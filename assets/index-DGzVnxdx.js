(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=a(s);fetch(s.href,i)}})();const Us=!1;var us=Array.isArray,vo=Array.prototype.indexOf,Ns=Array.from,Qr=Object.defineProperty,ya=Object.getOwnPropertyDescriptor,Jr=Object.getOwnPropertyDescriptors,go=Object.prototype,bo=Array.prototype,rr=Object.getPrototypeOf,wr=Object.isExtensible;const Vn=()=>{};function To(e){return e()}function Es(e){for(var t=0;t<e.length;t++)e[t]()}function Zr(){var e,t,a=new Promise((r,s)=>{e=r,t=s});return{promise:a,resolve:e,reject:t}}const Dt=2,Rs=4,ds=8,ei=1<<24,Fn=16,Bn=32,Sa=64,ir=128,sn=512,kt=1024,Wt=2048,wn=4096,Vt=8192,$n=16384,or=32768,$a=65536,Ar=1<<17,ti=1<<18,Ba=1<<19,ni=1<<20,Pn=1<<25,Ta=32768,Ks=1<<21,lr=1<<22,Qn=1<<23,On=Symbol("$state"),xo=Symbol("legacy props"),_o=Symbol(""),ka=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function cr(){throw new Error("https://svelte.dev/e/invalid_default_snippet")}function mr(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function So(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function wo(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ao(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Co(e){throw new Error("https://svelte.dev/e/effect_orphan")}function Eo(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Ro(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function Mo(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function ko(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Do(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Io(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Lo=1,No=2,ai=4,Po=8,$o=16,Oo=1,Wo=2,Yo=4,Ho=8,Fo=16,si=1,Bo=2,Mt=Symbol(),qo="http://www.w3.org/1999/xhtml";function Uo(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Ko(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function ri(e){return e===this.v}function ii(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function oi(e){return!ii(e,this.v)}let qa=!1,Go=!1;function zo(){qa=!0}let it=null;function Oa(e){it=e}function Yt(e,t=!1,a){it={p:it,i:!1,c:null,e:null,s:e,x:null,l:qa&&!t?{s:null,u:null,$:[]}:null}}function Ht(e){var t=it,a=t.e;if(a!==null){t.e=null;for(var r of a)wi(r)}return e!==void 0&&(t.x=e),t.i=!0,it=t.p,e??{}}function hs(){return!qa||it!==null&&it.l===null}let ha=[];function li(){var e=ha;ha=[],Es(e)}function Ua(e){if(ha.length===0&&!ns){var t=ha;queueMicrotask(()=>{t===ha&&li()})}ha.push(e)}function jo(){for(;ha.length>0;)li()}function ci(e){var t=Ve;if(t===null)return Ke.f|=Qn,e;if((t.f&or)===0){if((t.f&ir)===0)throw e;t.b.error(e)}else Wa(e,t)}function Wa(e,t){for(;t!==null;){if((t.f&ir)!==0)try{t.b.error(e);return}catch(a){e=a}t=t.parent}throw e}const Xo=-7169;function Et(e,t){e.f=e.f&Xo|t}function ur(e){(e.f&sn)!==0||e.deps===null?Et(e,kt):Et(e,wn)}function mi(e){if(e!==null)for(const t of e)(t.f&Dt)===0||(t.f&Ta)===0||(t.f^=Ta,mi(t.deps))}function ui(e,t,a){(e.f&Wt)!==0?t.add(e):(e.f&wn)!==0&&a.add(e),mi(e.deps),Et(e,kt)}const vs=new Set;let je=null,ts=null,un=null,tn=[],Ps=null,Gs=!1,ns=!1;class xn{committed=!1;current=new Map;previous=new Map;#t=new Set;#i=new Set;#e=0;#s=0;#r=null;#a=new Set;#n=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#s>0}process(t){tn=[],ts=null,this.apply();var a=[],r=[];for(const s of t)this.#o(s,a,r);this.is_fork||this.#c(),this.is_deferred()?(this.#l(r),this.#l(a)):(ts=this,je=null,Cr(r),Cr(a),ts=null,this.#r?.resolve()),un=null}#o(t,a,r){t.f^=kt;for(var s=t.first,i=null;s!==null;){var o=s.f,l=(o&(Bn|Sa))!==0,c=l&&(o&kt)!==0,m=c||(o&Vt)!==0||this.skipped_effects.has(s);if(!m&&s.fn!==null){l?s.f^=kt:i!==null&&(o&(Rs|ds|ei))!==0?i.b.defer_effect(s):(o&Rs)!==0?a.push(s):Ga(s)&&((o&Fn)!==0&&this.#a.add(s),Ya(s));var d=s.first;if(d!==null){s=d;continue}}var f=s.parent;for(s=s.next;s===null&&f!==null;)f===i&&(i=null),s=f.next,f=f.parent}}#l(t){for(var a=0;a<t.length;a+=1)ui(t[a],this.#a,this.#n)}capture(t,a){a!==Mt&&!this.previous.has(t)&&this.previous.set(t,a),(t.f&Qn)===0&&(this.current.set(t,t.v),un?.set(t,t.v))}activate(){je=this,this.apply()}deactivate(){je===this&&(je=null,un=null)}flush(){if(this.activate(),tn.length>0){if(di(),je!==null&&je!==this)return}else this.#e===0&&this.process([]);this.deactivate()}discard(){for(const t of this.#i)t(this);this.#i.clear()}#c(){if(this.#s===0){for(const t of this.#t)t();this.#t.clear()}this.#e===0&&this.#m()}#m(){if(vs.size>1){this.previous.clear();var t=un,a=!0;for(const s of vs){if(s===this){a=!1;continue}const i=[];for(const[l,c]of this.current){if(s.current.has(l))if(a&&c!==s.current.get(l))s.current.set(l,c);else continue;i.push(l)}if(i.length===0)continue;const o=[...s.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var r=tn;tn=[];const l=new Set,c=new Map;for(const m of i)hi(m,o,l,c);if(tn.length>0){je=s,s.apply();for(const m of tn)s.#o(m,[],[]);s.deactivate()}tn=r}}je=null,un=t}this.committed=!0,vs.delete(this)}increment(t){this.#e+=1,t&&(this.#s+=1)}decrement(t){this.#e-=1,t&&(this.#s-=1),this.revive()}revive(){for(const t of this.#a)this.#n.delete(t),Et(t,Wt),Hn(t);for(const t of this.#n)Et(t,wn),Hn(t);this.flush()}oncommit(t){this.#t.add(t)}ondiscard(t){this.#i.add(t)}settled(){return(this.#r??=Zr()).promise}static ensure(){if(je===null){const t=je=new xn;vs.add(je),ns||xn.enqueue(()=>{je===t&&t.flush()})}return je}static enqueue(t){Ua(t)}apply(){}}function Vo(e){var t=ns;ns=!0;try{for(var a;;){if(jo(),tn.length===0&&(je?.flush(),tn.length===0))return Ps=null,a;di()}}finally{ns=t}}function di(){var e=va;Gs=!0;var t=null;try{var a=0;for(ks(!0);tn.length>0;){var r=xn.ensure();if(a++>1e3){var s,i;Qo()}r.process(tn),Jn.clear()}}finally{Gs=!1,ks(e),Ps=null}}function Qo(){try{Eo()}catch(e){Wa(e,Ps)}}let Dn=null;function Cr(e){var t=e.length;if(t!==0){for(var a=0;a<t;){var r=e[a++];if((r.f&($n|Vt))===0&&Ga(r)&&(Dn=new Set,Ya(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?Ri(r):r.fn=null),Dn?.size>0)){Jn.clear();for(const s of Dn){if((s.f&($n|Vt))!==0)continue;const i=[s];let o=s.parent;for(;o!==null;)Dn.has(o)&&(Dn.delete(o),i.push(o)),o=o.parent;for(let l=i.length-1;l>=0;l--){const c=i[l];(c.f&($n|Vt))===0&&Ya(c)}}Dn.clear()}}Dn=null}}function hi(e,t,a,r){if(!a.has(e)&&(a.add(e),e.reactions!==null))for(const s of e.reactions){const i=s.f;(i&Dt)!==0?hi(s,t,a,r):(i&(lr|Fn))!==0&&(i&Wt)===0&&fi(s,t,r)&&(Et(s,Wt),Hn(s))}}function fi(e,t,a){const r=a.get(e);if(r!==void 0)return r;if(e.deps!==null)for(const s of e.deps){if(t.includes(s))return!0;if((s.f&Dt)!==0&&fi(s,t,a))return a.set(s,!0),!0}return a.set(e,!1),!1}function Hn(e){for(var t=Ps=e;t.parent!==null;){t=t.parent;var a=t.f;if(Gs&&t===Ve&&(a&Fn)!==0&&(a&ti)===0)return;if((a&(Sa|Bn))!==0){if((a&kt)===0)return;t.f^=kt}}tn.push(t)}function Jo(e){let t=0,a=xa(0),r;return()=>{fr()&&(n(a),Ka(()=>(t===0&&(r=v(()=>e(()=>as(a)))),t+=1,()=>{Ua(()=>{t-=1,t===0&&(r?.(),r=void 0,as(a))})})))}}var Zo=$a|Ba|ir;function el(e,t,a){new tl(e,t,a)}class tl{parent;is_pending=!1;#t;#i=null;#e;#s;#r;#a=null;#n=null;#o=null;#l=null;#c=null;#m=0;#u=0;#h=!1;#f=new Set;#y=new Set;#d=null;#T=Jo(()=>(this.#d=xa(this.#m),()=>{this.#d=null}));constructor(t,a,r){this.#t=t,this.#e=a,this.#s=r,this.parent=Ve.b,this.is_pending=!!this.#e.pending,this.#r=yr(()=>{Ve.b=this;{var s=this.#g();try{this.#a=nn(()=>r(s))}catch(i){this.error(i)}this.#u>0?this.#v():this.is_pending=!1}return()=>{this.#c?.remove()}},Zo)}#x(){try{this.#a=nn(()=>this.#s(this.#t))}catch(t){this.error(t)}}#_(){const t=this.#e.pending;t&&(this.#n=nn(()=>t(this.#t)),xn.enqueue(()=>{var a=this.#g();this.#a=this.#p(()=>(xn.ensure(),nn(()=>this.#s(a)))),this.#u>0?this.#v():(pa(this.#n,()=>{this.#n=null}),this.is_pending=!1)}))}#g(){var t=this.#t;return this.is_pending&&(this.#c=Wn(),this.#t.before(this.#c),t=this.#c),t}defer_effect(t){ui(t,this.#f,this.#y)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#e.pending}#p(t){var a=Ve,r=Ke,s=it;Sn(this.#r),qt(this.#r),Oa(this.#r.ctx);try{return t()}catch(i){return ci(i),null}finally{Sn(a),qt(r),Oa(s)}}#v(){const t=this.#e.pending;this.#a!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#c),Di(this.#a,this.#l)),this.#n===null&&(this.#n=nn(()=>t(this.#t)))}#b(t){if(!this.has_pending_snippet()){this.parent&&this.parent.#b(t);return}if(this.#u+=t,this.#u===0){this.is_pending=!1;for(const a of this.#f)Et(a,Wt),Hn(a);for(const a of this.#y)Et(a,wn),Hn(a);this.#f.clear(),this.#y.clear(),this.#n&&pa(this.#n,()=>{this.#n=null}),this.#l&&(this.#t.before(this.#l),this.#l=null)}}update_pending_count(t){this.#b(t),this.#m+=t,this.#d&&_a(this.#d,this.#m)}get_effect_pending(){return this.#T(),n(this.#d)}error(t){var a=this.#e.onerror;let r=this.#e.failed;if(this.#h||!a&&!r)throw t;this.#a&&(Ut(this.#a),this.#a=null),this.#n&&(Ut(this.#n),this.#n=null),this.#o&&(Ut(this.#o),this.#o=null);var s=!1,i=!1;const o=()=>{if(s){Ko();return}s=!0,i&&Io(),xn.ensure(),this.#m=0,this.#o!==null&&pa(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#a=this.#p(()=>(this.#h=!1,nn(()=>this.#s(this.#t)))),this.#u>0?this.#v():this.is_pending=!1};var l=Ke;try{qt(null),i=!0,a?.(t,o),i=!1}catch(c){Wa(c,this.#r&&this.#r.parent)}finally{qt(l)}r&&Ua(()=>{this.#o=this.#p(()=>{xn.ensure(),this.#h=!0;try{return nn(()=>{r(this.#t,()=>t,()=>o)})}catch(c){return Wa(c,this.#r.parent),null}finally{this.#h=!1}})})}}function nl(e,t,a,r){const s=hs()?$s:Xe;if(a.length===0&&e.length===0){r(t.map(s));return}var i=je,o=Ve,l=al();function c(){Promise.all(a.map(m=>sl(m))).then(m=>{l();try{r([...t.map(s),...m])}catch(d){(o.f&$n)===0&&Wa(d,o)}i?.deactivate(),Ms()}).catch(m=>{Wa(m,o)})}e.length>0?Promise.all(e).then(()=>{l();try{return c()}finally{i?.deactivate(),Ms()}}):c()}function al(){var e=Ve,t=Ke,a=it,r=je;return function(i=!0){Sn(e),qt(t),Oa(a),i&&r?.activate()}}function Ms(){Sn(null),qt(null),Oa(null)}function $s(e){var t=Dt|Wt,a=Ke!==null&&(Ke.f&Dt)!==0?Ke:null;return Ve!==null&&(Ve.f|=Ba),{ctx:it,deps:null,effects:null,equals:ri,f:t,fn:e,reactions:null,rv:0,v:Mt,wv:0,parent:a??Ve,ac:null}}function sl(e,t,a){let r=Ve;r===null&&So();var s=r.b,i=void 0,o=xa(Mt),l=!Ke,c=new Map;return fl(()=>{var m=Zr();i=m.promise;try{Promise.resolve(e()).then(m.resolve,m.reject).then(()=>{d===je&&d.committed&&d.deactivate(),Ms()})}catch(h){m.reject(h),Ms()}var d=je;if(l){var f=s.is_rendered();s.update_pending_count(1),d.increment(f),c.get(d)?.reject(ka),c.delete(d),c.set(d,m)}const u=(h,y=void 0)=>{if(d.activate(),y)y!==ka&&(o.f|=Qn,_a(o,y));else{(o.f&Qn)!==0&&(o.f^=Qn),_a(o,h);for(const[g,p]of c){if(c.delete(g),g===d)break;p.reject(ka)}}l&&(s.update_pending_count(-1),d.decrement(f))};m.promise.then(u,h=>u(null,h||"unknown"))}),ys(()=>{for(const m of c.values())m.reject(ka)}),new Promise(m=>{function d(f){function u(){f===i?m(o):d(i)}f.then(u,u)}d(i)})}function Xe(e){const t=$s(e);return t.equals=oi,t}function yi(e){var t=e.effects;if(t!==null){e.effects=null;for(var a=0;a<t.length;a+=1)Ut(t[a])}}function rl(e){for(var t=e.parent;t!==null;){if((t.f&Dt)===0)return(t.f&$n)===0?t:null;t=t.parent}return null}function dr(e){var t,a=Ve;Sn(rl(e));try{e.f&=~Ta,yi(e),t=$i(e)}finally{Sn(a)}return t}function pi(e){var t=dr(e);if(!e.equals(t)&&(e.wv=Ni(),(!je?.is_fork||e.deps===null)&&(e.v=t,e.deps===null))){Et(e,kt);return}ea||(un!==null?(fr()||je?.is_fork)&&un.set(e,t):ur(e))}let zs=new Set;const Jn=new Map;let vi=!1;function xa(e,t){var a={f:0,v:e,reactions:null,equals:ri,rv:0,wv:0};return a}function Kn(e,t){const a=xa(e);return gl(a),a}function O(e,t=!1,a=!0){const r=xa(e);return t||(r.equals=oi),qa&&a&&it!==null&&it.l!==null&&(it.l.s??=[]).push(r),r}function Ys(e,t){return _(e,v(()=>n(e))),t}function _(e,t,a=!1){Ke!==null&&(!dn||(Ke.f&Ar)!==0)&&hs()&&(Ke.f&(Dt|Fn|lr|Ar))!==0&&!Yn?.includes(e)&&Do();let r=a?Da(t):t;return _a(e,r)}function _a(e,t){if(!e.equals(t)){var a=e.v;ea?Jn.set(e,t):Jn.set(e,a),e.v=t;var r=xn.ensure();if(r.capture(e,a),(e.f&Dt)!==0){const s=e;(e.f&Wt)!==0&&dr(s),ur(s)}e.wv=Ni(),gi(e,Wt),hs()&&Ve!==null&&(Ve.f&kt)!==0&&(Ve.f&(Bn|Sa))===0&&(en===null?bl([e]):en.push(e)),!r.is_fork&&zs.size>0&&!vi&&il()}return t}function il(){vi=!1;var e=va;ks(!0);const t=Array.from(zs);try{for(const a of t)(a.f&kt)!==0&&Et(a,wn),Ga(a)&&Ya(a)}finally{ks(e)}zs.clear()}function as(e){_(e,e.v+1)}function gi(e,t){var a=e.reactions;if(a!==null)for(var r=hs(),s=a.length,i=0;i<s;i++){var o=a[i],l=o.f;if(!(!r&&o===Ve)){var c=(l&Wt)===0;if(c&&Et(o,t),(l&Dt)!==0){var m=o;un?.delete(m),(l&Ta)===0&&(l&sn&&(o.f|=Ta),gi(m,wn))}else c&&((l&Fn)!==0&&Dn!==null&&Dn.add(o),Hn(o))}}}function Da(e){if(typeof e!="object"||e===null||On in e)return e;const t=rr(e);if(t!==go&&t!==bo)return e;var a=new Map,r=us(e),s=Kn(0),i=ga,o=l=>{if(ga===i)return l();var c=Ke,m=ga;qt(null),kr(i);var d=l();return qt(c),kr(m),d};return r&&a.set("length",Kn(e.length)),new Proxy(e,{defineProperty(l,c,m){(!("value"in m)||m.configurable===!1||m.enumerable===!1||m.writable===!1)&&Mo();var d=a.get(c);return d===void 0?d=o(()=>{var f=Kn(m.value);return a.set(c,f),f}):_(d,m.value,!0),!0},deleteProperty(l,c){var m=a.get(c);if(m===void 0){if(c in l){const d=o(()=>Kn(Mt));a.set(c,d),as(s)}}else _(m,Mt),as(s);return!0},get(l,c,m){if(c===On)return e;var d=a.get(c),f=c in l;if(d===void 0&&(!f||ya(l,c)?.writable)&&(d=o(()=>{var h=Da(f?l[c]:Mt),y=Kn(h);return y}),a.set(c,d)),d!==void 0){var u=n(d);return u===Mt?void 0:u}return Reflect.get(l,c,m)},getOwnPropertyDescriptor(l,c){var m=Reflect.getOwnPropertyDescriptor(l,c);if(m&&"value"in m){var d=a.get(c);d&&(m.value=n(d))}else if(m===void 0){var f=a.get(c),u=f?.v;if(f!==void 0&&u!==Mt)return{enumerable:!0,configurable:!0,value:u,writable:!0}}return m},has(l,c){if(c===On)return!0;var m=a.get(c),d=m!==void 0&&m.v!==Mt||Reflect.has(l,c);if(m!==void 0||Ve!==null&&(!d||ya(l,c)?.writable)){m===void 0&&(m=o(()=>{var u=d?Da(l[c]):Mt,h=Kn(u);return h}),a.set(c,m));var f=n(m);if(f===Mt)return!1}return d},set(l,c,m,d){var f=a.get(c),u=c in l;if(r&&c==="length")for(var h=m;h<f.v;h+=1){var y=a.get(h+"");y!==void 0?_(y,Mt):h in l&&(y=o(()=>Kn(Mt)),a.set(h+"",y))}if(f===void 0)(!u||ya(l,c)?.writable)&&(f=o(()=>Kn(void 0)),_(f,Da(m)),a.set(c,f));else{u=f.v!==Mt;var g=o(()=>Da(m));_(f,g)}var p=Reflect.getOwnPropertyDescriptor(l,c);if(p?.set&&p.set.call(d,m),!u){if(r&&typeof c=="string"){var S=a.get("length"),k=Number(c);Number.isInteger(k)&&k>=S.v&&_(S,k+1)}as(s)}return!0},ownKeys(l){n(s);var c=Reflect.ownKeys(l).filter(f=>{var u=a.get(f);return u===void 0||u.v!==Mt});for(var[m,d]of a)d.v!==Mt&&!(m in l)&&c.push(m);return c},setPrototypeOf(){ko()}})}function Er(e){try{if(e!==null&&typeof e=="object"&&On in e)return e[On]}catch{}return e}function ol(e,t){return Object.is(Er(e),Er(t))}var Ia,bi,Ti,xi;function ll(){if(Ia===void 0){Ia=window,bi=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,a=Text.prototype;Ti=ya(t,"firstChild").get,xi=ya(t,"nextSibling").get,wr(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),wr(a)&&(a.__t=void 0)}}function Wn(e=""){return document.createTextNode(e)}function Ln(e){return Ti.call(e)}function fs(e){return xi.call(e)}function E(e,t){return Ln(e)}function Re(e,t=!1){{var a=Ln(e);return a instanceof Comment&&a.data===""?fs(a):a}}function A(e,t=1,a=!1){let r=e;for(;t--;)r=fs(r);return r}function cl(e){e.textContent=""}function _i(){return!1}let Rr=!1;function ml(){Rr||(Rr=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{if(!e.defaultPrevented)for(const t of e.target.elements)t.__on_r?.()})},{capture:!0}))}function Os(e){var t=Ke,a=Ve;qt(null),Sn(null);try{return e()}finally{qt(t),Sn(a)}}function hr(e,t,a,r=a){e.addEventListener(t,()=>Os(a));const s=e.__on_r;s?e.__on_r=()=>{s(),r(!0)}:e.__on_r=()=>r(!0),ml()}function Si(e){Ve===null&&(Ke===null&&Co(),Ao()),ea&&wo()}function ul(e,t){var a=t.last;a===null?t.last=t.first=e:(a.next=e,e.prev=a,t.last=e)}function An(e,t,a){var r=Ve;r!==null&&(r.f&Vt)!==0&&(e|=Vt);var s={ctx:it,deps:null,nodes:null,f:e|Wt|sn,first:null,fn:t,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(a)try{Ya(s),s.f|=or}catch(l){throw Ut(s),l}else t!==null&&Hn(s);var i=s;if(a&&i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&Ba)===0&&(i=i.first,(e&Fn)!==0&&(e&$a)!==0&&i!==null&&(i.f|=$a)),i!==null&&(i.parent=r,r!==null&&ul(i,r),Ke!==null&&(Ke.f&Dt)!==0&&(e&Sa)===0)){var o=Ke;(o.effects??=[]).push(i)}return s}function fr(){return Ke!==null&&!dn}function ys(e){const t=An(ds,null,!1);return Et(t,kt),t.teardown=e,t}function js(e){Si();var t=Ve.f,a=!Ke&&(t&Bn)!==0&&(t&or)===0;if(a){var r=it;(r.e??=[]).push(e)}else return wi(e)}function wi(e){return An(Rs|ni,e,!1)}function dl(e){return Si(),An(ds|ni,e,!0)}function hl(e){xn.ensure();const t=An(Sa|Ba,e,!0);return(a={})=>new Promise(r=>{a.outro?pa(t,()=>{Ut(t),r(void 0)}):(Ut(t),r(void 0))})}function Ai(e){return An(Rs,e,!1)}function le(e,t){var a=it,r={effect:null,ran:!1,deps:e};a.l.$.push(r),r.effect=Ka(()=>{e(),!r.ran&&(r.ran=!0,v(t))})}function Cn(){var e=it;Ka(()=>{for(var t of e.l.$){t.deps();var a=t.effect;(a.f&kt)!==0&&a.deps!==null&&Et(a,wn),Ga(a)&&Ya(a),t.ran=!1}})}function fl(e){return An(lr|Ba,e,!0)}function Ka(e,t=0){return An(ds|t,e,!0)}function V(e,t=[],a=[],r=[]){nl(r,t,a,s=>{An(ds,()=>e(...s.map(n)),!0)})}function yr(e,t=0){var a=An(Fn|t,e,!0);return a}function nn(e){return An(Bn|Ba,e,!0)}function Ci(e){var t=e.teardown;if(t!==null){const a=ea,r=Ke;Mr(!0),qt(null);try{t.call(null)}finally{Mr(a),qt(r)}}}function Ei(e,t=!1){var a=e.first;for(e.first=e.last=null;a!==null;){const s=a.ac;s!==null&&Os(()=>{s.abort(ka)});var r=a.next;(a.f&Sa)!==0?a.parent=null:Ut(a,t),a=r}}function yl(e){for(var t=e.first;t!==null;){var a=t.next;(t.f&Bn)===0&&Ut(t),t=a}}function Ut(e,t=!0){var a=!1;(t||(e.f&ti)!==0)&&e.nodes!==null&&e.nodes.end!==null&&(pl(e.nodes.start,e.nodes.end),a=!0),Ei(e,t&&!a),Ds(e,0),Et(e,$n);var r=e.nodes&&e.nodes.t;if(r!==null)for(const i of r)i.stop();Ci(e);var s=e.parent;s!==null&&s.first!==null&&Ri(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes=e.ac=null}function pl(e,t){for(;e!==null;){var a=e===t?null:fs(e);e.remove(),e=a}}function Ri(e){var t=e.parent,a=e.prev,r=e.next;a!==null&&(a.next=r),r!==null&&(r.prev=a),t!==null&&(t.first===e&&(t.first=r),t.last===e&&(t.last=a))}function pa(e,t,a=!0){var r=[];Mi(e,r,!0);var s=()=>{a&&Ut(e),t&&t()},i=r.length;if(i>0){var o=()=>--i||s();for(var l of r)l.out(o)}else s()}function Mi(e,t,a){if((e.f&Vt)===0){e.f^=Vt;var r=e.nodes&&e.nodes.t;if(r!==null)for(const l of r)(l.is_global||a)&&t.push(l);for(var s=e.first;s!==null;){var i=s.next,o=(s.f&$a)!==0||(s.f&Bn)!==0&&(e.f&Fn)!==0;Mi(s,t,o?a:!1),s=i}}}function pr(e){ki(e,!0)}function ki(e,t){if((e.f&Vt)!==0){e.f^=Vt,(e.f&kt)===0&&(Et(e,Wt),Hn(e));for(var a=e.first;a!==null;){var r=a.next,s=(a.f&$a)!==0||(a.f&Bn)!==0;ki(a,s?t:!1),a=r}var i=e.nodes&&e.nodes.t;if(i!==null)for(const o of i)(o.is_global||t)&&o.in()}}function Di(e,t){if(e.nodes)for(var a=e.nodes.start,r=e.nodes.end;a!==null;){var s=a===r?null:fs(a);t.append(a),a=s}}let Ma=null;function vl(e){var t=Ma;try{if(Ma=new Set,v(e),t!==null)for(var a of Ma)t.add(a);return Ma}finally{Ma=t}}function Ii(e){for(var t of vl(e))_a(t,t.v)}let va=!1;function ks(e){va=e}let ea=!1;function Mr(e){ea=e}let Ke=null,dn=!1;function qt(e){Ke=e}let Ve=null;function Sn(e){Ve=e}let Yn=null;function gl(e){Ke!==null&&(Yn===null?Yn=[e]:Yn.push(e))}let Ot=null,Gt=0,en=null;function bl(e){en=e}let Li=1,os=0,ga=os;function kr(e){ga=e}function Ni(){return++Li}function Ga(e){var t=e.f;if((t&Wt)!==0)return!0;if(t&Dt&&(e.f&=~Ta),(t&wn)!==0){for(var a=e.deps,r=a.length,s=0;s<r;s++){var i=a[s];if(Ga(i)&&pi(i),i.wv>e.wv)return!0}(t&sn)!==0&&un===null&&Et(e,kt)}return!1}function Pi(e,t,a=!0){var r=e.reactions;if(r!==null&&!Yn?.includes(e))for(var s=0;s<r.length;s++){var i=r[s];(i.f&Dt)!==0?Pi(i,t,!1):t===i&&(a?Et(i,Wt):(i.f&kt)!==0&&Et(i,wn),Hn(i))}}function $i(e){var t=Ot,a=Gt,r=en,s=Ke,i=Yn,o=it,l=dn,c=ga,m=e.f;Ot=null,Gt=0,en=null,Ke=(m&(Bn|Sa))===0?e:null,Yn=null,Oa(e.ctx),dn=!1,ga=++os,e.ac!==null&&(Os(()=>{e.ac.abort(ka)}),e.ac=null);try{e.f|=Ks;var d=e.fn,f=d(),u=e.deps;if(Ot!==null){var h;if(Ds(e,Gt),u!==null&&Gt>0)for(u.length=Gt+Ot.length,h=0;h<Ot.length;h++)u[Gt+h]=Ot[h];else e.deps=u=Ot;if(fr()&&(e.f&sn)!==0)for(h=Gt;h<u.length;h++)(u[h].reactions??=[]).push(e)}else u!==null&&Gt<u.length&&(Ds(e,Gt),u.length=Gt);if(hs()&&en!==null&&!dn&&u!==null&&(e.f&(Dt|wn|Wt))===0)for(h=0;h<en.length;h++)Pi(en[h],e);return s!==null&&s!==e&&(os++,en!==null&&(r===null?r=en:r.push(...en))),(e.f&Qn)!==0&&(e.f^=Qn),f}catch(y){return ci(y)}finally{e.f^=Ks,Ot=t,Gt=a,en=r,Ke=s,Yn=i,Oa(o),dn=l,ga=c}}function Tl(e,t){let a=t.reactions;if(a!==null){var r=vo.call(a,e);if(r!==-1){var s=a.length-1;s===0?a=t.reactions=null:(a[r]=a[s],a.pop())}}if(a===null&&(t.f&Dt)!==0&&(Ot===null||!Ot.includes(t))){var i=t;(i.f&sn)!==0&&(i.f^=sn,i.f&=~Ta),ur(i),yi(i),Ds(i,0)}}function Ds(e,t){var a=e.deps;if(a!==null)for(var r=t;r<a.length;r++)Tl(e,a[r])}function Ya(e){var t=e.f;if((t&$n)===0){Et(e,kt);var a=Ve,r=va;Ve=e,va=!0;try{(t&(Fn|ei))!==0?yl(e):Ei(e),Ci(e);var s=$i(e);e.teardown=typeof s=="function"?s:null,e.wv=Li;var i;Us&&Go&&(e.f&Wt)!==0&&e.deps}finally{va=r,Ve=a}}}async function xl(){await Promise.resolve(),Vo()}function n(e){var t=e.f,a=(t&Dt)!==0;if(Ma?.add(e),Ke!==null&&!dn){var r=Ve!==null&&(Ve.f&$n)!==0;if(!r&&!Yn?.includes(e)){var s=Ke.deps;if((Ke.f&Ks)!==0)e.rv<os&&(e.rv=os,Ot===null&&s!==null&&s[Gt]===e?Gt++:Ot===null?Ot=[e]:Ot.includes(e)||Ot.push(e));else{(Ke.deps??=[]).push(e);var i=e.reactions;i===null?e.reactions=[Ke]:i.includes(Ke)||i.push(Ke)}}}if(ea&&Jn.has(e))return Jn.get(e);if(a){var o=e;if(ea){var l=o.v;return((o.f&kt)===0&&o.reactions!==null||Wi(o))&&(l=dr(o)),Jn.set(o,l),l}var c=(o.f&sn)===0&&!dn&&Ke!==null&&(va||(Ke.f&sn)!==0),m=o.deps===null;Ga(o)&&(c&&(o.f|=sn),pi(o)),c&&!m&&Oi(o)}if(un?.has(e))return un.get(e);if((e.f&Qn)!==0)throw e.v;return e.v}function Oi(e){if(e.deps!==null){e.f|=sn;for(const t of e.deps)(t.reactions??=[]).push(e),(t.f&Dt)!==0&&(t.f&sn)===0&&Oi(t)}}function Wi(e){if(e.v===Mt)return!0;if(e.deps===null)return!1;for(const t of e.deps)if(Jn.has(t)||(t.f&Dt)!==0&&Wi(t))return!0;return!1}function v(e){var t=dn;try{return dn=!0,e()}finally{dn=t}}function ee(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(On in e)Xs(e);else if(!Array.isArray(e))for(let t in e){const a=e[t];typeof a=="object"&&a&&On in a&&Xs(a)}}}function Xs(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let r in e)try{Xs(e[r],t)}catch{}const a=rr(e);if(a!==Object.prototype&&a!==Array.prototype&&a!==Map.prototype&&a!==Set.prototype&&a!==Date.prototype){const r=Jr(a);for(let s in r){const i=r[s].get;if(i)try{i.call(e)}catch{}}}}}const _l=["touchstart","touchmove"];function Sl(e){return _l.includes(e)}const wl=new Set,Dr=new Set;function Al(e,t,a,r={}){function s(i){if(r.capture||Qa.call(t,i),!i.cancelBubble)return Os(()=>a?.call(this,i))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?Ua(()=>{t.addEventListener(e,s,r)}):t.addEventListener(e,s,r),s}function q(e,t,a,r,s){var i={capture:r,passive:s},o=Al(e,t,a,i);(t===document.body||t===window||t===document||t instanceof HTMLMediaElement)&&ys(()=>{t.removeEventListener(e,o,i)})}let Ir=null;function Qa(e){var t=this,a=t.ownerDocument,r=e.type,s=e.composedPath?.()||[],i=s[0]||e.target;Ir=e;var o=0,l=Ir===e&&e.__root;if(l){var c=s.indexOf(l);if(c!==-1&&(t===document||t===window)){e.__root=t;return}var m=s.indexOf(t);if(m===-1)return;c<=m&&(o=c)}if(i=s[o]||e.target,i!==t){Qr(e,"currentTarget",{configurable:!0,get(){return i||a}});var d=Ke,f=Ve;qt(null),Sn(null);try{for(var u,h=[];i!==null;){var y=i.assignedSlot||i.parentNode||i.host||null;try{var g=i["__"+r];g!=null&&(!i.disabled||e.target===i)&&g.call(i,e)}catch(p){u?h.push(p):u=p}if(e.cancelBubble||y===t||y===null)break;i=y}if(u){for(let p of h)queueMicrotask(()=>{throw p});throw u}}finally{e.__root=t,delete e.currentTarget,qt(d),Sn(f)}}}function Yi(e){var t=document.createElement("template");return t.innerHTML=e.replaceAll("<!>","<!---->"),t.content}function Ha(e,t){var a=Ve;a.nodes===null&&(a.nodes={start:e,end:t,a:null,t:null})}function pe(e,t){var a=(t&si)!==0,r=(t&Bo)!==0,s,i=!e.startsWith("<!>");return()=>{s===void 0&&(s=Yi(i?e:"<!>"+e),a||(s=Ln(s)));var o=r||bi?document.importNode(s,!0):s.cloneNode(!0);if(a){var l=Ln(o),c=o.lastChild;Ha(l,c)}else Ha(o,o);return o}}function Cl(e,t,a="svg"){var r=!e.startsWith("<!>"),s=(t&si)!==0,i=`<${a}>${r?e:"<!>"+e}</${a}>`,o;return()=>{if(!o){var l=Yi(i),c=Ln(l);if(s)for(o=document.createDocumentFragment();Ln(c);)o.appendChild(Ln(c));else o=Ln(c)}var m=o.cloneNode(!0);if(s){var d=Ln(m),f=m.lastChild;Ha(d,f)}else Ha(m,m);return m}}function Ae(e,t){return Cl(e,t,"svg")}function Hi(e=""){{var t=Wn(e+"");return Ha(t,t),t}}function bt(){var e=document.createDocumentFragment(),t=document.createComment(""),a=Wn();return e.append(t,a),Ha(t,a),e}function L(e,t){e!==null&&e.before(t)}function Ce(e,t){var a=t==null?"":typeof t=="object"?t+"":t;a!==(e.__t??=e.nodeValue)&&(e.__t=a,e.nodeValue=a+"")}function El(e,t){return Rl(e,t)}const Ca=new Map;function Rl(e,{target:t,anchor:a,props:r={},events:s,context:i,intro:o=!0}){ll();var l=new Set,c=f=>{for(var u=0;u<f.length;u++){var h=f[u];if(!l.has(h)){l.add(h);var y=Sl(h);t.addEventListener(h,Qa,{passive:y});var g=Ca.get(h);g===void 0?(document.addEventListener(h,Qa,{passive:y}),Ca.set(h,1)):Ca.set(h,g+1)}}};c(Ns(wl)),Dr.add(c);var m=void 0,d=hl(()=>{var f=a??t.appendChild(Wn());return el(f,{pending:()=>{}},u=>{if(i){Yt({});var h=it;h.c=i}s&&(r.$$events=s),m=e(u,r)||{},i&&Ht()}),()=>{for(var u of l){t.removeEventListener(u,Qa);var h=Ca.get(u);--h===0?(document.removeEventListener(u,Qa),Ca.delete(u)):Ca.set(u,h)}Dr.delete(c),f!==a&&f.parentNode?.removeChild(f)}});return Ml.set(m,d),m}let Ml=new WeakMap;class kl{anchor;#t=new Map;#i=new Map;#e=new Map;#s=new Set;#r=!0;constructor(t,a=!0){this.anchor=t,this.#r=a}#a=()=>{var t=je;if(this.#t.has(t)){var a=this.#t.get(t),r=this.#i.get(a);if(r)pr(r),this.#s.delete(a);else{var s=this.#e.get(a);s&&(this.#i.set(a,s.effect),this.#e.delete(a),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),r=s.effect)}for(const[i,o]of this.#t){if(this.#t.delete(i),i===t)break;const l=this.#e.get(o);l&&(Ut(l.effect),this.#e.delete(o))}for(const[i,o]of this.#i){if(i===a||this.#s.has(i))continue;const l=()=>{if(Array.from(this.#t.values()).includes(i)){var m=document.createDocumentFragment();Di(o,m),m.append(Wn()),this.#e.set(i,{effect:o,fragment:m})}else Ut(o);this.#s.delete(i),this.#i.delete(i)};this.#r||!r?(this.#s.add(i),pa(o,l,!1)):l()}}};#n=t=>{this.#t.delete(t);const a=Array.from(this.#t.values());for(const[r,s]of this.#e)a.includes(r)||(Ut(s.effect),this.#e.delete(r))};ensure(t,a){var r=je,s=_i();if(a&&!this.#i.has(t)&&!this.#e.has(t))if(s){var i=document.createDocumentFragment(),o=Wn();i.append(o),this.#e.set(t,{effect:nn(()=>a(o)),fragment:i})}else this.#i.set(t,nn(()=>a(this.anchor)));if(this.#t.set(r,t),s){for(const[l,c]of this.#i)l===t?r.skipped_effects.delete(c):r.skipped_effects.add(c);for(const[l,c]of this.#e)l===t?r.skipped_effects.delete(c.effect):r.skipped_effects.add(c.effect);r.oncommit(this.#a),r.ondiscard(this.#n)}else this.#a()}}function be(e,t,a=!1){var r=new kl(e),s=a?$a:0;function i(o,l){r.ensure(o,l)}yr(()=>{var o=!1;t((l,c=!0)=>{o=!0,i(c,l)}),o||i(!1,null)},s)}function Be(e,t){return t}function Dl(e,t,a){for(var r=[],s=t.length,i,o=t.length,l=0;l<s;l++){let f=t[l];pa(f,()=>{if(i){if(i.pending.delete(f),i.done.add(f),i.pending.size===0){var u=e.outrogroups;Vs(Ns(i.done)),u.delete(i),u.size===0&&(e.outrogroups=null)}}else o-=1},!1)}if(o===0){var c=r.length===0&&a!==null;if(c){var m=a,d=m.parentNode;cl(d),d.append(m),e.items.clear()}Vs(t,!c)}else i={pending:new Set(t),done:new Set},(e.outrogroups??=new Set).add(i)}function Vs(e,t=!0){for(var a=0;a<e.length;a++)Ut(e[a],t)}var Lr;function Me(e,t,a,r,s,i=null){var o=e,l=new Map,c=(t&ai)!==0;if(c){var m=e;o=m.appendChild(Wn())}var d=null,f=Xe(()=>{var S=a();return us(S)?S:S==null?[]:Ns(S)}),u,h=!0;function y(){p.fallback=d,Il(p,u,o,t,r),d!==null&&(u.length===0?(d.f&Pn)===0?pr(d):(d.f^=Pn,Ja(d,null,o)):pa(d,()=>{d=null}))}var g=yr(()=>{u=n(f);for(var S=u.length,k=new Set,C=je,b=_i(),T=0;T<S;T+=1){var R=u[T],N=r(R,T),w=h?null:l.get(N);w?(w.v&&_a(w.v,R),w.i&&_a(w.i,T),b&&C.skipped_effects.delete(w.e)):(w=Ll(l,h?o:Lr??=Wn(),R,N,T,s,t,a),h||(w.e.f|=Pn),l.set(N,w)),k.add(N)}if(S===0&&i&&!d&&(h?d=nn(()=>i(o)):(d=nn(()=>i(Lr??=Wn())),d.f|=Pn)),!h)if(b){for(const[I,W]of l)k.has(I)||C.skipped_effects.add(W.e);C.oncommit(y),C.ondiscard(()=>{})}else y();n(f)}),p={effect:g,items:l,outrogroups:null,fallback:d};h=!1}function Il(e,t,a,r,s){var i=(r&Po)!==0,o=t.length,l=e.items,c=e.effect.first,m,d=null,f,u=[],h=[],y,g,p,S;if(i)for(S=0;S<o;S+=1)y=t[S],g=s(y,S),p=l.get(g).e,(p.f&Pn)===0&&(p.nodes?.a?.measure(),(f??=new Set).add(p));for(S=0;S<o;S+=1){if(y=t[S],g=s(y,S),p=l.get(g).e,e.outrogroups!==null)for(const W of e.outrogroups)W.pending.delete(p),W.done.delete(p);if((p.f&Pn)!==0)if(p.f^=Pn,p===c)Ja(p,null,a);else{var k=d?d.next:c;p===e.effect.last&&(e.effect.last=p.prev),p.prev&&(p.prev.next=p.next),p.next&&(p.next.prev=p.prev),Gn(e,d,p),Gn(e,p,k),Ja(p,k,a),d=p,u=[],h=[],c=d.next;continue}if((p.f&Vt)!==0&&(pr(p),i&&(p.nodes?.a?.unfix(),(f??=new Set).delete(p))),p!==c){if(m!==void 0&&m.has(p)){if(u.length<h.length){var C=h[0],b;d=C.prev;var T=u[0],R=u[u.length-1];for(b=0;b<u.length;b+=1)Ja(u[b],C,a);for(b=0;b<h.length;b+=1)m.delete(h[b]);Gn(e,T.prev,R.next),Gn(e,d,T),Gn(e,R,C),c=C,d=R,S-=1,u=[],h=[]}else m.delete(p),Ja(p,c,a),Gn(e,p.prev,p.next),Gn(e,p,d===null?e.effect.first:d.next),Gn(e,d,p),d=p;continue}for(u=[],h=[];c!==null&&c!==p;)(m??=new Set).add(c),h.push(c),c=c.next;if(c===null)continue}(p.f&Pn)===0&&u.push(p),d=p,c=p.next}if(e.outrogroups!==null){for(const W of e.outrogroups)W.pending.size===0&&(Vs(Ns(W.done)),e.outrogroups?.delete(W));e.outrogroups.size===0&&(e.outrogroups=null)}if(c!==null||m!==void 0){var N=[];if(m!==void 0)for(p of m)(p.f&Vt)===0&&N.push(p);for(;c!==null;)(c.f&Vt)===0&&c!==e.fallback&&N.push(c),c=c.next;var w=N.length;if(w>0){var I=(r&ai)!==0&&o===0?a:null;if(i){for(S=0;S<w;S+=1)N[S].nodes?.a?.measure();for(S=0;S<w;S+=1)N[S].nodes?.a?.fix()}Dl(e,N,I)}}i&&Ua(()=>{if(f!==void 0)for(p of f)p.nodes?.a?.apply()})}function Ll(e,t,a,r,s,i,o,l){var c=(o&Lo)!==0?(o&$o)===0?O(a,!1,!1):xa(a):null,m=(o&No)!==0?xa(s):null;return{v:c,i:m,e:nn(()=>(i(t,c??a,m??s,l),()=>{e.delete(r)}))}}function Ja(e,t,a){if(e.nodes)for(var r=e.nodes.start,s=e.nodes.end,i=t&&(t.f&Pn)===0?t.nodes.start:a;r!==null;){var o=fs(r);if(i.before(r),r===s)return;r=o}}function Gn(e,t,a){t===null?e.effect.first=a:t.next=a,a===null?e.effect.last=t:a.prev=t}function Fi(e,t,a,r,s){var i=t.$$slots?.[a],o=!1;i===!0&&(i=t.children,o=!0),i===void 0||i(e,o?()=>r:r)}const Nr=[...` 	
\r\fÂ \v\uFEFF`];function Nl(e,t,a){var r=e==null?"":""+e;if(a){for(var s in a)if(a[s])r=r?r+" "+s:s;else if(r.length)for(var i=s.length,o=0;(o=r.indexOf(s,o))>=0;){var l=o+i;(o===0||Nr.includes(r[o-1]))&&(l===r.length||Nr.includes(r[l]))?r=(o===0?"":r.substring(0,o))+r.substring(l+1):o=l}}return r===""?null:r}function Pl(e,t){return e==null?null:String(e)}function hn(e,t,a,r,s,i){var o=e.__className;if(o!==a||o===void 0){var l=Nl(a,r,i);l==null?e.removeAttribute("class"):t?e.className=l:e.setAttribute("class",l),e.__className=a}else if(i&&s!==i)for(var c in i){var m=!!i[c];(s==null||m!==!!s[c])&&e.classList.toggle(c,m)}return i}function $l(e,t,a,r){var s=e.__style;if(s!==t){var i=Pl(t);i==null?e.removeAttribute("style"):e.style.cssText=i,e.__style=t}return r}function Bi(e,t,a=!1){if(e.multiple){if(t==null)return;if(!us(t))return Uo();for(var r of e.options)r.selected=t.includes(ss(r));return}for(r of e.options){var s=ss(r);if(ol(s,t)){r.selected=!0;return}}(!a||t!==void 0)&&(e.selectedIndex=-1)}function Ol(e){var t=new MutationObserver(()=>{Bi(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ys(()=>{t.disconnect()})}function qi(e,t,a=t){var r=new WeakSet,s=!0;hr(e,"change",i=>{var o=i?"[selected]":":checked",l;if(e.multiple)l=[].map.call(e.querySelectorAll(o),ss);else{var c=e.querySelector(o)??e.querySelector("option:not([disabled])");l=c&&ss(c)}a(l),je!==null&&r.add(je)}),Ai(()=>{var i=t();if(e===document.activeElement){var o=ts??je;if(r.has(o))return}if(Bi(e,i,s),s&&i===void 0){var l=e.querySelector(":checked");l!==null&&(i=ss(l),a(i))}e.__value=i,s=!1}),Ol(e)}function ss(e){return"__value"in e?e.__value:e.value}const Wl=Symbol("is custom element"),Yl=Symbol("is html");function Hl(e,t){var a=Ui(e);a.value===(a.value=t??void 0)||e.value===t&&(t!==0||e.nodeName!=="PROGRESS")||(e.value=t??"")}function x(e,t,a,r){var s=Ui(e);s[t]!==(s[t]=a)&&(t==="loading"&&(e[_o]=a),a==null?e.removeAttribute(t):typeof a!="string"&&Fl(e).includes(t)?e[t]=a:e.setAttribute(t,a))}function Ui(e){return e.__attributes??={[Wl]:e.nodeName.includes("-"),[Yl]:e.namespaceURI===qo}}var Pr=new Map;function Fl(e){var t=e.getAttribute("is")||e.nodeName,a=Pr.get(t);if(a)return a;Pr.set(t,a=[]);for(var r,s=e,i=Element.prototype;i!==s;){r=Jr(s);for(var o in r)r[o].set&&a.push(o);s=rr(s)}return a}function Pt(e,t,a=t){var r=new WeakSet;hr(e,"input",async s=>{var i=s?e.defaultValue:e.value;if(i=Hs(e)?Fs(i):i,a(i),je!==null&&r.add(je),await xl(),i!==(i=t())){var o=e.selectionStart,l=e.selectionEnd,c=e.value.length;if(e.value=i??"",l!==null){var m=e.value.length;o===l&&l===c&&m>c?(e.selectionStart=m,e.selectionEnd=m):(e.selectionStart=o,e.selectionEnd=Math.min(l,m))}}}),v(t)==null&&e.value&&(a(Hs(e)?Fs(e.value):e.value),je!==null&&r.add(je)),Ka(()=>{var s=t();if(e===document.activeElement){var i=ts??je;if(r.has(i))return}Hs(e)&&s===Fs(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function La(e,t,a=t){hr(e,"change",r=>{var s=r?e.defaultChecked:e.checked;a(s)}),v(t)==null&&a(e.checked),Ka(()=>{var r=t();e.checked=!!r})}function Hs(e){var t=e.type;return t==="number"||t==="range"}function Fs(e){return e===""?null:+e}function Za(e,t,a){var r=ya(e,t);r&&r.set&&(e[t]=a,ys(()=>{e[t]=null}))}function $r(e,t){return e===t||e?.[On]===t}function ls(e={},t,a,r){return Ai(()=>{var s,i;return Ka(()=>{s=i,i=[],v(()=>{e!==a(...i)&&(t(e,...i),s&&$r(a(...s),e)&&t(null,...s))})}),()=>{Ua(()=>{i&&$r(a(...i),e)&&t(null,...i)})}}),e}function Or(e){return function(...t){var a=t[0];return a.stopPropagation(),e?.apply(this,t)}}function Kt(e=!1){const t=it,a=t.l.u;if(!a)return;let r=()=>ee(t.s);if(e){let s=0,i={};const o=$s(()=>{let l=!1;const c=t.s;for(const m in c)c[m]!==i[m]&&(i[m]=c[m],l=!0);return l&&s++,s});r=()=>n(o)}a.b.length&&dl(()=>{Wr(t,r),Es(a.b)}),js(()=>{const s=v(()=>a.m.map(To));return()=>{for(const i of s)typeof i=="function"&&i()}}),a.a.length&&js(()=>{Wr(t,r),Es(a.a)})}function Wr(e,t){if(e.l.s)for(const a of e.l.s)n(a);t()}function Yr(e,t){var a=e.$$events?.[t.type],r=us(a)?a.slice():a==null?[]:[a];for(var s of r)s.call(this,t)}function vr(e,t,a){if(e==null)return t(void 0),a&&a(void 0),Vn;const r=v(()=>e.subscribe(t,a));return r.unsubscribe?()=>r.unsubscribe():r}const Ea=[];function Bl(e,t){return{subscribe:lt(e,t).subscribe}}function lt(e,t=Vn){let a=null;const r=new Set;function s(l){if(ii(e,l)&&(e=l,a)){const c=!Ea.length;for(const m of r)m[1](),Ea.push(m,e);if(c){for(let m=0;m<Ea.length;m+=2)Ea[m][0](Ea[m+1]);Ea.length=0}}}function i(l){s(l(e))}function o(l,c=Vn){const m=[l,c];return r.add(m),r.size===1&&(a=t(s,i)||Vn),l(e),()=>{r.delete(m),r.size===0&&a&&(a(),a=null)}}return{set:s,update:i,subscribe:o}}function Qt(e,t,a){const r=!Array.isArray(e),s=r?[e]:e;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=t.length<2;return Bl(a,(o,l)=>{let c=!1;const m=[];let d=0,f=Vn;const u=()=>{if(d)return;f();const y=t(r?m[0]:m,o,l);i?o(y):f=typeof y=="function"?y:Vn},h=s.map((y,g)=>vr(y,p=>{m[g]=p,d&=~(1<<g),c&&u()},()=>{d|=1<<g}));return c=!0,u(),function(){Es(h),f(),c=!1}})}function jt(e){let t;return vr(e,a=>t=a)(),t}let gs=!1,Qs=Symbol();function Ze(e,t,a){const r=a[t]??={store:null,source:O(void 0),unsubscribe:Vn};if(r.store!==e&&!(Qs in a))if(r.unsubscribe(),r.store=e??null,e==null)r.source.v=void 0,r.unsubscribe=Vn;else{var s=!0;r.unsubscribe=vr(e,i=>{s?r.source.v=i:_(r.source,i)}),s=!1}return e&&Qs in a?jt(e):n(r.source)}function ql(e,t){return e.set(t),t}function za(){const e={};function t(){ys(()=>{for(var a in e)e[a].unsubscribe();Qr(e,Qs,{enumerable:!1,value:!0})})}return[e,t]}function Ul(e){var t=gs;try{return gs=!1,[e(),gs]}finally{gs=t}}function Se(e,t,a,r){var s=!qa||(a&Wo)!==0,i=(a&Ho)!==0,o=(a&Fo)!==0,l=r,c=!0,m=()=>(c&&(c=!1,l=o?v(r):r),l),d;if(i){var f=On in e||xo in e;d=ya(e,t)?.set??(f&&t in e?C=>e[t]=C:void 0)}var u,h=!1;i?[u,h]=Ul(()=>e[t]):u=e[t],u===void 0&&r!==void 0&&(u=m(),d&&(s&&Ro(),d(u)));var y;if(s?y=()=>{var C=e[t];return C===void 0?m():(c=!0,C)}:y=()=>{var C=e[t];return C!==void 0&&(l=void 0),C===void 0?l:C},s&&(a&Yo)===0)return y;if(d){var g=e.$$legacy;return(function(C,b){return arguments.length>0?((!s||!b||g||h)&&d(b?y():C),C):y()})}var p=!1,S=((a&Oo)!==0?$s:Xe)(()=>(p=!1,y()));i&&n(S);var k=Ve;return(function(C,b){if(arguments.length>0){const T=b?n(S):s&&i?Da(C):C;return _(S,T),p=!0,l!==void 0&&(l=T),C}return ea&&p||(k.f&$n)!==0?S.v:n(S)})}function ja(e){it===null&&mr(),qa&&it.l!==null?Gl(it).m.push(e):js(()=>{const t=v(e);if(typeof t=="function")return t})}function Ki(e){it===null&&mr(),ja(()=>()=>v(e))}function Kl(e,t,{bubbles:a=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:a,cancelable:r})}function gr(){const e=it;return e===null&&mr(),(t,a,r)=>{const s=e.s.$$events?.[t];if(s){const i=us(s)?s.slice():[s],o=Kl(t,a,r);for(const l of i)l.call(e.x,o);return!o.defaultPrevented}return!0}}function Gl(e){var t=e.l;return t.u??={a:[],b:[],m:[]}}const zl="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(zl);zo();function jl(e,t,a,r){const s=Na(a,r,e),i=Na(a,r,t),o=Na(e,t,a),l=Na(e,t,r);return!!((s>0&&i<0||s<0&&i>0)&&(o>0&&l<0||o<0&&l>0)||s===0&&bs(a,r,e)||i===0&&bs(a,r,t)||o===0&&bs(e,t,a)||l===0&&bs(e,t,r))}function Na(e,t,a){return(a.x-e.x)*(t.y-e.y)-(t.x-e.x)*(a.y-e.y)}function bs(e,t,a){return Math.min(e.x,t.x)<=a.x&&a.x<=Math.max(e.x,t.x)&&Math.min(e.y,t.y)<=a.y&&a.y<=Math.max(e.y,t.y)}function Hr(e,t,a,r=16){const s=[];for(let i=0;i<r;i++){const o=2*Math.PI*i/r;s.push({x:e+a*Math.cos(o),y:t+a*Math.sin(o)})}return s}function Xl(e,t,a,r,s=0,i=16){const o=[],l=2*(a+r),c=s*Math.PI/180,m=Math.cos(c),d=Math.sin(c),f=i/l,u=Math.max(1,Math.round(a*f)),h=Math.max(1,Math.round(r*f)),y=a/2,g=r/2,p=[];for(let S=0;S<u;S++){const k=S/u;p.push({x:-y+a*k,y:-g})}for(let S=0;S<h;S++){const k=S/h;p.push({x:y,y:-g+r*k})}for(let S=0;S<u;S++){const k=S/u;p.push({x:y-a*k,y:g})}for(let S=0;S<h;S++){const k=S/h;p.push({x:-y,y:g-r*k})}for(const S of p)o.push({x:e+S.x*m-S.y*d,y:t+S.x*d+S.y*m});if(o.length>i){const S=[],k=o.length/i;for(let C=0;C<i;C++)S.push(o[Math.floor(C*k)]);return S}return o}function Vl(e,t,a,r,s=0,i=16){const o=[],l=s*Math.PI/180,c=Math.cos(l),m=Math.sin(l);for(let d=0;d<i;d++){const f=2*Math.PI*d/i,u=a*Math.cos(f),h=r*Math.sin(f);o.push({x:e+u*c-h*m,y:t+u*m+h*c})}return o}function Fr(e,t,a){const r=a.length;for(let s=0;s<r;s++){const i=a[s],o=a[(s+1)%r];if(jl(e,t,i,o))return!0}return!1}function Gi(e,t,a){const r=a*Math.PI/180,s=Math.cos(r),i=Math.sin(r),o=e.x-t.x,l=e.y-t.y;return{x:t.x+o*s-l*i,y:t.y+o*i+l*s}}function zi(e){return{x:e.x+e.width/2,y:e.y+e.height/2}}function cs(e){const t=zi(e),a=e.rotation||0;return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}].map(s=>Gi(s,t,a))}function Ql(e){const s=e.x,i=e.y+e.height;return[{x:s,y:i},{x:s,y:i-8},{x:s+.5,y:i-8},{x:s+.5,y:i-.5},{x:s+4,y:i-.5},{x:s+4,y:i}]}function Jl(e){const t=Ql(e),a=zi(e),r=e.rotation||0;return t.map(s=>Gi(s,a,r))}function Zl(e,t,a,r,s=.01){const i=Math.abs(Na(e,t,a)),o=Math.abs(Na(e,t,r)),l=Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),c=s*l;if(i>c||o>c)return!1;const m=t.x-e.x,d=t.y-e.y,f=Math.sqrt(m*m+d*d);if(f<s)return!1;const u=m/f,h=d/f,y=0,g=f,p=(a.x-e.x)*u+(a.y-e.y)*h,S=(r.x-e.x)*u+(r.y-e.y)*h,k=Math.min(y,g),C=Math.max(y,g),b=Math.min(p,S),T=Math.max(p,S),R=Math.max(k,b);return Math.min(C,T)-R>s}function ec(e,t,a=.1){const r=e.length,s=t.length;for(let i=0;i<r;i++){const o=e[i],l=e[(i+1)%r];for(let c=0;c<s;c++){const m=t[c],d=t[(c+1)%s];if(Zl(o,l,m,d,a))return!0}}return!1}function tc(e){const t=e.length;if(t===0)return new Map;const a=Array.from({length:t},(l,c)=>c);function r(l){return a[l]!==l&&(a[l]=r(a[l])),a[l]}function s(l,c){const m=r(l),d=r(c);m!==d&&(a[m]=d)}for(let l=0;l<t;l++)for(let c=l+1;c<t;c++)ec(e[l].vertices,e[c].vertices)&&s(l,c);const i=new Map;e.forEach((l,c)=>i.set(l.id,c));const o=new Map;return e.forEach((l,c)=>{o.set(l.id,r(c))}),o}function nc(e,t,a){const r=t.get(e);return r===void 0?[e]:a.filter(s=>t.get(s.id)===r).map(s=>s.id)}const Ts=16;function Js(e){return e.isRectangle&&e.width!==void 0&&e.height!==void 0?Xl(e.x,e.y,e.width,e.height,e.rotation||0,Ts):e.radius!==void 0?Hr(e.x,e.y,e.radius,Ts):e.rx!==void 0&&e.ry!==void 0?Vl(e.x,e.y,e.rx,e.ry,e.rotation||0,Ts):Hr(e.x,e.y,.5,Ts)}function Br(e,t){const a=Js(e);for(const r of a)if(qr(r,t))return!0;return!!qr({x:e.x,y:e.y},t)}function qr(e,t){const a=t.length;let r=null;for(let s=0;s<a;s++){const i=t[s],o=t[(s+1)%a],l=(o.x-i.x)*(e.y-i.y)-(o.y-i.y)*(e.x-i.x);if(l!==0){const c=l>0;if(r===null)r=c;else if(r!==c)return!1}}return!0}function ji(e,t,a,r){const s=Js(e),i=Js(t),o=tc(a),l=new Set;for(const f of a){const u=Br(e,f.vertices),h=Br(t,f.vertices);if(u||h){const y=nc(f.id,o,a);for(const g of y)l.add(g)}}const c=[];let m=!1,d=null;for(const f of s)for(const u of i){const h={from:f,to:u,blocked:!1,blockedBy:null};let y=!1;for(const p of a)if(!l.has(p.id)&&Fr(f,u,p.vertices)){h.blocked=!0,h.blockedBy="terrain",y=!0;break}if(y){c.push(h);continue}let g=!1;for(const p of r)if(Fr(f,u,p)){h.blocked=!0,h.blockedBy="wall",g=!0;break}g||(h.blocked=!1,m||(d=h),m=!0),c.push(h)}return{canSee:m,rays:c,firstClearRay:d,terrainsIgnored:Array.from(l)}}const Ie={width:60,height:44},Xi=lt([{id:"terrain1",x:20,y:16,width:6,height:12,rotation:0},{id:"terrain2",x:34,y:10,width:6,height:12,rotation:45},{id:"terrain3",x:44,y:20,width:6,height:12,rotation:-30}]);Qt(Xi,e=>e.map(t=>Jl(t)));Qt(Xi,e=>e.map(t=>({id:t.id,vertices:cs(t)})));const Ur=lt(!1);var ac=Ae('<line stroke="#3a4a3a" stroke-width="0.05"></line>'),sc=Ae('<line stroke="#3a4a3a" stroke-width="0.05"></line>'),rc=Ae('<line stroke="#5a6a5a" stroke-width="0.08"></line>'),ic=Ae('<line stroke="#5a6a5a" stroke-width="0.08"></line>'),oc=Ae('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),lc=Ae('<line stroke="#666"></line><!>',1),cc=Ae('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),mc=Ae('<line stroke="#666"></line><!>',1),uc=Ae('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),dc=Ae('<line stroke="#666"></line><!>',1),hc=Ae('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),fc=Ae('<line stroke="#666"></line><!>',1),yc=Ae('<svg preserveAspectRatio="xMidYMid meet"><rect x="0" y="0" fill="#1a1a1a"></rect><rect fill="#4a5a4a"></rect><!><!><!><!><!><!><!><!><g><!></g></svg>');function Ws(e,t){Yt(t,!1);const a=O(),r=O(),s=O(),i=O(),o=O(),l=O(),c=O();let m=O();const d=2,f=Ie.width+d*2,u=Ie.height+d*2;let h=O(1),y=O(0),g=O(0),p=O(!1),S={x:0,y:0},k=O(!1);const C=.5,b=4;function T(F,de){if(!n(m))return{x:0,y:0};const Pe=n(m).createSVGPoint();Pe.x=F,Pe.y=de;const oe=Pe.matrixTransform(n(m).getScreenCTM().inverse());return{x:oe.x-d,y:oe.y-d}}function R(F){F.preventDefault();const de=n(m).getBoundingClientRect(),Pe=F.clientX-de.left,oe=F.clientY-de.top,Tt=n(s)+Pe/de.width*n(a),ct=n(i)+oe/de.height*n(r),at=F.deltaY>0?.9:1.1,Ge=Math.max(C,Math.min(b,n(h)*at)),wt=f/Ge,rn=u/Ge,on=Tt-Pe/de.width*wt,z=ct-oe/de.height*rn;_(h,Ge),_(y,on),_(g,z)}function N(F){(F.button===1||F.button===0&&n(k))&&(F.preventDefault(),_(p,!0),S={x:F.clientX,y:F.clientY})}function w(F){if(!n(p))return;const de=n(m).getBoundingClientRect(),Pe=(F.clientX-S.x)/de.width*n(a),oe=(F.clientY-S.y)/de.height*n(r);_(y,n(y)-Pe),_(g,n(g)-oe),S={x:F.clientX,y:F.clientY}}function I(){_(p,!1)}function W(F){F.code==="Space"&&!F.repeat&&F.target.tagName!=="INPUT"&&(F.preventDefault(),_(k,!0))}function se(F){F.code==="Space"&&_(k,!1)}function X(){_(h,1),_(y,0),_(g,0)}le(()=>n(h),()=>{_(a,f/n(h))}),le(()=>n(h),()=>{_(r,u/n(h))}),le(()=>n(y),()=>{_(s,n(y))}),le(()=>n(g),()=>{_(i,n(g))}),le(()=>(n(s),n(i),n(a),n(r)),()=>{_(o,`${n(s)} ${n(i)} ${n(a)} ${n(r)}`)}),le(()=>Ie,()=>{_(l,Array.from({length:Ie.width+1},(F,de)=>de))}),le(()=>Ie,()=>{_(c,Array.from({length:Ie.height+1},(F,de)=>de))}),Cn();var ye={screenToSvg:T};Kt();var ce=yc();q("keydown",Ia,W),q("keyup",Ia,se),q("mouseup",Ia,I),q("mousemove",Ia,w);let U;var B=E(ce),te=A(B);x(te,"x",d),x(te,"y",d);var G=A(te);Me(G,1,()=>(ee(Ie),v(()=>Array(Ie.width+1))),Be,(F,de,Pe)=>{var oe=ac();x(oe,"x1",d+Pe),x(oe,"y1",d),x(oe,"x2",d+Pe),V(()=>x(oe,"y2",(ee(Ie),v(()=>d+Ie.height)))),L(F,oe)});var J=A(G);Me(J,1,()=>(ee(Ie),v(()=>Array(Ie.height+1))),Be,(F,de,Pe)=>{var oe=sc();x(oe,"x1",d),x(oe,"y1",d+Pe),x(oe,"y2",d+Pe),V(()=>x(oe,"x2",(ee(Ie),v(()=>d+Ie.width)))),L(F,oe)});var $=A(J);Me($,1,()=>(ee(Ie),v(()=>Array(Math.floor(Ie.width/6)+1))),Be,(F,de,Pe)=>{var oe=rc();x(oe,"x1",d+Pe*6),x(oe,"y1",d),x(oe,"x2",d+Pe*6),V(()=>x(oe,"y2",(ee(Ie),v(()=>d+Ie.height)))),L(F,oe)});var P=A($);Me(P,1,()=>(ee(Ie),v(()=>Array(Math.floor(Ie.height/6)+1))),Be,(F,de,Pe)=>{var oe=ic();x(oe,"x1",d),x(oe,"y1",d+Pe*6),x(oe,"y2",d+Pe*6),V(()=>x(oe,"x2",(ee(Ie),v(()=>d+Ie.width)))),L(F,oe)});var Y=A(P);Me(Y,1,()=>n(l),Be,(F,de)=>{var Pe=lc(),oe=Re(Pe);x(oe,"y2",d);var Tt=A(oe);{var ct=at=>{var Ge=oc();x(Ge,"y",1.2);var wt=E(Ge);V(()=>{x(Ge,"x",d+n(de)),Ce(wt,`${n(de)??""}"`)}),L(at,Ge)};be(Tt,at=>{n(de)%6===0&&at(ct)})}V(()=>{x(oe,"x1",d+n(de)),x(oe,"y1",n(de)%6===0?.5:d-.8),x(oe,"x2",d+n(de)),x(oe,"stroke-width",n(de)%6===0?.08:.04)}),L(F,Pe)});var ne=A(Y);Me(ne,1,()=>n(l),Be,(F,de)=>{var Pe=mc(),oe=Re(Pe),Tt=A(oe);{var ct=at=>{var Ge=cc(),wt=E(Ge);V(()=>{x(Ge,"x",d+n(de)),x(Ge,"y",(ee(Ie),v(()=>d+Ie.height+1.8))),Ce(wt,`${n(de)??""}"`)}),L(at,Ge)};be(Tt,at=>{n(de)%6===0&&at(ct)})}V(()=>{x(oe,"x1",d+n(de)),x(oe,"y1",(ee(Ie),v(()=>d+Ie.height))),x(oe,"x2",d+n(de)),x(oe,"y2",(ee(Ie),n(de),v(()=>d+Ie.height+(n(de)%6===0?1.5:.8)))),x(oe,"stroke-width",n(de)%6===0?.08:.04)}),L(F,Pe)});var H=A(ne);Me(H,1,()=>n(c),Be,(F,de)=>{var Pe=dc(),oe=Re(Pe);x(oe,"x2",d);var Tt=A(oe);{var ct=at=>{var Ge=uc();x(Ge,"x",1);var wt=E(Ge);V(()=>{x(Ge,"y",d+n(de)+.35),Ce(wt,`${n(de)??""}"`)}),L(at,Ge)};be(Tt,at=>{n(de)%6===0&&at(ct)})}V(()=>{x(oe,"x1",n(de)%6===0?.5:d-.8),x(oe,"y1",d+n(de)),x(oe,"y2",d+n(de)),x(oe,"stroke-width",n(de)%6===0?.08:.04)}),L(F,Pe)});var re=A(H);Me(re,1,()=>n(c),Be,(F,de)=>{var Pe=fc(),oe=Re(Pe),Tt=A(oe);{var ct=at=>{var Ge=hc(),wt=E(Ge);V(()=>{x(Ge,"x",(ee(Ie),v(()=>d+Ie.width+1))),x(Ge,"y",d+n(de)+.35),Ce(wt,`${n(de)??""}"`)}),L(at,Ge)};be(Tt,at=>{n(de)%6===0&&at(ct)})}V(()=>{x(oe,"x1",(ee(Ie),v(()=>d+Ie.width))),x(oe,"y1",d+n(de)),x(oe,"x2",(ee(Ie),n(de),v(()=>d+Ie.width+(n(de)%6===0?1.5:.8)))),x(oe,"y2",d+n(de)),x(oe,"stroke-width",n(de)%6===0?.08:.04)}),L(F,Pe)});var ke=A(re);x(ke,"transform","translate(2, 2)");var qe=E(ke);return Fi(qe,t,"default",{screenToSvg:T}),ls(ce,F=>_(m,F),()=>n(m)),V(()=>{x(ce,"viewBox",n(o)),U=hn(ce,0,"battlefield svelte-n43bnt",null,U,{panning:n(p)||n(k)}),x(B,"width",(ee(Ie),v(()=>Ie.width+d*2))),x(B,"height",(ee(Ie),v(()=>Ie.height+d*2))),x(te,"width",(ee(Ie),v(()=>Ie.width))),x(te,"height",(ee(Ie),v(()=>Ie.height)))}),q("wheel",ce,R),q("mousedown",ce,N),q("dblclick",ce,X),L(e,ce),Za(t,"screenToSvg",T),Ht(ye)}var pc=Ae('<line stroke="#3b82f6" stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" fill="#3b82f6" stroke="#1d4ed8" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-trljjm"></circle>',1),vc=Ae('<g><g><rect role="button" tabindex="0" class="svelte-trljjm"></rect></g><!></g>');function Vi(e,t){Yt(t,!1);const a=O(),r=O(),s=O(),i=O(),o=O();let l=Se(t,"id",8),c=Se(t,"x",8),m=Se(t,"y",8),d=Se(t,"width",8),f=Se(t,"height",8),u=Se(t,"rotation",8,0),h=Se(t,"selected",8,!1),y=Se(t,"screenToSvg",8),g=Se(t,"onSelect",8,()=>{}),p=Se(t,"onDrag",8,()=>{}),S=Se(t,"onRotate",8,()=>{}),k=O(!1),C=!1,b={x:0,y:0};function T(G){G.stopPropagation(),g()(l())}function R(G){if(G.button!==0)return;G.preventDefault(),G.stopPropagation(),g()(l()),_(k,!0);const J=y()(G.clientX,G.clientY);b={x:J.x-c(),y:J.y-m()},window.addEventListener("mousemove",N),window.addEventListener("mouseup",w)}function N(G){if(!n(k))return;const J=y()(G.clientX,G.clientY);let $=J.x-b.x,P=J.y-b.y;G.shiftKey||($=Math.round($),P=Math.round(P));const Y=Math.max(d(),f())/2;$=Math.max(-Y,Math.min(Ie.width-d()+Y,$)),P=Math.max(-Y,Math.min(Ie.height-f()+Y,P)),p()(l(),$,P)}function w(){_(k,!1),window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",w)}function I(G){G.preventDefault(),G.stopPropagation(),C=!0,window.addEventListener("mousemove",W),window.addEventListener("mouseup",se)}function W(G){if(!C)return;const J=y()(G.clientX,G.clientY),$=J.x-n(a),P=J.y-n(r);let Y=Math.atan2(P,$)*180/Math.PI+45;G.shiftKey||(Y=Math.round(Y/15)*15),S()(l(),Y)}function se(){C=!1,window.removeEventListener("mousemove",W),window.removeEventListener("mouseup",se)}le(()=>(ee(c()),ee(d())),()=>{_(a,c()+d()/2)}),le(()=>(ee(m()),ee(f())),()=>{_(r,m()+f()/2)}),le(()=>(ee(d()),ee(f())),()=>{_(s,Math.max(d(),f())/2+1.5)}),le(()=>(n(a),n(s),ee(u())),()=>{_(i,n(a)+n(s)*Math.cos((u()-45)*Math.PI/180))}),le(()=>(n(r),n(s),ee(u())),()=>{_(o,n(r)+n(s)*Math.sin((u()-45)*Math.PI/180))}),Cn(),Kt();var X=vc();let ye;var ce=E(X),U=E(ce),B=A(ce);{var te=G=>{var J=pc(),$=Re(J),P=A($);V(()=>{x($,"x1",n(a)),x($,"y1",n(r)),x($,"x2",n(i)),x($,"y2",n(o)),x(P,"cx",n(i)),x(P,"cy",n(o))}),q("mousedown",P,I),L(G,J)};be(B,G=>{h()&&G(te)})}V(()=>{ye=hn(X,0,"terrain-rect svelte-trljjm",null,ye,{selected:h(),dragging:n(k)}),x(ce,"transform",`rotate(${u()??""}, ${n(a)??""}, ${n(r)??""})`),x(U,"x",c()),x(U,"y",m()),x(U,"width",d()),x(U,"height",f()),x(U,"fill",h()?"rgba(59, 130, 246, 0.3)":"rgba(139, 90, 43, 0.3)"),x(U,"stroke",h()?"#3b82f6":"#8b5a2b"),x(U,"stroke-width",h()?.15:.1)}),q("click",U,T),q("mousedown",U,R),L(e,X),Ht()}const Qi="warhammer-deployment-layouts",Ji=[{label:'6" x 12"',width:6,height:12},{label:'5" x 10"',width:5,height:10},{label:'4" x 6"',width:4,height:6}],Zs=[{label:"L 4x8",shape:"L-4x8"},{label:"L 4x8 â",shape:"L-4x8-mirror"},{label:"C 4-8-4",shape:"C-4-8-4"},{label:"L 5x6",shape:"L-5x6"},{label:"L 5x6 â",shape:"L-5x6-mirror"},{label:"L 4x6",shape:"L-4x6"},{label:"L 4x6 â",shape:"L-4x6-mirror"}],br=[{name:"Layout 1",terrains:[{id:"a",x:28,y:0,width:4,height:6,rotation:0},{id:"b",x:28,y:38,width:4,height:6,rotation:0},{id:"c",x:6,y:5,width:6,height:12,rotation:0},{id:"d",x:48,y:27,width:6,height:12,rotation:0},{id:"e",x:16,y:28,width:6,height:12,rotation:0},{id:"f",x:7,y:19,width:6,height:12,rotation:90},{id:"g",x:38,y:4,width:6,height:12,rotation:0},{id:"h",x:47,y:13,width:6,height:12,rotation:90},{id:"i",x:32.74,y:23.59,width:5,height:10,rotation:135},{id:"j",x:35.06,y:19.5,width:4,height:6,rotation:45},{id:"k",x:22.07,y:10.17,width:5,height:10,rotation:-45},{id:"l",x:20.72,y:18.23,width:4,height:6,rotation:45}],walls:[{id:"wa",x:38,y:6,shape:"C-4-8-4",rotation:0},{id:"wb",x:18,y:30,shape:"C-4-8-4",rotation:180},{id:"wc",x:13.33,y:20.15,shape:"L-4x8-mirror",rotation:-90},{id:"wd",x:49.67,y:15.93,shape:"L-4x8-mirror",rotation:90},{id:"we",x:48.2,y:30.88,shape:"L-4x8",rotation:0},{id:"wf",x:7.84,y:5.01,shape:"L-4x8",rotation:180},{id:"wg",x:27.06,y:11.52,shape:"L-4x8-mirror",rotation:-45},{id:"wh",x:35.81,y:24.24,shape:"L-4x8-mirror",rotation:135}]},{name:"Layout 2",terrains:[{id:"a",x:31,y:7,width:4,height:6,rotation:-90},{id:"b",x:25,y:30,width:4,height:6,rotation:90},{id:"c",x:5,y:4,width:6,height:12,rotation:0},{id:"d",x:49,y:28,width:6,height:12,rotation:0},{id:"e",x:46,y:4,width:6,height:12,rotation:0},{id:"f",x:16.32,y:16.13,width:6,height:12,rotation:135},{id:"g",x:53,y:15,width:4,height:6,rotation:90},{id:"h",x:8,y:28,width:6,height:12,rotation:0},{id:"i",x:3,y:23,width:4,height:6,rotation:90},{id:"j",x:32.62,y:32.55,width:5,height:10,rotation:-90},{id:"k",x:22.48,y:.51,width:5,height:10,rotation:-90},{id:"l",x:37,y:16,width:6,height:12,rotation:135}],walls:[{id:"wa",x:49,y:32,shape:"L-4x8",rotation:0},{id:"wb",x:7,y:4,shape:"L-4x8",rotation:180},{id:"wc",x:46,y:8,shape:"L-4x8",rotation:0},{id:"wd",x:10,y:28,shape:"L-4x8",rotation:180},{id:"we",x:35.07,y:34.56,shape:"L-5x6-mirror",rotation:-90},{id:"wf",x:29.09,y:2.47,shape:"L-5x6-mirror",rotation:90},{id:"wg",x:17.86,y:17.53,shape:"C-4-8-4",rotation:135},{id:"wh",x:37.24,y:18.38,shape:"C-4-8-4",rotation:-45}]},{name:"Layout 3",terrains:[{id:"a",x:11,y:3,width:4,height:6,rotation:90},{id:"b",x:45,y:35,width:4,height:6,rotation:90},{id:"c",x:25,y:1,width:6,height:12,rotation:90},{id:"d",x:29,y:31,width:6,height:12,rotation:90},{id:"e",x:7.74,y:26.05,width:6,height:12,rotation:125.31},{id:"f",x:46.34,y:5.51,width:6,height:12,rotation:121.72},{id:"g",x:5.14,y:10.46,width:6,height:12,rotation:41.51},{id:"h",x:48.67,y:21.52,width:6,height:12,rotation:41.51},{id:"i",x:19.59,y:14.36,width:5,height:10,rotation:-38.13},{id:"j",x:20.69,y:24.37,width:4,height:6,rotation:-39.33},{id:"k",x:35.34,y:19.61,width:5,height:10,rotation:-38.13},{id:"l",x:35.31,y:13.5,width:4,height:6,rotation:-39.33}],walls:[{id:"aa",x:30,y:32,shape:"C-4-8-4",rotation:90},{id:"ab",x:26,y:4,shape:"C-4-8-4",rotation:-90},{id:"ac",x:8.19,y:11.64,shape:"L-4x8",rotation:222.46},{id:"ad",x:47.79,y:24.3,shape:"L-4x8",rotation:41.26},{id:"ae",x:38.64,y:20.09,shape:"L-5x6-mirror",rotation:141.31},{id:"af",x:25.26,y:17.9,shape:"L-5x6-mirror",rotation:-37.61},{id:"ag",x:14.37,y:28.38,shape:"L-4x8-mirror",rotation:-54.26},{id:"ah",x:48.75,y:7.3,shape:"L-4x8-mirror",rotation:122.02}]},{name:"Layout 4",terrains:[{id:"a",x:15,y:1,width:6,height:12,rotation:90},{id:"b",x:8,y:10,width:4,height:6,rotation:0},{id:"c",x:4,y:19,width:4,height:6,rotation:0},{id:"d",x:7.5,y:27.68,width:6,height:12,rotation:-48.57},{id:"e",x:46.53,y:4.24,width:6,height:12,rotation:-48.57},{id:"f",x:53,y:19,width:4,height:6,rotation:0},{id:"g",x:48,y:28,width:4,height:6,rotation:0},{id:"h",x:39,y:31,width:6,height:12,rotation:90},{id:"i",x:33.03,y:2.97,width:6,height:12,rotation:-37.25},{id:"j",x:20.96,y:28.96,width:6,height:12,rotation:-37.25},{id:"k",x:16.93,y:16.51,width:5,height:10,rotation:-41.85},{id:"l",x:37.96,y:17.43,width:5,height:10,rotation:-41.85}],walls:[{id:"aa",x:18,y:4,shape:"L-4x8",rotation:-90},{id:"ab",x:9.04,y:29.01,shape:"C-4-8-4",rotation:131.97},{id:"ac",x:47,y:7,shape:"C-4-8-4",rotation:-48.54},{id:"ad",x:38,y:32,shape:"L-4x8",rotation:90},{id:"ae",x:34.42,y:7.12,shape:"L-4x8",rotation:-37.53},{id:"af",x:21.57,y:28.8,shape:"L-4x8",rotation:142.46},{id:"ag",x:15.7,y:17.01,shape:"L-5x6",rotation:137.87},{id:"ah",x:39.17,y:20.85,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 5",terrains:[{id:"aa",x:27,y:1,width:6,height:12,rotation:90},{id:"ab",x:36.53,y:12.48,width:5,height:10,rotation:-90},{id:"ac",x:13,y:3,width:4,height:6,rotation:90},{id:"ad",x:43,y:35,width:4,height:6,rotation:90},{id:"ae",x:27,y:31,width:6,height:12,rotation:90},{id:"af",x:18.43,y:21.49,width:5,height:10,rotation:-90},{id:"ag",x:1,y:23,width:4,height:6,rotation:90},{id:"ah",x:55,y:15,width:4,height:6,rotation:90},{id:"ai",x:7.83,y:30.22,width:6,height:12,rotation:-60},{id:"aj",x:46.32,y:1.58,width:6,height:12,rotation:-60},{id:"ak",x:8.74,y:10.19,width:6,height:12,rotation:65.22},{id:"al",x:45.22,y:21.75,width:6,height:12,rotation:65.22}],walls:[{id:"a1",x:28,y:32,shape:"C-4-8-4",rotation:90},{id:"a2",x:28,y:4,shape:"C-4-8-4",rotation:-90},{id:"a3",x:11.88,y:12.29,shape:"L-4x8",rotation:-114.74},{id:"a4",x:43.97,y:23.59,shape:"L-4x8",rotation:64.22},{id:"a5",x:24.91,y:23.52,shape:"L-5x6-mirror",rotation:-90.37},{id:"a6",x:39,y:14.51,shape:"L-5x6-mirror",rotation:89.9},{id:"a7",x:7.58,y:30.57,shape:"L-4x8",rotation:120.93},{id:"a8",x:48.51,y:5.28,shape:"L-4x8",rotation:-59.06}]},{name:"Layout 6",terrains:[{id:"aa",x:13,y:1,width:6,height:12,rotation:90},{id:"ab",x:6,y:10,width:4,height:6,rotation:0},{id:"ac",x:25,y:11,width:4,height:6,rotation:90},{id:"ad",x:7.34,y:27.57,width:6,height:12,rotation:-40.32},{id:"ae",x:46.69,y:4.57,width:6,height:12,rotation:-41.9},{id:"af",x:31,y:27,width:4,height:6,rotation:-90},{id:"ag",x:50,y:28,width:4,height:6,rotation:0},{id:"ah",x:41,y:31,width:6,height:12,rotation:90},{id:"ai",x:34,y:4,width:6,height:12,rotation:0},{id:"aj",x:20,y:28,width:6,height:12,rotation:0},{id:"ak",x:15.7,y:15.03,width:5,height:10,rotation:-41.85},{id:"al",x:39.43,y:19.24,width:5,height:10,rotation:-39.95}],walls:[{id:"a1",x:16,y:4,shape:"L-4x8",rotation:-90},{id:"a2",x:9.04,y:29.01,shape:"C-4-8-4",rotation:140.05},{id:"a3",x:47,y:7.16,shape:"C-4-8-4",rotation:-41.53},{id:"a4",x:40,y:32,shape:"L-4x8",rotation:90},{id:"a5",x:34.15,y:7.88,shape:"L-4x8",rotation:0},{id:"a6",x:22,y:28,shape:"L-4x8",rotation:180},{id:"a7",x:14.47,y:15.47,shape:"L-5x6",rotation:137.87},{id:"a8",x:40.53,y:22.78,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 7",terrains:[{id:"aa",x:8,y:8,width:6,height:12,rotation:0},{id:"ab",x:6,y:28,width:6,height:12,rotation:0},{id:"ac",x:7,y:39,width:4,height:6,rotation:90},{id:"ad",x:18,y:26,width:5,height:10,rotation:0},{id:"ae",x:19,y:20,width:4,height:6,rotation:0},{id:"af",x:23,y:3,width:6,height:12,rotation:0},{id:"ag",x:31,y:29,width:6,height:12,rotation:0},{id:"ah",x:37,y:18,width:4,height:6,rotation:0},{id:"ai",x:37,y:8,width:5,height:10,rotation:0},{id:"aj",x:46,y:24,width:6,height:12,rotation:0},{id:"ak",x:48,y:4,width:6,height:12,rotation:0},{id:"al",x:49,y:-1,width:4,height:6,rotation:90}],walls:[{id:"a1",x:9,y:10,shape:"L-5x6",rotation:180},{id:"a2",x:11.44,y:31.97,shape:"L-4x8-mirror",rotation:0},{id:"a3",x:19,y:20,shape:"L-4x6",rotation:180},{id:"a4",x:22.53,y:30.02,shape:"L-5x6-mirror",rotation:0},{id:"a5",x:25,y:5,shape:"C-4-8-4",rotation:180},{id:"a6",x:31,y:31,shape:"C-4-8-4",rotation:0},{id:"a7",x:37,y:18,shape:"L-4x6",rotation:0},{id:"a8",x:41.51,y:8.09,shape:"L-5x6-mirror",rotation:180},{id:"a9",x:46,y:28,shape:"L-5x6",rotation:0},{id:"a10",x:51.51,y:4.01,shape:"L-4x8-mirror",rotation:180}]},{name:"Layout 8",terrains:[{id:"aa",x:23,y:22,width:4,height:6,rotation:0},{id:"ab",x:23,y:28,width:4,height:6,rotation:0},{id:"ac",x:33,y:16,width:4,height:6,rotation:0},{id:"ad",x:33,y:10,width:4,height:6,rotation:0},{id:"ae",x:41,y:19,width:6,height:12,rotation:0},{id:"af",x:13,y:13,width:6,height:12,rotation:0},{id:"ag",x:32,y:32,width:6,height:12,rotation:0},{id:"ah",x:22,y:0,width:6,height:12,rotation:0},{id:"ai",x:9.5,y:27.68,width:6,height:12,rotation:-48.69},{id:"aj",x:44.51,y:4.35,width:6,height:12,rotation:-48.69},{id:"ak",x:6.95,y:4,width:5,height:10,rotation:53.9},{id:"al",x:48,y:30,width:5,height:10,rotation:53.9}],walls:[{id:"a1",x:32,y:34,shape:"C-4-8-4",rotation:0},{id:"a2",x:24,y:2,shape:"C-4-8-4",rotation:180},{id:"a3",x:44.68,y:19.06,shape:"L-4x8-mirror",rotation:180},{id:"a4",x:18.43,y:16.91,shape:"L-4x8-mirror",rotation:0},{id:"a5",x:46.38,y:33.13,shape:"L-5x6",rotation:52.87},{id:"a6",x:8.55,y:4.89,shape:"L-5x6",rotation:-127.66},{id:"a7",x:16,y:30.28,shape:"L-4x8-mirror",rotation:-48.62},{id:"a8",x:46.91,y:5.85,shape:"L-4x8-mirror",rotation:132.19}]}];function gc(){return"terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Nn(){const e=localStorage.getItem(Qi);if(e)try{return JSON.parse(e)}catch(t){return console.error("Failed to parse saved layouts:",t),{}}return{}}function Is(e){localStorage.setItem(Qi,JSON.stringify(e))}function Zi(){const{subscribe:e,set:t,update:a}=lt([]);return{subscribe:e,set:t,update:a,add(r,s){a(i=>[...i,{id:gc(),x:30-r/2,y:22-s/2,width:r,height:s,rotation:0}])},updateTerrain(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){t([])},save(r){const s=jt({subscribe:e}),i=Nn();i[r]={terrains:s,savedAt:Date.now()},Is(i)},load(r){const s=Nn();return s[r]?(t(s[r].terrains),!0):!1},deleteLayout(r){const s=Nn();delete s[r],Is(s)},getSavedLayoutNames(){const r=Nn();return Object.keys(r).map(s=>({name:s,savedAt:r[s].savedAt,terrainCount:r[s].terrains.length})).sort((s,i)=>i.savedAt-s.savedAt)},hasSaved(){const r=Nn();return Object.keys(r).length>0}}}const Bt=Zi();function eo(){const{subscribe:e,set:t,update:a}=lt([]);return{subscribe:e,set:t,update:a,add(r){a(s=>[...s,{id:"wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),x:30,y:22,shape:r,rotation:0}])},updateWall(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){t([])}}}const $t=eo(),xs=Zi(),_s=eo(),Ss=lt(null),ws=lt(null);function er(e){const t=e.includes("-mirror"),a=e.replace("-mirror","");if(a.startsWith("L-")){const r=a.match(/L-(\d+)x(\d+)/);if(r)return{type:"L",segments:[parseInt(r[1]),parseInt(r[2])],mirrored:t}}else if(a.startsWith("C-")){const r=a.match(/C-(\d+)-(\d+)-(\d+)/);if(r)return{type:"C",segments:[parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],mirrored:t}}return{type:"L",segments:[4,8],mirrored:!1}}function Fa(e,t=null){const s=er(e),i=t||s.segments,o=s.mirrored;if(s.type==="L"){const[l,c]=i;return o?[{x:0,y:0},{x:.5,y:0},{x:.5,y:c},{x:-l+.5,y:c},{x:-l+.5,y:c-.5},{x:0,y:c-.5}]:[{x:0,y:0},{x:.5,y:0},{x:.5,y:c-.5},{x:l,y:c-.5},{x:l,y:c},{x:0,y:c}]}else if(s.type==="C"){const[l,c,m]=i;return[{x:0,y:0},{x:m,y:0},{x:m,y:.5},{x:.5,y:.5},{x:.5,y:c-.5},{x:l,y:c-.5},{x:l,y:c},{x:0,y:c}]}return[]}function Tr(e,t,a,r){if(e.length===0)return[];const s=e.map(S=>S.x),i=e.map(S=>S.y),o=Math.min(...s),l=Math.max(...s),c=Math.min(...i),m=Math.max(...i),d=l-o,f=m-c,u=t+o+d/2,h=a+c+f/2,y=r*Math.PI/180,g=Math.cos(y),p=Math.sin(y);return e.map(S=>{const k=t+S.x,C=a+S.y,b=k-u,T=C-h;return{x:u+b*g-T*p,y:h+b*p+T*g}})}Qt($t,e=>e.map(t=>Tr(Fa(t.shape,t.segments),t.x,t.y,t.rotation)));const gn=lt(null),bn=lt(null),xr=lt([]);function bc(e,t=[]){const a=jt(Bt),r=jt($t),s=Nn();s[e]={terrains:a,walls:r,models:t,savedAt:Date.now()},Is(s)}function Tc(e){const t=Nn();return t[e]?(Bt.set(t[e].terrains||[]),$t.set(t[e].walls||[]),{terrains:t[e].terrains||[],walls:t[e].walls||[],models:t[e].models||[]}):null}function xc(e){const t=Nn();delete t[e],Is(t)}function _c(){const e=Nn();return Object.keys(e).map(t=>({name:t,savedAt:e[t].savedAt,terrainCount:(e[t].terrains||[]).length,wallCount:(e[t].walls||[]).length,modelCount:(e[t].models||[]).length})).sort((t,a)=>a.savedAt-t.savedAt)}function es(){xr.set(_c())}var Sc=Ae('<line stroke="#3b82f6" stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" fill="#3b82f6" stroke="#1d4ed8" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-1tez9jd"></circle>',1),wc=Ae('<g><g><path role="button" tabindex="0" class="svelte-1tez9jd"></path></g><!></g>');function _r(e,t){Yt(t,!1);const a=O(),r=O(),s=O(),i=O(),o=O(),l=O(),c=O(),m=O(),d=O(),f=O();let u=Se(t,"id",8),h=Se(t,"x",8),y=Se(t,"y",8),g=Se(t,"shape",8),p=Se(t,"segments",8,null),S=Se(t,"rotation",8,0),k=Se(t,"selected",8,!1),C=Se(t,"screenToSvg",8),b=Se(t,"onSelect",8,()=>{}),T=Se(t,"onDrag",8,()=>{}),R=Se(t,"onRotate",8,()=>{});function N(H){const re=H.map(qe=>qe.x),ke=H.map(qe=>qe.y);return{minX:Math.min(...re),maxX:Math.max(...re),minY:Math.min(...ke),maxY:Math.max(...ke)}}let w=O(!1),I=!1,W={x:0,y:0};function se(H){H.stopPropagation(),b()(u())}function X(H){if(H.button!==0)return;H.preventDefault(),H.stopPropagation(),b()(u()),_(w,!0);const re=C()(H.clientX,H.clientY);W={x:re.x-h(),y:re.y-y()},window.addEventListener("mousemove",ye),window.addEventListener("mouseup",ce)}function ye(H){if(!n(w))return;const re=C()(H.clientX,H.clientY);let ke=re.x-W.x,qe=re.y-W.y;H.shiftKey||(ke=Math.round(ke),qe=Math.round(qe));const F=Math.max(n(s),n(i));ke=Math.max(-F,Math.min(Ie.width+F-n(s),ke)),qe=Math.max(-F,Math.min(Ie.height+F-n(i),qe)),T()(u(),ke,qe)}function ce(){_(w,!1),window.removeEventListener("mousemove",ye),window.removeEventListener("mouseup",ce)}function U(H){H.preventDefault(),H.stopPropagation(),I=!0,window.addEventListener("mousemove",B),window.addEventListener("mouseup",te)}function B(H){if(!I)return;const re=C()(H.clientX,H.clientY),ke=re.x-n(o),qe=re.y-n(l);let F=Math.atan2(qe,ke)*180/Math.PI+45;H.shiftKey||(F=Math.round(F/15)*15),R()(u(),F)}function te(){I=!1,window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",te)}le(()=>(ee(g()),ee(p())),()=>{_(a,Fa(g(),p()))}),le(()=>n(a),()=>{_(r,N(n(a)))}),le(()=>n(r),()=>{_(s,n(r).maxX-n(r).minX)}),le(()=>n(r),()=>{_(i,n(r).maxY-n(r).minY)}),le(()=>(ee(h()),n(r),n(s)),()=>{_(o,h()+n(r).minX+n(s)/2)}),le(()=>(ee(y()),n(r),n(i)),()=>{_(l,y()+n(r).minY+n(i)/2)}),le(()=>(n(a),ee(h()),ee(y())),()=>{_(c,n(a).length>0?`M ${n(a).map(H=>`${h()+H.x},${y()+H.y}`).join(" L ")} Z`:"")}),le(()=>(n(s),n(i)),()=>{_(m,Math.max(n(s),n(i))/2+1.5)}),le(()=>(n(o),n(m),ee(S())),()=>{_(d,n(o)+n(m)*Math.cos((S()-45)*Math.PI/180))}),le(()=>(n(l),n(m),ee(S())),()=>{_(f,n(l)+n(m)*Math.sin((S()-45)*Math.PI/180))}),Cn(),Kt();var G=wc();let J;var $=E(G),P=E($),Y=A($);{var ne=H=>{var re=Sc(),ke=Re(re),qe=A(ke);V(()=>{x(ke,"x1",n(o)),x(ke,"y1",n(l)),x(ke,"x2",n(d)),x(ke,"y2",n(f)),x(qe,"cx",n(d)),x(qe,"cy",n(f))}),q("mousedown",qe,U),L(H,re)};be(Y,H=>{k()&&H(ne)})}V(()=>{J=hn(G,0,"wall-piece svelte-1tez9jd",null,J,{selected:k(),dragging:n(w)}),x($,"transform",`rotate(${S()??""}, ${n(o)??""}, ${n(l)??""})`),x(P,"d",n(c)),x(P,"fill",k()?"rgba(139, 69, 19, 0.6)":"rgba(139, 69, 19, 0.8)"),x(P,"stroke",k()?"#3b82f6":"#5c3317"),x(P,"stroke-width",k()?.15:.1)}),q("click",P,se),q("mousedown",P,X),L(e,G),Ht()}var Ac=pe('<div class="section-content svelte-7o4pd4"><!></div>'),Cc=pe('<section><div class="section-header svelte-7o4pd4" role="button" tabindex="0"><h3 class="svelte-7o4pd4"> </h3> <span class="toggle-icon svelte-7o4pd4"> </span></div> <!></section>');function It(e,t){let a=Se(t,"title",8),r=Se(t,"defaultOpen",8,!0),s=O(r());function i(){_(s,!n(s))}var o=Cc();let l;var c=E(o),m=E(c),d=E(m),f=A(m,2),u=E(f),h=A(c,2);{var y=g=>{var p=Ac(),S=E(p);Fi(S,t,"default",{}),L(g,p)};be(h,g=>{n(s)&&g(y)})}V(()=>{l=hn(o,1,"collapsible-section svelte-7o4pd4",null,l,{collapsed:!n(s)}),Ce(d,a()),Ce(u,n(s)?"â¼":"â¶")}),q("click",c,i),L(e,o)}var Ec=pe('<button class="svelte-10mgcx0"> </button>'),Rc=pe('<div class="button-group svelte-10mgcx0"></div>'),Mc=pe('<button class="svelte-10mgcx0"> </button>'),kc=pe('<div class="button-group svelte-10mgcx0"></div>'),Dc=pe('<div class="field svelte-10mgcx0"><label for="edit-width" class="svelte-10mgcx0">Width (inches)</label> <input id="edit-width" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-height" class="svelte-10mgcx0">Height (inches)</label> <input id="edit-height" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-rotation" class="svelte-10mgcx0">Rotation (Â°)</label> <input id="edit-rotation" type="number" step="15" class="svelte-10mgcx0"/></div>',1),Ic=pe('<div class="field svelte-10mgcx0"><label for="edit-seg1" class="svelte-10mgcx0">Horizontal (inches)</label> <input id="edit-seg1" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg2" class="svelte-10mgcx0">Vertical (inches)</label> <input id="edit-seg2" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div>',1),Lc=pe('<div class="field svelte-10mgcx0"><label for="edit-seg1" class="svelte-10mgcx0">Top Width (inches)</label> <input id="edit-seg1" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg2" class="svelte-10mgcx0">Height (inches)</label> <input id="edit-seg2" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg3" class="svelte-10mgcx0">Bottom Width (inches)</label> <input id="edit-seg3" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div>',1),Nc=pe('<div class="field svelte-10mgcx0"><span class="label-text svelte-10mgcx0">Shape</span> <span class="value svelte-10mgcx0"> </span></div> <!> <div class="field svelte-10mgcx0"><label for="edit-rotation" class="svelte-10mgcx0">Rotation (Â°)</label> <input id="edit-rotation" type="number" step="15" class="svelte-10mgcx0"/></div>',1),Pc=pe('<div class="edit-form svelte-10mgcx0"><div class="field svelte-10mgcx0"><label for="edit-x" class="svelte-10mgcx0">X (inches)</label> <input id="edit-x" type="number" step="0.1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-y" class="svelte-10mgcx0">Y (inches)</label> <input id="edit-y" type="number" step="0.1" class="svelte-10mgcx0"/></div> <!> <button class="danger svelte-10mgcx0">Remove</button></div>'),$c=pe('<p class="hint svelte-10mgcx0">Click a piece to select it</p>'),Oc=pe('<div class="button-group vertical svelte-10mgcx0"><button class="svelte-10mgcx0">Save Layout</button> <button class="svelte-10mgcx0">Load Layout</button> <div class="button-row svelte-10mgcx0"><button class="secondary small svelte-10mgcx0">Export</button> <button class="secondary small svelte-10mgcx0">Import</button></div> <button class="secondary svelte-10mgcx0">Clear All</button></div>'),Wc=pe("<!> <!>",1),Yc=pe('<div class="modal-overlay svelte-10mgcx0" role="presentation"><div class="modal svelte-10mgcx0" role="dialog"><h2 class="svelte-10mgcx0">Save Layout</h2> <div class="modal-field svelte-10mgcx0"><label for="layout-name" class="svelte-10mgcx0">Layout Name</label> <input id="layout-name" type="text" placeholder="Enter a name..." class="svelte-10mgcx0"/></div> <div class="modal-actions svelte-10mgcx0"><button class="secondary svelte-10mgcx0">Cancel</button> <button class="svelte-10mgcx0">Save</button></div></div></div>'),Hc=pe('<p class="hint svelte-10mgcx0">No saved layouts yet</p>'),Fc=pe('<div class="layout-item svelte-10mgcx0" role="button" tabindex="0"><div class="layout-info svelte-10mgcx0"><span class="layout-name svelte-10mgcx0"> </span> <span class="layout-meta svelte-10mgcx0"> </span></div> <button class="delete-btn svelte-10mgcx0" title="Delete">Ã</button></div>'),Bc=pe('<div class="layout-list svelte-10mgcx0"></div>'),qc=pe('<div class="modal-overlay svelte-10mgcx0" role="presentation"><div class="modal svelte-10mgcx0" role="dialog"><h2 class="svelte-10mgcx0">Load Layout</h2> <!> <div class="modal-actions svelte-10mgcx0"><button class="secondary svelte-10mgcx0">Cancel</button></div></div></div>'),Uc=pe('<main class="svelte-10mgcx0"><div class="header svelte-10mgcx0"><h1 class="svelte-10mgcx0">Layout Builder</h1> <nav class="nav-links svelte-10mgcx0"><a href="#/setup" class="svelte-10mgcx0">Battlefield Setup</a> <a href="#/deployment" class="svelte-10mgcx0">Deployment</a> <a href="#/" class="active svelte-10mgcx0">Layout Builder</a> <a href="#/debug" class="svelte-10mgcx0">Debug Mode</a></nav></div> <div class="layout svelte-10mgcx0"><div class="sidebar svelte-10mgcx0"><!> <!> <!> <!> <input type="file" accept=".json" style="display: none;"/></div> <div class="battlefield-area svelte-10mgcx0"><div class="battlefield-container svelte-10mgcx0" role="presentation"><!></div> <div class="info svelte-10mgcx0"><p class="svelte-10mgcx0"> </p> <p class="hint svelte-10mgcx0">Scroll to zoom | Space+drag or middle-click to pan | Double-click to reset view</p></div></div></div></main> <!> <!>',1);function Kc(e,t){Yt(t,!1);const a=()=>Ze(gn,"$selectedTerrainId",l),r=()=>Ze(bn,"$selectedWallId",l),s=()=>Ze(Bt,"$layoutTerrains",l),i=()=>Ze($t,"$layoutWalls",l),o=()=>Ze(xr,"$savedLayoutsList",l),[l,c]=za(),m=O(),d=O();let f=O(!1),u=O(!1),h=O(""),y=null;ja(()=>{es(),window.addEventListener("keydown",g)}),Ki(()=>{window.removeEventListener("keydown",g)});function g(M){if(M.target.tagName==="INPUT"||n(f)||n(u))return;const Z=a()||r();if((M.key==="Delete"||M.key==="Backspace")&&Z){M.preventDefault(),J();return}if(Z&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(M.key)){M.preventDefault();const ve=M.shiftKey?.1:1;let ge=0,Te=0;switch(M.key){case"ArrowUp":Te=-ve;break;case"ArrowDown":Te=ve;break;case"ArrowLeft":ge=-ve;break;case"ArrowRight":ge=ve;break}if(a()){const He=s().find(Ue=>Ue.id===a());He&&Bt.updateTerrain(a(),{x:He.x+ge,y:He.y+Te})}else if(r()){const He=i().find(Ue=>Ue.id===r());He&&$t.updateWall(r(),{x:He.x+ge,y:He.y+Te})}return}if(M.key==="c"&&(M.ctrlKey||M.metaKey)&&Z){if(M.preventDefault(),a()){const ve=s().find(ge=>ge.id===a());ve&&(y={type:"terrain",data:{...ve}})}else if(r()){const ve=i().find(ge=>ge.id===r());ve&&(y={type:"wall",data:{...ve}})}return}if(M.key==="v"&&(M.ctrlKey||M.metaKey)&&y){if(M.preventDefault(),y.type==="terrain"){const ve="terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),ge={...y.data,id:ve,x:y.data.x+2,y:y.data.y+2};Bt.update(Te=>[...Te,ge]),gn.set(ve),bn.set(null),y.data.x+=2,y.data.y+=2}else if(y.type==="wall"){const ve="wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),ge={...y.data,id:ve,x:y.data.x+2,y:y.data.y+2};$t.update(Te=>[...Te,ge]),bn.set(ve),gn.set(null),y.data.x+=2,y.data.y+=2}return}if(M.key==="Escape"){ce();return}}let p=O(""),S=O(""),k=O(""),C=O(""),b=O(""),T=O(""),R=O(""),N=O("");function w(M){return M.segments?M.segments:er(M.shape).segments}function I(M){return er(M.shape).type}function W(M,Z){Bt.add(M,Z)}function se(M){$t.add(M)}function X(M){gn.set(M),bn.set(null)}function ye(M){bn.set(M),gn.set(null)}function ce(){gn.set(null),bn.set(null)}function U(M,Z,ve){Bt.updateTerrain(M,{x:Z,y:ve})}function B(M,Z,ve){$t.updateWall(M,{x:Z,y:ve})}function te(M,Z){Bt.updateTerrain(M,{rotation:Z})}function G(M,Z){$t.updateWall(M,{rotation:Z})}function J(){a()?(Bt.remove(a()),gn.set(null)):r()&&($t.remove(r()),bn.set(null))}function $(){const M=parseFloat(n(p)),Z=parseFloat(n(S));!isNaN(M)&&!isNaN(Z)&&(a()?Bt.updateTerrain(a(),{x:M,y:Z}):r()&&$t.updateWall(r(),{x:M,y:Z}))}function P(){if(!a())return;const M=parseFloat(n(k)),Z=parseFloat(n(C));!isNaN(M)&&!isNaN(Z)&&M>0&&Z>0&&Bt.updateTerrain(a(),{width:M,height:Z})}function Y(){const M=parseFloat(n(b));isNaN(M)||(a()?Bt.updateTerrain(a(),{rotation:M}):r()&&$t.updateWall(r(),{rotation:M}))}function ne(){if(!r()||!n(d))return;const M=I(n(d)),Z=parseFloat(n(T)),ve=parseFloat(n(R));if(isNaN(Z)||isNaN(ve)||Z<=0||ve<=0)return;let ge;if(M==="C"){const Te=parseFloat(n(N));if(isNaN(Te)||Te<=0)return;ge=[Z,ve,Te]}else ge=[Z,ve];$t.updateWall(r(),{segments:ge})}function H(){_(h,""),_(f,!0)}function re(){n(h).trim()&&(bc(n(h).trim()),es(),_(f,!1),_(h,""))}function ke(){es(),_(u,!0)}function qe(M){Tc(M),gn.set(null),bn.set(null),_(u,!1)}function F(M,Z){Z.stopPropagation(),confirm(`Delete layout "${M}"?`)&&(xc(M),es())}function de(){confirm("Clear all terrain and walls?")&&(Bt.clear(),$t.clear(),gn.set(null),bn.set(null))}function Pe(M){return new Date(M).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function oe(M){const Z=Zs.find(ve=>ve.shape===M);return Z?Z.label:M}function Tt(){const M=prompt("Layout name (for the recipient):","Custom Layout");if(M===null)return;const Z=s(),ve=i(),ge={version:1,name:M||"Custom Layout",exportedAt:new Date().toISOString(),terrainCount:Z.length,wallCount:ve.length,terrains:Z,walls:ve},Te=JSON.stringify(ge,null,2),He=new Blob([Te],{type:"application/json"}),Ue=URL.createObjectURL(He),me=document.createElement("a");me.href=Ue;const De=(M||"layout").toLowerCase().replace(/[^a-z0-9]+/g,"-");me.download=`${De}-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(me),me.click(),document.body.removeChild(me),URL.revokeObjectURL(Ue)}let ct=O();function at(){n(ct).click()}function Ge(M){const Z=M.target.files[0];if(!Z)return;const ve=new FileReader;ve.onload=ge=>{try{const Te=JSON.parse(ge.target.result);Te.terrains&&Array.isArray(Te.terrains)&&Bt.set(Te.terrains),Te.walls&&Array.isArray(Te.walls)&&$t.set(Te.walls),gn.set(null),bn.set(null);const He=Te.name||"Unknown",Ue=Te.terrains?.length||0,me=Te.walls?.length||0;alert(`Imported "${He}"
${Ue} terrain(s), ${me} wall(s)`)}catch(Te){alert("Failed to import layout: Invalid file format"),console.error("Import error:",Te)}},ve.readAsText(Z),M.target.value=""}le(()=>(s(),a()),()=>{_(m,s().find(M=>M.id===a()))}),le(()=>(i(),r()),()=>{_(d,i().find(M=>M.id===r()))}),le(()=>(n(m),n(d)),()=>{if(n(m))_(p,n(m).x.toFixed(1)),_(S,n(m).y.toFixed(1)),_(k,n(m).width.toString()),_(C,n(m).height.toString()),_(b,Math.round(n(m).rotation).toString());else if(n(d)){_(p,n(d).x.toFixed(1)),_(S,n(d).y.toFixed(1)),_(b,Math.round(n(d).rotation).toString());const M=w(n(d));_(T,M[0]?.toString()||""),_(R,M[1]?.toString()||""),_(N,M[2]?.toString()||"")}}),Cn(),Kt();var wt=Uc(),rn=Re(wt),on=A(E(rn),2),z=E(on),_e=E(z);It(_e,{title:"Add Terrain",children:(M,Z)=>{var ve=Rc();Me(ve,5,()=>Ji,Be,(ge,Te)=>{var He=Ec(),Ue=E(He);V(()=>Ce(Ue,(n(Te),v(()=>n(Te).label)))),q("click",He,()=>W(n(Te).width,n(Te).height)),L(ge,He)}),L(M,ve)},$$slots:{default:!0}});var Le=A(_e,2);It(Le,{title:"Add Wall",children:(M,Z)=>{var ve=kc();Me(ve,5,()=>Zs,Be,(ge,Te)=>{var He=Mc(),Ue=E(He);V(()=>Ce(Ue,(n(Te),v(()=>n(Te).label)))),q("click",He,()=>se(n(Te).shape)),L(ge,He)}),L(M,ve)},$$slots:{default:!0}});var et=A(Le,2);{let M=Xe(()=>n(m)?"Terrain":n(d)?"Wall":"Item");It(et,{get title(){return`Selected ${n(M)??""}`},children:(Z,ve)=>{var ge=bt(),Te=Re(ge);{var He=me=>{var De=Pc(),mt=E(De),aa=A(E(mt),2),xt=A(mt,2),qn=A(E(xt),2),sa=A(xt,2);{var ra=Ft=>{var En=Dc(),yn=Re(En),Aa=A(E(yn),2),Un=A(yn,2),oa=A(E(Un),2),D=A(Un,2),K=A(E(D),2);Pt(Aa,()=>n(k),Q=>_(k,Q)),q("change",Aa,P),Pt(oa,()=>n(C),Q=>_(C,Q)),q("change",oa,P),Pt(K,()=>n(b),Q=>_(b,Q)),q("change",K,Y),L(Ft,En)},ia=Ft=>{var En=bt(),yn=Re(En);{var Aa=Un=>{var oa=Nc(),D=Re(oa),K=A(E(D),2),Q=E(K),ue=A(D,2);{var ie=Ne=>{var Qe=Ic(),rt=Re(Qe),nt=A(E(rt),2),ut=A(rt,2),pt=A(E(ut),2);Pt(nt,()=>n(T),_t=>_(T,_t)),q("change",nt,ne),Pt(pt,()=>n(R),_t=>_(R,_t)),q("change",pt,ne),L(Ne,Qe)},fe=Ne=>{var Qe=bt(),rt=Re(Qe);{var nt=ut=>{var pt=Lc(),_t=Re(pt),pn=A(E(_t),2),Rn=A(_t,2),Mn=A(E(Rn),2),Jt=A(Rn,2),kn=A(E(Jt),2);Pt(pn,()=>n(T),Zt=>_(T,Zt)),q("change",pn,ne),Pt(Mn,()=>n(R),Zt=>_(R,Zt)),q("change",Mn,ne),Pt(kn,()=>n(N),Zt=>_(N,Zt)),q("change",kn,ne),L(ut,pt)};be(rt,ut=>{n(d),v(()=>I(n(d))==="C")&&ut(nt)},!0)}L(Ne,Qe)};be(ue,Ne=>{n(d),v(()=>I(n(d))==="L")?Ne(ie):Ne(fe,!1)})}var he=A(ue,2),xe=A(E(he),2);V(Ne=>Ce(Q,Ne),[()=>(n(d),v(()=>oe(n(d).shape)))]),Pt(xe,()=>n(b),Ne=>_(b,Ne)),q("change",xe,Y),L(Un,oa)};be(yn,Un=>{n(d)&&Un(Aa)},!0)}L(Ft,En)};be(sa,Ft=>{n(m)?Ft(ra):Ft(ia,!1)})}var Xa=A(sa,2);Pt(aa,()=>n(p),Ft=>_(p,Ft)),q("change",aa,$),Pt(qn,()=>n(S),Ft=>_(S,Ft)),q("change",qn,$),q("click",Xa,J),L(me,De)},Ue=me=>{var De=$c();L(me,De)};be(Te,me=>{n(m)||n(d)?me(He):me(Ue,!1)})}L(Z,ge)},$$slots:{default:!0}})}var ze=A(et,2);It(ze,{title:"Layout",children:(M,Z)=>{var ve=Oc(),ge=E(ve),Te=A(ge,2),He=A(Te,2),Ue=E(He),me=A(Ue,2),De=A(He,2);V(()=>Te.disabled=(o(),v(()=>o().length===0))),q("click",ge,H),q("click",Te,ke),q("click",Ue,Tt),q("click",me,at),q("click",De,de),L(M,ve)},$$slots:{default:!0}});var st=A(ze,2);ls(st,M=>_(ct,M),()=>n(ct));var ft=A(z,2),Lt=E(ft),yt=E(Lt);Ws(yt,{children:cr,$$slots:{default:(M,Z)=>{const ve=Xe(()=>Z.screenToSvg);var ge=Wc(),Te=Re(ge);Me(Te,1,s,Ue=>Ue.id,(Ue,me)=>{{let De=Xe(()=>(n(me),a(),v(()=>n(me).id===a())));Vi(Ue,{get id(){return n(me),v(()=>n(me).id)},get x(){return n(me),v(()=>n(me).x)},get y(){return n(me),v(()=>n(me).y)},get width(){return n(me),v(()=>n(me).width)},get height(){return n(me),v(()=>n(me).height)},get rotation(){return n(me),v(()=>n(me).rotation)},get selected(){return n(De)},get screenToSvg(){return n(ve)},onSelect:X,onDrag:U,onRotate:te})}});var He=A(Te,2);Me(He,1,i,Ue=>Ue.id,(Ue,me)=>{{let De=Xe(()=>(n(me),r(),v(()=>n(me).id===r())));_r(Ue,{get id(){return n(me),v(()=>n(me).id)},get x(){return n(me),v(()=>n(me).x)},get y(){return n(me),v(()=>n(me).y)},get shape(){return n(me),v(()=>n(me).shape)},get segments(){return n(me),v(()=>n(me).segments)},get rotation(){return n(me),v(()=>n(me).rotation)},get selected(){return n(De)},get screenToSvg(){return n(ve)},onSelect:ye,onDrag:B,onRotate:G})}}),L(M,ge)}}});var At=A(Lt,2),we=E(At),$e=E(we),Ee=A(rn,2);{var tt=M=>{var Z=Yc(),ve=E(Z),ge=A(E(ve),2),Te=A(E(ge),2),He=A(ge,2),Ue=E(He),me=A(Ue,2);V(De=>me.disabled=De,[()=>(n(h),v(()=>!n(h).trim()))]),Pt(Te,()=>n(h),De=>_(h,De)),q("keydown",Te,De=>De.key==="Enter"&&re()),q("click",Ue,()=>_(f,!1)),q("click",me,re),q("click",ve,Or(function(De){Yr.call(this,t,De)})),q("click",Z,()=>_(f,!1)),L(M,Z)};be(Ee,M=>{n(f)&&M(tt)})}var Ct=A(Ee,2);{var We=M=>{var Z=qc(),ve=E(Z),ge=A(E(ve),2);{var Te=De=>{var mt=Hc();L(De,mt)},He=De=>{var mt=Bc();Me(mt,5,o,Be,(aa,xt)=>{var qn=Fc(),sa=E(qn),ra=E(sa),ia=E(ra),Xa=A(ra,2),Ft=E(Xa),En=A(sa,2);V(yn=>{Ce(ia,(n(xt),v(()=>n(xt).name))),Ce(Ft,`${n(xt),v(()=>n(xt).terrainCount)??""} terrain${n(xt),v(()=>n(xt).terrainCount!==1?"s":"")??""}, ${n(xt),v(()=>n(xt).wallCount||0)??""} wall${n(xt),v(()=>(n(xt).wallCount||0)!==1?"s":"")??""} Â· ${yn??""}`)},[()=>(n(xt),v(()=>Pe(n(xt).savedAt)))]),q("click",En,yn=>F(n(xt).name,yn)),q("click",qn,()=>qe(n(xt).name)),L(aa,qn)}),L(De,mt)};be(ge,De=>{o(),v(()=>o().length===0)?De(Te):De(He,!1)})}var Ue=A(ge,2),me=E(Ue);q("click",me,()=>_(u,!1)),q("click",ve,Or(function(De){Yr.call(this,t,De)})),q("click",Z,()=>_(u,!1)),L(M,Z)};be(Ct,M=>{n(u)&&M(We)})}V(()=>Ce($e,`Battlefield: 60" x 44" | ${s(),v(()=>s().length)??""} terrain${s(),v(()=>s().length!==1?"s":"")??""} | ${i(),v(()=>i().length)??""} wall${i(),v(()=>i().length!==1?"s":"")??""}`)),q("change",st,Ge),q("click",Lt,ce),L(e,wt),Ht(),c()}const to=1/25.4,no=40*to/2,ao=3+20*to;function so(e="item"){return e+"-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Gc(){const{subscribe:e,set:t,update:a}=lt([]);return{subscribe:e,set:t,update:a,add(r){const s=so("zone");return a(i=>[...i,{id:s,...r}]),s},updateZone(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){t([])}}}function zc(){const{subscribe:e,set:t,update:a}=lt([]);return{subscribe:e,set:t,update:a,add(r,s,i=!1){const o=so("obj"),l=Math.round(r),c=Math.round(s);return a(m=>[...m,{id:o,x:l,y:c,isPrimary:i}]),o},updateObjective(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){t([])}}}Gc();zc();const ro=[{name:"Dawn of War",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:32},{type:"L",x:60,y:32},{type:"L",x:60,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:0,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:12},{type:"L",x:0,y:12},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1}]},{name:"Hammer and Anvil",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:18,y:0},{type:"L",x:18,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:42,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:42,y:44},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1}]},{name:"Tipping Point",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:12,y:0},{type:"L",x:12,y:22},{type:"L",x:20,y:22},{type:"L",x:20,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:40,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:48,y:44},{type:"L",x:48,y:22},{type:"L",x:40,y:22},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:34,isPrimary:!1},{x:22,y:8,isPrimary:!1},{x:38,y:36,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Search and Destroy",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:22},{type:"L",x:21,y:22},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:0,x:30,y:31},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:30,y:0},{type:"L",x:30,y:13},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:1,x:39,y:22},{type:"L",x:60,y:22},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:10,isPrimary:!1},{x:46,y:34,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Sweeping Engagement",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:0,y:8},{type:"L",x:30,y:8},{type:"L",x:30,y:14},{type:"L",x:60,y:14},{type:"L",x:60,y:0},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:0,y:44},{type:"L",x:60,y:44},{type:"L",x:60,y:36},{type:"L",x:30,y:36},{type:"L",x:30,y:30},{type:"L",x:0,y:30},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:18,isPrimary:!1},{x:50,y:26,isPrimary:!1},{x:18,y:38,isPrimary:!1},{x:42,y:6,isPrimary:!1}]},{name:"Crucible of Battle",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:60,y:44},{type:"L",x:30,y:0},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:20,y:8,isPrimary:!1},{x:40,y:36,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]}];function tr(e){return e.map(t=>{switch(t.type){case"M":return`M ${t.x} ${t.y}`;case"L":return`L ${t.x} ${t.y}`;case"A":return`A ${t.rx} ${t.ry} ${t.rotation} ${t.largeArc} ${t.sweep} ${t.x} ${t.y}`;case"Z":return"Z";default:return""}}).join(" ")}const fa=lt(null),mn=lt(null),Tn=lt(null),io=Qt([mn,Tn],([e,t])=>{if(!e)return{terrains:[],walls:[]};if(t==="preset"){const a=br.find(r=>r.name===e);return a?{terrains:a.terrains||[],walls:a.walls||[]}:{terrains:[],walls:[]}}else if(t==="saved"){const a=localStorage.getItem("warhammer-deployment-layouts");if(a)try{const r=JSON.parse(a);if(r[e])return{terrains:r[e].terrains||[],walls:r[e].walls||[]}}catch(r){console.error("Failed to load layout:",r)}}return{terrains:[],walls:[]}});var jc=pe('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),Xc=pe('<button class="svelte-1jotvmi"> </button>'),Vc=pe('<div class="button-group svelte-1jotvmi"></div>'),Qc=pe('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),Jc=pe('<button class="svelte-1jotvmi"> </button>'),Zc=pe('<button class="svelte-1jotvmi"> </button>'),em=pe('<div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Saved</h4> <div class="button-group svelte-1jotvmi"></div></div>'),tm=pe('<div class="layout-sections svelte-1jotvmi"><div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Presets</h4> <div class="button-group svelte-1jotvmi"></div></div> <!></div>'),nm=pe('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Objectives:</span> <span class="value svelte-1jotvmi"> </span></div>'),am=pe('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Pieces:</span> <span class="value svelte-1jotvmi"> </span></div>'),sm=pe('<div class="summary svelte-1jotvmi"><div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Deployment:</span> <span class="value svelte-1jotvmi"> </span></div> <div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Terrain:</span> <span class="value svelte-1jotvmi"> </span></div> <!> <!></div>'),rm=Ae('<path stroke-width="0.10" stroke-dasharray="0.5,0.25"></path>'),im=Ae('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15"></circle><circle stroke="#000" stroke-width="0.06"></circle><circle r="0.15" fill="#000"></circle>',1),om=Ae("<!><!>",1),lm=Ae('<g><rect fill="rgba(139, 90, 43, 0.6)" stroke="#8b5a2b" stroke-width="0.1"></rect></g>'),cm=Ae('<g><path fill="rgba(139, 69, 19, 0.8)" stroke="#5c3317" stroke-width="0.1"></path></g>'),mm=Ae("<!><!><!>",1),um=pe('<main class="svelte-1jotvmi"><div class="header svelte-1jotvmi"><h1 class="svelte-1jotvmi">Battlefield Setup</h1> <nav class="nav-links svelte-1jotvmi"><a href="#/setup" class="active svelte-1jotvmi">Battlefield Setup</a> <a href="#/deployment" class="svelte-1jotvmi">Deployment</a> <a href="#/" class="svelte-1jotvmi">Layout Builder</a> <a href="#/debug" class="svelte-1jotvmi">Debug Mode</a></nav></div> <div class="layout svelte-1jotvmi"><div class="sidebar svelte-1jotvmi"><!> <!> <!></div> <div class="battlefield-area svelte-1jotvmi"><div class="battlefield-container svelte-1jotvmi"><!></div> <div class="info svelte-1jotvmi"><p class="svelte-1jotvmi">Battlefield: 60" x 44"</p> <p class="hint svelte-1jotvmi">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function dm(e,t){Yt(t,!1);const a=()=>Ze(fa,"$selectedDeployment",o),r=()=>Ze(mn,"$selectedLayoutName",o),s=()=>Ze(xr,"$savedLayoutsList",o),i=()=>Ze(io,"$loadedTerrain",o),[o,l]=za();ja(()=>{es()});function c(w){fa.set(w)}function m(w){mn.set(w.name),Tn.set("preset")}function d(w){mn.set(w),Tn.set("saved")}function f(){mn.set(null),Tn.set(null)}function u(){fa.set(null)}function h(w){let W=[];switch(w.shape){case"L-4x8":W=[{x:0,y:0},{x:.5,y:0},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];break;case"L-4x8-mirror":W=[{x:0,y:0},{x:.5,y:0},{x:.5,y:8},{x:-4+.5,y:8},{x:-4+.5,y:8-.5},{x:0,y:8-.5}];break;case"C-4-8-4":W=[{x:0,y:0},{x:4,y:0},{x:4,y:.5},{x:.5,y:.5},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];break;case"L-5x6":W=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:5,y:6-.5},{x:5,y:6},{x:0,y:6}];break;case"L-5x6-mirror":W=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-5+.5,y:6},{x:-5+.5,y:6-.5},{x:0,y:6-.5}];break;case"L-4x6":W=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:4,y:6-.5},{x:4,y:6},{x:0,y:6}];break;case"L-4x6-mirror":W=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-4+.5,y:6},{x:-4+.5,y:6-.5},{x:0,y:6-.5}];break;default:return""}return`M ${W.map(se=>`${w.x+se.x},${w.y+se.y}`).join(" L ")} Z`}function y(w){switch(w.shape){case"L-4x8":return{x:w.x+2,y:w.y+4};case"L-4x8-mirror":return{x:w.x-2+.5,y:w.y+4};case"C-4-8-4":return{x:w.x+2,y:w.y+4};case"L-5x6":return{x:w.x+2.5,y:w.y+3};case"L-5x6-mirror":return{x:w.x-2.5+.5,y:w.y+3};case"L-4x6":return{x:w.x+2,y:w.y+3};case"L-4x6-mirror":return{x:w.x-2+.5,y:w.y+3};default:return{x:w.x,y:w.y}}}Kt();var g=um(),p=A(E(g),2),S=E(p),k=E(S);It(k,{title:"Deployment",children:(w,I)=>{var W=bt(),se=Re(W);{var X=ce=>{var U=jc(),B=E(U),te=E(B),G=A(B,2);V(()=>Ce(te,a().name)),q("click",G,u),L(ce,U)},ye=ce=>{var U=Vc();Me(U,5,()=>ro,Be,(B,te)=>{var G=Xc(),J=E(G);V(()=>Ce(J,n(te).name)),q("click",G,()=>c(n(te))),L(B,G)}),L(ce,U)};be(se,ce=>{a()?ce(X):ce(ye,!1)})}L(w,W)},$$slots:{default:!0}});var C=A(k,2);It(C,{title:"Terrain Layout",children:(w,I)=>{var W=bt(),se=Re(W);{var X=ce=>{var U=Qc(),B=E(U),te=E(B),G=A(B,2);V(()=>Ce(te,r())),q("click",G,f),L(ce,U)},ye=ce=>{var U=tm(),B=E(U),te=A(E(B),2);Me(te,5,()=>br,Be,($,P)=>{var Y=Jc(),ne=E(Y);V(()=>Ce(ne,n(P).name)),q("click",Y,()=>m(n(P))),L($,Y)});var G=A(B,2);{var J=$=>{var P=em(),Y=A(E(P),2);Me(Y,5,s,Be,(ne,H)=>{var re=Zc(),ke=E(re);V(()=>Ce(ke,n(H).name)),q("click",re,()=>d(n(H).name)),L(ne,re)}),L($,P)};be(G,$=>{s().length>0&&$(J)})}L(ce,U)};be(se,ce=>{r()?ce(X):ce(ye,!1)})}L(w,W)},$$slots:{default:!0}});var b=A(C,2);It(b,{title:"Summary",children:(w,I)=>{var W=sm(),se=E(W),X=A(E(se),2),ye=E(X),ce=A(se,2),U=A(E(ce),2),B=E(U),te=A(ce,2);{var G=P=>{var Y=nm(),ne=A(E(Y),2),H=E(ne);V(()=>Ce(H,a().objectives.length)),L(P,Y)};be(te,P=>{a()&&P(G)})}var J=A(te,2);{var $=P=>{var Y=am(),ne=A(E(Y),2),H=E(ne);V(()=>Ce(H,`${i().terrains.length??""} terrain, ${i().walls.length??""} walls`)),L(P,Y)};be(J,P=>{(i().terrains.length>0||i().walls.length>0)&&P($)})}V(()=>{Ce(ye,a()?.name||"None"),Ce(B,r()||"None")}),L(w,W)},$$slots:{default:!0}});var T=A(S,2),R=E(T),N=E(R);Ws(N,{children:(w,I)=>{var W=mm(),se=Re(W);{var X=U=>{var B=om(),te=Re(B);Me(te,1,()=>a().zones,Be,(J,$)=>{var P=rm();V(Y=>{x(P,"d",Y),x(P,"fill",n($).color),x(P,"stroke",n($).borderColor)},[()=>tr(n($).path)]),L(J,P)});var G=A(te);Me(G,1,()=>a().objectives,Be,(J,$)=>{const P=Xe(()=>n($).isPrimary?"#fbbf24":"#9ca3af"),Y=Xe(()=>n($).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)");var ne=im(),H=Re(ne),re=A(H),ke=A(re);V(()=>{x(H,"cx",n($).x),x(H,"cy",n($).y),x(H,"r",ao),x(H,"fill",n(Y)),x(H,"stroke",n(P)),x(re,"cx",n($).x),x(re,"cy",n($).y),x(re,"r",no),x(re,"fill",n(P)),x(ke,"cx",n($).x),x(ke,"cy",n($).y)}),L(J,ne)}),L(U,B)};be(se,U=>{a()&&U(X)})}var ye=A(se);Me(ye,1,()=>i().terrains,Be,(U,B)=>{const te=Xe(()=>n(B).x+n(B).width/2),G=Xe(()=>n(B).y+n(B).height/2);var J=lm(),$=E(J);V(()=>{x(J,"transform",`rotate(${n(B).rotation??""}, ${n(te)??""}, ${n(G)??""})`),x($,"x",n(B).x),x($,"y",n(B).y),x($,"width",n(B).width),x($,"height",n(B).height)}),L(U,J)});var ce=A(ye);Me(ce,1,()=>i().walls,Be,(U,B)=>{const te=Xe(()=>y(n(B)));var G=cm(),J=E(G);V($=>{x(G,"transform",`rotate(${n(B).rotation??""}, ${n(te).x??""}, ${n(te).y??""})`),x(J,"d",$)},[()=>h(n(B))]),L(U,G)}),L(w,W)},$$slots:{default:!0}}),L(e,g),Ht(),l()}function oo(){const{subscribe:e,set:t,update:a}=lt({past:[],future:[]});return{subscribe:e,push(r){a(s=>({past:[...s.past,r],future:[]}))},undo(){let r=null;return a(s=>{if(s.past.length===0)return s;const i=[...s.past];return r=i.pop(),{past:i,future:[r,...s.future]}}),r},redo(){let r=null;return a(s=>{if(s.future.length===0)return s;const i=[...s.future];return r=i.shift(),{past:[...s.past,r],future:i}}),r},canUndo(){return jt({subscribe:e}).past.length>0},canRedo(){return jt({subscribe:e}).future.length>0},clear(){t({past:[],future:[]})}}}const zn=oo(),nr=oo(),Je=1/25.4,Xt={circles:[{type:"25mm",radius:25*Je/2,label:"25mm"},{type:"28.5mm",radius:28.5*Je/2,label:"28mm.5"},{type:"32mm",radius:32*Je/2,label:"32mm"},{type:"40mm",radius:40*Je/2,label:"40mm"},{type:"50mm",radius:50*Je/2,label:"50mm"},{type:"60mm",radius:60*Je/2,label:"60mm"},{type:"80mm",radius:80*Je/2,label:"80mm"},{type:"90mm",radius:90*Je/2,label:"90mm"},{type:"100mm",radius:100*Je/2,label:"100mm"},{type:"130mm",radius:130*Je/2,label:"130mm"},{type:"160mm",radius:160*Je/2,label:"160mm"}],ovals:[{type:"60x35.5mm",width:60*Je,height:35.5*Je,label:"60Ã35.5mm"},{type:"75x42mm",width:75*Je,height:42*Je,label:"75Ã42mm"},{type:"Small Flying Base",width:75*Je,height:42*Je,label:"Small Flying"},{type:"90x52.5mm",width:90*Je,height:52.5*Je,label:"90Ã52.5mm"},{type:"Large Flying Base",width:90*Je,height:52.5*Je,label:"Large Flying"},{type:"105x70mm",width:105*Je,height:70*Je,label:"105Ã70mm"},{type:"120x92mm",width:120*Je,height:92*Je,label:"120Ã92mm"},{type:"150x95mm",width:150*Je,height:95*Je,label:"150Ã95mm"},{type:"170x109mm",width:170*Je,height:109*Je,label:"170Ã109mm"}]};function rs(e,t=null){const a=Xt.circles.find(s=>s.type===e);if(a)return a;const r=Xt.ovals.find(s=>s.type===e);return r||(Sr(e)&&t?{type:e,width:t.customWidth,height:t.customHeight,label:`${t.customWidth.toFixed(1)}"Ã${t.customHeight.toFixed(1)}"`}:null)}function is(e){return Xt.ovals.some(t=>t.type===e)}function Sr(e){return e&&e.startsWith("rect-")}function Kr(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function lo(e){const{subscribe:t,set:a,update:r}=lt([]);return{subscribe:t,set:a,update:r,add(s,i,o,l,c=null,m=!1){const d=Kr(),f={id:d,baseType:s,playerId:i,x:o,y:l,rotation:0};return c&&c.width&&c.height&&(f.customWidth=c.width,f.customHeight=c.height),r(u=>[...u,f]),!m&&e&&e.push({type:"add",modelId:d,model:{...f}}),d},updateModel(s,i,o=!1){let l=null,c=null;if(!o&&e){const d=jt({subscribe:t}).find(f=>f.id===s);d&&(l={...d},"x"in i||"y"in i?c="move":"rotation"in i&&(c="rotate"))}if(r(m=>m.map(d=>d.id===s?{...d,...i}:d)),!o&&e&&c&&l){const d=jt({subscribe:t}).find(f=>f.id===s);e.push({type:c,modelId:s,before:c==="move"?{x:l.x,y:l.y}:{rotation:l.rotation},after:c==="move"?{x:d.x,y:d.y}:{rotation:d.rotation}})}},remove(s,i=!1){let o=null;!i&&e&&(o=jt({subscribe:t}).find(c=>c.id===s)),r(l=>l.filter(c=>c.id!==s)),!i&&e&&o&&e.push({type:"remove",modelId:s,model:{...o}})},removeByPlayer(s){r(i=>i.filter(o=>o.playerId!==s))},addBatch(s,i=!1){const o=[];return r(l=>{const c=[...l];return s.forEach(m=>{const d=m.id||Kr(),f={...m,id:d};c.push(f),o.push(d),!i&&e&&e.push({type:"add",modelId:d,model:{...f}})}),c}),o},updateUnit(s,i,o=!1){r(l=>l.map(c=>c.unitId===s?{...c,...i}:c))},removeUnit(s,i=!1){const o=[];if(!i&&e){const l=jt({subscribe:t});o.push(...l.filter(c=>c.unitId===s))}r(l=>l.filter(c=>c.unitId!==s)),!i&&e&&o.forEach(l=>{e.push({type:"remove",modelId:l.id,model:{...l}})})},clear(){a([]),e&&e.clear()},undo(){if(!e)return;const s=e.undo();if(s)switch(s.type){case"add":this.remove(s.modelId,!0);break;case"remove":r(i=>[...i,s.model]);break;case"move":this.updateModel(s.modelId,s.before,!0);break;case"rotate":this.updateModel(s.modelId,s.before,!0);break}},redo(){if(!e)return;const s=e.redo();if(s)switch(s.type){case"add":r(i=>[...i,s.model]);break;case"remove":this.remove(s.modelId,!0);break;case"move":this.updateModel(s.modelId,s.after,!0);break;case"rotate":this.updateModel(s.modelId,s.after,!0);break}}}}const ot=lo(zn),hm=Qt(ot,e=>e.filter(t=>t.playerId===1)),fm=Qt(ot,e=>e.filter(t=>t.playerId===2)),ym=lt(null);Qt([ot,ym],([e,t])=>t?e.find(a=>a.id===t):null);const jn=lo(nr),ua=lt(null);Qt([jn,ua],([e,t])=>t?e.find(a=>a.id===t):null);var pm=Ae('<g><rect role="button" tabindex="0" class="svelte-hycs6b"></rect></g>'),vm=Ae('<g><ellipse role="button" tabindex="0" class="svelte-hycs6b"></ellipse></g>'),gm=Ae('<circle role="button" tabindex="0" class="svelte-hycs6b"></circle>'),bm=Ae('<text text-anchor="middle" dominant-baseline="middle" font-weight="bold" fill="white" stroke="black" stroke-width="0.02" paint-order="stroke" pointer-events="none" class="model-name"> </text>'),Tm=Ae('<line stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-hycs6b"></circle>',1),xm=Ae('<line stroke="#fbbf24" stroke-width="0.12" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.25" fill="#fbbf24" pointer-events="none" class="svelte-hycs6b"></circle><text text-anchor="middle" dominant-baseline="middle" font-size="0.5" font-weight="bold" fill="#fbbf24" stroke="#000" stroke-width="0.05" paint-order="stroke" pointer-events="none" class="drag-ruler-label svelte-hycs6b"> </text>',1),_m=Ae("<g><!><!><!><!></g>");function ms(e,t){Yt(t,!1);const a=O(),r=O(),s=O(),i=O(),o=O(),l=O(),c=O(),m=O(),d=O(),f=O(),u=O(),h=O(),y=O(),g=O(),p=O(),S=O(),k=O(),C=O(),b=O(),T=O(),R=O();let N=Se(t,"id",8),w=Se(t,"x",8),I=Se(t,"y",8),W=Se(t,"baseType",8),se=Se(t,"playerId",8),X=Se(t,"rotation",8,0),ye=Se(t,"selected",8,!1),ce=Se(t,"marqueePreview",8,!1),U=Se(t,"name",8,""),B=Se(t,"customWidth",8,null),te=Se(t,"customHeight",8,null),G=Se(t,"screenToSvg",8),J=Se(t,"onSelect",8,()=>{}),$=Se(t,"onDrag",8,()=>{}),P=Se(t,"onDragEnd",8,()=>{}),Y=Se(t,"onRotate",8,()=>{}),ne=Se(t,"onRotateEnd",8,()=>{}),H=Se(t,"onRename",8,()=>{}),re=O(!1),ke=!1,qe={x:0,y:0},F=O(null),de=null;function Pe(we){we.stopPropagation(),J()(N(),we)}function oe(we){we.stopPropagation();const $e=prompt("Model name:",U());$e!==null&&H()(N(),$e)}function Tt(we){if(we.button!==0)return;we.preventDefault(),we.stopPropagation(),J()(N(),we),_(re,!0),_(F,{x:w(),y:I()});const $e=G()(we.clientX,we.clientY);qe={x:$e.x-w(),y:$e.y-I()},window.addEventListener("mousemove",ct),window.addEventListener("mouseup",at)}function ct(we){if(!n(re))return;const $e=G()(we.clientX,we.clientY);let Ee=$e.x-qe.x,tt=$e.y-qe.y;$()(N(),Ee,tt)}function at(){n(re)&&n(F)&&((n(F).x!==w()||n(F).y!==I())&&P()(N(),n(F).x,n(F).y,w(),I()),_(F,null)),_(re,!1),window.removeEventListener("mousemove",ct),window.removeEventListener("mouseup",at)}function Ge(we){we.preventDefault(),we.stopPropagation(),ke=!0,de=X(),window.addEventListener("mousemove",wt),window.addEventListener("mouseup",rn)}function wt(we){if(!ke)return;const $e=G()(we.clientX,we.clientY),Ee=$e.x-w(),tt=$e.y-I();let Ct=Math.atan2(tt,Ee)*180/Math.PI+45;we.shiftKey||(Ct=Math.round(Ct/15)*15),Y()(N(),Ct)}function rn(){ke&&de!==null&&(de!==X()&&ne()(N(),de,X()),de=null),ke=!1,window.removeEventListener("mousemove",wt),window.removeEventListener("mouseup",rn)}le(()=>(ee(B()),ee(te())),()=>{_(a,{customWidth:B(),customHeight:te()})}),le(()=>(ee(W()),n(a)),()=>{_(r,rs(W(),n(a)))}),le(()=>ee(W()),()=>{_(s,is(W()))}),le(()=>ee(W()),()=>{_(i,Sr(W()))}),le(()=>ee(se()),()=>{_(o,se()===1?"#3b82f6":"#ef4444")}),le(()=>ee(se()),()=>{_(l,se()===1?"rgba(59, 130, 246, 0.5)":"rgba(239, 68, 68, 0.5)")}),le(()=>ee(se()),()=>{_(c,se()===1?"rgba(59, 130, 246, 0.3)":"rgba(239, 68, 68, 0.3)")}),le(()=>(ee(ye()),ee(ce())),()=>{_(m,ye()?.15:ce()?.12:.1)}),le(()=>(ee(ye()),n(o),ee(ce()),n(c),n(l)),()=>{_(d,ye()?n(o):ce()?n(c):n(l))}),le(()=>n(r),()=>{_(f,n(r)?.radius||.5)}),le(()=>n(r),()=>{_(u,n(r)?.width?n(r).width/2:0)}),le(()=>n(r),()=>{_(h,n(r)?.height?n(r).height/2:0)}),le(()=>(n(i),ee(B())),()=>{_(y,n(i)&&B()||0)}),le(()=>(n(i),ee(te())),()=>{_(g,n(i)&&te()||0)}),le(()=>(n(s),n(u),n(h),n(i),n(y),n(g)),()=>{_(p,n(s)?Math.max(n(u),n(h))+1:n(i)?Math.max(n(y),n(g))/2+1:0)}),le(()=>(ee(w()),n(p),ee(X())),()=>{_(S,w()+n(p)*Math.cos((X()-45)*Math.PI/180))}),le(()=>(ee(I()),n(p),ee(X())),()=>{_(k,I()+n(p)*Math.sin((X()-45)*Math.PI/180))}),le(()=>(n(re),n(F),ee(w()),ee(I())),()=>{_(C,n(re)&&n(F)?Math.sqrt(Math.pow(w()-n(F).x,2)+Math.pow(I()-n(F).y,2)):0)}),le(()=>(n(re),n(F),ee(w())),()=>{_(b,n(re)&&n(F)?(n(F).x+w())/2:0)}),le(()=>(n(re),n(F),ee(I())),()=>{_(T,n(re)&&n(F)?(n(F).y+I())/2:0)}),le(()=>(n(i),n(y),n(g),n(s),n(u),n(h),n(f)),()=>{_(R,n(i)?Math.min(n(y),n(g))*.2:n(s)?Math.min(n(u),n(h))*.4:n(f)*.5)}),Cn(),Kt();var on=_m();let z;var _e=E(on);{var Le=we=>{var $e=pm(),Ee=E($e);V(()=>{x($e,"transform",`rotate(${X()??""}, ${w()??""}, ${I()??""})`),x(Ee,"x",w()-n(y)/2),x(Ee,"y",I()-n(g)/2),x(Ee,"width",n(y)),x(Ee,"height",n(g)),x(Ee,"fill",n(d)),x(Ee,"stroke",n(o)),x(Ee,"stroke-width",n(m))}),q("click",Ee,Pe),q("dblclick",Ee,oe),q("mousedown",Ee,Tt),L(we,$e)},et=we=>{var $e=bt(),Ee=Re($e);{var tt=We=>{var M=vm(),Z=E(M);V(()=>{x(M,"transform",`rotate(${X()??""}, ${w()??""}, ${I()??""})`),x(Z,"cx",w()),x(Z,"cy",I()),x(Z,"rx",n(u)),x(Z,"ry",n(h)),x(Z,"fill",n(d)),x(Z,"stroke",n(o)),x(Z,"stroke-width",n(m))}),q("click",Z,Pe),q("dblclick",Z,oe),q("mousedown",Z,Tt),L(We,M)},Ct=We=>{var M=gm();V(()=>{x(M,"cx",w()),x(M,"cy",I()),x(M,"r",n(f)),x(M,"fill",n(d)),x(M,"stroke",n(o)),x(M,"stroke-width",n(m))}),q("click",M,Pe),q("dblclick",M,oe),q("mousedown",M,Tt),L(We,M)};be(Ee,We=>{n(s)?We(tt):We(Ct,!1)},!0)}L(we,$e)};be(_e,we=>{n(i)?we(Le):we(et,!1)})}var ze=A(_e);{var st=we=>{var $e=bm(),Ee=E($e);V(()=>{x($e,"x",w()),x($e,"y",I()),x($e,"font-size",n(R)),Ce(Ee,U())}),L(we,$e)};be(ze,we=>{U()&&we(st)})}var ft=A(ze);{var Lt=we=>{var $e=Tm(),Ee=Re($e),tt=A(Ee);V(()=>{x(Ee,"x1",w()),x(Ee,"y1",I()),x(Ee,"x2",n(S)),x(Ee,"y2",n(k)),x(Ee,"stroke",n(o)),x(tt,"cx",n(S)),x(tt,"cy",n(k)),x(tt,"fill",n(o)),x(tt,"stroke",se()===1?"#1d4ed8":"#b91c1c")}),q("mousedown",tt,Ge),L(we,$e)};be(ft,we=>{ye()&&(n(s)||n(i))&&we(Lt)})}var yt=A(ft);{var At=we=>{var $e=xm(),Ee=Re($e),tt=A(Ee),Ct=A(tt),We=E(Ct);V(M=>{x(Ee,"x1",(n(F),v(()=>n(F).x))),x(Ee,"y1",(n(F),v(()=>n(F).y))),x(Ee,"x2",w()),x(Ee,"y2",I()),x(tt,"cx",(n(F),v(()=>n(F).x))),x(tt,"cy",(n(F),v(()=>n(F).y))),x(Ct,"x",n(b)),x(Ct,"y",n(T)-.5),Ce(We,`${M??""}"`)},[()=>(n(C),v(()=>n(C).toFixed(2)))]),L(we,$e)};be(yt,we=>{n(re)&&n(F)&&n(C)>.1&&we(At)})}V(()=>z=hn(on,0,"model-base svelte-hycs6b",null,z,{selected:ye(),dragging:n(re)})),L(e,on),Ht()}var Sm=Ae('<ellipse fill="none" stroke-width="2"></ellipse>'),wm=Ae('<circle fill="none" stroke-width="2"></circle>'),Am=pe('<button class="palette-item svelte-1urec28"><svg class="svelte-1urec28"><!></svg> <span class="label svelte-1urec28"> </span></button>');function Ls(e,t){Yt(t,!1);const a=O(),r=O(),s=O(),i=O(),o=O(),l=O();let c=Se(t,"baseSize",8),m=Se(t,"playerId",8),d=Se(t,"onDragStart",8,()=>{});const f=3;function u(b){b.button===0&&(b.preventDefault(),d()(c(),b))}le(()=>ee(m()),()=>{_(a,m()===1?"#3b82f6":"#ef4444")}),le(()=>ee(c()),()=>{_(r,c().width!==void 0)}),le(()=>(n(r),ee(c())),()=>{_(s,n(r)?null:c().radius*f)}),le(()=>(n(r),ee(c())),()=>{_(i,n(r)?c().width/2*f:null)}),le(()=>(n(r),ee(c())),()=>{_(o,n(r)?c().height/2*f:null)}),le(()=>(n(r),ee(c())),()=>{_(l,n(r)?Math.max(c().width,c().height)*f:c().radius*2*f)}),Cn(),Kt();var h=Am(),y=E(h),g=E(y);{var p=b=>{var T=Sm();V(()=>{x(T,"cx",(n(l)+8)/2),x(T,"cy",(n(l)+8)/2),x(T,"rx",n(i)),x(T,"ry",n(o)),x(T,"stroke",n(a))}),L(b,T)},S=b=>{var T=wm();V(()=>{x(T,"cx",(n(l)+8)/2),x(T,"cy",(n(l)+8)/2),x(T,"r",n(s)),x(T,"stroke",n(a))}),L(b,T)};be(g,b=>{n(r)?b(p):b(S,!1)})}var k=A(y,2),C=E(k);V(()=>{$l(h,`border-color: ${n(a)??""}`),x(h,"title",(ee(c()),v(()=>c().label))),x(y,"width",n(l)+8),x(y,"height",n(l)+8),x(y,"viewBox",`0 0 ${n(l)+8} ${n(l)+8}`),Ce(C,(ee(c()),v(()=>c().label)))}),q("mousedown",h,u),L(e,h),Ht()}const co="warhammer-imported-armies";function Cm(){try{const e=localStorage.getItem(co);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load army imports from storage:",e),[]}}function Bs(e){try{localStorage.setItem(co,JSON.stringify(e))}catch(t){console.error("Failed to save army imports to storage:",t)}}function Em(){return"import-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Rm(){const{subscribe:e,set:t,update:a}=lt(Cm());return{subscribe:e,addImport(r,s,i,o){const l=Em(),c={id:l,name:r||"Unnamed Army",timestamp:Date.now(),rawText:s,parsedData:i,faction:i.FACTION_KEYWORD||"Unknown",totalPoints:i.TOTAL_ARMY_POINTS||"0pts",playerId:o};return a(m=>{const d=[...m,c];return Bs(d),d}),l},removeImport(r){a(s=>{const i=s.filter(o=>o.id!==r);return Bs(i),i})},getImport(r){return jt({subscribe:e}).find(i=>i.id===r)||null},clear(){t([]),Bs([])}}}const ar=Rm();var Mm=pe('<div class="error-message svelte-leqhjl"> </div>'),km=pe('<div class="success-message svelte-leqhjl"> </div>'),Dm=pe("<option> </option>"),Im=pe('<div class="army-import-panel svelte-leqhjl"><div class="form-group svelte-leqhjl"><label for="army-list-input" class="svelte-leqhjl">Paste Army List:</label> <textarea id="army-list-input" placeholder="Paste your army list here (GW App, WTC, ListForge formats supported)" rows="12" class="svelte-leqhjl"></textarea></div> <div class="button-group svelte-leqhjl"><button class="svelte-leqhjl"> </button> <button class="svelte-leqhjl">Clear</button></div> <!> <!> <div class="divider svelte-leqhjl"></div> <div class="form-group svelte-leqhjl"><label for="import-select" class="svelte-leqhjl">Load Previous Import:</label> <select id="import-select" class="svelte-leqhjl"><option>-- Select an import --</option><!></select> <button class="load-button svelte-leqhjl">Load</button></div></div>');function Lm(e,t){Yt(t,!1);const a=()=>Ze(ar,"$armyImports",r),[r,s]=za();let i=Se(t,"currentPlayer",8,1);const o=gr();let l=O(""),c=O(!1),m=O(""),d=O(""),f=O("");function u(){if(!n(l).trim()){_(m,"Please paste an army list");return}_(c,!0),_(m,""),_(d,""),o("parse",{text:n(l),playerId:i()})}function h(){if(!n(f))return;const P=ar.getImport(n(f));P&&(_(l,P.rawText),_(d,`Loaded: ${P.name} (${P.faction}, ${P.totalPoints})`),_(m,""))}function y(){_(l,""),_(m,""),_(d,"")}function g(P){_(c,P)}function p(P){_(m,P),_(d,""),_(c,!1)}function S(P){_(d,P),_(m,""),_(c,!1)}function k(){_(l,"")}var C={setLoading:g,setError:p,setSuccess:S,clearText:k};Kt();var b=Im(),T=E(b),R=A(E(T),2),N=A(T,2),w=E(N),I=E(w),W=A(w,2),se=A(N,2);{var X=P=>{var Y=Mm(),ne=E(Y);V(()=>Ce(ne,`â ï¸ ${n(m)??""}`)),L(P,Y)};be(se,P=>{n(m)&&P(X)})}var ye=A(se,2);{var ce=P=>{var Y=km(),ne=E(Y);V(()=>Ce(ne,`â ${n(d)??""}`)),L(P,Y)};be(ye,P=>{n(d)&&P(ce)})}var U=A(ye,4),B=A(E(U),2);V(()=>{n(f),Ii(()=>{n(c),a()})});var te=E(B);te.value=te.__value="";var G=A(te);Me(G,1,a,P=>P.id,(P,Y)=>{var ne=Dm(),H=E(ne),re={};V(()=>{Ce(H,`${n(Y),v(()=>n(Y).name)??""} (${n(Y),v(()=>n(Y).faction)??""}, ${n(Y),v(()=>n(Y).totalPoints)??""})`),re!==(re=(n(Y),v(()=>n(Y).id)))&&(ne.value=(ne.__value=(n(Y),v(()=>n(Y).id)))??"")}),L(P,ne)});var J=A(B,2);V(P=>{R.disabled=n(c),w.disabled=P,Ce(I,n(c)?"Parsing...":"Parse Army List"),W.disabled=n(c),B.disabled=n(c),J.disabled=n(c)||!n(f)},[()=>(n(c),n(l),v(()=>n(c)||!n(l).trim()))]),Pt(R,()=>n(l),P=>_(l,P)),q("click",w,u),q("click",W,y),qi(B,()=>n(f),P=>_(f,P)),q("click",J,h),L(e,b),Za(t,"setLoading",g),Za(t,"setError",p),Za(t,"setSuccess",S),Za(t,"clearText",k);var $=Ht(C);return s(),$}var Nm=pe("<option> </option>"),Pm=pe('<tr><td class="unit-name svelte-1xyf33v"> </td><td class="quantity svelte-1xyf33v"> </td><td class="svelte-1xyf33v"><select class="svelte-1xyf33v"></select></td><td class="skip-cell svelte-1xyf33v"><input type="checkbox" class="svelte-1xyf33v"/></td></tr>'),$m=pe('<div class="dialog-overlay svelte-1xyf33v"><div class="dialog svelte-1xyf33v"><div class="dialog-header svelte-1xyf33v"><h3 class="svelte-1xyf33v">Unmatched Units</h3> <button class="close-button svelte-1xyf33v">&times;</button></div> <div class="dialog-content svelte-1xyf33v"><p class="info-text svelte-1xyf33v">The following units were not found in the database. Please select base sizes or skip them:</p> <div class="units-table svelte-1xyf33v"><table class="svelte-1xyf33v"><thead class="svelte-1xyf33v"><tr><th class="svelte-1xyf33v">Unit Name</th><th class="svelte-1xyf33v">Quantity</th><th class="svelte-1xyf33v">Base Size</th><th class="svelte-1xyf33v">Skip</th></tr></thead><tbody></tbody></table></div></div> <div class="dialog-footer svelte-1xyf33v"><button class="cancel-button svelte-1xyf33v">Cancel</button> <button class="import-button svelte-1xyf33v">Import Selected</button></div></div></div>');function Om(e,t){Yt(t,!1);let a=Se(t,"unmatchedUnits",24,()=>[]),r=Se(t,"show",12,!1);const s=gr();let i=O({});const o=[...Xt.circles.map(u=>({value:u.type,label:u.label})),...Xt.ovals.map(u=>({value:u.type,label:u.label})),{value:"rect-custom",label:"Custom Rectangle (Vehicle)"}];function l(){const u=a().filter(h=>!n(i)[h.id]?.skip).map(h=>({unitName:h.unitName,quantity:h.quantity,baseType:n(i)[h.id]?.baseType||"32mm"}));s("import",{selected:u}),c()}function c(){r(!1),s("close")}le(()=>ee(a()),()=>{_(i,{}),a().forEach(u=>{Ys(i,n(i)[u.id]={baseType:"32mm",skip:!1})})}),Cn(),Kt();var m=bt(),d=Re(m);{var f=u=>{var h=$m(),y=E(h),g=E(y),p=A(E(g),2),S=A(g,2),k=A(E(S),2),C=E(k),b=A(E(C));Me(b,5,a,w=>w.id,(w,I)=>{var W=Pm();let se;var X=E(W),ye=E(X),ce=A(X),U=E(ce),B=A(ce),te=E(B);V(()=>{n(i),Ii(()=>{n(I)})}),Me(te,5,()=>o,Be,($,P)=>{var Y=Nm(),ne=E(Y),H={};V(()=>{Ce(ne,(n(P),v(()=>n(P).label))),H!==(H=(n(P),v(()=>n(P).value)))&&(Y.value=(Y.__value=(n(P),v(()=>n(P).value)))??"")}),L($,Y)});var G=A(B),J=E(G);V(()=>{se=hn(W,1,"svelte-1xyf33v",null,se,{skipped:n(i)[n(I).id]?.skip}),Ce(ye,(n(I),v(()=>n(I).unitName))),Ce(U,(n(I),v(()=>n(I).quantity||"1x"))),te.disabled=(n(i),n(I),v(()=>n(i)[n(I).id]?.skip))}),qi(te,()=>n(i)[n(I).id].baseType,$=>Ys(i,n(i)[n(I).id].baseType=$)),La(J,()=>n(i)[n(I).id].skip,$=>Ys(i,n(i)[n(I).id].skip=$)),L(w,W)});var T=A(S,2),R=E(T),N=A(R,2);q("click",p,c),q("click",R,c),q("click",N,l),q("click",y,w=>w.stopPropagation()),q("click",h,c),L(u,h)};be(d,u=>{r()&&u(f)})}L(e,m),Ht()}const an=lt([]),ta=lt([]);function Gr(e,t){const a={};e.forEach(s=>{const i=s.unitId||"ungrouped";a[i]||(a[i]=[]),a[i].push(s)});const r=[];for(const s in a){const i=a[s],o=i[0];r.push({id:s,name:o.unitName||"Unknown Unit",playerId:o.playerId,modelIds:i.map(l=>l.id),importId:t})}an.update(s=>[...s,...e]),ta.update(s=>[...s,...r])}function Wm(e){const a=jt(ta).find(r=>r.id===e);a&&(an.update(r=>r.filter(s=>!a.modelIds.includes(s.id))),ta.update(r=>r.filter(s=>s.id!==e)))}function Ym(e,t=30,a=22){const s=jt(an).filter(c=>e.includes(c.id));if(s.length===0)return;const i=2;let o=0,l=0;s.forEach((c,m)=>{const d={...c,x:t+o,y:a+l,inStaging:!1};ot.update(f=>[...f,d]),o+=i,(m+1)%5===0&&(o=0,l+=i)}),an.update(c=>c.filter(m=>!e.includes(m.id))),ta.update(c=>c.map(m=>({...m,modelIds:m.modelIds.filter(d=>!e.includes(d))})).filter(m=>m.modelIds.length>0))}function Hm(){an.set([]),ta.set([])}Qt(an,e=>e.filter(t=>t.playerId===1));Qt(an,e=>e.filter(t=>t.playerId===2));Qt(ta,e=>e.filter(t=>t.playerId===1));Qt(ta,e=>e.filter(t=>t.playerId===2));var Fm=Ae('<g class="unit-group"><rect fill="none" stroke-dasharray="0.3 0.2" opacity="0.6" cursor="pointer"></rect><text text-anchor="middle" font-size="0.5" font-weight="600" pointer-events="none"> </text><g class="remove-button svelte-1lpiqbg" cursor="pointer"><circle r="0.25" fill="#dc3545" opacity="0.8" class="svelte-1lpiqbg"></circle><line stroke="white" stroke-width="0.08"></line><line stroke="white" stroke-width="0.08"></line></g></g>');function Bm(e,t){Yt(t,!1);const a=O(),r=O(),s=O(),i=O();let o=Se(t,"unit",8),l=Se(t,"models",24,()=>[]),c=Se(t,"selected",8,!1),m=Se(t,"onclick",8,()=>{}),d=Se(t,"onremove",8,()=>{});function f(g){if(g.length===0)return{minX:0,minY:0,maxX:0,maxY:0,width:0,height:0};const p=g.map(T=>({x:T.x,y:T.y})),S=Math.min(...p.map(T=>T.x))-.5,k=Math.min(...p.map(T=>T.y))-.5,C=Math.max(...p.map(T=>T.x))+.5,b=Math.max(...p.map(T=>T.y))+.5;return{minX:S,minY:k,maxX:C,maxY:b,width:C-S,height:b-k}}le(()=>(ee(l()),ee(o())),()=>{_(a,l().filter(g=>o().modelIds.includes(g.id)))}),le(()=>n(a),()=>{_(r,f(n(a)))}),le(()=>n(r),()=>{_(s,n(r).minX+n(r).width/2)}),le(()=>n(r),()=>{_(i,n(r).minY-.3)}),Cn(),Kt();var u=bt(),h=Re(u);{var y=g=>{var p=Fm(),S=E(p),k=A(S),C=E(k),b=A(k),T=E(b),R=A(T),N=A(R);V(()=>{x(S,"x",(n(r),v(()=>n(r).minX))),x(S,"y",(n(r),v(()=>n(r).minY))),x(S,"width",(n(r),v(()=>n(r).width))),x(S,"height",(n(r),v(()=>n(r).height))),x(S,"stroke",c()?"#ffc107":"#adb5bd"),x(S,"stroke-width",c()?"0.15":"0.08"),x(k,"x",n(s)),x(k,"y",n(i)),x(k,"fill",c()?"#333":"#6c757d"),Ce(C,`${ee(o()),v(()=>o().name)??""} (${n(a),v(()=>n(a).length)??""})`),x(T,"cx",(n(r),v(()=>n(r).maxX-.3))),x(T,"cy",(n(r),v(()=>n(r).minY+.3))),x(R,"x1",(n(r),v(()=>n(r).maxX-.4))),x(R,"y1",(n(r),v(()=>n(r).minY+.2))),x(R,"x2",(n(r),v(()=>n(r).maxX-.2))),x(R,"y2",(n(r),v(()=>n(r).minY+.4))),x(N,"x1",(n(r),v(()=>n(r).maxX-.2))),x(N,"y1",(n(r),v(()=>n(r).minY+.2))),x(N,"x2",(n(r),v(()=>n(r).maxX-.4))),x(N,"y2",(n(r),v(()=>n(r).minY+.4)))}),q("click",S,function(...w){m()?.apply(this,w)}),q("click",b,w=>{w.stopPropagation(),d()()}),L(g,p)};be(h,g=>{n(a),v(()=>n(a).length>0)&&g(y)})}L(e,u),Ht()}var qm=Ae('<line y1="0" y2="60" stroke="#2a2a2a" stroke-width="0.05"></line>'),Um=Ae('<line x1="0" x2="30" stroke="#2a2a2a" stroke-width="0.05"></line>'),Km=Ae('<text text-anchor="middle" font-size="0.4" fill="#6c757d" font-weight="600" pointer-events="none">STAGING</text>'),Gm=Ae("<!><!>",1),zm=Ae('<text x="15" y="30" text-anchor="middle" font-size="0.8" fill="#666">No models in staging</text>'),jm=pe('<div class="staging-area svelte-cjtwzf"><div class="staging-header svelte-cjtwzf"><h3 class="svelte-cjtwzf">Staging Area</h3> <div class="button-group svelte-cjtwzf"><button class="svelte-cjtwzf"> </button> <button class="svelte-cjtwzf"> </button> <button class="clear-button svelte-cjtwzf">Clear</button></div></div> <div class="staging-canvas svelte-cjtwzf"><svg viewBox="0 0 30 60" class="staging-svg svelte-cjtwzf"><rect x="0" y="0" width="30" height="60" fill="#1a1a1a" stroke="#444" stroke-width="0.1"></rect><!><!><!><!><!></svg></div></div>');function Xm(e,t){Yt(t,!1);const a=()=>Ze(an,"$stagingModels",s),r=()=>Ze(ta,"$stagingUnits",s),[s,i]=za(),o=gr();let l=O(new Set),c=O();function m(P,Y){if(!n(c))return{x:0,y:0};const ne=n(c).createSVGPoint();ne.x=P,ne.y=Y;const H=ne.matrixTransform(n(c).getScreenCTM().inverse());return{x:H.x,y:H.y}}function d(P){_(l,new Set([P]))}function f(P,Y,ne){an.update(H=>H.map(re=>re.id===P?{...re,x:Y,y:ne}:re))}function u(P){}function h(P,Y){an.update(ne=>ne.map(H=>H.id===P?{...H,rotation:Y}:H))}function y(P){}function g(P,Y){an.update(ne=>ne.map(H=>H.id===P?{...H,unitName:Y}:H))}function p(){o("deploy",{modelIds:a().map(P=>P.id)})}function S(){o("deploy",{modelIds:Array.from(n(l))})}function k(){confirm("Clear all models from staging area?")&&(Hm(),o("clear"))}function C(P){confirm("Remove this unit from staging?")&&Wm(P)}function b(P){const Y=r().find(ne=>ne.id===P);Y&&_(l,new Set(Y.modelIds))}Kt();var T=jm(),R=E(T),N=A(E(R),2),w=E(N),I=E(w),W=A(w,2),se=E(W),X=A(W,2),ye=A(R,2),ce=E(ye),U=A(E(ce));Me(U,0,()=>Array(16),Be,(P,Y,ne)=>{var H=qm();x(H,"x1",ne*2),x(H,"x2",ne*2),L(P,H)});var B=A(U);Me(B,0,()=>Array(31),Be,(P,Y,ne)=>{var H=Um();x(H,"y1",ne*2),x(H,"y2",ne*2),L(P,H)});var te=A(B);Me(te,1,r,P=>P.id,(P,Y)=>{{let ne=Xe(()=>n(Y).modelIds.every(H=>n(l).has(H)));Bm(P,{get unit(){return n(Y)},get models(){return a()},get selected(){return n(ne)},onclick:()=>b(n(Y).id),onremove:()=>C(n(Y).id)})}});var G=A(te);Me(G,1,a,P=>P.id,(P,Y)=>{var ne=Gm(),H=Re(ne);{let qe=Xe(()=>n(Y).name||n(Y).unitName),F=Xe(()=>n(l).has(n(Y).id));ms(H,{get id(){return n(Y).id},get x(){return n(Y).x},get y(){return n(Y).y},get baseType(){return n(Y).baseType},get playerId(){return n(Y).playerId},get rotation(){return n(Y).rotation},get name(){return n(qe)},get customWidth(){return n(Y).customWidth},get customHeight(){return n(Y).customHeight},get selected(){return n(F)},screenToSvg:m,onSelect:d,onDrag:f,onDragEnd:u,onRotate:h,onRotateEnd:y,onRename:g})}var re=A(H);{var ke=qe=>{var F=Km();V(()=>{x(F,"x",n(Y).x),x(F,"y",n(Y).y-1)}),L(qe,F)};be(re,qe=>{n(Y).inStaging&&qe(ke)})}L(P,ne)});var J=A(G);{var $=P=>{var Y=zm();L(P,Y)};be(J,P=>{a().length===0&&P($)})}ls(ce,P=>_(c,P),()=>n(c)),V(()=>{w.disabled=n(l).size===0,Ce(I,`Deploy Selected (${n(l).size??""})`),W.disabled=a().length===0,Ce(se,`Deploy All (${a().length??""})`),X.disabled=a().length===0}),q("click",w,S),q("click",W,p),q("click",X,k),L(e,T),Ht(),i()}function Zn(e){const t=e.match(/^\s*/);return t?t[0].length:0}function j(e){return e?e.toLowerCase().replace(/\s+/g," ").trim():""}function na(e){const t=/^(?:(\d+)x?\s+)?(.*)/,a=e.trim().match(t);if(a){const r=a[1]?`${a[1]}x`:"1x";let s=a[2].trim();return s=s.replace(/^with\s+/i,"").trim(),{quantity:r,name:s}}return{quantity:"1x",name:e.trim()}}function fn(e){return Array.isArray(e)&&e.sort((t,a)=>{const r=parseInt(String(t&&t.quantity||"1x").replace(/x/i,""),10)||1,s=parseInt(String(a&&a.quantity||"1x").replace(/x/i,""),10)||1;if(r!==s)return s-r;const i=t&&t.name?t.name.toString().toLowerCase():"",o=a&&a.name?a.name.toString().toLowerCase():"";return i<o?-1:i>o?1:0}),e}const _n={"World Eaters":"Chaos","Chaos Space Marines":"Chaos","Emperor's Children":"Chaos","Death Guard":"Chaos","Chaos Daemons":"Chaos","Chaos Knights":"Chaos","Thousand Sons":"Chaos","Space Marines":"Imperium","Iron Hands":"Space Marines",Salamanders:"Space Marines","Space Wolves":"Space Marines",Ultramarines:"Space Marines","White Scars":"Space Marines","Adepta Sororitas":"Imperium","Astra Militarum":"Imperium","Imperial Fists":"Space Marines","Dark Angels":"Space Marines","Blood Angels":"Space Marines","Raven Guard":"Space Marines","Black Templars":"Space Marines",Deathwatch:"Space Marines","Grey Knights":"Imperium","Imperial Knights":"Imperium","Adeptus Custodes":"Imperium","Adeptus Titanicus":"Imperium","Adeptus Mechanicus":"Imperium","Agents of the Imperium":"Imperium",Aeldari:"Xenos",Drukhari:"Xenos",Ynnari:"Xenos",Harlequins:"Xenos",Necrons:"Xenos",Orks:"Xenos",Tyranids:"Xenos","T'au Empire":"Xenos",Tau:"Xenos","T'au":"Xenos","Genestealer Cults":"Xenos","Leagues of Votann":"Xenos"};function wa(e){if(!e)return e;e.SUMMARY=e.SUMMARY||{};const t=e.SUMMARY;t.LIST_TITLE=t.LIST_TITLE||"",t.FACTION_KEYWORD&&(t.FACTION_KEYWORD=String(t.FACTION_KEYWORD).trim()),t.DETACHMENT&&(t.DETACHMENT=String(t.DETACHMENT).replace(/\u00A0/g," ").trim()),t.TOTAL_ARMY_POINTS&&(t.TOTAL_ARMY_POINTS=String(t.TOTAL_ARMY_POINTS).trim());const a=s=>{if(!s)return"";try{return s.toString().normalize("NFD").replace(new RegExp("\\p{M}","gu"),"").replace(/[\u2018\u2019\u201B\u2032]/g,"'").replace(/[^\w\s'\-]/g,"").toLowerCase().trim()}catch{return s.toString().toLowerCase().trim()}},r=t.FACTION_KEYWORD||null;if(r){const s=a(r);let i;for(const o of Object.keys(_n))if(a(o)===s){i=o;break}if(i){const o=r.toString().replace(/[\u2018\u2019\u201B\u2032]/g,"'").trim();t.DISPLAY_FACTION=`${_n[i]} - ${o}`}else t.DISPLAY_FACTION=t.DISPLAY_FACTION||r+(t.DETACHMENT?` - ${t.DETACHMENT}`:"")}else t.DETACHMENT?t.DISPLAY_FACTION=t.DISPLAY_FACTION||t.DETACHMENT:t.DISPLAY_FACTION=t.DISPLAY_FACTION||"";if(!t.FACTION_KEY){if(t.FACTION_KEYWORD)try{t.FACTION_KEY=t.FACTION_KEYWORD.toString().toLowerCase()}catch{t.FACTION_KEY=String(t.FACTION_KEYWORD).toLowerCase()}else if(t.DISPLAY_FACTION){const s=(t.DISPLAY_FACTION||"").split(" - ")[0];try{t.FACTION_KEY=s.toString().toLowerCase()}catch{t.FACTION_KEY=String(s).toLowerCase()}}}return e}function ma(e,t,a,r,s="",i=!1,o="wargear"){if(!e)return;e.items=e.items||[];const l=na(String(t||"").trim()),c=l.quantity?String(l.quantity):"1x",m=l.name||"",d=j(m);if(i){const u=String(a||""),h=String(s||"");if(j(u)===j(m)||h&&j(h)===j(m))return}const f=e.items.find(u=>j(u.name||"")===d);if(f){const u=parseInt(String(f.quantity||"1x").replace(/x/i,""),10)||0,h=parseInt(String(c||"1x").replace(/x/i,""),10)||0;f.quantity=`${u+h}x`}else{const u=j(m)==="warlord"?"special":o;e.items.push({quantity:c,name:m,items:[],type:u,nameshort:""})}}function Vm(e,t){if(!e||!t)return;t.items=t.items||[];const a=e.trim(),r=a.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),o=j(i);if((t.items||[]).some(f=>f&&f.type==="special"&&j((f.name||"").replace(/^Enhancement:\s*/i,""))===o))return;const m=`E: ${i.split(/\s+/).map(f=>f[0]?f[0].toUpperCase():"").join("")}${s}`.trim(),d={quantity:"1x",name:`Enhancement: ${i}`,nameshort:m,items:[],type:"special"};t.items.push(d)}function Qm(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(e))return t;const a=[];let r=0;const s=f=>/^(\d+)x?\s+/i.test(String(f||"").trim()),i=(f,u)=>{const h=String(f||"").trim();if(!h)return h;if(s(h)){const y=h.match(/^(\d+)x?\s+(.*)$/i);if(y){const g=parseInt(y[1],10)||1,p=y[2].trim();return`${Math.max(1,g*(parseInt(u,10)||1))}x ${p}`}return h}return`${u}x ${h}`};for(;r<e.length;r++){const u=(e[r]||"").trim();if(u){if(u.startsWith("+")||u.startsWith("&")){a.push(u);continue}break}}for(const f of a){if(f.startsWith("&")){const g=f.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);g&&(g[1].trim(),(g[3]||"").trim());continue}const h=f.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(h){const y=h[1].trim().toUpperCase(),g=h[2].trim();if(y==="FACTION KEYWORD"){const p=g.split(" - ");t.SUMMARY.FACTION_KEYWORD=p[p.length-1].trim()}else y==="DETACHMENT"?t.SUMMARY.DETACHMENT=g.replace(/\u00A0/g," "):y==="TOTAL ARMY POINTS"&&(t.SUMMARY.TOTAL_ARMY_POINTS=g)}}if(t.SUMMARY.LIST_TITLE="",t.SUMMARY&&t.SUMMARY.FACTION_KEYWORD){const f=t.SUMMARY.FACTION_KEYWORD,u=Object.keys(_n).find(y=>y.toLowerCase()===(f||"").toString().toLowerCase()),h=u?_n[u]:null;h?t.SUMMARY.DISPLAY_FACTION=`${h} - ${f}`:t.SUMMARY.DISPLAY_FACTION=f+(t.SUMMARY.DETACHMENT?` - ${t.SUMMARY.DETACHMENT}`:"");try{t.SUMMARY.FACTION_KEY=f.toString().toLowerCase()}catch{}}let o=null,l=null;const c=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,m=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;for(;r<e.length;r++){const f=e[r]||"",u=f.trim();if(!u)continue;if(/^Enhancement:\s*/i.test(u)){const S=u.replace(/^Enhancement:\s*/i,"").trim();l&&Vm(S,l);continue}const h=u.match(c);if(h){const S=h[1],k=h[2]?`${h[2]}x`:"1x",C=(h[3]||"").trim(),b=parseInt(h[4],10)||0,T=h[5],R={quantity:k,name:C,points:b,items:[],isComplex:!1,nameshort:""};S?(t.CHARACTER.push(R),l=R):(t["OTHER DATASHEETS"]=t["OTHER DATASHEETS"]||[],t["OTHER DATASHEETS"].push(R)),o=R,T&&T.split(",").map(N=>N.trim()).filter(Boolean).forEach(N=>ma(R,N,R.name,t.SUMMARY.FACTION_KEYWORD||"",R.name,!0));continue}const y=f.match(m);if(y){const S=y[1].trim(),k=S.match(/^(\d+)\s+with\s+(.*)$/i);if(k&&o){const T=parseInt(k[1],10)||1,R=k[2],N=o.items&&o.items.length>0?o.items[o.items.length-1]:o;R.split(",").map(w=>w.trim()).filter(Boolean).forEach(w=>{const I=i(w,T);ma(N,I,N.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const C=S.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(C&&o){const T=C[1],R=C[2].trim(),N=C[3]||"",w={quantity:T,name:R,items:[],type:"subunit"};if(o.items=o.items||[],o.items.push(w),N){const I=N.match(/^(\d+)\s+with\s+(.*)$/i);if(I){const W=parseInt(I[1],10)||1;I[2].split(",").map(X=>X.trim()).filter(Boolean).forEach(X=>{const ye=i(X,W);ma(w,ye,w.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)})}else N.split(",").map(W=>W.trim()).filter(Boolean).forEach(W=>ma(w,W,w.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0))}continue}const b=S.match(/^(\d+x?)\s+(.*)$/i);if(b&&o){const T={quantity:b[1],name:b[2].trim(),items:[],type:"subunit"};o.items=o.items||[],o.items.push(T);continue}if(o){ma(o,S,o.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0);continue}continue}const g=u.match(/^(\d+)\s+with\s+(.*)$/i);if(g&&o){const S=parseInt(g[1],10)||1,k=g[2],C=o.items&&o.items.length>0?o.items[o.items.length-1]:o;k.split(",").map(b=>b.trim()).filter(Boolean).forEach(b=>{const T=i(b,S);ma(C,T,C.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const p=u.match(/^(.*?):\s*(.*)$/);if(p&&o){(p[2]||"").split(",").map(k=>k.trim()).filter(Boolean).forEach(k=>ma(o,k,o.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0));continue}}const d=[...t.CHARACTER||[],...t["OTHER DATASHEETS"]||[]];for(const f of d){f&&Array.isArray(f.items)&&f.items.length>0&&fn(f.items);const u=f&&Array.isArray(f.items)?f.items.filter(h=>h&&h.type==="subunit"):[];for(const h of u)h&&Array.isArray(h.items)&&h.items.length>0&&fn(h.items)}return wa(t),t}function cn(e,t,a,r,s="",i=!1,o="wargear"){if(!e)return;e.items=e.items||[];const l=String(t||"").trim();if(/battlesuit support system|homing beacon|marker drone/i.test(l))try{zt.push(`processing raw=${l} for target=${e&&e.name}`)}catch{}let c=l.split(",").map(b=>b.trim()).filter(Boolean);try{const b=new Set;c=c.filter(T=>{const R=j(Pa(In(T)));return b.has(R)?!1:(b.add(R),!0)})}catch{}try{/stealth shas'vre|stealth battlesuits/i.test((e&&e.name||"")+(s||"")+l)&&zt.push(`splitParts target=${e&&e.name} top=${s} parts=${JSON.stringify(c)}`)}catch{}if(c.length>1){c.forEach(b=>cn(e,b,a,r,s,i,o));return}const m=na(l),d=m.quantity!==void 0&&m.quantity!==null;let f=d?String(m.quantity):"1x",u=m.name||"";try{u=Pa(In(u))}catch{}const h=/battlesuit support system|homing beacon|marker drone/i;try{const b=u.toLowerCase();if(b.includes("battlesuit support system")||b.includes("homing beacon")||b.includes("marker drone"))try{zt.push(`addItemToTarget target=${e&&e.name} raw=${l}`)}catch{}}catch{}const y=u.match(/^(\d+)x\s+(.*)$/i);if(y){const b=parseInt(y[1],10)||1,T=parseInt(String(f||"1x").replace(/x/i,""),10)||1;f=`${Math.max(1,T*b)}x`,u=y[2]}try{zt.push(`PARSE_QTY name=${u} parsedQtyRaw=${String(m.quantity||"")} qtyToken=${f}`)}catch{}let g=(b=>isNaN(b)?1:b)(parseInt(String(f||"1x").replace(/x/i,""),10)),p=g;try{if(e&&e.type==="subunit"){const b=parseInt(String(e.quantity||"1x").replace(/[^0-9]/g,""),10)||1;try{zt.push(`CALC_EFFECTIVE target=${e&&e.name} parentQty=${b} parsedQty=${g} hasExplicit=${d}`)}catch{}p=d?g:b;try{zt.push(`EFFECTIVE_QTY target=${e&&e.name} effectiveQty=${p}`)}catch{}}}catch{}const S=u,k=j(u);if(i){const b=String(a||""),T=String(s||"");if(j(b)===j(u)||T&&j(T)===j(u)){if(h.test(u))try{zt.push(`SKIP matched unitname name=${u} ctx=${b} top=${T}`)}catch{}return}}const C=e.items.find(b=>j(b.name||"")===k);if(C){const b=parseInt(String(C.quantity||"1x").replace(/x/i,""),10)||0,T=b+p;C.quantity=`${T}x`;try{zt.push(`UPDATED existing name=${u} existing=${b} added=${p} new=${T} target=${e&&e.name}`)}catch{}}else{const b=j(u)==="warlord"?"special":o;e.items.push({quantity:`${p}x`,name:S,items:[],type:b,nameshort:""});try{zt.push(`PUSHED new name=${u} quantity=${p} target=${e&&e.name}`)}catch{}}}function In(e){if(!e)return e;const t=e.toLowerCase();return t.includes("shield")&&t.includes("drone")?"Shield Drone":t.includes("marker")&&t.includes("drone")?"Marker Drone":t.includes("marker")&&t.includes("beacon")?"Homing Beacon":e}function Pa(e){return e&&e.split(/\s+/).map(t=>!t||/[A-Z]/.test(t.slice(1))?t:t[0].toUpperCase()+t.slice(1).toLowerCase()).join(" ")}function zr(e,t){if(!t)return`${e}x`;const a=String(t).trim(),r=a.match(/^(\d+)x\s+(.*)$/i);if(r){const s=parseInt(r[1],10)||1,i=r[2]||"";return`${Math.max(1,e*s)}x ${i}`}return`${e}x ${a}`}function Jm(e,t){if(!e||!t)return;t.items=t.items||[];const a=e.trim(),r=a.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),o=j(i);if((t.items||[]).some(f=>{if(!f||!f.name)return!1;const u=String(f.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]+\)$/,"").trim();return j(u)===o}))return;const m=`E: ${i.split(/\s+/).map(f=>f[0]?f[0].toUpperCase():"").join("")}${s}`.trim(),d={quantity:"1x",name:`Enhancement: ${i}`,nameshort:m,items:[],type:"special"};t.items.push(d)}function Zm(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(e))return t;const a=[];let r=0;for(;r<e.length;r++){const d=(e[r]||"").trim();if(d){if(d.startsWith("+")){a.push(d);continue}if(!d.startsWith("&"))break}}for(const m of a){const f=m.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(f){const u=f[1].trim().toUpperCase(),h=f[2].trim();if(u==="FACTION KEYWORD"){const y=h.split(" - ");t.SUMMARY.FACTION_KEYWORD=y[y.length-1].trim()}else u==="DETACHMENT"?t.SUMMARY.DETACHMENT=h.replace(/\u00A0/g," "):u==="TOTAL ARMY POINTS"&&(t.SUMMARY.TOTAL_ARMY_POINTS=h)}}if(t.SUMMARY.LIST_TITLE="",t.SUMMARY&&t.SUMMARY.FACTION_KEYWORD){const m=t.SUMMARY.FACTION_KEYWORD,d=Object.keys(_n).find(u=>u.toLowerCase()===(m||"").toString().toLowerCase()),f=d?_n[d]:null;f?t.SUMMARY.DISPLAY_FACTION=`${f} - ${m}`:t.SUMMARY.DISPLAY_FACTION=m+(t.SUMMARY.DETACHMENT?` - ${t.SUMMARY.DETACHMENT}`:"");try{t.SUMMARY.FACTION_KEY=m.toString().toLowerCase()}catch{}}const s=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,i=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;let o=null,l=null;for(;r<e.length;r++){const m=e[r]||"",d=m.trim();if(!d)continue;if(/^Enhancement:\s*/i.test(d)){const g=d.replace(/^Enhancement:\s*/i,"").trim();l&&Jm(g,l);continue}const f=d.match(s);if(f){const g=f[1],p=f[2]?`${f[2]}x`:"1x",S=(f[3]||"").trim(),k=parseInt(f[4],10)||0,C=f[5],b={quantity:p,name:S,points:k,items:[],isComplex:!1,nameshort:"",charId:g||null};g?(t.CHARACTER.push(b),l=b):(t["OTHER DATASHEETS"]=t["OTHER DATASHEETS"]||[],t["OTHER DATASHEETS"].push(b)),o=b,C&&C.split(",").map(T=>T.trim()).filter(Boolean).forEach(T=>cn(b,T,b.name,t.SUMMARY.FACTION_KEYWORD||"",b.name,!0));continue}const u=m.match(i);if(u){const g=u[1].trim(),p=g.match(/^(\d+)\s+with\s+(.*)$/i);if(p&&o){const C=parseInt(p[1],10)||1,b=p[2],T=o.items&&o.items.length>0?o.items[o.items.length-1]:o;try{zt.push(`WITHMATCH unit=${o.name} target=${T&&T.name} n=${C} rest=${b}`)}catch{}b.split(",").map(R=>R.trim()).filter(Boolean).forEach(R=>{const w=Pa(In(R));if(T&&T.type==="subunit"){try{zt.push(`WITH->SUB target=${T.name} item=${w} n=${C}`)}catch{}cn(T,`${C}x ${w}`,T.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}else{try{zt.push(`WITH->UNIT unit=${o.name} item=${w} n=${C}`)}catch{}cn(T,zr(C,w),T.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}});continue}const S=g.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(S&&o){const C=S[1],b=S[2].trim(),T=S[3]||"",R={quantity:C,name:b,items:[],type:"subunit",_parent:o};if(o.items=o.items||[],o.items.push(R),T){const N=T.match(/^(\d+)\s+with\s+(.*)$/i);N?N[2].split(",").map(I=>I.trim()).filter(Boolean).forEach(I=>{const W=In(I);cn(R,W,R.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}):T.split(",").map(w=>w.trim()).filter(Boolean).forEach(w=>{const I=In(w);cn(R,I,R.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)})}continue}const k=g.match(/^(\d+x?)\s+(.*)$/i);if(k&&o)if(o.charId){const C=k[1],b=k[2].trim();cn(o,`${C} ${b}`,o.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0);continue}else{const C={quantity:k[1],name:k[2].trim(),items:[],type:"subunit",_parent:o};o.items=o.items||[],o.items.push(C);continue}if(o){let C=g.split(",").map(T=>T.trim()).filter(Boolean);try{const T=o.items&&o.items.length>0?o.items[o.items.length-1]:null;T&&T.name&&(C=C.map(R=>{const N=R.match(/^(.*)\s*\(([^)]+)\)\s*$/);if(N){const w=N[1].trim();if(j(w)===j(T.name))return w}return R}))}catch{}try{const T=new Set;C=C.filter(R=>{const N=j(Pa(In(R)));return T.has(N)?!1:(T.add(N),!0)})}catch{}let b=o;if(o.items&&o.items.length>0){const T=o.items[o.items.length-1];T&&T.type==="subunit"&&(b=T)}C.forEach(T=>{const R=Pa(In(T));cn(b,R,b.name||o.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}continue}const h=d.match(/^(\d+)\s+with\s+(.*)$/i);if(h&&o){const g=parseInt(h[1],10)||1,p=h[2],S=o.items&&o.items.length>0?o.items[o.items.length-1]:o;p.split(",").map(k=>k.trim()).filter(Boolean).forEach(k=>{const b=Pa(In(k));S&&S.type==="subunit"?cn(S,`${g}x ${b}`,S.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0):cn(S,zr(g,b),S.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const y=d.match(/^(.*?):\s*(.*)$/);if(y&&o){(y[2]||"").split(",").map(p=>p.trim()).filter(Boolean).forEach(p=>{const S=In(p);cn(o,S,o.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}}const c=[...t.CHARACTER||[],...t["OTHER DATASHEETS"]||[]];for(const m of c){m&&Array.isArray(m.items)&&m.items.length>0&&fn(m.items);const d=m&&Array.isArray(m.items)?m.items.filter(f=>f&&f.type==="subunit"):[];for(const f of d)f&&Array.isArray(f.items)&&f.items.length>0&&fn(f.items)}wa(t);try{t.SUMMARY._parseDebug=(zt||[]).slice(0,200)}catch{}return t}const zt=[];function As(e){const t=Zn(e);if(t>0)return t;const a=(e||"").trim();return a.startsWith("â¦")||a.startsWith("+")?2:0}function Cs(e){if(!e)return"";const t=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(e).split(/\s+/).map((a,r)=>{if(!a)return"";const s=a.toLowerCase();return r>0&&t.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function Ra(e,t,a,r,s="",i=!1,o="wargear",l=1){if(!e)return;e.items=e.items||[];const c=na(String(t||"").trim()),m=c.quantity?String(c.quantity):"1x",d=c.name||"",f=j(d);if(i){const h=String(a||""),y=String(s||"");if(j(h)===j(d)||y&&j(y)===j(d))return}const u=e.items.find(h=>j(h.name||"")===f);if(u){const h=parseInt(String(u.quantity||"1x").replace(/x/i,""),10)||0,y=parseInt(String(m||"1x").replace(/x/i,""),10)||0;u.quantity=`${h+y}x`}else{const h=j(d)==="warlord"?"special":o;e.items.push({quantity:m,name:d,items:[],type:h,nameshort:""})}}function jr(e,t,a){if(!e||!t)return;t.items=t.items||[];const r=e.trim(),s=r.match(/\(([^)]+)\)$/),i=s?` (${s[1]})`:"",o=r.replace(/\s*\([^)]+\)$/,"").trim(),l=j(o);if((t.items||[]).some(u=>u&&u.type==="special"&&j((u.name||"").replace(/^Enhancement:\s*/i,""))===l))return;const d=`E: ${o.split(/\s+/).map(u=>u[0]?u[0].toUpperCase():"").join("")}${i}`.trim(),f={quantity:"1x",name:`Enhancement: ${o}`,nameshort:d,items:[],type:"special"};t.items.push(f)}function eu(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=e.findIndex(u=>a.test((u||"").trim().toUpperCase()));let i=(r===-1?e.slice(0,0):e.slice(0,r)).map(u=>(u||"").trim()).filter(u=>u&&!u.startsWith("Exported with"));const o=i.findIndex(u=>u&&u.trim()!=="");if(o!==-1){const u=i[o],h=u.match(/^(.*?)\s*\((\s*\d+\s*(?:pts|points)\s*)\)\s*$/i);if(h){t.SUMMARY.LIST_TITLE=h[1].trim();const R=(h[2].match(/(\d+)/)||[])[1]||"";R&&(t.SUMMARY.TOTAL_ARMY_POINTS=`${R}pts`)}else t.SUMMARY.LIST_TITLE=u;const y=[];for(let R=o+1;R<i.length;R++){const N=i[R];N&&y.push(N)}const g=["Combat Patrol","Incursion","Strike Force","Onslaught"],p=R=>{if(!R||!/\(/.test(R))return!1;for(const N of g)if(new RegExp(N,"i").test(R))return!0;return!1},S=new Set(Object.values(_n).map(R=>(R||"").toString().toLowerCase())),k=y.filter(R=>!(!R||p(R)||S.has(R.toLowerCase())));let C=null,b=null;const T=Object.keys(_n).map(R=>R.toLowerCase());for(const R of k)T.includes((R||"").toString().toLowerCase())?C=R:b||(b=R);if(!C&&k.length>0&&(C=k[0],b=k.length>1?k[1]:b),C&&(t.SUMMARY.FACTION_KEYWORD=C),b&&(t.SUMMARY.DETACHMENT=b),C){const R=Object.keys(_n).find(w=>w.toLowerCase()===C.toLowerCase()),N=R?_n[R]:null;N?t.SUMMARY.DISPLAY_FACTION=`${N} - ${C}`:t.SUMMARY.DISPLAY_FACTION=C+(b?` - ${b}`:"");try{t.SUMMARY.FACTION_KEY=C.toString().toLowerCase()}catch{}}}const l=r===-1?0:r,c=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*$/i,m=/^\s*(?:â¢|\-|\+|â¦)\s*(.*)$/;let d=null;for(let u=l;u<e.length;u++){const y=(e[u]||"").trim();if(!y||y.startsWith("Exported with"))continue;if(a.test(y.toUpperCase())){d=/^CHARACTERS?/i.test(y)?"CHARACTER":"OTHER DATASHEETS";continue}const g=y.match(c);if(g){const p=g[1].trim(),S=parseInt(String(g[2]).replace(/[\,\.\s]/g,""),10)||0;let k="1x",C=p;const b=p.match(/^([0-9]+x?)\s+(.*)$/i);b&&(k=b[1].toLowerCase(),C=b[2].trim());const T={quantity:k,name:C,points:S,items:[],isComplex:!1,nameshort:""},R=d==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";t[R]=t[R]||[],t[R].push(T);const N=[];let w=u+1;for(;w<e.length;){const X=e[w]||"";if(!X.trim()||a.test(X.trim().toUpperCase())||c.test(X.trim())||!/^\s+/.test(X)&&!m.test(X))break;N.push(X),w++}const I=(()=>{for(let X=0;X<N.length;X++){const ye=N[X];if(!ye.match(m))continue;const U=As(ye);for(let B=X+1;B<N.length;B++){const te=N[B];if(!te.trim()||As(te)<=U)break;if(m.test(te))return!0}}return!1})();let W=null,se=0;for(let X=0;X<N.length;X++){const ye=N[X],ce=ye.trim(),U=ye.match(m),B=As(ye);if(U){const te=U[1].trim(),G=te.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(te)){jr(te.replace(/^Enhancement:\s*/i,"").trim(),T,t.SUMMARY.FACTION_KEYWORD||"");continue}else if(G){jr(te.trim(),T,t.SUMMARY.FACTION_KEYWORD||"");continue}if(I){if(W&&typeof se=="number"&&B>se){Ra(W,te,W.name,t.SUMMARY.FACTION_KEYWORD||"",T.name,!1);continue}if(!(()=>{for(let H=X+1;H<N.length;H++){const re=N[H];if(!re.trim()||As(re)<=B)break;if(m.test(re))return!0}return!1})()){W=null,Ra(T,te,T.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}W=null;const $=te.match(/^(\d+x?)\s+(.*)$/i),P=$?$[1]:"1x",Y=$?$[2].trim():te,ne={quantity:P,name:Y,items:[],type:"subunit"};T.items=T.items||[],T.items.push(ne),W=ne,se=B;continue}Ra(T,te,T.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(W&&B>se){Ra(W,ce,W.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}Ra(T,ce,T.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1)}u=w-1;continue}}function f(u,h){if(!(!u||typeof u!="object")){if(typeof u.name!="string"&&(u.name=""),typeof u.quantity!="string"&&(u.quantity=u.quantity?String(u.quantity):"1x"),typeof u.type!="string"&&(u.type=u.type||"wargear"),typeof u.nameshort!="string"&&(u.nameshort=u.nameshort||""),Array.isArray(u.items)||(u.items=[]),/^Enhancement:/i.test(u.name)){const y=u.name.replace(/^Enhancement:\s*/i,"").trim();u.type="special",u.nameshort=u.nameshort||(()=>{const g=y.match(/\(([^)]+)\)$/),p=g?` (${g[1]})`:"";return`E: ${y.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(C=>C[0]?C[0].toUpperCase():"").join("")}${p}`.trim()})(),u.name=`Enhancement: ${Cs(y.replace(/\s*\([^)]+\)$/,"").trim())}`}else u.name=h?u.name:Cs(u.name);j(u.name)==="warlord"&&(u.type="special"),u.items=(u.items||[]).map(y=>{if(!y)return null;if(typeof y=="string"){const g={quantity:"1x",name:y.trim(),items:[],type:/^Enhancement:/i.test(y)?"special":"wargear",nameshort:""};return f(g,u.name),g.name&&(g.name=Cs(g.name)),g}return f(y,u.name),y&&y.name&&(y.name=Cs(y.name)),y}).filter(Boolean)}}for(const u of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(t[u]))for(const h of t[u]){f(h);const y=(h.items||[]).filter(g=>g&&g.type==="subunit");if(y.length>0)if(y.every(p=>j(p.name||"")===j(h.name||""))){const p=new Map;let S=0;for(const k of y){const C=parseInt(String(k.quantity||"1x").replace(/x/i,""),10)||1;S+=C;for(const b of k.items||[]){const T={items:[]};Ra(T,`${b.quantity||"1x"} ${b.name}`,h.name,t.SUMMARY.FACTION_KEYWORD||"",b.type||"wargear",1);for(const R of T.items){const N=j(R.name||"");if(p.has(N)){const w=p.get(N),I=parseInt(String(w.quantity||"1x").replace(/x/i,""),10)||0,W=parseInt(String(R.quantity||"1x").replace(/x/i,""),10)||0;w.quantity=`${I+W}x`}else p.set(N,R)}}}h.items=Array.from(p.values()),S>0&&(h.quantity=`${S}x`),h.isComplex=!1}else{const p=y.reduce((S,k)=>S+(parseInt(String(k.quantity||"1x").replace(/x/i,""),10)||0),0);p>0&&(h.quantity=`${p}x`),h.isComplex=!0}else h.isComplex=!1;Array.isArray(h.items)&&h.items.length>0&&fn(h.items)}return wa(t),t}function Xr(e){if(!e)return"";const t=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(e).split(/\s+/).map((a,r)=>{if(!a)return"";const s=a.toLowerCase();return r>0&&t.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function Xn(e,t,a,r,s="",i=!1,o="wargear",l=1){if(!e)return;e.items=e.items||[];const c=na(String(t||"").trim()),m=c.quantity?String(c.quantity):"1x",d=parseInt(String(m||"1x").replace(/[^0-9]/g,""),10)||1,f=`${d*(l||1)}x`;let u=c.name||"";if(!i)try{const g=u.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(g){const p=g[1].trim(),S=g[2].trim(),k=j(p),C=j(a||""),b=j(s||"");k&&(k===C||k===b||C.startsWith(k+" ")||b.startsWith(k+" ")||k.startsWith(C+" ")||k.startsWith(b+" "))&&(u=S)}}catch{}const h=j(u);if(i){const g=String(a||""),p=String(s||""),S=j(u),k=j(g),C=j(p),b=k&&S.startsWith(k+" "),T=C&&S.startsWith(C+" ");if(k&&(S===k||b)||C&&(S===C||T)){const R=u.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(R){const N=R[1].trim(),w=R[2].trim(),I=j(N);if(I===k||I===C||I.startsWith(k+" ")||I.startsWith(C+" ")){if(e&&e._deferredParenthetical&&j(e._deferredParenthetical)===j(w)||e&&e._deferredParenthetical&&j(e._deferredParenthetical)===j(w)||(e.items||[]).some(se=>j(se.name||"")===j(w)))return;Xn(e,w,a,r,s,!1,o,d);return}}return}}const y=e.items.find(g=>j(g.name||"")===h);if(y){const g=parseInt(String(y.quantity||"1x").replace(/x/i,""),10)||0,p=parseInt(String(f||"1x").replace(/x/i,""),10)||0;y.quantity=`${g+p}x`}else{const g=j(u)==="warlord"?"special":o;e.items.push({quantity:f,name:u,items:[],type:g,nameshort:""})}}function sr(e,t,a){if(!e||!t)return;t.items=t.items||[];const r=e.trim(),s=r.match(/\(([^)]+)\)$/),i=s?` (${s[1]})`:"",o=r.replace(/\s*\([^)]+\)$/,"").trim(),l=j(o);if((t.items||[]).some(u=>u&&u.type==="special"&&j((u.name||"").replace(/^Enhancement:\s*/i,""))===l))return;const d=`E: ${o.split(/\s+/).map(u=>u[0]?u[0].toUpperCase():"").join("")}${i}`.trim(),f={quantity:"1x",name:`Enhancement: ${o}`,nameshort:d,items:[],type:"special"};t.items.push(f)}function Vr(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*(?::\s*(.*))?$/i,s=/^\s*(?:â¢|\-|\+|â¦)\s*(.*)$/;let i=null;for(let l=0;l<e.length;l++){const m=(e[l]||"").trim();if(!m)continue;if(a.test(m.toUpperCase())){i=/^CHARACTERS?/i.test(m)?"CHARACTER":"OTHER DATASHEETS";continue}const d=m.match(r);if(d){const f=d[1].trim(),u=parseInt(String(d[2]).replace(/[\,\.\s]/g,""),10)||0;let h="1x",y=f;const g=f.match(/^([0-9]+x?)\s+(.*)$/i);g&&(h=g[1].toLowerCase(),y=g[2].trim());const p={quantity:h,name:y,points:u,items:[],isComplex:!1,nameshort:""},S=i==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";t[S]=t[S]||[],t[S].push(p);const k=d[3]||"";k&&k.split(",").map(w=>w.trim()).filter(Boolean).forEach(w=>Xn(p,w,p.name,t.SUMMARY.FACTION_KEYWORD||"",p.name,!0));const C=[];let b=l+1;for(;b<e.length;){const w=e[b]||"";if(!w.trim()||a.test(w.trim().toUpperCase())||r.test(w.trim())||!/^\s+/.test(w)&&!s.test(w))break;C.push(w),b++}const T=(()=>{for(let w=0;w<C.length;w++){const I=C[w];if(!I.match(s))continue;const se=Zn(I);for(let X=w+1;X<C.length;X++){const ye=C[X];if(!ye.trim()||Zn(ye)<=se)break;if(s.test(ye))return!0}}return!1})();let R=null,N=0;for(let w=0;w<C.length;w++){const I=C[w],W=I.trim(),se=I.match(s),X=Zn(I);if(se){const ye=se[1].trim(),ce=ye.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(ye)){sr(ye.replace(/^Enhancement:\s*/i,"").trim(),p,t.SUMMARY.FACTION_KEYWORD||"");continue}else if(ce){sr(ye.trim(),p,t.SUMMARY.FACTION_KEYWORD||"");continue}if(T){if(R&&typeof N=="number"&&X>N){const J=ye.split(",").map($=>$.trim()).filter(Boolean);for(let $ of J){const P=$.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(P){const Y=P[1].trim(),ne=P[2].trim();if(j(Y)===j(R.name)){const H=J.some(F=>j(F)===j(ne)),re=(R.items||[]).some(F=>j(F.name||"")===j(ne));if(H||re)continue;const ke=na($),qe=parseInt(String(ke.quantity||"1x").replace(/[^0-9]/g,""),10)||1;Xn(R,ne,R.name,t.SUMMARY.FACTION_KEYWORD||"",p.name,!1,"wargear",qe);continue}}Xn(R,$,R.name,t.SUMMARY.FACTION_KEYWORD||"",p.name,!0)}continue}R=null;const U=ye.match(/^(\d+x?)\s+(.*)$/i),B=U?U[1]:"1x";let te=U?U[2].trim():ye;try{const J=te.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(J){const $=J[1].trim(),P=J[2].trim(),Y=j($),ne=j(p.name||""),H=j(unitTopName||p.name||"");if(Y&&(Y===ne||ne.startsWith(Y)||Y.startsWith(ne)||H.startsWith(Y)||Y.startsWith(H))){te=$;const re={quantity:B,name:te,items:[],type:"subunit"};re._deferredParenthetical=P,re._deferredParentheticalQty=parseInt(String(B||"1x").replace(/[^0-9]/g,""),10)||1,p.items=p.items||[],p.items.push(re),R=re,N=X;continue}}}catch{}const G={quantity:B,name:te,items:[],type:"subunit"};p.items=p.items||[],p.items.push(G),R=G,N=X;continue}Xn(p,ye,p.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(R&&X>N){Xn(R,W,R.name,t.SUMMARY.FACTION_KEYWORD||"",p.name,!0);continue}Xn(p,W,p.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1)}l=b-1;continue}}function o(l,c){if(!(!l||typeof l!="object")){if(typeof l.name!="string"&&(l.name=""),typeof l.quantity!="string"&&(l.quantity=l.quantity?String(l.quantity):"1x"),typeof l.type!="string"&&(l.type=l.type||"wargear"),typeof l.nameshort!="string"&&(l.nameshort=l.nameshort||""),Array.isArray(l.items)||(l.items=[]),/^Enhancement:/i.test(l.name)){const m=l.name.replace(/^Enhancement:\s*/i,"").trim();l.type="special",l.nameshort=l.nameshort||(()=>{const d=m.match(/\(([^)]+)\)$/),f=d?` (${d[1]})`:"";return`E: ${m.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(y=>y[0]?y[0].toUpperCase():"").join("")}${f}`.trim()})(),l.name=`Enhancement: ${Xr(m.replace(/\s*\([^)]+\)$/,"").trim())}`}else l.name=c?l.name:Xr(l.name);j(l.name)==="warlord"&&(l.type="special"),l.items=(l.items||[]).map(m=>{if(!m)return null;if(typeof m=="string"){const d={quantity:"1x",name:m.trim(),items:[],type:/^Enhancement:/i.test(m)?"special":"wargear",nameshort:""};return o(d,l.name),d}return o(m,l.name),m}).filter(Boolean)}}for(const l of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(t[l]))for(const c of t[l]){o(c);const m=(c.items||[]).filter(f=>f&&f.type==="subunit");if(m.length>0)if(m.every(u=>j(u.name||"")===j(c.name||""))){const u=new Map;let h=0;for(const y of m){const g=parseInt(String(y.quantity||"1x").replace(/x/i,""),10)||1;h+=g;for(const p of y.items||[]){const S={items:[]};Xn(S,`${p.quantity||"1x"} ${p.name}`,c.name,t.SUMMARY.FACTION_KEYWORD||"",p.type||"wargear",1);for(const k of S.items){const C=j(k.name||"");if(u.has(C)){const b=u.get(C),T=parseInt(String(b.quantity||"1x").replace(/x/i,""),10)||0,R=parseInt(String(k.quantity||"1x").replace(/x/i,""),10)||0;b.quantity=`${T+R}x`}else u.set(C,k)}}}c.items=Array.from(u.values()),h>0&&(c.quantity=`${h}x`),c.isComplex=!1}else{const u=m.reduce((h,y)=>h+(parseInt(String(y.quantity||"1x").replace(/x/i,""),10)||0),0);u>0&&(c.quantity=`${u}x`),c.isComplex=!1}else c.isComplex=!1;if(Array.isArray(c.items)&&c.items.length===1&&c.items[0]&&c.items[0].type==="subunit"){const f=c.items[0];Array.isArray(f.items)&&f.items.length>0&&(c.items=f.items.slice(),c.isComplex=!1)}Array.isArray(c.items)&&c.items.length>0&&fn(c.items);const d=(c.items||[]).filter(f=>f&&f.type==="subunit");for(const f of d)Array.isArray(f.items)&&f.items.length>0&&fn(f.items)}return wa(t),t}function tu(e){if(!Array.isArray(e))return Vr(e);const t=[];let a=0;for(;a<e.length;a++){const f=String(e[a]||"").trim();if(!f){t.push(f);continue}if(f.startsWith("+")||f.startsWith("&")){t.push(f);continue}break}const r=[],s={};for(const d of t){if(!d)continue;if(d.startsWith("&")){const y=d.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);y&&r.push({enh:y[1].trim(),target:(y[3]||"").trim(),charId:y[2]||null});continue}const u=d.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(u){const h=u[1].trim().toUpperCase(),y=u[2].trim();if(h==="ENHANCEMENT"){const g=y.match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);g?r.push({enh:g[1].trim(),target:(g[3]||"").trim(),charId:g[2]||null}):r.push({enh:y,target:null,charId:null})}else if(h==="FACTION KEYWORD"){const g=y.split(" - ");s.faction=g[g.length-1].trim()}else h==="DETACHMENT"?s.detachment=y.replace(/\u00A0/g," "):h==="TOTAL ARMY POINTS"&&(s.points=y)}}const i=e.slice(a),o=[];for(const d of i){if(!d){o.push(d);continue}let f=String(d);f=f.replace(/^\s*Char\d+:\s*/i,"");const u=f.match(/^(.*\))\s*:\s*(.+)$/);u?(o.push(u[1]),o.push("  â¢ "+u[2])):o.push(f)}const l=Vr(o);l.SUMMARY=l.SUMMARY||{},s.faction&&(l.SUMMARY.FACTION_KEYWORD=s.faction),s.detachment&&(l.SUMMARY.DETACHMENT=s.detachment),s.points&&(l.SUMMARY.TOTAL_ARMY_POINTS=s.points);const c=[...l.CHARACTER||[],...l["OTHER DATASHEETS"]||[]],m=d=>{const f=j(String(d||""));for(const u of c){const h=u&&Array.isArray(u.items)?u.items:[];for(const y of h){if(!y||!y.name)continue;const g=String(y.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,"").trim();if(j(g)===f)return!0}}return!1};for(const d of r){if(!d||!d.enh||m(d.enh))continue;let f=null;const u=h=>String(h||"").toLowerCase().replace(/[^a-z0-9 ]/g,"").trim();if(d.charId){const h=parseInt(String(d.charId).replace(/[^0-9]/g,""),10);!Number.isNaN(h)&&h>0&&Array.isArray(l.CHARACTER)&&l.CHARACTER[h-1]&&(f=l.CHARACTER[h-1])}!f&&d.target&&(f=c.find(h=>u(h.name).includes(u(d.target))||u(`${h.quantity} ${h.name}`).includes(u(d.target)))),!f&&c.length===1&&(f=c[0]),f&&sr(d.enh,f,l.SUMMARY.FACTION_KEYWORD||"")}try{for(const d of["CHARACTER","OTHER DATASHEETS"]){const f=l[d];if(Array.isArray(f))for(const u of f)u&&typeof u=="object"&&Object.prototype.hasOwnProperty.call(u,"type")&&delete u.type}for(const d of["CHARACTER","OTHER DATASHEETS"]){const f=l[d];if(Array.isArray(f)){for(const u of f)if(!(!u||!Array.isArray(u.items))){for(const h of u.items.filter(y=>y&&y.type==="subunit"))if(h&&h._deferredParenthetical)try{delete h._deferredParenthetical,delete h._deferredParentheticalQty}catch{}}}}}catch{}return wa(l),l}function nu(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(e))return t;const a=e.map(m=>String(m||"")).find(m=>m.trim()),r=e.findIndex(m=>String(m||"").trim());if(a){const m=a.split(/\s*-\s*/).map(d=>d.trim()).filter(Boolean);if(t.SUMMARY.FACTION_FAMILY=m[0]||"",t.SUMMARY.FACTION_KEYWORD=m[1]||"",m.length>=3){const f=m[m.length-1].match(/\[\s*(\d{2,5})\s*pts?\s*\]$/i);f?(t.SUMMARY.TOTAL_ARMY_POINTS=`${f[1]}pts`,m.length===3?t.SUMMARY.LIST_TITLE=m[2]:t.SUMMARY.LIST_TITLE=m.slice(2,m.length-1).join(" - ")):t.SUMMARY.LIST_TITLE=m.slice(2).join(" - ")}t.SUMMARY.DISPLAY_FACTION=a.trim()}for(let m=0;m<Math.min(e.length,40);m++){const d=String(e[m]||"").trim();if(!d)continue;const f=d.match(/^Detachment:\s*(.*)$/i);f&&(t.SUMMARY.DETACHMENT=f[1].trim());const u=d.match(/^TOTAL ARMY POINTS:\s*(.*)$/i);u&&(t.SUMMARY.TOTAL_ARMY_POINTS=u[1].trim());const h=d.match(/^FACTION KEYWORD:\s*(.*)$/i);h&&(t.SUMMARY.FACTION_KEYWORD=h[1].trim());const y=d.match(/^Battle Size:\s*(.*)$/i);y&&(t.SUMMARY.BATTLE_SIZE=y[1].trim());const g=d.match(/^#+\s*(?:\+{1,2}\s*)?(.*)\[\s*\d{2,5}\s*pts?\s*\]$/i);if(g&&!t.SUMMARY.LIST_TITLE){const p=g[1].trim();/Army\s+Roster/i.test(p)||/\+\+/.test(p)?t.SUMMARY.LIST_TITLE="":t.SUMMARY.LIST_TITLE=p}}if(!t.SUMMARY.FACTION_KEYWORD&&t.SUMMARY.DISPLAY_FACTION){const m=t.SUMMARY.DISPLAY_FACTION.split(" - ");m.length>=2?t.SUMMARY.FACTION_KEYWORD=m[1].trim():t.SUMMARY.FACTION_KEYWORD=t.SUMMARY.DISPLAY_FACTION.replace(/\s*\[.*$/,"").trim()}const s=/^(?:(\d+)x?\s+)?(.+?)\s*\[\s*(\d{1,4})\s*pts?\s*\]\s*(?::\s*(.*))?$/i,i=/^\s*(?:â¢|\-|\+)\s*(.*)$/;let o=null,l=null;for(let m=0;m<e.length;m++){const d=String(e[m]||""),f=d.trim();if(!f||m===r)continue;if(f.startsWith("#")){const y=f.match(/^#+\s*(.+?)\s*(?:\[\s*\d+\s*pts?\s*\])?$/i);if(y){const g=y[1].trim();/character|epic|hero|hq/i.test(g)?o="CHARACTER":o="OTHER DATASHEETS"}continue}const u=f.match(s);if(u){const y=u[1]?`${u[1]}x`:"1x",g=(u[2]||"").trim(),p=parseInt(u[3],10)||0,S=u[4]||"",k={quantity:y,name:g,points:p,items:[],isComplex:!1,nameshort:""};o||(o="OTHER DATASHEETS"),t[o]=t[o]||[],t[o].push(k),l=k,S&&S.split(",").map(C=>C.trim()).filter(Boolean).forEach(C=>{c(l,C,l.name,t.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}const h=d.match(i);if(h&&l){const y=h[1].trim(),g=y.match(/^(\d+)\s+with\s+(.*)$/i);if(g&&l){const k=parseInt(g[1],10)||1,C=g[2],b=l.items&&l.items.length>0?l.items[l.items.length-1]:l;C.split(",").map(T=>T.trim()).filter(Boolean).forEach(T=>c(b,`${k}x ${T}`,b.name,t.SUMMARY.FACTION_KEYWORD||"",l.name,!0));continue}const p=y.match(/^(\d+x?)\s+([^:]+):\s*(.*)$/i);if(p){const k=p[1];let C=p[2].trim();const b=p[3]||"";C=C.replace(/\s+w\/.*$/i,"").trim();const T={quantity:k,name:C,items:[],type:"subunit"};if(b){const R=b.match(/^(\d+)\s+with\s+(.*)$/i);if(R){const N=parseInt(R[1],10)||1;R[2].split(",").map(I=>I.trim()).filter(Boolean).forEach(I=>c(T,`${N}x ${I}`,T.name,t.SUMMARY.FACTION_KEYWORD||"",l.name,!0))}else b.split(",").map(N=>N.trim()).filter(Boolean).forEach(N=>c(T,N,T.name,t.SUMMARY.FACTION_KEYWORD||"",l.name,!0))}l.items=l.items||[],l.items.push(T);continue}const S=y.match(/^(\d+x?)\s+(.*)$/i);if(S&&l){let k=S[2].trim();k=k.replace(/\s+w\/.*$/i,"").trim();const C={quantity:S[1],name:k,items:[],type:"subunit"};l.items=l.items||[],l.items.push(C);continue}c(l,y,l.name,t.SUMMARY.FACTION_KEYWORD||"",l.name,!0);continue}}function c(m,d,f,u,h="",y=!1,g="wargear"){if(!m)return;m.items=m.items||[];const p=String(d||"").trim(),S=na(p),k=S.quantity?String(S.quantity):"1x",C=/^\s*\d+x?\s+/i.test(p);let b=S.name||"";const T=b.match(/^(.*?)\s*\(([^)]+)\)$/);if(T){const W=(T[1]||"").trim(),se=(T[2]||"").trim();(/\bDrone\b/i.test(W)||/\bDrone\b/i.test(b))&&(b=se)}const R=j(b);if(y){const W=String(f||""),se=String(h||"");if(j(W)===j(b)||se&&j(se)===j(b))return}const N=parseInt(String(k||"1x").replace(/x/i,""),10)||1;let w=N;if(m&&m.type==="subunit"){const W=parseInt(String(m.quantity||"1x").replace(/[^0-9]/g,""),10)||1;w=C?N:W}const I=m.items.find(W=>j(W.name||"")===R);if(I){const W=parseInt(String(I.quantity||"1x").replace(/x/i,""),10)||0;I.quantity=`${W+w}x`}else{const W=j(b)==="warlord"?"special":g;m.items.push({quantity:`${w}x`,name:b,items:[],type:W,nameshort:""})}}for(const m of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(t[m]))for(const d of t[m]){if(!d||!Array.isArray(d.items)||d.items.length===0)continue;if(d.items.filter(h=>h&&h.type==="subunit").length>1){const h=new Map,y=[];for(const g of d.items){if(!g||g.type!=="subunit"){y.push(g);continue}const p=j(g.name||"");if(!h.has(p))h.set(p,{quantity:g.quantity||"1x",name:g.name,items:Array.isArray(g.items)?g.items.slice():[],type:"subunit"});else{const S=h.get(p),k=parseInt(String(S.quantity||"1x").replace(/[^0-9]/g,""),10)||0,C=parseInt(String(g.quantity||"1x").replace(/[^0-9]/g,""),10)||0;S.quantity=`${k+C}x`;const b=new Map;for(const T of S.items||[]){const R=j(T&&T.name||"");R&&b.set(R,{quantity:T.quantity||"1x",name:T.name,items:[],type:T.type||"wargear",nameshort:T.nameshort||""})}for(const T of g.items||[]){const R=j(T&&T.name||"");if(R)if(b.has(R)){const N=b.get(R),w=parseInt(String(N.quantity||"1x").replace(/[^0-9]/g,""),10)||0,I=parseInt(String(T.quantity||"1x").replace(/[^0-9]/g,""),10)||0;N.quantity=`${w+I}x`}else b.set(R,{quantity:T.quantity||"1x",name:T.name,items:[],type:T.type||"wargear",nameshort:T.nameshort||""})}S.items=Array.from(b.values())}}d.items=[...y,...Array.from(h.values())]}d&&Array.isArray(d.items)&&d.items.length>0&&fn(d.items);const u=d&&Array.isArray(d.items)?d.items.filter(h=>h&&h.type==="subunit"):[];for(const h of u)h&&Array.isArray(h.items)&&h.items.length>0&&fn(h.items)}return wa(t),t}function au(e,t=40){return(Array.isArray(e)?e:String(e||"").split(/\r?\n/)).slice(0,t)}function su(e){const t=Array.isArray(e)?e:String(e||"").split(/\r?\n/),a=au(t,40),r=t.join(`
`),s={NRNR:{score:0,breakdown:{},maxScore:8},"WTC-Compact":{score:0,breakdown:{},maxScore:8},WTC:{score:0,breakdown:{},maxScore:8},GWAPP:{score:0,breakdown:{},maxScore:7},"NR-GW":{score:0,breakdown:{},maxScore:7},LF:{score:0,breakdown:{},maxScore:7}},i=a.some(U=>/-\s*\[\s*\d{2,5}\s*pts?\s*\]$/i.test(U)),o=a.some(U=>/^#{1,3}\s+/.test(U)),l=a.some(U=>/^\s*#?\s*\+\+\s*Army Roster\s*\+\+/i.test(U)),c=a.some(U=>/^\s*##\s+/.test(U)),m=/(.+?)\s*[\(\[]\s*([0-9]{1,4})\s*(?:pts|points)\s*[\)\]]/i,d=r.match(new RegExp(m.source,"g"))||[],f=r.match(/^[ \t]*(?:â¢|\-|\+)\s*(?:\d+x?)\s+[^:]+:/gmi)||[],u=r.match(/\b[A-Za-z0-9\-\'â ]+\s*\([^\)]+\)/g)||[],h=/(^|\n)\s*Char\d+:.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)\s*:\s*/i,y=(r.match(new RegExp(h.source,"gi"))||[]).length,g=a.some(U=>/^(List Name|Factions Used|Army Points|Detachment Rule):/i.test(U.trim())),p=a.some(U=>/-\s*\(\s*\d+\s*Points?\s*\)\s*$/i.test(U)),S=r.match(/^(Epic Hero|Epic Heroes|Character|Characters|Battleline|Infantry|Beast|Vehicle|Dedicated Transport|Other Datasheets):\s*$/gmi)||[],k=(r.match(/^\s*â¢\s*(?:E:|Enhancement:)/gmi)||[]).length,C=(r.match(/^\s*â¢\s+/gmi)||[]).length;g&&(s.LF.score+=4,s.LF.breakdown.headerKeys=4),p&&(s.LF.score+=4,s.LF.breakdown.titleLine=4),S.length>=2&&(s.LF.score+=3,s.LF.breakdown.sectionColons=S.length),C>5&&(s.LF.score+=1,s.LF.breakdown.bullets=C),k>0&&(s.LF.score+=1,s.LF.breakdown.enhancementLines=k),(g||p||S.length>=2)&&(s.NRNR.score-=1,s.WTC.score-=1,s["WTC-Compact"].score-=1,s.GWAPP.score-=1,s["NR-GW"].score-=3),i&&(s.NRNR.score+=2,s.NRNR.breakdown.titleWithBracketedPts=2),o&&(s.NRNR.score+=3,s.NRNR.breakdown.markdownHeading=3),l&&(s.NRNR.score+=2,s.NRNR.breakdown.armyRoster=2),c&&(s.NRNR.score+=1,s.NRNR.breakdown.doubleHashSections=1),d.length>=3&&(s.NRNR.score+=1,s.NRNR.breakdown.unitLines=1),f.length>0&&(s.NRNR.score+=1,s.NRNR.breakdown.bulletWithQty=f.length),u.length>0&&(s.NRNR.score+=.5,s.NRNR.breakdown.parenItem=u.length);const b=a.join(`
`);/^[ \t]*[+&]/m.test(b)&&(s["WTC-Compact"].score+=3,s["WTC-Compact"].breakdown.headerPlusAmp=3),/(FACTION KEYWORD|DETACHMENT|TOTAL ARMY POINTS)/i.test(b)&&(s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.headerKeys=2),d.length>=2&&(s["WTC-Compact"].score+=1,s["WTC-Compact"].breakdown.unitLines=1),y>0&&(s["WTC-Compact"].score+=5,s["WTC-Compact"].breakdown.inlineCharList=y),/^\s*[+&]/m.test(b)&&(s.WTC.score+=1,s.WTC.breakdown.headerPlusAmp=1),/NUMBER OF UNITS:/i.test(b)&&(s.WTC.score+=2,s.WTC.breakdown.numberOfUnits=2);const T=(r.match(/(^|\n)\s*Char\d+:/gi)||[]).length>0;T&&(s.WTC.score+=3,s.WTC.breakdown.charMarkers=3),(o||l||c)&&(s.WTC.score-=2,s.WTC.breakdown.nrnrPenalty=-2,s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.nrnrPenalty=-1);const R=(r.match(/^\s*\d+\s+with\s+/gmi)||[]).length;R>0&&(s.WTC.score+=2,s.WTC.breakdown.withLines=R,s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.withLines=R),a.some(U=>/^(?:CHARACTER|OTHER DATASHEETS|CHARACTERS)\s*$/.test((U||"").trim()))&&(s.WTC.score+=1,s.WTC.breakdown.sectionHeaders=1),T&&(s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.charMarkerPenalty=-1),y>0&&(s.WTC.score-=2,s.WTC.breakdown.compactInlinePenalty=-2);const N=/Exported with/i.test(r);(/Exported with/i.test(b)||N)&&(s.GWAPP.score+=6,s.GWAPP.breakdown.exportedWith=6),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS)\b/i.test(r)&&(s.GWAPP.score+=2,s.GWAPP.breakdown.sectionHeaders=2),/\(\s*\d+\s*(?:pts|points)\s*\)/i.test(b)&&(s.GWAPP.score+=1,s.GWAPP.breakdown.titleParenPts=1),N&&(s["NR-GW"].score-=4,s["NR-GW"].breakdown.gwappPenalty=-4),/^\s*Strike Force\s*\(\s*\d{2,5}\s*points\s*\)/mi.test(r)&&(s.GWAPP.score+=3,s.GWAPP.breakdown.strikeForce=3),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|DEDICATED TRANSPORTS)\b/i.test(r)&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.sectionHeaders=2);const w=(r.match(/^[ \t]*(?:â¢|\u2022|â¦|\-|\+)\s+/gmi)||[]).length;w>0&&!N&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.bulletCount=w),u.length>0&&!N&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.parenItem=u.length);const I=(r.match(/^[ \t]*(?:â¢|\u2022|â¦|\-|\+)\s*\d+x?\s+[A-Za-z0-9\-\'â]+/gmi)||[]).length;I>=3&&!T&&!N&&(s["NR-GW"].score+=3,s["NR-GW"].breakdown.bulletQty=I);const W=/^(?:\s*)\d+x?\s+.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)/i,se=t.filter(U=>W.test(U)).length;if(se>=2&&!T&&!N&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.unitLinesNoChar=se),!T&&!N&&(I>=3||se>=2)&&(s.WTC.score-=2,s.WTC.breakdown.nrGwPenalty=-2,s["WTC-Compact"].score-=2,s["WTC-Compact"].breakdown.nrGwPenalty=-2),(o||l)&&(s["NR-GW"].score-=1,s["NR-GW"].breakdown.nrnrPenalty2=-1),r.indexOf("â")!==-1)for(const U of Object.keys(s))s[U].score+=.5,s[U].breakdown=s[U].breakdown||{},s[U].breakdown.unicodeApostrophe=.5;const X={};for(const U of Object.keys(s)){const B=s[U],te=Math.max(0,Math.min(1,B.score/(B.maxScore||8)));X[U]={score:B.score,confidence:te,scoreBreakdown:B.breakdown}}const ye=Object.keys(X).sort((U,B)=>X[B].score-X[U].score)[0],ce=X[ye]||{score:0,confidence:0};return{format:ye,confidence:ce.confidence,score:ce.score,scoreBreakdown:ce.scoreBreakdown,all:X}}function mo(e){const t=String(e||"").trim().match(/^(\d+)\s+(.*)$/);return t&&!/^\d+x\b/i.test(String(e||""))?`${t[1]}x ${t[2]}`:e}function uo(e){const t=String(e||"").trim().replace(/^E:\s*/i,"").replace(/^Enhancement:\s*/i,"").trim(),a=t.match(/\(([^)]*pts?[^)]*)\)\s*$/i),r=t.replace(/\s*\([^)]*\)\s*$/,"").trim(),i=`E: ${r.split(/\s+/).map(o=>o[0]?o[0].toUpperCase():"").join("")}${a?` (${a[1].trim()})`:""}`.trim();return{quantity:"1x",name:`Enhancement: ${r}`,nameshort:i,items:[],type:"special"}}function ru(e,t){if(!e)return;e.items=e.items||[];const a=mo(String(t||"").trim());if(/^(E:|Enhancement:)/i.test(a)){const s=uo(a),i=j(s.name.replace(/^Enhancement:\s*/i,""));(e.items||[]).some(l=>/^Enhancement:/i.test(l.name||"")&&j(String(l.name).replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,""))===i)||e.items.push(s);return}const r=a.split(",").map(s=>s.trim()).filter(Boolean);for(const s of r){const i=na(s.replace(/^with\s+/i,"")),o=i.quantity||"1x",l=i.name||"";if(!l)continue;const c=j(l),m=e.items.find(d=>j(d.name||"")===c);if(m){const d=parseInt(String(m.quantity||"1x").replace(/[^0-9]/g,""),10)||0,f=parseInt(String(o).replace(/[^0-9]/g,""),10)||0;m.quantity=`${d+f}x`}else e.items.push({quantity:o,name:l,items:[],type:"wargear",nameshort:""})}}function iu(e,t){const a=e[t]||"",r=Zn(a);for(let s=t+1;s<e.length;s++){const i=e[s]||"";if(!i.trim())continue;const o=Zn(i),l=/^\s*â¢\s*/.test(i);return o>r&&l}return!1}function ou(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(e))return t;const a=e.slice(0,30).map(u=>String(u||""));let r=!1;for(const u of a){const h=u.match(/^\s*([A-Za-z ][A-Za-z ]*):\s*(.*)$/);if(!h)continue;const y=h[1].trim().toLowerCase(),g=h[2].trim();if(y==="list name"&&(t.SUMMARY.LIST_TITLE=g,r=!0),y==="factions used"&&(t.SUMMARY.FACTION_KEYWORD=g,r=!0),y==="army points"){const p=parseInt(g.replace(/[^0-9]/g,""),10);p&&(t.SUMMARY.TOTAL_ARMY_POINTS=`${p}pts`,r=!0)}y==="detachment rule"&&(t.SUMMARY.DETACHMENT=g,r=!0)}if(!r){const u=e.find(h=>String(h||"").trim());if(u){const h=String(u).match(/^(.*?)\s*-\s*(.*?)\s*-\s*(.*?)\s*\((\d+)\s*Points?\)/i);h&&(t.SUMMARY.LIST_TITLE=h[1].trim(),t.SUMMARY.FACTION_KEYWORD=h[2].trim(),t.SUMMARY.DETACHMENT=h[3].trim(),t.SUMMARY.TOTAL_ARMY_POINTS=`${parseInt(h[4],10)}pts`)}}const s=/^\s*([A-Za-z ]+):\s*$/,i=/^\s*(.*?)\s*\((\d+)\s*pts?\)\s*$/i,o=/^\s*â¢\s*(.*)$/;let l=null;const c=[];for(let u=0;u<e.length;u++){const h=String(e[u]||"");if(!h.trim())continue;const g=h.match(s);if(g){const R=g[1].trim().toLowerCase();l=/hero|character/.test(R)?"CHARACTER":"OTHER DATASHEETS",c.length=0;continue}const p=h.match(i);if(p&&Zn(h)===0){const R=p[1].trim(),N=parseInt(p[2],10)||0,w={quantity:"1x",name:R,points:N,items:[],isComplex:!1,nameshort:""},I=l==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";t[I]=t[I]||[],t[I].push(w),c.length=0,c.push({indent:0,node:w});continue}const S=h.match(o);if(!S)continue;const k=S[1].trim(),C=Zn(h);for(;c.length>0&&C<=c[c.length-1].indent;)c.pop();const b=c.length>0?c[c.length-1].node:null;if(!b||/^B:\s*/i.test(k))continue;if(/^(E:|Enhancement:)/i.test(k)){const R=uo(k),N=c[0]?c[0].node:b;N.items=N.items||[],(N.items||[]).some(I=>/^Enhancement:/i.test(I.name||"")&&j(I.name)===j(R.name))||N.items.push(R);continue}if(iu(e,u)){const R=na(mo(k));let N=R.name||"";N=N.replace(/\s+w\/.*$/i,"").trim();const w={quantity:R.quantity||"1x",name:N,items:[],type:"subunit"};b.items=b.items||[],b.items.push(w),c.push({indent:C,node:w});continue}ru(b,k)}function m(u){const h=parseInt(String(u||"1x").replace(/[^0-9]/g,""),10);return Number.isFinite(h)&&h>0?h:1}for(const u of["CHARACTER","OTHER DATASHEETS"]){const h=t[u]||[];for(const y of h){const g=Array.isArray(y.items)?y.items:[],p=g.filter(b=>b&&b.type==="subunit");if(p.length<=1)continue;const S=new Map;for(const b of p){const T=j((b.name||"").replace(/\s+w\/.*/i,"").trim());S.has(T)||S.set(T,{name:b.name,qty:0,wargear:new Map});const R=S.get(T);R.qty+=m(b.quantity);const N=Array.isArray(b.items)?b.items:[];for(const w of N){const I=j(w.name||""),W=R.wargear.get(I)||{name:w.name,qty:0,type:w.type||"wargear"};W.qty+=m(w.quantity),R.wargear.has(I),R.wargear.set(I,W)}}const k=g.filter(b=>!(b&&b.type==="subunit")),C=[];for(const[,b]of S){const T={quantity:`${b.qty}x`,name:b.name,items:[],type:"subunit"};for(const[,R]of b.wargear)T.items.push({quantity:`${R.qty}x`,name:R.name,items:[],type:R.type||"wargear",nameshort:""});C.push(T)}y.items=[...k,...C]}}const d=t.SUMMARY&&t.SUMMARY.FACTION_KEYWORD?String(t.SUMMARY.FACTION_KEYWORD).trim():"";function f(u){if(!u||!d)return u;const h=new RegExp("^"+d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\s+","i");return String(u).replace(h,"").trim()}if(d)for(const u of["CHARACTER","OTHER DATASHEETS"]){const h=t[u]||[];for(const y of h){y.name=f(y.name);const g=(y.items||[]).filter(p=>p&&p.type==="subunit");for(const p of g)p.name=f(p.name)}}for(const u of["CHARACTER","OTHER DATASHEETS"]){const h=t[u]||[];for(const y of h){Array.isArray(y.items)&&y.items.length>0&&fn(y.items);const g=(y.items||[]).filter(p=>p&&p.type==="subunit");for(const p of g)Array.isArray(p.items)&&p.items.length>0&&fn(p.items)}}return wa(t),t}function lu(e){try{const t=su(e).format;return t==="NRNR"?"NRNR":t==="WTC-Compact"?"WTC_COMPACT":t==="WTC"?"WTC":t==="GWAPP"?"GW_APP":t==="NR-GW"?"NR_GW":t==="LF"?"LF":"UNKNOWN"}catch{const a=Array.isArray(e)?e.slice(0,25):[],r=a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i)||/^\s*\+\s*DETACHMENT:/i.test(i)),s=a.some(i=>/^(?:CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i.test((i||"").trim().toUpperCase()));return r&&s?"NR_GW":a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i))?"WTC_COMPACT":s?"GW_APP":"UNKNOWN"}}async function cu(e){if(!e||typeof e!="string")throw new Error("Invalid army list text");const t=e.split(`
`),a=lu(t);if(a==="UNKNOWN")throw new Error("Unable to detect army list format. Supported formats: GW App, WTC, WTC Compact, NR-GW, NR-NR, ListForge");let r;try{switch(a){case"GW_APP":r=eu(t);break;case"WTC":r=Zm(t);break;case"WTC_COMPACT":r=Qm(t);break;case"NR_GW":r=tu(t);break;case"NRNR":r=nu(t);break;case"LF":r=ou(t);break;default:throw new Error(`Unsupported format: ${a}`)}}catch(i){throw console.error("Parse error:",i),new Error(`Failed to parse ${a} format: ${i.message}`)}const s=mu(r);return{format:a,data:s}}function mu(e,t){const a=e.SUMMARY||{},r=[],s=["CHARACTER","CHARACTERS","BATTLELINE","OTHER DATASHEETS","ALLIED UNITS","DEDICATED TRANSPORTS"];for(const i of s)e[i]&&Array.isArray(e[i])&&r.push(...e[i].map(o=>({...o,section:i})));return{FACTION_KEYWORD:a.FACTION_KEYWORD||a.FACTION_KEY||"Unknown",DETACHMENT:a.DETACHMENT||"",TOTAL_ARMY_POINTS:a.TOTAL_ARMY_POINTS||"0pts",LIST_TITLE:a.LIST_TITLE||"",UNITS:r}}function uu(e){if(!e)return 1;const t=String(e).match(/(\d+)/);return t?parseInt(t[1],10):1}const du={Asurmen:{baseType:"40mm"},Autarch:{baseType:"32mm"},"Autarch wayleaper":{baseType:"32mm"},"Avatar of Khaine":{baseType:"80mm"},Baharroth:{baseType:"40mm"},"Corsair Voidreavers":{baseType:"28.5mm"},"Corsair Voidscarred":{baseType:"28.5mm"},"Crimson Hunter":{baseType:"120x92mm"},"D-cannon Platform":{baseType:"40mm"},"Dark Reapers":{baseType:"28.5mm"},"Death Jester":{baseType:"25mm"},"Dire Avengers":{baseType:"28.5mm"},"Eldrad Ulthran":{baseType:"32mm"},Falcon:{baseType:"Large Flying Base"},Farseer:{baseType:"25mm"},"Farseer Skyrunner":{baseType:"Small Flying Base"},"Fire Dragons":{baseType:"28.5mm"},"Fire Prism":{baseType:"Large Flying Base"},Fuegan:{baseType:"40mm"},"Guardian Defenders":{baseType:"28.5mm"},"Guardian Defenders: Heavy Weapon Platform":{baseType:"40mm"},"Hemlock Wraithfighter":{baseType:"120x92mm"},"Howling Banshees":{baseType:"28.5mm"},"Jain Zar":{baseType:"40mm"},Lhykhis:{baseType:"40mm"},"Maugan Ra":{baseType:"40mm"},"Night Spinner":{baseType:"Large Flying Base"},Rangers:{baseType:"28.5mm"},"Shadow Weaver Platform":{baseType:"40mm"},Shadowseer:{baseType:"25mm"},"Shining Spears":{baseType:"Large Flying Base"},"Shroud Runners":{baseType:"Large Flying Base"},Skyweavers:{baseType:"Large Flying Base"},Solitaire:{baseType:"25mm"},Spiritseer:{baseType:"25mm"},Starweaver:{baseType:"Large Flying Base"},"Storm Guardians":{baseType:"28.5mm"},"Storm Guardians: Serpentâs Scale Platform":{baseType:"40mm"},"Striking Scorpions":{baseType:"28.5mm"},"Swooping Hawks":{baseType:"28.5mm"},"The Visarch":{baseType:"32mm"}},hu={"Corvus Blackstar":{baseType:"120x92mm"},"Deathwatch Terminator Squad":{baseType:"40mm"},"Deathwatch Veterans":{baseType:"32mm"},"Fortis Kill Team":{baseType:"32mm"},"Indomitor Kill Team":{baseType:"40mm"},"Spectrus Kill Team":{baseType:"32mm"},"Spectrus Kill Team: Kill Team Infiltrators with bolt sniper rifles":{baseType:"40mm"},"Talonstrike Kill Team":{baseType:"32mm"},"Talonstrike Kill Team: Kill Team Heavy Intercessors with Jump Packs":{baseType:"40mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},fu={Archon:{baseType:"25mm"},Beastmaster:{baseType:"Small Flying Base"},"Beastmaster: Clawed Fiends, Khymerae, Razorwing Flocks":{baseType:"40mm"},"Court of the Archon: Sslyth":{baseType:"40mm"},"Court of the Archon: Ur-Ghul, Lhamaean, Medusae":{baseType:"25mm"},Cronos:{baseType:"Large Flying Base"},Drazhar:{baseType:"40mm"},Grotesques:{baseType:"40mm"},Haemonculus:{baseType:"25mm"},Hellions:{baseType:"Small Flying Base"},Incubi:{baseType:"28.5mm"},"Kabalite Warriors":{baseType:"25mm"},"Lelith Hesperax":{baseType:"32mm"},Mandrakes:{baseType:"28.5mm"},Raider:{baseType:"Large Flying Base"},Ravager:{baseType:"Large Flying Base"},"Razorwing Jetfighter":{baseType:"120x92mm"},Reavers:{baseType:"Small Flying Base"},Scourges:{baseType:"32mm"},Succubus:{baseType:"25mm"},Talos:{baseType:"Large Flying Base"},"Urien Rakarth":{baseType:"25mm"},Venom:{baseType:"Large Flying Base"},"Voidraven Bomber":{baseType:"120x92mm"},Wracks:{baseType:"25mm"},Wyches:{baseType:"25mm"}},yu={"Annihilation Barge":{baseType:"Large Flying Base"},"Câtan Shard of the Deceiver":{baseType:"40mm"},"Câtan Shard of the Nightbringer":{baseType:"40mm"},"Câtan Shard of the Void Dragon":{baseType:"80mm"},"Canoptek Doomstalker":{baseType:"90mm"},"Canoptek Reanimator":{baseType:"60mm"},"Canoptek Scarab Swarms":{baseType:"40mm"},"Canoptek Spyders":{baseType:"60mm"},"Canoptek Wraiths":{baseType:"50mm"},"Catacomb Command Barge":{baseType:"Large Flying Base"},Chronomancer:{baseType:"40mm"},"Convergence of Dominion":{baseType:"hull",hullDimensions:{width:0,height:0}},Cryptothralls:{baseType:"32mm"},Deathmarks:{baseType:"32mm"},"Doom Scythe":{baseType:"120x92mm"},"Doomsday Ark":{baseType:"Large Flying Base"},"Flayed Ones":{baseType:"28.5mm"},"Ghost Ark":{baseType:"Large Flying Base"},"Hexmark Destroyer":{baseType:"50mm"},"Illuminor Szeras":{baseType:"80mm"},Immortals:{baseType:"32mm"},"Imotekh the Stormlord":{baseType:"40mm"},"Lokhust Destroyers":{baseType:"Large Flying Base"},"Lokhust Heavy Destroyers":{baseType:"60mm"},"Lokhust Lord":{baseType:"Large Flying Base"},Lychguard:{baseType:"32mm"},Monolith:{baseType:"160mm"},"Necron Warriors":{baseType:"32mm"},"Night Scythe":{baseType:"120x92mm"},Obelisk:{baseType:"120x92mm"},"Ophydian Destroyers":{baseType:"50mm"},"Orikan the Diviner":{baseType:"40mm"},Overlord:{baseType:"40mm"},"Overlord with Translocation Shroud":{baseType:"40mm"},Plasmancer:{baseType:"32mm"},Psychomancer:{baseType:"40mm"},"Royal Warden":{baseType:"32mm"},"Skorpekh Destroyers":{baseType:"50mm"},"Skorpekh Lord":{baseType:"60mm"},Technomancer:{baseType:"50mm"},"Tesseract Vault":{baseType:"120x92mm"},"The Silent King: Szarekh":{baseType:"100mm"},"The Silent King: Triarchal Menhir":{baseType:"50mm"},"Tomb Blades":{baseType:"Small Flying Base"},"Transcendent Câtan":{baseType:"60mm"},"Trazyn the Infinite":{baseType:"40mm"},"Triarch Praetorians":{baseType:"32mm"},"Triarch Stalker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Seraptek Heavy Construct":{baseType:"hull",hullDimensions:{width:0,height:0}}},pu={Battlewagon:{baseType:"hull",hullDimensions:{width:0,height:0}},"Beast Snagga Boyz":{baseType:"32mm"},Beastboss:{baseType:"50mm"},"Beastboss on Squigosaur":{baseType:"80mm"},"Big Mek":{baseType:"50mm"},"Big Mek in Mega Armour":{baseType:"40mm"},"Big Mek with Shokk Attack Gun":{baseType:"40mm"},"Bigâed Bossbunka":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blitza-bommer":{baseType:"120x92mm"},"Boomdakka Snazzwagon":{baseType:"150x95mm"},"Boss Snikrot":{baseType:"40mm"},Boyz:{baseType:"32mm"},"Breaka Boyz":{baseType:"32mm"},"Breaka Boyz: Boss Nob":{baseType:"40mm"},"Burna Boyz":{baseType:"32mm"},"Burna-bommer":{baseType:"120x92mm"},Dakkajet:{baseType:"120x92mm"},"Deff Dread":{baseType:"60mm"},"Deffkilla Wartrike":{baseType:"150x95mm"},Deffkoptas:{baseType:"75x42mm"},"Flash Gitz":{baseType:"40mm"},"Ghazghkull Thraka":{baseType:"80mm"},"Ghazghkull Thraka: Makari":{baseType:"25mm"},Gorkanaut:{baseType:"170x109mm"},Gretchin:{baseType:"25mm"},"Gretchin: Runtherd":{baseType:"32mm"},"Hunta Rig":{baseType:"170x109mm"},"Kill Rig":{baseType:"170x109mm"},"Killa Kans":{baseType:"60mm"},Kommandos:{baseType:"32mm"},"Kustom Boosta-blasta":{baseType:"150x95mm"},Lootas:{baseType:"32mm"},Meganobz:{baseType:"40mm"},"Megatrakk Scrapjet":{baseType:"150x95mm"},Mek:{baseType:"32mm"},"Mek Gunz":{baseType:"hull",hullDimensions:{width:0,height:0}},Morkanaut:{baseType:"170x109mm"},"Mozrog Skragbad":{baseType:"80mm"},Nobz:{baseType:"32mm"},Painboss:{baseType:"40mm"},Painboy:{baseType:"32mm"},"Rukkatrukk Squigbuggy":{baseType:"150x95mm"},"Shokkjump Dragsta":{baseType:"150x95mm"},"Squighog Boyz":{baseType:"75x42mm"},"Squighog Boyz: Nob on Smasha Squig":{baseType:"90x52.5mm"},Stompa:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormboyz:{baseType:"32mm"},Tankbustas:{baseType:"32mm"},"Tankbustas: Boss Nob":{baseType:"40mm"},Trukk:{baseType:"hull",hullDimensions:{width:0,height:0}},Warbikers:{baseType:"75x42mm"},Warboss:{baseType:"40mm"},"Warboss in Mega Armour":{baseType:"50mm"},"Wazbom Blastajet":{baseType:"150x95mm"},Weirdboy:{baseType:"40mm"},Wurrboy:{baseType:"32mm"},"Zodgrod Wortsnagga":{baseType:"50mm"},"Gargantuan Squiggoth":{baseType:"hull",hullDimensions:{width:0,height:0}}},vu={Barbgaunts:{baseType:"40mm"},Biovores:{baseType:"80mm"},Broodlord:{baseType:"75x42mm"},Carnifexes:{baseType:"105x70mm"},Deathleaper:{baseType:"60mm"},Exocrine:{baseType:"120x92mm"},Gargoyles:{baseType:"Small Flying Base"},Genestealers:{baseType:"32mm"},Harpy:{baseType:"120x92mm"},Haruspex:{baseType:"120x92mm"},"Hive Crone":{baseType:"120x92mm"},"Hive Guard":{baseType:"50mm"},"Hive Tyrant":{baseType:"50mm"},Hormagaunts:{baseType:"28.5mm"},Lictor:{baseType:"50mm"},Maleceptor:{baseType:"120x92mm"},Mawloc:{baseType:"120x92mm"},"Mucolid Spores":{baseType:"40mm"},Neurogaunts:{baseType:"25mm"},"Neurogaunts: Nodebeasts":{baseType:"28.5mm"},Neurolictor:{baseType:"50mm"},Neurotyrant:{baseType:"50mm"},"Norn Assimilator":{baseType:"100mm"},"Norn Emissary":{baseType:"100mm"},"Old One Eye":{baseType:"105x70mm"},"Parasite of Mortrex":{baseType:"40mm"},Psychophage:{baseType:"120x92mm"},Pyrovores:{baseType:"80mm"},Raveners:{baseType:"40mm"},"Ripper Swarms":{baseType:"40mm"},"Screamer-killer":{baseType:"90mm"},"Spore MInes":{baseType:"25mm"},Sporocyst:{baseType:"hull",hullDimensions:{width:0,height:0}},Termagants:{baseType:"28.5mm"},Tervigon:{baseType:"120x92mm"},"The Swarmlord":{baseType:"60mm"},Toxicrene:{baseType:"120x92mm"},Trygon:{baseType:"120x92mm"},"Tyranid Warriors with Melee Bio-weapons":{baseType:"50mm"},"Tyranid Warriors with Ranged Bio-weapons":{baseType:"50mm"},Tyrannocyte:{baseType:"100mm"},Tyrannofex:{baseType:"120x92mm"},"Tyrant Guard":{baseType:"50mm"},Venomthropes:{baseType:"40mm"},"Von Ryanâs Leapers":{baseType:"40mm"},"Winged Hive Tyrant":{baseType:"60mm"},"Winged Tyranid Prime":{baseType:"50mm"},Zoanthropes:{baseType:"40mm"},Harridan:{baseType:"hull",hullDimensions:{width:4,height:6}},Hierophant:{baseType:"hull",hullDimensions:{width:0,height:0}}},ba={"ADEPTA SORORITAS":{"Aestred Thurga and Agathae Dolan: Aestred Thurga":{baseType:"32mm"},"Aestred Thurga and Agathae Dolan: Agathae Dolan":{baseType:"25mm"},"Arco-flagellants":{baseType:"25mm"},"Battle Sisters Squad":{baseType:"32mm"},Canoness:{baseType:"32mm"},"Canoness with Jump Pack":{baseType:"32mm"},Castigator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Celestian Sacresants":{baseType:"32mm"},Daemonifuge:{baseType:"32mm"},Dialogus:{baseType:"40mm"},Dogmata:{baseType:"32mm"},"Dominion Squad":{baseType:"32mm"},Exorcist:{baseType:"hull",hullDimensions:{width:0,height:0}},Hospitaller:{baseType:"50mm"},Imagifier:{baseType:"32mm"},Immolator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Junith Eruita":{baseType:"50mm"},"Ministorum Priest":{baseType:"32mm"},Mortifiers:{baseType:"50mm"},"Morvenn Vahl":{baseType:"60mm"},Palatine:{baseType:"32mm"},"Paragon Warsuits":{baseType:"50mm"},"Penitent Engines":{baseType:"50mm"},"Repentia Squad: Repentia Superior":{baseType:"32mm"},"Repentia Squad: Sister Repentia":{baseType:"28.5mm"},"Retributor Squad":{baseType:"32mm"},"Saint Celestine":{baseType:"40mm"},"Saint Celestine: Geminae Superia":{baseType:"32mm"},Sanctifiers:{baseType:"25mm"},"Seraphim Squad":{baseType:"32mm"},"Sisters Novitiate Squad: Novitiate Superior":{baseType:"32mm"},"Sisters Novitiate Squad: Sister Novitiate":{baseType:"28.5mm"},"Sororitas Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Triumph of Saint Katherine":{baseType:"120x92mm"},"Zephyrim Squad":{baseType:"32mm"}},"ADEPTUS CUSTODES":{Aleya:{baseType:"32mm"},"Allarus Custodians":{baseType:"40mm"},"Anathema Psykana Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blade Champion":{baseType:"40mm"},"Custodian Guard":{baseType:"40mm"},"Custodian Wardens":{baseType:"40mm"},"Knight-Centura":{baseType:"32mm"},Prosecutors:{baseType:"32mm"},"Shield-Captain":{baseType:"40mm"},"Shield-Captain in Allarus Terminator Armour":{baseType:"40mm"},"Shield-Captain on Dawneagle Jetbike":{baseType:"75x42mm"},"Trajann Valoris":{baseType:"40mm"},Valerian:{baseType:"40mm"},"Venerable Contemptor Dreadnought":{baseType:"60mm"},"Venerable Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vertus Praetors":{baseType:"75x42mm"},Vigilators:{baseType:"32mm"},Witchseekers:{baseType:"32mm"},"Agamatus Custodians":{baseType:"75x42mm"},"Aquilon Custodians":{baseType:"50mm"},"Ares Gunship":{baseType:"160mm"},"Caladius Grav-tank":{baseType:"170x109mm"},"Contemptor-Achillus Dreadnought":{baseType:"60mm"},"Contemptor-Galatus Dreadnought":{baseType:"60mm"},"Coronus Grav-carrier":{baseType:"170x109mm"},"Custodian Guard with Adrasite and Pyrithite Spears":{baseType:"40mm"},"Orion Assault Dropship":{baseType:"160mm"},"Pallas Grav-attack":{baseType:"105x70mm"},"Sagittarum Custodians":{baseType:"40mm"},"Telemon Heavy Dreadnought":{baseType:"100mm"},"Venatari Custodians":{baseType:"40mm"}},"ADEPTUS MECHANICUS":{"Archaeopter Fusilave":{baseType:"170x109mm"},"Archaeopter Stratoraptor":{baseType:"170x109mm"},"Archaeopter Transvector":{baseType:"170x109mm"},"Belisarius Cawl":{baseType:"105x70mm"},"Corpuscarii Electro-Priests":{baseType:"32mm"},"Cybernetica Datasmith":{baseType:"32mm"},"Fulgurite Electro-Priests":{baseType:"32mm"},"Ironstrider Ballistarii":{baseType:"105x70mm"},"Kastelan Robots":{baseType:"60mm"},"Kataphron Breachers":{baseType:"60mm"},"Kataphron Destroyers":{baseType:"60mm"},"Onager Dunecrawler":{baseType:"130mm"},"Pteraxii Skystalkers":{baseType:"40mm"},"Pteraxii Sterylizors":{baseType:"40mm"},"Serberys Raiders":{baseType:"60x35.5mm"},"Serberys Sulphurhounds":{baseType:"60x35.5mm"},"Sicarian Infiltrators":{baseType:"40mm"},"Sicarian Ruststalkers":{baseType:"40mm"},"Skitarii Marshal":{baseType:"32mm"},"Skitarii Rangers":{baseType:"25mm"},"Skitarii Rangers/Skitarii Vanguard: Transuranic Arquebus":{baseType:"60x35.5mm"},"Skitarii Vanguard":{baseType:"25mm"},"Skorpius Disintegrator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skorpius Dunerider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sydonian Dragoons with Radium Jezzails":{baseType:"105x70mm"},"Sydonian Dragoons with Taser Lances":{baseType:"105x70mm"},"Sydonian Skatros":{baseType:"40mm"},"Tech-Priest Dominus":{baseType:"50mm"},"Tech-Priest Enginseer":{baseType:"32mm"},"Tech-Priest Manipulus":{baseType:"50mm"},Technoarcheologist:{baseType:"32mm"}},"ADEPTUS TITANICUS":{"Reaver Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warbringer Nemesis Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warhound Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warlord Titan":{baseType:"hull",hullDimensions:{width:0,height:0}}},AELDARI:du,"ASTRA MILITARUM":{"Aegis Defence Line":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armoured Sentinels":{baseType:"80mm"},"Artillery Team":{baseType:"130mm"},"Attilan Rough Riders":{baseType:"60x35.5mm"},Baneblade:{baseType:"hull",hullDimensions:{width:0,height:0}},Banehammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Banesword:{baseType:"hull",hullDimensions:{width:0,height:0}},Basilisk:{baseType:"hull",hullDimensions:{width:0,height:0}},"Bullgryn squad":{baseType:"40mm"},"Cadian Castellan":{baseType:"28.5mm"},"Cadian Command Squad":{baseType:"28.5mm"},"Cadian Heavy Weapons Squad":{baseType:"50mm"},"Cadian Shock Troops":{baseType:"25mm"},"Catachan Command Squad":{baseType:"25mm"},"Catachan Heavy Weapons Squad":{baseType:"60mm"},"Catachan Jungle Fighters":{baseType:"25mm"},Chimera:{baseType:"hull",hullDimensions:{width:0,height:0}},Commissar:{baseType:"28.5mm"},"Death Korps of Krieg":{baseType:"25mm"},"Death Riders":{baseType:"60x35.5mm"},Deathstrike:{baseType:"hull",hullDimensions:{width:0,height:0}},Doomhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},"Field Ordnance Battery":{baseType:"100mm"},"Gauntâs Ghosts":{baseType:"28.5mm"},Hellhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Hellhound:{baseType:"hull",hullDimensions:{width:0,height:0}},Hydra:{baseType:"hull",hullDimensions:{width:0,height:0}},Kasrkin:{baseType:"28.5mm"},"Krieg Combat Engineers":{baseType:"25mm"},"Krieg Command Squad":{baseType:"25mm"},"Krieg Command Squad: Lord Commissar":{baseType:"32mm"},"Krieg Heavy Weapons Squad":{baseType:"50mm"},"Krieg Heavy Weapons Squad: Fire Coordinator":{baseType:"25mm"},"Leman Russ Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Demolisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Eradicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Executioner":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Exterminator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Punisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Vanquisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Marshal Dreir":{baseType:"75x42mm"},"Lord Solar Leontus":{baseType:"80mm"},Manticore:{baseType:"hull",hullDimensions:{width:0,height:0}},"Militarum Tempestus Command Squad":{baseType:"25mm"},"Ministorum Priest":{baseType:"32mm"},"Nork Deddog":{baseType:"40mm"},"Ogryn Bodyguard":{baseType:"40mm"},"Ogryn squad":{baseType:"40mm"},"Primaris Psyker":{baseType:"32mm"},Ratlings:{baseType:"25mm"},"Rogal Dorn Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Rogal Dorn Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Scout Sentinels":{baseType:"80mm"},Shadowsword:{baseType:"hull",hullDimensions:{width:0,height:0}},"Sly Marbo":{baseType:"32mm"},Stormlord:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormsword:{baseType:"hull",hullDimensions:{width:0,height:0}},Taurox:{baseType:"hull",hullDimensions:{width:0,height:0}},"Taurox Prime":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tech-Priest Enginseer":{baseType:"32mm"},"Tempestus Aquilons":{baseType:"28.5mm"},"Tempestus Scions":{baseType:"25mm"},"Ursula Creed":{baseType:"32mm"},Valkyrie:{baseType:"120x92mm"},Wyvern:{baseType:"hull",hullDimensions:{width:0,height:0}},"Avenger Strike Fighter":{baseType:"120x92mm"},"Cyclops Demolition Vehicle":{baseType:"hull",hullDimensions:{width:0,height:0}}},"BLACK TEMPLARS":{"Black Templars Gladiator Lancer":{baseType:"100mm"},"Black Templars Gladiator Reaper":{baseType:"100mm"},"Black Templars Gladiator Valiant":{baseType:"100mm"},"Black Templars Impulsor":{baseType:"100mm"},"Black Templars Repulsor":{baseType:"100mm"},"Black Templars Repulsor Executioner":{baseType:"100mm"},Castellan:{baseType:"40mm"},"Chaplain Grimaldus":{baseType:"40mm"},"Chaplain Grimaldus: Cenobyte Servitors":{baseType:"28.5mm"},"Crusader Squad: Neophytes":{baseType:"28.5mm"},"Crusader Squad: Sword Brother/Initiates":{baseType:"32mm"},"High Marshal Helbrecht":{baseType:"60mm"},Marshal:{baseType:"40mm"},"Primaris Crusader Squad: Initiates":{baseType:"32mm"},"Primaris Crusader Squad: Neophytes":{baseType:"28.5mm"},"Primaris Crusader Squad: Sword Brother":{baseType:"40mm"},"Primaris Sword Brethren":{baseType:"40mm"},"The Emperorâs Champion":{baseType:"40mm"}},"BLOOD ANGELS":{Astorath:{baseType:"40mm"},"Baal Predator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blood Angels Captain":{baseType:"40mm"},"Chief Librarian Mephiston":{baseType:"40mm"},"Commander Dante":{baseType:"50mm"},"Death Company Captain":{baseType:"40mm"},"Death Company Captain with Jump Pack":{baseType:"40mm"},"Death Company Dreadnought":{baseType:"90mm"},"Death Company Marines":{baseType:"32mm"},"Death Company Marines with Bolt Rifles":{baseType:"32mm"},"Death Company Marines with Jump Packs":{baseType:"32mm"},Lemartes:{baseType:"40mm"},"Sanguinary Guard":{baseType:"40mm"},"Sanguinary Priest":{baseType:"40mm"},"The Sanguinor":{baseType:"40mm"}},"CHAOS DAEMONS":{"Beâlakor":{baseType:"100mm"},"Beasts of Nurgle":{baseType:"60mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodmaster:{baseType:"40mm"},Bloodthirster:{baseType:"120x92mm"},"Blue Horrors":{baseType:"25mm"},"Burning Chariot":{baseType:"120x92mm"},Changecaster:{baseType:"32mm"},"Contorted Epitome":{baseType:"75x42mm"},"Daemon Prince of Chaos":{baseType:"60mm"},"Daemon Prince of Chaos with Wings":{baseType:"60mm"},Daemonettes:{baseType:"25mm"},Epidemius:{baseType:"60mm"},"Exalted Flamer":{baseType:"75x42mm"},Fateskimmer:{baseType:"120x92mm"},"Feculent Gnarlmaw":{baseType:"hull",hullDimensions:{width:0,height:0}},Fiends:{baseType:"75x42mm"},Flamers:{baseType:"32mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Fluxmaster:{baseType:"Large Flying Base"},"Great Unclean One":{baseType:"130mm"},Hellflayers:{baseType:"120x92mm"},"Horticulous Slimux":{baseType:"105x70mm"},"Infernal Enrapturess":{baseType:"60x35.5mm"},"Kairos Fateweaver":{baseType:"100mm"},Karanak:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},Nurglings:{baseType:"40mm"},"Pink Horrors":{baseType:"32mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Poxbringer:{baseType:"32mm"},"Rendmaster on Blood Throne":{baseType:"120x92mm"},Rotigus:{baseType:"130mm"},Screamers:{baseType:"Small Flying Base"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"},Skarbrand:{baseType:"100mm"},"Skull Altar":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skull Cannon":{baseType:"120x92mm"},Skullmaster:{baseType:"90x52.5mm"},Skulltaker:{baseType:"40mm"},"Sloppity Bilepiper":{baseType:"32mm"},"Soul Grinder":{baseType:"160mm"},"Spoilpox Scrivener":{baseType:"40mm"},"Syllâesske":{baseType:"50mm"},"The Blue Scribes":{baseType:"Large Flying Base"},"The Changeling":{baseType:"40mm"},"The Masque of Slaanesh":{baseType:"32mm"},Tormentbringer:{baseType:"120x92mm"},Tranceweaver:{baseType:"32mm"}},"CHAOS KNIGHTS":{"Knight Abominant":{baseType:"170x109mm"},"Knight Desecrator":{baseType:"170x109mm"},"Knight Despoiler":{baseType:"170x109mm"},"Knight Rampager":{baseType:"170x109mm"},"Knight Tyrant":{baseType:"170x109mm"},"War Dog Brigand":{baseType:"100mm"},"War Dog Executioner":{baseType:"100mm"},"War Dog Huntsman":{baseType:"100mm"},"War Dog Karnivore":{baseType:"100mm"},"War Dog Stalker":{baseType:"100mm"},"Chaos Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Cerastus Knight Acheron":{baseType:"170x109mm"},"Chaos Cerastus Knight Atrapos":{baseType:"170x109mm"},"Chaos Cerastus Knight Castigator":{baseType:"170x109mm"},"Chaos Cerastus Knight Lancer":{baseType:"170x109mm"},"Chaos Questoris Knight Magaera":{baseType:"170x109mm"},"Chaos Questoris Knight Styrix":{baseType:"170x109mm"},"War Dog Moirax":{baseType:"100mm"}},"CHAOS SPACE MARINES":{"Abaddon the Despoiler":{baseType:"60mm"},"Accursed Cultists: Mutant":{baseType:"25mm"},"Accursed Cultists: Torment":{baseType:"40mm"},"Chaos Bikers":{baseType:"75x42mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Lord":{baseType:"40mm"},"Chaos Lord in Terminator Armour":{baseType:"40mm"},"Chaos Lord with Jump Pack":{baseType:"40mm"},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminator Squad":{baseType:"40mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},Chosen:{baseType:"32mm"},"Cultist Firebrand":{baseType:"32mm"},"Cultist Mob":{baseType:"25mm"},Cypher:{baseType:"32mm"},"Dark Apostle":{baseType:"40mm"},"Dark Apostle: Dark Disciple":{baseType:"25mm"},"Dark Commune: Blessed Blade":{baseType:"28.5mm"},"Dark Commune: Cult Demagogue, Mindwitch, Iconarch":{baseType:"32mm"},Defiler:{baseType:"160mm"},"Fabius Bile":{baseType:"40mm"},"Fabius Bile: Surgeon Acolyte":{baseType:"32mm"},"Fellgor beastmen":{baseType:"32mm"},Forgefiend:{baseType:"120x92mm"},"Haarken Worldclaimer":{baseType:"40mm"},Havocs:{baseType:"40mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Heretic Astartes Daemon Prince":{baseType:"60mm"},"Heretic Astartes Daemon Prince with Wings":{baseType:"60mm"},"Huron Blackheart":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},Legionaries:{baseType:"32mm"},"Lord Discordant on Helstalker":{baseType:"120x92mm"},"Master of Executions":{baseType:"40mm"},"Master of Possession":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},"Nemesis Claw":{baseType:"32mm"},"Noctilith Crown":{baseType:"hull",hullDimensions:{width:0,height:0}},Obliterators:{baseType:"50mm"},Possessed:{baseType:"40mm"},Raptors:{baseType:"32mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Traitor Enforcer":{baseType:"32mm"},"Traitor Enforcer: Traitor Ogryn":{baseType:"40mm"},"Traitor Guardsmen Squad":{baseType:"25mm"},"Vashtorr the Arkifane":{baseType:"80mm"},Venomcrawler:{baseType:"100mm"},"Warp Talons":{baseType:"32mm"},Warpsmith:{baseType:"60x35.5mm"}},"DARK ANGELS":{Asmodai:{baseType:"50mm"},Azrael:{baseType:"50mm"},Belial:{baseType:"50mm"},"Deathwing Knights":{baseType:"40mm"},"Deathwing Terminator Squad":{baseType:"40mm"},Ezekiel:{baseType:"25mm"},"Inner Circle Companions":{baseType:"40mm"},"Land Speeder Vengeance":{baseType:"Large Flying Base"},Lazarus:{baseType:"40mm"},"Lion ElâJonson":{baseType:"60mm"},"Nephilim Jetfighter":{baseType:"120x92mm"},"Ravenwing Black Knights":{baseType:"75x42mm"},"Ravenwing Command Squad":{baseType:"75x42mm"},"Ravenwing Dark Talon":{baseType:"120x92mm"},"Ravenwing Darkshroud":{baseType:"Large Flying Base"},Sammael:{baseType:"Large Flying Base"}},"DEATH GUARD":{"Biologus Putrifier":{baseType:"40mm"},"Blightlord Terminators":{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Nurgle":{baseType:"60mm"},"Daemon Prince of Nurgle with Wings":{baseType:"60mm"},"Deathshroud Terminators":{baseType:"40mm"},Defiler:{baseType:"160mm"},"Foetid Bloat-Drone":{baseType:"60mm"},"Foetid Bloat-drone with Heavy Blight Launcher":{baseType:"60mm"},"Foul Blightspawn":{baseType:"40mm"},Helbrute:{baseType:"60mm"},"Icon Bearer":{baseType:"32mm"},"Lord of Contagion":{baseType:"50mm"},"Lord of Poxes":{baseType:"40mm"},"Lord of Virulence":{baseType:"50mm"},"Malignant Plaguecaster":{baseType:"32mm"},"Miasmic Malignifier":{baseType:"hull",hullDimensions:{width:0,height:0}},Mortarion:{baseType:"100mm"},"Myphitic Blight-Haulers":{baseType:"80mm"},"Noxious Blightbringer":{baseType:"40mm"},"Plague Marines":{baseType:"32mm"},"Plague Surgeon":{baseType:"40mm"},"Plagueburst Crawler":{baseType:"hull",hullDimensions:{width:0,height:0}},Poxwalkers:{baseType:"25mm"},Tallyman:{baseType:"40mm"},Typhus:{baseType:"50mm"},"Beasts of Nurgle":{baseType:"60mm"},"Great Unclean One":{baseType:"130mm"},Nurglings:{baseType:"40mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Rotigus:{baseType:"130mm"}},DEATHWATCH:hu,DRUKHARI:fu,"EMPERORâS CHILDREN":{"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminators":{baseType:"40mm"},"Daemon Prince of Slaanesh":{baseType:"60mm"},"Daemon Prince of Slaanesh with Wings":{baseType:"60mm"},"Flawless Blades":{baseType:"40mm"},Fulgrim:{baseType:"130mm"},Heldrake:{baseType:"120x92mm"},Infractors:{baseType:"32mm"},"Lord Exultant":{baseType:"40mm"},"Lord Kakophonist":{baseType:"40mm"},"Lucius the Eternal":{baseType:"50mm"},Maulerfiend:{baseType:"120x92mm"},"Noise Marines":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},Tormentors:{baseType:"32mm"},Daemonettes:{baseType:"25mm"},Fiends:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"}},"GENESTEALER CULTS":{Aberrants:{baseType:"32mm"},Abominant:{baseType:"40mm"},"Achilles Ridgerunners":{baseType:"120x92mm"},"Acolyte Hybrids with Autopistols":{baseType:"32mm"},"Acolyte Hybrids with Hand Flamers":{baseType:"32mm"},"Acolyte Iconward":{baseType:"32mm"},"Atalan Jackals":{baseType:"60x35.5mm"},"Atalan Jackals: Wolfquad":{baseType:"60mm"},Benefictus:{baseType:"32mm"},Biophagus:{baseType:"25mm"},Clamavus:{baseType:"32mm"},"Goliath Rockgrinder":{baseType:"hull",hullDimensions:{width:0,height:0}},"Goliath Truck":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hybrid Metamorphs":{baseType:"32mm"},"Jackal Alphus":{baseType:"60x35.5mm"},Kelermorph:{baseType:"32mm"},Locus:{baseType:"32mm"},Magus:{baseType:"32mm"},"Neophyte Hybrids":{baseType:"25mm"},"Neophyte Hybrids: Heavy stubber, Mining laser, Seismic cannon":{baseType:"32mm"},Nexos:{baseType:"40mm"},Patriarch:{baseType:"50mm"},Primus:{baseType:"32mm"},"Purestrain Genestealers":{baseType:"32mm"},"Reductus Saboteur":{baseType:"32mm"},Sanctus:{baseType:"32mm"}},"GREY KNIGHTS":{"Brother-Captain":{baseType:"40mm"},"Brother-Captain Stern":{baseType:"40mm"},"Brotherhood Champion":{baseType:"32mm"},"Brotherhood Chaplain":{baseType:"40mm"},"Brotherhood Librarian":{baseType:"40mm"},"Brotherhood Techmarine":{baseType:"32mm"},"Brotherhood Terminator Squad":{baseType:"40mm"},"Castellan Crowe":{baseType:"40mm"},"Grand Master":{baseType:"40mm"},"Grand Master in Nemesis Dreadknight":{baseType:"120x92mm"},"Grand Master Voldus":{baseType:"40mm"},"Grey Knights Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Razorback":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Stormhawk Interceptor":{baseType:"120x92mm"},"Grey knights Stormraven Gunship":{baseType:"120x92mm"},"Grey knights Stormtalon Gunship":{baseType:"120x92mm"},"Grey Knights Venerable Dreadnought":{baseType:"60mm"},"Interceptor Squad":{baseType:"32mm"},"Kaldor Draigo":{baseType:"40mm"},"Nemesis Dreadknight":{baseType:"120x92mm"},"Paladin Squad":{baseType:"40mm"},"Purgation Squad":{baseType:"32mm"},"Purifier Squad":{baseType:"32mm"},Servitors:{baseType:"25mm"},"Strike Squad":{baseType:"32mm"},"Grey Knights Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}},"Land Raider Banisher":{baseType:"hull",hullDimensions:{width:0,height:0}}},"IMPERIAL AGENTS":{"Callidus Assassin":{baseType:"32mm"},"Corvus Blackstar":{baseType:"120x92mm"},"Culexus Assassin":{baseType:"32mm"},"Deathwatch Kill Team":{baseType:"32mm"},"Eversor Assassin":{baseType:"32mm"},"Exaction Squad":{baseType:"28.5mm"},"Exaction Squad: Cyber-mastiff":{baseType:"25mm"},"Grey Knights Terminator Squad":{baseType:"40mm"},"Imperial Navy Breachers":{baseType:"25mm"},"Imperial Navy Breachers: Navis las-volley, endurant shield":{baseType:"28.5mm"},"Imperial Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},Inquisitor:{baseType:"32mm"},"Inquisitor Coteaz":{baseType:"40mm"},"Inquisitor Draxus":{baseType:"32mm"},"Inquisitor Greyfax":{baseType:"32mm"},"Inquisitorial Agents":{baseType:"25mm"},"Inquisitorial Agents: Gun Servitors":{baseType:"32mm"},"Inquisitorial Chimera":{baseType:"hull",hullDimensions:{width:0,height:0}},"Ministorum Priest":{baseType:"32mm"},Navigator:{baseType:"32mm"},"Rogue Trader entourage":{baseType:"25mm"},Sanctifiers:{baseType:"25mm"},"Sisters of Battle Immolator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sisters of Battle Squad":{baseType:"32mm"},"Subductor Squad":{baseType:"28.5mm"},"Subductor Squad: Cyber-mastiff":{baseType:"25mm"},"Vigilant Squad":{baseType:"28.5mm"},"Vigilant Squad: Cyber-mastiff":{baseType:"25mm"},"Vindicare Assassin":{baseType:"32mm"},"Voidsmen-at-Arms":{baseType:"32mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},"IMPERIAL KNIGHTS":{"Armiger Helverin":{baseType:"100mm"},"Armiger Warglaive":{baseType:"100mm"},"Canis Rex":{baseType:"170x109mm"},"Knight Castellan":{baseType:"170x109mm"},"Knight Crusader":{baseType:"170x109mm"},"Knight Errant":{baseType:"170x109mm"},"Knight Gallant":{baseType:"170x109mm"},"Knight Paladin":{baseType:"170x109mm"},"Knight Preceptor":{baseType:"170x109mm"},"Knight Valiant":{baseType:"170x109mm"},"Knight Warden":{baseType:"170x109mm"},"Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armiger Moirax":{baseType:"100mm"},"Cerastus Knight Acheron":{baseType:"170x109mm"},"Cerastus Knight Atrapos":{baseType:"170x109mm"},"Cerastus Knight Castigator":{baseType:"170x109mm"},"Cerastus Knight Lancer":{baseType:"170x109mm"},"Questoris Knight Magaera":{baseType:"170x109mm"},"Questoris Knight Styrix":{baseType:"170x109mm"}},"LEAGUES OF VOTANN":{"BrÃ´khyr Iron-master":{baseType:"32mm"},"BrÃ´khyr Iron-master: E-COG":{baseType:"25mm"},"BrÃ´khyr Iron-master: Ironkin Assistant":{baseType:"28.5mm"},"BrÃ´khyr Thunderkyn":{baseType:"40mm"},"Cthonian Beserks":{baseType:"28.5mm"},"Cthonian Beserks: Mole grenade launcher":{baseType:"50mm"},"Einhyr Champion":{baseType:"40mm"},"Einhyr Hearthguard":{baseType:"32mm"},Grimnyr:{baseType:"40mm"},"Grimnyr: CORV":{baseType:"25mm"},"Hearthkyn Warriors":{baseType:"28.5mm"},"Hekaton Land Fortress":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hernkyn Pioneers":{baseType:"90x52.5mm"},"Hernkyn Yaegirs":{baseType:"28.5mm"},KÃ¢hl:{baseType:"40mm"},Sagitaur:{baseType:"hull",hullDimensions:{width:0,height:0}},"Ãthar the Destined":{baseType:"40mm"}},NECRONS:yu,ORKS:pu,"SPACE MARINES":{"Adrax Agatone":{baseType:"40mm"},"Aggressor Squad":{baseType:"40mm"},Ancient:{baseType:"40mm"},"Ancient in Terminator Armour":{baseType:"40mm"},Apothecary:{baseType:"40mm"},"Apothecary Biologis":{baseType:"40mm"},"Assault Intercessor Squad":{baseType:"32mm"},"Assault Intercessors with Jump Packs":{baseType:"32mm"},"Ballistus Dreadnought":{baseType:"90mm"},"Bladeguard Ancient":{baseType:"40mm"},"Bladeguard Veteran Squad":{baseType:"40mm"},"Brutalis Dreadnought":{baseType:"90mm"},Captain:{baseType:"40mm"},"Captain in Gravis Armour":{baseType:"40mm"},"Captain in Phobos Armour":{baseType:"40mm"},"Captain in Terminator Armour":{baseType:"50mm"},"Captain Sicarius":{baseType:"32mm"},"Captain with Jump Pack":{baseType:"40mm"},"Centurion Assault Squad":{baseType:"50mm"},"Centurion Devastator Squad":{baseType:"50mm"},Chaplain:{baseType:"40mm"},"Chaplain in Terminator Armour":{baseType:"40mm"},"Chaplain on Bike":{baseType:"90x52.5mm"},"Chaplain with Jump Pack":{baseType:"32mm"},"Chief Librarian Tigurius":{baseType:"40mm"},"Company Heroes":{baseType:"40mm"},"Darnath Lysander":{baseType:"50mm"},"Desolation Squad":{baseType:"32mm"},"Devastator Squad":{baseType:"32mm"},Dreadnought:{baseType:"60mm"},"Drop Pod":{baseType:"hull",hullDimensions:{width:0,height:0}},"Eliminator Squad":{baseType:"40mm"},"Eradicator Squad":{baseType:"40mm"},"Firestrike Servo-turrets":{baseType:"80mm"},"Gladiator Lancer":{baseType:"100mm"},"Gladiator Reaper":{baseType:"100mm"},"Gladiator Valiant":{baseType:"100mm"},"Hammerfall Bunker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Heavy Intercessor Squad":{baseType:"40mm"},"Hellblaster Squad":{baseType:"32mm"},Impulsor:{baseType:"100mm"},"Inceptor Squad":{baseType:"40mm"},"Incursor Squad":{baseType:"32mm"},"Infernus Squad":{baseType:"32mm"},"Infiltrator Squad":{baseType:"32mm"},"Intercessor Squad":{baseType:"32mm"},"Invader ATV":{baseType:"hull",hullDimensions:{width:0,height:0}},"Invictor Tactical Warsuit":{baseType:"90mm"},"Iron Father Feirros":{baseType:"40mm"},Judiciar:{baseType:"40mm"},"Kayvaan Shrike":{baseType:"40mm"},"Korâsarro Khan":{baseType:"40mm"},"Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},Librarian:{baseType:"40mm"},"Librarian in Phobos Armour":{baseType:"40mm"},"Librarian in Terminator Armour":{baseType:"40mm"},Lieutenant:{baseType:"40mm"},"Lieutenant in Phobos Armour":{baseType:"40mm"},"Lieutenant in Reiver Armour":{baseType:"40mm"},"Lieutenant Titus":{baseType:"40mm"},"Lieutenant with Combi-weapon":{baseType:"40mm"},"Marneus Calgar":{baseType:"50mm"},"Marneus Calgar: Victrix Honour Guard":{baseType:"40mm"},"Outrider Squad":{baseType:"90x52.5mm"},"Pedro Kantor":{baseType:"32mm"},"Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},Razorback:{baseType:"hull",hullDimensions:{width:0,height:0}},"Redemptor Dreadnought":{baseType:"90mm"},"Reiver Squad":{baseType:"32mm"},Repulsor:{baseType:"100mm"},"Repulsor Executioner":{baseType:"100mm"},Rhino:{baseType:"hull",hullDimensions:{width:0,height:0}},"Roboute Guilliman":{baseType:"60mm"},"Scout Squad":{baseType:"28.5mm"},"Sternguard Veteran Squad":{baseType:"32mm"},"Storm Speeder Hailstrike":{baseType:"90mm"},"Storm Speeder Hammerstrike":{baseType:"90mm"},"Storm Speeder Thunderstrike":{baseType:"90mm"},"Stormhawk Interceptor":{baseType:"120x92mm"},"Stormraven Gunship":{baseType:"120x92mm"},"Stormtalon Gunship":{baseType:"120x92mm"},"Suppressor Squad":{baseType:"40mm"},"Tactical Squad":{baseType:"32mm"},Techmarine:{baseType:"40mm"},"Terminator Assault Squad":{baseType:"40mm"},"Terminator Squad":{baseType:"40mm"},"Tor Garadon":{baseType:"40mm"},"Uriel Ventris":{baseType:"40mm"},"Vanguard Veteran Squad with Jump Packs":{baseType:"32mm"},Vindicator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Vulkan Heâstan":{baseType:"32mm"},Whirlwind:{baseType:"hull",hullDimensions:{width:0,height:0}},Astraeus:{baseType:"hull",hullDimensions:{width:0,height:0}},"Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}}},"SPACE WOLVES":{"Arjac Rockfist":{baseType:"50mm"},"Bjorn the Fell-handed":{baseType:"60mm"},"Blood Claws":{baseType:"32mm"},"Fenrisian Wolves":{baseType:"40mm"},"Grey Hunters":{baseType:"32mm"},"Iron Priest":{baseType:"32mm"},"Logan Grimnar":{baseType:"80mm"},Murderfang:{baseType:"60mm"},"Njal Stormcaller":{baseType:"40mm"},"Ragnar Blackmane":{baseType:"40mm"},"Thunderwolf Cavalry":{baseType:"60mm"},"Ulrik the Slayer":{baseType:"32mm"},"Venerable Dreadnought":{baseType:"60mm"},"Wolf Guard Battle Leader":{baseType:"40mm"},"Wolf Guard Headtakers":{baseType:"40mm"},"Wolf Guard Headtakers: Hunting Wolves":{baseType:"60x35.5mm"},"Wolf Guard Terminators":{baseType:"40mm"},"Wolf Priest":{baseType:"40mm"},Wulfen:{baseType:"40mm"},"Wulfen Dreadnought":{baseType:"60mm"},"Wulfen with Storm Shields":{baseType:"40mm"}},"TâAU EMPIRE":{"Breacher Team":{baseType:"25mm"},"Broadside Battlesuits":{baseType:"60mm"},"Cadre Fireblade":{baseType:"25mm"},"Commander Farsight":{baseType:"60mm"},"Commander in Coldstar Battlesuit":{baseType:"60mm"},"Commander in Enforcer Battlesuit":{baseType:"60mm"},"Commander Shadowsun":{baseType:"50mm"},"Crisis Fireknife Battlesuits":{baseType:"50mm"},"Crisis Starscythe Battlesuits":{baseType:"50mm"},"Crisis Sunforge Battlesuits":{baseType:"50mm"},Darkstrider:{baseType:"32mm"},Devilfish:{baseType:"Large Flying Base"},Ethereal:{baseType:"40mm"},"Firesight Team":{baseType:"40mm"},"Ghostkeel Battlesuit":{baseType:"105x70mm"},"Hammerhead Gunship":{baseType:"Large Flying Base"},"Kroot Carnivores":{baseType:"28.5mm"},"Kroot Farstalkers":{baseType:"28.5mm"},"Kroot Farstalkers: Kroot Kill-broker":{baseType:"32mm"},"Kroot Flesh Shaper":{baseType:"32mm"},"Kroot Hounds":{baseType:"28.5mm"},"Kroot Lone-spear":{baseType:"90x52.5mm"},"Kroot Trail Shaper":{baseType:"32mm"},"Kroot War Shaper":{baseType:"32mm"},"Krootox Rampagers":{baseType:"50mm"},"Krootox Riders":{baseType:"50mm"},"Pathfinder Team":{baseType:"25mm"},Piranhas:{baseType:"Large Flying Base"},"Razorshark Strike Fighter":{baseType:"120x92mm"},"Riptide Battlesuit":{baseType:"120x92mm"},"Sky Ray Gunship":{baseType:"Large Flying Base"},"Stealth Battlesuits":{baseType:"32mm"},Stormsurge:{baseType:"170x109mm"},"Strike Team":{baseType:"25mm"},"Sun Shark Bomber":{baseType:"120x92mm"},"Tidewall Defence Platform":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Droneport":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Gunrig":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Shieldline":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vespid Stingwings":{baseType:"28.5mm"},"AX-1-0 Tiger Shark":{baseType:"160mm"},Manta:{baseType:"hull",hullDimensions:{width:4,height:6}},"Taâunar Supremacy Armour":{baseType:"160mm"},"Tiger Shark":{baseType:"160mm"}},"THOUSAND SONS":{Ahriman:{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Daemon Prince of Tzeentch":{baseType:"60mm"},"Daemon Prince of Tzeentch with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},"Exalted Sorcerer":{baseType:"32mm"},"Exalted Sorcerer on Disc of Tzeentch":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Infernal Master":{baseType:"40mm"},"Magnus the Red":{baseType:"100mm"},Maulerfiend:{baseType:"120x92mm"},"Mutalith Vortex Beast":{baseType:"120x92mm"},"Rubric Marines":{baseType:"32mm"},"Scarab Occult Terminators":{baseType:"40mm"},"Sekhetar Robots":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Tzaangor Enlightened":{baseType:"40mm"},"Tzaangor Enlightened with Fatecaster Greatbows":{baseType:"40mm"},"Tzaangor Shaman":{baseType:"40mm"},Tzaangors:{baseType:"32mm"},"Blue Horrors":{baseType:"25mm"},Flamers:{baseType:"32mm"},"Kairos Fateweaver":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},"Pink Horrors":{baseType:"32mm"},Screamers:{baseType:"Small Flying Base"}},TYRANIDS:vu,"WORLD EATERS":{Angron:{baseType:"100mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Khorne":{baseType:"60mm"},"Daemon Prince of Khorne with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},Eightbound:{baseType:"40mm"},"Exalted Eightbound":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Goremongers:{baseType:"32mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},Jakhals:{baseType:"28.5mm"},"Jakhals: Dishonoured":{baseType:"40mm"},"KhÃ¢rn the Betrayer":{baseType:"40mm"},"Khorne Berzerkers":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Invocatus":{baseType:"90x52.5mm"},"Lord on Juggernaut":{baseType:"90x52.5mm"},"Master of Executions":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},Slaughterbound:{baseType:"50mm"},"Terminator Squad":{baseType:"40mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodthirster:{baseType:"120x92mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Skarbrand:{baseType:"100mm"}}},gu=lt(ba);function bu(){return Object.keys(ba)}function ho(e){return ba[e]?Object.keys(ba[e]):[]}function qs(e,t){return!ba[e]||!ba[e][t]?null:ba[e][t]}Qt(gu,e=>Object.keys(e));function Tu(e,t){const a=e.FACTION_KEYWORD,r=e.UNITS||[],s=[],i=[],o={};for(const c of r){const m=c.name||"",d=uu(c.quantity);let f=qs(a,m);if(!f){const u=yo(m,a);u&&(f=qs(a,u))}if(!f){const{faction:u,unitName:h}=_u(m);u&&h&&(f=qs(u,h))}if(f){o[m]||(o[m]=0),o[m]++;const u=o[m]>1?` #${o[m]}`:"",h=`${m}${u}`,y=xu(f,d,t,h);s.push(...y)}else i.push({id:"unmatched-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),unitName:m,quantity:d,points:c.points,section:c.section})}return{matched:fo(s),unmatched:i}}function xu(e,t,a,r,s){const i=[],o=Su(),l=e.baseType,c=wu(r,l);for(let m=0;m<t;m++){const f={id:Cu(),baseType:l,playerId:a,x:0,y:0,rotation:0,unitId:o,unitName:r,name:c,imported:!0,inStaging:!0};l==="hull"&&(f.baseType="rect-custom",f.customWidth=e.hullDimensions?.width||5.5,f.customHeight=e.hullDimensions?.height||3),i.push(f)}return i}function fo(e){const i={};e.forEach(m=>{const d=m.unitId||"ungrouped";i[d]||(i[d]=[]),i[d].push(m)});let o=2,l=2,c=0;for(const m in i){const d=i[m];for(const f of d)f.x=o,f.y=l,o+=2,c++,c>=6&&(o=2,l+=2,c=0);c>0&&(o=2,l+=2,c=0)}return e}function yo(e,t){const a=ho(t);if(!a||a.length===0)return null;const r=da(e);for(const l of a)if(da(l)===r)return l;const s=r.replace(/s$/,""),i=r+"s";for(const l of a){const c=da(l);if(c===s||c===i)return l}for(const l of a){const c=da(l);if(r.includes(c)||c.includes(r))return l}const o=r.split(/\s+/).filter(l=>l.length>2);if(o.length>0)for(const l of a){const c=da(l);if(o.every(m=>c.includes(m)))return l}return null}function _u(e){const t=bu(),a=da(e);for(const r of t){const s=ho(r);if(s){for(const i of s)if(da(i)===a)return{faction:r,unitName:i}}}for(const r of t){const s=yo(e,r);if(s)return{faction:r,unitName:s}}return{faction:null,unitName:null}}function da(e){return String(e||"").toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim()}function Su(){return"unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function wu(e,t){if(!e)return"";const a=t.match(/(\d+)mm/),r=a?parseInt(a[1],10):null;return r&&r<50?Au(e):e}function Au(e){return e?e.replace(/\s*#\d+$/,"").split(/\s+/).filter(s=>s.length>0).slice(0,3).map(s=>s[0].toUpperCase()).join(""):""}function Cu(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}var Eu=pe('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),Ru=pe('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div> <!>',1),Mu=pe('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Selected</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <button class="danger svelte-1g40uyy"> </button></div>'),ku=pe('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Rotation</span> <span class="value svelte-1g40uyy"> </span></div>'),Du=pe('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div>'),Iu=pe('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),Lu=pe('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Base Type</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Player</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Position</span> <span class="value svelte-1g40uyy"> </span></div> <!> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-1g40uyy">Remove</button></div>'),Nu=pe('<p class="hint svelte-1g40uyy">Click a model to select it</p>'),Pu=pe('<div class="button-group vertical svelte-1g40uyy"><div class="button-row svelte-1g40uyy"><button title="Undo (Ctrl+Z)" class="svelte-1g40uyy">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-1g40uyy">Redo</button></div> <div class="button-row svelte-1g40uyy"><button title="Export deployment to share with others" class="svelte-1g40uyy">Export</button> <button title="Import deployment from JSON file" class="svelte-1g40uyy">Import</button></div> <input type="file" accept=".json" style="display: none;"/> <button class="svelte-1g40uyy">Save to Browser</button> <button class="svelte-1g40uyy">Restore from Browser</button> <button class="secondary svelte-1g40uyy">Clear All Models</button> <button class="secondary svelte-1g40uyy">Clear Saved State</button></div>'),$u=pe('<div class="player-toggle svelte-1g40uyy"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-1g40uyy"><div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Circles</h4> <div class="palette-grid svelte-1g40uyy"></div></div> <div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Ovals</h4> <div class="palette-grid svelte-1g40uyy"></div></div></div>',1),Ou=pe('<div class="rect-hull-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="rect-width" class="svelte-1g40uyy">Width (inches)</label> <input id="rect-width" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <div class="field svelte-1g40uyy"><label for="rect-height" class="svelte-1g40uyy">Height (inches)</label> <input id="rect-height" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <button class="svelte-1g40uyy"> </button></div>'),Wu=Ae('<path stroke-width="0.10" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),Yu=Ae('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),Hu=Ae("<!><!>",1),Fu=Ae('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),Bu=Ae('<g opacity="0.5" pointer-events="none"><!></g>'),qu=Ae('<line stroke-width="0.05" pointer-events="none"></line>'),Uu=Ae('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),Ku=Ae('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),Gu=Ae('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),zu=Ae("<!><!><!><!><!><!><!><!><!><!><!>",1),ju=pe('<div class="staging-wrapper svelte-1g40uyy"><!></div>'),Xu=pe('<main class="svelte-1g40uyy"><div class="header svelte-1g40uyy"><h1 class="svelte-1g40uyy">Deployment Practice</h1> <nav class="nav-links svelte-1g40uyy"><a href="#/setup" class="svelte-1g40uyy">Battlefield Setup</a> <a href="#/deployment" class="active svelte-1g40uyy">Deployment</a> <a href="#/" class="svelte-1g40uyy">Layout Builder</a> <a href="#/debug" class="svelte-1g40uyy">Debug Mode</a></nav></div> <div class="layout svelte-1g40uyy"><div class="sidebar svelte-1g40uyy"><!> <!> <!> <!> <!></div> <div class="main-content svelte-1g40uyy"><div class="battlefield-area svelte-1g40uyy"><div class="battlefield-container svelte-1g40uyy" role="presentation"><!></div> <div class="info svelte-1g40uyy"><p class="svelte-1g40uyy"> </p> <p class="hint svelte-1g40uyy">Drag to select multiple | Ctrl+Click for multi-select | Delete to remove | 1/2 to switch player | L for LoS</p></div></div> <!></div></div></main> <!>',1);function Vu(e,t){Yt(t,!1);const a=()=>Ze(fa,"$selectedDeployment",f),r=()=>Ze(mn,"$selectedLayoutName",f),s=()=>Ze(Tn,"$selectedLayoutType",f),i=()=>Ze(ot,"$models",f),o=()=>Ze(io,"$loadedTerrain",f),l=()=>Ze(zn,"$history",f),c=()=>Ze(hm,"$player1Models",f),m=()=>Ze(fm,"$player2Models",f),d=()=>Ze(an,"$stagingModels",f),[f,u]=za(),h=O(),y=O(),g=O(),p=O(),S=O(),k=O(),C=O();let b=O(1),T=O(null),R=!1,N=null,w=O(null),I=O(!1),W=O(!1),se=O(5.5),X=O(3),ye=O(!1),ce=O([]),U=[],B=O(null),te=O(!1),G=O(null),J=O(null),$=O([]),P=O(new Set),Y=!1,ne=!1,H=null,re=!1,ke=null;const qe=5,F="warhammer-deployment-state";function de(){const D={deployment:a()?.name||null,layout:r()||null,layoutType:s()||null,models:i()};localStorage.setItem(F,JSON.stringify(D))}function Pe(){const D=localStorage.getItem(F);if(D)try{const K=JSON.parse(D);K.models&&Array.isArray(K.models)&&(ot.set(K.models),zn.clear())}catch(K){console.error("Failed to restore deployment state:",K)}}function oe(){localStorage.removeItem(F),ot.clear()}function Tt(){const D={version:1,exportedAt:new Date().toISOString(),deployment:a()?{name:a().name,zones:a().zones,objectives:a().objectives}:null,terrain:{layoutName:r(),layoutType:s(),terrains:o().terrains,walls:o().walls},models:i()},K=JSON.stringify(D,null,2),Q=new Blob([K],{type:"application/json"}),ue=URL.createObjectURL(Q),ie=document.createElement("a");ie.href=ue,ie.download=`deployment-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(ie),ie.click(),document.body.removeChild(ie),URL.revokeObjectURL(ue)}let ct=O(null);function at(){n(ct)?.click()}function Ge(D){const K=D.target.files?.[0];if(!K)return;const Q=new FileReader;Q.onload=ue=>{try{const ie=JSON.parse(ue.target.result);wt(ie)}catch(ie){console.error("Failed to parse import file:",ie),alert("Failed to import: Invalid JSON file")}},Q.readAsText(K),D.target.value=""}function wt(D){if(!D.version){alert("Invalid import file: missing version");return}if(D.deployment){const K=ro.find(Q=>Q.name===D.deployment.name);K?fa.set(K):D.deployment.zones&&D.deployment.objectives&&fa.set({name:D.deployment.name||"Imported",zones:D.deployment.zones,objectives:D.deployment.objectives})}else fa.set(null);if(D.terrain){const{layoutName:K,layoutType:Q,terrains:ue,walls:ie}=D.terrain;if(Q==="preset"&&K){if(br.find(he=>he.name===K))mn.set(K),Tn.set("preset");else if(ue||ie){const he=`imported-${Date.now()}`,xe=localStorage.getItem("warhammer-deployment-layouts"),Ne=xe?JSON.parse(xe):{};Ne[he]={terrains:ue||[],walls:ie||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(Ne)),mn.set(he),Tn.set("saved")}}else if(Q==="saved"&&K){const fe=localStorage.getItem("warhammer-deployment-layouts"),he=fe?JSON.parse(fe):{};he[K]?(mn.set(K),Tn.set("saved")):(ue||ie)&&(he[K]={terrains:ue||[],walls:ie||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(he)),mn.set(K),Tn.set("saved"))}else if(ue||ie){const fe=`imported-${Date.now()}`,he=localStorage.getItem("warhammer-deployment-layouts"),xe=he?JSON.parse(he):{};xe[fe]={terrains:ue||[],walls:ie||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(xe)),mn.set(fe),Tn.set("saved")}}D.models&&Array.isArray(D.models)&&(ot.set(D.models),zn.clear()),_($,[])}async function rn(D){const{text:K,playerId:Q}=D.detail;try{n(B)&&n(B).setLoading(!0);const{format:ue,data:ie}=await cu(K),{matched:fe,unmatched:he}=Tu(ie,Q),xe=ie.LIST_TITLE||`${ie.FACTION_KEYWORD} Army`;ar.addImport(xe,K,ie,Q),he.length>0?(_(ce,he),U=fe,_(ye,!0),n(B)&&n(B).setLoading(!1)):(Gr(fe,ie.FACTION_KEYWORD),n(B)&&(n(B).setSuccess(`Imported ${fe.length} models from ${ie.FACTION_KEYWORD} (${ue})`),n(B).clearText()))}catch(ue){console.error("Failed to parse army list:",ue),n(B)&&n(B).setError(ue.message||"Failed to parse army list")}}function on(D){const{selected:K}=D.detail,Q=[];for(const fe of K){const he=typeof fe.quantity=="string"?parseInt(fe.quantity.replace(/x/i,""),10)||1:fe.quantity||1,xe="unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);for(let Ne=0;Ne<he;Ne++)Q.push({id:"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),baseType:fe.baseType,playerId:n(b),x:0,y:0,rotation:0,unitId:xe,unitName:fe.unitName,imported:!0,inStaging:!0})}const ue=[...U,...Q],ie=fo(ue);Gr(ie,"imported"),n(B)&&(n(B).setSuccess(`Imported ${ue.length} models to staging area`),n(B).clearText()),_(ce,[]),U=[]}function z(D){const{modelIds:K}=D.detail;Ym(K,30,22)}function _e(){}ja(()=>{window.addEventListener("keydown",Le)}),Ki(()=>{window.removeEventListener("keydown",Le)});function Le(D){if(D.target.tagName==="INPUT")return;const K=n($).length>0;if((D.ctrlKey||D.metaKey)&&D.key==="z"&&!D.shiftKey){D.preventDefault(),ot.undo();return}if((D.ctrlKey||D.metaKey)&&(D.key==="y"||D.shiftKey&&D.key==="z")){D.preventDefault(),ot.redo();return}if(D.key==="1"){D.preventDefault(),_(b,1);return}if(D.key==="2"){D.preventDefault(),_(b,2);return}if(D.key==="l"||D.key==="L"){D.preventDefault(),_(I,!n(I));return}if(D.key==="Delete"||D.key==="Backspace"){D.preventDefault(),n($).length>0&&(n($).forEach(Q=>{ot.remove(Q)}),_($,[]));return}if(K&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(D.key)){D.preventDefault();const Q=D.shiftKey?.1:1;let ue=0,ie=0;switch(D.key){case"ArrowUp":ie=-Q;break;case"ArrowDown":ie=Q;break;case"ArrowLeft":ue=-Q;break;case"ArrowRight":ue=Q;break}n($).forEach(fe=>{const he=i().find(xe=>xe.id===fe);he&&ot.updateModel(fe,{x:he.x+ue,y:he.y+ie},!1)});return}if(D.key==="Escape"){et();return}}function et(D){if(Y){Y=!1;return}_($,[])}function ze(D){if(D.target.closest(".model-base")||!n(w))return;D.preventDefault();const ue=n(w)(D.clientX,D.clientY);_(G,{x:ue.x,y:ue.y}),_(J,{x:ue.x,y:ue.y}),_(te,!0),window.addEventListener("mousemove",st),window.addEventListener("mouseup",ft)}function st(D){if(!n(te)||!n(w))return;const K=n(w)(D.clientX,D.clientY);_(J,{x:K.x,y:K.y});const Q=Math.min(n(G).x,n(J).x),ue=Math.max(n(G).x,n(J).x),ie=Math.min(n(G).y,n(J).y),fe=Math.max(n(G).y,n(J).y),he=new Set;i().forEach(xe=>{xe.x>=Q&&xe.x<=ue&&xe.y>=ie&&xe.y<=fe&&he.add(xe.id)}),_(P,he)}function ft(D){if(!n(te))return;const K=Math.min(n(G).x,n(J).x),Q=Math.max(n(G).x,n(J).x),ue=Math.min(n(G).y,n(J).y),ie=Math.max(n(G).y,n(J).y),fe=Q-K,he=ie-ue;if(fe<.5&&he<.5)_($,[]);else{const xe=[];i().forEach(Ne=>{Ne.x>=K&&Ne.x<=Q&&Ne.y>=ue&&Ne.y<=ie&&xe.push(Ne.id)}),_($,xe),Y=!0}_(te,!1),_(G,null),_(J,null),n(P).clear(),_(P,n(P)),window.removeEventListener("mousemove",st),window.removeEventListener("mouseup",ft)}function Lt(D,K){if(!n(w))return;R=!0,N={x:K.clientX,y:K.clientY};const Q=n(w)(K.clientX,K.clientY);_(T,{baseType:D.type,x:Q.x,y:Q.y}),window.addEventListener("mousemove",yt),window.addEventListener("mouseup",At)}function yt(D){if(!R||!n(T)||!n(w))return;const K=n(w)(D.clientX,D.clientY);_(T,{...n(T),x:K.x,y:K.y})}function At(D){if(!R||!n(T)){R=!1,_(T,null),N=null,window.removeEventListener("mousemove",yt),window.removeEventListener("mouseup",At);return}const K=D.clientX-N.x,Q=D.clientY-N.y,ue=Math.sqrt(K*K+Q*Q);let ie,fe;ue<qe?(ie=30,fe=22):(ie=n(T).x,fe=n(T).y);const he=n(T).customWidth&&n(T).customHeight?{width:n(T).customWidth,height:n(T).customHeight}:null,xe=ot.add(n(T).baseType,n(b),ie,fe,he);_($,[xe]),_(T,null),R=!1,N=null,window.removeEventListener("mousemove",yt),window.removeEventListener("mouseup",At)}function we(){const Q={width:n(se),height:n(X)},ue=ot.add("rect-custom",n(b),30,22,Q);_($,[ue])}function $e(D,K){K&&(K.ctrlKey||K.metaKey||K.shiftKey)?n($).includes(D)?_($,n($).filter(Q=>Q!==D)):_($,[...n($),D]):n($).includes(D)&&n($).length>1||_($,[D])}function Ee(D,K,Q){if(n($).length>1&&n($).includes(D)){ne||(ne=!0,H={},n($).forEach(ie=>{const fe=i().find(he=>he.id===ie);fe&&(H[ie]={x:fe.x,y:fe.y})}));const ue=H[D];if(ue){const ie=K-ue.x,fe=Q-ue.y;n($).forEach(he=>{const xe=H[he];xe&&ot.updateModel(he,{x:xe.x+ie,y:xe.y+fe},!0)})}}else ot.updateModel(D,{x:K,y:Q},!0)}function tt(D,K,Q,ue,ie){ne?(n($).forEach(fe=>{const he=H[fe],xe=i().find(Ne=>Ne.id===fe);he&&xe&&zn.push({type:"move",modelId:fe,before:{x:he.x,y:he.y},after:{x:xe.x,y:xe.y}})}),ne=!1,H=null):zn.push({type:"move",modelId:D,before:{x:K,y:Q},after:{x:ue,y:ie}})}function Ct(D,K){if(n($).length>1&&n($).includes(D)){if(!re){re=!0;let fe=0,he=0,xe=0;const Ne={};n($).forEach(Qe=>{const rt=i().find(nt=>nt.id===Qe);rt&&(fe+=rt.x,he+=rt.y,xe++,Ne[Qe]={x:rt.x,y:rt.y,rotation:rt.rotation||0})}),ke={x:fe/xe,y:he/xe},H=Ne}const Q=i().find(fe=>fe.id===D),ue=H[D];if(!Q||!ue)return;const ie=K-ue.rotation;n($).forEach(fe=>{const he=H[fe];if(he){const xe=he.x-ke.x,Ne=he.y-ke.y,Qe=ie*Math.PI/180,rt=Math.cos(Qe),nt=Math.sin(Qe),ut=xe*rt-Ne*nt,pt=xe*nt+Ne*rt;ot.updateModel(fe,{x:ke.x+ut,y:ke.y+pt,rotation:he.rotation+ie},!0)}})}else ot.updateModel(D,{rotation:K},!0)}function We(D,K,Q){re?(n($).forEach(ue=>{const ie=H[ue],fe=i().find(he=>he.id===ue);ie&&fe&&zn.push({type:"rotate",modelId:ue,before:{x:ie.x,y:ie.y,rotation:ie.rotation},after:{x:fe.x,y:fe.y,rotation:fe.rotation||0}})}),re=!1,ke=null,H=null):zn.push({type:"rotate",modelId:D,before:{rotation:K},after:{rotation:Q}})}function M(D,K){ot.updateModel(D,{name:K})}function Z(){n($).length>0&&(n($).forEach(D=>{ot.remove(D)}),_($,[]))}function ve(){confirm("Clear all models?")&&(ot.clear(),_($,[]))}function ge(D){if(Sr(D.baseType))return{x:D.x,y:D.y,width:D.customWidth,height:D.customHeight,rotation:D.rotation||0,isRectangle:!0};const K=rs(D.baseType,D);return is(D.baseType)?{x:D.x,y:D.y,rx:K.width/2,ry:K.height/2,rotation:D.rotation||0}:{x:D.x,y:D.y,radius:K.radius}}le(()=>(n($),i()),()=>{_(h,n($).map(D=>i().find(K=>K.id===D)).filter(Boolean))}),le(()=>n(h),()=>{_(y,n(h).length===1?n(h)[0]:null)}),le(()=>n(h),()=>{_(g,[...new Set(n(h).map(D=>D.playerId))])}),le(()=>(n(h),i(),n(g)),()=>{_(p,n(h).length>0?i().filter(D=>!n(g).includes(D.playerId)):[])}),le(()=>(o(),cs),()=>{_(S,o().terrains.map(D=>({id:D.id,vertices:cs(D)})))}),le(()=>(o(),Fa),()=>{_(k,o().walls.map(D=>Tr(Fa(D.shape,D.segments),D.x,D.y,D.rotation)))}),le(()=>(n(h),n(I),n(p),n(S),n(k)),()=>{_(C,n(h).length>0&&n(I)&&n(p).length>0?n(h).flatMap(D=>n(p).map(K=>{const Q=ji(ge(D),ge(K),n(S),n(k));return{sourceId:D.id,source:D,targetId:K.id,target:K,canSee:Q.canSee,firstClearRay:Q.firstClearRay,rays:Q.rays}})):[])}),Cn(),Kt();var Te=Xu(),He=Re(Te),Ue=A(E(He),2),me=E(Ue),De=E(me);It(De,{title:"Selected Model",children:(D,K)=>{var Q=bt(),ue=Re(Q);{var ie=he=>{var xe=Mu(),Ne=E(xe),Qe=A(E(Ne),2),rt=E(Qe),nt=A(Ne,2),ut=E(nt),pt=E(ut),_t=A(nt,2);{var pn=Jt=>{var kn=Ru(),Zt=Re(kn),Ye=E(Zt),ae=E(Ye),vt=A(Zt,2);{var gt=Fe=>{var Oe=Eu(),Nt=A(E(Oe),2),ln=E(Nt);V(dt=>Ce(ln,`${dt??""}/${n(C),v(()=>n(C).length)??""} rays visible`),[()=>(n(C),v(()=>n(C).filter(dt=>dt.canSee).length))]),L(Fe,Oe)};be(vt,Fe=>{n(C),v(()=>n(C).length>0)&&Fe(gt)})}La(ae,()=>n(W),Fe=>_(W,Fe)),L(Jt,kn)};be(_t,Jt=>{n(I)&&Jt(pn)})}var Rn=A(_t,2),Mn=E(Rn);V(()=>{Ce(rt,`${n($),v(()=>n($).length)??""} models`),Ce(Mn,`Remove All (${n($),v(()=>n($).length)??""})`)}),La(pt,()=>n(I),Jt=>_(I,Jt)),q("click",Rn,Z),L(he,xe)},fe=he=>{var xe=bt(),Ne=Re(xe);{var Qe=nt=>{var ut=Lu(),pt=E(ut),_t=A(E(pt),2),pn=A(pt,2),Rn=A(E(pn),2),Mn=E(Rn),Jt=A(pn,2),kn=A(E(Jt),2),Zt=E(kn),Ye=A(Jt,2),ae=A(E(Ye),2),vt=E(ae),gt=A(Ye,2);{var Fe=Rt=>{var vn=ku(),la=A(E(vn),2),Va=E(la);V(ca=>Ce(Va,`${ca??""}Â°`),[()=>(n(y),v(()=>Math.round(n(y).rotation||0)))]),L(Rt,vn)};be(gt,Rt=>{ee(is),n(y),v(()=>is(n(y).baseType))&&Rt(Fe)})}var Oe=A(gt,2),Nt=E(Oe),ln=E(Nt),dt=A(Oe,2);{var ht=Rt=>{var vn=Du(),la=E(vn),Va=E(la);La(Va,()=>n(W),ca=>_(W,ca)),L(Rt,vn)};be(dt,Rt=>{n(I)&&Rt(ht)})}var St=A(dt,2);{var ps=Rt=>{var vn=Iu(),la=A(E(vn),2),Va=E(la);V(ca=>Ce(Va,`${ca??""}/${n(C),v(()=>n(C).length)??""} visible`),[()=>(n(C),v(()=>n(C).filter(ca=>ca.canSee).length))]),L(Rt,vn)};be(St,Rt=>{n(I),n(C),v(()=>n(I)&&n(C).length>0)&&Rt(ps)})}var po=A(St,2);V((Rt,vn,la)=>{Hl(_t,(n(y),v(()=>n(y).name||""))),Ce(Mn,Rt),Ce(Zt,`Player ${n(y),v(()=>n(y).playerId)??""}`),Ce(vt,`${vn??""}", ${la??""}"`)},[()=>(ee(rs),n(y),v(()=>rs(n(y).baseType,n(y))?.label||"Unknown")),()=>(n(y),v(()=>n(y).x.toFixed(1))),()=>(n(y),v(()=>n(y).y.toFixed(1)))]),q("change",_t,Rt=>M(n(y).id,Rt.target.value)),La(ln,()=>n(I),Rt=>_(I,Rt)),q("click",po,Z),L(nt,ut)},rt=nt=>{var ut=Nu();L(nt,ut)};be(Ne,nt=>{n(y)?nt(Qe):nt(rt,!1)},!0)}L(he,xe)};be(ue,he=>{n($),v(()=>n($).length>1)?he(ie):he(fe,!1)})}L(D,Q)},$$slots:{default:!0}});var mt=A(De,2);It(mt,{title:"Import Army List",startOpen:!1,children:(D,K)=>{ls(Lm(D,{get currentPlayer(){return n(b)},$$events:{parse:rn},$$legacy:!0}),Q=>_(B,Q),()=>n(B))},$$slots:{default:!0}});var aa=A(mt,2);It(aa,{title:"Actions",children:(D,K)=>{var Q=Pu(),ue=E(Q),ie=E(ue),fe=A(ie,2),he=A(ue,2),xe=E(he),Ne=A(xe,2),Qe=A(he,2);ls(Qe,_t=>_(ct,_t),()=>n(ct));var rt=A(Qe,2),nt=A(rt,2),ut=A(nt,2),pt=A(ut,2);V(()=>{ie.disabled=(l(),v(()=>!l().past.length)),fe.disabled=(l(),v(()=>!l().future.length))}),q("click",ie,()=>ot.undo()),q("click",fe,()=>ot.redo()),q("click",xe,Tt),q("click",Ne,at),q("change",Qe,Ge),q("click",rt,de),q("click",nt,Pe),q("click",ut,ve),q("click",pt,oe),L(D,Q)},$$slots:{default:!0}});var xt=A(aa,2);It(xt,{title:"Add Models",children:(D,K)=>{var Q=$u(),ue=Re(Q),ie=E(ue);let fe;var he=A(ie,2);let xe;var Ne=A(ue,2),Qe=E(Ne),rt=A(E(Qe),2);Me(rt,5,()=>(ee(Xt),v(()=>Xt.circles)),Be,(pt,_t)=>{Ls(pt,{get baseSize(){return n(_t)},get playerId(){return n(b)},onDragStart:Lt})});var nt=A(Qe,2),ut=A(E(nt),2);Me(ut,5,()=>(ee(Xt),v(()=>Xt.ovals)),Be,(pt,_t)=>{Ls(pt,{get baseSize(){return n(_t)},get playerId(){return n(b)},onDragStart:Lt})}),V(()=>{fe=hn(ie,1,"toggle-btn svelte-1g40uyy",null,fe,{active:n(b)===1}),xe=hn(he,1,"toggle-btn svelte-1g40uyy",null,xe,{active:n(b)===2})}),q("click",ie,()=>_(b,1)),q("click",he,()=>_(b,2)),L(D,Q)},$$slots:{default:!0}});var qn=A(xt,2);It(qn,{title:"Add Hull (Vehicle)",children:(D,K)=>{var Q=Ou(),ue=E(Q),ie=A(E(ue),2),fe=A(ue,2),he=A(E(fe),2),xe=A(fe,2),Ne=E(xe);V(()=>Ce(Ne,`Add ${n(se)??""}" Ã ${n(X)??""}" Hull`)),Pt(ie,()=>n(se),Qe=>_(se,Qe)),Pt(he,()=>n(X),Qe=>_(X,Qe)),q("click",xe,we),L(D,Q)},$$slots:{default:!0}});var sa=A(me,2),ra=E(sa),ia=E(ra),Xa=E(ia);Ws(Xa,{children:cr,$$slots:{default:(D,K)=>{const Q=Xe(()=>K.screenToSvg);var ue=zu(),ie=Re(ue);{var fe=Ye=>{var ae=Hi();V(()=>Ce(ae,(n(w),ee(n(Q)),v(()=>(_(w,n(Q)),""))))),L(Ye,ae)};be(ie,Ye=>{n(Q)&&!n(w)&&Ye(fe)})}var he=A(ie);{var xe=Ye=>{var ae=Hu(),vt=Re(ae);Me(vt,1,()=>(a(),v(()=>a().zones)),Be,(Fe,Oe)=>{var Nt=Wu();V(ln=>{x(Nt,"d",ln),x(Nt,"fill",(n(Oe),v(()=>n(Oe).color))),x(Nt,"stroke",(n(Oe),v(()=>n(Oe).borderColor)))},[()=>(ee(tr),n(Oe),v(()=>tr(n(Oe).path)))]),L(Fe,Nt)});var gt=A(vt);Me(gt,1,()=>(a(),v(()=>a().objectives)),Be,(Fe,Oe)=>{const Nt=Xe(()=>(n(Oe),v(()=>n(Oe).isPrimary?"#fbbf24":"#9ca3af"))),ln=Xe(()=>(n(Oe),v(()=>n(Oe).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var dt=Yu(),ht=Re(dt),St=A(ht),ps=A(St);V(()=>{x(ht,"cx",(n(Oe),v(()=>n(Oe).x))),x(ht,"cy",(n(Oe),v(()=>n(Oe).y))),x(ht,"r",ao),x(ht,"fill",n(ln)),x(ht,"stroke",n(Nt)),x(St,"cx",(n(Oe),v(()=>n(Oe).x))),x(St,"cy",(n(Oe),v(()=>n(Oe).y))),x(St,"r",no),x(St,"fill",n(Nt)),x(ps,"cx",(n(Oe),v(()=>n(Oe).x))),x(ps,"cy",(n(Oe),v(()=>n(Oe).y)))}),L(Fe,dt)}),L(Ye,ae)};be(he,Ye=>{a()&&Ye(xe)})}var Ne=A(he);be(Ne,Ye=>{});var Qe=A(Ne);be(Qe,Ye=>{});var rt=A(Qe);Me(rt,1,()=>(o(),v(()=>o().terrains)),Be,(Ye,ae)=>{var vt=Fu(),gt=E(vt);V(()=>{x(vt,"transform",`rotate(${n(ae),v(()=>n(ae).rotation)??""}, ${n(ae),v(()=>n(ae).x+n(ae).width/2)??""}, ${n(ae),v(()=>n(ae).y+n(ae).height/2)??""})`),x(gt,"x",(n(ae),v(()=>n(ae).x))),x(gt,"y",(n(ae),v(()=>n(ae).y))),x(gt,"width",(n(ae),v(()=>n(ae).width))),x(gt,"height",(n(ae),v(()=>n(ae).height)))}),L(Ye,vt)});var nt=A(rt);Me(nt,1,()=>(o(),v(()=>o().walls)),Be,(Ye,ae)=>{var vt=Bu(),gt=E(vt);_r(gt,{get id(){return n(ae),v(()=>n(ae).id)},get x(){return n(ae),v(()=>n(ae).x)},get y(){return n(ae),v(()=>n(ae).y)},get shape(){return n(ae),v(()=>n(ae).shape)},get segments(){return n(ae),v(()=>n(ae).segments)},get rotation(){return n(ae),v(()=>n(ae).rotation)},selected:!1,get screenToSvg(){return n(Q)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),L(Ye,vt)});var ut=A(nt);Me(ut,1,i,Ye=>Ye.id,(Ye,ae)=>{{let vt=Xe(()=>(n(ae),v(()=>n(ae).name||""))),gt=Xe(()=>(n($),n(ae),v(()=>n($).includes(n(ae).id)))),Fe=Xe(()=>(n($),n(ae),n(P),v(()=>!n($).includes(n(ae).id)&&n(P).has(n(ae).id))));ms(Ye,{get id(){return n(ae),v(()=>n(ae).id)},get x(){return n(ae),v(()=>n(ae).x)},get y(){return n(ae),v(()=>n(ae).y)},get baseType(){return n(ae),v(()=>n(ae).baseType)},get playerId(){return n(ae),v(()=>n(ae).playerId)},get rotation(){return n(ae),v(()=>n(ae).rotation)},get name(){return n(vt)},get customWidth(){return n(ae),v(()=>n(ae).customWidth)},get customHeight(){return n(ae),v(()=>n(ae).customHeight)},get selected(){return n(gt)},get marqueePreview(){return n(Fe)},get screenToSvg(){return n(Q)},onSelect:$e,onDrag:Ee,onDragEnd:tt,onRotate:Ct,onRotateEnd:We,onRename:M})}});var pt=A(ut);{var _t=Ye=>{ms(Ye,{id:"phantom",get x(){return n(T),v(()=>n(T).x)},get y(){return n(T),v(()=>n(T).y)},get baseType(){return n(T),v(()=>n(T).baseType)},get playerId(){return n(b)},rotation:0,get customWidth(){return n(T),v(()=>n(T).customWidth)},get customHeight(){return n(T),v(()=>n(T).customHeight)},selected:!1,get screenToSvg(){return n(Q)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};be(pt,Ye=>{n(T)&&Ye(_t)})}var pn=A(pt);{var Rn=Ye=>{var ae=bt(),vt=Re(ae);Me(vt,1,()=>n(C),Be,(gt,Fe)=>{var Oe=bt(),Nt=Re(Oe);Me(Nt,1,()=>(n(Fe),v(()=>n(Fe).rays)),Be,(ln,dt)=>{var ht=qu();V(()=>{x(ht,"x1",(n(dt),v(()=>n(dt).from.x))),x(ht,"y1",(n(dt),v(()=>n(dt).from.y))),x(ht,"x2",(n(dt),v(()=>n(dt).to.x))),x(ht,"y2",(n(dt),v(()=>n(dt).to.y))),x(ht,"stroke",(n(dt),v(()=>n(dt).blocked?"#ff000033":"#00ff0033")))}),L(ln,ht)}),L(gt,Oe)}),L(Ye,ae)};be(pn,Ye=>{n(W),n(I),n(h),n(C),v(()=>n(W)&&n(I)&&n(h).length>0&&n(C).length>0)&&Ye(Rn)})}var Mn=A(pn);{var Jt=Ye=>{var ae=bt(),vt=Re(ae);Me(vt,1,()=>n(C),Be,(gt,Fe)=>{var Oe=bt(),Nt=Re(Oe);{var ln=ht=>{var St=Uu();V(()=>{x(St,"x1",(n(Fe),v(()=>n(Fe).firstClearRay.from.x))),x(St,"y1",(n(Fe),v(()=>n(Fe).firstClearRay.from.y))),x(St,"x2",(n(Fe),v(()=>n(Fe).firstClearRay.to.x))),x(St,"y2",(n(Fe),v(()=>n(Fe).firstClearRay.to.y)))}),L(ht,St)},dt=ht=>{var St=Ku();V(()=>{x(St,"x1",(n(Fe),v(()=>n(Fe).source.x))),x(St,"y1",(n(Fe),v(()=>n(Fe).source.y))),x(St,"x2",(n(Fe),v(()=>n(Fe).target.x))),x(St,"y2",(n(Fe),v(()=>n(Fe).target.y)))}),L(ht,St)};be(Nt,ht=>{n(Fe),v(()=>n(Fe).firstClearRay)?ht(ln):ht(dt,!1)})}L(gt,Oe)}),L(Ye,ae)};be(Mn,Ye=>{n(I),n(h),n(C),v(()=>n(I)&&n(h).length>0&&n(C).length>0)&&Ye(Jt)})}var kn=A(Mn);{var Zt=Ye=>{const ae=Xe(()=>(n(G),n(J),v(()=>Math.min(n(G).x,n(J).x)))),vt=Xe(()=>(n(G),n(J),v(()=>Math.min(n(G).y,n(J).y)))),gt=Xe(()=>(n(J),n(G),v(()=>Math.abs(n(J).x-n(G).x)))),Fe=Xe(()=>(n(J),n(G),v(()=>Math.abs(n(J).y-n(G).y))));var Oe=Gu();V(()=>{x(Oe,"x",n(ae)),x(Oe,"y",n(vt)),x(Oe,"width",n(gt)),x(Oe,"height",n(Fe))}),L(Ye,Oe)};be(kn,Ye=>{n(te)&&n(G)&&n(J)&&Ye(Zt)})}L(D,ue)}}});var Ft=A(ia,2),En=E(Ft),yn=E(En),Aa=A(ra,2);{var Un=D=>{var K=ju(),Q=E(K);Xm(Q,{$$events:{deploy:z,clear:_e}}),L(D,K)};be(Aa,D=>{d(),v(()=>d().length>0)&&D(Un)})}var oa=A(He,2);Om(oa,{get unmatchedUnits(){return n(ce)},get show(){return n(ye)},set show(D){_(ye,D)},$$events:{import:on,close:()=>{_(ye,!1)}},$$legacy:!0}),V(()=>Ce(yn,`Battlefield: 60" x 44" | ${c(),v(()=>c().length)??""} P1 models | ${m(),v(()=>m().length)??""} P2 models`)),q("mousedown",ia,ze),L(e,Te),Ht(),u()}var Qu=pe("<span> </span>"),Ju=pe('<span class="los-status svelte-12aohay">No enemies</span>'),Zu=pe('<div class="controls svelte-12aohay"><label class="svelte-12aohay"><input type="checkbox" class="svelte-12aohay"/> Show debug rays</label> <!></div>'),ed=pe('<button class="svelte-12aohay"> </button>'),td=pe('<div class="button-group svelte-12aohay"></div>'),nd=pe('<button class="svelte-12aohay"> </button>'),ad=pe('<div class="button-group svelte-12aohay"></div>'),sd=pe('<div class="player-toggle svelte-12aohay"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-12aohay"><div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Circles</h4> <div class="palette-grid svelte-12aohay"></div></div> <div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Ovals</h4> <div class="palette-grid svelte-12aohay"></div></div></div>',1),rd=Ae('<line stroke-width="0.05"></line>'),id=Ae('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),od=Ae('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),ld=Ae("<!><!><!><!><!><!><!>",1),cd=pe('<p class="svelte-12aohay"> </p>'),md=pe('<main class="svelte-12aohay"><div class="header svelte-12aohay"><h1 class="svelte-12aohay">Debug Mode</h1> <nav class="nav-links svelte-12aohay"><a href="#/setup" class="svelte-12aohay">Battlefield Setup</a> <a href="#/deployment" class="svelte-12aohay">Deployment</a> <a href="#/" class="svelte-12aohay">Layout Builder</a> <a href="#/debug" class="active svelte-12aohay">Debug Mode</a></nav></div> <div class="layout svelte-12aohay"><div class="sidebar svelte-12aohay"><!> <!> <!> <!></div> <div class="battlefield-area svelte-12aohay"><div class="battlefield-container svelte-12aohay"><!></div> <div class="info svelte-12aohay"><p class="svelte-12aohay"> </p> <!> <p class="hint svelte-12aohay">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function ud(e,t){Yt(t,!1);const a=()=>Ze(jn,"$debugModels",m),r=()=>Ze(ua,"$debugSelectedModelId",m),s=()=>Ze(xs,"$debugTerrains",m),i=()=>Ze(_s,"$debugWalls",m),o=()=>Ze(Ur,"$debugMode",m),l=()=>Ze(Ss,"$debugSelectedTerrainId",m),c=()=>Ze(ws,"$debugSelectedWallId",m),[m,d]=za(),f=O(),u=O(),h=O(),y=O(),g=O();function p(z,_e){xs.add(z,_e)}function S(z){_s.add(z)}function k(z){Ss.set(z),ws.set(null),ua.set(null)}function C(z){ws.set(z),Ss.set(null),ua.set(null)}function b(z,_e,Le){xs.updateTerrain(z,{x:_e,y:Le})}function T(z,_e,Le){_s.updateWall(z,{x:_e,y:Le})}function R(z,_e){xs.updateTerrain(z,{rotation:_e})}function N(z,_e){_s.updateWall(z,{rotation:_e})}let w=O(1),I=O(null),W=!1,se=null,X=O(null);const ye=5;ja(()=>{if(a().length===0){const z=jn.add("32mm",1,10,22);jn.add("32mm",2,50,22),ua.set(z)}});function ce(z,_e){if(!n(X))return;W=!0,se={x:_e.clientX,y:_e.clientY};const Le=n(X)(_e.clientX,_e.clientY);_(I,{baseType:z.type,x:Le.x,y:Le.y}),window.addEventListener("mousemove",U),window.addEventListener("mouseup",B)}function U(z){if(!W||!n(I)||!n(X))return;const _e=n(X)(z.clientX,z.clientY);_(I,{...n(I),x:_e.x,y:_e.y})}function B(z){if(!W||!n(I)){W=!1,_(I,null),se=null,window.removeEventListener("mousemove",U),window.removeEventListener("mouseup",B);return}const _e=z.clientX-se.x,Le=z.clientY-se.y,et=Math.sqrt(_e*_e+Le*Le);let ze,st;et<ye?(ze=30,st=22):(ze=n(I).x,st=n(I).y);const ft=jn.add(n(I).baseType,n(w),ze,st);ua.set(ft),_(I,null),W=!1,se=null,window.removeEventListener("mousemove",U),window.removeEventListener("mouseup",B)}function te(z){ua.set(z),Ss.set(null),ws.set(null)}function G(z,_e,Le){jn.updateModel(z,{x:_e,y:Le},!0)}function J(z,_e,Le,et,ze){nr.push({type:"move",modelId:z,before:{x:_e,y:Le},after:{x:et,y:ze}})}function $(z,_e){jn.updateModel(z,{rotation:_e},!0)}function P(z,_e,Le){nr.push({type:"rotate",modelId:z,before:{rotation:_e},after:{rotation:Le}})}function Y(z,_e){jn.updateModel(z,{name:_e})}function ne(z){const _e=rs(z.baseType);return is(z.baseType)?{x:z.x,y:z.y,rx:_e.width/2,ry:_e.height/2,rotation:z.rotation||0}:{x:z.x,y:z.y,radius:_e.radius}}le(()=>(a(),r()),()=>{_(f,a().find(z=>z.id===r()))}),le(()=>(n(f),a()),()=>{_(u,n(f)?a().filter(z=>z.playerId!==n(f).playerId):[])}),le(()=>(s(),cs),()=>{_(h,s().map(z=>({id:z.id,vertices:cs(z)})))}),le(()=>(i(),Fa),()=>{_(y,i().map(z=>Tr(Fa(z.shape,z.segments),z.x,z.y,z.rotation)))}),le(()=>(n(f),n(u),n(h),n(y)),()=>{_(g,n(f)&&n(u).length>0?n(u).map(z=>{const _e=ji(ne(n(f)),ne(z),n(h),n(y));return{targetId:z.id,target:z,canSee:_e.canSee,firstClearRay:_e.firstClearRay,rays:_e.rays}}):[])}),Cn(),Kt();var H=md(),re=A(E(H),2),ke=E(re),qe=E(ke);It(qe,{title:"LOS Debug",children:(z,_e)=>{var Le=Zu(),et=E(Le),ze=E(et),st=A(et,2);{var ft=yt=>{var At=Qu();let we;var $e=E(At);V((Ee,tt)=>{we=hn(At,1,"los-status svelte-12aohay",null,we,Ee),Ce($e,`${tt??""}/${n(g),v(()=>n(g).length)??""} visible`)},[()=>({"can-see":n(g).some(Ee=>Ee.canSee),blocked:!n(g).some(Ee=>Ee.canSee)}),()=>(n(g),v(()=>n(g).filter(Ee=>Ee.canSee).length))]),L(yt,At)},Lt=yt=>{var At=Ju();L(yt,At)};be(st,yt=>{n(f),n(g),v(()=>n(f)&&n(g).length>0)?yt(ft):yt(Lt,!1)})}La(ze,o,yt=>ql(Ur,yt)),L(z,Le)},$$slots:{default:!0}});var F=A(qe,2);It(F,{title:"Add Terrain",defaultOpen:!1,children:(z,_e)=>{var Le=td();Me(Le,5,()=>Ji,Be,(et,ze)=>{var st=ed(),ft=E(st);V(()=>Ce(ft,(n(ze),v(()=>n(ze).label)))),q("click",st,()=>p(n(ze).width,n(ze).height)),L(et,st)}),L(z,Le)},$$slots:{default:!0}});var de=A(F,2);It(de,{title:"Add Wall",defaultOpen:!1,children:(z,_e)=>{var Le=ad();Me(Le,5,()=>Zs,Be,(et,ze)=>{var st=nd(),ft=E(st);V(()=>Ce(ft,(n(ze),v(()=>n(ze).label)))),q("click",st,()=>S(n(ze).shape)),L(et,st)}),L(z,Le)},$$slots:{default:!0}});var Pe=A(de,2);It(Pe,{title:"Add Models",defaultOpen:!1,children:(z,_e)=>{var Le=sd(),et=Re(Le),ze=E(et);let st;var ft=A(ze,2);let Lt;var yt=A(et,2),At=E(yt),we=A(E(At),2);Me(we,5,()=>(ee(Xt),v(()=>Xt.circles)),Be,(tt,Ct)=>{Ls(tt,{get baseSize(){return n(Ct)},get playerId(){return n(w)},onDragStart:ce})});var $e=A(At,2),Ee=A(E($e),2);Me(Ee,5,()=>(ee(Xt),v(()=>Xt.ovals)),Be,(tt,Ct)=>{Ls(tt,{get baseSize(){return n(Ct)},get playerId(){return n(w)},onDragStart:ce})}),V(()=>{st=hn(ze,1,"toggle-btn svelte-12aohay",null,st,{active:n(w)===1}),Lt=hn(ft,1,"toggle-btn svelte-12aohay",null,Lt,{active:n(w)===2})}),q("click",ze,()=>_(w,1)),q("click",ft,()=>_(w,2)),L(z,Le)},$$slots:{default:!0}});var oe=A(ke,2),Tt=E(oe),ct=E(Tt);Ws(ct,{children:cr,$$slots:{default:(z,_e)=>{const Le=Xe(()=>_e.screenToSvg);var et=ld(),ze=Re(et);{var st=We=>{var M=Hi();V(()=>Ce(M,(n(X),ee(n(Le)),v(()=>(_(X,n(Le)),""))))),L(We,M)};be(ze,We=>{n(Le)&&!n(X)&&We(st)})}var ft=A(ze);{var Lt=We=>{var M=bt(),Z=Re(M);Me(Z,1,()=>n(g),Be,(ve,ge)=>{var Te=bt(),He=Re(Te);Me(He,1,()=>(n(ge),v(()=>n(ge).rays)),Be,(Ue,me)=>{var De=rd();V(()=>{x(De,"x1",(n(me),v(()=>n(me).from.x))),x(De,"y1",(n(me),v(()=>n(me).from.y))),x(De,"x2",(n(me),v(()=>n(me).to.x))),x(De,"y2",(n(me),v(()=>n(me).to.y))),x(De,"stroke",(n(me),v(()=>n(me).blocked?"#ff000033":"#00ff0033")))}),L(Ue,De)}),L(ve,Te)}),L(We,M)};be(ft,We=>{o(),n(f),n(g),v(()=>o()&&n(f)&&n(g).length>0)&&We(Lt)})}var yt=A(ft);Me(yt,1,s,We=>We.id,(We,M)=>{{let Z=Xe(()=>(n(M),l(),v(()=>n(M).id===l())));Vi(We,{get id(){return n(M),v(()=>n(M).id)},get x(){return n(M),v(()=>n(M).x)},get y(){return n(M),v(()=>n(M).y)},get width(){return n(M),v(()=>n(M).width)},get height(){return n(M),v(()=>n(M).height)},get rotation(){return n(M),v(()=>n(M).rotation)},get selected(){return n(Z)},get screenToSvg(){return n(Le)},onSelect:k,onDrag:b,onRotate:R})}});var At=A(yt);Me(At,1,i,We=>We.id,(We,M)=>{{let Z=Xe(()=>(n(M),c(),v(()=>n(M).id===c())));_r(We,{get id(){return n(M),v(()=>n(M).id)},get x(){return n(M),v(()=>n(M).x)},get y(){return n(M),v(()=>n(M).y)},get shape(){return n(M),v(()=>n(M).shape)},get segments(){return n(M),v(()=>n(M).segments)},get rotation(){return n(M),v(()=>n(M).rotation)},get selected(){return n(Z)},get screenToSvg(){return n(Le)},onSelect:C,onDrag:T,onRotate:N})}});var we=A(At);Me(we,1,a,We=>We.id,(We,M)=>{{let Z=Xe(()=>(n(M),v(()=>n(M).name||""))),ve=Xe(()=>(n(M),r(),v(()=>n(M).id===r())));ms(We,{get id(){return n(M),v(()=>n(M).id)},get x(){return n(M),v(()=>n(M).x)},get y(){return n(M),v(()=>n(M).y)},get baseType(){return n(M),v(()=>n(M).baseType)},get playerId(){return n(M),v(()=>n(M).playerId)},get rotation(){return n(M),v(()=>n(M).rotation)},get name(){return n(Z)},get selected(){return n(ve)},get screenToSvg(){return n(Le)},onSelect:te,onDrag:G,onDragEnd:J,onRotate:$,onRotateEnd:P,onRename:Y})}});var $e=A(we);{var Ee=We=>{var M=bt(),Z=Re(M);Me(Z,1,()=>n(g),Be,(ve,ge)=>{var Te=bt(),He=Re(Te);{var Ue=De=>{var mt=id();V(()=>{x(mt,"x1",(n(ge),v(()=>n(ge).firstClearRay.from.x))),x(mt,"y1",(n(ge),v(()=>n(ge).firstClearRay.from.y))),x(mt,"x2",(n(ge),v(()=>n(ge).firstClearRay.to.x))),x(mt,"y2",(n(ge),v(()=>n(ge).firstClearRay.to.y)))}),L(De,mt)},me=De=>{var mt=od();V(()=>{x(mt,"x1",(n(f),v(()=>n(f).x))),x(mt,"y1",(n(f),v(()=>n(f).y))),x(mt,"x2",(n(ge),v(()=>n(ge).target.x))),x(mt,"y2",(n(ge),v(()=>n(ge).target.y)))}),L(De,mt)};be(He,De=>{n(ge),v(()=>n(ge).firstClearRay)?De(Ue):De(me,!1)})}L(ve,Te)}),L(We,M)};be($e,We=>{o(),n(f),n(g),v(()=>o()&&n(f)&&n(g).length>0)&&We(Ee)})}var tt=A($e);{var Ct=We=>{ms(We,{id:"phantom",get x(){return n(I),v(()=>n(I).x)},get y(){return n(I),v(()=>n(I).y)},get baseType(){return n(I),v(()=>n(I).baseType)},get playerId(){return n(w)},rotation:0,selected:!1,get screenToSvg(){return n(Le)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};be(tt,We=>{n(I)&&We(Ct)})}L(z,et)}}});var at=A(Tt,2),Ge=E(at),wt=E(Ge),rn=A(Ge,2);{var on=z=>{var _e=cd(),Le=E(_e);V(et=>Ce(Le,`Selected model LOS: ${et??""}/${n(g),v(()=>n(g).length)??""} visible`),[()=>(n(g),v(()=>n(g).filter(et=>et.canSee).length))]),L(z,_e)};be(rn,z=>{o(),n(f),n(g),v(()=>o()&&n(f)&&n(g).length>0)&&z(on)})}V(()=>Ce(wt,`Battlefield: 60" x 44" | ${s(),v(()=>s().length)??""} terrain | ${i(),v(()=>i().length)??""} walls | ${a(),v(()=>a().length)??""} models`)),L(e,H),Ht(),d()}function dd(e,t){Yt(t,!1);let a=O("main");function r(){const c=window.location.hash;c==="#/debug"?_(a,"debug"):c==="#/setup"?_(a,"setup"):c==="#/deployment"?_(a,"deployment"):c==="#/"||c==="#/layout"?_(a,"main"):_(a,"setup")}ja(()=>(r(),window.addEventListener("hashchange",r),()=>window.removeEventListener("hashchange",r))),Kt();var s=bt(),i=Re(s);{var o=c=>{ud(c,{})},l=c=>{var m=bt(),d=Re(m);{var f=h=>{dm(h,{})},u=h=>{var y=bt(),g=Re(y);{var p=k=>{Vu(k,{})},S=k=>{Kc(k,{})};be(g,k=>{n(a)==="deployment"?k(p):k(S,!1)},!0)}L(h,y)};be(d,h=>{n(a)==="setup"?h(f):h(u,!1)},!0)}L(c,m)};be(i,c=>{n(a)==="debug"?c(o):c(l,!1)})}L(e,s),Ht()}El(dd,{target:document.getElementById("app")});
//# sourceMappingURL=index-DGzVnxdx.js.map
