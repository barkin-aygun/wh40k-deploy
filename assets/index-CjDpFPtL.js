(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=a(s);fetch(s.href,i)}})();const Nr=!1;var js=Array.isArray,sl=Array.prototype.indexOf,_r=Array.from,Bi=Object.defineProperty,Za=Object.getOwnPropertyDescriptor,qi=Object.getOwnPropertyDescriptors,rl=Object.prototype,il=Array.prototype,Vr=Object.getPrototypeOf,vi=Object.isExtensible;const Wa=()=>{};function ol(t){return t()}function hr(t){for(var n=0;n<t.length;n++)t[n]()}function Ui(){var t,n,a=new Promise((r,s)=>{t=r,n=s});return{promise:a,resolve:t,reject:n}}const yn=2,fr=4,Qs=8,Ki=1<<24,La=16,Da=32,ls=64,jr=128,Qn=512,fn=1024,Rn=2048,ga=4096,Hn=8192,Ca=16384,Qr=32768,As=65536,gi=1<<17,Gi=1<<18,Ds=1<<19,zi=1<<20,Aa=1<<25,ss=32768,Or=1<<21,Jr=1<<22,Ya=1<<23,Ma=Symbol("$state"),ll=Symbol("legacy props"),cl=Symbol(""),Ts=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function wr(){throw new Error("https://svelte.dev/e/invalid_default_snippet")}function Zr(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function ul(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function ml(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function dl(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function hl(t){throw new Error("https://svelte.dev/e/effect_orphan")}function fl(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function yl(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function pl(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function vl(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function gl(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function bl(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Tl=1,xl=2,Xi=4,_l=8,wl=16,Sl=1,Al=2,Cl=4,Ml=8,El=16,Vi=1,Rl=2,hn=Symbol(),kl="http://www.w3.org/1999/xhtml";function Ll(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Dl(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function ji(t){return t===this.v}function Qi(t,n){return t!=t?n==n:t!==n||t!==null&&typeof t=="object"||typeof t=="function"}function Ji(t){return!Qi(t,this.v)}let Is=!1,Il=!1;function $l(){Is=!0}let Bt=null;function Cs(t){Bt=t}function bn(t,n=!1,a){Bt={p:Bt,i:!1,c:null,e:null,s:t,x:null,l:Is&&!n?{s:null,u:null,$:[]}:null}}function Tn(t){var n=Bt,a=n.e;if(a!==null){n.e=null;for(var r of a)po(r)}return t!==void 0&&(n.x=t),n.i=!0,Bt=n.p,t??{}}function Js(){return!Is||Bt!==null&&Bt.l===null}let Ja=[];function Zi(){var t=Ja;Ja=[],hr(t)}function $s(t){if(Ja.length===0&&!Us){var n=Ja;queueMicrotask(()=>{n===Ja&&Zi()})}Ja.push(t)}function Pl(){for(;Ja.length>0;)Zi()}function eo(t){var n=Ct;if(n===null)return ft.f|=Ya,t;if((n.f&Qr)===0){if((n.f&jr)===0)throw t;n.b.error(t)}else Ms(t,n)}function Ms(t,n){for(;n!==null;){if((n.f&jr)!==0)try{n.b.error(t);return}catch(a){t=a}n=n.parent}throw t}const Nl=-7169;function cn(t,n){t.f=t.f&Nl|n}function ei(t){(t.f&Qn)!==0||t.deps===null?cn(t,fn):cn(t,ga)}function to(t){if(t!==null)for(const n of t)(n.f&yn)===0||(n.f&ss)===0||(n.f^=ss,to(n.deps))}function no(t,n,a){(t.f&Rn)!==0?n.add(t):(t.f&ga)!==0&&a.add(t),to(t.deps),cn(t,fn)}const ar=new Set;let wt=null,qs=null,aa=null,Gn=[],Sr=null,Wr=!1,Us=!1;class fa{committed=!1;current=new Map;previous=new Map;#t=new Set;#i=new Set;#e=0;#s=0;#r=null;#a=new Set;#n=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#s>0}process(n){Gn=[],qs=null,this.apply();var a=[],r=[];for(const s of n)this.#o(s,a,r);this.is_fork||this.#c(),this.is_deferred()?(this.#l(r),this.#l(a)):(qs=this,wt=null,bi(r),bi(a),qs=null,this.#r?.resolve()),aa=null}#o(n,a,r){n.f^=fn;for(var s=n.first,i=null;s!==null;){var o=s.f,l=(o&(Da|ls))!==0,c=l&&(o&fn)!==0,d=c||(o&Hn)!==0||this.skipped_effects.has(s);if(!d&&s.fn!==null){l?s.f^=fn:i!==null&&(o&(fr|Qs|Ki))!==0?i.b.defer_effect(s):(o&fr)!==0?a.push(s):Ns(s)&&((o&La)!==0&&this.#a.add(s),Es(s));var m=s.first;if(m!==null){s=m;continue}}var f=s.parent;for(s=s.next;s===null&&f!==null;)f===i&&(i=null),s=f.next,f=f.parent}}#l(n){for(var a=0;a<n.length;a+=1)no(n[a],this.#a,this.#n)}capture(n,a){a!==hn&&!this.previous.has(n)&&this.previous.set(n,a),(n.f&Ya)===0&&(this.current.set(n,n.v),aa?.set(n,n.v))}activate(){wt=this,this.apply()}deactivate(){wt===this&&(wt=null,aa=null)}flush(){if(this.activate(),Gn.length>0){if(ao(),wt!==null&&wt!==this)return}else this.#e===0&&this.process([]);this.deactivate()}discard(){for(const n of this.#i)n(this);this.#i.clear()}#c(){if(this.#s===0){for(const n of this.#t)n();this.#t.clear()}this.#e===0&&this.#u()}#u(){if(ar.size>1){this.previous.clear();var n=aa,a=!0;for(const s of ar){if(s===this){a=!1;continue}const i=[];for(const[l,c]of this.current){if(s.current.has(l))if(a&&c!==s.current.get(l))s.current.set(l,c);else continue;i.push(l)}if(i.length===0)continue;const o=[...s.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var r=Gn;Gn=[];const l=new Set,c=new Map;for(const d of i)so(d,o,l,c);if(Gn.length>0){wt=s,s.apply();for(const d of Gn)s.#o(d,[],[]);s.deactivate()}Gn=r}}wt=null,aa=n}this.committed=!0,ar.delete(this)}increment(n){this.#e+=1,n&&(this.#s+=1)}decrement(n){this.#e-=1,n&&(this.#s-=1),this.revive()}revive(){for(const n of this.#a)this.#n.delete(n),cn(n,Rn),ka(n);for(const n of this.#n)cn(n,ga),ka(n);this.flush()}oncommit(n){this.#t.add(n)}ondiscard(n){this.#i.add(n)}settled(){return(this.#r??=Ui()).promise}static ensure(){if(wt===null){const n=wt=new fa;ar.add(wt),Us||fa.enqueue(()=>{wt===n&&n.flush()})}return wt}static enqueue(n){$s(n)}apply(){}}function Ol(t){var n=Us;Us=!0;try{for(var a;;){if(Pl(),Gn.length===0&&(wt?.flush(),Gn.length===0))return Sr=null,a;ao()}}finally{Us=n}}function ao(){var t=ts;Wr=!0;var n=null;try{var a=0;for(pr(!0);Gn.length>0;){var r=fa.ensure();if(a++>1e3){var s,i;Wl()}r.process(Gn),Ha.clear()}}finally{Wr=!1,pr(t),Sr=null}}function Wl(){try{fl()}catch(t){Ms(t,Sr)}}let xa=null;function bi(t){var n=t.length;if(n!==0){for(var a=0;a<n;){var r=t[a++];if((r.f&(Ca|Hn))===0&&Ns(r)&&(xa=new Set,Es(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?To(r):r.fn=null),xa?.size>0)){Ha.clear();for(const s of xa){if((s.f&(Ca|Hn))!==0)continue;const i=[s];let o=s.parent;for(;o!==null;)xa.has(o)&&(xa.delete(o),i.push(o)),o=o.parent;for(let l=i.length-1;l>=0;l--){const c=i[l];(c.f&(Ca|Hn))===0&&Es(c)}}xa.clear()}}xa=null}}function so(t,n,a,r){if(!a.has(t)&&(a.add(t),t.reactions!==null))for(const s of t.reactions){const i=s.f;(i&yn)!==0?so(s,n,a,r):(i&(Jr|La))!==0&&(i&Rn)===0&&ro(s,n,r)&&(cn(s,Rn),ka(s))}}function ro(t,n,a){const r=a.get(t);if(r!==void 0)return r;if(t.deps!==null)for(const s of t.deps){if(n.includes(s))return!0;if((s.f&yn)!==0&&ro(s,n,a))return a.set(s,!0),!0}return a.set(t,!1),!1}function ka(t){for(var n=Sr=t;n.parent!==null;){n=n.parent;var a=n.f;if(Wr&&n===Ct&&(a&La)!==0&&(a&Gi)===0)return;if((a&(ls|Da))!==0){if((a&fn)===0)return;n.f^=fn}}Gn.push(n)}function Yl(t){let n=0,a=rs(0),r;return()=>{ai()&&(e(a),Ps(()=>(n===0&&(r=h(()=>t(()=>Ks(a)))),n+=1,()=>{$s(()=>{n-=1,n===0&&(r?.(),r=void 0,Ks(a))})})))}}var Hl=As|Ds|jr;function Fl(t,n,a){new Bl(t,n,a)}class Bl{parent;is_pending=!1;#t;#i=null;#e;#s;#r;#a=null;#n=null;#o=null;#l=null;#c=null;#u=0;#m=0;#h=!1;#f=new Set;#y=new Set;#d=null;#T=Yl(()=>(this.#d=rs(this.#u),()=>{this.#d=null}));constructor(n,a,r){this.#t=n,this.#e=a,this.#s=r,this.parent=Ct.b,this.is_pending=!!this.#e.pending,this.#r=si(()=>{Ct.b=this;{var s=this.#g();try{this.#a=zn(()=>r(s))}catch(i){this.error(i)}this.#m>0?this.#v():this.is_pending=!1}return()=>{this.#c?.remove()}},Hl)}#x(){try{this.#a=zn(()=>this.#s(this.#t))}catch(n){this.error(n)}}#_(){const n=this.#e.pending;n&&(this.#n=zn(()=>n(this.#t)),fa.enqueue(()=>{var a=this.#g();this.#a=this.#p(()=>(fa.ensure(),zn(()=>this.#s(a)))),this.#m>0?this.#v():(es(this.#n,()=>{this.#n=null}),this.is_pending=!1)}))}#g(){var n=this.#t;return this.is_pending&&(this.#c=Ea(),this.#t.before(this.#c),n=this.#c),n}defer_effect(n){no(n,this.#f,this.#y)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#e.pending}#p(n){var a=Ct,r=ft,s=Bt;va(this.#r),Dn(this.#r),Cs(this.#r.ctx);try{return n()}catch(i){return eo(i),null}finally{va(a),Dn(r),Cs(s)}}#v(){const n=this.#e.pending;this.#a!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#c),wo(this.#a,this.#l)),this.#n===null&&(this.#n=zn(()=>n(this.#t)))}#b(n){if(!this.has_pending_snippet()){this.parent&&this.parent.#b(n);return}if(this.#m+=n,this.#m===0){this.is_pending=!1;for(const a of this.#f)cn(a,Rn),ka(a);for(const a of this.#y)cn(a,ga),ka(a);this.#f.clear(),this.#y.clear(),this.#n&&es(this.#n,()=>{this.#n=null}),this.#l&&(this.#t.before(this.#l),this.#l=null)}}update_pending_count(n){this.#b(n),this.#u+=n,this.#d&&is(this.#d,this.#u)}get_effect_pending(){return this.#T(),e(this.#d)}error(n){var a=this.#e.onerror;let r=this.#e.failed;if(this.#h||!a&&!r)throw n;this.#a&&(In(this.#a),this.#a=null),this.#n&&(In(this.#n),this.#n=null),this.#o&&(In(this.#o),this.#o=null);var s=!1,i=!1;const o=()=>{if(s){Dl();return}s=!0,i&&bl(),fa.ensure(),this.#u=0,this.#o!==null&&es(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#a=this.#p(()=>(this.#h=!1,zn(()=>this.#s(this.#t)))),this.#m>0?this.#v():this.is_pending=!1};var l=ft;try{Dn(null),i=!0,a?.(n,o),i=!1}catch(c){Ms(c,this.#r&&this.#r.parent)}finally{Dn(l)}r&&$s(()=>{this.#o=this.#p(()=>{fa.ensure(),this.#h=!0;try{return zn(()=>{r(this.#t,()=>n,()=>o)})}catch(c){return Ms(c,this.#r.parent),null}finally{this.#h=!1}})})}}function ql(t,n,a,r){const s=Js()?Ar:We;if(a.length===0&&t.length===0){r(n.map(s));return}var i=wt,o=Ct,l=Ul();function c(){Promise.all(a.map(d=>Kl(d))).then(d=>{l();try{r([...n.map(s),...d])}catch(m){(o.f&Ca)===0&&Ms(m,o)}i?.deactivate(),yr()}).catch(d=>{Ms(d,o)})}t.length>0?Promise.all(t).then(()=>{l();try{return c()}finally{i?.deactivate(),yr()}}):c()}function Ul(){var t=Ct,n=ft,a=Bt,r=wt;return function(i=!0){va(t),Dn(n),Cs(a),i&&r?.activate()}}function yr(){va(null),Dn(null),Cs(null)}function Ar(t){var n=yn|Rn,a=ft!==null&&(ft.f&yn)!==0?ft:null;return Ct!==null&&(Ct.f|=Ds),{ctx:Bt,deps:null,effects:null,equals:ji,f:n,fn:t,reactions:null,rv:0,v:hn,wv:0,parent:a??Ct,ac:null}}function Kl(t,n,a){let r=Ct;r===null&&ul();var s=r.b,i=void 0,o=rs(hn),l=!ft,c=new Map;return tc(()=>{var d=Ui();i=d.promise;try{Promise.resolve(t()).then(d.resolve,d.reject).then(()=>{m===wt&&m.committed&&m.deactivate(),yr()})}catch(y){d.reject(y),yr()}var m=wt;if(l){var f=s.is_rendered();s.update_pending_count(1),m.increment(f),c.get(m)?.reject(Ts),c.delete(m),c.set(m,d)}const u=(y,g=void 0)=>{if(m.activate(),g)g!==Ts&&(o.f|=Ya,is(o,g));else{(o.f&Ya)!==0&&(o.f^=Ya),is(o,y);for(const[T,x]of c){if(c.delete(T),T===m)break;x.reject(Ts)}}l&&(s.update_pending_count(-1),m.decrement(f))};d.promise.then(u,y=>u(null,y||"unknown"))}),er(()=>{for(const d of c.values())d.reject(Ts)}),new Promise(d=>{function m(f){function u(){f===i?d(o):m(i)}f.then(u,u)}m(i)})}function We(t){const n=Ar(t);return n.equals=Ji,n}function io(t){var n=t.effects;if(n!==null){t.effects=null;for(var a=0;a<n.length;a+=1)In(n[a])}}function Gl(t){for(var n=t.parent;n!==null;){if((n.f&yn)===0)return(n.f&Ca)===0?n:null;n=n.parent}return null}function ti(t){var n,a=Ct;va(Gl(t));try{t.f&=~ss,io(t),n=Eo(t)}finally{va(a)}return n}function oo(t){var n=ti(t);if(!t.equals(n)&&(t.wv=Co(),(!wt?.is_fork||t.deps===null)&&(t.v=n,t.deps===null))){cn(t,fn);return}Ba||(aa!==null?(ai()||wt?.is_fork)&&aa.set(t,n):ei(t))}let Yr=new Set;const Ha=new Map;let lo=!1;function rs(t,n){var a={f:0,v:t,reactions:null,equals:ji,rv:0,wv:0};return a}function Ia(t,n){const a=rs(t);return rc(a),a}function N(t,n=!1,a=!0){const r=rs(t);return n||(r.equals=Ji),Is&&a&&Bt!==null&&Bt.l!==null&&(Bt.l.s??=[]).push(r),r}function Lr(t,n){return v(t,h(()=>e(t))),n}function v(t,n,a=!1){ft!==null&&(!sa||(ft.f&gi)!==0)&&Js()&&(ft.f&(yn|La|Jr|gi))!==0&&!Ra?.includes(t)&&gl();let r=a?xs(n):n;return is(t,r)}function is(t,n){if(!t.equals(n)){var a=t.v;Ba?Ha.set(t,n):Ha.set(t,a),t.v=n;var r=fa.ensure();if(r.capture(t,a),(t.f&yn)!==0){const s=t;(t.f&Rn)!==0&&ti(s),ei(s)}t.wv=Co(),co(t,Rn),Js()&&Ct!==null&&(Ct.f&fn)!==0&&(Ct.f&(Da|ls))===0&&(Kn===null?ic([t]):Kn.push(t)),!r.is_fork&&Yr.size>0&&!lo&&zl()}return n}function zl(){lo=!1;var t=ts;pr(!0);const n=Array.from(Yr);try{for(const a of n)(a.f&fn)!==0&&cn(a,ga),Ns(a)&&Es(a)}finally{pr(t)}Yr.clear()}function Ks(t){v(t,t.v+1)}function co(t,n){var a=t.reactions;if(a!==null)for(var r=Js(),s=a.length,i=0;i<s;i++){var o=a[i],l=o.f;if(!(!r&&o===Ct)){var c=(l&Rn)===0;if(c&&cn(o,n),(l&yn)!==0){var d=o;aa?.delete(d),(l&ss)===0&&(l&Qn&&(o.f|=ss),co(d,ga))}else c&&((l&La)!==0&&xa!==null&&xa.add(o),ka(o))}}}function xs(t){if(typeof t!="object"||t===null||Ma in t)return t;const n=Vr(t);if(n!==rl&&n!==il)return t;var a=new Map,r=js(t),s=Ia(0),i=ns,o=l=>{if(ns===i)return l();var c=ft,d=ns;Dn(null),wi(i);var m=l();return Dn(c),wi(d),m};return r&&a.set("length",Ia(t.length)),new Proxy(t,{defineProperty(l,c,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&pl();var m=a.get(c);return m===void 0?m=o(()=>{var f=Ia(d.value);return a.set(c,f),f}):v(m,d.value,!0),!0},deleteProperty(l,c){var d=a.get(c);if(d===void 0){if(c in l){const m=o(()=>Ia(hn));a.set(c,m),Ks(s)}}else v(d,hn),Ks(s);return!0},get(l,c,d){if(c===Ma)return t;var m=a.get(c),f=c in l;if(m===void 0&&(!f||Za(l,c)?.writable)&&(m=o(()=>{var y=xs(f?l[c]:hn),g=Ia(y);return g}),a.set(c,m)),m!==void 0){var u=e(m);return u===hn?void 0:u}return Reflect.get(l,c,d)},getOwnPropertyDescriptor(l,c){var d=Reflect.getOwnPropertyDescriptor(l,c);if(d&&"value"in d){var m=a.get(c);m&&(d.value=e(m))}else if(d===void 0){var f=a.get(c),u=f?.v;if(f!==void 0&&u!==hn)return{enumerable:!0,configurable:!0,value:u,writable:!0}}return d},has(l,c){if(c===Ma)return!0;var d=a.get(c),m=d!==void 0&&d.v!==hn||Reflect.has(l,c);if(d!==void 0||Ct!==null&&(!m||Za(l,c)?.writable)){d===void 0&&(d=o(()=>{var u=m?xs(l[c]):hn,y=Ia(u);return y}),a.set(c,d));var f=e(d);if(f===hn)return!1}return m},set(l,c,d,m){var f=a.get(c),u=c in l;if(r&&c==="length")for(var y=d;y<f.v;y+=1){var g=a.get(y+"");g!==void 0?v(g,hn):y in l&&(g=o(()=>Ia(hn)),a.set(y+"",g))}if(f===void 0)(!u||Za(l,c)?.writable)&&(f=o(()=>Ia(void 0)),v(f,xs(d)),a.set(c,f));else{u=f.v!==hn;var T=o(()=>xs(d));v(f,T)}var x=Reflect.getOwnPropertyDescriptor(l,c);if(x?.set&&x.set.call(m,d),!u){if(r&&typeof c=="string"){var C=a.get("length"),D=Number(c);Number.isInteger(D)&&D>=C.v&&v(C,D+1)}Ks(s)}return!0},ownKeys(l){e(s);var c=Reflect.ownKeys(l).filter(f=>{var u=a.get(f);return u===void 0||u.v!==hn});for(var[d,m]of a)m.v!==hn&&!(d in l)&&c.push(d);return c},setPrototypeOf(){vl()}})}function Ti(t){try{if(t!==null&&typeof t=="object"&&Ma in t)return t[Ma]}catch{}return t}function Xl(t,n){return Object.is(Ti(t),Ti(n))}var _s,uo,mo,ho;function Vl(){if(_s===void 0){_s=window,uo=/Firefox/.test(navigator.userAgent);var t=Element.prototype,n=Node.prototype,a=Text.prototype;mo=Za(n,"firstChild").get,ho=Za(n,"nextSibling").get,vi(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),vi(a)&&(a.__t=void 0)}}function Ea(t=""){return document.createTextNode(t)}function wa(t){return mo.call(t)}function Zs(t){return ho.call(t)}function _(t,n){return wa(t)}function Ce(t,n=!1){{var a=wa(t);return a instanceof Comment&&a.data===""?Zs(a):a}}function b(t,n=1,a=!1){let r=t;for(;n--;)r=Zs(r);return r}function jl(t){t.textContent=""}function fo(){return!1}let xi=!1;function Ql(){xi||(xi=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const n of t.target.elements)n.__on_r?.()})},{capture:!0}))}function Cr(t){var n=ft,a=Ct;Dn(null),va(null);try{return t()}finally{Dn(n),va(a)}}function ni(t,n,a,r=a){t.addEventListener(n,()=>Cr(a));const s=t.__on_r;s?t.__on_r=()=>{s(),r(!0)}:t.__on_r=()=>r(!0),Ql()}function yo(t){Ct===null&&(ft===null&&hl(),dl()),Ba&&ml()}function Jl(t,n){var a=n.last;a===null?n.last=n.first=t:(a.next=t,t.prev=a,n.last=t)}function ba(t,n,a){var r=Ct;r!==null&&(r.f&Hn)!==0&&(t|=Hn);var s={ctx:Bt,deps:null,nodes:null,f:t|Rn|Qn,first:null,fn:n,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(a)try{Es(s),s.f|=Qr}catch(l){throw In(s),l}else n!==null&&ka(s);var i=s;if(a&&i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&Ds)===0&&(i=i.first,(t&La)!==0&&(t&As)!==0&&i!==null&&(i.f|=As)),i!==null&&(i.parent=r,r!==null&&Jl(i,r),ft!==null&&(ft.f&yn)!==0&&(t&ls)===0)){var o=ft;(o.effects??=[]).push(i)}return s}function ai(){return ft!==null&&!sa}function er(t){const n=ba(Qs,null,!1);return cn(n,fn),n.teardown=t,n}function Hr(t){yo();var n=Ct.f,a=!ft&&(n&Da)!==0&&(n&Qr)===0;if(a){var r=Bt;(r.e??=[]).push(t)}else return po(t)}function po(t){return ba(fr|zi,t,!1)}function Zl(t){return yo(),ba(Qs|zi,t,!0)}function ec(t){fa.ensure();const n=ba(ls|Ds,t,!0);return(a={})=>new Promise(r=>{a.outro?es(n,()=>{In(n),r(void 0)}):(In(n),r(void 0))})}function vo(t){return ba(fr,t,!1)}function ce(t,n){var a=Bt,r={effect:null,ran:!1,deps:t};a.l.$.push(r),r.effect=Ps(()=>{t(),!r.ran&&(r.ran=!0,h(n))})}function ia(){var t=Bt;Ps(()=>{for(var n of t.l.$){n.deps();var a=n.effect;(a.f&fn)!==0&&a.deps!==null&&cn(a,ga),Ns(a)&&Es(a),n.ran=!1}})}function tc(t){return ba(Jr|Ds,t,!0)}function Ps(t,n=0){return ba(Qs|n,t,!0)}function G(t,n=[],a=[],r=[]){ql(r,n,a,s=>{ba(Qs,()=>t(...s.map(e)),!0)})}function si(t,n=0){var a=ba(La|n,t,!0);return a}function zn(t){return ba(Da|Ds,t,!0)}function go(t){var n=t.teardown;if(n!==null){const a=Ba,r=ft;_i(!0),Dn(null);try{n.call(null)}finally{_i(a),Dn(r)}}}function bo(t,n=!1){var a=t.first;for(t.first=t.last=null;a!==null;){const s=a.ac;s!==null&&Cr(()=>{s.abort(Ts)});var r=a.next;(a.f&ls)!==0?a.parent=null:In(a,n),a=r}}function nc(t){for(var n=t.first;n!==null;){var a=n.next;(n.f&Da)===0&&In(n),n=a}}function In(t,n=!0){var a=!1;(n||(t.f&Gi)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(ac(t.nodes.start,t.nodes.end),a=!0),bo(t,n&&!a),vr(t,0),cn(t,Ca);var r=t.nodes&&t.nodes.t;if(r!==null)for(const i of r)i.stop();go(t);var s=t.parent;s!==null&&s.first!==null&&To(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function ac(t,n){for(;t!==null;){var a=t===n?null:Zs(t);t.remove(),t=a}}function To(t){var n=t.parent,a=t.prev,r=t.next;a!==null&&(a.next=r),r!==null&&(r.prev=a),n!==null&&(n.first===t&&(n.first=r),n.last===t&&(n.last=a))}function es(t,n,a=!0){var r=[];xo(t,r,!0);var s=()=>{a&&In(t),n&&n()},i=r.length;if(i>0){var o=()=>--i||s();for(var l of r)l.out(o)}else s()}function xo(t,n,a){if((t.f&Hn)===0){t.f^=Hn;var r=t.nodes&&t.nodes.t;if(r!==null)for(const l of r)(l.is_global||a)&&n.push(l);for(var s=t.first;s!==null;){var i=s.next,o=(s.f&As)!==0||(s.f&Da)!==0&&(t.f&La)!==0;xo(s,n,o?a:!1),s=i}}}function ri(t){_o(t,!0)}function _o(t,n){if((t.f&Hn)!==0){t.f^=Hn,(t.f&fn)===0&&(cn(t,Rn),ka(t));for(var a=t.first;a!==null;){var r=a.next,s=(a.f&As)!==0||(a.f&Da)!==0;_o(a,s?n:!1),a=r}var i=t.nodes&&t.nodes.t;if(i!==null)for(const o of i)(o.is_global||n)&&o.in()}}function wo(t,n){if(t.nodes)for(var a=t.nodes.start,r=t.nodes.end;a!==null;){var s=a===r?null:Zs(a);n.append(a),a=s}}let bs=null;function sc(t){var n=bs;try{if(bs=new Set,h(t),n!==null)for(var a of bs)n.add(a);return bs}finally{bs=n}}function So(t){for(var n of sc(t))is(n,n.v)}let ts=!1;function pr(t){ts=t}let Ba=!1;function _i(t){Ba=t}let ft=null,sa=!1;function Dn(t){ft=t}let Ct=null;function va(t){Ct=t}let Ra=null;function rc(t){ft!==null&&(Ra===null?Ra=[t]:Ra.push(t))}let Mn=null,Nn=0,Kn=null;function ic(t){Kn=t}let Ao=1,zs=0,ns=zs;function wi(t){ns=t}function Co(){return++Ao}function Ns(t){var n=t.f;if((n&Rn)!==0)return!0;if(n&yn&&(t.f&=~ss),(n&ga)!==0){for(var a=t.deps,r=a.length,s=0;s<r;s++){var i=a[s];if(Ns(i)&&oo(i),i.wv>t.wv)return!0}(n&Qn)!==0&&aa===null&&cn(t,fn)}return!1}function Mo(t,n,a=!0){var r=t.reactions;if(r!==null&&!Ra?.includes(t))for(var s=0;s<r.length;s++){var i=r[s];(i.f&yn)!==0?Mo(i,n,!1):n===i&&(a?cn(i,Rn):(i.f&fn)!==0&&cn(i,ga),ka(i))}}function Eo(t){var n=Mn,a=Nn,r=Kn,s=ft,i=Ra,o=Bt,l=sa,c=ns,d=t.f;Mn=null,Nn=0,Kn=null,ft=(d&(Da|ls))===0?t:null,Ra=null,Cs(t.ctx),sa=!1,ns=++zs,t.ac!==null&&(Cr(()=>{t.ac.abort(Ts)}),t.ac=null);try{t.f|=Or;var m=t.fn,f=m(),u=t.deps;if(Mn!==null){var y;if(vr(t,Nn),u!==null&&Nn>0)for(u.length=Nn+Mn.length,y=0;y<Mn.length;y++)u[Nn+y]=Mn[y];else t.deps=u=Mn;if(ai()&&(t.f&Qn)!==0)for(y=Nn;y<u.length;y++)(u[y].reactions??=[]).push(t)}else u!==null&&Nn<u.length&&(vr(t,Nn),u.length=Nn);if(Js()&&Kn!==null&&!sa&&u!==null&&(t.f&(yn|ga|Rn))===0)for(y=0;y<Kn.length;y++)Mo(Kn[y],t);return s!==null&&s!==t&&(zs++,Kn!==null&&(r===null?r=Kn:r.push(...Kn))),(t.f&Ya)!==0&&(t.f^=Ya),f}catch(g){return eo(g)}finally{t.f^=Or,Mn=n,Nn=a,Kn=r,ft=s,Ra=i,Cs(o),sa=l,ns=c}}function oc(t,n){let a=n.reactions;if(a!==null){var r=sl.call(a,t);if(r!==-1){var s=a.length-1;s===0?a=n.reactions=null:(a[r]=a[s],a.pop())}}if(a===null&&(n.f&yn)!==0&&(Mn===null||!Mn.includes(n))){var i=n;(i.f&Qn)!==0&&(i.f^=Qn,i.f&=~ss),ei(i),io(i),vr(i,0)}}function vr(t,n){var a=t.deps;if(a!==null)for(var r=n;r<a.length;r++)oc(t,a[r])}function Es(t){var n=t.f;if((n&Ca)===0){cn(t,fn);var a=Ct,r=ts;Ct=t,ts=!0;try{(n&(La|Ki))!==0?nc(t):bo(t),go(t);var s=Eo(t);t.teardown=typeof s=="function"?s:null,t.wv=Ao;var i;Nr&&Il&&(t.f&Rn)!==0&&t.deps}finally{ts=r,Ct=a}}}async function lc(){await Promise.resolve(),Ol()}function e(t){var n=t.f,a=(n&yn)!==0;if(bs?.add(t),ft!==null&&!sa){var r=Ct!==null&&(Ct.f&Ca)!==0;if(!r&&!Ra?.includes(t)){var s=ft.deps;if((ft.f&Or)!==0)t.rv<zs&&(t.rv=zs,Mn===null&&s!==null&&s[Nn]===t?Nn++:Mn===null?Mn=[t]:Mn.includes(t)||Mn.push(t));else{(ft.deps??=[]).push(t);var i=t.reactions;i===null?t.reactions=[ft]:i.includes(ft)||i.push(ft)}}}if(Ba&&Ha.has(t))return Ha.get(t);if(a){var o=t;if(Ba){var l=o.v;return((o.f&fn)===0&&o.reactions!==null||ko(o))&&(l=ti(o)),Ha.set(o,l),l}var c=(o.f&Qn)===0&&!sa&&ft!==null&&(ts||(ft.f&Qn)!==0),d=o.deps===null;Ns(o)&&(c&&(o.f|=Qn),oo(o)),c&&!d&&Ro(o)}if(aa?.has(t))return aa.get(t);if((t.f&Ya)!==0)throw t.v;return t.v}function Ro(t){if(t.deps!==null){t.f|=Qn;for(const n of t.deps)(n.reactions??=[]).push(t),(n.f&yn)!==0&&(n.f&Qn)===0&&Ro(n)}}function ko(t){if(t.v===hn)return!0;if(t.deps===null)return!1;for(const n of t.deps)if(Ha.has(n)||(n.f&yn)!==0&&ko(n))return!0;return!1}function h(t){var n=sa;try{return sa=!0,t()}finally{sa=n}}function le(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Ma in t)Fr(t);else if(!Array.isArray(t))for(let n in t){const a=t[n];typeof a=="object"&&a&&Ma in a&&Fr(a)}}}function Fr(t,n=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!n.has(t)){n.add(t),t instanceof Date&&t.getTime();for(let r in t)try{Fr(t[r],n)}catch{}const a=Vr(t);if(a!==Object.prototype&&a!==Array.prototype&&a!==Map.prototype&&a!==Set.prototype&&a!==Date.prototype){const r=qi(a);for(let s in r){const i=r[s].get;if(i)try{i.call(t)}catch{}}}}}const cc=["touchstart","touchmove"];function uc(t){return cc.includes(t)}const mc=new Set,Si=new Set;function dc(t,n,a,r={}){function s(i){if(r.capture||Ys.call(n,i),!i.cancelBubble)return Cr(()=>a?.call(this,i))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?$s(()=>{n.addEventListener(t,s,r)}):n.addEventListener(t,s,r),s}function z(t,n,a,r,s){var i={capture:r,passive:s},o=dc(t,n,a,i);(n===document.body||n===window||n===document||n instanceof HTMLMediaElement)&&er(()=>{n.removeEventListener(t,o,i)})}let Ai=null;function Ys(t){var n=this,a=n.ownerDocument,r=t.type,s=t.composedPath?.()||[],i=s[0]||t.target;Ai=t;var o=0,l=Ai===t&&t.__root;if(l){var c=s.indexOf(l);if(c!==-1&&(n===document||n===window)){t.__root=n;return}var d=s.indexOf(n);if(d===-1)return;c<=d&&(o=c)}if(i=s[o]||t.target,i!==n){Bi(t,"currentTarget",{configurable:!0,get(){return i||a}});var m=ft,f=Ct;Dn(null),va(null);try{for(var u,y=[];i!==null;){var g=i.assignedSlot||i.parentNode||i.host||null;try{var T=i["__"+r];T!=null&&(!i.disabled||t.target===i)&&T.call(i,t)}catch(x){u?y.push(x):u=x}if(t.cancelBubble||g===n||g===null)break;i=g}if(u){for(let x of y)queueMicrotask(()=>{throw x});throw u}}finally{t.__root=n,delete t.currentTarget,Dn(m),va(f)}}}function Lo(t){var n=document.createElement("template");return n.innerHTML=t.replaceAll("<!>","<!---->"),n.content}function Rs(t,n){var a=Ct;a.nodes===null&&(a.nodes={start:t,end:n,a:null,t:null})}function he(t,n){var a=(n&Vi)!==0,r=(n&Rl)!==0,s,i=!t.startsWith("<!>");return()=>{s===void 0&&(s=Lo(i?t:"<!>"+t),a||(s=wa(s)));var o=r||uo?document.importNode(s,!0):s.cloneNode(!0);if(a){var l=wa(o),c=o.lastChild;Rs(l,c)}else Rs(o,o);return o}}function hc(t,n,a="svg"){var r=!t.startsWith("<!>"),s=(n&Vi)!==0,i=`<${a}>${r?t:"<!>"+t}</${a}>`,o;return()=>{if(!o){var l=Lo(i),c=wa(l);if(s)for(o=document.createDocumentFragment();wa(c);)o.appendChild(wa(c));else o=wa(c)}var d=o.cloneNode(!0);if(s){var m=wa(d),f=d.lastChild;Rs(m,f)}else Rs(d,d);return d}}function xe(t,n){return hc(t,n,"svg")}function ii(t=""){{var n=Ea(t+"");return Rs(n,n),n}}function Ot(){var t=document.createDocumentFragment(),n=document.createComment(""),a=Ea();return t.append(n,a),Rs(n,a),t}function k(t,n){t!==null&&t.before(n)}function we(t,n){var a=n==null?"":typeof n=="object"?n+"":n;a!==(t.__t??=t.nodeValue)&&(t.__t=a,t.nodeValue=a+"")}function fc(t,n){return yc(t,n)}const ps=new Map;function yc(t,{target:n,anchor:a,props:r={},events:s,context:i,intro:o=!0}){Vl();var l=new Set,c=f=>{for(var u=0;u<f.length;u++){var y=f[u];if(!l.has(y)){l.add(y);var g=uc(y);n.addEventListener(y,Ys,{passive:g});var T=ps.get(y);T===void 0?(document.addEventListener(y,Ys,{passive:g}),ps.set(y,1)):ps.set(y,T+1)}}};c(_r(mc)),Si.add(c);var d=void 0,m=ec(()=>{var f=a??n.appendChild(Ea());return Fl(f,{pending:()=>{}},u=>{if(i){bn({});var y=Bt;y.c=i}s&&(r.$$events=s),d=t(u,r)||{},i&&Tn()}),()=>{for(var u of l){n.removeEventListener(u,Ys);var y=ps.get(u);--y===0?(document.removeEventListener(u,Ys),ps.delete(u)):ps.set(u,y)}Si.delete(c),f!==a&&f.parentNode?.removeChild(f)}});return pc.set(d,m),d}let pc=new WeakMap;class vc{anchor;#t=new Map;#i=new Map;#e=new Map;#s=new Set;#r=!0;constructor(n,a=!0){this.anchor=n,this.#r=a}#a=()=>{var n=wt;if(this.#t.has(n)){var a=this.#t.get(n),r=this.#i.get(a);if(r)ri(r),this.#s.delete(a);else{var s=this.#e.get(a);s&&(this.#i.set(a,s.effect),this.#e.delete(a),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),r=s.effect)}for(const[i,o]of this.#t){if(this.#t.delete(i),i===n)break;const l=this.#e.get(o);l&&(In(l.effect),this.#e.delete(o))}for(const[i,o]of this.#i){if(i===a||this.#s.has(i))continue;const l=()=>{if(Array.from(this.#t.values()).includes(i)){var d=document.createDocumentFragment();wo(o,d),d.append(Ea()),this.#e.set(i,{effect:o,fragment:d})}else In(o);this.#s.delete(i),this.#i.delete(i)};this.#r||!r?(this.#s.add(i),es(o,l,!1)):l()}}};#n=n=>{this.#t.delete(n);const a=Array.from(this.#t.values());for(const[r,s]of this.#e)a.includes(r)||(In(s.effect),this.#e.delete(r))};ensure(n,a){var r=wt,s=fo();if(a&&!this.#i.has(n)&&!this.#e.has(n))if(s){var i=document.createDocumentFragment(),o=Ea();i.append(o),this.#e.set(n,{effect:zn(()=>a(o)),fragment:i})}else this.#i.set(n,zn(()=>a(this.anchor)));if(this.#t.set(r,n),s){for(const[l,c]of this.#i)l===n?r.skipped_effects.delete(c):r.skipped_effects.add(c);for(const[l,c]of this.#e)l===n?r.skipped_effects.delete(c.effect):r.skipped_effects.add(c.effect);r.oncommit(this.#a),r.ondiscard(this.#n)}else this.#a()}}function ie(t,n,a=!1){var r=new vc(t),s=a?As:0;function i(o,l){r.ensure(o,l)}si(()=>{var o=!1;n((l,c=!0)=>{o=!0,i(c,l)}),o||i(!1,null)},s)}function tt(t,n){return n}function gc(t,n,a){for(var r=[],s=n.length,i,o=n.length,l=0;l<s;l++){let f=n[l];es(f,()=>{if(i){if(i.pending.delete(f),i.done.add(f),i.pending.size===0){var u=t.outrogroups;Br(_r(i.done)),u.delete(i),u.size===0&&(t.outrogroups=null)}}else o-=1},!1)}if(o===0){var c=r.length===0&&a!==null;if(c){var d=a,m=d.parentNode;jl(m),m.append(d),t.items.clear()}Br(n,!c)}else i={pending:new Set(n),done:new Set},(t.outrogroups??=new Set).add(i)}function Br(t,n=!0){for(var a=0;a<t.length;a++)In(t[a],n)}var Ci;function Ie(t,n,a,r,s,i=null){var o=t,l=new Map,c=(n&Xi)!==0;if(c){var d=t;o=d.appendChild(Ea())}var m=null,f=We(()=>{var C=a();return js(C)?C:C==null?[]:_r(C)}),u,y=!0;function g(){x.fallback=m,bc(x,u,o,n,r),m!==null&&(u.length===0?(m.f&Aa)===0?ri(m):(m.f^=Aa,Hs(m,null,o)):es(m,()=>{m=null}))}var T=si(()=>{u=e(f);for(var C=u.length,D=new Set,R=wt,w=fo(),S=0;S<C;S+=1){var E=u[S],W=r(E,S),A=y?null:l.get(W);A?(A.v&&is(A.v,E),A.i&&is(A.i,S),w&&R.skipped_effects.delete(A.e)):(A=Tc(l,y?o:Ci??=Ea(),E,W,S,s,n,a),y||(A.e.f|=Aa),l.set(W,A)),D.add(W)}if(C===0&&i&&!m&&(y?m=zn(()=>i(o)):(m=zn(()=>i(Ci??=Ea())),m.f|=Aa)),!y)if(w){for(const[P,O]of l)D.has(P)||R.skipped_effects.add(O.e);R.oncommit(g),R.ondiscard(()=>{})}else g();e(f)}),x={effect:T,items:l,outrogroups:null,fallback:m};y=!1}function bc(t,n,a,r,s){var i=(r&_l)!==0,o=n.length,l=t.items,c=t.effect.first,d,m=null,f,u=[],y=[],g,T,x,C;if(i)for(C=0;C<o;C+=1)g=n[C],T=s(g,C),x=l.get(T).e,(x.f&Aa)===0&&(x.nodes?.a?.measure(),(f??=new Set).add(x));for(C=0;C<o;C+=1){if(g=n[C],T=s(g,C),x=l.get(T).e,t.outrogroups!==null)for(const O of t.outrogroups)O.pending.delete(x),O.done.delete(x);if((x.f&Aa)!==0)if(x.f^=Aa,x===c)Hs(x,null,a);else{var D=m?m.next:c;x===t.effect.last&&(t.effect.last=x.prev),x.prev&&(x.prev.next=x.next),x.next&&(x.next.prev=x.prev),$a(t,m,x),$a(t,x,D),Hs(x,D,a),m=x,u=[],y=[],c=m.next;continue}if((x.f&Hn)!==0&&(ri(x),i&&(x.nodes?.a?.unfix(),(f??=new Set).delete(x))),x!==c){if(d!==void 0&&d.has(x)){if(u.length<y.length){var R=y[0],w;m=R.prev;var S=u[0],E=u[u.length-1];for(w=0;w<u.length;w+=1)Hs(u[w],R,a);for(w=0;w<y.length;w+=1)d.delete(y[w]);$a(t,S.prev,E.next),$a(t,m,S),$a(t,E,R),c=R,m=E,C-=1,u=[],y=[]}else d.delete(x),Hs(x,c,a),$a(t,x.prev,x.next),$a(t,x,m===null?t.effect.first:m.next),$a(t,m,x),m=x;continue}for(u=[],y=[];c!==null&&c!==x;)(d??=new Set).add(c),y.push(c),c=c.next;if(c===null)continue}(x.f&Aa)===0&&u.push(x),m=x,c=x.next}if(t.outrogroups!==null){for(const O of t.outrogroups)O.pending.size===0&&(Br(_r(O.done)),t.outrogroups?.delete(O));t.outrogroups.size===0&&(t.outrogroups=null)}if(c!==null||d!==void 0){var W=[];if(d!==void 0)for(x of d)(x.f&Hn)===0&&W.push(x);for(;c!==null;)(c.f&Hn)===0&&c!==t.fallback&&W.push(c),c=c.next;var A=W.length;if(A>0){var P=(r&Xi)!==0&&o===0?a:null;if(i){for(C=0;C<A;C+=1)W[C].nodes?.a?.measure();for(C=0;C<A;C+=1)W[C].nodes?.a?.fix()}gc(t,W,P)}}i&&$s(()=>{if(f!==void 0)for(x of f)x.nodes?.a?.apply()})}function Tc(t,n,a,r,s,i,o,l){var c=(o&Tl)!==0?(o&wl)===0?N(a,!1,!1):rs(a):null,d=(o&xl)!==0?rs(s):null;return{v:c,i:d,e:zn(()=>(i(n,c??a,d??s,l),()=>{t.delete(r)}))}}function Hs(t,n,a){if(t.nodes)for(var r=t.nodes.start,s=t.nodes.end,i=n&&(n.f&Aa)===0?n.nodes.start:a;r!==null;){var o=Zs(r);if(i.before(r),r===s)return;r=o}}function $a(t,n,a){n===null?t.effect.first=a:n.next=a,a===null?t.effect.last=n:a.prev=n}function Do(t,n,a,r,s){var i=n.$$slots?.[a],o=!1;i===!0&&(i=n.children,o=!0),i===void 0||i(t,o?()=>r:r)}const Mi=[...` 	
\r\fÂ \v\uFEFF`];function xc(t,n,a){var r=t==null?"":""+t;if(a){for(var s in a)if(a[s])r=r?r+" "+s:s;else if(r.length)for(var i=s.length,o=0;(o=r.indexOf(s,o))>=0;){var l=o+i;(o===0||Mi.includes(r[o-1]))&&(l===r.length||Mi.includes(r[l]))?r=(o===0?"":r.substring(0,o))+r.substring(l+1):o=l}}return r===""?null:r}function _c(t,n){return t==null?null:String(t)}function mn(t,n,a,r,s,i){var o=t.__className;if(o!==a||o===void 0){var l=xc(a,r,i);l==null?t.removeAttribute("class"):n?t.className=l:t.setAttribute("class",l),t.__className=a}else if(i&&s!==i)for(var c in i){var d=!!i[c];(s==null||d!==!!s[c])&&t.classList.toggle(c,d)}return i}function wc(t,n,a,r){var s=t.__style;if(s!==n){var i=_c(n);i==null?t.removeAttribute("style"):t.style.cssText=i,t.__style=n}return r}function Io(t,n,a=!1){if(t.multiple){if(n==null)return;if(!js(n))return Ll();for(var r of t.options)r.selected=n.includes(Gs(r));return}for(r of t.options){var s=Gs(r);if(Xl(s,n)){r.selected=!0;return}}(!a||n!==void 0)&&(t.selectedIndex=-1)}function Sc(t){var n=new MutationObserver(()=>{Io(t,t.__value)});n.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),er(()=>{n.disconnect()})}function $o(t,n,a=n){var r=new WeakSet,s=!0;ni(t,"change",i=>{var o=i?"[selected]":":checked",l;if(t.multiple)l=[].map.call(t.querySelectorAll(o),Gs);else{var c=t.querySelector(o)??t.querySelector("option:not([disabled])");l=c&&Gs(c)}a(l),wt!==null&&r.add(wt)}),vo(()=>{var i=n();if(t===document.activeElement){var o=qs??wt;if(r.has(o))return}if(Io(t,i,s),s&&i===void 0){var l=t.querySelector(":checked");l!==null&&(i=Gs(l),a(i))}t.__value=i,s=!1}),Sc(t)}function Gs(t){return"__value"in t?t.__value:t.value}const Ac=Symbol("is custom element"),Cc=Symbol("is html");function Po(t,n){var a=No(t);a.value===(a.value=n??void 0)||t.value===n&&(n!==0||t.nodeName!=="PROGRESS")||(t.value=n??"")}function p(t,n,a,r){var s=No(t);s[n]!==(s[n]=a)&&(n==="loading"&&(t[cl]=a),a==null?t.removeAttribute(n):typeof a!="string"&&Mc(t).includes(n)?t[n]=a:t.setAttribute(n,a))}function No(t){return t.__attributes??={[Ac]:t.nodeName.includes("-"),[Cc]:t.namespaceURI===kl}}var Ei=new Map;function Mc(t){var n=t.getAttribute("is")||t.nodeName,a=Ei.get(n);if(a)return a;Ei.set(n,a=[]);for(var r,s=t,i=Element.prototype;i!==s;){r=qi(s);for(var o in r)r[o].set&&a.push(o);s=Vr(s)}return a}function An(t,n,a=n){var r=new WeakSet;ni(t,"input",async s=>{var i=s?t.defaultValue:t.value;if(i=Dr(t)?Ir(i):i,a(i),wt!==null&&r.add(wt),await lc(),i!==(i=n())){var o=t.selectionStart,l=t.selectionEnd,c=t.value.length;if(t.value=i??"",l!==null){var d=t.value.length;o===l&&l===c&&d>c?(t.selectionStart=d,t.selectionEnd=d):(t.selectionStart=o,t.selectionEnd=Math.min(l,d))}}}),h(n)==null&&t.value&&(a(Dr(t)?Ir(t.value):t.value),wt!==null&&r.add(wt)),Ps(()=>{var s=n();if(t===document.activeElement){var i=qs??wt;if(r.has(i))return}Dr(t)&&s===Ir(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function Xn(t,n,a=n){ni(t,"change",r=>{var s=r?t.defaultChecked:t.checked;a(s)}),h(n)==null&&a(t.checked),Ps(()=>{var r=n();t.checked=!!r})}function Dr(t){var n=t.type;return n==="number"||n==="range"}function Ir(t){return t===""?null:+t}function Fs(t,n,a){var r=Za(t,n);r&&r.set&&(t[n]=a,er(()=>{t[n]=null}))}function Ri(t,n){return t===n||t?.[Ma]===n}function Xs(t={},n,a,r){return vo(()=>{var s,i;return Ps(()=>{s=i,i=[],h(()=>{t!==a(...i)&&(n(t,...i),s&&Ri(a(...s),t)&&n(null,...s))})}),()=>{$s(()=>{i&&Ri(a(...i),t)&&n(null,...i)})}}),t}function ki(t){return function(...n){var a=n[0];return a.stopPropagation(),t?.apply(this,n)}}function kn(t=!1){const n=Bt,a=n.l.u;if(!a)return;let r=()=>le(n.s);if(t){let s=0,i={};const o=Ar(()=>{let l=!1;const c=n.s;for(const d in c)c[d]!==i[d]&&(i[d]=c[d],l=!0);return l&&s++,s});r=()=>e(o)}a.b.length&&Zl(()=>{Li(n,r),hr(a.b)}),Hr(()=>{const s=h(()=>a.m.map(ol));return()=>{for(const i of s)typeof i=="function"&&i()}}),a.a.length&&Hr(()=>{Li(n,r),hr(a.a)})}function Li(t,n){if(t.l.s)for(const a of t.l.s)e(a);n()}function Di(t,n){var a=t.$$events?.[n.type],r=js(a)?a.slice():a==null?[]:[a];for(var s of r)s.call(this,n)}function oi(t,n,a){if(t==null)return n(void 0),a&&a(void 0),Wa;const r=h(()=>t.subscribe(n,a));return r.unsubscribe?()=>r.unsubscribe():r}const vs=[];function Ec(t,n){return{subscribe:Qt(t,n).subscribe}}function Qt(t,n=Wa){let a=null;const r=new Set;function s(l){if(Qi(t,l)&&(t=l,a)){const c=!vs.length;for(const d of r)d[1](),vs.push(d,t);if(c){for(let d=0;d<vs.length;d+=2)vs[d][0](vs[d+1]);vs.length=0}}}function i(l){s(l(t))}function o(l,c=Wa){const d=[l,c];return r.add(d),r.size===1&&(a=n(s,i)||Wa),l(t),()=>{r.delete(d),r.size===0&&a&&(a(),a=null)}}return{set:s,update:i,subscribe:o}}function Fn(t,n,a){const r=!Array.isArray(t),s=r?[t]:t;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=n.length<2;return Ec(a,(o,l)=>{let c=!1;const d=[];let m=0,f=Wa;const u=()=>{if(m)return;f();const g=n(r?d[0]:d,o,l);i?o(g):f=typeof g=="function"?g:Wa},y=s.map((g,T)=>oi(g,x=>{d[T]=x,m&=~(1<<T),c&&u()},()=>{m|=1<<T}));return c=!0,u(),function(){hr(y),f(),c=!1}})}function Wn(t){let n;return oi(t,a=>n=a)(),n}let sr=!1,qr=Symbol();function pt(t,n,a){const r=a[n]??={store:null,source:N(void 0),unsubscribe:Wa};if(r.store!==t&&!(qr in a))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=Wa;else{var s=!0;r.unsubscribe=oi(t,i=>{s?r.source.v=i:v(r.source,i)}),s=!1}return t&&qr in a?Wn(t):e(r.source)}function Rc(t,n){return t.set(n),n}function cs(){const t={};function n(){er(()=>{for(var a in t)t[a].unsubscribe();Bi(t,qr,{enumerable:!1,value:!0})})}return[t,n]}function kc(t){var n=sr;try{return sr=!1,[t(),sr]}finally{sr=n}}function Be(t,n,a,r){var s=!Is||(a&Al)!==0,i=(a&Ml)!==0,o=(a&El)!==0,l=r,c=!0,d=()=>(c&&(c=!1,l=o?h(r):r),l),m;if(i){var f=Ma in t||ll in t;m=Za(t,n)?.set??(f&&n in t?R=>t[n]=R:void 0)}var u,y=!1;i?[u,y]=kc(()=>t[n]):u=t[n],u===void 0&&r!==void 0&&(u=d(),m&&(s&&yl(),m(u)));var g;if(s?g=()=>{var R=t[n];return R===void 0?d():(c=!0,R)}:g=()=>{var R=t[n];return R!==void 0&&(l=void 0),R===void 0?l:R},s&&(a&Cl)===0)return g;if(m){var T=t.$$legacy;return(function(R,w){return arguments.length>0?((!s||!w||T||y)&&m(w?g():R),R):g()})}var x=!1,C=((a&Sl)!==0?Ar:We)(()=>(x=!1,g()));i&&e(C);var D=Ct;return(function(R,w){if(arguments.length>0){const S=w?e(C):s&&i?xs(R):R;return v(C,S),x=!0,l!==void 0&&(l=S),R}return Ba&&x||(D.f&Ca)!==0?C.v:e(C)})}function us(t){Bt===null&&Zr(),Is&&Bt.l!==null?Dc(Bt).m.push(t):Hr(()=>{const n=h(t);if(typeof n=="function")return n})}function li(t){Bt===null&&Zr(),us(()=>()=>h(t))}function Lc(t,n,{bubbles:a=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:n,bubbles:a,cancelable:r})}function ci(){const t=Bt;return t===null&&Zr(),(n,a,r)=>{const s=t.s.$$events?.[n];if(s){const i=js(s)?s.slice():[s],o=Lc(n,a,r);for(const l of i)l.call(t.x,o);return!o.defaultPrevented}return!0}}function Dc(t){var n=t.l;return n.u??={a:[],b:[],m:[]}}const Ic="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Ic);$l();function $c(t,n,a,r){const s=ws(a,r,t),i=ws(a,r,n),o=ws(t,n,a),l=ws(t,n,r);return!!((s>0&&i<0||s<0&&i>0)&&(o>0&&l<0||o<0&&l>0)||s===0&&rr(a,r,t)||i===0&&rr(a,r,n)||o===0&&rr(t,n,a)||l===0&&rr(t,n,r))}function ws(t,n,a){return(a.x-t.x)*(n.y-t.y)-(n.x-t.x)*(a.y-t.y)}function rr(t,n,a){return Math.min(t.x,n.x)<=a.x&&a.x<=Math.max(t.x,n.x)&&Math.min(t.y,n.y)<=a.y&&a.y<=Math.max(t.y,n.y)}function Ii(t,n,a,r=16){const s=[];for(let i=0;i<r;i++){const o=2*Math.PI*i/r;s.push({x:t+a*Math.cos(o),y:n+a*Math.sin(o)})}return s}function Pc(t,n,a,r,s=0,i=16){const o=[],l=2*(a+r),c=s*Math.PI/180,d=Math.cos(c),m=Math.sin(c),f=i/l,u=Math.max(1,Math.round(a*f)),y=Math.max(1,Math.round(r*f)),g=a/2,T=r/2,x=[];for(let C=0;C<u;C++){const D=C/u;x.push({x:-g+a*D,y:-T})}for(let C=0;C<y;C++){const D=C/y;x.push({x:g,y:-T+r*D})}for(let C=0;C<u;C++){const D=C/u;x.push({x:g-a*D,y:T})}for(let C=0;C<y;C++){const D=C/y;x.push({x:-g,y:T-r*D})}for(const C of x)o.push({x:t+C.x*d-C.y*m,y:n+C.x*m+C.y*d});if(o.length>i){const C=[],D=o.length/i;for(let R=0;R<i;R++)C.push(o[Math.floor(R*D)]);return C}return o}function Nc(t,n,a,r,s=0,i=16){const o=[],l=s*Math.PI/180,c=Math.cos(l),d=Math.sin(l);for(let m=0;m<i;m++){const f=2*Math.PI*m/i,u=a*Math.cos(f),y=r*Math.sin(f);o.push({x:t+u*c-y*d,y:n+u*d+y*c})}return o}function $i(t,n,a){const r=a.length;for(let s=0;s<r;s++){const i=a[s],o=a[(s+1)%r];if($c(t,n,i,o))return!0}return!1}function Oo(t,n,a){const r=a*Math.PI/180,s=Math.cos(r),i=Math.sin(r),o=t.x-n.x,l=t.y-n.y;return{x:n.x+o*s-l*i,y:n.y+o*i+l*s}}function Wo(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function os(t){const n=Wo(t),a=t.rotation||0;return[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}].map(s=>Oo(s,n,a))}function Oc(t){const s=t.x,i=t.y+t.height;return[{x:s,y:i},{x:s,y:i-8},{x:s+.5,y:i-8},{x:s+.5,y:i-.5},{x:s+4,y:i-.5},{x:s+4,y:i}]}function Wc(t){const n=Oc(t),a=Wo(t),r=t.rotation||0;return n.map(s=>Oo(s,a,r))}function gr(t,n){const a=n.length;let r=null;for(let s=0;s<a;s++){const i=n[s],o=n[(s+1)%a],l=(o.x-i.x)*(t.y-i.y)-(o.y-i.y)*(t.x-i.x);if(l!==0){const c=l>0;if(r===null)r=c;else if(r!==c)return!1}}return!0}function Yc(t,n,a,r,s=.01){const i=Math.abs(ws(t,n,a)),o=Math.abs(ws(t,n,r)),l=Math.sqrt((n.x-t.x)**2+(n.y-t.y)**2),c=s*l;if(i>c||o>c)return!1;const d=n.x-t.x,m=n.y-t.y,f=Math.sqrt(d*d+m*m);if(f<s)return!1;const u=d/f,y=m/f,g=0,T=f,x=(a.x-t.x)*u+(a.y-t.y)*y,C=(r.x-t.x)*u+(r.y-t.y)*y,D=Math.min(g,T),R=Math.max(g,T),w=Math.min(x,C),S=Math.max(x,C),E=Math.max(D,w);return Math.min(R,S)-E>s}function Hc(t,n,a=.1){const r=t.length,s=n.length;for(let i=0;i<r;i++){const o=t[i],l=t[(i+1)%r];for(let c=0;c<s;c++){const d=n[c],m=n[(c+1)%s];if(Yc(o,l,d,m,a))return!0}}return!1}function Fc(t){const n=t.length;if(n===0)return new Map;const a=Array.from({length:n},(l,c)=>c);function r(l){return a[l]!==l&&(a[l]=r(a[l])),a[l]}function s(l,c){const d=r(l),m=r(c);d!==m&&(a[d]=m)}for(let l=0;l<n;l++)for(let c=l+1;c<n;c++)Hc(t[l].vertices,t[c].vertices)&&s(l,c);const i=new Map;t.forEach((l,c)=>i.set(l.id,c));const o=new Map;return t.forEach((l,c)=>{o.set(l.id,r(c))}),o}function Bc(t,n,a){const r=n.get(t);return r===void 0?[t]:a.filter(s=>n.get(s.id)===r).map(s=>s.id)}const ir=16;function br(t){return t.isRectangle&&t.width!==void 0&&t.height!==void 0?Pc(t.x,t.y,t.width,t.height,t.rotation||0,ir):t.radius!==void 0?Ii(t.x,t.y,t.radius,ir):t.rx!==void 0&&t.ry!==void 0?Nc(t.x,t.y,t.rx,t.ry,t.rotation||0,ir):Ii(t.x,t.y,.5,ir)}function qc(t,n){const a=br(t);for(const r of a)if(gr(r,n))return!0;return!!gr({x:t.x,y:t.y},n)}function Uc(t,n){if(!gr({x:t.x,y:t.y},n))return!1;const a=br(t);for(const r of a)if(!gr(r,n))return!1;return!0}function ui(t,n,a,r){const s=br(t),i=br(n),o=Fc(a),l=new Set;for(const f of a){const u=Uc(t,f.vertices),y=qc(n,f.vertices);if(u||y){const g=Bc(f.id,o,a);for(const T of g)l.add(T)}}const c=[];let d=!1,m=null;for(const f of s)for(const u of i){const y={from:f,to:u,blocked:!1,blockedBy:null};let g=!1;for(const x of a)if(!l.has(x.id)&&$i(f,u,x.vertices)){y.blocked=!0,y.blockedBy="terrain",g=!0;break}if(g){c.push(y);continue}let T=!1;for(const x of r)if($i(f,u,x)){y.blocked=!0,y.blockedBy="wall",T=!0;break}T||(y.blocked=!1,d||(m=y),d=!0),c.push(y)}return{canSee:d,rays:c,firstClearRay:m,terrainsIgnored:Array.from(l)}}const Je={width:60,height:44},Yo=Qt([{id:"terrain1",x:20,y:16,width:6,height:12,rotation:0},{id:"terrain2",x:34,y:10,width:6,height:12,rotation:45},{id:"terrain3",x:44,y:20,width:6,height:12,rotation:-30}]);Fn(Yo,t=>t.map(n=>Wc(n)));Fn(Yo,t=>t.map(n=>({id:n.id,vertices:os(n)})));const Pi=Qt(!1);var Kc=xe('<line stroke="#3a4a3a" stroke-width="0.05"></line>'),Gc=xe('<line stroke="#3a4a3a" stroke-width="0.05"></line>'),zc=xe('<line stroke="#5a6a5a" stroke-width="0.08"></line>'),Xc=xe('<line stroke="#5a6a5a" stroke-width="0.08"></line>'),Vc=xe('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),jc=xe('<line stroke="#666"></line><!>',1),Qc=xe('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),Jc=xe('<line stroke="#666"></line><!>',1),Zc=xe('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),eu=xe('<line stroke="#666"></line><!>',1),tu=xe('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),nu=xe('<line stroke="#666"></line><!>',1),au=xe('<svg preserveAspectRatio="xMidYMid meet"><rect x="0" y="0" fill="#1a1a1a"></rect><rect fill="#4a5a4a"></rect><!><!><!><!><!><!><!><!><g><!></g></svg>');function tr(t,n){bn(n,!1);const a=N(),r=N(),s=N(),i=N(),o=N(),l=N(),c=N();let d=N();const m=2,f=Je.width+m*2,u=Je.height+m*2;let y=N(1),g=N(0),T=N(0),x=N(!1),C={x:0,y:0},D=N(!1);const R=.5,w=4;function S(J,pe){if(!e(d))return{x:0,y:0};const Pe=e(d).createSVGPoint();Pe.x=J,Pe.y=pe;const ve=Pe.matrixTransform(e(d).getScreenCTM().inverse());return{x:ve.x-m,y:ve.y-m}}function E(J){J.preventDefault();const pe=e(d).getBoundingClientRect(),Pe=J.clientX-pe.left,ve=J.clientY-pe.top,qt=e(s)+Pe/pe.width*e(a),Rt=e(i)+ve/pe.height*e(r),Qe=J.deltaY>0?.9:1.1,qe=Math.max(R,Math.min(w,e(y)*Qe)),kt=f/qe,lt=u/qe,it=qt-Pe/pe.width*kt,V=Rt-ve/pe.height*lt;v(y,qe),v(g,it),v(T,V)}function W(J){(J.button===1||J.button===0&&e(D))&&(J.preventDefault(),v(x,!0),C={x:J.clientX,y:J.clientY})}function A(J){if(!e(x))return;const pe=e(d).getBoundingClientRect(),Pe=(J.clientX-C.x)/pe.width*e(a),ve=(J.clientY-C.y)/pe.height*e(r);v(g,e(g)-Pe),v(T,e(T)-ve),C={x:J.clientX,y:J.clientY}}function P(){v(x,!1)}function O(J){J.code==="Space"&&!J.repeat&&J.target.tagName!=="INPUT"&&(J.preventDefault(),v(D,!0))}function ne(J){J.code==="Space"&&v(D,!1)}function B(){v(y,1),v(g,0),v(T,0)}ce(()=>e(y),()=>{v(a,f/e(y))}),ce(()=>e(y),()=>{v(r,u/e(y))}),ce(()=>e(g),()=>{v(s,e(g))}),ce(()=>e(T),()=>{v(i,e(T))}),ce(()=>(e(s),e(i),e(a),e(r)),()=>{v(o,`${e(s)} ${e(i)} ${e(a)} ${e(r)}`)}),ce(()=>Je,()=>{v(l,Array.from({length:Je.width+1},(J,pe)=>pe))}),ce(()=>Je,()=>{v(c,Array.from({length:Je.height+1},(J,pe)=>pe))}),ia();var ae={screenToSvg:S};kn();var se=au();z("keydown",_s,O),z("keyup",_s,ne),z("mouseup",_s,P),z("mousemove",_s,A);let j;var Z=_(se),oe=b(Z);p(oe,"x",m),p(oe,"y",m);var me=b(oe);Ie(me,1,()=>(le(Je),h(()=>Array(Je.width+1))),tt,(J,pe,Pe)=>{var ve=Kc();p(ve,"x1",m+Pe),p(ve,"y1",m),p(ve,"x2",m+Pe),G(()=>p(ve,"y2",(le(Je),h(()=>m+Je.height)))),k(J,ve)});var _e=b(me);Ie(_e,1,()=>(le(Je),h(()=>Array(Je.height+1))),tt,(J,pe,Pe)=>{var ve=Gc();p(ve,"x1",m),p(ve,"y1",m+Pe),p(ve,"y2",m+Pe),G(()=>p(ve,"x2",(le(Je),h(()=>m+Je.width)))),k(J,ve)});var re=b(_e);Ie(re,1,()=>(le(Je),h(()=>Array(Math.floor(Je.width/6)+1))),tt,(J,pe,Pe)=>{var ve=zc();p(ve,"x1",m+Pe*6),p(ve,"y1",m),p(ve,"x2",m+Pe*6),G(()=>p(ve,"y2",(le(Je),h(()=>m+Je.height)))),k(J,ve)});var I=b(re);Ie(I,1,()=>(le(Je),h(()=>Array(Math.floor(Je.height/6)+1))),tt,(J,pe,Pe)=>{var ve=Xc();p(ve,"x1",m),p(ve,"y1",m+Pe*6),p(ve,"y2",m+Pe*6),G(()=>p(ve,"x2",(le(Je),h(()=>m+Je.width)))),k(J,ve)});var q=b(I);Ie(q,1,()=>e(l),tt,(J,pe)=>{var Pe=jc(),ve=Ce(Pe);p(ve,"y2",m);var qt=b(ve);{var Rt=Qe=>{var qe=Vc();p(qe,"y",1.2);var kt=_(qe);G(()=>{p(qe,"x",m+e(pe)),we(kt,`${e(pe)??""}"`)}),k(Qe,qe)};ie(qt,Qe=>{e(pe)%6===0&&Qe(Rt)})}G(()=>{p(ve,"x1",m+e(pe)),p(ve,"y1",e(pe)%6===0?.5:m-.8),p(ve,"x2",m+e(pe)),p(ve,"stroke-width",e(pe)%6===0?.08:.04)}),k(J,Pe)});var ee=b(q);Ie(ee,1,()=>e(l),tt,(J,pe)=>{var Pe=Jc(),ve=Ce(Pe),qt=b(ve);{var Rt=Qe=>{var qe=Qc(),kt=_(qe);G(()=>{p(qe,"x",m+e(pe)),p(qe,"y",(le(Je),h(()=>m+Je.height+1.8))),we(kt,`${e(pe)??""}"`)}),k(Qe,qe)};ie(qt,Qe=>{e(pe)%6===0&&Qe(Rt)})}G(()=>{p(ve,"x1",m+e(pe)),p(ve,"y1",(le(Je),h(()=>m+Je.height))),p(ve,"x2",m+e(pe)),p(ve,"y2",(le(Je),e(pe),h(()=>m+Je.height+(e(pe)%6===0?1.5:.8)))),p(ve,"stroke-width",e(pe)%6===0?.08:.04)}),k(J,Pe)});var F=b(ee);Ie(F,1,()=>e(c),tt,(J,pe)=>{var Pe=eu(),ve=Ce(Pe);p(ve,"x2",m);var qt=b(ve);{var Rt=Qe=>{var qe=Zc();p(qe,"x",1);var kt=_(qe);G(()=>{p(qe,"y",m+e(pe)+.35),we(kt,`${e(pe)??""}"`)}),k(Qe,qe)};ie(qt,Qe=>{e(pe)%6===0&&Qe(Rt)})}G(()=>{p(ve,"x1",e(pe)%6===0?.5:m-.8),p(ve,"y1",m+e(pe)),p(ve,"y2",m+e(pe)),p(ve,"stroke-width",e(pe)%6===0?.08:.04)}),k(J,Pe)});var H=b(F);Ie(H,1,()=>e(c),tt,(J,pe)=>{var Pe=nu(),ve=Ce(Pe),qt=b(ve);{var Rt=Qe=>{var qe=tu(),kt=_(qe);G(()=>{p(qe,"x",(le(Je),h(()=>m+Je.width+1))),p(qe,"y",m+e(pe)+.35),we(kt,`${e(pe)??""}"`)}),k(Qe,qe)};ie(qt,Qe=>{e(pe)%6===0&&Qe(Rt)})}G(()=>{p(ve,"x1",(le(Je),h(()=>m+Je.width))),p(ve,"y1",m+e(pe)),p(ve,"x2",(le(Je),e(pe),h(()=>m+Je.width+(e(pe)%6===0?1.5:.8)))),p(ve,"y2",m+e(pe)),p(ve,"stroke-width",e(pe)%6===0?.08:.04)}),k(J,Pe)});var Me=b(H);p(Me,"transform","translate(2, 2)");var st=_(Me);return Do(st,n,"default",{screenToSvg:S}),Xs(se,J=>v(d,J),()=>e(d)),G(()=>{p(se,"viewBox",e(o)),j=mn(se,0,"battlefield svelte-n43bnt",null,j,{panning:e(x)||e(D)}),p(Z,"width",(le(Je),h(()=>Je.width+m*2))),p(Z,"height",(le(Je),h(()=>Je.height+m*2))),p(oe,"width",(le(Je),h(()=>Je.width))),p(oe,"height",(le(Je),h(()=>Je.height)))}),z("wheel",se,E),z("mousedown",se,W),z("dblclick",se,B),k(t,se),Fs(n,"screenToSvg",S),Tn(ae)}var su=xe('<line stroke="#3b82f6" stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" fill="#3b82f6" stroke="#1d4ed8" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-trljjm"></circle>',1),ru=xe('<g><g><rect role="button" tabindex="0" class="svelte-trljjm"></rect></g><!></g>');function Ho(t,n){bn(n,!1);const a=N(),r=N(),s=N(),i=N(),o=N();let l=Be(n,"id",8),c=Be(n,"x",8),d=Be(n,"y",8),m=Be(n,"width",8),f=Be(n,"height",8),u=Be(n,"rotation",8,0),y=Be(n,"selected",8,!1),g=Be(n,"screenToSvg",8),T=Be(n,"onSelect",8,()=>{}),x=Be(n,"onDrag",8,()=>{}),C=Be(n,"onRotate",8,()=>{}),D=N(!1),R=!1,w={x:0,y:0};function S(me){me.stopPropagation(),T()(l())}function E(me){if(me.button!==0)return;me.preventDefault(),me.stopPropagation(),T()(l()),v(D,!0);const _e=g()(me.clientX,me.clientY);w={x:_e.x-c(),y:_e.y-d()},window.addEventListener("mousemove",W),window.addEventListener("mouseup",A)}function W(me){if(!e(D))return;const _e=g()(me.clientX,me.clientY);let re=_e.x-w.x,I=_e.y-w.y;me.shiftKey||(re=Math.round(re),I=Math.round(I));const q=Math.max(m(),f())/2;re=Math.max(-q,Math.min(Je.width-m()+q,re)),I=Math.max(-q,Math.min(Je.height-f()+q,I)),x()(l(),re,I)}function A(){v(D,!1),window.removeEventListener("mousemove",W),window.removeEventListener("mouseup",A)}function P(me){me.preventDefault(),me.stopPropagation(),R=!0,window.addEventListener("mousemove",O),window.addEventListener("mouseup",ne)}function O(me){if(!R)return;const _e=g()(me.clientX,me.clientY),re=_e.x-e(a),I=_e.y-e(r);let q=Math.atan2(I,re)*180/Math.PI+45;me.shiftKey||(q=Math.round(q/15)*15),C()(l(),q)}function ne(){R=!1,window.removeEventListener("mousemove",O),window.removeEventListener("mouseup",ne)}ce(()=>(le(c()),le(m())),()=>{v(a,c()+m()/2)}),ce(()=>(le(d()),le(f())),()=>{v(r,d()+f()/2)}),ce(()=>(le(m()),le(f())),()=>{v(s,Math.max(m(),f())/2+1.5)}),ce(()=>(e(a),e(s),le(u())),()=>{v(i,e(a)+e(s)*Math.cos((u()-45)*Math.PI/180))}),ce(()=>(e(r),e(s),le(u())),()=>{v(o,e(r)+e(s)*Math.sin((u()-45)*Math.PI/180))}),ia(),kn();var B=ru();let ae;var se=_(B),j=_(se),Z=b(se);{var oe=me=>{var _e=su(),re=Ce(_e),I=b(re);G(()=>{p(re,"x1",e(a)),p(re,"y1",e(r)),p(re,"x2",e(i)),p(re,"y2",e(o)),p(I,"cx",e(i)),p(I,"cy",e(o))}),z("mousedown",I,P),k(me,_e)};ie(Z,me=>{y()&&me(oe)})}G(()=>{ae=mn(B,0,"terrain-rect svelte-trljjm",null,ae,{selected:y(),dragging:e(D)}),p(se,"transform",`rotate(${u()??""}, ${e(a)??""}, ${e(r)??""})`),p(j,"x",c()),p(j,"y",d()),p(j,"width",m()),p(j,"height",f()),p(j,"fill",y()?"rgba(59, 130, 246, 0.3)":"rgba(139, 90, 43, 0.3)"),p(j,"stroke",y()?"#3b82f6":"#8b5a2b"),p(j,"stroke-width",y()?.15:.1)}),z("click",j,S),z("mousedown",j,E),k(t,B),Tn()}const Fo="warhammer-deployment-layouts",Bo=[{label:'6" x 12"',width:6,height:12},{label:'5" x 10"',width:5,height:10},{label:'4" x 6"',width:4,height:6}],Ur=[{label:"L 4x8",shape:"L-4x8"},{label:"L 4x8 â",shape:"L-4x8-mirror"},{label:"C 4-8-4",shape:"C-4-8-4"},{label:"L 5x6",shape:"L-5x6"},{label:"L 5x6 â",shape:"L-5x6-mirror"},{label:"L 4x6",shape:"L-4x6"},{label:"L 4x6 â",shape:"L-4x6-mirror"}],mi=[{name:"Layout 1",terrains:[{id:"a",x:28,y:0,width:4,height:6,rotation:0},{id:"b",x:28,y:38,width:4,height:6,rotation:0},{id:"c",x:6,y:5,width:6,height:12,rotation:0},{id:"d",x:48,y:27,width:6,height:12,rotation:0},{id:"e",x:16,y:28,width:6,height:12,rotation:0},{id:"f",x:7,y:19,width:6,height:12,rotation:90},{id:"g",x:38,y:4,width:6,height:12,rotation:0},{id:"h",x:47,y:13,width:6,height:12,rotation:90},{id:"i",x:32.74,y:23.59,width:5,height:10,rotation:135},{id:"j",x:35.06,y:19.5,width:4,height:6,rotation:45},{id:"k",x:22.07,y:10.17,width:5,height:10,rotation:-45},{id:"l",x:20.72,y:18.23,width:4,height:6,rotation:45}],walls:[{id:"wa",x:38,y:6,shape:"C-4-8-4",rotation:0},{id:"wb",x:18,y:30,shape:"C-4-8-4",rotation:180},{id:"wc",x:13.33,y:20.15,shape:"L-4x8-mirror",rotation:-90},{id:"wd",x:49.67,y:15.93,shape:"L-4x8-mirror",rotation:90},{id:"we",x:48.2,y:30.88,shape:"L-4x8",rotation:0},{id:"wf",x:7.84,y:5.01,shape:"L-4x8",rotation:180},{id:"wg",x:27.06,y:11.52,shape:"L-4x8-mirror",rotation:-45},{id:"wh",x:35.81,y:24.24,shape:"L-4x8-mirror",rotation:135}]},{name:"Layout 2",terrains:[{id:"a",x:31,y:7,width:4,height:6,rotation:-90},{id:"b",x:25,y:30,width:4,height:6,rotation:90},{id:"c",x:5,y:4,width:6,height:12,rotation:0},{id:"d",x:49,y:28,width:6,height:12,rotation:0},{id:"e",x:46,y:4,width:6,height:12,rotation:0},{id:"f",x:16.32,y:16.13,width:6,height:12,rotation:135},{id:"g",x:53,y:15,width:4,height:6,rotation:90},{id:"h",x:8,y:28,width:6,height:12,rotation:0},{id:"i",x:3,y:23,width:4,height:6,rotation:90},{id:"j",x:32.62,y:32.55,width:5,height:10,rotation:-90},{id:"k",x:22.48,y:.51,width:5,height:10,rotation:-90},{id:"l",x:37,y:16,width:6,height:12,rotation:135}],walls:[{id:"wa",x:49,y:32,shape:"L-4x8",rotation:0},{id:"wb",x:7,y:4,shape:"L-4x8",rotation:180},{id:"wc",x:46,y:8,shape:"L-4x8",rotation:0},{id:"wd",x:10,y:28,shape:"L-4x8",rotation:180},{id:"we",x:35.07,y:34.56,shape:"L-5x6-mirror",rotation:-90},{id:"wf",x:29.09,y:2.47,shape:"L-5x6-mirror",rotation:90},{id:"wg",x:17.86,y:17.53,shape:"C-4-8-4",rotation:135},{id:"wh",x:37.24,y:18.38,shape:"C-4-8-4",rotation:-45}]},{name:"Layout 3",terrains:[{id:"a",x:11,y:3,width:4,height:6,rotation:90},{id:"b",x:45,y:35,width:4,height:6,rotation:90},{id:"c",x:25,y:1,width:6,height:12,rotation:90},{id:"d",x:29,y:31,width:6,height:12,rotation:90},{id:"e",x:7.74,y:26.05,width:6,height:12,rotation:125.31},{id:"f",x:46.34,y:5.51,width:6,height:12,rotation:121.72},{id:"g",x:5.14,y:10.46,width:6,height:12,rotation:41.51},{id:"h",x:48.67,y:21.52,width:6,height:12,rotation:41.51},{id:"i",x:19.59,y:14.36,width:5,height:10,rotation:-38.13},{id:"j",x:20.69,y:24.37,width:4,height:6,rotation:-39.33},{id:"k",x:35.34,y:19.61,width:5,height:10,rotation:-38.13},{id:"l",x:35.31,y:13.5,width:4,height:6,rotation:-39.33}],walls:[{id:"aa",x:30,y:32,shape:"C-4-8-4",rotation:90},{id:"ab",x:26,y:4,shape:"C-4-8-4",rotation:-90},{id:"ac",x:8.19,y:11.64,shape:"L-4x8",rotation:222.46},{id:"ad",x:47.79,y:24.3,shape:"L-4x8",rotation:41.26},{id:"ae",x:38.64,y:20.09,shape:"L-5x6-mirror",rotation:141.31},{id:"af",x:25.26,y:17.9,shape:"L-5x6-mirror",rotation:-37.61},{id:"ag",x:14.37,y:28.38,shape:"L-4x8-mirror",rotation:-54.26},{id:"ah",x:48.75,y:7.3,shape:"L-4x8-mirror",rotation:122.02}]},{name:"Layout 4",terrains:[{id:"a",x:15,y:1,width:6,height:12,rotation:90},{id:"b",x:8,y:10,width:4,height:6,rotation:0},{id:"c",x:4,y:19,width:4,height:6,rotation:0},{id:"d",x:7.5,y:27.68,width:6,height:12,rotation:-48.57},{id:"e",x:46.53,y:4.24,width:6,height:12,rotation:-48.57},{id:"f",x:53,y:19,width:4,height:6,rotation:0},{id:"g",x:48,y:28,width:4,height:6,rotation:0},{id:"h",x:39,y:31,width:6,height:12,rotation:90},{id:"i",x:33.03,y:2.97,width:6,height:12,rotation:-37.25},{id:"j",x:20.96,y:28.96,width:6,height:12,rotation:-37.25},{id:"k",x:16.93,y:16.51,width:5,height:10,rotation:-41.85},{id:"l",x:37.96,y:17.43,width:5,height:10,rotation:-41.85}],walls:[{id:"aa",x:18,y:4,shape:"L-4x8",rotation:-90},{id:"ab",x:9.04,y:29.01,shape:"C-4-8-4",rotation:131.97},{id:"ac",x:47,y:7,shape:"C-4-8-4",rotation:-48.54},{id:"ad",x:38,y:32,shape:"L-4x8",rotation:90},{id:"ae",x:34.42,y:7.12,shape:"L-4x8",rotation:-37.53},{id:"af",x:21.57,y:28.8,shape:"L-4x8",rotation:142.46},{id:"ag",x:15.7,y:17.01,shape:"L-5x6",rotation:137.87},{id:"ah",x:39.17,y:20.85,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 5",terrains:[{id:"aa",x:27,y:1,width:6,height:12,rotation:90},{id:"ab",x:36.53,y:12.48,width:5,height:10,rotation:-90},{id:"ac",x:13,y:3,width:4,height:6,rotation:90},{id:"ad",x:43,y:35,width:4,height:6,rotation:90},{id:"ae",x:27,y:31,width:6,height:12,rotation:90},{id:"af",x:18.43,y:21.49,width:5,height:10,rotation:-90},{id:"ag",x:1,y:23,width:4,height:6,rotation:90},{id:"ah",x:55,y:15,width:4,height:6,rotation:90},{id:"ai",x:7.83,y:30.22,width:6,height:12,rotation:-60},{id:"aj",x:46.32,y:1.58,width:6,height:12,rotation:-60},{id:"ak",x:8.74,y:10.19,width:6,height:12,rotation:65.22},{id:"al",x:45.22,y:21.75,width:6,height:12,rotation:65.22}],walls:[{id:"a1",x:28,y:32,shape:"C-4-8-4",rotation:90},{id:"a2",x:28,y:4,shape:"C-4-8-4",rotation:-90},{id:"a3",x:11.88,y:12.29,shape:"L-4x8",rotation:-114.74},{id:"a4",x:43.97,y:23.59,shape:"L-4x8",rotation:64.22},{id:"a5",x:24.91,y:23.52,shape:"L-5x6-mirror",rotation:-90.37},{id:"a6",x:39,y:14.51,shape:"L-5x6-mirror",rotation:89.9},{id:"a7",x:7.58,y:30.57,shape:"L-4x8",rotation:120.93},{id:"a8",x:48.51,y:5.28,shape:"L-4x8",rotation:-59.06}]},{name:"Layout 6",terrains:[{id:"aa",x:13,y:1,width:6,height:12,rotation:90},{id:"ab",x:6,y:10,width:4,height:6,rotation:0},{id:"ac",x:25,y:11,width:4,height:6,rotation:90},{id:"ad",x:7.34,y:27.57,width:6,height:12,rotation:-40.32},{id:"ae",x:46.69,y:4.57,width:6,height:12,rotation:-41.9},{id:"af",x:31,y:27,width:4,height:6,rotation:-90},{id:"ag",x:50,y:28,width:4,height:6,rotation:0},{id:"ah",x:41,y:31,width:6,height:12,rotation:90},{id:"ai",x:34,y:4,width:6,height:12,rotation:0},{id:"aj",x:20,y:28,width:6,height:12,rotation:0},{id:"ak",x:15.7,y:15.03,width:5,height:10,rotation:-41.85},{id:"al",x:39.43,y:19.24,width:5,height:10,rotation:-39.95}],walls:[{id:"a1",x:16,y:4,shape:"L-4x8",rotation:-90},{id:"a2",x:9.04,y:29.01,shape:"C-4-8-4",rotation:140.05},{id:"a3",x:47,y:7.16,shape:"C-4-8-4",rotation:-41.53},{id:"a4",x:40,y:32,shape:"L-4x8",rotation:90},{id:"a5",x:34.15,y:7.88,shape:"L-4x8",rotation:0},{id:"a6",x:22,y:28,shape:"L-4x8",rotation:180},{id:"a7",x:14.47,y:15.47,shape:"L-5x6",rotation:137.87},{id:"a8",x:40.53,y:22.78,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 7",terrains:[{id:"aa",x:8,y:8,width:6,height:12,rotation:0},{id:"ab",x:6,y:28,width:6,height:12,rotation:0},{id:"ac",x:7,y:39,width:4,height:6,rotation:90},{id:"ad",x:18,y:26,width:5,height:10,rotation:0},{id:"ae",x:19,y:20,width:4,height:6,rotation:0},{id:"af",x:23,y:3,width:6,height:12,rotation:0},{id:"ag",x:31,y:29,width:6,height:12,rotation:0},{id:"ah",x:37,y:18,width:4,height:6,rotation:0},{id:"ai",x:37,y:8,width:5,height:10,rotation:0},{id:"aj",x:46,y:24,width:6,height:12,rotation:0},{id:"ak",x:48,y:4,width:6,height:12,rotation:0},{id:"al",x:49,y:-1,width:4,height:6,rotation:90}],walls:[{id:"a1",x:9,y:10,shape:"L-5x6",rotation:180},{id:"a2",x:11.44,y:31.97,shape:"L-4x8-mirror",rotation:0},{id:"a3",x:19,y:20,shape:"L-4x6",rotation:180},{id:"a4",x:22.53,y:30.02,shape:"L-5x6-mirror",rotation:0},{id:"a5",x:25,y:5,shape:"C-4-8-4",rotation:180},{id:"a6",x:31,y:31,shape:"C-4-8-4",rotation:0},{id:"a7",x:37,y:18,shape:"L-4x6",rotation:0},{id:"a8",x:41.51,y:8.09,shape:"L-5x6-mirror",rotation:180},{id:"a9",x:46,y:28,shape:"L-5x6",rotation:0},{id:"a10",x:51.51,y:4.01,shape:"L-4x8-mirror",rotation:180}]},{name:"Layout 8",terrains:[{id:"aa",x:23,y:22,width:4,height:6,rotation:0},{id:"ab",x:23,y:28,width:4,height:6,rotation:0},{id:"ac",x:33,y:16,width:4,height:6,rotation:0},{id:"ad",x:33,y:10,width:4,height:6,rotation:0},{id:"ae",x:41,y:19,width:6,height:12,rotation:0},{id:"af",x:13,y:13,width:6,height:12,rotation:0},{id:"ag",x:32,y:32,width:6,height:12,rotation:0},{id:"ah",x:22,y:0,width:6,height:12,rotation:0},{id:"ai",x:9.5,y:27.68,width:6,height:12,rotation:-48.69},{id:"aj",x:44.51,y:4.35,width:6,height:12,rotation:-48.69},{id:"ak",x:6.95,y:4,width:5,height:10,rotation:53.9},{id:"al",x:48,y:30,width:5,height:10,rotation:53.9}],walls:[{id:"a1",x:32,y:34,shape:"C-4-8-4",rotation:0},{id:"a2",x:24,y:2,shape:"C-4-8-4",rotation:180},{id:"a3",x:44.68,y:19.06,shape:"L-4x8-mirror",rotation:180},{id:"a4",x:18.43,y:16.91,shape:"L-4x8-mirror",rotation:0},{id:"a5",x:46.38,y:33.13,shape:"L-5x6",rotation:52.87},{id:"a6",x:8.55,y:4.89,shape:"L-5x6",rotation:-127.66},{id:"a7",x:16,y:30.28,shape:"L-4x8-mirror",rotation:-48.62},{id:"a8",x:46.91,y:5.85,shape:"L-4x8-mirror",rotation:132.19}]}];function iu(){return"terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Sa(){const t=localStorage.getItem(Fo);if(t)try{return JSON.parse(t)}catch(n){return console.error("Failed to parse saved layouts:",n),{}}return{}}function Tr(t){localStorage.setItem(Fo,JSON.stringify(t))}function qo(){const{subscribe:t,set:n,update:a}=Qt([]);return{subscribe:t,set:n,update:a,add(r,s){a(i=>[...i,{id:iu(),x:30-r/2,y:22-s/2,width:r,height:s,rotation:0}])},updateTerrain(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){n([])},save(r){const s=Wn({subscribe:t}),i=Sa();i[r]={terrains:s,savedAt:Date.now()},Tr(i)},load(r){const s=Sa();return s[r]?(n(s[r].terrains),!0):!1},deleteLayout(r){const s=Sa();delete s[r],Tr(s)},getSavedLayoutNames(){const r=Sa();return Object.keys(r).map(s=>({name:s,savedAt:r[s].savedAt,terrainCount:r[s].terrains.length})).sort((s,i)=>i.savedAt-s.savedAt)},hasSaved(){const r=Sa();return Object.keys(r).length>0}}}const Ln=qo();function Uo(){const{subscribe:t,set:n,update:a}=Qt([]);return{subscribe:t,set:n,update:a,add(r){a(s=>[...s,{id:"wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),x:30,y:22,shape:r,rotation:0}])},updateWall(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){n([])}}}const Cn=Uo(),or=qo(),lr=Uo(),cr=Qt(null),ur=Qt(null);function Kr(t){const n=t.includes("-mirror"),a=t.replace("-mirror","");if(a.startsWith("L-")){const r=a.match(/L-(\d+)x(\d+)/);if(r)return{type:"L",segments:[parseInt(r[1]),parseInt(r[2])],mirrored:n}}else if(a.startsWith("C-")){const r=a.match(/C-(\d+)-(\d+)-(\d+)/);if(r)return{type:"C",segments:[parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],mirrored:n}}return{type:"L",segments:[4,8],mirrored:!1}}function qa(t,n=null){const s=Kr(t),i=n||s.segments,o=s.mirrored;if(s.type==="L"){const[l,c]=i;return o?[{x:0,y:0},{x:.5,y:0},{x:.5,y:c},{x:-l+.5,y:c},{x:-l+.5,y:c-.5},{x:0,y:c-.5}]:[{x:0,y:0},{x:.5,y:0},{x:.5,y:c-.5},{x:l,y:c-.5},{x:l,y:c},{x:0,y:c}]}else if(s.type==="C"){const[l,c,d]=i;return[{x:0,y:0},{x:d,y:0},{x:d,y:.5},{x:.5,y:.5},{x:.5,y:c-.5},{x:l,y:c-.5},{x:l,y:c},{x:0,y:c}]}return[]}function Mr(t,n,a,r){if(t.length===0)return[];const s=t.map(C=>C.x),i=t.map(C=>C.y),o=Math.min(...s),l=Math.max(...s),c=Math.min(...i),d=Math.max(...i),m=l-o,f=d-c,u=n+o+m/2,y=a+c+f/2,g=r*Math.PI/180,T=Math.cos(g),x=Math.sin(g);return t.map(C=>{const D=n+C.x,R=a+C.y,w=D-u,S=R-y;return{x:u+w*T-S*x,y:y+w*x+S*T}})}Fn(Cn,t=>t.map(n=>Mr(qa(n.shape,n.segments),n.x,n.y,n.rotation)));const ma=Qt(null),da=Qt(null),di=Qt([]);function ou(t,n=[]){const a=Wn(Ln),r=Wn(Cn),s=Sa();s[t]={terrains:a,walls:r,models:n,savedAt:Date.now()},Tr(s)}function lu(t){const n=Sa();return n[t]?(Ln.set(n[t].terrains||[]),Cn.set(n[t].walls||[]),{terrains:n[t].terrains||[],walls:n[t].walls||[],models:n[t].models||[]}):null}function cu(t){const n=Sa();delete n[t],Tr(n)}function uu(){const t=Sa();return Object.keys(t).map(n=>({name:n,savedAt:t[n].savedAt,terrainCount:(t[n].terrains||[]).length,wallCount:(t[n].walls||[]).length,modelCount:(t[n].models||[]).length})).sort((n,a)=>a.savedAt-n.savedAt)}function Bs(){di.set(uu())}var mu=xe('<line stroke="#3b82f6" stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" fill="#3b82f6" stroke="#1d4ed8" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-1tez9jd"></circle>',1),du=xe('<g><g><path role="button" tabindex="0" class="svelte-1tez9jd"></path></g><!></g>');function Er(t,n){bn(n,!1);const a=N(),r=N(),s=N(),i=N(),o=N(),l=N(),c=N(),d=N(),m=N(),f=N();let u=Be(n,"id",8),y=Be(n,"x",8),g=Be(n,"y",8),T=Be(n,"shape",8),x=Be(n,"segments",8,null),C=Be(n,"rotation",8,0),D=Be(n,"selected",8,!1),R=Be(n,"screenToSvg",8),w=Be(n,"onSelect",8,()=>{}),S=Be(n,"onDrag",8,()=>{}),E=Be(n,"onRotate",8,()=>{});function W(F){const H=F.map(st=>st.x),Me=F.map(st=>st.y);return{minX:Math.min(...H),maxX:Math.max(...H),minY:Math.min(...Me),maxY:Math.max(...Me)}}let A=N(!1),P=!1,O={x:0,y:0};function ne(F){F.stopPropagation(),w()(u())}function B(F){if(F.button!==0)return;F.preventDefault(),F.stopPropagation(),w()(u()),v(A,!0);const H=R()(F.clientX,F.clientY);O={x:H.x-y(),y:H.y-g()},window.addEventListener("mousemove",ae),window.addEventListener("mouseup",se)}function ae(F){if(!e(A))return;const H=R()(F.clientX,F.clientY);let Me=H.x-O.x,st=H.y-O.y;F.shiftKey||(Me=Math.round(Me),st=Math.round(st));const J=Math.max(e(s),e(i));Me=Math.max(-J,Math.min(Je.width+J-e(s),Me)),st=Math.max(-J,Math.min(Je.height+J-e(i),st)),S()(u(),Me,st)}function se(){v(A,!1),window.removeEventListener("mousemove",ae),window.removeEventListener("mouseup",se)}function j(F){F.preventDefault(),F.stopPropagation(),P=!0,window.addEventListener("mousemove",Z),window.addEventListener("mouseup",oe)}function Z(F){if(!P)return;const H=R()(F.clientX,F.clientY),Me=H.x-e(o),st=H.y-e(l);let J=Math.atan2(st,Me)*180/Math.PI+45;F.shiftKey||(J=Math.round(J/15)*15),E()(u(),J)}function oe(){P=!1,window.removeEventListener("mousemove",Z),window.removeEventListener("mouseup",oe)}ce(()=>(le(T()),le(x())),()=>{v(a,qa(T(),x()))}),ce(()=>e(a),()=>{v(r,W(e(a)))}),ce(()=>e(r),()=>{v(s,e(r).maxX-e(r).minX)}),ce(()=>e(r),()=>{v(i,e(r).maxY-e(r).minY)}),ce(()=>(le(y()),e(r),e(s)),()=>{v(o,y()+e(r).minX+e(s)/2)}),ce(()=>(le(g()),e(r),e(i)),()=>{v(l,g()+e(r).minY+e(i)/2)}),ce(()=>(e(a),le(y()),le(g())),()=>{v(c,e(a).length>0?`M ${e(a).map(F=>`${y()+F.x},${g()+F.y}`).join(" L ")} Z`:"")}),ce(()=>(e(s),e(i)),()=>{v(d,Math.max(e(s),e(i))/2+1.5)}),ce(()=>(e(o),e(d),le(C())),()=>{v(m,e(o)+e(d)*Math.cos((C()-45)*Math.PI/180))}),ce(()=>(e(l),e(d),le(C())),()=>{v(f,e(l)+e(d)*Math.sin((C()-45)*Math.PI/180))}),ia(),kn();var me=du();let _e;var re=_(me),I=_(re),q=b(re);{var ee=F=>{var H=mu(),Me=Ce(H),st=b(Me);G(()=>{p(Me,"x1",e(o)),p(Me,"y1",e(l)),p(Me,"x2",e(m)),p(Me,"y2",e(f)),p(st,"cx",e(m)),p(st,"cy",e(f))}),z("mousedown",st,j),k(F,H)};ie(q,F=>{D()&&F(ee)})}G(()=>{_e=mn(me,0,"wall-piece svelte-1tez9jd",null,_e,{selected:D(),dragging:e(A)}),p(re,"transform",`rotate(${C()??""}, ${e(o)??""}, ${e(l)??""})`),p(I,"d",e(c)),p(I,"fill",D()?"rgba(139, 69, 19, 0.6)":"rgba(139, 69, 19, 0.8)"),p(I,"stroke",D()?"#3b82f6":"#5c3317"),p(I,"stroke-width",D()?.15:.1)}),z("click",I,ne),z("mousedown",I,B),k(t,me),Tn()}var hu=he('<div class="section-content svelte-7o4pd4"><!></div>'),fu=he('<section><div class="section-header svelte-7o4pd4" role="button" tabindex="0"><h3 class="svelte-7o4pd4"> </h3> <span class="toggle-icon svelte-7o4pd4"> </span></div> <!></section>');function an(t,n){let a=Be(n,"title",8),r=Be(n,"defaultOpen",8,!0),s=N(r());function i(){v(s,!e(s))}var o=fu();let l;var c=_(o),d=_(c),m=_(d),f=b(d,2),u=_(f),y=b(c,2);{var g=T=>{var x=hu(),C=_(x);Do(C,n,"default",{}),k(T,x)};ie(y,T=>{e(s)&&T(g)})}G(()=>{l=mn(o,1,"collapsible-section svelte-7o4pd4",null,l,{collapsed:!e(s)}),we(m,a()),we(u,e(s)?"â¼":"â¶")}),z("click",c,i),k(t,o)}var yu=he('<button class="svelte-10mgcx0"> </button>'),pu=he('<div class="button-group svelte-10mgcx0"></div>'),vu=he('<button class="svelte-10mgcx0"> </button>'),gu=he('<div class="button-group svelte-10mgcx0"></div>'),bu=he('<div class="field svelte-10mgcx0"><label for="edit-width" class="svelte-10mgcx0">Width (inches)</label> <input id="edit-width" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-height" class="svelte-10mgcx0">Length (inches)</label> <input id="edit-height" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-rotation" class="svelte-10mgcx0">Rotation (Â°)</label> <input id="edit-rotation" type="number" step="15" class="svelte-10mgcx0"/></div>',1),Tu=he('<div class="field svelte-10mgcx0"><label for="edit-seg1" class="svelte-10mgcx0">Horizontal (inches)</label> <input id="edit-seg1" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg2" class="svelte-10mgcx0">Vertical (inches)</label> <input id="edit-seg2" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div>',1),xu=he('<div class="field svelte-10mgcx0"><label for="edit-seg1" class="svelte-10mgcx0">Top Width (inches)</label> <input id="edit-seg1" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg2" class="svelte-10mgcx0">Length (inches)</label> <input id="edit-seg2" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg3" class="svelte-10mgcx0">Bottom Width (inches)</label> <input id="edit-seg3" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div>',1),_u=he('<div class="field svelte-10mgcx0"><span class="label-text svelte-10mgcx0">Shape</span> <span class="value svelte-10mgcx0"> </span></div> <!> <div class="field svelte-10mgcx0"><label for="edit-rotation" class="svelte-10mgcx0">Rotation (Â°)</label> <input id="edit-rotation" type="number" step="15" class="svelte-10mgcx0"/></div>',1),wu=he('<div class="edit-form svelte-10mgcx0"><div class="field svelte-10mgcx0"><label for="edit-x" class="svelte-10mgcx0">X (inches)</label> <input id="edit-x" type="number" step="0.1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-y" class="svelte-10mgcx0">Y (inches)</label> <input id="edit-y" type="number" step="0.1" class="svelte-10mgcx0"/></div> <!> <button class="danger svelte-10mgcx0">Remove</button></div>'),Su=he('<p class="hint svelte-10mgcx0">Click a piece to select it</p>'),Au=he('<div class="button-group vertical svelte-10mgcx0"><button class="svelte-10mgcx0">Save Layout</button> <button class="svelte-10mgcx0">Load Layout</button> <div class="button-row svelte-10mgcx0"><button class="secondary small svelte-10mgcx0">Export</button> <button class="secondary small svelte-10mgcx0">Import</button></div> <button class="secondary svelte-10mgcx0">Clear All</button></div>'),Cu=he("<!> <!>",1),Mu=he('<div class="modal-overlay svelte-10mgcx0" role="presentation"><div class="modal svelte-10mgcx0" role="dialog"><h2 class="svelte-10mgcx0">Save Layout</h2> <div class="modal-field svelte-10mgcx0"><label for="layout-name" class="svelte-10mgcx0">Layout Name</label> <input id="layout-name" type="text" placeholder="Enter a name..." class="svelte-10mgcx0"/></div> <div class="modal-actions svelte-10mgcx0"><button class="secondary svelte-10mgcx0">Cancel</button> <button class="svelte-10mgcx0">Save</button></div></div></div>'),Eu=he('<p class="hint svelte-10mgcx0">No saved layouts yet</p>'),Ru=he('<div class="layout-item svelte-10mgcx0" role="button" tabindex="0"><div class="layout-info svelte-10mgcx0"><span class="layout-name svelte-10mgcx0"> </span> <span class="layout-meta svelte-10mgcx0"> </span></div> <button class="delete-btn svelte-10mgcx0" title="Delete">Ã</button></div>'),ku=he('<div class="layout-list svelte-10mgcx0"></div>'),Lu=he('<div class="modal-overlay svelte-10mgcx0" role="presentation"><div class="modal svelte-10mgcx0" role="dialog"><h2 class="svelte-10mgcx0">Load Layout</h2> <!> <div class="modal-actions svelte-10mgcx0"><button class="secondary svelte-10mgcx0">Cancel</button></div></div></div>'),Du=he('<main class="svelte-10mgcx0"><div class="layout svelte-10mgcx0"><div class="sidebar svelte-10mgcx0"><!> <!> <!> <!> <input type="file" accept=".json" style="display: none;"/></div> <div class="battlefield-area svelte-10mgcx0"><div class="battlefield-container svelte-10mgcx0" role="presentation"><!></div> <div class="info svelte-10mgcx0"><p class="svelte-10mgcx0"> </p> <p class="hint svelte-10mgcx0">Scroll to zoom | Space+drag or middle-click to pan | Double-click to reset view</p></div></div></div></main> <!> <!>',1);function Iu(t,n){bn(n,!1);const a=()=>pt(ma,"$selectedTerrainId",l),r=()=>pt(da,"$selectedWallId",l),s=()=>pt(Ln,"$layoutTerrains",l),i=()=>pt(Cn,"$layoutWalls",l),o=()=>pt(di,"$savedLayoutsList",l),[l,c]=cs(),d=N(),m=N();let f=N(!1),u=N(!1),y=N(""),g=null;us(()=>{Bs(),window.addEventListener("keydown",T)}),li(()=>{window.removeEventListener("keydown",T)});function T(L){if(L.target.tagName==="INPUT"||e(f)||e(u))return;const ye=a()||r();if((L.key==="Delete"||L.key==="Backspace")&&ye){L.preventDefault(),_e();return}if(ye&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(L.key)){L.preventDefault();const Se=L.shiftKey?.1:1;let Ae=0,Re=0;switch(L.key){case"ArrowUp":Re=-Se;break;case"ArrowDown":Re=Se;break;case"ArrowLeft":Ae=-Se;break;case"ArrowRight":Ae=Se;break}if(a()){const ct=s().find(ut=>ut.id===a());ct&&Ln.updateTerrain(a(),{x:ct.x+Ae,y:ct.y+Re})}else if(r()){const ct=i().find(ut=>ut.id===r());ct&&Cn.updateWall(r(),{x:ct.x+Ae,y:ct.y+Re})}return}if(L.key==="c"&&(L.ctrlKey||L.metaKey)&&ye){if(L.preventDefault(),a()){const Se=s().find(Ae=>Ae.id===a());Se&&(g={type:"terrain",data:{...Se}})}else if(r()){const Se=i().find(Ae=>Ae.id===r());Se&&(g={type:"wall",data:{...Se}})}return}if(L.key==="v"&&(L.ctrlKey||L.metaKey)&&g){if(L.preventDefault(),g.type==="terrain"){const Se="terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),Ae={...g.data,id:Se,x:g.data.x+2,y:g.data.y+2};Ln.update(Re=>[...Re,Ae]),ma.set(Se),da.set(null),g.data.x+=2,g.data.y+=2}else if(g.type==="wall"){const Se="wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),Ae={...g.data,id:Se,x:g.data.x+2,y:g.data.y+2};Cn.update(Re=>[...Re,Ae]),da.set(Se),ma.set(null),g.data.x+=2,g.data.y+=2}return}if(L.key==="Escape"){se();return}}let x=N(""),C=N(""),D=N(""),R=N(""),w=N(""),S=N(""),E=N(""),W=N("");function A(L){return L.segments?L.segments:Kr(L.shape).segments}function P(L){return Kr(L.shape).type}function O(L,ye){Ln.add(L,ye)}function ne(L){Cn.add(L)}function B(L){ma.set(L),da.set(null)}function ae(L){da.set(L),ma.set(null)}function se(){ma.set(null),da.set(null)}function j(L,ye,Se){Ln.updateTerrain(L,{x:ye,y:Se})}function Z(L,ye,Se){Cn.updateWall(L,{x:ye,y:Se})}function oe(L,ye){Ln.updateTerrain(L,{rotation:ye})}function me(L,ye){Cn.updateWall(L,{rotation:ye})}function _e(){a()?(Ln.remove(a()),ma.set(null)):r()&&(Cn.remove(r()),da.set(null))}function re(){const L=parseFloat(e(x)),ye=parseFloat(e(C));!isNaN(L)&&!isNaN(ye)&&(a()?Ln.updateTerrain(a(),{x:L,y:ye}):r()&&Cn.updateWall(r(),{x:L,y:ye}))}function I(){if(!a())return;const L=parseFloat(e(D)),ye=parseFloat(e(R));!isNaN(L)&&!isNaN(ye)&&L>0&&ye>0&&Ln.updateTerrain(a(),{width:L,height:ye})}function q(){const L=parseFloat(e(w));isNaN(L)||(a()?Ln.updateTerrain(a(),{rotation:L}):r()&&Cn.updateWall(r(),{rotation:L}))}function ee(){if(!r()||!e(m))return;const L=P(e(m)),ye=parseFloat(e(S)),Se=parseFloat(e(E));if(isNaN(ye)||isNaN(Se)||ye<=0||Se<=0)return;let Ae;if(L==="C"){const Re=parseFloat(e(W));if(isNaN(Re)||Re<=0)return;Ae=[ye,Se,Re]}else Ae=[ye,Se];Cn.updateWall(r(),{segments:Ae})}function F(){v(y,""),v(f,!0)}function H(){e(y).trim()&&(ou(e(y).trim()),Bs(),v(f,!1),v(y,""))}function Me(){Bs(),v(u,!0)}function st(L){lu(L),ma.set(null),da.set(null),v(u,!1)}function J(L,ye){ye.stopPropagation(),confirm(`Delete layout "${L}"?`)&&(cu(L),Bs())}function pe(){confirm("Clear all terrain and walls?")&&(Ln.clear(),Cn.clear(),ma.set(null),da.set(null))}function Pe(L){return new Date(L).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function ve(L){const ye=Ur.find(Se=>Se.shape===L);return ye?ye.label:L}function qt(){const L=prompt("Layout name (for the recipient):","Custom Layout");if(L===null)return;const ye=s(),Se=i(),Ae={version:1,name:L||"Custom Layout",exportedAt:new Date().toISOString(),terrainCount:ye.length,wallCount:Se.length,terrains:ye,walls:Se},Re=JSON.stringify(Ae,null,2),ct=new Blob([Re],{type:"application/json"}),ut=URL.createObjectURL(ct),be=document.createElement("a");be.href=ut;const Ge=(L||"layout").toLowerCase().replace(/[^a-z0-9]+/g,"-");be.download=`${Ge}-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(be),be.click(),document.body.removeChild(be),URL.revokeObjectURL(ut)}let Rt=N();function Qe(){e(Rt).click()}function qe(L){const ye=L.target.files[0];if(!ye)return;const Se=new FileReader;Se.onload=Ae=>{try{const Re=JSON.parse(Ae.target.result);Re.terrains&&Array.isArray(Re.terrains)&&Ln.set(Re.terrains),Re.walls&&Array.isArray(Re.walls)&&Cn.set(Re.walls),ma.set(null),da.set(null);const ct=Re.name||"Unknown",ut=Re.terrains?.length||0,be=Re.walls?.length||0;alert(`Imported "${ct}"
${ut} terrain(s), ${be} wall(s)`)}catch(Re){alert("Failed to import layout: Invalid file format"),console.error("Import error:",Re)}},Se.readAsText(ye),L.target.value=""}ce(()=>(s(),a()),()=>{v(d,s().find(L=>L.id===a()))}),ce(()=>(i(),r()),()=>{v(m,i().find(L=>L.id===r()))}),ce(()=>(e(d),e(m)),()=>{if(e(d))v(x,e(d).x.toFixed(1)),v(C,e(d).y.toFixed(1)),v(D,e(d).width.toString()),v(R,e(d).height.toString()),v(w,Math.round(e(d).rotation).toString());else if(e(m)){v(x,e(m).x.toFixed(1)),v(C,e(m).y.toFixed(1)),v(w,Math.round(e(m).rotation).toString());const L=A(e(m));v(S,L[0]?.toString()||""),v(E,L[1]?.toString()||""),v(W,L[2]?.toString()||"")}}),ia(),kn();var kt=Du(),lt=Ce(kt),it=_(lt),V=_(it),De=_(V);an(De,{title:"Add Terrain",children:(L,ye)=>{var Se=pu();Ie(Se,5,()=>Bo,tt,(Ae,Re)=>{var ct=yu(),ut=_(ct);G(()=>we(ut,(e(Re),h(()=>e(Re).label)))),z("click",ct,()=>O(e(Re).width,e(Re).height)),k(Ae,ct)}),k(L,Se)},$$slots:{default:!0}});var Ke=b(De,2);an(Ke,{title:"Add Wall",children:(L,ye)=>{var Se=gu();Ie(Se,5,()=>Ur,tt,(Ae,Re)=>{var ct=vu(),ut=_(ct);G(()=>we(ut,(e(Re),h(()=>e(Re).label)))),z("click",ct,()=>ne(e(Re).shape)),k(Ae,ct)}),k(L,Se)},$$slots:{default:!0}});var xt=b(Ke,2);{let L=We(()=>e(d)?"Terrain":e(m)?"Wall":"Item");an(xt,{get title(){return`Selected ${e(L)??""}`},children:(ye,Se)=>{var Ae=Ot(),Re=Ce(Ae);{var ct=be=>{var Ge=wu(),Pt=_(Ge),Bn=b(_(Pt),2),tn=b(Pt,2),$n=b(_(tn),2),Jn=b(tn,2);{var oa=$=>{var Q=bu(),te=Ce(Q),ke=b(_(te),2),Le=b(te,2),He=b(_(Le),2),Ne=b(Le,2),Ve=b(_(Ne),2);An(ke,()=>e(D),at=>v(D,at)),z("change",ke,I),An(He,()=>e(R),at=>v(R,at)),z("change",He,I),An(Ve,()=>e(w),at=>v(w,at)),z("change",Ve,q),k($,Q)},Ga=$=>{var Q=Ot(),te=Ce(Q);{var ke=Le=>{var He=_u(),Ne=Ce(He),Ve=b(_(Ne),2),at=_(Ve),Jt=b(Ne,2);{var Ft=Lt=>{var on=Tu(),un=Ce(on),dn=b(_(un),2),Dt=b(un,2),xn=b(_(Dt),2);An(dn,()=>e(S),pn=>v(S,pn)),z("change",dn,ee),An(xn,()=>e(E),pn=>v(E,pn)),z("change",xn,ee),k(Lt,on)},Wt=Lt=>{var on=Ot(),un=Ce(on);{var dn=Dt=>{var xn=xu(),pn=Ce(xn),Zn=b(_(pn),2),Xe=b(pn,2),K=b(_(Xe),2),dt=b(Xe,2),ot=b(_(dt),2);An(Zn,()=>e(S),Oe=>v(S,Oe)),z("change",Zn,ee),An(K,()=>e(E),Oe=>v(E,Oe)),z("change",K,ee),An(ot,()=>e(W),Oe=>v(W,Oe)),z("change",ot,ee),k(Dt,xn)};ie(un,Dt=>{e(m),h(()=>P(e(m))==="C")&&Dt(dn)},!0)}k(Lt,on)};ie(Jt,Lt=>{e(m),h(()=>P(e(m))==="L")?Lt(Ft):Lt(Wt,!1)})}var St=b(Jt,2),Xt=b(_(St),2);G(Lt=>we(at,Lt),[()=>(e(m),h(()=>ve(e(m).shape)))]),An(Xt,()=>e(w),Lt=>v(w,Lt)),z("change",Xt,q),k(Le,He)};ie(te,Le=>{e(m)&&Le(ke)},!0)}k($,Q)};ie(Jn,$=>{e(d)?$(oa):$(Ga,!1)})}var za=b(Jn,2);An(Bn,()=>e(x),$=>v(x,$)),z("change",Bn,re),An($n,()=>e(C),$=>v(C,$)),z("change",$n,re),z("click",za,_e),k(be,Ge)},ut=be=>{var Ge=Su();k(be,Ge)};ie(Re,be=>{e(d)||e(m)?be(ct):be(ut,!1)})}k(ye,Ae)},$$slots:{default:!0}})}var vt=b(xt,2);an(vt,{title:"Layout",children:(L,ye)=>{var Se=Au(),Ae=_(Se),Re=b(Ae,2),ct=b(Re,2),ut=_(ct),be=b(ut,2),Ge=b(ct,2);G(()=>Re.disabled=(o(),h(()=>o().length===0))),z("click",Ae,F),z("click",Re,Me),z("click",ut,qt),z("click",be,Qe),z("click",Ge,pe),k(L,Se)},$$slots:{default:!0}});var $t=b(vt,2);Xs($t,L=>v(Rt,L),()=>e(Rt));var Gt=b(V,2),sn=_(Gt),en=_(sn);tr(en,{children:wr,$$slots:{default:(L,ye)=>{const Se=We(()=>ye.screenToSvg);var Ae=Cu(),Re=Ce(Ae);Ie(Re,1,s,ut=>ut.id,(ut,be)=>{{let Ge=We(()=>(e(be),a(),h(()=>e(be).id===a())));Ho(ut,{get id(){return e(be),h(()=>e(be).id)},get x(){return e(be),h(()=>e(be).x)},get y(){return e(be),h(()=>e(be).y)},get width(){return e(be),h(()=>e(be).width)},get height(){return e(be),h(()=>e(be).height)},get rotation(){return e(be),h(()=>e(be).rotation)},get selected(){return e(Ge)},get screenToSvg(){return e(Se)},onSelect:B,onDrag:j,onRotate:oe})}});var ct=b(Re,2);Ie(ct,1,i,ut=>ut.id,(ut,be)=>{{let Ge=We(()=>(e(be),r(),h(()=>e(be).id===r())));Er(ut,{get id(){return e(be),h(()=>e(be).id)},get x(){return e(be),h(()=>e(be).x)},get y(){return e(be),h(()=>e(be).y)},get shape(){return e(be),h(()=>e(be).shape)},get segments(){return e(be),h(()=>e(be).segments)},get rotation(){return e(be),h(()=>e(be).rotation)},get selected(){return e(Ge)},get screenToSvg(){return e(Se)},onSelect:ae,onDrag:Z,onRotate:me})}}),k(L,Ae)}}});var rn=b(sn,2),Ye=_(rn),nt=_(Ye),ze=b(lt,2);{var Mt=L=>{var ye=Mu(),Se=_(ye),Ae=b(_(Se),2),Re=b(_(Ae),2),ct=b(Ae,2),ut=_(ct),be=b(ut,2);G(Ge=>be.disabled=Ge,[()=>(e(y),h(()=>!e(y).trim()))]),An(Re,()=>e(y),Ge=>v(y,Ge)),z("keydown",Re,Ge=>Ge.key==="Enter"&&H()),z("click",ut,()=>v(f,!1)),z("click",be,H),z("click",Se,ki(function(Ge){Di.call(this,n,Ge)})),z("click",ye,()=>v(f,!1)),k(L,ye)};ie(ze,L=>{e(f)&&L(Mt)})}var zt=b(ze,2);{var Ze=L=>{var ye=Lu(),Se=_(ye),Ae=b(_(Se),2);{var Re=Ge=>{var Pt=Eu();k(Ge,Pt)},ct=Ge=>{var Pt=ku();Ie(Pt,5,o,tt,(Bn,tn)=>{var $n=Ru(),Jn=_($n),oa=_(Jn),Ga=_(oa),za=b(oa,2),$=_(za),Q=b(Jn,2);G(te=>{we(Ga,(e(tn),h(()=>e(tn).name))),we($,`${e(tn),h(()=>e(tn).terrainCount)??""} terrain${e(tn),h(()=>e(tn).terrainCount!==1?"s":"")??""}, ${e(tn),h(()=>e(tn).wallCount||0)??""} wall${e(tn),h(()=>(e(tn).wallCount||0)!==1?"s":"")??""} Â· ${te??""}`)},[()=>(e(tn),h(()=>Pe(e(tn).savedAt)))]),z("click",Q,te=>J(e(tn).name,te)),z("click",$n,()=>st(e(tn).name)),k(Bn,$n)}),k(Ge,Pt)};ie(Ae,Ge=>{o(),h(()=>o().length===0)?Ge(Re):Ge(ct,!1)})}var ut=b(Ae,2),be=_(ut);z("click",be,()=>v(u,!1)),z("click",Se,ki(function(Ge){Di.call(this,n,Ge)})),z("click",ye,()=>v(u,!1)),k(L,ye)};ie(zt,L=>{e(u)&&L(Ze)})}G(()=>we(nt,`Battlefield: 60" x 44" | ${s(),h(()=>s().length)??""} terrain${s(),h(()=>s().length!==1?"s":"")??""} | ${i(),h(()=>i().length)??""} wall${i(),h(()=>i().length!==1?"s":"")??""}`)),z("change",$t,qe),z("click",sn,se),k(t,kt),Tn(),c()}const Ko=1/25.4,hi=40*Ko/2,fi=3+20*Ko;function Go(t="item"){return t+"-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function $u(){const{subscribe:t,set:n,update:a}=Qt([]);return{subscribe:t,set:n,update:a,add(r){const s=Go("zone");return a(i=>[...i,{id:s,...r}]),s},updateZone(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){n([])}}}function Pu(){const{subscribe:t,set:n,update:a}=Qt([]);return{subscribe:t,set:n,update:a,add(r,s,i=!1){const o=Go("obj"),l=Math.round(r),c=Math.round(s);return a(d=>[...d,{id:o,x:l,y:c,isPrimary:i}]),o},updateObjective(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){n([])}}}$u();Pu();const zo=[{name:"Dawn of War",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:32},{type:"L",x:60,y:32},{type:"L",x:60,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:0,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:12},{type:"L",x:0,y:12},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1}]},{name:"Hammer and Anvil",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:18,y:0},{type:"L",x:18,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:42,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:42,y:44},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1}]},{name:"Tipping Point",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:12,y:0},{type:"L",x:12,y:22},{type:"L",x:20,y:22},{type:"L",x:20,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:40,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:48,y:44},{type:"L",x:48,y:22},{type:"L",x:40,y:22},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:34,isPrimary:!1},{x:22,y:8,isPrimary:!1},{x:38,y:36,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Search and Destroy",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:22},{type:"L",x:21,y:22},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:0,x:30,y:31},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:30,y:0},{type:"L",x:30,y:13},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:1,x:39,y:22},{type:"L",x:60,y:22},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:10,isPrimary:!1},{x:46,y:34,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Sweeping Engagement",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:0,y:8},{type:"L",x:30,y:8},{type:"L",x:30,y:14},{type:"L",x:60,y:14},{type:"L",x:60,y:0},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:0,y:44},{type:"L",x:60,y:44},{type:"L",x:60,y:36},{type:"L",x:30,y:36},{type:"L",x:30,y:30},{type:"L",x:0,y:30},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:18,isPrimary:!1},{x:50,y:26,isPrimary:!1},{x:18,y:38,isPrimary:!1},{x:42,y:6,isPrimary:!1}]},{name:"Crucible of Battle",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:60,y:44},{type:"L",x:30,y:0},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:20,y:8,isPrimary:!1},{x:40,y:36,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]}];function Vs(t){return t.map(n=>{switch(n.type){case"M":return`M ${n.x} ${n.y}`;case"L":return`L ${n.x} ${n.y}`;case"A":return`A ${n.rx} ${n.ry} ${n.rotation} ${n.largeArc} ${n.sweep} ${n.x} ${n.y}`;case"Z":return"Z";default:return""}}).join(" ")}const Oa=Qt(null),na=Qt(null),ha=Qt(null),yi=Fn([na,ha],([t,n])=>{if(!t)return{terrains:[],walls:[]};if(n==="preset"){const a=mi.find(r=>r.name===t);return a?{terrains:a.terrains||[],walls:a.walls||[]}:{terrains:[],walls:[]}}else if(n==="saved"){const a=localStorage.getItem("warhammer-deployment-layouts");if(a)try{const r=JSON.parse(a);if(r[t])return{terrains:r[t].terrains||[],walls:r[t].walls||[]}}catch(r){console.error("Failed to load layout:",r)}}return{terrains:[],walls:[]}});var Nu=he('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),Ou=he('<button class="svelte-1jotvmi"> </button>'),Wu=he('<div class="button-group svelte-1jotvmi"></div>'),Yu=he('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),Hu=he('<button class="svelte-1jotvmi"> </button>'),Fu=he('<button class="svelte-1jotvmi"> </button>'),Bu=he('<div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Saved</h4> <div class="button-group svelte-1jotvmi"></div></div>'),qu=he('<div class="layout-sections svelte-1jotvmi"><div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Presets</h4> <div class="button-group svelte-1jotvmi"></div></div> <!></div>'),Uu=he('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Objectives:</span> <span class="value svelte-1jotvmi"> </span></div>'),Ku=he('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Pieces:</span> <span class="value svelte-1jotvmi"> </span></div>'),Gu=he('<div class="summary svelte-1jotvmi"><div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Deployment:</span> <span class="value svelte-1jotvmi"> </span></div> <div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Terrain:</span> <span class="value svelte-1jotvmi"> </span></div> <!> <!></div>'),zu=xe('<path stroke-width="0.10" stroke-dasharray="0.5,0.25"></path>'),Xu=xe('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15"></circle><circle stroke="#000" stroke-width="0.06"></circle><circle r="0.15" fill="#000"></circle>',1),Vu=xe("<!><!>",1),ju=xe('<g><rect fill="rgba(139, 90, 43, 0.6)" stroke="#8b5a2b" stroke-width="0.1"></rect></g>'),Qu=xe('<g><path fill="rgba(139, 69, 19, 0.8)" stroke="#5c3317" stroke-width="0.1"></path></g>'),Ju=xe("<!><!><!>",1),Zu=he('<main class="svelte-1jotvmi"><div class="layout svelte-1jotvmi"><div class="sidebar svelte-1jotvmi"><!> <!> <!></div> <div class="battlefield-area svelte-1jotvmi"><div class="battlefield-container svelte-1jotvmi"><!></div> <div class="info svelte-1jotvmi"><p class="svelte-1jotvmi">Battlefield: 60" x 44"</p> <p class="hint svelte-1jotvmi">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function em(t,n){bn(n,!1);const a=()=>pt(Oa,"$selectedDeployment",o),r=()=>pt(na,"$selectedLayoutName",o),s=()=>pt(di,"$savedLayoutsList",o),i=()=>pt(yi,"$loadedTerrain",o),[o,l]=cs();us(()=>{Bs()});function c(A){Oa.set(A)}function d(A){na.set(A.name),ha.set("preset")}function m(A){na.set(A),ha.set("saved")}function f(){na.set(null),ha.set(null)}function u(){Oa.set(null)}function y(A){let O=[];switch(A.shape){case"L-4x8":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];break;case"L-4x8-mirror":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:8},{x:-4+.5,y:8},{x:-4+.5,y:8-.5},{x:0,y:8-.5}];break;case"C-4-8-4":O=[{x:0,y:0},{x:4,y:0},{x:4,y:.5},{x:.5,y:.5},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];break;case"L-5x6":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:5,y:6-.5},{x:5,y:6},{x:0,y:6}];break;case"L-5x6-mirror":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-5+.5,y:6},{x:-5+.5,y:6-.5},{x:0,y:6-.5}];break;case"L-4x6":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:4,y:6-.5},{x:4,y:6},{x:0,y:6}];break;case"L-4x6-mirror":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-4+.5,y:6},{x:-4+.5,y:6-.5},{x:0,y:6-.5}];break;default:return""}return`M ${O.map(ne=>`${A.x+ne.x},${A.y+ne.y}`).join(" L ")} Z`}function g(A){switch(A.shape){case"L-4x8":return{x:A.x+2,y:A.y+4};case"L-4x8-mirror":return{x:A.x-2+.5,y:A.y+4};case"C-4-8-4":return{x:A.x+2,y:A.y+4};case"L-5x6":return{x:A.x+2.5,y:A.y+3};case"L-5x6-mirror":return{x:A.x-2.5+.5,y:A.y+3};case"L-4x6":return{x:A.x+2,y:A.y+3};case"L-4x6-mirror":return{x:A.x-2+.5,y:A.y+3};default:return{x:A.x,y:A.y}}}kn();var T=Zu(),x=_(T),C=_(x),D=_(C);an(D,{title:"Deployment",children:(A,P)=>{var O=Ot(),ne=Ce(O);{var B=se=>{var j=Nu(),Z=_(j),oe=_(Z),me=b(Z,2);G(()=>we(oe,a().name)),z("click",me,u),k(se,j)},ae=se=>{var j=Wu();Ie(j,5,()=>zo,tt,(Z,oe)=>{var me=Ou(),_e=_(me);G(()=>we(_e,e(oe).name)),z("click",me,()=>c(e(oe))),k(Z,me)}),k(se,j)};ie(ne,se=>{a()?se(B):se(ae,!1)})}k(A,O)},$$slots:{default:!0}});var R=b(D,2);an(R,{title:"Terrain Layout",children:(A,P)=>{var O=Ot(),ne=Ce(O);{var B=se=>{var j=Yu(),Z=_(j),oe=_(Z),me=b(Z,2);G(()=>we(oe,r())),z("click",me,f),k(se,j)},ae=se=>{var j=qu(),Z=_(j),oe=b(_(Z),2);Ie(oe,5,()=>mi,tt,(re,I)=>{var q=Hu(),ee=_(q);G(()=>we(ee,e(I).name)),z("click",q,()=>d(e(I))),k(re,q)});var me=b(Z,2);{var _e=re=>{var I=Bu(),q=b(_(I),2);Ie(q,5,s,tt,(ee,F)=>{var H=Fu(),Me=_(H);G(()=>we(Me,e(F).name)),z("click",H,()=>m(e(F).name)),k(ee,H)}),k(re,I)};ie(me,re=>{s().length>0&&re(_e)})}k(se,j)};ie(ne,se=>{r()?se(B):se(ae,!1)})}k(A,O)},$$slots:{default:!0}});var w=b(R,2);an(w,{title:"Summary",children:(A,P)=>{var O=Gu(),ne=_(O),B=b(_(ne),2),ae=_(B),se=b(ne,2),j=b(_(se),2),Z=_(j),oe=b(se,2);{var me=I=>{var q=Uu(),ee=b(_(q),2),F=_(ee);G(()=>we(F,a().objectives.length)),k(I,q)};ie(oe,I=>{a()&&I(me)})}var _e=b(oe,2);{var re=I=>{var q=Ku(),ee=b(_(q),2),F=_(ee);G(()=>we(F,`${i().terrains.length??""} terrain, ${i().walls.length??""} walls`)),k(I,q)};ie(_e,I=>{(i().terrains.length>0||i().walls.length>0)&&I(re)})}G(()=>{we(ae,a()?.name||"None"),we(Z,r()||"None")}),k(A,O)},$$slots:{default:!0}});var S=b(C,2),E=_(S),W=_(E);tr(W,{children:(A,P)=>{var O=Ju(),ne=Ce(O);{var B=j=>{var Z=Vu(),oe=Ce(Z);Ie(oe,1,()=>a().zones,tt,(_e,re)=>{var I=zu();G(q=>{p(I,"d",q),p(I,"fill",e(re).color),p(I,"stroke",e(re).borderColor)},[()=>Vs(e(re).path)]),k(_e,I)});var me=b(oe);Ie(me,1,()=>a().objectives,tt,(_e,re)=>{const I=We(()=>e(re).isPrimary?"#fbbf24":"#9ca3af"),q=We(()=>e(re).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)");var ee=Xu(),F=Ce(ee),H=b(F),Me=b(H);G(()=>{p(F,"cx",e(re).x),p(F,"cy",e(re).y),p(F,"r",fi),p(F,"fill",e(q)),p(F,"stroke",e(I)),p(H,"cx",e(re).x),p(H,"cy",e(re).y),p(H,"r",hi),p(H,"fill",e(I)),p(Me,"cx",e(re).x),p(Me,"cy",e(re).y)}),k(_e,ee)}),k(j,Z)};ie(ne,j=>{a()&&j(B)})}var ae=b(ne);Ie(ae,1,()=>i().terrains,tt,(j,Z)=>{const oe=We(()=>e(Z).x+e(Z).width/2),me=We(()=>e(Z).y+e(Z).height/2);var _e=ju(),re=_(_e);G(()=>{p(_e,"transform",`rotate(${e(Z).rotation??""}, ${e(oe)??""}, ${e(me)??""})`),p(re,"x",e(Z).x),p(re,"y",e(Z).y),p(re,"width",e(Z).width),p(re,"height",e(Z).height)}),k(j,_e)});var se=b(ae);Ie(se,1,()=>i().walls,tt,(j,Z)=>{const oe=We(()=>g(e(Z)));var me=Qu(),_e=_(me);G(re=>{p(me,"transform",`rotate(${e(Z).rotation??""}, ${e(oe).x??""}, ${e(oe).y??""})`),p(_e,"d",re)},[()=>y(e(Z))]),k(j,me)}),k(A,O)},$$slots:{default:!0}}),k(t,T),Tn(),l()}function Xo(){const{subscribe:t,set:n,update:a}=Qt({past:[],future:[]});return{subscribe:t,push(r){a(s=>({past:[...s.past,r],future:[]}))},undo(){let r=null;return a(s=>{if(s.past.length===0)return s;const i=[...s.past];return r=i.pop(),{past:i,future:[r,...s.future]}}),r},redo(){let r=null;return a(s=>{if(s.future.length===0)return s;const i=[...s.future];return r=i.shift(),{past:[...s.past,r],future:i}}),r},canUndo(){return Wn({subscribe:t}).past.length>0},canRedo(){return Wn({subscribe:t}).future.length>0},clear(){n({past:[],future:[]})}}}const En=Xo(),Gr=Xo(),Et=1/25.4,Yn={circles:[{type:"25mm",radius:25*Et/2,label:"25mm"},{type:"28.5mm",radius:28.5*Et/2,label:"28mm.5"},{type:"32mm",radius:32*Et/2,label:"32mm"},{type:"40mm",radius:40*Et/2,label:"40mm"},{type:"50mm",radius:50*Et/2,label:"50mm"},{type:"60mm",radius:60*Et/2,label:"60mm"},{type:"80mm",radius:80*Et/2,label:"80mm"},{type:"90mm",radius:90*Et/2,label:"90mm"},{type:"100mm",radius:100*Et/2,label:"100mm"},{type:"130mm",radius:130*Et/2,label:"130mm"},{type:"160mm",radius:160*Et/2,label:"160mm"}],ovals:[{type:"60x35.5mm",width:60*Et,height:35.5*Et,label:"60Ã35.5mm"},{type:"75x42mm",width:75*Et,height:42*Et,label:"75Ã42mm"},{type:"Small Flying Base",width:75*Et,height:42*Et,label:"Small Flying"},{type:"90x52.5mm",width:90*Et,height:52.5*Et,label:"90Ã52.5mm"},{type:"Large Flying Base",width:90*Et,height:52.5*Et,label:"Large Flying"},{type:"105x70mm",width:105*Et,height:70*Et,label:"105Ã70mm"},{type:"120x92mm",width:120*Et,height:92*Et,label:"120Ã92mm"},{type:"150x95mm",width:150*Et,height:95*Et,label:"150Ã95mm"},{type:"170x109mm",width:170*Et,height:109*Et,label:"170Ã109mm"}]};function ya(t,n=null){const a=Yn.circles.find(s=>s.type===t);if(a)return a;const r=Yn.ovals.find(s=>s.type===t);return r||(ks(t)&&n?{type:t,width:n.customWidth,height:n.customHeight,label:`${n.customWidth.toFixed(1)}"Ã${n.customHeight.toFixed(1)}"`}:null)}function Vn(t){return Yn.ovals.some(n=>n.type===t)}function ks(t){return t&&t.startsWith("rect-")}function Ni(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Vo(t){const{subscribe:n,set:a,update:r}=Qt([]);return{subscribe:n,set:a,update:r,add(s,i,o,l,c=null,d=!1){const m=Ni(),f={id:m,baseType:s,playerId:i,x:o,y:l,rotation:0};return c&&c.width&&c.height&&(f.customWidth=c.width,f.customHeight=c.height),r(u=>[...u,f]),!d&&t&&t.push({type:"add",modelId:m,model:{...f}}),m},updateModel(s,i,o=!1){let l=null,c=null;if(!o&&t){const m=Wn({subscribe:n}).find(f=>f.id===s);m&&(l={...m},"x"in i||"y"in i?c="move":"rotation"in i&&(c="rotate"))}if(r(d=>d.map(m=>m.id===s?{...m,...i}:m)),!o&&t&&c&&l){const m=Wn({subscribe:n}).find(f=>f.id===s);t.push({type:c,modelId:s,before:c==="move"?{x:l.x,y:l.y}:{rotation:l.rotation},after:c==="move"?{x:m.x,y:m.y}:{rotation:m.rotation}})}},remove(s,i=!1){let o=null;!i&&t&&(o=Wn({subscribe:n}).find(c=>c.id===s)),r(l=>l.filter(c=>c.id!==s)),!i&&t&&o&&t.push({type:"remove",modelId:s,model:{...o}})},removeByPlayer(s){r(i=>i.filter(o=>o.playerId!==s))},addBatch(s,i=!1){const o=[];return r(l=>{const c=[...l];return s.forEach(d=>{const m=d.id||Ni(),f={...d,id:m};c.push(f),o.push(m),!i&&t&&t.push({type:"add",modelId:m,model:{...f}})}),c}),o},updateUnit(s,i,o=!1){r(l=>l.map(c=>c.unitId===s?{...c,...i}:c))},removeUnit(s,i=!1){const o=[];if(!i&&t){const l=Wn({subscribe:n});o.push(...l.filter(c=>c.unitId===s))}r(l=>l.filter(c=>c.unitId!==s)),!i&&t&&o.forEach(l=>{t.push({type:"remove",modelId:l.id,model:{...l}})})},clear(){a([]),t&&t.clear()},undo(){if(!t)return;const s=t.undo();if(s)switch(s.type){case"add":this.remove(s.modelId,!0);break;case"remove":r(i=>[...i,s.model]);break;case"move":this.updateModel(s.modelId,s.before,!0);break;case"rotate":this.updateModel(s.modelId,s.before,!0);break}},redo(){if(!t)return;const s=t.redo();if(s)switch(s.type){case"add":r(i=>[...i,s.model]);break;case"remove":this.remove(s.modelId,!0);break;case"move":this.updateModel(s.modelId,s.after,!0);break;case"rotate":this.updateModel(s.modelId,s.after,!0);break}}}}const mt=Vo(En),jo=Fn(mt,t=>t.filter(n=>n.playerId===1)),Qo=Fn(mt,t=>t.filter(n=>n.playerId===2)),tm=Qt(null);Fn([mt,tm],([t,n])=>n?t.find(a=>a.id===n):null);const Pa=Vo(Gr),ja=Qt(null);Fn([Pa,ja],([t,n])=>n?t.find(a=>a.id===n):null);var nm=xe('<g><rect role="button" tabindex="0" class="svelte-hycs6b"></rect></g>'),am=xe('<g><ellipse role="button" tabindex="0" class="svelte-hycs6b"></ellipse></g>'),sm=xe('<circle role="button" tabindex="0" class="svelte-hycs6b"></circle>'),rm=xe('<text text-anchor="middle" dominant-baseline="middle" font-weight="bold" fill="white" stroke="black" stroke-width="0.02" paint-order="stroke" pointer-events="none" class="model-name"> </text>'),im=xe('<line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="rotate-handle svelte-hycs6b"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),om=xe('<line stroke="#fbbf24" stroke-width="0.12" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.25" fill="#fbbf24" pointer-events="none" class="svelte-hycs6b"></circle><text text-anchor="middle" dominant-baseline="middle" font-size="0.5" font-weight="bold" fill="#fbbf24" stroke="#000" stroke-width="0.05" paint-order="stroke" pointer-events="none" class="drag-ruler-label svelte-hycs6b"> </text>',1),lm=xe("<g><!><!><!><!></g>");function Ls(t,n){bn(n,!1);const a=N(),r=N(),s=N(),i=N(),o=N(),l=N(),c=N(),d=N(),m=N(),f=N(),u=N(),y=N(),g=N(),T=N(),x=N(),C=N(),D=N(),R=N(),w=N(),S=N(),E=N();let W=Be(n,"id",8),A=Be(n,"x",8),P=Be(n,"y",8),O=Be(n,"baseType",8),ne=Be(n,"playerId",8),B=Be(n,"rotation",8,0),ae=Be(n,"selected",8,!1),se=Be(n,"marqueePreview",8,!1),j=Be(n,"name",8,""),Z=Be(n,"customWidth",8,null),oe=Be(n,"customHeight",8,null),me=Be(n,"screenToSvg",8),_e=Be(n,"onSelect",8,()=>{}),re=Be(n,"onDrag",8,()=>{}),I=Be(n,"onDragEnd",8,()=>{}),q=Be(n,"onRotate",8,()=>{}),ee=Be(n,"onRotateEnd",8,()=>{}),F=Be(n,"onRename",8,()=>{}),H=N(!1),Me=!1,st={x:0,y:0},J=N(null),pe=null;function Pe(Ye){Ye.stopPropagation()}function ve(Ye){Ye.stopPropagation();const nt=prompt("Model name:",j());nt!==null&&F()(W(),nt)}function qt(Ye){if(Ye.button!==0)return;Ye.preventDefault(),Ye.stopPropagation(),_e()(W(),Ye),v(H,!0),v(J,{x:A(),y:P()});const nt=me()(Ye.clientX,Ye.clientY);st={x:nt.x-A(),y:nt.y-P()},window.addEventListener("mousemove",Rt),window.addEventListener("mouseup",Qe)}function Rt(Ye){if(!e(H))return;const nt=me()(Ye.clientX,Ye.clientY);let ze=nt.x-st.x,Mt=nt.y-st.y;re()(W(),ze,Mt)}function Qe(){e(H)&&e(J)&&((e(J).x!==A()||e(J).y!==P())&&I()(W(),e(J).x,e(J).y,A(),P()),v(J,null)),v(H,!1),window.removeEventListener("mousemove",Rt),window.removeEventListener("mouseup",Qe)}function qe(Ye){Ye.preventDefault(),Ye.stopPropagation(),Me=!0,pe=B(),window.addEventListener("mousemove",kt),window.addEventListener("mouseup",lt)}function kt(Ye){if(!Me)return;const nt=me()(Ye.clientX,Ye.clientY),ze=nt.x-A(),Mt=nt.y-P();let zt=Math.atan2(Mt,ze)*180/Math.PI+45;Ye.shiftKey||(zt=Math.round(zt/15)*15),q()(W(),zt)}function lt(){Me&&pe!==null&&(pe!==B()&&ee()(W(),pe,B()),pe=null),Me=!1,window.removeEventListener("mousemove",kt),window.removeEventListener("mouseup",lt)}ce(()=>(le(Z()),le(oe())),()=>{v(a,{customWidth:Z(),customHeight:oe()})}),ce(()=>(le(O()),e(a)),()=>{v(r,ya(O(),e(a)))}),ce(()=>le(O()),()=>{v(s,Vn(O()))}),ce(()=>le(O()),()=>{v(i,ks(O()))}),ce(()=>le(ne()),()=>{v(o,ne()===1?"#3b82f6":"#ef4444")}),ce(()=>le(ne()),()=>{v(l,ne()===1?"rgba(59, 130, 246, 0.5)":"rgba(239, 68, 68, 0.5)")}),ce(()=>le(ne()),()=>{v(c,ne()===1?"rgba(59, 130, 246, 0.3)":"rgba(239, 68, 68, 0.3)")}),ce(()=>(le(ae()),le(se())),()=>{v(d,ae()?.15:se()?.12:.1)}),ce(()=>(le(ae()),e(o),le(se()),e(c),e(l)),()=>{v(m,ae()?e(o):se()?e(c):e(l))}),ce(()=>e(r),()=>{v(f,e(r)?.radius||.5)}),ce(()=>e(r),()=>{v(u,e(r)?.width?e(r).width/2:0)}),ce(()=>e(r),()=>{v(y,e(r)?.height?e(r).height/2:0)}),ce(()=>(e(i),le(Z())),()=>{v(g,e(i)&&Z()||0)}),ce(()=>(e(i),le(oe())),()=>{v(T,e(i)&&oe()||0)}),ce(()=>(e(s),e(u),e(y),e(i),e(g),e(T)),()=>{v(x,e(s)?Math.max(e(u),e(y))+1:e(i)?Math.max(e(g),e(T))/2+1:0)}),ce(()=>(le(A()),e(x),le(B())),()=>{v(C,A()+e(x)*Math.cos((B()-45)*Math.PI/180))}),ce(()=>(le(P()),e(x),le(B())),()=>{v(D,P()+e(x)*Math.sin((B()-45)*Math.PI/180))}),ce(()=>(e(H),e(J),le(A()),le(P())),()=>{v(R,e(H)&&e(J)?Math.sqrt(Math.pow(A()-e(J).x,2)+Math.pow(P()-e(J).y,2)):0)}),ce(()=>(e(H),e(J),le(A())),()=>{v(w,e(H)&&e(J)?(e(J).x+A())/2:0)}),ce(()=>(e(H),e(J),le(P())),()=>{v(S,e(H)&&e(J)?(e(J).y+P())/2:0)}),ce(()=>(e(i),e(g),e(T),e(s),e(u),e(y),e(f)),()=>{v(E,e(i)?Math.min(e(g),e(T))*.2:e(s)?Math.min(e(u),e(y))*.4:e(f)*.5)}),ia(),kn();var it=lm();let V;var De=_(it);{var Ke=Ye=>{var nt=nm(),ze=_(nt);G(()=>{p(nt,"transform",`rotate(${B()??""}, ${A()??""}, ${P()??""})`),p(ze,"x",A()-e(g)/2),p(ze,"y",P()-e(T)/2),p(ze,"width",e(g)),p(ze,"height",e(T)),p(ze,"fill",e(m)),p(ze,"stroke",e(o)),p(ze,"stroke-width",e(d))}),z("click",ze,Pe),z("dblclick",ze,ve),z("mousedown",ze,qt),k(Ye,nt)},xt=Ye=>{var nt=Ot(),ze=Ce(nt);{var Mt=Ze=>{var L=am(),ye=_(L);G(()=>{p(L,"transform",`rotate(${B()??""}, ${A()??""}, ${P()??""})`),p(ye,"cx",A()),p(ye,"cy",P()),p(ye,"rx",e(u)),p(ye,"ry",e(y)),p(ye,"fill",e(m)),p(ye,"stroke",e(o)),p(ye,"stroke-width",e(d))}),z("click",ye,Pe),z("dblclick",ye,ve),z("mousedown",ye,qt),k(Ze,L)},zt=Ze=>{var L=sm();G(()=>{p(L,"cx",A()),p(L,"cy",P()),p(L,"r",e(f)),p(L,"fill",e(m)),p(L,"stroke",e(o)),p(L,"stroke-width",e(d))}),z("click",L,Pe),z("dblclick",L,ve),z("mousedown",L,qt),k(Ze,L)};ie(ze,Ze=>{e(s)?Ze(Mt):Ze(zt,!1)},!0)}k(Ye,nt)};ie(De,Ye=>{e(i)?Ye(Ke):Ye(xt,!1)})}var vt=b(De);{var $t=Ye=>{var nt=rm(),ze=_(nt);G(()=>{p(nt,"x",A()),p(nt,"y",P()),p(nt,"font-size",e(E)),we(ze,j())}),k(Ye,nt)};ie(vt,Ye=>{j()&&Ye($t)})}var Gt=b(vt);{var sn=Ye=>{var nt=im(),ze=Ce(nt),Mt=b(ze),zt=b(Mt);G(()=>{p(ze,"x1",A()),p(ze,"y1",P()),p(ze,"x2",e(C)),p(ze,"y2",e(D)),p(Mt,"cx",e(C)),p(Mt,"cy",e(D)),p(zt,"transform",`translate(${e(C)??""}, ${e(D)??""})`)}),z("mousedown",Mt,qe),k(Ye,nt)};ie(Gt,Ye=>{ae()&&(e(s)||e(i))&&Ye(sn)})}var en=b(Gt);{var rn=Ye=>{var nt=om(),ze=Ce(nt),Mt=b(ze),zt=b(Mt),Ze=_(zt);G(L=>{p(ze,"x1",(e(J),h(()=>e(J).x))),p(ze,"y1",(e(J),h(()=>e(J).y))),p(ze,"x2",A()),p(ze,"y2",P()),p(Mt,"cx",(e(J),h(()=>e(J).x))),p(Mt,"cy",(e(J),h(()=>e(J).y))),p(zt,"x",e(w)),p(zt,"y",e(S)-.5),we(Ze,`${L??""}"`)},[()=>(e(R),h(()=>e(R).toFixed(2)))]),k(Ye,nt)};ie(en,Ye=>{e(H)&&e(J)&&e(R)>.1&&Ye(rn)})}G(()=>V=mn(it,0,"model-base svelte-hycs6b",null,V,{selected:ae(),dragging:e(H)})),k(t,it),Tn()}var cm=xe('<ellipse fill="none" stroke-width="2"></ellipse>'),um=xe('<circle fill="none" stroke-width="2"></circle>'),mm=he('<button class="palette-item svelte-1urec28"><svg class="svelte-1urec28"><!></svg> <span class="label svelte-1urec28"> </span></button>');function xr(t,n){bn(n,!1);const a=N(),r=N(),s=N(),i=N(),o=N(),l=N();let c=Be(n,"baseSize",8),d=Be(n,"playerId",8),m=Be(n,"onDragStart",8,()=>{});const f=3;function u(w){w.button===0&&(w.preventDefault(),m()(c(),w))}ce(()=>le(d()),()=>{v(a,d()===1?"#3b82f6":"#ef4444")}),ce(()=>le(c()),()=>{v(r,c().width!==void 0)}),ce(()=>(e(r),le(c())),()=>{v(s,e(r)?null:c().radius*f)}),ce(()=>(e(r),le(c())),()=>{v(i,e(r)?c().width/2*f:null)}),ce(()=>(e(r),le(c())),()=>{v(o,e(r)?c().height/2*f:null)}),ce(()=>(e(r),le(c())),()=>{v(l,e(r)?Math.max(c().width,c().height)*f:c().radius*2*f)}),ia(),kn();var y=mm(),g=_(y),T=_(g);{var x=w=>{var S=cm();G(()=>{p(S,"cx",(e(l)+8)/2),p(S,"cy",(e(l)+8)/2),p(S,"rx",e(i)),p(S,"ry",e(o)),p(S,"stroke",e(a))}),k(w,S)},C=w=>{var S=um();G(()=>{p(S,"cx",(e(l)+8)/2),p(S,"cy",(e(l)+8)/2),p(S,"r",e(s)),p(S,"stroke",e(a))}),k(w,S)};ie(T,w=>{e(r)?w(x):w(C,!1)})}var D=b(g,2),R=_(D);G(()=>{wc(y,`border-color: ${e(a)??""}`),p(y,"title",(le(c()),h(()=>c().label))),p(g,"width",e(l)+8),p(g,"height",e(l)+8),p(g,"viewBox",`0 0 ${e(l)+8} ${e(l)+8}`),we(R,(le(c()),h(()=>c().label)))}),z("mousedown",y,u),k(t,y),Tn()}const Jo="warhammer-imported-armies";function dm(){try{const t=localStorage.getItem(Jo);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load army imports from storage:",t),[]}}function $r(t){try{localStorage.setItem(Jo,JSON.stringify(t))}catch(n){console.error("Failed to save army imports to storage:",n)}}function hm(){return"import-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function fm(){const{subscribe:t,set:n,update:a}=Qt(dm());return{subscribe:t,addImport(r,s,i,o){const l=hm(),c={id:l,name:r||"Unnamed Army",timestamp:Date.now(),rawText:s,parsedData:i,faction:i.FACTION_KEYWORD||"Unknown",totalPoints:i.TOTAL_ARMY_POINTS||"0pts",playerId:o};return a(d=>{const m=[...d,c];return $r(m),m}),l},removeImport(r){a(s=>{const i=s.filter(o=>o.id!==r);return $r(i),i})},getImport(r){return Wn({subscribe:t}).find(i=>i.id===r)||null},clear(){n([]),$r([])}}}const zr=fm();var ym=he('<div class="error-message svelte-leqhjl"> </div>'),pm=he('<div class="success-message svelte-leqhjl"> </div>'),vm=he("<option> </option>"),gm=he('<div class="army-import-panel svelte-leqhjl"><div class="form-group svelte-leqhjl"><label for="army-list-input" class="svelte-leqhjl">Paste Army List:</label> <textarea id="army-list-input" placeholder="Paste your army list here (GW App, WTC, ListForge formats supported)" rows="12" class="svelte-leqhjl"></textarea></div> <div class="button-group svelte-leqhjl"><button class="svelte-leqhjl"> </button> <button class="svelte-leqhjl">Clear</button></div> <!> <!> <div class="divider svelte-leqhjl"></div> <div class="form-group svelte-leqhjl"><label for="import-select" class="svelte-leqhjl">Load Previous Import:</label> <select id="import-select" class="svelte-leqhjl"><option>-- Select an import --</option><!></select> <button class="load-button svelte-leqhjl">Load</button></div></div>');function bm(t,n){bn(n,!1);const a=()=>pt(zr,"$armyImports",r),[r,s]=cs();let i=Be(n,"currentPlayer",8,1);const o=ci();let l=N(""),c=N(!1),d=N(""),m=N(""),f=N("");function u(){if(!e(l).trim()){v(d,"Please paste an army list");return}v(c,!0),v(d,""),v(m,""),o("parse",{text:e(l),playerId:i()})}function y(){if(!e(f))return;const I=zr.getImport(e(f));I&&(v(l,I.rawText),v(m,`Loaded: ${I.name} (${I.faction}, ${I.totalPoints})`),v(d,""))}function g(){v(l,""),v(d,""),v(m,"")}function T(I){v(c,I)}function x(I){v(d,I),v(m,""),v(c,!1)}function C(I){v(m,I),v(d,""),v(c,!1)}function D(){v(l,"")}var R={setLoading:T,setError:x,setSuccess:C,clearText:D};kn();var w=gm(),S=_(w),E=b(_(S),2),W=b(S,2),A=_(W),P=_(A),O=b(A,2),ne=b(W,2);{var B=I=>{var q=ym(),ee=_(q);G(()=>we(ee,`â ï¸ ${e(d)??""}`)),k(I,q)};ie(ne,I=>{e(d)&&I(B)})}var ae=b(ne,2);{var se=I=>{var q=pm(),ee=_(q);G(()=>we(ee,`â ${e(m)??""}`)),k(I,q)};ie(ae,I=>{e(m)&&I(se)})}var j=b(ae,4),Z=b(_(j),2);G(()=>{e(f),So(()=>{e(c),a()})});var oe=_(Z);oe.value=oe.__value="";var me=b(oe);Ie(me,1,a,I=>I.id,(I,q)=>{var ee=vm(),F=_(ee),H={};G(()=>{we(F,`${e(q),h(()=>e(q).name)??""} (${e(q),h(()=>e(q).faction)??""}, ${e(q),h(()=>e(q).totalPoints)??""})`),H!==(H=(e(q),h(()=>e(q).id)))&&(ee.value=(ee.__value=(e(q),h(()=>e(q).id)))??"")}),k(I,ee)});var _e=b(Z,2);G(I=>{E.disabled=e(c),A.disabled=I,we(P,e(c)?"Parsing...":"Parse Army List"),O.disabled=e(c),Z.disabled=e(c),_e.disabled=e(c)||!e(f)},[()=>(e(c),e(l),h(()=>e(c)||!e(l).trim()))]),An(E,()=>e(l),I=>v(l,I)),z("click",A,u),z("click",O,g),$o(Z,()=>e(f),I=>v(f,I)),z("click",_e,y),k(t,w),Fs(n,"setLoading",T),Fs(n,"setError",x),Fs(n,"setSuccess",C),Fs(n,"clearText",D);var re=Tn(R);return s(),re}var Tm=he("<option> </option>"),xm=he('<tr><td class="unit-name svelte-1xyf33v"> </td><td class="quantity svelte-1xyf33v"> </td><td class="svelte-1xyf33v"><select class="svelte-1xyf33v"></select></td><td class="skip-cell svelte-1xyf33v"><input type="checkbox" class="svelte-1xyf33v"/></td></tr>'),_m=he('<div class="dialog-overlay svelte-1xyf33v"><div class="dialog svelte-1xyf33v"><div class="dialog-header svelte-1xyf33v"><h3 class="svelte-1xyf33v">Unmatched Units</h3> <button class="close-button svelte-1xyf33v">&times;</button></div> <div class="dialog-content svelte-1xyf33v"><p class="info-text svelte-1xyf33v">The following units were not found in the database. Please select base sizes or skip them:</p> <div class="units-table svelte-1xyf33v"><table class="svelte-1xyf33v"><thead class="svelte-1xyf33v"><tr><th class="svelte-1xyf33v">Unit Name</th><th class="svelte-1xyf33v">Quantity</th><th class="svelte-1xyf33v">Base Size</th><th class="svelte-1xyf33v">Skip</th></tr></thead><tbody></tbody></table></div></div> <div class="dialog-footer svelte-1xyf33v"><button class="cancel-button svelte-1xyf33v">Cancel</button> <button class="import-button svelte-1xyf33v">Import Selected</button></div></div></div>');function wm(t,n){bn(n,!1);let a=Be(n,"unmatchedUnits",24,()=>[]),r=Be(n,"show",12,!1);const s=ci();let i=N({});const o=[...Yn.circles.map(u=>({value:u.type,label:u.label})),...Yn.ovals.map(u=>({value:u.type,label:u.label})),{value:"rect-custom",label:"Custom Rectangle (Vehicle)"}];function l(){const u=a().filter(y=>!e(i)[y.id]?.skip).map(y=>({unitName:y.unitName,quantity:y.quantity,baseType:e(i)[y.id]?.baseType||"32mm"}));s("import",{selected:u}),c()}function c(){r(!1),s("close")}ce(()=>le(a()),()=>{v(i,{}),a().forEach(u=>{Lr(i,e(i)[u.id]={baseType:"32mm",skip:!1})})}),ia(),kn();var d=Ot(),m=Ce(d);{var f=u=>{var y=_m(),g=_(y),T=_(g),x=b(_(T),2),C=b(T,2),D=b(_(C),2),R=_(D),w=b(_(R));Ie(w,5,a,A=>A.id,(A,P)=>{var O=xm();let ne;var B=_(O),ae=_(B),se=b(B),j=_(se),Z=b(se),oe=_(Z);G(()=>{e(i),So(()=>{e(P)})}),Ie(oe,5,()=>o,tt,(re,I)=>{var q=Tm(),ee=_(q),F={};G(()=>{we(ee,(e(I),h(()=>e(I).label))),F!==(F=(e(I),h(()=>e(I).value)))&&(q.value=(q.__value=(e(I),h(()=>e(I).value)))??"")}),k(re,q)});var me=b(Z),_e=_(me);G(()=>{ne=mn(O,1,"svelte-1xyf33v",null,ne,{skipped:e(i)[e(P).id]?.skip}),we(ae,(e(P),h(()=>e(P).unitName))),we(j,(e(P),h(()=>e(P).quantity||"1x"))),oe.disabled=(e(i),e(P),h(()=>e(i)[e(P).id]?.skip))}),$o(oe,()=>e(i)[e(P).id].baseType,re=>Lr(i,e(i)[e(P).id].baseType=re)),Xn(_e,()=>e(i)[e(P).id].skip,re=>Lr(i,e(i)[e(P).id].skip=re)),k(A,O)});var S=b(C,2),E=_(S),W=b(E,2);z("click",x,c),z("click",E,c),z("click",W,l),z("click",g,A=>A.stopPropagation()),z("click",y,c),k(u,y)};ie(m,u=>{r()&&u(f)})}k(t,d),Tn()}const jn=Qt([]),Ua=Qt([]);function Oi(t,n){const a={};t.forEach(s=>{const i=s.unitId||"ungrouped";a[i]||(a[i]=[]),a[i].push(s)});const r=[];for(const s in a){const i=a[s],o=i[0];r.push({id:s,name:o.unitName||"Unknown Unit",playerId:o.playerId,modelIds:i.map(l=>l.id),importId:n})}jn.update(s=>[...s,...t]),Ua.update(s=>[...s,...r])}function Sm(t){const a=Wn(Ua).find(r=>r.id===t);a&&(jn.update(r=>r.filter(s=>!a.modelIds.includes(s.id))),Ua.update(r=>r.filter(s=>s.id!==t)))}function Am(t,n=30,a=22){const s=Wn(jn).filter(c=>t.includes(c.id));if(s.length===0)return;const i=2;let o=0,l=0;s.forEach((c,d)=>{const m={...c,x:n+o,y:a+l,inStaging:!1};mt.update(f=>[...f,m]),o+=i,(d+1)%5===0&&(o=0,l+=i)}),jn.update(c=>c.filter(d=>!t.includes(d.id))),Ua.update(c=>c.map(d=>({...d,modelIds:d.modelIds.filter(m=>!t.includes(m))})).filter(d=>d.modelIds.length>0))}function Cm(){jn.set([]),Ua.set([])}Fn(jn,t=>t.filter(n=>n.playerId===1));Fn(jn,t=>t.filter(n=>n.playerId===2));Fn(Ua,t=>t.filter(n=>n.playerId===1));Fn(Ua,t=>t.filter(n=>n.playerId===2));var Mm=xe('<g class="unit-group"><rect fill="none" stroke-dasharray="0.3 0.2" opacity="0.6" cursor="pointer"></rect><text text-anchor="middle" font-size="0.5" font-weight="600" pointer-events="none"> </text><g class="remove-button svelte-1lpiqbg" cursor="pointer"><circle r="0.25" fill="#dc3545" opacity="0.8" class="svelte-1lpiqbg"></circle><line stroke="white" stroke-width="0.08"></line><line stroke="white" stroke-width="0.08"></line></g></g>');function Em(t,n){bn(n,!1);const a=N(),r=N(),s=N(),i=N();let o=Be(n,"unit",8),l=Be(n,"models",24,()=>[]),c=Be(n,"selected",8,!1),d=Be(n,"onclick",8,()=>{}),m=Be(n,"onremove",8,()=>{});function f(T){if(T.length===0)return{minX:0,minY:0,maxX:0,maxY:0,width:0,height:0};const x=T.map(S=>({x:S.x,y:S.y})),C=Math.min(...x.map(S=>S.x))-.5,D=Math.min(...x.map(S=>S.y))-.5,R=Math.max(...x.map(S=>S.x))+.5,w=Math.max(...x.map(S=>S.y))+.5;return{minX:C,minY:D,maxX:R,maxY:w,width:R-C,height:w-D}}ce(()=>(le(l()),le(o())),()=>{v(a,l().filter(T=>o().modelIds.includes(T.id)))}),ce(()=>e(a),()=>{v(r,f(e(a)))}),ce(()=>e(r),()=>{v(s,e(r).minX+e(r).width/2)}),ce(()=>e(r),()=>{v(i,e(r).minY-.3)}),ia(),kn();var u=Ot(),y=Ce(u);{var g=T=>{var x=Mm(),C=_(x),D=b(C),R=_(D),w=b(D),S=_(w),E=b(S),W=b(E);G(()=>{p(C,"x",(e(r),h(()=>e(r).minX))),p(C,"y",(e(r),h(()=>e(r).minY))),p(C,"width",(e(r),h(()=>e(r).width))),p(C,"height",(e(r),h(()=>e(r).height))),p(C,"stroke",c()?"#ffc107":"#adb5bd"),p(C,"stroke-width",c()?"0.15":"0.08"),p(D,"x",e(s)),p(D,"y",e(i)),p(D,"fill",c()?"#333":"#6c757d"),we(R,`${le(o()),h(()=>o().name)??""} (${e(a),h(()=>e(a).length)??""})`),p(S,"cx",(e(r),h(()=>e(r).maxX-.3))),p(S,"cy",(e(r),h(()=>e(r).minY+.3))),p(E,"x1",(e(r),h(()=>e(r).maxX-.4))),p(E,"y1",(e(r),h(()=>e(r).minY+.2))),p(E,"x2",(e(r),h(()=>e(r).maxX-.2))),p(E,"y2",(e(r),h(()=>e(r).minY+.4))),p(W,"x1",(e(r),h(()=>e(r).maxX-.2))),p(W,"y1",(e(r),h(()=>e(r).minY+.2))),p(W,"x2",(e(r),h(()=>e(r).maxX-.4))),p(W,"y2",(e(r),h(()=>e(r).minY+.4)))}),z("click",C,function(...A){d()?.apply(this,A)}),z("click",w,A=>{A.stopPropagation(),m()()}),k(T,x)};ie(y,T=>{e(a),h(()=>e(a).length>0)&&T(g)})}k(t,u),Tn()}var Rm=xe('<line y1="0" y2="60" stroke="#2a2a2a" stroke-width="0.05"></line>'),km=xe('<line x1="0" x2="30" stroke="#2a2a2a" stroke-width="0.05"></line>'),Lm=xe('<text text-anchor="middle" font-size="0.4" fill="#6c757d" font-weight="600" pointer-events="none">STAGING</text>'),Dm=xe("<!><!>",1),Im=xe('<text x="15" y="30" text-anchor="middle" font-size="0.8" fill="#666">No models in staging</text>'),$m=he('<div class="staging-area svelte-cjtwzf"><div class="staging-header svelte-cjtwzf"><h3 class="svelte-cjtwzf">Staging Area</h3> <div class="button-group svelte-cjtwzf"><button class="svelte-cjtwzf"> </button> <button class="svelte-cjtwzf"> </button> <button class="clear-button svelte-cjtwzf">Clear</button></div></div> <div class="staging-canvas svelte-cjtwzf"><svg viewBox="0 0 30 60" class="staging-svg svelte-cjtwzf"><rect x="0" y="0" width="30" height="60" fill="#1a1a1a" stroke="#444" stroke-width="0.1"></rect><!><!><!><!><!></svg></div></div>');function Pm(t,n){bn(n,!1);const a=()=>pt(jn,"$stagingModels",s),r=()=>pt(Ua,"$stagingUnits",s),[s,i]=cs(),o=ci();let l=N(new Set),c=N();function d(I,q){if(!e(c))return{x:0,y:0};const ee=e(c).createSVGPoint();ee.x=I,ee.y=q;const F=ee.matrixTransform(e(c).getScreenCTM().inverse());return{x:F.x,y:F.y}}function m(I){v(l,new Set([I]))}function f(I,q,ee){jn.update(F=>F.map(H=>H.id===I?{...H,x:q,y:ee}:H))}function u(I){}function y(I,q){jn.update(ee=>ee.map(F=>F.id===I?{...F,rotation:q}:F))}function g(I){}function T(I,q){jn.update(ee=>ee.map(F=>F.id===I?{...F,unitName:q}:F))}function x(){o("deploy",{modelIds:a().map(I=>I.id)})}function C(){o("deploy",{modelIds:Array.from(e(l))})}function D(){confirm("Clear all models from staging area?")&&(Cm(),o("clear"))}function R(I){confirm("Remove this unit from staging?")&&Sm(I)}function w(I){const q=r().find(ee=>ee.id===I);q&&v(l,new Set(q.modelIds))}kn();var S=$m(),E=_(S),W=b(_(E),2),A=_(W),P=_(A),O=b(A,2),ne=_(O),B=b(O,2),ae=b(E,2),se=_(ae),j=b(_(se));Ie(j,0,()=>Array(16),tt,(I,q,ee)=>{var F=Rm();p(F,"x1",ee*2),p(F,"x2",ee*2),k(I,F)});var Z=b(j);Ie(Z,0,()=>Array(31),tt,(I,q,ee)=>{var F=km();p(F,"y1",ee*2),p(F,"y2",ee*2),k(I,F)});var oe=b(Z);Ie(oe,1,r,I=>I.id,(I,q)=>{{let ee=We(()=>e(q).modelIds.every(F=>e(l).has(F)));Em(I,{get unit(){return e(q)},get models(){return a()},get selected(){return e(ee)},onclick:()=>w(e(q).id),onremove:()=>R(e(q).id)})}});var me=b(oe);Ie(me,1,a,I=>I.id,(I,q)=>{var ee=Dm(),F=Ce(ee);{let st=We(()=>e(q).name||e(q).unitName),J=We(()=>e(l).has(e(q).id));Ls(F,{get id(){return e(q).id},get x(){return e(q).x},get y(){return e(q).y},get baseType(){return e(q).baseType},get playerId(){return e(q).playerId},get rotation(){return e(q).rotation},get name(){return e(st)},get customWidth(){return e(q).customWidth},get customHeight(){return e(q).customHeight},get selected(){return e(J)},screenToSvg:d,onSelect:m,onDrag:f,onDragEnd:u,onRotate:y,onRotateEnd:g,onRename:T})}var H=b(F);{var Me=st=>{var J=Lm();G(()=>{p(J,"x",e(q).x),p(J,"y",e(q).y-1)}),k(st,J)};ie(H,st=>{e(q).inStaging&&st(Me)})}k(I,ee)});var _e=b(me);{var re=I=>{var q=Im();k(I,q)};ie(_e,I=>{a().length===0&&I(re)})}Xs(se,I=>v(c,I),()=>e(c)),G(()=>{A.disabled=e(l).size===0,we(P,`Deploy Selected (${e(l).size??""})`),O.disabled=a().length===0,we(ne,`Deploy All (${a().length??""})`),B.disabled=a().length===0}),z("click",A,C),z("click",O,x),z("click",B,D),k(t,S),Tn(),i()}function Fa(t){const n=t.match(/^\s*/);return n?n[0].length:0}function ue(t){return t?t.toLowerCase().replace(/\s+/g," ").trim():""}function Ka(t){const n=/^(?:(\d+)x?\s+)?(.*)/,a=t.trim().match(n);if(a){const r=a[1]?`${a[1]}x`:"1x";let s=a[2].trim();return s=s.replace(/^with\s+/i,"").trim(),{quantity:r,name:s}}return{quantity:"1x",name:t.trim()}}function ra(t){return Array.isArray(t)&&t.sort((n,a)=>{const r=parseInt(String(n&&n.quantity||"1x").replace(/x/i,""),10)||1,s=parseInt(String(a&&a.quantity||"1x").replace(/x/i,""),10)||1;if(r!==s)return s-r;const i=n&&n.name?n.name.toString().toLowerCase():"",o=a&&a.name?a.name.toString().toLowerCase():"";return i<o?-1:i>o?1:0}),t}const pa={"World Eaters":"Chaos","Chaos Space Marines":"Chaos","Emperor's Children":"Chaos","Death Guard":"Chaos","Chaos Daemons":"Chaos","Chaos Knights":"Chaos","Thousand Sons":"Chaos","Space Marines":"Imperium","Iron Hands":"Space Marines",Salamanders:"Space Marines","Space Wolves":"Space Marines",Ultramarines:"Space Marines","White Scars":"Space Marines","Adepta Sororitas":"Imperium","Astra Militarum":"Imperium","Imperial Fists":"Space Marines","Dark Angels":"Space Marines","Blood Angels":"Space Marines","Raven Guard":"Space Marines","Black Templars":"Space Marines",Deathwatch:"Space Marines","Grey Knights":"Imperium","Imperial Knights":"Imperium","Adeptus Custodes":"Imperium","Adeptus Titanicus":"Imperium","Adeptus Mechanicus":"Imperium","Agents of the Imperium":"Imperium",Aeldari:"Xenos",Drukhari:"Xenos",Ynnari:"Xenos",Harlequins:"Xenos",Necrons:"Xenos",Orks:"Xenos",Tyranids:"Xenos","T'au Empire":"Xenos",Tau:"Xenos","T'au":"Xenos","Genestealer Cults":"Xenos","Leagues of Votann":"Xenos"};function ms(t){if(!t)return t;t.SUMMARY=t.SUMMARY||{};const n=t.SUMMARY;n.LIST_TITLE=n.LIST_TITLE||"",n.FACTION_KEYWORD&&(n.FACTION_KEYWORD=String(n.FACTION_KEYWORD).trim()),n.DETACHMENT&&(n.DETACHMENT=String(n.DETACHMENT).replace(/\u00A0/g," ").trim()),n.TOTAL_ARMY_POINTS&&(n.TOTAL_ARMY_POINTS=String(n.TOTAL_ARMY_POINTS).trim());const a=s=>{if(!s)return"";try{return s.toString().normalize("NFD").replace(new RegExp("\\p{M}","gu"),"").replace(/[\u2018\u2019\u201B\u2032]/g,"'").replace(/[^\w\s'\-]/g,"").toLowerCase().trim()}catch{return s.toString().toLowerCase().trim()}},r=n.FACTION_KEYWORD||null;if(r){const s=a(r);let i;for(const o of Object.keys(pa))if(a(o)===s){i=o;break}if(i){const o=r.toString().replace(/[\u2018\u2019\u201B\u2032]/g,"'").trim();n.DISPLAY_FACTION=`${pa[i]} - ${o}`}else n.DISPLAY_FACTION=n.DISPLAY_FACTION||r+(n.DETACHMENT?` - ${n.DETACHMENT}`:"")}else n.DETACHMENT?n.DISPLAY_FACTION=n.DISPLAY_FACTION||n.DETACHMENT:n.DISPLAY_FACTION=n.DISPLAY_FACTION||"";if(!n.FACTION_KEY){if(n.FACTION_KEYWORD)try{n.FACTION_KEY=n.FACTION_KEYWORD.toString().toLowerCase()}catch{n.FACTION_KEY=String(n.FACTION_KEYWORD).toLowerCase()}else if(n.DISPLAY_FACTION){const s=(n.DISPLAY_FACTION||"").split(" - ")[0];try{n.FACTION_KEY=s.toString().toLowerCase()}catch{n.FACTION_KEY=String(s).toLowerCase()}}}return t}function Va(t,n,a,r,s="",i=!1,o="wargear"){if(!t)return;t.items=t.items||[];const l=Ka(String(n||"").trim()),c=l.quantity?String(l.quantity):"1x",d=l.name||"",m=ue(d);if(i){const u=String(a||""),y=String(s||"");if(ue(u)===ue(d)||y&&ue(y)===ue(d))return}const f=t.items.find(u=>ue(u.name||"")===m);if(f){const u=parseInt(String(f.quantity||"1x").replace(/x/i,""),10)||0,y=parseInt(String(c||"1x").replace(/x/i,""),10)||0;f.quantity=`${u+y}x`}else{const u=ue(d)==="warlord"?"special":o;t.items.push({quantity:c,name:d,items:[],type:u,nameshort:""})}}function Nm(t,n){if(!t||!n)return;n.items=n.items||[];const a=t.trim(),r=a.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),o=ue(i);if((n.items||[]).some(f=>f&&f.type==="special"&&ue((f.name||"").replace(/^Enhancement:\s*/i,""))===o))return;const d=`E: ${i.split(/\s+/).map(f=>f[0]?f[0].toUpperCase():"").join("")}${s}`.trim(),m={quantity:"1x",name:`Enhancement: ${i}`,nameshort:d,items:[],type:"special"};n.items.push(m)}function Om(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=[];let r=0;const s=f=>/^(\d+)x?\s+/i.test(String(f||"").trim()),i=(f,u)=>{const y=String(f||"").trim();if(!y)return y;if(s(y)){const g=y.match(/^(\d+)x?\s+(.*)$/i);if(g){const T=parseInt(g[1],10)||1,x=g[2].trim();return`${Math.max(1,T*(parseInt(u,10)||1))}x ${x}`}return y}return`${u}x ${y}`};for(;r<t.length;r++){const u=(t[r]||"").trim();if(u){if(u.startsWith("+")||u.startsWith("&")){a.push(u);continue}break}}for(const f of a){if(f.startsWith("&")){const T=f.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);T&&(T[1].trim(),(T[3]||"").trim());continue}const y=f.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(y){const g=y[1].trim().toUpperCase(),T=y[2].trim();if(g==="FACTION KEYWORD"){const x=T.split(" - ");n.SUMMARY.FACTION_KEYWORD=x[x.length-1].trim()}else g==="DETACHMENT"?n.SUMMARY.DETACHMENT=T.replace(/\u00A0/g," "):g==="TOTAL ARMY POINTS"&&(n.SUMMARY.TOTAL_ARMY_POINTS=T)}}if(n.SUMMARY.LIST_TITLE="",n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD){const f=n.SUMMARY.FACTION_KEYWORD,u=Object.keys(pa).find(g=>g.toLowerCase()===(f||"").toString().toLowerCase()),y=u?pa[u]:null;y?n.SUMMARY.DISPLAY_FACTION=`${y} - ${f}`:n.SUMMARY.DISPLAY_FACTION=f+(n.SUMMARY.DETACHMENT?` - ${n.SUMMARY.DETACHMENT}`:"");try{n.SUMMARY.FACTION_KEY=f.toString().toLowerCase()}catch{}}let o=null,l=null;const c=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,d=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;for(;r<t.length;r++){const f=t[r]||"",u=f.trim();if(!u)continue;if(/^Enhancement:\s*/i.test(u)){const C=u.replace(/^Enhancement:\s*/i,"").trim();l&&Nm(C,l);continue}const y=u.match(c);if(y){const C=y[1],D=y[2]?`${y[2]}x`:"1x",R=(y[3]||"").trim(),w=parseInt(y[4],10)||0,S=y[5],E={quantity:D,name:R,points:w,items:[],isComplex:!1,nameshort:""};C?(n.CHARACTER.push(E),l=E):(n["OTHER DATASHEETS"]=n["OTHER DATASHEETS"]||[],n["OTHER DATASHEETS"].push(E)),o=E,S&&S.split(",").map(W=>W.trim()).filter(Boolean).forEach(W=>Va(E,W,E.name,n.SUMMARY.FACTION_KEYWORD||"",E.name,!0));continue}const g=f.match(d);if(g){const C=g[1].trim(),D=C.match(/^(\d+)\s+with\s+(.*)$/i);if(D&&o){const S=parseInt(D[1],10)||1,E=D[2],W=o.items&&o.items.length>0?o.items[o.items.length-1]:o;E.split(",").map(A=>A.trim()).filter(Boolean).forEach(A=>{const P=i(A,S);Va(W,P,W.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const R=C.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(R&&o){const S=R[1],E=R[2].trim(),W=R[3]||"",A={quantity:S,name:E,items:[],type:"subunit"};if(o.items=o.items||[],o.items.push(A),W){const P=W.match(/^(\d+)\s+with\s+(.*)$/i);if(P){const O=parseInt(P[1],10)||1;P[2].split(",").map(B=>B.trim()).filter(Boolean).forEach(B=>{const ae=i(B,O);Va(A,ae,A.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)})}else W.split(",").map(O=>O.trim()).filter(Boolean).forEach(O=>Va(A,O,A.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0))}continue}const w=C.match(/^(\d+x?)\s+(.*)$/i);if(w&&o){const S={quantity:w[1],name:w[2].trim(),items:[],type:"subunit"};o.items=o.items||[],o.items.push(S);continue}if(o){Va(o,C,o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0);continue}continue}const T=u.match(/^(\d+)\s+with\s+(.*)$/i);if(T&&o){const C=parseInt(T[1],10)||1,D=T[2],R=o.items&&o.items.length>0?o.items[o.items.length-1]:o;D.split(",").map(w=>w.trim()).filter(Boolean).forEach(w=>{const S=i(w,C);Va(R,S,R.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const x=u.match(/^(.*?):\s*(.*)$/);if(x&&o){(x[2]||"").split(",").map(D=>D.trim()).filter(Boolean).forEach(D=>Va(o,D,o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0));continue}}const m=[...n.CHARACTER||[],...n["OTHER DATASHEETS"]||[]];for(const f of m){f&&Array.isArray(f.items)&&f.items.length>0&&ra(f.items);const u=f&&Array.isArray(f.items)?f.items.filter(y=>y&&y.type==="subunit"):[];for(const y of u)y&&Array.isArray(y.items)&&y.items.length>0&&ra(y.items)}return ms(n),n}function ta(t,n,a,r,s="",i=!1,o="wargear"){if(!t)return;t.items=t.items||[];const l=String(n||"").trim();if(/battlesuit support system|homing beacon|marker drone/i.test(l))try{On.push(`processing raw=${l} for target=${t&&t.name}`)}catch{}let c=l.split(",").map(w=>w.trim()).filter(Boolean);try{const w=new Set;c=c.filter(S=>{const E=ue(Ss(_a(S)));return w.has(E)?!1:(w.add(E),!0)})}catch{}try{/stealth shas'vre|stealth battlesuits/i.test((t&&t.name||"")+(s||"")+l)&&On.push(`splitParts target=${t&&t.name} top=${s} parts=${JSON.stringify(c)}`)}catch{}if(c.length>1){c.forEach(w=>ta(t,w,a,r,s,i,o));return}const d=Ka(l),m=d.quantity!==void 0&&d.quantity!==null;let f=m?String(d.quantity):"1x",u=d.name||"";try{u=Ss(_a(u))}catch{}const y=/battlesuit support system|homing beacon|marker drone/i;try{const w=u.toLowerCase();if(w.includes("battlesuit support system")||w.includes("homing beacon")||w.includes("marker drone"))try{On.push(`addItemToTarget target=${t&&t.name} raw=${l}`)}catch{}}catch{}const g=u.match(/^(\d+)x\s+(.*)$/i);if(g){const w=parseInt(g[1],10)||1,S=parseInt(String(f||"1x").replace(/x/i,""),10)||1;f=`${Math.max(1,S*w)}x`,u=g[2]}try{On.push(`PARSE_QTY name=${u} parsedQtyRaw=${String(d.quantity||"")} qtyToken=${f}`)}catch{}let T=(w=>isNaN(w)?1:w)(parseInt(String(f||"1x").replace(/x/i,""),10)),x=T;try{if(t&&t.type==="subunit"){const w=parseInt(String(t.quantity||"1x").replace(/[^0-9]/g,""),10)||1;try{On.push(`CALC_EFFECTIVE target=${t&&t.name} parentQty=${w} parsedQty=${T} hasExplicit=${m}`)}catch{}x=m?T:w;try{On.push(`EFFECTIVE_QTY target=${t&&t.name} effectiveQty=${x}`)}catch{}}}catch{}const C=u,D=ue(u);if(i){const w=String(a||""),S=String(s||"");if(ue(w)===ue(u)||S&&ue(S)===ue(u)){if(y.test(u))try{On.push(`SKIP matched unitname name=${u} ctx=${w} top=${S}`)}catch{}return}}const R=t.items.find(w=>ue(w.name||"")===D);if(R){const w=parseInt(String(R.quantity||"1x").replace(/x/i,""),10)||0,S=w+x;R.quantity=`${S}x`;try{On.push(`UPDATED existing name=${u} existing=${w} added=${x} new=${S} target=${t&&t.name}`)}catch{}}else{const w=ue(u)==="warlord"?"special":o;t.items.push({quantity:`${x}x`,name:C,items:[],type:w,nameshort:""});try{On.push(`PUSHED new name=${u} quantity=${x} target=${t&&t.name}`)}catch{}}}function _a(t){if(!t)return t;const n=t.toLowerCase();return n.includes("shield")&&n.includes("drone")?"Shield Drone":n.includes("marker")&&n.includes("drone")?"Marker Drone":n.includes("marker")&&n.includes("beacon")?"Homing Beacon":t}function Ss(t){return t&&t.split(/\s+/).map(n=>!n||/[A-Z]/.test(n.slice(1))?n:n[0].toUpperCase()+n.slice(1).toLowerCase()).join(" ")}function Wi(t,n){if(!n)return`${t}x`;const a=String(n).trim(),r=a.match(/^(\d+)x\s+(.*)$/i);if(r){const s=parseInt(r[1],10)||1,i=r[2]||"";return`${Math.max(1,t*s)}x ${i}`}return`${t}x ${a}`}function Wm(t,n){if(!t||!n)return;n.items=n.items||[];const a=t.trim(),r=a.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),o=ue(i);if((n.items||[]).some(f=>{if(!f||!f.name)return!1;const u=String(f.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]+\)$/,"").trim();return ue(u)===o}))return;const d=`E: ${i.split(/\s+/).map(f=>f[0]?f[0].toUpperCase():"").join("")}${s}`.trim(),m={quantity:"1x",name:`Enhancement: ${i}`,nameshort:d,items:[],type:"special"};n.items.push(m)}function Ym(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=[];let r=0;for(;r<t.length;r++){const m=(t[r]||"").trim();if(m){if(m.startsWith("+")){a.push(m);continue}if(!m.startsWith("&"))break}}for(const d of a){const f=d.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(f){const u=f[1].trim().toUpperCase(),y=f[2].trim();if(u==="FACTION KEYWORD"){const g=y.split(" - ");n.SUMMARY.FACTION_KEYWORD=g[g.length-1].trim()}else u==="DETACHMENT"?n.SUMMARY.DETACHMENT=y.replace(/\u00A0/g," "):u==="TOTAL ARMY POINTS"&&(n.SUMMARY.TOTAL_ARMY_POINTS=y)}}if(n.SUMMARY.LIST_TITLE="",n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD){const d=n.SUMMARY.FACTION_KEYWORD,m=Object.keys(pa).find(u=>u.toLowerCase()===(d||"").toString().toLowerCase()),f=m?pa[m]:null;f?n.SUMMARY.DISPLAY_FACTION=`${f} - ${d}`:n.SUMMARY.DISPLAY_FACTION=d+(n.SUMMARY.DETACHMENT?` - ${n.SUMMARY.DETACHMENT}`:"");try{n.SUMMARY.FACTION_KEY=d.toString().toLowerCase()}catch{}}const s=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,i=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;let o=null,l=null;for(;r<t.length;r++){const d=t[r]||"",m=d.trim();if(!m)continue;if(/^Enhancement:\s*/i.test(m)){const T=m.replace(/^Enhancement:\s*/i,"").trim();l&&Wm(T,l);continue}const f=m.match(s);if(f){const T=f[1],x=f[2]?`${f[2]}x`:"1x",C=(f[3]||"").trim(),D=parseInt(f[4],10)||0,R=f[5],w={quantity:x,name:C,points:D,items:[],isComplex:!1,nameshort:"",charId:T||null};T?(n.CHARACTER.push(w),l=w):(n["OTHER DATASHEETS"]=n["OTHER DATASHEETS"]||[],n["OTHER DATASHEETS"].push(w)),o=w,R&&R.split(",").map(S=>S.trim()).filter(Boolean).forEach(S=>ta(w,S,w.name,n.SUMMARY.FACTION_KEYWORD||"",w.name,!0));continue}const u=d.match(i);if(u){const T=u[1].trim(),x=T.match(/^(\d+)\s+with\s+(.*)$/i);if(x&&o){const R=parseInt(x[1],10)||1,w=x[2],S=o.items&&o.items.length>0?o.items[o.items.length-1]:o;try{On.push(`WITHMATCH unit=${o.name} target=${S&&S.name} n=${R} rest=${w}`)}catch{}w.split(",").map(E=>E.trim()).filter(Boolean).forEach(E=>{const A=Ss(_a(E));if(S&&S.type==="subunit"){try{On.push(`WITH->SUB target=${S.name} item=${A} n=${R}`)}catch{}ta(S,`${R}x ${A}`,S.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}else{try{On.push(`WITH->UNIT unit=${o.name} item=${A} n=${R}`)}catch{}ta(S,Wi(R,A),S.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}});continue}const C=T.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(C&&o){const R=C[1],w=C[2].trim(),S=C[3]||"",E={quantity:R,name:w,items:[],type:"subunit",_parent:o};if(o.items=o.items||[],o.items.push(E),S){const W=S.match(/^(\d+)\s+with\s+(.*)$/i);W?W[2].split(",").map(P=>P.trim()).filter(Boolean).forEach(P=>{const O=_a(P);ta(E,O,E.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}):S.split(",").map(A=>A.trim()).filter(Boolean).forEach(A=>{const P=_a(A);ta(E,P,E.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)})}continue}const D=T.match(/^(\d+x?)\s+(.*)$/i);if(D&&o)if(o.charId){const R=D[1],w=D[2].trim();ta(o,`${R} ${w}`,o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0);continue}else{const R={quantity:D[1],name:D[2].trim(),items:[],type:"subunit",_parent:o};o.items=o.items||[],o.items.push(R);continue}if(o){let R=T.split(",").map(S=>S.trim()).filter(Boolean);try{const S=o.items&&o.items.length>0?o.items[o.items.length-1]:null;S&&S.name&&(R=R.map(E=>{const W=E.match(/^(.*)\s*\(([^)]+)\)\s*$/);if(W){const A=W[1].trim();if(ue(A)===ue(S.name))return A}return E}))}catch{}try{const S=new Set;R=R.filter(E=>{const W=ue(Ss(_a(E)));return S.has(W)?!1:(S.add(W),!0)})}catch{}let w=o;if(o.items&&o.items.length>0){const S=o.items[o.items.length-1];S&&S.type==="subunit"&&(w=S)}R.forEach(S=>{const E=Ss(_a(S));ta(w,E,w.name||o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}continue}const y=m.match(/^(\d+)\s+with\s+(.*)$/i);if(y&&o){const T=parseInt(y[1],10)||1,x=y[2],C=o.items&&o.items.length>0?o.items[o.items.length-1]:o;x.split(",").map(D=>D.trim()).filter(Boolean).forEach(D=>{const w=Ss(_a(D));C&&C.type==="subunit"?ta(C,`${T}x ${w}`,C.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0):ta(C,Wi(T,w),C.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const g=m.match(/^(.*?):\s*(.*)$/);if(g&&o){(g[2]||"").split(",").map(x=>x.trim()).filter(Boolean).forEach(x=>{const C=_a(x);ta(o,C,o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}}const c=[...n.CHARACTER||[],...n["OTHER DATASHEETS"]||[]];for(const d of c){d&&Array.isArray(d.items)&&d.items.length>0&&ra(d.items);const m=d&&Array.isArray(d.items)?d.items.filter(f=>f&&f.type==="subunit"):[];for(const f of m)f&&Array.isArray(f.items)&&f.items.length>0&&ra(f.items)}ms(n);try{n.SUMMARY._parseDebug=(On||[]).slice(0,200)}catch{}return n}const On=[];function mr(t){const n=Fa(t);if(n>0)return n;const a=(t||"").trim();return a.startsWith("â¦")||a.startsWith("+")?2:0}function dr(t){if(!t)return"";const n=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(t).split(/\s+/).map((a,r)=>{if(!a)return"";const s=a.toLowerCase();return r>0&&n.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function gs(t,n,a,r,s="",i=!1,o="wargear",l=1){if(!t)return;t.items=t.items||[];const c=Ka(String(n||"").trim()),d=c.quantity?String(c.quantity):"1x",m=c.name||"",f=ue(m);if(i){const y=String(a||""),g=String(s||"");if(ue(y)===ue(m)||g&&ue(g)===ue(m))return}const u=t.items.find(y=>ue(y.name||"")===f);if(u){const y=parseInt(String(u.quantity||"1x").replace(/x/i,""),10)||0,g=parseInt(String(d||"1x").replace(/x/i,""),10)||0;u.quantity=`${y+g}x`}else{const y=ue(m)==="warlord"?"special":o;t.items.push({quantity:d,name:m,items:[],type:y,nameshort:""})}}function Yi(t,n,a){if(!t||!n)return;n.items=n.items||[];const r=t.trim(),s=r.match(/\(([^)]+)\)$/),i=s?` (${s[1]})`:"",o=r.replace(/\s*\([^)]+\)$/,"").trim(),l=ue(o);if((n.items||[]).some(u=>u&&u.type==="special"&&ue((u.name||"").replace(/^Enhancement:\s*/i,""))===l))return;const m=`E: ${o.split(/\s+/).map(u=>u[0]?u[0].toUpperCase():"").join("")}${i}`.trim(),f={quantity:"1x",name:`Enhancement: ${o}`,nameshort:m,items:[],type:"special"};n.items.push(f)}function Hm(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=t.findIndex(u=>a.test((u||"").trim().toUpperCase()));let i=(r===-1?t.slice(0,0):t.slice(0,r)).map(u=>(u||"").trim()).filter(u=>u&&!u.startsWith("Exported with"));const o=i.findIndex(u=>u&&u.trim()!=="");if(o!==-1){const u=i[o],y=u.match(/^(.*?)\s*\((\s*\d+\s*(?:pts|points)\s*)\)\s*$/i);if(y){n.SUMMARY.LIST_TITLE=y[1].trim();const E=(y[2].match(/(\d+)/)||[])[1]||"";E&&(n.SUMMARY.TOTAL_ARMY_POINTS=`${E}pts`)}else n.SUMMARY.LIST_TITLE=u;const g=[];for(let E=o+1;E<i.length;E++){const W=i[E];W&&g.push(W)}const T=["Combat Patrol","Incursion","Strike Force","Onslaught"],x=E=>{if(!E||!/\(/.test(E))return!1;for(const W of T)if(new RegExp(W,"i").test(E))return!0;return!1},C=new Set(Object.values(pa).map(E=>(E||"").toString().toLowerCase())),D=g.filter(E=>!(!E||x(E)||C.has(E.toLowerCase())));let R=null,w=null;const S=Object.keys(pa).map(E=>E.toLowerCase());for(const E of D)S.includes((E||"").toString().toLowerCase())?R=E:w||(w=E);if(!R&&D.length>0&&(R=D[0],w=D.length>1?D[1]:w),R&&(n.SUMMARY.FACTION_KEYWORD=R),w&&(n.SUMMARY.DETACHMENT=w),R){const E=Object.keys(pa).find(A=>A.toLowerCase()===R.toLowerCase()),W=E?pa[E]:null;W?n.SUMMARY.DISPLAY_FACTION=`${W} - ${R}`:n.SUMMARY.DISPLAY_FACTION=R+(w?` - ${w}`:"");try{n.SUMMARY.FACTION_KEY=R.toString().toLowerCase()}catch{}}}const l=r===-1?0:r,c=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*$/i,d=/^\s*(?:â¢|\-|\+|â¦)\s*(.*)$/;let m=null;for(let u=l;u<t.length;u++){const g=(t[u]||"").trim();if(!g||g.startsWith("Exported with"))continue;if(a.test(g.toUpperCase())){m=/^CHARACTERS?/i.test(g)?"CHARACTER":"OTHER DATASHEETS";continue}const T=g.match(c);if(T){const x=T[1].trim(),C=parseInt(String(T[2]).replace(/[\,\.\s]/g,""),10)||0;let D="1x",R=x;const w=x.match(/^([0-9]+x?)\s+(.*)$/i);w&&(D=w[1].toLowerCase(),R=w[2].trim());const S={quantity:D,name:R,points:C,items:[],isComplex:!1,nameshort:""},E=m==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[E]=n[E]||[],n[E].push(S);const W=[];let A=u+1;for(;A<t.length;){const B=t[A]||"";if(!B.trim()||a.test(B.trim().toUpperCase())||c.test(B.trim())||!/^\s+/.test(B)&&!d.test(B))break;W.push(B),A++}const P=(()=>{for(let B=0;B<W.length;B++){const ae=W[B];if(!ae.match(d))continue;const j=mr(ae);for(let Z=B+1;Z<W.length;Z++){const oe=W[Z];if(!oe.trim()||mr(oe)<=j)break;if(d.test(oe))return!0}}return!1})();let O=null,ne=0;for(let B=0;B<W.length;B++){const ae=W[B],se=ae.trim(),j=ae.match(d),Z=mr(ae);if(j){const oe=j[1].trim(),me=oe.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(oe)){Yi(oe.replace(/^Enhancement:\s*/i,"").trim(),S,n.SUMMARY.FACTION_KEYWORD||"");continue}else if(me){Yi(oe.trim(),S,n.SUMMARY.FACTION_KEYWORD||"");continue}if(P){if(O&&typeof ne=="number"&&Z>ne){gs(O,oe,O.name,n.SUMMARY.FACTION_KEYWORD||"",S.name,!1);continue}if(!(()=>{for(let F=B+1;F<W.length;F++){const H=W[F];if(!H.trim()||mr(H)<=Z)break;if(d.test(H))return!0}return!1})()){O=null,gs(S,oe,S.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}O=null;const re=oe.match(/^(\d+x?)\s+(.*)$/i),I=re?re[1]:"1x",q=re?re[2].trim():oe,ee={quantity:I,name:q,items:[],type:"subunit"};S.items=S.items||[],S.items.push(ee),O=ee,ne=Z;continue}gs(S,oe,S.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(O&&Z>ne){gs(O,se,O.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}gs(S,se,S.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1)}u=A-1;continue}}function f(u,y){if(!(!u||typeof u!="object")){if(typeof u.name!="string"&&(u.name=""),typeof u.quantity!="string"&&(u.quantity=u.quantity?String(u.quantity):"1x"),typeof u.type!="string"&&(u.type=u.type||"wargear"),typeof u.nameshort!="string"&&(u.nameshort=u.nameshort||""),Array.isArray(u.items)||(u.items=[]),/^Enhancement:/i.test(u.name)){const g=u.name.replace(/^Enhancement:\s*/i,"").trim();u.type="special",u.nameshort=u.nameshort||(()=>{const T=g.match(/\(([^)]+)\)$/),x=T?` (${T[1]})`:"";return`E: ${g.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(R=>R[0]?R[0].toUpperCase():"").join("")}${x}`.trim()})(),u.name=`Enhancement: ${dr(g.replace(/\s*\([^)]+\)$/,"").trim())}`}else u.name=y?u.name:dr(u.name);ue(u.name)==="warlord"&&(u.type="special"),u.items=(u.items||[]).map(g=>{if(!g)return null;if(typeof g=="string"){const T={quantity:"1x",name:g.trim(),items:[],type:/^Enhancement:/i.test(g)?"special":"wargear",nameshort:""};return f(T,u.name),T.name&&(T.name=dr(T.name)),T}return f(g,u.name),g&&g.name&&(g.name=dr(g.name)),g}).filter(Boolean)}}for(const u of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[u]))for(const y of n[u]){f(y);const g=(y.items||[]).filter(T=>T&&T.type==="subunit");if(g.length>0)if(g.every(x=>ue(x.name||"")===ue(y.name||""))){const x=new Map;let C=0;for(const D of g){const R=parseInt(String(D.quantity||"1x").replace(/x/i,""),10)||1;C+=R;for(const w of D.items||[]){const S={items:[]};gs(S,`${w.quantity||"1x"} ${w.name}`,y.name,n.SUMMARY.FACTION_KEYWORD||"",w.type||"wargear",1);for(const E of S.items){const W=ue(E.name||"");if(x.has(W)){const A=x.get(W),P=parseInt(String(A.quantity||"1x").replace(/x/i,""),10)||0,O=parseInt(String(E.quantity||"1x").replace(/x/i,""),10)||0;A.quantity=`${P+O}x`}else x.set(W,E)}}}y.items=Array.from(x.values()),C>0&&(y.quantity=`${C}x`),y.isComplex=!1}else{const x=g.reduce((C,D)=>C+(parseInt(String(D.quantity||"1x").replace(/x/i,""),10)||0),0);x>0&&(y.quantity=`${x}x`),y.isComplex=!0}else y.isComplex=!1;Array.isArray(y.items)&&y.items.length>0&&ra(y.items)}return ms(n),n}function Hi(t){if(!t)return"";const n=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(t).split(/\s+/).map((a,r)=>{if(!a)return"";const s=a.toLowerCase();return r>0&&n.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function Na(t,n,a,r,s="",i=!1,o="wargear",l=1){if(!t)return;t.items=t.items||[];const c=Ka(String(n||"").trim()),d=c.quantity?String(c.quantity):"1x",m=parseInt(String(d||"1x").replace(/[^0-9]/g,""),10)||1,f=`${m*(l||1)}x`;let u=c.name||"";if(!i)try{const T=u.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(T){const x=T[1].trim(),C=T[2].trim(),D=ue(x),R=ue(a||""),w=ue(s||"");D&&(D===R||D===w||R.startsWith(D+" ")||w.startsWith(D+" ")||D.startsWith(R+" ")||D.startsWith(w+" "))&&(u=C)}}catch{}const y=ue(u);if(i){const T=String(a||""),x=String(s||""),C=ue(u),D=ue(T),R=ue(x),w=D&&C.startsWith(D+" "),S=R&&C.startsWith(R+" ");if(D&&(C===D||w)||R&&(C===R||S)){const E=u.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(E){const W=E[1].trim(),A=E[2].trim(),P=ue(W);if(P===D||P===R||P.startsWith(D+" ")||P.startsWith(R+" ")){if(t&&t._deferredParenthetical&&ue(t._deferredParenthetical)===ue(A)||t&&t._deferredParenthetical&&ue(t._deferredParenthetical)===ue(A)||(t.items||[]).some(ne=>ue(ne.name||"")===ue(A)))return;Na(t,A,a,r,s,!1,o,m);return}}return}}const g=t.items.find(T=>ue(T.name||"")===y);if(g){const T=parseInt(String(g.quantity||"1x").replace(/x/i,""),10)||0,x=parseInt(String(f||"1x").replace(/x/i,""),10)||0;g.quantity=`${T+x}x`}else{const T=ue(u)==="warlord"?"special":o;t.items.push({quantity:f,name:u,items:[],type:T,nameshort:""})}}function Xr(t,n,a){if(!t||!n)return;n.items=n.items||[];const r=t.trim(),s=r.match(/\(([^)]+)\)$/),i=s?` (${s[1]})`:"",o=r.replace(/\s*\([^)]+\)$/,"").trim(),l=ue(o);if((n.items||[]).some(u=>u&&u.type==="special"&&ue((u.name||"").replace(/^Enhancement:\s*/i,""))===l))return;const m=`E: ${o.split(/\s+/).map(u=>u[0]?u[0].toUpperCase():"").join("")}${i}`.trim(),f={quantity:"1x",name:`Enhancement: ${o}`,nameshort:m,items:[],type:"special"};n.items.push(f)}function Fi(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*(?::\s*(.*))?$/i,s=/^\s*(?:â¢|\-|\+|â¦)\s*(.*)$/;let i=null;for(let l=0;l<t.length;l++){const d=(t[l]||"").trim();if(!d)continue;if(a.test(d.toUpperCase())){i=/^CHARACTERS?/i.test(d)?"CHARACTER":"OTHER DATASHEETS";continue}const m=d.match(r);if(m){const f=m[1].trim(),u=parseInt(String(m[2]).replace(/[\,\.\s]/g,""),10)||0;let y="1x",g=f;const T=f.match(/^([0-9]+x?)\s+(.*)$/i);T&&(y=T[1].toLowerCase(),g=T[2].trim());const x={quantity:y,name:g,points:u,items:[],isComplex:!1,nameshort:""},C=i==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[C]=n[C]||[],n[C].push(x);const D=m[3]||"";D&&D.split(",").map(A=>A.trim()).filter(Boolean).forEach(A=>Na(x,A,x.name,n.SUMMARY.FACTION_KEYWORD||"",x.name,!0));const R=[];let w=l+1;for(;w<t.length;){const A=t[w]||"";if(!A.trim()||a.test(A.trim().toUpperCase())||r.test(A.trim())||!/^\s+/.test(A)&&!s.test(A))break;R.push(A),w++}const S=(()=>{for(let A=0;A<R.length;A++){const P=R[A];if(!P.match(s))continue;const ne=Fa(P);for(let B=A+1;B<R.length;B++){const ae=R[B];if(!ae.trim()||Fa(ae)<=ne)break;if(s.test(ae))return!0}}return!1})();let E=null,W=0;for(let A=0;A<R.length;A++){const P=R[A],O=P.trim(),ne=P.match(s),B=Fa(P);if(ne){const ae=ne[1].trim(),se=ae.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(ae)){Xr(ae.replace(/^Enhancement:\s*/i,"").trim(),x,n.SUMMARY.FACTION_KEYWORD||"");continue}else if(se){Xr(ae.trim(),x,n.SUMMARY.FACTION_KEYWORD||"");continue}if(S){if(E&&typeof W=="number"&&B>W){const _e=ae.split(",").map(re=>re.trim()).filter(Boolean);for(let re of _e){const I=re.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(I){const q=I[1].trim(),ee=I[2].trim();if(ue(q)===ue(E.name)){const F=_e.some(J=>ue(J)===ue(ee)),H=(E.items||[]).some(J=>ue(J.name||"")===ue(ee));if(F||H)continue;const Me=Ka(re),st=parseInt(String(Me.quantity||"1x").replace(/[^0-9]/g,""),10)||1;Na(E,ee,E.name,n.SUMMARY.FACTION_KEYWORD||"",x.name,!1,"wargear",st);continue}}Na(E,re,E.name,n.SUMMARY.FACTION_KEYWORD||"",x.name,!0)}continue}E=null;const j=ae.match(/^(\d+x?)\s+(.*)$/i),Z=j?j[1]:"1x";let oe=j?j[2].trim():ae;try{const _e=oe.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(_e){const re=_e[1].trim(),I=_e[2].trim(),q=ue(re),ee=ue(x.name||""),F=ue(unitTopName||x.name||"");if(q&&(q===ee||ee.startsWith(q)||q.startsWith(ee)||F.startsWith(q)||q.startsWith(F))){oe=re;const H={quantity:Z,name:oe,items:[],type:"subunit"};H._deferredParenthetical=I,H._deferredParentheticalQty=parseInt(String(Z||"1x").replace(/[^0-9]/g,""),10)||1,x.items=x.items||[],x.items.push(H),E=H,W=B;continue}}}catch{}const me={quantity:Z,name:oe,items:[],type:"subunit"};x.items=x.items||[],x.items.push(me),E=me,W=B;continue}Na(x,ae,x.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(E&&B>W){Na(E,O,E.name,n.SUMMARY.FACTION_KEYWORD||"",x.name,!0);continue}Na(x,O,x.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1)}l=w-1;continue}}function o(l,c){if(!(!l||typeof l!="object")){if(typeof l.name!="string"&&(l.name=""),typeof l.quantity!="string"&&(l.quantity=l.quantity?String(l.quantity):"1x"),typeof l.type!="string"&&(l.type=l.type||"wargear"),typeof l.nameshort!="string"&&(l.nameshort=l.nameshort||""),Array.isArray(l.items)||(l.items=[]),/^Enhancement:/i.test(l.name)){const d=l.name.replace(/^Enhancement:\s*/i,"").trim();l.type="special",l.nameshort=l.nameshort||(()=>{const m=d.match(/\(([^)]+)\)$/),f=m?` (${m[1]})`:"";return`E: ${d.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(g=>g[0]?g[0].toUpperCase():"").join("")}${f}`.trim()})(),l.name=`Enhancement: ${Hi(d.replace(/\s*\([^)]+\)$/,"").trim())}`}else l.name=c?l.name:Hi(l.name);ue(l.name)==="warlord"&&(l.type="special"),l.items=(l.items||[]).map(d=>{if(!d)return null;if(typeof d=="string"){const m={quantity:"1x",name:d.trim(),items:[],type:/^Enhancement:/i.test(d)?"special":"wargear",nameshort:""};return o(m,l.name),m}return o(d,l.name),d}).filter(Boolean)}}for(const l of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[l]))for(const c of n[l]){o(c);const d=(c.items||[]).filter(f=>f&&f.type==="subunit");if(d.length>0)if(d.every(u=>ue(u.name||"")===ue(c.name||""))){const u=new Map;let y=0;for(const g of d){const T=parseInt(String(g.quantity||"1x").replace(/x/i,""),10)||1;y+=T;for(const x of g.items||[]){const C={items:[]};Na(C,`${x.quantity||"1x"} ${x.name}`,c.name,n.SUMMARY.FACTION_KEYWORD||"",x.type||"wargear",1);for(const D of C.items){const R=ue(D.name||"");if(u.has(R)){const w=u.get(R),S=parseInt(String(w.quantity||"1x").replace(/x/i,""),10)||0,E=parseInt(String(D.quantity||"1x").replace(/x/i,""),10)||0;w.quantity=`${S+E}x`}else u.set(R,D)}}}c.items=Array.from(u.values()),y>0&&(c.quantity=`${y}x`),c.isComplex=!1}else{const u=d.reduce((y,g)=>y+(parseInt(String(g.quantity||"1x").replace(/x/i,""),10)||0),0);u>0&&(c.quantity=`${u}x`),c.isComplex=!1}else c.isComplex=!1;if(Array.isArray(c.items)&&c.items.length===1&&c.items[0]&&c.items[0].type==="subunit"){const f=c.items[0];Array.isArray(f.items)&&f.items.length>0&&(c.items=f.items.slice(),c.isComplex=!1)}Array.isArray(c.items)&&c.items.length>0&&ra(c.items);const m=(c.items||[]).filter(f=>f&&f.type==="subunit");for(const f of m)Array.isArray(f.items)&&f.items.length>0&&ra(f.items)}return ms(n),n}function Fm(t){if(!Array.isArray(t))return Fi(t);const n=[];let a=0;for(;a<t.length;a++){const f=String(t[a]||"").trim();if(!f){n.push(f);continue}if(f.startsWith("+")||f.startsWith("&")){n.push(f);continue}break}const r=[],s={};for(const m of n){if(!m)continue;if(m.startsWith("&")){const g=m.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);g&&r.push({enh:g[1].trim(),target:(g[3]||"").trim(),charId:g[2]||null});continue}const u=m.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(u){const y=u[1].trim().toUpperCase(),g=u[2].trim();if(y==="ENHANCEMENT"){const T=g.match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);T?r.push({enh:T[1].trim(),target:(T[3]||"").trim(),charId:T[2]||null}):r.push({enh:g,target:null,charId:null})}else if(y==="FACTION KEYWORD"){const T=g.split(" - ");s.faction=T[T.length-1].trim()}else y==="DETACHMENT"?s.detachment=g.replace(/\u00A0/g," "):y==="TOTAL ARMY POINTS"&&(s.points=g)}}const i=t.slice(a),o=[];for(const m of i){if(!m){o.push(m);continue}let f=String(m);f=f.replace(/^\s*Char\d+:\s*/i,"");const u=f.match(/^(.*\))\s*:\s*(.+)$/);u?(o.push(u[1]),o.push("  â¢ "+u[2])):o.push(f)}const l=Fi(o);l.SUMMARY=l.SUMMARY||{},s.faction&&(l.SUMMARY.FACTION_KEYWORD=s.faction),s.detachment&&(l.SUMMARY.DETACHMENT=s.detachment),s.points&&(l.SUMMARY.TOTAL_ARMY_POINTS=s.points);const c=[...l.CHARACTER||[],...l["OTHER DATASHEETS"]||[]],d=m=>{const f=ue(String(m||""));for(const u of c){const y=u&&Array.isArray(u.items)?u.items:[];for(const g of y){if(!g||!g.name)continue;const T=String(g.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,"").trim();if(ue(T)===f)return!0}}return!1};for(const m of r){if(!m||!m.enh||d(m.enh))continue;let f=null;const u=y=>String(y||"").toLowerCase().replace(/[^a-z0-9 ]/g,"").trim();if(m.charId){const y=parseInt(String(m.charId).replace(/[^0-9]/g,""),10);!Number.isNaN(y)&&y>0&&Array.isArray(l.CHARACTER)&&l.CHARACTER[y-1]&&(f=l.CHARACTER[y-1])}!f&&m.target&&(f=c.find(y=>u(y.name).includes(u(m.target))||u(`${y.quantity} ${y.name}`).includes(u(m.target)))),!f&&c.length===1&&(f=c[0]),f&&Xr(m.enh,f,l.SUMMARY.FACTION_KEYWORD||"")}try{for(const m of["CHARACTER","OTHER DATASHEETS"]){const f=l[m];if(Array.isArray(f))for(const u of f)u&&typeof u=="object"&&Object.prototype.hasOwnProperty.call(u,"type")&&delete u.type}for(const m of["CHARACTER","OTHER DATASHEETS"]){const f=l[m];if(Array.isArray(f)){for(const u of f)if(!(!u||!Array.isArray(u.items))){for(const y of u.items.filter(g=>g&&g.type==="subunit"))if(y&&y._deferredParenthetical)try{delete y._deferredParenthetical,delete y._deferredParentheticalQty}catch{}}}}}catch{}return ms(l),l}function Bm(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=t.map(d=>String(d||"")).find(d=>d.trim()),r=t.findIndex(d=>String(d||"").trim());if(a){const d=a.split(/\s*-\s*/).map(m=>m.trim()).filter(Boolean);if(n.SUMMARY.FACTION_FAMILY=d[0]||"",n.SUMMARY.FACTION_KEYWORD=d[1]||"",d.length>=3){const f=d[d.length-1].match(/\[\s*(\d{2,5})\s*pts?\s*\]$/i);f?(n.SUMMARY.TOTAL_ARMY_POINTS=`${f[1]}pts`,d.length===3?n.SUMMARY.LIST_TITLE=d[2]:n.SUMMARY.LIST_TITLE=d.slice(2,d.length-1).join(" - ")):n.SUMMARY.LIST_TITLE=d.slice(2).join(" - ")}n.SUMMARY.DISPLAY_FACTION=a.trim()}for(let d=0;d<Math.min(t.length,40);d++){const m=String(t[d]||"").trim();if(!m)continue;const f=m.match(/^Detachment:\s*(.*)$/i);f&&(n.SUMMARY.DETACHMENT=f[1].trim());const u=m.match(/^TOTAL ARMY POINTS:\s*(.*)$/i);u&&(n.SUMMARY.TOTAL_ARMY_POINTS=u[1].trim());const y=m.match(/^FACTION KEYWORD:\s*(.*)$/i);y&&(n.SUMMARY.FACTION_KEYWORD=y[1].trim());const g=m.match(/^Battle Size:\s*(.*)$/i);g&&(n.SUMMARY.BATTLE_SIZE=g[1].trim());const T=m.match(/^#+\s*(?:\+{1,2}\s*)?(.*)\[\s*\d{2,5}\s*pts?\s*\]$/i);if(T&&!n.SUMMARY.LIST_TITLE){const x=T[1].trim();/Army\s+Roster/i.test(x)||/\+\+/.test(x)?n.SUMMARY.LIST_TITLE="":n.SUMMARY.LIST_TITLE=x}}if(!n.SUMMARY.FACTION_KEYWORD&&n.SUMMARY.DISPLAY_FACTION){const d=n.SUMMARY.DISPLAY_FACTION.split(" - ");d.length>=2?n.SUMMARY.FACTION_KEYWORD=d[1].trim():n.SUMMARY.FACTION_KEYWORD=n.SUMMARY.DISPLAY_FACTION.replace(/\s*\[.*$/,"").trim()}const s=/^(?:(\d+)x?\s+)?(.+?)\s*\[\s*(\d{1,4})\s*pts?\s*\]\s*(?::\s*(.*))?$/i,i=/^\s*(?:â¢|\-|\+)\s*(.*)$/;let o=null,l=null;for(let d=0;d<t.length;d++){const m=String(t[d]||""),f=m.trim();if(!f||d===r)continue;if(f.startsWith("#")){const g=f.match(/^#+\s*(.+?)\s*(?:\[\s*\d+\s*pts?\s*\])?$/i);if(g){const T=g[1].trim();/character|epic|hero|hq/i.test(T)?o="CHARACTER":o="OTHER DATASHEETS"}continue}const u=f.match(s);if(u){const g=u[1]?`${u[1]}x`:"1x",T=(u[2]||"").trim(),x=parseInt(u[3],10)||0,C=u[4]||"",D={quantity:g,name:T,points:x,items:[],isComplex:!1,nameshort:""};o||(o="OTHER DATASHEETS"),n[o]=n[o]||[],n[o].push(D),l=D,C&&C.split(",").map(R=>R.trim()).filter(Boolean).forEach(R=>{c(l,R,l.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}const y=m.match(i);if(y&&l){const g=y[1].trim(),T=g.match(/^(\d+)\s+with\s+(.*)$/i);if(T&&l){const D=parseInt(T[1],10)||1,R=T[2],w=l.items&&l.items.length>0?l.items[l.items.length-1]:l;R.split(",").map(S=>S.trim()).filter(Boolean).forEach(S=>c(w,`${D}x ${S}`,w.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0));continue}const x=g.match(/^(\d+x?)\s+([^:]+):\s*(.*)$/i);if(x){const D=x[1];let R=x[2].trim();const w=x[3]||"";R=R.replace(/\s+w\/.*$/i,"").trim();const S={quantity:D,name:R,items:[],type:"subunit"};if(w){const E=w.match(/^(\d+)\s+with\s+(.*)$/i);if(E){const W=parseInt(E[1],10)||1;E[2].split(",").map(P=>P.trim()).filter(Boolean).forEach(P=>c(S,`${W}x ${P}`,S.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0))}else w.split(",").map(W=>W.trim()).filter(Boolean).forEach(W=>c(S,W,S.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0))}l.items=l.items||[],l.items.push(S);continue}const C=g.match(/^(\d+x?)\s+(.*)$/i);if(C&&l){let D=C[2].trim();D=D.replace(/\s+w\/.*$/i,"").trim();const R={quantity:C[1],name:D,items:[],type:"subunit"};l.items=l.items||[],l.items.push(R);continue}c(l,g,l.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0);continue}}function c(d,m,f,u,y="",g=!1,T="wargear"){if(!d)return;d.items=d.items||[];const x=String(m||"").trim(),C=Ka(x),D=C.quantity?String(C.quantity):"1x",R=/^\s*\d+x?\s+/i.test(x);let w=C.name||"";const S=w.match(/^(.*?)\s*\(([^)]+)\)$/);if(S){const O=(S[1]||"").trim(),ne=(S[2]||"").trim();(/\bDrone\b/i.test(O)||/\bDrone\b/i.test(w))&&(w=ne)}const E=ue(w);if(g){const O=String(f||""),ne=String(y||"");if(ue(O)===ue(w)||ne&&ue(ne)===ue(w))return}const W=parseInt(String(D||"1x").replace(/x/i,""),10)||1;let A=W;if(d&&d.type==="subunit"){const O=parseInt(String(d.quantity||"1x").replace(/[^0-9]/g,""),10)||1;A=R?W:O}const P=d.items.find(O=>ue(O.name||"")===E);if(P){const O=parseInt(String(P.quantity||"1x").replace(/x/i,""),10)||0;P.quantity=`${O+A}x`}else{const O=ue(w)==="warlord"?"special":T;d.items.push({quantity:`${A}x`,name:w,items:[],type:O,nameshort:""})}}for(const d of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[d]))for(const m of n[d]){if(!m||!Array.isArray(m.items)||m.items.length===0)continue;if(m.items.filter(y=>y&&y.type==="subunit").length>1){const y=new Map,g=[];for(const T of m.items){if(!T||T.type!=="subunit"){g.push(T);continue}const x=ue(T.name||"");if(!y.has(x))y.set(x,{quantity:T.quantity||"1x",name:T.name,items:Array.isArray(T.items)?T.items.slice():[],type:"subunit"});else{const C=y.get(x),D=parseInt(String(C.quantity||"1x").replace(/[^0-9]/g,""),10)||0,R=parseInt(String(T.quantity||"1x").replace(/[^0-9]/g,""),10)||0;C.quantity=`${D+R}x`;const w=new Map;for(const S of C.items||[]){const E=ue(S&&S.name||"");E&&w.set(E,{quantity:S.quantity||"1x",name:S.name,items:[],type:S.type||"wargear",nameshort:S.nameshort||""})}for(const S of T.items||[]){const E=ue(S&&S.name||"");if(E)if(w.has(E)){const W=w.get(E),A=parseInt(String(W.quantity||"1x").replace(/[^0-9]/g,""),10)||0,P=parseInt(String(S.quantity||"1x").replace(/[^0-9]/g,""),10)||0;W.quantity=`${A+P}x`}else w.set(E,{quantity:S.quantity||"1x",name:S.name,items:[],type:S.type||"wargear",nameshort:S.nameshort||""})}C.items=Array.from(w.values())}}m.items=[...g,...Array.from(y.values())]}m&&Array.isArray(m.items)&&m.items.length>0&&ra(m.items);const u=m&&Array.isArray(m.items)?m.items.filter(y=>y&&y.type==="subunit"):[];for(const y of u)y&&Array.isArray(y.items)&&y.items.length>0&&ra(y.items)}return ms(n),n}function qm(t,n=40){return(Array.isArray(t)?t:String(t||"").split(/\r?\n/)).slice(0,n)}function Um(t){const n=Array.isArray(t)?t:String(t||"").split(/\r?\n/),a=qm(n,40),r=n.join(`
`),s={NRNR:{score:0,breakdown:{},maxScore:8},"WTC-Compact":{score:0,breakdown:{},maxScore:8},WTC:{score:0,breakdown:{},maxScore:8},GWAPP:{score:0,breakdown:{},maxScore:7},"NR-GW":{score:0,breakdown:{},maxScore:7},LF:{score:0,breakdown:{},maxScore:7}},i=a.some(j=>/-\s*\[\s*\d{2,5}\s*pts?\s*\]$/i.test(j)),o=a.some(j=>/^#{1,3}\s+/.test(j)),l=a.some(j=>/^\s*#?\s*\+\+\s*Army Roster\s*\+\+/i.test(j)),c=a.some(j=>/^\s*##\s+/.test(j)),d=/(.+?)\s*[\(\[]\s*([0-9]{1,4})\s*(?:pts|points)\s*[\)\]]/i,m=r.match(new RegExp(d.source,"g"))||[],f=r.match(/^[ \t]*(?:â¢|\-|\+)\s*(?:\d+x?)\s+[^:]+:/gmi)||[],u=r.match(/\b[A-Za-z0-9\-\'â ]+\s*\([^\)]+\)/g)||[],y=/(^|\n)\s*Char\d+:.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)\s*:\s*/i,g=(r.match(new RegExp(y.source,"gi"))||[]).length,T=a.some(j=>/^(List Name|Factions Used|Army Points|Detachment Rule):/i.test(j.trim())),x=a.some(j=>/-\s*\(\s*\d+\s*Points?\s*\)\s*$/i.test(j)),C=r.match(/^(Epic Hero|Epic Heroes|Character|Characters|Battleline|Infantry|Beast|Vehicle|Dedicated Transport|Other Datasheets):\s*$/gmi)||[],D=(r.match(/^\s*â¢\s*(?:E:|Enhancement:)/gmi)||[]).length,R=(r.match(/^\s*â¢\s+/gmi)||[]).length;T&&(s.LF.score+=4,s.LF.breakdown.headerKeys=4),x&&(s.LF.score+=4,s.LF.breakdown.titleLine=4),C.length>=2&&(s.LF.score+=3,s.LF.breakdown.sectionColons=C.length),R>5&&(s.LF.score+=1,s.LF.breakdown.bullets=R),D>0&&(s.LF.score+=1,s.LF.breakdown.enhancementLines=D),(T||x||C.length>=2)&&(s.NRNR.score-=1,s.WTC.score-=1,s["WTC-Compact"].score-=1,s.GWAPP.score-=1,s["NR-GW"].score-=3),i&&(s.NRNR.score+=2,s.NRNR.breakdown.titleWithBracketedPts=2),o&&(s.NRNR.score+=3,s.NRNR.breakdown.markdownHeading=3),l&&(s.NRNR.score+=2,s.NRNR.breakdown.armyRoster=2),c&&(s.NRNR.score+=1,s.NRNR.breakdown.doubleHashSections=1),m.length>=3&&(s.NRNR.score+=1,s.NRNR.breakdown.unitLines=1),f.length>0&&(s.NRNR.score+=1,s.NRNR.breakdown.bulletWithQty=f.length),u.length>0&&(s.NRNR.score+=.5,s.NRNR.breakdown.parenItem=u.length);const w=a.join(`
`);/^[ \t]*[+&]/m.test(w)&&(s["WTC-Compact"].score+=3,s["WTC-Compact"].breakdown.headerPlusAmp=3),/(FACTION KEYWORD|DETACHMENT|TOTAL ARMY POINTS)/i.test(w)&&(s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.headerKeys=2),m.length>=2&&(s["WTC-Compact"].score+=1,s["WTC-Compact"].breakdown.unitLines=1),g>0&&(s["WTC-Compact"].score+=5,s["WTC-Compact"].breakdown.inlineCharList=g),/^\s*[+&]/m.test(w)&&(s.WTC.score+=1,s.WTC.breakdown.headerPlusAmp=1),/NUMBER OF UNITS:/i.test(w)&&(s.WTC.score+=2,s.WTC.breakdown.numberOfUnits=2);const S=(r.match(/(^|\n)\s*Char\d+:/gi)||[]).length>0;S&&(s.WTC.score+=3,s.WTC.breakdown.charMarkers=3),(o||l||c)&&(s.WTC.score-=2,s.WTC.breakdown.nrnrPenalty=-2,s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.nrnrPenalty=-1);const E=(r.match(/^\s*\d+\s+with\s+/gmi)||[]).length;E>0&&(s.WTC.score+=2,s.WTC.breakdown.withLines=E,s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.withLines=E),a.some(j=>/^(?:CHARACTER|OTHER DATASHEETS|CHARACTERS)\s*$/.test((j||"").trim()))&&(s.WTC.score+=1,s.WTC.breakdown.sectionHeaders=1),S&&(s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.charMarkerPenalty=-1),g>0&&(s.WTC.score-=2,s.WTC.breakdown.compactInlinePenalty=-2);const W=/Exported with/i.test(r);(/Exported with/i.test(w)||W)&&(s.GWAPP.score+=6,s.GWAPP.breakdown.exportedWith=6),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS)\b/i.test(r)&&(s.GWAPP.score+=2,s.GWAPP.breakdown.sectionHeaders=2),/\(\s*\d+\s*(?:pts|points)\s*\)/i.test(w)&&(s.GWAPP.score+=1,s.GWAPP.breakdown.titleParenPts=1),W&&(s["NR-GW"].score-=4,s["NR-GW"].breakdown.gwappPenalty=-4),/^\s*Strike Force\s*\(\s*\d{2,5}\s*points\s*\)/mi.test(r)&&(s.GWAPP.score+=3,s.GWAPP.breakdown.strikeForce=3),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|DEDICATED TRANSPORTS)\b/i.test(r)&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.sectionHeaders=2);const A=(r.match(/^[ \t]*(?:â¢|\u2022|â¦|\-|\+)\s+/gmi)||[]).length;A>0&&!W&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.bulletCount=A),u.length>0&&!W&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.parenItem=u.length);const P=(r.match(/^[ \t]*(?:â¢|\u2022|â¦|\-|\+)\s*\d+x?\s+[A-Za-z0-9\-\'â]+/gmi)||[]).length;P>=3&&!S&&!W&&(s["NR-GW"].score+=3,s["NR-GW"].breakdown.bulletQty=P);const O=/^(?:\s*)\d+x?\s+.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)/i,ne=n.filter(j=>O.test(j)).length;if(ne>=2&&!S&&!W&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.unitLinesNoChar=ne),!S&&!W&&(P>=3||ne>=2)&&(s.WTC.score-=2,s.WTC.breakdown.nrGwPenalty=-2,s["WTC-Compact"].score-=2,s["WTC-Compact"].breakdown.nrGwPenalty=-2),(o||l)&&(s["NR-GW"].score-=1,s["NR-GW"].breakdown.nrnrPenalty2=-1),r.indexOf("â")!==-1)for(const j of Object.keys(s))s[j].score+=.5,s[j].breakdown=s[j].breakdown||{},s[j].breakdown.unicodeApostrophe=.5;const B={};for(const j of Object.keys(s)){const Z=s[j],oe=Math.max(0,Math.min(1,Z.score/(Z.maxScore||8)));B[j]={score:Z.score,confidence:oe,scoreBreakdown:Z.breakdown}}const ae=Object.keys(B).sort((j,Z)=>B[Z].score-B[j].score)[0],se=B[ae]||{score:0,confidence:0};return{format:ae,confidence:se.confidence,score:se.score,scoreBreakdown:se.scoreBreakdown,all:B}}function Zo(t){const n=String(t||"").trim().match(/^(\d+)\s+(.*)$/);return n&&!/^\d+x\b/i.test(String(t||""))?`${n[1]}x ${n[2]}`:t}function el(t){const n=String(t||"").trim().replace(/^E:\s*/i,"").replace(/^Enhancement:\s*/i,"").trim(),a=n.match(/\(([^)]*pts?[^)]*)\)\s*$/i),r=n.replace(/\s*\([^)]*\)\s*$/,"").trim(),i=`E: ${r.split(/\s+/).map(o=>o[0]?o[0].toUpperCase():"").join("")}${a?` (${a[1].trim()})`:""}`.trim();return{quantity:"1x",name:`Enhancement: ${r}`,nameshort:i,items:[],type:"special"}}function Km(t,n){if(!t)return;t.items=t.items||[];const a=Zo(String(n||"").trim());if(/^(E:|Enhancement:)/i.test(a)){const s=el(a),i=ue(s.name.replace(/^Enhancement:\s*/i,""));(t.items||[]).some(l=>/^Enhancement:/i.test(l.name||"")&&ue(String(l.name).replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,""))===i)||t.items.push(s);return}const r=a.split(",").map(s=>s.trim()).filter(Boolean);for(const s of r){const i=Ka(s.replace(/^with\s+/i,"")),o=i.quantity||"1x",l=i.name||"";if(!l)continue;const c=ue(l),d=t.items.find(m=>ue(m.name||"")===c);if(d){const m=parseInt(String(d.quantity||"1x").replace(/[^0-9]/g,""),10)||0,f=parseInt(String(o).replace(/[^0-9]/g,""),10)||0;d.quantity=`${m+f}x`}else t.items.push({quantity:o,name:l,items:[],type:"wargear",nameshort:""})}}function Gm(t,n){const a=t[n]||"",r=Fa(a);for(let s=n+1;s<t.length;s++){const i=t[s]||"";if(!i.trim())continue;const o=Fa(i),l=/^\s*â¢\s*/.test(i);return o>r&&l}return!1}function zm(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=t.slice(0,30).map(u=>String(u||""));let r=!1;for(const u of a){const y=u.match(/^\s*([A-Za-z ][A-Za-z ]*):\s*(.*)$/);if(!y)continue;const g=y[1].trim().toLowerCase(),T=y[2].trim();if(g==="list name"&&(n.SUMMARY.LIST_TITLE=T,r=!0),g==="factions used"&&(n.SUMMARY.FACTION_KEYWORD=T,r=!0),g==="army points"){const x=parseInt(T.replace(/[^0-9]/g,""),10);x&&(n.SUMMARY.TOTAL_ARMY_POINTS=`${x}pts`,r=!0)}g==="detachment rule"&&(n.SUMMARY.DETACHMENT=T,r=!0)}if(!r){const u=t.find(y=>String(y||"").trim());if(u){const y=String(u).match(/^(.*?)\s*-\s*(.*?)\s*-\s*(.*?)\s*\((\d+)\s*Points?\)/i);y&&(n.SUMMARY.LIST_TITLE=y[1].trim(),n.SUMMARY.FACTION_KEYWORD=y[2].trim(),n.SUMMARY.DETACHMENT=y[3].trim(),n.SUMMARY.TOTAL_ARMY_POINTS=`${parseInt(y[4],10)}pts`)}}const s=/^\s*([A-Za-z ]+):\s*$/,i=/^\s*(.*?)\s*\((\d+)\s*pts?\)\s*$/i,o=/^\s*â¢\s*(.*)$/;let l=null;const c=[];for(let u=0;u<t.length;u++){const y=String(t[u]||"");if(!y.trim())continue;const T=y.match(s);if(T){const E=T[1].trim().toLowerCase();l=/hero|character/.test(E)?"CHARACTER":"OTHER DATASHEETS",c.length=0;continue}const x=y.match(i);if(x&&Fa(y)===0){const E=x[1].trim(),W=parseInt(x[2],10)||0,A={quantity:"1x",name:E,points:W,items:[],isComplex:!1,nameshort:""},P=l==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[P]=n[P]||[],n[P].push(A),c.length=0,c.push({indent:0,node:A});continue}const C=y.match(o);if(!C)continue;const D=C[1].trim(),R=Fa(y);for(;c.length>0&&R<=c[c.length-1].indent;)c.pop();const w=c.length>0?c[c.length-1].node:null;if(!w||/^B:\s*/i.test(D))continue;if(/^(E:|Enhancement:)/i.test(D)){const E=el(D),W=c[0]?c[0].node:w;W.items=W.items||[],(W.items||[]).some(P=>/^Enhancement:/i.test(P.name||"")&&ue(P.name)===ue(E.name))||W.items.push(E);continue}if(Gm(t,u)){const E=Ka(Zo(D));let W=E.name||"";W=W.replace(/\s+w\/.*$/i,"").trim();const A={quantity:E.quantity||"1x",name:W,items:[],type:"subunit"};w.items=w.items||[],w.items.push(A),c.push({indent:R,node:A});continue}Km(w,D)}function d(u){const y=parseInt(String(u||"1x").replace(/[^0-9]/g,""),10);return Number.isFinite(y)&&y>0?y:1}for(const u of["CHARACTER","OTHER DATASHEETS"]){const y=n[u]||[];for(const g of y){const T=Array.isArray(g.items)?g.items:[],x=T.filter(w=>w&&w.type==="subunit");if(x.length<=1)continue;const C=new Map;for(const w of x){const S=ue((w.name||"").replace(/\s+w\/.*/i,"").trim());C.has(S)||C.set(S,{name:w.name,qty:0,wargear:new Map});const E=C.get(S);E.qty+=d(w.quantity);const W=Array.isArray(w.items)?w.items:[];for(const A of W){const P=ue(A.name||""),O=E.wargear.get(P)||{name:A.name,qty:0,type:A.type||"wargear"};O.qty+=d(A.quantity),E.wargear.has(P),E.wargear.set(P,O)}}const D=T.filter(w=>!(w&&w.type==="subunit")),R=[];for(const[,w]of C){const S={quantity:`${w.qty}x`,name:w.name,items:[],type:"subunit"};for(const[,E]of w.wargear)S.items.push({quantity:`${E.qty}x`,name:E.name,items:[],type:E.type||"wargear",nameshort:""});R.push(S)}g.items=[...D,...R]}}const m=n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD?String(n.SUMMARY.FACTION_KEYWORD).trim():"";function f(u){if(!u||!m)return u;const y=new RegExp("^"+m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\s+","i");return String(u).replace(y,"").trim()}if(m)for(const u of["CHARACTER","OTHER DATASHEETS"]){const y=n[u]||[];for(const g of y){g.name=f(g.name);const T=(g.items||[]).filter(x=>x&&x.type==="subunit");for(const x of T)x.name=f(x.name)}}for(const u of["CHARACTER","OTHER DATASHEETS"]){const y=n[u]||[];for(const g of y){Array.isArray(g.items)&&g.items.length>0&&ra(g.items);const T=(g.items||[]).filter(x=>x&&x.type==="subunit");for(const x of T)Array.isArray(x.items)&&x.items.length>0&&ra(x.items)}}return ms(n),n}function Xm(t){try{const n=Um(t).format;return n==="NRNR"?"NRNR":n==="WTC-Compact"?"WTC_COMPACT":n==="WTC"?"WTC":n==="GWAPP"?"GW_APP":n==="NR-GW"?"NR_GW":n==="LF"?"LF":"UNKNOWN"}catch{const a=Array.isArray(t)?t.slice(0,25):[],r=a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i)||/^\s*\+\s*DETACHMENT:/i.test(i)),s=a.some(i=>/^(?:CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i.test((i||"").trim().toUpperCase()));return r&&s?"NR_GW":a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i))?"WTC_COMPACT":s?"GW_APP":"UNKNOWN"}}async function Vm(t){if(!t||typeof t!="string")throw new Error("Invalid army list text");const n=t.split(`
`),a=Xm(n);if(a==="UNKNOWN")throw new Error("Unable to detect army list format. Supported formats: GW App, WTC, WTC Compact, NR-GW, NR-NR, ListForge");let r;try{switch(a){case"GW_APP":r=Hm(n);break;case"WTC":r=Ym(n);break;case"WTC_COMPACT":r=Om(n);break;case"NR_GW":r=Fm(n);break;case"NRNR":r=Bm(n);break;case"LF":r=zm(n);break;default:throw new Error(`Unsupported format: ${a}`)}}catch(i){throw console.error("Parse error:",i),new Error(`Failed to parse ${a} format: ${i.message}`)}const s=jm(r);return{format:a,data:s}}function jm(t,n){const a=t.SUMMARY||{},r=[],s=["CHARACTER","CHARACTERS","BATTLELINE","OTHER DATASHEETS","ALLIED UNITS","DEDICATED TRANSPORTS"];for(const i of s)t[i]&&Array.isArray(t[i])&&r.push(...t[i].map(o=>({...o,section:i})));return{FACTION_KEYWORD:a.FACTION_KEYWORD||a.FACTION_KEY||"Unknown",DETACHMENT:a.DETACHMENT||"",TOTAL_ARMY_POINTS:a.TOTAL_ARMY_POINTS||"0pts",LIST_TITLE:a.LIST_TITLE||"",UNITS:r}}function Qm(t){if(!t)return 1;const n=String(t).match(/(\d+)/);return n?parseInt(n[1],10):1}const Jm={Asurmen:{baseType:"40mm"},Autarch:{baseType:"32mm"},"Autarch wayleaper":{baseType:"32mm"},"Avatar of Khaine":{baseType:"80mm"},Baharroth:{baseType:"40mm"},"Corsair Voidreavers":{baseType:"28.5mm"},"Corsair Voidscarred":{baseType:"28.5mm"},"Crimson Hunter":{baseType:"120x92mm"},"D-cannon Platform":{baseType:"40mm"},"Dark Reapers":{baseType:"28.5mm"},"Death Jester":{baseType:"25mm"},"Dire Avengers":{baseType:"28.5mm"},"Eldrad Ulthran":{baseType:"32mm"},Falcon:{baseType:"Large Flying Base"},Farseer:{baseType:"25mm"},"Farseer Skyrunner":{baseType:"Small Flying Base"},"Fire Dragons":{baseType:"28.5mm"},"Fire Prism":{baseType:"Large Flying Base"},Fuegan:{baseType:"40mm"},"Guardian Defenders":{baseType:"28.5mm"},"Guardian Defenders: Heavy Weapon Platform":{baseType:"40mm"},"Hemlock Wraithfighter":{baseType:"120x92mm"},"Howling Banshees":{baseType:"28.5mm"},"Jain Zar":{baseType:"40mm"},Lhykhis:{baseType:"40mm"},"Maugan Ra":{baseType:"40mm"},"Night Spinner":{baseType:"Large Flying Base"},Rangers:{baseType:"28.5mm"},"Shadow Weaver Platform":{baseType:"40mm"},Shadowseer:{baseType:"25mm"},"Shining Spears":{baseType:"Large Flying Base"},"Shroud Runners":{baseType:"Large Flying Base"},Skyweavers:{baseType:"Large Flying Base"},Solitaire:{baseType:"25mm"},Spiritseer:{baseType:"25mm"},Starweaver:{baseType:"Large Flying Base"},"Storm Guardians":{baseType:"28.5mm"},"Storm Guardians: Serpentâs Scale Platform":{baseType:"40mm"},"Striking Scorpions":{baseType:"28.5mm"},"Swooping Hawks":{baseType:"28.5mm"},"The Visarch":{baseType:"32mm"}},Zm={"Corvus Blackstar":{baseType:"120x92mm"},"Deathwatch Terminator Squad":{baseType:"40mm"},"Deathwatch Veterans":{baseType:"32mm"},"Fortis Kill Team":{baseType:"32mm"},"Indomitor Kill Team":{baseType:"40mm"},"Spectrus Kill Team":{baseType:"32mm"},"Spectrus Kill Team: Kill Team Infiltrators with bolt sniper rifles":{baseType:"40mm"},"Talonstrike Kill Team":{baseType:"32mm"},"Talonstrike Kill Team: Kill Team Heavy Intercessors with Jump Packs":{baseType:"40mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},ed={Archon:{baseType:"25mm"},Beastmaster:{baseType:"Small Flying Base"},"Beastmaster: Clawed Fiends, Khymerae, Razorwing Flocks":{baseType:"40mm"},"Court of the Archon: Sslyth":{baseType:"40mm"},"Court of the Archon: Ur-Ghul, Lhamaean, Medusae":{baseType:"25mm"},Cronos:{baseType:"Large Flying Base"},Drazhar:{baseType:"40mm"},Grotesques:{baseType:"40mm"},Haemonculus:{baseType:"25mm"},Hellions:{baseType:"Small Flying Base"},Incubi:{baseType:"28.5mm"},"Kabalite Warriors":{baseType:"25mm"},"Lelith Hesperax":{baseType:"32mm"},Mandrakes:{baseType:"28.5mm"},Raider:{baseType:"Large Flying Base"},Ravager:{baseType:"Large Flying Base"},"Razorwing Jetfighter":{baseType:"120x92mm"},Reavers:{baseType:"Small Flying Base"},Scourges:{baseType:"32mm"},Succubus:{baseType:"25mm"},Talos:{baseType:"Large Flying Base"},"Urien Rakarth":{baseType:"25mm"},Venom:{baseType:"Large Flying Base"},"Voidraven Bomber":{baseType:"120x92mm"},Wracks:{baseType:"25mm"},Wyches:{baseType:"25mm"}},td={"Annihilation Barge":{baseType:"Large Flying Base"},"Câtan Shard of the Deceiver":{baseType:"40mm"},"Câtan Shard of the Nightbringer":{baseType:"40mm"},"Câtan Shard of the Void Dragon":{baseType:"80mm"},"Canoptek Doomstalker":{baseType:"90mm"},"Canoptek Reanimator":{baseType:"60mm"},"Canoptek Scarab Swarms":{baseType:"40mm"},"Canoptek Spyders":{baseType:"60mm"},"Canoptek Wraiths":{baseType:"50mm"},"Catacomb Command Barge":{baseType:"Large Flying Base"},Chronomancer:{baseType:"40mm"},"Convergence of Dominion":{baseType:"hull",hullDimensions:{width:0,height:0}},Cryptothralls:{baseType:"32mm"},Deathmarks:{baseType:"32mm"},"Doom Scythe":{baseType:"120x92mm"},"Doomsday Ark":{baseType:"Large Flying Base"},"Flayed Ones":{baseType:"28.5mm"},"Ghost Ark":{baseType:"Large Flying Base"},"Hexmark Destroyer":{baseType:"50mm"},"Illuminor Szeras":{baseType:"80mm"},Immortals:{baseType:"32mm"},"Imotekh the Stormlord":{baseType:"40mm"},"Lokhust Destroyers":{baseType:"Large Flying Base"},"Lokhust Heavy Destroyers":{baseType:"60mm"},"Lokhust Lord":{baseType:"Large Flying Base"},Lychguard:{baseType:"32mm"},Monolith:{baseType:"160mm"},"Necron Warriors":{baseType:"32mm"},"Night Scythe":{baseType:"120x92mm"},Obelisk:{baseType:"120x92mm"},"Ophydian Destroyers":{baseType:"50mm"},"Orikan the Diviner":{baseType:"40mm"},Overlord:{baseType:"40mm"},"Overlord with Translocation Shroud":{baseType:"40mm"},Plasmancer:{baseType:"32mm"},Psychomancer:{baseType:"40mm"},"Royal Warden":{baseType:"32mm"},"Skorpekh Destroyers":{baseType:"50mm"},"Skorpekh Lord":{baseType:"60mm"},Technomancer:{baseType:"50mm"},"Tesseract Vault":{baseType:"120x92mm"},"The Silent King: Szarekh":{baseType:"100mm"},"The Silent King: Triarchal Menhir":{baseType:"50mm"},"Tomb Blades":{baseType:"Small Flying Base"},"Transcendent Câtan":{baseType:"60mm"},"Trazyn the Infinite":{baseType:"40mm"},"Triarch Praetorians":{baseType:"32mm"},"Triarch Stalker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Seraptek Heavy Construct":{baseType:"hull",hullDimensions:{width:0,height:0}}},nd={Battlewagon:{baseType:"hull",hullDimensions:{width:0,height:0}},"Beast Snagga Boyz":{baseType:"32mm"},Beastboss:{baseType:"50mm"},"Beastboss on Squigosaur":{baseType:"80mm"},"Big Mek":{baseType:"50mm"},"Big Mek in Mega Armour":{baseType:"40mm"},"Big Mek with Shokk Attack Gun":{baseType:"40mm"},"Bigâed Bossbunka":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blitza-bommer":{baseType:"120x92mm"},"Boomdakka Snazzwagon":{baseType:"150x95mm"},"Boss Snikrot":{baseType:"40mm"},Boyz:{baseType:"32mm"},"Breaka Boyz":{baseType:"32mm"},"Breaka Boyz: Boss Nob":{baseType:"40mm"},"Burna Boyz":{baseType:"32mm"},"Burna-bommer":{baseType:"120x92mm"},Dakkajet:{baseType:"120x92mm"},"Deff Dread":{baseType:"60mm"},"Deffkilla Wartrike":{baseType:"150x95mm"},Deffkoptas:{baseType:"75x42mm"},"Flash Gitz":{baseType:"40mm"},"Ghazghkull Thraka":{baseType:"80mm"},"Ghazghkull Thraka: Makari":{baseType:"25mm"},Gorkanaut:{baseType:"170x109mm"},Gretchin:{baseType:"25mm"},"Gretchin: Runtherd":{baseType:"32mm"},"Hunta Rig":{baseType:"170x109mm"},"Kill Rig":{baseType:"170x109mm"},"Killa Kans":{baseType:"60mm"},Kommandos:{baseType:"32mm"},"Kustom Boosta-blasta":{baseType:"150x95mm"},Lootas:{baseType:"32mm"},Meganobz:{baseType:"40mm"},"Megatrakk Scrapjet":{baseType:"150x95mm"},Mek:{baseType:"32mm"},"Mek Gunz":{baseType:"hull",hullDimensions:{width:0,height:0}},Morkanaut:{baseType:"170x109mm"},"Mozrog Skragbad":{baseType:"80mm"},Nobz:{baseType:"32mm"},Painboss:{baseType:"40mm"},Painboy:{baseType:"32mm"},"Rukkatrukk Squigbuggy":{baseType:"150x95mm"},"Shokkjump Dragsta":{baseType:"150x95mm"},"Squighog Boyz":{baseType:"75x42mm"},"Squighog Boyz: Nob on Smasha Squig":{baseType:"90x52.5mm"},Stompa:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormboyz:{baseType:"32mm"},Tankbustas:{baseType:"32mm"},"Tankbustas: Boss Nob":{baseType:"40mm"},Trukk:{baseType:"hull",hullDimensions:{width:0,height:0}},Warbikers:{baseType:"75x42mm"},Warboss:{baseType:"40mm"},"Warboss in Mega Armour":{baseType:"50mm"},"Wazbom Blastajet":{baseType:"150x95mm"},Weirdboy:{baseType:"40mm"},Wurrboy:{baseType:"32mm"},"Zodgrod Wortsnagga":{baseType:"50mm"},"Gargantuan Squiggoth":{baseType:"hull",hullDimensions:{width:0,height:0}}},ad={Barbgaunts:{baseType:"40mm"},Biovores:{baseType:"80mm"},Broodlord:{baseType:"75x42mm"},Carnifexes:{baseType:"105x70mm"},Deathleaper:{baseType:"60mm"},Exocrine:{baseType:"120x92mm"},Gargoyles:{baseType:"Small Flying Base"},Genestealers:{baseType:"32mm"},Harpy:{baseType:"120x92mm"},Haruspex:{baseType:"120x92mm"},"Hive Crone":{baseType:"120x92mm"},"Hive Guard":{baseType:"50mm"},"Hive Tyrant":{baseType:"50mm"},Hormagaunts:{baseType:"28.5mm"},Lictor:{baseType:"50mm"},Maleceptor:{baseType:"120x92mm"},Mawloc:{baseType:"120x92mm"},"Mucolid Spores":{baseType:"40mm"},Neurogaunts:{baseType:"25mm"},"Neurogaunts: Nodebeasts":{baseType:"28.5mm"},Neurolictor:{baseType:"50mm"},Neurotyrant:{baseType:"50mm"},"Norn Assimilator":{baseType:"100mm"},"Norn Emissary":{baseType:"100mm"},"Old One Eye":{baseType:"105x70mm"},"Parasite of Mortrex":{baseType:"40mm"},Psychophage:{baseType:"120x92mm"},Pyrovores:{baseType:"80mm"},Raveners:{baseType:"40mm"},"Ripper Swarms":{baseType:"40mm"},"Screamer-killer":{baseType:"90mm"},"Spore MInes":{baseType:"25mm"},Sporocyst:{baseType:"hull",hullDimensions:{width:0,height:0}},Termagants:{baseType:"28.5mm"},Tervigon:{baseType:"120x92mm"},"The Swarmlord":{baseType:"60mm"},Toxicrene:{baseType:"120x92mm"},Trygon:{baseType:"120x92mm"},"Tyranid Warriors with Melee Bio-weapons":{baseType:"50mm"},"Tyranid Warriors with Ranged Bio-weapons":{baseType:"50mm"},Tyrannocyte:{baseType:"100mm"},Tyrannofex:{baseType:"120x92mm"},"Tyrant Guard":{baseType:"50mm"},Venomthropes:{baseType:"40mm"},"Von Ryanâs Leapers":{baseType:"40mm"},"Winged Hive Tyrant":{baseType:"60mm"},"Winged Tyranid Prime":{baseType:"50mm"},Zoanthropes:{baseType:"40mm"},Harridan:{baseType:"hull",hullDimensions:{width:4,height:6}},Hierophant:{baseType:"hull",hullDimensions:{width:0,height:0}}},as={"ADEPTA SORORITAS":{"Aestred Thurga and Agathae Dolan: Aestred Thurga":{baseType:"32mm"},"Aestred Thurga and Agathae Dolan: Agathae Dolan":{baseType:"25mm"},"Arco-flagellants":{baseType:"25mm"},"Battle Sisters Squad":{baseType:"32mm"},Canoness:{baseType:"32mm"},"Canoness with Jump Pack":{baseType:"32mm"},Castigator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Celestian Sacresants":{baseType:"32mm"},Daemonifuge:{baseType:"32mm"},Dialogus:{baseType:"40mm"},Dogmata:{baseType:"32mm"},"Dominion Squad":{baseType:"32mm"},Exorcist:{baseType:"hull",hullDimensions:{width:0,height:0}},Hospitaller:{baseType:"50mm"},Imagifier:{baseType:"32mm"},Immolator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Junith Eruita":{baseType:"50mm"},"Ministorum Priest":{baseType:"32mm"},Mortifiers:{baseType:"50mm"},"Morvenn Vahl":{baseType:"60mm"},Palatine:{baseType:"32mm"},"Paragon Warsuits":{baseType:"50mm"},"Penitent Engines":{baseType:"50mm"},"Repentia Squad: Repentia Superior":{baseType:"32mm"},"Repentia Squad: Sister Repentia":{baseType:"28.5mm"},"Retributor Squad":{baseType:"32mm"},"Saint Celestine":{baseType:"40mm"},"Saint Celestine: Geminae Superia":{baseType:"32mm"},Sanctifiers:{baseType:"25mm"},"Seraphim Squad":{baseType:"32mm"},"Sisters Novitiate Squad: Novitiate Superior":{baseType:"32mm"},"Sisters Novitiate Squad: Sister Novitiate":{baseType:"28.5mm"},"Sororitas Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Triumph of Saint Katherine":{baseType:"120x92mm"},"Zephyrim Squad":{baseType:"32mm"}},"ADEPTUS CUSTODES":{Aleya:{baseType:"32mm"},"Allarus Custodians":{baseType:"40mm"},"Anathema Psykana Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blade Champion":{baseType:"40mm"},"Custodian Guard":{baseType:"40mm"},"Custodian Wardens":{baseType:"40mm"},"Knight-Centura":{baseType:"32mm"},Prosecutors:{baseType:"32mm"},"Shield-Captain":{baseType:"40mm"},"Shield-Captain in Allarus Terminator Armour":{baseType:"40mm"},"Shield-Captain on Dawneagle Jetbike":{baseType:"75x42mm"},"Trajann Valoris":{baseType:"40mm"},Valerian:{baseType:"40mm"},"Venerable Contemptor Dreadnought":{baseType:"60mm"},"Venerable Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vertus Praetors":{baseType:"75x42mm"},Vigilators:{baseType:"32mm"},Witchseekers:{baseType:"32mm"},"Agamatus Custodians":{baseType:"75x42mm"},"Aquilon Custodians":{baseType:"50mm"},"Ares Gunship":{baseType:"160mm"},"Caladius Grav-tank":{baseType:"170x109mm"},"Contemptor-Achillus Dreadnought":{baseType:"60mm"},"Contemptor-Galatus Dreadnought":{baseType:"60mm"},"Coronus Grav-carrier":{baseType:"170x109mm"},"Custodian Guard with Adrasite and Pyrithite Spears":{baseType:"40mm"},"Orion Assault Dropship":{baseType:"160mm"},"Pallas Grav-attack":{baseType:"105x70mm"},"Sagittarum Custodians":{baseType:"40mm"},"Telemon Heavy Dreadnought":{baseType:"100mm"},"Venatari Custodians":{baseType:"40mm"}},"ADEPTUS MECHANICUS":{"Archaeopter Fusilave":{baseType:"170x109mm"},"Archaeopter Stratoraptor":{baseType:"170x109mm"},"Archaeopter Transvector":{baseType:"170x109mm"},"Belisarius Cawl":{baseType:"105x70mm"},"Corpuscarii Electro-Priests":{baseType:"32mm"},"Cybernetica Datasmith":{baseType:"32mm"},"Fulgurite Electro-Priests":{baseType:"32mm"},"Ironstrider Ballistarii":{baseType:"105x70mm"},"Kastelan Robots":{baseType:"60mm"},"Kataphron Breachers":{baseType:"60mm"},"Kataphron Destroyers":{baseType:"60mm"},"Onager Dunecrawler":{baseType:"130mm"},"Pteraxii Skystalkers":{baseType:"40mm"},"Pteraxii Sterylizors":{baseType:"40mm"},"Serberys Raiders":{baseType:"60x35.5mm"},"Serberys Sulphurhounds":{baseType:"60x35.5mm"},"Sicarian Infiltrators":{baseType:"40mm"},"Sicarian Ruststalkers":{baseType:"40mm"},"Skitarii Marshal":{baseType:"32mm"},"Skitarii Rangers":{baseType:"25mm"},"Skitarii Rangers/Skitarii Vanguard: Transuranic Arquebus":{baseType:"60x35.5mm"},"Skitarii Vanguard":{baseType:"25mm"},"Skorpius Disintegrator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skorpius Dunerider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sydonian Dragoons with Radium Jezzails":{baseType:"105x70mm"},"Sydonian Dragoons with Taser Lances":{baseType:"105x70mm"},"Sydonian Skatros":{baseType:"40mm"},"Tech-Priest Dominus":{baseType:"50mm"},"Tech-Priest Enginseer":{baseType:"32mm"},"Tech-Priest Manipulus":{baseType:"50mm"},Technoarcheologist:{baseType:"32mm"}},"ADEPTUS TITANICUS":{"Reaver Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warbringer Nemesis Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warhound Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warlord Titan":{baseType:"hull",hullDimensions:{width:0,height:0}}},AELDARI:Jm,"ASTRA MILITARUM":{"Aegis Defence Line":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armoured Sentinels":{baseType:"80mm"},"Artillery Team":{baseType:"130mm"},"Attilan Rough Riders":{baseType:"60x35.5mm"},Baneblade:{baseType:"hull",hullDimensions:{width:0,height:0}},Banehammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Banesword:{baseType:"hull",hullDimensions:{width:0,height:0}},Basilisk:{baseType:"hull",hullDimensions:{width:0,height:0}},"Bullgryn squad":{baseType:"40mm"},"Cadian Castellan":{baseType:"28.5mm"},"Cadian Command Squad":{baseType:"28.5mm"},"Cadian Heavy Weapons Squad":{baseType:"50mm"},"Cadian Shock Troops":{baseType:"25mm"},"Catachan Command Squad":{baseType:"25mm"},"Catachan Heavy Weapons Squad":{baseType:"60mm"},"Catachan Jungle Fighters":{baseType:"25mm"},Chimera:{baseType:"hull",hullDimensions:{width:0,height:0}},Commissar:{baseType:"28.5mm"},"Death Korps of Krieg":{baseType:"25mm"},"Death Riders":{baseType:"60x35.5mm"},Deathstrike:{baseType:"hull",hullDimensions:{width:0,height:0}},Doomhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},"Field Ordnance Battery":{baseType:"100mm"},"Gauntâs Ghosts":{baseType:"28.5mm"},Hellhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Hellhound:{baseType:"hull",hullDimensions:{width:0,height:0}},Hydra:{baseType:"hull",hullDimensions:{width:0,height:0}},Kasrkin:{baseType:"28.5mm"},"Krieg Combat Engineers":{baseType:"25mm"},"Krieg Command Squad":{baseType:"25mm"},"Krieg Command Squad: Lord Commissar":{baseType:"32mm"},"Krieg Heavy Weapons Squad":{baseType:"50mm"},"Krieg Heavy Weapons Squad: Fire Coordinator":{baseType:"25mm"},"Leman Russ Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Demolisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Eradicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Executioner":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Exterminator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Punisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Vanquisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Marshal Dreir":{baseType:"75x42mm"},"Lord Solar Leontus":{baseType:"80mm"},Manticore:{baseType:"hull",hullDimensions:{width:0,height:0}},"Militarum Tempestus Command Squad":{baseType:"25mm"},"Ministorum Priest":{baseType:"32mm"},"Nork Deddog":{baseType:"40mm"},"Ogryn Bodyguard":{baseType:"40mm"},"Ogryn squad":{baseType:"40mm"},"Primaris Psyker":{baseType:"32mm"},Ratlings:{baseType:"25mm"},"Rogal Dorn Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Rogal Dorn Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Scout Sentinels":{baseType:"80mm"},Shadowsword:{baseType:"hull",hullDimensions:{width:0,height:0}},"Sly Marbo":{baseType:"32mm"},Stormlord:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormsword:{baseType:"hull",hullDimensions:{width:0,height:0}},Taurox:{baseType:"hull",hullDimensions:{width:0,height:0}},"Taurox Prime":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tech-Priest Enginseer":{baseType:"32mm"},"Tempestus Aquilons":{baseType:"28.5mm"},"Tempestus Scions":{baseType:"25mm"},"Ursula Creed":{baseType:"32mm"},Valkyrie:{baseType:"120x92mm"},Wyvern:{baseType:"hull",hullDimensions:{width:0,height:0}},"Avenger Strike Fighter":{baseType:"120x92mm"},"Cyclops Demolition Vehicle":{baseType:"hull",hullDimensions:{width:0,height:0}}},"BLACK TEMPLARS":{"Black Templars Gladiator Lancer":{baseType:"100mm"},"Black Templars Gladiator Reaper":{baseType:"100mm"},"Black Templars Gladiator Valiant":{baseType:"100mm"},"Black Templars Impulsor":{baseType:"100mm"},"Black Templars Repulsor":{baseType:"100mm"},"Black Templars Repulsor Executioner":{baseType:"100mm"},Castellan:{baseType:"40mm"},"Chaplain Grimaldus":{baseType:"40mm"},"Chaplain Grimaldus: Cenobyte Servitors":{baseType:"28.5mm"},"Crusader Squad: Neophytes":{baseType:"28.5mm"},"Crusader Squad: Sword Brother/Initiates":{baseType:"32mm"},"High Marshal Helbrecht":{baseType:"60mm"},Marshal:{baseType:"40mm"},"Primaris Crusader Squad: Initiates":{baseType:"32mm"},"Primaris Crusader Squad: Neophytes":{baseType:"28.5mm"},"Primaris Crusader Squad: Sword Brother":{baseType:"40mm"},"Primaris Sword Brethren":{baseType:"40mm"},"The Emperorâs Champion":{baseType:"40mm"}},"BLOOD ANGELS":{Astorath:{baseType:"40mm"},"Baal Predator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blood Angels Captain":{baseType:"40mm"},"Chief Librarian Mephiston":{baseType:"40mm"},"Commander Dante":{baseType:"50mm"},"Death Company Captain":{baseType:"40mm"},"Death Company Captain with Jump Pack":{baseType:"40mm"},"Death Company Dreadnought":{baseType:"90mm"},"Death Company Marines":{baseType:"32mm"},"Death Company Marines with Bolt Rifles":{baseType:"32mm"},"Death Company Marines with Jump Packs":{baseType:"32mm"},Lemartes:{baseType:"40mm"},"Sanguinary Guard":{baseType:"40mm"},"Sanguinary Priest":{baseType:"40mm"},"The Sanguinor":{baseType:"40mm"}},"CHAOS DAEMONS":{"Beâlakor":{baseType:"100mm"},"Beasts of Nurgle":{baseType:"60mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodmaster:{baseType:"40mm"},Bloodthirster:{baseType:"120x92mm"},"Blue Horrors":{baseType:"25mm"},"Burning Chariot":{baseType:"120x92mm"},Changecaster:{baseType:"32mm"},"Contorted Epitome":{baseType:"75x42mm"},"Daemon Prince of Chaos":{baseType:"60mm"},"Daemon Prince of Chaos with Wings":{baseType:"60mm"},Daemonettes:{baseType:"25mm"},Epidemius:{baseType:"60mm"},"Exalted Flamer":{baseType:"75x42mm"},Fateskimmer:{baseType:"120x92mm"},"Feculent Gnarlmaw":{baseType:"hull",hullDimensions:{width:0,height:0}},Fiends:{baseType:"75x42mm"},Flamers:{baseType:"32mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Fluxmaster:{baseType:"Large Flying Base"},"Great Unclean One":{baseType:"130mm"},Hellflayers:{baseType:"120x92mm"},"Horticulous Slimux":{baseType:"105x70mm"},"Infernal Enrapturess":{baseType:"60x35.5mm"},"Kairos Fateweaver":{baseType:"100mm"},Karanak:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},Nurglings:{baseType:"40mm"},"Pink Horrors":{baseType:"32mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Poxbringer:{baseType:"32mm"},"Rendmaster on Blood Throne":{baseType:"120x92mm"},Rotigus:{baseType:"130mm"},Screamers:{baseType:"Small Flying Base"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"},Skarbrand:{baseType:"100mm"},"Skull Altar":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skull Cannon":{baseType:"120x92mm"},Skullmaster:{baseType:"90x52.5mm"},Skulltaker:{baseType:"40mm"},"Sloppity Bilepiper":{baseType:"32mm"},"Soul Grinder":{baseType:"160mm"},"Spoilpox Scrivener":{baseType:"40mm"},"Syllâesske":{baseType:"50mm"},"The Blue Scribes":{baseType:"Large Flying Base"},"The Changeling":{baseType:"40mm"},"The Masque of Slaanesh":{baseType:"32mm"},Tormentbringer:{baseType:"120x92mm"},Tranceweaver:{baseType:"32mm"}},"CHAOS KNIGHTS":{"Knight Abominant":{baseType:"170x109mm"},"Knight Desecrator":{baseType:"170x109mm"},"Knight Despoiler":{baseType:"170x109mm"},"Knight Rampager":{baseType:"170x109mm"},"Knight Tyrant":{baseType:"170x109mm"},"War Dog Brigand":{baseType:"100mm"},"War Dog Executioner":{baseType:"100mm"},"War Dog Huntsman":{baseType:"100mm"},"War Dog Karnivore":{baseType:"100mm"},"War Dog Stalker":{baseType:"100mm"},"Chaos Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Cerastus Knight Acheron":{baseType:"170x109mm"},"Chaos Cerastus Knight Atrapos":{baseType:"170x109mm"},"Chaos Cerastus Knight Castigator":{baseType:"170x109mm"},"Chaos Cerastus Knight Lancer":{baseType:"170x109mm"},"Chaos Questoris Knight Magaera":{baseType:"170x109mm"},"Chaos Questoris Knight Styrix":{baseType:"170x109mm"},"War Dog Moirax":{baseType:"100mm"}},"CHAOS SPACE MARINES":{"Abaddon the Despoiler":{baseType:"60mm"},"Accursed Cultists: Mutant":{baseType:"25mm"},"Accursed Cultists: Torment":{baseType:"40mm"},"Chaos Bikers":{baseType:"75x42mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Lord":{baseType:"40mm"},"Chaos Lord in Terminator Armour":{baseType:"40mm"},"Chaos Lord with Jump Pack":{baseType:"40mm"},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminator Squad":{baseType:"40mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},Chosen:{baseType:"32mm"},"Cultist Firebrand":{baseType:"32mm"},"Cultist Mob":{baseType:"25mm"},Cypher:{baseType:"32mm"},"Dark Apostle":{baseType:"40mm"},"Dark Apostle: Dark Disciple":{baseType:"25mm"},"Dark Commune: Blessed Blade":{baseType:"28.5mm"},"Dark Commune: Cult Demagogue, Mindwitch, Iconarch":{baseType:"32mm"},Defiler:{baseType:"160mm"},"Fabius Bile":{baseType:"40mm"},"Fabius Bile: Surgeon Acolyte":{baseType:"32mm"},"Fellgor beastmen":{baseType:"32mm"},Forgefiend:{baseType:"120x92mm"},"Haarken Worldclaimer":{baseType:"40mm"},Havocs:{baseType:"40mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Heretic Astartes Daemon Prince":{baseType:"60mm"},"Heretic Astartes Daemon Prince with Wings":{baseType:"60mm"},"Huron Blackheart":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},Legionaries:{baseType:"32mm"},"Lord Discordant on Helstalker":{baseType:"120x92mm"},"Master of Executions":{baseType:"40mm"},"Master of Possession":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},"Nemesis Claw":{baseType:"32mm"},"Noctilith Crown":{baseType:"hull",hullDimensions:{width:0,height:0}},Obliterators:{baseType:"50mm"},Possessed:{baseType:"40mm"},Raptors:{baseType:"32mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Traitor Enforcer":{baseType:"32mm"},"Traitor Enforcer: Traitor Ogryn":{baseType:"40mm"},"Traitor Guardsmen Squad":{baseType:"25mm"},"Vashtorr the Arkifane":{baseType:"80mm"},Venomcrawler:{baseType:"100mm"},"Warp Talons":{baseType:"32mm"},Warpsmith:{baseType:"60x35.5mm"}},"DARK ANGELS":{Asmodai:{baseType:"50mm"},Azrael:{baseType:"50mm"},Belial:{baseType:"50mm"},"Deathwing Knights":{baseType:"40mm"},"Deathwing Terminator Squad":{baseType:"40mm"},Ezekiel:{baseType:"25mm"},"Inner Circle Companions":{baseType:"40mm"},"Land Speeder Vengeance":{baseType:"Large Flying Base"},Lazarus:{baseType:"40mm"},"Lion ElâJonson":{baseType:"60mm"},"Nephilim Jetfighter":{baseType:"120x92mm"},"Ravenwing Black Knights":{baseType:"75x42mm"},"Ravenwing Command Squad":{baseType:"75x42mm"},"Ravenwing Dark Talon":{baseType:"120x92mm"},"Ravenwing Darkshroud":{baseType:"Large Flying Base"},Sammael:{baseType:"Large Flying Base"}},"DEATH GUARD":{"Biologus Putrifier":{baseType:"40mm"},"Blightlord Terminators":{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Nurgle":{baseType:"60mm"},"Daemon Prince of Nurgle with Wings":{baseType:"60mm"},"Deathshroud Terminators":{baseType:"40mm"},Defiler:{baseType:"160mm"},"Foetid Bloat-Drone":{baseType:"60mm"},"Foetid Bloat-drone with Heavy Blight Launcher":{baseType:"60mm"},"Foul Blightspawn":{baseType:"40mm"},Helbrute:{baseType:"60mm"},"Icon Bearer":{baseType:"32mm"},"Lord of Contagion":{baseType:"50mm"},"Lord of Poxes":{baseType:"40mm"},"Lord of Virulence":{baseType:"50mm"},"Malignant Plaguecaster":{baseType:"32mm"},"Miasmic Malignifier":{baseType:"hull",hullDimensions:{width:0,height:0}},Mortarion:{baseType:"100mm"},"Myphitic Blight-Haulers":{baseType:"80mm"},"Noxious Blightbringer":{baseType:"40mm"},"Plague Marines":{baseType:"32mm"},"Plague Surgeon":{baseType:"40mm"},"Plagueburst Crawler":{baseType:"hull",hullDimensions:{width:0,height:0}},Poxwalkers:{baseType:"25mm"},Tallyman:{baseType:"40mm"},Typhus:{baseType:"50mm"},"Beasts of Nurgle":{baseType:"60mm"},"Great Unclean One":{baseType:"130mm"},Nurglings:{baseType:"40mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Rotigus:{baseType:"130mm"}},DEATHWATCH:Zm,DRUKHARI:ed,"EMPERORâS CHILDREN":{"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminators":{baseType:"40mm"},"Daemon Prince of Slaanesh":{baseType:"60mm"},"Daemon Prince of Slaanesh with Wings":{baseType:"60mm"},"Flawless Blades":{baseType:"40mm"},Fulgrim:{baseType:"130mm"},Heldrake:{baseType:"120x92mm"},Infractors:{baseType:"32mm"},"Lord Exultant":{baseType:"40mm"},"Lord Kakophonist":{baseType:"40mm"},"Lucius the Eternal":{baseType:"50mm"},Maulerfiend:{baseType:"120x92mm"},"Noise Marines":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},Tormentors:{baseType:"32mm"},Daemonettes:{baseType:"25mm"},Fiends:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"}},"GENESTEALER CULTS":{Aberrants:{baseType:"32mm"},Abominant:{baseType:"40mm"},"Achilles Ridgerunners":{baseType:"120x92mm"},"Acolyte Hybrids with Autopistols":{baseType:"32mm"},"Acolyte Hybrids with Hand Flamers":{baseType:"32mm"},"Acolyte Iconward":{baseType:"32mm"},"Atalan Jackals":{baseType:"60x35.5mm"},"Atalan Jackals: Wolfquad":{baseType:"60mm"},Benefictus:{baseType:"32mm"},Biophagus:{baseType:"25mm"},Clamavus:{baseType:"32mm"},"Goliath Rockgrinder":{baseType:"hull",hullDimensions:{width:0,height:0}},"Goliath Truck":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hybrid Metamorphs":{baseType:"32mm"},"Jackal Alphus":{baseType:"60x35.5mm"},Kelermorph:{baseType:"32mm"},Locus:{baseType:"32mm"},Magus:{baseType:"32mm"},"Neophyte Hybrids":{baseType:"25mm"},"Neophyte Hybrids: Heavy stubber, Mining laser, Seismic cannon":{baseType:"32mm"},Nexos:{baseType:"40mm"},Patriarch:{baseType:"50mm"},Primus:{baseType:"32mm"},"Purestrain Genestealers":{baseType:"32mm"},"Reductus Saboteur":{baseType:"32mm"},Sanctus:{baseType:"32mm"}},"GREY KNIGHTS":{"Brother-Captain":{baseType:"40mm"},"Brother-Captain Stern":{baseType:"40mm"},"Brotherhood Champion":{baseType:"32mm"},"Brotherhood Chaplain":{baseType:"40mm"},"Brotherhood Librarian":{baseType:"40mm"},"Brotherhood Techmarine":{baseType:"32mm"},"Brotherhood Terminator Squad":{baseType:"40mm"},"Castellan Crowe":{baseType:"40mm"},"Grand Master":{baseType:"40mm"},"Grand Master in Nemesis Dreadknight":{baseType:"120x92mm"},"Grand Master Voldus":{baseType:"40mm"},"Grey Knights Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Razorback":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Stormhawk Interceptor":{baseType:"120x92mm"},"Grey knights Stormraven Gunship":{baseType:"120x92mm"},"Grey knights Stormtalon Gunship":{baseType:"120x92mm"},"Grey Knights Venerable Dreadnought":{baseType:"60mm"},"Interceptor Squad":{baseType:"32mm"},"Kaldor Draigo":{baseType:"40mm"},"Nemesis Dreadknight":{baseType:"120x92mm"},"Paladin Squad":{baseType:"40mm"},"Purgation Squad":{baseType:"32mm"},"Purifier Squad":{baseType:"32mm"},Servitors:{baseType:"25mm"},"Strike Squad":{baseType:"32mm"},"Grey Knights Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}},"Land Raider Banisher":{baseType:"hull",hullDimensions:{width:0,height:0}}},"IMPERIAL AGENTS":{"Callidus Assassin":{baseType:"32mm"},"Corvus Blackstar":{baseType:"120x92mm"},"Culexus Assassin":{baseType:"32mm"},"Deathwatch Kill Team":{baseType:"32mm"},"Eversor Assassin":{baseType:"32mm"},"Exaction Squad":{baseType:"28.5mm"},"Exaction Squad: Cyber-mastiff":{baseType:"25mm"},"Grey Knights Terminator Squad":{baseType:"40mm"},"Imperial Navy Breachers":{baseType:"25mm"},"Imperial Navy Breachers: Navis las-volley, endurant shield":{baseType:"28.5mm"},"Imperial Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},Inquisitor:{baseType:"32mm"},"Inquisitor Coteaz":{baseType:"40mm"},"Inquisitor Draxus":{baseType:"32mm"},"Inquisitor Greyfax":{baseType:"32mm"},"Inquisitorial Agents":{baseType:"25mm"},"Inquisitorial Agents: Gun Servitors":{baseType:"32mm"},"Inquisitorial Chimera":{baseType:"hull",hullDimensions:{width:0,height:0}},"Ministorum Priest":{baseType:"32mm"},Navigator:{baseType:"32mm"},"Rogue Trader entourage":{baseType:"25mm"},Sanctifiers:{baseType:"25mm"},"Sisters of Battle Immolator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sisters of Battle Squad":{baseType:"32mm"},"Subductor Squad":{baseType:"28.5mm"},"Subductor Squad: Cyber-mastiff":{baseType:"25mm"},"Vigilant Squad":{baseType:"28.5mm"},"Vigilant Squad: Cyber-mastiff":{baseType:"25mm"},"Vindicare Assassin":{baseType:"32mm"},"Voidsmen-at-Arms":{baseType:"32mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},"IMPERIAL KNIGHTS":{"Armiger Helverin":{baseType:"100mm"},"Armiger Warglaive":{baseType:"100mm"},"Canis Rex":{baseType:"170x109mm"},"Knight Castellan":{baseType:"170x109mm"},"Knight Crusader":{baseType:"170x109mm"},"Knight Errant":{baseType:"170x109mm"},"Knight Gallant":{baseType:"170x109mm"},"Knight Paladin":{baseType:"170x109mm"},"Knight Preceptor":{baseType:"170x109mm"},"Knight Valiant":{baseType:"170x109mm"},"Knight Warden":{baseType:"170x109mm"},"Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armiger Moirax":{baseType:"100mm"},"Cerastus Knight Acheron":{baseType:"170x109mm"},"Cerastus Knight Atrapos":{baseType:"170x109mm"},"Cerastus Knight Castigator":{baseType:"170x109mm"},"Cerastus Knight Lancer":{baseType:"170x109mm"},"Questoris Knight Magaera":{baseType:"170x109mm"},"Questoris Knight Styrix":{baseType:"170x109mm"}},"LEAGUES OF VOTANN":{"BrÃ´khyr Iron-master":{baseType:"32mm"},"BrÃ´khyr Iron-master: E-COG":{baseType:"25mm"},"BrÃ´khyr Iron-master: Ironkin Assistant":{baseType:"28.5mm"},"BrÃ´khyr Thunderkyn":{baseType:"40mm"},"Cthonian Beserks":{baseType:"28.5mm"},"Cthonian Beserks: Mole grenade launcher":{baseType:"50mm"},"Einhyr Champion":{baseType:"40mm"},"Einhyr Hearthguard":{baseType:"32mm"},Grimnyr:{baseType:"40mm"},"Grimnyr: CORV":{baseType:"25mm"},"Hearthkyn Warriors":{baseType:"28.5mm"},"Hekaton Land Fortress":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hernkyn Pioneers":{baseType:"90x52.5mm"},"Hernkyn Yaegirs":{baseType:"28.5mm"},KÃ¢hl:{baseType:"40mm"},Sagitaur:{baseType:"hull",hullDimensions:{width:0,height:0}},"Ãthar the Destined":{baseType:"40mm"}},NECRONS:td,ORKS:nd,"SPACE MARINES":{"Adrax Agatone":{baseType:"40mm"},"Aggressor Squad":{baseType:"40mm"},Ancient:{baseType:"40mm"},"Ancient in Terminator Armour":{baseType:"40mm"},Apothecary:{baseType:"40mm"},"Apothecary Biologis":{baseType:"40mm"},"Assault Intercessor Squad":{baseType:"32mm"},"Assault Intercessors with Jump Packs":{baseType:"32mm"},"Ballistus Dreadnought":{baseType:"90mm"},"Bladeguard Ancient":{baseType:"40mm"},"Bladeguard Veteran Squad":{baseType:"40mm"},"Brutalis Dreadnought":{baseType:"90mm"},Captain:{baseType:"40mm"},"Captain in Gravis Armour":{baseType:"40mm"},"Captain in Phobos Armour":{baseType:"40mm"},"Captain in Terminator Armour":{baseType:"50mm"},"Captain Sicarius":{baseType:"32mm"},"Captain with Jump Pack":{baseType:"40mm"},"Centurion Assault Squad":{baseType:"50mm"},"Centurion Devastator Squad":{baseType:"50mm"},Chaplain:{baseType:"40mm"},"Chaplain in Terminator Armour":{baseType:"40mm"},"Chaplain on Bike":{baseType:"90x52.5mm"},"Chaplain with Jump Pack":{baseType:"32mm"},"Chief Librarian Tigurius":{baseType:"40mm"},"Company Heroes":{baseType:"40mm"},"Darnath Lysander":{baseType:"50mm"},"Desolation Squad":{baseType:"32mm"},"Devastator Squad":{baseType:"32mm"},Dreadnought:{baseType:"60mm"},"Drop Pod":{baseType:"hull",hullDimensions:{width:0,height:0}},"Eliminator Squad":{baseType:"40mm"},"Eradicator Squad":{baseType:"40mm"},"Firestrike Servo-turrets":{baseType:"80mm"},"Gladiator Lancer":{baseType:"100mm"},"Gladiator Reaper":{baseType:"100mm"},"Gladiator Valiant":{baseType:"100mm"},"Hammerfall Bunker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Heavy Intercessor Squad":{baseType:"40mm"},"Hellblaster Squad":{baseType:"32mm"},Impulsor:{baseType:"100mm"},"Inceptor Squad":{baseType:"40mm"},"Incursor Squad":{baseType:"32mm"},"Infernus Squad":{baseType:"32mm"},"Infiltrator Squad":{baseType:"32mm"},"Intercessor Squad":{baseType:"32mm"},"Invader ATV":{baseType:"hull",hullDimensions:{width:0,height:0}},"Invictor Tactical Warsuit":{baseType:"90mm"},"Iron Father Feirros":{baseType:"40mm"},Judiciar:{baseType:"40mm"},"Kayvaan Shrike":{baseType:"40mm"},"Korâsarro Khan":{baseType:"40mm"},"Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},Librarian:{baseType:"40mm"},"Librarian in Phobos Armour":{baseType:"40mm"},"Librarian in Terminator Armour":{baseType:"40mm"},Lieutenant:{baseType:"40mm"},"Lieutenant in Phobos Armour":{baseType:"40mm"},"Lieutenant in Reiver Armour":{baseType:"40mm"},"Lieutenant Titus":{baseType:"40mm"},"Lieutenant with Combi-weapon":{baseType:"40mm"},"Marneus Calgar":{baseType:"50mm"},"Marneus Calgar: Victrix Honour Guard":{baseType:"40mm"},"Outrider Squad":{baseType:"90x52.5mm"},"Pedro Kantor":{baseType:"32mm"},"Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},Razorback:{baseType:"hull",hullDimensions:{width:0,height:0}},"Redemptor Dreadnought":{baseType:"90mm"},"Reiver Squad":{baseType:"32mm"},Repulsor:{baseType:"100mm"},"Repulsor Executioner":{baseType:"100mm"},Rhino:{baseType:"hull",hullDimensions:{width:0,height:0}},"Roboute Guilliman":{baseType:"60mm"},"Scout Squad":{baseType:"28.5mm"},"Sternguard Veteran Squad":{baseType:"32mm"},"Storm Speeder Hailstrike":{baseType:"90mm"},"Storm Speeder Hammerstrike":{baseType:"90mm"},"Storm Speeder Thunderstrike":{baseType:"90mm"},"Stormhawk Interceptor":{baseType:"120x92mm"},"Stormraven Gunship":{baseType:"120x92mm"},"Stormtalon Gunship":{baseType:"120x92mm"},"Suppressor Squad":{baseType:"40mm"},"Tactical Squad":{baseType:"32mm"},Techmarine:{baseType:"40mm"},"Terminator Assault Squad":{baseType:"40mm"},"Terminator Squad":{baseType:"40mm"},"Tor Garadon":{baseType:"40mm"},"Uriel Ventris":{baseType:"40mm"},"Vanguard Veteran Squad with Jump Packs":{baseType:"32mm"},Vindicator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Vulkan Heâstan":{baseType:"32mm"},Whirlwind:{baseType:"hull",hullDimensions:{width:0,height:0}},Astraeus:{baseType:"hull",hullDimensions:{width:0,height:0}},"Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}}},"SPACE WOLVES":{"Arjac Rockfist":{baseType:"50mm"},"Bjorn the Fell-handed":{baseType:"60mm"},"Blood Claws":{baseType:"32mm"},"Fenrisian Wolves":{baseType:"40mm"},"Grey Hunters":{baseType:"32mm"},"Iron Priest":{baseType:"32mm"},"Logan Grimnar":{baseType:"80mm"},Murderfang:{baseType:"60mm"},"Njal Stormcaller":{baseType:"40mm"},"Ragnar Blackmane":{baseType:"40mm"},"Thunderwolf Cavalry":{baseType:"60mm"},"Ulrik the Slayer":{baseType:"32mm"},"Venerable Dreadnought":{baseType:"60mm"},"Wolf Guard Battle Leader":{baseType:"40mm"},"Wolf Guard Headtakers":{baseType:"40mm"},"Wolf Guard Headtakers: Hunting Wolves":{baseType:"60x35.5mm"},"Wolf Guard Terminators":{baseType:"40mm"},"Wolf Priest":{baseType:"40mm"},Wulfen:{baseType:"40mm"},"Wulfen Dreadnought":{baseType:"60mm"},"Wulfen with Storm Shields":{baseType:"40mm"}},"TâAU EMPIRE":{"Breacher Team":{baseType:"25mm"},"Broadside Battlesuits":{baseType:"60mm"},"Cadre Fireblade":{baseType:"25mm"},"Commander Farsight":{baseType:"60mm"},"Commander in Coldstar Battlesuit":{baseType:"60mm"},"Commander in Enforcer Battlesuit":{baseType:"60mm"},"Commander Shadowsun":{baseType:"50mm"},"Crisis Fireknife Battlesuits":{baseType:"50mm"},"Crisis Starscythe Battlesuits":{baseType:"50mm"},"Crisis Sunforge Battlesuits":{baseType:"50mm"},Darkstrider:{baseType:"32mm"},Devilfish:{baseType:"Large Flying Base"},Ethereal:{baseType:"40mm"},"Firesight Team":{baseType:"40mm"},"Ghostkeel Battlesuit":{baseType:"105x70mm"},"Hammerhead Gunship":{baseType:"Large Flying Base"},"Kroot Carnivores":{baseType:"28.5mm"},"Kroot Farstalkers":{baseType:"28.5mm"},"Kroot Farstalkers: Kroot Kill-broker":{baseType:"32mm"},"Kroot Flesh Shaper":{baseType:"32mm"},"Kroot Hounds":{baseType:"28.5mm"},"Kroot Lone-spear":{baseType:"90x52.5mm"},"Kroot Trail Shaper":{baseType:"32mm"},"Kroot War Shaper":{baseType:"32mm"},"Krootox Rampagers":{baseType:"50mm"},"Krootox Riders":{baseType:"50mm"},"Pathfinder Team":{baseType:"25mm"},Piranhas:{baseType:"Large Flying Base"},"Razorshark Strike Fighter":{baseType:"120x92mm"},"Riptide Battlesuit":{baseType:"120x92mm"},"Sky Ray Gunship":{baseType:"Large Flying Base"},"Stealth Battlesuits":{baseType:"32mm"},Stormsurge:{baseType:"170x109mm"},"Strike Team":{baseType:"25mm"},"Sun Shark Bomber":{baseType:"120x92mm"},"Tidewall Defence Platform":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Droneport":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Gunrig":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Shieldline":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vespid Stingwings":{baseType:"28.5mm"},"AX-1-0 Tiger Shark":{baseType:"160mm"},Manta:{baseType:"hull",hullDimensions:{width:4,height:6}},"Taâunar Supremacy Armour":{baseType:"160mm"},"Tiger Shark":{baseType:"160mm"}},"THOUSAND SONS":{Ahriman:{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Daemon Prince of Tzeentch":{baseType:"60mm"},"Daemon Prince of Tzeentch with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},"Exalted Sorcerer":{baseType:"32mm"},"Exalted Sorcerer on Disc of Tzeentch":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Infernal Master":{baseType:"40mm"},"Magnus the Red":{baseType:"100mm"},Maulerfiend:{baseType:"120x92mm"},"Mutalith Vortex Beast":{baseType:"120x92mm"},"Rubric Marines":{baseType:"32mm"},"Scarab Occult Terminators":{baseType:"40mm"},"Sekhetar Robots":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Tzaangor Enlightened":{baseType:"40mm"},"Tzaangor Enlightened with Fatecaster Greatbows":{baseType:"40mm"},"Tzaangor Shaman":{baseType:"40mm"},Tzaangors:{baseType:"32mm"},"Blue Horrors":{baseType:"25mm"},Flamers:{baseType:"32mm"},"Kairos Fateweaver":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},"Pink Horrors":{baseType:"32mm"},Screamers:{baseType:"Small Flying Base"}},TYRANIDS:ad,"WORLD EATERS":{Angron:{baseType:"100mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Khorne":{baseType:"60mm"},"Daemon Prince of Khorne with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},Eightbound:{baseType:"40mm"},"Exalted Eightbound":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Goremongers:{baseType:"32mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},Jakhals:{baseType:"28.5mm"},"Jakhals: Dishonoured":{baseType:"40mm"},"KhÃ¢rn the Betrayer":{baseType:"40mm"},"Khorne Berzerkers":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Invocatus":{baseType:"90x52.5mm"},"Lord on Juggernaut":{baseType:"90x52.5mm"},"Master of Executions":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},Slaughterbound:{baseType:"50mm"},"Terminator Squad":{baseType:"40mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodthirster:{baseType:"120x92mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Skarbrand:{baseType:"100mm"}}},sd=Qt(as);function rd(){return Object.keys(as)}function tl(t){return as[t]?Object.keys(as[t]):[]}function Pr(t,n){return!as[t]||!as[t][n]?null:as[t][n]}Fn(sd,t=>Object.keys(t));function id(t,n){const a=t.FACTION_KEYWORD,r=t.UNITS||[],s=[],i=[],o={};for(const c of r){const d=c.name||"",m=Qm(c.quantity);let f=Pr(a,d);if(!f){const u=al(d,a);u&&(f=Pr(a,u))}if(!f){const{faction:u,unitName:y}=ld(d);u&&y&&(f=Pr(u,y))}if(f){o[d]||(o[d]=0),o[d]++;const u=o[d]>1?` #${o[d]}`:"",y=`${d}${u}`,g=od(f,m,n,y);s.push(...g)}else i.push({id:"unmatched-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),unitName:d,quantity:m,points:c.points,section:c.section})}return{matched:nl(s),unmatched:i}}function od(t,n,a,r,s){const i=[],o=cd(),l=t.baseType,c=ud(r,l);for(let d=0;d<n;d++){const f={id:dd(),baseType:l,playerId:a,x:0,y:0,rotation:0,unitId:o,unitName:r,name:c,imported:!0,inStaging:!0};l==="hull"&&(f.baseType="rect-custom",f.customWidth=t.hullDimensions?.width||5.5,f.customHeight=t.hullDimensions?.height||3),i.push(f)}return i}function nl(t){const i={};t.forEach(d=>{const m=d.unitId||"ungrouped";i[m]||(i[m]=[]),i[m].push(d)});let o=2,l=2,c=0;for(const d in i){const m=i[d];for(const f of m)f.x=o,f.y=l,o+=2,c++,c>=6&&(o=2,l+=2,c=0);c>0&&(o=2,l+=2,c=0)}return t}function al(t,n){const a=tl(n);if(!a||a.length===0)return null;const r=Qa(t);for(const l of a)if(Qa(l)===r)return l;const s=r.replace(/s$/,""),i=r+"s";for(const l of a){const c=Qa(l);if(c===s||c===i)return l}for(const l of a){const c=Qa(l);if(r.includes(c)||c.includes(r))return l}const o=r.split(/\s+/).filter(l=>l.length>2);if(o.length>0)for(const l of a){const c=Qa(l);if(o.every(d=>c.includes(d)))return l}return null}function ld(t){const n=rd(),a=Qa(t);for(const r of n){const s=tl(r);if(s){for(const i of s)if(Qa(i)===a)return{faction:r,unitName:i}}}for(const r of n){const s=al(t,r);if(s)return{faction:r,unitName:s}}return{faction:null,unitName:null}}function Qa(t){return String(t||"").toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim()}function cd(){return"unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function ud(t,n){if(!t)return"";const a=n.match(/(\d+)mm/),r=a?parseInt(a[1],10):null;return r&&r<50?md(t):t}function md(t){return t?t.replace(/\s*#\d+$/,"").split(/\s+/).filter(s=>s.length>0).slice(0,3).map(s=>s[0].toUpperCase()).join(""):""}function dd(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}var hd=he('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),fd=he('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div> <!>',1),yd=he('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Selected</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <button class="danger svelte-1g40uyy"> </button></div>'),pd=he('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Rotation</span> <span class="value svelte-1g40uyy"> </span></div>'),vd=he('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div>'),gd=he('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),bd=he('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Base Type</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Player</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Position</span> <span class="value svelte-1g40uyy"> </span></div> <!> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-1g40uyy">Remove</button></div>'),Td=he('<p class="hint svelte-1g40uyy">Click a model to select it</p>'),xd=he('<p class="hint svelte-1g40uyy">Click and drag on battlefield to draw a measurement line</p>'),_d=he('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Length</span> <span class="value svelte-1g40uyy"> </span></div> <button class="danger svelte-1g40uyy">Remove Line</button>',1),wd=he('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Lines</span> <span class="value svelte-1g40uyy"> </span></div> <button class="secondary svelte-1g40uyy">Clear All Lines</button>',1),Sd=he('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Line Tool Active (M)</label></div> <!> <!> <!></div>'),Ad=he('<div class="button-group vertical svelte-1g40uyy"><div class="button-row svelte-1g40uyy"><button title="Undo (Ctrl+Z)" class="svelte-1g40uyy">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-1g40uyy">Redo</button></div> <div class="button-row svelte-1g40uyy"><button title="Export deployment to share with others" class="svelte-1g40uyy">Export</button> <button title="Import deployment from JSON file" class="svelte-1g40uyy">Import</button></div> <input type="file" accept=".json" style="display: none;"/> <button class="svelte-1g40uyy">Save to Browser</button> <button class="svelte-1g40uyy">Restore from Browser</button> <button class="secondary svelte-1g40uyy">Clear All Models</button> <button class="secondary svelte-1g40uyy">Clear Saved State</button></div>'),Cd=he('<div class="player-toggle svelte-1g40uyy"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-1g40uyy"><div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Circles</h4> <div class="palette-grid svelte-1g40uyy"></div></div> <div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Ovals</h4> <div class="palette-grid svelte-1g40uyy"></div></div></div>',1),Md=he('<div class="rect-hull-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="rect-width" class="svelte-1g40uyy">Width (inches)</label> <input id="rect-width" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <div class="field svelte-1g40uyy"><label for="rect-height" class="svelte-1g40uyy">Height (inches)</label> <input id="rect-height" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <button class="svelte-1g40uyy"> </button></div>'),Ed=xe('<path stroke-width="0.10" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),Rd=xe('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),kd=xe("<!><!>",1),Ld=xe('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),Dd=xe('<g opacity="0.5" pointer-events="none"><!></g>'),Id=xe('<circle r="0.4" fill="rgba(147, 51, 234, 0.5)" stroke="#9333ea" stroke-width="0.1" pointer-events="none"></circle><line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="group-rotate-handle"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),$d=xe('<circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle><circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle>',1),Pd=xe('<g><line stroke-linecap="round"></line><!><g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g></g>'),Nd=xe('<g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" fill="#f59e0b" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g>'),Od=xe('<g class="measurement-line drawing"><line stroke="#f59e0b" stroke-width="0.15" stroke-dasharray="0.3,0.15" stroke-linecap="round" pointer-events="none"></line><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><!></g>'),Wd=xe('<line stroke-width="0.05" pointer-events="none"></line>'),Yd=xe('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),Hd=xe('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),Fd=xe('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),Bd=xe("<!><!><!><!><!><!><!><!><!><!><!><!><!><!>",1),qd=he('<div class="staging-wrapper svelte-1g40uyy"><!></div>'),Ud=he('<main class="svelte-1g40uyy"><div class="layout svelte-1g40uyy"><div class="sidebar svelte-1g40uyy"><!> <!> <!> <!> <!> <!></div> <div class="main-content svelte-1g40uyy"><div class="battlefield-area svelte-1g40uyy"><div class="battlefield-container svelte-1g40uyy" role="presentation"><!></div> <div class="info svelte-1g40uyy"><p class="svelte-1g40uyy"> </p> <p class="hint svelte-1g40uyy">Drag to select | Ctrl+Click multi-select | Del remove | 1/2 player | L LoS | M measure</p></div></div> <!></div></div></main> <!>',1);function Kd(t,n){bn(n,!1);const a=()=>pt(Oa,"$selectedDeployment",f),r=()=>pt(na,"$selectedLayoutName",f),s=()=>pt(ha,"$selectedLayoutType",f),i=()=>pt(mt,"$models",f),o=()=>pt(yi,"$loadedTerrain",f),l=()=>pt(En,"$history",f),c=()=>pt(jo,"$player1Models",f),d=()=>pt(Qo,"$player2Models",f),m=()=>pt(jn,"$stagingModels",f),[f,u]=cs(),y=N(),g=N(),T=N(),x=N(),C=N(),D=N(),R=N(),w=N(),S=N(),E=N(),W=N(),A=N();let P=N(1),O=N(null),ne=!1,B=null,ae=N(null),se=N(!1),j=N(!1),Z=N(5.5),oe=N(3),me=N(!1),_e=N([]),re=[],I=N(null),q=N(!1),ee=N(null),F=N(null),H=N([]),Me=N(new Set),st=!1,J=!1,pe=null,Pe=!1,ve=null,qt=0,Rt=null,Qe=N([]),qe=N(null),kt=N(!1),lt=N(null),it=N(null),V=N(!1);const De=5,Ke="warhammer-deployment-state";function xt(){const M={deployment:a()?.name||null,layout:r()||null,layoutType:s()||null,models:i()};localStorage.setItem(Ke,JSON.stringify(M))}function vt(){const M=localStorage.getItem(Ke);if(M)try{const Y=JSON.parse(M);Y.models&&Array.isArray(Y.models)&&(mt.set(Y.models),En.clear())}catch(Y){console.error("Failed to restore deployment state:",Y)}}function $t(){localStorage.removeItem(Ke),mt.clear()}function Gt(){const M={version:1,exportedAt:new Date().toISOString(),deployment:a()?{name:a().name,zones:a().zones,objectives:a().objectives}:null,terrain:{layoutName:r(),layoutType:s(),terrains:o().terrains,walls:o().walls},models:i()},Y=JSON.stringify(M,null,2),U=new Blob([Y],{type:"application/json"}),fe=URL.createObjectURL(U),de=document.createElement("a");de.href=fe,de.download=`deployment-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(de),de.click(),document.body.removeChild(de),URL.revokeObjectURL(fe)}let sn=N(null);function en(){e(sn)?.click()}function rn(M){const Y=M.target.files?.[0];if(!Y)return;const U=new FileReader;U.onload=fe=>{try{const de=JSON.parse(fe.target.result);Ye(de)}catch(de){console.error("Failed to parse import file:",de),alert("Failed to import: Invalid JSON file")}},U.readAsText(Y),M.target.value=""}function Ye(M){if(!M.version){alert("Invalid import file: missing version");return}if(M.deployment){const Y=zo.find(U=>U.name===M.deployment.name);Y?Oa.set(Y):M.deployment.zones&&M.deployment.objectives&&Oa.set({name:M.deployment.name||"Imported",zones:M.deployment.zones,objectives:M.deployment.objectives})}else Oa.set(null);if(M.terrain){const{layoutName:Y,layoutType:U,terrains:fe,walls:de}=M.terrain;if(U==="preset"&&Y){if(mi.find(ge=>ge.name===Y))na.set(Y),ha.set("preset");else if(fe||de){const ge=`imported-${Date.now()}`,Ee=localStorage.getItem("warhammer-deployment-layouts"),et=Ee?JSON.parse(Ee):{};et[ge]={terrains:fe||[],walls:de||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(et)),na.set(ge),ha.set("saved")}}else if(U==="saved"&&Y){const Te=localStorage.getItem("warhammer-deployment-layouts"),ge=Te?JSON.parse(Te):{};ge[Y]?(na.set(Y),ha.set("saved")):(fe||de)&&(ge[Y]={terrains:fe||[],walls:de||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(ge)),na.set(Y),ha.set("saved"))}else if(fe||de){const Te=`imported-${Date.now()}`,ge=localStorage.getItem("warhammer-deployment-layouts"),Ee=ge?JSON.parse(ge):{};Ee[Te]={terrains:fe||[],walls:de||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(Ee)),na.set(Te),ha.set("saved")}}M.models&&Array.isArray(M.models)&&(mt.set(M.models),En.clear()),v(H,[])}async function nt(M){const{text:Y,playerId:U}=M.detail;try{e(I)&&e(I).setLoading(!0);const{format:fe,data:de}=await Vm(Y),{matched:Te,unmatched:ge}=id(de,U),Ee=de.LIST_TITLE||`${de.FACTION_KEYWORD} Army`;zr.addImport(Ee,Y,de,U),ge.length>0?(v(_e,ge),re=Te,v(me,!0),e(I)&&e(I).setLoading(!1)):(Oi(Te,de.FACTION_KEYWORD),e(I)&&(e(I).setSuccess(`Imported ${Te.length} models from ${de.FACTION_KEYWORD} (${fe})`),e(I).clearText()))}catch(fe){console.error("Failed to parse army list:",fe),e(I)&&e(I).setError(fe.message||"Failed to parse army list")}}function ze(M){const{selected:Y}=M.detail,U=[];for(const Te of Y){const ge=typeof Te.quantity=="string"?parseInt(Te.quantity.replace(/x/i,""),10)||1:Te.quantity||1,Ee="unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);for(let et=0;et<ge;et++)U.push({id:"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),baseType:Te.baseType,playerId:e(P),x:0,y:0,rotation:0,unitId:Ee,unitName:Te.unitName,imported:!0,inStaging:!0})}const fe=[...re,...U],de=nl(fe);Oi(de,"imported"),e(I)&&(e(I).setSuccess(`Imported ${fe.length} models to staging area`),e(I).clearText()),v(_e,[]),re=[]}function Mt(M){const{modelIds:Y}=M.detail;Am(Y,30,22)}function zt(){}us(()=>{window.addEventListener("keydown",Ze)}),li(()=>{window.removeEventListener("keydown",Ze)});function Ze(M){if(M.target.tagName==="INPUT")return;const Y=e(H).length>0;if((M.ctrlKey||M.metaKey)&&M.key==="z"&&!M.shiftKey){M.preventDefault(),mt.undo();return}if((M.ctrlKey||M.metaKey)&&(M.key==="y"||M.shiftKey&&M.key==="z")){M.preventDefault(),mt.redo();return}if(M.key==="1"){M.preventDefault(),v(P,1);return}if(M.key==="2"){M.preventDefault(),v(P,2);return}if(M.key==="l"||M.key==="L"){M.preventDefault(),v(se,!e(se));return}if(M.key==="m"||M.key==="M"){M.preventDefault(),v(V,!e(V)),e(V)||(v(kt,!1),v(lt,null),v(it,null));return}if(M.key==="Delete"||M.key==="Backspace"){if(M.preventDefault(),e(qe)){v(Qe,e(Qe).filter(U=>U.id!==e(qe))),v(qe,null);return}e(H).length>0&&(e(H).forEach(U=>{mt.remove(U)}),v(H,[]));return}if(Y&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(M.key)){M.preventDefault();const U=M.shiftKey?.1:1;let fe=0,de=0;switch(M.key){case"ArrowUp":de=-U;break;case"ArrowDown":de=U;break;case"ArrowLeft":fe=-U;break;case"ArrowRight":fe=U;break}e(H).forEach(Te=>{const ge=i().find(Ee=>Ee.id===Te);ge&&mt.updateModel(Te,{x:ge.x+fe,y:ge.y+de},!1)});return}if(M.key==="Escape"){L();return}}function L(M){if(st){st=!1;return}v(H,[]),v(qe,null)}function ye(){return"line-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Se(M,Y,U,fe){return Math.sqrt((U-M)**2+(fe-Y)**2)}function Ae(M){if(!e(ae))return;M.preventDefault();const Y=e(ae)(M.clientX,M.clientY);v(kt,!0),v(lt,{x:Y.x,y:Y.y}),v(it,{x:Y.x,y:Y.y}),window.addEventListener("mousemove",Re),window.addEventListener("mouseup",ct)}function Re(M){if(!e(kt)||!e(ae))return;const Y=e(ae)(M.clientX,M.clientY);v(it,{x:Y.x,y:Y.y})}function ct(M){if(!e(kt))return;if(Se(e(lt).x,e(lt).y,e(it).x,e(it).y)>.5){const U={id:ye(),x1:e(lt).x,y1:e(lt).y,x2:e(it).x,y2:e(it).y};v(Qe,[...e(Qe),U]),v(qe,U.id),v(H,[])}v(kt,!1),v(lt,null),v(it,null),window.removeEventListener("mousemove",Re),window.removeEventListener("mouseup",ct)}function ut(M,Y){Y?.stopPropagation(),v(qe,M),v(H,[])}let be=!1,Ge={x:0,y:0},Pt=null,Bn=null;function tn(M,Y){if(!e(V)||!e(ae))return;Y.stopPropagation(),Y.preventDefault();const U=e(Qe).find(ge=>ge.id===M);if(!U)return;be=!0,Pt=M,Bn=null,v(qe,M),v(H,[]);const fe=e(ae)(Y.clientX,Y.clientY),de=(U.x1+U.x2)/2,Te=(U.y1+U.y2)/2;Ge={x:fe.x-de,y:fe.y-Te},window.addEventListener("mousemove",Jn),window.addEventListener("mouseup",oa)}function $n(M,Y,U){!e(V)||!e(ae)||(U.stopPropagation(),U.preventDefault(),be=!0,Pt=M,Bn=Y,v(qe,M),v(H,[]),window.addEventListener("mousemove",Jn),window.addEventListener("mouseup",oa))}function Jn(M){if(!be||!e(ae)||!Pt)return;const Y=e(ae)(M.clientX,M.clientY);v(Qe,e(Qe).map(U=>{if(U.id!==Pt)return U;if(Bn===1)return{...U,x1:Y.x,y1:Y.y};if(Bn===2)return{...U,x2:Y.x,y2:Y.y};{const fe=Y.x-Ge.x,de=Y.y-Ge.y,Te=(U.x1+U.x2)/2,ge=(U.y1+U.y2)/2,Ee=fe-Te,et=de-ge;return{...U,x1:U.x1+Ee,y1:U.y1+et,x2:U.x2+Ee,y2:U.y2+et}}}))}function oa(){be=!1,Pt=null,Bn=null,window.removeEventListener("mousemove",Jn),window.removeEventListener("mouseup",oa)}function Ga(){v(Qe,[]),v(qe,null)}function za(M){const Y=M.target,U=Y.closest(".model-base"),fe=Y.closest(".measurement-line");if(U||fe||!e(ae))return;if(M.preventDefault(),e(V)){Ae(M);return}const de=e(ae)(M.clientX,M.clientY);v(ee,{x:de.x,y:de.y}),v(F,{x:de.x,y:de.y}),v(q,!0),window.addEventListener("mousemove",$),window.addEventListener("mouseup",Q)}function $(M){if(!e(q)||!e(ae))return;const Y=e(ae)(M.clientX,M.clientY);v(F,{x:Y.x,y:Y.y});const U=Math.min(e(ee).x,e(F).x),fe=Math.max(e(ee).x,e(F).x),de=Math.min(e(ee).y,e(F).y),Te=Math.max(e(ee).y,e(F).y),ge=new Set;i().forEach(Ee=>{Ee.x>=U&&Ee.x<=fe&&Ee.y>=de&&Ee.y<=Te&&ge.add(Ee.id)}),v(Me,ge)}function Q(M){if(!e(q))return;const Y=Math.min(e(ee).x,e(F).x),U=Math.max(e(ee).x,e(F).x),fe=Math.min(e(ee).y,e(F).y),de=Math.max(e(ee).y,e(F).y),Te=U-Y,ge=de-fe;if(Te<.5&&ge<.5)v(H,[]);else{const Ee=[];i().forEach(et=>{et.x>=Y&&et.x<=U&&et.y>=fe&&et.y<=de&&Ee.push(et.id)}),v(H,Ee),st=!0}v(q,!1),v(ee,null),v(F,null),e(Me).clear(),v(Me,e(Me)),window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",Q)}function te(M,Y){if(!e(ae))return;ne=!0,B={x:Y.clientX,y:Y.clientY};const U=e(ae)(Y.clientX,Y.clientY);v(O,{baseType:M.type,x:U.x,y:U.y}),window.addEventListener("mousemove",ke),window.addEventListener("mouseup",Le)}function ke(M){if(!ne||!e(O)||!e(ae))return;const Y=e(ae)(M.clientX,M.clientY);v(O,{...e(O),x:Y.x,y:Y.y})}function Le(M){if(!ne||!e(O)){ne=!1,v(O,null),B=null,window.removeEventListener("mousemove",ke),window.removeEventListener("mouseup",Le);return}const Y=M.clientX-B.x,U=M.clientY-B.y,fe=Math.sqrt(Y*Y+U*U);let de,Te;fe<De?(de=30,Te=22):(de=e(O).x,Te=e(O).y);const ge=e(O).customWidth&&e(O).customHeight?{width:e(O).customWidth,height:e(O).customHeight}:null,Ee=mt.add(e(O).baseType,e(P),de,Te,ge);v(H,[Ee]),v(O,null),ne=!1,B=null,window.removeEventListener("mousemove",ke),window.removeEventListener("mouseup",Le)}function He(){const U={width:e(Z),height:e(oe)},fe=mt.add("rect-custom",e(P),30,22,U);v(H,[fe])}function Ne(M,Y){Y&&(Y.ctrlKey||Y.metaKey||Y.shiftKey)?e(H).includes(M)?v(H,e(H).filter(U=>U!==M)):v(H,[...e(H),M]):e(H).includes(M)&&e(H).length>1||v(H,[M])}function Ve(M,Y,U){if(e(H).length>1&&e(H).includes(M)){J||(J=!0,pe={},e(H).forEach(de=>{const Te=i().find(ge=>ge.id===de);Te&&(pe[de]={x:Te.x,y:Te.y})}));const fe=pe[M];if(fe){const de=Y-fe.x,Te=U-fe.y;e(H).forEach(ge=>{const Ee=pe[ge];Ee&&mt.updateModel(ge,{x:Ee.x+de,y:Ee.y+Te},!0)})}}else mt.updateModel(M,{x:Y,y:U},!0)}function at(M,Y,U,fe,de){J?(e(H).forEach(Te=>{const ge=pe[Te],Ee=i().find(et=>et.id===Te);ge&&Ee&&En.push({type:"move",modelId:Te,before:{x:ge.x,y:ge.y},after:{x:Ee.x,y:Ee.y}})}),J=!1,pe=null):En.push({type:"move",modelId:M,before:{x:Y,y:U},after:{x:fe,y:de}})}function Jt(M,Y){if(e(H).length>1&&e(H).includes(M)){if(!Pe){Pe=!0;let Te=0,ge=0,Ee=0;const et={};e(H).forEach(It=>{const Yt=i().find(Ht=>Ht.id===It);Yt&&(Te+=Yt.x,ge+=Yt.y,Ee++,et[It]={x:Yt.x,y:Yt.y,rotation:Yt.rotation||0})}),ve={x:Te/Ee,y:ge/Ee},pe=et}const U=i().find(Te=>Te.id===M),fe=pe[M];if(!U||!fe)return;const de=Y-fe.rotation;e(H).forEach(Te=>{const ge=pe[Te];if(ge){const Ee=ge.x-ve.x,et=ge.y-ve.y,It=de*Math.PI/180,Yt=Math.cos(It),Ht=Math.sin(It),Tt=Ee*Yt-et*Ht,jt=Ee*Ht+et*Yt;mt.updateModel(Te,{x:ve.x+Tt,y:ve.y+jt,rotation:ge.rotation+de},!0)}})}else mt.updateModel(M,{rotation:Y},!0)}function Ft(M,Y,U){Pe?(e(H).forEach(fe=>{const de=pe[fe],Te=i().find(ge=>ge.id===fe);de&&Te&&En.push({type:"rotate",modelId:fe,before:{x:de.x,y:de.y,rotation:de.rotation},after:{x:Te.x,y:Te.y,rotation:Te.rotation||0}})}),Pe=!1,ve=null,pe=null):En.push({type:"rotate",modelId:M,before:{rotation:Y},after:{rotation:U}})}function Wt(M,Y){mt.updateModel(M,{name:Y})}function St(M){if(!e(ae)||e(y).length<2)return;M.preventDefault(),M.stopPropagation(),Pe=!0,Rt={},e(y).forEach(U=>{Rt[U.id]={x:U.x,y:U.y,rotation:U.rotation||0}});const Y=e(ae)(M.clientX,M.clientY);qt=Math.atan2(Y.y-e(T).y,Y.x-e(T).x)*180/Math.PI,window.addEventListener("mousemove",Xt),window.addEventListener("mouseup",Lt)}function Xt(M){if(!Pe||!e(ae)||!e(T))return;const Y=e(ae)(M.clientX,M.clientY);let fe=Math.atan2(Y.y-e(T).y,Y.x-e(T).x)*180/Math.PI-qt;M.shiftKey||(fe=Math.round(fe/15)*15),v(Dt,-45+fe);const de=fe*Math.PI/180,Te=Math.cos(de),ge=Math.sin(de);e(y).forEach(Ee=>{const et=Rt[Ee.id];if(et){const It=et.x-e(T).x,Yt=et.y-e(T).y,Ht=It*Te-Yt*ge,Tt=It*ge+Yt*Te;mt.updateModel(Ee.id,{x:e(T).x+Ht,y:e(T).y+Tt,rotation:et.rotation+fe},!0)}})}function Lt(){Pe&&Rt&&e(y).forEach(M=>{const Y=Rt[M.id];Y&&En.push({type:"rotate",modelId:M.id,before:{x:Y.x,y:Y.y,rotation:Y.rotation},after:{x:M.x,y:M.y,rotation:M.rotation||0}})}),Pe=!1,Rt=null,v(Dt,-45),window.removeEventListener("mousemove",Xt),window.removeEventListener("mouseup",Lt)}function on(){e(H).length>0&&(e(H).forEach(M=>{mt.remove(M)}),v(H,[]))}function un(){confirm("Clear all models?")&&(mt.clear(),v(H,[]))}function dn(M){if(ks(M.baseType))return{x:M.x,y:M.y,width:M.customWidth,height:M.customHeight,rotation:M.rotation||0,isRectangle:!0};const Y=ya(M.baseType,M);return Vn(M.baseType)?{x:M.x,y:M.y,rx:Y.width/2,ry:Y.height/2,rotation:M.rotation||0}:{x:M.x,y:M.y,radius:Y.radius}}let Dt=N(-45);ce(()=>(e(H),i()),()=>{v(y,e(H).map(M=>i().find(Y=>Y.id===M)).filter(Boolean))}),ce(()=>e(y),()=>{v(g,e(y).length===1?e(y)[0]:null)}),ce(()=>e(y),()=>{v(T,e(y).length>1?(()=>{let M=0,Y=0;return e(y).forEach(U=>{M+=U.x,Y+=U.y}),{x:M/e(y).length,y:Y/e(y).length}})():null)}),ce(()=>(e(y),e(T),Vn),()=>{v(x,e(y).length>1?(()=>{let M=0;return e(y).forEach(Y=>{const U=Math.sqrt(Math.pow(Y.x-e(T).x,2)+Math.pow(Y.y-e(T).y,2)),fe=ya(Y.baseType,Y),de=ks(Y.baseType)?Math.max(Y.customWidth,Y.customHeight)/2:Vn(Y.baseType)?Math.max(fe.width,fe.height)/2:fe.radius;M=Math.max(M,U+de)}),M+2})():0)}),ce(()=>(e(T),e(x),e(Dt)),()=>{v(C,e(T)?e(T).x+e(x)*Math.cos(e(Dt)*Math.PI/180):0)}),ce(()=>(e(T),e(x),e(Dt)),()=>{v(D,e(T)?e(T).y+e(x)*Math.sin(e(Dt)*Math.PI/180):0)}),ce(()=>(e(qe),e(Qe)),()=>{v(R,e(qe)?e(Qe).find(M=>M.id===e(qe)):null)}),ce(()=>e(y),()=>{v(w,[...new Set(e(y).map(M=>M.playerId))])}),ce(()=>(e(y),i(),e(w)),()=>{v(S,e(y).length>0?i().filter(M=>!e(w).includes(M.playerId)):[])}),ce(()=>(o(),os),()=>{v(E,o().terrains.map(M=>({id:M.id,vertices:os(M)})))}),ce(()=>(o(),qa),()=>{v(W,o().walls.map(M=>Mr(qa(M.shape,M.segments),M.x,M.y,M.rotation)))}),ce(()=>(e(y),e(se),e(S),e(E),e(W)),()=>{v(A,e(y).length>0&&e(se)&&e(S).length>0?e(y).flatMap(M=>e(S).map(Y=>{const U=ui(dn(Y),dn(M),e(E),e(W));return{sourceId:Y.id,source:Y,targetId:M.id,target:M,canSee:U.canSee,firstClearRay:U.firstClearRay,rays:U.rays}})):[])}),ia(),kn();var xn=Ud(),pn=Ce(xn),Zn=_(pn),Xe=_(Zn),K=_(Xe);an(K,{title:"Selected Model",children:(M,Y)=>{var U=Ot(),fe=Ce(U);{var de=ge=>{var Ee=yd(),et=_(Ee),It=b(_(et),2),Yt=_(It),Ht=b(et,2),Tt=_(Ht),jt=_(Tt),ln=b(Ht,2);{var ea=wn=>{var ds=fd(),Xa=Ce(ds),hs=_(Xa),fs=_(hs),Os=b(Xa,2);{var ys=Ta=>{var Ue=hd(),X=b(_(Ue),2),At=_(X);G(gt=>we(At,`${gt??""}/${e(A),h(()=>e(A).length)??""} rays visible`),[()=>(e(A),h(()=>e(A).filter(gt=>gt.canSee).length))]),k(Ta,Ue)};ie(Os,Ta=>{e(A),h(()=>e(A).length>0)&&Ta(ys)})}Xn(fs,()=>e(j),Ta=>v(j,Ta)),k(wn,ds)};ie(ln,wn=>{e(se)&&wn(ea)})}var ca=b(ln,2),ua=_(ca);G(()=>{we(Yt,`${e(H),h(()=>e(H).length)??""} models`),we(ua,`Remove All (${e(H),h(()=>e(H).length)??""})`)}),Xn(jt,()=>e(se),wn=>v(se,wn)),z("click",ca,on),k(ge,Ee)},Te=ge=>{var Ee=Ot(),et=Ce(Ee);{var It=Ht=>{var Tt=bd(),jt=_(Tt),ln=b(_(jt),2),ea=b(jt,2),ca=b(_(ea),2),ua=_(ca),wn=b(ea,2),ds=b(_(wn),2),Xa=_(ds),hs=b(wn,2),fs=b(_(hs),2),Os=_(fs),ys=b(hs,2);{var Ta=je=>{var ht=pd(),_t=b(_(ht),2),Sn=_(_t);G(qn=>we(Sn,`${qn??""}Â°`),[()=>(e(g),h(()=>Math.round(e(g).rotation||0)))]),k(je,ht)};ie(ys,je=>{le(Vn),e(g),h(()=>Vn(e(g).baseType))&&je(Ta)})}var Ue=b(ys,2),X=_(Ue),At=_(X),gt=b(Ue,2);{var rt=je=>{var ht=vd(),_t=_(ht),Sn=_(_t);Xn(Sn,()=>e(j),qn=>v(j,qn)),k(je,ht)};ie(gt,je=>{e(se)&&je(rt)})}var Fe=b(gt,2);{var nn=je=>{var ht=gd(),_t=b(_(ht),2),Sn=_(_t);G(qn=>we(Sn,`${qn??""}/${e(A),h(()=>e(A).length)??""} visible`),[()=>(e(A),h(()=>e(A).filter(qn=>qn.canSee).length))]),k(je,ht)};ie(Fe,je=>{e(se),e(A),h(()=>e(se)&&e(A).length>0)&&je(nn)})}var gn=b(Fe,2);G((je,ht,_t)=>{Po(ln,(e(g),h(()=>e(g).name||""))),we(ua,je),we(Xa,`Player ${e(g),h(()=>e(g).playerId)??""}`),we(Os,`${ht??""}", ${_t??""}"`)},[()=>(le(ya),e(g),h(()=>ya(e(g).baseType,e(g))?.label||"Unknown")),()=>(e(g),h(()=>e(g).x.toFixed(1))),()=>(e(g),h(()=>e(g).y.toFixed(1)))]),z("change",ln,je=>Wt(e(g).id,je.target.value)),Xn(At,()=>e(se),je=>v(se,je)),z("click",gn,on),k(Ht,Tt)},Yt=Ht=>{var Tt=Td();k(Ht,Tt)};ie(et,Ht=>{e(g)?Ht(It):Ht(Yt,!1)},!0)}k(ge,Ee)};ie(fe,ge=>{e(H),h(()=>e(H).length>1)?ge(de):ge(Te,!1)})}k(M,U)},$$slots:{default:!0}});var dt=b(K,2);an(dt,{title:"Measure Tool",children:(M,Y)=>{var U=Sd(),fe=_(U),de=_(fe),Te=_(de),ge=b(fe,2);{var Ee=Tt=>{var jt=xd();k(Tt,jt)};ie(ge,Tt=>{e(V)&&Tt(Ee)})}var et=b(ge,2);{var It=Tt=>{var jt=_d(),ln=Ce(jt),ea=b(_(ln),2),ca=_(ea),ua=b(ln,2);G(wn=>we(ca,`${wn??""}"`),[()=>(e(R),h(()=>Se(e(R).x1,e(R).y1,e(R).x2,e(R).y2).toFixed(2)))]),z("click",ua,()=>{v(Qe,e(Qe).filter(wn=>wn.id!==e(qe))),v(qe,null)}),k(Tt,jt)};ie(et,Tt=>{e(R)&&Tt(It)})}var Yt=b(et,2);{var Ht=Tt=>{var jt=wd(),ln=Ce(jt),ea=b(_(ln),2),ca=_(ea),ua=b(ln,2);G(()=>we(ca,`${e(Qe),h(()=>e(Qe).length)??""} line${e(Qe),h(()=>e(Qe).length!==1?"s":"")??""}`)),z("click",ua,Ga),k(Tt,jt)};ie(Yt,Tt=>{e(Qe),h(()=>e(Qe).length>0)&&Tt(Ht)})}Xn(Te,()=>e(V),Tt=>v(V,Tt)),k(M,U)},$$slots:{default:!0}});var ot=b(dt,2);an(ot,{title:"Actions",children:(M,Y)=>{var U=Ad(),fe=_(U),de=_(fe),Te=b(de,2),ge=b(fe,2),Ee=_(ge),et=b(Ee,2),It=b(ge,2);Xs(It,ln=>v(sn,ln),()=>e(sn));var Yt=b(It,2),Ht=b(Yt,2),Tt=b(Ht,2),jt=b(Tt,2);G(()=>{de.disabled=(l(),h(()=>!l().past.length)),Te.disabled=(l(),h(()=>!l().future.length))}),z("click",de,()=>mt.undo()),z("click",Te,()=>mt.redo()),z("click",Ee,Gt),z("click",et,en),z("change",It,rn),z("click",Yt,xt),z("click",Ht,vt),z("click",Tt,un),z("click",jt,$t),k(M,U)},$$slots:{default:!0}});var Oe=b(ot,2);an(Oe,{title:"Import Army List",startOpen:!1,children:(M,Y)=>{Xs(bm(M,{get currentPlayer(){return e(P)},$$events:{parse:nt},$$legacy:!0}),U=>v(I,U),()=>e(I))},$$slots:{default:!0}});var $e=b(Oe,2);an($e,{title:"Add Models",children:(M,Y)=>{var U=Cd(),fe=Ce(U),de=_(fe);let Te;var ge=b(de,2);let Ee;var et=b(fe,2),It=_(et),Yt=b(_(It),2);Ie(Yt,5,()=>(le(Yn),h(()=>Yn.circles)),tt,(jt,ln)=>{xr(jt,{get baseSize(){return e(ln)},get playerId(){return e(P)},onDragStart:te})});var Ht=b(It,2),Tt=b(_(Ht),2);Ie(Tt,5,()=>(le(Yn),h(()=>Yn.ovals)),tt,(jt,ln)=>{xr(jt,{get baseSize(){return e(ln)},get playerId(){return e(P)},onDragStart:te})}),G(()=>{Te=mn(de,1,"toggle-btn svelte-1g40uyy",null,Te,{active:e(P)===1}),Ee=mn(ge,1,"toggle-btn svelte-1g40uyy",null,Ee,{active:e(P)===2})}),z("click",de,()=>v(P,1)),z("click",ge,()=>v(P,2)),k(M,U)},$$slots:{default:!0}});var Ut=b($e,2);an(Ut,{title:"Add Hull (Vehicle)",children:(M,Y)=>{var U=Md(),fe=_(U),de=b(_(fe),2),Te=b(fe,2),ge=b(_(Te),2),Ee=b(Te,2),et=_(Ee);G(()=>we(et,`Add ${e(Z)??""}" Ã ${e(oe)??""}" Hull`)),An(de,()=>e(Z),It=>v(Z,It)),An(ge,()=>e(oe),It=>v(oe,It)),z("click",Ee,He),k(M,U)},$$slots:{default:!0}});var Vt=b(Xe,2),yt=_(Vt),bt=_(yt),Nt=_(bt);tr(Nt,{children:wr,$$slots:{default:(M,Y)=>{const U=We(()=>Y.screenToSvg);var fe=Bd(),de=Ce(fe);{var Te=Ue=>{var X=ii();G(()=>we(X,(e(ae),le(e(U)),h(()=>(v(ae,e(U)),""))))),k(Ue,X)};ie(de,Ue=>{e(U)&&!e(ae)&&Ue(Te)})}var ge=b(de);{var Ee=Ue=>{var X=kd(),At=Ce(X);Ie(At,1,()=>(a(),h(()=>a().zones)),tt,(rt,Fe)=>{var nn=Ed();G(gn=>{p(nn,"d",gn),p(nn,"fill",(e(Fe),h(()=>e(Fe).color))),p(nn,"stroke",(e(Fe),h(()=>e(Fe).borderColor)))},[()=>(le(Vs),e(Fe),h(()=>Vs(e(Fe).path)))]),k(rt,nn)});var gt=b(At);Ie(gt,1,()=>(a(),h(()=>a().objectives)),tt,(rt,Fe)=>{const nn=We(()=>(e(Fe),h(()=>e(Fe).isPrimary?"#fbbf24":"#9ca3af"))),gn=We(()=>(e(Fe),h(()=>e(Fe).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var je=Rd(),ht=Ce(je),_t=b(ht),Sn=b(_t);G(()=>{p(ht,"cx",(e(Fe),h(()=>e(Fe).x))),p(ht,"cy",(e(Fe),h(()=>e(Fe).y))),p(ht,"r",fi),p(ht,"fill",e(gn)),p(ht,"stroke",e(nn)),p(_t,"cx",(e(Fe),h(()=>e(Fe).x))),p(_t,"cy",(e(Fe),h(()=>e(Fe).y))),p(_t,"r",hi),p(_t,"fill",e(nn)),p(Sn,"cx",(e(Fe),h(()=>e(Fe).x))),p(Sn,"cy",(e(Fe),h(()=>e(Fe).y)))}),k(rt,je)}),k(Ue,X)};ie(ge,Ue=>{a()&&Ue(Ee)})}var et=b(ge);ie(et,Ue=>{});var It=b(et);ie(It,Ue=>{});var Yt=b(It);Ie(Yt,1,()=>(o(),h(()=>o().terrains)),tt,(Ue,X)=>{var At=Ld(),gt=_(At);G(()=>{p(At,"transform",`rotate(${e(X),h(()=>e(X).rotation)??""}, ${e(X),h(()=>e(X).x+e(X).width/2)??""}, ${e(X),h(()=>e(X).y+e(X).height/2)??""})`),p(gt,"x",(e(X),h(()=>e(X).x))),p(gt,"y",(e(X),h(()=>e(X).y))),p(gt,"width",(e(X),h(()=>e(X).width))),p(gt,"height",(e(X),h(()=>e(X).height)))}),k(Ue,At)});var Ht=b(Yt);Ie(Ht,1,()=>(o(),h(()=>o().walls)),tt,(Ue,X)=>{var At=Dd(),gt=_(At);Er(gt,{get id(){return e(X),h(()=>e(X).id)},get x(){return e(X),h(()=>e(X).x)},get y(){return e(X),h(()=>e(X).y)},get shape(){return e(X),h(()=>e(X).shape)},get segments(){return e(X),h(()=>e(X).segments)},get rotation(){return e(X),h(()=>e(X).rotation)},selected:!1,get screenToSvg(){return e(U)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),k(Ue,At)});var Tt=b(Ht);Ie(Tt,1,i,Ue=>Ue.id,(Ue,X)=>{{let At=We(()=>(e(X),h(()=>e(X).name||""))),gt=We(()=>(e(H),e(X),h(()=>e(H).includes(e(X).id)))),rt=We(()=>(e(H),e(X),e(Me),h(()=>!e(H).includes(e(X).id)&&e(Me).has(e(X).id))));Ls(Ue,{get id(){return e(X),h(()=>e(X).id)},get x(){return e(X),h(()=>e(X).x)},get y(){return e(X),h(()=>e(X).y)},get baseType(){return e(X),h(()=>e(X).baseType)},get playerId(){return e(X),h(()=>e(X).playerId)},get rotation(){return e(X),h(()=>e(X).rotation)},get name(){return e(At)},get customWidth(){return e(X),h(()=>e(X).customWidth)},get customHeight(){return e(X),h(()=>e(X).customHeight)},get selected(){return e(gt)},get marqueePreview(){return e(rt)},get screenToSvg(){return e(U)},onSelect:Ne,onDrag:Ve,onDragEnd:at,onRotate:Jt,onRotateEnd:Ft,onRename:Wt})}});var jt=b(Tt);{var ln=Ue=>{Ls(Ue,{id:"phantom",get x(){return e(O),h(()=>e(O).x)},get y(){return e(O),h(()=>e(O).y)},get baseType(){return e(O),h(()=>e(O).baseType)},get playerId(){return e(P)},rotation:0,get customWidth(){return e(O),h(()=>e(O).customWidth)},get customHeight(){return e(O),h(()=>e(O).customHeight)},selected:!1,get screenToSvg(){return e(U)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};ie(jt,Ue=>{e(O)&&Ue(ln)})}var ea=b(jt);{var ca=Ue=>{var X=Id(),At=Ce(X),gt=b(At),rt=b(gt),Fe=b(rt);G(()=>{p(At,"cx",(e(T),h(()=>e(T).x))),p(At,"cy",(e(T),h(()=>e(T).y))),p(gt,"x1",(e(T),h(()=>e(T).x))),p(gt,"y1",(e(T),h(()=>e(T).y))),p(gt,"x2",e(C)),p(gt,"y2",e(D)),p(rt,"cx",e(C)),p(rt,"cy",e(D)),p(Fe,"transform",`translate(${e(C)??""}, ${e(D)??""})`)}),z("mousedown",rt,St),k(Ue,X)};ie(ea,Ue=>{e(T),e(y),h(()=>e(T)&&e(y).length>1)&&Ue(ca)})}var ua=b(ea);Ie(ua,1,()=>e(Qe),Ue=>Ue.id,(Ue,X)=>{const At=We(()=>(e(X),h(()=>Se(e(X).x1,e(X).y1,e(X).x2,e(X).y2)))),gt=We(()=>(e(X),h(()=>(e(X).x1+e(X).x2)/2))),rt=We(()=>(e(X),h(()=>(e(X).y1+e(X).y2)/2))),Fe=We(()=>(e(X),e(qe),h(()=>e(X).id===e(qe))));var nn=Pd();let gn;var je=_(nn),ht=b(je);{var _t=Un=>{var pi=$d(),Ws=Ce(pi),nr=b(Ws);G(()=>{p(Ws,"cx",(e(X),h(()=>e(X).x1))),p(Ws,"cy",(e(X),h(()=>e(X).y1))),p(Ws,"fill",e(Fe)?"#3b82f6":"#f59e0b"),p(nr,"cx",(e(X),h(()=>e(X).x2))),p(nr,"cy",(e(X),h(()=>e(X).y2))),p(nr,"fill",e(Fe)?"#3b82f6":"#f59e0b")}),z("mousedown",Ws,kr=>$n(e(X).id,1,kr)),z("mousedown",nr,kr=>$n(e(X).id,2,kr)),k(Un,pi)};ie(ht,Un=>{e(V)&&Un(_t)})}var Sn=b(ht),qn=b(_(Sn)),Rr=_(qn);G(Un=>{gn=mn(nn,0,"measurement-line",null,gn,{selected:e(Fe),"tool-active":e(V)}),p(je,"x1",(e(X),h(()=>e(X).x1))),p(je,"y1",(e(X),h(()=>e(X).y1))),p(je,"x2",(e(X),h(()=>e(X).x2))),p(je,"y2",(e(X),h(()=>e(X).y2))),p(je,"stroke",e(Fe)&&e(V)?"#3b82f6":"#f59e0b"),p(je,"stroke-width",e(Fe)&&e(V)?.2:.15),p(je,"role",e(V)?"button":"presentation"),p(je,"tabindex",e(V)?0:-1),p(Sn,"transform",`translate(${e(gt)??""}, ${e(rt)??""})`),p(qn,"fill",e(Fe)&&e(V)?"#3b82f6":"#f59e0b"),we(Rr,`${Un??""}"`)},[()=>(le(e(At)),h(()=>e(At).toFixed(1)))]),z("click",je,Un=>e(V)&&ut(e(X).id,Un)),z("mousedown",je,Un=>e(V)?tn(e(X).id,Un):Un.stopPropagation()),k(Ue,nn)});var wn=b(ua);{var ds=Ue=>{const X=We(()=>(e(lt),e(it),h(()=>Se(e(lt).x,e(lt).y,e(it).x,e(it).y)))),At=We(()=>(e(lt),e(it),h(()=>(e(lt).x+e(it).x)/2))),gt=We(()=>(e(lt),e(it),h(()=>(e(lt).y+e(it).y)/2)));var rt=Od(),Fe=_(rt),nn=b(Fe),gn=b(nn),je=b(gn);{var ht=_t=>{var Sn=Nd(),qn=b(_(Sn)),Rr=_(qn);G(Un=>{p(Sn,"transform",`translate(${e(At)??""}, ${e(gt)??""})`),we(Rr,`${Un??""}"`)},[()=>(le(e(X)),h(()=>e(X).toFixed(1)))]),k(_t,Sn)};ie(je,_t=>{e(X)>.5&&_t(ht)})}G(()=>{p(Fe,"x1",(e(lt),h(()=>e(lt).x))),p(Fe,"y1",(e(lt),h(()=>e(lt).y))),p(Fe,"x2",(e(it),h(()=>e(it).x))),p(Fe,"y2",(e(it),h(()=>e(it).y))),p(nn,"cx",(e(lt),h(()=>e(lt).x))),p(nn,"cy",(e(lt),h(()=>e(lt).y))),p(gn,"cx",(e(it),h(()=>e(it).x))),p(gn,"cy",(e(it),h(()=>e(it).y)))}),k(Ue,rt)};ie(wn,Ue=>{e(kt)&&e(lt)&&e(it)&&Ue(ds)})}var Xa=b(wn);{var hs=Ue=>{var X=Ot(),At=Ce(X);Ie(At,1,()=>e(A),tt,(gt,rt)=>{var Fe=Ot(),nn=Ce(Fe);Ie(nn,1,()=>(e(rt),h(()=>e(rt).rays)),tt,(gn,je)=>{var ht=Wd();G(()=>{p(ht,"x1",(e(je),h(()=>e(je).from.x))),p(ht,"y1",(e(je),h(()=>e(je).from.y))),p(ht,"x2",(e(je),h(()=>e(je).to.x))),p(ht,"y2",(e(je),h(()=>e(je).to.y))),p(ht,"stroke",(e(je),h(()=>e(je).blocked?"#ff000033":"#00ff0033")))}),k(gn,ht)}),k(gt,Fe)}),k(Ue,X)};ie(Xa,Ue=>{e(j),e(se),e(y),e(A),h(()=>e(j)&&e(se)&&e(y).length>0&&e(A).length>0)&&Ue(hs)})}var fs=b(Xa);{var Os=Ue=>{var X=Ot(),At=Ce(X);Ie(At,1,()=>e(A),tt,(gt,rt)=>{var Fe=Ot(),nn=Ce(Fe);{var gn=ht=>{var _t=Yd();G(()=>{p(_t,"x1",(e(rt),h(()=>e(rt).firstClearRay.from.x))),p(_t,"y1",(e(rt),h(()=>e(rt).firstClearRay.from.y))),p(_t,"x2",(e(rt),h(()=>e(rt).firstClearRay.to.x))),p(_t,"y2",(e(rt),h(()=>e(rt).firstClearRay.to.y)))}),k(ht,_t)},je=ht=>{var _t=Hd();G(()=>{p(_t,"x1",(e(rt),h(()=>e(rt).source.x))),p(_t,"y1",(e(rt),h(()=>e(rt).source.y))),p(_t,"x2",(e(rt),h(()=>e(rt).target.x))),p(_t,"y2",(e(rt),h(()=>e(rt).target.y)))}),k(ht,_t)};ie(nn,ht=>{e(rt),h(()=>e(rt).firstClearRay)?ht(gn):ht(je,!1)})}k(gt,Fe)}),k(Ue,X)};ie(fs,Ue=>{e(se),e(y),e(A),h(()=>e(se)&&e(y).length>0&&e(A).length>0)&&Ue(Os)})}var ys=b(fs);{var Ta=Ue=>{const X=We(()=>(e(ee),e(F),h(()=>Math.min(e(ee).x,e(F).x)))),At=We(()=>(e(ee),e(F),h(()=>Math.min(e(ee).y,e(F).y)))),gt=We(()=>(e(F),e(ee),h(()=>Math.abs(e(F).x-e(ee).x)))),rt=We(()=>(e(F),e(ee),h(()=>Math.abs(e(F).y-e(ee).y))));var Fe=Fd();G(()=>{p(Fe,"x",e(X)),p(Fe,"y",e(At)),p(Fe,"width",e(gt)),p(Fe,"height",e(rt))}),k(Ue,Fe)};ie(ys,Ue=>{e(q)&&e(ee)&&e(F)&&Ue(Ta)})}k(M,fe)}}});var Pn=b(bt,2),Kt=_(Pn),vn=_(Kt),Zt=b(yt,2);{var la=M=>{var Y=qd(),U=_(Y);Pm(U,{$$events:{deploy:Mt,clear:zt}}),k(M,Y)};ie(Zt,M=>{m(),h(()=>m().length>0)&&M(la)})}var _n=b(pn,2);wm(_n,{get unmatchedUnits(){return e(_e)},get show(){return e(me)},set show(M){v(me,M)},$$events:{import:ze,close:()=>{v(me,!1)}},$$legacy:!0}),G(()=>we(vn,`Battlefield: 60" x 44" | ${c(),h(()=>c().length)??""} P1 models | ${d(),h(()=>d().length)??""} P2 models`)),z("mousedown",bt,za),k(t,xn),Tn(),u()}var Gd=he('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">LoS Status</span> <span class="value svelte-hpuhtb"> </span></div>'),zd=he('<div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Debug Rays</label></div> <!>',1),Xd=he('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Selected</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Line of Sight</label></div> <!> <button class="danger svelte-hpuhtb"> </button></div>'),Vd=he('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Rotation</span> <span class="value svelte-hpuhtb"> </span></div>'),jd=he('<div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Debug Rays</label></div>'),Qd=he('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">LoS Status</span> <span class="value svelte-hpuhtb"> </span></div>'),Jd=he('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Base Type</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Player</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Position</span> <span class="value svelte-hpuhtb"> </span></div> <!> <div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-hpuhtb">Remove</button></div>'),Zd=he('<p class="hint svelte-hpuhtb">Click a model to select it</p>'),eh=he('<p class="hint svelte-hpuhtb">Click and drag on battlefield to draw a measurement line</p>'),th=he('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Length</span> <span class="value svelte-hpuhtb"> </span></div> <button class="danger svelte-hpuhtb">Remove Line</button>',1),nh=he('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Lines</span> <span class="value svelte-hpuhtb"> </span></div> <button class="secondary svelte-hpuhtb">Clear All Lines</button>',1),ah=he('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Line Tool Active (M)</label></div> <!> <!> <!></div>'),sh=he('<div class="button-group vertical svelte-hpuhtb"><div class="button-row svelte-hpuhtb"><button title="Undo (Ctrl+Z)" class="svelte-hpuhtb">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-hpuhtb">Redo</button></div></div>'),rh=xe('<path fill="none" stroke-width="0.15" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),ih=xe('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),oh=xe("<!><!>",1),lh=xe('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),ch=xe('<g opacity="0.5" pointer-events="none"><!></g>'),uh=xe('<circle r="0.4" fill="rgba(147, 51, 234, 0.5)" stroke="#9333ea" stroke-width="0.1" pointer-events="none"></circle><line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="group-rotate-handle"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),mh=xe('<circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle><circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle>',1),dh=xe('<g><line stroke-linecap="round"></line><!><g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g></g>'),hh=xe('<g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" fill="#f59e0b" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g>'),fh=xe('<g class="measurement-line drawing"><line stroke="#f59e0b" stroke-width="0.15" stroke-dasharray="0.3,0.15" stroke-linecap="round" pointer-events="none"></line><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><!></g>'),yh=xe('<line stroke-width="0.05" pointer-events="none"></line>'),ph=xe('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),vh=xe('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),gh=xe('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),bh=xe("<!><!><!><!><!><!><!><!><!><!><!>",1),Th=he('<main class="svelte-hpuhtb"><div class="layout svelte-hpuhtb"><div class="sidebar svelte-hpuhtb"><!> <!> <!></div> <div class="main-content svelte-hpuhtb"><div class="battlefield-area svelte-hpuhtb"><div class="battlefield-container svelte-hpuhtb" role="presentation"><!></div> <div class="info svelte-hpuhtb"><p class="svelte-hpuhtb"> </p> <p class="hint svelte-hpuhtb">Drag to select | Ctrl+Click multi-select | Del remove | L LoS | M measure</p></div></div></div></div></main>');function xh(t,n){bn(n,!1);const a=()=>pt(mt,"$models",c),r=()=>pt(yi,"$loadedTerrain",c),s=()=>pt(En,"$history",c),i=()=>pt(Oa,"$selectedDeployment",c),o=()=>pt(jo,"$player1Models",c),l=()=>pt(Qo,"$player2Models",c),[c,d]=cs(),m=N(),f=N(),u=N(),y=N(),g=N(),T=N(),x=N(),C=N(),D=N(),R=N(),w=N(),S=N();let E=N(null),W=N(!1),A=N(!1),P=N(!1),O=N(null),ne=N(null),B=N([]),ae=N(new Set),se=!1,j=!1,Z=null,oe=!1,me=null,_e=0,re=null,I=N([]),q=N(null),ee=N(!1),F=N(null),H=N(null),Me=N(!1);us(()=>{window.addEventListener("keydown",st)}),li(()=>{window.removeEventListener("keydown",st)});function st($){if($.target.tagName==="INPUT")return;const Q=e(B).length>0;if(($.ctrlKey||$.metaKey)&&$.key==="z"&&!$.shiftKey){$.preventDefault(),mt.undo();return}if(($.ctrlKey||$.metaKey)&&($.key==="y"||$.shiftKey&&$.key==="z")){$.preventDefault(),mt.redo();return}if($.key==="l"||$.key==="L"){$.preventDefault(),v(W,!e(W));return}if($.key==="m"||$.key==="M"){$.preventDefault(),v(Me,!e(Me)),e(Me)||(v(ee,!1),v(F,null),v(H,null));return}if($.key==="Delete"||$.key==="Backspace"){if($.preventDefault(),e(q)){v(I,e(I).filter(te=>te.id!==e(q))),v(q,null);return}e(B).length>0&&(e(B).forEach(te=>{mt.remove(te)}),v(B,[]));return}if(Q&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes($.key)){$.preventDefault();const te=$.shiftKey?.1:1;let ke=0,Le=0;switch($.key){case"ArrowUp":Le=-te;break;case"ArrowDown":Le=te;break;case"ArrowLeft":ke=-te;break;case"ArrowRight":ke=te;break}e(B).forEach(He=>{const Ne=a().find(Ve=>Ve.id===He);Ne&&mt.updateModel(He,{x:Ne.x+ke,y:Ne.y+Le},!1)});return}if($.key==="Escape"){J();return}}function J($){if(se){se=!1;return}v(B,[]),v(q,null)}function pe(){return"line-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Pe($,Q,te,ke){return Math.sqrt((te-$)**2+(ke-Q)**2)}function ve($){if(!e(E))return;$.preventDefault();const Q=e(E)($.clientX,$.clientY);v(ee,!0),v(F,{x:Q.x,y:Q.y}),v(H,{x:Q.x,y:Q.y}),window.addEventListener("mousemove",qt),window.addEventListener("mouseup",Rt)}function qt($){if(!e(ee)||!e(E))return;const Q=e(E)($.clientX,$.clientY);v(H,{x:Q.x,y:Q.y})}function Rt($){if(!e(ee))return;if(Pe(e(F).x,e(F).y,e(H).x,e(H).y)>.5){const te={id:pe(),x1:e(F).x,y1:e(F).y,x2:e(H).x,y2:e(H).y};v(I,[...e(I),te]),v(q,te.id),v(B,[])}v(ee,!1),v(F,null),v(H,null),window.removeEventListener("mousemove",qt),window.removeEventListener("mouseup",Rt)}function Qe($,Q){Q?.stopPropagation(),v(q,$),v(B,[])}let qe=!1,kt={x:0,y:0},lt=null,it=null;function V($,Q){if(!e(Me)||!e(E))return;Q.stopPropagation(),Q.preventDefault();const te=e(I).find(Ne=>Ne.id===$);if(!te)return;qe=!0,lt=$,it=null,v(q,$),v(B,[]);const ke=e(E)(Q.clientX,Q.clientY),Le=(te.x1+te.x2)/2,He=(te.y1+te.y2)/2;kt={x:ke.x-Le,y:ke.y-He},window.addEventListener("mousemove",Ke),window.addEventListener("mouseup",xt)}function De($,Q,te){!e(Me)||!e(E)||(te.stopPropagation(),te.preventDefault(),qe=!0,lt=$,it=Q,v(q,$),v(B,[]),window.addEventListener("mousemove",Ke),window.addEventListener("mouseup",xt))}function Ke($){if(!qe||!e(E)||!lt)return;const Q=e(E)($.clientX,$.clientY);v(I,e(I).map(te=>{if(te.id!==lt)return te;if(it===1)return{...te,x1:Q.x,y1:Q.y};if(it===2)return{...te,x2:Q.x,y2:Q.y};{const ke=Q.x-kt.x,Le=Q.y-kt.y,He=(te.x1+te.x2)/2,Ne=(te.y1+te.y2)/2,Ve=ke-He,at=Le-Ne;return{...te,x1:te.x1+Ve,y1:te.y1+at,x2:te.x2+Ve,y2:te.y2+at}}}))}function xt(){qe=!1,lt=null,it=null,window.removeEventListener("mousemove",Ke),window.removeEventListener("mouseup",xt)}function vt(){v(I,[]),v(q,null)}function $t($){const Q=$.target,te=Q.closest(".model-base"),ke=Q.closest(".measurement-line");if(te||ke||!e(E))return;if($.preventDefault(),e(Me)){ve($);return}const Le=e(E)($.clientX,$.clientY);v(O,{x:Le.x,y:Le.y}),v(ne,{x:Le.x,y:Le.y}),v(P,!0),window.addEventListener("mousemove",Gt),window.addEventListener("mouseup",sn)}function Gt($){if(!e(P)||!e(E))return;const Q=e(E)($.clientX,$.clientY);v(ne,{x:Q.x,y:Q.y});const te=Math.min(e(O).x,e(ne).x),ke=Math.max(e(O).x,e(ne).x),Le=Math.min(e(O).y,e(ne).y),He=Math.max(e(O).y,e(ne).y),Ne=new Set;a().forEach(Ve=>{Ve.x>=te&&Ve.x<=ke&&Ve.y>=Le&&Ve.y<=He&&Ne.add(Ve.id)}),v(ae,Ne)}function sn($){if(!e(P))return;const Q=Math.min(e(O).x,e(ne).x),te=Math.max(e(O).x,e(ne).x),ke=Math.min(e(O).y,e(ne).y),Le=Math.max(e(O).y,e(ne).y),He=te-Q,Ne=Le-ke;if(He<.5&&Ne<.5)v(B,[]);else{const Ve=[];a().forEach(at=>{at.x>=Q&&at.x<=te&&at.y>=ke&&at.y<=Le&&Ve.push(at.id)}),v(B,Ve),se=!0}v(P,!1),v(O,null),v(ne,null),e(ae).clear(),v(ae,e(ae)),window.removeEventListener("mousemove",Gt),window.removeEventListener("mouseup",sn)}function en($,Q){Q&&(Q.ctrlKey||Q.metaKey||Q.shiftKey)?e(B).includes($)?v(B,e(B).filter(te=>te!==$)):v(B,[...e(B),$]):e(B).includes($)&&e(B).length>1||v(B,[$])}function rn($,Q,te){if(e(B).length>1&&e(B).includes($)){j||(j=!0,Z={},e(B).forEach(Le=>{const He=a().find(Ne=>Ne.id===Le);He&&(Z[Le]={x:He.x,y:He.y})}));const ke=Z[$];if(ke){const Le=Q-ke.x,He=te-ke.y;e(B).forEach(Ne=>{const Ve=Z[Ne];Ve&&mt.updateModel(Ne,{x:Ve.x+Le,y:Ve.y+He},!0)})}}else mt.updateModel($,{x:Q,y:te},!0)}function Ye($,Q,te,ke,Le){j?(e(B).forEach(He=>{const Ne=Z[He],Ve=a().find(at=>at.id===He);Ne&&Ve&&En.push({type:"move",modelId:He,before:{x:Ne.x,y:Ne.y},after:{x:Ve.x,y:Ve.y}})}),j=!1,Z=null):En.push({type:"move",modelId:$,before:{x:Q,y:te},after:{x:ke,y:Le}})}function nt($,Q){if(e(B).length>1&&e(B).includes($)){if(!oe){oe=!0;let He=0,Ne=0,Ve=0;const at={};e(B).forEach(Jt=>{const Ft=a().find(Wt=>Wt.id===Jt);Ft&&(He+=Ft.x,Ne+=Ft.y,Ve++,at[Jt]={x:Ft.x,y:Ft.y,rotation:Ft.rotation||0})}),me={x:He/Ve,y:Ne/Ve},Z=at}const te=a().find(He=>He.id===$),ke=Z[$];if(!te||!ke)return;const Le=Q-ke.rotation;e(B).forEach(He=>{const Ne=Z[He];if(Ne){const Ve=Ne.x-me.x,at=Ne.y-me.y,Jt=Le*Math.PI/180,Ft=Math.cos(Jt),Wt=Math.sin(Jt),St=Ve*Ft-at*Wt,Xt=Ve*Wt+at*Ft;mt.updateModel(He,{x:me.x+St,y:me.y+Xt,rotation:Ne.rotation+Le},!0)}})}else mt.updateModel($,{rotation:Q},!0)}function ze($,Q,te){oe?(e(B).forEach(ke=>{const Le=Z[ke],He=a().find(Ne=>Ne.id===ke);Le&&He&&En.push({type:"rotate",modelId:ke,before:{x:Le.x,y:Le.y,rotation:Le.rotation},after:{x:He.x,y:He.y,rotation:He.rotation||0}})}),oe=!1,me=null,Z=null):En.push({type:"rotate",modelId:$,before:{rotation:Q},after:{rotation:te}})}function Mt($,Q){mt.updateModel($,{name:Q})}function zt($){if(!e(E)||e(m).length<2)return;$.preventDefault(),$.stopPropagation(),oe=!0,re={},e(m).forEach(te=>{re[te.id]={x:te.x,y:te.y,rotation:te.rotation||0}});const Q=e(E)($.clientX,$.clientY);_e=Math.atan2(Q.y-e(u).y,Q.x-e(u).x)*180/Math.PI,window.addEventListener("mousemove",Ze),window.addEventListener("mouseup",L)}function Ze($){if(!oe||!e(E)||!e(u))return;const Q=e(E)($.clientX,$.clientY);let ke=Math.atan2(Q.y-e(u).y,Q.x-e(u).x)*180/Math.PI-_e;$.shiftKey||(ke=Math.round(ke/15)*15),v(Ae,-45+ke);const Le=ke*Math.PI/180,He=Math.cos(Le),Ne=Math.sin(Le);e(m).forEach(Ve=>{const at=re[Ve.id];if(at){const Jt=at.x-e(u).x,Ft=at.y-e(u).y,Wt=Jt*He-Ft*Ne,St=Jt*Ne+Ft*He;mt.updateModel(Ve.id,{x:e(u).x+Wt,y:e(u).y+St,rotation:at.rotation+ke},!0)}})}function L(){oe&&re&&e(m).forEach($=>{const Q=re[$.id];Q&&En.push({type:"rotate",modelId:$.id,before:{x:Q.x,y:Q.y,rotation:Q.rotation},after:{x:$.x,y:$.y,rotation:$.rotation||0}})}),oe=!1,re=null,v(Ae,-45),window.removeEventListener("mousemove",Ze),window.removeEventListener("mouseup",L)}function ye(){e(B).length>0&&(e(B).forEach($=>{mt.remove($)}),v(B,[]))}function Se($){if(ks($.baseType))return{x:$.x,y:$.y,width:$.customWidth,height:$.customHeight,rotation:$.rotation||0,isRectangle:!0};const Q=ya($.baseType,$);return Vn($.baseType)?{x:$.x,y:$.y,rx:Q.width/2,ry:Q.height/2,rotation:$.rotation||0}:{x:$.x,y:$.y,radius:Q.radius}}let Ae=N(-45);ce(()=>(e(B),a()),()=>{v(m,e(B).map($=>a().find(Q=>Q.id===$)).filter(Boolean))}),ce(()=>e(m),()=>{v(f,e(m).length===1?e(m)[0]:null)}),ce(()=>e(m),()=>{v(u,e(m).length>1?(()=>{let $=0,Q=0;return e(m).forEach(te=>{$+=te.x,Q+=te.y}),{x:$/e(m).length,y:Q/e(m).length}})():null)}),ce(()=>(e(m),e(u),Vn),()=>{v(y,e(m).length>1?(()=>{let $=0;return e(m).forEach(Q=>{const te=Math.sqrt(Math.pow(Q.x-e(u).x,2)+Math.pow(Q.y-e(u).y,2)),ke=ya(Q.baseType,Q),Le=ks(Q.baseType)?Math.max(Q.customWidth,Q.customHeight)/2:Vn(Q.baseType)?Math.max(ke.width,ke.height)/2:ke.radius;$=Math.max($,te+Le)}),$+2})():0)}),ce(()=>(e(u),e(y),e(Ae)),()=>{v(g,e(u)?e(u).x+e(y)*Math.cos(e(Ae)*Math.PI/180):0)}),ce(()=>(e(u),e(y),e(Ae)),()=>{v(T,e(u)?e(u).y+e(y)*Math.sin(e(Ae)*Math.PI/180):0)}),ce(()=>(e(q),e(I)),()=>{v(x,e(q)?e(I).find($=>$.id===e(q)):null)}),ce(()=>e(m),()=>{v(C,[...new Set(e(m).map($=>$.playerId))])}),ce(()=>(e(m),a(),e(C)),()=>{v(D,e(m).length>0?a().filter($=>!e(C).includes($.playerId)):[])}),ce(()=>(r(),os),()=>{v(R,r().terrains.map($=>({id:$.id,vertices:os($)})))}),ce(()=>(r(),qa),()=>{v(w,r().walls.map($=>Mr(qa($.shape,$.segments),$.x,$.y,$.rotation)))}),ce(()=>(e(m),e(W),e(D),e(R),e(w)),()=>{v(S,e(m).length>0&&e(W)&&e(D).length>0?e(m).flatMap($=>e(D).map(Q=>{const te=ui(Se(Q),Se($),e(R),e(w));return{sourceId:Q.id,source:Q,targetId:$.id,target:$,canSee:te.canSee,firstClearRay:te.firstClearRay,rays:te.rays}})):[])}),ia(),kn();var Re=Th(),ct=_(Re),ut=_(ct),be=_(ut);an(be,{title:"Selected Model",children:($,Q)=>{var te=Ot(),ke=Ce(te);{var Le=Ne=>{var Ve=Xd(),at=_(Ve),Jt=b(_(at),2),Ft=_(Jt),Wt=b(at,2),St=_(Wt),Xt=_(St),Lt=b(Wt,2);{var on=Dt=>{var xn=zd(),pn=Ce(xn),Zn=_(pn),Xe=_(Zn),K=b(pn,2);{var dt=ot=>{var Oe=Gd(),$e=b(_(Oe),2),Ut=_($e);G(Vt=>we(Ut,`${Vt??""}/${e(S),h(()=>e(S).length)??""} visible`),[()=>(e(S),h(()=>e(S).filter(Vt=>Vt.canSee).length))]),k(ot,Oe)};ie(K,ot=>{e(S),h(()=>e(S).length>0)&&ot(dt)})}Xn(Xe,()=>e(A),ot=>v(A,ot)),k(Dt,xn)};ie(Lt,Dt=>{e(W)&&Dt(on)})}var un=b(Lt,2),dn=_(un);G(()=>{we(Ft,`${e(B),h(()=>e(B).length)??""} models`),we(dn,`Remove All (${e(B),h(()=>e(B).length)??""})`)}),Xn(Xt,()=>e(W),Dt=>v(W,Dt)),z("click",un,ye),k(Ne,Ve)},He=Ne=>{var Ve=Ot(),at=Ce(Ve);{var Jt=Wt=>{var St=Jd(),Xt=_(St),Lt=b(_(Xt),2),on=b(Xt,2),un=b(_(on),2),dn=_(un),Dt=b(on,2),xn=b(_(Dt),2),pn=_(xn),Zn=b(Dt,2),Xe=b(_(Zn),2),K=_(Xe),dt=b(Zn,2);{var ot=Kt=>{var vn=Vd(),Zt=b(_(vn),2),la=_(Zt);G(_n=>we(la,`${_n??""}Â°`),[()=>(e(f),h(()=>Math.round(e(f).rotation||0)))]),k(Kt,vn)};ie(dt,Kt=>{le(Vn),e(f),h(()=>Vn(e(f).baseType))&&Kt(ot)})}var Oe=b(dt,2),$e=_(Oe),Ut=_($e),Vt=b(Oe,2);{var yt=Kt=>{var vn=jd(),Zt=_(vn),la=_(Zt);Xn(la,()=>e(A),_n=>v(A,_n)),k(Kt,vn)};ie(Vt,Kt=>{e(W)&&Kt(yt)})}var bt=b(Vt,2);{var Nt=Kt=>{var vn=Qd(),Zt=b(_(vn),2),la=_(Zt);G(_n=>we(la,`${_n??""}/${e(S),h(()=>e(S).length)??""} visible`),[()=>(e(S),h(()=>e(S).filter(_n=>_n.canSee).length))]),k(Kt,vn)};ie(bt,Kt=>{e(W),e(S),h(()=>e(W)&&e(S).length>0)&&Kt(Nt)})}var Pn=b(bt,2);G((Kt,vn,Zt)=>{Po(Lt,(e(f),h(()=>e(f).name||""))),we(dn,Kt),we(pn,`Player ${e(f),h(()=>e(f).playerId)??""}`),we(K,`${vn??""}", ${Zt??""}"`)},[()=>(le(ya),e(f),h(()=>ya(e(f).baseType,e(f))?.label||"Unknown")),()=>(e(f),h(()=>e(f).x.toFixed(1))),()=>(e(f),h(()=>e(f).y.toFixed(1)))]),z("change",Lt,Kt=>Mt(e(f).id,Kt.target.value)),Xn(Ut,()=>e(W),Kt=>v(W,Kt)),z("click",Pn,ye),k(Wt,St)},Ft=Wt=>{var St=Zd();k(Wt,St)};ie(at,Wt=>{e(f)?Wt(Jt):Wt(Ft,!1)},!0)}k(Ne,Ve)};ie(ke,Ne=>{e(B),h(()=>e(B).length>1)?Ne(Le):Ne(He,!1)})}k($,te)},$$slots:{default:!0}});var Ge=b(be,2);an(Ge,{title:"Measure Tool",children:($,Q)=>{var te=ah(),ke=_(te),Le=_(ke),He=_(Le),Ne=b(ke,2);{var Ve=St=>{var Xt=eh();k(St,Xt)};ie(Ne,St=>{e(Me)&&St(Ve)})}var at=b(Ne,2);{var Jt=St=>{var Xt=th(),Lt=Ce(Xt),on=b(_(Lt),2),un=_(on),dn=b(Lt,2);G(Dt=>we(un,`${Dt??""}"`),[()=>(e(x),h(()=>Pe(e(x).x1,e(x).y1,e(x).x2,e(x).y2).toFixed(2)))]),z("click",dn,()=>{v(I,e(I).filter(Dt=>Dt.id!==e(q))),v(q,null)}),k(St,Xt)};ie(at,St=>{e(x)&&St(Jt)})}var Ft=b(at,2);{var Wt=St=>{var Xt=nh(),Lt=Ce(Xt),on=b(_(Lt),2),un=_(on),dn=b(Lt,2);G(()=>we(un,`${e(I),h(()=>e(I).length)??""} line${e(I),h(()=>e(I).length!==1?"s":"")??""}`)),z("click",dn,vt),k(St,Xt)};ie(Ft,St=>{e(I),h(()=>e(I).length>0)&&St(Wt)})}Xn(He,()=>e(Me),St=>v(Me,St)),k($,te)},$$slots:{default:!0}});var Pt=b(Ge,2);an(Pt,{title:"Actions",children:($,Q)=>{var te=sh(),ke=_(te),Le=_(ke),He=b(Le,2);G(()=>{Le.disabled=(s(),h(()=>!s().past.length)),He.disabled=(s(),h(()=>!s().future.length))}),z("click",Le,()=>mt.undo()),z("click",He,()=>mt.redo()),k($,te)},$$slots:{default:!0}});var Bn=b(ut,2),tn=_(Bn),$n=_(tn),Jn=_($n);tr(Jn,{children:wr,$$slots:{default:($,Q)=>{const te=We(()=>Q.screenToSvg);var ke=bh(),Le=Ce(ke);{var He=Xe=>{var K=ii();G(()=>we(K,(e(E),le(e(te)),h(()=>(v(E,e(te)),""))))),k(Xe,K)};ie(Le,Xe=>{e(te)&&!e(E)&&Xe(He)})}var Ne=b(Le);{var Ve=Xe=>{var K=oh(),dt=Ce(K);Ie(dt,1,()=>(i(),h(()=>i().zones)),tt,(Oe,$e)=>{var Ut=rh();G(Vt=>{p(Ut,"d",Vt),p(Ut,"stroke",(e($e),h(()=>e($e).borderColor)))},[()=>(le(Vs),e($e),h(()=>Vs(e($e).path)))]),k(Oe,Ut)});var ot=b(dt);Ie(ot,1,()=>(i(),h(()=>i().objectives)),tt,(Oe,$e)=>{const Ut=We(()=>(e($e),h(()=>e($e).isPrimary?"#fbbf24":"#9ca3af"))),Vt=We(()=>(e($e),h(()=>e($e).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var yt=ih(),bt=Ce(yt),Nt=b(bt),Pn=b(Nt);G(()=>{p(bt,"cx",(e($e),h(()=>e($e).x))),p(bt,"cy",(e($e),h(()=>e($e).y))),p(bt,"r",fi),p(bt,"fill",e(Vt)),p(bt,"stroke",e(Ut)),p(Nt,"cx",(e($e),h(()=>e($e).x))),p(Nt,"cy",(e($e),h(()=>e($e).y))),p(Nt,"r",hi),p(Nt,"fill",e(Ut)),p(Pn,"cx",(e($e),h(()=>e($e).x))),p(Pn,"cy",(e($e),h(()=>e($e).y)))}),k(Oe,yt)}),k(Xe,K)};ie(Ne,Xe=>{i()&&Xe(Ve)})}var at=b(Ne);Ie(at,1,()=>(r(),h(()=>r().terrains)),tt,(Xe,K)=>{var dt=lh(),ot=_(dt);G(()=>{p(dt,"transform",`rotate(${e(K),h(()=>e(K).rotation)??""}, ${e(K),h(()=>e(K).x+e(K).width/2)??""}, ${e(K),h(()=>e(K).y+e(K).height/2)??""})`),p(ot,"x",(e(K),h(()=>e(K).x))),p(ot,"y",(e(K),h(()=>e(K).y))),p(ot,"width",(e(K),h(()=>e(K).width))),p(ot,"height",(e(K),h(()=>e(K).height)))}),k(Xe,dt)});var Jt=b(at);Ie(Jt,1,()=>(r(),h(()=>r().walls)),tt,(Xe,K)=>{var dt=ch(),ot=_(dt);Er(ot,{get id(){return e(K),h(()=>e(K).id)},get x(){return e(K),h(()=>e(K).x)},get y(){return e(K),h(()=>e(K).y)},get shape(){return e(K),h(()=>e(K).shape)},get segments(){return e(K),h(()=>e(K).segments)},get rotation(){return e(K),h(()=>e(K).rotation)},selected:!1,get screenToSvg(){return e(te)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),k(Xe,dt)});var Ft=b(Jt);Ie(Ft,1,a,Xe=>Xe.id,(Xe,K)=>{{let dt=We(()=>(e(K),h(()=>e(K).name||""))),ot=We(()=>(e(B),e(K),h(()=>e(B).includes(e(K).id)))),Oe=We(()=>(e(B),e(K),e(ae),h(()=>!e(B).includes(e(K).id)&&e(ae).has(e(K).id))));Ls(Xe,{get id(){return e(K),h(()=>e(K).id)},get x(){return e(K),h(()=>e(K).x)},get y(){return e(K),h(()=>e(K).y)},get baseType(){return e(K),h(()=>e(K).baseType)},get playerId(){return e(K),h(()=>e(K).playerId)},get rotation(){return e(K),h(()=>e(K).rotation)},get name(){return e(dt)},get customWidth(){return e(K),h(()=>e(K).customWidth)},get customHeight(){return e(K),h(()=>e(K).customHeight)},get selected(){return e(ot)},get marqueePreview(){return e(Oe)},get screenToSvg(){return e(te)},onSelect:en,onDrag:rn,onDragEnd:Ye,onRotate:nt,onRotateEnd:ze,onRename:Mt})}});var Wt=b(Ft);{var St=Xe=>{var K=uh(),dt=Ce(K),ot=b(dt),Oe=b(ot),$e=b(Oe);G(()=>{p(dt,"cx",(e(u),h(()=>e(u).x))),p(dt,"cy",(e(u),h(()=>e(u).y))),p(ot,"x1",(e(u),h(()=>e(u).x))),p(ot,"y1",(e(u),h(()=>e(u).y))),p(ot,"x2",e(g)),p(ot,"y2",e(T)),p(Oe,"cx",e(g)),p(Oe,"cy",e(T)),p($e,"transform",`translate(${e(g)??""}, ${e(T)??""})`)}),z("mousedown",Oe,zt),k(Xe,K)};ie(Wt,Xe=>{e(u),e(m),h(()=>e(u)&&e(m).length>1)&&Xe(St)})}var Xt=b(Wt);Ie(Xt,1,()=>e(I),Xe=>Xe.id,(Xe,K)=>{const dt=We(()=>(e(K),h(()=>Pe(e(K).x1,e(K).y1,e(K).x2,e(K).y2)))),ot=We(()=>(e(K),h(()=>(e(K).x1+e(K).x2)/2))),Oe=We(()=>(e(K),h(()=>(e(K).y1+e(K).y2)/2))),$e=We(()=>(e(K),e(q),h(()=>e(K).id===e(q))));var Ut=dh();let Vt;var yt=_(Ut),bt=b(yt);{var Nt=Zt=>{var la=mh(),_n=Ce(la),M=b(_n);G(()=>{p(_n,"cx",(e(K),h(()=>e(K).x1))),p(_n,"cy",(e(K),h(()=>e(K).y1))),p(_n,"fill",e($e)?"#3b82f6":"#f59e0b"),p(M,"cx",(e(K),h(()=>e(K).x2))),p(M,"cy",(e(K),h(()=>e(K).y2))),p(M,"fill",e($e)?"#3b82f6":"#f59e0b")}),z("mousedown",_n,Y=>De(e(K).id,1,Y)),z("mousedown",M,Y=>De(e(K).id,2,Y)),k(Zt,la)};ie(bt,Zt=>{e(Me)&&Zt(Nt)})}var Pn=b(bt),Kt=b(_(Pn)),vn=_(Kt);G(Zt=>{Vt=mn(Ut,0,"measurement-line",null,Vt,{selected:e($e),"tool-active":e(Me)}),p(yt,"x1",(e(K),h(()=>e(K).x1))),p(yt,"y1",(e(K),h(()=>e(K).y1))),p(yt,"x2",(e(K),h(()=>e(K).x2))),p(yt,"y2",(e(K),h(()=>e(K).y2))),p(yt,"stroke",e($e)&&e(Me)?"#3b82f6":"#f59e0b"),p(yt,"stroke-width",e($e)&&e(Me)?.2:.15),p(yt,"role",e(Me)?"button":"presentation"),p(yt,"tabindex",e(Me)?0:-1),p(Pn,"transform",`translate(${e(ot)??""}, ${e(Oe)??""})`),p(Kt,"fill",e($e)&&e(Me)?"#3b82f6":"#f59e0b"),we(vn,`${Zt??""}"`)},[()=>(le(e(dt)),h(()=>e(dt).toFixed(1)))]),z("click",yt,Zt=>e(Me)&&Qe(e(K).id,Zt)),z("mousedown",yt,Zt=>e(Me)?V(e(K).id,Zt):Zt.stopPropagation()),k(Xe,Ut)});var Lt=b(Xt);{var on=Xe=>{const K=We(()=>(e(F),e(H),h(()=>Pe(e(F).x,e(F).y,e(H).x,e(H).y)))),dt=We(()=>(e(F),e(H),h(()=>(e(F).x+e(H).x)/2))),ot=We(()=>(e(F),e(H),h(()=>(e(F).y+e(H).y)/2)));var Oe=fh(),$e=_(Oe),Ut=b($e),Vt=b(Ut),yt=b(Vt);{var bt=Nt=>{var Pn=hh(),Kt=b(_(Pn)),vn=_(Kt);G(Zt=>{p(Pn,"transform",`translate(${e(dt)??""}, ${e(ot)??""})`),we(vn,`${Zt??""}"`)},[()=>(le(e(K)),h(()=>e(K).toFixed(1)))]),k(Nt,Pn)};ie(yt,Nt=>{e(K)>.5&&Nt(bt)})}G(()=>{p($e,"x1",(e(F),h(()=>e(F).x))),p($e,"y1",(e(F),h(()=>e(F).y))),p($e,"x2",(e(H),h(()=>e(H).x))),p($e,"y2",(e(H),h(()=>e(H).y))),p(Ut,"cx",(e(F),h(()=>e(F).x))),p(Ut,"cy",(e(F),h(()=>e(F).y))),p(Vt,"cx",(e(H),h(()=>e(H).x))),p(Vt,"cy",(e(H),h(()=>e(H).y)))}),k(Xe,Oe)};ie(Lt,Xe=>{e(ee)&&e(F)&&e(H)&&Xe(on)})}var un=b(Lt);{var dn=Xe=>{var K=Ot(),dt=Ce(K);Ie(dt,1,()=>e(S),tt,(ot,Oe)=>{var $e=Ot(),Ut=Ce($e);Ie(Ut,1,()=>(e(Oe),h(()=>e(Oe).rays)),tt,(Vt,yt)=>{var bt=yh();G(()=>{p(bt,"x1",(e(yt),h(()=>e(yt).from.x))),p(bt,"y1",(e(yt),h(()=>e(yt).from.y))),p(bt,"x2",(e(yt),h(()=>e(yt).to.x))),p(bt,"y2",(e(yt),h(()=>e(yt).to.y))),p(bt,"stroke",(e(yt),h(()=>e(yt).blocked?"#ff000033":"#00ff0033")))}),k(Vt,bt)}),k(ot,$e)}),k(Xe,K)};ie(un,Xe=>{e(A),e(W),e(m),e(S),h(()=>e(A)&&e(W)&&e(m).length>0&&e(S).length>0)&&Xe(dn)})}var Dt=b(un);{var xn=Xe=>{var K=Ot(),dt=Ce(K);Ie(dt,1,()=>e(S),tt,(ot,Oe)=>{var $e=Ot(),Ut=Ce($e);{var Vt=bt=>{var Nt=ph();G(()=>{p(Nt,"x1",(e(Oe),h(()=>e(Oe).firstClearRay.from.x))),p(Nt,"y1",(e(Oe),h(()=>e(Oe).firstClearRay.from.y))),p(Nt,"x2",(e(Oe),h(()=>e(Oe).firstClearRay.to.x))),p(Nt,"y2",(e(Oe),h(()=>e(Oe).firstClearRay.to.y)))}),k(bt,Nt)},yt=bt=>{var Nt=vh();G(()=>{p(Nt,"x1",(e(Oe),h(()=>e(Oe).source.x))),p(Nt,"y1",(e(Oe),h(()=>e(Oe).source.y))),p(Nt,"x2",(e(Oe),h(()=>e(Oe).target.x))),p(Nt,"y2",(e(Oe),h(()=>e(Oe).target.y)))}),k(bt,Nt)};ie(Ut,bt=>{e(Oe),h(()=>e(Oe).firstClearRay)?bt(Vt):bt(yt,!1)})}k(ot,$e)}),k(Xe,K)};ie(Dt,Xe=>{e(W),e(m),e(S),h(()=>e(W)&&e(m).length>0&&e(S).length>0)&&Xe(xn)})}var pn=b(Dt);{var Zn=Xe=>{const K=We(()=>(e(O),e(ne),h(()=>Math.min(e(O).x,e(ne).x)))),dt=We(()=>(e(O),e(ne),h(()=>Math.min(e(O).y,e(ne).y)))),ot=We(()=>(e(ne),e(O),h(()=>Math.abs(e(ne).x-e(O).x)))),Oe=We(()=>(e(ne),e(O),h(()=>Math.abs(e(ne).y-e(O).y))));var $e=gh();G(()=>{p($e,"x",e(K)),p($e,"y",e(dt)),p($e,"width",e(ot)),p($e,"height",e(Oe))}),k(Xe,$e)};ie(pn,Xe=>{e(P)&&e(O)&&e(ne)&&Xe(Zn)})}k($,ke)}}});var oa=b($n,2),Ga=_(oa),za=_(Ga);G(()=>we(za,`Battlefield: 60" x 44" | ${o(),h(()=>o().length)??""} P1 models | ${l(),h(()=>l().length)??""} P2 models`)),z("mousedown",$n,$t),k(t,Re),Tn(),d()}var _h=he("<span> </span>"),wh=he('<span class="los-status svelte-12aohay">No enemies</span>'),Sh=he('<div class="controls svelte-12aohay"><label class="svelte-12aohay"><input type="checkbox" class="svelte-12aohay"/> Show debug rays</label> <!></div>'),Ah=he('<button class="svelte-12aohay"> </button>'),Ch=he('<div class="button-group svelte-12aohay"></div>'),Mh=he('<button class="svelte-12aohay"> </button>'),Eh=he('<div class="button-group svelte-12aohay"></div>'),Rh=he('<div class="player-toggle svelte-12aohay"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-12aohay"><div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Circles</h4> <div class="palette-grid svelte-12aohay"></div></div> <div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Ovals</h4> <div class="palette-grid svelte-12aohay"></div></div></div>',1),kh=xe('<line stroke-width="0.05"></line>'),Lh=xe('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),Dh=xe('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),Ih=xe("<!><!><!><!><!><!><!>",1),$h=he('<p class="svelte-12aohay"> </p>'),Ph=he('<main class="svelte-12aohay"><div class="layout svelte-12aohay"><div class="sidebar svelte-12aohay"><!> <!> <!> <!></div> <div class="battlefield-area svelte-12aohay"><div class="battlefield-container svelte-12aohay"><!></div> <div class="info svelte-12aohay"><p class="svelte-12aohay"> </p> <!> <p class="hint svelte-12aohay">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function Nh(t,n){bn(n,!1);const a=()=>pt(Pa,"$debugModels",d),r=()=>pt(ja,"$debugSelectedModelId",d),s=()=>pt(or,"$debugTerrains",d),i=()=>pt(lr,"$debugWalls",d),o=()=>pt(Pi,"$debugMode",d),l=()=>pt(cr,"$debugSelectedTerrainId",d),c=()=>pt(ur,"$debugSelectedWallId",d),[d,m]=cs(),f=N(),u=N(),y=N(),g=N(),T=N();function x(V,De){or.add(V,De)}function C(V){lr.add(V)}function D(V){cr.set(V),ur.set(null),ja.set(null)}function R(V){ur.set(V),cr.set(null),ja.set(null)}function w(V,De,Ke){or.updateTerrain(V,{x:De,y:Ke})}function S(V,De,Ke){lr.updateWall(V,{x:De,y:Ke})}function E(V,De){or.updateTerrain(V,{rotation:De})}function W(V,De){lr.updateWall(V,{rotation:De})}let A=N(1),P=N(null),O=!1,ne=null,B=N(null);const ae=5;us(()=>{if(a().length===0){const V=Pa.add("32mm",1,10,22);Pa.add("32mm",2,50,22),ja.set(V)}});function se(V,De){if(!e(B))return;O=!0,ne={x:De.clientX,y:De.clientY};const Ke=e(B)(De.clientX,De.clientY);v(P,{baseType:V.type,x:Ke.x,y:Ke.y}),window.addEventListener("mousemove",j),window.addEventListener("mouseup",Z)}function j(V){if(!O||!e(P)||!e(B))return;const De=e(B)(V.clientX,V.clientY);v(P,{...e(P),x:De.x,y:De.y})}function Z(V){if(!O||!e(P)){O=!1,v(P,null),ne=null,window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",Z);return}const De=V.clientX-ne.x,Ke=V.clientY-ne.y,xt=Math.sqrt(De*De+Ke*Ke);let vt,$t;xt<ae?(vt=30,$t=22):(vt=e(P).x,$t=e(P).y);const Gt=Pa.add(e(P).baseType,e(A),vt,$t);ja.set(Gt),v(P,null),O=!1,ne=null,window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",Z)}function oe(V){ja.set(V),cr.set(null),ur.set(null)}function me(V,De,Ke){Pa.updateModel(V,{x:De,y:Ke},!0)}function _e(V,De,Ke,xt,vt){Gr.push({type:"move",modelId:V,before:{x:De,y:Ke},after:{x:xt,y:vt}})}function re(V,De){Pa.updateModel(V,{rotation:De},!0)}function I(V,De,Ke){Gr.push({type:"rotate",modelId:V,before:{rotation:De},after:{rotation:Ke}})}function q(V,De){Pa.updateModel(V,{name:De})}function ee(V){const De=ya(V.baseType);return Vn(V.baseType)?{x:V.x,y:V.y,rx:De.width/2,ry:De.height/2,rotation:V.rotation||0}:{x:V.x,y:V.y,radius:De.radius}}ce(()=>(a(),r()),()=>{v(f,a().find(V=>V.id===r()))}),ce(()=>(e(f),a()),()=>{v(u,e(f)?a().filter(V=>V.playerId!==e(f).playerId):[])}),ce(()=>(s(),os),()=>{v(y,s().map(V=>({id:V.id,vertices:os(V)})))}),ce(()=>(i(),qa),()=>{v(g,i().map(V=>Mr(qa(V.shape,V.segments),V.x,V.y,V.rotation)))}),ce(()=>(e(f),e(u),e(y),e(g)),()=>{v(T,e(f)&&e(u).length>0?e(u).map(V=>{const De=ui(ee(V),ee(e(f)),e(y),e(g));return{viewerId:V.id,viewer:V,canSee:De.canSee,firstClearRay:De.firstClearRay,rays:De.rays}}):[])}),ia(),kn();var F=Ph(),H=_(F),Me=_(H),st=_(Me);an(st,{title:"LOS Debug",children:(V,De)=>{var Ke=Sh(),xt=_(Ke),vt=_(xt),$t=b(xt,2);{var Gt=en=>{var rn=_h();let Ye;var nt=_(rn);G((ze,Mt)=>{Ye=mn(rn,1,"los-status svelte-12aohay",null,Ye,ze),we(nt,`${Mt??""}/${e(T),h(()=>e(T).length)??""} visible`)},[()=>({"can-see":e(T).some(ze=>ze.canSee),blocked:!e(T).some(ze=>ze.canSee)}),()=>(e(T),h(()=>e(T).filter(ze=>ze.canSee).length))]),k(en,rn)},sn=en=>{var rn=wh();k(en,rn)};ie($t,en=>{e(f),e(T),h(()=>e(f)&&e(T).length>0)?en(Gt):en(sn,!1)})}Xn(vt,o,en=>Rc(Pi,en)),k(V,Ke)},$$slots:{default:!0}});var J=b(st,2);an(J,{title:"Add Terrain",defaultOpen:!1,children:(V,De)=>{var Ke=Ch();Ie(Ke,5,()=>Bo,tt,(xt,vt)=>{var $t=Ah(),Gt=_($t);G(()=>we(Gt,(e(vt),h(()=>e(vt).label)))),z("click",$t,()=>x(e(vt).width,e(vt).height)),k(xt,$t)}),k(V,Ke)},$$slots:{default:!0}});var pe=b(J,2);an(pe,{title:"Add Wall",defaultOpen:!1,children:(V,De)=>{var Ke=Eh();Ie(Ke,5,()=>Ur,tt,(xt,vt)=>{var $t=Mh(),Gt=_($t);G(()=>we(Gt,(e(vt),h(()=>e(vt).label)))),z("click",$t,()=>C(e(vt).shape)),k(xt,$t)}),k(V,Ke)},$$slots:{default:!0}});var Pe=b(pe,2);an(Pe,{title:"Add Models",defaultOpen:!1,children:(V,De)=>{var Ke=Rh(),xt=Ce(Ke),vt=_(xt);let $t;var Gt=b(vt,2);let sn;var en=b(xt,2),rn=_(en),Ye=b(_(rn),2);Ie(Ye,5,()=>(le(Yn),h(()=>Yn.circles)),tt,(Mt,zt)=>{xr(Mt,{get baseSize(){return e(zt)},get playerId(){return e(A)},onDragStart:se})});var nt=b(rn,2),ze=b(_(nt),2);Ie(ze,5,()=>(le(Yn),h(()=>Yn.ovals)),tt,(Mt,zt)=>{xr(Mt,{get baseSize(){return e(zt)},get playerId(){return e(A)},onDragStart:se})}),G(()=>{$t=mn(vt,1,"toggle-btn svelte-12aohay",null,$t,{active:e(A)===1}),sn=mn(Gt,1,"toggle-btn svelte-12aohay",null,sn,{active:e(A)===2})}),z("click",vt,()=>v(A,1)),z("click",Gt,()=>v(A,2)),k(V,Ke)},$$slots:{default:!0}});var ve=b(Me,2),qt=_(ve),Rt=_(qt);tr(Rt,{children:wr,$$slots:{default:(V,De)=>{const Ke=We(()=>De.screenToSvg);var xt=Ih(),vt=Ce(xt);{var $t=Ze=>{var L=ii();G(()=>we(L,(e(B),le(e(Ke)),h(()=>(v(B,e(Ke)),""))))),k(Ze,L)};ie(vt,Ze=>{e(Ke)&&!e(B)&&Ze($t)})}var Gt=b(vt);{var sn=Ze=>{var L=Ot(),ye=Ce(L);Ie(ye,1,()=>e(T),tt,(Se,Ae)=>{var Re=Ot(),ct=Ce(Re);Ie(ct,1,()=>(e(Ae),h(()=>e(Ae).rays)),tt,(ut,be)=>{var Ge=kh();G(()=>{p(Ge,"x1",(e(be),h(()=>e(be).from.x))),p(Ge,"y1",(e(be),h(()=>e(be).from.y))),p(Ge,"x2",(e(be),h(()=>e(be).to.x))),p(Ge,"y2",(e(be),h(()=>e(be).to.y))),p(Ge,"stroke",(e(be),h(()=>e(be).blocked?"#ff000033":"#00ff0033")))}),k(ut,Ge)}),k(Se,Re)}),k(Ze,L)};ie(Gt,Ze=>{o(),e(f),e(T),h(()=>o()&&e(f)&&e(T).length>0)&&Ze(sn)})}var en=b(Gt);Ie(en,1,s,Ze=>Ze.id,(Ze,L)=>{{let ye=We(()=>(e(L),l(),h(()=>e(L).id===l())));Ho(Ze,{get id(){return e(L),h(()=>e(L).id)},get x(){return e(L),h(()=>e(L).x)},get y(){return e(L),h(()=>e(L).y)},get width(){return e(L),h(()=>e(L).width)},get height(){return e(L),h(()=>e(L).height)},get rotation(){return e(L),h(()=>e(L).rotation)},get selected(){return e(ye)},get screenToSvg(){return e(Ke)},onSelect:D,onDrag:w,onRotate:E})}});var rn=b(en);Ie(rn,1,i,Ze=>Ze.id,(Ze,L)=>{{let ye=We(()=>(e(L),c(),h(()=>e(L).id===c())));Er(Ze,{get id(){return e(L),h(()=>e(L).id)},get x(){return e(L),h(()=>e(L).x)},get y(){return e(L),h(()=>e(L).y)},get shape(){return e(L),h(()=>e(L).shape)},get segments(){return e(L),h(()=>e(L).segments)},get rotation(){return e(L),h(()=>e(L).rotation)},get selected(){return e(ye)},get screenToSvg(){return e(Ke)},onSelect:R,onDrag:S,onRotate:W})}});var Ye=b(rn);Ie(Ye,1,a,Ze=>Ze.id,(Ze,L)=>{{let ye=We(()=>(e(L),h(()=>e(L).name||""))),Se=We(()=>(e(L),r(),h(()=>e(L).id===r())));Ls(Ze,{get id(){return e(L),h(()=>e(L).id)},get x(){return e(L),h(()=>e(L).x)},get y(){return e(L),h(()=>e(L).y)},get baseType(){return e(L),h(()=>e(L).baseType)},get playerId(){return e(L),h(()=>e(L).playerId)},get rotation(){return e(L),h(()=>e(L).rotation)},get name(){return e(ye)},get selected(){return e(Se)},get screenToSvg(){return e(Ke)},onSelect:oe,onDrag:me,onDragEnd:_e,onRotate:re,onRotateEnd:I,onRename:q})}});var nt=b(Ye);{var ze=Ze=>{var L=Ot(),ye=Ce(L);Ie(ye,1,()=>e(T),tt,(Se,Ae)=>{var Re=Ot(),ct=Ce(Re);{var ut=Ge=>{var Pt=Lh();G(()=>{p(Pt,"x1",(e(Ae),h(()=>e(Ae).firstClearRay.from.x))),p(Pt,"y1",(e(Ae),h(()=>e(Ae).firstClearRay.from.y))),p(Pt,"x2",(e(Ae),h(()=>e(Ae).firstClearRay.to.x))),p(Pt,"y2",(e(Ae),h(()=>e(Ae).firstClearRay.to.y)))}),k(Ge,Pt)},be=Ge=>{var Pt=Dh();G(()=>{p(Pt,"x1",(e(f),h(()=>e(f).x))),p(Pt,"y1",(e(f),h(()=>e(f).y))),p(Pt,"x2",(e(Ae),h(()=>e(Ae).target.x))),p(Pt,"y2",(e(Ae),h(()=>e(Ae).target.y)))}),k(Ge,Pt)};ie(ct,Ge=>{e(Ae),h(()=>e(Ae).firstClearRay)?Ge(ut):Ge(be,!1)})}k(Se,Re)}),k(Ze,L)};ie(nt,Ze=>{o(),e(f),e(T),h(()=>o()&&e(f)&&e(T).length>0)&&Ze(ze)})}var Mt=b(nt);{var zt=Ze=>{Ls(Ze,{id:"phantom",get x(){return e(P),h(()=>e(P).x)},get y(){return e(P),h(()=>e(P).y)},get baseType(){return e(P),h(()=>e(P).baseType)},get playerId(){return e(A)},rotation:0,selected:!1,get screenToSvg(){return e(Ke)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};ie(Mt,Ze=>{e(P)&&Ze(zt)})}k(V,xt)}}});var Qe=b(qt,2),qe=_(Qe),kt=_(qe),lt=b(qe,2);{var it=V=>{var De=$h(),Ke=_(De);G(xt=>we(Ke,`Selected model LOS: ${xt??""}/${e(T),h(()=>e(T).length)??""} visible`),[()=>(e(T),h(()=>e(T).filter(xt=>xt.canSee).length))]),k(V,De)};ie(lt,V=>{o(),e(f),e(T),h(()=>o()&&e(f)&&e(T).length>0)&&V(it)})}G(()=>we(kt,`Battlefield: 60" x 44" | ${s(),h(()=>s().length)??""} terrain | ${i(),h(()=>i().length)??""} walls | ${a(),h(()=>a().length)??""} models`)),k(t,F),Tn(),m()}var Oh=he(`<div class="app-header svelte-1n46o8q"><h1 class="app-title svelte-1n46o8q">Fu'llasso</h1> <nav class="nav-links svelte-1n46o8q"><a href="#/setup">Battlefield Setup</a> <a href="#/deployment">Deployment</a> <a href="#/battle">Battle</a> <a href="#/">Layout Builder</a> <a href="#/debug">Debug</a></nav></div> <!> <footer class="app-footer svelte-1n46o8q"><span>Built with love by @Volfied</span> <span class="separator svelte-1n46o8q">|</span> <span class="disclaimer svelte-1n46o8q">Warhammer 40,000 and all associated marks, logos, and images are trademarks and/or copyrights of Games Workshop Ltd. This is an unofficial fan project and is not affiliated with or endorsed by Games Workshop.</span></footer>`,1);function Wh(t,n){bn(n,!1);let a=N("main");function r(){const w=window.location.hash;w==="#/debug"?v(a,"debug"):w==="#/setup"?v(a,"setup"):w==="#/deployment"?v(a,"deployment"):w==="#/battle"?v(a,"battle"):w==="#/"||w==="#/layout"?v(a,"main"):v(a,"setup")}us(()=>(r(),window.addEventListener("hashchange",r),()=>window.removeEventListener("hashchange",r))),kn();var s=Oh(),i=Ce(s),o=b(_(i),2),l=_(o);let c;var d=b(l,2);let m;var f=b(d,2);let u;var y=b(f,2);let g;var T=b(y,2);let x;var C=b(i,2);{var D=w=>{Nh(w,{})},R=w=>{var S=Ot(),E=Ce(S);{var W=P=>{em(P,{})},A=P=>{var O=Ot(),ne=Ce(O);{var B=se=>{Kd(se,{})},ae=se=>{var j=Ot(),Z=Ce(j);{var oe=_e=>{xh(_e,{})},me=_e=>{Iu(_e,{})};ie(Z,_e=>{e(a)==="battle"?_e(oe):_e(me,!1)},!0)}k(se,j)};ie(ne,se=>{e(a)==="deployment"?se(B):se(ae,!1)},!0)}k(P,O)};ie(E,P=>{e(a)==="setup"?P(W):P(A,!1)},!0)}k(w,S)};ie(C,w=>{e(a)==="debug"?w(D):w(R,!1)})}G(()=>{c=mn(l,1,"svelte-1n46o8q",null,c,{active:e(a)==="setup"}),m=mn(d,1,"svelte-1n46o8q",null,m,{active:e(a)==="deployment"}),u=mn(f,1,"svelte-1n46o8q",null,u,{active:e(a)==="battle"}),g=mn(y,1,"svelte-1n46o8q",null,g,{active:e(a)==="main"}),x=mn(T,1,"svelte-1n46o8q",null,x,{active:e(a)==="debug"})}),k(t,s),Tn()}fc(Wh,{target:document.getElementById("app")});
//# sourceMappingURL=index-CjDpFPtL.js.map
