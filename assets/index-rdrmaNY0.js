(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const ri=!1;var Gr=Array.isArray,kl=Array.prototype.indexOf,zr=Array.from,no=Object.defineProperty,ps=Object.getOwnPropertyDescriptor,so=Object.getOwnPropertyDescriptors,Al=Object.prototype,Cl=Array.prototype,yi=Object.getPrototypeOf,Li=Object.isExtensible;const ns=()=>{};function El(t){return t()}function Nr(t){for(var a=0;a<t.length;a++)t[a]()}function ro(){var t,a,n=new Promise((r,s)=>{t=r,a=s});return{promise:n,resolve:t,reject:a}}const Ba=2,Or=4,pr=8,io=1<<24,Vn=16,jn=32,ks=64,vi=128,yn=512,Fa=1024,za=2048,In=4096,on=8192,Un=16384,gi=32768,Bs=65536,$i=1<<17,oo=1<<18,zs=1<<19,lo=1<<20,qn=1<<25,bs=32768,ii=1<<21,bi=1<<22,ss=1<<23,Kn=Symbol("$state"),Ml=Symbol("legacy props"),Rl=Symbol(""),Os=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function co(){throw new Error("https://svelte.dev/e/invalid_default_snippet")}function Ti(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Dl(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Il(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ll(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function $l(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Pl(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Nl(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function Ol(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Wl(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Yl(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Hl(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Fl=1,Bl=2,uo=4,ql=8,Ul=16,Kl=1,Gl=2,zl=4,Xl=8,Vl=16,ho=1,jl=2,Wa=Symbol(),Jl="http://www.w3.org/1999/xhtml";function Zl(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Ql(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function mo(t){return t===this.v}function fo(t,a){return t!=t?a==a:t!==a||t!==null&&typeof t=="object"||typeof t=="function"}function po(t){return!fo(t,this.v)}let Xs=!1,ec=!1;function tc(){Xs=!0}let va=null;function qs(t){va=t}function Ja(t,a=!1,n){va={p:va,i:!1,c:null,e:null,s:t,x:null,l:Xs&&!a?{s:null,u:null,$:[]}:null}}function Za(t){var a=va,n=a.e;if(n!==null){a.e=null;for(var r of n)Io(r)}return t!==void 0&&(a.x=t),a.i=!0,va=a.p,t??{}}function yr(){return!Xs||va!==null&&va.l===null}let ms=[];function yo(){var t=ms;ms=[],Nr(t)}function Vs(t){if(ms.length===0&&!cr){var a=ms;queueMicrotask(()=>{a===ms&&yo()})}ms.push(t)}function ac(){for(;ms.length>0;)yo()}function vo(t){var a=na;if(a===null)return zt.f|=ss,t;if((a.f&gi)===0){if((a.f&vi)===0)throw t;a.b.error(t)}else Us(t,a)}function Us(t,a){for(;a!==null;){if((a.f&vi)!==0)try{a.b.error(t);return}catch(n){t=n}a=a.parent}throw t}const nc=-7169;function Da(t,a){t.f=t.f&nc|a}function xi(t){(t.f&yn)!==0||t.deps===null?Da(t,Fa):Da(t,In)}function go(t){if(t!==null)for(const a of t)(a.f&Ba)===0||(a.f&bs)===0||(a.f^=bs,go(a.deps))}function bo(t,a,n){(t.f&za)!==0?a.add(t):(t.f&In)!==0&&n.add(t),go(t.deps),Da(t,Fa)}const kr=new Set;let ta=null,lr=null,Sn=null,mn=[],Xr=null,oi=!1,cr=!1;class Mn{committed=!1;current=new Map;previous=new Map;#t=new Set;#i=new Set;#e=0;#s=0;#r=null;#n=new Set;#a=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#s>0}process(a){mn=[],lr=null,this.apply();var n=[],r=[];for(const s of a)this.#o(s,n,r);this.is_fork||this.#c(),this.is_deferred()?(this.#l(r),this.#l(n)):(lr=this,ta=null,Pi(r),Pi(n),lr=null,this.#r?.resolve()),Sn=null}#o(a,n,r){a.f^=Fa;for(var s=a.first,o=null;s!==null;){var l=s.f,u=(l&(jn|ks))!==0,d=u&&(l&Fa)!==0,m=d||(l&on)!==0||this.skipped_effects.has(s);if(!m&&s.fn!==null){u?s.f^=Fa:o!==null&&(l&(Or|pr|io))!==0?o.b.defer_effect(s):(l&Or)!==0?n.push(s):Js(s)&&((l&Vn)!==0&&this.#n.add(s),Ks(s));var y=s.first;if(y!==null){s=y;continue}}var p=s.parent;for(s=s.next;s===null&&p!==null;)p===o&&(o=null),s=p.next,p=p.parent}}#l(a){for(var n=0;n<a.length;n+=1)bo(a[n],this.#n,this.#a)}capture(a,n){n!==Wa&&!this.previous.has(a)&&this.previous.set(a,n),(a.f&ss)===0&&(this.current.set(a,a.v),Sn?.set(a,a.v))}activate(){ta=this,this.apply()}deactivate(){ta===this&&(ta=null,Sn=null)}flush(){if(this.activate(),mn.length>0){if(To(),ta!==null&&ta!==this)return}else this.#e===0&&this.process([]);this.deactivate()}discard(){for(const a of this.#i)a(this);this.#i.clear()}#c(){if(this.#s===0){for(const a of this.#t)a();this.#t.clear()}this.#e===0&&this.#u()}#u(){if(kr.size>1){this.previous.clear();var a=Sn,n=!0;for(const s of kr){if(s===this){n=!1;continue}const o=[];for(const[u,d]of this.current){if(s.current.has(u))if(n&&d!==s.current.get(u))s.current.set(u,d);else continue;o.push(u)}if(o.length===0)continue;const l=[...s.current.keys()].filter(u=>!this.current.has(u));if(l.length>0){var r=mn;mn=[];const u=new Set,d=new Map;for(const m of o)xo(m,l,u,d);if(mn.length>0){ta=s,s.apply();for(const m of mn)s.#o(m,[],[]);s.deactivate()}mn=r}}ta=null,Sn=a}this.committed=!0,kr.delete(this)}increment(a){this.#e+=1,a&&(this.#s+=1)}decrement(a){this.#e-=1,a&&(this.#s-=1),this.revive()}revive(){for(const a of this.#n)this.#a.delete(a),Da(a,za),Xn(a);for(const a of this.#a)Da(a,In),Xn(a);this.flush()}oncommit(a){this.#t.add(a)}ondiscard(a){this.#i.add(a)}settled(){return(this.#r??=ro()).promise}static ensure(){if(ta===null){const a=ta=new Mn;kr.add(ta),cr||Mn.enqueue(()=>{ta===a&&a.flush()})}return ta}static enqueue(a){Vs(a)}apply(){}}function sc(t){var a=cr;cr=!0;try{for(var n;;){if(ac(),mn.length===0&&(ta?.flush(),mn.length===0))return Xr=null,n;To()}}finally{cr=a}}function To(){var t=vs;oi=!0;var a=null;try{var n=0;for(Yr(!0);mn.length>0;){var r=Mn.ensure();if(n++>1e3){var s,o;rc()}r.process(mn),rs.clear()}}finally{oi=!1,Yr(t),Xr=null}}function rc(){try{Pl()}catch(t){Us(t,Xr)}}let Wn=null;function Pi(t){var a=t.length;if(a!==0){for(var n=0;n<a;){var r=t[n++];if((r.f&(Un|on))===0&&Js(r)&&(Wn=new Set,Ks(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?No(r):r.fn=null),Wn?.size>0)){rs.clear();for(const s of Wn){if((s.f&(Un|on))!==0)continue;const o=[s];let l=s.parent;for(;l!==null;)Wn.has(l)&&(Wn.delete(l),o.push(l)),l=l.parent;for(let u=o.length-1;u>=0;u--){const d=o[u];(d.f&(Un|on))===0&&Ks(d)}}Wn.clear()}}Wn=null}}function xo(t,a,n,r){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const s of t.reactions){const o=s.f;(o&Ba)!==0?xo(s,a,n,r):(o&(bi|Vn))!==0&&(o&za)===0&&_o(s,a,r)&&(Da(s,za),Xn(s))}}function _o(t,a,n){const r=n.get(t);if(r!==void 0)return r;if(t.deps!==null)for(const s of t.deps){if(a.includes(s))return!0;if((s.f&Ba)!==0&&_o(s,a,n))return n.set(s,!0),!0}return n.set(t,!1),!1}function Xn(t){for(var a=Xr=t;a.parent!==null;){a=a.parent;var n=a.f;if(oi&&a===na&&(n&Vn)!==0&&(n&oo)===0)return;if((n&(ks|jn))!==0){if((n&Fa)===0)return;a.f^=Fa}}mn.push(a)}function ic(t){let a=0,n=Ts(0),r;return()=>{Si()&&(e(n),js(()=>(a===0&&(r=i(()=>t(()=>ur(n)))),a+=1,()=>{Vs(()=>{a-=1,a===0&&(r?.(),r=void 0,ur(n))})})))}}var oc=Bs|zs|vi;function lc(t,a,n){new cc(t,a,n)}class cc{parent;is_pending=!1;#t;#i=null;#e;#s;#r;#n=null;#a=null;#o=null;#l=null;#c=null;#u=0;#d=0;#m=!1;#f=new Set;#p=new Set;#h=null;#T=ic(()=>(this.#h=Ts(this.#u),()=>{this.#h=null}));constructor(a,n,r){this.#t=a,this.#e=n,this.#s=r,this.parent=na.b,this.is_pending=!!this.#e.pending,this.#r=ki(()=>{na.b=this;{var s=this.#g();try{this.#n=fn(()=>r(s))}catch(o){this.error(o)}this.#d>0?this.#v():this.is_pending=!1}return()=>{this.#c?.remove()}},oc)}#x(){try{this.#n=fn(()=>this.#s(this.#t))}catch(a){this.error(a)}}#_(){const a=this.#e.pending;a&&(this.#a=fn(()=>a(this.#t)),Mn.enqueue(()=>{var n=this.#g();this.#n=this.#y(()=>(Mn.ensure(),fn(()=>this.#s(n)))),this.#d>0?this.#v():(ys(this.#a,()=>{this.#a=null}),this.is_pending=!1)}))}#g(){var a=this.#t;return this.is_pending&&(this.#c=Gn(),this.#t.before(this.#c),a=this.#c),a}defer_effect(a){bo(a,this.#f,this.#p)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#e.pending}#y(a){var n=na,r=zt,s=va;Dn(this.#r),Va(this.#r),qs(this.#r.ctx);try{return a()}catch(o){return vo(o),null}finally{Dn(n),Va(r),qs(s)}}#v(){const a=this.#e.pending;this.#n!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#c),Yo(this.#n,this.#l)),this.#a===null&&(this.#a=fn(()=>a(this.#t)))}#b(a){if(!this.has_pending_snippet()){this.parent&&this.parent.#b(a);return}if(this.#d+=a,this.#d===0){this.is_pending=!1;for(const n of this.#f)Da(n,za),Xn(n);for(const n of this.#p)Da(n,In),Xn(n);this.#f.clear(),this.#p.clear(),this.#a&&ys(this.#a,()=>{this.#a=null}),this.#l&&(this.#t.before(this.#l),this.#l=null)}}update_pending_count(a){this.#b(a),this.#u+=a,this.#h&&xs(this.#h,this.#u)}get_effect_pending(){return this.#T(),e(this.#h)}error(a){var n=this.#e.onerror;let r=this.#e.failed;if(this.#m||!n&&!r)throw a;this.#n&&(ja(this.#n),this.#n=null),this.#a&&(ja(this.#a),this.#a=null),this.#o&&(ja(this.#o),this.#o=null);var s=!1,o=!1;const l=()=>{if(s){Ql();return}s=!0,o&&Hl(),Mn.ensure(),this.#u=0,this.#o!==null&&ys(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#n=this.#y(()=>(this.#m=!1,fn(()=>this.#s(this.#t)))),this.#d>0?this.#v():this.is_pending=!1};var u=zt;try{Va(null),o=!0,n?.(a,l),o=!1}catch(d){Us(d,this.#r&&this.#r.parent)}finally{Va(u)}r&&Vs(()=>{this.#o=this.#y(()=>{Mn.ensure(),this.#m=!0;try{return fn(()=>{r(this.#t,()=>a,()=>l)})}catch(d){return Us(d,this.#r.parent),null}finally{this.#m=!1}})})}}function uc(t,a,n,r){const s=yr()?Vr:Me;if(n.length===0&&t.length===0){r(a.map(s));return}var o=ta,l=na,u=dc();function d(){Promise.all(n.map(m=>hc(m))).then(m=>{u();try{r([...a.map(s),...m])}catch(y){(l.f&Un)===0&&Us(y,l)}o?.deactivate(),Wr()}).catch(m=>{Us(m,l)})}t.length>0?Promise.all(t).then(()=>{u();try{return d()}finally{o?.deactivate(),Wr()}}):d()}function dc(){var t=na,a=zt,n=va,r=ta;return function(o=!0){Dn(t),Va(a),qs(n),o&&r?.activate()}}function Wr(){Dn(null),Va(null),qs(null)}function Vr(t){var a=Ba|za,n=zt!==null&&(zt.f&Ba)!==0?zt:null;return na!==null&&(na.f|=zs),{ctx:va,deps:null,effects:null,equals:mo,f:a,fn:t,reactions:null,rv:0,v:Wa,wv:0,parent:n??na,ac:null}}function hc(t,a,n){let r=na;r===null&&Dl();var s=r.b,o=void 0,l=Ts(Wa),u=!zt,d=new Map;return _c(()=>{var m=ro();o=m.promise;try{Promise.resolve(t()).then(m.resolve,m.reject).then(()=>{y===ta&&y.committed&&y.deactivate(),Wr()})}catch(f){m.reject(f),Wr()}var y=ta;if(u){var p=s.is_rendered();s.update_pending_count(1),y.increment(p),d.get(y)?.reject(Os),d.delete(y),d.set(y,m)}const h=(f,v=void 0)=>{if(y.activate(),v)v!==Os&&(l.f|=ss,xs(l,v));else{(l.f&ss)!==0&&(l.f^=ss),xs(l,f);for(const[k,T]of d){if(d.delete(k),k===y)break;T.reject(Os)}}u&&(s.update_pending_count(-1),y.decrement(p))};m.promise.then(h,f=>h(null,f||"unknown"))}),gr(()=>{for(const m of d.values())m.reject(Os)}),new Promise(m=>{function y(p){function h(){p===o?m(l):y(o)}p.then(h,h)}y(o)})}function Me(t){const a=Vr(t);return a.equals=po,a}function wo(t){var a=t.effects;if(a!==null){t.effects=null;for(var n=0;n<a.length;n+=1)ja(a[n])}}function mc(t){for(var a=t.parent;a!==null;){if((a.f&Ba)===0)return(a.f&Un)===0?a:null;a=a.parent}return null}function _i(t){var a,n=na;Dn(mc(t));try{t.f&=~bs,wo(t),a=Uo(t)}finally{Dn(n)}return a}function So(t){var a=_i(t);if(!t.equals(a)&&(t.wv=Bo(),(!ta?.is_fork||t.deps===null)&&(t.v=a,t.deps===null))){Da(t,Fa);return}os||(Sn!==null?(Si()||ta?.is_fork)&&Sn.set(t,a):xi(t))}let li=new Set;const rs=new Map;let ko=!1;function Ts(t,a){var n={f:0,v:t,reactions:null,equals:mo,rv:0,wv:0};return n}function Jn(t,a){const n=Ts(t);return Ac(n),n}function N(t,a=!1,n=!0){const r=Ts(t);return a||(r.equals=po),Xs&&n&&va!==null&&va.l!==null&&(va.l.s??=[]).push(r),r}function ei(t,a){return g(t,i(()=>e(t))),a}function g(t,a,n=!1){zt!==null&&(!kn||(zt.f&$i)!==0)&&yr()&&(zt.f&(Ba|Vn|bi|$i))!==0&&!zn?.includes(t)&&Yl();let r=n?Ws(a):a;return xs(t,r)}function xs(t,a){if(!t.equals(a)){var n=t.v;os?rs.set(t,a):rs.set(t,n),t.v=a;var r=Mn.ensure();if(r.capture(t,n),(t.f&Ba)!==0){const s=t;(t.f&za)!==0&&_i(s),xi(s)}t.wv=Bo(),Ao(t,za),yr()&&na!==null&&(na.f&Fa)!==0&&(na.f&(jn|ks))===0&&(hn===null?Cc([t]):hn.push(t)),!r.is_fork&&li.size>0&&!ko&&fc()}return a}function fc(){ko=!1;var t=vs;Yr(!0);const a=Array.from(li);try{for(const n of a)(n.f&Fa)!==0&&Da(n,In),Js(n)&&Ks(n)}finally{Yr(t)}li.clear()}function ur(t){g(t,t.v+1)}function Ao(t,a){var n=t.reactions;if(n!==null)for(var r=yr(),s=n.length,o=0;o<s;o++){var l=n[o],u=l.f;if(!(!r&&l===na)){var d=(u&za)===0;if(d&&Da(l,a),(u&Ba)!==0){var m=l;Sn?.delete(m),(u&bs)===0&&(u&yn&&(l.f|=bs),Ao(m,In))}else d&&((u&Vn)!==0&&Wn!==null&&Wn.add(l),Xn(l))}}}function Ws(t){if(typeof t!="object"||t===null||Kn in t)return t;const a=yi(t);if(a!==Al&&a!==Cl)return t;var n=new Map,r=Gr(t),s=Jn(0),o=gs,l=u=>{if(gs===o)return u();var d=zt,m=gs;Va(null),Yi(o);var y=u();return Va(d),Yi(m),y};return r&&n.set("length",Jn(t.length)),new Proxy(t,{defineProperty(u,d,m){(!("value"in m)||m.configurable===!1||m.enumerable===!1||m.writable===!1)&&Ol();var y=n.get(d);return y===void 0?y=l(()=>{var p=Jn(m.value);return n.set(d,p),p}):g(y,m.value,!0),!0},deleteProperty(u,d){var m=n.get(d);if(m===void 0){if(d in u){const y=l(()=>Jn(Wa));n.set(d,y),ur(s)}}else g(m,Wa),ur(s);return!0},get(u,d,m){if(d===Kn)return t;var y=n.get(d),p=d in u;if(y===void 0&&(!p||ps(u,d)?.writable)&&(y=l(()=>{var f=Ws(p?u[d]:Wa),v=Jn(f);return v}),n.set(d,y)),y!==void 0){var h=e(y);return h===Wa?void 0:h}return Reflect.get(u,d,m)},getOwnPropertyDescriptor(u,d){var m=Reflect.getOwnPropertyDescriptor(u,d);if(m&&"value"in m){var y=n.get(d);y&&(m.value=e(y))}else if(m===void 0){var p=n.get(d),h=p?.v;if(p!==void 0&&h!==Wa)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return m},has(u,d){if(d===Kn)return!0;var m=n.get(d),y=m!==void 0&&m.v!==Wa||Reflect.has(u,d);if(m!==void 0||na!==null&&(!y||ps(u,d)?.writable)){m===void 0&&(m=l(()=>{var h=y?Ws(u[d]):Wa,f=Jn(h);return f}),n.set(d,m));var p=e(m);if(p===Wa)return!1}return y},set(u,d,m,y){var p=n.get(d),h=d in u;if(r&&d==="length")for(var f=m;f<p.v;f+=1){var v=n.get(f+"");v!==void 0?g(v,Wa):f in u&&(v=l(()=>Jn(Wa)),n.set(f+"",v))}if(p===void 0)(!h||ps(u,d)?.writable)&&(p=l(()=>Jn(void 0)),g(p,Ws(m)),n.set(d,p));else{h=p.v!==Wa;var k=l(()=>Ws(m));g(p,k)}var T=Reflect.getOwnPropertyDescriptor(u,d);if(T?.set&&T.set.call(y,m),!h){if(r&&typeof d=="string"){var A=n.get("length"),P=Number(d);Number.isInteger(P)&&P>=A.v&&g(A,P+1)}ur(s)}return!0},ownKeys(u){e(s);var d=Reflect.ownKeys(u).filter(p=>{var h=n.get(p);return h===void 0||h.v!==Wa});for(var[m,y]of n)y.v!==Wa&&!(m in u)&&d.push(m);return d},setPrototypeOf(){Wl()}})}function Ni(t){try{if(t!==null&&typeof t=="object"&&Kn in t)return t[Kn]}catch{}return t}function pc(t,a){return Object.is(Ni(t),Ni(a))}var fs,Co,Eo,Mo;function yc(){if(fs===void 0){fs=window,Co=/Firefox/.test(navigator.userAgent);var t=Element.prototype,a=Node.prototype,n=Text.prototype;Eo=ps(a,"firstChild").get,Mo=ps(a,"nextSibling").get,Li(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Li(n)&&(n.__t=void 0)}}function Gn(t=""){return document.createTextNode(t)}function Fn(t){return Eo.call(t)}function vr(t){return Mo.call(t)}function x(t,a){return Fn(t)}function ie(t,a=!1){{var n=Fn(t);return n instanceof Comment&&n.data===""?vr(n):n}}function b(t,a=1,n=!1){let r=t;for(;a--;)r=vr(r);return r}function vc(t){t.textContent=""}function Ro(){return!1}let Oi=!1;function gc(){Oi||(Oi=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const a of t.target.elements)a.__on_r?.()})},{capture:!0}))}function jr(t){var a=zt,n=na;Va(null),Dn(null);try{return t()}finally{Va(a),Dn(n)}}function wi(t,a,n,r=n){t.addEventListener(a,()=>jr(n));const s=t.__on_r;s?t.__on_r=()=>{s(),r(!0)}:t.__on_r=()=>r(!0),gc()}function Do(t){na===null&&(zt===null&&$l(),Ll()),os&&Il()}function bc(t,a){var n=a.last;n===null?a.last=a.first=t:(n.next=t,t.prev=n,a.last=t)}function Ln(t,a,n){var r=na;r!==null&&(r.f&on)!==0&&(t|=on);var s={ctx:va,deps:null,nodes:null,f:t|za|yn,first:null,fn:a,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{Ks(s),s.f|=gi}catch(u){throw ja(s),u}else a!==null&&Xn(s);var o=s;if(n&&o.deps===null&&o.teardown===null&&o.nodes===null&&o.first===o.last&&(o.f&zs)===0&&(o=o.first,(t&Vn)!==0&&(t&Bs)!==0&&o!==null&&(o.f|=Bs)),o!==null&&(o.parent=r,r!==null&&bc(o,r),zt!==null&&(zt.f&Ba)!==0&&(t&ks)===0)){var l=zt;(l.effects??=[]).push(o)}return s}function Si(){return zt!==null&&!kn}function gr(t){const a=Ln(pr,null,!1);return Da(a,Fa),a.teardown=t,a}function ci(t){Do();var a=na.f,n=!zt&&(a&jn)!==0&&(a&gi)===0;if(n){var r=va;(r.e??=[]).push(t)}else return Io(t)}function Io(t){return Ln(Or|lo,t,!1)}function Tc(t){return Do(),Ln(pr|lo,t,!0)}function xc(t){Mn.ensure();const a=Ln(ks|zs,t,!0);return(n={})=>new Promise(r=>{n.outro?ys(a,()=>{ja(a),r(void 0)}):(ja(a),r(void 0))})}function Lo(t){return Ln(Or,t,!1)}function le(t,a){var n=va,r={effect:null,ran:!1,deps:t};n.l.$.push(r),r.effect=js(()=>{t(),!r.ran&&(r.ran=!0,i(a))})}function $n(){var t=va;js(()=>{for(var a of t.l.$){a.deps();var n=a.effect;(n.f&Fa)!==0&&n.deps!==null&&Da(n,In),Js(n)&&Ks(n),a.ran=!1}})}function _c(t){return Ln(bi|zs,t,!0)}function js(t,a=0){return Ln(pr|a,t,!0)}function H(t,a=[],n=[],r=[]){uc(r,a,n,s=>{Ln(pr,()=>t(...s.map(e)),!0)})}function ki(t,a=0){var n=Ln(Vn|a,t,!0);return n}function fn(t){return Ln(jn|zs,t,!0)}function $o(t){var a=t.teardown;if(a!==null){const n=os,r=zt;Wi(!0),Va(null);try{a.call(null)}finally{Wi(n),Va(r)}}}function Po(t,a=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const s=n.ac;s!==null&&jr(()=>{s.abort(Os)});var r=n.next;(n.f&ks)!==0?n.parent=null:ja(n,a),n=r}}function wc(t){for(var a=t.first;a!==null;){var n=a.next;(a.f&jn)===0&&ja(a),a=n}}function ja(t,a=!0){var n=!1;(a||(t.f&oo)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(Sc(t.nodes.start,t.nodes.end),n=!0),Po(t,a&&!n),Hr(t,0),Da(t,Un);var r=t.nodes&&t.nodes.t;if(r!==null)for(const o of r)o.stop();$o(t);var s=t.parent;s!==null&&s.first!==null&&No(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function Sc(t,a){for(;t!==null;){var n=t===a?null:vr(t);t.remove(),t=n}}function No(t){var a=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),a!==null&&(a.first===t&&(a.first=r),a.last===t&&(a.last=n))}function ys(t,a,n=!0){var r=[];Oo(t,r,!0);var s=()=>{n&&ja(t),a&&a()},o=r.length;if(o>0){var l=()=>--o||s();for(var u of r)u.out(l)}else s()}function Oo(t,a,n){if((t.f&on)===0){t.f^=on;var r=t.nodes&&t.nodes.t;if(r!==null)for(const u of r)(u.is_global||n)&&a.push(u);for(var s=t.first;s!==null;){var o=s.next,l=(s.f&Bs)!==0||(s.f&jn)!==0&&(t.f&Vn)!==0;Oo(s,a,l?n:!1),s=o}}}function Ai(t){Wo(t,!0)}function Wo(t,a){if((t.f&on)!==0){t.f^=on,(t.f&Fa)===0&&(Da(t,za),Xn(t));for(var n=t.first;n!==null;){var r=n.next,s=(n.f&Bs)!==0||(n.f&jn)!==0;Wo(n,s?a:!1),n=r}var o=t.nodes&&t.nodes.t;if(o!==null)for(const l of o)(l.is_global||a)&&l.in()}}function Yo(t,a){if(t.nodes)for(var n=t.nodes.start,r=t.nodes.end;n!==null;){var s=n===r?null:vr(n);a.append(n),n=s}}let Ns=null;function kc(t){var a=Ns;try{if(Ns=new Set,i(t),a!==null)for(var n of Ns)a.add(n);return Ns}finally{Ns=a}}function Ho(t){for(var a of kc(t))xs(a,a.v)}let vs=!1;function Yr(t){vs=t}let os=!1;function Wi(t){os=t}let zt=null,kn=!1;function Va(t){zt=t}let na=null;function Dn(t){na=t}let zn=null;function Ac(t){zt!==null&&(zn===null?zn=[t]:zn.push(t))}let Ga=null,an=0,hn=null;function Cc(t){hn=t}let Fo=1,mr=0,gs=mr;function Yi(t){gs=t}function Bo(){return++Fo}function Js(t){var a=t.f;if((a&za)!==0)return!0;if(a&Ba&&(t.f&=~bs),(a&In)!==0){for(var n=t.deps,r=n.length,s=0;s<r;s++){var o=n[s];if(Js(o)&&So(o),o.wv>t.wv)return!0}(a&yn)!==0&&Sn===null&&Da(t,Fa)}return!1}function qo(t,a,n=!0){var r=t.reactions;if(r!==null&&!zn?.includes(t))for(var s=0;s<r.length;s++){var o=r[s];(o.f&Ba)!==0?qo(o,a,!1):a===o&&(n?Da(o,za):(o.f&Fa)!==0&&Da(o,In),Xn(o))}}function Uo(t){var a=Ga,n=an,r=hn,s=zt,o=zn,l=va,u=kn,d=gs,m=t.f;Ga=null,an=0,hn=null,zt=(m&(jn|ks))===0?t:null,zn=null,qs(t.ctx),kn=!1,gs=++mr,t.ac!==null&&(jr(()=>{t.ac.abort(Os)}),t.ac=null);try{t.f|=ii;var y=t.fn,p=y(),h=t.deps;if(Ga!==null){var f;if(Hr(t,an),h!==null&&an>0)for(h.length=an+Ga.length,f=0;f<Ga.length;f++)h[an+f]=Ga[f];else t.deps=h=Ga;if(Si()&&(t.f&yn)!==0)for(f=an;f<h.length;f++)(h[f].reactions??=[]).push(t)}else h!==null&&an<h.length&&(Hr(t,an),h.length=an);if(yr()&&hn!==null&&!kn&&h!==null&&(t.f&(Ba|In|za))===0)for(f=0;f<hn.length;f++)qo(hn[f],t);return s!==null&&s!==t&&(mr++,hn!==null&&(r===null?r=hn:r.push(...hn))),(t.f&ss)!==0&&(t.f^=ss),p}catch(v){return vo(v)}finally{t.f^=ii,Ga=a,an=n,hn=r,zt=s,zn=o,qs(l),kn=u,gs=d}}function Ec(t,a){let n=a.reactions;if(n!==null){var r=kl.call(n,t);if(r!==-1){var s=n.length-1;s===0?n=a.reactions=null:(n[r]=n[s],n.pop())}}if(n===null&&(a.f&Ba)!==0&&(Ga===null||!Ga.includes(a))){var o=a;(o.f&yn)!==0&&(o.f^=yn,o.f&=~bs),xi(o),wo(o),Hr(o,0)}}function Hr(t,a){var n=t.deps;if(n!==null)for(var r=a;r<n.length;r++)Ec(t,n[r])}function Ks(t){var a=t.f;if((a&Un)===0){Da(t,Fa);var n=na,r=vs;na=t,vs=!0;try{(a&(Vn|io))!==0?wc(t):Po(t),$o(t);var s=Uo(t);t.teardown=typeof s=="function"?s:null,t.wv=Fo;var o;ri&&ec&&(t.f&za)!==0&&t.deps}finally{vs=r,na=n}}}async function Mc(){await Promise.resolve(),sc()}function e(t){var a=t.f,n=(a&Ba)!==0;if(Ns?.add(t),zt!==null&&!kn){var r=na!==null&&(na.f&Un)!==0;if(!r&&!zn?.includes(t)){var s=zt.deps;if((zt.f&ii)!==0)t.rv<mr&&(t.rv=mr,Ga===null&&s!==null&&s[an]===t?an++:Ga===null?Ga=[t]:Ga.includes(t)||Ga.push(t));else{(zt.deps??=[]).push(t);var o=t.reactions;o===null?t.reactions=[zt]:o.includes(zt)||o.push(zt)}}}if(os&&rs.has(t))return rs.get(t);if(n){var l=t;if(os){var u=l.v;return((l.f&Fa)===0&&l.reactions!==null||Go(l))&&(u=_i(l)),rs.set(l,u),u}var d=(l.f&yn)===0&&!kn&&zt!==null&&(vs||(zt.f&yn)!==0),m=l.deps===null;Js(l)&&(d&&(l.f|=yn),So(l)),d&&!m&&Ko(l)}if(Sn?.has(t))return Sn.get(t);if((t.f&ss)!==0)throw t.v;return t.v}function Ko(t){if(t.deps!==null){t.f|=yn;for(const a of t.deps)(a.reactions??=[]).push(t),(a.f&Ba)!==0&&(a.f&yn)===0&&Ko(a)}}function Go(t){if(t.v===Wa)return!0;if(t.deps===null)return!1;for(const a of t.deps)if(rs.has(a)||(a.f&Ba)!==0&&Go(a))return!0;return!1}function i(t){var a=kn;try{return kn=!0,t()}finally{kn=a}}function D(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Kn in t)ui(t);else if(!Array.isArray(t))for(let a in t){const n=t[a];typeof n=="object"&&n&&Kn in n&&ui(n)}}}function ui(t,a=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!a.has(t)){a.add(t),t instanceof Date&&t.getTime();for(let r in t)try{ui(t[r],a)}catch{}const n=yi(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=so(n);for(let s in r){const o=r[s].get;if(o)try{o.call(t)}catch{}}}}}const Rc=["touchstart","touchmove"];function Dc(t){return Rc.includes(t)}const Ic=new Set,Hi=new Set;function Lc(t,a,n,r={}){function s(o){if(r.capture||rr.call(a,o),!o.cancelBubble)return jr(()=>n?.call(this,o))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Vs(()=>{a.addEventListener(t,s,r)}):a.addEventListener(t,s,r),s}function Z(t,a,n,r,s){var o={capture:r,passive:s},l=Lc(t,a,n,o);(a===document.body||a===window||a===document||a instanceof HTMLMediaElement)&&gr(()=>{a.removeEventListener(t,l,o)})}let Fi=null;function rr(t){var a=this,n=a.ownerDocument,r=t.type,s=t.composedPath?.()||[],o=s[0]||t.target;Fi=t;var l=0,u=Fi===t&&t.__root;if(u){var d=s.indexOf(u);if(d!==-1&&(a===document||a===window)){t.__root=a;return}var m=s.indexOf(a);if(m===-1)return;d<=m&&(l=d)}if(o=s[l]||t.target,o!==a){no(t,"currentTarget",{configurable:!0,get(){return o||n}});var y=zt,p=na;Va(null),Dn(null);try{for(var h,f=[];o!==null;){var v=o.assignedSlot||o.parentNode||o.host||null;try{var k=o["__"+r];k!=null&&(!o.disabled||t.target===o)&&k.call(o,t)}catch(T){h?f.push(T):h=T}if(t.cancelBubble||v===a||v===null)break;o=v}if(h){for(let T of f)queueMicrotask(()=>{throw T});throw h}}finally{t.__root=a,delete t.currentTarget,Va(y),Dn(p)}}}function zo(t){var a=document.createElement("template");return a.innerHTML=t.replaceAll("<!>","<!---->"),a.content}function Gs(t,a){var n=na;n.nodes===null&&(n.nodes={start:t,end:a,a:null,t:null})}function ve(t,a){var n=(a&ho)!==0,r=(a&jl)!==0,s,o=!t.startsWith("<!>");return()=>{s===void 0&&(s=zo(o?t:"<!>"+t),n||(s=Fn(s)));var l=r||Co?document.importNode(s,!0):s.cloneNode(!0);if(n){var u=Fn(l),d=l.lastChild;Gs(u,d)}else Gs(l,l);return l}}function $c(t,a,n="svg"){var r=!t.startsWith("<!>"),s=(a&ho)!==0,o=`<${n}>${r?t:"<!>"+t}</${n}>`,l;return()=>{if(!l){var u=zo(o),d=Fn(u);if(s)for(l=document.createDocumentFragment();Fn(d);)l.appendChild(Fn(d));else l=Fn(d)}var m=l.cloneNode(!0);if(s){var y=Fn(m),p=m.lastChild;Gs(y,p)}else Gs(m,m);return m}}function ce(t,a){return $c(t,a,"svg")}function Xo(t=""){{var a=Gn(t+"");return Gs(a,a),a}}function ze(){var t=document.createDocumentFragment(),a=document.createComment(""),n=Gn();return t.append(a,n),Gs(a,n),t}function _(t,a){t!==null&&t.before(a)}function Oe(t,a){var n=a==null?"":typeof a=="object"?a+"":a;n!==(t.__t??=t.nodeValue)&&(t.__t=n,t.nodeValue=n+"")}function Pc(t,a){return Nc(t,a)}const Ls=new Map;function Nc(t,{target:a,anchor:n,props:r={},events:s,context:o,intro:l=!0}){yc();var u=new Set,d=p=>{for(var h=0;h<p.length;h++){var f=p[h];if(!u.has(f)){u.add(f);var v=Dc(f);a.addEventListener(f,rr,{passive:v});var k=Ls.get(f);k===void 0?(document.addEventListener(f,rr,{passive:v}),Ls.set(f,1)):Ls.set(f,k+1)}}};d(zr(Ic)),Hi.add(d);var m=void 0,y=xc(()=>{var p=n??a.appendChild(Gn());return lc(p,{pending:()=>{}},h=>{if(o){Ja({});var f=va;f.c=o}s&&(r.$$events=s),m=t(h,r)||{},o&&Za()}),()=>{for(var h of u){a.removeEventListener(h,rr);var f=Ls.get(h);--f===0?(document.removeEventListener(h,rr),Ls.delete(h)):Ls.set(h,f)}Hi.delete(d),p!==n&&p.parentNode?.removeChild(p)}});return Oc.set(m,y),m}let Oc=new WeakMap;class Wc{anchor;#t=new Map;#i=new Map;#e=new Map;#s=new Set;#r=!0;constructor(a,n=!0){this.anchor=a,this.#r=n}#n=()=>{var a=ta;if(this.#t.has(a)){var n=this.#t.get(a),r=this.#i.get(n);if(r)Ai(r),this.#s.delete(n);else{var s=this.#e.get(n);s&&(this.#i.set(n,s.effect),this.#e.delete(n),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),r=s.effect)}for(const[o,l]of this.#t){if(this.#t.delete(o),o===a)break;const u=this.#e.get(l);u&&(ja(u.effect),this.#e.delete(l))}for(const[o,l]of this.#i){if(o===n||this.#s.has(o))continue;const u=()=>{if(Array.from(this.#t.values()).includes(o)){var m=document.createDocumentFragment();Yo(l,m),m.append(Gn()),this.#e.set(o,{effect:l,fragment:m})}else ja(l);this.#s.delete(o),this.#i.delete(o)};this.#r||!r?(this.#s.add(o),ys(l,u,!1)):u()}}};#a=a=>{this.#t.delete(a);const n=Array.from(this.#t.values());for(const[r,s]of this.#e)n.includes(r)||(ja(s.effect),this.#e.delete(r))};ensure(a,n){var r=ta,s=Ro();if(n&&!this.#i.has(a)&&!this.#e.has(a))if(s){var o=document.createDocumentFragment(),l=Gn();o.append(l),this.#e.set(a,{effect:fn(()=>n(l)),fragment:o})}else this.#i.set(a,fn(()=>n(this.anchor)));if(this.#t.set(r,a),s){for(const[u,d]of this.#i)u===a?r.skipped_effects.delete(d):r.skipped_effects.add(d);for(const[u,d]of this.#e)u===a?r.skipped_effects.delete(d.effect):r.skipped_effects.add(d.effect);r.oncommit(this.#n),r.ondiscard(this.#a)}else this.#n()}}function z(t,a,n=!1){var r=new Wc(t),s=n?Bs:0;function o(l,u){r.ensure(l,u)}ki(()=>{var l=!1;a((u,d=!0)=>{l=!0,o(d,u)}),l||o(!1,null)},s)}function Ct(t,a){return a}function Yc(t,a,n){for(var r=[],s=a.length,o,l=a.length,u=0;u<s;u++){let p=a[u];ys(p,()=>{if(o){if(o.pending.delete(p),o.done.add(p),o.pending.size===0){var h=t.outrogroups;di(zr(o.done)),h.delete(o),h.size===0&&(t.outrogroups=null)}}else l-=1},!1)}if(l===0){var d=r.length===0&&n!==null;if(d){var m=n,y=m.parentNode;vc(y),y.append(m),t.items.clear()}di(a,!d)}else o={pending:new Set(a),done:new Set},(t.outrogroups??=new Set).add(o)}function di(t,a=!0){for(var n=0;n<t.length;n++)ja(t[n],a)}var Bi;function at(t,a,n,r,s,o=null){var l=t,u=new Map,d=(a&uo)!==0;if(d){var m=t;l=m.appendChild(Gn())}var y=null,p=Me(()=>{var A=n();return Gr(A)?A:A==null?[]:zr(A)}),h,f=!0;function v(){T.fallback=y,Hc(T,h,l,a,r),y!==null&&(h.length===0?(y.f&qn)===0?Ai(y):(y.f^=qn,ir(y,null,l)):ys(y,()=>{y=null}))}var k=ki(()=>{h=e(p);for(var A=h.length,P=new Set,E=ta,S=Ro(),R=0;R<A;R+=1){var L=h[R],q=r(L,R),F=f?null:u.get(q);F?(F.v&&xs(F.v,L),F.i&&xs(F.i,R),S&&E.skipped_effects.delete(F.e)):(F=Fc(u,f?l:Bi??=Gn(),L,q,R,s,a,n),f||(F.e.f|=qn),u.set(q,F)),P.add(q)}if(A===0&&o&&!y&&(f?y=fn(()=>o(l)):(y=fn(()=>o(Bi??=Gn())),y.f|=qn)),!f)if(S){for(const[U,W]of u)P.has(U)||E.skipped_effects.add(W.e);E.oncommit(v),E.ondiscard(()=>{})}else v();e(p)}),T={effect:k,items:u,outrogroups:null,fallback:y};f=!1}function Hc(t,a,n,r,s){var o=(r&ql)!==0,l=a.length,u=t.items,d=t.effect.first,m,y=null,p,h=[],f=[],v,k,T,A;if(o)for(A=0;A<l;A+=1)v=a[A],k=s(v,A),T=u.get(k).e,(T.f&qn)===0&&(T.nodes?.a?.measure(),(p??=new Set).add(T));for(A=0;A<l;A+=1){if(v=a[A],k=s(v,A),T=u.get(k).e,t.outrogroups!==null)for(const W of t.outrogroups)W.pending.delete(T),W.done.delete(T);if((T.f&qn)!==0)if(T.f^=qn,T===d)ir(T,null,n);else{var P=y?y.next:d;T===t.effect.last&&(t.effect.last=T.prev),T.prev&&(T.prev.next=T.next),T.next&&(T.next.prev=T.prev),Zn(t,y,T),Zn(t,T,P),ir(T,P,n),y=T,h=[],f=[],d=y.next;continue}if((T.f&on)!==0&&(Ai(T),o&&(T.nodes?.a?.unfix(),(p??=new Set).delete(T))),T!==d){if(m!==void 0&&m.has(T)){if(h.length<f.length){var E=f[0],S;y=E.prev;var R=h[0],L=h[h.length-1];for(S=0;S<h.length;S+=1)ir(h[S],E,n);for(S=0;S<f.length;S+=1)m.delete(f[S]);Zn(t,R.prev,L.next),Zn(t,y,R),Zn(t,L,E),d=E,y=L,A-=1,h=[],f=[]}else m.delete(T),ir(T,d,n),Zn(t,T.prev,T.next),Zn(t,T,y===null?t.effect.first:y.next),Zn(t,y,T),y=T;continue}for(h=[],f=[];d!==null&&d!==T;)(m??=new Set).add(d),f.push(d),d=d.next;if(d===null)continue}(T.f&qn)===0&&h.push(T),y=T,d=T.next}if(t.outrogroups!==null){for(const W of t.outrogroups)W.pending.size===0&&(di(zr(W.done)),t.outrogroups?.delete(W));t.outrogroups.size===0&&(t.outrogroups=null)}if(d!==null||m!==void 0){var q=[];if(m!==void 0)for(T of m)(T.f&on)===0&&q.push(T);for(;d!==null;)(d.f&on)===0&&d!==t.fallback&&q.push(d),d=d.next;var F=q.length;if(F>0){var U=(r&uo)!==0&&l===0?n:null;if(o){for(A=0;A<F;A+=1)q[A].nodes?.a?.measure();for(A=0;A<F;A+=1)q[A].nodes?.a?.fix()}Yc(t,q,U)}}o&&Vs(()=>{if(p!==void 0)for(T of p)T.nodes?.a?.apply()})}function Fc(t,a,n,r,s,o,l,u){var d=(l&Fl)!==0?(l&Ul)===0?N(n,!1,!1):Ts(n):null,m=(l&Bl)!==0?Ts(s):null;return{v:d,i:m,e:fn(()=>(o(a,d??n,m??s,u),()=>{t.delete(r)}))}}function ir(t,a,n){if(t.nodes)for(var r=t.nodes.start,s=t.nodes.end,o=a&&(a.f&qn)===0?a.nodes.start:n;r!==null;){var l=vr(r);if(o.before(r),r===s)return;r=l}}function Zn(t,a,n){a===null?t.effect.first=n:a.next=n,n===null?t.effect.last=a:n.prev=a}function Vo(t,a,n,r,s){var o=a.$$slots?.[n],l=!1;o===!0&&(o=a.children,l=!0),o===void 0||o(t,l?()=>r:r)}const qi=[...` 	
\r\f \v\uFEFF`];function Bc(t,a,n){var r=t==null?"":""+t;if(n){for(var s in n)if(n[s])r=r?r+" "+s:s;else if(r.length)for(var o=s.length,l=0;(l=r.indexOf(s,l))>=0;){var u=l+o;(l===0||qi.includes(r[l-1]))&&(u===r.length||qi.includes(r[u]))?r=(l===0?"":r.substring(0,l))+r.substring(u+1):l=u}}return r===""?null:r}function qc(t,a){return t==null?null:String(t)}function Oa(t,a,n,r,s,o){var l=t.__className;if(l!==n||l===void 0){var u=Bc(n,r,o);u==null?t.removeAttribute("class"):a?t.className=u:t.setAttribute("class",u),t.__className=n}else if(o&&s!==o)for(var d in o){var m=!!o[d];(s==null||m!==!!s[d])&&t.classList.toggle(d,m)}return o}function Uc(t,a,n,r){var s=t.__style;if(s!==a){var o=qc(a);o==null?t.removeAttribute("style"):t.style.cssText=o,t.__style=a}return r}function jo(t,a,n=!1){if(t.multiple){if(a==null)return;if(!Gr(a))return Zl();for(var r of t.options)r.selected=a.includes(dr(r));return}for(r of t.options){var s=dr(r);if(pc(s,a)){r.selected=!0;return}}(!n||a!==void 0)&&(t.selectedIndex=-1)}function Kc(t){var a=new MutationObserver(()=>{jo(t,t.__value)});a.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),gr(()=>{a.disconnect()})}function Jo(t,a,n=a){var r=new WeakSet,s=!0;wi(t,"change",o=>{var l=o?"[selected]":":checked",u;if(t.multiple)u=[].map.call(t.querySelectorAll(l),dr);else{var d=t.querySelector(l)??t.querySelector("option:not([disabled])");u=d&&dr(d)}n(u),ta!==null&&r.add(ta)}),Lo(()=>{var o=a();if(t===document.activeElement){var l=lr??ta;if(r.has(l))return}if(jo(t,o,s),s&&o===void 0){var u=t.querySelector(":checked");u!==null&&(o=dr(u),n(o))}t.__value=o,s=!1}),Kc(t)}function dr(t){return"__value"in t?t.__value:t.value}const Gc=Symbol("is custom element"),zc=Symbol("is html");function Yn(t,a){var n=Zo(t);n.value===(n.value=a??void 0)||t.value===a&&(a!==0||t.nodeName!=="PROGRESS")||(t.value=a??"")}function c(t,a,n,r){var s=Zo(t);s[a]!==(s[a]=n)&&(a==="loading"&&(t[Rl]=n),n==null?t.removeAttribute(a):typeof n!="string"&&Xc(t).includes(a)?t[a]=n:t.setAttribute(a,n))}function Zo(t){return t.__attributes??={[Gc]:t.nodeName.includes("-"),[zc]:t.namespaceURI===Jl}}var Ui=new Map;function Xc(t){var a=t.getAttribute("is")||t.nodeName,n=Ui.get(a);if(n)return n;Ui.set(a,n=[]);for(var r,s=t,o=Element.prototype;o!==s;){r=so(s);for(var l in r)r[l].set&&n.push(l);s=yi(s)}return n}function Fs(t,a,n=a){var r=new WeakSet;wi(t,"input",async s=>{var o=s?t.defaultValue:t.value;if(o=ti(t)?ai(o):o,n(o),ta!==null&&r.add(ta),await Mc(),o!==(o=a())){var l=t.selectionStart,u=t.selectionEnd,d=t.value.length;if(t.value=o??"",u!==null){var m=t.value.length;l===u&&u===d&&m>d?(t.selectionStart=m,t.selectionEnd=m):(t.selectionStart=l,t.selectionEnd=Math.min(u,m))}}}),i(a)==null&&t.value&&(n(ti(t)?ai(t.value):t.value),ta!==null&&r.add(ta)),js(()=>{var s=a();if(t===document.activeElement){var o=lr??ta;if(r.has(o))return}ti(t)&&s===ai(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function Na(t,a,n=a){wi(t,"change",r=>{var s=r?t.defaultChecked:t.checked;n(s)}),i(a)==null&&n(t.checked),js(()=>{var r=a();t.checked=!!r})}function ti(t){var a=t.type;return a==="number"||a==="range"}function ai(t){return t===""?null:+t}function or(t,a,n){var r=ps(t,a);r&&r.set&&(t[a]=n,gr(()=>{t[a]=null}))}function Ki(t,a){return t===a||t?.[Kn]===a}function _s(t={},a,n,r){return Lo(()=>{var s,o;return js(()=>{s=o,o=[],i(()=>{t!==n(...o)&&(a(t,...o),s&&Ki(n(...s),t)&&a(null,...s))})}),()=>{Vs(()=>{o&&Ki(n(...o),t)&&a(null,...o)})}}),t}function ln(t=!1){const a=va,n=a.l.u;if(!n)return;let r=()=>D(a.s);if(t){let s=0,o={};const l=Vr(()=>{let u=!1;const d=a.s;for(const m in d)d[m]!==o[m]&&(o[m]=d[m],u=!0);return u&&s++,s});r=()=>e(l)}n.b.length&&Tc(()=>{Gi(a,r),Nr(n.b)}),ci(()=>{const s=i(()=>n.m.map(El));return()=>{for(const o of s)typeof o=="function"&&o()}}),n.a.length&&ci(()=>{Gi(a,r),Nr(n.a)})}function Gi(t,a){if(t.l.s)for(const n of t.l.s)e(n);a()}function Ci(t,a,n){if(t==null)return a(void 0),n&&n(void 0),ns;const r=i(()=>t.subscribe(a,n));return r.unsubscribe?()=>r.unsubscribe():r}const $s=[];function Vc(t,a){return{subscribe:Sa(t,a).subscribe}}function Sa(t,a=ns){let n=null;const r=new Set;function s(u){if(fo(t,u)&&(t=u,n)){const d=!$s.length;for(const m of r)m[1](),$s.push(m,t);if(d){for(let m=0;m<$s.length;m+=2)$s[m][0]($s[m+1]);$s.length=0}}}function o(u){s(u(t))}function l(u,d=ns){const m=[u,d];return r.add(m),r.size===1&&(n=a(s,o)||ns),u(t),()=>{r.delete(m),r.size===0&&n&&(n(),n=null)}}return{set:s,update:o,subscribe:l}}function Pn(t,a,n){const r=!Array.isArray(t),s=r?[t]:t;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const o=a.length<2;return Vc(n,(l,u)=>{let d=!1;const m=[];let y=0,p=ns;const h=()=>{if(y)return;p();const v=a(r?m[0]:m,l,u);o?l(v):p=typeof v=="function"?v:ns},f=s.map((v,k)=>Ci(v,T=>{m[k]=T,y&=~(1<<k),d&&h()},()=>{y|=1<<k}));return d=!0,h(),function(){Nr(f),p(),d=!1}})}function sn(t){let a;return Ci(t,n=>a=n)(),a}let Ar=!1,hi=Symbol();function Xt(t,a,n){const r=n[a]??={store:null,source:N(void 0),unsubscribe:ns};if(r.store!==t&&!(hi in n))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=ns;else{var s=!0;r.unsubscribe=Ci(t,o=>{s?r.source.v=o:g(r.source,o)}),s=!1}return t&&hi in n?sn(t):e(r.source)}function jc(t,a){return t.set(a),a}function As(){const t={};function a(){gr(()=>{for(var n in t)t[n].unsubscribe();no(t,hi,{enumerable:!1,value:!0})})}return[t,a]}function Jc(t){var a=Ar;try{return Ar=!1,[t(),Ar]}finally{Ar=a}}function Ae(t,a,n,r){var s=!Xs||(n&Gl)!==0,o=(n&Xl)!==0,l=(n&Vl)!==0,u=r,d=!0,m=()=>(d&&(d=!1,u=l?i(r):r),u),y;if(o){var p=Kn in t||Ml in t;y=ps(t,a)?.set??(p&&a in t?E=>t[a]=E:void 0)}var h,f=!1;o?[h,f]=Jc(()=>t[a]):h=t[a],h===void 0&&r!==void 0&&(h=m(),y&&(s&&Nl(),y(h)));var v;if(s?v=()=>{var E=t[a];return E===void 0?m():(d=!0,E)}:v=()=>{var E=t[a];return E!==void 0&&(u=void 0),E===void 0?u:E},s&&(n&zl)===0)return v;if(y){var k=t.$$legacy;return(function(E,S){return arguments.length>0?((!s||!S||k||f)&&y(S?v():E),E):v()})}var T=!1,A=((n&Kl)!==0?Vr:Me)(()=>(T=!1,v()));o&&e(A);var P=na;return(function(E,S){if(arguments.length>0){const R=S?e(A):s&&o?Ws(E):E;return g(A,R),T=!0,u!==void 0&&(u=R),E}return os&&T||(P.f&Un)!==0?A.v:e(A)})}function Cs(t){va===null&&Ti(),Xs&&va.l!==null?Qc(va).m.push(t):ci(()=>{const a=i(t);if(typeof a=="function")return a})}function Qo(t){va===null&&Ti(),Cs(()=>()=>i(t))}function Zc(t,a,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:a,bubbles:n,cancelable:r})}function el(){const t=va;return t===null&&Ti(),(a,n,r)=>{const s=t.s.$$events?.[a];if(s){const o=Gr(s)?s.slice():[s],l=Zc(a,n,r);for(const u of o)u.call(t.x,l);return!l.defaultPrevented}return!0}}function Qc(t){var a=t.l;return a.u??={a:[],b:[],m:[]}}const eu="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(eu);tc();function tu(t,a,n,r){const s=Ys(n,r,t),o=Ys(n,r,a),l=Ys(t,a,n),u=Ys(t,a,r);return!!((s>0&&o<0||s<0&&o>0)&&(l>0&&u<0||l<0&&u>0)||s===0&&Cr(n,r,t)||o===0&&Cr(n,r,a)||l===0&&Cr(t,a,n)||u===0&&Cr(t,a,r))}function Ys(t,a,n){return(n.x-t.x)*(a.y-t.y)-(a.x-t.x)*(n.y-t.y)}function Cr(t,a,n){return Math.min(t.x,a.x)<=n.x&&n.x<=Math.max(t.x,a.x)&&Math.min(t.y,a.y)<=n.y&&n.y<=Math.max(t.y,a.y)}function zi(t,a,n,r=16){const s=[];for(let o=0;o<r;o++){const l=2*Math.PI*o/r;s.push({x:t+n*Math.cos(l),y:a+n*Math.sin(l)})}return s}function au(t,a,n,r,s=0,o=16){const l=[],u=2*(n+r),d=s*Math.PI/180,m=Math.cos(d),y=Math.sin(d),p=o/u,h=Math.max(1,Math.round(n*p)),f=Math.max(1,Math.round(r*p)),v=n/2,k=r/2,T=[];for(let A=0;A<h;A++){const P=A/h;T.push({x:-v+n*P,y:-k})}for(let A=0;A<f;A++){const P=A/f;T.push({x:v,y:-k+r*P})}for(let A=0;A<h;A++){const P=A/h;T.push({x:v-n*P,y:k})}for(let A=0;A<f;A++){const P=A/f;T.push({x:-v,y:k-r*P})}for(const A of T)l.push({x:t+A.x*m-A.y*y,y:a+A.x*y+A.y*m});if(l.length>o){const A=[],P=l.length/o;for(let E=0;E<o;E++)A.push(l[Math.floor(E*P)]);return A}return l}function nu(t,a,n,r,s=0,o=16){const l=[],u=s*Math.PI/180,d=Math.cos(u),m=Math.sin(u);for(let y=0;y<o;y++){const p=2*Math.PI*y/o,h=n*Math.cos(p),f=r*Math.sin(p);l.push({x:t+h*d-f*m,y:a+h*m+f*d})}return l}function Xi(t,a,n){const r=n.length;for(let s=0;s<r;s++){const o=n[s],l=n[(s+1)%r];if(tu(t,a,o,l))return!0}return!1}function tl(t,a,n){const r=n*Math.PI/180,s=Math.cos(r),o=Math.sin(r),l=t.x-a.x,u=t.y-a.y;return{x:a.x+l*s-u*o,y:a.y+l*o+u*s}}function al(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function ws(t){const a=al(t),n=t.rotation||0;return[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}].map(s=>tl(s,a,n))}function su(t){const s=t.x,o=t.y+t.height;return[{x:s,y:o},{x:s,y:o-8},{x:s+.5,y:o-8},{x:s+.5,y:o-.5},{x:s+4,y:o-.5},{x:s+4,y:o}]}function ru(t){const a=su(t),n=al(t),r=t.rotation||0;return a.map(s=>tl(s,n,r))}function Fr(t,a){const n=a.length;let r=null;for(let s=0;s<n;s++){const o=a[s],l=a[(s+1)%n],u=(l.x-o.x)*(t.y-o.y)-(l.y-o.y)*(t.x-o.x);if(u!==0){const d=u>0;if(r===null)r=d;else if(r!==d)return!1}}return!0}function iu(t,a,n,r,s=.01){const o=Math.abs(Ys(t,a,n)),l=Math.abs(Ys(t,a,r)),u=Math.sqrt((a.x-t.x)**2+(a.y-t.y)**2),d=s*u;if(o>d||l>d)return!1;const m=a.x-t.x,y=a.y-t.y,p=Math.sqrt(m*m+y*y);if(p<s)return!1;const h=m/p,f=y/p,v=0,k=p,T=(n.x-t.x)*h+(n.y-t.y)*f,A=(r.x-t.x)*h+(r.y-t.y)*f,P=Math.min(v,k),E=Math.max(v,k),S=Math.min(T,A),R=Math.max(T,A),L=Math.max(P,S);return Math.min(E,R)-L>s}function ou(t,a,n=.1){const r=t.length,s=a.length;for(let o=0;o<r;o++){const l=t[o],u=t[(o+1)%r];for(let d=0;d<s;d++){const m=a[d],y=a[(d+1)%s];if(iu(l,u,m,y,n))return!0}}return!1}function lu(t){const a=t.length;if(a===0)return new Map;const n=Array.from({length:a},(u,d)=>d);function r(u){return n[u]!==u&&(n[u]=r(n[u])),n[u]}function s(u,d){const m=r(u),y=r(d);m!==y&&(n[m]=y)}for(let u=0;u<a;u++)for(let d=u+1;d<a;d++)ou(t[u].vertices,t[d].vertices)&&s(u,d);const o=new Map;t.forEach((u,d)=>o.set(u.id,d));const l=new Map;return t.forEach((u,d)=>{l.set(u.id,r(d))}),l}function cu(t,a,n){const r=a.get(t);return r===void 0?[t]:n.filter(s=>a.get(s.id)===r).map(s=>s.id)}const Er=16;function Br(t){return t.isRectangle&&t.width!==void 0&&t.height!==void 0?au(t.x,t.y,t.width,t.height,t.rotation||0,Er):t.radius!==void 0?zi(t.x,t.y,t.radius,Er):t.rx!==void 0&&t.ry!==void 0?nu(t.x,t.y,t.rx,t.ry,t.rotation||0,Er):zi(t.x,t.y,.5,Er)}function uu(t,a){const n=Br(t);for(const r of n)if(Fr(r,a))return!0;return!!Fr({x:t.x,y:t.y},a)}function du(t,a){if(!Fr({x:t.x,y:t.y},a))return!1;const n=Br(t);for(const r of n)if(!Fr(r,a))return!1;return!0}function nl(t,a,n,r){const s=Br(t),o=Br(a),l=lu(n),u=new Set;for(const p of n){const h=du(t,p.vertices),f=uu(a,p.vertices);if(h||f){const v=cu(p.id,l,n);for(const k of v)u.add(k)}}const d=[];let m=!1,y=null;for(const p of s)for(const h of o){const f={from:p,to:h,blocked:!1,blockedBy:null};let v=!1;for(const T of n)if(!u.has(T.id)&&Xi(p,h,T.vertices)){f.blocked=!0,f.blockedBy="terrain",v=!0;break}if(v){d.push(f);continue}let k=!1;for(const T of r)if(Xi(p,h,T)){f.blocked=!0,f.blockedBy="wall",k=!0;break}k||(f.blocked=!1,m||(y=f),m=!0),d.push(f)}return{canSee:m,rays:d,firstClearRay:y,terrainsIgnored:Array.from(u)}}function sl(t,a,n,r){const s=[];let o=null,l=!1;for(const u of t)for(const d of a){const m=nl(u,d,n,r);s.push({modelA:u,modelB:d,...m}),m.canSee&&!l&&(l=!0,o=m)}return{canSee:l,firstClearResult:o,allResults:s}}const yt={width:60,height:44},rl=Sa([{id:"terrain1",x:20,y:16,width:6,height:12,rotation:0},{id:"terrain2",x:34,y:10,width:6,height:12,rotation:45},{id:"terrain3",x:44,y:20,width:6,height:12,rotation:-30}]);Pn(rl,t=>t.map(a=>ru(a)));Pn(rl,t=>t.map(a=>({id:a.id,vertices:ws(a)})));const Vi=Sa(!1),ne={player1:{primary:"#3b82f6",fill:"rgba(59, 130, 246, 0.5)",fillLight:"rgba(59, 130, 246, 0.3)",fillLighter:"rgba(59, 130, 246, 0.15)",zone:"rgba(59, 130, 246, 0.1)"},player2:{primary:"#ef4444",fill:"rgba(239, 68, 68, 0.5)",fillLight:"rgba(239, 68, 68, 0.3)",fillLighter:"rgba(239, 68, 68, 0.15)",zone:"rgba(239, 68, 68, 0.1)"},battlefield:{background:"#738973ff",gridFine:"#3a4a3a8c",gridCoarse:"#5a6a5a",ruler:"#666",rulerText:"#888",rulerBackground:"#1a1a1a"},terrain:{fill:"rgba(139, 90, 43, 0.3)",fillSelected:"rgba(59, 130, 246, 0.3)",fillStatic:"rgba(139, 90, 43, 0.6)",stroke:"#8b5a2b"},wall:{fill:"rgba(139, 69, 19, 0.8)",fillSelected:"rgba(139, 69, 19, 0.6)",stroke:"#5c3317"},objective:{primary:"#fbbf24",primaryControl:"rgba(251, 191, 36, 0.15)",secondary:"#9ca3af",secondaryControl:"rgba(156, 163, 175, 0.15)",center:"#000"},los:{visible:"#22c55e",blocked:"#ef4444",rayVisible:"#00ff0033",rayBlocked:"#ff000033"},selection:{highlight:"#3b82f6",highlightDark:"#1d4ed8",handle:"#9333ea",handleDark:"#7e22ce",dragRuler:"#fbbf24"}};function fr(t){return t===1?ne.player1:ne.player2}const il=1/25.4,Jr=40*il/2,Zr=3+20*il;function ol(t="item"){return t+"-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function hu(){const{subscribe:t,set:a,update:n}=Sa([]);return{subscribe:t,set:a,update:n,add(r){const s=ol("zone");return n(o=>[...o,{id:s,...r}]),s},updateZone(r,s){n(o=>o.map(l=>l.id===r?{...l,...s}:l))},remove(r){n(s=>s.filter(o=>o.id!==r))},clear(){a([])}}}function mu(){const{subscribe:t,set:a,update:n}=Sa([]);return{subscribe:t,set:a,update:n,add(r,s,o=!1){const l=ol("obj"),u=Math.round(r),d=Math.round(s);return n(m=>[...m,{id:l,x:u,y:d,isPrimary:o}]),l},updateObjective(r,s){n(o=>o.map(l=>l.id===r?{...l,...s}:l))},remove(r){n(s=>s.filter(o=>o.id!==r))},clear(){a([])}}}hu();mu();const ll=[{name:"Dawn of War",zones:[{name:"Player 1",color:ne.player1.zone,borderColor:ne.player1.primary,path:[{type:"M",x:0,y:32},{type:"L",x:60,y:32},{type:"L",x:60,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:ne.player2.zone,borderColor:ne.player2.primary,path:[{type:"M",x:0,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:12},{type:"L",x:0,y:12},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1}]},{name:"Hammer and Anvil",zones:[{name:"Player 1",color:ne.player1.zone,borderColor:ne.player1.primary,path:[{type:"M",x:0,y:0},{type:"L",x:18,y:0},{type:"L",x:18,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:ne.player2.zone,borderColor:ne.player2.primary,path:[{type:"M",x:42,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:42,y:44},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1}]},{name:"Tipping Point",zones:[{name:"Player 1",color:ne.player1.zone,borderColor:ne.player1.primary,path:[{type:"M",x:0,y:0},{type:"L",x:12,y:0},{type:"L",x:12,y:22},{type:"L",x:20,y:22},{type:"L",x:20,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:ne.player2.zone,borderColor:ne.player2.primary,path:[{type:"M",x:40,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:48,y:44},{type:"L",x:48,y:22},{type:"L",x:40,y:22},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:34,isPrimary:!1},{x:22,y:8,isPrimary:!1},{x:38,y:36,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Search and Destroy",zones:[{name:"Player 1",color:ne.player1.zone,borderColor:ne.player1.primary,path:[{type:"M",x:0,y:22},{type:"L",x:21,y:22},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:0,x:30,y:31},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:ne.player2.zone,borderColor:ne.player2.primary,path:[{type:"M",x:30,y:0},{type:"L",x:30,y:13},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:1,x:39,y:22},{type:"L",x:60,y:22},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:10,isPrimary:!1},{x:46,y:34,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Sweeping Engagement",zones:[{name:"Player 1",color:ne.player1.zone,borderColor:ne.player1.primary,path:[{type:"M",x:0,y:0},{type:"L",x:0,y:8},{type:"L",x:30,y:8},{type:"L",x:30,y:14},{type:"L",x:60,y:14},{type:"L",x:60,y:0},{type:"Z"}]},{name:"Player 2",color:ne.player2.zone,borderColor:ne.player2.primary,path:[{type:"M",x:0,y:44},{type:"L",x:60,y:44},{type:"L",x:60,y:36},{type:"L",x:30,y:36},{type:"L",x:30,y:30},{type:"L",x:0,y:30},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:18,isPrimary:!1},{x:50,y:26,isPrimary:!1},{x:18,y:38,isPrimary:!1},{x:42,y:6,isPrimary:!1}]},{name:"Crucible of Battle",zones:[{name:"Player 1",color:ne.player1.zone,borderColor:ne.player1.primary,path:[{type:"M",x:0,y:0},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:ne.player2.zone,borderColor:ne.player2.primary,path:[{type:"M",x:60,y:44},{type:"L",x:30,y:0},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:20,y:8,isPrimary:!1},{x:40,y:36,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]}];function Ss(t){return t.map(a=>{switch(a.type){case"M":return`M ${a.x} ${a.y}`;case"L":return`L ${a.x} ${a.y}`;case"A":return`A ${a.rx} ${a.ry} ${a.rotation} ${a.largeArc} ${a.sweep} ${a.x} ${a.y}`;case"Z":return"Z";default:return""}}).join(" ")}const cl="warhammer-deployment-layouts",ul=[{label:'6" x 12"',width:6,height:12},{label:'5" x 10"',width:5,height:10},{label:'4" x 6"',width:4,height:6}],dl=[{label:"L 4x8",shape:"L-4x8"},{label:"L 4x8 ⌐",shape:"L-4x8-mirror"},{label:"C 4-8-4",shape:"C-4-8-4"},{label:"L 5x6",shape:"L-5x6"},{label:"L 5x6 ⌐",shape:"L-5x6-mirror"},{label:"L 4x6",shape:"L-4x6"},{label:"L 4x6 ⌐",shape:"L-4x6-mirror"}],hl=[{id:"gw",name:"GW",description:"Games Workshop official layouts",presets:[{name:"Layout 1",terrains:[{id:"a",x:28,y:0,width:4,height:6,rotation:0},{id:"b",x:28,y:38,width:4,height:6,rotation:0},{id:"c",x:6,y:5,width:6,height:12,rotation:0},{id:"d",x:48,y:27,width:6,height:12,rotation:0},{id:"e",x:16,y:28,width:6,height:12,rotation:0},{id:"f",x:7,y:19,width:6,height:12,rotation:90},{id:"g",x:38,y:4,width:6,height:12,rotation:0},{id:"h",x:47,y:13,width:6,height:12,rotation:90},{id:"i",x:32.74,y:23.59,width:5,height:10,rotation:135},{id:"j",x:35.06,y:19.5,width:4,height:6,rotation:45},{id:"k",x:22.07,y:10.17,width:5,height:10,rotation:-45},{id:"l",x:20.72,y:18.23,width:4,height:6,rotation:45}],walls:[{id:"wa",x:38,y:6,shape:"C-4-8-4",rotation:0},{id:"wb",x:18,y:30,shape:"C-4-8-4",rotation:180},{id:"wc",x:13.33,y:20.15,shape:"L-4x8-mirror",rotation:-90},{id:"wd",x:49.67,y:15.93,shape:"L-4x8-mirror",rotation:90},{id:"we",x:48.2,y:30.88,shape:"L-4x8",rotation:0},{id:"wf",x:7.84,y:5.01,shape:"L-4x8",rotation:180},{id:"wg",x:27.06,y:11.52,shape:"L-4x8-mirror",rotation:-45},{id:"wh",x:35.81,y:24.24,shape:"L-4x8-mirror",rotation:135}]},{name:"Layout 2",terrains:[{id:"a",x:31,y:7,width:4,height:6,rotation:-90},{id:"b",x:25,y:30,width:4,height:6,rotation:90},{id:"c",x:5,y:4,width:6,height:12,rotation:0},{id:"d",x:49,y:28,width:6,height:12,rotation:0},{id:"e",x:46,y:4,width:6,height:12,rotation:0},{id:"f",x:16.46,y:15.77,width:6,height:12,rotation:132.1},{id:"g",x:53,y:15,width:4,height:6,rotation:90},{id:"h",x:8,y:28,width:6,height:12,rotation:0},{id:"i",x:3,y:23,width:4,height:6,rotation:90},{id:"j",x:32.62,y:32.55,width:5,height:10,rotation:-90},{id:"k",x:22.48,y:.51,width:5,height:10,rotation:-90},{id:"l",x:37.5,y:16.2,width:6,height:12,rotation:132.1}],walls:[{id:"wa",x:49,y:32,shape:"L-4x8",rotation:0},{id:"wb",x:7,y:4,shape:"L-4x8",rotation:180},{id:"wc",x:46,y:8,shape:"L-4x8",rotation:0},{id:"wd",x:10,y:28,shape:"L-4x8",rotation:180},{id:"we",x:35.07,y:34.56,shape:"L-5x6-mirror",rotation:-90},{id:"wf",x:29.09,y:2.47,shape:"L-5x6-mirror",rotation:90},{id:"wg",x:17.86,y:17.53,shape:"C-4-8-4",rotation:135},{id:"wh",x:37.24,y:18.38,shape:"C-4-8-4",rotation:-45}]},{name:"Layout 3",terrains:[{id:"a",x:11,y:3,width:4,height:6,rotation:90},{id:"b",x:45,y:35,width:4,height:6,rotation:90},{id:"c",x:25,y:1,width:6,height:12,rotation:90},{id:"d",x:29,y:31,width:6,height:12,rotation:90},{id:"e",x:7.74,y:26.05,width:6,height:12,rotation:125.31},{id:"f",x:46.34,y:5.51,width:6,height:12,rotation:121.72},{id:"g",x:5.14,y:10.46,width:6,height:12,rotation:41.51},{id:"h",x:48.67,y:21.52,width:6,height:12,rotation:41.51},{id:"i",x:19.59,y:14.36,width:5,height:10,rotation:-38.13},{id:"j",x:20.69,y:24.37,width:4,height:6,rotation:-39.33},{id:"k",x:35.34,y:19.61,width:5,height:10,rotation:-38.13},{id:"l",x:35.31,y:13.5,width:4,height:6,rotation:-39.33}],walls:[{id:"aa",x:30,y:32,shape:"C-4-8-4",rotation:90},{id:"ab",x:26,y:4,shape:"C-4-8-4",rotation:-90},{id:"ac",x:8.19,y:11.64,shape:"L-4x8",rotation:222.46},{id:"ad",x:47.79,y:24.3,shape:"L-4x8",rotation:41.26},{id:"ae",x:38.64,y:20.09,shape:"L-5x6-mirror",rotation:141.31},{id:"af",x:25.26,y:17.9,shape:"L-5x6-mirror",rotation:-37.61},{id:"ag",x:14.37,y:28.38,shape:"L-4x8-mirror",rotation:-54.26},{id:"ah",x:48.75,y:7.3,shape:"L-4x8-mirror",rotation:122.02}]},{name:"Layout 4",terrains:[{id:"a",x:15,y:1,width:6,height:12,rotation:90},{id:"b",x:8,y:10,width:4,height:6,rotation:0},{id:"c",x:4,y:19,width:4,height:6,rotation:0},{id:"d",x:7.5,y:27.68,width:6,height:12,rotation:-48.57},{id:"e",x:46.53,y:4.24,width:6,height:12,rotation:-48.57},{id:"f",x:52,y:19,width:4,height:6,rotation:0},{id:"g",x:48,y:28,width:4,height:6,rotation:0},{id:"h",x:39,y:31,width:6,height:12,rotation:90},{id:"i",x:33.03,y:2.97,width:6,height:12,rotation:-37.25},{id:"j",x:20.96,y:28.96,width:6,height:12,rotation:-37.25},{id:"k",x:16.93,y:16.51,width:5,height:10,rotation:-41.85},{id:"l",x:37.96,y:17.43,width:5,height:10,rotation:-41.85}],walls:[{id:"aa",x:18,y:4,shape:"L-4x8",rotation:-90},{id:"ab",x:9.04,y:29.01,shape:"C-4-8-4",rotation:131.97},{id:"ac",x:47,y:7,shape:"C-4-8-4",rotation:-48.54},{id:"ad",x:38,y:32,shape:"L-4x8",rotation:90},{id:"ae",x:34.42,y:7.12,shape:"L-4x8",rotation:-37.53},{id:"af",x:21.57,y:28.8,shape:"L-4x8",rotation:142.46},{id:"ag",x:15.7,y:17.01,shape:"L-5x6",rotation:137.87},{id:"ah",x:39.17,y:20.85,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 5",terrains:[{id:"aa",x:27,y:1,width:6,height:12,rotation:90},{id:"ab",x:36.53,y:12.48,width:5,height:10,rotation:-90},{id:"ac",x:13,y:3,width:4,height:6,rotation:90},{id:"ad",x:43,y:35,width:4,height:6,rotation:90},{id:"ae",x:27,y:31,width:6,height:12,rotation:90},{id:"af",x:18.43,y:21.49,width:5,height:10,rotation:-90},{id:"ag",x:1,y:23,width:4,height:6,rotation:90},{id:"ah",x:55,y:15,width:4,height:6,rotation:90},{id:"ai",x:7.83,y:30.22,width:6,height:12,rotation:-60},{id:"aj",x:46.32,y:1.58,width:6,height:12,rotation:-60},{id:"ak",x:8.74,y:10.19,width:6,height:12,rotation:65.22},{id:"al",x:45.22,y:21.75,width:6,height:12,rotation:65.22}],walls:[{id:"a1",x:28,y:32,shape:"C-4-8-4",rotation:90},{id:"a2",x:28,y:4,shape:"C-4-8-4",rotation:-90},{id:"a3",x:11.88,y:12.29,shape:"L-4x8",rotation:-114.74},{id:"a4",x:43.97,y:23.59,shape:"L-4x8",rotation:64.22},{id:"a5",x:24.91,y:23.52,shape:"L-5x6-mirror",rotation:-90.37},{id:"a6",x:39,y:14.51,shape:"L-5x6-mirror",rotation:89.9},{id:"a7",x:7.58,y:30.57,shape:"L-4x8",rotation:120.93},{id:"a8",x:48.51,y:5.28,shape:"L-4x8",rotation:-59.06}]},{name:"Layout 6",terrains:[{id:"aa",x:13,y:1,width:6,height:12,rotation:90},{id:"ab",x:6,y:10,width:4,height:6,rotation:0},{id:"ac",x:25,y:11,width:4,height:6,rotation:90},{id:"ad",x:7.34,y:27.57,width:6,height:12,rotation:-40.32},{id:"ae",x:46.69,y:4.57,width:6,height:12,rotation:-41.9},{id:"af",x:31,y:27,width:4,height:6,rotation:-90},{id:"ag",x:50,y:28,width:4,height:6,rotation:0},{id:"ah",x:41,y:31,width:6,height:12,rotation:90},{id:"ai",x:34,y:4,width:6,height:12,rotation:0},{id:"aj",x:20,y:28,width:6,height:12,rotation:0},{id:"ak",x:15.7,y:15.03,width:5,height:10,rotation:-41.85},{id:"al",x:39.43,y:19.24,width:5,height:10,rotation:-39.95}],walls:[{id:"a1",x:16,y:4,shape:"L-4x8",rotation:-90},{id:"a2",x:9.04,y:29.01,shape:"C-4-8-4",rotation:140.05},{id:"a3",x:47,y:7.16,shape:"C-4-8-4",rotation:-41.53},{id:"a4",x:40,y:32,shape:"L-4x8",rotation:90},{id:"a5",x:34.15,y:7.88,shape:"L-4x8",rotation:0},{id:"a6",x:22,y:28,shape:"L-4x8",rotation:180},{id:"a7",x:14.47,y:15.47,shape:"L-5x6",rotation:137.87},{id:"a8",x:40.53,y:22.78,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 7",terrains:[{id:"aa",x:8,y:8,width:6,height:12,rotation:0},{id:"ab",x:6,y:28,width:6,height:12,rotation:0},{id:"ac",x:7,y:39,width:4,height:6,rotation:90},{id:"ad",x:18,y:26,width:5,height:10,rotation:0},{id:"ae",x:19,y:20,width:4,height:6,rotation:0},{id:"af",x:23,y:3,width:6,height:12,rotation:0},{id:"ag",x:31,y:29,width:6,height:12,rotation:0},{id:"ah",x:37,y:18,width:4,height:6,rotation:0},{id:"ai",x:37,y:8,width:5,height:10,rotation:0},{id:"aj",x:46,y:24,width:6,height:12,rotation:0},{id:"ak",x:48,y:4,width:6,height:12,rotation:0},{id:"al",x:49,y:-1,width:4,height:6,rotation:90}],walls:[{id:"a1",x:9,y:10,shape:"L-5x6",rotation:180},{id:"a2",x:11.44,y:31.97,shape:"L-4x8-mirror",rotation:0},{id:"a3",x:19,y:20,shape:"L-4x6",rotation:180},{id:"a4",x:22.53,y:30.02,shape:"L-5x6-mirror",rotation:0},{id:"a5",x:25,y:5,shape:"C-4-8-4",rotation:180},{id:"a6",x:31,y:31,shape:"C-4-8-4",rotation:0},{id:"a7",x:37,y:18,shape:"L-4x6",rotation:0},{id:"a8",x:41.51,y:8.09,shape:"L-5x6-mirror",rotation:180},{id:"a9",x:46,y:28,shape:"L-5x6",rotation:0},{id:"a10",x:51.51,y:4.01,shape:"L-4x8-mirror",rotation:180}]},{name:"Layout 8",terrains:[{id:"aa",x:23,y:22,width:4,height:6,rotation:0},{id:"ab",x:23,y:28,width:4,height:6,rotation:0},{id:"ac",x:33,y:16,width:4,height:6,rotation:0},{id:"ad",x:33,y:10,width:4,height:6,rotation:0},{id:"ae",x:41,y:19,width:6,height:12,rotation:0},{id:"af",x:13,y:13,width:6,height:12,rotation:0},{id:"ag",x:32,y:32,width:6,height:12,rotation:0},{id:"ah",x:22,y:0,width:6,height:12,rotation:0},{id:"ai",x:9.5,y:27.68,width:6,height:12,rotation:-48.69},{id:"aj",x:44.51,y:4.35,width:6,height:12,rotation:-48.69},{id:"ak",x:6.95,y:4,width:5,height:10,rotation:53.9},{id:"al",x:48,y:30,width:5,height:10,rotation:53.9}],walls:[{id:"a1",x:32,y:34,shape:"C-4-8-4",rotation:0},{id:"a2",x:24,y:2,shape:"C-4-8-4",rotation:180},{id:"a3",x:44.68,y:19.06,shape:"L-4x8-mirror",rotation:180},{id:"a4",x:18.43,y:16.91,shape:"L-4x8-mirror",rotation:0},{id:"a5",x:46.38,y:33.13,shape:"L-5x6",rotation:52.87},{id:"a6",x:8.55,y:4.89,shape:"L-5x6",rotation:-127.66},{id:"a7",x:16,y:30.28,shape:"L-4x8-mirror",rotation:-48.62},{id:"a8",x:46.91,y:5.85,shape:"L-4x8-mirror",rotation:132.19}]}]},{id:"uktc",name:"UKTC",description:"UK Team Championship layouts",presets:[{name:"UKTC 1",terrains:[{id:"a",x:15,y:16,width:6,height:12,rotation:0},{id:"b",x:39,y:16,width:6,height:12,rotation:0}],walls:[]},{name:"UKTC 2",terrains:[{id:"a",x:15,y:16,width:6,height:12,rotation:0},{id:"b",x:39,y:16,width:6,height:12,rotation:0}],walls:[]}]},{id:"wtc",name:"WTC",description:"World Team Championship layouts",presets:[{name:"WTC 1",terrains:[{id:"a",x:15,y:16,width:6,height:12,rotation:0},{id:"b",x:39,y:16,width:6,height:12,rotation:0}],walls:[]},{name:"WTC 2",terrains:[{id:"a",x:15,y:16,width:6,height:12,rotation:0},{id:"b",x:39,y:16,width:6,height:12,rotation:0}],walls:[]}]}],ml=hl.flatMap(t=>t.presets);function fu(){return"terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Bn(){const t=localStorage.getItem(cl);if(t)try{return JSON.parse(t)}catch(a){return console.error("Failed to parse saved layouts:",a),{}}return{}}function qr(t){localStorage.setItem(cl,JSON.stringify(t))}function fl(){const{subscribe:t,set:a,update:n}=Sa([]);return{subscribe:t,set:a,update:n,add(r,s){n(o=>[...o,{id:fu(),x:30-r/2,y:22-s/2,width:r,height:s,rotation:0}])},updateTerrain(r,s){n(o=>o.map(l=>l.id===r?{...l,...s}:l))},remove(r){n(s=>s.filter(o=>o.id!==r))},clear(){a([])},save(r){const s=sn({subscribe:t}),o=Bn();o[r]={terrains:s,savedAt:Date.now()},qr(o)},load(r){const s=Bn();return s[r]?(a(s[r].terrains),!0):!1},deleteLayout(r){const s=Bn();delete s[r],qr(s)},getSavedLayoutNames(){const r=Bn();return Object.keys(r).map(s=>({name:s,savedAt:r[s].savedAt,terrainCount:r[s].terrains.length})).sort((s,o)=>o.savedAt-s.savedAt)},hasSaved(){const r=Bn();return Object.keys(r).length>0}}}const xn=fl();function pl(){const{subscribe:t,set:a,update:n}=Sa([]);return{subscribe:t,set:a,update:n,add(r){n(s=>[...s,{id:"wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),x:30,y:22,shape:r,rotation:0}])},updateWall(r,s){n(o=>o.map(l=>l.id===r?{...l,...s}:l))},remove(r){n(s=>s.filter(o=>o.id!==r))},clear(){a([])}}}const _n=pl(),Mr=fl(),Rr=pl(),nr=Sa(null),sr=Sa(null);function Lr(t){const a=t.includes("-mirror"),n=t.replace("-mirror","");if(n.startsWith("L-")){const r=n.match(/L-(\d+)x(\d+)/);if(r)return{type:"L",segments:[parseInt(r[1]),parseInt(r[2])],mirrored:a}}else if(n.startsWith("C-")){const r=n.match(/C-(\d+)-(\d+)-(\d+)/);if(r)return{type:"C",segments:[parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],mirrored:a}}return{type:"L",segments:[4,8],mirrored:!1}}function Cn(t,a=null){const s=Lr(t),o=a||s.segments,l=s.mirrored;if(s.type==="L"){const[u,d]=o;return l?[{x:0,y:0},{x:.5,y:0},{x:.5,y:d},{x:-u+.5,y:d},{x:-u+.5,y:d-.5},{x:0,y:d-.5}]:[{x:0,y:0},{x:.5,y:0},{x:.5,y:d-.5},{x:u,y:d-.5},{x:u,y:d},{x:0,y:d}]}else if(s.type==="C"){const[u,d,m]=o;return[{x:0,y:0},{x:m,y:0},{x:m,y:.5},{x:.5,y:.5},{x:.5,y:d-.5},{x:u,y:d-.5},{x:u,y:d},{x:0,y:d}]}return[]}function br(t,a,n,r){if(t.length===0)return[];const s=t.map(A=>A.x),o=t.map(A=>A.y),l=Math.min(...s),u=Math.max(...s),d=Math.min(...o),m=Math.max(...o),y=u-l,p=m-d,h=a+l+y/2,f=n+d+p/2,v=r*Math.PI/180,k=Math.cos(v),T=Math.sin(v);return t.map(A=>{const P=a+A.x,E=n+A.y,S=P-h,R=E-f;return{x:h+S*k-R*T,y:f+S*T+R*k}})}Pn(_n,t=>t.map(a=>br(Cn(a.shape,a.segments),a.x,a.y,a.rotation)));const Nn=Sa(null),On=Sa(null),Ei=Sa([]);function pu(t,a=[]){const n=sn(xn),r=sn(_n),s=Bn();s[t]={terrains:n,walls:r,models:a,savedAt:Date.now()},qr(s)}function yu(t){const a=Bn();return a[t]?(xn.set(a[t].terrains||[]),_n.set(a[t].walls||[]),{terrains:a[t].terrains||[],walls:a[t].walls||[],models:a[t].models||[]}):null}function vu(t){const a=Bn();delete a[t],qr(a)}function gu(){const t=Bn();return Object.keys(t).map(a=>({name:a,savedAt:t[a].savedAt,terrainCount:(t[a].terrains||[]).length,wallCount:(t[a].walls||[]).length,modelCount:(t[a].models||[]).length})).sort((a,n)=>n.savedAt-a.savedAt)}function $r(){Ei.set(gu())}function yl(){const{subscribe:t,set:a,update:n}=Sa({past:[],future:[]});return{subscribe:t,push(r){n(s=>({past:[...s.past,r],future:[]}))},undo(){let r=null;return n(s=>{if(s.past.length===0)return s;const o=[...s.past];return r=o.pop(),{past:o,future:[r,...s.future]}}),r},redo(){let r=null;return n(s=>{if(s.future.length===0)return s;const o=[...s.future];return r=o.shift(),{past:[...s.past,r],future:o}}),r},canUndo(){return sn({subscribe:t}).past.length>0},canRedo(){return sn({subscribe:t}).future.length>0},clear(){a({past:[],future:[]})}}}const Ya=yl(),mi=yl(),bu=2;function Tu(t,a){const n=Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.y-a.y,2)),r=ji(t),s=ji(a);return Math.max(0,n-r-s)}function ji(t){const a=_a(t.baseType,t);return a?Ha(t.baseType)?Math.min(t.customWidth,t.customHeight)/2:ya(t.baseType)?Math.min(a.width,a.height)/2:a.radius:.5}function xu(t){const a=new Map;for(const n of t)a.set(n.id,new Set);for(let n=0;n<t.length;n++)for(let r=n+1;r<t.length;r++)Tu(t[n],t[r])<=bu&&(a.get(t[n].id).add(t[r].id),a.get(t[r].id).add(t[n].id));return a}function _u(t,a){const n=new Set,r=[];for(const s of t){if(n.has(s.id))continue;const o=new Set,l=[s.id];for(;l.length>0;){const u=l.shift();if(!n.has(u)){n.add(u),o.add(u);for(const d of a.get(u))n.has(d)||l.push(d)}}r.push(o)}return r}function wu(t){if(t.length<=1)return{isCoherent:!0,violations:new Map};const a=t.length>=7?2:1,n=xu(t),r=_u(t,n),s=new Map;r.length;let o=r[0];for(const l of r)l.size>o.size&&(o=l);for(const l of t){const u=n.get(l.id).size,d=o.has(l.id);u>=a&&d||s.set(l.id,{model:l,requiredCount:a,actualCount:u,isDisconnected:!d,componentSize:r.find(p=>p.has(l.id))?.size||0})}return{isCoherent:s.size===0,violations:s,componentCount:r.length}}function Su(t){const a=new Map,n=new Map;for(const r of t)r.unitId&&(n.has(r.unitId)||n.set(r.unitId,[]),n.get(r.unitId).push(r));for(const[r,s]of n){const o=wu(s),l=s.length>=7?2:1;for(const u of s){const d=o.violations.get(u.id);a.set(u.id,{inCoherency:!d,requiredCount:l,actualCount:d?d.actualCount:l,unitSize:s.length,isDisconnected:d?.isDisconnected||!1,componentCount:o.componentCount})}}return a}const ia=1/25.4,rn={circles:[{type:"25mm",radius:25*ia/2,label:"25mm"},{type:"28.5mm",radius:28.5*ia/2,label:"28mm.5"},{type:"32mm",radius:32*ia/2,label:"32mm"},{type:"40mm",radius:40*ia/2,label:"40mm"},{type:"50mm",radius:50*ia/2,label:"50mm"},{type:"60mm",radius:60*ia/2,label:"60mm"},{type:"80mm",radius:80*ia/2,label:"80mm"},{type:"90mm",radius:90*ia/2,label:"90mm"},{type:"100mm",radius:100*ia/2,label:"100mm"},{type:"130mm",radius:130*ia/2,label:"130mm"},{type:"160mm",radius:160*ia/2,label:"160mm"}],ovals:[{type:"60x35.5mm",width:60*ia,height:35.5*ia,label:"60×35.5mm"},{type:"75x42mm",width:75*ia,height:42*ia,label:"75×42mm"},{type:"Small Flying Base",width:75*ia,height:42*ia,label:"Small Flying"},{type:"90x52.5mm",width:90*ia,height:52.5*ia,label:"90×52.5mm"},{type:"Large Flying Base",width:90*ia,height:52.5*ia,label:"Large Flying"},{type:"105x70mm",width:105*ia,height:70*ia,label:"105×70mm"},{type:"120x92mm",width:120*ia,height:92*ia,label:"120×92mm"},{type:"150x95mm",width:150*ia,height:95*ia,label:"150×95mm"},{type:"170x109mm",width:170*ia,height:109*ia,label:"170×109mm"}]};function _a(t,a=null){const n=rn.circles.find(s=>s.type===t);if(n)return n;const r=rn.ovals.find(s=>s.type===t);return r||(Ha(t)&&a?{type:t,width:a.customWidth,height:a.customHeight,label:`${a.customWidth.toFixed(1)}"×${a.customHeight.toFixed(1)}"`}:null)}function ya(t){return rn.ovals.some(a=>a.type===t)}function Ha(t){return t&&t.startsWith("rect-")}function Ji(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function vl(t){const{subscribe:a,set:n,update:r}=Sa([]);return{subscribe:a,set:n,update:r,add(s,o,l,u,d=null,m=!1){const y=Ji(),p={id:y,baseType:s,playerId:o,x:l,y:u,rotation:0};return d&&d.width&&d.height&&(p.customWidth=d.width,p.customHeight=d.height),r(h=>[...h,p]),!m&&t&&t.push({type:"add",modelId:y,model:{...p}}),y},updateModel(s,o,l=!1){let u=null,d=null;if(!l&&t){const y=sn({subscribe:a}).find(p=>p.id===s);y&&(u={...y},"x"in o||"y"in o?d="move":"rotation"in o&&(d="rotate"))}if(r(m=>m.map(y=>y.id===s?{...y,...o}:y)),!l&&t&&d&&u){const y=sn({subscribe:a}).find(p=>p.id===s);t.push({type:d,modelId:s,before:d==="move"?{x:u.x,y:u.y}:{rotation:u.rotation},after:d==="move"?{x:y.x,y:y.y}:{rotation:y.rotation}})}},remove(s,o=!1){let l=null;!o&&t&&(l=sn({subscribe:a}).find(d=>d.id===s)),r(u=>u.filter(d=>d.id!==s)),!o&&t&&l&&t.push({type:"remove",modelId:s,model:{...l}})},removeByPlayer(s){r(o=>o.filter(l=>l.playerId!==s))},addBatch(s,o=!1){const l=[];return r(u=>{const d=[...u];return s.forEach(m=>{const y=m.id||Ji(),p={...m,id:y};d.push(p),l.push(y),!o&&t&&t.push({type:"add",modelId:y,model:{...p}})}),d}),l},updateUnit(s,o,l=!1){r(u=>u.map(d=>d.unitId===s?{...d,...o}:d))},removeUnit(s,o=!1){const l=[];if(!o&&t){const u=sn({subscribe:a});l.push(...u.filter(d=>d.unitId===s))}r(u=>u.filter(d=>d.unitId!==s)),!o&&t&&l.forEach(u=>{t.push({type:"remove",modelId:u.id,model:{...u}})})},groupModels(s,o=!1){if(s.length<2)return null;const l=sn({subscribe:a}),u=s.map(p=>l.find(h=>h.id===p)).filter(Boolean);if(u.length<2||[...new Set(u.map(p=>p.playerId))].length>1)return null;const m="unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),y={};return u.forEach(p=>{y[p.id]=p.unitId||null}),r(p=>p.map(h=>s.includes(h.id)?{...h,unitId:m}:h)),!o&&t&&t.push({type:"group",modelIds:[...s],unitId:m,previousUnitIds:y}),m},ungroupModels(s,o=!1){const l=sn({subscribe:a}),u={};s.forEach(d=>{const m=l.find(y=>y.id===d);m&&(u[d]=m.unitId||null)}),r(d=>d.map(m=>s.includes(m.id)?{...m,unitId:null}:m)),!o&&t&&t.push({type:"ungroup",modelIds:[...s],previousUnitIds:u})},clear(){n([]),t&&t.clear()},undo(){if(!t)return;const s=t.undo();if(s)switch(s.type){case"add":this.remove(s.modelId,!0);break;case"remove":r(o=>[...o,s.model]);break;case"move":this.updateModel(s.modelId,s.before,!0);break;case"rotate":this.updateModel(s.modelId,s.before,!0);break;case"group":r(o=>o.map(l=>s.modelIds.includes(l.id)?{...l,unitId:s.previousUnitIds[l.id]}:l));break;case"ungroup":r(o=>o.map(l=>s.modelIds.includes(l.id)?{...l,unitId:s.previousUnitIds[l.id]}:l));break}},redo(){if(!t)return;const s=t.redo();if(s)switch(s.type){case"add":r(o=>[...o,s.model]);break;case"remove":this.remove(s.modelId,!0);break;case"move":this.updateModel(s.modelId,s.after,!0);break;case"rotate":this.updateModel(s.modelId,s.after,!0);break;case"group":r(o=>o.map(l=>s.modelIds.includes(l.id)?{...l,unitId:s.unitId}:l));break;case"ungroup":r(o=>o.map(l=>s.modelIds.includes(l.id)?{...l,unitId:null}:l));break}}}}const Tt=vl(Ya),gl=Pn(Tt,t=>t.filter(a=>a.playerId===1)),bl=Pn(Tt,t=>t.filter(a=>a.playerId===2)),ku=Sa(null);Pn([Tt,ku],([t,a])=>a?t.find(n=>n.id===a):null);const Qn=vl(mi),es=Sa(null);Pn([Qn,es],([t,a])=>a?t.find(n=>n.id===a):null);Pn(Tt,t=>{const a=new Map;return t.forEach(n=>{n.unitId&&(a.has(n.unitId)||a.set(n.unitId,{unitId:n.unitId,playerId:n.playerId,models:[]}),a.get(n.unitId).models.push(n))}),Array.from(a.values())});const Au=Pn(Tt,t=>Su(t)),Pr=Sa({zoom:1,panX:0,panY:0});function Cu(){Pr.set({zoom:1,panX:0,panY:0})}var Eu=ce('<line stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-1lx01iv"></circle>',1),Mu=ce('<g><g><rect role="button" tabindex="0" class="svelte-1lx01iv"></rect></g><!></g>');function Ru(t,a){Ja(a,!1);const n=N(),r=N(),s=N(),o=N(),l=N();let u=Ae(a,"id",8),d=Ae(a,"x",8),m=Ae(a,"y",8),y=Ae(a,"width",8),p=Ae(a,"height",8),h=Ae(a,"rotation",8,0),f=Ae(a,"selected",8,!1),v=Ae(a,"screenToSvg",8),k=Ae(a,"onSelect",8,()=>{}),T=Ae(a,"onDrag",8,()=>{}),A=Ae(a,"onRotate",8,()=>{}),P=N(!1),E=!1,S={x:0,y:0};function R(_e){_e.stopPropagation(),k()(u())}function L(_e){if(_e.button!==0)return;_e.preventDefault(),_e.stopPropagation(),k()(u()),g(P,!0);const De=v()(_e.clientX,_e.clientY);S={x:De.x-d(),y:De.y-m()},window.addEventListener("mousemove",q),window.addEventListener("mouseup",F)}function q(_e){if(!e(P))return;const De=v()(_e.clientX,_e.clientY);let Ie=De.x-S.x,de=De.y-S.y;_e.shiftKey||(Ie=Math.round(Ie),de=Math.round(de));const Q=Math.max(y(),p())/2;Ie=Math.max(-Q,Math.min(yt.width-y()+Q,Ie)),de=Math.max(-Q,Math.min(yt.height-p()+Q,de)),T()(u(),Ie,de)}function F(){g(P,!1),window.removeEventListener("mousemove",q),window.removeEventListener("mouseup",F)}function U(_e){_e.preventDefault(),_e.stopPropagation(),E=!0,window.addEventListener("mousemove",W),window.addEventListener("mouseup",ae)}function W(_e){if(!E)return;const De=v()(_e.clientX,_e.clientY),Ie=De.x-e(n),de=De.y-e(r);let Q=Math.atan2(de,Ie)*180/Math.PI+45;_e.shiftKey||(Q=Math.round(Q/15)*15),A()(u(),Q)}function ae(){E=!1,window.removeEventListener("mousemove",W),window.removeEventListener("mouseup",ae)}le(()=>(D(d()),D(y())),()=>{g(n,d()+y()/2)}),le(()=>(D(m()),D(p())),()=>{g(r,m()+p()/2)}),le(()=>(D(y()),D(p())),()=>{g(s,Math.max(y(),p())/2+1.5)}),le(()=>(e(n),e(s),D(h())),()=>{g(o,e(n)+e(s)*Math.cos((h()-45)*Math.PI/180))}),le(()=>(e(r),e(s),D(h())),()=>{g(l,e(r)+e(s)*Math.sin((h()-45)*Math.PI/180))}),$n(),ln();var re=Mu();let Re;var fe=x(re),se=x(fe),We=b(fe);{var xe=_e=>{var De=Eu(),Ie=ie(De),de=b(Ie);H(()=>{c(Ie,"x1",e(n)),c(Ie,"y1",e(r)),c(Ie,"x2",e(o)),c(Ie,"y2",e(l)),c(Ie,"stroke",(D(ne),i(()=>ne.selection.highlight))),c(de,"cx",e(o)),c(de,"cy",e(l)),c(de,"fill",(D(ne),i(()=>ne.selection.highlight))),c(de,"stroke",(D(ne),i(()=>ne.selection.highlightDark)))}),Z("mousedown",de,U),_(_e,De)};z(We,_e=>{f()&&_e(xe)})}H(()=>{Re=Oa(re,0,"terrain-rect svelte-1lx01iv",null,Re,{selected:f(),dragging:e(P)}),c(fe,"transform",`rotate(${h()??""}, ${e(n)??""}, ${e(r)??""})`),c(se,"x",d()),c(se,"y",m()),c(se,"width",y()),c(se,"height",p()),c(se,"fill",(D(f()),D(ne),i(()=>f()?ne.terrain.fillSelected:ne.terrain.fill))),c(se,"stroke",(D(f()),D(ne),i(()=>f()?ne.selection.highlight:ne.terrain.stroke))),c(se,"stroke-width",f()?.15:.1)}),Z("click",se,R),Z("mousedown",se,L),_(t,re),Za()}var Du=ce('<line stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-x1kcna"></circle>',1),Iu=ce('<g><g><path role="button" tabindex="0" class="svelte-x1kcna"></path></g><!></g>');function Mi(t,a){Ja(a,!1);const n=N(),r=N(),s=N(),o=N(),l=N(),u=N(),d=N(),m=N(),y=N(),p=N();let h=Ae(a,"id",8),f=Ae(a,"x",8),v=Ae(a,"y",8),k=Ae(a,"shape",8),T=Ae(a,"segments",8,null),A=Ae(a,"rotation",8,0),P=Ae(a,"selected",8,!1),E=Ae(a,"screenToSvg",8),S=Ae(a,"onSelect",8,()=>{}),R=Ae(a,"onDrag",8,()=>{}),L=Ae(a,"onRotate",8,()=>{});function q(G){const Fe=G.map(kt=>kt.x),he=G.map(kt=>kt.y);return{minX:Math.min(...Fe),maxX:Math.max(...Fe),minY:Math.min(...he),maxY:Math.max(...he)}}let F=N(!1),U=!1,W={x:0,y:0};function ae(G){G.stopPropagation(),S()(h())}function re(G){if(G.button!==0)return;G.preventDefault(),G.stopPropagation(),S()(h()),g(F,!0);const Fe=E()(G.clientX,G.clientY);W={x:Fe.x-f(),y:Fe.y-v()},window.addEventListener("mousemove",Re),window.addEventListener("mouseup",fe)}function Re(G){if(!e(F))return;const Fe=E()(G.clientX,G.clientY);let he=Fe.x-W.x,kt=Fe.y-W.y;G.shiftKey||(he=Math.round(he),kt=Math.round(kt));const Ot=Math.max(e(s),e(o));he=Math.max(-Ot,Math.min(yt.width+Ot-e(s),he)),kt=Math.max(-Ot,Math.min(yt.height+Ot-e(o),kt)),R()(h(),he,kt)}function fe(){g(F,!1),window.removeEventListener("mousemove",Re),window.removeEventListener("mouseup",fe)}function se(G){G.preventDefault(),G.stopPropagation(),U=!0,window.addEventListener("mousemove",We),window.addEventListener("mouseup",xe)}function We(G){if(!U)return;const Fe=E()(G.clientX,G.clientY),he=Fe.x-e(l),kt=Fe.y-e(u);let Ot=Math.atan2(kt,he)*180/Math.PI+45;G.shiftKey||(Ot=Math.round(Ot/15)*15),L()(h(),Ot)}function xe(){U=!1,window.removeEventListener("mousemove",We),window.removeEventListener("mouseup",xe)}le(()=>(D(k()),D(T())),()=>{g(n,Cn(k(),T()))}),le(()=>e(n),()=>{g(r,q(e(n)))}),le(()=>e(r),()=>{g(s,e(r).maxX-e(r).minX)}),le(()=>e(r),()=>{g(o,e(r).maxY-e(r).minY)}),le(()=>(D(f()),e(r),e(s)),()=>{g(l,f()+e(r).minX+e(s)/2)}),le(()=>(D(v()),e(r),e(o)),()=>{g(u,v()+e(r).minY+e(o)/2)}),le(()=>(e(n),D(f()),D(v())),()=>{g(d,e(n).length>0?`M ${e(n).map(G=>`${f()+G.x},${v()+G.y}`).join(" L ")} Z`:"")}),le(()=>(e(s),e(o)),()=>{g(m,Math.max(e(s),e(o))/2+1.5)}),le(()=>(e(l),e(m),D(A())),()=>{g(y,e(l)+e(m)*Math.cos((A()-45)*Math.PI/180))}),le(()=>(e(u),e(m),D(A())),()=>{g(p,e(u)+e(m)*Math.sin((A()-45)*Math.PI/180))}),$n(),ln();var _e=Iu();let De;var Ie=x(_e),de=x(Ie),Q=b(Ie);{var Ve=G=>{var Fe=Du(),he=ie(Fe),kt=b(he);H(()=>{c(he,"x1",e(l)),c(he,"y1",e(u)),c(he,"x2",e(y)),c(he,"y2",e(p)),c(he,"stroke",(D(ne),i(()=>ne.selection.highlight))),c(kt,"cx",e(y)),c(kt,"cy",e(p)),c(kt,"fill",(D(ne),i(()=>ne.selection.highlight))),c(kt,"stroke",(D(ne),i(()=>ne.selection.highlightDark)))}),Z("mousedown",kt,se),_(G,Fe)};z(Q,G=>{P()&&G(Ve)})}H(()=>{De=Oa(_e,0,"wall-piece svelte-x1kcna",null,De,{selected:P(),dragging:e(F)}),c(Ie,"transform",`rotate(${A()??""}, ${e(l)??""}, ${e(u)??""})`),c(de,"d",e(d)),c(de,"fill",(D(P()),D(ne),i(()=>P()?ne.wall.fillSelected:ne.wall.fill))),c(de,"stroke",(D(P()),D(ne),i(()=>P()?ne.selection.highlight:ne.wall.stroke))),c(de,"stroke-width",P()?.15:.1)}),Z("click",de,ae),Z("mousedown",de,re),_(t,_e),Za()}var Lu=ce('<g class="svelte-1vg3k6o"><rect rx="0.1" ry="0.1" fill="rgba(239, 68, 68, 0.6)" pointer-events="none" class="engagement-glow svelte-1vg3k6o"></rect></g>'),$u=ce('<g class="svelte-1vg3k6o"><ellipse fill="rgba(239, 68, 68, 0.6)" pointer-events="none" class="engagement-glow svelte-1vg3k6o"></ellipse></g>'),Pu=ce('<circle fill="rgba(239, 68, 68, 0.6)" pointer-events="none" class="engagement-glow svelte-1vg3k6o"></circle>'),Nu=ce('<g class="svelte-1vg3k6o"><rect role="button" tabindex="0" class="svelte-1vg3k6o"></rect></g>'),Ou=ce('<g class="svelte-1vg3k6o"><ellipse role="button" tabindex="0" class="svelte-1vg3k6o"></ellipse></g>'),Wu=ce('<circle role="button" tabindex="0" class="svelte-1vg3k6o"></circle>'),Yu=ce('<text text-anchor="middle" dominant-baseline="middle" font-weight="bold" fill="white" stroke="black" stroke-width="0.02" paint-order="stroke" pointer-events="none" class="model-name svelte-1vg3k6o"> </text>'),Hu=ce('<line stroke-width="0.1" stroke-dasharray="0.3,0.15" class="svelte-1vg3k6o"></line><circle r="0.8" stroke-width="0.1" role="button" tabindex="0" class="rotate-handle svelte-1vg3k6o"></circle><g pointer-events="none" class="svelte-1vg3k6o"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08" class="svelte-1vg3k6o"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08" class="svelte-1vg3k6o"></path></g>',1),Fu=ce('<line stroke-width="0.12" stroke-dasharray="0.3,0.15" pointer-events="none" class="svelte-1vg3k6o"></line><circle r="0.25" pointer-events="none" class="svelte-1vg3k6o"></circle><text text-anchor="middle" dominant-baseline="middle" font-size="0.5" font-weight="bold" stroke="#000" stroke-width="0.05" paint-order="stroke" pointer-events="none" class="drag-ruler-label svelte-1vg3k6o"> </text>',1),Bu=ce("<g><!><!><!><!><!></g>");function Ur(t,a){Ja(a,!1);const n=N(),r=N(),s=N(),o=N(),l=N(),u=N(),d=N(),m=N(),y=N(),p=N(),h=N(),f=N(),v=N(),k=N(),T=N(),A=N(),P=N(),E=N(),S=N(),R=N(),L=N(),q=N(),F=N();let U=Ae(a,"id",8),W=Ae(a,"x",8),ae=Ae(a,"y",8),re=Ae(a,"baseType",8),Re=Ae(a,"playerId",8),fe=Ae(a,"rotation",8,0),se=Ae(a,"selected",8,!1),We=Ae(a,"marqueePreview",8,!1),xe=Ae(a,"inGroupSelection",8,!1),_e=Ae(a,"name",8,""),De=Ae(a,"customWidth",8,null),Ie=Ae(a,"customHeight",8,null),de=Ae(a,"unitStrokeColor",8,null),Q=Ae(a,"coherencyViolation",8,!1),Ve=Ae(a,"inEngagementRange",8,!1),G=Ae(a,"screenToSvg",8),Fe=Ae(a,"onSelect",8,()=>{}),he=Ae(a,"onDrag",8,()=>{}),kt=Ae(a,"onDragEnd",8,()=>{}),Ot=Ae(a,"onRotate",8,()=>{}),ha=Ae(a,"onRotateEnd",8,()=>{}),aa=Ae(a,"onRename",8,()=>{}),Vt=N(!1),ma=!1,Ia={x:0,y:0},lt=N(null),ct=null;function Et(et){et.stopPropagation()}function Pe(et){et.stopPropagation();const it=prompt("Model name:",_e());it!==null&&aa()(U(),it)}function we(et){if(et.button!==0)return;et.preventDefault(),et.stopPropagation(),Fe()(U(),et),g(Vt,!0),g(lt,{x:W(),y:ae()});const it=G()(et.clientX,et.clientY);Ia={x:it.x-W(),y:it.y-ae()},window.addEventListener("mousemove",Ce),window.addEventListener("mouseup",Ze)}function Ce(et){if(!e(Vt))return;const it=G()(et.clientX,et.clientY);let pt=it.x-Ia.x,Gt=it.y-Ia.y;he()(U(),pt,Gt)}function Ze(){e(Vt)&&e(lt)&&((e(lt).x!==W()||e(lt).y!==ae())&&kt()(U(),e(lt).x,e(lt).y,W(),ae()),g(lt,null)),g(Vt,!1),window.removeEventListener("mousemove",Ce),window.removeEventListener("mouseup",Ze)}function V(et){et.preventDefault(),et.stopPropagation(),ma=!0,ct=fe(),window.addEventListener("mousemove",Le),window.addEventListener("mouseup",Xe)}function Le(et){if(!ma)return;const it=G()(et.clientX,et.clientY),pt=it.x-W(),Gt=it.y-ae();let la=Math.atan2(Gt,pt)*180/Math.PI+45;et.shiftKey||(la=Math.round(la/15)*15),Ot()(U(),la)}function Xe(){ma&&ct!==null&&(ct!==fe()&&ha()(U(),ct,fe()),ct=null),ma=!1,window.removeEventListener("mousemove",Le),window.removeEventListener("mouseup",Xe)}le(()=>(D(De()),D(Ie())),()=>{g(n,{customWidth:De(),customHeight:Ie()})}),le(()=>(D(re()),e(n)),()=>{g(r,_a(re(),e(n)))}),le(()=>D(re()),()=>{g(s,ya(re()))}),le(()=>D(re()),()=>{g(o,Ha(re()))}),le(()=>D(Re()),()=>{g(l,fr(Re()))}),le(()=>e(l),()=>{g(u,e(l).primary)}),le(()=>e(l),()=>{g(d,e(l).fill)}),le(()=>e(l),()=>{g(m,e(l).fillLight)}),le(()=>(D(se()),D(We()),D(Q())),()=>{g(y,se()?.15:We()?.12:Q()?.15:.1)}),le(()=>(D(se()),e(u),D(We()),e(m),D(Q()),e(d)),()=>{g(p,se()?e(u):We()?e(m):Q()?"rgba(239, 68, 68, 0.3)":e(d))}),le(()=>(D(Q()),D(de()),e(u)),()=>{g(h,Q()?"#ef4444":de()||e(u))}),le(()=>e(r),()=>{g(f,e(r)?.radius||.5)}),le(()=>e(r),()=>{g(v,e(r)?.width?e(r).width/2:0)}),le(()=>e(r),()=>{g(k,e(r)?.height?e(r).height/2:0)}),le(()=>(e(o),D(De())),()=>{g(T,e(o)&&De()||0)}),le(()=>(e(o),D(Ie())),()=>{g(A,e(o)&&Ie()||0)}),le(()=>(e(s),e(v),e(k),e(o),e(T),e(A)),()=>{g(P,e(s)?Math.max(e(v),e(k))+1:e(o)?Math.max(e(T),e(A))/2+1:0)}),le(()=>(D(W()),e(P),D(fe())),()=>{g(E,W()+e(P)*Math.cos((fe()-45)*Math.PI/180))}),le(()=>(D(ae()),e(P),D(fe())),()=>{g(S,ae()+e(P)*Math.sin((fe()-45)*Math.PI/180))}),le(()=>(e(Vt),e(lt),D(W()),D(ae())),()=>{g(R,e(Vt)&&e(lt)?Math.sqrt(Math.pow(W()-e(lt).x,2)+Math.pow(ae()-e(lt).y,2)):0)}),le(()=>(e(Vt),e(lt),D(W())),()=>{g(L,e(Vt)&&e(lt)?(e(lt).x+W())/2:0)}),le(()=>(e(Vt),e(lt),D(ae())),()=>{g(q,e(Vt)&&e(lt)?(e(lt).y+ae())/2:0)}),le(()=>(e(o),e(T),e(A),e(s),e(v),e(k),e(f)),()=>{g(F,e(o)?Math.min(e(T),e(A))*.2:e(s)?Math.min(e(v),e(k))*.4:e(f)*.5)}),$n(),ln();var Pt=Bu();let At;var ft=x(Pt);{var Ut=et=>{var it=ze(),pt=ie(it);{var Gt=sa=>{var qt=Lu(),Yt=x(qt);H(()=>{c(qt,"transform",`rotate(${fe()??""}, ${W()??""}, ${ae()??""})`),c(Yt,"x",W()-e(T)/2-.15),c(Yt,"y",ae()-e(A)/2-.15),c(Yt,"width",e(T)+.3),c(Yt,"height",e(A)+.3)}),_(sa,qt)},la=sa=>{var qt=ze(),Yt=ie(qt);{var La=Ta=>{var ca=$u(),qa=x(ca);H(()=>{c(ca,"transform",`rotate(${fe()??""}, ${W()??""}, ${ae()??""})`),c(qa,"cx",W()),c(qa,"cy",ae()),c(qa,"rx",e(v)+.15),c(qa,"ry",e(k)+.15)}),_(Ta,ca)},$a=Ta=>{var ca=Pu();H(()=>{c(ca,"cx",W()),c(ca,"cy",ae()),c(ca,"r",e(f)+.15)}),_(Ta,ca)};z(Yt,Ta=>{e(s)?Ta(La):Ta($a,!1)},!0)}_(sa,qt)};z(pt,sa=>{e(o)?sa(Gt):sa(la,!1)})}_(et,it)};z(ft,et=>{Ve()&&et(Ut)})}var jt=b(ft);{var Kt=et=>{var it=Nu(),pt=x(it);H(()=>{c(it,"transform",`rotate(${fe()??""}, ${W()??""}, ${ae()??""})`),c(pt,"x",W()-e(T)/2),c(pt,"y",ae()-e(A)/2),c(pt,"width",e(T)),c(pt,"height",e(A)),c(pt,"fill",e(p)),c(pt,"stroke",e(h)),c(pt,"stroke-width",e(y))}),Z("click",pt,Et),Z("dblclick",pt,Pe),Z("mousedown",pt,we),_(et,it)},Lt=et=>{var it=ze(),pt=ie(it);{var Gt=sa=>{var qt=Ou(),Yt=x(qt);H(()=>{c(qt,"transform",`rotate(${fe()??""}, ${W()??""}, ${ae()??""})`),c(Yt,"cx",W()),c(Yt,"cy",ae()),c(Yt,"rx",e(v)),c(Yt,"ry",e(k)),c(Yt,"fill",e(p)),c(Yt,"stroke",e(h)),c(Yt,"stroke-width",e(y))}),Z("click",Yt,Et),Z("dblclick",Yt,Pe),Z("mousedown",Yt,we),_(sa,qt)},la=sa=>{var qt=Wu();H(()=>{c(qt,"cx",W()),c(qt,"cy",ae()),c(qt,"r",e(f)),c(qt,"fill",e(p)),c(qt,"stroke",e(h)),c(qt,"stroke-width",e(y))}),Z("click",qt,Et),Z("dblclick",qt,Pe),Z("mousedown",qt,we),_(sa,qt)};z(pt,sa=>{e(s)?sa(Gt):sa(la,!1)},!0)}_(et,it)};z(jt,et=>{e(o)?et(Kt):et(Lt,!1)})}var Bt=b(jt);{var wa=et=>{var it=Yu(),pt=x(it);H(()=>{c(it,"x",W()),c(it,"y",ae()),c(it,"font-size",e(F)),Oe(pt,_e())}),_(et,it)};z(Bt,et=>{_e()&&et(wa)})}var ga=b(Bt);{var Jt=et=>{var it=Hu(),pt=ie(it),Gt=b(pt),la=b(Gt);H(()=>{c(pt,"x1",W()),c(pt,"y1",ae()),c(pt,"x2",e(E)),c(pt,"y2",e(S)),c(pt,"stroke",(D(ne),i(()=>ne.selection.handle))),c(Gt,"cx",e(E)),c(Gt,"cy",e(S)),c(Gt,"fill",(D(ne),i(()=>ne.selection.handle))),c(Gt,"stroke",(D(ne),i(()=>ne.selection.handleDark))),c(la,"transform",`translate(${e(E)??""}, ${e(S)??""})`)}),Z("mousedown",Gt,V),_(et,it)};z(ga,et=>{se()&&(e(s)||e(o))&&!xe()&&et(Jt)})}var Dt=b(ga);{var ka=et=>{var it=Fu(),pt=ie(it),Gt=b(pt),la=b(Gt),sa=x(la);H(qt=>{c(pt,"x1",(e(lt),i(()=>e(lt).x))),c(pt,"y1",(e(lt),i(()=>e(lt).y))),c(pt,"x2",W()),c(pt,"y2",ae()),c(pt,"stroke",(D(ne),i(()=>ne.selection.dragRuler))),c(Gt,"cx",(e(lt),i(()=>e(lt).x))),c(Gt,"cy",(e(lt),i(()=>e(lt).y))),c(Gt,"fill",(D(ne),i(()=>ne.selection.dragRuler))),c(la,"x",e(L)),c(la,"y",e(q)-.5),c(la,"fill",(D(ne),i(()=>ne.selection.dragRuler))),Oe(sa,`${qt??""}"`)},[()=>(e(R),i(()=>e(R).toFixed(2)))]),_(et,it)};z(Dt,et=>{e(Vt)&&e(lt)&&e(R)>.1&&et(ka)})}H(()=>At=Oa(Pt,0,"model-base svelte-1vg3k6o",null,At,{selected:se(),dragging:e(Vt),"coherency-violation":Q(),"engagement-range":Ve()})),_(t,Pt),Za()}var qu=ce('<rect x="0" y="0"></rect>'),Uu=ce('<line stroke-width="0.05"></line>'),Ku=ce('<line stroke-width="0.05"></line>'),Gu=ce('<line stroke-width="0.08"></line>'),zu=ce('<line stroke-width="0.08"></line>'),Xu=ce("<!><!><!><!>",1),Vu=ce('<text text-anchor="middle" class="ruler-text svelte-lpn8p2"> </text>'),ju=ce("<line></line><!>",1),Ju=ce('<text text-anchor="middle" class="ruler-text svelte-lpn8p2"> </text>'),Zu=ce("<line></line><!>",1),Qu=ce('<text text-anchor="middle" class="ruler-text svelte-lpn8p2"> </text>'),ed=ce("<line></line><!>",1),td=ce('<text text-anchor="middle" class="ruler-text svelte-lpn8p2"> </text>'),ad=ce("<line></line><!>",1),nd=ce("<!><!><!><!>",1),sd=ce('<path stroke-width="0.10" stroke-dasharray="0.5,0.25"></path>'),rd=ce('<line stroke-width="0.05"></line>'),id=ce('<g><rect stroke-width="0.1"></rect></g>'),od=ce('<g><path stroke-width="0.1"></path></g>'),ld=ce('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15"></circle><circle stroke-width="0.06"></circle><circle r="0.15"></circle>',1),cd=ce('<g><rect stroke-width="0.1"></rect></g>'),ud=ce('<g><ellipse stroke-width="0.1"></ellipse></g>'),dd=ce('<circle stroke-width="0.1"></circle>'),hd=ce('<line stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),md=ce('<line stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),fd=ce('<svg preserveAspectRatio="xMidYMid meet"><!><rect></rect><!><!><g><!><!><!><!><!><!><!><!></g></svg>');function Tr(t,a){Ja(a,!1);const n=()=>Xt(Pr,"$battlefieldView",r),[r,s]=As(),o=N(),l=N(),u=N(),d=N(),m=N(),y=N(),p=N(),h=N();let f=N();const v=2,k=yt.width+v*2,T=yt.height+v*2;let A=Ae(a,"deploymentZones",8,null),P=Ae(a,"objectives",8,null),E=Ae(a,"terrains",8,null),S=Ae(a,"walls",8,null),R=Ae(a,"models",8,null),L=Ae(a,"losResults",8,null),q=Ae(a,"showGrid",8,!0),F=Ae(a,"showRuler",8,!0),U=Ae(a,"interactiveTerrain",8,!1),W=Ae(a,"interactiveWalls",8,!1),ae=Ae(a,"interactiveModels",8,!1),re=Ae(a,"showDebugRays",8,!1),Re=Ae(a,"selectedTerrainId",8,null),fe=Ae(a,"selectedWallId",8,null),se=Ae(a,"selectedModelId",8,null),We=Ae(a,"onTerrainSelect",8,()=>{}),xe=Ae(a,"onTerrainDrag",8,()=>{}),_e=Ae(a,"onTerrainRotate",8,()=>{}),De=Ae(a,"onWallSelect",8,()=>{}),Ie=Ae(a,"onWallDrag",8,()=>{}),de=Ae(a,"onWallRotate",8,()=>{}),Q=Ae(a,"onModelSelect",8,()=>{}),Ve=Ae(a,"onModelDrag",8,()=>{}),G=Ae(a,"onModelDragEnd",8,()=>{}),Fe=Ae(a,"onModelRotate",8,()=>{}),he=Ae(a,"onModelRotateEnd",8,()=>{}),kt=Ae(a,"onModelRename",8,()=>{}),Ot=Ae(a,"onBackgroundClick",8,()=>{}),ha=N(!1),aa={x:0,y:0},Vt=N(!1);const ma=.5,Ia=4;function lt(ue,Je){if(!e(f))return{x:0,y:0};const $t=e(f).createSVGPoint();$t.x=ue,$t.y=Je;const Wt=$t.matrixTransform(e(f).getScreenCTM().inverse());return{x:Wt.x-v,y:Wt.y-v}}function ct(ue){ue.preventDefault();const Je=e(f).getBoundingClientRect(),$t=ue.clientX-Je.left,Wt=ue.clientY-Je.top,Ee=e(u)+$t/Je.width*e(o),vt=e(d)+Wt/Je.height*e(l),st=ue.deltaY>0?.9:1.1,Ye=Math.max(ma,Math.min(Ia,n().zoom*st)),Ge=k/Ye,I=T/Ye,ht=Ee-$t/Je.width*Ge,Nt=vt-Wt/Je.height*I;Pr.set({zoom:Ye,panX:ht,panY:Nt})}function Et(ue){(ue.button===1||ue.button===0&&e(Vt))&&(ue.preventDefault(),g(ha,!0),aa={x:ue.clientX,y:ue.clientY})}function Pe(ue){if(!e(ha))return;const Je=e(f).getBoundingClientRect(),$t=(ue.clientX-aa.x)/Je.width*e(o),Wt=(ue.clientY-aa.y)/Je.height*e(l);Pr.update(Ee=>({...Ee,panX:Ee.panX-$t,panY:Ee.panY-Wt})),aa={x:ue.clientX,y:ue.clientY}}function we(){g(ha,!1)}function Ce(ue){ue.code==="Space"&&!ue.repeat&&ue.target.tagName!=="INPUT"&&(ue.preventDefault(),g(Vt,!0))}function Ze(ue){ue.code==="Space"&&g(Vt,!1)}function V(){Cu()}function Le(ue){(ue.target===ue.currentTarget||ue.target.tagName==="rect")&&Ot()()}function Xe(ue){const Je=Cn(ue.shape,ue.segments);return Je.length===0?"":`M ${Je.map($t=>`${ue.x+$t.x},${ue.y+$t.y}`).join(" L ")} Z`}function Pt(ue){const Je=Cn(ue.shape,ue.segments);if(Je.length===0)return{x:ue.x,y:ue.y};const $t=Je.map(Ge=>Ge.x),Wt=Je.map(Ge=>Ge.y),Ee=Math.min(...$t),vt=Math.max(...$t),st=Math.min(...Wt),Ye=Math.max(...Wt);return{x:ue.x+Ee+(vt-Ee)/2,y:ue.y+st+(Ye-st)/2}}le(()=>n(),()=>{g(o,k/n().zoom)}),le(()=>n(),()=>{g(l,T/n().zoom)}),le(()=>n(),()=>{g(u,n().panX)}),le(()=>n(),()=>{g(d,n().panY)}),le(()=>(e(u),e(d),e(o),e(l)),()=>{g(m,`${e(u)} ${e(d)} ${e(o)} ${e(l)}`)}),le(()=>yt,()=>{g(y,Array.from({length:yt.width+1},(ue,Je)=>Je))}),le(()=>yt,()=>{g(p,Array.from({length:yt.height+1},(ue,Je)=>Je))}),le(()=>(D(R()),D(se())),()=>{g(h,R()?.find(ue=>ue.id===se()))}),$n();var At={screenToSvg:lt};ln();var ft=fd();Z("keydown",fs,Ce),Z("keyup",fs,Ze),Z("mouseup",fs,we),Z("mousemove",fs,Pe);let Ut;var jt=x(ft);{var Kt=ue=>{var Je=qu();H(()=>{c(Je,"width",(D(yt),i(()=>yt.width+v*2))),c(Je,"height",(D(yt),i(()=>yt.height+v*2))),c(Je,"fill",(D(ne),i(()=>ne.battlefield.rulerBackground)))}),_(ue,Je)};z(jt,ue=>{F()&&ue(Kt)})}var Lt=b(jt);c(Lt,"x",v),c(Lt,"y",v);var Bt=b(Lt);{var wa=ue=>{var Je=Xu(),$t=ie(Je);at($t,1,()=>(D(yt),i(()=>Array(yt.width+1))),Ct,(st,Ye,Ge)=>{var I=Uu();c(I,"x1",v+Ge),c(I,"y1",v),c(I,"x2",v+Ge),H(()=>{c(I,"y2",(D(yt),i(()=>v+yt.height))),c(I,"stroke",(D(ne),i(()=>ne.battlefield.gridFine)))}),_(st,I)});var Wt=b($t);at(Wt,1,()=>(D(yt),i(()=>Array(yt.height+1))),Ct,(st,Ye,Ge)=>{var I=Ku();c(I,"x1",v),c(I,"y1",v+Ge),c(I,"y2",v+Ge),H(()=>{c(I,"x2",(D(yt),i(()=>v+yt.width))),c(I,"stroke",(D(ne),i(()=>ne.battlefield.gridFine)))}),_(st,I)});var Ee=b(Wt);at(Ee,1,()=>(D(yt),i(()=>Array(Math.floor(yt.width/6)+1))),Ct,(st,Ye,Ge)=>{var I=Gu();c(I,"x1",v+Ge*6),c(I,"y1",v),c(I,"x2",v+Ge*6),H(()=>{c(I,"y2",(D(yt),i(()=>v+yt.height))),c(I,"stroke",(D(ne),i(()=>ne.battlefield.gridCoarse)))}),_(st,I)});var vt=b(Ee);at(vt,1,()=>(D(yt),i(()=>Array(Math.floor(yt.height/6)+1))),Ct,(st,Ye,Ge)=>{var I=zu();c(I,"x1",v),c(I,"y1",v+Ge*6),c(I,"y2",v+Ge*6),H(()=>{c(I,"x2",(D(yt),i(()=>v+yt.width))),c(I,"stroke",(D(ne),i(()=>ne.battlefield.gridCoarse)))}),_(st,I)}),_(ue,Je)};z(Bt,ue=>{q()&&ue(wa)})}var ga=b(Bt);{var Jt=ue=>{var Je=nd(),$t=ie(Je);at($t,1,()=>e(y),Ct,(st,Ye)=>{var Ge=ju(),I=ie(Ge);c(I,"y2",v);var ht=b(I);{var Nt=Mt=>{var xt=Vu();c(xt,"y",1.2);var xa=x(xt);H(()=>{c(xt,"x",v+e(Ye)),Oe(xa,`${e(Ye)??""}"`)}),_(Mt,xt)};z(ht,Mt=>{e(Ye)%6===0&&Mt(Nt)})}H(()=>{c(I,"x1",v+e(Ye)),c(I,"y1",e(Ye)%6===0?.5:v-.8),c(I,"x2",v+e(Ye)),c(I,"stroke",(D(ne),i(()=>ne.battlefield.ruler))),c(I,"stroke-width",e(Ye)%6===0?.08:.04)}),_(st,Ge)});var Wt=b($t);at(Wt,1,()=>e(y),Ct,(st,Ye)=>{var Ge=Zu(),I=ie(Ge),ht=b(I);{var Nt=Mt=>{var xt=Ju(),xa=x(xt);H(()=>{c(xt,"x",v+e(Ye)),c(xt,"y",(D(yt),i(()=>v+yt.height+1.8))),Oe(xa,`${e(Ye)??""}"`)}),_(Mt,xt)};z(ht,Mt=>{e(Ye)%6===0&&Mt(Nt)})}H(()=>{c(I,"x1",v+e(Ye)),c(I,"y1",(D(yt),i(()=>v+yt.height))),c(I,"x2",v+e(Ye)),c(I,"y2",(D(yt),e(Ye),i(()=>v+yt.height+(e(Ye)%6===0?1.5:.8)))),c(I,"stroke",(D(ne),i(()=>ne.battlefield.ruler))),c(I,"stroke-width",e(Ye)%6===0?.08:.04)}),_(st,Ge)});var Ee=b(Wt);at(Ee,1,()=>e(p),Ct,(st,Ye)=>{var Ge=ed(),I=ie(Ge);c(I,"x2",v);var ht=b(I);{var Nt=Mt=>{var xt=Qu();c(xt,"x",1);var xa=x(xt);H(()=>{c(xt,"y",v+e(Ye)+.35),Oe(xa,`${e(Ye)??""}"`)}),_(Mt,xt)};z(ht,Mt=>{e(Ye)%6===0&&Mt(Nt)})}H(()=>{c(I,"x1",e(Ye)%6===0?.5:v-.8),c(I,"y1",v+e(Ye)),c(I,"y2",v+e(Ye)),c(I,"stroke",(D(ne),i(()=>ne.battlefield.ruler))),c(I,"stroke-width",e(Ye)%6===0?.08:.04)}),_(st,Ge)});var vt=b(Ee);at(vt,1,()=>e(p),Ct,(st,Ye)=>{var Ge=ad(),I=ie(Ge),ht=b(I);{var Nt=Mt=>{var xt=td(),xa=x(xt);H(()=>{c(xt,"x",(D(yt),i(()=>v+yt.width+1))),c(xt,"y",v+e(Ye)+.35),Oe(xa,`${e(Ye)??""}"`)}),_(Mt,xt)};z(ht,Mt=>{e(Ye)%6===0&&Mt(Nt)})}H(()=>{c(I,"x1",(D(yt),i(()=>v+yt.width))),c(I,"y1",v+e(Ye)),c(I,"x2",(D(yt),e(Ye),i(()=>v+yt.width+(e(Ye)%6===0?1.5:.8)))),c(I,"y2",v+e(Ye)),c(I,"stroke",(D(ne),i(()=>ne.battlefield.ruler))),c(I,"stroke-width",e(Ye)%6===0?.08:.04)}),_(st,Ge)}),_(ue,Je)};z(ga,ue=>{F()&&ue(Jt)})}var Dt=b(ga);c(Dt,"transform","translate(2, 2)");var ka=x(Dt);{var et=ue=>{var Je=ze(),$t=ie(Je);at($t,1,A,Ct,(Wt,Ee)=>{var vt=sd();H(st=>{c(vt,"d",st),c(vt,"fill",(e(Ee),i(()=>e(Ee).color))),c(vt,"stroke",(e(Ee),i(()=>e(Ee).borderColor)))},[()=>(D(Ss),e(Ee),i(()=>Ss(e(Ee).path)))]),_(Wt,vt)}),_(ue,Je)};z(ka,ue=>{A()&&ue(et)})}var it=b(ka);{var pt=ue=>{var Je=ze(),$t=ie(Je);at($t,1,L,Ct,(Wt,Ee)=>{var vt=ze(),st=ie(vt);{var Ye=Ge=>{var I=ze(),ht=ie(I);at(ht,1,()=>(e(Ee),i(()=>e(Ee).rays)),Ct,(Nt,Mt)=>{var xt=rd();H(()=>{c(xt,"x1",(e(Mt),i(()=>e(Mt).from.x))),c(xt,"y1",(e(Mt),i(()=>e(Mt).from.y))),c(xt,"x2",(e(Mt),i(()=>e(Mt).to.x))),c(xt,"y2",(e(Mt),i(()=>e(Mt).to.y))),c(xt,"stroke",(e(Mt),D(ne),i(()=>e(Mt).blocked?ne.los.rayBlocked:ne.los.rayVisible)))}),_(Nt,xt)}),_(Ge,I)};z(st,Ge=>{e(Ee),i(()=>e(Ee).rays)&&Ge(Ye)})}_(Wt,vt)}),_(ue,Je)};z(it,ue=>{D(re()),D(L()),i(()=>re()&&L()&&L().length>0)&&ue(pt)})}var Gt=b(it);{var la=ue=>{var Je=ze(),$t=ie(Je);{var Wt=vt=>{var st=ze(),Ye=ie(st);at(Ye,1,E,Ge=>Ge.id,(Ge,I)=>{{let ht=Me(()=>(e(I),D(Re()),i(()=>e(I).id===Re())));Ru(Ge,{get id(){return e(I),i(()=>e(I).id)},get x(){return e(I),i(()=>e(I).x)},get y(){return e(I),i(()=>e(I).y)},get width(){return e(I),i(()=>e(I).width)},get height(){return e(I),i(()=>e(I).height)},get rotation(){return e(I),i(()=>e(I).rotation)},get selected(){return e(ht)},screenToSvg:lt,get onSelect(){return We()},get onDrag(){return xe()},get onRotate(){return _e()}})}}),_(vt,st)},Ee=vt=>{var st=ze(),Ye=ie(st);at(Ye,1,E,Ct,(Ge,I)=>{const ht=Me(()=>(e(I),i(()=>e(I).x+e(I).width/2))),Nt=Me(()=>(e(I),i(()=>e(I).y+e(I).height/2)));var Mt=id(),xt=x(Mt);H(()=>{c(Mt,"transform",`rotate(${e(I),i(()=>e(I).rotation)??""}, ${e(ht)??""}, ${e(Nt)??""})`),c(xt,"x",(e(I),i(()=>e(I).x))),c(xt,"y",(e(I),i(()=>e(I).y))),c(xt,"width",(e(I),i(()=>e(I).width))),c(xt,"height",(e(I),i(()=>e(I).height))),c(xt,"fill",(D(ne),i(()=>ne.terrain.fillStatic))),c(xt,"stroke",(D(ne),i(()=>ne.terrain.stroke)))}),_(Ge,Mt)}),_(vt,st)};z($t,vt=>{U()?vt(Wt):vt(Ee,!1)})}_(ue,Je)};z(Gt,ue=>{E()&&ue(la)})}var sa=b(Gt);{var qt=ue=>{var Je=ze(),$t=ie(Je);{var Wt=vt=>{var st=ze(),Ye=ie(st);at(Ye,1,S,Ge=>Ge.id,(Ge,I)=>{{let ht=Me(()=>(e(I),D(fe()),i(()=>e(I).id===fe())));Mi(Ge,{get id(){return e(I),i(()=>e(I).id)},get x(){return e(I),i(()=>e(I).x)},get y(){return e(I),i(()=>e(I).y)},get shape(){return e(I),i(()=>e(I).shape)},get segments(){return e(I),i(()=>e(I).segments)},get rotation(){return e(I),i(()=>e(I).rotation)},get selected(){return e(ht)},screenToSvg:lt,get onSelect(){return De()},get onDrag(){return Ie()},get onRotate(){return de()}})}}),_(vt,st)},Ee=vt=>{var st=ze(),Ye=ie(st);at(Ye,1,S,Ct,(Ge,I)=>{const ht=Me(()=>(e(I),i(()=>Pt(e(I)))));var Nt=od(),Mt=x(Nt);H(xt=>{c(Nt,"transform",`rotate(${e(I),i(()=>e(I).rotation)??""}, ${D(e(ht)),i(()=>e(ht).x)??""}, ${D(e(ht)),i(()=>e(ht).y)??""})`),c(Mt,"d",xt),c(Mt,"fill",(D(ne),i(()=>ne.wall.fill))),c(Mt,"stroke",(D(ne),i(()=>ne.wall.stroke)))},[()=>(e(I),i(()=>Xe(e(I))))]),_(Ge,Nt)}),_(vt,st)};z($t,vt=>{W()?vt(Wt):vt(Ee,!1)})}_(ue,Je)};z(sa,ue=>{S()&&ue(qt)})}var Yt=b(sa);{var La=ue=>{var Je=ze(),$t=ie(Je);at($t,1,P,Ct,(Wt,Ee)=>{const vt=Me(()=>(e(Ee),D(ne),i(()=>e(Ee).isPrimary?ne.objective.primary:ne.objective.secondary))),st=Me(()=>(e(Ee),D(ne),i(()=>e(Ee).isPrimary?ne.objective.primaryControl:ne.objective.secondaryControl)));var Ye=ld(),Ge=ie(Ye),I=b(Ge),ht=b(I);H(()=>{c(Ge,"cx",(e(Ee),i(()=>e(Ee).x))),c(Ge,"cy",(e(Ee),i(()=>e(Ee).y))),c(Ge,"r",Zr),c(Ge,"fill",e(st)),c(Ge,"stroke",e(vt)),c(I,"cx",(e(Ee),i(()=>e(Ee).x))),c(I,"cy",(e(Ee),i(()=>e(Ee).y))),c(I,"r",Jr),c(I,"fill",e(vt)),c(I,"stroke",(D(ne),i(()=>ne.objective.center))),c(ht,"cx",(e(Ee),i(()=>e(Ee).x))),c(ht,"cy",(e(Ee),i(()=>e(Ee).y))),c(ht,"fill",(D(ne),i(()=>ne.objective.center)))}),_(Wt,Ye)}),_(ue,Je)};z(Yt,ue=>{P()&&ue(La)})}var $a=b(Yt);{var Ta=ue=>{var Je=ze(),$t=ie(Je);{var Wt=vt=>{var st=ze(),Ye=ie(st);at(Ye,1,R,Ge=>Ge.id,(Ge,I)=>{{let ht=Me(()=>(e(I),i(()=>e(I).name||""))),Nt=Me(()=>(e(I),D(se()),i(()=>e(I).id===se())));Ur(Ge,{get id(){return e(I),i(()=>e(I).id)},get x(){return e(I),i(()=>e(I).x)},get y(){return e(I),i(()=>e(I).y)},get baseType(){return e(I),i(()=>e(I).baseType)},get playerId(){return e(I),i(()=>e(I).playerId)},get rotation(){return e(I),i(()=>e(I).rotation)},get name(){return e(ht)},get selected(){return e(Nt)},screenToSvg:lt,get onSelect(){return Q()},get onDrag(){return Ve()},get onDragEnd(){return G()},get onRotate(){return Fe()},get onRotateEnd(){return he()},get onRename(){return kt()}})}}),_(vt,st)},Ee=vt=>{var st=ze(),Ye=ie(st);at(Ye,1,R,Ct,(Ge,I)=>{const ht=Me(()=>(D(_a),e(I),i(()=>_a(e(I).baseType)))),Nt=Me(()=>(D(fr),e(I),i(()=>fr(e(I).playerId)))),Mt=Me(()=>(D(ya),e(I),i(()=>ya(e(I).baseType)))),xt=Me(()=>(D(Ha),e(I),i(()=>Ha(e(I).baseType))));var xa=ze(),Ms=ie(xa);{var gn=bn=>{var cn=cd(),en=x(cn);H(()=>{c(cn,"transform",`rotate(${e(I),i(()=>e(I).rotation||0)??""}, ${e(I),i(()=>e(I).x)??""}, ${e(I),i(()=>e(I).y)??""})`),c(en,"x",(e(I),i(()=>e(I).x-(e(I).customWidth||0)/2))),c(en,"y",(e(I),i(()=>e(I).y-(e(I).customHeight||0)/2))),c(en,"width",(e(I),i(()=>e(I).customWidth||0))),c(en,"height",(e(I),i(()=>e(I).customHeight||0))),c(en,"fill",(D(e(Nt)),i(()=>e(Nt).fill))),c(en,"stroke",(D(e(Nt)),i(()=>e(Nt).primary)))}),_(bn,cn)},Rs=bn=>{var cn=ze(),en=ie(cn);{var Ds=tn=>{var Xa=ud(),Ka=x(Xa);H(()=>{c(Xa,"transform",`rotate(${e(I),i(()=>e(I).rotation||0)??""}, ${e(I),i(()=>e(I).x)??""}, ${e(I),i(()=>e(I).y)??""})`),c(Ka,"cx",(e(I),i(()=>e(I).x))),c(Ka,"cy",(e(I),i(()=>e(I).y))),c(Ka,"rx",(D(e(ht)),i(()=>e(ht).width/2))),c(Ka,"ry",(D(e(ht)),i(()=>e(ht).height/2))),c(Ka,"fill",(D(e(Nt)),i(()=>e(Nt).fill))),c(Ka,"stroke",(D(e(Nt)),i(()=>e(Nt).primary)))}),_(tn,Xa)},cs=tn=>{var Xa=dd();H(()=>{c(Xa,"cx",(e(I),i(()=>e(I).x))),c(Xa,"cy",(e(I),i(()=>e(I).y))),c(Xa,"r",(D(e(ht)),i(()=>e(ht).radius))),c(Xa,"fill",(D(e(Nt)),i(()=>e(Nt).fill))),c(Xa,"stroke",(D(e(Nt)),i(()=>e(Nt).primary)))}),_(tn,Xa)};z(en,tn=>{e(Mt)?tn(Ds):tn(cs,!1)},!0)}_(bn,cn)};z(Ms,bn=>{e(xt)?bn(gn):bn(Rs,!1)})}_(Ge,xa)}),_(vt,st)};z($t,vt=>{ae()?vt(Wt):vt(Ee,!1)})}_(ue,Je)};z($a,ue=>{R()&&ue(Ta)})}var ca=b($a);{var qa=ue=>{var Je=ze(),$t=ie(Je);at($t,1,L,Ct,(Wt,Ee)=>{var vt=ze(),st=ie(vt);{var Ye=I=>{var ht=hd();H(()=>{c(ht,"x1",(e(Ee),i(()=>e(Ee).firstClearRay.from.x))),c(ht,"y1",(e(Ee),i(()=>e(Ee).firstClearRay.from.y))),c(ht,"x2",(e(Ee),i(()=>e(Ee).firstClearRay.to.x))),c(ht,"y2",(e(Ee),i(()=>e(Ee).firstClearRay.to.y))),c(ht,"stroke",(D(ne),i(()=>ne.los.visible)))}),_(I,ht)},Ge=I=>{var ht=ze(),Nt=ie(ht);{var Mt=xt=>{var xa=md();H(()=>{c(xa,"x1",(e(h),i(()=>e(h).x))),c(xa,"y1",(e(h),i(()=>e(h).y))),c(xa,"x2",(e(Ee),i(()=>e(Ee).viewer.x))),c(xa,"y2",(e(Ee),i(()=>e(Ee).viewer.y))),c(xa,"stroke",(D(ne),i(()=>ne.los.blocked)))}),_(xt,xa)};z(Nt,xt=>{e(Ee),i(()=>e(Ee).viewer)&&xt(Mt)},!0)}_(I,ht)};z(st,I=>{e(Ee),i(()=>e(Ee).firstClearRay)?I(Ye):I(Ge,!1)})}_(Wt,vt)}),_(ue,Je)};z(ca,ue=>{D(re()),D(L()),e(h),i(()=>re()&&L()&&L().length>0&&e(h))&&ue(qa)})}var Qa=b(ca);Vo(Qa,a,"default",{screenToSvg:lt}),_s(ft,ue=>g(f,ue),()=>e(f)),H(()=>{c(ft,"viewBox",e(m)),Ut=Oa(ft,0,"battlefield svelte-lpn8p2",null,Ut,{panning:e(ha)||e(Vt)}),c(Lt,"width",(D(yt),i(()=>yt.width))),c(Lt,"height",(D(yt),i(()=>yt.height))),c(Lt,"fill",(D(ne),i(()=>ne.battlefield.background)))}),Z("wheel",ft,ct),Z("mousedown",ft,Et),Z("dblclick",ft,V),Z("click",ft,Le),_(t,ft),or(a,"screenToSvg",lt);var vn=Za(At);return s(),vn}var pd=ve('<div class="section-content svelte-1ms4b45"><!></div>'),yd=ve('<section><div class="section-header svelte-1ms4b45" role="button" tabindex="0"><h3 class="svelte-1ms4b45"> </h3> <span class="toggle-icon svelte-1ms4b45"> </span></div> <!></section>');function Ma(t,a){let n=Ae(a,"title",8),r=Ae(a,"defaultOpen",8,!0),s=N(r());function o(){g(s,!e(s))}var l=yd();let u;var d=x(l),m=x(d),y=x(m),p=b(m,2),h=x(p),f=b(d,2);{var v=k=>{var T=pd(),A=x(T);Vo(A,a,"default",{}),_(k,T)};z(f,k=>{e(s)&&k(v)})}H(()=>{u=Oa(l,1,"collapsible-section svelte-1ms4b45",null,u,{collapsed:!e(s)}),Oe(y,n()),Oe(h,e(s)?"▼":"▶")}),Z("click",d,o),_(t,l)}const as=Sa(null),pn=Sa(null),wn=Sa(null),Ri=Pn([pn,wn],([t,a])=>{if(!t)return{terrains:[],walls:[]};if(a==="preset"){const n=ml.find(r=>r.name===t);return n?{terrains:n.terrains||[],walls:n.walls||[]}:{terrains:[],walls:[]}}else if(a==="saved"){const n=localStorage.getItem("warhammer-deployment-layouts");if(n)try{const r=JSON.parse(n);if(r[t])return{terrains:r[t].terrains||[],walls:r[t].walls||[]}}catch(r){console.error("Failed to load layout:",r)}}return{terrains:[],walls:[]}});var vd=ve('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),gd=ve('<button class="svelte-1jotvmi"> </button>'),bd=ve('<div class="button-group svelte-1jotvmi"></div>'),Td=ve('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),xd=ve('<button class="svelte-1jotvmi"> </button>'),_d=ve('<div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi"> </h4> <div class="button-group svelte-1jotvmi"></div></div>'),wd=ve('<button class="svelte-1jotvmi"> </button>'),Sd=ve('<div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Saved</h4> <div class="button-group svelte-1jotvmi"></div></div>'),kd=ve('<div class="layout-sections svelte-1jotvmi"><!> <!></div>'),Ad=ve('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Objectives:</span> <span class="value svelte-1jotvmi"> </span></div>'),Cd=ve('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Pieces:</span> <span class="value svelte-1jotvmi"> </span></div>'),Ed=ve('<div class="summary svelte-1jotvmi"><div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Deployment:</span> <span class="value svelte-1jotvmi"> </span></div> <div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Terrain:</span> <span class="value svelte-1jotvmi"> </span></div> <!> <!></div>'),Md=ve('<main class="svelte-1jotvmi"><div class="layout svelte-1jotvmi"><div class="sidebar svelte-1jotvmi"><!> <!> <!></div> <div class="battlefield-area svelte-1jotvmi"><div class="battlefield-container svelte-1jotvmi"><!></div> <div class="info svelte-1jotvmi"><p class="svelte-1jotvmi">Battlefield: 60" x 44"</p> <p class="hint svelte-1jotvmi">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function Rd(t,a){Ja(a,!1);const n=()=>Xt(as,"$selectedDeployment",l),r=()=>Xt(pn,"$selectedLayoutName",l),s=()=>Xt(Ei,"$savedLayoutsList",l),o=()=>Xt(Ri,"$loadedTerrain",l),[l,u]=As();Cs(()=>{$r()});function d(L){as.set(L)}function m(L){pn.set(L.name),wn.set("preset")}function y(L){pn.set(L),wn.set("saved")}function p(){pn.set(null),wn.set(null)}function h(){as.set(null)}ln();var f=Md(),v=x(f),k=x(v),T=x(k);Ma(T,{title:"Deployment",children:(L,q)=>{var F=ze(),U=ie(F);{var W=re=>{var Re=vd(),fe=x(Re),se=x(fe),We=b(fe,2);H(()=>Oe(se,n().name)),Z("click",We,h),_(re,Re)},ae=re=>{var Re=bd();at(Re,5,()=>ll,Ct,(fe,se)=>{var We=gd(),xe=x(We);H(()=>Oe(xe,e(se).name)),Z("click",We,()=>d(e(se))),_(fe,We)}),_(re,Re)};z(U,re=>{n()?re(W):re(ae,!1)})}_(L,F)},$$slots:{default:!0}});var A=b(T,2);Ma(A,{title:"Terrain Layout",children:(L,q)=>{var F=ze(),U=ie(F);{var W=re=>{var Re=Td(),fe=x(Re),se=x(fe),We=b(fe,2);H(()=>Oe(se,r())),Z("click",We,p),_(re,Re)},ae=re=>{var Re=kd(),fe=x(Re);at(fe,1,()=>hl,Ct,(xe,_e)=>{var De=_d(),Ie=x(De),de=x(Ie),Q=b(Ie,2);at(Q,5,()=>e(_e).presets,Ct,(Ve,G)=>{var Fe=xd(),he=x(Fe);H(()=>Oe(he,e(G).name)),Z("click",Fe,()=>m(e(G))),_(Ve,Fe)}),H(()=>Oe(de,e(_e).name)),_(xe,De)});var se=b(fe,2);{var We=xe=>{var _e=Sd(),De=b(x(_e),2);at(De,5,s,Ct,(Ie,de)=>{var Q=wd(),Ve=x(Q);H(()=>Oe(Ve,e(de).name)),Z("click",Q,()=>y(e(de).name)),_(Ie,Q)}),_(xe,_e)};z(se,xe=>{s().length>0&&xe(We)})}_(re,Re)};z(U,re=>{r()?re(W):re(ae,!1)})}_(L,F)},$$slots:{default:!0}});var P=b(A,2);Ma(P,{title:"Summary",children:(L,q)=>{var F=Ed(),U=x(F),W=b(x(U),2),ae=x(W),re=b(U,2),Re=b(x(re),2),fe=x(Re),se=b(re,2);{var We=De=>{var Ie=Ad(),de=b(x(Ie),2),Q=x(de);H(()=>Oe(Q,n().objectives.length)),_(De,Ie)};z(se,De=>{n()&&De(We)})}var xe=b(se,2);{var _e=De=>{var Ie=Cd(),de=b(x(Ie),2),Q=x(de);H(()=>Oe(Q,`${o().terrains.length??""} terrain, ${o().walls.length??""} walls`)),_(De,Ie)};z(xe,De=>{(o().terrains.length>0||o().walls.length>0)&&De(_e)})}H(()=>{Oe(ae,n()?.name||"None"),Oe(fe,r()||"None")}),_(L,F)},$$slots:{default:!0}});var E=b(k,2),S=x(E),R=x(S);{let L=Me(()=>n()?.zones),q=Me(()=>n()?.objectives);Tr(R,{get deploymentZones(){return e(L)},get objectives(){return e(q)},get terrains(){return o().terrains},get walls(){return o().walls}})}_(t,f),Za(),u()}var Dd=ce('<ellipse fill="none" stroke-width="2"></ellipse>'),Id=ce('<circle fill="none" stroke-width="2"></circle>'),Ld=ve('<button class="palette-item svelte-1t25izx"><svg class="svelte-1t25izx"><!></svg> <span class="label svelte-1t25izx"> </span></button>');function Kr(t,a){Ja(a,!1);const n=N(),r=N(),s=N(),o=N(),l=N(),u=N();let d=Ae(a,"baseSize",8),m=Ae(a,"playerId",8),y=Ae(a,"onDragStart",8,()=>{});const p=3;function h(S){S.button===0&&(S.preventDefault(),y()(d(),S))}le(()=>D(m()),()=>{g(n,m()===1?"#3b82f6":"#ef4444")}),le(()=>D(d()),()=>{g(r,d().width!==void 0)}),le(()=>(e(r),D(d())),()=>{g(s,e(r)?null:d().radius*p)}),le(()=>(e(r),D(d())),()=>{g(o,e(r)?d().width/2*p:null)}),le(()=>(e(r),D(d())),()=>{g(l,e(r)?d().height/2*p:null)}),le(()=>(e(r),D(d())),()=>{g(u,e(r)?Math.max(d().width,d().height)*p:d().radius*2*p)}),$n(),ln();var f=Ld(),v=x(f),k=x(v);{var T=S=>{var R=Dd();H(()=>{c(R,"cx",(e(u)+8)/2),c(R,"cy",(e(u)+8)/2),c(R,"rx",e(o)),c(R,"ry",e(l)),c(R,"stroke",e(n))}),_(S,R)},A=S=>{var R=Id();H(()=>{c(R,"cx",(e(u)+8)/2),c(R,"cy",(e(u)+8)/2),c(R,"r",e(s)),c(R,"stroke",e(n))}),_(S,R)};z(k,S=>{e(r)?S(T):S(A,!1)})}var P=b(v,2),E=x(P);H(()=>{Uc(f,`border-color: ${e(n)??""}`),c(f,"title",(D(d()),i(()=>d().label))),c(v,"width",e(u)+8),c(v,"height",e(u)+8),c(v,"viewBox",`0 0 ${e(u)+8} ${e(u)+8}`),Oe(E,(D(d()),i(()=>d().label)))}),Z("mousedown",f,h),_(t,f),Za()}const Tl="warhammer-imported-armies";function $d(){try{const t=localStorage.getItem(Tl);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load army imports from storage:",t),[]}}function ni(t){try{localStorage.setItem(Tl,JSON.stringify(t))}catch(a){console.error("Failed to save army imports to storage:",a)}}function Pd(){return"import-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Nd(){const{subscribe:t,set:a,update:n}=Sa($d());return{subscribe:t,addImport(r,s,o,l){const u=Pd(),d={id:u,name:r||"Unnamed Army",timestamp:Date.now(),rawText:s,parsedData:o,faction:o.FACTION_KEYWORD||"Unknown",totalPoints:o.TOTAL_ARMY_POINTS||"0pts",playerId:l};return n(m=>{const y=[...m,d];return ni(y),y}),u},removeImport(r){n(s=>{const o=s.filter(l=>l.id!==r);return ni(o),o})},getImport(r){return sn({subscribe:t}).find(o=>o.id===r)||null},clear(){a([]),ni([])}}}const fi=Nd();var Od=ve('<div class="error-message svelte-11ilo6m"> </div>'),Wd=ve('<div class="success-message svelte-11ilo6m"> </div>'),Yd=ve("<option> </option>"),Hd=ve('<div class="army-import-panel svelte-11ilo6m"><div class="form-group svelte-11ilo6m"><label for="army-list-input" class="svelte-11ilo6m">Paste Army List:</label> <textarea id="army-list-input" placeholder="Paste your army list here (GW App, WTC, ListForge formats supported)" rows="12" class="svelte-11ilo6m"></textarea></div> <div class="button-group svelte-11ilo6m"><button class="svelte-11ilo6m"> </button> <button class="svelte-11ilo6m">Clear</button></div> <!> <!> <div class="divider svelte-11ilo6m"></div> <div class="form-group svelte-11ilo6m"><label for="import-select" class="svelte-11ilo6m">Load Previous Import:</label> <select id="import-select" class="svelte-11ilo6m"><option>-- Select an import --</option><!></select> <button class="load-button svelte-11ilo6m">Load</button></div></div>');function Fd(t,a){Ja(a,!1);const n=()=>Xt(fi,"$armyImports",r),[r,s]=As();let o=Ae(a,"currentPlayer",8,1);const l=el();let u=N(""),d=N(!1),m=N(""),y=N(""),p=N("");function h(){if(!e(u).trim()){g(m,"Please paste an army list");return}g(d,!0),g(m,""),g(y,""),l("parse",{text:e(u),playerId:o()})}function f(){if(!e(p))return;const de=fi.getImport(e(p));de&&(g(u,de.rawText),g(y,`Loaded: ${de.name} (${de.faction}, ${de.totalPoints})`),g(m,""))}function v(){g(u,""),g(m,""),g(y,"")}function k(de){g(d,de)}function T(de){g(m,de),g(y,""),g(d,!1)}function A(de){g(y,de),g(m,""),g(d,!1)}function P(){g(u,"")}var E={setLoading:k,setError:T,setSuccess:A,clearText:P};ln();var S=Hd(),R=x(S),L=b(x(R),2),q=b(R,2),F=x(q),U=x(F),W=b(F,2),ae=b(q,2);{var re=de=>{var Q=Od(),Ve=x(Q);H(()=>Oe(Ve,`⚠️ ${e(m)??""}`)),_(de,Q)};z(ae,de=>{e(m)&&de(re)})}var Re=b(ae,2);{var fe=de=>{var Q=Wd(),Ve=x(Q);H(()=>Oe(Ve,`✓ ${e(y)??""}`)),_(de,Q)};z(Re,de=>{e(y)&&de(fe)})}var se=b(Re,4),We=b(x(se),2);H(()=>{e(p),Ho(()=>{e(d),n()})});var xe=x(We);xe.value=xe.__value="";var _e=b(xe);at(_e,1,n,de=>de.id,(de,Q)=>{var Ve=Yd(),G=x(Ve),Fe={};H(()=>{Oe(G,`${e(Q),i(()=>e(Q).name)??""} (${e(Q),i(()=>e(Q).faction)??""}, ${e(Q),i(()=>e(Q).totalPoints)??""})`),Fe!==(Fe=(e(Q),i(()=>e(Q).id)))&&(Ve.value=(Ve.__value=(e(Q),i(()=>e(Q).id)))??"")}),_(de,Ve)});var De=b(We,2);H(de=>{L.disabled=e(d),F.disabled=de,Oe(U,e(d)?"Parsing...":"Parse Army List"),W.disabled=e(d),We.disabled=e(d),De.disabled=e(d)||!e(p)},[()=>(e(d),e(u),i(()=>e(d)||!e(u).trim()))]),Fs(L,()=>e(u),de=>g(u,de)),Z("click",F,h),Z("click",W,v),Jo(We,()=>e(p),de=>g(p,de)),Z("click",De,f),_(t,S),or(a,"setLoading",k),or(a,"setError",T),or(a,"setSuccess",A),or(a,"clearText",P);var Ie=Za(E);return s(),Ie}var Bd=ve("<option> </option>"),qd=ve('<tr><td class="unit-name svelte-1qdui6g"> </td><td class="quantity svelte-1qdui6g"> </td><td class="svelte-1qdui6g"><select class="svelte-1qdui6g"></select></td><td class="skip-cell svelte-1qdui6g"><input type="checkbox" class="svelte-1qdui6g"/></td></tr>'),Ud=ve('<div class="dialog-overlay svelte-1qdui6g"><div class="dialog svelte-1qdui6g"><div class="dialog-header svelte-1qdui6g"><h3 class="svelte-1qdui6g">Unmatched Units</h3> <button class="close-button svelte-1qdui6g">&times;</button></div> <div class="dialog-content svelte-1qdui6g"><p class="info-text svelte-1qdui6g">The following units were not found in the database. Please select base sizes or skip them:</p> <div class="units-table svelte-1qdui6g"><table class="svelte-1qdui6g"><thead class="svelte-1qdui6g"><tr><th class="svelte-1qdui6g">Unit Name</th><th class="svelte-1qdui6g">Quantity</th><th class="svelte-1qdui6g">Base Size</th><th class="svelte-1qdui6g">Skip</th></tr></thead><tbody></tbody></table></div></div> <div class="dialog-footer svelte-1qdui6g"><button class="cancel-button svelte-1qdui6g">Cancel</button> <button class="import-button svelte-1qdui6g">Import Selected</button></div></div></div>');function Kd(t,a){Ja(a,!1);let n=Ae(a,"unmatchedUnits",24,()=>[]),r=Ae(a,"show",12,!1);const s=el();let o=N({});const l=[...rn.circles.map(h=>({value:h.type,label:h.label})),...rn.ovals.map(h=>({value:h.type,label:h.label})),{value:"rect-custom",label:"Custom Rectangle (Vehicle)"}];function u(){const h=n().filter(f=>!e(o)[f.id]?.skip).map(f=>({unitName:f.unitName,quantity:f.quantity,baseType:e(o)[f.id]?.baseType||"32mm"}));s("import",{selected:h}),d()}function d(){r(!1),s("close")}le(()=>D(n()),()=>{g(o,{}),n().forEach(h=>{ei(o,e(o)[h.id]={baseType:"32mm",skip:!1})})}),$n(),ln();var m=ze(),y=ie(m);{var p=h=>{var f=Ud(),v=x(f),k=x(v),T=b(x(k),2),A=b(k,2),P=b(x(A),2),E=x(P),S=b(x(E));at(S,5,n,F=>F.id,(F,U)=>{var W=qd();let ae;var re=x(W),Re=x(re),fe=b(re),se=x(fe),We=b(fe),xe=x(We);H(()=>{e(o),Ho(()=>{e(U)})}),at(xe,5,()=>l,Ct,(Ie,de)=>{var Q=Bd(),Ve=x(Q),G={};H(()=>{Oe(Ve,(e(de),i(()=>e(de).label))),G!==(G=(e(de),i(()=>e(de).value)))&&(Q.value=(Q.__value=(e(de),i(()=>e(de).value)))??"")}),_(Ie,Q)});var _e=b(We),De=x(_e);H(()=>{ae=Oa(W,1,"svelte-1qdui6g",null,ae,{skipped:e(o)[e(U).id]?.skip}),Oe(Re,(e(U),i(()=>e(U).unitName))),Oe(se,(e(U),i(()=>e(U).quantity||"1x"))),xe.disabled=(e(o),e(U),i(()=>e(o)[e(U).id]?.skip))}),Jo(xe,()=>e(o)[e(U).id].baseType,Ie=>ei(o,e(o)[e(U).id].baseType=Ie)),Na(De,()=>e(o)[e(U).id].skip,Ie=>ei(o,e(o)[e(U).id].skip=Ie)),_(F,W)});var R=b(A,2),L=x(R),q=b(L,2);Z("click",T,d),Z("click",L,d),Z("click",q,u),Z("click",v,F=>F.stopPropagation()),Z("click",f,d),_(h,f)};z(y,h=>{r()&&h(p)})}_(t,m),Za()}function is(t){const a=t.match(/^\s*/);return a?a[0].length:0}function be(t){return t?t.toLowerCase().replace(/\s+/g," ").trim():""}function ls(t){const a=/^(?:(\d+)x?\s+)?(.*)/,n=t.trim().match(a);if(n){const r=n[1]?`${n[1]}x`:"1x";let s=n[2].trim();return s=s.replace(/^with\s+/i,"").trim(),{quantity:r,name:s}}return{quantity:"1x",name:t.trim()}}function En(t){return Array.isArray(t)&&t.sort((a,n)=>{const r=parseInt(String(a&&a.quantity||"1x").replace(/x/i,""),10)||1,s=parseInt(String(n&&n.quantity||"1x").replace(/x/i,""),10)||1;if(r!==s)return s-r;const o=a&&a.name?a.name.toString().toLowerCase():"",l=n&&n.name?n.name.toString().toLowerCase():"";return o<l?-1:o>l?1:0}),t}const Rn={"World Eaters":"Chaos","Chaos Space Marines":"Chaos","Emperor's Children":"Chaos","Death Guard":"Chaos","Chaos Daemons":"Chaos","Chaos Knights":"Chaos","Thousand Sons":"Chaos","Space Marines":"Imperium","Iron Hands":"Space Marines",Salamanders:"Space Marines","Space Wolves":"Space Marines",Ultramarines:"Space Marines","White Scars":"Space Marines","Adepta Sororitas":"Imperium","Astra Militarum":"Imperium","Imperial Fists":"Space Marines","Dark Angels":"Space Marines","Blood Angels":"Space Marines","Raven Guard":"Space Marines","Black Templars":"Space Marines",Deathwatch:"Space Marines","Grey Knights":"Imperium","Imperial Knights":"Imperium","Adeptus Custodes":"Imperium","Adeptus Titanicus":"Imperium","Adeptus Mechanicus":"Imperium","Agents of the Imperium":"Imperium",Aeldari:"Xenos",Drukhari:"Xenos",Ynnari:"Xenos",Harlequins:"Xenos",Necrons:"Xenos",Orks:"Xenos",Tyranids:"Xenos","T'au Empire":"Xenos",Tau:"Xenos","T'au":"Xenos","Genestealer Cults":"Xenos","Leagues of Votann":"Xenos"};function Es(t){if(!t)return t;t.SUMMARY=t.SUMMARY||{};const a=t.SUMMARY;a.LIST_TITLE=a.LIST_TITLE||"",a.FACTION_KEYWORD&&(a.FACTION_KEYWORD=String(a.FACTION_KEYWORD).trim()),a.DETACHMENT&&(a.DETACHMENT=String(a.DETACHMENT).replace(/\u00A0/g," ").trim()),a.TOTAL_ARMY_POINTS&&(a.TOTAL_ARMY_POINTS=String(a.TOTAL_ARMY_POINTS).trim());const n=s=>{if(!s)return"";try{return s.toString().normalize("NFD").replace(new RegExp("\\p{M}","gu"),"").replace(/[\u2018\u2019\u201B\u2032]/g,"'").replace(/[^\w\s'\-]/g,"").toLowerCase().trim()}catch{return s.toString().toLowerCase().trim()}},r=a.FACTION_KEYWORD||null;if(r){const s=n(r);let o;for(const l of Object.keys(Rn))if(n(l)===s){o=l;break}if(o){const l=r.toString().replace(/[\u2018\u2019\u201B\u2032]/g,"'").trim();a.DISPLAY_FACTION=`${Rn[o]} - ${l}`}else a.DISPLAY_FACTION=a.DISPLAY_FACTION||r+(a.DETACHMENT?` - ${a.DETACHMENT}`:"")}else a.DETACHMENT?a.DISPLAY_FACTION=a.DISPLAY_FACTION||a.DETACHMENT:a.DISPLAY_FACTION=a.DISPLAY_FACTION||"";if(!a.FACTION_KEY){if(a.FACTION_KEYWORD)try{a.FACTION_KEY=a.FACTION_KEYWORD.toString().toLowerCase()}catch{a.FACTION_KEY=String(a.FACTION_KEYWORD).toLowerCase()}else if(a.DISPLAY_FACTION){const s=(a.DISPLAY_FACTION||"").split(" - ")[0];try{a.FACTION_KEY=s.toString().toLowerCase()}catch{a.FACTION_KEY=String(s).toLowerCase()}}}return t}function ds(t,a,n,r,s="",o=!1,l="wargear"){if(!t)return;t.items=t.items||[];const u=ls(String(a||"").trim()),d=u.quantity?String(u.quantity):"1x",m=u.name||"",y=be(m);if(o){const h=String(n||""),f=String(s||"");if(be(h)===be(m)||f&&be(f)===be(m))return}const p=t.items.find(h=>be(h.name||"")===y);if(p){const h=parseInt(String(p.quantity||"1x").replace(/x/i,""),10)||0,f=parseInt(String(d||"1x").replace(/x/i,""),10)||0;p.quantity=`${h+f}x`}else{const h=be(m)==="warlord"?"special":l;t.items.push({quantity:d,name:m,items:[],type:h,nameshort:""})}}function Gd(t,a){if(!t||!a)return;a.items=a.items||[];const n=t.trim(),r=n.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",o=n.replace(/\s*\([^)]+\)$/,"").trim(),l=be(o);if((a.items||[]).some(p=>p&&p.type==="special"&&be((p.name||"").replace(/^Enhancement:\s*/i,""))===l))return;const m=`E: ${o.split(/\s+/).map(p=>p[0]?p[0].toUpperCase():"").join("")}${s}`.trim(),y={quantity:"1x",name:`Enhancement: ${o}`,nameshort:m,items:[],type:"special"};a.items.push(y)}function zd(t){const a={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return a;const n=[];let r=0;const s=p=>/^(\d+)x?\s+/i.test(String(p||"").trim()),o=(p,h)=>{const f=String(p||"").trim();if(!f)return f;if(s(f)){const v=f.match(/^(\d+)x?\s+(.*)$/i);if(v){const k=parseInt(v[1],10)||1,T=v[2].trim();return`${Math.max(1,k*(parseInt(h,10)||1))}x ${T}`}return f}return`${h}x ${f}`};for(;r<t.length;r++){const h=(t[r]||"").trim();if(h){if(h.startsWith("+")||h.startsWith("&")){n.push(h);continue}break}}for(const p of n){if(p.startsWith("&")){const k=p.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);k&&(k[1].trim(),(k[3]||"").trim());continue}const f=p.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(f){const v=f[1].trim().toUpperCase(),k=f[2].trim();if(v==="FACTION KEYWORD"){const T=k.split(" - ");a.SUMMARY.FACTION_KEYWORD=T[T.length-1].trim()}else v==="DETACHMENT"?a.SUMMARY.DETACHMENT=k.replace(/\u00A0/g," "):v==="TOTAL ARMY POINTS"&&(a.SUMMARY.TOTAL_ARMY_POINTS=k)}}if(a.SUMMARY.LIST_TITLE="",a.SUMMARY&&a.SUMMARY.FACTION_KEYWORD){const p=a.SUMMARY.FACTION_KEYWORD,h=Object.keys(Rn).find(v=>v.toLowerCase()===(p||"").toString().toLowerCase()),f=h?Rn[h]:null;f?a.SUMMARY.DISPLAY_FACTION=`${f} - ${p}`:a.SUMMARY.DISPLAY_FACTION=p+(a.SUMMARY.DETACHMENT?` - ${a.SUMMARY.DETACHMENT}`:"");try{a.SUMMARY.FACTION_KEY=p.toString().toLowerCase()}catch{}}let l=null,u=null;const d=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,m=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;for(;r<t.length;r++){const p=t[r]||"",h=p.trim();if(!h)continue;if(/^Enhancement:\s*/i.test(h)){const A=h.replace(/^Enhancement:\s*/i,"").trim();u&&Gd(A,u);continue}const f=h.match(d);if(f){const A=f[1],P=f[2]?`${f[2]}x`:"1x",E=(f[3]||"").trim(),S=parseInt(f[4],10)||0,R=f[5],L={quantity:P,name:E,points:S,items:[],isComplex:!1,nameshort:""};A?(a.CHARACTER.push(L),u=L):(a["OTHER DATASHEETS"]=a["OTHER DATASHEETS"]||[],a["OTHER DATASHEETS"].push(L)),l=L,R&&R.split(",").map(q=>q.trim()).filter(Boolean).forEach(q=>ds(L,q,L.name,a.SUMMARY.FACTION_KEYWORD||"",L.name,!0));continue}const v=p.match(m);if(v){const A=v[1].trim(),P=A.match(/^(\d+)\s+with\s+(.*)$/i);if(P&&l){const R=parseInt(P[1],10)||1,L=P[2],q=l.items&&l.items.length>0?l.items[l.items.length-1]:l;L.split(",").map(F=>F.trim()).filter(Boolean).forEach(F=>{const U=o(F,R);ds(q,U,q.name,a.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}const E=A.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(E&&l){const R=E[1],L=E[2].trim(),q=E[3]||"",F={quantity:R,name:L,items:[],type:"subunit"};if(l.items=l.items||[],l.items.push(F),q){const U=q.match(/^(\d+)\s+with\s+(.*)$/i);if(U){const W=parseInt(U[1],10)||1;U[2].split(",").map(re=>re.trim()).filter(Boolean).forEach(re=>{const Re=o(re,W);ds(F,Re,F.name,a.SUMMARY.FACTION_KEYWORD||"",l.name,!0)})}else q.split(",").map(W=>W.trim()).filter(Boolean).forEach(W=>ds(F,W,F.name,a.SUMMARY.FACTION_KEYWORD||"",l.name,!0))}continue}const S=A.match(/^(\d+x?)\s+(.*)$/i);if(S&&l){const R={quantity:S[1],name:S[2].trim(),items:[],type:"subunit"};l.items=l.items||[],l.items.push(R);continue}if(l){ds(l,A,l.name,a.SUMMARY.FACTION_KEYWORD||"",l.name,!0);continue}continue}const k=h.match(/^(\d+)\s+with\s+(.*)$/i);if(k&&l){const A=parseInt(k[1],10)||1,P=k[2],E=l.items&&l.items.length>0?l.items[l.items.length-1]:l;P.split(",").map(S=>S.trim()).filter(Boolean).forEach(S=>{const R=o(S,A);ds(E,R,E.name,a.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}const T=h.match(/^(.*?):\s*(.*)$/);if(T&&l){(T[2]||"").split(",").map(P=>P.trim()).filter(Boolean).forEach(P=>ds(l,P,l.name,a.SUMMARY.FACTION_KEYWORD||"",l.name,!0));continue}}const y=[...a.CHARACTER||[],...a["OTHER DATASHEETS"]||[]];for(const p of y){p&&Array.isArray(p.items)&&p.items.length>0&&En(p.items);const h=p&&Array.isArray(p.items)?p.items.filter(f=>f&&f.type==="subunit"):[];for(const f of h)f&&Array.isArray(f.items)&&f.items.length>0&&En(f.items)}return Es(a),a}function Tn(t,a,n,r,s="",o=!1,l="wargear"){if(!t)return;t.items=t.items||[];const u=String(a||"").trim();if(/battlesuit support system|homing beacon|marker drone/i.test(u))try{nn.push(`processing raw=${u} for target=${t&&t.name}`)}catch{}let d=u.split(",").map(S=>S.trim()).filter(Boolean);try{const S=new Set;d=d.filter(R=>{const L=be(Hs(Hn(R)));return S.has(L)?!1:(S.add(L),!0)})}catch{}try{/stealth shas'vre|stealth battlesuits/i.test((t&&t.name||"")+(s||"")+u)&&nn.push(`splitParts target=${t&&t.name} top=${s} parts=${JSON.stringify(d)}`)}catch{}if(d.length>1){d.forEach(S=>Tn(t,S,n,r,s,o,l));return}const m=ls(u),y=m.quantity!==void 0&&m.quantity!==null;let p=y?String(m.quantity):"1x",h=m.name||"";try{h=Hs(Hn(h))}catch{}const f=/battlesuit support system|homing beacon|marker drone/i;try{const S=h.toLowerCase();if(S.includes("battlesuit support system")||S.includes("homing beacon")||S.includes("marker drone"))try{nn.push(`addItemToTarget target=${t&&t.name} raw=${u}`)}catch{}}catch{}const v=h.match(/^(\d+)x\s+(.*)$/i);if(v){const S=parseInt(v[1],10)||1,R=parseInt(String(p||"1x").replace(/x/i,""),10)||1;p=`${Math.max(1,R*S)}x`,h=v[2]}try{nn.push(`PARSE_QTY name=${h} parsedQtyRaw=${String(m.quantity||"")} qtyToken=${p}`)}catch{}let k=(S=>isNaN(S)?1:S)(parseInt(String(p||"1x").replace(/x/i,""),10)),T=k;try{if(t&&t.type==="subunit"){const S=parseInt(String(t.quantity||"1x").replace(/[^0-9]/g,""),10)||1;try{nn.push(`CALC_EFFECTIVE target=${t&&t.name} parentQty=${S} parsedQty=${k} hasExplicit=${y}`)}catch{}T=y?k:S;try{nn.push(`EFFECTIVE_QTY target=${t&&t.name} effectiveQty=${T}`)}catch{}}}catch{}const A=h,P=be(h);if(o){const S=String(n||""),R=String(s||"");if(be(S)===be(h)||R&&be(R)===be(h)){if(f.test(h))try{nn.push(`SKIP matched unitname name=${h} ctx=${S} top=${R}`)}catch{}return}}const E=t.items.find(S=>be(S.name||"")===P);if(E){const S=parseInt(String(E.quantity||"1x").replace(/x/i,""),10)||0,R=S+T;E.quantity=`${R}x`;try{nn.push(`UPDATED existing name=${h} existing=${S} added=${T} new=${R} target=${t&&t.name}`)}catch{}}else{const S=be(h)==="warlord"?"special":l;t.items.push({quantity:`${T}x`,name:A,items:[],type:S,nameshort:""});try{nn.push(`PUSHED new name=${h} quantity=${T} target=${t&&t.name}`)}catch{}}}function Hn(t){if(!t)return t;const a=t.toLowerCase();return a.includes("shield")&&a.includes("drone")?"Shield Drone":a.includes("marker")&&a.includes("drone")?"Marker Drone":a.includes("marker")&&a.includes("beacon")?"Homing Beacon":t}function Hs(t){return t&&t.split(/\s+/).map(a=>!a||/[A-Z]/.test(a.slice(1))?a:a[0].toUpperCase()+a.slice(1).toLowerCase()).join(" ")}function Zi(t,a){if(!a)return`${t}x`;const n=String(a).trim(),r=n.match(/^(\d+)x\s+(.*)$/i);if(r){const s=parseInt(r[1],10)||1,o=r[2]||"";return`${Math.max(1,t*s)}x ${o}`}return`${t}x ${n}`}function Xd(t,a){if(!t||!a)return;a.items=a.items||[];const n=t.trim(),r=n.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",o=n.replace(/\s*\([^)]+\)$/,"").trim(),l=be(o);if((a.items||[]).some(p=>{if(!p||!p.name)return!1;const h=String(p.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]+\)$/,"").trim();return be(h)===l}))return;const m=`E: ${o.split(/\s+/).map(p=>p[0]?p[0].toUpperCase():"").join("")}${s}`.trim(),y={quantity:"1x",name:`Enhancement: ${o}`,nameshort:m,items:[],type:"special"};a.items.push(y)}function Vd(t){const a={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return a;const n=[];let r=0;for(;r<t.length;r++){const y=(t[r]||"").trim();if(y){if(y.startsWith("+")){n.push(y);continue}if(!y.startsWith("&"))break}}for(const m of n){const p=m.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(p){const h=p[1].trim().toUpperCase(),f=p[2].trim();if(h==="FACTION KEYWORD"){const v=f.split(" - ");a.SUMMARY.FACTION_KEYWORD=v[v.length-1].trim()}else h==="DETACHMENT"?a.SUMMARY.DETACHMENT=f.replace(/\u00A0/g," "):h==="TOTAL ARMY POINTS"&&(a.SUMMARY.TOTAL_ARMY_POINTS=f)}}if(a.SUMMARY.LIST_TITLE="",a.SUMMARY&&a.SUMMARY.FACTION_KEYWORD){const m=a.SUMMARY.FACTION_KEYWORD,y=Object.keys(Rn).find(h=>h.toLowerCase()===(m||"").toString().toLowerCase()),p=y?Rn[y]:null;p?a.SUMMARY.DISPLAY_FACTION=`${p} - ${m}`:a.SUMMARY.DISPLAY_FACTION=m+(a.SUMMARY.DETACHMENT?` - ${a.SUMMARY.DETACHMENT}`:"");try{a.SUMMARY.FACTION_KEY=m.toString().toLowerCase()}catch{}}const s=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,o=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;let l=null,u=null;for(;r<t.length;r++){const m=t[r]||"",y=m.trim();if(!y)continue;if(/^Enhancement:\s*/i.test(y)){const k=y.replace(/^Enhancement:\s*/i,"").trim();u&&Xd(k,u);continue}const p=y.match(s);if(p){const k=p[1],T=p[2]?`${p[2]}x`:"1x",A=(p[3]||"").trim(),P=parseInt(p[4],10)||0,E=p[5],S={quantity:T,name:A,points:P,items:[],isComplex:!1,nameshort:"",charId:k||null};k?(a.CHARACTER.push(S),u=S):(a["OTHER DATASHEETS"]=a["OTHER DATASHEETS"]||[],a["OTHER DATASHEETS"].push(S)),l=S,E&&E.split(",").map(R=>R.trim()).filter(Boolean).forEach(R=>Tn(S,R,S.name,a.SUMMARY.FACTION_KEYWORD||"",S.name,!0));continue}const h=m.match(o);if(h){const k=h[1].trim(),T=k.match(/^(\d+)\s+with\s+(.*)$/i);if(T&&l){const E=parseInt(T[1],10)||1,S=T[2],R=l.items&&l.items.length>0?l.items[l.items.length-1]:l;try{nn.push(`WITHMATCH unit=${l.name} target=${R&&R.name} n=${E} rest=${S}`)}catch{}S.split(",").map(L=>L.trim()).filter(Boolean).forEach(L=>{const F=Hs(Hn(L));if(R&&R.type==="subunit"){try{nn.push(`WITH->SUB target=${R.name} item=${F} n=${E}`)}catch{}Tn(R,`${E}x ${F}`,R.name,a.SUMMARY.FACTION_KEYWORD||"",l.name,!0)}else{try{nn.push(`WITH->UNIT unit=${l.name} item=${F} n=${E}`)}catch{}Tn(R,Zi(E,F),R.name,a.SUMMARY.FACTION_KEYWORD||"",l.name,!0)}});continue}const A=k.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(A&&l){const E=A[1],S=A[2].trim(),R=A[3]||"",L={quantity:E,name:S,items:[],type:"subunit",_parent:l};if(l.items=l.items||[],l.items.push(L),R){const q=R.match(/^(\d+)\s+with\s+(.*)$/i);q?q[2].split(",").map(U=>U.trim()).filter(Boolean).forEach(U=>{const W=Hn(U);Tn(L,W,L.name,a.SUMMARY.FACTION_KEYWORD||"",l.name,!0)}):R.split(",").map(F=>F.trim()).filter(Boolean).forEach(F=>{const U=Hn(F);Tn(L,U,L.name,a.SUMMARY.FACTION_KEYWORD||"",l.name,!0)})}continue}const P=k.match(/^(\d+x?)\s+(.*)$/i);if(P&&l)if(l.charId){const E=P[1],S=P[2].trim();Tn(l,`${E} ${S}`,l.name,a.SUMMARY.FACTION_KEYWORD||"",l.name,!0);continue}else{const E={quantity:P[1],name:P[2].trim(),items:[],type:"subunit",_parent:l};l.items=l.items||[],l.items.push(E);continue}if(l){let E=k.split(",").map(R=>R.trim()).filter(Boolean);try{const R=l.items&&l.items.length>0?l.items[l.items.length-1]:null;R&&R.name&&(E=E.map(L=>{const q=L.match(/^(.*)\s*\(([^)]+)\)\s*$/);if(q){const F=q[1].trim();if(be(F)===be(R.name))return F}return L}))}catch{}try{const R=new Set;E=E.filter(L=>{const q=be(Hs(Hn(L)));return R.has(q)?!1:(R.add(q),!0)})}catch{}let S=l;if(l.items&&l.items.length>0){const R=l.items[l.items.length-1];R&&R.type==="subunit"&&(S=R)}E.forEach(R=>{const L=Hs(Hn(R));Tn(S,L,S.name||l.name,a.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}continue}const f=y.match(/^(\d+)\s+with\s+(.*)$/i);if(f&&l){const k=parseInt(f[1],10)||1,T=f[2],A=l.items&&l.items.length>0?l.items[l.items.length-1]:l;T.split(",").map(P=>P.trim()).filter(Boolean).forEach(P=>{const S=Hs(Hn(P));A&&A.type==="subunit"?Tn(A,`${k}x ${S}`,A.name,a.SUMMARY.FACTION_KEYWORD||"",l.name,!0):Tn(A,Zi(k,S),A.name,a.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}const v=y.match(/^(.*?):\s*(.*)$/);if(v&&l){(v[2]||"").split(",").map(T=>T.trim()).filter(Boolean).forEach(T=>{const A=Hn(T);Tn(l,A,l.name,a.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}}const d=[...a.CHARACTER||[],...a["OTHER DATASHEETS"]||[]];for(const m of d){m&&Array.isArray(m.items)&&m.items.length>0&&En(m.items);const y=m&&Array.isArray(m.items)?m.items.filter(p=>p&&p.type==="subunit"):[];for(const p of y)p&&Array.isArray(p.items)&&p.items.length>0&&En(p.items)}Es(a);try{a.SUMMARY._parseDebug=(nn||[]).slice(0,200)}catch{}return a}const nn=[];function Dr(t){const a=is(t);if(a>0)return a;const n=(t||"").trim();return n.startsWith("◦")||n.startsWith("+")?2:0}function Ir(t){if(!t)return"";const a=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(t).split(/\s+/).map((n,r)=>{if(!n)return"";const s=n.toLowerCase();return r>0&&a.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function Ps(t,a,n,r,s="",o=!1,l="wargear",u=1){if(!t)return;t.items=t.items||[];const d=ls(String(a||"").trim()),m=d.quantity?String(d.quantity):"1x",y=d.name||"",p=be(y);if(o){const f=String(n||""),v=String(s||"");if(be(f)===be(y)||v&&be(v)===be(y))return}const h=t.items.find(f=>be(f.name||"")===p);if(h){const f=parseInt(String(h.quantity||"1x").replace(/x/i,""),10)||0,v=parseInt(String(m||"1x").replace(/x/i,""),10)||0;h.quantity=`${f+v}x`}else{const f=be(y)==="warlord"?"special":l;t.items.push({quantity:m,name:y,items:[],type:f,nameshort:""})}}function Qi(t,a,n){if(!t||!a)return;a.items=a.items||[];const r=t.trim(),s=r.match(/\(([^)]+)\)$/),o=s?` (${s[1]})`:"",l=r.replace(/\s*\([^)]+\)$/,"").trim(),u=be(l);if((a.items||[]).some(h=>h&&h.type==="special"&&be((h.name||"").replace(/^Enhancement:\s*/i,""))===u))return;const y=`E: ${l.split(/\s+/).map(h=>h[0]?h[0].toUpperCase():"").join("")}${o}`.trim(),p={quantity:"1x",name:`Enhancement: ${l}`,nameshort:y,items:[],type:"special"};a.items.push(p)}function jd(t){const a={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},n=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=t.findIndex(h=>n.test((h||"").trim().toUpperCase()));let o=(r===-1?t.slice(0,0):t.slice(0,r)).map(h=>(h||"").trim()).filter(h=>h&&!h.startsWith("Exported with"));const l=o.findIndex(h=>h&&h.trim()!=="");if(l!==-1){const h=o[l],f=h.match(/^(.*?)\s*\((\s*\d+\s*(?:pts|points)\s*)\)\s*$/i);if(f){a.SUMMARY.LIST_TITLE=f[1].trim();const L=(f[2].match(/(\d+)/)||[])[1]||"";L&&(a.SUMMARY.TOTAL_ARMY_POINTS=`${L}pts`)}else a.SUMMARY.LIST_TITLE=h;const v=[];for(let L=l+1;L<o.length;L++){const q=o[L];q&&v.push(q)}const k=["Combat Patrol","Incursion","Strike Force","Onslaught"],T=L=>{if(!L||!/\(/.test(L))return!1;for(const q of k)if(new RegExp(q,"i").test(L))return!0;return!1},A=new Set(Object.values(Rn).map(L=>(L||"").toString().toLowerCase())),P=v.filter(L=>!(!L||T(L)||A.has(L.toLowerCase())));let E=null,S=null;const R=Object.keys(Rn).map(L=>L.toLowerCase());for(const L of P)R.includes((L||"").toString().toLowerCase())?E=L:S||(S=L);if(!E&&P.length>0&&(E=P[0],S=P.length>1?P[1]:S),E&&(a.SUMMARY.FACTION_KEYWORD=E),S&&(a.SUMMARY.DETACHMENT=S),E){const L=Object.keys(Rn).find(F=>F.toLowerCase()===E.toLowerCase()),q=L?Rn[L]:null;q?a.SUMMARY.DISPLAY_FACTION=`${q} - ${E}`:a.SUMMARY.DISPLAY_FACTION=E+(S?` - ${S}`:"");try{a.SUMMARY.FACTION_KEY=E.toString().toLowerCase()}catch{}}}const u=r===-1?0:r,d=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*$/i,m=/^\s*(?:•|\-|\+|◦)\s*(.*)$/;let y=null;for(let h=u;h<t.length;h++){const v=(t[h]||"").trim();if(!v||v.startsWith("Exported with"))continue;if(n.test(v.toUpperCase())){y=/^CHARACTERS?/i.test(v)?"CHARACTER":"OTHER DATASHEETS";continue}const k=v.match(d);if(k){const T=k[1].trim(),A=parseInt(String(k[2]).replace(/[\,\.\s]/g,""),10)||0;let P="1x",E=T;const S=T.match(/^([0-9]+x?)\s+(.*)$/i);S&&(P=S[1].toLowerCase(),E=S[2].trim());const R={quantity:P,name:E,points:A,items:[],isComplex:!1,nameshort:""},L=y==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";a[L]=a[L]||[],a[L].push(R);const q=[];let F=h+1;for(;F<t.length;){const re=t[F]||"";if(!re.trim()||n.test(re.trim().toUpperCase())||d.test(re.trim())||!/^\s+/.test(re)&&!m.test(re))break;q.push(re),F++}const U=(()=>{for(let re=0;re<q.length;re++){const Re=q[re];if(!Re.match(m))continue;const se=Dr(Re);for(let We=re+1;We<q.length;We++){const xe=q[We];if(!xe.trim()||Dr(xe)<=se)break;if(m.test(xe))return!0}}return!1})();let W=null,ae=0;for(let re=0;re<q.length;re++){const Re=q[re],fe=Re.trim(),se=Re.match(m),We=Dr(Re);if(se){const xe=se[1].trim(),_e=xe.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(xe)){Qi(xe.replace(/^Enhancement:\s*/i,"").trim(),R,a.SUMMARY.FACTION_KEYWORD||"");continue}else if(_e){Qi(xe.trim(),R,a.SUMMARY.FACTION_KEYWORD||"");continue}if(U){if(W&&typeof ae=="number"&&We>ae){Ps(W,xe,W.name,a.SUMMARY.FACTION_KEYWORD||"",R.name,!1);continue}if(!(()=>{for(let G=re+1;G<q.length;G++){const Fe=q[G];if(!Fe.trim()||Dr(Fe)<=We)break;if(m.test(Fe))return!0}return!1})()){W=null,Ps(R,xe,R.name,a.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}W=null;const Ie=xe.match(/^(\d+x?)\s+(.*)$/i),de=Ie?Ie[1]:"1x",Q=Ie?Ie[2].trim():xe,Ve={quantity:de,name:Q,items:[],type:"subunit"};R.items=R.items||[],R.items.push(Ve),W=Ve,ae=We;continue}Ps(R,xe,R.name,a.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(W&&We>ae){Ps(W,fe,W.name,a.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}Ps(R,fe,R.name,a.SUMMARY.FACTION_KEYWORD||"","wargear",1)}h=F-1;continue}}function p(h,f){if(!(!h||typeof h!="object")){if(typeof h.name!="string"&&(h.name=""),typeof h.quantity!="string"&&(h.quantity=h.quantity?String(h.quantity):"1x"),typeof h.type!="string"&&(h.type=h.type||"wargear"),typeof h.nameshort!="string"&&(h.nameshort=h.nameshort||""),Array.isArray(h.items)||(h.items=[]),/^Enhancement:/i.test(h.name)){const v=h.name.replace(/^Enhancement:\s*/i,"").trim();h.type="special",h.nameshort=h.nameshort||(()=>{const k=v.match(/\(([^)]+)\)$/),T=k?` (${k[1]})`:"";return`E: ${v.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(E=>E[0]?E[0].toUpperCase():"").join("")}${T}`.trim()})(),h.name=`Enhancement: ${Ir(v.replace(/\s*\([^)]+\)$/,"").trim())}`}else h.name=f?h.name:Ir(h.name);be(h.name)==="warlord"&&(h.type="special"),h.items=(h.items||[]).map(v=>{if(!v)return null;if(typeof v=="string"){const k={quantity:"1x",name:v.trim(),items:[],type:/^Enhancement:/i.test(v)?"special":"wargear",nameshort:""};return p(k,h.name),k.name&&(k.name=Ir(k.name)),k}return p(v,h.name),v&&v.name&&(v.name=Ir(v.name)),v}).filter(Boolean)}}for(const h of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(a[h]))for(const f of a[h]){p(f);const v=(f.items||[]).filter(k=>k&&k.type==="subunit");if(v.length>0)if(v.every(T=>be(T.name||"")===be(f.name||""))){const T=new Map;let A=0;for(const P of v){const E=parseInt(String(P.quantity||"1x").replace(/x/i,""),10)||1;A+=E;for(const S of P.items||[]){const R={items:[]};Ps(R,`${S.quantity||"1x"} ${S.name}`,f.name,a.SUMMARY.FACTION_KEYWORD||"",S.type||"wargear",1);for(const L of R.items){const q=be(L.name||"");if(T.has(q)){const F=T.get(q),U=parseInt(String(F.quantity||"1x").replace(/x/i,""),10)||0,W=parseInt(String(L.quantity||"1x").replace(/x/i,""),10)||0;F.quantity=`${U+W}x`}else T.set(q,L)}}}f.items=Array.from(T.values()),A>0&&(f.quantity=`${A}x`),f.isComplex=!1}else{const T=v.reduce((A,P)=>A+(parseInt(String(P.quantity||"1x").replace(/x/i,""),10)||0),0);T>0&&(f.quantity=`${T}x`),f.isComplex=!0}else f.isComplex=!1;Array.isArray(f.items)&&f.items.length>0&&En(f.items)}return Es(a),a}function eo(t){if(!t)return"";const a=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(t).split(/\s+/).map((n,r)=>{if(!n)return"";const s=n.toLowerCase();return r>0&&a.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function ts(t,a,n,r,s="",o=!1,l="wargear",u=1){if(!t)return;t.items=t.items||[];const d=ls(String(a||"").trim()),m=d.quantity?String(d.quantity):"1x",y=parseInt(String(m||"1x").replace(/[^0-9]/g,""),10)||1,p=`${y*(u||1)}x`;let h=d.name||"";if(!o)try{const k=h.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(k){const T=k[1].trim(),A=k[2].trim(),P=be(T),E=be(n||""),S=be(s||"");P&&(P===E||P===S||E.startsWith(P+" ")||S.startsWith(P+" ")||P.startsWith(E+" ")||P.startsWith(S+" "))&&(h=A)}}catch{}const f=be(h);if(o){const k=String(n||""),T=String(s||""),A=be(h),P=be(k),E=be(T),S=P&&A.startsWith(P+" "),R=E&&A.startsWith(E+" ");if(P&&(A===P||S)||E&&(A===E||R)){const L=h.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(L){const q=L[1].trim(),F=L[2].trim(),U=be(q);if(U===P||U===E||U.startsWith(P+" ")||U.startsWith(E+" ")){if(t&&t._deferredParenthetical&&be(t._deferredParenthetical)===be(F)||t&&t._deferredParenthetical&&be(t._deferredParenthetical)===be(F)||(t.items||[]).some(ae=>be(ae.name||"")===be(F)))return;ts(t,F,n,r,s,!1,l,y);return}}return}}const v=t.items.find(k=>be(k.name||"")===f);if(v){const k=parseInt(String(v.quantity||"1x").replace(/x/i,""),10)||0,T=parseInt(String(p||"1x").replace(/x/i,""),10)||0;v.quantity=`${k+T}x`}else{const k=be(h)==="warlord"?"special":l;t.items.push({quantity:p,name:h,items:[],type:k,nameshort:""})}}function pi(t,a,n){if(!t||!a)return;a.items=a.items||[];const r=t.trim(),s=r.match(/\(([^)]+)\)$/),o=s?` (${s[1]})`:"",l=r.replace(/\s*\([^)]+\)$/,"").trim(),u=be(l);if((a.items||[]).some(h=>h&&h.type==="special"&&be((h.name||"").replace(/^Enhancement:\s*/i,""))===u))return;const y=`E: ${l.split(/\s+/).map(h=>h[0]?h[0].toUpperCase():"").join("")}${o}`.trim(),p={quantity:"1x",name:`Enhancement: ${l}`,nameshort:y,items:[],type:"special"};a.items.push(p)}function to(t){const a={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},n=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*(?::\s*(.*))?$/i,s=/^\s*(?:•|\-|\+|◦)\s*(.*)$/;let o=null;for(let u=0;u<t.length;u++){const m=(t[u]||"").trim();if(!m)continue;if(n.test(m.toUpperCase())){o=/^CHARACTERS?/i.test(m)?"CHARACTER":"OTHER DATASHEETS";continue}const y=m.match(r);if(y){const p=y[1].trim(),h=parseInt(String(y[2]).replace(/[\,\.\s]/g,""),10)||0;let f="1x",v=p;const k=p.match(/^([0-9]+x?)\s+(.*)$/i);k&&(f=k[1].toLowerCase(),v=k[2].trim());const T={quantity:f,name:v,points:h,items:[],isComplex:!1,nameshort:""},A=o==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";a[A]=a[A]||[],a[A].push(T);const P=y[3]||"";P&&P.split(",").map(F=>F.trim()).filter(Boolean).forEach(F=>ts(T,F,T.name,a.SUMMARY.FACTION_KEYWORD||"",T.name,!0));const E=[];let S=u+1;for(;S<t.length;){const F=t[S]||"";if(!F.trim()||n.test(F.trim().toUpperCase())||r.test(F.trim())||!/^\s+/.test(F)&&!s.test(F))break;E.push(F),S++}const R=(()=>{for(let F=0;F<E.length;F++){const U=E[F];if(!U.match(s))continue;const ae=is(U);for(let re=F+1;re<E.length;re++){const Re=E[re];if(!Re.trim()||is(Re)<=ae)break;if(s.test(Re))return!0}}return!1})();let L=null,q=0;for(let F=0;F<E.length;F++){const U=E[F],W=U.trim(),ae=U.match(s),re=is(U);if(ae){const Re=ae[1].trim(),fe=Re.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(Re)){pi(Re.replace(/^Enhancement:\s*/i,"").trim(),T,a.SUMMARY.FACTION_KEYWORD||"");continue}else if(fe){pi(Re.trim(),T,a.SUMMARY.FACTION_KEYWORD||"");continue}if(R){if(L&&typeof q=="number"&&re>q){const De=Re.split(",").map(Ie=>Ie.trim()).filter(Boolean);for(let Ie of De){const de=Ie.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(de){const Q=de[1].trim(),Ve=de[2].trim();if(be(Q)===be(L.name)){const G=De.some(Ot=>be(Ot)===be(Ve)),Fe=(L.items||[]).some(Ot=>be(Ot.name||"")===be(Ve));if(G||Fe)continue;const he=ls(Ie),kt=parseInt(String(he.quantity||"1x").replace(/[^0-9]/g,""),10)||1;ts(L,Ve,L.name,a.SUMMARY.FACTION_KEYWORD||"",T.name,!1,"wargear",kt);continue}}ts(L,Ie,L.name,a.SUMMARY.FACTION_KEYWORD||"",T.name,!0)}continue}L=null;const se=Re.match(/^(\d+x?)\s+(.*)$/i),We=se?se[1]:"1x";let xe=se?se[2].trim():Re;try{const De=xe.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(De){const Ie=De[1].trim(),de=De[2].trim(),Q=be(Ie),Ve=be(T.name||""),G=be(unitTopName||T.name||"");if(Q&&(Q===Ve||Ve.startsWith(Q)||Q.startsWith(Ve)||G.startsWith(Q)||Q.startsWith(G))){xe=Ie;const Fe={quantity:We,name:xe,items:[],type:"subunit"};Fe._deferredParenthetical=de,Fe._deferredParentheticalQty=parseInt(String(We||"1x").replace(/[^0-9]/g,""),10)||1,T.items=T.items||[],T.items.push(Fe),L=Fe,q=re;continue}}}catch{}const _e={quantity:We,name:xe,items:[],type:"subunit"};T.items=T.items||[],T.items.push(_e),L=_e,q=re;continue}ts(T,Re,T.name,a.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(L&&re>q){ts(L,W,L.name,a.SUMMARY.FACTION_KEYWORD||"",T.name,!0);continue}ts(T,W,T.name,a.SUMMARY.FACTION_KEYWORD||"","wargear",1)}u=S-1;continue}}function l(u,d){if(!(!u||typeof u!="object")){if(typeof u.name!="string"&&(u.name=""),typeof u.quantity!="string"&&(u.quantity=u.quantity?String(u.quantity):"1x"),typeof u.type!="string"&&(u.type=u.type||"wargear"),typeof u.nameshort!="string"&&(u.nameshort=u.nameshort||""),Array.isArray(u.items)||(u.items=[]),/^Enhancement:/i.test(u.name)){const m=u.name.replace(/^Enhancement:\s*/i,"").trim();u.type="special",u.nameshort=u.nameshort||(()=>{const y=m.match(/\(([^)]+)\)$/),p=y?` (${y[1]})`:"";return`E: ${m.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(v=>v[0]?v[0].toUpperCase():"").join("")}${p}`.trim()})(),u.name=`Enhancement: ${eo(m.replace(/\s*\([^)]+\)$/,"").trim())}`}else u.name=d?u.name:eo(u.name);be(u.name)==="warlord"&&(u.type="special"),u.items=(u.items||[]).map(m=>{if(!m)return null;if(typeof m=="string"){const y={quantity:"1x",name:m.trim(),items:[],type:/^Enhancement:/i.test(m)?"special":"wargear",nameshort:""};return l(y,u.name),y}return l(m,u.name),m}).filter(Boolean)}}for(const u of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(a[u]))for(const d of a[u]){l(d);const m=(d.items||[]).filter(p=>p&&p.type==="subunit");if(m.length>0)if(m.every(h=>be(h.name||"")===be(d.name||""))){const h=new Map;let f=0;for(const v of m){const k=parseInt(String(v.quantity||"1x").replace(/x/i,""),10)||1;f+=k;for(const T of v.items||[]){const A={items:[]};ts(A,`${T.quantity||"1x"} ${T.name}`,d.name,a.SUMMARY.FACTION_KEYWORD||"",T.type||"wargear",1);for(const P of A.items){const E=be(P.name||"");if(h.has(E)){const S=h.get(E),R=parseInt(String(S.quantity||"1x").replace(/x/i,""),10)||0,L=parseInt(String(P.quantity||"1x").replace(/x/i,""),10)||0;S.quantity=`${R+L}x`}else h.set(E,P)}}}d.items=Array.from(h.values()),f>0&&(d.quantity=`${f}x`),d.isComplex=!1}else{const h=m.reduce((f,v)=>f+(parseInt(String(v.quantity||"1x").replace(/x/i,""),10)||0),0);h>0&&(d.quantity=`${h}x`),d.isComplex=!1}else d.isComplex=!1;if(Array.isArray(d.items)&&d.items.length===1&&d.items[0]&&d.items[0].type==="subunit"){const p=d.items[0];Array.isArray(p.items)&&p.items.length>0&&(d.items=p.items.slice(),d.isComplex=!1)}Array.isArray(d.items)&&d.items.length>0&&En(d.items);const y=(d.items||[]).filter(p=>p&&p.type==="subunit");for(const p of y)Array.isArray(p.items)&&p.items.length>0&&En(p.items)}return Es(a),a}function Jd(t){if(!Array.isArray(t))return to(t);const a=[];let n=0;for(;n<t.length;n++){const p=String(t[n]||"").trim();if(!p){a.push(p);continue}if(p.startsWith("+")||p.startsWith("&")){a.push(p);continue}break}const r=[],s={};for(const y of a){if(!y)continue;if(y.startsWith("&")){const v=y.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);v&&r.push({enh:v[1].trim(),target:(v[3]||"").trim(),charId:v[2]||null});continue}const h=y.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(h){const f=h[1].trim().toUpperCase(),v=h[2].trim();if(f==="ENHANCEMENT"){const k=v.match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);k?r.push({enh:k[1].trim(),target:(k[3]||"").trim(),charId:k[2]||null}):r.push({enh:v,target:null,charId:null})}else if(f==="FACTION KEYWORD"){const k=v.split(" - ");s.faction=k[k.length-1].trim()}else f==="DETACHMENT"?s.detachment=v.replace(/\u00A0/g," "):f==="TOTAL ARMY POINTS"&&(s.points=v)}}const o=t.slice(n),l=[];for(const y of o){if(!y){l.push(y);continue}let p=String(y);p=p.replace(/^\s*Char\d+:\s*/i,"");const h=p.match(/^(.*\))\s*:\s*(.+)$/);h?(l.push(h[1]),l.push("  • "+h[2])):l.push(p)}const u=to(l);u.SUMMARY=u.SUMMARY||{},s.faction&&(u.SUMMARY.FACTION_KEYWORD=s.faction),s.detachment&&(u.SUMMARY.DETACHMENT=s.detachment),s.points&&(u.SUMMARY.TOTAL_ARMY_POINTS=s.points);const d=[...u.CHARACTER||[],...u["OTHER DATASHEETS"]||[]],m=y=>{const p=be(String(y||""));for(const h of d){const f=h&&Array.isArray(h.items)?h.items:[];for(const v of f){if(!v||!v.name)continue;const k=String(v.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,"").trim();if(be(k)===p)return!0}}return!1};for(const y of r){if(!y||!y.enh||m(y.enh))continue;let p=null;const h=f=>String(f||"").toLowerCase().replace(/[^a-z0-9 ]/g,"").trim();if(y.charId){const f=parseInt(String(y.charId).replace(/[^0-9]/g,""),10);!Number.isNaN(f)&&f>0&&Array.isArray(u.CHARACTER)&&u.CHARACTER[f-1]&&(p=u.CHARACTER[f-1])}!p&&y.target&&(p=d.find(f=>h(f.name).includes(h(y.target))||h(`${f.quantity} ${f.name}`).includes(h(y.target)))),!p&&d.length===1&&(p=d[0]),p&&pi(y.enh,p,u.SUMMARY.FACTION_KEYWORD||"")}try{for(const y of["CHARACTER","OTHER DATASHEETS"]){const p=u[y];if(Array.isArray(p))for(const h of p)h&&typeof h=="object"&&Object.prototype.hasOwnProperty.call(h,"type")&&delete h.type}for(const y of["CHARACTER","OTHER DATASHEETS"]){const p=u[y];if(Array.isArray(p)){for(const h of p)if(!(!h||!Array.isArray(h.items))){for(const f of h.items.filter(v=>v&&v.type==="subunit"))if(f&&f._deferredParenthetical)try{delete f._deferredParenthetical,delete f._deferredParentheticalQty}catch{}}}}}catch{}return Es(u),u}function Zd(t){const a={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return a;const n=t.map(m=>String(m||"")).find(m=>m.trim()),r=t.findIndex(m=>String(m||"").trim());if(n){const m=n.split(/\s*-\s*/).map(y=>y.trim()).filter(Boolean);if(a.SUMMARY.FACTION_FAMILY=m[0]||"",a.SUMMARY.FACTION_KEYWORD=m[1]||"",m.length>=3){const p=m[m.length-1].match(/\[\s*(\d{2,5})\s*pts?\s*\]$/i);p?(a.SUMMARY.TOTAL_ARMY_POINTS=`${p[1]}pts`,m.length===3?a.SUMMARY.LIST_TITLE=m[2]:a.SUMMARY.LIST_TITLE=m.slice(2,m.length-1).join(" - ")):a.SUMMARY.LIST_TITLE=m.slice(2).join(" - ")}a.SUMMARY.DISPLAY_FACTION=n.trim()}for(let m=0;m<Math.min(t.length,40);m++){const y=String(t[m]||"").trim();if(!y)continue;const p=y.match(/^Detachment:\s*(.*)$/i);p&&(a.SUMMARY.DETACHMENT=p[1].trim());const h=y.match(/^TOTAL ARMY POINTS:\s*(.*)$/i);h&&(a.SUMMARY.TOTAL_ARMY_POINTS=h[1].trim());const f=y.match(/^FACTION KEYWORD:\s*(.*)$/i);f&&(a.SUMMARY.FACTION_KEYWORD=f[1].trim());const v=y.match(/^Battle Size:\s*(.*)$/i);v&&(a.SUMMARY.BATTLE_SIZE=v[1].trim());const k=y.match(/^#+\s*(?:\+{1,2}\s*)?(.*)\[\s*\d{2,5}\s*pts?\s*\]$/i);if(k&&!a.SUMMARY.LIST_TITLE){const T=k[1].trim();/Army\s+Roster/i.test(T)||/\+\+/.test(T)?a.SUMMARY.LIST_TITLE="":a.SUMMARY.LIST_TITLE=T}}if(!a.SUMMARY.FACTION_KEYWORD&&a.SUMMARY.DISPLAY_FACTION){const m=a.SUMMARY.DISPLAY_FACTION.split(" - ");m.length>=2?a.SUMMARY.FACTION_KEYWORD=m[1].trim():a.SUMMARY.FACTION_KEYWORD=a.SUMMARY.DISPLAY_FACTION.replace(/\s*\[.*$/,"").trim()}const s=/^(?:(\d+)x?\s+)?(.+?)\s*\[\s*(\d{1,4})\s*pts?\s*\]\s*(?::\s*(.*))?$/i,o=/^\s*(?:•|\-|\+)\s*(.*)$/;let l=null,u=null;for(let m=0;m<t.length;m++){const y=String(t[m]||""),p=y.trim();if(!p||m===r)continue;if(p.startsWith("#")){const v=p.match(/^#+\s*(.+?)\s*(?:\[\s*\d+\s*pts?\s*\])?$/i);if(v){const k=v[1].trim();/character|epic|hero|hq/i.test(k)?l="CHARACTER":l="OTHER DATASHEETS"}continue}const h=p.match(s);if(h){const v=h[1]?`${h[1]}x`:"1x",k=(h[2]||"").trim(),T=parseInt(h[3],10)||0,A=h[4]||"",P={quantity:v,name:k,points:T,items:[],isComplex:!1,nameshort:""};l||(l="OTHER DATASHEETS"),a[l]=a[l]||[],a[l].push(P),u=P,A&&A.split(",").map(E=>E.trim()).filter(Boolean).forEach(E=>{d(u,E,u.name,a.SUMMARY.FACTION_KEYWORD||"",u.name,!0)});continue}const f=y.match(o);if(f&&u){const v=f[1].trim(),k=v.match(/^(\d+)\s+with\s+(.*)$/i);if(k&&u){const P=parseInt(k[1],10)||1,E=k[2],S=u.items&&u.items.length>0?u.items[u.items.length-1]:u;E.split(",").map(R=>R.trim()).filter(Boolean).forEach(R=>d(S,`${P}x ${R}`,S.name,a.SUMMARY.FACTION_KEYWORD||"",u.name,!0));continue}const T=v.match(/^(\d+x?)\s+([^:]+):\s*(.*)$/i);if(T){const P=T[1];let E=T[2].trim();const S=T[3]||"";E=E.replace(/\s+w\/.*$/i,"").trim();const R={quantity:P,name:E,items:[],type:"subunit"};if(S){const L=S.match(/^(\d+)\s+with\s+(.*)$/i);if(L){const q=parseInt(L[1],10)||1;L[2].split(",").map(U=>U.trim()).filter(Boolean).forEach(U=>d(R,`${q}x ${U}`,R.name,a.SUMMARY.FACTION_KEYWORD||"",u.name,!0))}else S.split(",").map(q=>q.trim()).filter(Boolean).forEach(q=>d(R,q,R.name,a.SUMMARY.FACTION_KEYWORD||"",u.name,!0))}u.items=u.items||[],u.items.push(R);continue}const A=v.match(/^(\d+x?)\s+(.*)$/i);if(A&&u){let P=A[2].trim();P=P.replace(/\s+w\/.*$/i,"").trim();const E={quantity:A[1],name:P,items:[],type:"subunit"};u.items=u.items||[],u.items.push(E);continue}d(u,v,u.name,a.SUMMARY.FACTION_KEYWORD||"",u.name,!0);continue}}function d(m,y,p,h,f="",v=!1,k="wargear"){if(!m)return;m.items=m.items||[];const T=String(y||"").trim(),A=ls(T),P=A.quantity?String(A.quantity):"1x",E=/^\s*\d+x?\s+/i.test(T);let S=A.name||"";const R=S.match(/^(.*?)\s*\(([^)]+)\)$/);if(R){const W=(R[1]||"").trim(),ae=(R[2]||"").trim();(/\bDrone\b/i.test(W)||/\bDrone\b/i.test(S))&&(S=ae)}const L=be(S);if(v){const W=String(p||""),ae=String(f||"");if(be(W)===be(S)||ae&&be(ae)===be(S))return}const q=parseInt(String(P||"1x").replace(/x/i,""),10)||1;let F=q;if(m&&m.type==="subunit"){const W=parseInt(String(m.quantity||"1x").replace(/[^0-9]/g,""),10)||1;F=E?q:W}const U=m.items.find(W=>be(W.name||"")===L);if(U){const W=parseInt(String(U.quantity||"1x").replace(/x/i,""),10)||0;U.quantity=`${W+F}x`}else{const W=be(S)==="warlord"?"special":k;m.items.push({quantity:`${F}x`,name:S,items:[],type:W,nameshort:""})}}for(const m of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(a[m]))for(const y of a[m]){if(!y||!Array.isArray(y.items)||y.items.length===0)continue;if(y.items.filter(f=>f&&f.type==="subunit").length>1){const f=new Map,v=[];for(const k of y.items){if(!k||k.type!=="subunit"){v.push(k);continue}const T=be(k.name||"");if(!f.has(T))f.set(T,{quantity:k.quantity||"1x",name:k.name,items:Array.isArray(k.items)?k.items.slice():[],type:"subunit"});else{const A=f.get(T),P=parseInt(String(A.quantity||"1x").replace(/[^0-9]/g,""),10)||0,E=parseInt(String(k.quantity||"1x").replace(/[^0-9]/g,""),10)||0;A.quantity=`${P+E}x`;const S=new Map;for(const R of A.items||[]){const L=be(R&&R.name||"");L&&S.set(L,{quantity:R.quantity||"1x",name:R.name,items:[],type:R.type||"wargear",nameshort:R.nameshort||""})}for(const R of k.items||[]){const L=be(R&&R.name||"");if(L)if(S.has(L)){const q=S.get(L),F=parseInt(String(q.quantity||"1x").replace(/[^0-9]/g,""),10)||0,U=parseInt(String(R.quantity||"1x").replace(/[^0-9]/g,""),10)||0;q.quantity=`${F+U}x`}else S.set(L,{quantity:R.quantity||"1x",name:R.name,items:[],type:R.type||"wargear",nameshort:R.nameshort||""})}A.items=Array.from(S.values())}}y.items=[...v,...Array.from(f.values())]}y&&Array.isArray(y.items)&&y.items.length>0&&En(y.items);const h=y&&Array.isArray(y.items)?y.items.filter(f=>f&&f.type==="subunit"):[];for(const f of h)f&&Array.isArray(f.items)&&f.items.length>0&&En(f.items)}return Es(a),a}function Qd(t,a=40){return(Array.isArray(t)?t:String(t||"").split(/\r?\n/)).slice(0,a)}function eh(t){const a=Array.isArray(t)?t:String(t||"").split(/\r?\n/),n=Qd(a,40),r=a.join(`
`),s={NRNR:{score:0,breakdown:{},maxScore:8},"WTC-Compact":{score:0,breakdown:{},maxScore:8},WTC:{score:0,breakdown:{},maxScore:8},GWAPP:{score:0,breakdown:{},maxScore:7},"NR-GW":{score:0,breakdown:{},maxScore:7},LF:{score:0,breakdown:{},maxScore:7}},o=n.some(se=>/-\s*\[\s*\d{2,5}\s*pts?\s*\]$/i.test(se)),l=n.some(se=>/^#{1,3}\s+/.test(se)),u=n.some(se=>/^\s*#?\s*\+\+\s*Army Roster\s*\+\+/i.test(se)),d=n.some(se=>/^\s*##\s+/.test(se)),m=/(.+?)\s*[\(\[]\s*([0-9]{1,4})\s*(?:pts|points)\s*[\)\]]/i,y=r.match(new RegExp(m.source,"g"))||[],p=r.match(/^[ \t]*(?:•|\-|\+)\s*(?:\d+x?)\s+[^:]+:/gmi)||[],h=r.match(/\b[A-Za-z0-9\-\'’ ]+\s*\([^\)]+\)/g)||[],f=/(^|\n)\s*Char\d+:.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)\s*:\s*/i,v=(r.match(new RegExp(f.source,"gi"))||[]).length,k=n.some(se=>/^(List Name|Factions Used|Army Points|Detachment Rule):/i.test(se.trim())),T=n.some(se=>/-\s*\(\s*\d+\s*Points?\s*\)\s*$/i.test(se)),A=r.match(/^(Epic Hero|Epic Heroes|Character|Characters|Battleline|Infantry|Beast|Vehicle|Dedicated Transport|Other Datasheets):\s*$/gmi)||[],P=(r.match(/^\s*•\s*(?:E:|Enhancement:)/gmi)||[]).length,E=(r.match(/^\s*•\s+/gmi)||[]).length;k&&(s.LF.score+=4,s.LF.breakdown.headerKeys=4),T&&(s.LF.score+=4,s.LF.breakdown.titleLine=4),A.length>=2&&(s.LF.score+=3,s.LF.breakdown.sectionColons=A.length),E>5&&(s.LF.score+=1,s.LF.breakdown.bullets=E),P>0&&(s.LF.score+=1,s.LF.breakdown.enhancementLines=P),(k||T||A.length>=2)&&(s.NRNR.score-=1,s.WTC.score-=1,s["WTC-Compact"].score-=1,s.GWAPP.score-=1,s["NR-GW"].score-=3),o&&(s.NRNR.score+=2,s.NRNR.breakdown.titleWithBracketedPts=2),l&&(s.NRNR.score+=3,s.NRNR.breakdown.markdownHeading=3),u&&(s.NRNR.score+=2,s.NRNR.breakdown.armyRoster=2),d&&(s.NRNR.score+=1,s.NRNR.breakdown.doubleHashSections=1),y.length>=3&&(s.NRNR.score+=1,s.NRNR.breakdown.unitLines=1),p.length>0&&(s.NRNR.score+=1,s.NRNR.breakdown.bulletWithQty=p.length),h.length>0&&(s.NRNR.score+=.5,s.NRNR.breakdown.parenItem=h.length);const S=n.join(`
`);/^[ \t]*[+&]/m.test(S)&&(s["WTC-Compact"].score+=3,s["WTC-Compact"].breakdown.headerPlusAmp=3),/(FACTION KEYWORD|DETACHMENT|TOTAL ARMY POINTS)/i.test(S)&&(s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.headerKeys=2),y.length>=2&&(s["WTC-Compact"].score+=1,s["WTC-Compact"].breakdown.unitLines=1),v>0&&(s["WTC-Compact"].score+=5,s["WTC-Compact"].breakdown.inlineCharList=v),/^\s*[+&]/m.test(S)&&(s.WTC.score+=1,s.WTC.breakdown.headerPlusAmp=1),/NUMBER OF UNITS:/i.test(S)&&(s.WTC.score+=2,s.WTC.breakdown.numberOfUnits=2);const R=(r.match(/(^|\n)\s*Char\d+:/gi)||[]).length>0;R&&(s.WTC.score+=3,s.WTC.breakdown.charMarkers=3),(l||u||d)&&(s.WTC.score-=2,s.WTC.breakdown.nrnrPenalty=-2,s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.nrnrPenalty=-1);const L=(r.match(/^\s*\d+\s+with\s+/gmi)||[]).length;L>0&&(s.WTC.score+=2,s.WTC.breakdown.withLines=L,s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.withLines=L),n.some(se=>/^(?:CHARACTER|OTHER DATASHEETS|CHARACTERS)\s*$/.test((se||"").trim()))&&(s.WTC.score+=1,s.WTC.breakdown.sectionHeaders=1),R&&(s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.charMarkerPenalty=-1),v>0&&(s.WTC.score-=2,s.WTC.breakdown.compactInlinePenalty=-2);const q=/Exported with/i.test(r);(/Exported with/i.test(S)||q)&&(s.GWAPP.score+=6,s.GWAPP.breakdown.exportedWith=6),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS)\b/i.test(r)&&(s.GWAPP.score+=2,s.GWAPP.breakdown.sectionHeaders=2),/\(\s*\d+\s*(?:pts|points)\s*\)/i.test(S)&&(s.GWAPP.score+=1,s.GWAPP.breakdown.titleParenPts=1),q&&(s["NR-GW"].score-=4,s["NR-GW"].breakdown.gwappPenalty=-4),/^\s*Strike Force\s*\(\s*\d{2,5}\s*points\s*\)/mi.test(r)&&(s.GWAPP.score+=3,s.GWAPP.breakdown.strikeForce=3),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|DEDICATED TRANSPORTS)\b/i.test(r)&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.sectionHeaders=2);const F=(r.match(/^[ \t]*(?:•|\u2022|◦|\-|\+)\s+/gmi)||[]).length;F>0&&!q&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.bulletCount=F),h.length>0&&!q&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.parenItem=h.length);const U=(r.match(/^[ \t]*(?:•|\u2022|◦|\-|\+)\s*\d+x?\s+[A-Za-z0-9\-\'’]+/gmi)||[]).length;U>=3&&!R&&!q&&(s["NR-GW"].score+=3,s["NR-GW"].breakdown.bulletQty=U);const W=/^(?:\s*)\d+x?\s+.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)/i,ae=a.filter(se=>W.test(se)).length;if(ae>=2&&!R&&!q&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.unitLinesNoChar=ae),!R&&!q&&(U>=3||ae>=2)&&(s.WTC.score-=2,s.WTC.breakdown.nrGwPenalty=-2,s["WTC-Compact"].score-=2,s["WTC-Compact"].breakdown.nrGwPenalty=-2),(l||u)&&(s["NR-GW"].score-=1,s["NR-GW"].breakdown.nrnrPenalty2=-1),r.indexOf("’")!==-1)for(const se of Object.keys(s))s[se].score+=.5,s[se].breakdown=s[se].breakdown||{},s[se].breakdown.unicodeApostrophe=.5;const re={};for(const se of Object.keys(s)){const We=s[se],xe=Math.max(0,Math.min(1,We.score/(We.maxScore||8)));re[se]={score:We.score,confidence:xe,scoreBreakdown:We.breakdown}}const Re=Object.keys(re).sort((se,We)=>re[We].score-re[se].score)[0],fe=re[Re]||{score:0,confidence:0};return{format:Re,confidence:fe.confidence,score:fe.score,scoreBreakdown:fe.scoreBreakdown,all:re}}function xl(t){const a=String(t||"").trim().match(/^(\d+)\s+(.*)$/);return a&&!/^\d+x\b/i.test(String(t||""))?`${a[1]}x ${a[2]}`:t}function _l(t){const a=String(t||"").trim().replace(/^E:\s*/i,"").replace(/^Enhancement:\s*/i,"").trim(),n=a.match(/\(([^)]*pts?[^)]*)\)\s*$/i),r=a.replace(/\s*\([^)]*\)\s*$/,"").trim(),o=`E: ${r.split(/\s+/).map(l=>l[0]?l[0].toUpperCase():"").join("")}${n?` (${n[1].trim()})`:""}`.trim();return{quantity:"1x",name:`Enhancement: ${r}`,nameshort:o,items:[],type:"special"}}function th(t,a){if(!t)return;t.items=t.items||[];const n=xl(String(a||"").trim());if(/^(E:|Enhancement:)/i.test(n)){const s=_l(n),o=be(s.name.replace(/^Enhancement:\s*/i,""));(t.items||[]).some(u=>/^Enhancement:/i.test(u.name||"")&&be(String(u.name).replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,""))===o)||t.items.push(s);return}const r=n.split(",").map(s=>s.trim()).filter(Boolean);for(const s of r){const o=ls(s.replace(/^with\s+/i,"")),l=o.quantity||"1x",u=o.name||"";if(!u)continue;const d=be(u),m=t.items.find(y=>be(y.name||"")===d);if(m){const y=parseInt(String(m.quantity||"1x").replace(/[^0-9]/g,""),10)||0,p=parseInt(String(l).replace(/[^0-9]/g,""),10)||0;m.quantity=`${y+p}x`}else t.items.push({quantity:l,name:u,items:[],type:"wargear",nameshort:""})}}function ah(t,a){const n=t[a]||"",r=is(n);for(let s=a+1;s<t.length;s++){const o=t[s]||"";if(!o.trim())continue;const l=is(o),u=/^\s*•\s*/.test(o);return l>r&&u}return!1}function nh(t){const a={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return a;const n=t.slice(0,30).map(h=>String(h||""));let r=!1;for(const h of n){const f=h.match(/^\s*([A-Za-z ][A-Za-z ]*):\s*(.*)$/);if(!f)continue;const v=f[1].trim().toLowerCase(),k=f[2].trim();if(v==="list name"&&(a.SUMMARY.LIST_TITLE=k,r=!0),v==="factions used"&&(a.SUMMARY.FACTION_KEYWORD=k,r=!0),v==="army points"){const T=parseInt(k.replace(/[^0-9]/g,""),10);T&&(a.SUMMARY.TOTAL_ARMY_POINTS=`${T}pts`,r=!0)}v==="detachment rule"&&(a.SUMMARY.DETACHMENT=k,r=!0)}if(!r){const h=t.find(f=>String(f||"").trim());if(h){const f=String(h).match(/^(.*?)\s*-\s*(.*?)\s*-\s*(.*?)\s*\((\d+)\s*Points?\)/i);f&&(a.SUMMARY.LIST_TITLE=f[1].trim(),a.SUMMARY.FACTION_KEYWORD=f[2].trim(),a.SUMMARY.DETACHMENT=f[3].trim(),a.SUMMARY.TOTAL_ARMY_POINTS=`${parseInt(f[4],10)}pts`)}}const s=/^\s*([A-Za-z ]+):\s*$/,o=/^\s*(.*?)\s*\((\d+)\s*pts?\)\s*$/i,l=/^\s*•\s*(.*)$/;let u=null;const d=[];for(let h=0;h<t.length;h++){const f=String(t[h]||"");if(!f.trim())continue;const k=f.match(s);if(k){const L=k[1].trim().toLowerCase();u=/hero|character/.test(L)?"CHARACTER":"OTHER DATASHEETS",d.length=0;continue}const T=f.match(o);if(T&&is(f)===0){const L=T[1].trim(),q=parseInt(T[2],10)||0,F={quantity:"1x",name:L,points:q,items:[],isComplex:!1,nameshort:""},U=u==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";a[U]=a[U]||[],a[U].push(F),d.length=0,d.push({indent:0,node:F});continue}const A=f.match(l);if(!A)continue;const P=A[1].trim(),E=is(f);for(;d.length>0&&E<=d[d.length-1].indent;)d.pop();const S=d.length>0?d[d.length-1].node:null;if(!S||/^B:\s*/i.test(P))continue;if(/^(E:|Enhancement:)/i.test(P)){const L=_l(P),q=d[0]?d[0].node:S;q.items=q.items||[],(q.items||[]).some(U=>/^Enhancement:/i.test(U.name||"")&&be(U.name)===be(L.name))||q.items.push(L);continue}if(ah(t,h)){const L=ls(xl(P));let q=L.name||"";q=q.replace(/\s+w\/.*$/i,"").trim();const F={quantity:L.quantity||"1x",name:q,items:[],type:"subunit"};S.items=S.items||[],S.items.push(F),d.push({indent:E,node:F});continue}th(S,P)}function m(h){const f=parseInt(String(h||"1x").replace(/[^0-9]/g,""),10);return Number.isFinite(f)&&f>0?f:1}for(const h of["CHARACTER","OTHER DATASHEETS"]){const f=a[h]||[];for(const v of f){const k=Array.isArray(v.items)?v.items:[],T=k.filter(S=>S&&S.type==="subunit");if(T.length<=1)continue;const A=new Map;for(const S of T){const R=be((S.name||"").replace(/\s+w\/.*/i,"").trim());A.has(R)||A.set(R,{name:S.name,qty:0,wargear:new Map});const L=A.get(R);L.qty+=m(S.quantity);const q=Array.isArray(S.items)?S.items:[];for(const F of q){const U=be(F.name||""),W=L.wargear.get(U)||{name:F.name,qty:0,type:F.type||"wargear"};W.qty+=m(F.quantity),L.wargear.has(U),L.wargear.set(U,W)}}const P=k.filter(S=>!(S&&S.type==="subunit")),E=[];for(const[,S]of A){const R={quantity:`${S.qty}x`,name:S.name,items:[],type:"subunit"};for(const[,L]of S.wargear)R.items.push({quantity:`${L.qty}x`,name:L.name,items:[],type:L.type||"wargear",nameshort:""});E.push(R)}v.items=[...P,...E]}}const y=a.SUMMARY&&a.SUMMARY.FACTION_KEYWORD?String(a.SUMMARY.FACTION_KEYWORD).trim():"";function p(h){if(!h||!y)return h;const f=new RegExp("^"+y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\s+","i");return String(h).replace(f,"").trim()}if(y)for(const h of["CHARACTER","OTHER DATASHEETS"]){const f=a[h]||[];for(const v of f){v.name=p(v.name);const k=(v.items||[]).filter(T=>T&&T.type==="subunit");for(const T of k)T.name=p(T.name)}}for(const h of["CHARACTER","OTHER DATASHEETS"]){const f=a[h]||[];for(const v of f){Array.isArray(v.items)&&v.items.length>0&&En(v.items);const k=(v.items||[]).filter(T=>T&&T.type==="subunit");for(const T of k)Array.isArray(T.items)&&T.items.length>0&&En(T.items)}}return Es(a),a}function sh(t){try{const a=eh(t).format;return a==="NRNR"?"NRNR":a==="WTC-Compact"?"WTC_COMPACT":a==="WTC"?"WTC":a==="GWAPP"?"GW_APP":a==="NR-GW"?"NR_GW":a==="LF"?"LF":"UNKNOWN"}catch{const n=Array.isArray(t)?t.slice(0,25):[],r=n.some(o=>/^\s*\+\s*FACTION KEYWORD:/i.test(o)||/^\s*\+\s*DETACHMENT:/i.test(o)),s=n.some(o=>/^(?:CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i.test((o||"").trim().toUpperCase()));return r&&s?"NR_GW":n.some(o=>/^\s*\+\s*FACTION KEYWORD:/i.test(o))?"WTC_COMPACT":s?"GW_APP":"UNKNOWN"}}async function rh(t){if(!t||typeof t!="string")throw new Error("Invalid army list text");const a=t.split(`
`),n=sh(a);if(n==="UNKNOWN")throw new Error("Unable to detect army list format. Supported formats: GW App, WTC, WTC Compact, NR-GW, NR-NR, ListForge");let r;try{switch(n){case"GW_APP":r=jd(a);break;case"WTC":r=Vd(a);break;case"WTC_COMPACT":r=zd(a);break;case"NR_GW":r=Jd(a);break;case"NRNR":r=Zd(a);break;case"LF":r=nh(a);break;default:throw new Error(`Unsupported format: ${n}`)}}catch(o){throw console.error("Parse error:",o),new Error(`Failed to parse ${n} format: ${o.message}`)}const s=ih(r);return{format:n,data:s}}function ih(t,a){const n=t.SUMMARY||{},r=[],s=["CHARACTER","CHARACTERS","BATTLELINE","OTHER DATASHEETS","ALLIED UNITS","DEDICATED TRANSPORTS"];for(const o of s)t[o]&&Array.isArray(t[o])&&r.push(...t[o].map(l=>({...l,section:o})));return{FACTION_KEYWORD:n.FACTION_KEYWORD||n.FACTION_KEY||"Unknown",DETACHMENT:n.DETACHMENT||"",TOTAL_ARMY_POINTS:n.TOTAL_ARMY_POINTS||"0pts",LIST_TITLE:n.LIST_TITLE||"",UNITS:r}}function oh(t){if(!t)return 1;const a=String(t).match(/(\d+)/);return a?parseInt(a[1],10):1}const lh={Asurmen:{baseType:"40mm"},Autarch:{baseType:"32mm"},"Autarch wayleaper":{baseType:"32mm"},"Avatar of Khaine":{baseType:"80mm"},Baharroth:{baseType:"40mm"},"Corsair Voidreavers":{baseType:"28.5mm"},"Corsair Voidscarred":{baseType:"28.5mm"},"Crimson Hunter":{baseType:"120x92mm"},"D-cannon Platform":{baseType:"40mm"},"Dark Reapers":{baseType:"28.5mm"},"Death Jester":{baseType:"25mm"},"Dire Avengers":{baseType:"28.5mm"},"Eldrad Ulthran":{baseType:"32mm"},Falcon:{baseType:"Large Flying Base"},Farseer:{baseType:"25mm"},"Farseer Skyrunner":{baseType:"Small Flying Base"},"Fire Dragons":{baseType:"28.5mm"},"Fire Prism":{baseType:"Large Flying Base"},Fuegan:{baseType:"40mm"},"Guardian Defenders":{baseType:"28.5mm"},"Guardian Defenders: Heavy Weapon Platform":{baseType:"40mm"},"Hemlock Wraithfighter":{baseType:"120x92mm"},"Howling Banshees":{baseType:"28.5mm"},"Jain Zar":{baseType:"40mm"},Lhykhis:{baseType:"40mm"},"Maugan Ra":{baseType:"40mm"},"Night Spinner":{baseType:"Large Flying Base"},Rangers:{baseType:"28.5mm"},"Shadow Weaver Platform":{baseType:"40mm"},Shadowseer:{baseType:"25mm"},"Shining Spears":{baseType:"Large Flying Base"},"Shroud Runners":{baseType:"Large Flying Base"},Skyweavers:{baseType:"Large Flying Base"},Solitaire:{baseType:"25mm"},Spiritseer:{baseType:"25mm"},Starweaver:{baseType:"Large Flying Base"},"Storm Guardians":{baseType:"28.5mm"},"Storm Guardians: Serpent’s Scale Platform":{baseType:"40mm"},"Striking Scorpions":{baseType:"28.5mm"},"Swooping Hawks":{baseType:"28.5mm"},"The Visarch":{baseType:"32mm"}},ch={"Corvus Blackstar":{baseType:"120x92mm"},"Deathwatch Terminator Squad":{baseType:"40mm"},"Deathwatch Veterans":{baseType:"32mm"},"Fortis Kill Team":{baseType:"32mm"},"Indomitor Kill Team":{baseType:"40mm"},"Spectrus Kill Team":{baseType:"32mm"},"Spectrus Kill Team: Kill Team Infiltrators with bolt sniper rifles":{baseType:"40mm"},"Talonstrike Kill Team":{baseType:"32mm"},"Talonstrike Kill Team: Kill Team Heavy Intercessors with Jump Packs":{baseType:"40mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},uh={Archon:{baseType:"25mm"},Beastmaster:{baseType:"Small Flying Base"},"Beastmaster: Clawed Fiends, Khymerae, Razorwing Flocks":{baseType:"40mm"},"Court of the Archon: Sslyth":{baseType:"40mm"},"Court of the Archon: Ur-Ghul, Lhamaean, Medusae":{baseType:"25mm"},Cronos:{baseType:"Large Flying Base"},Drazhar:{baseType:"40mm"},Grotesques:{baseType:"40mm"},Haemonculus:{baseType:"25mm"},Hellions:{baseType:"Small Flying Base"},Incubi:{baseType:"28.5mm"},"Kabalite Warriors":{baseType:"25mm"},"Lelith Hesperax":{baseType:"32mm"},Mandrakes:{baseType:"28.5mm"},Raider:{baseType:"Large Flying Base"},Ravager:{baseType:"Large Flying Base"},"Razorwing Jetfighter":{baseType:"120x92mm"},Reavers:{baseType:"Small Flying Base"},Scourges:{baseType:"32mm"},Succubus:{baseType:"25mm"},Talos:{baseType:"Large Flying Base"},"Urien Rakarth":{baseType:"25mm"},Venom:{baseType:"Large Flying Base"},"Voidraven Bomber":{baseType:"120x92mm"},Wracks:{baseType:"25mm"},Wyches:{baseType:"25mm"}},dh={"Annihilation Barge":{baseType:"Large Flying Base"},"C’tan Shard of the Deceiver":{baseType:"40mm"},"C’tan Shard of the Nightbringer":{baseType:"40mm"},"C’tan Shard of the Void Dragon":{baseType:"80mm"},"Canoptek Doomstalker":{baseType:"90mm"},"Canoptek Reanimator":{baseType:"60mm"},"Canoptek Scarab Swarms":{baseType:"40mm"},"Canoptek Spyders":{baseType:"60mm"},"Canoptek Wraiths":{baseType:"50mm"},"Catacomb Command Barge":{baseType:"Large Flying Base"},Chronomancer:{baseType:"40mm"},"Convergence of Dominion":{baseType:"hull",hullDimensions:{width:0,height:0}},Cryptothralls:{baseType:"32mm"},Deathmarks:{baseType:"32mm"},"Doom Scythe":{baseType:"120x92mm"},"Doomsday Ark":{baseType:"Large Flying Base"},"Flayed Ones":{baseType:"28.5mm"},"Ghost Ark":{baseType:"Large Flying Base"},"Hexmark Destroyer":{baseType:"50mm"},"Illuminor Szeras":{baseType:"80mm"},Immortals:{baseType:"32mm"},"Imotekh the Stormlord":{baseType:"40mm"},"Lokhust Destroyers":{baseType:"Large Flying Base"},"Lokhust Heavy Destroyers":{baseType:"60mm"},"Lokhust Lord":{baseType:"Large Flying Base"},Lychguard:{baseType:"32mm"},Monolith:{baseType:"160mm"},"Necron Warriors":{baseType:"32mm"},"Night Scythe":{baseType:"120x92mm"},Obelisk:{baseType:"120x92mm"},"Ophydian Destroyers":{baseType:"50mm"},"Orikan the Diviner":{baseType:"40mm"},Overlord:{baseType:"40mm"},"Overlord with Translocation Shroud":{baseType:"40mm"},Plasmancer:{baseType:"32mm"},Psychomancer:{baseType:"40mm"},"Royal Warden":{baseType:"32mm"},"Skorpekh Destroyers":{baseType:"50mm"},"Skorpekh Lord":{baseType:"60mm"},Technomancer:{baseType:"50mm"},"Tesseract Vault":{baseType:"120x92mm"},"The Silent King: Szarekh":{baseType:"100mm"},"The Silent King: Triarchal Menhir":{baseType:"50mm"},"Tomb Blades":{baseType:"Small Flying Base"},"Transcendent C’tan":{baseType:"60mm"},"Trazyn the Infinite":{baseType:"40mm"},"Triarch Praetorians":{baseType:"32mm"},"Triarch Stalker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Seraptek Heavy Construct":{baseType:"hull",hullDimensions:{width:0,height:0}}},hh={Battlewagon:{baseType:"hull",hullDimensions:{width:0,height:0}},"Beast Snagga Boyz":{baseType:"32mm"},Beastboss:{baseType:"50mm"},"Beastboss on Squigosaur":{baseType:"80mm"},"Big Mek":{baseType:"50mm"},"Big Mek in Mega Armour":{baseType:"40mm"},"Big Mek with Shokk Attack Gun":{baseType:"40mm"},"Big’ed Bossbunka":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blitza-bommer":{baseType:"120x92mm"},"Boomdakka Snazzwagon":{baseType:"150x95mm"},"Boss Snikrot":{baseType:"40mm"},Boyz:{baseType:"32mm"},"Breaka Boyz":{baseType:"32mm"},"Breaka Boyz: Boss Nob":{baseType:"40mm"},"Burna Boyz":{baseType:"32mm"},"Burna-bommer":{baseType:"120x92mm"},Dakkajet:{baseType:"120x92mm"},"Deff Dread":{baseType:"60mm"},"Deffkilla Wartrike":{baseType:"150x95mm"},Deffkoptas:{baseType:"75x42mm"},"Flash Gitz":{baseType:"40mm"},"Ghazghkull Thraka":{baseType:"80mm"},"Ghazghkull Thraka: Makari":{baseType:"25mm"},Gorkanaut:{baseType:"170x109mm"},Gretchin:{baseType:"25mm"},"Gretchin: Runtherd":{baseType:"32mm"},"Hunta Rig":{baseType:"170x109mm"},"Kill Rig":{baseType:"170x109mm"},"Killa Kans":{baseType:"60mm"},Kommandos:{baseType:"32mm"},"Kustom Boosta-blasta":{baseType:"150x95mm"},Lootas:{baseType:"32mm"},Meganobz:{baseType:"40mm"},"Megatrakk Scrapjet":{baseType:"150x95mm"},Mek:{baseType:"32mm"},"Mek Gunz":{baseType:"hull",hullDimensions:{width:0,height:0}},Morkanaut:{baseType:"170x109mm"},"Mozrog Skragbad":{baseType:"80mm"},Nobz:{baseType:"32mm"},Painboss:{baseType:"40mm"},Painboy:{baseType:"32mm"},"Rukkatrukk Squigbuggy":{baseType:"150x95mm"},"Shokkjump Dragsta":{baseType:"150x95mm"},"Squighog Boyz":{baseType:"75x42mm"},"Squighog Boyz: Nob on Smasha Squig":{baseType:"90x52.5mm"},Stompa:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormboyz:{baseType:"32mm"},Tankbustas:{baseType:"32mm"},"Tankbustas: Boss Nob":{baseType:"40mm"},Trukk:{baseType:"hull",hullDimensions:{width:0,height:0}},Warbikers:{baseType:"75x42mm"},Warboss:{baseType:"40mm"},"Warboss in Mega Armour":{baseType:"50mm"},"Wazbom Blastajet":{baseType:"150x95mm"},Weirdboy:{baseType:"40mm"},Wurrboy:{baseType:"32mm"},"Zodgrod Wortsnagga":{baseType:"50mm"},"Gargantuan Squiggoth":{baseType:"hull",hullDimensions:{width:0,height:0}}},mh={Barbgaunts:{baseType:"40mm"},Biovores:{baseType:"80mm"},Broodlord:{baseType:"75x42mm"},Carnifexes:{baseType:"105x70mm"},Deathleaper:{baseType:"60mm"},Exocrine:{baseType:"120x92mm"},Gargoyles:{baseType:"Small Flying Base"},Genestealers:{baseType:"32mm"},Harpy:{baseType:"120x92mm"},Haruspex:{baseType:"120x92mm"},"Hive Crone":{baseType:"120x92mm"},"Hive Guard":{baseType:"50mm"},"Hive Tyrant":{baseType:"50mm"},Hormagaunts:{baseType:"28.5mm"},Lictor:{baseType:"50mm"},Maleceptor:{baseType:"120x92mm"},Mawloc:{baseType:"120x92mm"},"Mucolid Spores":{baseType:"40mm"},Neurogaunts:{baseType:"25mm"},"Neurogaunts: Nodebeasts":{baseType:"28.5mm"},Neurolictor:{baseType:"50mm"},Neurotyrant:{baseType:"50mm"},"Norn Assimilator":{baseType:"100mm"},"Norn Emissary":{baseType:"100mm"},"Old One Eye":{baseType:"105x70mm"},"Parasite of Mortrex":{baseType:"40mm"},Psychophage:{baseType:"120x92mm"},Pyrovores:{baseType:"80mm"},Raveners:{baseType:"40mm"},"Ripper Swarms":{baseType:"40mm"},"Screamer-killer":{baseType:"90mm"},"Spore MInes":{baseType:"25mm"},Sporocyst:{baseType:"hull",hullDimensions:{width:0,height:0}},Termagants:{baseType:"28.5mm"},Tervigon:{baseType:"120x92mm"},"The Swarmlord":{baseType:"60mm"},Toxicrene:{baseType:"120x92mm"},Trygon:{baseType:"120x92mm"},"Tyranid Warriors with Melee Bio-weapons":{baseType:"50mm"},"Tyranid Warriors with Ranged Bio-weapons":{baseType:"50mm"},Tyrannocyte:{baseType:"100mm"},Tyrannofex:{baseType:"120x92mm"},"Tyrant Guard":{baseType:"50mm"},Venomthropes:{baseType:"40mm"},"Von Ryan’s Leapers":{baseType:"40mm"},"Winged Hive Tyrant":{baseType:"60mm"},"Winged Tyranid Prime":{baseType:"50mm"},Zoanthropes:{baseType:"40mm"},Harridan:{baseType:"hull",hullDimensions:{width:4,height:6}},Hierophant:{baseType:"hull",hullDimensions:{width:0,height:0}}},Di={"ADEPTA SORORITAS":{"Aestred Thurga and Agathae Dolan: Aestred Thurga":{baseType:"32mm"},"Aestred Thurga and Agathae Dolan: Agathae Dolan":{baseType:"25mm"},"Arco-flagellants":{baseType:"25mm"},"Battle Sisters Squad":{baseType:"32mm"},Canoness:{baseType:"32mm"},"Canoness with Jump Pack":{baseType:"32mm"},Castigator:{baseType:"hull",hullDimensions:{width:6,height:8}},"Celestian Sacresants":{baseType:"32mm"},Daemonifuge:{baseType:"32mm"},Dialogus:{baseType:"40mm"},Dogmata:{baseType:"32mm"},"Dominion Squad":{baseType:"32mm"},Exorcist:{baseType:"hull",hullDimensions:{width:3.5,height:6}},Hospitaller:{baseType:"50mm"},Imagifier:{baseType:"32mm"},Immolator:{baseType:"hull",hullDimensions:{width:4,height:6}},"Junith Eruita":{baseType:"50mm"},"Ministorum Priest":{baseType:"32mm"},Mortifiers:{baseType:"50mm"},"Morvenn Vahl":{baseType:"60mm"},Palatine:{baseType:"32mm"},"Paragon Warsuits":{baseType:"50mm"},"Penitent Engines":{baseType:"50mm"},"Repentia Squad: Repentia Superior":{baseType:"32mm"},"Repentia Squad: Sister Repentia":{baseType:"28.5mm"},"Retributor Squad":{baseType:"32mm"},"Saint Celestine":{baseType:"40mm"},"Saint Celestine: Geminae Superia":{baseType:"32mm"},Sanctifiers:{baseType:"25mm"},"Seraphim Squad":{baseType:"32mm"},"Sisters Novitiate Squad: Novitiate Superior":{baseType:"32mm"},"Sisters Novitiate Squad: Sister Novitiate":{baseType:"28.5mm"},"Sororitas Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Triumph of Saint Katherine":{baseType:"120x92mm"},"Zephyrim Squad":{baseType:"32mm"}},"ADEPTUS CUSTODES":{Aleya:{baseType:"32mm"},"Allarus Custodians":{baseType:"40mm"},"Anathema Psykana Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blade Champion":{baseType:"40mm"},"Custodian Guard":{baseType:"40mm"},"Custodian Wardens":{baseType:"40mm"},"Knight-Centura":{baseType:"32mm"},Prosecutors:{baseType:"32mm"},"Shield-Captain":{baseType:"40mm"},"Shield-Captain in Allarus Terminator Armour":{baseType:"40mm"},"Shield-Captain on Dawneagle Jetbike":{baseType:"75x42mm"},"Trajann Valoris":{baseType:"40mm"},Valerian:{baseType:"40mm"},"Venerable Contemptor Dreadnought":{baseType:"60mm"},"Venerable Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vertus Praetors":{baseType:"75x42mm"},Vigilators:{baseType:"32mm"},Witchseekers:{baseType:"32mm"},"Agamatus Custodians":{baseType:"75x42mm"},"Aquilon Custodians":{baseType:"50mm"},"Ares Gunship":{baseType:"160mm"},"Caladius Grav-tank":{baseType:"170x109mm"},"Contemptor-Achillus Dreadnought":{baseType:"60mm"},"Contemptor-Galatus Dreadnought":{baseType:"60mm"},"Coronus Grav-carrier":{baseType:"170x109mm"},"Custodian Guard with Adrasite and Pyrithite Spears":{baseType:"40mm"},"Orion Assault Dropship":{baseType:"160mm"},"Pallas Grav-attack":{baseType:"105x70mm"},"Sagittarum Custodians":{baseType:"40mm"},"Telemon Heavy Dreadnought":{baseType:"100mm"},"Venatari Custodians":{baseType:"40mm"}},"ADEPTUS MECHANICUS":{"Archaeopter Fusilave":{baseType:"170x109mm"},"Archaeopter Stratoraptor":{baseType:"170x109mm"},"Archaeopter Transvector":{baseType:"170x109mm"},"Belisarius Cawl":{baseType:"105x70mm"},"Corpuscarii Electro-Priests":{baseType:"32mm"},"Cybernetica Datasmith":{baseType:"32mm"},"Fulgurite Electro-Priests":{baseType:"32mm"},"Ironstrider Ballistarii":{baseType:"105x70mm"},"Kastelan Robots":{baseType:"60mm"},"Kataphron Breachers":{baseType:"60mm"},"Kataphron Destroyers":{baseType:"60mm"},"Onager Dunecrawler":{baseType:"130mm"},"Pteraxii Skystalkers":{baseType:"40mm"},"Pteraxii Sterylizors":{baseType:"40mm"},"Serberys Raiders":{baseType:"60x35.5mm"},"Serberys Sulphurhounds":{baseType:"60x35.5mm"},"Sicarian Infiltrators":{baseType:"40mm"},"Sicarian Ruststalkers":{baseType:"40mm"},"Skitarii Marshal":{baseType:"32mm"},"Skitarii Rangers":{baseType:"25mm"},"Skitarii Rangers/Skitarii Vanguard: Transuranic Arquebus":{baseType:"60x35.5mm"},"Skitarii Vanguard":{baseType:"25mm"},"Skorpius Disintegrator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skorpius Dunerider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sydonian Dragoons with Radium Jezzails":{baseType:"105x70mm"},"Sydonian Dragoons with Taser Lances":{baseType:"105x70mm"},"Sydonian Skatros":{baseType:"40mm"},"Tech-Priest Dominus":{baseType:"50mm"},"Tech-Priest Enginseer":{baseType:"32mm"},"Tech-Priest Manipulus":{baseType:"50mm"},Technoarcheologist:{baseType:"32mm"}},"ADEPTUS TITANICUS":{"Reaver Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warbringer Nemesis Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warhound Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warlord Titan":{baseType:"hull",hullDimensions:{width:0,height:0}}},AELDARI:lh,"ASTRA MILITARUM":{"Aegis Defence Line":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armoured Sentinels":{baseType:"80mm"},"Artillery Team":{baseType:"130mm"},"Attilan Rough Riders":{baseType:"60x35.5mm"},Baneblade:{baseType:"hull",hullDimensions:{width:0,height:0}},Banehammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Banesword:{baseType:"hull",hullDimensions:{width:0,height:0}},Basilisk:{baseType:"hull",hullDimensions:{width:0,height:0}},"Bullgryn squad":{baseType:"40mm"},"Cadian Castellan":{baseType:"28.5mm"},"Cadian Command Squad":{baseType:"28.5mm"},"Cadian Heavy Weapons Squad":{baseType:"50mm"},"Cadian Shock Troops":{baseType:"25mm"},"Catachan Command Squad":{baseType:"25mm"},"Catachan Heavy Weapons Squad":{baseType:"60mm"},"Catachan Jungle Fighters":{baseType:"25mm"},Chimera:{baseType:"hull",hullDimensions:{width:0,height:0}},Commissar:{baseType:"28.5mm"},"Death Korps of Krieg":{baseType:"25mm"},"Death Riders":{baseType:"60x35.5mm"},Deathstrike:{baseType:"hull",hullDimensions:{width:0,height:0}},Doomhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},"Field Ordnance Battery":{baseType:"100mm"},"Gaunt’s Ghosts":{baseType:"28.5mm"},Hellhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Hellhound:{baseType:"hull",hullDimensions:{width:0,height:0}},Hydra:{baseType:"hull",hullDimensions:{width:0,height:0}},Kasrkin:{baseType:"28.5mm"},"Krieg Combat Engineers":{baseType:"25mm"},"Krieg Command Squad":{baseType:"25mm"},"Krieg Command Squad: Lord Commissar":{baseType:"32mm"},"Krieg Heavy Weapons Squad":{baseType:"50mm"},"Krieg Heavy Weapons Squad: Fire Coordinator":{baseType:"25mm"},"Leman Russ Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Demolisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Eradicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Executioner":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Exterminator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Punisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Vanquisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Marshal Dreir":{baseType:"75x42mm"},"Lord Solar Leontus":{baseType:"80mm"},Manticore:{baseType:"hull",hullDimensions:{width:0,height:0}},"Militarum Tempestus Command Squad":{baseType:"25mm"},"Ministorum Priest":{baseType:"32mm"},"Nork Deddog":{baseType:"40mm"},"Ogryn Bodyguard":{baseType:"40mm"},"Ogryn squad":{baseType:"40mm"},"Primaris Psyker":{baseType:"32mm"},Ratlings:{baseType:"25mm"},"Rogal Dorn Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Rogal Dorn Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Scout Sentinels":{baseType:"80mm"},Shadowsword:{baseType:"hull",hullDimensions:{width:0,height:0}},"Sly Marbo":{baseType:"32mm"},Stormlord:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormsword:{baseType:"hull",hullDimensions:{width:0,height:0}},Taurox:{baseType:"hull",hullDimensions:{width:0,height:0}},"Taurox Prime":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tech-Priest Enginseer":{baseType:"32mm"},"Tempestus Aquilons":{baseType:"28.5mm"},"Tempestus Scions":{baseType:"25mm"},"Ursula Creed":{baseType:"32mm"},Valkyrie:{baseType:"120x92mm"},Wyvern:{baseType:"hull",hullDimensions:{width:0,height:0}},"Avenger Strike Fighter":{baseType:"120x92mm"},"Cyclops Demolition Vehicle":{baseType:"hull",hullDimensions:{width:0,height:0}}},"BLACK TEMPLARS":{"Black Templars Gladiator Lancer":{baseType:"100mm"},"Black Templars Gladiator Reaper":{baseType:"100mm"},"Black Templars Gladiator Valiant":{baseType:"100mm"},"Black Templars Impulsor":{baseType:"100mm"},"Black Templars Repulsor":{baseType:"100mm"},"Black Templars Repulsor Executioner":{baseType:"100mm"},Castellan:{baseType:"40mm"},"Chaplain Grimaldus":{baseType:"40mm"},"Chaplain Grimaldus: Cenobyte Servitors":{baseType:"28.5mm"},"Crusader Squad: Neophytes":{baseType:"28.5mm"},"Crusader Squad: Sword Brother/Initiates":{baseType:"32mm"},"High Marshal Helbrecht":{baseType:"60mm"},Marshal:{baseType:"40mm"},"Primaris Crusader Squad: Initiates":{baseType:"32mm"},"Primaris Crusader Squad: Neophytes":{baseType:"28.5mm"},"Primaris Crusader Squad: Sword Brother":{baseType:"40mm"},"Primaris Sword Brethren":{baseType:"40mm"},"The Emperor’s Champion":{baseType:"40mm"}},"BLOOD ANGELS":{Astorath:{baseType:"40mm"},"Baal Predator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blood Angels Captain":{baseType:"40mm"},"Chief Librarian Mephiston":{baseType:"40mm"},"Commander Dante":{baseType:"50mm"},"Death Company Captain":{baseType:"40mm"},"Death Company Captain with Jump Pack":{baseType:"40mm"},"Death Company Dreadnought":{baseType:"90mm"},"Death Company Marines":{baseType:"32mm"},"Death Company Marines with Bolt Rifles":{baseType:"32mm"},"Death Company Marines with Jump Packs":{baseType:"32mm"},Lemartes:{baseType:"40mm"},"Sanguinary Guard":{baseType:"40mm"},"Sanguinary Priest":{baseType:"40mm"},"The Sanguinor":{baseType:"40mm"}},"CHAOS DAEMONS":{"Be’lakor":{baseType:"100mm"},"Beasts of Nurgle":{baseType:"60mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodmaster:{baseType:"40mm"},Bloodthirster:{baseType:"120x92mm"},"Blue Horrors":{baseType:"25mm"},"Burning Chariot":{baseType:"120x92mm"},Changecaster:{baseType:"32mm"},"Contorted Epitome":{baseType:"75x42mm"},"Daemon Prince of Chaos":{baseType:"60mm"},"Daemon Prince of Chaos with Wings":{baseType:"60mm"},Daemonettes:{baseType:"25mm"},Epidemius:{baseType:"60mm"},"Exalted Flamer":{baseType:"75x42mm"},Fateskimmer:{baseType:"120x92mm"},"Feculent Gnarlmaw":{baseType:"hull",hullDimensions:{width:0,height:0}},Fiends:{baseType:"75x42mm"},Flamers:{baseType:"32mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Fluxmaster:{baseType:"Large Flying Base"},"Great Unclean One":{baseType:"130mm"},Hellflayers:{baseType:"120x92mm"},"Horticulous Slimux":{baseType:"105x70mm"},"Infernal Enrapturess":{baseType:"60x35.5mm"},"Kairos Fateweaver":{baseType:"100mm"},Karanak:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},Nurglings:{baseType:"40mm"},"Pink Horrors":{baseType:"32mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Poxbringer:{baseType:"32mm"},"Rendmaster on Blood Throne":{baseType:"120x92mm"},Rotigus:{baseType:"130mm"},Screamers:{baseType:"Small Flying Base"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"},Skarbrand:{baseType:"100mm"},"Skull Altar":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skull Cannon":{baseType:"120x92mm"},Skullmaster:{baseType:"90x52.5mm"},Skulltaker:{baseType:"40mm"},"Sloppity Bilepiper":{baseType:"32mm"},"Soul Grinder":{baseType:"160mm"},"Spoilpox Scrivener":{baseType:"40mm"},"Syll’esske":{baseType:"50mm"},"The Blue Scribes":{baseType:"Large Flying Base"},"The Changeling":{baseType:"40mm"},"The Masque of Slaanesh":{baseType:"32mm"},Tormentbringer:{baseType:"120x92mm"},Tranceweaver:{baseType:"32mm"}},"CHAOS KNIGHTS":{"Knight Abominant":{baseType:"170x109mm"},"Knight Desecrator":{baseType:"170x109mm"},"Knight Despoiler":{baseType:"170x109mm"},"Knight Rampager":{baseType:"170x109mm"},"Knight Tyrant":{baseType:"170x109mm"},"War Dog Brigand":{baseType:"100mm"},"War Dog Executioner":{baseType:"100mm"},"War Dog Huntsman":{baseType:"100mm"},"War Dog Karnivore":{baseType:"100mm"},"War Dog Stalker":{baseType:"100mm"},"Chaos Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Cerastus Knight Acheron":{baseType:"170x109mm"},"Chaos Cerastus Knight Atrapos":{baseType:"170x109mm"},"Chaos Cerastus Knight Castigator":{baseType:"170x109mm"},"Chaos Cerastus Knight Lancer":{baseType:"170x109mm"},"Chaos Questoris Knight Magaera":{baseType:"170x109mm"},"Chaos Questoris Knight Styrix":{baseType:"170x109mm"},"War Dog Moirax":{baseType:"100mm"}},"CHAOS SPACE MARINES":{"Abaddon the Despoiler":{baseType:"60mm"},"Accursed Cultists: Mutant":{baseType:"25mm"},"Accursed Cultists: Torment":{baseType:"40mm"},"Chaos Bikers":{baseType:"75x42mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Lord":{baseType:"40mm"},"Chaos Lord in Terminator Armour":{baseType:"40mm"},"Chaos Lord with Jump Pack":{baseType:"40mm"},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminator Squad":{baseType:"40mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},Chosen:{baseType:"32mm"},"Cultist Firebrand":{baseType:"32mm"},"Cultist Mob":{baseType:"25mm"},Cypher:{baseType:"32mm"},"Dark Apostle":{baseType:"40mm"},"Dark Apostle: Dark Disciple":{baseType:"25mm"},"Dark Commune: Blessed Blade":{baseType:"28.5mm"},"Dark Commune: Cult Demagogue, Mindwitch, Iconarch":{baseType:"32mm"},Defiler:{baseType:"160mm"},"Fabius Bile":{baseType:"40mm"},"Fabius Bile: Surgeon Acolyte":{baseType:"32mm"},"Fellgor beastmen":{baseType:"32mm"},Forgefiend:{baseType:"120x92mm"},"Haarken Worldclaimer":{baseType:"40mm"},Havocs:{baseType:"40mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Heretic Astartes Daemon Prince":{baseType:"60mm"},"Heretic Astartes Daemon Prince with Wings":{baseType:"60mm"},"Huron Blackheart":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},Legionaries:{baseType:"32mm"},"Lord Discordant on Helstalker":{baseType:"120x92mm"},"Master of Executions":{baseType:"40mm"},"Master of Possession":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},"Nemesis Claw":{baseType:"32mm"},"Noctilith Crown":{baseType:"hull",hullDimensions:{width:0,height:0}},Obliterators:{baseType:"50mm"},Possessed:{baseType:"40mm"},Raptors:{baseType:"32mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Traitor Enforcer":{baseType:"32mm"},"Traitor Enforcer: Traitor Ogryn":{baseType:"40mm"},"Traitor Guardsmen Squad":{baseType:"25mm"},"Vashtorr the Arkifane":{baseType:"80mm"},Venomcrawler:{baseType:"100mm"},"Warp Talons":{baseType:"32mm"},Warpsmith:{baseType:"60x35.5mm"}},"DARK ANGELS":{Asmodai:{baseType:"50mm"},Azrael:{baseType:"50mm"},Belial:{baseType:"50mm"},"Deathwing Knights":{baseType:"40mm"},"Deathwing Terminator Squad":{baseType:"40mm"},Ezekiel:{baseType:"25mm"},"Inner Circle Companions":{baseType:"40mm"},"Land Speeder Vengeance":{baseType:"Large Flying Base"},Lazarus:{baseType:"40mm"},"Lion El’Jonson":{baseType:"60mm"},"Nephilim Jetfighter":{baseType:"120x92mm"},"Ravenwing Black Knights":{baseType:"75x42mm"},"Ravenwing Command Squad":{baseType:"75x42mm"},"Ravenwing Dark Talon":{baseType:"120x92mm"},"Ravenwing Darkshroud":{baseType:"Large Flying Base"},Sammael:{baseType:"Large Flying Base"}},"DEATH GUARD":{"Biologus Putrifier":{baseType:"40mm"},"Blightlord Terminators":{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Nurgle":{baseType:"60mm"},"Daemon Prince of Nurgle with Wings":{baseType:"60mm"},"Deathshroud Terminators":{baseType:"40mm"},Defiler:{baseType:"160mm"},"Foetid Bloat-Drone":{baseType:"60mm"},"Foetid Bloat-drone with Heavy Blight Launcher":{baseType:"60mm"},"Foul Blightspawn":{baseType:"40mm"},Helbrute:{baseType:"60mm"},"Icon Bearer":{baseType:"32mm"},"Lord of Contagion":{baseType:"50mm"},"Lord of Poxes":{baseType:"40mm"},"Lord of Virulence":{baseType:"50mm"},"Malignant Plaguecaster":{baseType:"32mm"},"Miasmic Malignifier":{baseType:"hull",hullDimensions:{width:0,height:0}},Mortarion:{baseType:"100mm"},"Myphitic Blight-Haulers":{baseType:"80mm"},"Noxious Blightbringer":{baseType:"40mm"},"Plague Marines":{baseType:"32mm"},"Plague Surgeon":{baseType:"40mm"},"Plagueburst Crawler":{baseType:"hull",hullDimensions:{width:0,height:0}},Poxwalkers:{baseType:"25mm"},Tallyman:{baseType:"40mm"},Typhus:{baseType:"50mm"},"Beasts of Nurgle":{baseType:"60mm"},"Great Unclean One":{baseType:"130mm"},Nurglings:{baseType:"40mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Rotigus:{baseType:"130mm"}},DEATHWATCH:ch,DRUKHARI:uh,"EMPEROR’S CHILDREN":{"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminators":{baseType:"40mm"},"Daemon Prince of Slaanesh":{baseType:"60mm"},"Daemon Prince of Slaanesh with Wings":{baseType:"60mm"},"Flawless Blades":{baseType:"40mm"},Fulgrim:{baseType:"130mm"},Heldrake:{baseType:"120x92mm"},Infractors:{baseType:"32mm"},"Lord Exultant":{baseType:"40mm"},"Lord Kakophonist":{baseType:"40mm"},"Lucius the Eternal":{baseType:"50mm"},Maulerfiend:{baseType:"120x92mm"},"Noise Marines":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},Tormentors:{baseType:"32mm"},Daemonettes:{baseType:"25mm"},Fiends:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"}},"GENESTEALER CULTS":{Aberrants:{baseType:"32mm"},Abominant:{baseType:"40mm"},"Achilles Ridgerunners":{baseType:"120x92mm"},"Acolyte Hybrids with Autopistols":{baseType:"32mm"},"Acolyte Hybrids with Hand Flamers":{baseType:"32mm"},"Acolyte Iconward":{baseType:"32mm"},"Atalan Jackals":{baseType:"60x35.5mm"},"Atalan Jackals: Wolfquad":{baseType:"60mm"},Benefictus:{baseType:"32mm"},Biophagus:{baseType:"25mm"},Clamavus:{baseType:"32mm"},"Goliath Rockgrinder":{baseType:"hull",hullDimensions:{width:0,height:0}},"Goliath Truck":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hybrid Metamorphs":{baseType:"32mm"},"Jackal Alphus":{baseType:"60x35.5mm"},Kelermorph:{baseType:"32mm"},Locus:{baseType:"32mm"},Magus:{baseType:"32mm"},"Neophyte Hybrids":{baseType:"25mm"},"Neophyte Hybrids: Heavy stubber, Mining laser, Seismic cannon":{baseType:"32mm"},Nexos:{baseType:"40mm"},Patriarch:{baseType:"50mm"},Primus:{baseType:"32mm"},"Purestrain Genestealers":{baseType:"32mm"},"Reductus Saboteur":{baseType:"32mm"},Sanctus:{baseType:"32mm"}},"GREY KNIGHTS":{"Brother-Captain":{baseType:"40mm"},"Brother-Captain Stern":{baseType:"40mm"},"Brotherhood Champion":{baseType:"32mm"},"Brotherhood Chaplain":{baseType:"40mm"},"Brotherhood Librarian":{baseType:"40mm"},"Brotherhood Techmarine":{baseType:"32mm"},"Brotherhood Terminator Squad":{baseType:"40mm"},"Castellan Crowe":{baseType:"40mm"},"Grand Master":{baseType:"40mm"},"Grand Master in Nemesis Dreadknight":{baseType:"120x92mm"},"Grand Master Voldus":{baseType:"40mm"},"Grey Knights Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Razorback":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Stormhawk Interceptor":{baseType:"120x92mm"},"Grey knights Stormraven Gunship":{baseType:"120x92mm"},"Grey knights Stormtalon Gunship":{baseType:"120x92mm"},"Grey Knights Venerable Dreadnought":{baseType:"60mm"},"Interceptor Squad":{baseType:"32mm"},"Kaldor Draigo":{baseType:"40mm"},"Nemesis Dreadknight":{baseType:"120x92mm"},"Paladin Squad":{baseType:"40mm"},"Purgation Squad":{baseType:"32mm"},"Purifier Squad":{baseType:"32mm"},Servitors:{baseType:"25mm"},"Strike Squad":{baseType:"32mm"},"Grey Knights Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}},"Land Raider Banisher":{baseType:"hull",hullDimensions:{width:0,height:0}}},"IMPERIAL AGENTS":{"Callidus Assassin":{baseType:"32mm"},"Corvus Blackstar":{baseType:"120x92mm"},"Culexus Assassin":{baseType:"32mm"},"Deathwatch Kill Team":{baseType:"32mm"},"Eversor Assassin":{baseType:"32mm"},"Exaction Squad":{baseType:"28.5mm"},"Exaction Squad: Cyber-mastiff":{baseType:"25mm"},"Grey Knights Terminator Squad":{baseType:"40mm"},"Imperial Navy Breachers":{baseType:"25mm"},"Imperial Navy Breachers: Navis las-volley, endurant shield":{baseType:"28.5mm"},"Imperial Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},Inquisitor:{baseType:"32mm"},"Inquisitor Coteaz":{baseType:"40mm"},"Inquisitor Draxus":{baseType:"32mm"},"Inquisitor Greyfax":{baseType:"32mm"},"Inquisitorial Agents":{baseType:"25mm"},"Inquisitorial Agents: Gun Servitors":{baseType:"32mm"},"Inquisitorial Chimera":{baseType:"hull",hullDimensions:{width:0,height:0}},"Ministorum Priest":{baseType:"32mm"},Navigator:{baseType:"32mm"},"Rogue Trader entourage":{baseType:"25mm"},Sanctifiers:{baseType:"25mm"},"Sisters of Battle Immolator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sisters of Battle Squad":{baseType:"32mm"},"Subductor Squad":{baseType:"28.5mm"},"Subductor Squad: Cyber-mastiff":{baseType:"25mm"},"Vigilant Squad":{baseType:"28.5mm"},"Vigilant Squad: Cyber-mastiff":{baseType:"25mm"},"Vindicare Assassin":{baseType:"32mm"},"Voidsmen-at-Arms":{baseType:"32mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},"IMPERIAL KNIGHTS":{"Armiger Helverin":{baseType:"100mm"},"Armiger Warglaive":{baseType:"100mm"},"Canis Rex":{baseType:"170x109mm"},"Knight Castellan":{baseType:"170x109mm"},"Knight Crusader":{baseType:"170x109mm"},"Knight Errant":{baseType:"170x109mm"},"Knight Gallant":{baseType:"170x109mm"},"Knight Paladin":{baseType:"170x109mm"},"Knight Preceptor":{baseType:"170x109mm"},"Knight Valiant":{baseType:"170x109mm"},"Knight Warden":{baseType:"170x109mm"},"Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armiger Moirax":{baseType:"100mm"},"Cerastus Knight Acheron":{baseType:"170x109mm"},"Cerastus Knight Atrapos":{baseType:"170x109mm"},"Cerastus Knight Castigator":{baseType:"170x109mm"},"Cerastus Knight Lancer":{baseType:"170x109mm"},"Questoris Knight Magaera":{baseType:"170x109mm"},"Questoris Knight Styrix":{baseType:"170x109mm"}},"LEAGUES OF VOTANN":{"Brôkhyr Iron-master":{baseType:"32mm"},"Brôkhyr Iron-master: E-COG":{baseType:"25mm"},"Brôkhyr Iron-master: Ironkin Assistant":{baseType:"28.5mm"},"Brôkhyr Thunderkyn":{baseType:"40mm"},"Cthonian Beserks":{baseType:"28.5mm"},"Cthonian Beserks: Mole grenade launcher":{baseType:"50mm"},"Einhyr Champion":{baseType:"40mm"},"Einhyr Hearthguard":{baseType:"32mm"},Grimnyr:{baseType:"40mm"},"Grimnyr: CORV":{baseType:"25mm"},"Hearthkyn Warriors":{baseType:"28.5mm"},"Hekaton Land Fortress":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hernkyn Pioneers":{baseType:"90x52.5mm"},"Hernkyn Yaegirs":{baseType:"28.5mm"},Kâhl:{baseType:"40mm"},Sagitaur:{baseType:"hull",hullDimensions:{width:0,height:0}},"Ûthar the Destined":{baseType:"40mm"}},NECRONS:dh,ORKS:hh,"SPACE MARINES":{"Adrax Agatone":{baseType:"40mm"},"Aggressor Squad":{baseType:"40mm"},Ancient:{baseType:"40mm"},"Ancient in Terminator Armour":{baseType:"40mm"},Apothecary:{baseType:"40mm"},"Apothecary Biologis":{baseType:"40mm"},"Assault Intercessor Squad":{baseType:"32mm"},"Assault Intercessors with Jump Packs":{baseType:"32mm"},"Ballistus Dreadnought":{baseType:"90mm"},"Bladeguard Ancient":{baseType:"40mm"},"Bladeguard Veteran Squad":{baseType:"40mm"},"Brutalis Dreadnought":{baseType:"90mm"},Captain:{baseType:"40mm"},"Captain in Gravis Armour":{baseType:"40mm"},"Captain in Phobos Armour":{baseType:"40mm"},"Captain in Terminator Armour":{baseType:"50mm"},"Captain Sicarius":{baseType:"32mm"},"Captain with Jump Pack":{baseType:"40mm"},"Centurion Assault Squad":{baseType:"50mm"},"Centurion Devastator Squad":{baseType:"50mm"},Chaplain:{baseType:"40mm"},"Chaplain in Terminator Armour":{baseType:"40mm"},"Chaplain on Bike":{baseType:"90x52.5mm"},"Chaplain with Jump Pack":{baseType:"32mm"},"Chief Librarian Tigurius":{baseType:"40mm"},"Company Heroes":{baseType:"40mm"},"Darnath Lysander":{baseType:"50mm"},"Desolation Squad":{baseType:"32mm"},"Devastator Squad":{baseType:"32mm"},Dreadnought:{baseType:"60mm"},"Drop Pod":{baseType:"hull",hullDimensions:{width:0,height:0}},"Eliminator Squad":{baseType:"40mm"},"Eradicator Squad":{baseType:"40mm"},"Firestrike Servo-turrets":{baseType:"80mm"},"Gladiator Lancer":{baseType:"100mm"},"Gladiator Reaper":{baseType:"100mm"},"Gladiator Valiant":{baseType:"100mm"},"Hammerfall Bunker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Heavy Intercessor Squad":{baseType:"40mm"},"Hellblaster Squad":{baseType:"32mm"},Impulsor:{baseType:"100mm"},"Inceptor Squad":{baseType:"40mm"},"Incursor Squad":{baseType:"32mm"},"Infernus Squad":{baseType:"32mm"},"Infiltrator Squad":{baseType:"32mm"},"Intercessor Squad":{baseType:"32mm"},"Invader ATV":{baseType:"hull",hullDimensions:{width:0,height:0}},"Invictor Tactical Warsuit":{baseType:"90mm"},"Iron Father Feirros":{baseType:"40mm"},Judiciar:{baseType:"40mm"},"Kayvaan Shrike":{baseType:"40mm"},"Kor’sarro Khan":{baseType:"40mm"},"Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},Librarian:{baseType:"40mm"},"Librarian in Phobos Armour":{baseType:"40mm"},"Librarian in Terminator Armour":{baseType:"40mm"},Lieutenant:{baseType:"40mm"},"Lieutenant in Phobos Armour":{baseType:"40mm"},"Lieutenant in Reiver Armour":{baseType:"40mm"},"Lieutenant Titus":{baseType:"40mm"},"Lieutenant with Combi-weapon":{baseType:"40mm"},"Marneus Calgar":{baseType:"50mm"},"Marneus Calgar: Victrix Honour Guard":{baseType:"40mm"},"Outrider Squad":{baseType:"90x52.5mm"},"Pedro Kantor":{baseType:"32mm"},"Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},Razorback:{baseType:"hull",hullDimensions:{width:0,height:0}},"Redemptor Dreadnought":{baseType:"90mm"},"Reiver Squad":{baseType:"32mm"},Repulsor:{baseType:"100mm"},"Repulsor Executioner":{baseType:"100mm"},Rhino:{baseType:"hull",hullDimensions:{width:0,height:0}},"Roboute Guilliman":{baseType:"60mm"},"Scout Squad":{baseType:"28.5mm"},"Sternguard Veteran Squad":{baseType:"32mm"},"Storm Speeder Hailstrike":{baseType:"90mm"},"Storm Speeder Hammerstrike":{baseType:"90mm"},"Storm Speeder Thunderstrike":{baseType:"90mm"},"Stormhawk Interceptor":{baseType:"120x92mm"},"Stormraven Gunship":{baseType:"120x92mm"},"Stormtalon Gunship":{baseType:"120x92mm"},"Suppressor Squad":{baseType:"40mm"},"Tactical Squad":{baseType:"32mm"},Techmarine:{baseType:"40mm"},"Terminator Assault Squad":{baseType:"40mm"},"Terminator Squad":{baseType:"40mm"},"Tor Garadon":{baseType:"40mm"},"Uriel Ventris":{baseType:"40mm"},"Vanguard Veteran Squad with Jump Packs":{baseType:"32mm"},Vindicator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Vulkan He’stan":{baseType:"32mm"},Whirlwind:{baseType:"hull",hullDimensions:{width:0,height:0}},Astraeus:{baseType:"hull",hullDimensions:{width:0,height:0}},"Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}}},"SPACE WOLVES":{"Arjac Rockfist":{baseType:"50mm"},"Bjorn the Fell-handed":{baseType:"60mm"},"Blood Claws":{baseType:"32mm"},"Fenrisian Wolves":{baseType:"40mm"},"Grey Hunters":{baseType:"32mm"},"Iron Priest":{baseType:"32mm"},"Logan Grimnar":{baseType:"80mm"},Murderfang:{baseType:"60mm"},"Njal Stormcaller":{baseType:"40mm"},"Ragnar Blackmane":{baseType:"40mm"},"Thunderwolf Cavalry":{baseType:"60mm"},"Ulrik the Slayer":{baseType:"32mm"},"Venerable Dreadnought":{baseType:"60mm"},"Wolf Guard Battle Leader":{baseType:"40mm"},"Wolf Guard Headtakers":{baseType:"40mm"},"Wolf Guard Headtakers: Hunting Wolves":{baseType:"60x35.5mm"},"Wolf Guard Terminators":{baseType:"40mm"},"Wolf Priest":{baseType:"40mm"},Wulfen:{baseType:"40mm"},"Wulfen Dreadnought":{baseType:"60mm"},"Wulfen with Storm Shields":{baseType:"40mm"}},"T’AU EMPIRE":{"Breacher Team":{baseType:"25mm"},"Broadside Battlesuits":{baseType:"60mm"},"Cadre Fireblade":{baseType:"25mm"},"Commander Farsight":{baseType:"60mm"},"Commander in Coldstar Battlesuit":{baseType:"60mm"},"Commander in Enforcer Battlesuit":{baseType:"60mm"},"Commander Shadowsun":{baseType:"50mm"},"Crisis Fireknife Battlesuits":{baseType:"50mm"},"Crisis Starscythe Battlesuits":{baseType:"50mm"},"Crisis Sunforge Battlesuits":{baseType:"50mm"},Darkstrider:{baseType:"32mm"},Devilfish:{baseType:"Large Flying Base"},Ethereal:{baseType:"40mm"},"Firesight Team":{baseType:"40mm"},"Ghostkeel Battlesuit":{baseType:"105x70mm"},"Hammerhead Gunship":{baseType:"Large Flying Base"},"Kroot Carnivores":{baseType:"28.5mm"},"Kroot Farstalkers":{baseType:"28.5mm"},"Kroot Farstalkers: Kroot Kill-broker":{baseType:"32mm"},"Kroot Flesh Shaper":{baseType:"32mm"},"Kroot Hounds":{baseType:"28.5mm"},"Kroot Lone-spear":{baseType:"90x52.5mm"},"Kroot Trail Shaper":{baseType:"32mm"},"Kroot War Shaper":{baseType:"32mm"},"Krootox Rampagers":{baseType:"50mm"},"Krootox Riders":{baseType:"50mm"},"Pathfinder Team":{baseType:"25mm"},Piranhas:{baseType:"Large Flying Base"},"Razorshark Strike Fighter":{baseType:"120x92mm"},"Riptide Battlesuit":{baseType:"120x92mm"},"Sky Ray Gunship":{baseType:"Large Flying Base"},"Stealth Battlesuits":{baseType:"32mm"},Stormsurge:{baseType:"170x109mm"},"Strike Team":{baseType:"25mm"},"Sun Shark Bomber":{baseType:"120x92mm"},"Tidewall Defence Platform":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Droneport":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Gunrig":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Shieldline":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vespid Stingwings":{baseType:"28.5mm"},"AX-1-0 Tiger Shark":{baseType:"160mm"},Manta:{baseType:"hull",hullDimensions:{width:4,height:6}},"Ta’unar Supremacy Armour":{baseType:"160mm"},"Tiger Shark":{baseType:"160mm"}},"THOUSAND SONS":{Ahriman:{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Daemon Prince of Tzeentch":{baseType:"60mm"},"Daemon Prince of Tzeentch with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},"Exalted Sorcerer":{baseType:"32mm"},"Exalted Sorcerer on Disc of Tzeentch":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Infernal Master":{baseType:"40mm"},"Magnus the Red":{baseType:"100mm"},Maulerfiend:{baseType:"120x92mm"},"Mutalith Vortex Beast":{baseType:"120x92mm"},"Rubric Marines":{baseType:"32mm"},"Scarab Occult Terminators":{baseType:"40mm"},"Sekhetar Robots":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Tzaangor Enlightened":{baseType:"40mm"},"Tzaangor Enlightened with Fatecaster Greatbows":{baseType:"40mm"},"Tzaangor Shaman":{baseType:"40mm"},Tzaangors:{baseType:"32mm"},"Blue Horrors":{baseType:"25mm"},Flamers:{baseType:"32mm"},"Kairos Fateweaver":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},"Pink Horrors":{baseType:"32mm"},Screamers:{baseType:"Small Flying Base"}},TYRANIDS:mh,"WORLD EATERS":{Angron:{baseType:"100mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Khorne":{baseType:"60mm"},"Daemon Prince of Khorne with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},Eightbound:{baseType:"40mm"},"Exalted Eightbound":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Goremongers:{baseType:"32mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},Jakhals:{baseType:"28.5mm"},"Jakhals: Dishonoured":{baseType:"40mm"},"Khârn the Betrayer":{baseType:"40mm"},"Khorne Berzerkers":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Invocatus":{baseType:"90x52.5mm"},"Lord on Juggernaut":{baseType:"90x52.5mm"},"Master of Executions":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},Slaughterbound:{baseType:"50mm"},"Terminator Squad":{baseType:"40mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodthirster:{baseType:"120x92mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Skarbrand:{baseType:"100mm"}}};function fh(){return Object.keys(Di)}function wl(t){const a=Di[t];return a?Object.keys(a):[]}function si(t,a){const n=Di[t];return n&&n[a]||null}function ph(t,a){const n=t.FACTION_KEYWORD,r=t.UNITS||[],s=[],o=[],l={};for(const d of r){const m=d.name||"",y=oh(d.quantity);let p=si(n,m);if(!p){const h=Sl(m,n);h&&(p=si(n,h))}if(!p){const{faction:h,unitName:f}=gh(m);h&&f&&(p=si(h,f))}if(p){l[m]||(l[m]=0),l[m]++;const h=l[m]>1?` #${l[m]}`:"",f=`${m}${h}`,v=yh(p,y,a,f);s.push(...v)}else o.push({id:"unmatched-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),unitName:m,quantity:y,points:d.points,section:d.section})}return{matched:vh(s),unmatched:o}}function yh(t,a,n,r,s){const o=[],l=bh(),u=t.baseType,d=Th(r,u);for(let m=0;m<a;m++){const p={id:_h(),baseType:u,playerId:n,x:0,y:0,rotation:0,unitId:l,unitName:r,name:d,imported:!0,inStaging:!0};u==="hull"&&(p.baseType="rect-custom",p.customWidth=t.hullDimensions?.width||5.5,p.customHeight=t.hullDimensions?.height||3),o.push(p)}return o}function vh(t){const o={};t.forEach(m=>{const y=m.unitId||"ungrouped";o[y]||(o[y]=[]),o[y].push(m)});let l=2,u=2,d=0;for(const m in o){const y=o[m];for(const p of y)p.x=l,p.y=u,l+=2,d++,d>=6&&(l=2,u+=2,d=0);d>0&&(l=2,u+=2,d=0)}return t}function Sl(t,a){const n=wl(a);if(!n||n.length===0)return null;const r=hs(t);for(const u of n)if(hs(u)===r)return u;const s=r.replace(/s$/,""),o=r+"s";for(const u of n){const d=hs(u);if(d===s||d===o)return u}for(const u of n){const d=hs(u);if(r.includes(d)||d.includes(r))return u}const l=r.split(/\s+/).filter(u=>u.length>2);if(l.length>0)for(const u of n){const d=hs(u);if(l.every(m=>d.includes(m)))return u}return null}function gh(t){const a=fh(),n=hs(t);for(const r of a){const s=wl(r);if(s){for(const o of s)if(hs(o)===n)return{faction:r,unitName:o}}}for(const r of a){const s=Sl(t,r);if(s)return{faction:r,unitName:s}}return{faction:null,unitName:null}}function hs(t){return String(t||"").toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim()}function bh(){return"unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Th(t,a){if(!t)return"";const n=a.match(/(\d+)mm/),r=n?parseInt(n[1],10):null;return r&&r<50?xh(t):t}function xh(t){return t?t.replace(/\s*#\d+$/,"").split(/\s+/).filter(s=>s.length>0).slice(0,3).map(s=>s[0].toUpperCase()).join(""):""}function _h(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}const An={battlefield:{fill:"#adbeadff"},terrain:{fill:"rgba(116, 102, 63, 0.71)",stroke:"#8b5a2b",strokeWidth:.15},wall:{fill:"rgba(52, 45, 39, 1)",stroke:"#000000ba",strokeWidth:.15},player1:{fill:"rgba(59, 130, 246, 0.6)",stroke:"#3b82f6",strokeWidth:.12},player2:{fill:"rgba(239, 68, 68, 0.6)",stroke:"#ef4444",strokeWidth:.12},modelName:{fill:"#ffffff",stroke:"#000000",strokeWidth:.05,fontWeight:"bold"},deploymentZone:{fillOpacity:.2,strokeWidth:.2,strokeDasharray:"0.5,0.25"},objective:{primary:{fill:"#9ca3af",stroke:"#000000",strokeWidth:.08},secondary:{fill:"#9ca3af",stroke:"#000000",strokeWidth:.08},controlRadius:{fillOpacity:.15,strokeWidth:.06,strokeDasharray:"0.3,0.15"},centerDot:{fill:"#000000",radius:.15}}},hr={pixelsPerInch:50,pngScale:2,fontSizeMultiplier:{circle:.8,oval:.6,rectangle:.35}};function wh(t){const a=An.deploymentZone;return`<path
    d="${Ss(t.path)}"
    fill="${t.borderColor}"
    fill-opacity="${a.fillOpacity}"
    stroke="${t.borderColor}"
    stroke-width="${a.strokeWidth}"
    stroke-dasharray="${a.strokeDasharray}"
  />`}function Sh(t){const a=t.isPrimary?An.objective.primary:An.objective.secondary,n=An.objective.controlRadius,r=An.objective.centerDot,s=`<circle
    cx="${t.x}"
    cy="${t.y}"
    r="${Zr}"
    fill="${a.fill}"
    fill-opacity="${n.fillOpacity}"
    stroke="${a.fill}"
    stroke-width="${n.strokeWidth}"
    stroke-dasharray="${n.strokeDasharray}"
  />`,o=`<circle
    cx="${t.x}"
    cy="${t.y}"
    r="${Jr}"
    fill="${a.fill}"
    stroke="${a.stroke}"
    stroke-width="${a.strokeWidth}"
  />`,l=`<circle
    cx="${t.x}"
    cy="${t.y}"
    r="${r.radius}"
    fill="${r.fill}"
  />`;return s+o+l}function kh(t){const{x:a,y:n,width:r,height:s,rotation:o}=t,l=a+r/2,u=n+s/2,d=An.terrain;return`<rect
    x="${a}"
    y="${n}"
    width="${r}"
    height="${s}"
    transform="rotate(${o}, ${l}, ${u})"
    fill="${d.fill}"
    stroke="${d.stroke}"
    stroke-width="${d.strokeWidth}"
  />`}function Ah(t){const a=Cn(t.shape,t.segments),n=br(a,t.x,t.y,t.rotation);if(n.length===0)return"";const r=n.map((o,l)=>`${l===0?"M":"L"} ${o.x} ${o.y}`).join(" ")+" Z",s=An.wall;return`<path
    d="${r}"
    fill="${s.fill}"
    stroke="${s.stroke}"
    stroke-width="${s.strokeWidth}"
  />`}function Ch(t){const a=_a(t.baseType,t),n=ya(t.baseType),r=Ha(t.baseType),s=t.playerId===1?An.player1:An.player2,o=An.modelName;let l="",u=0;if(r){const m=t.customWidth||0,y=t.customHeight||0,p=t.x,h=t.y;u=Math.min(m,y)*hr.fontSizeMultiplier.rectangle,l=`<g transform="rotate(${t.rotation||0}, ${p}, ${h})">
      <rect
        x="${p-m/2}"
        y="${h-y/2}"
        width="${m}"
        height="${y}"
        fill="${s.fill}"
        stroke="${s.stroke}"
        stroke-width="${s.strokeWidth}"
      />
    </g>`}else if(n){const m=a.width/2,y=a.height/2;u=Math.min(m,y)*hr.fontSizeMultiplier.oval,l=`<g transform="rotate(${t.rotation||0}, ${t.x}, ${t.y})">
      <ellipse
        cx="${t.x}"
        cy="${t.y}"
        rx="${m}"
        ry="${y}"
        fill="${s.fill}"
        stroke="${s.stroke}"
        stroke-width="${s.strokeWidth}"
      />
    </g>`}else{const m=a?.radius||.5;u=m*hr.fontSizeMultiplier.circle,l=`<circle
      cx="${t.x}"
      cy="${t.y}"
      r="${m}"
      fill="${s.fill}"
      stroke="${s.stroke}"
      stroke-width="${s.strokeWidth}"
    />`}let d="";return t.name&&(d=`<text
      x="${t.x}"
      y="${t.y}"
      text-anchor="middle"
      dominant-baseline="middle"
      font-size="${u}"
      font-weight="${o.fontWeight}"
      fill="${o.fill}"
      stroke="${o.stroke}"
      stroke-width="${o.strokeWidth}"
      paint-order="stroke"
    >${Eh(t.name)}</text>`),l+d}function Eh(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Mh(t,a,n,r=null){const s=yt.width,o=yt.height,l=An.battlefield.fill,u=hr.pixelsPerInch,d=t.map(kh).join(`
    `),m=a.map(Ah).join(`
    `),y=n.map(Ch).join(`
    `),p=r?.zones?r.zones.map(wh).join(`
    `):"",h=r?.objectives?r.objectives.map(Sh).join(`
    `):"";return`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${s} ${o}" width="${s*u}" height="${o*u}">
  <!-- Battlefield background -->
  <rect x="0" y="0" width="${s}" height="${o}" fill="${l}" />

  <!-- Deployment zones -->
  <g id="deployment-zones">
    ${p}
  </g>

  <!-- Objectives -->
  <g id="objectives">
    ${h}
  </g>

  <!-- Terrain pieces -->
  <g id="terrains">
    ${d}
  </g>

  <!-- Wall pieces -->
  <g id="walls">
    ${m}
  </g>

  <!-- Model bases -->
  <g id="models">
    ${y}
  </g>
</svg>`}function Rh(t,a=1){return new Promise((n,r)=>{const s=new Image,o=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),l=URL.createObjectURL(o);s.onload=()=>{const u=document.createElement("canvas");u.width=s.width*a,u.height=s.height*a;const d=u.getContext("2d");d.scale(a,a),d.drawImage(s,0,0),URL.revokeObjectURL(l),u.toBlob(m=>{m?n(m):r(new Error("Failed to create PNG blob"))},"image/png")},s.onerror=()=>{URL.revokeObjectURL(l),r(new Error("Failed to load SVG image"))},s.src=l})}async function Ii(t,a,n=[],r="battlefield",s=null){try{const o=Mh(t,a,n,s),l=await Rh(o,hr.pngScale),u=URL.createObjectURL(l),d=document.createElement("a");return d.href=u,d.download=`${r}.png`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(u),!0}catch(o){throw console.error("Failed to export PNG:",o),o}}var Dh=ve('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),Ih=ve('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div> <!>',1),Lh=ve('<button class="svelte-1g40uyy">Group (Ctrl+G)</button>'),$h=ve('<button class="svelte-1g40uyy">Ungroup (Ctrl+Shift+G)</button>'),Ph=ve('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Selected</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <!> <!> <button class="danger svelte-1g40uyy"> </button></div>'),Nh=ve('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Rotation</span> <span class="value svelte-1g40uyy"> </span></div>'),Oh=ve('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div>'),Wh=ve('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),Yh=ve('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Base Type</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Player</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Position</span> <span class="value svelte-1g40uyy"> </span></div> <!> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-1g40uyy">Remove</button></div>'),Hh=ve('<p class="hint svelte-1g40uyy">Click a model to select it</p>'),Fh=ve('<p class="hint svelte-1g40uyy">Click and drag on battlefield to draw a measurement line</p>'),Bh=ve('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Length</span> <span class="value svelte-1g40uyy"> </span></div> <button class="danger svelte-1g40uyy">Remove Line</button>',1),qh=ve('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Lines</span> <span class="value svelte-1g40uyy"> </span></div> <button class="secondary svelte-1g40uyy">Clear All Lines</button>',1),Uh=ve('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Line Tool Active (M)</label></div> <!> <!> <!> <div class="field svelte-1g40uyy" style="margin-top: 0.5rem; border-top: 1px solid #333; padding-top: 0.5rem;"><span class="label-text svelte-1g40uyy">Range Zones</span> <label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show 6" zones</label> <label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show 9" zones</label> <label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show 12" zones</label></div></div>'),Kh=ve('<div class="button-group vertical svelte-1g40uyy"><div class="button-row svelte-1g40uyy"><button title="Undo (Ctrl+Z)" class="svelte-1g40uyy">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-1g40uyy">Redo</button></div> <div class="button-row svelte-1g40uyy"><button title="Export deployment to share with others" class="svelte-1g40uyy">Export</button> <button title="Import deployment from JSON file" class="svelte-1g40uyy">Import</button></div> <input type="file" accept=".json" style="display: none;"/> <button title="Export battlefield as PNG image" class="svelte-1g40uyy">Export PNG</button> <button class="svelte-1g40uyy">Save to Browser</button> <button class="svelte-1g40uyy">Restore from Browser</button> <button class="secondary svelte-1g40uyy">Clear All Models</button></div>'),Gh=ve('<div class="player-toggle svelte-1g40uyy"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-1g40uyy"><div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Circles</h4> <div class="palette-grid svelte-1g40uyy"></div></div> <div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Ovals</h4> <div class="palette-grid svelte-1g40uyy"></div></div></div>',1),zh=ve('<div class="rect-hull-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="rect-width" class="svelte-1g40uyy">Width (inches)</label> <input id="rect-width" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <div class="field svelte-1g40uyy"><label for="rect-height" class="svelte-1g40uyy">Height (inches)</label> <input id="rect-height" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <button class="svelte-1g40uyy"> </button></div>'),Xh=ce('<path stroke-width="0.10" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),Vh=ce('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),jh=ce("<!><!>",1),Jh=ce('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),Zh=ce('<g opacity="0.5" pointer-events="none"><!></g>'),Qh=ce('<g><rect rx="12" ry="12" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></rect></g>'),em=ce('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></ellipse></g>'),tm=ce('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></circle>'),am=ce('<g><rect rx="9" ry="9" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></rect></g>'),nm=ce('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></ellipse></g>'),sm=ce('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></circle>'),rm=ce('<g><rect rx="6" ry="6" fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></rect></g>'),im=ce('<g><ellipse fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></ellipse></g>'),om=ce('<circle fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></circle>'),lm=ce("<!><!><!>",1),cm=ce('<circle r="0.4" fill="rgba(147, 51, 234, 0.5)" stroke="#9333ea" stroke-width="0.1" pointer-events="none"></circle><line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="group-rotate-handle"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),um=ce('<circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle><circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle>',1),dm=ce('<g><line stroke-linecap="round"></line><!><g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g></g>'),hm=ce('<g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" fill="#f59e0b" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g>'),mm=ce('<g class="measurement-line drawing"><line stroke="#f59e0b" stroke-width="0.15" stroke-dasharray="0.3,0.15" stroke-linecap="round" pointer-events="none"></line><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><!></g>'),fm=ce('<line stroke-width="0.05" pointer-events="none"></line>'),pm=ce('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),ym=ce('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),vm=ce('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),gm=ce("<!><!><!><!><!><!><!><!><!><!><!><!><!><!><!>",1),bm=ve('<main class="svelte-1g40uyy"><div class="layout svelte-1g40uyy"><div class="sidebar svelte-1g40uyy"><!> <!> <!> <!> <!> <!></div> <div class="main-content svelte-1g40uyy"><div class="battlefield-area svelte-1g40uyy"><div class="battlefield-container svelte-1g40uyy" role="presentation"><!></div> <div class="info svelte-1g40uyy"><p class="svelte-1g40uyy"> </p> <p class="hint svelte-1g40uyy">Drag to select | Ctrl+Click multi-select | Del remove | 1/2 player | L LoS | M measure</p></div></div></div></div></main> <!>',1);function ao(t,a){Ja(a,!1);const n=()=>Xt(as,"$selectedDeployment",y),r=()=>Xt(pn,"$selectedLayoutName",y),s=()=>Xt(wn,"$selectedLayoutType",y),o=()=>Xt(Tt,"$models",y),l=()=>Xt(Ri,"$loadedTerrain",y),u=()=>Xt(Ya,"$history",y),d=()=>Xt(gl,"$player1Models",y),m=()=>Xt(bl,"$player2Models",y),[y,p]=As(),h=N(),f=N(),v=N(),k=N(),T=N(),A=N(),P=N(),E=N(),S=N(),R=N(),L=N(),q=N(),F=N(),U=N();let W=N(1),ae=N(null),re=!1,Re=null,fe=N(null),se=N(!1),We=N(!1),xe=N(5.5),_e=N(3),De=N(!1),Ie=N([]),de=[],Q=N(null),Ve=N(!1),G=N(null),Fe=N(null),he=N([]),kt=N(new Set),Ot=!1,ha=!1,aa=null,Vt=!1,ma=null,Ia=0,lt=null,ct=N([]),Et=N(null),Pe=N(!1),we=N(null),Ce=N(null),Ze=N(!1),V=N(!1),Le=N(!1),Xe=N(!1);const Pt=5,At="warhammer-deployment-state";function ft(){const w={deployment:n()?.name||null,layout:r()||null,layoutType:s()||null,models:o()};localStorage.setItem(At,JSON.stringify(w))}function Ut(){const w=localStorage.getItem(At);if(w)try{const O=JSON.parse(w);O.models&&Array.isArray(O.models)&&(Tt.set(O.models),Ya.clear())}catch(O){console.error("Failed to restore deployment state:",O)}}function jt(){const w={version:1,exportedAt:new Date().toISOString(),deployment:n()?{name:n().name,zones:n().zones,objectives:n().objectives}:null,terrain:{layoutName:r(),layoutType:s(),terrains:l().terrains,walls:l().walls},models:o()},O=JSON.stringify(w,null,2),Y=new Blob([O],{type:"application/json"}),j=URL.createObjectURL(Y),te=document.createElement("a");te.href=j,te.download=`deployment-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(te),te.click(),document.body.removeChild(te),URL.revokeObjectURL(j)}async function Kt(){const O=`deployment-${new Date().toISOString().slice(0,10)}`;try{await Ii(l().terrains,l().walls,o(),O,n())}catch(Y){alert("Failed to export PNG"),console.error("Export error:",Y)}}let Lt=N(null);function Bt(){e(Lt)?.click()}function wa(w){const O=w.target.files?.[0];if(!O)return;const Y=new FileReader;Y.onload=j=>{try{const te=JSON.parse(j.target.result);ga(te)}catch(te){console.error("Failed to parse import file:",te),alert("Failed to import: Invalid JSON file")}},Y.readAsText(O),w.target.value=""}function ga(w){if(!w.version){alert("Invalid import file: missing version");return}if(w.deployment){const O=ll.find(Y=>Y.name===w.deployment.name);O?as.set(O):w.deployment.zones&&w.deployment.objectives&&as.set({name:w.deployment.name||"Imported",zones:w.deployment.zones,objectives:w.deployment.objectives})}else as.set(null);if(w.terrain){const{layoutName:O,layoutType:Y,terrains:j,walls:te}=w.terrain;if(Y==="preset"&&O){if(ml.find(me=>me.name===O))pn.set(O),wn.set("preset");else if(j||te){const me=`imported-${Date.now()}`,oe=localStorage.getItem("warhammer-deployment-layouts"),$e=oe?JSON.parse(oe):{};$e[me]={terrains:j||[],walls:te||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify($e)),pn.set(me),wn.set("saved")}}else if(Y==="saved"&&O){const ye=localStorage.getItem("warhammer-deployment-layouts"),me=ye?JSON.parse(ye):{};me[O]?(pn.set(O),wn.set("saved")):(j||te)&&(me[O]={terrains:j||[],walls:te||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(me)),pn.set(O),wn.set("saved"))}else if(j||te){const ye=`imported-${Date.now()}`,me=localStorage.getItem("warhammer-deployment-layouts"),oe=me?JSON.parse(me):{};oe[ye]={terrains:j||[],walls:te||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(oe)),pn.set(ye),wn.set("saved")}}w.models&&Array.isArray(w.models)&&(Tt.set(w.models),Ya.clear()),g(he,[])}function Jt(w,O){const te=O===1?-4:64,ye=2;let me=te,oe=ye,$e=0;return w.map(ot=>{const It={...ot,x:me,y:oe,inStaging:!1};return oe+=2,$e++,$e>=20&&(oe=ye,me+=O===1?-2:2,$e=0),It})}async function Dt(w){const{text:O,playerId:Y}=w.detail;try{e(Q)&&e(Q).setLoading(!0);const{format:j,data:te}=await rh(O),{matched:ye,unmatched:me}=ph(te,Y),oe=te.LIST_TITLE||`${te.FACTION_KEYWORD} Army`;fi.addImport(oe,O,te,Y),me.length>0?(g(Ie,me),de=ye,g(De,!0),e(Q)&&e(Q).setLoading(!1)):(Jt(ye,Y).forEach(ot=>{Tt.update(It=>[...It,ot])}),e(Q)&&(e(Q).setSuccess(`Imported ${ye.length} models from ${te.FACTION_KEYWORD} (${j})`),e(Q).clearText()))}catch(j){console.error("Failed to parse army list:",j),e(Q)&&e(Q).setError(j.message||"Failed to parse army list")}}function ka(w){const{selected:O}=w.detail,Y=[];for(const ye of O){const me=typeof ye.quantity=="string"?parseInt(ye.quantity.replace(/x/i,""),10)||1:ye.quantity||1,oe="unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);for(let $e=0;$e<me;$e++)Y.push({id:"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),baseType:ye.baseType,playerId:e(W),x:0,y:0,rotation:0,unitId:oe,unitName:ye.unitName,name:ye.unitName,imported:!0})}const j=[...de,...Y];Jt(j,e(W)).forEach(ye=>{Tt.update(me=>[...me,ye])}),e(Q)&&(e(Q).setSuccess(`Imported ${j.length} models`),e(Q).clearText()),g(Ie,[]),de=[]}Cs(()=>{window.addEventListener("keydown",et)}),Qo(()=>{window.removeEventListener("keydown",et)});function et(w){if(w.target.tagName==="INPUT")return;const O=e(he).length>0;if((w.ctrlKey||w.metaKey)&&w.key==="z"&&!w.shiftKey){w.preventDefault(),Tt.undo();return}if((w.ctrlKey||w.metaKey)&&(w.key==="y"||w.shiftKey&&w.key==="z")){w.preventDefault(),Tt.redo();return}if((w.ctrlKey||w.metaKey)&&w.key==="g"&&!w.shiftKey){w.preventDefault(),Ms();return}if((w.ctrlKey||w.metaKey)&&w.shiftKey&&w.key==="G"){w.preventDefault(),gn();return}if(w.key==="1"){w.preventDefault(),g(W,1);return}if(w.key==="2"){w.preventDefault(),g(W,2);return}if(w.key==="l"||w.key==="L"){w.preventDefault(),g(se,!e(se));return}if(w.key==="m"||w.key==="M"){w.preventDefault(),g(Ze,!e(Ze)),e(Ze)||(g(Pe,!1),g(we,null),g(Ce,null));return}if(w.key==="Delete"||w.key==="Backspace"){if(w.preventDefault(),e(Et)){g(ct,e(ct).filter(Y=>Y.id!==e(Et))),g(Et,null);return}e(he).length>0&&(e(he).forEach(Y=>{Tt.remove(Y)}),g(he,[]));return}if(O&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(w.key)){w.preventDefault();const Y=w.shiftKey?.1:1;let j=0,te=0;switch(w.key){case"ArrowUp":te=-Y;break;case"ArrowDown":te=Y;break;case"ArrowLeft":j=-Y;break;case"ArrowRight":j=Y;break}e(he).forEach(ye=>{const me=o().find(oe=>oe.id===ye);me&&Tt.updateModel(ye,{x:me.x+j,y:me.y+te},!1)});return}if(w.key==="Escape"){it();return}}function it(w){if(Ot){Ot=!1;return}g(he,[]),g(Et,null)}function pt(){return"line-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Gt(w,O,Y,j){return Math.sqrt((Y-w)**2+(j-O)**2)}function la(w){if(!e(fe))return;w.preventDefault();const O=e(fe)(w.clientX,w.clientY);g(Pe,!0),g(we,{x:O.x,y:O.y}),g(Ce,{x:O.x,y:O.y}),window.addEventListener("mousemove",sa),window.addEventListener("mouseup",qt)}function sa(w){if(!e(Pe)||!e(fe))return;const O=e(fe)(w.clientX,w.clientY);g(Ce,{x:O.x,y:O.y})}function qt(w){if(!e(Pe))return;if(Gt(e(we).x,e(we).y,e(Ce).x,e(Ce).y)>.5){const Y={id:pt(),x1:e(we).x,y1:e(we).y,x2:e(Ce).x,y2:e(Ce).y};g(ct,[...e(ct),Y]),g(Et,Y.id),g(he,[])}g(Pe,!1),g(we,null),g(Ce,null),window.removeEventListener("mousemove",sa),window.removeEventListener("mouseup",qt)}function Yt(w,O){O?.stopPropagation(),g(Et,w),g(he,[])}let La=!1,$a={x:0,y:0},Ta=null,ca=null;function qa(w,O){if(!e(Ze)||!e(fe))return;O.stopPropagation(),O.preventDefault();const Y=e(ct).find(me=>me.id===w);if(!Y)return;La=!0,Ta=w,ca=null,g(Et,w),g(he,[]);const j=e(fe)(O.clientX,O.clientY),te=(Y.x1+Y.x2)/2,ye=(Y.y1+Y.y2)/2;$a={x:j.x-te,y:j.y-ye},window.addEventListener("mousemove",vn),window.addEventListener("mouseup",ue)}function Qa(w,O,Y){!e(Ze)||!e(fe)||(Y.stopPropagation(),Y.preventDefault(),La=!0,Ta=w,ca=O,g(Et,w),g(he,[]),window.addEventListener("mousemove",vn),window.addEventListener("mouseup",ue))}function vn(w){if(!La||!e(fe)||!Ta)return;const O=e(fe)(w.clientX,w.clientY);g(ct,e(ct).map(Y=>{if(Y.id!==Ta)return Y;if(ca===1)return{...Y,x1:O.x,y1:O.y};if(ca===2)return{...Y,x2:O.x,y2:O.y};{const j=O.x-$a.x,te=O.y-$a.y,ye=(Y.x1+Y.x2)/2,me=(Y.y1+Y.y2)/2,oe=j-ye,$e=te-me;return{...Y,x1:Y.x1+oe,y1:Y.y1+$e,x2:Y.x2+oe,y2:Y.y2+$e}}}))}function ue(){La=!1,Ta=null,ca=null,window.removeEventListener("mousemove",vn),window.removeEventListener("mouseup",ue)}function Je(){g(ct,[]),g(Et,null)}function $t(w){const O=w.target,Y=O.closest(".model-base"),j=O.closest(".measurement-line");if(Y||j||!e(fe))return;if(w.preventDefault(),e(Ze)){la(w);return}const te=e(fe)(w.clientX,w.clientY);g(G,{x:te.x,y:te.y}),g(Fe,{x:te.x,y:te.y}),g(Ve,!0),window.addEventListener("mousemove",Wt),window.addEventListener("mouseup",Ee)}function Wt(w){if(!e(Ve)||!e(fe))return;const O=e(fe)(w.clientX,w.clientY);g(Fe,{x:O.x,y:O.y});const Y=Math.min(e(G).x,e(Fe).x),j=Math.max(e(G).x,e(Fe).x),te=Math.min(e(G).y,e(Fe).y),ye=Math.max(e(G).y,e(Fe).y),me=new Set;o().forEach(oe=>{oe.x>=Y&&oe.x<=j&&oe.y>=te&&oe.y<=ye&&me.add(oe.id)}),g(kt,me)}function Ee(w){if(!e(Ve))return;const O=Math.min(e(G).x,e(Fe).x),Y=Math.max(e(G).x,e(Fe).x),j=Math.min(e(G).y,e(Fe).y),te=Math.max(e(G).y,e(Fe).y),ye=Y-O,me=te-j;if(ye<.5&&me<.5)g(he,[]);else{const oe=[];o().forEach($e=>{$e.x>=O&&$e.x<=Y&&$e.y>=j&&$e.y<=te&&oe.push($e.id)}),g(he,oe),Ot=!0}g(Ve,!1),g(G,null),g(Fe,null),e(kt).clear(),g(kt,e(kt)),window.removeEventListener("mousemove",Wt),window.removeEventListener("mouseup",Ee)}function vt(w,O){if(!e(fe))return;re=!0,Re={x:O.clientX,y:O.clientY};const Y=e(fe)(O.clientX,O.clientY);g(ae,{baseType:w.type,x:Y.x,y:Y.y}),window.addEventListener("mousemove",st),window.addEventListener("mouseup",Ye)}function st(w){if(!re||!e(ae)||!e(fe))return;const O=e(fe)(w.clientX,w.clientY);g(ae,{...e(ae),x:O.x,y:O.y})}function Ye(w){if(!re||!e(ae)){re=!1,g(ae,null),Re=null,window.removeEventListener("mousemove",st),window.removeEventListener("mouseup",Ye);return}const O=w.clientX-Re.x,Y=w.clientY-Re.y,j=Math.sqrt(O*O+Y*Y);let te,ye;j<Pt?(te=30,ye=22):(te=e(ae).x,ye=e(ae).y);const me=e(ae).customWidth&&e(ae).customHeight?{width:e(ae).customWidth,height:e(ae).customHeight}:null,oe=Tt.add(e(ae).baseType,e(W),te,ye,me);g(he,[oe]),g(ae,null),re=!1,Re=null,window.removeEventListener("mousemove",st),window.removeEventListener("mouseup",Ye)}function Ge(){const Y={width:e(xe),height:e(_e)},j=Tt.add("rect-custom",e(W),30,22,Y);g(he,[j])}function I(w,O){if(O&&(O.ctrlKey||O.metaKey||O.shiftKey))e(he).includes(w)?g(he,e(he).filter(Y=>Y!==w)):g(he,[...e(he),w]);else{if(e(he).includes(w))return;{const Y=o().find(j=>j.id===w);if(Y&&Y.unitId){const j=o().filter(te=>te.unitId===Y.unitId).map(te=>te.id);g(he,j)}else g(he,[w])}}}function ht(w,O,Y){if(e(he).length>1&&e(he).includes(w)){ha||(ha=!0,aa={},e(he).forEach(te=>{const ye=o().find(me=>me.id===te);ye&&(aa[te]={x:ye.x,y:ye.y})}));const j=aa[w];if(j){const te=O-j.x,ye=Y-j.y;e(he).forEach(me=>{const oe=aa[me];oe&&Tt.updateModel(me,{x:oe.x+te,y:oe.y+ye},!0)})}}else Tt.updateModel(w,{x:O,y:Y},!0)}function Nt(w,O,Y,j,te){ha?(e(he).forEach(ye=>{const me=aa[ye],oe=o().find($e=>$e.id===ye);me&&oe&&Ya.push({type:"move",modelId:ye,before:{x:me.x,y:me.y},after:{x:oe.x,y:oe.y}})}),ha=!1,aa=null):Ya.push({type:"move",modelId:w,before:{x:O,y:Y},after:{x:j,y:te}})}function Mt(w,O){if(e(he).length>1&&e(he).includes(w)){if(!Vt){Vt=!0;let ye=0,me=0,oe=0;const $e={};e(he).forEach(ot=>{const It=o().find(Ht=>Ht.id===ot);It&&(ye+=It.x,me+=It.y,oe++,$e[ot]={x:It.x,y:It.y,rotation:It.rotation||0})}),ma={x:ye/oe,y:me/oe},aa=$e}const Y=o().find(ye=>ye.id===w),j=aa[w];if(!Y||!j)return;const te=O-j.rotation;e(he).forEach(ye=>{const me=aa[ye];if(me){const oe=me.x-ma.x,$e=me.y-ma.y,ot=te*Math.PI/180,It=Math.cos(ot),Ht=Math.sin(ot),Qt=oe*It-$e*Ht,_t=oe*Ht+$e*It;Tt.updateModel(ye,{x:ma.x+Qt,y:ma.y+_t,rotation:me.rotation+te},!0)}})}else Tt.updateModel(w,{rotation:O},!0)}function xt(w,O,Y){Vt?(e(he).forEach(j=>{const te=aa[j],ye=o().find(me=>me.id===j);te&&ye&&Ya.push({type:"rotate",modelId:j,before:{x:te.x,y:te.y,rotation:te.rotation},after:{x:ye.x,y:ye.y,rotation:ye.rotation||0}})}),Vt=!1,ma=null,aa=null):Ya.push({type:"rotate",modelId:w,before:{rotation:O},after:{rotation:Y}})}function xa(w,O){Tt.updateModel(w,{name:O})}function Ms(){if(e(he).length<2)return;const w=e(he).map(Y=>o().find(j=>j.id===Y)).filter(Boolean);if([...new Set(w.map(Y=>Y.playerId))].length>1){alert("Cannot group models from different players");return}Tt.groupModels(e(he))}function gn(){if(e(he).length===0)return;const w=e(he).filter(O=>{const Y=o().find(j=>j.id===O);return Y&&Y.unitId});w.length>0&&Tt.ungroupModels(w)}function Rs(w){if(!e(fe)||e(h).length<2)return;w.preventDefault(),w.stopPropagation(),Vt=!0,lt={},e(h).forEach(Y=>{lt[Y.id]={x:Y.x,y:Y.y,rotation:Y.rotation||0}});const O=e(fe)(w.clientX,w.clientY);Ia=Math.atan2(O.y-e(T).y,O.x-e(T).x)*180/Math.PI,window.addEventListener("mousemove",bn),window.addEventListener("mouseup",cn)}function bn(w){if(!Vt||!e(fe)||!e(T))return;const O=e(fe)(w.clientX,w.clientY);let j=Math.atan2(O.y-e(T).y,O.x-e(T).x)*180/Math.PI-Ia;w.shiftKey||(j=Math.round(j/15)*15),g(Ka,-45+j);const te=j*Math.PI/180,ye=Math.cos(te),me=Math.sin(te);e(h).forEach(oe=>{const $e=lt[oe.id];if($e){const ot=$e.x-e(T).x,It=$e.y-e(T).y,Ht=ot*ye-It*me,Qt=ot*me+It*ye;Tt.updateModel(oe.id,{x:e(T).x+Ht,y:e(T).y+Qt,rotation:$e.rotation+j},!0)}})}function cn(){Vt&&lt&&e(h).forEach(w=>{const O=lt[w.id];O&&Ya.push({type:"rotate",modelId:w.id,before:{x:O.x,y:O.y,rotation:O.rotation},after:{x:w.x,y:w.y,rotation:w.rotation||0}})}),Vt=!1,lt=null,g(Ka,-45),window.removeEventListener("mousemove",bn),window.removeEventListener("mouseup",cn)}function en(){e(he).length>0&&(e(he).forEach(w=>{Tt.remove(w)}),g(he,[]))}function Ds(){confirm("Clear all models?")&&(Tt.clear(),g(he,[]))}function cs(w){if(Ha(w.baseType))return{x:w.x,y:w.y,width:w.customWidth,height:w.customHeight,rotation:w.rotation||0,isRectangle:!0};const O=_a(w.baseType,w);return ya(w.baseType)?{x:w.x,y:w.y,rx:O.width/2,ry:O.height/2,rotation:w.rotation||0}:{x:w.x,y:w.y,radius:O.radius}}const tn=["#f97316","#f59e0b","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e","#fb7185","#fdba74","#fcd34d"];function Xa(w){if(!w)return null;let O=0;for(let j=0;j<w.length;j++)O=(O<<5)-O+w.charCodeAt(j),O=O&O;const Y=Math.abs(O)%tn.length;return console.log(tn[Y]),tn[Y]}let Ka=N(-45);le(()=>(e(he),o()),()=>{g(h,e(he).map(w=>o().find(O=>O.id===w)).filter(Boolean))}),le(()=>e(h),()=>{g(f,e(h).length===1?e(h)[0]:null)}),le(()=>e(h),()=>{g(v,e(h).length<2?!1:[...new Set(e(h).map(O=>O.playerId))].length===1)}),le(()=>e(h),()=>{g(k,e(h).some(w=>w.unitId))}),le(()=>e(h),()=>{g(T,e(h).length>1?(()=>{let w=0,O=0;return e(h).forEach(Y=>{w+=Y.x,O+=Y.y}),{x:w/e(h).length,y:O/e(h).length}})():null)}),le(()=>(e(h),e(T),ya),()=>{g(A,e(h).length>1?(()=>{let w=0;return e(h).forEach(O=>{const Y=Math.sqrt(Math.pow(O.x-e(T).x,2)+Math.pow(O.y-e(T).y,2)),j=_a(O.baseType,O),te=Ha(O.baseType)?Math.max(O.customWidth,O.customHeight)/2:ya(O.baseType)?Math.max(j.width,j.height)/2:j.radius;w=Math.max(w,Y+te)}),w+2})():0)}),le(()=>(e(T),e(A),e(Ka)),()=>{g(P,e(T)?e(T).x+e(A)*Math.cos(e(Ka)*Math.PI/180):0)}),le(()=>(e(T),e(A),e(Ka)),()=>{g(E,e(T)?e(T).y+e(A)*Math.sin(e(Ka)*Math.PI/180):0)}),le(()=>(e(Et),e(ct)),()=>{g(S,e(Et)?e(ct).find(w=>w.id===e(Et)):null)}),le(()=>e(h),()=>{g(R,[...new Set(e(h).map(w=>w.playerId))])}),le(()=>(e(h),o(),e(R)),()=>{g(L,e(h).length>0?o().filter(w=>!e(R).includes(w.playerId)):[])}),le(()=>(l(),ws),()=>{g(q,l().terrains.map(w=>({id:w.id,vertices:ws(w)})))}),le(()=>(l(),Cn),()=>{g(F,l().walls.map(w=>br(Cn(w.shape,w.segments),w.x,w.y,w.rotation)))}),le(()=>(e(h),e(se),e(L),e(q),e(F)),()=>{g(U,e(h).length>0&&e(se)&&e(L).length>0?(()=>{const w=new Map;e(h).forEach(j=>{const te=j.unitId||`single-${j.id}`;w.has(te)||w.set(te,[]),w.get(te).push(j)});const O=new Map;e(L).forEach(j=>{const te=j.unitId||`single-${j.id}`;O.has(te)||O.set(te,[]),O.get(te).push(j)});const Y=[];for(const j of w.values())for(const te of O.values()){const ye=te.map($e=>cs($e)),me=j.map($e=>cs($e)),oe=sl(ye,me,e(q),e(F));oe.canSee?te.forEach($e=>{j.forEach(ot=>{Y.push({sourceId:$e.id,source:$e,targetId:ot.id,target:ot,canSee:!0,firstClearRay:oe.firstClearResult?.firstClearRay,rays:oe.firstClearResult?.rays||[]})})}):te.forEach($e=>{j.forEach(ot=>{Y.push({sourceId:$e.id,source:$e,targetId:ot.id,target:ot,canSee:!1,firstClearRay:null,rays:[]})})})}return Y})():[])}),$n(),ln();var xr=bm(),Is=ie(xr),Qr=x(Is),_r=x(Qr),wr=x(_r);Ma(wr,{title:"Selected Model",children:(w,O)=>{var Y=ze(),j=ie(Y);{var te=me=>{var oe=Ph(),$e=x(oe),ot=b(x($e),2),It=x(ot),Ht=b($e,2),Qt=x(Ht),_t=x(Qt),Se=b(Ht,2);{var B=Be=>{var Qe=Ih(),qe=ie(Qe),bt=x(qe),Zt=x(bt),oa=b(qe,2);{var Te=K=>{var St=Dh(),Ke=b(x(St),2),$=x(Ke);H(pe=>Oe($,`${pe??""}/${e(U),i(()=>e(U).length)??""} rays visible`),[()=>(e(U),i(()=>e(U).filter(pe=>pe.canSee).length))]),_(K,St)};z(oa,K=>{e(U),i(()=>e(U).length>0)&&K(Te)})}Na(Zt,()=>e(We),K=>g(We,K)),_(Be,Qe)};z(Se,Be=>{e(se)&&Be(B)})}var mt=b(Se,2);{var rt=Be=>{var Qe=Lh();Z("click",Qe,Ms),_(Be,Qe)};z(mt,Be=>{e(v)&&Be(rt)})}var M=b(mt,2);{var J=Be=>{var Qe=$h();Z("click",Qe,gn),_(Be,Qe)};z(M,Be=>{e(k)&&Be(J)})}var tt=b(M,2),Rt=x(tt);H(()=>{Oe(It,`${e(he),i(()=>e(he).length)??""} models`),Oe(Rt,`Remove All (${e(he),i(()=>e(he).length)??""})`)}),Na(_t,()=>e(se),Be=>g(se,Be)),Z("click",tt,en),_(me,oe)},ye=me=>{var oe=ze(),$e=ie(oe);{var ot=Ht=>{var Qt=Yh(),_t=x(Qt),Se=b(x(_t),2),B=b(_t,2),mt=b(x(B),2),rt=x(mt),M=b(B,2),J=b(x(M),2),tt=x(J),Rt=b(M,2),Be=b(x(Rt),2),Qe=x(Be),qe=b(Rt,2);{var bt=dt=>{var Ft=Nh(),Ne=b(x(Ft),2),Ue=x(Ne);H(je=>Oe(Ue,`${je??""}°`),[()=>(e(f),i(()=>Math.round(e(f).rotation||0)))]),_(dt,Ft)};z(qe,dt=>{D(ya),e(f),i(()=>ya(e(f).baseType))&&dt(bt)})}var Zt=b(qe,2),oa=x(Zt),Te=x(oa),K=b(Zt,2);{var St=dt=>{var Ft=Oh(),Ne=x(Ft),Ue=x(Ne);Na(Ue,()=>e(We),je=>g(We,je)),_(dt,Ft)};z(K,dt=>{e(se)&&dt(St)})}var Ke=b(K,2);{var $=dt=>{var Ft=Wh(),Ne=b(x(Ft),2),Ue=x(Ne);H(je=>Oe(Ue,`${je??""}/${e(U),i(()=>e(U).length)??""} visible`),[()=>(e(U),i(()=>e(U).filter(je=>je.canSee).length))]),_(dt,Ft)};z(Ke,dt=>{e(se),e(U),i(()=>e(se)&&e(U).length>0)&&dt($)})}var pe=b(Ke,2);H((dt,Ft,Ne)=>{Yn(Se,(e(f),i(()=>e(f).name||""))),Oe(rt,dt),Oe(tt,`Player ${e(f),i(()=>e(f).playerId)??""}`),Oe(Qe,`${Ft??""}", ${Ne??""}"`)},[()=>(D(_a),e(f),i(()=>_a(e(f).baseType,e(f))?.label||"Unknown")),()=>(e(f),i(()=>e(f).x.toFixed(1))),()=>(e(f),i(()=>e(f).y.toFixed(1)))]),Z("change",Se,dt=>xa(e(f).id,dt.target.value)),Na(Te,()=>e(se),dt=>g(se,dt)),Z("click",pe,en),_(Ht,Qt)},It=Ht=>{var Qt=Hh();_(Ht,Qt)};z($e,Ht=>{e(f)?Ht(ot):Ht(It,!1)},!0)}_(me,oe)};z(j,me=>{e(he),i(()=>e(he).length>1)?me(te):me(ye,!1)})}_(w,Y)},$$slots:{default:!0}});var Sr=b(wr,2);Ma(Sr,{title:"Measure Tool",children:(w,O)=>{var Y=Uh(),j=x(Y),te=x(j),ye=x(te),me=b(j,2);{var oe=J=>{var tt=Fh();_(J,tt)};z(me,J=>{e(Ze)&&J(oe)})}var $e=b(me,2);{var ot=J=>{var tt=Bh(),Rt=ie(tt),Be=b(x(Rt),2),Qe=x(Be),qe=b(Rt,2);H(bt=>Oe(Qe,`${bt??""}"`),[()=>(e(S),i(()=>Gt(e(S).x1,e(S).y1,e(S).x2,e(S).y2).toFixed(2)))]),Z("click",qe,()=>{g(ct,e(ct).filter(bt=>bt.id!==e(Et))),g(Et,null)}),_(J,tt)};z($e,J=>{e(S)&&J(ot)})}var It=b($e,2);{var Ht=J=>{var tt=qh(),Rt=ie(tt),Be=b(x(Rt),2),Qe=x(Be),qe=b(Rt,2);H(()=>Oe(Qe,`${e(ct),i(()=>e(ct).length)??""} line${e(ct),i(()=>e(ct).length!==1?"s":"")??""}`)),Z("click",qe,Je),_(J,tt)};z(It,J=>{e(ct),i(()=>e(ct).length>0)&&J(Ht)})}var Qt=b(It,2),_t=b(x(Qt),2),Se=x(_t),B=b(_t,2),mt=x(B),rt=b(B,2),M=x(rt);Na(ye,()=>e(Ze),J=>g(Ze,J)),Na(Se,()=>e(V),J=>g(V,J)),Na(mt,()=>e(Le),J=>g(Le,J)),Na(M,()=>e(Xe),J=>g(Xe,J)),_(w,Y)},$$slots:{default:!0}});var C=b(Sr,2);Ma(C,{title:"Actions",children:(w,O)=>{var Y=Kh(),j=x(Y),te=x(j),ye=b(te,2),me=b(j,2),oe=x(me),$e=b(oe,2),ot=b(me,2);_s(ot,Se=>g(Lt,Se),()=>e(Lt));var It=b(ot,2),Ht=b(It,2),Qt=b(Ht,2),_t=b(Qt,2);H(()=>{te.disabled=(u(),i(()=>!u().past.length)),ye.disabled=(u(),i(()=>!u().future.length))}),Z("click",te,()=>Tt.undo()),Z("click",ye,()=>Tt.redo()),Z("click",oe,jt),Z("click",$e,Bt),Z("change",ot,wa),Z("click",It,Kt),Z("click",Ht,ft),Z("click",Qt,Ut),Z("click",_t,Ds),_(w,Y)},$$slots:{default:!0}});var X=b(C,2);Ma(X,{title:"Import Army List",startOpen:!1,children:(w,O)=>{_s(Fd(w,{get currentPlayer(){return e(W)},$$events:{parse:Dt},$$legacy:!0}),Y=>g(Q,Y),()=>e(Q))},$$slots:{default:!0}});var ee=b(X,2);Ma(ee,{title:"Add Models",children:(w,O)=>{var Y=Gh(),j=ie(Y),te=x(j);let ye;var me=b(te,2);let oe;var $e=b(j,2),ot=x($e),It=b(x(ot),2);at(It,5,()=>(D(rn),i(()=>rn.circles)),Ct,(_t,Se)=>{Kr(_t,{get baseSize(){return e(Se)},get playerId(){return e(W)},onDragStart:vt})});var Ht=b(ot,2),Qt=b(x(Ht),2);at(Qt,5,()=>(D(rn),i(()=>rn.ovals)),Ct,(_t,Se)=>{Kr(_t,{get baseSize(){return e(Se)},get playerId(){return e(W)},onDragStart:vt})}),H(()=>{ye=Oa(te,1,"toggle-btn svelte-1g40uyy",null,ye,{active:e(W)===1}),oe=Oa(me,1,"toggle-btn svelte-1g40uyy",null,oe,{active:e(W)===2})}),Z("click",te,()=>g(W,1)),Z("click",me,()=>g(W,2)),_(w,Y)},$$slots:{default:!0}});var ge=b(ee,2);Ma(ge,{title:"Add Hull (Vehicle)",children:(w,O)=>{var Y=zh(),j=x(Y),te=b(x(j),2),ye=b(j,2),me=b(x(ye),2),oe=b(ye,2),$e=x(oe);H(()=>Oe($e,`Add ${e(xe)??""}" × ${e(_e)??""}" Hull`)),Fs(te,()=>e(xe),ot=>g(xe,ot)),Fs(me,()=>e(_e),ot=>g(_e,ot)),Z("click",oe,Ge),_(w,Y)},$$slots:{default:!0}});var ke=b(_r,2),nt=x(ke),He=x(nt),ut=x(He);Tr(ut,{children:co,$$slots:{default:(w,O)=>{const Y=Me(()=>O.screenToSvg);var j=gm(),te=ie(j);{var ye=Te=>{var K=Xo();H(()=>Oe(K,(e(fe),D(e(Y)),i(()=>(g(fe,e(Y)),""))))),_(Te,K)};z(te,Te=>{e(Y)&&!e(fe)&&Te(ye)})}var me=b(te);{var oe=Te=>{var K=jh(),St=ie(K);at(St,1,()=>(n(),i(()=>n().zones)),Ct,($,pe)=>{var dt=Xh();H(Ft=>{c(dt,"d",Ft),c(dt,"fill",(e(pe),i(()=>e(pe).color))),c(dt,"stroke",(e(pe),i(()=>e(pe).borderColor)))},[()=>(D(Ss),e(pe),i(()=>Ss(e(pe).path)))]),_($,dt)});var Ke=b(St);at(Ke,1,()=>(n(),i(()=>n().objectives)),Ct,($,pe)=>{const dt=Me(()=>(e(pe),i(()=>e(pe).isPrimary?"#fbbf24":"#9ca3af"))),Ft=Me(()=>(e(pe),i(()=>e(pe).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var Ne=Vh(),Ue=ie(Ne),je=b(Ue),Pa=b(je);H(()=>{c(Ue,"cx",(e(pe),i(()=>e(pe).x))),c(Ue,"cy",(e(pe),i(()=>e(pe).y))),c(Ue,"r",Zr),c(Ue,"fill",e(Ft)),c(Ue,"stroke",e(dt)),c(je,"cx",(e(pe),i(()=>e(pe).x))),c(je,"cy",(e(pe),i(()=>e(pe).y))),c(je,"r",Jr),c(je,"fill",e(dt)),c(Pa,"cx",(e(pe),i(()=>e(pe).x))),c(Pa,"cy",(e(pe),i(()=>e(pe).y)))}),_($,Ne)}),_(Te,K)};z(me,Te=>{n()&&Te(oe)})}var $e=b(me);z($e,Te=>{});var ot=b($e);z(ot,Te=>{});var It=b(ot);at(It,1,()=>(l(),i(()=>l().terrains)),Ct,(Te,K)=>{var St=Jh(),Ke=x(St);H(()=>{c(St,"transform",`rotate(${e(K),i(()=>e(K).rotation)??""}, ${e(K),i(()=>e(K).x+e(K).width/2)??""}, ${e(K),i(()=>e(K).y+e(K).height/2)??""})`),c(Ke,"x",(e(K),i(()=>e(K).x))),c(Ke,"y",(e(K),i(()=>e(K).y))),c(Ke,"width",(e(K),i(()=>e(K).width))),c(Ke,"height",(e(K),i(()=>e(K).height)))}),_(Te,St)});var Ht=b(It);at(Ht,1,()=>(l(),i(()=>l().walls)),Ct,(Te,K)=>{var St=Zh(),Ke=x(St);Mi(Ke,{get id(){return e(K),i(()=>e(K).id)},get x(){return e(K),i(()=>e(K).x)},get y(){return e(K),i(()=>e(K).y)},get shape(){return e(K),i(()=>e(K).shape)},get segments(){return e(K),i(()=>e(K).segments)},get rotation(){return e(K),i(()=>e(K).rotation)},selected:!1,get screenToSvg(){return e(Y)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),_(Te,St)});var Qt=b(Ht);{var _t=Te=>{var K=ze(),St=ie(K);at(St,1,o,Ke=>Ke.id,(Ke,$)=>{const pe=Me(()=>(D(_a),e($),i(()=>_a(e($).baseType,e($))))),dt=Me(()=>(D(ya),e($),i(()=>ya(e($).baseType)))),Ft=Me(()=>(D(Ha),e($),i(()=>Ha(e($).baseType)))),Ne=Me(()=>(e($),i(()=>e($).playerId===1?"rgba(59, 130, 246, 0.15)":"rgba(239, 68, 68, 0.15)"))),Ue=Me(()=>(e($),i(()=>e($).playerId===1?"#3b82f6":"#ef4444")));var je=lm(),Pa=ie(je);{var un=Ua=>{var dn=ze(),Zs=ie(dn);{var Qs=Aa=>{var Ca=Qh(),pa=x(Ca);H(()=>{c(Ca,"transform",`rotate(${e($),i(()=>e($).rotation||0)??""}, ${e($),i(()=>e($).x)??""}, ${e($),i(()=>e($).y)??""})`),c(pa,"x",(e($),i(()=>e($).x-e($).customWidth/2-12))),c(pa,"y",(e($),i(()=>e($).y-e($).customHeight/2-12))),c(pa,"width",(e($),i(()=>e($).customWidth+24))),c(pa,"height",(e($),i(()=>e($).customHeight+24))),c(pa,"fill",e(Ne)),c(pa,"stroke",e(Ue))}),_(Aa,Ca)},er=Aa=>{var Ca=ze(),pa=ie(Ca);{var tr=Ea=>{var ea=em(),Ra=x(ea);H(()=>{c(ea,"transform",`rotate(${e($),i(()=>e($).rotation||0)??""}, ${e($),i(()=>e($).x)??""}, ${e($),i(()=>e($).y)??""})`),c(Ra,"cx",(e($),i(()=>e($).x))),c(Ra,"cy",(e($),i(()=>e($).y))),c(Ra,"rx",(D(e(pe)),i(()=>e(pe).width/2+12))),c(Ra,"ry",(D(e(pe)),i(()=>e(pe).height/2+12))),c(Ra,"fill",e(Ne)),c(Ra,"stroke",e(Ue))}),_(Ea,ea)},ar=Ea=>{var ea=tm();H(()=>{c(ea,"cx",(e($),i(()=>e($).x))),c(ea,"cy",(e($),i(()=>e($).y))),c(ea,"r",(D(e(pe)),i(()=>e(pe).radius+12))),c(ea,"fill",e(Ne)),c(ea,"stroke",e(Ue))}),_(Ea,ea)};z(pa,Ea=>{e(dt)?Ea(tr):Ea(ar,!1)},!0)}_(Aa,Ca)};z(Zs,Aa=>{e(Ft)?Aa(Qs):Aa(er,!1)})}_(Ua,dn)};z(Pa,Ua=>{e(Xe)&&Ua(un)})}var da=b(Pa);{var wt=Ua=>{var dn=ze(),Zs=ie(dn);{var Qs=Aa=>{var Ca=am(),pa=x(Ca);H(()=>{c(Ca,"transform",`rotate(${e($),i(()=>e($).rotation||0)??""}, ${e($),i(()=>e($).x)??""}, ${e($),i(()=>e($).y)??""})`),c(pa,"x",(e($),i(()=>e($).x-e($).customWidth/2-9))),c(pa,"y",(e($),i(()=>e($).y-e($).customHeight/2-9))),c(pa,"width",(e($),i(()=>e($).customWidth+18))),c(pa,"height",(e($),i(()=>e($).customHeight+18))),c(pa,"fill",e(Ne)),c(pa,"stroke",e(Ue))}),_(Aa,Ca)},er=Aa=>{var Ca=ze(),pa=ie(Ca);{var tr=Ea=>{var ea=nm(),Ra=x(ea);H(()=>{c(ea,"transform",`rotate(${e($),i(()=>e($).rotation||0)??""}, ${e($),i(()=>e($).x)??""}, ${e($),i(()=>e($).y)??""})`),c(Ra,"cx",(e($),i(()=>e($).x))),c(Ra,"cy",(e($),i(()=>e($).y))),c(Ra,"rx",(D(e(pe)),i(()=>e(pe).width/2+9))),c(Ra,"ry",(D(e(pe)),i(()=>e(pe).height/2+9))),c(Ra,"fill",e(Ne)),c(Ra,"stroke",e(Ue))}),_(Ea,ea)},ar=Ea=>{var ea=sm();H(()=>{c(ea,"cx",(e($),i(()=>e($).x))),c(ea,"cy",(e($),i(()=>e($).y))),c(ea,"r",(D(e(pe)),i(()=>e(pe).radius+9))),c(ea,"fill",e(Ne)),c(ea,"stroke",e(Ue))}),_(Ea,ea)};z(pa,Ea=>{e(dt)?Ea(tr):Ea(ar,!1)},!0)}_(Aa,Ca)};z(Zs,Aa=>{e(Ft)?Aa(Qs):Aa(er,!1)})}_(Ua,dn)};z(da,Ua=>{e(Le)&&Ua(wt)})}var ba=b(da);{var us=Ua=>{var dn=ze(),Zs=ie(dn);{var Qs=Aa=>{var Ca=rm(),pa=x(Ca);H(()=>{c(Ca,"transform",`rotate(${e($),i(()=>e($).rotation||0)??""}, ${e($),i(()=>e($).x)??""}, ${e($),i(()=>e($).y)??""})`),c(pa,"x",(e($),i(()=>e($).x-e($).customWidth/2-6))),c(pa,"y",(e($),i(()=>e($).y-e($).customHeight/2-6))),c(pa,"width",(e($),i(()=>e($).customWidth+12))),c(pa,"height",(e($),i(()=>e($).customHeight+12))),c(pa,"stroke",e(Ue))}),_(Aa,Ca)},er=Aa=>{var Ca=ze(),pa=ie(Ca);{var tr=Ea=>{var ea=im(),Ra=x(ea);H(()=>{c(ea,"transform",`rotate(${e($),i(()=>e($).rotation||0)??""}, ${e($),i(()=>e($).x)??""}, ${e($),i(()=>e($).y)??""})`),c(Ra,"cx",(e($),i(()=>e($).x))),c(Ra,"cy",(e($),i(()=>e($).y))),c(Ra,"rx",(D(e(pe)),i(()=>e(pe).width/2+6))),c(Ra,"ry",(D(e(pe)),i(()=>e(pe).height/2+6))),c(Ra,"stroke",e(Ue))}),_(Ea,ea)},ar=Ea=>{var ea=om();H(()=>{c(ea,"cx",(e($),i(()=>e($).x))),c(ea,"cy",(e($),i(()=>e($).y))),c(ea,"r",(D(e(pe)),i(()=>e(pe).radius+6))),c(ea,"stroke",e(Ue))}),_(Ea,ea)};z(pa,Ea=>{e(dt)?Ea(tr):Ea(ar,!1)},!0)}_(Aa,Ca)};z(Zs,Aa=>{e(Ft)?Aa(Qs):Aa(er,!1)})}_(Ua,dn)};z(ba,Ua=>{e(V)&&Ua(us)})}_(Ke,je)}),_(Te,K)};z(Qt,Te=>{(e(V)||e(Le)||e(Xe))&&Te(_t)})}var Se=b(Qt);at(Se,1,o,Te=>Te.id,(Te,K)=>{{let St=Me(()=>(e(K),i(()=>e(K).name||""))),Ke=Me(()=>(e(K),i(()=>Xa(e(K).unitId)))),$=Me(()=>(e(he),e(K),i(()=>e(he).includes(e(K).id)))),pe=Me(()=>(e(he),e(K),i(()=>e(he).length>1&&e(he).includes(e(K).id)))),dt=Me(()=>(e(he),e(K),e(kt),i(()=>!e(he).includes(e(K).id)&&e(kt).has(e(K).id))));Ur(Te,{get id(){return e(K),i(()=>e(K).id)},get x(){return e(K),i(()=>e(K).x)},get y(){return e(K),i(()=>e(K).y)},get baseType(){return e(K),i(()=>e(K).baseType)},get playerId(){return e(K),i(()=>e(K).playerId)},get rotation(){return e(K),i(()=>e(K).rotation)},get name(){return e(St)},get customWidth(){return e(K),i(()=>e(K).customWidth)},get customHeight(){return e(K),i(()=>e(K).customHeight)},get unitStrokeColor(){return e(Ke)},get selected(){return e($)},get inGroupSelection(){return e(pe)},get marqueePreview(){return e(dt)},get screenToSvg(){return e(Y)},onSelect:I,onDrag:ht,onDragEnd:Nt,onRotate:Mt,onRotateEnd:xt,onRename:xa})}});var B=b(Se);{var mt=Te=>{Ur(Te,{id:"phantom",get x(){return e(ae),i(()=>e(ae).x)},get y(){return e(ae),i(()=>e(ae).y)},get baseType(){return e(ae),i(()=>e(ae).baseType)},get playerId(){return e(W)},rotation:0,get customWidth(){return e(ae),i(()=>e(ae).customWidth)},get customHeight(){return e(ae),i(()=>e(ae).customHeight)},selected:!1,get screenToSvg(){return e(Y)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};z(B,Te=>{e(ae)&&Te(mt)})}var rt=b(B);{var M=Te=>{var K=cm(),St=ie(K),Ke=b(St),$=b(Ke),pe=b($);H(()=>{c(St,"cx",(e(T),i(()=>e(T).x))),c(St,"cy",(e(T),i(()=>e(T).y))),c(Ke,"x1",(e(T),i(()=>e(T).x))),c(Ke,"y1",(e(T),i(()=>e(T).y))),c(Ke,"x2",e(P)),c(Ke,"y2",e(E)),c($,"cx",e(P)),c($,"cy",e(E)),c(pe,"transform",`translate(${e(P)??""}, ${e(E)??""})`)}),Z("mousedown",$,Rs),_(Te,K)};z(rt,Te=>{e(T),e(h),i(()=>e(T)&&e(h).length>1)&&Te(M)})}var J=b(rt);at(J,1,()=>e(ct),Te=>Te.id,(Te,K)=>{const St=Me(()=>(e(K),i(()=>Gt(e(K).x1,e(K).y1,e(K).x2,e(K).y2)))),Ke=Me(()=>(e(K),i(()=>(e(K).x1+e(K).x2)/2))),$=Me(()=>(e(K),i(()=>(e(K).y1+e(K).y2)/2))),pe=Me(()=>(e(K),e(Et),i(()=>e(K).id===e(Et))));var dt=dm();let Ft;var Ne=x(dt),Ue=b(Ne);{var je=wt=>{var ba=um(),us=ie(ba),Ua=b(us);H(()=>{c(us,"cx",(e(K),i(()=>e(K).x1))),c(us,"cy",(e(K),i(()=>e(K).y1))),c(us,"fill",e(pe)?"#3b82f6":"#f59e0b"),c(Ua,"cx",(e(K),i(()=>e(K).x2))),c(Ua,"cy",(e(K),i(()=>e(K).y2))),c(Ua,"fill",e(pe)?"#3b82f6":"#f59e0b")}),Z("mousedown",us,dn=>Qa(e(K).id,1,dn)),Z("mousedown",Ua,dn=>Qa(e(K).id,2,dn)),_(wt,ba)};z(Ue,wt=>{e(Ze)&&wt(je)})}var Pa=b(Ue),un=b(x(Pa)),da=x(un);H(wt=>{Ft=Oa(dt,0,"measurement-line",null,Ft,{selected:e(pe),"tool-active":e(Ze)}),c(Ne,"x1",(e(K),i(()=>e(K).x1))),c(Ne,"y1",(e(K),i(()=>e(K).y1))),c(Ne,"x2",(e(K),i(()=>e(K).x2))),c(Ne,"y2",(e(K),i(()=>e(K).y2))),c(Ne,"stroke",e(pe)&&e(Ze)?"#3b82f6":"#f59e0b"),c(Ne,"stroke-width",e(pe)&&e(Ze)?.2:.15),c(Ne,"role",e(Ze)?"button":"presentation"),c(Ne,"tabindex",e(Ze)?0:-1),c(Pa,"transform",`translate(${e(Ke)??""}, ${e($)??""})`),c(un,"fill",e(pe)&&e(Ze)?"#3b82f6":"#f59e0b"),Oe(da,`${wt??""}"`)},[()=>(D(e(St)),i(()=>e(St).toFixed(1)))]),Z("click",Ne,wt=>e(Ze)&&Yt(e(K).id,wt)),Z("mousedown",Ne,wt=>e(Ze)?qa(e(K).id,wt):wt.stopPropagation()),_(Te,dt)});var tt=b(J);{var Rt=Te=>{const K=Me(()=>(e(we),e(Ce),i(()=>Gt(e(we).x,e(we).y,e(Ce).x,e(Ce).y)))),St=Me(()=>(e(we),e(Ce),i(()=>(e(we).x+e(Ce).x)/2))),Ke=Me(()=>(e(we),e(Ce),i(()=>(e(we).y+e(Ce).y)/2)));var $=mm(),pe=x($),dt=b(pe),Ft=b(dt),Ne=b(Ft);{var Ue=je=>{var Pa=hm(),un=b(x(Pa)),da=x(un);H(wt=>{c(Pa,"transform",`translate(${e(St)??""}, ${e(Ke)??""})`),Oe(da,`${wt??""}"`)},[()=>(D(e(K)),i(()=>e(K).toFixed(1)))]),_(je,Pa)};z(Ne,je=>{e(K)>.5&&je(Ue)})}H(()=>{c(pe,"x1",(e(we),i(()=>e(we).x))),c(pe,"y1",(e(we),i(()=>e(we).y))),c(pe,"x2",(e(Ce),i(()=>e(Ce).x))),c(pe,"y2",(e(Ce),i(()=>e(Ce).y))),c(dt,"cx",(e(we),i(()=>e(we).x))),c(dt,"cy",(e(we),i(()=>e(we).y))),c(Ft,"cx",(e(Ce),i(()=>e(Ce).x))),c(Ft,"cy",(e(Ce),i(()=>e(Ce).y)))}),_(Te,$)};z(tt,Te=>{e(Pe)&&e(we)&&e(Ce)&&Te(Rt)})}var Be=b(tt);{var Qe=Te=>{var K=ze(),St=ie(K);at(St,1,()=>e(U),Ct,(Ke,$)=>{var pe=ze(),dt=ie(pe);at(dt,1,()=>(e($),i(()=>e($).rays)),Ct,(Ft,Ne)=>{var Ue=fm();H(()=>{c(Ue,"x1",(e(Ne),i(()=>e(Ne).from.x))),c(Ue,"y1",(e(Ne),i(()=>e(Ne).from.y))),c(Ue,"x2",(e(Ne),i(()=>e(Ne).to.x))),c(Ue,"y2",(e(Ne),i(()=>e(Ne).to.y))),c(Ue,"stroke",(e(Ne),i(()=>e(Ne).blocked?"#ff000033":"#00ff0033")))}),_(Ft,Ue)}),_(Ke,pe)}),_(Te,K)};z(Be,Te=>{e(We),e(se),e(h),e(U),i(()=>e(We)&&e(se)&&e(h).length>0&&e(U).length>0)&&Te(Qe)})}var qe=b(Be);{var bt=Te=>{var K=ze(),St=ie(K);at(St,1,()=>e(U),Ct,(Ke,$)=>{var pe=ze(),dt=ie(pe);{var Ft=Ue=>{var je=pm();H(()=>{c(je,"x1",(e($),i(()=>e($).firstClearRay.from.x))),c(je,"y1",(e($),i(()=>e($).firstClearRay.from.y))),c(je,"x2",(e($),i(()=>e($).firstClearRay.to.x))),c(je,"y2",(e($),i(()=>e($).firstClearRay.to.y)))}),_(Ue,je)},Ne=Ue=>{var je=ym();H(()=>{c(je,"x1",(e($),i(()=>e($).source.x))),c(je,"y1",(e($),i(()=>e($).source.y))),c(je,"x2",(e($),i(()=>e($).target.x))),c(je,"y2",(e($),i(()=>e($).target.y)))}),_(Ue,je)};z(dt,Ue=>{e($),i(()=>e($).firstClearRay)?Ue(Ft):Ue(Ne,!1)})}_(Ke,pe)}),_(Te,K)};z(qe,Te=>{e(se),e(h),e(U),i(()=>e(se)&&e(h).length>0&&e(U).length>0)&&Te(bt)})}var Zt=b(qe);{var oa=Te=>{const K=Me(()=>(e(G),e(Fe),i(()=>Math.min(e(G).x,e(Fe).x)))),St=Me(()=>(e(G),e(Fe),i(()=>Math.min(e(G).y,e(Fe).y)))),Ke=Me(()=>(e(Fe),e(G),i(()=>Math.abs(e(Fe).x-e(G).x)))),$=Me(()=>(e(Fe),e(G),i(()=>Math.abs(e(Fe).y-e(G).y))));var pe=vm();H(()=>{c(pe,"x",e(K)),c(pe,"y",e(St)),c(pe,"width",e(Ke)),c(pe,"height",e($))}),_(Te,pe)};z(Zt,Te=>{e(Ve)&&e(G)&&e(Fe)&&Te(oa)})}_(w,j)}}});var gt=b(He,2),ra=x(gt),ua=x(ra),fa=b(Is,2);Kd(fa,{get unmatchedUnits(){return e(Ie)},get show(){return e(De)},set show(w){g(De,w)},$$events:{import:ka,close:()=>{g(De,!1)}},$$legacy:!0}),H(()=>Oe(ua,`Battlefield: 60" x 44" | ${d(),i(()=>d().length)??""} P1 models | ${m(),i(()=>m().length)??""} P2 models`)),Z("mousedown",He,$t),_(t,xr),Za(),p()}var Tm=ve('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">LoS Status</span> <span class="value svelte-hpuhtb"> </span></div>'),xm=ve('<div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Debug Rays</label></div> <!>',1),_m=ve('<span class="value warning svelte-hpuhtb">Unit split into groups</span>'),wm=ve('<span class="value warning svelte-hpuhtb"> </span>'),Sm=ve('<div class="field coherency-warning svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Coherency</span> <!></div>'),km=ve('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Coherency</span> <span class="value ok svelte-hpuhtb">All models in coherency</span></div>'),Am=ve('<button class="svelte-hpuhtb">Group (Ctrl+G)</button>'),Cm=ve('<button class="svelte-hpuhtb">Ungroup (Ctrl+Shift+G)</button>'),Em=ve('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Selected</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Line of Sight</label></div> <!> <!> <!> <!> <button class="danger svelte-hpuhtb"> </button></div>'),Mm=ve('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Rotation</span> <span class="value svelte-hpuhtb"> </span></div>'),Rm=ve('<span class="value warning svelte-hpuhtb">Disconnected from unit</span>'),Dm=ve('<span class="value warning svelte-hpuhtb"> </span>'),Im=ve('<span class="value ok svelte-hpuhtb">In coherency</span>'),Lm=ve('<div><span class="label-text svelte-hpuhtb">Coherency</span> <!></div>'),$m=ve('<div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Debug Rays</label></div>'),Pm=ve('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">LoS Status</span> <span class="value svelte-hpuhtb"> </span></div>'),Nm=ve('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><label for="model-name" class="svelte-hpuhtb">Name</label> <input id="model-name" type="text" class="svelte-hpuhtb"/></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Base Type</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Player</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Position</span> <span class="value svelte-hpuhtb"> </span></div> <!> <!> <div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-hpuhtb">Remove</button></div>'),Om=ve('<p class="hint svelte-hpuhtb">Click a model to select it</p>'),Wm=ve('<p class="hint svelte-hpuhtb">Click and drag on battlefield to draw a measurement line</p>'),Ym=ve('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Length</span> <span class="value svelte-hpuhtb"> </span></div> <button class="danger svelte-hpuhtb">Remove Line</button>',1),Hm=ve('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Lines</span> <span class="value svelte-hpuhtb"> </span></div> <button class="secondary svelte-hpuhtb">Clear All Lines</button>',1),Fm=ve('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Line Tool Active (M)</label></div> <!> <!> <!> <div class="field svelte-hpuhtb" style="margin-top: 0.5rem; border-top: 1px solid #333; padding-top: 0.5rem;"><span class="label-text svelte-hpuhtb">Range Zones</span> <label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show 6" zones</label> <label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show 9" zones</label> <label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show 12" zones</label></div></div>'),Bm=ve('<div class="button-group vertical svelte-hpuhtb"><div class="button-row svelte-hpuhtb"><button title="Undo (Ctrl+Z)" class="svelte-hpuhtb">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-hpuhtb">Redo</button></div> <div class="button-row svelte-hpuhtb"><button title="Export battle state to share" class="svelte-hpuhtb">Export</button> <button title="Import battle state from JSON" class="svelte-hpuhtb">Import</button></div> <input type="file" accept=".json" style="display: none;" class="svelte-hpuhtb"/> <button title="Export battlefield as PNG image" class="svelte-hpuhtb">Export PNG</button> <button class="svelte-hpuhtb">Save to Browser</button> <button class="svelte-hpuhtb">Restore from Browser</button> <button class="secondary svelte-hpuhtb">Clear All Models</button></div>'),qm=ce('<path fill="none" stroke-width="0.15" stroke-dasharray="0.5,0.25" pointer-events="none" class="svelte-hpuhtb"></path>'),Um=ce('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none" class="svelte-hpuhtb"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none" class="svelte-hpuhtb"></circle><circle r="0.15" fill="#000" pointer-events="none" class="svelte-hpuhtb"></circle>',1),Km=ce("<!><!>",1),Gm=ce('<g class="svelte-hpuhtb"><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none" class="svelte-hpuhtb"></rect></g>'),zm=ce('<g opacity="0.5" pointer-events="none" class="svelte-hpuhtb"><!></g>'),Xm=ce('<g class="svelte-hpuhtb"><rect rx="12" ry="12" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4" class="svelte-hpuhtb"></rect></g>'),Vm=ce('<g class="svelte-hpuhtb"><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4" class="svelte-hpuhtb"></ellipse></g>'),jm=ce('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4" class="svelte-hpuhtb"></circle>'),Jm=ce('<g class="svelte-hpuhtb"><rect rx="9" ry="9" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5" class="svelte-hpuhtb"></rect></g>'),Zm=ce('<g class="svelte-hpuhtb"><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5" class="svelte-hpuhtb"></ellipse></g>'),Qm=ce('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5" class="svelte-hpuhtb"></circle>'),ef=ce('<g class="svelte-hpuhtb"><rect rx="6" ry="6" fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7" class="svelte-hpuhtb"></rect></g>'),tf=ce('<g class="svelte-hpuhtb"><ellipse fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7" class="svelte-hpuhtb"></ellipse></g>'),af=ce('<circle fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7" class="svelte-hpuhtb"></circle>'),nf=ce("<!><!><!>",1),sf=ce('<g class="svelte-hpuhtb"><rect rx="1" ry="1" fill="rgba(239, 68, 68, 0.2)" stroke="#ef4444" stroke-width="0.08" stroke-dasharray="0.2,0.1" pointer-events="none" class="engagement-zone svelte-hpuhtb"></rect></g>'),rf=ce('<g class="svelte-hpuhtb"><ellipse fill="rgba(239, 68, 68, 0.2)" stroke="#ef4444" stroke-width="0.08" stroke-dasharray="0.2,0.1" pointer-events="none" class="engagement-zone svelte-hpuhtb"></ellipse></g>'),of=ce('<circle fill="rgba(239, 68, 68, 0.2)" stroke="#ef4444" stroke-width="0.08" stroke-dasharray="0.2,0.1" pointer-events="none" class="engagement-zone svelte-hpuhtb"></circle>'),lf=ce('<circle r="0.4" fill="rgba(147, 51, 234, 0.5)" stroke="#9333ea" stroke-width="0.1" pointer-events="none" class="svelte-hpuhtb"></circle><line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15" pointer-events="none" class="svelte-hpuhtb"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="group-rotate-handle svelte-hpuhtb"></circle><g pointer-events="none" class="svelte-hpuhtb"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08" class="svelte-hpuhtb"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08" class="svelte-hpuhtb"></path></g>',1),cf=ce('<circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint svelte-hpuhtb" role="button" tabindex="0"></circle><circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint svelte-hpuhtb" role="button" tabindex="0"></circle>',1),uf=ce('<g><line stroke-linecap="round" class="svelte-hpuhtb"></line><!><g class="svelte-hpuhtb"><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none" class="svelte-hpuhtb"></rect><text x="0" y="0.35" text-anchor="middle" font-size="0.8" font-weight="bold" pointer-events="none" class="svelte-hpuhtb"> </text></g></g>'),df=ce('<g class="svelte-hpuhtb"><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none" class="svelte-hpuhtb"></rect><text x="0" y="0.35" text-anchor="middle" fill="#f59e0b" font-size="0.8" font-weight="bold" pointer-events="none" class="svelte-hpuhtb"> </text></g>'),hf=ce('<g class="measurement-line drawing svelte-hpuhtb"><line stroke="#f59e0b" stroke-width="0.15" stroke-dasharray="0.3,0.15" stroke-linecap="round" pointer-events="none" class="svelte-hpuhtb"></line><circle r="0.3" fill="#f59e0b" pointer-events="none" class="svelte-hpuhtb"></circle><circle r="0.3" fill="#f59e0b" pointer-events="none" class="svelte-hpuhtb"></circle><!></g>'),mf=ce('<line stroke-width="0.05" pointer-events="none" class="svelte-hpuhtb"></line>'),ff=ce('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none" class="svelte-hpuhtb"></line>'),pf=ce('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none" class="svelte-hpuhtb"></line>'),yf=ce('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none" class="svelte-hpuhtb"></rect>'),vf=ce("<!><!><!><!><!><!><!><!><!><!><!><!><!>",1),gf=ve('<main class="svelte-hpuhtb"><div class="layout svelte-hpuhtb"><div class="sidebar svelte-hpuhtb"><!> <!> <!></div> <div class="main-content svelte-hpuhtb"><div class="battlefield-area svelte-hpuhtb"><div class="battlefield-container svelte-hpuhtb" role="presentation"><!></div> <div class="info svelte-hpuhtb"><p class="svelte-hpuhtb"> </p> <p class="hint svelte-hpuhtb">Drag to select | Ctrl+Click multi-select | Del remove | L LoS | M measure</p></div></div></div></div></main>');function bf(t,a){Ja(a,!1);const n=()=>Xt(Ri,"$loadedTerrain",p),r=()=>Xt(Tt,"$models",p),s=()=>Xt(as,"$selectedDeployment",p),o=()=>Xt(pn,"$selectedLayoutName",p),l=()=>Xt(wn,"$selectedLayoutType",p),u=()=>Xt(Au,"$coherencyStatus",p),d=()=>Xt(Ya,"$history",p),m=()=>Xt(gl,"$player1Models",p),y=()=>Xt(bl,"$player2Models",p),[p,h]=As(),f=N(),v=N(),k=N(),T=N(),A=N(),P=N(),E=N(),S=N(),R=N(),L=N(),q=N(),F=N(),U=N(),W=N(),ae=N(),re=N(),Re=N(),fe=N(),se=N(),We=N(),xe=N();let _e=N(null),De=N(!1),Ie=N(!1),de=N(!1),Q=N(null),Ve=N(null),G=N([]),Fe=N(new Set),he=!1,kt=N(!1),Ot=null,ha=!1,aa=null,Vt=0,ma=null,Ia=N(!1),lt=N(null),ct=N([]),Et=N(null),Pe=N(!1),we=N(null),Ce=N(null),Ze=N(!1),V=N(!1),Le=N(!1),Xe=N(!1);Cs(()=>{window.addEventListener("keydown",ga)}),Qo(()=>{window.removeEventListener("keydown",ga)});async function Pt(){const X=`battle-${new Date().toISOString().slice(0,10)}`;try{await Ii(n().terrains,n().walls,r(),X,s())}catch(ee){alert("Failed to export PNG"),console.error("Export error:",ee)}}const At="warhammer-battle-state";let ft=N();function Ut(){const C={deployment:s()?.name||null,layout:o()||null,layoutType:l()||null,models:r()};localStorage.setItem(At,JSON.stringify(C))}function jt(){const C=localStorage.getItem(At);if(C)try{const X=JSON.parse(C);X.models&&Array.isArray(X.models)&&(Tt.set(X.models),Ya.clear())}catch(X){console.error("Failed to restore battle state:",X)}}function Kt(){const C={version:1,exportedAt:new Date().toISOString(),deployment:s()?{name:s().name,zones:s().zones,objectives:s().objectives}:null,terrain:{layoutName:o(),layoutType:l(),terrains:n().terrains,walls:n().walls},models:r().map(He=>({id:He.id,baseType:He.baseType,playerId:He.playerId,x:He.x,y:He.y,rotation:He.rotation||0,name:He.name||"",customWidth:He.customWidth,customHeight:He.customHeight}))},X=JSON.stringify(C,null,2),ee=new Blob([X],{type:"application/json"}),ge=URL.createObjectURL(ee),ke=document.createElement("a");ke.href=ge;const nt=new Date().toISOString().slice(0,10);ke.download=`battle-${nt}.json`,document.body.appendChild(ke),ke.click(),document.body.removeChild(ke),URL.revokeObjectURL(ge)}function Lt(){e(ft)?.click()}function Bt(C){const X=C.target.files?.[0];if(!X)return;const ee=new FileReader;ee.onload=ge=>{try{const ke=JSON.parse(ge.target.result);ke.models&&Array.isArray(ke.models)&&(Tt.set(ke.models),Ya.clear())}catch(ke){console.error("Failed to parse import file:",ke),alert("Failed to import: Invalid JSON file")}},ee.readAsText(X),C.target.value=""}function wa(){confirm("Clear all models?")&&(Tt.clear(),g(G,[]))}function ga(C){if(C.target.tagName==="INPUT")return;const X=e(G).length>0;if((C.ctrlKey||C.metaKey)&&C.key==="z"&&!C.shiftKey){C.preventDefault(),Tt.undo();return}if((C.ctrlKey||C.metaKey)&&(C.key==="y"||C.shiftKey&&C.key==="z")){C.preventDefault(),Tt.redo();return}if((C.ctrlKey||C.metaKey)&&C.key==="g"&&!C.shiftKey){C.preventDefault(),Ye();return}if((C.ctrlKey||C.metaKey)&&C.shiftKey&&C.key==="G"){C.preventDefault(),Ge();return}if(C.key==="l"||C.key==="L"){C.preventDefault(),g(De,!e(De));return}if(C.key==="m"||C.key==="M"){C.preventDefault(),g(Ze,!e(Ze)),e(Ze)||(g(Pe,!1),g(we,null),g(Ce,null));return}if(C.key==="Delete"||C.key==="Backspace"){if(C.preventDefault(),e(Et)){g(ct,e(ct).filter(ee=>ee.id!==e(Et))),g(Et,null);return}e(G).length>0&&(e(G).forEach(ee=>{Tt.remove(ee)}),g(G,[]));return}if(X&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(C.key)){C.preventDefault();const ee=C.shiftKey?.1:1;let ge=0,ke=0;switch(C.key){case"ArrowUp":ke=-ee;break;case"ArrowDown":ke=ee;break;case"ArrowLeft":ge=-ee;break;case"ArrowRight":ge=ee;break}e(G).forEach(nt=>{const He=r().find(ut=>ut.id===nt);He&&Tt.updateModel(nt,{x:He.x+ge,y:He.y+ke},!1)});return}if(C.key==="Escape"){Jt();return}}function Jt(C){if(he){he=!1;return}g(G,[]),g(Et,null)}function Dt(){return"line-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function ka(C,X,ee,ge){return Math.sqrt((ee-C)**2+(ge-X)**2)}function et(C){if(!e(_e))return;C.preventDefault();const X=e(_e)(C.clientX,C.clientY);g(Pe,!0),g(we,{x:X.x,y:X.y}),g(Ce,{x:X.x,y:X.y}),window.addEventListener("mousemove",it),window.addEventListener("mouseup",pt)}function it(C){if(!e(Pe)||!e(_e))return;const X=e(_e)(C.clientX,C.clientY);g(Ce,{x:X.x,y:X.y})}function pt(C){if(!e(Pe))return;if(ka(e(we).x,e(we).y,e(Ce).x,e(Ce).y)>.5){const ee={id:Dt(),x1:e(we).x,y1:e(we).y,x2:e(Ce).x,y2:e(Ce).y};g(ct,[...e(ct),ee]),g(Et,ee.id),g(G,[])}g(Pe,!1),g(we,null),g(Ce,null),window.removeEventListener("mousemove",it),window.removeEventListener("mouseup",pt)}function Gt(C,X){X?.stopPropagation(),g(Et,C),g(G,[])}let la=!1,sa={x:0,y:0},qt=null,Yt=null;function La(C,X){if(!e(Ze)||!e(_e))return;X.stopPropagation(),X.preventDefault();const ee=e(ct).find(He=>He.id===C);if(!ee)return;la=!0,qt=C,Yt=null,g(Et,C),g(G,[]);const ge=e(_e)(X.clientX,X.clientY),ke=(ee.x1+ee.x2)/2,nt=(ee.y1+ee.y2)/2;sa={x:ge.x-ke,y:ge.y-nt},window.addEventListener("mousemove",Ta),window.addEventListener("mouseup",ca)}function $a(C,X,ee){!e(Ze)||!e(_e)||(ee.stopPropagation(),ee.preventDefault(),la=!0,qt=C,Yt=X,g(Et,C),g(G,[]),window.addEventListener("mousemove",Ta),window.addEventListener("mouseup",ca))}function Ta(C){if(!la||!e(_e)||!qt)return;const X=e(_e)(C.clientX,C.clientY);g(ct,e(ct).map(ee=>{if(ee.id!==qt)return ee;if(Yt===1)return{...ee,x1:X.x,y1:X.y};if(Yt===2)return{...ee,x2:X.x,y2:X.y};{const ge=X.x-sa.x,ke=X.y-sa.y,nt=(ee.x1+ee.x2)/2,He=(ee.y1+ee.y2)/2,ut=ge-nt,gt=ke-He;return{...ee,x1:ee.x1+ut,y1:ee.y1+gt,x2:ee.x2+ut,y2:ee.y2+gt}}}))}function ca(){la=!1,qt=null,Yt=null,window.removeEventListener("mousemove",Ta),window.removeEventListener("mouseup",ca)}function qa(){g(ct,[]),g(Et,null)}function Qa(C){const X=C.target,ee=X.closest(".model-base"),ge=X.closest(".measurement-line");if(ee||ge||!e(_e))return;if(C.preventDefault(),e(Ze)){et(C);return}const ke=e(_e)(C.clientX,C.clientY);g(Q,{x:ke.x,y:ke.y}),g(Ve,{x:ke.x,y:ke.y}),g(de,!0),window.addEventListener("mousemove",vn),window.addEventListener("mouseup",ue)}function vn(C){if(!e(de)||!e(_e))return;const X=e(_e)(C.clientX,C.clientY);g(Ve,{x:X.x,y:X.y});const ee=Math.min(e(Q).x,e(Ve).x),ge=Math.max(e(Q).x,e(Ve).x),ke=Math.min(e(Q).y,e(Ve).y),nt=Math.max(e(Q).y,e(Ve).y),He=new Set;r().forEach(ut=>{ut.x>=ee&&ut.x<=ge&&ut.y>=ke&&ut.y<=nt&&He.add(ut.id)}),g(Fe,He)}function ue(C){if(!e(de))return;const X=Math.min(e(Q).x,e(Ve).x),ee=Math.max(e(Q).x,e(Ve).x),ge=Math.min(e(Q).y,e(Ve).y),ke=Math.max(e(Q).y,e(Ve).y),nt=ee-X,He=ke-ge;if(nt<.5&&He<.5)g(G,[]);else{const ut=[];r().forEach(gt=>{gt.x>=X&&gt.x<=ee&&gt.y>=ge&&gt.y<=ke&&ut.push(gt.id)}),g(G,ut),he=!0}g(de,!1),g(Q,null),g(Ve,null),e(Fe).clear(),g(Fe,e(Fe)),window.removeEventListener("mousemove",vn),window.removeEventListener("mouseup",ue)}function Je(C,X){if(X&&(X.ctrlKey||X.metaKey||X.shiftKey))e(G).includes(C)?g(G,e(G).filter(ee=>ee!==C)):g(G,[...e(G),C]);else{if(e(G).includes(C))return;{const ee=r().find(ge=>ge.id===C);if(ee&&ee.unitId){const ge=r().filter(ke=>ke.unitId===ee.unitId).map(ke=>ke.id);g(G,ge)}else g(G,[C])}}}function $t(C,X,ee){if(e(G).length>1&&e(G).includes(C)){e(kt)||(g(kt,!0),Ot={},e(G).forEach(ke=>{const nt=r().find(He=>He.id===ke);nt&&(Ot[ke]={x:nt.x,y:nt.y})}));const ge=Ot[C];if(ge){const ke=X-ge.x,nt=ee-ge.y;e(G).forEach(He=>{const ut=Ot[He];ut&&Tt.updateModel(He,{x:ut.x+ke,y:ut.y+nt},!0)})}}else e(Ia)||(g(Ia,!0),g(lt,C)),Tt.updateModel(C,{x:X,y:ee},!0)}function Wt(C,X,ee,ge,ke){e(kt)?(e(G).forEach(nt=>{const He=Ot[nt],ut=r().find(gt=>gt.id===nt);He&&ut&&Ya.push({type:"move",modelId:nt,before:{x:He.x,y:He.y},after:{x:ut.x,y:ut.y}})}),g(kt,!1),Ot=null):(Ya.push({type:"move",modelId:C,before:{x:X,y:ee},after:{x:ge,y:ke}}),g(Ia,!1),g(lt,null))}function Ee(C,X){if(e(G).length>1&&e(G).includes(C)){if(!ha){ha=!0;let nt=0,He=0,ut=0;const gt={};e(G).forEach(ra=>{const ua=r().find(fa=>fa.id===ra);ua&&(nt+=ua.x,He+=ua.y,ut++,gt[ra]={x:ua.x,y:ua.y,rotation:ua.rotation||0})}),aa={x:nt/ut,y:He/ut},Ot=gt}const ee=r().find(nt=>nt.id===C),ge=Ot[C];if(!ee||!ge)return;const ke=X-ge.rotation;e(G).forEach(nt=>{const He=Ot[nt];if(He){const ut=He.x-aa.x,gt=He.y-aa.y,ra=ke*Math.PI/180,ua=Math.cos(ra),fa=Math.sin(ra),w=ut*ua-gt*fa,O=ut*fa+gt*ua;Tt.updateModel(nt,{x:aa.x+w,y:aa.y+O,rotation:He.rotation+ke},!0)}})}else Tt.updateModel(C,{rotation:X},!0)}function vt(C,X,ee){ha?(e(G).forEach(ge=>{const ke=Ot[ge],nt=r().find(He=>He.id===ge);ke&&nt&&Ya.push({type:"rotate",modelId:ge,before:{x:ke.x,y:ke.y,rotation:ke.rotation},after:{x:nt.x,y:nt.y,rotation:nt.rotation||0}})}),ha=!1,aa=null,Ot=null):Ya.push({type:"rotate",modelId:C,before:{rotation:X},after:{rotation:ee}})}function st(C,X){Tt.updateModel(C,{name:X})}function Ye(){if(e(G).length<2)return;const C=e(G).map(ee=>r().find(ge=>ge.id===ee)).filter(Boolean);if([...new Set(C.map(ee=>ee.playerId))].length>1){alert("Cannot group models from different players");return}Tt.groupModels(e(G))}function Ge(){if(e(G).length===0)return;const C=e(G).filter(X=>{const ee=r().find(ge=>ge.id===X);return ee&&ee.unitId});C.length>0&&Tt.ungroupModels(C)}function I(C){if(!e(_e)||e(f).length<2)return;C.preventDefault(),C.stopPropagation(),ha=!0,ma={},e(f).forEach(ee=>{ma[ee.id]={x:ee.x,y:ee.y,rotation:ee.rotation||0}});const X=e(_e)(C.clientX,C.clientY);Vt=Math.atan2(X.y-e(E).y,X.x-e(E).x)*180/Math.PI,window.addEventListener("mousemove",ht),window.addEventListener("mouseup",Nt)}function ht(C){if(!ha||!e(_e)||!e(E))return;const X=e(_e)(C.clientX,C.clientY);let ge=Math.atan2(X.y-e(E).y,X.x-e(E).x)*180/Math.PI-Vt;C.shiftKey||(ge=Math.round(ge/15)*15),g(gn,-45+ge);const ke=ge*Math.PI/180,nt=Math.cos(ke),He=Math.sin(ke);e(f).forEach(ut=>{const gt=ma[ut.id];if(gt){const ra=gt.x-e(E).x,ua=gt.y-e(E).y,fa=ra*nt-ua*He,w=ra*He+ua*nt;Tt.updateModel(ut.id,{x:e(E).x+fa,y:e(E).y+w,rotation:gt.rotation+ge},!0)}})}function Nt(){ha&&ma&&e(f).forEach(C=>{const X=ma[C.id];X&&Ya.push({type:"rotate",modelId:C.id,before:{x:X.x,y:X.y,rotation:X.rotation},after:{x:C.x,y:C.y,rotation:C.rotation||0}})}),ha=!1,ma=null,g(gn,-45),window.removeEventListener("mousemove",ht),window.removeEventListener("mouseup",Nt)}function Mt(){e(G).length>0&&(e(G).forEach(C=>{Tt.remove(C)}),g(G,[]))}function xt(C){if(Ha(C.baseType))return{x:C.x,y:C.y,width:C.customWidth,height:C.customHeight,rotation:C.rotation||0,isRectangle:!0};const X=_a(C.baseType,C);return ya(C.baseType)?{x:C.x,y:C.y,rx:X.width/2,ry:X.height/2,rotation:C.rotation||0}:{x:C.x,y:C.y,radius:X.radius}}const xa=["#f97316","#f59e0b","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e","#fb7185","#fdba74","#fcd34d"];function Ms(C){if(!C)return null;let X=0;for(let ge=0;ge<C.length;ge++)X=(X<<5)-X+C.charCodeAt(ge),X=X&X;const ee=Math.abs(X)%xa.length;return xa[ee]}let gn=N(-45);function Rs(C){const X=_a(C.baseType,C);return Ha(C.baseType)?Math.sqrt(C.customWidth*C.customWidth+C.customHeight*C.customHeight)/2:ya(C.baseType)?Math.max(X.width,X.height)/2:X.radius}function bn(C,X){const ee=Rs(C);for(const ge of X){const ke=Rs(ge),nt=C.x-ge.x,He=C.y-ge.y;if(Math.sqrt(nt*nt+He*He)-ee-ke<1)return!0}return!1}le(()=>(e(G),r()),()=>{g(f,e(G).map(C=>r().find(X=>X.id===C)).filter(Boolean))}),le(()=>e(f),()=>{g(v,e(f).length===1?e(f)[0]:null)}),le(()=>e(f),()=>{g(k,e(f).length<2?!1:[...new Set(e(f).map(X=>X.playerId))].length===1)}),le(()=>e(f),()=>{g(T,e(f).some(C=>C.unitId))}),le(()=>(e(f),u()),()=>{g(A,e(f).filter(C=>{const X=u().get(C.id);return X&&!X.inCoherency}))}),le(()=>e(A),()=>{g(P,e(A).length>0)}),le(()=>e(f),()=>{g(E,e(f).length>1?(()=>{let C=0,X=0;return e(f).forEach(ee=>{C+=ee.x,X+=ee.y}),{x:C/e(f).length,y:X/e(f).length}})():null)}),le(()=>(e(f),e(E),ya),()=>{g(S,e(f).length>1?(()=>{let C=0;return e(f).forEach(X=>{const ee=Math.sqrt(Math.pow(X.x-e(E).x,2)+Math.pow(X.y-e(E).y,2)),ge=_a(X.baseType,X),ke=Ha(X.baseType)?Math.max(X.customWidth,X.customHeight)/2:ya(X.baseType)?Math.max(ge.width,ge.height)/2:ge.radius;C=Math.max(C,ee+ke)}),C+2})():0)}),le(()=>(e(E),e(S),e(gn)),()=>{g(R,e(E)?e(E).x+e(S)*Math.cos(e(gn)*Math.PI/180):0)}),le(()=>(e(E),e(S),e(gn)),()=>{g(L,e(E)?e(E).y+e(S)*Math.sin(e(gn)*Math.PI/180):0)}),le(()=>(e(Et),e(ct)),()=>{g(q,e(Et)?e(ct).find(C=>C.id===e(Et)):null)}),le(()=>e(f),()=>{g(F,[...new Set(e(f).map(C=>C.playerId))])}),le(()=>(e(f),r(),e(F)),()=>{g(U,e(f).length>0?r().filter(C=>!e(F).includes(C.playerId)):[])}),le(()=>(e(kt),e(Ia)),()=>{g(W,e(kt)||e(Ia))}),le(()=>(e(W),e(kt),e(f),e(lt),r()),()=>{g(ae,e(W)?e(kt)?e(f):e(lt)?r().filter(C=>C.id===e(lt)):[]:[])}),le(()=>e(ae),()=>{g(re,[...new Set(e(ae).map(C=>C.playerId))])}),le(()=>(e(W),e(re),r()),()=>{g(Re,e(W)&&e(re).length>0?r().filter(C=>!e(re).includes(C.playerId)):[])}),le(()=>(e(W),e(ae),e(Re)),()=>{g(fe,e(W)?new Set(e(ae).filter(C=>bn(C,e(Re))).map(C=>C.id)):new Set)}),le(()=>(n(),ws),()=>{g(se,n().terrains.map(C=>({id:C.id,vertices:ws(C)})))}),le(()=>(n(),Cn),()=>{g(We,n().walls.map(C=>br(Cn(C.shape,C.segments),C.x,C.y,C.rotation)))}),le(()=>(e(f),e(De),e(U),e(se),e(We)),()=>{g(xe,e(f).length>0&&e(De)&&e(U).length>0?(()=>{const C=new Map;e(f).forEach(ge=>{const ke=ge.unitId||`single-${ge.id}`;C.has(ke)||C.set(ke,[]),C.get(ke).push(ge)});const X=new Map;e(U).forEach(ge=>{const ke=ge.unitId||`single-${ge.id}`;X.has(ke)||X.set(ke,[]),X.get(ke).push(ge)});const ee=[];for(const ge of C.values())for(const ke of X.values()){const nt=ke.map(gt=>xt(gt)),He=ge.map(gt=>xt(gt)),ut=sl(nt,He,e(se),e(We));ut.canSee?ke.forEach(gt=>{ge.forEach(ra=>{ee.push({sourceId:gt.id,source:gt,targetId:ra.id,target:ra,canSee:!0,firstClearRay:ut.firstClearResult?.firstClearRay,rays:ut.firstClearResult?.rays||[]})})}):ke.forEach(gt=>{ge.forEach(ra=>{ee.push({sourceId:gt.id,source:gt,targetId:ra.id,target:ra,canSee:!1,firstClearRay:null,rays:[]})})})}return ee})():[])}),$n(),ln();var cn=gf(),en=x(cn),Ds=x(en),cs=x(Ds);Ma(cs,{title:"Selected Model",children:(C,X)=>{var ee=ze(),ge=ie(ee);{var ke=He=>{var ut=Em(),gt=x(ut),ra=b(x(gt),2),ua=x(ra),fa=b(gt,2),w=x(fa),O=x(w),Y=b(fa,2);{var j=_t=>{var Se=xm(),B=ie(Se),mt=x(B),rt=x(mt),M=b(B,2);{var J=tt=>{var Rt=Tm(),Be=b(x(Rt),2),Qe=x(Be);H(qe=>Oe(Qe,`${qe??""}/${e(xe),i(()=>e(xe).length)??""} visible`),[()=>(e(xe),i(()=>e(xe).filter(qe=>qe.canSee).length))]),_(tt,Rt)};z(M,tt=>{e(xe),i(()=>e(xe).length>0)&&tt(J)})}Na(rt,()=>e(Ie),tt=>g(Ie,tt)),_(_t,Se)};z(Y,_t=>{e(De)&&_t(j)})}var te=b(Y,2);{var ye=_t=>{const Se=Me(()=>(e(A),u(),i(()=>e(A).filter(J=>u().get(J.id)?.isDisconnected).length)));var B=Sm(),mt=b(x(B),2);{var rt=J=>{var tt=_m();_(J,tt)},M=J=>{var tt=wm(),Rt=x(tt);H(()=>Oe(Rt,`${e(A),i(()=>e(A).length)??""} model${e(A),i(()=>e(A).length!==1?"s":"")??""} out of coherency`)),_(J,tt)};z(mt,J=>{e(Se)>0?J(rt):J(M,!1)})}_(_t,B)},me=_t=>{var Se=ze(),B=ie(Se);{var mt=rt=>{var M=km();_(rt,M)};z(B,rt=>{e(f),i(()=>e(f).some(M=>M.unitId))&&rt(mt)},!0)}_(_t,Se)};z(te,_t=>{e(P)?_t(ye):_t(me,!1)})}var oe=b(te,2);{var $e=_t=>{var Se=Am();Z("click",Se,Ye),_(_t,Se)};z(oe,_t=>{e(k)&&_t($e)})}var ot=b(oe,2);{var It=_t=>{var Se=Cm();Z("click",Se,Ge),_(_t,Se)};z(ot,_t=>{e(T)&&_t(It)})}var Ht=b(ot,2),Qt=x(Ht);H(()=>{Oe(ua,`${e(G),i(()=>e(G).length)??""} models`),Oe(Qt,`Remove All (${e(G),i(()=>e(G).length)??""})`)}),Na(O,()=>e(De),_t=>g(De,_t)),Z("click",Ht,Mt),_(He,ut)},nt=He=>{var ut=ze(),gt=ie(ut);{var ra=fa=>{var w=Nm(),O=x(w),Y=b(x(O),2),j=b(O,2),te=b(x(j),2),ye=x(te),me=b(j,2),oe=b(x(me),2),$e=x(oe),ot=b(me,2),It=b(x(ot),2),Ht=x(It),Qt=b(ot,2);{var _t=qe=>{var bt=Mm(),Zt=b(x(bt),2),oa=x(Zt);H(Te=>Oe(oa,`${Te??""}°`),[()=>(e(v),i(()=>Math.round(e(v).rotation||0)))]),_(qe,bt)};z(Qt,qe=>{D(ya),e(v),i(()=>ya(e(v).baseType))&&qe(_t)})}var Se=b(Qt,2);{var B=qe=>{const bt=Me(()=>(u(),e(v),i(()=>u().get(e(v).id))));var Zt=Lm();let oa;var Te=b(x(Zt),2);{var K=Ke=>{var $=ze(),pe=ie($);{var dt=Ne=>{var Ue=Rm();_(Ne,Ue)},Ft=Ne=>{var Ue=Dm(),je=x(Ue);H(()=>Oe(je,`Need ${D(e(bt)),i(()=>e(bt).requiredCount)??""} nearby, have ${D(e(bt)),i(()=>e(bt).actualCount)??""}`)),_(Ne,Ue)};z(pe,Ne=>{D(e(bt)),i(()=>e(bt).isDisconnected)?Ne(dt):Ne(Ft,!1)})}_(Ke,$)},St=Ke=>{var $=Im();_(Ke,$)};z(Te,Ke=>{D(e(bt)),i(()=>e(bt)&&!e(bt).inCoherency)?Ke(K):Ke(St,!1)})}H(()=>oa=Oa(Zt,1,"field svelte-hpuhtb",null,oa,{"coherency-warning":e(bt)&&!e(bt).inCoherency})),_(qe,Zt)};z(Se,qe=>{e(v),i(()=>e(v).unitId)&&qe(B)})}var mt=b(Se,2),rt=x(mt),M=x(rt),J=b(mt,2);{var tt=qe=>{var bt=$m(),Zt=x(bt),oa=x(Zt);Na(oa,()=>e(Ie),Te=>g(Ie,Te)),_(qe,bt)};z(J,qe=>{e(De)&&qe(tt)})}var Rt=b(J,2);{var Be=qe=>{var bt=Pm(),Zt=b(x(bt),2),oa=x(Zt);H(Te=>Oe(oa,`${Te??""}/${e(xe),i(()=>e(xe).length)??""} visible`),[()=>(e(xe),i(()=>e(xe).filter(Te=>Te.canSee).length))]),_(qe,bt)};z(Rt,qe=>{e(De),e(xe),i(()=>e(De)&&e(xe).length>0)&&qe(Be)})}var Qe=b(Rt,2);H((qe,bt,Zt)=>{Yn(Y,(e(v),i(()=>e(v).name||""))),Oe(ye,qe),Oe($e,`Player ${e(v),i(()=>e(v).playerId)??""}`),Oe(Ht,`${bt??""}", ${Zt??""}"`)},[()=>(D(_a),e(v),i(()=>_a(e(v).baseType,e(v))?.label||"Unknown")),()=>(e(v),i(()=>e(v).x.toFixed(1))),()=>(e(v),i(()=>e(v).y.toFixed(1)))]),Z("change",Y,qe=>st(e(v).id,qe.target.value)),Na(M,()=>e(De),qe=>g(De,qe)),Z("click",Qe,Mt),_(fa,w)},ua=fa=>{var w=Om();_(fa,w)};z(gt,fa=>{e(v)?fa(ra):fa(ua,!1)},!0)}_(He,ut)};z(ge,He=>{e(G),i(()=>e(G).length>1)?He(ke):He(nt,!1)})}_(C,ee)},$$slots:{default:!0}});var tn=b(cs,2);Ma(tn,{title:"Measure Tool",children:(C,X)=>{var ee=Fm(),ge=x(ee),ke=x(ge),nt=x(ke),He=b(ge,2);{var ut=oe=>{var $e=Wm();_(oe,$e)};z(He,oe=>{e(Ze)&&oe(ut)})}var gt=b(He,2);{var ra=oe=>{var $e=Ym(),ot=ie($e),It=b(x(ot),2),Ht=x(It),Qt=b(ot,2);H(_t=>Oe(Ht,`${_t??""}"`),[()=>(e(q),i(()=>ka(e(q).x1,e(q).y1,e(q).x2,e(q).y2).toFixed(2)))]),Z("click",Qt,()=>{g(ct,e(ct).filter(_t=>_t.id!==e(Et))),g(Et,null)}),_(oe,$e)};z(gt,oe=>{e(q)&&oe(ra)})}var ua=b(gt,2);{var fa=oe=>{var $e=Hm(),ot=ie($e),It=b(x(ot),2),Ht=x(It),Qt=b(ot,2);H(()=>Oe(Ht,`${e(ct),i(()=>e(ct).length)??""} line${e(ct),i(()=>e(ct).length!==1?"s":"")??""}`)),Z("click",Qt,qa),_(oe,$e)};z(ua,oe=>{e(ct),i(()=>e(ct).length>0)&&oe(fa)})}var w=b(ua,2),O=b(x(w),2),Y=x(O),j=b(O,2),te=x(j),ye=b(j,2),me=x(ye);Na(nt,()=>e(Ze),oe=>g(Ze,oe)),Na(Y,()=>e(V),oe=>g(V,oe)),Na(te,()=>e(Le),oe=>g(Le,oe)),Na(me,()=>e(Xe),oe=>g(Xe,oe)),_(C,ee)},$$slots:{default:!0}});var Xa=b(tn,2);Ma(Xa,{title:"Actions",children:(C,X)=>{var ee=Bm(),ge=x(ee),ke=x(ge),nt=b(ke,2),He=b(ge,2),ut=x(He),gt=b(ut,2),ra=b(He,2);_s(ra,Y=>g(ft,Y),()=>e(ft));var ua=b(ra,2),fa=b(ua,2),w=b(fa,2),O=b(w,2);H(()=>{ke.disabled=(d(),i(()=>!d().past.length)),nt.disabled=(d(),i(()=>!d().future.length))}),Z("click",ke,()=>Tt.undo()),Z("click",nt,()=>Tt.redo()),Z("click",ut,Kt),Z("click",gt,Lt),Z("change",ra,Bt),Z("click",ua,Pt),Z("click",fa,Ut),Z("click",w,jt),Z("click",O,wa),_(C,ee)},$$slots:{default:!0}});var Ka=b(Ds,2),xr=x(Ka),Is=x(xr),Qr=x(Is);Tr(Qr,{children:co,$$slots:{default:(C,X)=>{const ee=Me(()=>X.screenToSvg);var ge=vf(),ke=ie(ge);{var nt=Se=>{var B=Xo();H(()=>Oe(B,(e(_e),D(e(ee)),i(()=>(g(_e,e(ee)),""))))),_(Se,B)};z(ke,Se=>{e(ee)&&!e(_e)&&Se(nt)})}var He=b(ke);{var ut=Se=>{var B=Km(),mt=ie(B);at(mt,1,()=>(s(),i(()=>s().zones)),Ct,(M,J)=>{var tt=qm();H(Rt=>{c(tt,"d",Rt),c(tt,"stroke",(e(J),i(()=>e(J).borderColor)))},[()=>(D(Ss),e(J),i(()=>Ss(e(J).path)))]),_(M,tt)});var rt=b(mt);at(rt,1,()=>(s(),i(()=>s().objectives)),Ct,(M,J)=>{const tt=Me(()=>(e(J),i(()=>e(J).isPrimary?"#fbbf24":"#9ca3af"))),Rt=Me(()=>(e(J),i(()=>e(J).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var Be=Um(),Qe=ie(Be),qe=b(Qe),bt=b(qe);H(()=>{c(Qe,"cx",(e(J),i(()=>e(J).x))),c(Qe,"cy",(e(J),i(()=>e(J).y))),c(Qe,"r",Zr),c(Qe,"fill",e(Rt)),c(Qe,"stroke",e(tt)),c(qe,"cx",(e(J),i(()=>e(J).x))),c(qe,"cy",(e(J),i(()=>e(J).y))),c(qe,"r",Jr),c(qe,"fill",e(tt)),c(bt,"cx",(e(J),i(()=>e(J).x))),c(bt,"cy",(e(J),i(()=>e(J).y)))}),_(M,Be)}),_(Se,B)};z(He,Se=>{s()&&Se(ut)})}var gt=b(He);at(gt,1,()=>(n(),i(()=>n().terrains)),Ct,(Se,B)=>{var mt=Gm(),rt=x(mt);H(()=>{c(mt,"transform",`rotate(${e(B),i(()=>e(B).rotation)??""}, ${e(B),i(()=>e(B).x+e(B).width/2)??""}, ${e(B),i(()=>e(B).y+e(B).height/2)??""})`),c(rt,"x",(e(B),i(()=>e(B).x))),c(rt,"y",(e(B),i(()=>e(B).y))),c(rt,"width",(e(B),i(()=>e(B).width))),c(rt,"height",(e(B),i(()=>e(B).height)))}),_(Se,mt)});var ra=b(gt);at(ra,1,()=>(n(),i(()=>n().walls)),Ct,(Se,B)=>{var mt=zm(),rt=x(mt);Mi(rt,{get id(){return e(B),i(()=>e(B).id)},get x(){return e(B),i(()=>e(B).x)},get y(){return e(B),i(()=>e(B).y)},get shape(){return e(B),i(()=>e(B).shape)},get segments(){return e(B),i(()=>e(B).segments)},get rotation(){return e(B),i(()=>e(B).rotation)},selected:!1,get screenToSvg(){return e(ee)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),_(Se,mt)});var ua=b(ra);{var fa=Se=>{var B=ze(),mt=ie(B);at(mt,1,r,rt=>rt.id,(rt,M)=>{const J=Me(()=>(D(_a),e(M),i(()=>_a(e(M).baseType,e(M))))),tt=Me(()=>(D(ya),e(M),i(()=>ya(e(M).baseType)))),Rt=Me(()=>(D(Ha),e(M),i(()=>Ha(e(M).baseType)))),Be=Me(()=>(e(M),i(()=>e(M).playerId===1?"rgba(59, 130, 246, 0.15)":"rgba(239, 68, 68, 0.15)"))),Qe=Me(()=>(e(M),i(()=>e(M).playerId===1?"#3b82f6":"#ef4444")));var qe=nf(),bt=ie(qe);{var Zt=Ke=>{var $=ze(),pe=ie($);{var dt=Ne=>{var Ue=Xm(),je=x(Ue);H(()=>{c(Ue,"transform",`rotate(${e(M),i(()=>e(M).rotation||0)??""}, ${e(M),i(()=>e(M).x)??""}, ${e(M),i(()=>e(M).y)??""})`),c(je,"x",(e(M),i(()=>e(M).x-e(M).customWidth/2-12))),c(je,"y",(e(M),i(()=>e(M).y-e(M).customHeight/2-12))),c(je,"width",(e(M),i(()=>e(M).customWidth+24))),c(je,"height",(e(M),i(()=>e(M).customHeight+24))),c(je,"fill",e(Be)),c(je,"stroke",e(Qe))}),_(Ne,Ue)},Ft=Ne=>{var Ue=ze(),je=ie(Ue);{var Pa=da=>{var wt=Vm(),ba=x(wt);H(()=>{c(wt,"transform",`rotate(${e(M),i(()=>e(M).rotation||0)??""}, ${e(M),i(()=>e(M).x)??""}, ${e(M),i(()=>e(M).y)??""})`),c(ba,"cx",(e(M),i(()=>e(M).x))),c(ba,"cy",(e(M),i(()=>e(M).y))),c(ba,"rx",(D(e(J)),i(()=>e(J).width/2+12))),c(ba,"ry",(D(e(J)),i(()=>e(J).height/2+12))),c(ba,"fill",e(Be)),c(ba,"stroke",e(Qe))}),_(da,wt)},un=da=>{var wt=jm();H(()=>{c(wt,"cx",(e(M),i(()=>e(M).x))),c(wt,"cy",(e(M),i(()=>e(M).y))),c(wt,"r",(D(e(J)),i(()=>e(J).radius+12))),c(wt,"fill",e(Be)),c(wt,"stroke",e(Qe))}),_(da,wt)};z(je,da=>{e(tt)?da(Pa):da(un,!1)},!0)}_(Ne,Ue)};z(pe,Ne=>{e(Rt)?Ne(dt):Ne(Ft,!1)})}_(Ke,$)};z(bt,Ke=>{e(Xe)&&Ke(Zt)})}var oa=b(bt);{var Te=Ke=>{var $=ze(),pe=ie($);{var dt=Ne=>{var Ue=Jm(),je=x(Ue);H(()=>{c(Ue,"transform",`rotate(${e(M),i(()=>e(M).rotation||0)??""}, ${e(M),i(()=>e(M).x)??""}, ${e(M),i(()=>e(M).y)??""})`),c(je,"x",(e(M),i(()=>e(M).x-e(M).customWidth/2-9))),c(je,"y",(e(M),i(()=>e(M).y-e(M).customHeight/2-9))),c(je,"width",(e(M),i(()=>e(M).customWidth+18))),c(je,"height",(e(M),i(()=>e(M).customHeight+18))),c(je,"fill",e(Be)),c(je,"stroke",e(Qe))}),_(Ne,Ue)},Ft=Ne=>{var Ue=ze(),je=ie(Ue);{var Pa=da=>{var wt=Zm(),ba=x(wt);H(()=>{c(wt,"transform",`rotate(${e(M),i(()=>e(M).rotation||0)??""}, ${e(M),i(()=>e(M).x)??""}, ${e(M),i(()=>e(M).y)??""})`),c(ba,"cx",(e(M),i(()=>e(M).x))),c(ba,"cy",(e(M),i(()=>e(M).y))),c(ba,"rx",(D(e(J)),i(()=>e(J).width/2+9))),c(ba,"ry",(D(e(J)),i(()=>e(J).height/2+9))),c(ba,"fill",e(Be)),c(ba,"stroke",e(Qe))}),_(da,wt)},un=da=>{var wt=Qm();H(()=>{c(wt,"cx",(e(M),i(()=>e(M).x))),c(wt,"cy",(e(M),i(()=>e(M).y))),c(wt,"r",(D(e(J)),i(()=>e(J).radius+9))),c(wt,"fill",e(Be)),c(wt,"stroke",e(Qe))}),_(da,wt)};z(je,da=>{e(tt)?da(Pa):da(un,!1)},!0)}_(Ne,Ue)};z(pe,Ne=>{e(Rt)?Ne(dt):Ne(Ft,!1)})}_(Ke,$)};z(oa,Ke=>{e(Le)&&Ke(Te)})}var K=b(oa);{var St=Ke=>{var $=ze(),pe=ie($);{var dt=Ne=>{var Ue=ef(),je=x(Ue);H(()=>{c(Ue,"transform",`rotate(${e(M),i(()=>e(M).rotation||0)??""}, ${e(M),i(()=>e(M).x)??""}, ${e(M),i(()=>e(M).y)??""})`),c(je,"x",(e(M),i(()=>e(M).x-e(M).customWidth/2-6))),c(je,"y",(e(M),i(()=>e(M).y-e(M).customHeight/2-6))),c(je,"width",(e(M),i(()=>e(M).customWidth+12))),c(je,"height",(e(M),i(()=>e(M).customHeight+12))),c(je,"stroke",e(Qe))}),_(Ne,Ue)},Ft=Ne=>{var Ue=ze(),je=ie(Ue);{var Pa=da=>{var wt=tf(),ba=x(wt);H(()=>{c(wt,"transform",`rotate(${e(M),i(()=>e(M).rotation||0)??""}, ${e(M),i(()=>e(M).x)??""}, ${e(M),i(()=>e(M).y)??""})`),c(ba,"cx",(e(M),i(()=>e(M).x))),c(ba,"cy",(e(M),i(()=>e(M).y))),c(ba,"rx",(D(e(J)),i(()=>e(J).width/2+6))),c(ba,"ry",(D(e(J)),i(()=>e(J).height/2+6))),c(ba,"stroke",e(Qe))}),_(da,wt)},un=da=>{var wt=af();H(()=>{c(wt,"cx",(e(M),i(()=>e(M).x))),c(wt,"cy",(e(M),i(()=>e(M).y))),c(wt,"r",(D(e(J)),i(()=>e(J).radius+6))),c(wt,"stroke",e(Qe))}),_(da,wt)};z(je,da=>{e(tt)?da(Pa):da(un,!1)},!0)}_(Ne,Ue)};z(pe,Ne=>{e(Rt)?Ne(dt):Ne(Ft,!1)})}_(Ke,$)};z(K,Ke=>{e(V)&&Ke(St)})}_(rt,qe)}),_(Se,B)};z(ua,Se=>{(e(V)||e(Le)||e(Xe))&&Se(fa)})}var w=b(ua);{var O=Se=>{var B=ze(),mt=ie(B);at(mt,1,()=>e(Re),rt=>rt.id,(rt,M)=>{const J=Me(()=>(D(_a),e(M),i(()=>_a(e(M).baseType,e(M))))),tt=Me(()=>(D(ya),e(M),i(()=>ya(e(M).baseType)))),Rt=Me(()=>(D(Ha),e(M),i(()=>Ha(e(M).baseType))));var Be=ze(),Qe=ie(Be);{var qe=Zt=>{var oa=sf(),Te=x(oa);H(()=>{c(oa,"transform",`rotate(${e(M),i(()=>e(M).rotation||0)??""}, ${e(M),i(()=>e(M).x)??""}, ${e(M),i(()=>e(M).y)??""})`),c(Te,"x",(e(M),i(()=>e(M).x-e(M).customWidth/2-1))),c(Te,"y",(e(M),i(()=>e(M).y-e(M).customHeight/2-1))),c(Te,"width",(e(M),i(()=>e(M).customWidth+2))),c(Te,"height",(e(M),i(()=>e(M).customHeight+2)))}),_(Zt,oa)},bt=Zt=>{var oa=ze(),Te=ie(oa);{var K=Ke=>{var $=rf(),pe=x($);H(()=>{c($,"transform",`rotate(${e(M),i(()=>e(M).rotation||0)??""}, ${e(M),i(()=>e(M).x)??""}, ${e(M),i(()=>e(M).y)??""})`),c(pe,"cx",(e(M),i(()=>e(M).x))),c(pe,"cy",(e(M),i(()=>e(M).y))),c(pe,"rx",(D(e(J)),i(()=>e(J).width/2+1))),c(pe,"ry",(D(e(J)),i(()=>e(J).height/2+1)))}),_(Ke,$)},St=Ke=>{var $=of();H(()=>{c($,"cx",(e(M),i(()=>e(M).x))),c($,"cy",(e(M),i(()=>e(M).y))),c($,"r",(D(e(J)),i(()=>e(J).radius+1)))}),_(Ke,$)};z(Te,Ke=>{e(tt)?Ke(K):Ke(St,!1)},!0)}_(Zt,oa)};z(Qe,Zt=>{e(Rt)?Zt(qe):Zt(bt,!1)})}_(rt,Be)}),_(Se,B)};z(w,Se=>{e(W),e(Re),i(()=>e(W)&&e(Re).length>0)&&Se(O)})}var Y=b(w);at(Y,1,r,Se=>Se.id,(Se,B)=>{const mt=Me(()=>(u(),e(B),i(()=>u().get(e(B).id))));{let rt=Me(()=>(e(B),i(()=>e(B).name||""))),M=Me(()=>(e(B),i(()=>Ms(e(B).unitId)))),J=Me(()=>(D(e(mt)),i(()=>e(mt)?!e(mt).inCoherency:!1))),tt=Me(()=>(e(fe),e(B),i(()=>e(fe).has(e(B).id)))),Rt=Me(()=>(e(G),e(B),i(()=>e(G).includes(e(B).id)))),Be=Me(()=>(e(G),e(B),i(()=>e(G).length>1&&e(G).includes(e(B).id)))),Qe=Me(()=>(e(G),e(B),e(Fe),i(()=>!e(G).includes(e(B).id)&&e(Fe).has(e(B).id))));Ur(Se,{get id(){return e(B),i(()=>e(B).id)},get x(){return e(B),i(()=>e(B).x)},get y(){return e(B),i(()=>e(B).y)},get baseType(){return e(B),i(()=>e(B).baseType)},get playerId(){return e(B),i(()=>e(B).playerId)},get rotation(){return e(B),i(()=>e(B).rotation)},get name(){return e(rt)},get customWidth(){return e(B),i(()=>e(B).customWidth)},get customHeight(){return e(B),i(()=>e(B).customHeight)},get unitStrokeColor(){return e(M)},get coherencyViolation(){return e(J)},get inEngagementRange(){return e(tt)},get selected(){return e(Rt)},get inGroupSelection(){return e(Be)},get marqueePreview(){return e(Qe)},get screenToSvg(){return e(ee)},onSelect:Je,onDrag:$t,onDragEnd:Wt,onRotate:Ee,onRotateEnd:vt,onRename:st})}});var j=b(Y);{var te=Se=>{var B=lf(),mt=ie(B),rt=b(mt),M=b(rt),J=b(M);H(()=>{c(mt,"cx",(e(E),i(()=>e(E).x))),c(mt,"cy",(e(E),i(()=>e(E).y))),c(rt,"x1",(e(E),i(()=>e(E).x))),c(rt,"y1",(e(E),i(()=>e(E).y))),c(rt,"x2",e(R)),c(rt,"y2",e(L)),c(M,"cx",e(R)),c(M,"cy",e(L)),c(J,"transform",`translate(${e(R)??""}, ${e(L)??""})`)}),Z("mousedown",M,I),_(Se,B)};z(j,Se=>{e(E),e(f),i(()=>e(E)&&e(f).length>1)&&Se(te)})}var ye=b(j);at(ye,1,()=>e(ct),Se=>Se.id,(Se,B)=>{const mt=Me(()=>(e(B),i(()=>ka(e(B).x1,e(B).y1,e(B).x2,e(B).y2)))),rt=Me(()=>(e(B),i(()=>(e(B).x1+e(B).x2)/2))),M=Me(()=>(e(B),i(()=>(e(B).y1+e(B).y2)/2))),J=Me(()=>(e(B),e(Et),i(()=>e(B).id===e(Et))));var tt=uf();let Rt;var Be=x(tt),Qe=b(Be);{var qe=Te=>{var K=cf(),St=ie(K),Ke=b(St);H(()=>{c(St,"cx",(e(B),i(()=>e(B).x1))),c(St,"cy",(e(B),i(()=>e(B).y1))),c(St,"fill",e(J)?"#3b82f6":"#f59e0b"),c(Ke,"cx",(e(B),i(()=>e(B).x2))),c(Ke,"cy",(e(B),i(()=>e(B).y2))),c(Ke,"fill",e(J)?"#3b82f6":"#f59e0b")}),Z("mousedown",St,$=>$a(e(B).id,1,$)),Z("mousedown",Ke,$=>$a(e(B).id,2,$)),_(Te,K)};z(Qe,Te=>{e(Ze)&&Te(qe)})}var bt=b(Qe),Zt=b(x(bt)),oa=x(Zt);H(Te=>{Rt=Oa(tt,0,"measurement-line svelte-hpuhtb",null,Rt,{selected:e(J),"tool-active":e(Ze)}),c(Be,"x1",(e(B),i(()=>e(B).x1))),c(Be,"y1",(e(B),i(()=>e(B).y1))),c(Be,"x2",(e(B),i(()=>e(B).x2))),c(Be,"y2",(e(B),i(()=>e(B).y2))),c(Be,"stroke",e(J)&&e(Ze)?"#3b82f6":"#f59e0b"),c(Be,"stroke-width",e(J)&&e(Ze)?.2:.15),c(Be,"role",e(Ze)?"button":"presentation"),c(Be,"tabindex",e(Ze)?0:-1),c(bt,"transform",`translate(${e(rt)??""}, ${e(M)??""})`),c(Zt,"fill",e(J)&&e(Ze)?"#3b82f6":"#f59e0b"),Oe(oa,`${Te??""}"`)},[()=>(D(e(mt)),i(()=>e(mt).toFixed(1)))]),Z("click",Be,Te=>e(Ze)&&Gt(e(B).id,Te)),Z("mousedown",Be,Te=>e(Ze)?La(e(B).id,Te):Te.stopPropagation()),_(Se,tt)});var me=b(ye);{var oe=Se=>{const B=Me(()=>(e(we),e(Ce),i(()=>ka(e(we).x,e(we).y,e(Ce).x,e(Ce).y)))),mt=Me(()=>(e(we),e(Ce),i(()=>(e(we).x+e(Ce).x)/2))),rt=Me(()=>(e(we),e(Ce),i(()=>(e(we).y+e(Ce).y)/2)));var M=hf(),J=x(M),tt=b(J),Rt=b(tt),Be=b(Rt);{var Qe=qe=>{var bt=df(),Zt=b(x(bt)),oa=x(Zt);H(Te=>{c(bt,"transform",`translate(${e(mt)??""}, ${e(rt)??""})`),Oe(oa,`${Te??""}"`)},[()=>(D(e(B)),i(()=>e(B).toFixed(1)))]),_(qe,bt)};z(Be,qe=>{e(B)>.5&&qe(Qe)})}H(()=>{c(J,"x1",(e(we),i(()=>e(we).x))),c(J,"y1",(e(we),i(()=>e(we).y))),c(J,"x2",(e(Ce),i(()=>e(Ce).x))),c(J,"y2",(e(Ce),i(()=>e(Ce).y))),c(tt,"cx",(e(we),i(()=>e(we).x))),c(tt,"cy",(e(we),i(()=>e(we).y))),c(Rt,"cx",(e(Ce),i(()=>e(Ce).x))),c(Rt,"cy",(e(Ce),i(()=>e(Ce).y)))}),_(Se,M)};z(me,Se=>{e(Pe)&&e(we)&&e(Ce)&&Se(oe)})}var $e=b(me);{var ot=Se=>{var B=ze(),mt=ie(B);at(mt,1,()=>e(xe),Ct,(rt,M)=>{var J=ze(),tt=ie(J);at(tt,1,()=>(e(M),i(()=>e(M).rays)),Ct,(Rt,Be)=>{var Qe=mf();H(()=>{c(Qe,"x1",(e(Be),i(()=>e(Be).from.x))),c(Qe,"y1",(e(Be),i(()=>e(Be).from.y))),c(Qe,"x2",(e(Be),i(()=>e(Be).to.x))),c(Qe,"y2",(e(Be),i(()=>e(Be).to.y))),c(Qe,"stroke",(e(Be),i(()=>e(Be).blocked?"#ff000033":"#00ff0033")))}),_(Rt,Qe)}),_(rt,J)}),_(Se,B)};z($e,Se=>{e(Ie),e(De),e(f),e(xe),i(()=>e(Ie)&&e(De)&&e(f).length>0&&e(xe).length>0)&&Se(ot)})}var It=b($e);{var Ht=Se=>{var B=ze(),mt=ie(B);at(mt,1,()=>e(xe),Ct,(rt,M)=>{var J=ze(),tt=ie(J);{var Rt=Qe=>{var qe=ff();H(()=>{c(qe,"x1",(e(M),i(()=>e(M).firstClearRay.from.x))),c(qe,"y1",(e(M),i(()=>e(M).firstClearRay.from.y))),c(qe,"x2",(e(M),i(()=>e(M).firstClearRay.to.x))),c(qe,"y2",(e(M),i(()=>e(M).firstClearRay.to.y)))}),_(Qe,qe)},Be=Qe=>{var qe=pf();H(()=>{c(qe,"x1",(e(M),i(()=>e(M).source.x))),c(qe,"y1",(e(M),i(()=>e(M).source.y))),c(qe,"x2",(e(M),i(()=>e(M).target.x))),c(qe,"y2",(e(M),i(()=>e(M).target.y)))}),_(Qe,qe)};z(tt,Qe=>{e(M),i(()=>e(M).firstClearRay)?Qe(Rt):Qe(Be,!1)})}_(rt,J)}),_(Se,B)};z(It,Se=>{e(De),e(f),e(xe),i(()=>e(De)&&e(f).length>0&&e(xe).length>0)&&Se(Ht)})}var Qt=b(It);{var _t=Se=>{const B=Me(()=>(e(Q),e(Ve),i(()=>Math.min(e(Q).x,e(Ve).x)))),mt=Me(()=>(e(Q),e(Ve),i(()=>Math.min(e(Q).y,e(Ve).y)))),rt=Me(()=>(e(Ve),e(Q),i(()=>Math.abs(e(Ve).x-e(Q).x)))),M=Me(()=>(e(Ve),e(Q),i(()=>Math.abs(e(Ve).y-e(Q).y))));var J=yf();H(()=>{c(J,"x",e(B)),c(J,"y",e(mt)),c(J,"width",e(rt)),c(J,"height",e(M))}),_(Se,J)};z(Qt,Se=>{e(de)&&e(Q)&&e(Ve)&&Se(_t)})}_(C,ge)}}});var _r=b(Is,2),wr=x(_r),Sr=x(wr);H(()=>Oe(Sr,`Battlefield: 60" x 44" | ${m(),i(()=>m().length)??""} P1 models | ${y(),i(()=>y().length)??""} P2 models`)),Z("mousedown",Is,Qa),_(t,cn),Za(),h()}var Tf=ve("<span> </span>"),xf=ve('<span class="los-status svelte-12aohay">No enemies</span>'),_f=ve('<div class="controls svelte-12aohay"><label class="svelte-12aohay"><input type="checkbox" class="svelte-12aohay"/> Show debug rays</label> <!> <button class="export-btn svelte-12aohay">Export PNG</button></div>'),wf=ve('<button class="svelte-12aohay"> </button>'),Sf=ve('<div class="button-group svelte-12aohay"></div>'),kf=ve('<button class="svelte-12aohay"> </button>'),Af=ve('<div class="button-group svelte-12aohay"></div>'),Cf=ve('<div class="player-toggle svelte-12aohay"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-12aohay"><div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Circles</h4> <div class="palette-grid svelte-12aohay"></div></div> <div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Ovals</h4> <div class="palette-grid svelte-12aohay"></div></div></div>',1),Ef=ce('<ellipse stroke-width="0.1"></ellipse>'),Mf=ce('<circle stroke-width="0.1"></circle>'),Rf=ve('<p class="svelte-12aohay"> </p>'),Df=ve('<main class="svelte-12aohay"><div class="layout svelte-12aohay"><div class="sidebar svelte-12aohay"><!> <!> <!> <!></div> <div class="battlefield-area svelte-12aohay"><div class="battlefield-container svelte-12aohay"><!></div> <div class="info svelte-12aohay"><p class="svelte-12aohay"> </p> <!> <p class="hint svelte-12aohay">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function If(t,a){Ja(a,!1);const n=()=>Xt(Qn,"$debugModels",m),r=()=>Xt(es,"$debugSelectedModelId",m),s=()=>Xt(Mr,"$debugTerrains",m),o=()=>Xt(Rr,"$debugWalls",m),l=()=>Xt(Vi,"$debugMode",m),u=()=>Xt(nr,"$debugSelectedTerrainId",m),d=()=>Xt(sr,"$debugSelectedWallId",m),[m,y]=As(),p=N(),h=N(),f=N(),v=N(),k=N();let T=N();function A(V,Le){Mr.add(V,Le)}function P(V){Rr.add(V)}function E(V){nr.set(V),sr.set(null),es.set(null)}function S(V){sr.set(V),nr.set(null),es.set(null)}function R(V,Le,Xe){Mr.updateTerrain(V,{x:Le,y:Xe})}function L(V,Le,Xe){Rr.updateWall(V,{x:Le,y:Xe})}function q(V,Le){Mr.updateTerrain(V,{rotation:Le})}function F(V,Le){Rr.updateWall(V,{rotation:Le})}let U=N(1),W=N(null),ae=!1,re=null;const Re=5;Cs(()=>{if(n().length===0){const V=Qn.add("32mm",1,10,22);Qn.add("32mm",2,50,22),es.set(V)}});function fe(V,Le){if(!e(T))return;ae=!0,re={x:Le.clientX,y:Le.clientY};const Xe=e(T).screenToSvg(Le.clientX,Le.clientY);g(W,{baseType:V.type,x:Xe.x,y:Xe.y}),window.addEventListener("mousemove",se),window.addEventListener("mouseup",We)}function se(V){if(!ae||!e(W)||!e(T))return;const Le=e(T).screenToSvg(V.clientX,V.clientY);g(W,{...e(W),x:Le.x,y:Le.y})}function We(V){if(!ae||!e(W)){ae=!1,g(W,null),re=null,window.removeEventListener("mousemove",se),window.removeEventListener("mouseup",We);return}const Le=V.clientX-re.x,Xe=V.clientY-re.y,Pt=Math.sqrt(Le*Le+Xe*Xe);let At,ft;Pt<Re?(At=30,ft=22):(At=e(W).x,ft=e(W).y);const Ut=Qn.add(e(W).baseType,e(U),At,ft);es.set(Ut),g(W,null),ae=!1,re=null,window.removeEventListener("mousemove",se),window.removeEventListener("mouseup",We)}function xe(V){es.set(V),nr.set(null),sr.set(null)}function _e(V,Le,Xe){Qn.updateModel(V,{x:Le,y:Xe},!0)}function De(V,Le,Xe,Pt,At){mi.push({type:"move",modelId:V,before:{x:Le,y:Xe},after:{x:Pt,y:At}})}function Ie(V,Le){Qn.updateModel(V,{rotation:Le},!0)}function de(V,Le,Xe){mi.push({type:"rotate",modelId:V,before:{rotation:Le},after:{rotation:Xe}})}function Q(V,Le){Qn.updateModel(V,{name:Le})}function Ve(){nr.set(null),sr.set(null),es.set(null)}function G(V){const Le=_a(V.baseType);return ya(V.baseType)?{x:V.x,y:V.y,rx:Le.width/2,ry:Le.height/2,rotation:V.rotation||0}:{x:V.x,y:V.y,radius:Le.radius}}async function Fe(){const Le=`battlefield-debug-${new Date().toISOString().slice(0,10)}`;try{await Ii(s(),o(),n(),Le)}catch(Xe){alert("Failed to export PNG"),console.error("Export error:",Xe)}}le(()=>(n(),r()),()=>{g(p,n().find(V=>V.id===r()))}),le(()=>(e(p),n()),()=>{g(h,e(p)?n().filter(V=>V.playerId!==e(p).playerId):[])}),le(()=>(s(),ws),()=>{g(f,s().map(V=>({id:V.id,vertices:ws(V)})))}),le(()=>(o(),Cn),()=>{g(v,o().map(V=>br(Cn(V.shape,V.segments),V.x,V.y,V.rotation)))}),le(()=>(e(p),e(h),e(f),e(v)),()=>{g(k,e(p)&&e(h).length>0?e(h).map(V=>{const Le=nl(G(V),G(e(p)),e(f),e(v));return{viewerId:V.id,viewer:V,canSee:Le.canSee,firstClearRay:Le.firstClearRay,rays:Le.rays}}):[])}),$n(),ln();var he=Df(),kt=x(he),Ot=x(kt),ha=x(Ot);Ma(ha,{title:"LOS Debug",children:(V,Le)=>{var Xe=_f(),Pt=x(Xe),At=x(Pt),ft=b(Pt,2);{var Ut=Lt=>{var Bt=Tf();let wa;var ga=x(Bt);H((Jt,Dt)=>{wa=Oa(Bt,1,"los-status svelte-12aohay",null,wa,Jt),Oe(ga,`${Dt??""}/${e(k),i(()=>e(k).length)??""} visible`)},[()=>({"can-see":e(k).some(Jt=>Jt.canSee),blocked:!e(k).some(Jt=>Jt.canSee)}),()=>(e(k),i(()=>e(k).filter(Jt=>Jt.canSee).length))]),_(Lt,Bt)},jt=Lt=>{var Bt=xf();_(Lt,Bt)};z(ft,Lt=>{e(p),e(k),i(()=>e(p)&&e(k).length>0)?Lt(Ut):Lt(jt,!1)})}var Kt=b(ft,2);Na(At,l,Lt=>jc(Vi,Lt)),Z("click",Kt,Fe),_(V,Xe)},$$slots:{default:!0}});var aa=b(ha,2);Ma(aa,{title:"Add Terrain",defaultOpen:!1,children:(V,Le)=>{var Xe=Sf();at(Xe,5,()=>ul,Ct,(Pt,At)=>{var ft=wf(),Ut=x(ft);H(()=>Oe(Ut,(e(At),i(()=>e(At).label)))),Z("click",ft,()=>A(e(At).width,e(At).height)),_(Pt,ft)}),_(V,Xe)},$$slots:{default:!0}});var Vt=b(aa,2);Ma(Vt,{title:"Add Wall",defaultOpen:!1,children:(V,Le)=>{var Xe=Af();at(Xe,5,()=>dl,Ct,(Pt,At)=>{var ft=kf(),Ut=x(ft);H(()=>Oe(Ut,(e(At),i(()=>e(At).label)))),Z("click",ft,()=>P(e(At).shape)),_(Pt,ft)}),_(V,Xe)},$$slots:{default:!0}});var ma=b(Vt,2);Ma(ma,{title:"Add Models",defaultOpen:!1,children:(V,Le)=>{var Xe=Cf(),Pt=ie(Xe),At=x(Pt);let ft;var Ut=b(At,2);let jt;var Kt=b(Pt,2),Lt=x(Kt),Bt=b(x(Lt),2);at(Bt,5,()=>(D(rn),i(()=>rn.circles)),Ct,(Jt,Dt)=>{Kr(Jt,{get baseSize(){return e(Dt)},get playerId(){return e(U)},onDragStart:fe})});var wa=b(Lt,2),ga=b(x(wa),2);at(ga,5,()=>(D(rn),i(()=>rn.ovals)),Ct,(Jt,Dt)=>{Kr(Jt,{get baseSize(){return e(Dt)},get playerId(){return e(U)},onDragStart:fe})}),H(()=>{ft=Oa(At,1,"toggle-btn svelte-12aohay",null,ft,{active:e(U)===1}),jt=Oa(Ut,1,"toggle-btn svelte-12aohay",null,jt,{active:e(U)===2})}),Z("click",At,()=>g(U,1)),Z("click",Ut,()=>g(U,2)),_(V,Xe)},$$slots:{default:!0}});var Ia=b(Ot,2),lt=x(Ia),ct=x(lt);_s(Tr(ct,{get terrains(){return s()},get walls(){return o()},get models(){return n()},get losResults(){return e(k)},interactiveTerrain:!0,interactiveWalls:!0,interactiveModels:!0,get showDebugRays(){return l()},get selectedTerrainId(){return u()},get selectedWallId(){return d()},get selectedModelId(){return r()},onTerrainSelect:E,onTerrainDrag:R,onTerrainRotate:q,onWallSelect:S,onWallDrag:L,onWallRotate:F,onModelSelect:xe,onModelDrag:_e,onModelDragEnd:De,onModelRotate:Ie,onModelRotateEnd:de,onModelRename:Q,onBackgroundClick:Ve,children:(V,Le)=>{var Xe=ze(),Pt=ie(Xe);{var At=ft=>{const Ut=Me(()=>(D(_a),e(W),i(()=>_a(e(W).baseType)))),jt=Me(()=>(D(ya),e(W),i(()=>ya(e(W).baseType)))),Kt=Me(()=>(D(fr),e(U),i(()=>fr(e(U)))));var Lt=ze(),Bt=ie(Lt);{var wa=Jt=>{var Dt=Ef();H(()=>{c(Dt,"cx",(e(W),i(()=>e(W).x))),c(Dt,"cy",(e(W),i(()=>e(W).y))),c(Dt,"rx",(D(e(Ut)),i(()=>e(Ut).width/2))),c(Dt,"ry",(D(e(Ut)),i(()=>e(Ut).height/2))),c(Dt,"fill",(D(e(Kt)),i(()=>e(Kt).fillLight))),c(Dt,"stroke",(D(e(Kt)),i(()=>e(Kt).primary)))}),_(Jt,Dt)},ga=Jt=>{var Dt=Mf();H(()=>{c(Dt,"cx",(e(W),i(()=>e(W).x))),c(Dt,"cy",(e(W),i(()=>e(W).y))),c(Dt,"r",(D(e(Ut)),i(()=>e(Ut).radius))),c(Dt,"fill",(D(e(Kt)),i(()=>e(Kt).fillLight))),c(Dt,"stroke",(D(e(Kt)),i(()=>e(Kt).primary)))}),_(Jt,Dt)};z(Bt,Jt=>{e(jt)?Jt(wa):Jt(ga,!1)})}_(ft,Lt)};z(Pt,ft=>{e(W)&&ft(At)})}_(V,Xe)},$$slots:{default:!0},$$legacy:!0}),V=>g(T,V),()=>e(T));var Et=b(lt,2),Pe=x(Et),we=x(Pe),Ce=b(Pe,2);{var Ze=V=>{var Le=Rf(),Xe=x(Le);H(Pt=>Oe(Xe,`Selected model LOS: ${Pt??""}/${e(k),i(()=>e(k).length)??""} visible`),[()=>(e(k),i(()=>e(k).filter(Pt=>Pt.canSee).length))]),_(V,Le)};z(Ce,V=>{l(),e(p),e(k),i(()=>l()&&e(p)&&e(k).length>0)&&V(Ze)})}H(()=>Oe(we,`Battlefield: 60" x 44" | ${s(),i(()=>s().length)??""} terrain | ${o(),i(()=>o().length)??""} walls | ${n(),i(()=>n().length)??""} models`)),_(t,he),Za(),y()}var Lf=ve('<button class="svelte-yk5o9r"> </button>'),$f=ve('<div class="button-group svelte-yk5o9r"></div> <div class="custom-size-section svelte-yk5o9r"><span class="section-label svelte-yk5o9r">Custom Size</span> <div class="dimension-inputs svelte-yk5o9r"><div class="dimension-input svelte-yk5o9r"><label class="svelte-yk5o9r">W</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div> <span class="dimension-separator svelte-yk5o9r">×</span> <div class="dimension-input svelte-yk5o9r"><label class="svelte-yk5o9r">H</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div> <button class="svelte-yk5o9r">Add</button></div></div>',1),Pf=ve('<button class="svelte-yk5o9r"> </button>'),Nf=ve('<div class="button-group svelte-yk5o9r"></div>'),Of=ve('<div class="selected-info svelte-yk5o9r"><div class="field svelte-yk5o9r"><span class="label svelte-yk5o9r">Type</span> <span class="value svelte-yk5o9r">Terrain</span></div> <div class="field svelte-yk5o9r"><span class="label svelte-yk5o9r">Position</span> <span class="value svelte-yk5o9r"> </span></div> <div class="field svelte-yk5o9r"><span class="label svelte-yk5o9r">Rotation</span> <span class="value svelte-yk5o9r"> </span></div> <div class="edit-section svelte-yk5o9r"><span class="section-label svelte-yk5o9r">Dimensions</span> <div class="dimension-inputs svelte-yk5o9r"><div class="dimension-input svelte-yk5o9r"><label class="svelte-yk5o9r">W</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div> <span class="dimension-separator svelte-yk5o9r">×</span> <div class="dimension-input svelte-yk5o9r"><label class="svelte-yk5o9r">H</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div></div></div> <button class="danger svelte-yk5o9r">Delete Terrain</button></div>'),Wf=ve('<div class="segment-inputs svelte-yk5o9r"><div class="segment-input svelte-yk5o9r"><label class="svelte-yk5o9r">Width</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div> <div class="segment-input svelte-yk5o9r"><label class="svelte-yk5o9r">Height</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div></div>'),Yf=ve('<div class="segment-inputs svelte-yk5o9r"><div class="segment-input svelte-yk5o9r"><label class="svelte-yk5o9r">Top</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div> <div class="segment-input svelte-yk5o9r"><label class="svelte-yk5o9r">Height</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div> <div class="segment-input svelte-yk5o9r"><label class="svelte-yk5o9r">Bottom</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div></div>'),Hf=ve('<div class="selected-info svelte-yk5o9r"><div class="field svelte-yk5o9r"><span class="label svelte-yk5o9r">Type</span> <span class="value svelte-yk5o9r"> </span></div> <div class="field svelte-yk5o9r"><span class="label svelte-yk5o9r">Position</span> <span class="value svelte-yk5o9r"> </span></div> <div class="field svelte-yk5o9r"><span class="label svelte-yk5o9r">Rotation</span> <span class="value svelte-yk5o9r"> </span></div> <div class="edit-section svelte-yk5o9r"><span class="section-label svelte-yk5o9r">Segments</span> <!></div> <button class="danger svelte-yk5o9r">Delete Wall</button></div>'),Ff=ve('<p class="hint svelte-yk5o9r">Click terrain or wall to select</p>'),Bf=ve('<div class="saved-layout-item svelte-yk5o9r"><button class="layout-btn svelte-yk5o9r"> <span class="layout-meta svelte-yk5o9r"> </span></button> <button class="delete-btn svelte-yk5o9r" title="Delete">×</button></div>'),qf=ve('<div class="saved-layouts svelte-yk5o9r"><span class="section-label svelte-yk5o9r">Saved Layouts</span> <!></div>'),Uf=ve('<div class="save-section svelte-yk5o9r"><div class="save-row svelte-yk5o9r"><input type="text" placeholder="Layout name..." class="svelte-yk5o9r"/> <button class="svelte-yk5o9r">Save</button></div> <!> <div class="export-section svelte-yk5o9r"><span class="section-label svelte-yk5o9r">File Export/Import</span> <div class="button-row svelte-yk5o9r"><button class="svelte-yk5o9r">Export JSON</button> <button class="svelte-yk5o9r">Import JSON</button></div> <input type="file" accept=".json" style="display: none;"/></div> <button class="secondary svelte-yk5o9r">Clear All</button></div>'),Kf=ve('<main class="svelte-yk5o9r"><div class="layout svelte-yk5o9r"><div class="sidebar svelte-yk5o9r"><!> <!> <!> <!></div> <div class="battlefield-area svelte-yk5o9r"><div class="battlefield-container svelte-yk5o9r"><!></div> <div class="info svelte-yk5o9r"><p class="svelte-yk5o9r"> </p> <p class="hint svelte-yk5o9r">Del to remove | Scroll to zoom | Space+drag to pan | Shift+drag for fine rotation</p></div></div></div></main>');function Gf(t,a){Ja(a,!1);const n=()=>Xt(Nn,"$selectedTerrainId",u),r=()=>Xt(On,"$selectedWallId",u),s=()=>Xt(xn,"$layoutTerrains",u),o=()=>Xt(_n,"$layoutWalls",u),l=()=>Xt(Ei,"$savedLayoutsList",u),[u,d]=As(),m=N(),y=N(),p=N(),h=N();let f=N(),v=N(""),k=N(),T=N(6),A=N(12);Cs(()=>{$r()});function P(Pe,we){xn.add(Pe,we)}function E(){e(T)>0&&e(A)>0&&xn.add(e(T),e(A))}function S(Pe){Nn.set(Pe),On.set(null)}function R(Pe,we,Ce){xn.updateTerrain(Pe,{x:we,y:Ce})}function L(Pe,we){xn.updateTerrain(Pe,{rotation:we})}function q(Pe,we){n()&&we>0&&xn.updateTerrain(n(),{[Pe]:we})}function F(){n()&&(xn.remove(n()),Nn.set(null))}function U(Pe){_n.add(Pe)}function W(Pe){On.set(Pe),Nn.set(null)}function ae(Pe,we,Ce){_n.updateWall(Pe,{x:we,y:Ce})}function re(Pe,we){_n.updateWall(Pe,{rotation:we})}function Re(){r()&&(_n.remove(r()),On.set(null))}function fe(Pe,we){if(r()&&e(y)&&we>0){const Ce=Lr(e(y).shape),V=[...e(y).segments||Ce.segments];V[Pe]=we,_n.updateWall(r(),{segments:V})}}function se(){Nn.set(null),On.set(null)}function We(){confirm("Clear all terrain and walls?")&&(xn.clear(),_n.clear(),Nn.set(null),On.set(null))}function xe(){if(!e(v).trim()){alert("Please enter a layout name");return}pu(e(v).trim()),$r(),g(v,"")}function _e(Pe){yu(Pe),Nn.set(null),On.set(null)}function De(Pe,we){we.stopPropagation(),confirm(`Delete layout "${Pe}"?`)&&(vu(Pe),$r())}function Ie(){const Pe={version:1,exportedAt:new Date().toISOString(),terrains:s(),walls:o()},we=JSON.stringify(Pe,null,2),Ce=new Blob([we],{type:"application/json"}),Ze=URL.createObjectURL(Ce),V=document.createElement("a");V.href=Ze;const Le=new Date().toISOString().slice(0,10);V.download=`layout-${Le}.json`,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL(Ze)}function de(){e(k)?.click()}function Q(Pe){const we=Pe.target.files?.[0];if(!we)return;const Ce=new FileReader;Ce.onload=Ze=>{try{const V=JSON.parse(Ze.target.result);V.terrains&&Array.isArray(V.terrains)&&xn.set(V.terrains),V.walls&&Array.isArray(V.walls)&&_n.set(V.walls),Nn.set(null),On.set(null)}catch(V){console.error("Failed to parse layout file:",V),alert("Failed to import: Invalid JSON file")}},Ce.readAsText(we),Pe.target.value=""}function Ve(Pe){Pe.target.tagName!=="INPUT"&&((Pe.key==="Delete"||Pe.key==="Backspace")&&(Pe.preventDefault(),n()?F():r()&&Re()),Pe.key==="Escape"&&(Nn.set(null),On.set(null)))}le(()=>(s(),n()),()=>{g(m,s().find(Pe=>Pe.id===n()))}),le(()=>(o(),r()),()=>{g(y,o().find(Pe=>Pe.id===r()))}),le(()=>(e(y),Lr),()=>{g(p,e(y)?Lr(e(y).shape):null)}),le(()=>(e(y),e(p)),()=>{g(h,e(y)?.segments||e(p)?.segments||[])}),$n(),ln();var G=Kf();Z("keydown",fs,Ve);var Fe=x(G),he=x(Fe),kt=x(he);Ma(kt,{title:"Add Terrain",children:(Pe,we)=>{var Ce=$f(),Ze=ie(Ce);at(Ze,5,()=>ul,Ct,(jt,Kt)=>{var Lt=Lf(),Bt=x(Lt);H(()=>Oe(Bt,(e(Kt),i(()=>e(Kt).label)))),Z("click",Lt,()=>P(e(Kt).width,e(Kt).height)),_(jt,Lt)});var V=b(Ze,2),Le=b(x(V),2),Xe=x(Le),Pt=b(x(Xe),2),At=b(Xe,4),ft=b(x(At),2),Ut=b(At,2);Fs(Pt,()=>e(T),jt=>g(T,jt)),Fs(ft,()=>e(A),jt=>g(A,jt)),Z("click",Ut,E),_(Pe,Ce)},$$slots:{default:!0}});var Ot=b(kt,2);Ma(Ot,{title:"Add Wall",children:(Pe,we)=>{var Ce=Nf();at(Ce,5,()=>dl,Ct,(Ze,V)=>{var Le=Pf(),Xe=x(Le);H(()=>Oe(Xe,(e(V),i(()=>e(V).label)))),Z("click",Le,()=>U(e(V).shape)),_(Ze,Le)}),_(Pe,Ce)},$$slots:{default:!0}});var ha=b(Ot,2);Ma(ha,{title:"Selected",children:(Pe,we)=>{var Ce=ze(),Ze=ie(Ce);{var V=Xe=>{var Pt=Of(),At=b(x(Pt),2),ft=b(x(At),2),Ut=x(ft),jt=b(At,2),Kt=b(x(jt),2),Lt=x(Kt),Bt=b(jt,2),wa=b(x(Bt),2),ga=x(wa),Jt=b(x(ga),2),Dt=b(ga,4),ka=b(x(Dt),2),et=b(Bt,2);H((it,pt,Gt)=>{Oe(Ut,`${it??""}", ${pt??""}"`),Oe(Lt,`${Gt??""}°`),Yn(Jt,(e(m),i(()=>e(m).width))),Yn(ka,(e(m),i(()=>e(m).height)))},[()=>(e(m),i(()=>e(m).x.toFixed(1))),()=>(e(m),i(()=>e(m).y.toFixed(1))),()=>(e(m),i(()=>Math.round(e(m).rotation||0)))]),Z("change",Jt,it=>q("width",parseFloat(it.target.value))),Z("change",ka,it=>q("height",parseFloat(it.target.value))),Z("click",et,F),_(Xe,Pt)},Le=Xe=>{var Pt=ze(),At=ie(Pt);{var ft=jt=>{var Kt=Hf(),Lt=x(Kt),Bt=b(x(Lt),2),wa=x(Bt),ga=b(Lt,2),Jt=b(x(ga),2),Dt=x(Jt),ka=b(ga,2),et=b(x(ka),2),it=x(et),pt=b(ka,2),Gt=b(x(pt),2);{var la=Yt=>{var La=Wf(),$a=x(La),Ta=b(x($a),2),ca=b($a,2),qa=b(x(ca),2);H(()=>{Yn(Ta,(e(h),i(()=>e(h)[0]))),Yn(qa,(e(h),i(()=>e(h)[1])))}),Z("change",Ta,Qa=>fe(0,parseFloat(Qa.target.value))),Z("change",qa,Qa=>fe(1,parseFloat(Qa.target.value))),_(Yt,La)},sa=Yt=>{var La=ze(),$a=ie(La);{var Ta=ca=>{var qa=Yf(),Qa=x(qa),vn=b(x(Qa),2),ue=b(Qa,2),Je=b(x(ue),2),$t=b(ue,2),Wt=b(x($t),2);H(()=>{Yn(vn,(e(h),i(()=>e(h)[0]))),Yn(Je,(e(h),i(()=>e(h)[1]))),Yn(Wt,(e(h),i(()=>e(h)[2])))}),Z("change",vn,Ee=>fe(0,parseFloat(Ee.target.value))),Z("change",Je,Ee=>fe(1,parseFloat(Ee.target.value))),Z("change",Wt,Ee=>fe(2,parseFloat(Ee.target.value))),_(ca,qa)};z($a,ca=>{e(p),i(()=>e(p)?.type==="C")&&ca(Ta)},!0)}_(Yt,La)};z(Gt,Yt=>{e(p),i(()=>e(p)?.type==="L")?Yt(la):Yt(sa,!1)})}var qt=b(pt,2);H((Yt,La,$a)=>{Oe(wa,`${e(p),i(()=>e(p)?.type)??""}-Wall ${e(p),i(()=>e(p)?.mirrored?"(mirrored)":"")??""}`),Oe(Dt,`${Yt??""}", ${La??""}"`),Oe(it,`${$a??""}°`)},[()=>(e(y),i(()=>e(y).x.toFixed(1))),()=>(e(y),i(()=>e(y).y.toFixed(1))),()=>(e(y),i(()=>Math.round(e(y).rotation||0)))]),Z("click",qt,Re),_(jt,Kt)},Ut=jt=>{var Kt=Ff();_(jt,Kt)};z(At,jt=>{e(y)?jt(ft):jt(Ut,!1)},!0)}_(Xe,Pt)};z(Ze,Xe=>{e(m)?Xe(V):Xe(Le,!1)})}_(Pe,Ce)},$$slots:{default:!0}});var aa=b(ha,2);Ma(aa,{title:"Save & Load",children:(Pe,we)=>{var Ce=Uf(),Ze=x(Ce),V=x(Ze),Le=b(V,2),Xe=b(Ze,2);{var Pt=Bt=>{var wa=qf(),ga=b(x(wa),2);at(ga,1,l,Ct,(Jt,Dt)=>{var ka=Bf(),et=x(ka),it=x(et),pt=b(it),Gt=x(pt),la=b(et,2);H(()=>{Oe(it,`${e(Dt),i(()=>e(Dt).name)??""} `),Oe(Gt,`${e(Dt),i(()=>e(Dt).terrainCount)??""}T ${e(Dt),i(()=>e(Dt).wallCount)??""}W`)}),Z("click",et,()=>_e(e(Dt).name)),Z("click",la,sa=>De(e(Dt).name,sa)),_(Jt,ka)}),_(Bt,wa)};z(Xe,Bt=>{l(),i(()=>l().length>0)&&Bt(Pt)})}var At=b(Xe,2),ft=b(x(At),2),Ut=x(ft),jt=b(Ut,2),Kt=b(ft,2);_s(Kt,Bt=>g(k,Bt),()=>e(k));var Lt=b(At,2);Fs(V,()=>e(v),Bt=>g(v,Bt)),Z("keydown",V,Bt=>Bt.key==="Enter"&&xe()),Z("click",Le,xe),Z("click",Ut,Ie),Z("click",jt,de),Z("change",Kt,Q),Z("click",Lt,We),_(Pe,Ce)},$$slots:{default:!0}});var Vt=b(he,2),ma=x(Vt),Ia=x(ma);_s(Tr(Ia,{get terrains(){return s()},get walls(){return o()},models:[],interactiveTerrain:!0,interactiveWalls:!0,get selectedTerrainId(){return n()},get selectedWallId(){return r()},onTerrainSelect:S,onTerrainDrag:R,onTerrainRotate:L,onWallSelect:W,onWallDrag:ae,onWallRotate:re,onBackgroundClick:se,$$legacy:!0}),Pe=>g(f,Pe),()=>e(f));var lt=b(ma,2),ct=x(lt),Et=x(ct);H(()=>Oe(Et,`Battlefield: 60" × 44" | ${s(),i(()=>s().length)??""} terrain | ${o(),i(()=>o().length)??""} walls`)),_(t,G),Za(),d()}var zf=ve('<div class="app-header svelte-1n46o8q"><h1 class="app-title svelte-1n46o8q">Procinctum</h1> <nav class="nav-links svelte-1n46o8q"><a href="#/setup">Battlefield Setup</a> <a href="#/deployment">Deployment</a> <a href="#/battle">Battle</a> <a href="#/layout">Layout Builder</a></nav></div> <!> <footer class="app-footer svelte-1n46o8q"><span>Built with love by <a href="https://github.com/barkin-aygun/wh40k-deploy" target="_blank" rel="noopener noreferrer" class="svelte-1n46o8q">@Volfied</a></span> <span class="separator svelte-1n46o8q">|</span> <span class="disclaimer svelte-1n46o8q">Warhammer 40,000 and all associated marks, logos, and images are trademarks and/or copyrights of Games Workshop Ltd. This is an unofficial fan project and is not affiliated with or endorsed by Games Workshop.<br/><a href="https://github.com/desjani/40kCompactor" target="_blank" rel="noopener noreferrer" class="svelte-1n46o8q">40KCompactor</a> by Desjani</span></footer>',1);function Xf(t,a){Ja(a,!1);let n=N("main");function r(){const P=window.location.hash;P==="#/debug"?g(n,"debug"):P==="#/setup"?g(n,"setup"):P==="#/deployment"?g(n,"deployment"):P==="#/battle"?g(n,"battle"):P==="#/layout"?g(n,"layout"):g(n,"deployment")}Cs(()=>(r(),window.addEventListener("hashchange",r),()=>window.removeEventListener("hashchange",r))),ln();var s=zf(),o=ie(s),l=b(x(o),2),u=x(l);let d;var m=b(u,2);let y;var p=b(m,2);let h;var f=b(p,2);let v;var k=b(o,2);{var T=P=>{If(P,{})},A=P=>{var E=ze(),S=ie(E);{var R=q=>{Rd(q,{})},L=q=>{var F=ze(),U=ie(F);{var W=re=>{ao(re,{})},ae=re=>{var Re=ze(),fe=ie(Re);{var se=xe=>{bf(xe,{})},We=xe=>{var _e=ze(),De=ie(_e);{var Ie=Q=>{Gf(Q,{})},de=Q=>{ao(Q,{})};z(De,Q=>{e(n)==="layout"?Q(Ie):Q(de,!1)},!0)}_(xe,_e)};z(fe,xe=>{e(n)==="battle"?xe(se):xe(We,!1)},!0)}_(re,Re)};z(U,re=>{e(n)==="deployment"?re(W):re(ae,!1)},!0)}_(q,F)};z(S,q=>{e(n)==="setup"?q(R):q(L,!1)},!0)}_(P,E)};z(k,P=>{e(n)==="debug"?P(T):P(A,!1)})}H(()=>{d=Oa(u,1,"svelte-1n46o8q",null,d,{active:e(n)==="setup"}),y=Oa(m,1,"svelte-1n46o8q",null,y,{active:e(n)==="deployment"}),h=Oa(p,1,"svelte-1n46o8q",null,h,{active:e(n)==="battle"}),v=Oa(f,1,"svelte-1n46o8q",null,v,{active:e(n)==="layout"})}),_(t,s),Za()}Pc(Xf,{target:document.getElementById("app")});
//# sourceMappingURL=index-rdrmaNY0.js.map
