(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=a(s);fetch(s.href,i)}})();const Vr=!1;var ir=Array.isArray,hl=Array.prototype.indexOf,Ir=Array.from,Zi=Object.defineProperty,hs=Object.getOwnPropertyDescriptor,Qi=Object.getOwnPropertyDescriptors,fl=Object.prototype,pl=Array.prototype,li=Object.getPrototypeOf,Ei=Object.isExtensible;const Ja=()=>{};function yl(t){return t()}function wr(t){for(var n=0;n<t.length;n++)t[n]()}function Ji(){var t,n,a=new Promise((r,s)=>{t=r,n=s});return{promise:a,resolve:t,reject:n}}const _n=2,Sr=4,or=8,eo=1<<24,Ua=16,Ka=32,_s=64,ci=128,sa=512,xn=1024,$n=2048,ka=4096,jn=8192,Wa=16384,ui=32768,Ps=65536,ki=1<<17,to=1<<18,Fs=1<<19,no=1<<20,Oa=1<<25,gs=32768,jr=1<<21,mi=1<<22,es=1<<23,Ya=Symbol("$state"),vl=Symbol("legacy props"),gl=Symbol(""),Rs=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function $r(){throw new Error("https://svelte.dev/e/invalid_default_snippet")}function di(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function bl(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Tl(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function xl(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function _l(t){throw new Error("https://svelte.dev/e/effect_orphan")}function wl(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Sl(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function Al(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Cl(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function El(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function kl(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Ml=1,Rl=2,ao=4,Ll=8,Dl=16,Il=1,$l=2,Pl=4,Nl=8,Ol=16,so=1,Wl=2,gn=Symbol(),Yl="http://www.w3.org/1999/xhtml";function Hl(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Fl(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function ro(t){return t===this.v}function io(t,n){return t!=t?n==n:t!==n||t!==null&&typeof t=="object"||typeof t=="function"}function oo(t){return!io(t,this.v)}let Bs=!1,Bl=!1;function ql(){Bs=!0}let Xt=null;function Ns(t){Xt=t}function Hn(t,n=!1,a){Xt={p:Xt,i:!1,c:null,e:null,s:t,x:null,l:Bs&&!n?{s:null,u:null,$:[]}:null}}function Fn(t){var n=Xt,a=n.e;if(a!==null){n.e=null;for(var r of a)Ao(r)}return t!==void 0&&(n.x=t),n.i=!0,Xt=n.p,t??{}}function lr(){return!Bs||Xt!==null&&Xt.l===null}let ds=[];function lo(){var t=ds;ds=[],wr(t)}function qs(t){if(ds.length===0&&!er){var n=ds;queueMicrotask(()=>{n===ds&&lo()})}ds.push(t)}function Ul(){for(;ds.length>0;)lo()}function co(t){var n=Nt;if(n===null)return wt.f|=es,t;if((n.f&ui)===0){if((n.f&ci)===0)throw t;n.b.error(t)}else Os(t,n)}function Os(t,n){for(;n!==null;){if((n.f&ci)!==0)try{n.b.error(t);return}catch(a){t=a}n=n.parent}throw t}const Kl=-7169;function mn(t,n){t.f=t.f&Kl|n}function hi(t){(t.f&sa)!==0||t.deps===null?mn(t,xn):mn(t,ka)}function uo(t){if(t!==null)for(const n of t)(n.f&_n)===0||(n.f&gs)===0||(n.f^=gs,uo(n.deps))}function mo(t,n,a){(t.f&$n)!==0?n.add(t):(t.f&ka)!==0&&a.add(t),uo(t.deps),mn(t,xn)}const hr=new Set;let Lt=null,Js=null,ua=null,na=[],Pr=null,Zr=!1,er=!1;class Aa{committed=!1;current=new Map;previous=new Map;#t=new Set;#i=new Set;#e=0;#s=0;#r=null;#a=new Set;#n=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#s>0}process(n){na=[],Js=null,this.apply();var a=[],r=[];for(const s of n)this.#o(s,a,r);this.is_fork||this.#c(),this.is_deferred()?(this.#l(r),this.#l(a)):(Js=this,Lt=null,Mi(r),Mi(a),Js=null,this.#r?.resolve()),ua=null}#o(n,a,r){n.f^=xn;for(var s=n.first,i=null;s!==null;){var o=s.f,l=(o&(Ka|_s))!==0,m=l&&(o&xn)!==0,h=m||(o&jn)!==0||this.skipped_effects.has(s);if(!h&&s.fn!==null){l?s.f^=xn:i!==null&&(o&(Sr|or|eo))!==0?i.b.defer_effect(s):(o&Sr)!==0?a.push(s):Ks(s)&&((o&Ua)!==0&&this.#a.add(s),Ws(s));var d=s.first;if(d!==null){s=d;continue}}var p=s.parent;for(s=s.next;s===null&&p!==null;)p===i&&(i=null),s=p.next,p=p.parent}}#l(n){for(var a=0;a<n.length;a+=1)mo(n[a],this.#a,this.#n)}capture(n,a){a!==gn&&!this.previous.has(n)&&this.previous.set(n,a),(n.f&es)===0&&(this.current.set(n,n.v),ua?.set(n,n.v))}activate(){Lt=this,this.apply()}deactivate(){Lt===this&&(Lt=null,ua=null)}flush(){if(this.activate(),na.length>0){if(ho(),Lt!==null&&Lt!==this)return}else this.#e===0&&this.process([]);this.deactivate()}discard(){for(const n of this.#i)n(this);this.#i.clear()}#c(){if(this.#s===0){for(const n of this.#t)n();this.#t.clear()}this.#e===0&&this.#u()}#u(){if(hr.size>1){this.previous.clear();var n=ua,a=!0;for(const s of hr){if(s===this){a=!1;continue}const i=[];for(const[l,m]of this.current){if(s.current.has(l))if(a&&m!==s.current.get(l))s.current.set(l,m);else continue;i.push(l)}if(i.length===0)continue;const o=[...s.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var r=na;na=[];const l=new Set,m=new Map;for(const h of i)fo(h,o,l,m);if(na.length>0){Lt=s,s.apply();for(const h of na)s.#o(h,[],[]);s.deactivate()}na=r}}Lt=null,ua=n}this.committed=!0,hr.delete(this)}increment(n){this.#e+=1,n&&(this.#s+=1)}decrement(n){this.#e-=1,n&&(this.#s-=1),this.revive()}revive(){for(const n of this.#a)this.#n.delete(n),mn(n,$n),Ba(n);for(const n of this.#n)mn(n,ka),Ba(n);this.flush()}oncommit(n){this.#t.add(n)}ondiscard(n){this.#i.add(n)}settled(){return(this.#r??=Ji()).promise}static ensure(){if(Lt===null){const n=Lt=new Aa;hr.add(Lt),er||Aa.enqueue(()=>{Lt===n&&n.flush()})}return Lt}static enqueue(n){qs(n)}apply(){}}function Gl(t){var n=er;er=!0;try{for(var a;;){if(Ul(),na.length===0&&(Lt?.flush(),na.length===0))return Pr=null,a;ho()}}finally{er=n}}function ho(){var t=ps;Zr=!0;var n=null;try{var a=0;for(Cr(!0);na.length>0;){var r=Aa.ensure();if(a++>1e3){var s,i;zl()}r.process(na),ts.clear()}}finally{Zr=!1,Cr(t),Pr=null}}function zl(){try{wl()}catch(t){Os(t,Pr)}}let Ia=null;function Mi(t){var n=t.length;if(n!==0){for(var a=0;a<n;){var r=t[a++];if((r.f&(Wa|jn))===0&&Ks(r)&&(Ia=new Set,Ws(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?Mo(r):r.fn=null),Ia?.size>0)){ts.clear();for(const s of Ia){if((s.f&(Wa|jn))!==0)continue;const i=[s];let o=s.parent;for(;o!==null;)Ia.has(o)&&(Ia.delete(o),i.push(o)),o=o.parent;for(let l=i.length-1;l>=0;l--){const m=i[l];(m.f&(Wa|jn))===0&&Ws(m)}}Ia.clear()}}Ia=null}}function fo(t,n,a,r){if(!a.has(t)&&(a.add(t),t.reactions!==null))for(const s of t.reactions){const i=s.f;(i&_n)!==0?fo(s,n,a,r):(i&(mi|Ua))!==0&&(i&$n)===0&&po(s,n,r)&&(mn(s,$n),Ba(s))}}function po(t,n,a){const r=a.get(t);if(r!==void 0)return r;if(t.deps!==null)for(const s of t.deps){if(n.includes(s))return!0;if((s.f&_n)!==0&&po(s,n,a))return a.set(s,!0),!0}return a.set(t,!1),!1}function Ba(t){for(var n=Pr=t;n.parent!==null;){n=n.parent;var a=n.f;if(Zr&&n===Nt&&(a&Ua)!==0&&(a&to)===0)return;if((a&(_s|Ka))!==0){if((a&xn)===0)return;n.f^=xn}}na.push(n)}function Xl(t){let n=0,a=bs(0),r;return()=>{yi()&&(e(a),Us(()=>(n===0&&(r=c(()=>t(()=>tr(a)))),n+=1,()=>{qs(()=>{n-=1,n===0&&(r?.(),r=void 0,tr(a))})})))}}var Vl=Ps|Fs|ci;function jl(t,n,a){new Zl(t,n,a)}class Zl{parent;is_pending=!1;#t;#i=null;#e;#s;#r;#a=null;#n=null;#o=null;#l=null;#c=null;#u=0;#m=0;#h=!1;#f=new Set;#p=new Set;#d=null;#T=Xl(()=>(this.#d=bs(this.#u),()=>{this.#d=null}));constructor(n,a,r){this.#t=n,this.#e=a,this.#s=r,this.parent=Nt.b,this.is_pending=!!this.#e.pending,this.#r=vi(()=>{Nt.b=this;{var s=this.#g();try{this.#a=aa(()=>r(s))}catch(i){this.error(i)}this.#m>0?this.#v():this.is_pending=!1}return()=>{this.#c?.remove()}},Vl)}#x(){try{this.#a=aa(()=>this.#s(this.#t))}catch(n){this.error(n)}}#_(){const n=this.#e.pending;n&&(this.#n=aa(()=>n(this.#t)),Aa.enqueue(()=>{var a=this.#g();this.#a=this.#y(()=>(Aa.ensure(),aa(()=>this.#s(a)))),this.#m>0?this.#v():(fs(this.#n,()=>{this.#n=null}),this.is_pending=!1)}))}#g(){var n=this.#t;return this.is_pending&&(this.#c=Ha(),this.#t.before(this.#c),n=this.#c),n}defer_effect(n){mo(n,this.#f,this.#p)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#e.pending}#y(n){var a=Nt,r=wt,s=Xt;Ea(this.#r),Wn(this.#r),Ns(this.#r.ctx);try{return n()}catch(i){return co(i),null}finally{Ea(a),Wn(r),Ns(s)}}#v(){const n=this.#e.pending;this.#a!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#c),Do(this.#a,this.#l)),this.#n===null&&(this.#n=aa(()=>n(this.#t)))}#b(n){if(!this.has_pending_snippet()){this.parent&&this.parent.#b(n);return}if(this.#m+=n,this.#m===0){this.is_pending=!1;for(const a of this.#f)mn(a,$n),Ba(a);for(const a of this.#p)mn(a,ka),Ba(a);this.#f.clear(),this.#p.clear(),this.#n&&fs(this.#n,()=>{this.#n=null}),this.#l&&(this.#t.before(this.#l),this.#l=null)}}update_pending_count(n){this.#b(n),this.#u+=n,this.#d&&Ts(this.#d,this.#u)}get_effect_pending(){return this.#T(),e(this.#d)}error(n){var a=this.#e.onerror;let r=this.#e.failed;if(this.#h||!a&&!r)throw n;this.#a&&(Yn(this.#a),this.#a=null),this.#n&&(Yn(this.#n),this.#n=null),this.#o&&(Yn(this.#o),this.#o=null);var s=!1,i=!1;const o=()=>{if(s){Fl();return}s=!0,i&&kl(),Aa.ensure(),this.#u=0,this.#o!==null&&fs(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#a=this.#y(()=>(this.#h=!1,aa(()=>this.#s(this.#t)))),this.#m>0?this.#v():this.is_pending=!1};var l=wt;try{Wn(null),i=!0,a?.(n,o),i=!1}catch(m){Os(m,this.#r&&this.#r.parent)}finally{Wn(l)}r&&qs(()=>{this.#o=this.#y(()=>{Aa.ensure(),this.#h=!0;try{return aa(()=>{r(this.#t,()=>n,()=>o)})}catch(m){return Os(m,this.#r.parent),null}finally{this.#h=!1}})})}}function Ql(t,n,a,r){const s=lr()?Nr:Ie;if(a.length===0&&t.length===0){r(n.map(s));return}var i=Lt,o=Nt,l=Jl();function m(){Promise.all(a.map(h=>ec(h))).then(h=>{l();try{r([...n.map(s),...h])}catch(d){(o.f&Wa)===0&&Os(d,o)}i?.deactivate(),Ar()}).catch(h=>{Os(h,o)})}t.length>0?Promise.all(t).then(()=>{l();try{return m()}finally{i?.deactivate(),Ar()}}):m()}function Jl(){var t=Nt,n=wt,a=Xt,r=Lt;return function(i=!0){Ea(t),Wn(n),Ns(a),i&&r?.activate()}}function Ar(){Ea(null),Wn(null),Ns(null)}function Nr(t){var n=_n|$n,a=wt!==null&&(wt.f&_n)!==0?wt:null;return Nt!==null&&(Nt.f|=Fs),{ctx:Xt,deps:null,effects:null,equals:ro,f:n,fn:t,reactions:null,rv:0,v:gn,wv:0,parent:a??Nt,ac:null}}function ec(t,n,a){let r=Nt;r===null&&bl();var s=r.b,i=void 0,o=bs(gn),l=!wt,m=new Map;return uc(()=>{var h=Ji();i=h.promise;try{Promise.resolve(t()).then(h.resolve,h.reject).then(()=>{d===Lt&&d.committed&&d.deactivate(),Ar()})}catch(y){h.reject(y),Ar()}var d=Lt;if(l){var p=s.is_rendered();s.update_pending_count(1),d.increment(p),m.get(d)?.reject(Rs),m.delete(d),m.set(d,h)}const u=(y,g=void 0)=>{if(d.activate(),g)g!==Rs&&(o.f|=es,Ts(o,g));else{(o.f&es)!==0&&(o.f^=es),Ts(o,y);for(const[_,T]of m){if(m.delete(_),_===d)break;T.reject(Rs)}}l&&(s.update_pending_count(-1),d.decrement(p))};h.promise.then(u,y=>u(null,y||"unknown"))}),ur(()=>{for(const h of m.values())h.reject(Rs)}),new Promise(h=>{function d(p){function u(){p===i?h(o):d(i)}p.then(u,u)}d(i)})}function Ie(t){const n=Nr(t);return n.equals=oo,n}function yo(t){var n=t.effects;if(n!==null){t.effects=null;for(var a=0;a<n.length;a+=1)Yn(n[a])}}function tc(t){for(var n=t.parent;n!==null;){if((n.f&_n)===0)return(n.f&Wa)===0?n:null;n=n.parent}return null}function fi(t){var n,a=Nt;Ea(tc(t));try{t.f&=~gs,yo(t),n=Oo(t)}finally{Ea(a)}return n}function vo(t){var n=fi(t);if(!t.equals(n)&&(t.wv=Po(),(!Lt?.is_fork||t.deps===null)&&(t.v=n,t.deps===null))){mn(t,xn);return}as||(ua!==null?(yi()||Lt?.is_fork)&&ua.set(t,n):hi(t))}let Qr=new Set;const ts=new Map;let go=!1;function bs(t,n){var a={f:0,v:t,reactions:null,equals:ro,rv:0,wv:0};return a}function Xa(t,n){const a=bs(t);return fc(a),a}function N(t,n=!1,a=!0){const r=bs(t);return n||(r.equals=oo),Bs&&a&&Xt!==null&&Xt.l!==null&&(Xt.l.s??=[]).push(r),r}function Ur(t,n){return v(t,c(()=>e(t))),n}function v(t,n,a=!1){wt!==null&&(!ma||(wt.f&ki)!==0)&&lr()&&(wt.f&(_n|Ua|mi|ki))!==0&&!Fa?.includes(t)&&El();let r=a?Ls(n):n;return Ts(t,r)}function Ts(t,n){if(!t.equals(n)){var a=t.v;as?ts.set(t,n):ts.set(t,a),t.v=n;var r=Aa.ensure();if(r.capture(t,a),(t.f&_n)!==0){const s=t;(t.f&$n)!==0&&fi(s),hi(s)}t.wv=Po(),bo(t,$n),lr()&&Nt!==null&&(Nt.f&xn)!==0&&(Nt.f&(Ka|_s))===0&&(ta===null?pc([t]):ta.push(t)),!r.is_fork&&Qr.size>0&&!go&&nc()}return n}function nc(){go=!1;var t=ps;Cr(!0);const n=Array.from(Qr);try{for(const a of n)(a.f&xn)!==0&&mn(a,ka),Ks(a)&&Ws(a)}finally{Cr(t)}Qr.clear()}function tr(t){v(t,t.v+1)}function bo(t,n){var a=t.reactions;if(a!==null)for(var r=lr(),s=a.length,i=0;i<s;i++){var o=a[i],l=o.f;if(!(!r&&o===Nt)){var m=(l&$n)===0;if(m&&mn(o,n),(l&_n)!==0){var h=o;ua?.delete(h),(l&gs)===0&&(l&sa&&(o.f|=gs),bo(h,ka))}else m&&((l&Ua)!==0&&Ia!==null&&Ia.add(o),Ba(o))}}}function Ls(t){if(typeof t!="object"||t===null||Ya in t)return t;const n=li(t);if(n!==fl&&n!==pl)return t;var a=new Map,r=ir(t),s=Xa(0),i=ys,o=l=>{if(ys===i)return l();var m=wt,h=ys;Wn(null),Ii(i);var d=l();return Wn(m),Ii(h),d};return r&&a.set("length",Xa(t.length)),new Proxy(t,{defineProperty(l,m,h){(!("value"in h)||h.configurable===!1||h.enumerable===!1||h.writable===!1)&&Al();var d=a.get(m);return d===void 0?d=o(()=>{var p=Xa(h.value);return a.set(m,p),p}):v(d,h.value,!0),!0},deleteProperty(l,m){var h=a.get(m);if(h===void 0){if(m in l){const d=o(()=>Xa(gn));a.set(m,d),tr(s)}}else v(h,gn),tr(s);return!0},get(l,m,h){if(m===Ya)return t;var d=a.get(m),p=m in l;if(d===void 0&&(!p||hs(l,m)?.writable)&&(d=o(()=>{var y=Ls(p?l[m]:gn),g=Xa(y);return g}),a.set(m,d)),d!==void 0){var u=e(d);return u===gn?void 0:u}return Reflect.get(l,m,h)},getOwnPropertyDescriptor(l,m){var h=Reflect.getOwnPropertyDescriptor(l,m);if(h&&"value"in h){var d=a.get(m);d&&(h.value=e(d))}else if(h===void 0){var p=a.get(m),u=p?.v;if(p!==void 0&&u!==gn)return{enumerable:!0,configurable:!0,value:u,writable:!0}}return h},has(l,m){if(m===Ya)return!0;var h=a.get(m),d=h!==void 0&&h.v!==gn||Reflect.has(l,m);if(h!==void 0||Nt!==null&&(!d||hs(l,m)?.writable)){h===void 0&&(h=o(()=>{var u=d?Ls(l[m]):gn,y=Xa(u);return y}),a.set(m,h));var p=e(h);if(p===gn)return!1}return d},set(l,m,h,d){var p=a.get(m),u=m in l;if(r&&m==="length")for(var y=h;y<p.v;y+=1){var g=a.get(y+"");g!==void 0?v(g,gn):y in l&&(g=o(()=>Xa(gn)),a.set(y+"",g))}if(p===void 0)(!u||hs(l,m)?.writable)&&(p=o(()=>Xa(void 0)),v(p,Ls(h)),a.set(m,p));else{u=p.v!==gn;var _=o(()=>Ls(h));v(p,_)}var T=Reflect.getOwnPropertyDescriptor(l,m);if(T?.set&&T.set.call(d,h),!u){if(r&&typeof m=="string"){var E=a.get("length"),R=Number(m);Number.isInteger(R)&&R>=E.v&&v(E,R+1)}tr(s)}return!0},ownKeys(l){e(s);var m=Reflect.ownKeys(l).filter(p=>{var u=a.get(p);return u===void 0||u.v!==gn});for(var[h,d]of a)d.v!==gn&&!(h in l)&&m.push(h);return m},setPrototypeOf(){Cl()}})}function Ri(t){try{if(t!==null&&typeof t=="object"&&Ya in t)return t[Ya]}catch{}return t}function ac(t,n){return Object.is(Ri(t),Ri(n))}var Ds,To,xo,_o;function sc(){if(Ds===void 0){Ds=window,To=/Firefox/.test(navigator.userAgent);var t=Element.prototype,n=Node.prototype,a=Text.prototype;xo=hs(n,"firstChild").get,_o=hs(n,"nextSibling").get,Ei(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Ei(a)&&(a.__t=void 0)}}function Ha(t=""){return document.createTextNode(t)}function Pa(t){return xo.call(t)}function cr(t){return _o.call(t)}function x(t,n){return Pa(t)}function _e(t,n=!1){{var a=Pa(t);return a instanceof Comment&&a.data===""?cr(a):a}}function b(t,n=1,a=!1){let r=t;for(;n--;)r=cr(r);return r}function rc(t){t.textContent=""}function wo(){return!1}let Li=!1;function ic(){Li||(Li=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const n of t.target.elements)n.__on_r?.()})},{capture:!0}))}function Or(t){var n=wt,a=Nt;Wn(null),Ea(null);try{return t()}finally{Wn(n),Ea(a)}}function pi(t,n,a,r=a){t.addEventListener(n,()=>Or(a));const s=t.__on_r;s?t.__on_r=()=>{s(),r(!0)}:t.__on_r=()=>r(!0),ic()}function So(t){Nt===null&&(wt===null&&_l(),xl()),as&&Tl()}function oc(t,n){var a=n.last;a===null?n.last=n.first=t:(a.next=t,t.prev=a,n.last=t)}function Ma(t,n,a){var r=Nt;r!==null&&(r.f&jn)!==0&&(t|=jn);var s={ctx:Xt,deps:null,nodes:null,f:t|$n|sa,first:null,fn:n,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(a)try{Ws(s),s.f|=ui}catch(l){throw Yn(s),l}else n!==null&&Ba(s);var i=s;if(a&&i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&Fs)===0&&(i=i.first,(t&Ua)!==0&&(t&Ps)!==0&&i!==null&&(i.f|=Ps)),i!==null&&(i.parent=r,r!==null&&oc(i,r),wt!==null&&(wt.f&_n)!==0&&(t&_s)===0)){var o=wt;(o.effects??=[]).push(i)}return s}function yi(){return wt!==null&&!ma}function ur(t){const n=Ma(or,null,!1);return mn(n,xn),n.teardown=t,n}function Jr(t){So();var n=Nt.f,a=!wt&&(n&Ka)!==0&&(n&ui)===0;if(a){var r=Xt;(r.e??=[]).push(t)}else return Ao(t)}function Ao(t){return Ma(Sr|no,t,!1)}function lc(t){return So(),Ma(or|no,t,!0)}function cc(t){Aa.ensure();const n=Ma(_s|Fs,t,!0);return(a={})=>new Promise(r=>{a.outro?fs(n,()=>{Yn(n),r(void 0)}):(Yn(n),r(void 0))})}function Co(t){return Ma(Sr,t,!1)}function pe(t,n){var a=Xt,r={effect:null,ran:!1,deps:t};a.l.$.push(r),r.effect=Us(()=>{t(),!r.ran&&(r.ran=!0,c(n))})}function Ra(){var t=Xt;Us(()=>{for(var n of t.l.$){n.deps();var a=n.effect;(a.f&xn)!==0&&a.deps!==null&&mn(a,ka),Ks(a)&&Ws(a),n.ran=!1}})}function uc(t){return Ma(mi|Fs,t,!0)}function Us(t,n=0){return Ma(or|n,t,!0)}function U(t,n=[],a=[],r=[]){Ql(r,n,a,s=>{Ma(or,()=>t(...s.map(e)),!0)})}function vi(t,n=0){var a=Ma(Ua|n,t,!0);return a}function aa(t){return Ma(Ka|Fs,t,!0)}function Eo(t){var n=t.teardown;if(n!==null){const a=as,r=wt;Di(!0),Wn(null);try{n.call(null)}finally{Di(a),Wn(r)}}}function ko(t,n=!1){var a=t.first;for(t.first=t.last=null;a!==null;){const s=a.ac;s!==null&&Or(()=>{s.abort(Rs)});var r=a.next;(a.f&_s)!==0?a.parent=null:Yn(a,n),a=r}}function mc(t){for(var n=t.first;n!==null;){var a=n.next;(n.f&Ka)===0&&Yn(n),n=a}}function Yn(t,n=!0){var a=!1;(n||(t.f&to)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(dc(t.nodes.start,t.nodes.end),a=!0),ko(t,n&&!a),Er(t,0),mn(t,Wa);var r=t.nodes&&t.nodes.t;if(r!==null)for(const i of r)i.stop();Eo(t);var s=t.parent;s!==null&&s.first!==null&&Mo(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function dc(t,n){for(;t!==null;){var a=t===n?null:cr(t);t.remove(),t=a}}function Mo(t){var n=t.parent,a=t.prev,r=t.next;a!==null&&(a.next=r),r!==null&&(r.prev=a),n!==null&&(n.first===t&&(n.first=r),n.last===t&&(n.last=a))}function fs(t,n,a=!0){var r=[];Ro(t,r,!0);var s=()=>{a&&Yn(t),n&&n()},i=r.length;if(i>0){var o=()=>--i||s();for(var l of r)l.out(o)}else s()}function Ro(t,n,a){if((t.f&jn)===0){t.f^=jn;var r=t.nodes&&t.nodes.t;if(r!==null)for(const l of r)(l.is_global||a)&&n.push(l);for(var s=t.first;s!==null;){var i=s.next,o=(s.f&Ps)!==0||(s.f&Ka)!==0&&(t.f&Ua)!==0;Ro(s,n,o?a:!1),s=i}}}function gi(t){Lo(t,!0)}function Lo(t,n){if((t.f&jn)!==0){t.f^=jn,(t.f&xn)===0&&(mn(t,$n),Ba(t));for(var a=t.first;a!==null;){var r=a.next,s=(a.f&Ps)!==0||(a.f&Ka)!==0;Lo(a,s?n:!1),a=r}var i=t.nodes&&t.nodes.t;if(i!==null)for(const o of i)(o.is_global||n)&&o.in()}}function Do(t,n){if(t.nodes)for(var a=t.nodes.start,r=t.nodes.end;a!==null;){var s=a===r?null:cr(a);n.append(a),a=s}}let Ms=null;function hc(t){var n=Ms;try{if(Ms=new Set,c(t),n!==null)for(var a of Ms)n.add(a);return Ms}finally{Ms=n}}function Io(t){for(var n of hc(t))Ts(n,n.v)}let ps=!1;function Cr(t){ps=t}let as=!1;function Di(t){as=t}let wt=null,ma=!1;function Wn(t){wt=t}let Nt=null;function Ea(t){Nt=t}let Fa=null;function fc(t){wt!==null&&(Fa===null?Fa=[t]:Fa.push(t))}let Ln=null,zn=0,ta=null;function pc(t){ta=t}let $o=1,sr=0,ys=sr;function Ii(t){ys=t}function Po(){return++$o}function Ks(t){var n=t.f;if((n&$n)!==0)return!0;if(n&_n&&(t.f&=~gs),(n&ka)!==0){for(var a=t.deps,r=a.length,s=0;s<r;s++){var i=a[s];if(Ks(i)&&vo(i),i.wv>t.wv)return!0}(n&sa)!==0&&ua===null&&mn(t,xn)}return!1}function No(t,n,a=!0){var r=t.reactions;if(r!==null&&!Fa?.includes(t))for(var s=0;s<r.length;s++){var i=r[s];(i.f&_n)!==0?No(i,n,!1):n===i&&(a?mn(i,$n):(i.f&xn)!==0&&mn(i,ka),Ba(i))}}function Oo(t){var n=Ln,a=zn,r=ta,s=wt,i=Fa,o=Xt,l=ma,m=ys,h=t.f;Ln=null,zn=0,ta=null,wt=(h&(Ka|_s))===0?t:null,Fa=null,Ns(t.ctx),ma=!1,ys=++sr,t.ac!==null&&(Or(()=>{t.ac.abort(Rs)}),t.ac=null);try{t.f|=jr;var d=t.fn,p=d(),u=t.deps;if(Ln!==null){var y;if(Er(t,zn),u!==null&&zn>0)for(u.length=zn+Ln.length,y=0;y<Ln.length;y++)u[zn+y]=Ln[y];else t.deps=u=Ln;if(yi()&&(t.f&sa)!==0)for(y=zn;y<u.length;y++)(u[y].reactions??=[]).push(t)}else u!==null&&zn<u.length&&(Er(t,zn),u.length=zn);if(lr()&&ta!==null&&!ma&&u!==null&&(t.f&(_n|ka|$n))===0)for(y=0;y<ta.length;y++)No(ta[y],t);return s!==null&&s!==t&&(sr++,ta!==null&&(r===null?r=ta:r.push(...ta))),(t.f&es)!==0&&(t.f^=es),p}catch(g){return co(g)}finally{t.f^=jr,Ln=n,zn=a,ta=r,wt=s,Fa=i,Ns(o),ma=l,ys=m}}function yc(t,n){let a=n.reactions;if(a!==null){var r=hl.call(a,t);if(r!==-1){var s=a.length-1;s===0?a=n.reactions=null:(a[r]=a[s],a.pop())}}if(a===null&&(n.f&_n)!==0&&(Ln===null||!Ln.includes(n))){var i=n;(i.f&sa)!==0&&(i.f^=sa,i.f&=~gs),hi(i),yo(i),Er(i,0)}}function Er(t,n){var a=t.deps;if(a!==null)for(var r=n;r<a.length;r++)yc(t,a[r])}function Ws(t){var n=t.f;if((n&Wa)===0){mn(t,xn);var a=Nt,r=ps;Nt=t,ps=!0;try{(n&(Ua|eo))!==0?mc(t):ko(t),Eo(t);var s=Oo(t);t.teardown=typeof s=="function"?s:null,t.wv=$o;var i;Vr&&Bl&&(t.f&$n)!==0&&t.deps}finally{ps=r,Nt=a}}}async function vc(){await Promise.resolve(),Gl()}function e(t){var n=t.f,a=(n&_n)!==0;if(Ms?.add(t),wt!==null&&!ma){var r=Nt!==null&&(Nt.f&Wa)!==0;if(!r&&!Fa?.includes(t)){var s=wt.deps;if((wt.f&jr)!==0)t.rv<sr&&(t.rv=sr,Ln===null&&s!==null&&s[zn]===t?zn++:Ln===null?Ln=[t]:Ln.includes(t)||Ln.push(t));else{(wt.deps??=[]).push(t);var i=t.reactions;i===null?t.reactions=[wt]:i.includes(wt)||i.push(wt)}}}if(as&&ts.has(t))return ts.get(t);if(a){var o=t;if(as){var l=o.v;return((o.f&xn)===0&&o.reactions!==null||Yo(o))&&(l=fi(o)),ts.set(o,l),l}var m=(o.f&sa)===0&&!ma&&wt!==null&&(ps||(wt.f&sa)!==0),h=o.deps===null;Ks(o)&&(m&&(o.f|=sa),vo(o)),m&&!h&&Wo(o)}if(ua?.has(t))return ua.get(t);if((t.f&es)!==0)throw t.v;return t.v}function Wo(t){if(t.deps!==null){t.f|=sa;for(const n of t.deps)(n.reactions??=[]).push(t),(n.f&_n)!==0&&(n.f&sa)===0&&Wo(n)}}function Yo(t){if(t.v===gn)return!0;if(t.deps===null)return!1;for(const n of t.deps)if(ts.has(n)||(n.f&_n)!==0&&Yo(n))return!0;return!1}function c(t){var n=ma;try{return ma=!0,t()}finally{ma=n}}function J(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Ya in t)ei(t);else if(!Array.isArray(t))for(let n in t){const a=t[n];typeof a=="object"&&a&&Ya in a&&ei(a)}}}function ei(t,n=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!n.has(t)){n.add(t),t instanceof Date&&t.getTime();for(let r in t)try{ei(t[r],n)}catch{}const a=li(t);if(a!==Object.prototype&&a!==Array.prototype&&a!==Map.prototype&&a!==Set.prototype&&a!==Date.prototype){const r=Qi(a);for(let s in r){const i=r[s].get;if(i)try{i.call(t)}catch{}}}}}const gc=["touchstart","touchmove"];function bc(t){return gc.includes(t)}const Tc=new Set,$i=new Set;function xc(t,n,a,r={}){function s(i){if(r.capture||Vs.call(n,i),!i.cancelBubble)return Or(()=>a?.call(this,i))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?qs(()=>{n.addEventListener(t,s,r)}):n.addEventListener(t,s,r),s}function V(t,n,a,r,s){var i={capture:r,passive:s},o=xc(t,n,a,i);(n===document.body||n===window||n===document||n instanceof HTMLMediaElement)&&ur(()=>{n.removeEventListener(t,o,i)})}let Pi=null;function Vs(t){var n=this,a=n.ownerDocument,r=t.type,s=t.composedPath?.()||[],i=s[0]||t.target;Pi=t;var o=0,l=Pi===t&&t.__root;if(l){var m=s.indexOf(l);if(m!==-1&&(n===document||n===window)){t.__root=n;return}var h=s.indexOf(n);if(h===-1)return;m<=h&&(o=m)}if(i=s[o]||t.target,i!==n){Zi(t,"currentTarget",{configurable:!0,get(){return i||a}});var d=wt,p=Nt;Wn(null),Ea(null);try{for(var u,y=[];i!==null;){var g=i.assignedSlot||i.parentNode||i.host||null;try{var _=i["__"+r];_!=null&&(!i.disabled||t.target===i)&&_.call(i,t)}catch(T){u?y.push(T):u=T}if(t.cancelBubble||g===n||g===null)break;i=g}if(u){for(let T of y)queueMicrotask(()=>{throw T});throw u}}finally{t.__root=n,delete t.currentTarget,Wn(d),Ea(p)}}}function Ho(t){var n=document.createElement("template");return n.innerHTML=t.replaceAll("<!>","<!---->"),n.content}function Ys(t,n){var a=Nt;a.nodes===null&&(a.nodes={start:t,end:n,a:null,t:null})}function ve(t,n){var a=(n&so)!==0,r=(n&Wl)!==0,s,i=!t.startsWith("<!>");return()=>{s===void 0&&(s=Ho(i?t:"<!>"+t),a||(s=Pa(s)));var o=r||To?document.importNode(s,!0):s.cloneNode(!0);if(a){var l=Pa(o),m=o.lastChild;Ys(l,m)}else Ys(o,o);return o}}function _c(t,n,a="svg"){var r=!t.startsWith("<!>"),s=(n&so)!==0,i=`<${a}>${r?t:"<!>"+t}</${a}>`,o;return()=>{if(!o){var l=Ho(i),m=Pa(l);if(s)for(o=document.createDocumentFragment();Pa(m);)o.appendChild(Pa(m));else o=Pa(m)}var h=o.cloneNode(!0);if(s){var d=Pa(h),p=h.lastChild;Ys(d,p)}else Ys(h,h);return h}}function ge(t,n){return _c(t,n,"svg")}function bi(t=""){{var n=Ha(t+"");return Ys(n,n),n}}function xt(){var t=document.createDocumentFragment(),n=document.createComment(""),a=Ha();return t.append(n,a),Ys(n,a),t}function k(t,n){t!==null&&t.before(n)}function Re(t,n){var a=n==null?"":typeof n=="object"?n+"":n;a!==(t.__t??=t.nodeValue)&&(t.__t=a,t.nodeValue=a+"")}function wc(t,n){return Sc(t,n)}const Cs=new Map;function Sc(t,{target:n,anchor:a,props:r={},events:s,context:i,intro:o=!0}){sc();var l=new Set,m=p=>{for(var u=0;u<p.length;u++){var y=p[u];if(!l.has(y)){l.add(y);var g=bc(y);n.addEventListener(y,Vs,{passive:g});var _=Cs.get(y);_===void 0?(document.addEventListener(y,Vs,{passive:g}),Cs.set(y,1)):Cs.set(y,_+1)}}};m(Ir(Tc)),$i.add(m);var h=void 0,d=cc(()=>{var p=a??n.appendChild(Ha());return jl(p,{pending:()=>{}},u=>{if(i){Hn({});var y=Xt;y.c=i}s&&(r.$$events=s),h=t(u,r)||{},i&&Fn()}),()=>{for(var u of l){n.removeEventListener(u,Vs);var y=Cs.get(u);--y===0?(document.removeEventListener(u,Vs),Cs.delete(u)):Cs.set(u,y)}$i.delete(m),p!==a&&p.parentNode?.removeChild(p)}});return Ac.set(h,d),h}let Ac=new WeakMap;class Cc{anchor;#t=new Map;#i=new Map;#e=new Map;#s=new Set;#r=!0;constructor(n,a=!0){this.anchor=n,this.#r=a}#a=()=>{var n=Lt;if(this.#t.has(n)){var a=this.#t.get(n),r=this.#i.get(a);if(r)gi(r),this.#s.delete(a);else{var s=this.#e.get(a);s&&(this.#i.set(a,s.effect),this.#e.delete(a),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),r=s.effect)}for(const[i,o]of this.#t){if(this.#t.delete(i),i===n)break;const l=this.#e.get(o);l&&(Yn(l.effect),this.#e.delete(o))}for(const[i,o]of this.#i){if(i===a||this.#s.has(i))continue;const l=()=>{if(Array.from(this.#t.values()).includes(i)){var h=document.createDocumentFragment();Do(o,h),h.append(Ha()),this.#e.set(i,{effect:o,fragment:h})}else Yn(o);this.#s.delete(i),this.#i.delete(i)};this.#r||!r?(this.#s.add(i),fs(o,l,!1)):l()}}};#n=n=>{this.#t.delete(n);const a=Array.from(this.#t.values());for(const[r,s]of this.#e)a.includes(r)||(Yn(s.effect),this.#e.delete(r))};ensure(n,a){var r=Lt,s=wo();if(a&&!this.#i.has(n)&&!this.#e.has(n))if(s){var i=document.createDocumentFragment(),o=Ha();i.append(o),this.#e.set(n,{effect:aa(()=>a(o)),fragment:i})}else this.#i.set(n,aa(()=>a(this.anchor)));if(this.#t.set(r,n),s){for(const[l,m]of this.#i)l===n?r.skipped_effects.delete(m):r.skipped_effects.add(m);for(const[l,m]of this.#e)l===n?r.skipped_effects.delete(m.effect):r.skipped_effects.add(m.effect);r.oncommit(this.#a),r.ondiscard(this.#n)}else this.#a()}}function te(t,n,a=!1){var r=new Cc(t),s=a?Ps:0;function i(o,l){r.ensure(o,l)}vi(()=>{var o=!1;n((l,m=!0)=>{o=!0,i(m,l)}),o||i(!1,null)},s)}function lt(t,n){return n}function Ec(t,n,a){for(var r=[],s=n.length,i,o=n.length,l=0;l<s;l++){let p=n[l];fs(p,()=>{if(i){if(i.pending.delete(p),i.done.add(p),i.pending.size===0){var u=t.outrogroups;ti(Ir(i.done)),u.delete(i),u.size===0&&(t.outrogroups=null)}}else o-=1},!1)}if(o===0){var m=r.length===0&&a!==null;if(m){var h=a,d=h.parentNode;rc(d),d.append(h),t.items.clear()}ti(n,!m)}else i={pending:new Set(n),done:new Set},(t.outrogroups??=new Set).add(i)}function ti(t,n=!0){for(var a=0;a<t.length;a++)Yn(t[a],n)}var Ni;function Ye(t,n,a,r,s,i=null){var o=t,l=new Map,m=(n&ao)!==0;if(m){var h=t;o=h.appendChild(Ha())}var d=null,p=Ie(()=>{var E=a();return ir(E)?E:E==null?[]:Ir(E)}),u,y=!0;function g(){T.fallback=d,kc(T,u,o,n,r),d!==null&&(u.length===0?(d.f&Oa)===0?gi(d):(d.f^=Oa,js(d,null,o)):fs(d,()=>{d=null}))}var _=vi(()=>{u=e(p);for(var E=u.length,R=new Set,L=Lt,S=wo(),A=0;A<E;A+=1){var M=u[A],D=r(M,A),C=y?null:l.get(D);C?(C.v&&Ts(C.v,M),C.i&&Ts(C.i,A),S&&L.skipped_effects.delete(C.e)):(C=Mc(l,y?o:Ni??=Ha(),M,D,A,s,n,a),y||(C.e.f|=Oa),l.set(D,C)),R.add(D)}if(E===0&&i&&!d&&(y?d=aa(()=>i(o)):(d=aa(()=>i(Ni??=Ha())),d.f|=Oa)),!y)if(S){for(const[I,F]of l)R.has(I)||L.skipped_effects.add(F.e);L.oncommit(g),L.ondiscard(()=>{})}else g();e(p)}),T={effect:_,items:l,outrogroups:null,fallback:d};y=!1}function kc(t,n,a,r,s){var i=(r&Ll)!==0,o=n.length,l=t.items,m=t.effect.first,h,d=null,p,u=[],y=[],g,_,T,E;if(i)for(E=0;E<o;E+=1)g=n[E],_=s(g,E),T=l.get(_).e,(T.f&Oa)===0&&(T.nodes?.a?.measure(),(p??=new Set).add(T));for(E=0;E<o;E+=1){if(g=n[E],_=s(g,E),T=l.get(_).e,t.outrogroups!==null)for(const F of t.outrogroups)F.pending.delete(T),F.done.delete(T);if((T.f&Oa)!==0)if(T.f^=Oa,T===m)js(T,null,a);else{var R=d?d.next:m;T===t.effect.last&&(t.effect.last=T.prev),T.prev&&(T.prev.next=T.next),T.next&&(T.next.prev=T.prev),Va(t,d,T),Va(t,T,R),js(T,R,a),d=T,u=[],y=[],m=d.next;continue}if((T.f&jn)!==0&&(gi(T),i&&(T.nodes?.a?.unfix(),(p??=new Set).delete(T))),T!==m){if(h!==void 0&&h.has(T)){if(u.length<y.length){var L=y[0],S;d=L.prev;var A=u[0],M=u[u.length-1];for(S=0;S<u.length;S+=1)js(u[S],L,a);for(S=0;S<y.length;S+=1)h.delete(y[S]);Va(t,A.prev,M.next),Va(t,d,A),Va(t,M,L),m=L,d=M,E-=1,u=[],y=[]}else h.delete(T),js(T,m,a),Va(t,T.prev,T.next),Va(t,T,d===null?t.effect.first:d.next),Va(t,d,T),d=T;continue}for(u=[],y=[];m!==null&&m!==T;)(h??=new Set).add(m),y.push(m),m=m.next;if(m===null)continue}(T.f&Oa)===0&&u.push(T),d=T,m=T.next}if(t.outrogroups!==null){for(const F of t.outrogroups)F.pending.size===0&&(ti(Ir(F.done)),t.outrogroups?.delete(F));t.outrogroups.size===0&&(t.outrogroups=null)}if(m!==null||h!==void 0){var D=[];if(h!==void 0)for(T of h)(T.f&jn)===0&&D.push(T);for(;m!==null;)(m.f&jn)===0&&m!==t.fallback&&D.push(m),m=m.next;var C=D.length;if(C>0){var I=(r&ao)!==0&&o===0?a:null;if(i){for(E=0;E<C;E+=1)D[E].nodes?.a?.measure();for(E=0;E<C;E+=1)D[E].nodes?.a?.fix()}Ec(t,D,I)}}i&&qs(()=>{if(p!==void 0)for(T of p)T.nodes?.a?.apply()})}function Mc(t,n,a,r,s,i,o,l){var m=(o&Ml)!==0?(o&Dl)===0?N(a,!1,!1):bs(a):null,h=(o&Rl)!==0?bs(s):null;return{v:m,i:h,e:aa(()=>(i(n,m??a,h??s,l),()=>{t.delete(r)}))}}function js(t,n,a){if(t.nodes)for(var r=t.nodes.start,s=t.nodes.end,i=n&&(n.f&Oa)===0?n.nodes.start:a;r!==null;){var o=cr(r);if(i.before(r),r===s)return;r=o}}function Va(t,n,a){n===null?t.effect.first=a:n.next=a,a===null?t.effect.last=n:a.prev=n}function Fo(t,n,a,r,s){var i=n.$$slots?.[a],o=!1;i===!0&&(i=n.children,o=!0),i===void 0||i(t,o?()=>r:r)}const Oi=[...` 	
\r\fÂ \v\uFEFF`];function Rc(t,n,a){var r=t==null?"":""+t;if(a){for(var s in a)if(a[s])r=r?r+" "+s:s;else if(r.length)for(var i=s.length,o=0;(o=r.indexOf(s,o))>=0;){var l=o+i;(o===0||Oi.includes(r[o-1]))&&(l===r.length||Oi.includes(r[l]))?r=(o===0?"":r.substring(0,o))+r.substring(l+1):o=l}}return r===""?null:r}function Lc(t,n){return t==null?null:String(t)}function Tn(t,n,a,r,s,i){var o=t.__className;if(o!==a||o===void 0){var l=Rc(a,r,i);l==null?t.removeAttribute("class"):n?t.className=l:t.setAttribute("class",l),t.__className=a}else if(i&&s!==i)for(var m in i){var h=!!i[m];(s==null||h!==!!s[m])&&t.classList.toggle(m,h)}return i}function Dc(t,n,a,r){var s=t.__style;if(s!==n){var i=Lc(n);i==null?t.removeAttribute("style"):t.style.cssText=i,t.__style=n}return r}function Bo(t,n,a=!1){if(t.multiple){if(n==null)return;if(!ir(n))return Hl();for(var r of t.options)r.selected=n.includes(nr(r));return}for(r of t.options){var s=nr(r);if(ac(s,n)){r.selected=!0;return}}(!a||n!==void 0)&&(t.selectedIndex=-1)}function Ic(t){var n=new MutationObserver(()=>{Bo(t,t.__value)});n.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ur(()=>{n.disconnect()})}function qo(t,n,a=n){var r=new WeakSet,s=!0;pi(t,"change",i=>{var o=i?"[selected]":":checked",l;if(t.multiple)l=[].map.call(t.querySelectorAll(o),nr);else{var m=t.querySelector(o)??t.querySelector("option:not([disabled])");l=m&&nr(m)}a(l),Lt!==null&&r.add(Lt)}),Co(()=>{var i=n();if(t===document.activeElement){var o=Js??Lt;if(r.has(o))return}if(Bo(t,i,s),s&&i===void 0){var l=t.querySelector(":checked");l!==null&&(i=nr(l),a(i))}t.__value=i,s=!1}),Ic(t)}function nr(t){return"__value"in t?t.__value:t.value}const $c=Symbol("is custom element"),Pc=Symbol("is html");function Uo(t,n){var a=Ko(t);a.value===(a.value=n??void 0)||t.value===n&&(n!==0||t.nodeName!=="PROGRESS")||(t.value=n??"")}function f(t,n,a,r){var s=Ko(t);s[n]!==(s[n]=a)&&(n==="loading"&&(t[gl]=a),a==null?t.removeAttribute(n):typeof a!="string"&&Nc(t).includes(n)?t[n]=a:t.setAttribute(n,a))}function Ko(t){return t.__attributes??={[$c]:t.nodeName.includes("-"),[Pc]:t.namespaceURI===Yl}}var Wi=new Map;function Nc(t){var n=t.getAttribute("is")||t.nodeName,a=Wi.get(n);if(a)return a;Wi.set(n,a=[]);for(var r,s=t,i=Element.prototype;i!==s;){r=Qi(s);for(var o in r)r[o].set&&a.push(o);s=li(s)}return a}function Mn(t,n,a=n){var r=new WeakSet;pi(t,"input",async s=>{var i=s?t.defaultValue:t.value;if(i=Kr(t)?Gr(i):i,a(i),Lt!==null&&r.add(Lt),await vc(),i!==(i=n())){var o=t.selectionStart,l=t.selectionEnd,m=t.value.length;if(t.value=i??"",l!==null){var h=t.value.length;o===l&&l===m&&h>m?(t.selectionStart=h,t.selectionEnd=h):(t.selectionStart=o,t.selectionEnd=Math.min(l,h))}}}),c(n)==null&&t.value&&(a(Kr(t)?Gr(t.value):t.value),Lt!==null&&r.add(Lt)),Us(()=>{var s=n();if(t===document.activeElement){var i=Js??Lt;if(r.has(i))return}Kr(t)&&s===Gr(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function Cn(t,n,a=n){pi(t,"change",r=>{var s=r?t.defaultChecked:t.checked;a(s)}),c(n)==null&&a(t.checked),Us(()=>{var r=n();t.checked=!!r})}function Kr(t){var n=t.type;return n==="number"||n==="range"}function Gr(t){return t===""?null:+t}function Zs(t,n,a){var r=hs(t,n);r&&r.set&&(t[n]=a,ur(()=>{t[n]=null}))}function Yi(t,n){return t===n||t?.[Ya]===n}function kr(t={},n,a,r){return Co(()=>{var s,i;return Us(()=>{s=i,i=[],c(()=>{t!==a(...i)&&(n(t,...i),s&&Yi(a(...s),t)&&n(null,...s))})}),()=>{qs(()=>{i&&Yi(a(...i),t)&&n(null,...i)})}}),t}function Hi(t){return function(...n){var a=n[0];return a.stopPropagation(),t?.apply(this,n)}}function Zn(t=!1){const n=Xt,a=n.l.u;if(!a)return;let r=()=>J(n.s);if(t){let s=0,i={};const o=Nr(()=>{let l=!1;const m=n.s;for(const h in m)m[h]!==i[h]&&(i[h]=m[h],l=!0);return l&&s++,s});r=()=>e(o)}a.b.length&&lc(()=>{Fi(n,r),wr(a.b)}),Jr(()=>{const s=c(()=>a.m.map(yl));return()=>{for(const i of s)typeof i=="function"&&i()}}),a.a.length&&Jr(()=>{Fi(n,r),wr(a.a)})}function Fi(t,n){if(t.l.s)for(const a of t.l.s)e(a);n()}function Bi(t,n){var a=t.$$events?.[n.type],r=ir(a)?a.slice():a==null?[]:[a];for(var s of r)s.call(this,n)}function Ti(t,n,a){if(t==null)return n(void 0),a&&a(void 0),Ja;const r=c(()=>t.subscribe(n,a));return r.unsubscribe?()=>r.unsubscribe():r}const Es=[];function Oc(t,n){return{subscribe:rn(t,n).subscribe}}function rn(t,n=Ja){let a=null;const r=new Set;function s(l){if(io(t,l)&&(t=l,a)){const m=!Es.length;for(const h of r)h[1](),Es.push(h,t);if(m){for(let h=0;h<Es.length;h+=2)Es[h][0](Es[h+1]);Es.length=0}}}function i(l){s(l(t))}function o(l,m=Ja){const h=[l,m];return r.add(h),r.size===1&&(a=n(s,i)||Ja),l(t),()=>{r.delete(h),r.size===0&&a&&(a(),a=null)}}return{set:s,update:i,subscribe:o}}function Ga(t,n,a){const r=!Array.isArray(t),s=r?[t]:t;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=n.length<2;return Oc(a,(o,l)=>{let m=!1;const h=[];let d=0,p=Ja;const u=()=>{if(d)return;p();const g=n(r?h[0]:h,o,l);i?o(g):p=typeof g=="function"?g:Ja},y=s.map((g,_)=>Ti(g,T=>{h[_]=T,d&=~(1<<_),m&&u()},()=>{d|=1<<_}));return m=!0,u(),function(){wr(y),p(),m=!1}})}function da(t){let n;return Ti(t,a=>n=a)(),n}let fr=!1,ni=Symbol();function Dt(t,n,a){const r=a[n]??={store:null,source:N(void 0),unsubscribe:Ja};if(r.store!==t&&!(ni in a))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=Ja;else{var s=!0;r.unsubscribe=Ti(t,i=>{s?r.source.v=i:v(r.source,i)}),s=!1}return t&&ni in a?da(t):e(r.source)}function Wc(t,n){return t.set(n),n}function Gs(){const t={};function n(){ur(()=>{for(var a in t)t[a].unsubscribe();Zi(t,ni,{enumerable:!1,value:!0})})}return[t,n]}function Yc(t){var n=fr;try{return fr=!1,[t(),fr]}finally{fr=n}}function Xe(t,n,a,r){var s=!Bs||(a&$l)!==0,i=(a&Nl)!==0,o=(a&Ol)!==0,l=r,m=!0,h=()=>(m&&(m=!1,l=o?c(r):r),l),d;if(i){var p=Ya in t||vl in t;d=hs(t,n)?.set??(p&&n in t?L=>t[n]=L:void 0)}var u,y=!1;i?[u,y]=Yc(()=>t[n]):u=t[n],u===void 0&&r!==void 0&&(u=h(),d&&(s&&Sl(),d(u)));var g;if(s?g=()=>{var L=t[n];return L===void 0?h():(m=!0,L)}:g=()=>{var L=t[n];return L!==void 0&&(l=void 0),L===void 0?l:L},s&&(a&Pl)===0)return g;if(d){var _=t.$$legacy;return(function(L,S){return arguments.length>0?((!s||!S||_||y)&&d(S?g():L),L):g()})}var T=!1,E=((a&Il)!==0?Nr:Ie)(()=>(T=!1,g()));i&&e(E);var R=Nt;return(function(L,S){if(arguments.length>0){const A=S?e(E):s&&i?Ls(L):L;return v(E,A),T=!0,l!==void 0&&(l=A),L}return as&&T||(R.f&Wa)!==0?E.v:e(E)})}function ws(t){Xt===null&&di(),Bs&&Xt.l!==null?Fc(Xt).m.push(t):Jr(()=>{const n=c(t);if(typeof n=="function")return n})}function xi(t){Xt===null&&di(),ws(()=>()=>c(t))}function Hc(t,n,{bubbles:a=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:n,bubbles:a,cancelable:r})}function Go(){const t=Xt;return t===null&&di(),(n,a,r)=>{const s=t.s.$$events?.[n];if(s){const i=ir(s)?s.slice():[s],o=Hc(n,a,r);for(const l of i)l.call(t.x,o);return!o.defaultPrevented}return!0}}function Fc(t){var n=t.l;return n.u??={a:[],b:[],m:[]}}const Bc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Bc);ql();function qc(t,n,a,r){const s=Is(a,r,t),i=Is(a,r,n),o=Is(t,n,a),l=Is(t,n,r);return!!((s>0&&i<0||s<0&&i>0)&&(o>0&&l<0||o<0&&l>0)||s===0&&pr(a,r,t)||i===0&&pr(a,r,n)||o===0&&pr(t,n,a)||l===0&&pr(t,n,r))}function Is(t,n,a){return(a.x-t.x)*(n.y-t.y)-(n.x-t.x)*(a.y-t.y)}function pr(t,n,a){return Math.min(t.x,n.x)<=a.x&&a.x<=Math.max(t.x,n.x)&&Math.min(t.y,n.y)<=a.y&&a.y<=Math.max(t.y,n.y)}function qi(t,n,a,r=16){const s=[];for(let i=0;i<r;i++){const o=2*Math.PI*i/r;s.push({x:t+a*Math.cos(o),y:n+a*Math.sin(o)})}return s}function Uc(t,n,a,r,s=0,i=16){const o=[],l=2*(a+r),m=s*Math.PI/180,h=Math.cos(m),d=Math.sin(m),p=i/l,u=Math.max(1,Math.round(a*p)),y=Math.max(1,Math.round(r*p)),g=a/2,_=r/2,T=[];for(let E=0;E<u;E++){const R=E/u;T.push({x:-g+a*R,y:-_})}for(let E=0;E<y;E++){const R=E/y;T.push({x:g,y:-_+r*R})}for(let E=0;E<u;E++){const R=E/u;T.push({x:g-a*R,y:_})}for(let E=0;E<y;E++){const R=E/y;T.push({x:-g,y:_-r*R})}for(const E of T)o.push({x:t+E.x*h-E.y*d,y:n+E.x*d+E.y*h});if(o.length>i){const E=[],R=o.length/i;for(let L=0;L<i;L++)E.push(o[Math.floor(L*R)]);return E}return o}function Kc(t,n,a,r,s=0,i=16){const o=[],l=s*Math.PI/180,m=Math.cos(l),h=Math.sin(l);for(let d=0;d<i;d++){const p=2*Math.PI*d/i,u=a*Math.cos(p),y=r*Math.sin(p);o.push({x:t+u*m-y*h,y:n+u*h+y*m})}return o}function Ui(t,n,a){const r=a.length;for(let s=0;s<r;s++){const i=a[s],o=a[(s+1)%r];if(qc(t,n,i,o))return!0}return!1}function zo(t,n,a){const r=a*Math.PI/180,s=Math.cos(r),i=Math.sin(r),o=t.x-n.x,l=t.y-n.y;return{x:n.x+o*s-l*i,y:n.y+o*i+l*s}}function Xo(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function xs(t){const n=Xo(t),a=t.rotation||0;return[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}].map(s=>zo(s,n,a))}function Gc(t){const s=t.x,i=t.y+t.height;return[{x:s,y:i},{x:s,y:i-8},{x:s+.5,y:i-8},{x:s+.5,y:i-.5},{x:s+4,y:i-.5},{x:s+4,y:i}]}function zc(t){const n=Gc(t),a=Xo(t),r=t.rotation||0;return n.map(s=>zo(s,a,r))}function Mr(t,n){const a=n.length;let r=null;for(let s=0;s<a;s++){const i=n[s],o=n[(s+1)%a],l=(o.x-i.x)*(t.y-i.y)-(o.y-i.y)*(t.x-i.x);if(l!==0){const m=l>0;if(r===null)r=m;else if(r!==m)return!1}}return!0}function Xc(t,n,a,r,s=.01){const i=Math.abs(Is(t,n,a)),o=Math.abs(Is(t,n,r)),l=Math.sqrt((n.x-t.x)**2+(n.y-t.y)**2),m=s*l;if(i>m||o>m)return!1;const h=n.x-t.x,d=n.y-t.y,p=Math.sqrt(h*h+d*d);if(p<s)return!1;const u=h/p,y=d/p,g=0,_=p,T=(a.x-t.x)*u+(a.y-t.y)*y,E=(r.x-t.x)*u+(r.y-t.y)*y,R=Math.min(g,_),L=Math.max(g,_),S=Math.min(T,E),A=Math.max(T,E),M=Math.max(R,S);return Math.min(L,A)-M>s}function Vc(t,n,a=.1){const r=t.length,s=n.length;for(let i=0;i<r;i++){const o=t[i],l=t[(i+1)%r];for(let m=0;m<s;m++){const h=n[m],d=n[(m+1)%s];if(Xc(o,l,h,d,a))return!0}}return!1}function jc(t){const n=t.length;if(n===0)return new Map;const a=Array.from({length:n},(l,m)=>m);function r(l){return a[l]!==l&&(a[l]=r(a[l])),a[l]}function s(l,m){const h=r(l),d=r(m);h!==d&&(a[h]=d)}for(let l=0;l<n;l++)for(let m=l+1;m<n;m++)Vc(t[l].vertices,t[m].vertices)&&s(l,m);const i=new Map;t.forEach((l,m)=>i.set(l.id,m));const o=new Map;return t.forEach((l,m)=>{o.set(l.id,r(m))}),o}function Zc(t,n,a){const r=n.get(t);return r===void 0?[t]:a.filter(s=>n.get(s.id)===r).map(s=>s.id)}const yr=16;function Rr(t){return t.isRectangle&&t.width!==void 0&&t.height!==void 0?Uc(t.x,t.y,t.width,t.height,t.rotation||0,yr):t.radius!==void 0?qi(t.x,t.y,t.radius,yr):t.rx!==void 0&&t.ry!==void 0?Kc(t.x,t.y,t.rx,t.ry,t.rotation||0,yr):qi(t.x,t.y,.5,yr)}function Qc(t,n){const a=Rr(t);for(const r of a)if(Mr(r,n))return!0;return!!Mr({x:t.x,y:t.y},n)}function Jc(t,n){if(!Mr({x:t.x,y:t.y},n))return!1;const a=Rr(t);for(const r of a)if(!Mr(r,n))return!1;return!0}function _i(t,n,a,r){const s=Rr(t),i=Rr(n),o=jc(a),l=new Set;for(const p of a){const u=Jc(t,p.vertices),y=Qc(n,p.vertices);if(u||y){const g=Zc(p.id,o,a);for(const _ of g)l.add(_)}}const m=[];let h=!1,d=null;for(const p of s)for(const u of i){const y={from:p,to:u,blocked:!1,blockedBy:null};let g=!1;for(const T of a)if(!l.has(T.id)&&Ui(p,u,T.vertices)){y.blocked=!0,y.blockedBy="terrain",g=!0;break}if(g){m.push(y);continue}let _=!1;for(const T of r)if(Ui(p,u,T)){y.blocked=!0,y.blockedBy="wall",_=!0;break}_||(y.blocked=!1,h||(d=y),h=!0),m.push(y)}return{canSee:h,rays:m,firstClearRay:d,terrainsIgnored:Array.from(l)}}const Ve={width:60,height:44},Vo=rn([{id:"terrain1",x:20,y:16,width:6,height:12,rotation:0},{id:"terrain2",x:34,y:10,width:6,height:12,rotation:45},{id:"terrain3",x:44,y:20,width:6,height:12,rotation:-30}]);Ga(Vo,t=>t.map(n=>zc(n)));Ga(Vo,t=>t.map(n=>({id:n.id,vertices:xs(n)})));const Ki=rn(!1);var eu=ge('<line stroke="#3a4a3a" stroke-width="0.05"></line>'),tu=ge('<line stroke="#3a4a3a" stroke-width="0.05"></line>'),nu=ge('<line stroke="#5a6a5a" stroke-width="0.08"></line>'),au=ge('<line stroke="#5a6a5a" stroke-width="0.08"></line>'),su=ge('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),ru=ge('<line stroke="#666"></line><!>',1),iu=ge('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),ou=ge('<line stroke="#666"></line><!>',1),lu=ge('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),cu=ge('<line stroke="#666"></line><!>',1),uu=ge('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),mu=ge('<line stroke="#666"></line><!>',1),du=ge('<svg preserveAspectRatio="xMidYMid meet"><rect x="0" y="0" fill="#1a1a1a"></rect><rect fill="#4a5a4a"></rect><!><!><!><!><!><!><!><!><g><!></g></svg>');function mr(t,n){Hn(n,!1);const a=N(),r=N(),s=N(),i=N(),o=N(),l=N(),m=N();let h=N();const d=2,p=Ve.width+d*2,u=Ve.height+d*2;let y=N(1),g=N(0),_=N(0),T=N(!1),E={x:0,y:0},R=N(!1);const L=.5,S=4;function A(fe,ae){if(!e(h))return{x:0,y:0};const Fe=e(h).createSVGPoint();Fe.x=fe,Fe.y=ae;const Ce=Fe.matrixTransform(e(h).getScreenCTM().inverse());return{x:Ce.x-d,y:Ce.y-d}}function M(fe){fe.preventDefault();const ae=e(h).getBoundingClientRect(),Fe=fe.clientX-ae.left,Ce=fe.clientY-ae.top,Bt=e(s)+Fe/ae.width*e(a),Qe=e(i)+Ce/ae.height*e(r),st=fe.deltaY>0?.9:1.1,ut=Math.max(L,Math.min(S,e(y)*st)),nt=p/ut,yt=u/ut,Mt=Bt-Fe/ae.width*nt,un=Qe-Ce/ae.height*yt;v(y,ut),v(g,Mt),v(_,un)}function D(fe){(fe.button===1||fe.button===0&&e(R))&&(fe.preventDefault(),v(T,!0),E={x:fe.clientX,y:fe.clientY})}function C(fe){if(!e(T))return;const ae=e(h).getBoundingClientRect(),Fe=(fe.clientX-E.x)/ae.width*e(a),Ce=(fe.clientY-E.y)/ae.height*e(r);v(g,e(g)-Fe),v(_,e(_)-Ce),E={x:fe.clientX,y:fe.clientY}}function I(){v(T,!1)}function F(fe){fe.code==="Space"&&!fe.repeat&&fe.target.tagName!=="INPUT"&&(fe.preventDefault(),v(R,!0))}function le(fe){fe.code==="Space"&&v(R,!1)}function $(){v(y,1),v(g,0),v(_,0)}pe(()=>e(y),()=>{v(a,p/e(y))}),pe(()=>e(y),()=>{v(r,u/e(y))}),pe(()=>e(g),()=>{v(s,e(g))}),pe(()=>e(_),()=>{v(i,e(_))}),pe(()=>(e(s),e(i),e(a),e(r)),()=>{v(o,`${e(s)} ${e(i)} ${e(a)} ${e(r)}`)}),pe(()=>Ve,()=>{v(l,Array.from({length:Ve.width+1},(fe,ae)=>ae))}),pe(()=>Ve,()=>{v(m,Array.from({length:Ve.height+1},(fe,ae)=>ae))}),Ra();var he={screenToSvg:A};Zn();var we=du();V("keydown",Ds,F),V("keyup",Ds,le),V("mouseup",Ds,I),V("mousemove",Ds,C);let ne;var re=x(we),ue=b(re);f(ue,"x",d),f(ue,"y",d);var be=b(ue);Ye(be,1,()=>(J(Ve),c(()=>Array(Ve.width+1))),lt,(fe,ae,Fe)=>{var Ce=eu();f(Ce,"x1",d+Fe),f(Ce,"y1",d),f(Ce,"x2",d+Fe),U(()=>f(Ce,"y2",(J(Ve),c(()=>d+Ve.height)))),k(fe,Ce)});var Le=b(be);Ye(Le,1,()=>(J(Ve),c(()=>Array(Ve.height+1))),lt,(fe,ae,Fe)=>{var Ce=tu();f(Ce,"x1",d),f(Ce,"y1",d+Fe),f(Ce,"y2",d+Fe),U(()=>f(Ce,"x2",(J(Ve),c(()=>d+Ve.width)))),k(fe,Ce)});var ee=b(Le);Ye(ee,1,()=>(J(Ve),c(()=>Array(Math.floor(Ve.width/6)+1))),lt,(fe,ae,Fe)=>{var Ce=nu();f(Ce,"x1",d+Fe*6),f(Ce,"y1",d),f(Ce,"x2",d+Fe*6),U(()=>f(Ce,"y2",(J(Ve),c(()=>d+Ve.height)))),k(fe,Ce)});var K=b(ee);Ye(K,1,()=>(J(Ve),c(()=>Array(Math.floor(Ve.height/6)+1))),lt,(fe,ae,Fe)=>{var Ce=au();f(Ce,"x1",d),f(Ce,"y1",d+Fe*6),f(Ce,"y2",d+Fe*6),U(()=>f(Ce,"x2",(J(Ve),c(()=>d+Ve.width)))),k(fe,Ce)});var j=b(K);Ye(j,1,()=>e(l),lt,(fe,ae)=>{var Fe=ru(),Ce=_e(Fe);f(Ce,"y2",d);var Bt=b(Ce);{var Qe=st=>{var ut=su();f(ut,"y",1.2);var nt=x(ut);U(()=>{f(ut,"x",d+e(ae)),Re(nt,`${e(ae)??""}"`)}),k(st,ut)};te(Bt,st=>{e(ae)%6===0&&st(Qe)})}U(()=>{f(Ce,"x1",d+e(ae)),f(Ce,"y1",e(ae)%6===0?.5:d-.8),f(Ce,"x2",d+e(ae)),f(Ce,"stroke-width",e(ae)%6===0?.08:.04)}),k(fe,Fe)});var xe=b(j);Ye(xe,1,()=>e(l),lt,(fe,ae)=>{var Fe=ou(),Ce=_e(Fe),Bt=b(Ce);{var Qe=st=>{var ut=iu(),nt=x(ut);U(()=>{f(ut,"x",d+e(ae)),f(ut,"y",(J(Ve),c(()=>d+Ve.height+1.8))),Re(nt,`${e(ae)??""}"`)}),k(st,ut)};te(Bt,st=>{e(ae)%6===0&&st(Qe)})}U(()=>{f(Ce,"x1",d+e(ae)),f(Ce,"y1",(J(Ve),c(()=>d+Ve.height))),f(Ce,"x2",d+e(ae)),f(Ce,"y2",(J(Ve),e(ae),c(()=>d+Ve.height+(e(ae)%6===0?1.5:.8)))),f(Ce,"stroke-width",e(ae)%6===0?.08:.04)}),k(fe,Fe)});var W=b(xe);Ye(W,1,()=>e(m),lt,(fe,ae)=>{var Fe=cu(),Ce=_e(Fe);f(Ce,"x2",d);var Bt=b(Ce);{var Qe=st=>{var ut=lu();f(ut,"x",1);var nt=x(ut);U(()=>{f(ut,"y",d+e(ae)+.35),Re(nt,`${e(ae)??""}"`)}),k(st,ut)};te(Bt,st=>{e(ae)%6===0&&st(Qe)})}U(()=>{f(Ce,"x1",e(ae)%6===0?.5:d-.8),f(Ce,"y1",d+e(ae)),f(Ce,"y2",d+e(ae)),f(Ce,"stroke-width",e(ae)%6===0?.08:.04)}),k(fe,Fe)});var ye=b(W);Ye(ye,1,()=>e(m),lt,(fe,ae)=>{var Fe=mu(),Ce=_e(Fe),Bt=b(Ce);{var Qe=st=>{var ut=uu(),nt=x(ut);U(()=>{f(ut,"x",(J(Ve),c(()=>d+Ve.width+1))),f(ut,"y",d+e(ae)+.35),Re(nt,`${e(ae)??""}"`)}),k(st,ut)};te(Bt,st=>{e(ae)%6===0&&st(Qe)})}U(()=>{f(Ce,"x1",(J(Ve),c(()=>d+Ve.width))),f(Ce,"y1",d+e(ae)),f(Ce,"x2",(J(Ve),e(ae),c(()=>d+Ve.width+(e(ae)%6===0?1.5:.8)))),f(Ce,"y2",d+e(ae)),f(Ce,"stroke-width",e(ae)%6===0?.08:.04)}),k(fe,Fe)});var ke=b(ye);f(ke,"transform","translate(2, 2)");var dt=x(ke);return Fo(dt,n,"default",{screenToSvg:A}),kr(we,fe=>v(h,fe),()=>e(h)),U(()=>{f(we,"viewBox",e(o)),ne=Tn(we,0,"battlefield svelte-n43bnt",null,ne,{panning:e(T)||e(R)}),f(re,"width",(J(Ve),c(()=>Ve.width+d*2))),f(re,"height",(J(Ve),c(()=>Ve.height+d*2))),f(ue,"width",(J(Ve),c(()=>Ve.width))),f(ue,"height",(J(Ve),c(()=>Ve.height)))}),V("wheel",we,M),V("mousedown",we,D),V("dblclick",we,$),k(t,we),Zs(n,"screenToSvg",A),Fn(he)}var hu=ge('<line stroke="#3b82f6" stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" fill="#3b82f6" stroke="#1d4ed8" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-trljjm"></circle>',1),fu=ge('<g><g><rect role="button" tabindex="0" class="svelte-trljjm"></rect></g><!></g>');function jo(t,n){Hn(n,!1);const a=N(),r=N(),s=N(),i=N(),o=N();let l=Xe(n,"id",8),m=Xe(n,"x",8),h=Xe(n,"y",8),d=Xe(n,"width",8),p=Xe(n,"height",8),u=Xe(n,"rotation",8,0),y=Xe(n,"selected",8,!1),g=Xe(n,"screenToSvg",8),_=Xe(n,"onSelect",8,()=>{}),T=Xe(n,"onDrag",8,()=>{}),E=Xe(n,"onRotate",8,()=>{}),R=N(!1),L=!1,S={x:0,y:0};function A(be){be.stopPropagation(),_()(l())}function M(be){if(be.button!==0)return;be.preventDefault(),be.stopPropagation(),_()(l()),v(R,!0);const Le=g()(be.clientX,be.clientY);S={x:Le.x-m(),y:Le.y-h()},window.addEventListener("mousemove",D),window.addEventListener("mouseup",C)}function D(be){if(!e(R))return;const Le=g()(be.clientX,be.clientY);let ee=Le.x-S.x,K=Le.y-S.y;be.shiftKey||(ee=Math.round(ee),K=Math.round(K));const j=Math.max(d(),p())/2;ee=Math.max(-j,Math.min(Ve.width-d()+j,ee)),K=Math.max(-j,Math.min(Ve.height-p()+j,K)),T()(l(),ee,K)}function C(){v(R,!1),window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",C)}function I(be){be.preventDefault(),be.stopPropagation(),L=!0,window.addEventListener("mousemove",F),window.addEventListener("mouseup",le)}function F(be){if(!L)return;const Le=g()(be.clientX,be.clientY),ee=Le.x-e(a),K=Le.y-e(r);let j=Math.atan2(K,ee)*180/Math.PI+45;be.shiftKey||(j=Math.round(j/15)*15),E()(l(),j)}function le(){L=!1,window.removeEventListener("mousemove",F),window.removeEventListener("mouseup",le)}pe(()=>(J(m()),J(d())),()=>{v(a,m()+d()/2)}),pe(()=>(J(h()),J(p())),()=>{v(r,h()+p()/2)}),pe(()=>(J(d()),J(p())),()=>{v(s,Math.max(d(),p())/2+1.5)}),pe(()=>(e(a),e(s),J(u())),()=>{v(i,e(a)+e(s)*Math.cos((u()-45)*Math.PI/180))}),pe(()=>(e(r),e(s),J(u())),()=>{v(o,e(r)+e(s)*Math.sin((u()-45)*Math.PI/180))}),Ra(),Zn();var $=fu();let he;var we=x($),ne=x(we),re=b(we);{var ue=be=>{var Le=hu(),ee=_e(Le),K=b(ee);U(()=>{f(ee,"x1",e(a)),f(ee,"y1",e(r)),f(ee,"x2",e(i)),f(ee,"y2",e(o)),f(K,"cx",e(i)),f(K,"cy",e(o))}),V("mousedown",K,I),k(be,Le)};te(re,be=>{y()&&be(ue)})}U(()=>{he=Tn($,0,"terrain-rect svelte-trljjm",null,he,{selected:y(),dragging:e(R)}),f(we,"transform",`rotate(${u()??""}, ${e(a)??""}, ${e(r)??""})`),f(ne,"x",m()),f(ne,"y",h()),f(ne,"width",d()),f(ne,"height",p()),f(ne,"fill",y()?"rgba(59, 130, 246, 0.3)":"rgba(139, 90, 43, 0.3)"),f(ne,"stroke",y()?"#3b82f6":"#8b5a2b"),f(ne,"stroke-width",y()?.15:.1)}),V("click",ne,A),V("mousedown",ne,M),k(t,$),Fn()}const Zo="warhammer-deployment-layouts",Qo=[{label:'6" x 12"',width:6,height:12},{label:'5" x 10"',width:5,height:10},{label:'4" x 6"',width:4,height:6}],ai=[{label:"L 4x8",shape:"L-4x8"},{label:"L 4x8 â",shape:"L-4x8-mirror"},{label:"C 4-8-4",shape:"C-4-8-4"},{label:"L 5x6",shape:"L-5x6"},{label:"L 5x6 â",shape:"L-5x6-mirror"},{label:"L 4x6",shape:"L-4x6"},{label:"L 4x6 â",shape:"L-4x6-mirror"}],wi=[{name:"Layout 1",terrains:[{id:"a",x:28,y:0,width:4,height:6,rotation:0},{id:"b",x:28,y:38,width:4,height:6,rotation:0},{id:"c",x:6,y:5,width:6,height:12,rotation:0},{id:"d",x:48,y:27,width:6,height:12,rotation:0},{id:"e",x:16,y:28,width:6,height:12,rotation:0},{id:"f",x:7,y:19,width:6,height:12,rotation:90},{id:"g",x:38,y:4,width:6,height:12,rotation:0},{id:"h",x:47,y:13,width:6,height:12,rotation:90},{id:"i",x:32.74,y:23.59,width:5,height:10,rotation:135},{id:"j",x:35.06,y:19.5,width:4,height:6,rotation:45},{id:"k",x:22.07,y:10.17,width:5,height:10,rotation:-45},{id:"l",x:20.72,y:18.23,width:4,height:6,rotation:45}],walls:[{id:"wa",x:38,y:6,shape:"C-4-8-4",rotation:0},{id:"wb",x:18,y:30,shape:"C-4-8-4",rotation:180},{id:"wc",x:13.33,y:20.15,shape:"L-4x8-mirror",rotation:-90},{id:"wd",x:49.67,y:15.93,shape:"L-4x8-mirror",rotation:90},{id:"we",x:48.2,y:30.88,shape:"L-4x8",rotation:0},{id:"wf",x:7.84,y:5.01,shape:"L-4x8",rotation:180},{id:"wg",x:27.06,y:11.52,shape:"L-4x8-mirror",rotation:-45},{id:"wh",x:35.81,y:24.24,shape:"L-4x8-mirror",rotation:135}]},{name:"Layout 2",terrains:[{id:"a",x:31,y:7,width:4,height:6,rotation:-90},{id:"b",x:25,y:30,width:4,height:6,rotation:90},{id:"c",x:5,y:4,width:6,height:12,rotation:0},{id:"d",x:49,y:28,width:6,height:12,rotation:0},{id:"e",x:46,y:4,width:6,height:12,rotation:0},{id:"f",x:16.46,y:15.77,width:6,height:12,rotation:132.1},{id:"g",x:53,y:15,width:4,height:6,rotation:90},{id:"h",x:8,y:28,width:6,height:12,rotation:0},{id:"i",x:3,y:23,width:4,height:6,rotation:90},{id:"j",x:32.62,y:32.55,width:5,height:10,rotation:-90},{id:"k",x:22.48,y:.51,width:5,height:10,rotation:-90},{id:"l",x:37.5,y:16.2,width:6,height:12,rotation:132.1}],walls:[{id:"wa",x:49,y:32,shape:"L-4x8",rotation:0},{id:"wb",x:7,y:4,shape:"L-4x8",rotation:180},{id:"wc",x:46,y:8,shape:"L-4x8",rotation:0},{id:"wd",x:10,y:28,shape:"L-4x8",rotation:180},{id:"we",x:35.07,y:34.56,shape:"L-5x6-mirror",rotation:-90},{id:"wf",x:29.09,y:2.47,shape:"L-5x6-mirror",rotation:90},{id:"wg",x:17.86,y:17.53,shape:"C-4-8-4",rotation:135},{id:"wh",x:37.24,y:18.38,shape:"C-4-8-4",rotation:-45}]},{name:"Layout 3",terrains:[{id:"a",x:11,y:3,width:4,height:6,rotation:90},{id:"b",x:45,y:35,width:4,height:6,rotation:90},{id:"c",x:25,y:1,width:6,height:12,rotation:90},{id:"d",x:29,y:31,width:6,height:12,rotation:90},{id:"e",x:7.74,y:26.05,width:6,height:12,rotation:125.31},{id:"f",x:46.34,y:5.51,width:6,height:12,rotation:121.72},{id:"g",x:5.14,y:10.46,width:6,height:12,rotation:41.51},{id:"h",x:48.67,y:21.52,width:6,height:12,rotation:41.51},{id:"i",x:19.59,y:14.36,width:5,height:10,rotation:-38.13},{id:"j",x:20.69,y:24.37,width:4,height:6,rotation:-39.33},{id:"k",x:35.34,y:19.61,width:5,height:10,rotation:-38.13},{id:"l",x:35.31,y:13.5,width:4,height:6,rotation:-39.33}],walls:[{id:"aa",x:30,y:32,shape:"C-4-8-4",rotation:90},{id:"ab",x:26,y:4,shape:"C-4-8-4",rotation:-90},{id:"ac",x:8.19,y:11.64,shape:"L-4x8",rotation:222.46},{id:"ad",x:47.79,y:24.3,shape:"L-4x8",rotation:41.26},{id:"ae",x:38.64,y:20.09,shape:"L-5x6-mirror",rotation:141.31},{id:"af",x:25.26,y:17.9,shape:"L-5x6-mirror",rotation:-37.61},{id:"ag",x:14.37,y:28.38,shape:"L-4x8-mirror",rotation:-54.26},{id:"ah",x:48.75,y:7.3,shape:"L-4x8-mirror",rotation:122.02}]},{name:"Layout 4",terrains:[{id:"a",x:15,y:1,width:6,height:12,rotation:90},{id:"b",x:8,y:10,width:4,height:6,rotation:0},{id:"c",x:4,y:19,width:4,height:6,rotation:0},{id:"d",x:7.5,y:27.68,width:6,height:12,rotation:-48.57},{id:"e",x:46.53,y:4.24,width:6,height:12,rotation:-48.57},{id:"f",x:52,y:19,width:4,height:6,rotation:0},{id:"g",x:48,y:28,width:4,height:6,rotation:0},{id:"h",x:39,y:31,width:6,height:12,rotation:90},{id:"i",x:33.03,y:2.97,width:6,height:12,rotation:-37.25},{id:"j",x:20.96,y:28.96,width:6,height:12,rotation:-37.25},{id:"k",x:16.93,y:16.51,width:5,height:10,rotation:-41.85},{id:"l",x:37.96,y:17.43,width:5,height:10,rotation:-41.85}],walls:[{id:"aa",x:18,y:4,shape:"L-4x8",rotation:-90},{id:"ab",x:9.04,y:29.01,shape:"C-4-8-4",rotation:131.97},{id:"ac",x:47,y:7,shape:"C-4-8-4",rotation:-48.54},{id:"ad",x:38,y:32,shape:"L-4x8",rotation:90},{id:"ae",x:34.42,y:7.12,shape:"L-4x8",rotation:-37.53},{id:"af",x:21.57,y:28.8,shape:"L-4x8",rotation:142.46},{id:"ag",x:15.7,y:17.01,shape:"L-5x6",rotation:137.87},{id:"ah",x:39.17,y:20.85,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 5",terrains:[{id:"aa",x:27,y:1,width:6,height:12,rotation:90},{id:"ab",x:36.53,y:12.48,width:5,height:10,rotation:-90},{id:"ac",x:13,y:3,width:4,height:6,rotation:90},{id:"ad",x:43,y:35,width:4,height:6,rotation:90},{id:"ae",x:27,y:31,width:6,height:12,rotation:90},{id:"af",x:18.43,y:21.49,width:5,height:10,rotation:-90},{id:"ag",x:1,y:23,width:4,height:6,rotation:90},{id:"ah",x:55,y:15,width:4,height:6,rotation:90},{id:"ai",x:7.83,y:30.22,width:6,height:12,rotation:-60},{id:"aj",x:46.32,y:1.58,width:6,height:12,rotation:-60},{id:"ak",x:8.74,y:10.19,width:6,height:12,rotation:65.22},{id:"al",x:45.22,y:21.75,width:6,height:12,rotation:65.22}],walls:[{id:"a1",x:28,y:32,shape:"C-4-8-4",rotation:90},{id:"a2",x:28,y:4,shape:"C-4-8-4",rotation:-90},{id:"a3",x:11.88,y:12.29,shape:"L-4x8",rotation:-114.74},{id:"a4",x:43.97,y:23.59,shape:"L-4x8",rotation:64.22},{id:"a5",x:24.91,y:23.52,shape:"L-5x6-mirror",rotation:-90.37},{id:"a6",x:39,y:14.51,shape:"L-5x6-mirror",rotation:89.9},{id:"a7",x:7.58,y:30.57,shape:"L-4x8",rotation:120.93},{id:"a8",x:48.51,y:5.28,shape:"L-4x8",rotation:-59.06}]},{name:"Layout 6",terrains:[{id:"aa",x:13,y:1,width:6,height:12,rotation:90},{id:"ab",x:6,y:10,width:4,height:6,rotation:0},{id:"ac",x:25,y:11,width:4,height:6,rotation:90},{id:"ad",x:7.34,y:27.57,width:6,height:12,rotation:-40.32},{id:"ae",x:46.69,y:4.57,width:6,height:12,rotation:-41.9},{id:"af",x:31,y:27,width:4,height:6,rotation:-90},{id:"ag",x:50,y:28,width:4,height:6,rotation:0},{id:"ah",x:41,y:31,width:6,height:12,rotation:90},{id:"ai",x:34,y:4,width:6,height:12,rotation:0},{id:"aj",x:20,y:28,width:6,height:12,rotation:0},{id:"ak",x:15.7,y:15.03,width:5,height:10,rotation:-41.85},{id:"al",x:39.43,y:19.24,width:5,height:10,rotation:-39.95}],walls:[{id:"a1",x:16,y:4,shape:"L-4x8",rotation:-90},{id:"a2",x:9.04,y:29.01,shape:"C-4-8-4",rotation:140.05},{id:"a3",x:47,y:7.16,shape:"C-4-8-4",rotation:-41.53},{id:"a4",x:40,y:32,shape:"L-4x8",rotation:90},{id:"a5",x:34.15,y:7.88,shape:"L-4x8",rotation:0},{id:"a6",x:22,y:28,shape:"L-4x8",rotation:180},{id:"a7",x:14.47,y:15.47,shape:"L-5x6",rotation:137.87},{id:"a8",x:40.53,y:22.78,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 7",terrains:[{id:"aa",x:8,y:8,width:6,height:12,rotation:0},{id:"ab",x:6,y:28,width:6,height:12,rotation:0},{id:"ac",x:7,y:39,width:4,height:6,rotation:90},{id:"ad",x:18,y:26,width:5,height:10,rotation:0},{id:"ae",x:19,y:20,width:4,height:6,rotation:0},{id:"af",x:23,y:3,width:6,height:12,rotation:0},{id:"ag",x:31,y:29,width:6,height:12,rotation:0},{id:"ah",x:37,y:18,width:4,height:6,rotation:0},{id:"ai",x:37,y:8,width:5,height:10,rotation:0},{id:"aj",x:46,y:24,width:6,height:12,rotation:0},{id:"ak",x:48,y:4,width:6,height:12,rotation:0},{id:"al",x:49,y:-1,width:4,height:6,rotation:90}],walls:[{id:"a1",x:9,y:10,shape:"L-5x6",rotation:180},{id:"a2",x:11.44,y:31.97,shape:"L-4x8-mirror",rotation:0},{id:"a3",x:19,y:20,shape:"L-4x6",rotation:180},{id:"a4",x:22.53,y:30.02,shape:"L-5x6-mirror",rotation:0},{id:"a5",x:25,y:5,shape:"C-4-8-4",rotation:180},{id:"a6",x:31,y:31,shape:"C-4-8-4",rotation:0},{id:"a7",x:37,y:18,shape:"L-4x6",rotation:0},{id:"a8",x:41.51,y:8.09,shape:"L-5x6-mirror",rotation:180},{id:"a9",x:46,y:28,shape:"L-5x6",rotation:0},{id:"a10",x:51.51,y:4.01,shape:"L-4x8-mirror",rotation:180}]},{name:"Layout 8",terrains:[{id:"aa",x:23,y:22,width:4,height:6,rotation:0},{id:"ab",x:23,y:28,width:4,height:6,rotation:0},{id:"ac",x:33,y:16,width:4,height:6,rotation:0},{id:"ad",x:33,y:10,width:4,height:6,rotation:0},{id:"ae",x:41,y:19,width:6,height:12,rotation:0},{id:"af",x:13,y:13,width:6,height:12,rotation:0},{id:"ag",x:32,y:32,width:6,height:12,rotation:0},{id:"ah",x:22,y:0,width:6,height:12,rotation:0},{id:"ai",x:9.5,y:27.68,width:6,height:12,rotation:-48.69},{id:"aj",x:44.51,y:4.35,width:6,height:12,rotation:-48.69},{id:"ak",x:6.95,y:4,width:5,height:10,rotation:53.9},{id:"al",x:48,y:30,width:5,height:10,rotation:53.9}],walls:[{id:"a1",x:32,y:34,shape:"C-4-8-4",rotation:0},{id:"a2",x:24,y:2,shape:"C-4-8-4",rotation:180},{id:"a3",x:44.68,y:19.06,shape:"L-4x8-mirror",rotation:180},{id:"a4",x:18.43,y:16.91,shape:"L-4x8-mirror",rotation:0},{id:"a5",x:46.38,y:33.13,shape:"L-5x6",rotation:52.87},{id:"a6",x:8.55,y:4.89,shape:"L-5x6",rotation:-127.66},{id:"a7",x:16,y:30.28,shape:"L-4x8-mirror",rotation:-48.62},{id:"a8",x:46.91,y:5.85,shape:"L-4x8-mirror",rotation:132.19}]}];function pu(){return"terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Na(){const t=localStorage.getItem(Zo);if(t)try{return JSON.parse(t)}catch(n){return console.error("Failed to parse saved layouts:",n),{}}return{}}function Lr(t){localStorage.setItem(Zo,JSON.stringify(t))}function Jo(){const{subscribe:t,set:n,update:a}=rn([]);return{subscribe:t,set:n,update:a,add(r,s){a(i=>[...i,{id:pu(),x:30-r/2,y:22-s/2,width:r,height:s,rotation:0}])},updateTerrain(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){n([])},save(r){const s=da({subscribe:t}),i=Na();i[r]={terrains:s,savedAt:Date.now()},Lr(i)},load(r){const s=Na();return s[r]?(n(s[r].terrains),!0):!1},deleteLayout(r){const s=Na();delete s[r],Lr(s)},getSavedLayoutNames(){const r=Na();return Object.keys(r).map(s=>({name:s,savedAt:r[s].savedAt,terrainCount:r[s].terrains.length})).sort((s,i)=>i.savedAt-s.savedAt)},hasSaved(){const r=Na();return Object.keys(r).length>0}}}const On=Jo();function el(){const{subscribe:t,set:n,update:a}=rn([]);return{subscribe:t,set:n,update:a,add(r){a(s=>[...s,{id:"wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),x:30,y:22,shape:r,rotation:0}])},updateWall(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){n([])}}}const Rn=el(),vr=Jo(),gr=el(),br=rn(null),Tr=rn(null);function si(t){const n=t.includes("-mirror"),a=t.replace("-mirror","");if(a.startsWith("L-")){const r=a.match(/L-(\d+)x(\d+)/);if(r)return{type:"L",segments:[parseInt(r[1]),parseInt(r[2])],mirrored:n}}else if(a.startsWith("C-")){const r=a.match(/C-(\d+)-(\d+)-(\d+)/);if(r)return{type:"C",segments:[parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],mirrored:n}}return{type:"L",segments:[4,8],mirrored:!1}}function qa(t,n=null){const s=si(t),i=n||s.segments,o=s.mirrored;if(s.type==="L"){const[l,m]=i;return o?[{x:0,y:0},{x:.5,y:0},{x:.5,y:m},{x:-l+.5,y:m},{x:-l+.5,y:m-.5},{x:0,y:m-.5}]:[{x:0,y:0},{x:.5,y:0},{x:.5,y:m-.5},{x:l,y:m-.5},{x:l,y:m},{x:0,y:m}]}else if(s.type==="C"){const[l,m,h]=i;return[{x:0,y:0},{x:h,y:0},{x:h,y:.5},{x:.5,y:.5},{x:.5,y:m-.5},{x:l,y:m-.5},{x:l,y:m},{x:0,y:m}]}return[]}function dr(t,n,a,r){if(t.length===0)return[];const s=t.map(E=>E.x),i=t.map(E=>E.y),o=Math.min(...s),l=Math.max(...s),m=Math.min(...i),h=Math.max(...i),d=l-o,p=h-m,u=n+o+d/2,y=a+m+p/2,g=r*Math.PI/180,_=Math.cos(g),T=Math.sin(g);return t.map(E=>{const R=n+E.x,L=a+E.y,S=R-u,A=L-y;return{x:u+S*_-A*T,y:y+S*T+A*_}})}Ga(Rn,t=>t.map(n=>dr(qa(n.shape,n.segments),n.x,n.y,n.rotation)));const _a=rn(null),wa=rn(null),Si=rn([]);function yu(t,n=[]){const a=da(On),r=da(Rn),s=Na();s[t]={terrains:a,walls:r,models:n,savedAt:Date.now()},Lr(s)}function vu(t){const n=Na();return n[t]?(On.set(n[t].terrains||[]),Rn.set(n[t].walls||[]),{terrains:n[t].terrains||[],walls:n[t].walls||[],models:n[t].models||[]}):null}function gu(t){const n=Na();delete n[t],Lr(n)}function bu(){const t=Na();return Object.keys(t).map(n=>({name:n,savedAt:t[n].savedAt,terrainCount:(t[n].terrains||[]).length,wallCount:(t[n].walls||[]).length,modelCount:(t[n].models||[]).length})).sort((n,a)=>a.savedAt-n.savedAt)}function Qs(){Si.set(bu())}var Tu=ge('<line stroke="#3b82f6" stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" fill="#3b82f6" stroke="#1d4ed8" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-1tez9jd"></circle>',1),xu=ge('<g><g><path role="button" tabindex="0" class="svelte-1tez9jd"></path></g><!></g>');function Wr(t,n){Hn(n,!1);const a=N(),r=N(),s=N(),i=N(),o=N(),l=N(),m=N(),h=N(),d=N(),p=N();let u=Xe(n,"id",8),y=Xe(n,"x",8),g=Xe(n,"y",8),_=Xe(n,"shape",8),T=Xe(n,"segments",8,null),E=Xe(n,"rotation",8,0),R=Xe(n,"selected",8,!1),L=Xe(n,"screenToSvg",8),S=Xe(n,"onSelect",8,()=>{}),A=Xe(n,"onDrag",8,()=>{}),M=Xe(n,"onRotate",8,()=>{});function D(W){const ye=W.map(dt=>dt.x),ke=W.map(dt=>dt.y);return{minX:Math.min(...ye),maxX:Math.max(...ye),minY:Math.min(...ke),maxY:Math.max(...ke)}}let C=N(!1),I=!1,F={x:0,y:0};function le(W){W.stopPropagation(),S()(u())}function $(W){if(W.button!==0)return;W.preventDefault(),W.stopPropagation(),S()(u()),v(C,!0);const ye=L()(W.clientX,W.clientY);F={x:ye.x-y(),y:ye.y-g()},window.addEventListener("mousemove",he),window.addEventListener("mouseup",we)}function he(W){if(!e(C))return;const ye=L()(W.clientX,W.clientY);let ke=ye.x-F.x,dt=ye.y-F.y;W.shiftKey||(ke=Math.round(ke),dt=Math.round(dt));const fe=Math.max(e(s),e(i));ke=Math.max(-fe,Math.min(Ve.width+fe-e(s),ke)),dt=Math.max(-fe,Math.min(Ve.height+fe-e(i),dt)),A()(u(),ke,dt)}function we(){v(C,!1),window.removeEventListener("mousemove",he),window.removeEventListener("mouseup",we)}function ne(W){W.preventDefault(),W.stopPropagation(),I=!0,window.addEventListener("mousemove",re),window.addEventListener("mouseup",ue)}function re(W){if(!I)return;const ye=L()(W.clientX,W.clientY),ke=ye.x-e(o),dt=ye.y-e(l);let fe=Math.atan2(dt,ke)*180/Math.PI+45;W.shiftKey||(fe=Math.round(fe/15)*15),M()(u(),fe)}function ue(){I=!1,window.removeEventListener("mousemove",re),window.removeEventListener("mouseup",ue)}pe(()=>(J(_()),J(T())),()=>{v(a,qa(_(),T()))}),pe(()=>e(a),()=>{v(r,D(e(a)))}),pe(()=>e(r),()=>{v(s,e(r).maxX-e(r).minX)}),pe(()=>e(r),()=>{v(i,e(r).maxY-e(r).minY)}),pe(()=>(J(y()),e(r),e(s)),()=>{v(o,y()+e(r).minX+e(s)/2)}),pe(()=>(J(g()),e(r),e(i)),()=>{v(l,g()+e(r).minY+e(i)/2)}),pe(()=>(e(a),J(y()),J(g())),()=>{v(m,e(a).length>0?`M ${e(a).map(W=>`${y()+W.x},${g()+W.y}`).join(" L ")} Z`:"")}),pe(()=>(e(s),e(i)),()=>{v(h,Math.max(e(s),e(i))/2+1.5)}),pe(()=>(e(o),e(h),J(E())),()=>{v(d,e(o)+e(h)*Math.cos((E()-45)*Math.PI/180))}),pe(()=>(e(l),e(h),J(E())),()=>{v(p,e(l)+e(h)*Math.sin((E()-45)*Math.PI/180))}),Ra(),Zn();var be=xu();let Le;var ee=x(be),K=x(ee),j=b(ee);{var xe=W=>{var ye=Tu(),ke=_e(ye),dt=b(ke);U(()=>{f(ke,"x1",e(o)),f(ke,"y1",e(l)),f(ke,"x2",e(d)),f(ke,"y2",e(p)),f(dt,"cx",e(d)),f(dt,"cy",e(p))}),V("mousedown",dt,ne),k(W,ye)};te(j,W=>{R()&&W(xe)})}U(()=>{Le=Tn(be,0,"wall-piece svelte-1tez9jd",null,Le,{selected:R(),dragging:e(C)}),f(ee,"transform",`rotate(${E()??""}, ${e(o)??""}, ${e(l)??""})`),f(K,"d",e(m)),f(K,"fill",R()?"rgba(139, 69, 19, 0.6)":"rgba(139, 69, 19, 0.8)"),f(K,"stroke",R()?"#3b82f6":"#5c3317"),f(K,"stroke-width",R()?.15:.1)}),V("click",K,le),V("mousedown",K,$),k(t,be),Fn()}var _u=ve('<div class="section-content svelte-7o4pd4"><!></div>'),wu=ve('<section><div class="section-header svelte-7o4pd4" role="button" tabindex="0"><h3 class="svelte-7o4pd4"> </h3> <span class="toggle-icon svelte-7o4pd4"> </span></div> <!></section>');function cn(t,n){let a=Xe(n,"title",8),r=Xe(n,"defaultOpen",8,!0),s=N(r());function i(){v(s,!e(s))}var o=wu();let l;var m=x(o),h=x(m),d=x(h),p=b(h,2),u=x(p),y=b(m,2);{var g=_=>{var T=_u(),E=x(T);Fo(E,n,"default",{}),k(_,T)};te(y,_=>{e(s)&&_(g)})}U(()=>{l=Tn(o,1,"collapsible-section svelte-7o4pd4",null,l,{collapsed:!e(s)}),Re(d,a()),Re(u,e(s)?"â¼":"â¶")}),V("click",m,i),k(t,o)}const ha={battlefield:{fill:"#adbeadff"},terrain:{fill:"rgba(116, 102, 63, 0.71)",stroke:"#8b5a2b",strokeWidth:.15},wall:{fill:"rgba(52, 45, 39, 1)",stroke:"#000000ba",strokeWidth:.15},player1:{fill:"rgba(59, 130, 246, 0.6)",stroke:"#3b82f6",strokeWidth:.12},player2:{fill:"rgba(239, 68, 68, 0.6)",stroke:"#ef4444",strokeWidth:.12},modelName:{fill:"#ffffff",stroke:"#000000",strokeWidth:.05,fontWeight:"bold"},deploymentZone:{fillOpacity:.2,strokeWidth:.2,strokeDasharray:"0.5,0.25"},objective:{primary:{fill:"#9ca3af",stroke:"#000000",strokeWidth:.08},secondary:{fill:"#9ca3af",stroke:"#000000",strokeWidth:.08},controlRadius:{fillOpacity:.15,strokeWidth:.06,strokeDasharray:"0.3,0.15"},centerDot:{fill:"#000000",radius:.15}}};function tl(){const{subscribe:t,set:n,update:a}=rn({past:[],future:[]});return{subscribe:t,push(r){a(s=>({past:[...s.past,r],future:[]}))},undo(){let r=null;return a(s=>{if(s.past.length===0)return s;const i=[...s.past];return r=i.pop(),{past:i,future:[r,...s.future]}}),r},redo(){let r=null;return a(s=>{if(s.future.length===0)return s;const i=[...s.future];return r=i.shift(),{past:[...s.past,r],future:i}}),r},canUndo(){return da({subscribe:t}).past.length>0},canRedo(){return da({subscribe:t}).future.length>0},clear(){n({past:[],future:[]})}}}const Dn=tl(),ri=tl(),Wt=1/25.4,Vn={circles:[{type:"25mm",radius:25*Wt/2,label:"25mm"},{type:"28.5mm",radius:28.5*Wt/2,label:"28mm.5"},{type:"32mm",radius:32*Wt/2,label:"32mm"},{type:"40mm",radius:40*Wt/2,label:"40mm"},{type:"50mm",radius:50*Wt/2,label:"50mm"},{type:"60mm",radius:60*Wt/2,label:"60mm"},{type:"80mm",radius:80*Wt/2,label:"80mm"},{type:"90mm",radius:90*Wt/2,label:"90mm"},{type:"100mm",radius:100*Wt/2,label:"100mm"},{type:"130mm",radius:130*Wt/2,label:"130mm"},{type:"160mm",radius:160*Wt/2,label:"160mm"}],ovals:[{type:"60x35.5mm",width:60*Wt,height:35.5*Wt,label:"60Ã35.5mm"},{type:"75x42mm",width:75*Wt,height:42*Wt,label:"75Ã42mm"},{type:"Small Flying Base",width:75*Wt,height:42*Wt,label:"Small Flying"},{type:"90x52.5mm",width:90*Wt,height:52.5*Wt,label:"90Ã52.5mm"},{type:"Large Flying Base",width:90*Wt,height:52.5*Wt,label:"Large Flying"},{type:"105x70mm",width:105*Wt,height:70*Wt,label:"105Ã70mm"},{type:"120x92mm",width:120*Wt,height:92*Wt,label:"120Ã92mm"},{type:"150x95mm",width:150*Wt,height:95*Wt,label:"150Ã95mm"},{type:"170x109mm",width:170*Wt,height:109*Wt,label:"170Ã109mm"}]};function In(t,n=null){const a=Vn.circles.find(s=>s.type===t);if(a)return a;const r=Vn.ovals.find(s=>s.type===t);return r||(fa(t)&&n?{type:t,width:n.customWidth,height:n.customHeight,label:`${n.customWidth.toFixed(1)}"Ã${n.customHeight.toFixed(1)}"`}:null)}function bn(t){return Vn.ovals.some(n=>n.type===t)}function fa(t){return t&&t.startsWith("rect-")}function Gi(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function nl(t){const{subscribe:n,set:a,update:r}=rn([]);return{subscribe:n,set:a,update:r,add(s,i,o,l,m=null,h=!1){const d=Gi(),p={id:d,baseType:s,playerId:i,x:o,y:l,rotation:0};return m&&m.width&&m.height&&(p.customWidth=m.width,p.customHeight=m.height),r(u=>[...u,p]),!h&&t&&t.push({type:"add",modelId:d,model:{...p}}),d},updateModel(s,i,o=!1){let l=null,m=null;if(!o&&t){const d=da({subscribe:n}).find(p=>p.id===s);d&&(l={...d},"x"in i||"y"in i?m="move":"rotation"in i&&(m="rotate"))}if(r(h=>h.map(d=>d.id===s?{...d,...i}:d)),!o&&t&&m&&l){const d=da({subscribe:n}).find(p=>p.id===s);t.push({type:m,modelId:s,before:m==="move"?{x:l.x,y:l.y}:{rotation:l.rotation},after:m==="move"?{x:d.x,y:d.y}:{rotation:d.rotation}})}},remove(s,i=!1){let o=null;!i&&t&&(o=da({subscribe:n}).find(m=>m.id===s)),r(l=>l.filter(m=>m.id!==s)),!i&&t&&o&&t.push({type:"remove",modelId:s,model:{...o}})},removeByPlayer(s){r(i=>i.filter(o=>o.playerId!==s))},addBatch(s,i=!1){const o=[];return r(l=>{const m=[...l];return s.forEach(h=>{const d=h.id||Gi(),p={...h,id:d};m.push(p),o.push(d),!i&&t&&t.push({type:"add",modelId:d,model:{...p}})}),m}),o},updateUnit(s,i,o=!1){r(l=>l.map(m=>m.unitId===s?{...m,...i}:m))},removeUnit(s,i=!1){const o=[];if(!i&&t){const l=da({subscribe:n});o.push(...l.filter(m=>m.unitId===s))}r(l=>l.filter(m=>m.unitId!==s)),!i&&t&&o.forEach(l=>{t.push({type:"remove",modelId:l.id,model:{...l}})})},clear(){a([]),t&&t.clear()},undo(){if(!t)return;const s=t.undo();if(s)switch(s.type){case"add":this.remove(s.modelId,!0);break;case"remove":r(i=>[...i,s.model]);break;case"move":this.updateModel(s.modelId,s.before,!0);break;case"rotate":this.updateModel(s.modelId,s.before,!0);break}},redo(){if(!t)return;const s=t.redo();if(s)switch(s.type){case"add":r(i=>[...i,s.model]);break;case"remove":this.remove(s.modelId,!0);break;case"move":this.updateModel(s.modelId,s.after,!0);break;case"rotate":this.updateModel(s.modelId,s.after,!0);break}}}}const ht=nl(Dn),al=Ga(ht,t=>t.filter(n=>n.playerId===1)),sl=Ga(ht,t=>t.filter(n=>n.playerId===2)),Su=rn(null);Ga([ht,Su],([t,n])=>n?t.find(a=>a.id===n):null);const ja=nl(ri),us=rn(null);Ga([ja,us],([t,n])=>n?t.find(a=>a.id===n):null);const rl=1/25.4,Yr=40*rl/2,Hr=3+20*rl;function il(t="item"){return t+"-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Au(){const{subscribe:t,set:n,update:a}=rn([]);return{subscribe:t,set:n,update:a,add(r){const s=il("zone");return a(i=>[...i,{id:s,...r}]),s},updateZone(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){n([])}}}function Cu(){const{subscribe:t,set:n,update:a}=rn([]);return{subscribe:t,set:n,update:a,add(r,s,i=!1){const o=il("obj"),l=Math.round(r),m=Math.round(s);return a(h=>[...h,{id:o,x:l,y:m,isPrimary:i}]),o},updateObjective(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){n([])}}}Au();Cu();const ol=[{name:"Dawn of War",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:32},{type:"L",x:60,y:32},{type:"L",x:60,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:0,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:12},{type:"L",x:0,y:12},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1}]},{name:"Hammer and Anvil",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:18,y:0},{type:"L",x:18,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:42,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:42,y:44},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1}]},{name:"Tipping Point",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:12,y:0},{type:"L",x:12,y:22},{type:"L",x:20,y:22},{type:"L",x:20,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:40,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:48,y:44},{type:"L",x:48,y:22},{type:"L",x:40,y:22},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:34,isPrimary:!1},{x:22,y:8,isPrimary:!1},{x:38,y:36,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Search and Destroy",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:22},{type:"L",x:21,y:22},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:0,x:30,y:31},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:30,y:0},{type:"L",x:30,y:13},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:1,x:39,y:22},{type:"L",x:60,y:22},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:10,isPrimary:!1},{x:46,y:34,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Sweeping Engagement",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:0,y:8},{type:"L",x:30,y:8},{type:"L",x:30,y:14},{type:"L",x:60,y:14},{type:"L",x:60,y:0},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:0,y:44},{type:"L",x:60,y:44},{type:"L",x:60,y:36},{type:"L",x:30,y:36},{type:"L",x:30,y:30},{type:"L",x:0,y:30},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:18,isPrimary:!1},{x:50,y:26,isPrimary:!1},{x:18,y:38,isPrimary:!1},{x:42,y:6,isPrimary:!1}]},{name:"Crucible of Battle",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:60,y:44},{type:"L",x:30,y:0},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:20,y:8,isPrimary:!1},{x:40,y:36,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]}];function Hs(t){return t.map(n=>{switch(n.type){case"M":return`M ${n.x} ${n.y}`;case"L":return`L ${n.x} ${n.y}`;case"A":return`A ${n.rx} ${n.ry} ${n.rotation} ${n.largeArc} ${n.sweep} ${n.x} ${n.y}`;case"Z":return"Z";default:return""}}).join(" ")}const ar={pixelsPerInch:50,pngScale:2,fontSizeMultiplier:{circle:.8,oval:.6,rectangle:.35}};function Eu(t){const n=ha.deploymentZone;return`<path
    d="${Hs(t.path)}"
    fill="${t.borderColor}"
    fill-opacity="${n.fillOpacity}"
    stroke="${t.borderColor}"
    stroke-width="${n.strokeWidth}"
    stroke-dasharray="${n.strokeDasharray}"
  />`}function ku(t){const n=t.isPrimary?ha.objective.primary:ha.objective.secondary,a=ha.objective.controlRadius,r=ha.objective.centerDot,s=`<circle
    cx="${t.x}"
    cy="${t.y}"
    r="${Hr}"
    fill="${n.fill}"
    fill-opacity="${a.fillOpacity}"
    stroke="${n.fill}"
    stroke-width="${a.strokeWidth}"
    stroke-dasharray="${a.strokeDasharray}"
  />`,i=`<circle
    cx="${t.x}"
    cy="${t.y}"
    r="${Yr}"
    fill="${n.fill}"
    stroke="${n.stroke}"
    stroke-width="${n.strokeWidth}"
  />`,o=`<circle
    cx="${t.x}"
    cy="${t.y}"
    r="${r.radius}"
    fill="${r.fill}"
  />`;return s+i+o}function Mu(t){const{x:n,y:a,width:r,height:s,rotation:i}=t,o=n+r/2,l=a+s/2,m=ha.terrain;return`<rect
    x="${n}"
    y="${a}"
    width="${r}"
    height="${s}"
    transform="rotate(${i}, ${o}, ${l})"
    fill="${m.fill}"
    stroke="${m.stroke}"
    stroke-width="${m.strokeWidth}"
  />`}function Ru(t){const n=qa(t.shape,t.segments),a=dr(n,t.x,t.y,t.rotation);if(a.length===0)return"";const r=a.map((i,o)=>`${o===0?"M":"L"} ${i.x} ${i.y}`).join(" ")+" Z",s=ha.wall;return`<path
    d="${r}"
    fill="${s.fill}"
    stroke="${s.stroke}"
    stroke-width="${s.strokeWidth}"
  />`}function Lu(t){const n=In(t.baseType,t),a=bn(t.baseType),r=fa(t.baseType),s=t.playerId===1?ha.player1:ha.player2,i=ha.modelName;let o="",l=0;if(r){const h=t.customWidth||0,d=t.customHeight||0,p=t.x,u=t.y;l=Math.min(h,d)*ar.fontSizeMultiplier.rectangle,o=`<g transform="rotate(${t.rotation||0}, ${p}, ${u})">
      <rect
        x="${p-h/2}"
        y="${u-d/2}"
        width="${h}"
        height="${d}"
        fill="${s.fill}"
        stroke="${s.stroke}"
        stroke-width="${s.strokeWidth}"
      />
    </g>`}else if(a){const h=n.width/2,d=n.height/2;l=Math.min(h,d)*ar.fontSizeMultiplier.oval,o=`<g transform="rotate(${t.rotation||0}, ${t.x}, ${t.y})">
      <ellipse
        cx="${t.x}"
        cy="${t.y}"
        rx="${h}"
        ry="${d}"
        fill="${s.fill}"
        stroke="${s.stroke}"
        stroke-width="${s.strokeWidth}"
      />
    </g>`}else{const h=n?.radius||.5;l=h*ar.fontSizeMultiplier.circle,o=`<circle
      cx="${t.x}"
      cy="${t.y}"
      r="${h}"
      fill="${s.fill}"
      stroke="${s.stroke}"
      stroke-width="${s.strokeWidth}"
    />`}let m="";return t.name&&(m=`<text
      x="${t.x}"
      y="${t.y}"
      text-anchor="middle"
      dominant-baseline="middle"
      font-size="${l}"
      font-weight="${i.fontWeight}"
      fill="${i.fill}"
      stroke="${i.stroke}"
      stroke-width="${i.strokeWidth}"
      paint-order="stroke"
    >${Du(t.name)}</text>`),o+m}function Du(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Iu(t,n,a,r=null){const s=Ve.width,i=Ve.height,o=ha.battlefield.fill,l=ar.pixelsPerInch,m=t.map(Mu).join(`
    `),h=n.map(Ru).join(`
    `),d=a.map(Lu).join(`
    `),p=r?.zones?r.zones.map(Eu).join(`
    `):"",u=r?.objectives?r.objectives.map(ku).join(`
    `):"";return`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${s} ${i}" width="${s*l}" height="${i*l}">
  <!-- Battlefield background -->
  <rect x="0" y="0" width="${s}" height="${i}" fill="${o}" />

  <!-- Deployment zones -->
  <g id="deployment-zones">
    ${p}
  </g>

  <!-- Objectives -->
  <g id="objectives">
    ${u}
  </g>

  <!-- Terrain pieces -->
  <g id="terrains">
    ${m}
  </g>

  <!-- Wall pieces -->
  <g id="walls">
    ${h}
  </g>

  <!-- Model bases -->
  <g id="models">
    ${d}
  </g>
</svg>`}function $u(t,n=1){return new Promise((a,r)=>{const s=new Image,i=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(i);s.onload=()=>{const l=document.createElement("canvas");l.width=s.width*n,l.height=s.height*n;const m=l.getContext("2d");m.scale(n,n),m.drawImage(s,0,0),URL.revokeObjectURL(o),l.toBlob(h=>{h?a(h):r(new Error("Failed to create PNG blob"))},"image/png")},s.onerror=()=>{URL.revokeObjectURL(o),r(new Error("Failed to load SVG image"))},s.src=o})}async function Ai(t,n,a=[],r="battlefield",s=null){try{const i=Iu(t,n,a,s),o=await $u(i,ar.pngScale),l=URL.createObjectURL(o),m=document.createElement("a");return m.href=l,m.download=`${r}.png`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(l),!0}catch(i){throw console.error("Failed to export PNG:",i),i}}var Pu=ve('<button class="svelte-10mgcx0"> </button>'),Nu=ve('<div class="button-group svelte-10mgcx0"></div>'),Ou=ve('<button class="svelte-10mgcx0"> </button>'),Wu=ve('<div class="button-group svelte-10mgcx0"></div>'),Yu=ve('<div class="field svelte-10mgcx0"><label for="edit-width" class="svelte-10mgcx0">Width (inches)</label> <input id="edit-width" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-height" class="svelte-10mgcx0">Length (inches)</label> <input id="edit-height" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-rotation" class="svelte-10mgcx0">Rotation (Â°)</label> <input id="edit-rotation" type="number" step="15" class="svelte-10mgcx0"/></div>',1),Hu=ve('<div class="field svelte-10mgcx0"><label for="edit-seg1" class="svelte-10mgcx0">Horizontal (inches)</label> <input id="edit-seg1" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg2" class="svelte-10mgcx0">Vertical (inches)</label> <input id="edit-seg2" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div>',1),Fu=ve('<div class="field svelte-10mgcx0"><label for="edit-seg1" class="svelte-10mgcx0">Top Width (inches)</label> <input id="edit-seg1" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg2" class="svelte-10mgcx0">Length (inches)</label> <input id="edit-seg2" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg3" class="svelte-10mgcx0">Bottom Width (inches)</label> <input id="edit-seg3" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div>',1),Bu=ve('<div class="field svelte-10mgcx0"><span class="label-text svelte-10mgcx0">Shape</span> <span class="value svelte-10mgcx0"> </span></div> <!> <div class="field svelte-10mgcx0"><label for="edit-rotation" class="svelte-10mgcx0">Rotation (Â°)</label> <input id="edit-rotation" type="number" step="15" class="svelte-10mgcx0"/></div>',1),qu=ve('<div class="edit-form svelte-10mgcx0"><div class="field svelte-10mgcx0"><label for="edit-x" class="svelte-10mgcx0">X (inches)</label> <input id="edit-x" type="number" step="0.1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-y" class="svelte-10mgcx0">Y (inches)</label> <input id="edit-y" type="number" step="0.1" class="svelte-10mgcx0"/></div> <!> <button class="danger svelte-10mgcx0">Remove</button></div>'),Uu=ve('<p class="hint svelte-10mgcx0">Click a piece to select it</p>'),Ku=ve('<div class="button-group vertical svelte-10mgcx0"><button class="svelte-10mgcx0">Save Layout</button> <button class="svelte-10mgcx0">Load Layout</button> <div class="button-row svelte-10mgcx0"><button class="secondary small svelte-10mgcx0">Export</button> <button class="secondary small svelte-10mgcx0">Import</button></div> <button class="secondary svelte-10mgcx0">Clear All</button></div>'),Gu=ve("<!> <!>",1),zu=ve('<div class="modal-overlay svelte-10mgcx0" role="presentation"><div class="modal svelte-10mgcx0" role="dialog"><h2 class="svelte-10mgcx0">Save Layout</h2> <div class="modal-field svelte-10mgcx0"><label for="layout-name" class="svelte-10mgcx0">Layout Name</label> <input id="layout-name" type="text" placeholder="Enter a name..." class="svelte-10mgcx0"/></div> <div class="modal-actions svelte-10mgcx0"><button class="secondary svelte-10mgcx0">Cancel</button> <button class="svelte-10mgcx0">Save</button></div></div></div>'),Xu=ve('<p class="hint svelte-10mgcx0">No saved layouts yet</p>'),Vu=ve('<div class="layout-item svelte-10mgcx0" role="button" tabindex="0"><div class="layout-info svelte-10mgcx0"><span class="layout-name svelte-10mgcx0"> </span> <span class="layout-meta svelte-10mgcx0"> </span></div> <button class="delete-btn svelte-10mgcx0" title="Delete">Ã</button></div>'),ju=ve('<div class="layout-list svelte-10mgcx0"></div>'),Zu=ve('<div class="modal-overlay svelte-10mgcx0" role="presentation"><div class="modal svelte-10mgcx0" role="dialog"><h2 class="svelte-10mgcx0">Load Layout</h2> <!> <div class="modal-actions svelte-10mgcx0"><button class="secondary svelte-10mgcx0">Cancel</button></div></div></div>'),Qu=ve('<main class="svelte-10mgcx0"><div class="layout svelte-10mgcx0"><div class="sidebar svelte-10mgcx0"><!> <!> <!> <!> <input type="file" accept=".json" style="display: none;"/></div> <div class="battlefield-area svelte-10mgcx0"><div class="battlefield-container svelte-10mgcx0" role="presentation"><!></div> <div class="info svelte-10mgcx0"><p class="svelte-10mgcx0"> </p> <p class="hint svelte-10mgcx0">Scroll to zoom | Space+drag or middle-click to pan | Double-click to reset view</p></div></div></div></main> <!> <!>',1);function Ju(t,n){Hn(n,!1);const a=()=>Dt(_a,"$selectedTerrainId",l),r=()=>Dt(wa,"$selectedWallId",l),s=()=>Dt(On,"$layoutTerrains",l),i=()=>Dt(Rn,"$layoutWalls",l),o=()=>Dt(Si,"$savedLayoutsList",l),[l,m]=Gs(),h=N(),d=N();let p=N(!1),u=N(!1),y=N(""),g=null;ws(()=>{Qs(),window.addEventListener("keydown",_)}),xi(()=>{window.removeEventListener("keydown",_)});function _(Y){if(Y.target.tagName==="INPUT"||e(p)||e(u))return;const B=a()||r();if((Y.key==="Delete"||Y.key==="Backspace")&&B){Y.preventDefault(),Le();return}if(B&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(Y.key)){Y.preventDefault();const Te=Y.shiftKey?.1:1;let Be=0,Ee=0;switch(Y.key){case"ArrowUp":Ee=-Te;break;case"ArrowDown":Ee=Te;break;case"ArrowLeft":Be=-Te;break;case"ArrowRight":Be=Te;break}if(a()){const ot=s().find(at=>at.id===a());ot&&On.updateTerrain(a(),{x:ot.x+Be,y:ot.y+Ee})}else if(r()){const ot=i().find(at=>at.id===r());ot&&Rn.updateWall(r(),{x:ot.x+Be,y:ot.y+Ee})}return}if(Y.key==="c"&&(Y.ctrlKey||Y.metaKey)&&B){if(Y.preventDefault(),a()){const Te=s().find(Be=>Be.id===a());Te&&(g={type:"terrain",data:{...Te}})}else if(r()){const Te=i().find(Be=>Be.id===r());Te&&(g={type:"wall",data:{...Te}})}return}if(Y.key==="v"&&(Y.ctrlKey||Y.metaKey)&&g){if(Y.preventDefault(),g.type==="terrain"){const Te="terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),Be={...g.data,id:Te,x:g.data.x+2,y:g.data.y+2};On.update(Ee=>[...Ee,Be]),_a.set(Te),wa.set(null),g.data.x+=2,g.data.y+=2}else if(g.type==="wall"){const Te="wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),Be={...g.data,id:Te,x:g.data.x+2,y:g.data.y+2};Rn.update(Ee=>[...Ee,Be]),wa.set(Te),_a.set(null),g.data.x+=2,g.data.y+=2}return}if(Y.key==="Escape"){we();return}}let T=N(""),E=N(""),R=N(""),L=N(""),S=N(""),A=N(""),M=N(""),D=N("");function C(Y){return Y.segments?Y.segments:si(Y.shape).segments}function I(Y){return si(Y.shape).type}function F(Y,B){On.add(Y,B)}function le(Y){Rn.add(Y)}function $(Y){_a.set(Y),wa.set(null)}function he(Y){wa.set(Y),_a.set(null)}function we(){_a.set(null),wa.set(null)}function ne(Y,B,Te){On.updateTerrain(Y,{x:B,y:Te})}function re(Y,B,Te){Rn.updateWall(Y,{x:B,y:Te})}function ue(Y,B){On.updateTerrain(Y,{rotation:B})}function be(Y,B){Rn.updateWall(Y,{rotation:B})}function Le(){a()?(On.remove(a()),_a.set(null)):r()&&(Rn.remove(r()),wa.set(null))}function ee(){const Y=parseFloat(e(T)),B=parseFloat(e(E));!isNaN(Y)&&!isNaN(B)&&(a()?On.updateTerrain(a(),{x:Y,y:B}):r()&&Rn.updateWall(r(),{x:Y,y:B}))}function K(){if(!a())return;const Y=parseFloat(e(R)),B=parseFloat(e(L));!isNaN(Y)&&!isNaN(B)&&Y>0&&B>0&&On.updateTerrain(a(),{width:Y,height:B})}function j(){const Y=parseFloat(e(S));isNaN(Y)||(a()?On.updateTerrain(a(),{rotation:Y}):r()&&Rn.updateWall(r(),{rotation:Y}))}function xe(){if(!r()||!e(d))return;const Y=I(e(d)),B=parseFloat(e(A)),Te=parseFloat(e(M));if(isNaN(B)||isNaN(Te)||B<=0||Te<=0)return;let Be;if(Y==="C"){const Ee=parseFloat(e(D));if(isNaN(Ee)||Ee<=0)return;Be=[B,Te,Ee]}else Be=[B,Te];Rn.updateWall(r(),{segments:Be})}function W(){v(y,""),v(p,!0)}function ye(){e(y).trim()&&(yu(e(y).trim()),Qs(),v(p,!1),v(y,""))}function ke(){Qs(),v(u,!0)}function dt(Y){vu(Y),_a.set(null),wa.set(null),v(u,!1)}function fe(Y,B){B.stopPropagation(),confirm(`Delete layout "${Y}"?`)&&(gu(Y),Qs())}function ae(){confirm("Clear all terrain and walls?")&&(On.clear(),Rn.clear(),_a.set(null),wa.set(null))}function Fe(Y){return new Date(Y).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function Ce(Y){const B=ai.find(Te=>Te.shape===Y);return B?B.label:Y}function Bt(){const Y=prompt("Layout name (for the recipient):","Custom Layout");if(Y===null)return;const B=s(),Te=i(),Be={version:1,name:Y||"Custom Layout",exportedAt:new Date().toISOString(),terrainCount:B.length,wallCount:Te.length,terrains:B,walls:Te},Ee=JSON.stringify(Be,null,2),ot=new Blob([Ee],{type:"application/json"}),at=URL.createObjectURL(ot),$e=document.createElement("a");$e.href=at;const ze=(Y||"layout").toLowerCase().replace(/[^a-z0-9]+/g,"-");$e.download=`${ze}-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild($e),$e.click(),document.body.removeChild($e),URL.revokeObjectURL(at)}let Qe=N();function st(){e(Qe).click()}function ut(Y){const B=Y.target.files[0];if(!B)return;const Te=new FileReader;Te.onload=Be=>{try{const Ee=JSON.parse(Be.target.result);Ee.terrains&&Array.isArray(Ee.terrains)&&On.set(Ee.terrains),Ee.walls&&Array.isArray(Ee.walls)&&Rn.set(Ee.walls),_a.set(null),wa.set(null);const ot=Ee.name||"Unknown",at=Ee.terrains?.length||0,$e=Ee.walls?.length||0;alert(`Imported "${ot}"
${at} terrain(s), ${$e} wall(s)`)}catch(Ee){alert("Failed to import layout: Invalid file format"),console.error("Import error:",Ee)}},Te.readAsText(B),Y.target.value=""}pe(()=>(s(),a()),()=>{v(h,s().find(Y=>Y.id===a()))}),pe(()=>(i(),r()),()=>{v(d,i().find(Y=>Y.id===r()))}),pe(()=>(e(h),e(d)),()=>{if(e(h))v(T,e(h).x.toFixed(1)),v(E,e(h).y.toFixed(1)),v(R,e(h).width.toString()),v(L,e(h).height.toString()),v(S,Math.round(e(h).rotation).toString());else if(e(d)){v(T,e(d).x.toFixed(1)),v(E,e(d).y.toFixed(1)),v(S,Math.round(e(d).rotation).toString());const Y=C(e(d));v(A,Y[0]?.toString()||""),v(M,Y[1]?.toString()||""),v(D,Y[2]?.toString()||"")}}),Ra(),Zn();var nt=Qu(),yt=_e(nt),Mt=x(yt),un=x(Mt),oe=x(un);cn(oe,{title:"Add Terrain",children:(Y,B)=>{var Te=Nu();Ye(Te,5,()=>Qo,lt,(Be,Ee)=>{var ot=Pu(),at=x(ot);U(()=>Re(at,(e(Ee),c(()=>e(Ee).label)))),V("click",ot,()=>F(e(Ee).width,e(Ee).height)),k(Be,ot)}),k(Y,Te)},$$slots:{default:!0}});var De=b(oe,2);cn(De,{title:"Add Wall",children:(Y,B)=>{var Te=Wu();Ye(Te,5,()=>ai,lt,(Be,Ee)=>{var ot=Ou(),at=x(ot);U(()=>Re(at,(e(Ee),c(()=>e(Ee).label)))),V("click",ot,()=>le(e(Ee).shape)),k(Be,ot)}),k(Y,Te)},$$slots:{default:!0}});var Ge=b(De,2);{let Y=Ie(()=>e(h)?"Terrain":e(d)?"Wall":"Item");cn(Ge,{get title(){return`Selected ${e(Y)??""}`},children:(B,Te)=>{var Be=xt(),Ee=_e(Be);{var ot=$e=>{var ze=qu(),Yt=x(ze),Kt=b(x(Yt),2),qt=b(Yt,2),ya=b(x(qt),2),va=b(qt,2);{var ga=wn=>{var Qn=Yu(),Bn=_e(Qn),P=b(x(Bn),2),Z=b(Bn,2),se=b(x(Z),2),Pe=b(Z,2),Oe=b(x(Pe),2);Mn(P,()=>e(R),We=>v(R,We)),V("change",P,K),Mn(se,()=>e(L),We=>v(L,We)),V("change",se,K),Mn(Oe,()=>e(S),We=>v(S,We)),V("change",Oe,j),k(wn,Qn)},ra=wn=>{var Qn=xt(),Bn=_e(Qn);{var P=Z=>{var se=Bu(),Pe=_e(se),Oe=b(x(Pe),2),We=x(Oe),He=b(Pe,2);{var et=At=>{var jt=Hu(),on=_e(jt),Sn=b(x(on),2),dn=b(on,2),tn=b(x(dn),2);Mn(Sn,()=>e(A),Et=>v(A,Et)),V("change",Sn,xe),Mn(tn,()=>e(M),Et=>v(M,Et)),V("change",tn,xe),k(At,jt)},vt=At=>{var jt=xt(),on=_e(jt);{var Sn=dn=>{var tn=Fu(),Et=_e(tn),Gt=b(x(Et),2),yn=b(Et,2),vn=b(x(yn),2),En=b(yn,2),kn=b(x(En),2);Mn(Gt,()=>e(A),hn=>v(A,hn)),V("change",Gt,xe),Mn(vn,()=>e(M),hn=>v(M,hn)),V("change",vn,xe),Mn(kn,()=>e(D),hn=>v(D,hn)),V("change",kn,xe),k(dn,tn)};te(on,dn=>{e(d),c(()=>I(e(d))==="C")&&dn(Sn)},!0)}k(At,jt)};te(He,At=>{e(d),c(()=>I(e(d))==="L")?At(et):At(vt,!1)})}var en=b(He,2),Ft=b(x(en),2);U(At=>Re(We,At),[()=>(e(d),c(()=>Ce(e(d).shape)))]),Mn(Ft,()=>e(S),At=>v(S,At)),V("change",Ft,j),k(Z,se)};te(Bn,Z=>{e(d)&&Z(P)},!0)}k(wn,Qn)};te(va,wn=>{e(h)?wn(ga):wn(ra,!1)})}var rs=b(va,2);Mn(Kt,()=>e(T),wn=>v(T,wn)),V("change",Kt,ee),Mn(ya,()=>e(E),wn=>v(E,wn)),V("change",ya,ee),V("click",rs,Le),k($e,ze)},at=$e=>{var ze=Uu();k($e,ze)};te(Ee,$e=>{e(h)||e(d)?$e(ot):$e(at,!1)})}k(B,Be)},$$slots:{default:!0}})}var It=b(Ge,2);cn(It,{title:"Layout",children:(Y,B)=>{var Te=Ku(),Be=x(Te),Ee=b(Be,2),ot=b(Ee,2),at=x(ot),$e=b(at,2),ze=b(ot,2);U(()=>Ee.disabled=(o(),c(()=>o().length===0))),V("click",Be,W),V("click",Ee,ke),V("click",at,Bt),V("click",$e,st),V("click",ze,ae),k(Y,Te)},$$slots:{default:!0}});var _t=b(It,2);kr(_t,Y=>v(Qe,Y),()=>e(Qe));var Ot=b(un,2),Vt=x(Ot),Pn=x(Vt);mr(Pn,{children:$r,$$slots:{default:(Y,B)=>{const Te=Ie(()=>B.screenToSvg);var Be=Gu(),Ee=_e(Be);Ye(Ee,1,s,at=>at.id,(at,$e)=>{{let ze=Ie(()=>(e($e),a(),c(()=>e($e).id===a())));jo(at,{get id(){return e($e),c(()=>e($e).id)},get x(){return e($e),c(()=>e($e).x)},get y(){return e($e),c(()=>e($e).y)},get width(){return e($e),c(()=>e($e).width)},get height(){return e($e),c(()=>e($e).height)},get rotation(){return e($e),c(()=>e($e).rotation)},get selected(){return e(ze)},get screenToSvg(){return e(Te)},onSelect:$,onDrag:ne,onRotate:ue})}});var ot=b(Ee,2);Ye(ot,1,i,at=>at.id,(at,$e)=>{{let ze=Ie(()=>(e($e),r(),c(()=>e($e).id===r())));Wr(at,{get id(){return e($e),c(()=>e($e).id)},get x(){return e($e),c(()=>e($e).x)},get y(){return e($e),c(()=>e($e).y)},get shape(){return e($e),c(()=>e($e).shape)},get segments(){return e($e),c(()=>e($e).segments)},get rotation(){return e($e),c(()=>e($e).rotation)},get selected(){return e(ze)},get screenToSvg(){return e(Te)},onSelect:he,onDrag:re,onRotate:be})}}),k(Y,Be)}}});var pn=b(Vt,2),Jt=x(pn),Ne=x(Jt),Je=b(yt,2);{var rt=Y=>{var B=zu(),Te=x(B),Be=b(x(Te),2),Ee=b(x(Be),2),ot=b(Be,2),at=x(ot),$e=b(at,2);U(ze=>$e.disabled=ze,[()=>(e(y),c(()=>!e(y).trim()))]),Mn(Ee,()=>e(y),ze=>v(y,ze)),V("keydown",Ee,ze=>ze.key==="Enter"&&ye()),V("click",at,()=>v(p,!1)),V("click",$e,ye),V("click",Te,Hi(function(ze){Bi.call(this,n,ze)})),V("click",B,()=>v(p,!1)),k(Y,B)};te(Je,Y=>{e(p)&&Y(rt)})}var St=b(Je,2);{var Ut=Y=>{var B=Zu(),Te=x(B),Be=b(x(Te),2);{var Ee=ze=>{var Yt=Xu();k(ze,Yt)},ot=ze=>{var Yt=ju();Ye(Yt,5,o,lt,(Kt,qt)=>{var ya=Vu(),va=x(ya),ga=x(va),ra=x(ga),rs=b(ga,2),wn=x(rs),Qn=b(va,2);U(Bn=>{Re(ra,(e(qt),c(()=>e(qt).name))),Re(wn,`${e(qt),c(()=>e(qt).terrainCount)??""} terrain${e(qt),c(()=>e(qt).terrainCount!==1?"s":"")??""}, ${e(qt),c(()=>e(qt).wallCount||0)??""} wall${e(qt),c(()=>(e(qt).wallCount||0)!==1?"s":"")??""} Â· ${Bn??""}`)},[()=>(e(qt),c(()=>Fe(e(qt).savedAt)))]),V("click",Qn,Bn=>fe(e(qt).name,Bn)),V("click",ya,()=>dt(e(qt).name)),k(Kt,ya)}),k(ze,Yt)};te(Be,ze=>{o(),c(()=>o().length===0)?ze(Ee):ze(ot,!1)})}var at=b(Be,2),$e=x(at);V("click",$e,()=>v(u,!1)),V("click",Te,Hi(function(ze){Bi.call(this,n,ze)})),V("click",B,()=>v(u,!1)),k(Y,B)};te(St,Y=>{e(u)&&Y(Ut)})}U(()=>Re(Ne,`Battlefield: 60" x 44" | ${s(),c(()=>s().length)??""} terrain${s(),c(()=>s().length!==1?"s":"")??""} | ${i(),c(()=>i().length)??""} wall${i(),c(()=>i().length!==1?"s":"")??""}`)),V("change",_t,ut),V("click",Vt,we),k(t,nt),Fn(),m()}const Qa=rn(null),ca=rn(null),Sa=rn(null),Ci=Ga([ca,Sa],([t,n])=>{if(!t)return{terrains:[],walls:[]};if(n==="preset"){const a=wi.find(r=>r.name===t);return a?{terrains:a.terrains||[],walls:a.walls||[]}:{terrains:[],walls:[]}}else if(n==="saved"){const a=localStorage.getItem("warhammer-deployment-layouts");if(a)try{const r=JSON.parse(a);if(r[t])return{terrains:r[t].terrains||[],walls:r[t].walls||[]}}catch(r){console.error("Failed to load layout:",r)}}return{terrains:[],walls:[]}});var em=ve('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),tm=ve('<button class="svelte-1jotvmi"> </button>'),nm=ve('<div class="button-group svelte-1jotvmi"></div>'),am=ve('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),sm=ve('<button class="svelte-1jotvmi"> </button>'),rm=ve('<button class="svelte-1jotvmi"> </button>'),im=ve('<div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Saved</h4> <div class="button-group svelte-1jotvmi"></div></div>'),om=ve('<div class="layout-sections svelte-1jotvmi"><div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Presets</h4> <div class="button-group svelte-1jotvmi"></div></div> <!></div>'),lm=ve('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Objectives:</span> <span class="value svelte-1jotvmi"> </span></div>'),cm=ve('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Pieces:</span> <span class="value svelte-1jotvmi"> </span></div>'),um=ve('<div class="summary svelte-1jotvmi"><div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Deployment:</span> <span class="value svelte-1jotvmi"> </span></div> <div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Terrain:</span> <span class="value svelte-1jotvmi"> </span></div> <!> <!></div>'),mm=ge('<path stroke-width="0.10" stroke-dasharray="0.5,0.25"></path>'),dm=ge('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15"></circle><circle stroke="#000" stroke-width="0.06"></circle><circle r="0.15" fill="#000"></circle>',1),hm=ge("<!><!>",1),fm=ge('<g><rect fill="rgba(139, 90, 43, 0.6)" stroke="#8b5a2b" stroke-width="0.1"></rect></g>'),pm=ge('<g><path fill="rgba(139, 69, 19, 0.8)" stroke="#5c3317" stroke-width="0.1"></path></g>'),ym=ge("<!><!><!>",1),vm=ve('<main class="svelte-1jotvmi"><div class="layout svelte-1jotvmi"><div class="sidebar svelte-1jotvmi"><!> <!> <!></div> <div class="battlefield-area svelte-1jotvmi"><div class="battlefield-container svelte-1jotvmi"><!></div> <div class="info svelte-1jotvmi"><p class="svelte-1jotvmi">Battlefield: 60" x 44"</p> <p class="hint svelte-1jotvmi">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function gm(t,n){Hn(n,!1);const a=()=>Dt(Qa,"$selectedDeployment",o),r=()=>Dt(ca,"$selectedLayoutName",o),s=()=>Dt(Si,"$savedLayoutsList",o),i=()=>Dt(Ci,"$loadedTerrain",o),[o,l]=Gs();ws(()=>{Qs()});function m(C){Qa.set(C)}function h(C){ca.set(C.name),Sa.set("preset")}function d(C){ca.set(C),Sa.set("saved")}function p(){ca.set(null),Sa.set(null)}function u(){Qa.set(null)}function y(C){let F=[];switch(C.shape){case"L-4x8":F=[{x:0,y:0},{x:.5,y:0},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];break;case"L-4x8-mirror":F=[{x:0,y:0},{x:.5,y:0},{x:.5,y:8},{x:-4+.5,y:8},{x:-4+.5,y:8-.5},{x:0,y:8-.5}];break;case"C-4-8-4":F=[{x:0,y:0},{x:4,y:0},{x:4,y:.5},{x:.5,y:.5},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];break;case"L-5x6":F=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:5,y:6-.5},{x:5,y:6},{x:0,y:6}];break;case"L-5x6-mirror":F=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-5+.5,y:6},{x:-5+.5,y:6-.5},{x:0,y:6-.5}];break;case"L-4x6":F=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:4,y:6-.5},{x:4,y:6},{x:0,y:6}];break;case"L-4x6-mirror":F=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-4+.5,y:6},{x:-4+.5,y:6-.5},{x:0,y:6-.5}];break;default:return""}return`M ${F.map(le=>`${C.x+le.x},${C.y+le.y}`).join(" L ")} Z`}function g(C){switch(C.shape){case"L-4x8":return{x:C.x+2,y:C.y+4};case"L-4x8-mirror":return{x:C.x-2+.5,y:C.y+4};case"C-4-8-4":return{x:C.x+2,y:C.y+4};case"L-5x6":return{x:C.x+2.5,y:C.y+3};case"L-5x6-mirror":return{x:C.x-2.5+.5,y:C.y+3};case"L-4x6":return{x:C.x+2,y:C.y+3};case"L-4x6-mirror":return{x:C.x-2+.5,y:C.y+3};default:return{x:C.x,y:C.y}}}Zn();var _=vm(),T=x(_),E=x(T),R=x(E);cn(R,{title:"Deployment",children:(C,I)=>{var F=xt(),le=_e(F);{var $=we=>{var ne=em(),re=x(ne),ue=x(re),be=b(re,2);U(()=>Re(ue,a().name)),V("click",be,u),k(we,ne)},he=we=>{var ne=nm();Ye(ne,5,()=>ol,lt,(re,ue)=>{var be=tm(),Le=x(be);U(()=>Re(Le,e(ue).name)),V("click",be,()=>m(e(ue))),k(re,be)}),k(we,ne)};te(le,we=>{a()?we($):we(he,!1)})}k(C,F)},$$slots:{default:!0}});var L=b(R,2);cn(L,{title:"Terrain Layout",children:(C,I)=>{var F=xt(),le=_e(F);{var $=we=>{var ne=am(),re=x(ne),ue=x(re),be=b(re,2);U(()=>Re(ue,r())),V("click",be,p),k(we,ne)},he=we=>{var ne=om(),re=x(ne),ue=b(x(re),2);Ye(ue,5,()=>wi,lt,(ee,K)=>{var j=sm(),xe=x(j);U(()=>Re(xe,e(K).name)),V("click",j,()=>h(e(K))),k(ee,j)});var be=b(re,2);{var Le=ee=>{var K=im(),j=b(x(K),2);Ye(j,5,s,lt,(xe,W)=>{var ye=rm(),ke=x(ye);U(()=>Re(ke,e(W).name)),V("click",ye,()=>d(e(W).name)),k(xe,ye)}),k(ee,K)};te(be,ee=>{s().length>0&&ee(Le)})}k(we,ne)};te(le,we=>{r()?we($):we(he,!1)})}k(C,F)},$$slots:{default:!0}});var S=b(L,2);cn(S,{title:"Summary",children:(C,I)=>{var F=um(),le=x(F),$=b(x(le),2),he=x($),we=b(le,2),ne=b(x(we),2),re=x(ne),ue=b(we,2);{var be=K=>{var j=lm(),xe=b(x(j),2),W=x(xe);U(()=>Re(W,a().objectives.length)),k(K,j)};te(ue,K=>{a()&&K(be)})}var Le=b(ue,2);{var ee=K=>{var j=cm(),xe=b(x(j),2),W=x(xe);U(()=>Re(W,`${i().terrains.length??""} terrain, ${i().walls.length??""} walls`)),k(K,j)};te(Le,K=>{(i().terrains.length>0||i().walls.length>0)&&K(ee)})}U(()=>{Re(he,a()?.name||"None"),Re(re,r()||"None")}),k(C,F)},$$slots:{default:!0}});var A=b(E,2),M=x(A),D=x(M);mr(D,{children:(C,I)=>{var F=ym(),le=_e(F);{var $=ne=>{var re=hm(),ue=_e(re);Ye(ue,1,()=>a().zones,lt,(Le,ee)=>{var K=mm();U(j=>{f(K,"d",j),f(K,"fill",e(ee).color),f(K,"stroke",e(ee).borderColor)},[()=>Hs(e(ee).path)]),k(Le,K)});var be=b(ue);Ye(be,1,()=>a().objectives,lt,(Le,ee)=>{const K=Ie(()=>e(ee).isPrimary?"#fbbf24":"#9ca3af"),j=Ie(()=>e(ee).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)");var xe=dm(),W=_e(xe),ye=b(W),ke=b(ye);U(()=>{f(W,"cx",e(ee).x),f(W,"cy",e(ee).y),f(W,"r",Hr),f(W,"fill",e(j)),f(W,"stroke",e(K)),f(ye,"cx",e(ee).x),f(ye,"cy",e(ee).y),f(ye,"r",Yr),f(ye,"fill",e(K)),f(ke,"cx",e(ee).x),f(ke,"cy",e(ee).y)}),k(Le,xe)}),k(ne,re)};te(le,ne=>{a()&&ne($)})}var he=b(le);Ye(he,1,()=>i().terrains,lt,(ne,re)=>{const ue=Ie(()=>e(re).x+e(re).width/2),be=Ie(()=>e(re).y+e(re).height/2);var Le=fm(),ee=x(Le);U(()=>{f(Le,"transform",`rotate(${e(re).rotation??""}, ${e(ue)??""}, ${e(be)??""})`),f(ee,"x",e(re).x),f(ee,"y",e(re).y),f(ee,"width",e(re).width),f(ee,"height",e(re).height)}),k(ne,Le)});var we=b(he);Ye(we,1,()=>i().walls,lt,(ne,re)=>{const ue=Ie(()=>g(e(re)));var be=pm(),Le=x(be);U(ee=>{f(be,"transform",`rotate(${e(re).rotation??""}, ${e(ue).x??""}, ${e(ue).y??""})`),f(Le,"d",ee)},[()=>y(e(re))]),k(ne,be)}),k(C,F)},$$slots:{default:!0}}),k(t,_),Fn(),l()}var bm=ge('<g><rect role="button" tabindex="0" class="svelte-hycs6b"></rect></g>'),Tm=ge('<g><ellipse role="button" tabindex="0" class="svelte-hycs6b"></ellipse></g>'),xm=ge('<circle role="button" tabindex="0" class="svelte-hycs6b"></circle>'),_m=ge('<text text-anchor="middle" dominant-baseline="middle" font-weight="bold" fill="white" stroke="black" stroke-width="0.02" paint-order="stroke" pointer-events="none" class="model-name"> </text>'),wm=ge('<line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="rotate-handle svelte-hycs6b"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),Sm=ge('<line stroke="#fbbf24" stroke-width="0.12" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.25" fill="#fbbf24" pointer-events="none" class="svelte-hycs6b"></circle><text text-anchor="middle" dominant-baseline="middle" font-size="0.5" font-weight="bold" fill="#fbbf24" stroke="#000" stroke-width="0.05" paint-order="stroke" pointer-events="none" class="drag-ruler-label svelte-hycs6b"> </text>',1),Am=ge("<g><!><!><!><!></g>");function rr(t,n){Hn(n,!1);const a=N(),r=N(),s=N(),i=N(),o=N(),l=N(),m=N(),h=N(),d=N(),p=N(),u=N(),y=N(),g=N(),_=N(),T=N(),E=N(),R=N(),L=N(),S=N(),A=N(),M=N();let D=Xe(n,"id",8),C=Xe(n,"x",8),I=Xe(n,"y",8),F=Xe(n,"baseType",8),le=Xe(n,"playerId",8),$=Xe(n,"rotation",8,0),he=Xe(n,"selected",8,!1),we=Xe(n,"marqueePreview",8,!1),ne=Xe(n,"inGroupSelection",8,!1),re=Xe(n,"name",8,""),ue=Xe(n,"customWidth",8,null),be=Xe(n,"customHeight",8,null),Le=Xe(n,"screenToSvg",8),ee=Xe(n,"onSelect",8,()=>{}),K=Xe(n,"onDrag",8,()=>{}),j=Xe(n,"onDragEnd",8,()=>{}),xe=Xe(n,"onRotate",8,()=>{}),W=Xe(n,"onRotateEnd",8,()=>{}),ye=Xe(n,"onRename",8,()=>{}),ke=N(!1),dt=!1,fe={x:0,y:0},ae=N(null),Fe=null;function Ce(Ne){Ne.stopPropagation()}function Bt(Ne){Ne.stopPropagation();const Je=prompt("Model name:",re());Je!==null&&ye()(D(),Je)}function Qe(Ne){if(Ne.button!==0)return;Ne.preventDefault(),Ne.stopPropagation(),ee()(D(),Ne),v(ke,!0),v(ae,{x:C(),y:I()});const Je=Le()(Ne.clientX,Ne.clientY);fe={x:Je.x-C(),y:Je.y-I()},window.addEventListener("mousemove",st),window.addEventListener("mouseup",ut)}function st(Ne){if(!e(ke))return;const Je=Le()(Ne.clientX,Ne.clientY);let rt=Je.x-fe.x,St=Je.y-fe.y;K()(D(),rt,St)}function ut(){e(ke)&&e(ae)&&((e(ae).x!==C()||e(ae).y!==I())&&j()(D(),e(ae).x,e(ae).y,C(),I()),v(ae,null)),v(ke,!1),window.removeEventListener("mousemove",st),window.removeEventListener("mouseup",ut)}function nt(Ne){Ne.preventDefault(),Ne.stopPropagation(),dt=!0,Fe=$(),window.addEventListener("mousemove",yt),window.addEventListener("mouseup",Mt)}function yt(Ne){if(!dt)return;const Je=Le()(Ne.clientX,Ne.clientY),rt=Je.x-C(),St=Je.y-I();let Ut=Math.atan2(St,rt)*180/Math.PI+45;Ne.shiftKey||(Ut=Math.round(Ut/15)*15),xe()(D(),Ut)}function Mt(){dt&&Fe!==null&&(Fe!==$()&&W()(D(),Fe,$()),Fe=null),dt=!1,window.removeEventListener("mousemove",yt),window.removeEventListener("mouseup",Mt)}pe(()=>(J(ue()),J(be())),()=>{v(a,{customWidth:ue(),customHeight:be()})}),pe(()=>(J(F()),e(a)),()=>{v(r,In(F(),e(a)))}),pe(()=>J(F()),()=>{v(s,bn(F()))}),pe(()=>J(F()),()=>{v(i,fa(F()))}),pe(()=>J(le()),()=>{v(o,le()===1?"#3b82f6":"#ef4444")}),pe(()=>J(le()),()=>{v(l,le()===1?"rgba(59, 130, 246, 0.5)":"rgba(239, 68, 68, 0.5)")}),pe(()=>J(le()),()=>{v(m,le()===1?"rgba(59, 130, 246, 0.3)":"rgba(239, 68, 68, 0.3)")}),pe(()=>(J(he()),J(we())),()=>{v(h,he()?.15:we()?.12:.1)}),pe(()=>(J(he()),e(o),J(we()),e(m),e(l)),()=>{v(d,he()?e(o):we()?e(m):e(l))}),pe(()=>e(r),()=>{v(p,e(r)?.radius||.5)}),pe(()=>e(r),()=>{v(u,e(r)?.width?e(r).width/2:0)}),pe(()=>e(r),()=>{v(y,e(r)?.height?e(r).height/2:0)}),pe(()=>(e(i),J(ue())),()=>{v(g,e(i)&&ue()||0)}),pe(()=>(e(i),J(be())),()=>{v(_,e(i)&&be()||0)}),pe(()=>(e(s),e(u),e(y),e(i),e(g),e(_)),()=>{v(T,e(s)?Math.max(e(u),e(y))+1:e(i)?Math.max(e(g),e(_))/2+1:0)}),pe(()=>(J(C()),e(T),J($())),()=>{v(E,C()+e(T)*Math.cos(($()-45)*Math.PI/180))}),pe(()=>(J(I()),e(T),J($())),()=>{v(R,I()+e(T)*Math.sin(($()-45)*Math.PI/180))}),pe(()=>(e(ke),e(ae),J(C()),J(I())),()=>{v(L,e(ke)&&e(ae)?Math.sqrt(Math.pow(C()-e(ae).x,2)+Math.pow(I()-e(ae).y,2)):0)}),pe(()=>(e(ke),e(ae),J(C())),()=>{v(S,e(ke)&&e(ae)?(e(ae).x+C())/2:0)}),pe(()=>(e(ke),e(ae),J(I())),()=>{v(A,e(ke)&&e(ae)?(e(ae).y+I())/2:0)}),pe(()=>(e(i),e(g),e(_),e(s),e(u),e(y),e(p)),()=>{v(M,e(i)?Math.min(e(g),e(_))*.2:e(s)?Math.min(e(u),e(y))*.4:e(p)*.5)}),Ra(),Zn();var un=Am();let oe;var De=x(un);{var Ge=Ne=>{var Je=bm(),rt=x(Je);U(()=>{f(Je,"transform",`rotate(${$()??""}, ${C()??""}, ${I()??""})`),f(rt,"x",C()-e(g)/2),f(rt,"y",I()-e(_)/2),f(rt,"width",e(g)),f(rt,"height",e(_)),f(rt,"fill",e(d)),f(rt,"stroke",e(o)),f(rt,"stroke-width",e(h))}),V("click",rt,Ce),V("dblclick",rt,Bt),V("mousedown",rt,Qe),k(Ne,Je)},It=Ne=>{var Je=xt(),rt=_e(Je);{var St=Y=>{var B=Tm(),Te=x(B);U(()=>{f(B,"transform",`rotate(${$()??""}, ${C()??""}, ${I()??""})`),f(Te,"cx",C()),f(Te,"cy",I()),f(Te,"rx",e(u)),f(Te,"ry",e(y)),f(Te,"fill",e(d)),f(Te,"stroke",e(o)),f(Te,"stroke-width",e(h))}),V("click",Te,Ce),V("dblclick",Te,Bt),V("mousedown",Te,Qe),k(Y,B)},Ut=Y=>{var B=xm();U(()=>{f(B,"cx",C()),f(B,"cy",I()),f(B,"r",e(p)),f(B,"fill",e(d)),f(B,"stroke",e(o)),f(B,"stroke-width",e(h))}),V("click",B,Ce),V("dblclick",B,Bt),V("mousedown",B,Qe),k(Y,B)};te(rt,Y=>{e(s)?Y(St):Y(Ut,!1)},!0)}k(Ne,Je)};te(De,Ne=>{e(i)?Ne(Ge):Ne(It,!1)})}var _t=b(De);{var Ot=Ne=>{var Je=_m(),rt=x(Je);U(()=>{f(Je,"x",C()),f(Je,"y",I()),f(Je,"font-size",e(M)),Re(rt,re())}),k(Ne,Je)};te(_t,Ne=>{re()&&Ne(Ot)})}var Vt=b(_t);{var Pn=Ne=>{var Je=wm(),rt=_e(Je),St=b(rt),Ut=b(St);U(()=>{f(rt,"x1",C()),f(rt,"y1",I()),f(rt,"x2",e(E)),f(rt,"y2",e(R)),f(St,"cx",e(E)),f(St,"cy",e(R)),f(Ut,"transform",`translate(${e(E)??""}, ${e(R)??""})`)}),V("mousedown",St,nt),k(Ne,Je)};te(Vt,Ne=>{he()&&(e(s)||e(i))&&!ne()&&Ne(Pn)})}var pn=b(Vt);{var Jt=Ne=>{var Je=Sm(),rt=_e(Je),St=b(rt),Ut=b(St),Y=x(Ut);U(B=>{f(rt,"x1",(e(ae),c(()=>e(ae).x))),f(rt,"y1",(e(ae),c(()=>e(ae).y))),f(rt,"x2",C()),f(rt,"y2",I()),f(St,"cx",(e(ae),c(()=>e(ae).x))),f(St,"cy",(e(ae),c(()=>e(ae).y))),f(Ut,"x",e(S)),f(Ut,"y",e(A)-.5),Re(Y,`${B??""}"`)},[()=>(e(L),c(()=>e(L).toFixed(2)))]),k(Ne,Je)};te(pn,Ne=>{e(ke)&&e(ae)&&e(L)>.1&&Ne(Jt)})}U(()=>oe=Tn(un,0,"model-base svelte-hycs6b",null,oe,{selected:he(),dragging:e(ke)})),k(t,un),Fn()}var Cm=ge('<ellipse fill="none" stroke-width="2"></ellipse>'),Em=ge('<circle fill="none" stroke-width="2"></circle>'),km=ve('<button class="palette-item svelte-1urec28"><svg class="svelte-1urec28"><!></svg> <span class="label svelte-1urec28"> </span></button>');function Dr(t,n){Hn(n,!1);const a=N(),r=N(),s=N(),i=N(),o=N(),l=N();let m=Xe(n,"baseSize",8),h=Xe(n,"playerId",8),d=Xe(n,"onDragStart",8,()=>{});const p=3;function u(S){S.button===0&&(S.preventDefault(),d()(m(),S))}pe(()=>J(h()),()=>{v(a,h()===1?"#3b82f6":"#ef4444")}),pe(()=>J(m()),()=>{v(r,m().width!==void 0)}),pe(()=>(e(r),J(m())),()=>{v(s,e(r)?null:m().radius*p)}),pe(()=>(e(r),J(m())),()=>{v(i,e(r)?m().width/2*p:null)}),pe(()=>(e(r),J(m())),()=>{v(o,e(r)?m().height/2*p:null)}),pe(()=>(e(r),J(m())),()=>{v(l,e(r)?Math.max(m().width,m().height)*p:m().radius*2*p)}),Ra(),Zn();var y=km(),g=x(y),_=x(g);{var T=S=>{var A=Cm();U(()=>{f(A,"cx",(e(l)+8)/2),f(A,"cy",(e(l)+8)/2),f(A,"rx",e(i)),f(A,"ry",e(o)),f(A,"stroke",e(a))}),k(S,A)},E=S=>{var A=Em();U(()=>{f(A,"cx",(e(l)+8)/2),f(A,"cy",(e(l)+8)/2),f(A,"r",e(s)),f(A,"stroke",e(a))}),k(S,A)};te(_,S=>{e(r)?S(T):S(E,!1)})}var R=b(g,2),L=x(R);U(()=>{Dc(y,`border-color: ${e(a)??""}`),f(y,"title",(J(m()),c(()=>m().label))),f(g,"width",e(l)+8),f(g,"height",e(l)+8),f(g,"viewBox",`0 0 ${e(l)+8} ${e(l)+8}`),Re(L,(J(m()),c(()=>m().label)))}),V("mousedown",y,u),k(t,y),Fn()}const ll="warhammer-imported-armies";function Mm(){try{const t=localStorage.getItem(ll);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load army imports from storage:",t),[]}}function zr(t){try{localStorage.setItem(ll,JSON.stringify(t))}catch(n){console.error("Failed to save army imports to storage:",n)}}function Rm(){return"import-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Lm(){const{subscribe:t,set:n,update:a}=rn(Mm());return{subscribe:t,addImport(r,s,i,o){const l=Rm(),m={id:l,name:r||"Unnamed Army",timestamp:Date.now(),rawText:s,parsedData:i,faction:i.FACTION_KEYWORD||"Unknown",totalPoints:i.TOTAL_ARMY_POINTS||"0pts",playerId:o};return a(h=>{const d=[...h,m];return zr(d),d}),l},removeImport(r){a(s=>{const i=s.filter(o=>o.id!==r);return zr(i),i})},getImport(r){return da({subscribe:t}).find(i=>i.id===r)||null},clear(){n([]),zr([])}}}const ii=Lm();var Dm=ve('<div class="error-message svelte-leqhjl"> </div>'),Im=ve('<div class="success-message svelte-leqhjl"> </div>'),$m=ve("<option> </option>"),Pm=ve('<div class="army-import-panel svelte-leqhjl"><div class="form-group svelte-leqhjl"><label for="army-list-input" class="svelte-leqhjl">Paste Army List:</label> <textarea id="army-list-input" placeholder="Paste your army list here (GW App, WTC, ListForge formats supported)" rows="12" class="svelte-leqhjl"></textarea></div> <div class="button-group svelte-leqhjl"><button class="svelte-leqhjl"> </button> <button class="svelte-leqhjl">Clear</button></div> <!> <!> <div class="divider svelte-leqhjl"></div> <div class="form-group svelte-leqhjl"><label for="import-select" class="svelte-leqhjl">Load Previous Import:</label> <select id="import-select" class="svelte-leqhjl"><option>-- Select an import --</option><!></select> <button class="load-button svelte-leqhjl">Load</button></div></div>');function Nm(t,n){Hn(n,!1);const a=()=>Dt(ii,"$armyImports",r),[r,s]=Gs();let i=Xe(n,"currentPlayer",8,1);const o=Go();let l=N(""),m=N(!1),h=N(""),d=N(""),p=N("");function u(){if(!e(l).trim()){v(h,"Please paste an army list");return}v(m,!0),v(h,""),v(d,""),o("parse",{text:e(l),playerId:i()})}function y(){if(!e(p))return;const K=ii.getImport(e(p));K&&(v(l,K.rawText),v(d,`Loaded: ${K.name} (${K.faction}, ${K.totalPoints})`),v(h,""))}function g(){v(l,""),v(h,""),v(d,"")}function _(K){v(m,K)}function T(K){v(h,K),v(d,""),v(m,!1)}function E(K){v(d,K),v(h,""),v(m,!1)}function R(){v(l,"")}var L={setLoading:_,setError:T,setSuccess:E,clearText:R};Zn();var S=Pm(),A=x(S),M=b(x(A),2),D=b(A,2),C=x(D),I=x(C),F=b(C,2),le=b(D,2);{var $=K=>{var j=Dm(),xe=x(j);U(()=>Re(xe,`â ï¸ ${e(h)??""}`)),k(K,j)};te(le,K=>{e(h)&&K($)})}var he=b(le,2);{var we=K=>{var j=Im(),xe=x(j);U(()=>Re(xe,`â ${e(d)??""}`)),k(K,j)};te(he,K=>{e(d)&&K(we)})}var ne=b(he,4),re=b(x(ne),2);U(()=>{e(p),Io(()=>{e(m),a()})});var ue=x(re);ue.value=ue.__value="";var be=b(ue);Ye(be,1,a,K=>K.id,(K,j)=>{var xe=$m(),W=x(xe),ye={};U(()=>{Re(W,`${e(j),c(()=>e(j).name)??""} (${e(j),c(()=>e(j).faction)??""}, ${e(j),c(()=>e(j).totalPoints)??""})`),ye!==(ye=(e(j),c(()=>e(j).id)))&&(xe.value=(xe.__value=(e(j),c(()=>e(j).id)))??"")}),k(K,xe)});var Le=b(re,2);U(K=>{M.disabled=e(m),C.disabled=K,Re(I,e(m)?"Parsing...":"Parse Army List"),F.disabled=e(m),re.disabled=e(m),Le.disabled=e(m)||!e(p)},[()=>(e(m),e(l),c(()=>e(m)||!e(l).trim()))]),Mn(M,()=>e(l),K=>v(l,K)),V("click",C,u),V("click",F,g),qo(re,()=>e(p),K=>v(p,K)),V("click",Le,y),k(t,S),Zs(n,"setLoading",_),Zs(n,"setError",T),Zs(n,"setSuccess",E),Zs(n,"clearText",R);var ee=Fn(L);return s(),ee}var Om=ve("<option> </option>"),Wm=ve('<tr><td class="unit-name svelte-1xyf33v"> </td><td class="quantity svelte-1xyf33v"> </td><td class="svelte-1xyf33v"><select class="svelte-1xyf33v"></select></td><td class="skip-cell svelte-1xyf33v"><input type="checkbox" class="svelte-1xyf33v"/></td></tr>'),Ym=ve('<div class="dialog-overlay svelte-1xyf33v"><div class="dialog svelte-1xyf33v"><div class="dialog-header svelte-1xyf33v"><h3 class="svelte-1xyf33v">Unmatched Units</h3> <button class="close-button svelte-1xyf33v">&times;</button></div> <div class="dialog-content svelte-1xyf33v"><p class="info-text svelte-1xyf33v">The following units were not found in the database. Please select base sizes or skip them:</p> <div class="units-table svelte-1xyf33v"><table class="svelte-1xyf33v"><thead class="svelte-1xyf33v"><tr><th class="svelte-1xyf33v">Unit Name</th><th class="svelte-1xyf33v">Quantity</th><th class="svelte-1xyf33v">Base Size</th><th class="svelte-1xyf33v">Skip</th></tr></thead><tbody></tbody></table></div></div> <div class="dialog-footer svelte-1xyf33v"><button class="cancel-button svelte-1xyf33v">Cancel</button> <button class="import-button svelte-1xyf33v">Import Selected</button></div></div></div>');function Hm(t,n){Hn(n,!1);let a=Xe(n,"unmatchedUnits",24,()=>[]),r=Xe(n,"show",12,!1);const s=Go();let i=N({});const o=[...Vn.circles.map(u=>({value:u.type,label:u.label})),...Vn.ovals.map(u=>({value:u.type,label:u.label})),{value:"rect-custom",label:"Custom Rectangle (Vehicle)"}];function l(){const u=a().filter(y=>!e(i)[y.id]?.skip).map(y=>({unitName:y.unitName,quantity:y.quantity,baseType:e(i)[y.id]?.baseType||"32mm"}));s("import",{selected:u}),m()}function m(){r(!1),s("close")}pe(()=>J(a()),()=>{v(i,{}),a().forEach(u=>{Ur(i,e(i)[u.id]={baseType:"32mm",skip:!1})})}),Ra(),Zn();var h=xt(),d=_e(h);{var p=u=>{var y=Ym(),g=x(y),_=x(g),T=b(x(_),2),E=b(_,2),R=b(x(E),2),L=x(R),S=b(x(L));Ye(S,5,a,C=>C.id,(C,I)=>{var F=Wm();let le;var $=x(F),he=x($),we=b($),ne=x(we),re=b(we),ue=x(re);U(()=>{e(i),Io(()=>{e(I)})}),Ye(ue,5,()=>o,lt,(ee,K)=>{var j=Om(),xe=x(j),W={};U(()=>{Re(xe,(e(K),c(()=>e(K).label))),W!==(W=(e(K),c(()=>e(K).value)))&&(j.value=(j.__value=(e(K),c(()=>e(K).value)))??"")}),k(ee,j)});var be=b(re),Le=x(be);U(()=>{le=Tn(F,1,"svelte-1xyf33v",null,le,{skipped:e(i)[e(I).id]?.skip}),Re(he,(e(I),c(()=>e(I).unitName))),Re(ne,(e(I),c(()=>e(I).quantity||"1x"))),ue.disabled=(e(i),e(I),c(()=>e(i)[e(I).id]?.skip))}),qo(ue,()=>e(i)[e(I).id].baseType,ee=>Ur(i,e(i)[e(I).id].baseType=ee)),Cn(Le,()=>e(i)[e(I).id].skip,ee=>Ur(i,e(i)[e(I).id].skip=ee)),k(C,F)});var A=b(E,2),M=x(A),D=b(M,2);V("click",T,m),V("click",M,m),V("click",D,l),V("click",g,C=>C.stopPropagation()),V("click",y,m),k(u,y)};te(d,u=>{r()&&u(p)})}k(t,h),Fn()}function ns(t){const n=t.match(/^\s*/);return n?n[0].length:0}function de(t){return t?t.toLowerCase().replace(/\s+/g," ").trim():""}function ss(t){const n=/^(?:(\d+)x?\s+)?(.*)/,a=t.trim().match(n);if(a){const r=a[1]?`${a[1]}x`:"1x";let s=a[2].trim();return s=s.replace(/^with\s+/i,"").trim(),{quantity:r,name:s}}return{quantity:"1x",name:t.trim()}}function pa(t){return Array.isArray(t)&&t.sort((n,a)=>{const r=parseInt(String(n&&n.quantity||"1x").replace(/x/i,""),10)||1,s=parseInt(String(a&&a.quantity||"1x").replace(/x/i,""),10)||1;if(r!==s)return s-r;const i=n&&n.name?n.name.toString().toLowerCase():"",o=a&&a.name?a.name.toString().toLowerCase():"";return i<o?-1:i>o?1:0}),t}const Ca={"World Eaters":"Chaos","Chaos Space Marines":"Chaos","Emperor's Children":"Chaos","Death Guard":"Chaos","Chaos Daemons":"Chaos","Chaos Knights":"Chaos","Thousand Sons":"Chaos","Space Marines":"Imperium","Iron Hands":"Space Marines",Salamanders:"Space Marines","Space Wolves":"Space Marines",Ultramarines:"Space Marines","White Scars":"Space Marines","Adepta Sororitas":"Imperium","Astra Militarum":"Imperium","Imperial Fists":"Space Marines","Dark Angels":"Space Marines","Blood Angels":"Space Marines","Raven Guard":"Space Marines","Black Templars":"Space Marines",Deathwatch:"Space Marines","Grey Knights":"Imperium","Imperial Knights":"Imperium","Adeptus Custodes":"Imperium","Adeptus Titanicus":"Imperium","Adeptus Mechanicus":"Imperium","Agents of the Imperium":"Imperium",Aeldari:"Xenos",Drukhari:"Xenos",Ynnari:"Xenos",Harlequins:"Xenos",Necrons:"Xenos",Orks:"Xenos",Tyranids:"Xenos","T'au Empire":"Xenos",Tau:"Xenos","T'au":"Xenos","Genestealer Cults":"Xenos","Leagues of Votann":"Xenos"};function Ss(t){if(!t)return t;t.SUMMARY=t.SUMMARY||{};const n=t.SUMMARY;n.LIST_TITLE=n.LIST_TITLE||"",n.FACTION_KEYWORD&&(n.FACTION_KEYWORD=String(n.FACTION_KEYWORD).trim()),n.DETACHMENT&&(n.DETACHMENT=String(n.DETACHMENT).replace(/\u00A0/g," ").trim()),n.TOTAL_ARMY_POINTS&&(n.TOTAL_ARMY_POINTS=String(n.TOTAL_ARMY_POINTS).trim());const a=s=>{if(!s)return"";try{return s.toString().normalize("NFD").replace(new RegExp("\\p{M}","gu"),"").replace(/[\u2018\u2019\u201B\u2032]/g,"'").replace(/[^\w\s'\-]/g,"").toLowerCase().trim()}catch{return s.toString().toLowerCase().trim()}},r=n.FACTION_KEYWORD||null;if(r){const s=a(r);let i;for(const o of Object.keys(Ca))if(a(o)===s){i=o;break}if(i){const o=r.toString().replace(/[\u2018\u2019\u201B\u2032]/g,"'").trim();n.DISPLAY_FACTION=`${Ca[i]} - ${o}`}else n.DISPLAY_FACTION=n.DISPLAY_FACTION||r+(n.DETACHMENT?` - ${n.DETACHMENT}`:"")}else n.DETACHMENT?n.DISPLAY_FACTION=n.DISPLAY_FACTION||n.DETACHMENT:n.DISPLAY_FACTION=n.DISPLAY_FACTION||"";if(!n.FACTION_KEY){if(n.FACTION_KEYWORD)try{n.FACTION_KEY=n.FACTION_KEYWORD.toString().toLowerCase()}catch{n.FACTION_KEY=String(n.FACTION_KEYWORD).toLowerCase()}else if(n.DISPLAY_FACTION){const s=(n.DISPLAY_FACTION||"").split(" - ")[0];try{n.FACTION_KEY=s.toString().toLowerCase()}catch{n.FACTION_KEY=String(s).toLowerCase()}}}return t}function cs(t,n,a,r,s="",i=!1,o="wargear"){if(!t)return;t.items=t.items||[];const l=ss(String(n||"").trim()),m=l.quantity?String(l.quantity):"1x",h=l.name||"",d=de(h);if(i){const u=String(a||""),y=String(s||"");if(de(u)===de(h)||y&&de(y)===de(h))return}const p=t.items.find(u=>de(u.name||"")===d);if(p){const u=parseInt(String(p.quantity||"1x").replace(/x/i,""),10)||0,y=parseInt(String(m||"1x").replace(/x/i,""),10)||0;p.quantity=`${u+y}x`}else{const u=de(h)==="warlord"?"special":o;t.items.push({quantity:m,name:h,items:[],type:u,nameshort:""})}}function Fm(t,n){if(!t||!n)return;n.items=n.items||[];const a=t.trim(),r=a.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),o=de(i);if((n.items||[]).some(p=>p&&p.type==="special"&&de((p.name||"").replace(/^Enhancement:\s*/i,""))===o))return;const h=`E: ${i.split(/\s+/).map(p=>p[0]?p[0].toUpperCase():"").join("")}${s}`.trim(),d={quantity:"1x",name:`Enhancement: ${i}`,nameshort:h,items:[],type:"special"};n.items.push(d)}function Bm(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=[];let r=0;const s=p=>/^(\d+)x?\s+/i.test(String(p||"").trim()),i=(p,u)=>{const y=String(p||"").trim();if(!y)return y;if(s(y)){const g=y.match(/^(\d+)x?\s+(.*)$/i);if(g){const _=parseInt(g[1],10)||1,T=g[2].trim();return`${Math.max(1,_*(parseInt(u,10)||1))}x ${T}`}return y}return`${u}x ${y}`};for(;r<t.length;r++){const u=(t[r]||"").trim();if(u){if(u.startsWith("+")||u.startsWith("&")){a.push(u);continue}break}}for(const p of a){if(p.startsWith("&")){const _=p.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);_&&(_[1].trim(),(_[3]||"").trim());continue}const y=p.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(y){const g=y[1].trim().toUpperCase(),_=y[2].trim();if(g==="FACTION KEYWORD"){const T=_.split(" - ");n.SUMMARY.FACTION_KEYWORD=T[T.length-1].trim()}else g==="DETACHMENT"?n.SUMMARY.DETACHMENT=_.replace(/\u00A0/g," "):g==="TOTAL ARMY POINTS"&&(n.SUMMARY.TOTAL_ARMY_POINTS=_)}}if(n.SUMMARY.LIST_TITLE="",n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD){const p=n.SUMMARY.FACTION_KEYWORD,u=Object.keys(Ca).find(g=>g.toLowerCase()===(p||"").toString().toLowerCase()),y=u?Ca[u]:null;y?n.SUMMARY.DISPLAY_FACTION=`${y} - ${p}`:n.SUMMARY.DISPLAY_FACTION=p+(n.SUMMARY.DETACHMENT?` - ${n.SUMMARY.DETACHMENT}`:"");try{n.SUMMARY.FACTION_KEY=p.toString().toLowerCase()}catch{}}let o=null,l=null;const m=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,h=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;for(;r<t.length;r++){const p=t[r]||"",u=p.trim();if(!u)continue;if(/^Enhancement:\s*/i.test(u)){const E=u.replace(/^Enhancement:\s*/i,"").trim();l&&Fm(E,l);continue}const y=u.match(m);if(y){const E=y[1],R=y[2]?`${y[2]}x`:"1x",L=(y[3]||"").trim(),S=parseInt(y[4],10)||0,A=y[5],M={quantity:R,name:L,points:S,items:[],isComplex:!1,nameshort:""};E?(n.CHARACTER.push(M),l=M):(n["OTHER DATASHEETS"]=n["OTHER DATASHEETS"]||[],n["OTHER DATASHEETS"].push(M)),o=M,A&&A.split(",").map(D=>D.trim()).filter(Boolean).forEach(D=>cs(M,D,M.name,n.SUMMARY.FACTION_KEYWORD||"",M.name,!0));continue}const g=p.match(h);if(g){const E=g[1].trim(),R=E.match(/^(\d+)\s+with\s+(.*)$/i);if(R&&o){const A=parseInt(R[1],10)||1,M=R[2],D=o.items&&o.items.length>0?o.items[o.items.length-1]:o;M.split(",").map(C=>C.trim()).filter(Boolean).forEach(C=>{const I=i(C,A);cs(D,I,D.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const L=E.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(L&&o){const A=L[1],M=L[2].trim(),D=L[3]||"",C={quantity:A,name:M,items:[],type:"subunit"};if(o.items=o.items||[],o.items.push(C),D){const I=D.match(/^(\d+)\s+with\s+(.*)$/i);if(I){const F=parseInt(I[1],10)||1;I[2].split(",").map($=>$.trim()).filter(Boolean).forEach($=>{const he=i($,F);cs(C,he,C.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)})}else D.split(",").map(F=>F.trim()).filter(Boolean).forEach(F=>cs(C,F,C.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0))}continue}const S=E.match(/^(\d+x?)\s+(.*)$/i);if(S&&o){const A={quantity:S[1],name:S[2].trim(),items:[],type:"subunit"};o.items=o.items||[],o.items.push(A);continue}if(o){cs(o,E,o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0);continue}continue}const _=u.match(/^(\d+)\s+with\s+(.*)$/i);if(_&&o){const E=parseInt(_[1],10)||1,R=_[2],L=o.items&&o.items.length>0?o.items[o.items.length-1]:o;R.split(",").map(S=>S.trim()).filter(Boolean).forEach(S=>{const A=i(S,E);cs(L,A,L.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const T=u.match(/^(.*?):\s*(.*)$/);if(T&&o){(T[2]||"").split(",").map(R=>R.trim()).filter(Boolean).forEach(R=>cs(o,R,o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0));continue}}const d=[...n.CHARACTER||[],...n["OTHER DATASHEETS"]||[]];for(const p of d){p&&Array.isArray(p.items)&&p.items.length>0&&pa(p.items);const u=p&&Array.isArray(p.items)?p.items.filter(y=>y&&y.type==="subunit"):[];for(const y of u)y&&Array.isArray(y.items)&&y.items.length>0&&pa(y.items)}return Ss(n),n}function la(t,n,a,r,s="",i=!1,o="wargear"){if(!t)return;t.items=t.items||[];const l=String(n||"").trim();if(/battlesuit support system|homing beacon|marker drone/i.test(l))try{Xn.push(`processing raw=${l} for target=${t&&t.name}`)}catch{}let m=l.split(",").map(S=>S.trim()).filter(Boolean);try{const S=new Set;m=m.filter(A=>{const M=de($s($a(A)));return S.has(M)?!1:(S.add(M),!0)})}catch{}try{/stealth shas'vre|stealth battlesuits/i.test((t&&t.name||"")+(s||"")+l)&&Xn.push(`splitParts target=${t&&t.name} top=${s} parts=${JSON.stringify(m)}`)}catch{}if(m.length>1){m.forEach(S=>la(t,S,a,r,s,i,o));return}const h=ss(l),d=h.quantity!==void 0&&h.quantity!==null;let p=d?String(h.quantity):"1x",u=h.name||"";try{u=$s($a(u))}catch{}const y=/battlesuit support system|homing beacon|marker drone/i;try{const S=u.toLowerCase();if(S.includes("battlesuit support system")||S.includes("homing beacon")||S.includes("marker drone"))try{Xn.push(`addItemToTarget target=${t&&t.name} raw=${l}`)}catch{}}catch{}const g=u.match(/^(\d+)x\s+(.*)$/i);if(g){const S=parseInt(g[1],10)||1,A=parseInt(String(p||"1x").replace(/x/i,""),10)||1;p=`${Math.max(1,A*S)}x`,u=g[2]}try{Xn.push(`PARSE_QTY name=${u} parsedQtyRaw=${String(h.quantity||"")} qtyToken=${p}`)}catch{}let _=(S=>isNaN(S)?1:S)(parseInt(String(p||"1x").replace(/x/i,""),10)),T=_;try{if(t&&t.type==="subunit"){const S=parseInt(String(t.quantity||"1x").replace(/[^0-9]/g,""),10)||1;try{Xn.push(`CALC_EFFECTIVE target=${t&&t.name} parentQty=${S} parsedQty=${_} hasExplicit=${d}`)}catch{}T=d?_:S;try{Xn.push(`EFFECTIVE_QTY target=${t&&t.name} effectiveQty=${T}`)}catch{}}}catch{}const E=u,R=de(u);if(i){const S=String(a||""),A=String(s||"");if(de(S)===de(u)||A&&de(A)===de(u)){if(y.test(u))try{Xn.push(`SKIP matched unitname name=${u} ctx=${S} top=${A}`)}catch{}return}}const L=t.items.find(S=>de(S.name||"")===R);if(L){const S=parseInt(String(L.quantity||"1x").replace(/x/i,""),10)||0,A=S+T;L.quantity=`${A}x`;try{Xn.push(`UPDATED existing name=${u} existing=${S} added=${T} new=${A} target=${t&&t.name}`)}catch{}}else{const S=de(u)==="warlord"?"special":o;t.items.push({quantity:`${T}x`,name:E,items:[],type:S,nameshort:""});try{Xn.push(`PUSHED new name=${u} quantity=${T} target=${t&&t.name}`)}catch{}}}function $a(t){if(!t)return t;const n=t.toLowerCase();return n.includes("shield")&&n.includes("drone")?"Shield Drone":n.includes("marker")&&n.includes("drone")?"Marker Drone":n.includes("marker")&&n.includes("beacon")?"Homing Beacon":t}function $s(t){return t&&t.split(/\s+/).map(n=>!n||/[A-Z]/.test(n.slice(1))?n:n[0].toUpperCase()+n.slice(1).toLowerCase()).join(" ")}function zi(t,n){if(!n)return`${t}x`;const a=String(n).trim(),r=a.match(/^(\d+)x\s+(.*)$/i);if(r){const s=parseInt(r[1],10)||1,i=r[2]||"";return`${Math.max(1,t*s)}x ${i}`}return`${t}x ${a}`}function qm(t,n){if(!t||!n)return;n.items=n.items||[];const a=t.trim(),r=a.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),o=de(i);if((n.items||[]).some(p=>{if(!p||!p.name)return!1;const u=String(p.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]+\)$/,"").trim();return de(u)===o}))return;const h=`E: ${i.split(/\s+/).map(p=>p[0]?p[0].toUpperCase():"").join("")}${s}`.trim(),d={quantity:"1x",name:`Enhancement: ${i}`,nameshort:h,items:[],type:"special"};n.items.push(d)}function Um(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=[];let r=0;for(;r<t.length;r++){const d=(t[r]||"").trim();if(d){if(d.startsWith("+")){a.push(d);continue}if(!d.startsWith("&"))break}}for(const h of a){const p=h.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(p){const u=p[1].trim().toUpperCase(),y=p[2].trim();if(u==="FACTION KEYWORD"){const g=y.split(" - ");n.SUMMARY.FACTION_KEYWORD=g[g.length-1].trim()}else u==="DETACHMENT"?n.SUMMARY.DETACHMENT=y.replace(/\u00A0/g," "):u==="TOTAL ARMY POINTS"&&(n.SUMMARY.TOTAL_ARMY_POINTS=y)}}if(n.SUMMARY.LIST_TITLE="",n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD){const h=n.SUMMARY.FACTION_KEYWORD,d=Object.keys(Ca).find(u=>u.toLowerCase()===(h||"").toString().toLowerCase()),p=d?Ca[d]:null;p?n.SUMMARY.DISPLAY_FACTION=`${p} - ${h}`:n.SUMMARY.DISPLAY_FACTION=h+(n.SUMMARY.DETACHMENT?` - ${n.SUMMARY.DETACHMENT}`:"");try{n.SUMMARY.FACTION_KEY=h.toString().toLowerCase()}catch{}}const s=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,i=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;let o=null,l=null;for(;r<t.length;r++){const h=t[r]||"",d=h.trim();if(!d)continue;if(/^Enhancement:\s*/i.test(d)){const _=d.replace(/^Enhancement:\s*/i,"").trim();l&&qm(_,l);continue}const p=d.match(s);if(p){const _=p[1],T=p[2]?`${p[2]}x`:"1x",E=(p[3]||"").trim(),R=parseInt(p[4],10)||0,L=p[5],S={quantity:T,name:E,points:R,items:[],isComplex:!1,nameshort:"",charId:_||null};_?(n.CHARACTER.push(S),l=S):(n["OTHER DATASHEETS"]=n["OTHER DATASHEETS"]||[],n["OTHER DATASHEETS"].push(S)),o=S,L&&L.split(",").map(A=>A.trim()).filter(Boolean).forEach(A=>la(S,A,S.name,n.SUMMARY.FACTION_KEYWORD||"",S.name,!0));continue}const u=h.match(i);if(u){const _=u[1].trim(),T=_.match(/^(\d+)\s+with\s+(.*)$/i);if(T&&o){const L=parseInt(T[1],10)||1,S=T[2],A=o.items&&o.items.length>0?o.items[o.items.length-1]:o;try{Xn.push(`WITHMATCH unit=${o.name} target=${A&&A.name} n=${L} rest=${S}`)}catch{}S.split(",").map(M=>M.trim()).filter(Boolean).forEach(M=>{const C=$s($a(M));if(A&&A.type==="subunit"){try{Xn.push(`WITH->SUB target=${A.name} item=${C} n=${L}`)}catch{}la(A,`${L}x ${C}`,A.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}else{try{Xn.push(`WITH->UNIT unit=${o.name} item=${C} n=${L}`)}catch{}la(A,zi(L,C),A.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}});continue}const E=_.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(E&&o){const L=E[1],S=E[2].trim(),A=E[3]||"",M={quantity:L,name:S,items:[],type:"subunit",_parent:o};if(o.items=o.items||[],o.items.push(M),A){const D=A.match(/^(\d+)\s+with\s+(.*)$/i);D?D[2].split(",").map(I=>I.trim()).filter(Boolean).forEach(I=>{const F=$a(I);la(M,F,M.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}):A.split(",").map(C=>C.trim()).filter(Boolean).forEach(C=>{const I=$a(C);la(M,I,M.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)})}continue}const R=_.match(/^(\d+x?)\s+(.*)$/i);if(R&&o)if(o.charId){const L=R[1],S=R[2].trim();la(o,`${L} ${S}`,o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0);continue}else{const L={quantity:R[1],name:R[2].trim(),items:[],type:"subunit",_parent:o};o.items=o.items||[],o.items.push(L);continue}if(o){let L=_.split(",").map(A=>A.trim()).filter(Boolean);try{const A=o.items&&o.items.length>0?o.items[o.items.length-1]:null;A&&A.name&&(L=L.map(M=>{const D=M.match(/^(.*)\s*\(([^)]+)\)\s*$/);if(D){const C=D[1].trim();if(de(C)===de(A.name))return C}return M}))}catch{}try{const A=new Set;L=L.filter(M=>{const D=de($s($a(M)));return A.has(D)?!1:(A.add(D),!0)})}catch{}let S=o;if(o.items&&o.items.length>0){const A=o.items[o.items.length-1];A&&A.type==="subunit"&&(S=A)}L.forEach(A=>{const M=$s($a(A));la(S,M,S.name||o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}continue}const y=d.match(/^(\d+)\s+with\s+(.*)$/i);if(y&&o){const _=parseInt(y[1],10)||1,T=y[2],E=o.items&&o.items.length>0?o.items[o.items.length-1]:o;T.split(",").map(R=>R.trim()).filter(Boolean).forEach(R=>{const S=$s($a(R));E&&E.type==="subunit"?la(E,`${_}x ${S}`,E.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0):la(E,zi(_,S),E.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const g=d.match(/^(.*?):\s*(.*)$/);if(g&&o){(g[2]||"").split(",").map(T=>T.trim()).filter(Boolean).forEach(T=>{const E=$a(T);la(o,E,o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}}const m=[...n.CHARACTER||[],...n["OTHER DATASHEETS"]||[]];for(const h of m){h&&Array.isArray(h.items)&&h.items.length>0&&pa(h.items);const d=h&&Array.isArray(h.items)?h.items.filter(p=>p&&p.type==="subunit"):[];for(const p of d)p&&Array.isArray(p.items)&&p.items.length>0&&pa(p.items)}Ss(n);try{n.SUMMARY._parseDebug=(Xn||[]).slice(0,200)}catch{}return n}const Xn=[];function xr(t){const n=ns(t);if(n>0)return n;const a=(t||"").trim();return a.startsWith("â¦")||a.startsWith("+")?2:0}function _r(t){if(!t)return"";const n=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(t).split(/\s+/).map((a,r)=>{if(!a)return"";const s=a.toLowerCase();return r>0&&n.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function ks(t,n,a,r,s="",i=!1,o="wargear",l=1){if(!t)return;t.items=t.items||[];const m=ss(String(n||"").trim()),h=m.quantity?String(m.quantity):"1x",d=m.name||"",p=de(d);if(i){const y=String(a||""),g=String(s||"");if(de(y)===de(d)||g&&de(g)===de(d))return}const u=t.items.find(y=>de(y.name||"")===p);if(u){const y=parseInt(String(u.quantity||"1x").replace(/x/i,""),10)||0,g=parseInt(String(h||"1x").replace(/x/i,""),10)||0;u.quantity=`${y+g}x`}else{const y=de(d)==="warlord"?"special":o;t.items.push({quantity:h,name:d,items:[],type:y,nameshort:""})}}function Xi(t,n,a){if(!t||!n)return;n.items=n.items||[];const r=t.trim(),s=r.match(/\(([^)]+)\)$/),i=s?` (${s[1]})`:"",o=r.replace(/\s*\([^)]+\)$/,"").trim(),l=de(o);if((n.items||[]).some(u=>u&&u.type==="special"&&de((u.name||"").replace(/^Enhancement:\s*/i,""))===l))return;const d=`E: ${o.split(/\s+/).map(u=>u[0]?u[0].toUpperCase():"").join("")}${i}`.trim(),p={quantity:"1x",name:`Enhancement: ${o}`,nameshort:d,items:[],type:"special"};n.items.push(p)}function Km(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=t.findIndex(u=>a.test((u||"").trim().toUpperCase()));let i=(r===-1?t.slice(0,0):t.slice(0,r)).map(u=>(u||"").trim()).filter(u=>u&&!u.startsWith("Exported with"));const o=i.findIndex(u=>u&&u.trim()!=="");if(o!==-1){const u=i[o],y=u.match(/^(.*?)\s*\((\s*\d+\s*(?:pts|points)\s*)\)\s*$/i);if(y){n.SUMMARY.LIST_TITLE=y[1].trim();const M=(y[2].match(/(\d+)/)||[])[1]||"";M&&(n.SUMMARY.TOTAL_ARMY_POINTS=`${M}pts`)}else n.SUMMARY.LIST_TITLE=u;const g=[];for(let M=o+1;M<i.length;M++){const D=i[M];D&&g.push(D)}const _=["Combat Patrol","Incursion","Strike Force","Onslaught"],T=M=>{if(!M||!/\(/.test(M))return!1;for(const D of _)if(new RegExp(D,"i").test(M))return!0;return!1},E=new Set(Object.values(Ca).map(M=>(M||"").toString().toLowerCase())),R=g.filter(M=>!(!M||T(M)||E.has(M.toLowerCase())));let L=null,S=null;const A=Object.keys(Ca).map(M=>M.toLowerCase());for(const M of R)A.includes((M||"").toString().toLowerCase())?L=M:S||(S=M);if(!L&&R.length>0&&(L=R[0],S=R.length>1?R[1]:S),L&&(n.SUMMARY.FACTION_KEYWORD=L),S&&(n.SUMMARY.DETACHMENT=S),L){const M=Object.keys(Ca).find(C=>C.toLowerCase()===L.toLowerCase()),D=M?Ca[M]:null;D?n.SUMMARY.DISPLAY_FACTION=`${D} - ${L}`:n.SUMMARY.DISPLAY_FACTION=L+(S?` - ${S}`:"");try{n.SUMMARY.FACTION_KEY=L.toString().toLowerCase()}catch{}}}const l=r===-1?0:r,m=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*$/i,h=/^\s*(?:â¢|\-|\+|â¦)\s*(.*)$/;let d=null;for(let u=l;u<t.length;u++){const g=(t[u]||"").trim();if(!g||g.startsWith("Exported with"))continue;if(a.test(g.toUpperCase())){d=/^CHARACTERS?/i.test(g)?"CHARACTER":"OTHER DATASHEETS";continue}const _=g.match(m);if(_){const T=_[1].trim(),E=parseInt(String(_[2]).replace(/[\,\.\s]/g,""),10)||0;let R="1x",L=T;const S=T.match(/^([0-9]+x?)\s+(.*)$/i);S&&(R=S[1].toLowerCase(),L=S[2].trim());const A={quantity:R,name:L,points:E,items:[],isComplex:!1,nameshort:""},M=d==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[M]=n[M]||[],n[M].push(A);const D=[];let C=u+1;for(;C<t.length;){const $=t[C]||"";if(!$.trim()||a.test($.trim().toUpperCase())||m.test($.trim())||!/^\s+/.test($)&&!h.test($))break;D.push($),C++}const I=(()=>{for(let $=0;$<D.length;$++){const he=D[$];if(!he.match(h))continue;const ne=xr(he);for(let re=$+1;re<D.length;re++){const ue=D[re];if(!ue.trim()||xr(ue)<=ne)break;if(h.test(ue))return!0}}return!1})();let F=null,le=0;for(let $=0;$<D.length;$++){const he=D[$],we=he.trim(),ne=he.match(h),re=xr(he);if(ne){const ue=ne[1].trim(),be=ue.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(ue)){Xi(ue.replace(/^Enhancement:\s*/i,"").trim(),A,n.SUMMARY.FACTION_KEYWORD||"");continue}else if(be){Xi(ue.trim(),A,n.SUMMARY.FACTION_KEYWORD||"");continue}if(I){if(F&&typeof le=="number"&&re>le){ks(F,ue,F.name,n.SUMMARY.FACTION_KEYWORD||"",A.name,!1);continue}if(!(()=>{for(let W=$+1;W<D.length;W++){const ye=D[W];if(!ye.trim()||xr(ye)<=re)break;if(h.test(ye))return!0}return!1})()){F=null,ks(A,ue,A.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}F=null;const ee=ue.match(/^(\d+x?)\s+(.*)$/i),K=ee?ee[1]:"1x",j=ee?ee[2].trim():ue,xe={quantity:K,name:j,items:[],type:"subunit"};A.items=A.items||[],A.items.push(xe),F=xe,le=re;continue}ks(A,ue,A.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(F&&re>le){ks(F,we,F.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}ks(A,we,A.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1)}u=C-1;continue}}function p(u,y){if(!(!u||typeof u!="object")){if(typeof u.name!="string"&&(u.name=""),typeof u.quantity!="string"&&(u.quantity=u.quantity?String(u.quantity):"1x"),typeof u.type!="string"&&(u.type=u.type||"wargear"),typeof u.nameshort!="string"&&(u.nameshort=u.nameshort||""),Array.isArray(u.items)||(u.items=[]),/^Enhancement:/i.test(u.name)){const g=u.name.replace(/^Enhancement:\s*/i,"").trim();u.type="special",u.nameshort=u.nameshort||(()=>{const _=g.match(/\(([^)]+)\)$/),T=_?` (${_[1]})`:"";return`E: ${g.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(L=>L[0]?L[0].toUpperCase():"").join("")}${T}`.trim()})(),u.name=`Enhancement: ${_r(g.replace(/\s*\([^)]+\)$/,"").trim())}`}else u.name=y?u.name:_r(u.name);de(u.name)==="warlord"&&(u.type="special"),u.items=(u.items||[]).map(g=>{if(!g)return null;if(typeof g=="string"){const _={quantity:"1x",name:g.trim(),items:[],type:/^Enhancement:/i.test(g)?"special":"wargear",nameshort:""};return p(_,u.name),_.name&&(_.name=_r(_.name)),_}return p(g,u.name),g&&g.name&&(g.name=_r(g.name)),g}).filter(Boolean)}}for(const u of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[u]))for(const y of n[u]){p(y);const g=(y.items||[]).filter(_=>_&&_.type==="subunit");if(g.length>0)if(g.every(T=>de(T.name||"")===de(y.name||""))){const T=new Map;let E=0;for(const R of g){const L=parseInt(String(R.quantity||"1x").replace(/x/i,""),10)||1;E+=L;for(const S of R.items||[]){const A={items:[]};ks(A,`${S.quantity||"1x"} ${S.name}`,y.name,n.SUMMARY.FACTION_KEYWORD||"",S.type||"wargear",1);for(const M of A.items){const D=de(M.name||"");if(T.has(D)){const C=T.get(D),I=parseInt(String(C.quantity||"1x").replace(/x/i,""),10)||0,F=parseInt(String(M.quantity||"1x").replace(/x/i,""),10)||0;C.quantity=`${I+F}x`}else T.set(D,M)}}}y.items=Array.from(T.values()),E>0&&(y.quantity=`${E}x`),y.isComplex=!1}else{const T=g.reduce((E,R)=>E+(parseInt(String(R.quantity||"1x").replace(/x/i,""),10)||0),0);T>0&&(y.quantity=`${T}x`),y.isComplex=!0}else y.isComplex=!1;Array.isArray(y.items)&&y.items.length>0&&pa(y.items)}return Ss(n),n}function Vi(t){if(!t)return"";const n=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(t).split(/\s+/).map((a,r)=>{if(!a)return"";const s=a.toLowerCase();return r>0&&n.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function Za(t,n,a,r,s="",i=!1,o="wargear",l=1){if(!t)return;t.items=t.items||[];const m=ss(String(n||"").trim()),h=m.quantity?String(m.quantity):"1x",d=parseInt(String(h||"1x").replace(/[^0-9]/g,""),10)||1,p=`${d*(l||1)}x`;let u=m.name||"";if(!i)try{const _=u.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(_){const T=_[1].trim(),E=_[2].trim(),R=de(T),L=de(a||""),S=de(s||"");R&&(R===L||R===S||L.startsWith(R+" ")||S.startsWith(R+" ")||R.startsWith(L+" ")||R.startsWith(S+" "))&&(u=E)}}catch{}const y=de(u);if(i){const _=String(a||""),T=String(s||""),E=de(u),R=de(_),L=de(T),S=R&&E.startsWith(R+" "),A=L&&E.startsWith(L+" ");if(R&&(E===R||S)||L&&(E===L||A)){const M=u.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(M){const D=M[1].trim(),C=M[2].trim(),I=de(D);if(I===R||I===L||I.startsWith(R+" ")||I.startsWith(L+" ")){if(t&&t._deferredParenthetical&&de(t._deferredParenthetical)===de(C)||t&&t._deferredParenthetical&&de(t._deferredParenthetical)===de(C)||(t.items||[]).some(le=>de(le.name||"")===de(C)))return;Za(t,C,a,r,s,!1,o,d);return}}return}}const g=t.items.find(_=>de(_.name||"")===y);if(g){const _=parseInt(String(g.quantity||"1x").replace(/x/i,""),10)||0,T=parseInt(String(p||"1x").replace(/x/i,""),10)||0;g.quantity=`${_+T}x`}else{const _=de(u)==="warlord"?"special":o;t.items.push({quantity:p,name:u,items:[],type:_,nameshort:""})}}function oi(t,n,a){if(!t||!n)return;n.items=n.items||[];const r=t.trim(),s=r.match(/\(([^)]+)\)$/),i=s?` (${s[1]})`:"",o=r.replace(/\s*\([^)]+\)$/,"").trim(),l=de(o);if((n.items||[]).some(u=>u&&u.type==="special"&&de((u.name||"").replace(/^Enhancement:\s*/i,""))===l))return;const d=`E: ${o.split(/\s+/).map(u=>u[0]?u[0].toUpperCase():"").join("")}${i}`.trim(),p={quantity:"1x",name:`Enhancement: ${o}`,nameshort:d,items:[],type:"special"};n.items.push(p)}function ji(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*(?::\s*(.*))?$/i,s=/^\s*(?:â¢|\-|\+|â¦)\s*(.*)$/;let i=null;for(let l=0;l<t.length;l++){const h=(t[l]||"").trim();if(!h)continue;if(a.test(h.toUpperCase())){i=/^CHARACTERS?/i.test(h)?"CHARACTER":"OTHER DATASHEETS";continue}const d=h.match(r);if(d){const p=d[1].trim(),u=parseInt(String(d[2]).replace(/[\,\.\s]/g,""),10)||0;let y="1x",g=p;const _=p.match(/^([0-9]+x?)\s+(.*)$/i);_&&(y=_[1].toLowerCase(),g=_[2].trim());const T={quantity:y,name:g,points:u,items:[],isComplex:!1,nameshort:""},E=i==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[E]=n[E]||[],n[E].push(T);const R=d[3]||"";R&&R.split(",").map(C=>C.trim()).filter(Boolean).forEach(C=>Za(T,C,T.name,n.SUMMARY.FACTION_KEYWORD||"",T.name,!0));const L=[];let S=l+1;for(;S<t.length;){const C=t[S]||"";if(!C.trim()||a.test(C.trim().toUpperCase())||r.test(C.trim())||!/^\s+/.test(C)&&!s.test(C))break;L.push(C),S++}const A=(()=>{for(let C=0;C<L.length;C++){const I=L[C];if(!I.match(s))continue;const le=ns(I);for(let $=C+1;$<L.length;$++){const he=L[$];if(!he.trim()||ns(he)<=le)break;if(s.test(he))return!0}}return!1})();let M=null,D=0;for(let C=0;C<L.length;C++){const I=L[C],F=I.trim(),le=I.match(s),$=ns(I);if(le){const he=le[1].trim(),we=he.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(he)){oi(he.replace(/^Enhancement:\s*/i,"").trim(),T,n.SUMMARY.FACTION_KEYWORD||"");continue}else if(we){oi(he.trim(),T,n.SUMMARY.FACTION_KEYWORD||"");continue}if(A){if(M&&typeof D=="number"&&$>D){const Le=he.split(",").map(ee=>ee.trim()).filter(Boolean);for(let ee of Le){const K=ee.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(K){const j=K[1].trim(),xe=K[2].trim();if(de(j)===de(M.name)){const W=Le.some(fe=>de(fe)===de(xe)),ye=(M.items||[]).some(fe=>de(fe.name||"")===de(xe));if(W||ye)continue;const ke=ss(ee),dt=parseInt(String(ke.quantity||"1x").replace(/[^0-9]/g,""),10)||1;Za(M,xe,M.name,n.SUMMARY.FACTION_KEYWORD||"",T.name,!1,"wargear",dt);continue}}Za(M,ee,M.name,n.SUMMARY.FACTION_KEYWORD||"",T.name,!0)}continue}M=null;const ne=he.match(/^(\d+x?)\s+(.*)$/i),re=ne?ne[1]:"1x";let ue=ne?ne[2].trim():he;try{const Le=ue.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(Le){const ee=Le[1].trim(),K=Le[2].trim(),j=de(ee),xe=de(T.name||""),W=de(unitTopName||T.name||"");if(j&&(j===xe||xe.startsWith(j)||j.startsWith(xe)||W.startsWith(j)||j.startsWith(W))){ue=ee;const ye={quantity:re,name:ue,items:[],type:"subunit"};ye._deferredParenthetical=K,ye._deferredParentheticalQty=parseInt(String(re||"1x").replace(/[^0-9]/g,""),10)||1,T.items=T.items||[],T.items.push(ye),M=ye,D=$;continue}}}catch{}const be={quantity:re,name:ue,items:[],type:"subunit"};T.items=T.items||[],T.items.push(be),M=be,D=$;continue}Za(T,he,T.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(M&&$>D){Za(M,F,M.name,n.SUMMARY.FACTION_KEYWORD||"",T.name,!0);continue}Za(T,F,T.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1)}l=S-1;continue}}function o(l,m){if(!(!l||typeof l!="object")){if(typeof l.name!="string"&&(l.name=""),typeof l.quantity!="string"&&(l.quantity=l.quantity?String(l.quantity):"1x"),typeof l.type!="string"&&(l.type=l.type||"wargear"),typeof l.nameshort!="string"&&(l.nameshort=l.nameshort||""),Array.isArray(l.items)||(l.items=[]),/^Enhancement:/i.test(l.name)){const h=l.name.replace(/^Enhancement:\s*/i,"").trim();l.type="special",l.nameshort=l.nameshort||(()=>{const d=h.match(/\(([^)]+)\)$/),p=d?` (${d[1]})`:"";return`E: ${h.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(g=>g[0]?g[0].toUpperCase():"").join("")}${p}`.trim()})(),l.name=`Enhancement: ${Vi(h.replace(/\s*\([^)]+\)$/,"").trim())}`}else l.name=m?l.name:Vi(l.name);de(l.name)==="warlord"&&(l.type="special"),l.items=(l.items||[]).map(h=>{if(!h)return null;if(typeof h=="string"){const d={quantity:"1x",name:h.trim(),items:[],type:/^Enhancement:/i.test(h)?"special":"wargear",nameshort:""};return o(d,l.name),d}return o(h,l.name),h}).filter(Boolean)}}for(const l of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[l]))for(const m of n[l]){o(m);const h=(m.items||[]).filter(p=>p&&p.type==="subunit");if(h.length>0)if(h.every(u=>de(u.name||"")===de(m.name||""))){const u=new Map;let y=0;for(const g of h){const _=parseInt(String(g.quantity||"1x").replace(/x/i,""),10)||1;y+=_;for(const T of g.items||[]){const E={items:[]};Za(E,`${T.quantity||"1x"} ${T.name}`,m.name,n.SUMMARY.FACTION_KEYWORD||"",T.type||"wargear",1);for(const R of E.items){const L=de(R.name||"");if(u.has(L)){const S=u.get(L),A=parseInt(String(S.quantity||"1x").replace(/x/i,""),10)||0,M=parseInt(String(R.quantity||"1x").replace(/x/i,""),10)||0;S.quantity=`${A+M}x`}else u.set(L,R)}}}m.items=Array.from(u.values()),y>0&&(m.quantity=`${y}x`),m.isComplex=!1}else{const u=h.reduce((y,g)=>y+(parseInt(String(g.quantity||"1x").replace(/x/i,""),10)||0),0);u>0&&(m.quantity=`${u}x`),m.isComplex=!1}else m.isComplex=!1;if(Array.isArray(m.items)&&m.items.length===1&&m.items[0]&&m.items[0].type==="subunit"){const p=m.items[0];Array.isArray(p.items)&&p.items.length>0&&(m.items=p.items.slice(),m.isComplex=!1)}Array.isArray(m.items)&&m.items.length>0&&pa(m.items);const d=(m.items||[]).filter(p=>p&&p.type==="subunit");for(const p of d)Array.isArray(p.items)&&p.items.length>0&&pa(p.items)}return Ss(n),n}function Gm(t){if(!Array.isArray(t))return ji(t);const n=[];let a=0;for(;a<t.length;a++){const p=String(t[a]||"").trim();if(!p){n.push(p);continue}if(p.startsWith("+")||p.startsWith("&")){n.push(p);continue}break}const r=[],s={};for(const d of n){if(!d)continue;if(d.startsWith("&")){const g=d.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);g&&r.push({enh:g[1].trim(),target:(g[3]||"").trim(),charId:g[2]||null});continue}const u=d.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(u){const y=u[1].trim().toUpperCase(),g=u[2].trim();if(y==="ENHANCEMENT"){const _=g.match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);_?r.push({enh:_[1].trim(),target:(_[3]||"").trim(),charId:_[2]||null}):r.push({enh:g,target:null,charId:null})}else if(y==="FACTION KEYWORD"){const _=g.split(" - ");s.faction=_[_.length-1].trim()}else y==="DETACHMENT"?s.detachment=g.replace(/\u00A0/g," "):y==="TOTAL ARMY POINTS"&&(s.points=g)}}const i=t.slice(a),o=[];for(const d of i){if(!d){o.push(d);continue}let p=String(d);p=p.replace(/^\s*Char\d+:\s*/i,"");const u=p.match(/^(.*\))\s*:\s*(.+)$/);u?(o.push(u[1]),o.push("  â¢ "+u[2])):o.push(p)}const l=ji(o);l.SUMMARY=l.SUMMARY||{},s.faction&&(l.SUMMARY.FACTION_KEYWORD=s.faction),s.detachment&&(l.SUMMARY.DETACHMENT=s.detachment),s.points&&(l.SUMMARY.TOTAL_ARMY_POINTS=s.points);const m=[...l.CHARACTER||[],...l["OTHER DATASHEETS"]||[]],h=d=>{const p=de(String(d||""));for(const u of m){const y=u&&Array.isArray(u.items)?u.items:[];for(const g of y){if(!g||!g.name)continue;const _=String(g.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,"").trim();if(de(_)===p)return!0}}return!1};for(const d of r){if(!d||!d.enh||h(d.enh))continue;let p=null;const u=y=>String(y||"").toLowerCase().replace(/[^a-z0-9 ]/g,"").trim();if(d.charId){const y=parseInt(String(d.charId).replace(/[^0-9]/g,""),10);!Number.isNaN(y)&&y>0&&Array.isArray(l.CHARACTER)&&l.CHARACTER[y-1]&&(p=l.CHARACTER[y-1])}!p&&d.target&&(p=m.find(y=>u(y.name).includes(u(d.target))||u(`${y.quantity} ${y.name}`).includes(u(d.target)))),!p&&m.length===1&&(p=m[0]),p&&oi(d.enh,p,l.SUMMARY.FACTION_KEYWORD||"")}try{for(const d of["CHARACTER","OTHER DATASHEETS"]){const p=l[d];if(Array.isArray(p))for(const u of p)u&&typeof u=="object"&&Object.prototype.hasOwnProperty.call(u,"type")&&delete u.type}for(const d of["CHARACTER","OTHER DATASHEETS"]){const p=l[d];if(Array.isArray(p)){for(const u of p)if(!(!u||!Array.isArray(u.items))){for(const y of u.items.filter(g=>g&&g.type==="subunit"))if(y&&y._deferredParenthetical)try{delete y._deferredParenthetical,delete y._deferredParentheticalQty}catch{}}}}}catch{}return Ss(l),l}function zm(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=t.map(h=>String(h||"")).find(h=>h.trim()),r=t.findIndex(h=>String(h||"").trim());if(a){const h=a.split(/\s*-\s*/).map(d=>d.trim()).filter(Boolean);if(n.SUMMARY.FACTION_FAMILY=h[0]||"",n.SUMMARY.FACTION_KEYWORD=h[1]||"",h.length>=3){const p=h[h.length-1].match(/\[\s*(\d{2,5})\s*pts?\s*\]$/i);p?(n.SUMMARY.TOTAL_ARMY_POINTS=`${p[1]}pts`,h.length===3?n.SUMMARY.LIST_TITLE=h[2]:n.SUMMARY.LIST_TITLE=h.slice(2,h.length-1).join(" - ")):n.SUMMARY.LIST_TITLE=h.slice(2).join(" - ")}n.SUMMARY.DISPLAY_FACTION=a.trim()}for(let h=0;h<Math.min(t.length,40);h++){const d=String(t[h]||"").trim();if(!d)continue;const p=d.match(/^Detachment:\s*(.*)$/i);p&&(n.SUMMARY.DETACHMENT=p[1].trim());const u=d.match(/^TOTAL ARMY POINTS:\s*(.*)$/i);u&&(n.SUMMARY.TOTAL_ARMY_POINTS=u[1].trim());const y=d.match(/^FACTION KEYWORD:\s*(.*)$/i);y&&(n.SUMMARY.FACTION_KEYWORD=y[1].trim());const g=d.match(/^Battle Size:\s*(.*)$/i);g&&(n.SUMMARY.BATTLE_SIZE=g[1].trim());const _=d.match(/^#+\s*(?:\+{1,2}\s*)?(.*)\[\s*\d{2,5}\s*pts?\s*\]$/i);if(_&&!n.SUMMARY.LIST_TITLE){const T=_[1].trim();/Army\s+Roster/i.test(T)||/\+\+/.test(T)?n.SUMMARY.LIST_TITLE="":n.SUMMARY.LIST_TITLE=T}}if(!n.SUMMARY.FACTION_KEYWORD&&n.SUMMARY.DISPLAY_FACTION){const h=n.SUMMARY.DISPLAY_FACTION.split(" - ");h.length>=2?n.SUMMARY.FACTION_KEYWORD=h[1].trim():n.SUMMARY.FACTION_KEYWORD=n.SUMMARY.DISPLAY_FACTION.replace(/\s*\[.*$/,"").trim()}const s=/^(?:(\d+)x?\s+)?(.+?)\s*\[\s*(\d{1,4})\s*pts?\s*\]\s*(?::\s*(.*))?$/i,i=/^\s*(?:â¢|\-|\+)\s*(.*)$/;let o=null,l=null;for(let h=0;h<t.length;h++){const d=String(t[h]||""),p=d.trim();if(!p||h===r)continue;if(p.startsWith("#")){const g=p.match(/^#+\s*(.+?)\s*(?:\[\s*\d+\s*pts?\s*\])?$/i);if(g){const _=g[1].trim();/character|epic|hero|hq/i.test(_)?o="CHARACTER":o="OTHER DATASHEETS"}continue}const u=p.match(s);if(u){const g=u[1]?`${u[1]}x`:"1x",_=(u[2]||"").trim(),T=parseInt(u[3],10)||0,E=u[4]||"",R={quantity:g,name:_,points:T,items:[],isComplex:!1,nameshort:""};o||(o="OTHER DATASHEETS"),n[o]=n[o]||[],n[o].push(R),l=R,E&&E.split(",").map(L=>L.trim()).filter(Boolean).forEach(L=>{m(l,L,l.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}const y=d.match(i);if(y&&l){const g=y[1].trim(),_=g.match(/^(\d+)\s+with\s+(.*)$/i);if(_&&l){const R=parseInt(_[1],10)||1,L=_[2],S=l.items&&l.items.length>0?l.items[l.items.length-1]:l;L.split(",").map(A=>A.trim()).filter(Boolean).forEach(A=>m(S,`${R}x ${A}`,S.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0));continue}const T=g.match(/^(\d+x?)\s+([^:]+):\s*(.*)$/i);if(T){const R=T[1];let L=T[2].trim();const S=T[3]||"";L=L.replace(/\s+w\/.*$/i,"").trim();const A={quantity:R,name:L,items:[],type:"subunit"};if(S){const M=S.match(/^(\d+)\s+with\s+(.*)$/i);if(M){const D=parseInt(M[1],10)||1;M[2].split(",").map(I=>I.trim()).filter(Boolean).forEach(I=>m(A,`${D}x ${I}`,A.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0))}else S.split(",").map(D=>D.trim()).filter(Boolean).forEach(D=>m(A,D,A.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0))}l.items=l.items||[],l.items.push(A);continue}const E=g.match(/^(\d+x?)\s+(.*)$/i);if(E&&l){let R=E[2].trim();R=R.replace(/\s+w\/.*$/i,"").trim();const L={quantity:E[1],name:R,items:[],type:"subunit"};l.items=l.items||[],l.items.push(L);continue}m(l,g,l.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0);continue}}function m(h,d,p,u,y="",g=!1,_="wargear"){if(!h)return;h.items=h.items||[];const T=String(d||"").trim(),E=ss(T),R=E.quantity?String(E.quantity):"1x",L=/^\s*\d+x?\s+/i.test(T);let S=E.name||"";const A=S.match(/^(.*?)\s*\(([^)]+)\)$/);if(A){const F=(A[1]||"").trim(),le=(A[2]||"").trim();(/\bDrone\b/i.test(F)||/\bDrone\b/i.test(S))&&(S=le)}const M=de(S);if(g){const F=String(p||""),le=String(y||"");if(de(F)===de(S)||le&&de(le)===de(S))return}const D=parseInt(String(R||"1x").replace(/x/i,""),10)||1;let C=D;if(h&&h.type==="subunit"){const F=parseInt(String(h.quantity||"1x").replace(/[^0-9]/g,""),10)||1;C=L?D:F}const I=h.items.find(F=>de(F.name||"")===M);if(I){const F=parseInt(String(I.quantity||"1x").replace(/x/i,""),10)||0;I.quantity=`${F+C}x`}else{const F=de(S)==="warlord"?"special":_;h.items.push({quantity:`${C}x`,name:S,items:[],type:F,nameshort:""})}}for(const h of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[h]))for(const d of n[h]){if(!d||!Array.isArray(d.items)||d.items.length===0)continue;if(d.items.filter(y=>y&&y.type==="subunit").length>1){const y=new Map,g=[];for(const _ of d.items){if(!_||_.type!=="subunit"){g.push(_);continue}const T=de(_.name||"");if(!y.has(T))y.set(T,{quantity:_.quantity||"1x",name:_.name,items:Array.isArray(_.items)?_.items.slice():[],type:"subunit"});else{const E=y.get(T),R=parseInt(String(E.quantity||"1x").replace(/[^0-9]/g,""),10)||0,L=parseInt(String(_.quantity||"1x").replace(/[^0-9]/g,""),10)||0;E.quantity=`${R+L}x`;const S=new Map;for(const A of E.items||[]){const M=de(A&&A.name||"");M&&S.set(M,{quantity:A.quantity||"1x",name:A.name,items:[],type:A.type||"wargear",nameshort:A.nameshort||""})}for(const A of _.items||[]){const M=de(A&&A.name||"");if(M)if(S.has(M)){const D=S.get(M),C=parseInt(String(D.quantity||"1x").replace(/[^0-9]/g,""),10)||0,I=parseInt(String(A.quantity||"1x").replace(/[^0-9]/g,""),10)||0;D.quantity=`${C+I}x`}else S.set(M,{quantity:A.quantity||"1x",name:A.name,items:[],type:A.type||"wargear",nameshort:A.nameshort||""})}E.items=Array.from(S.values())}}d.items=[...g,...Array.from(y.values())]}d&&Array.isArray(d.items)&&d.items.length>0&&pa(d.items);const u=d&&Array.isArray(d.items)?d.items.filter(y=>y&&y.type==="subunit"):[];for(const y of u)y&&Array.isArray(y.items)&&y.items.length>0&&pa(y.items)}return Ss(n),n}function Xm(t,n=40){return(Array.isArray(t)?t:String(t||"").split(/\r?\n/)).slice(0,n)}function Vm(t){const n=Array.isArray(t)?t:String(t||"").split(/\r?\n/),a=Xm(n,40),r=n.join(`
`),s={NRNR:{score:0,breakdown:{},maxScore:8},"WTC-Compact":{score:0,breakdown:{},maxScore:8},WTC:{score:0,breakdown:{},maxScore:8},GWAPP:{score:0,breakdown:{},maxScore:7},"NR-GW":{score:0,breakdown:{},maxScore:7},LF:{score:0,breakdown:{},maxScore:7}},i=a.some(ne=>/-\s*\[\s*\d{2,5}\s*pts?\s*\]$/i.test(ne)),o=a.some(ne=>/^#{1,3}\s+/.test(ne)),l=a.some(ne=>/^\s*#?\s*\+\+\s*Army Roster\s*\+\+/i.test(ne)),m=a.some(ne=>/^\s*##\s+/.test(ne)),h=/(.+?)\s*[\(\[]\s*([0-9]{1,4})\s*(?:pts|points)\s*[\)\]]/i,d=r.match(new RegExp(h.source,"g"))||[],p=r.match(/^[ \t]*(?:â¢|\-|\+)\s*(?:\d+x?)\s+[^:]+:/gmi)||[],u=r.match(/\b[A-Za-z0-9\-\'â ]+\s*\([^\)]+\)/g)||[],y=/(^|\n)\s*Char\d+:.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)\s*:\s*/i,g=(r.match(new RegExp(y.source,"gi"))||[]).length,_=a.some(ne=>/^(List Name|Factions Used|Army Points|Detachment Rule):/i.test(ne.trim())),T=a.some(ne=>/-\s*\(\s*\d+\s*Points?\s*\)\s*$/i.test(ne)),E=r.match(/^(Epic Hero|Epic Heroes|Character|Characters|Battleline|Infantry|Beast|Vehicle|Dedicated Transport|Other Datasheets):\s*$/gmi)||[],R=(r.match(/^\s*â¢\s*(?:E:|Enhancement:)/gmi)||[]).length,L=(r.match(/^\s*â¢\s+/gmi)||[]).length;_&&(s.LF.score+=4,s.LF.breakdown.headerKeys=4),T&&(s.LF.score+=4,s.LF.breakdown.titleLine=4),E.length>=2&&(s.LF.score+=3,s.LF.breakdown.sectionColons=E.length),L>5&&(s.LF.score+=1,s.LF.breakdown.bullets=L),R>0&&(s.LF.score+=1,s.LF.breakdown.enhancementLines=R),(_||T||E.length>=2)&&(s.NRNR.score-=1,s.WTC.score-=1,s["WTC-Compact"].score-=1,s.GWAPP.score-=1,s["NR-GW"].score-=3),i&&(s.NRNR.score+=2,s.NRNR.breakdown.titleWithBracketedPts=2),o&&(s.NRNR.score+=3,s.NRNR.breakdown.markdownHeading=3),l&&(s.NRNR.score+=2,s.NRNR.breakdown.armyRoster=2),m&&(s.NRNR.score+=1,s.NRNR.breakdown.doubleHashSections=1),d.length>=3&&(s.NRNR.score+=1,s.NRNR.breakdown.unitLines=1),p.length>0&&(s.NRNR.score+=1,s.NRNR.breakdown.bulletWithQty=p.length),u.length>0&&(s.NRNR.score+=.5,s.NRNR.breakdown.parenItem=u.length);const S=a.join(`
`);/^[ \t]*[+&]/m.test(S)&&(s["WTC-Compact"].score+=3,s["WTC-Compact"].breakdown.headerPlusAmp=3),/(FACTION KEYWORD|DETACHMENT|TOTAL ARMY POINTS)/i.test(S)&&(s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.headerKeys=2),d.length>=2&&(s["WTC-Compact"].score+=1,s["WTC-Compact"].breakdown.unitLines=1),g>0&&(s["WTC-Compact"].score+=5,s["WTC-Compact"].breakdown.inlineCharList=g),/^\s*[+&]/m.test(S)&&(s.WTC.score+=1,s.WTC.breakdown.headerPlusAmp=1),/NUMBER OF UNITS:/i.test(S)&&(s.WTC.score+=2,s.WTC.breakdown.numberOfUnits=2);const A=(r.match(/(^|\n)\s*Char\d+:/gi)||[]).length>0;A&&(s.WTC.score+=3,s.WTC.breakdown.charMarkers=3),(o||l||m)&&(s.WTC.score-=2,s.WTC.breakdown.nrnrPenalty=-2,s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.nrnrPenalty=-1);const M=(r.match(/^\s*\d+\s+with\s+/gmi)||[]).length;M>0&&(s.WTC.score+=2,s.WTC.breakdown.withLines=M,s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.withLines=M),a.some(ne=>/^(?:CHARACTER|OTHER DATASHEETS|CHARACTERS)\s*$/.test((ne||"").trim()))&&(s.WTC.score+=1,s.WTC.breakdown.sectionHeaders=1),A&&(s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.charMarkerPenalty=-1),g>0&&(s.WTC.score-=2,s.WTC.breakdown.compactInlinePenalty=-2);const D=/Exported with/i.test(r);(/Exported with/i.test(S)||D)&&(s.GWAPP.score+=6,s.GWAPP.breakdown.exportedWith=6),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS)\b/i.test(r)&&(s.GWAPP.score+=2,s.GWAPP.breakdown.sectionHeaders=2),/\(\s*\d+\s*(?:pts|points)\s*\)/i.test(S)&&(s.GWAPP.score+=1,s.GWAPP.breakdown.titleParenPts=1),D&&(s["NR-GW"].score-=4,s["NR-GW"].breakdown.gwappPenalty=-4),/^\s*Strike Force\s*\(\s*\d{2,5}\s*points\s*\)/mi.test(r)&&(s.GWAPP.score+=3,s.GWAPP.breakdown.strikeForce=3),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|DEDICATED TRANSPORTS)\b/i.test(r)&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.sectionHeaders=2);const C=(r.match(/^[ \t]*(?:â¢|\u2022|â¦|\-|\+)\s+/gmi)||[]).length;C>0&&!D&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.bulletCount=C),u.length>0&&!D&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.parenItem=u.length);const I=(r.match(/^[ \t]*(?:â¢|\u2022|â¦|\-|\+)\s*\d+x?\s+[A-Za-z0-9\-\'â]+/gmi)||[]).length;I>=3&&!A&&!D&&(s["NR-GW"].score+=3,s["NR-GW"].breakdown.bulletQty=I);const F=/^(?:\s*)\d+x?\s+.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)/i,le=n.filter(ne=>F.test(ne)).length;if(le>=2&&!A&&!D&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.unitLinesNoChar=le),!A&&!D&&(I>=3||le>=2)&&(s.WTC.score-=2,s.WTC.breakdown.nrGwPenalty=-2,s["WTC-Compact"].score-=2,s["WTC-Compact"].breakdown.nrGwPenalty=-2),(o||l)&&(s["NR-GW"].score-=1,s["NR-GW"].breakdown.nrnrPenalty2=-1),r.indexOf("â")!==-1)for(const ne of Object.keys(s))s[ne].score+=.5,s[ne].breakdown=s[ne].breakdown||{},s[ne].breakdown.unicodeApostrophe=.5;const $={};for(const ne of Object.keys(s)){const re=s[ne],ue=Math.max(0,Math.min(1,re.score/(re.maxScore||8)));$[ne]={score:re.score,confidence:ue,scoreBreakdown:re.breakdown}}const he=Object.keys($).sort((ne,re)=>$[re].score-$[ne].score)[0],we=$[he]||{score:0,confidence:0};return{format:he,confidence:we.confidence,score:we.score,scoreBreakdown:we.scoreBreakdown,all:$}}function cl(t){const n=String(t||"").trim().match(/^(\d+)\s+(.*)$/);return n&&!/^\d+x\b/i.test(String(t||""))?`${n[1]}x ${n[2]}`:t}function ul(t){const n=String(t||"").trim().replace(/^E:\s*/i,"").replace(/^Enhancement:\s*/i,"").trim(),a=n.match(/\(([^)]*pts?[^)]*)\)\s*$/i),r=n.replace(/\s*\([^)]*\)\s*$/,"").trim(),i=`E: ${r.split(/\s+/).map(o=>o[0]?o[0].toUpperCase():"").join("")}${a?` (${a[1].trim()})`:""}`.trim();return{quantity:"1x",name:`Enhancement: ${r}`,nameshort:i,items:[],type:"special"}}function jm(t,n){if(!t)return;t.items=t.items||[];const a=cl(String(n||"").trim());if(/^(E:|Enhancement:)/i.test(a)){const s=ul(a),i=de(s.name.replace(/^Enhancement:\s*/i,""));(t.items||[]).some(l=>/^Enhancement:/i.test(l.name||"")&&de(String(l.name).replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,""))===i)||t.items.push(s);return}const r=a.split(",").map(s=>s.trim()).filter(Boolean);for(const s of r){const i=ss(s.replace(/^with\s+/i,"")),o=i.quantity||"1x",l=i.name||"";if(!l)continue;const m=de(l),h=t.items.find(d=>de(d.name||"")===m);if(h){const d=parseInt(String(h.quantity||"1x").replace(/[^0-9]/g,""),10)||0,p=parseInt(String(o).replace(/[^0-9]/g,""),10)||0;h.quantity=`${d+p}x`}else t.items.push({quantity:o,name:l,items:[],type:"wargear",nameshort:""})}}function Zm(t,n){const a=t[n]||"",r=ns(a);for(let s=n+1;s<t.length;s++){const i=t[s]||"";if(!i.trim())continue;const o=ns(i),l=/^\s*â¢\s*/.test(i);return o>r&&l}return!1}function Qm(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=t.slice(0,30).map(u=>String(u||""));let r=!1;for(const u of a){const y=u.match(/^\s*([A-Za-z ][A-Za-z ]*):\s*(.*)$/);if(!y)continue;const g=y[1].trim().toLowerCase(),_=y[2].trim();if(g==="list name"&&(n.SUMMARY.LIST_TITLE=_,r=!0),g==="factions used"&&(n.SUMMARY.FACTION_KEYWORD=_,r=!0),g==="army points"){const T=parseInt(_.replace(/[^0-9]/g,""),10);T&&(n.SUMMARY.TOTAL_ARMY_POINTS=`${T}pts`,r=!0)}g==="detachment rule"&&(n.SUMMARY.DETACHMENT=_,r=!0)}if(!r){const u=t.find(y=>String(y||"").trim());if(u){const y=String(u).match(/^(.*?)\s*-\s*(.*?)\s*-\s*(.*?)\s*\((\d+)\s*Points?\)/i);y&&(n.SUMMARY.LIST_TITLE=y[1].trim(),n.SUMMARY.FACTION_KEYWORD=y[2].trim(),n.SUMMARY.DETACHMENT=y[3].trim(),n.SUMMARY.TOTAL_ARMY_POINTS=`${parseInt(y[4],10)}pts`)}}const s=/^\s*([A-Za-z ]+):\s*$/,i=/^\s*(.*?)\s*\((\d+)\s*pts?\)\s*$/i,o=/^\s*â¢\s*(.*)$/;let l=null;const m=[];for(let u=0;u<t.length;u++){const y=String(t[u]||"");if(!y.trim())continue;const _=y.match(s);if(_){const M=_[1].trim().toLowerCase();l=/hero|character/.test(M)?"CHARACTER":"OTHER DATASHEETS",m.length=0;continue}const T=y.match(i);if(T&&ns(y)===0){const M=T[1].trim(),D=parseInt(T[2],10)||0,C={quantity:"1x",name:M,points:D,items:[],isComplex:!1,nameshort:""},I=l==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[I]=n[I]||[],n[I].push(C),m.length=0,m.push({indent:0,node:C});continue}const E=y.match(o);if(!E)continue;const R=E[1].trim(),L=ns(y);for(;m.length>0&&L<=m[m.length-1].indent;)m.pop();const S=m.length>0?m[m.length-1].node:null;if(!S||/^B:\s*/i.test(R))continue;if(/^(E:|Enhancement:)/i.test(R)){const M=ul(R),D=m[0]?m[0].node:S;D.items=D.items||[],(D.items||[]).some(I=>/^Enhancement:/i.test(I.name||"")&&de(I.name)===de(M.name))||D.items.push(M);continue}if(Zm(t,u)){const M=ss(cl(R));let D=M.name||"";D=D.replace(/\s+w\/.*$/i,"").trim();const C={quantity:M.quantity||"1x",name:D,items:[],type:"subunit"};S.items=S.items||[],S.items.push(C),m.push({indent:L,node:C});continue}jm(S,R)}function h(u){const y=parseInt(String(u||"1x").replace(/[^0-9]/g,""),10);return Number.isFinite(y)&&y>0?y:1}for(const u of["CHARACTER","OTHER DATASHEETS"]){const y=n[u]||[];for(const g of y){const _=Array.isArray(g.items)?g.items:[],T=_.filter(S=>S&&S.type==="subunit");if(T.length<=1)continue;const E=new Map;for(const S of T){const A=de((S.name||"").replace(/\s+w\/.*/i,"").trim());E.has(A)||E.set(A,{name:S.name,qty:0,wargear:new Map});const M=E.get(A);M.qty+=h(S.quantity);const D=Array.isArray(S.items)?S.items:[];for(const C of D){const I=de(C.name||""),F=M.wargear.get(I)||{name:C.name,qty:0,type:C.type||"wargear"};F.qty+=h(C.quantity),M.wargear.has(I),M.wargear.set(I,F)}}const R=_.filter(S=>!(S&&S.type==="subunit")),L=[];for(const[,S]of E){const A={quantity:`${S.qty}x`,name:S.name,items:[],type:"subunit"};for(const[,M]of S.wargear)A.items.push({quantity:`${M.qty}x`,name:M.name,items:[],type:M.type||"wargear",nameshort:""});L.push(A)}g.items=[...R,...L]}}const d=n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD?String(n.SUMMARY.FACTION_KEYWORD).trim():"";function p(u){if(!u||!d)return u;const y=new RegExp("^"+d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\s+","i");return String(u).replace(y,"").trim()}if(d)for(const u of["CHARACTER","OTHER DATASHEETS"]){const y=n[u]||[];for(const g of y){g.name=p(g.name);const _=(g.items||[]).filter(T=>T&&T.type==="subunit");for(const T of _)T.name=p(T.name)}}for(const u of["CHARACTER","OTHER DATASHEETS"]){const y=n[u]||[];for(const g of y){Array.isArray(g.items)&&g.items.length>0&&pa(g.items);const _=(g.items||[]).filter(T=>T&&T.type==="subunit");for(const T of _)Array.isArray(T.items)&&T.items.length>0&&pa(T.items)}}return Ss(n),n}function Jm(t){try{const n=Vm(t).format;return n==="NRNR"?"NRNR":n==="WTC-Compact"?"WTC_COMPACT":n==="WTC"?"WTC":n==="GWAPP"?"GW_APP":n==="NR-GW"?"NR_GW":n==="LF"?"LF":"UNKNOWN"}catch{const a=Array.isArray(t)?t.slice(0,25):[],r=a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i)||/^\s*\+\s*DETACHMENT:/i.test(i)),s=a.some(i=>/^(?:CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i.test((i||"").trim().toUpperCase()));return r&&s?"NR_GW":a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i))?"WTC_COMPACT":s?"GW_APP":"UNKNOWN"}}async function ed(t){if(!t||typeof t!="string")throw new Error("Invalid army list text");const n=t.split(`
`),a=Jm(n);if(a==="UNKNOWN")throw new Error("Unable to detect army list format. Supported formats: GW App, WTC, WTC Compact, NR-GW, NR-NR, ListForge");let r;try{switch(a){case"GW_APP":r=Km(n);break;case"WTC":r=Um(n);break;case"WTC_COMPACT":r=Bm(n);break;case"NR_GW":r=Gm(n);break;case"NRNR":r=zm(n);break;case"LF":r=Qm(n);break;default:throw new Error(`Unsupported format: ${a}`)}}catch(i){throw console.error("Parse error:",i),new Error(`Failed to parse ${a} format: ${i.message}`)}const s=td(r);return{format:a,data:s}}function td(t,n){const a=t.SUMMARY||{},r=[],s=["CHARACTER","CHARACTERS","BATTLELINE","OTHER DATASHEETS","ALLIED UNITS","DEDICATED TRANSPORTS"];for(const i of s)t[i]&&Array.isArray(t[i])&&r.push(...t[i].map(o=>({...o,section:i})));return{FACTION_KEYWORD:a.FACTION_KEYWORD||a.FACTION_KEY||"Unknown",DETACHMENT:a.DETACHMENT||"",TOTAL_ARMY_POINTS:a.TOTAL_ARMY_POINTS||"0pts",LIST_TITLE:a.LIST_TITLE||"",UNITS:r}}function nd(t){if(!t)return 1;const n=String(t).match(/(\d+)/);return n?parseInt(n[1],10):1}const ad={Asurmen:{baseType:"40mm"},Autarch:{baseType:"32mm"},"Autarch wayleaper":{baseType:"32mm"},"Avatar of Khaine":{baseType:"80mm"},Baharroth:{baseType:"40mm"},"Corsair Voidreavers":{baseType:"28.5mm"},"Corsair Voidscarred":{baseType:"28.5mm"},"Crimson Hunter":{baseType:"120x92mm"},"D-cannon Platform":{baseType:"40mm"},"Dark Reapers":{baseType:"28.5mm"},"Death Jester":{baseType:"25mm"},"Dire Avengers":{baseType:"28.5mm"},"Eldrad Ulthran":{baseType:"32mm"},Falcon:{baseType:"Large Flying Base"},Farseer:{baseType:"25mm"},"Farseer Skyrunner":{baseType:"Small Flying Base"},"Fire Dragons":{baseType:"28.5mm"},"Fire Prism":{baseType:"Large Flying Base"},Fuegan:{baseType:"40mm"},"Guardian Defenders":{baseType:"28.5mm"},"Guardian Defenders: Heavy Weapon Platform":{baseType:"40mm"},"Hemlock Wraithfighter":{baseType:"120x92mm"},"Howling Banshees":{baseType:"28.5mm"},"Jain Zar":{baseType:"40mm"},Lhykhis:{baseType:"40mm"},"Maugan Ra":{baseType:"40mm"},"Night Spinner":{baseType:"Large Flying Base"},Rangers:{baseType:"28.5mm"},"Shadow Weaver Platform":{baseType:"40mm"},Shadowseer:{baseType:"25mm"},"Shining Spears":{baseType:"Large Flying Base"},"Shroud Runners":{baseType:"Large Flying Base"},Skyweavers:{baseType:"Large Flying Base"},Solitaire:{baseType:"25mm"},Spiritseer:{baseType:"25mm"},Starweaver:{baseType:"Large Flying Base"},"Storm Guardians":{baseType:"28.5mm"},"Storm Guardians: Serpentâs Scale Platform":{baseType:"40mm"},"Striking Scorpions":{baseType:"28.5mm"},"Swooping Hawks":{baseType:"28.5mm"},"The Visarch":{baseType:"32mm"}},sd={"Corvus Blackstar":{baseType:"120x92mm"},"Deathwatch Terminator Squad":{baseType:"40mm"},"Deathwatch Veterans":{baseType:"32mm"},"Fortis Kill Team":{baseType:"32mm"},"Indomitor Kill Team":{baseType:"40mm"},"Spectrus Kill Team":{baseType:"32mm"},"Spectrus Kill Team: Kill Team Infiltrators with bolt sniper rifles":{baseType:"40mm"},"Talonstrike Kill Team":{baseType:"32mm"},"Talonstrike Kill Team: Kill Team Heavy Intercessors with Jump Packs":{baseType:"40mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},rd={Archon:{baseType:"25mm"},Beastmaster:{baseType:"Small Flying Base"},"Beastmaster: Clawed Fiends, Khymerae, Razorwing Flocks":{baseType:"40mm"},"Court of the Archon: Sslyth":{baseType:"40mm"},"Court of the Archon: Ur-Ghul, Lhamaean, Medusae":{baseType:"25mm"},Cronos:{baseType:"Large Flying Base"},Drazhar:{baseType:"40mm"},Grotesques:{baseType:"40mm"},Haemonculus:{baseType:"25mm"},Hellions:{baseType:"Small Flying Base"},Incubi:{baseType:"28.5mm"},"Kabalite Warriors":{baseType:"25mm"},"Lelith Hesperax":{baseType:"32mm"},Mandrakes:{baseType:"28.5mm"},Raider:{baseType:"Large Flying Base"},Ravager:{baseType:"Large Flying Base"},"Razorwing Jetfighter":{baseType:"120x92mm"},Reavers:{baseType:"Small Flying Base"},Scourges:{baseType:"32mm"},Succubus:{baseType:"25mm"},Talos:{baseType:"Large Flying Base"},"Urien Rakarth":{baseType:"25mm"},Venom:{baseType:"Large Flying Base"},"Voidraven Bomber":{baseType:"120x92mm"},Wracks:{baseType:"25mm"},Wyches:{baseType:"25mm"}},id={"Annihilation Barge":{baseType:"Large Flying Base"},"Câtan Shard of the Deceiver":{baseType:"40mm"},"Câtan Shard of the Nightbringer":{baseType:"40mm"},"Câtan Shard of the Void Dragon":{baseType:"80mm"},"Canoptek Doomstalker":{baseType:"90mm"},"Canoptek Reanimator":{baseType:"60mm"},"Canoptek Scarab Swarms":{baseType:"40mm"},"Canoptek Spyders":{baseType:"60mm"},"Canoptek Wraiths":{baseType:"50mm"},"Catacomb Command Barge":{baseType:"Large Flying Base"},Chronomancer:{baseType:"40mm"},"Convergence of Dominion":{baseType:"hull",hullDimensions:{width:0,height:0}},Cryptothralls:{baseType:"32mm"},Deathmarks:{baseType:"32mm"},"Doom Scythe":{baseType:"120x92mm"},"Doomsday Ark":{baseType:"Large Flying Base"},"Flayed Ones":{baseType:"28.5mm"},"Ghost Ark":{baseType:"Large Flying Base"},"Hexmark Destroyer":{baseType:"50mm"},"Illuminor Szeras":{baseType:"80mm"},Immortals:{baseType:"32mm"},"Imotekh the Stormlord":{baseType:"40mm"},"Lokhust Destroyers":{baseType:"Large Flying Base"},"Lokhust Heavy Destroyers":{baseType:"60mm"},"Lokhust Lord":{baseType:"Large Flying Base"},Lychguard:{baseType:"32mm"},Monolith:{baseType:"160mm"},"Necron Warriors":{baseType:"32mm"},"Night Scythe":{baseType:"120x92mm"},Obelisk:{baseType:"120x92mm"},"Ophydian Destroyers":{baseType:"50mm"},"Orikan the Diviner":{baseType:"40mm"},Overlord:{baseType:"40mm"},"Overlord with Translocation Shroud":{baseType:"40mm"},Plasmancer:{baseType:"32mm"},Psychomancer:{baseType:"40mm"},"Royal Warden":{baseType:"32mm"},"Skorpekh Destroyers":{baseType:"50mm"},"Skorpekh Lord":{baseType:"60mm"},Technomancer:{baseType:"50mm"},"Tesseract Vault":{baseType:"120x92mm"},"The Silent King: Szarekh":{baseType:"100mm"},"The Silent King: Triarchal Menhir":{baseType:"50mm"},"Tomb Blades":{baseType:"Small Flying Base"},"Transcendent Câtan":{baseType:"60mm"},"Trazyn the Infinite":{baseType:"40mm"},"Triarch Praetorians":{baseType:"32mm"},"Triarch Stalker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Seraptek Heavy Construct":{baseType:"hull",hullDimensions:{width:0,height:0}}},od={Battlewagon:{baseType:"hull",hullDimensions:{width:0,height:0}},"Beast Snagga Boyz":{baseType:"32mm"},Beastboss:{baseType:"50mm"},"Beastboss on Squigosaur":{baseType:"80mm"},"Big Mek":{baseType:"50mm"},"Big Mek in Mega Armour":{baseType:"40mm"},"Big Mek with Shokk Attack Gun":{baseType:"40mm"},"Bigâed Bossbunka":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blitza-bommer":{baseType:"120x92mm"},"Boomdakka Snazzwagon":{baseType:"150x95mm"},"Boss Snikrot":{baseType:"40mm"},Boyz:{baseType:"32mm"},"Breaka Boyz":{baseType:"32mm"},"Breaka Boyz: Boss Nob":{baseType:"40mm"},"Burna Boyz":{baseType:"32mm"},"Burna-bommer":{baseType:"120x92mm"},Dakkajet:{baseType:"120x92mm"},"Deff Dread":{baseType:"60mm"},"Deffkilla Wartrike":{baseType:"150x95mm"},Deffkoptas:{baseType:"75x42mm"},"Flash Gitz":{baseType:"40mm"},"Ghazghkull Thraka":{baseType:"80mm"},"Ghazghkull Thraka: Makari":{baseType:"25mm"},Gorkanaut:{baseType:"170x109mm"},Gretchin:{baseType:"25mm"},"Gretchin: Runtherd":{baseType:"32mm"},"Hunta Rig":{baseType:"170x109mm"},"Kill Rig":{baseType:"170x109mm"},"Killa Kans":{baseType:"60mm"},Kommandos:{baseType:"32mm"},"Kustom Boosta-blasta":{baseType:"150x95mm"},Lootas:{baseType:"32mm"},Meganobz:{baseType:"40mm"},"Megatrakk Scrapjet":{baseType:"150x95mm"},Mek:{baseType:"32mm"},"Mek Gunz":{baseType:"hull",hullDimensions:{width:0,height:0}},Morkanaut:{baseType:"170x109mm"},"Mozrog Skragbad":{baseType:"80mm"},Nobz:{baseType:"32mm"},Painboss:{baseType:"40mm"},Painboy:{baseType:"32mm"},"Rukkatrukk Squigbuggy":{baseType:"150x95mm"},"Shokkjump Dragsta":{baseType:"150x95mm"},"Squighog Boyz":{baseType:"75x42mm"},"Squighog Boyz: Nob on Smasha Squig":{baseType:"90x52.5mm"},Stompa:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormboyz:{baseType:"32mm"},Tankbustas:{baseType:"32mm"},"Tankbustas: Boss Nob":{baseType:"40mm"},Trukk:{baseType:"hull",hullDimensions:{width:0,height:0}},Warbikers:{baseType:"75x42mm"},Warboss:{baseType:"40mm"},"Warboss in Mega Armour":{baseType:"50mm"},"Wazbom Blastajet":{baseType:"150x95mm"},Weirdboy:{baseType:"40mm"},Wurrboy:{baseType:"32mm"},"Zodgrod Wortsnagga":{baseType:"50mm"},"Gargantuan Squiggoth":{baseType:"hull",hullDimensions:{width:0,height:0}}},ld={Barbgaunts:{baseType:"40mm"},Biovores:{baseType:"80mm"},Broodlord:{baseType:"75x42mm"},Carnifexes:{baseType:"105x70mm"},Deathleaper:{baseType:"60mm"},Exocrine:{baseType:"120x92mm"},Gargoyles:{baseType:"Small Flying Base"},Genestealers:{baseType:"32mm"},Harpy:{baseType:"120x92mm"},Haruspex:{baseType:"120x92mm"},"Hive Crone":{baseType:"120x92mm"},"Hive Guard":{baseType:"50mm"},"Hive Tyrant":{baseType:"50mm"},Hormagaunts:{baseType:"28.5mm"},Lictor:{baseType:"50mm"},Maleceptor:{baseType:"120x92mm"},Mawloc:{baseType:"120x92mm"},"Mucolid Spores":{baseType:"40mm"},Neurogaunts:{baseType:"25mm"},"Neurogaunts: Nodebeasts":{baseType:"28.5mm"},Neurolictor:{baseType:"50mm"},Neurotyrant:{baseType:"50mm"},"Norn Assimilator":{baseType:"100mm"},"Norn Emissary":{baseType:"100mm"},"Old One Eye":{baseType:"105x70mm"},"Parasite of Mortrex":{baseType:"40mm"},Psychophage:{baseType:"120x92mm"},Pyrovores:{baseType:"80mm"},Raveners:{baseType:"40mm"},"Ripper Swarms":{baseType:"40mm"},"Screamer-killer":{baseType:"90mm"},"Spore MInes":{baseType:"25mm"},Sporocyst:{baseType:"hull",hullDimensions:{width:0,height:0}},Termagants:{baseType:"28.5mm"},Tervigon:{baseType:"120x92mm"},"The Swarmlord":{baseType:"60mm"},Toxicrene:{baseType:"120x92mm"},Trygon:{baseType:"120x92mm"},"Tyranid Warriors with Melee Bio-weapons":{baseType:"50mm"},"Tyranid Warriors with Ranged Bio-weapons":{baseType:"50mm"},Tyrannocyte:{baseType:"100mm"},Tyrannofex:{baseType:"120x92mm"},"Tyrant Guard":{baseType:"50mm"},Venomthropes:{baseType:"40mm"},"Von Ryanâs Leapers":{baseType:"40mm"},"Winged Hive Tyrant":{baseType:"60mm"},"Winged Tyranid Prime":{baseType:"50mm"},Zoanthropes:{baseType:"40mm"},Harridan:{baseType:"hull",hullDimensions:{width:4,height:6}},Hierophant:{baseType:"hull",hullDimensions:{width:0,height:0}}},vs={"ADEPTA SORORITAS":{"Aestred Thurga and Agathae Dolan: Aestred Thurga":{baseType:"32mm"},"Aestred Thurga and Agathae Dolan: Agathae Dolan":{baseType:"25mm"},"Arco-flagellants":{baseType:"25mm"},"Battle Sisters Squad":{baseType:"32mm"},Canoness:{baseType:"32mm"},"Canoness with Jump Pack":{baseType:"32mm"},Castigator:{baseType:"hull",hullDimensions:{width:6,height:8}},"Celestian Sacresants":{baseType:"32mm"},Daemonifuge:{baseType:"32mm"},Dialogus:{baseType:"40mm"},Dogmata:{baseType:"32mm"},"Dominion Squad":{baseType:"32mm"},Exorcist:{baseType:"hull",hullDimensions:{width:3.5,height:6}},Hospitaller:{baseType:"50mm"},Imagifier:{baseType:"32mm"},Immolator:{baseType:"hull",hullDimensions:{width:4,height:6}},"Junith Eruita":{baseType:"50mm"},"Ministorum Priest":{baseType:"32mm"},Mortifiers:{baseType:"50mm"},"Morvenn Vahl":{baseType:"60mm"},Palatine:{baseType:"32mm"},"Paragon Warsuits":{baseType:"50mm"},"Penitent Engines":{baseType:"50mm"},"Repentia Squad: Repentia Superior":{baseType:"32mm"},"Repentia Squad: Sister Repentia":{baseType:"28.5mm"},"Retributor Squad":{baseType:"32mm"},"Saint Celestine":{baseType:"40mm"},"Saint Celestine: Geminae Superia":{baseType:"32mm"},Sanctifiers:{baseType:"25mm"},"Seraphim Squad":{baseType:"32mm"},"Sisters Novitiate Squad: Novitiate Superior":{baseType:"32mm"},"Sisters Novitiate Squad: Sister Novitiate":{baseType:"28.5mm"},"Sororitas Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Triumph of Saint Katherine":{baseType:"120x92mm"},"Zephyrim Squad":{baseType:"32mm"}},"ADEPTUS CUSTODES":{Aleya:{baseType:"32mm"},"Allarus Custodians":{baseType:"40mm"},"Anathema Psykana Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blade Champion":{baseType:"40mm"},"Custodian Guard":{baseType:"40mm"},"Custodian Wardens":{baseType:"40mm"},"Knight-Centura":{baseType:"32mm"},Prosecutors:{baseType:"32mm"},"Shield-Captain":{baseType:"40mm"},"Shield-Captain in Allarus Terminator Armour":{baseType:"40mm"},"Shield-Captain on Dawneagle Jetbike":{baseType:"75x42mm"},"Trajann Valoris":{baseType:"40mm"},Valerian:{baseType:"40mm"},"Venerable Contemptor Dreadnought":{baseType:"60mm"},"Venerable Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vertus Praetors":{baseType:"75x42mm"},Vigilators:{baseType:"32mm"},Witchseekers:{baseType:"32mm"},"Agamatus Custodians":{baseType:"75x42mm"},"Aquilon Custodians":{baseType:"50mm"},"Ares Gunship":{baseType:"160mm"},"Caladius Grav-tank":{baseType:"170x109mm"},"Contemptor-Achillus Dreadnought":{baseType:"60mm"},"Contemptor-Galatus Dreadnought":{baseType:"60mm"},"Coronus Grav-carrier":{baseType:"170x109mm"},"Custodian Guard with Adrasite and Pyrithite Spears":{baseType:"40mm"},"Orion Assault Dropship":{baseType:"160mm"},"Pallas Grav-attack":{baseType:"105x70mm"},"Sagittarum Custodians":{baseType:"40mm"},"Telemon Heavy Dreadnought":{baseType:"100mm"},"Venatari Custodians":{baseType:"40mm"}},"ADEPTUS MECHANICUS":{"Archaeopter Fusilave":{baseType:"170x109mm"},"Archaeopter Stratoraptor":{baseType:"170x109mm"},"Archaeopter Transvector":{baseType:"170x109mm"},"Belisarius Cawl":{baseType:"105x70mm"},"Corpuscarii Electro-Priests":{baseType:"32mm"},"Cybernetica Datasmith":{baseType:"32mm"},"Fulgurite Electro-Priests":{baseType:"32mm"},"Ironstrider Ballistarii":{baseType:"105x70mm"},"Kastelan Robots":{baseType:"60mm"},"Kataphron Breachers":{baseType:"60mm"},"Kataphron Destroyers":{baseType:"60mm"},"Onager Dunecrawler":{baseType:"130mm"},"Pteraxii Skystalkers":{baseType:"40mm"},"Pteraxii Sterylizors":{baseType:"40mm"},"Serberys Raiders":{baseType:"60x35.5mm"},"Serberys Sulphurhounds":{baseType:"60x35.5mm"},"Sicarian Infiltrators":{baseType:"40mm"},"Sicarian Ruststalkers":{baseType:"40mm"},"Skitarii Marshal":{baseType:"32mm"},"Skitarii Rangers":{baseType:"25mm"},"Skitarii Rangers/Skitarii Vanguard: Transuranic Arquebus":{baseType:"60x35.5mm"},"Skitarii Vanguard":{baseType:"25mm"},"Skorpius Disintegrator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skorpius Dunerider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sydonian Dragoons with Radium Jezzails":{baseType:"105x70mm"},"Sydonian Dragoons with Taser Lances":{baseType:"105x70mm"},"Sydonian Skatros":{baseType:"40mm"},"Tech-Priest Dominus":{baseType:"50mm"},"Tech-Priest Enginseer":{baseType:"32mm"},"Tech-Priest Manipulus":{baseType:"50mm"},Technoarcheologist:{baseType:"32mm"}},"ADEPTUS TITANICUS":{"Reaver Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warbringer Nemesis Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warhound Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warlord Titan":{baseType:"hull",hullDimensions:{width:0,height:0}}},AELDARI:ad,"ASTRA MILITARUM":{"Aegis Defence Line":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armoured Sentinels":{baseType:"80mm"},"Artillery Team":{baseType:"130mm"},"Attilan Rough Riders":{baseType:"60x35.5mm"},Baneblade:{baseType:"hull",hullDimensions:{width:0,height:0}},Banehammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Banesword:{baseType:"hull",hullDimensions:{width:0,height:0}},Basilisk:{baseType:"hull",hullDimensions:{width:0,height:0}},"Bullgryn squad":{baseType:"40mm"},"Cadian Castellan":{baseType:"28.5mm"},"Cadian Command Squad":{baseType:"28.5mm"},"Cadian Heavy Weapons Squad":{baseType:"50mm"},"Cadian Shock Troops":{baseType:"25mm"},"Catachan Command Squad":{baseType:"25mm"},"Catachan Heavy Weapons Squad":{baseType:"60mm"},"Catachan Jungle Fighters":{baseType:"25mm"},Chimera:{baseType:"hull",hullDimensions:{width:0,height:0}},Commissar:{baseType:"28.5mm"},"Death Korps of Krieg":{baseType:"25mm"},"Death Riders":{baseType:"60x35.5mm"},Deathstrike:{baseType:"hull",hullDimensions:{width:0,height:0}},Doomhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},"Field Ordnance Battery":{baseType:"100mm"},"Gauntâs Ghosts":{baseType:"28.5mm"},Hellhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Hellhound:{baseType:"hull",hullDimensions:{width:0,height:0}},Hydra:{baseType:"hull",hullDimensions:{width:0,height:0}},Kasrkin:{baseType:"28.5mm"},"Krieg Combat Engineers":{baseType:"25mm"},"Krieg Command Squad":{baseType:"25mm"},"Krieg Command Squad: Lord Commissar":{baseType:"32mm"},"Krieg Heavy Weapons Squad":{baseType:"50mm"},"Krieg Heavy Weapons Squad: Fire Coordinator":{baseType:"25mm"},"Leman Russ Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Demolisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Eradicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Executioner":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Exterminator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Punisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Vanquisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Marshal Dreir":{baseType:"75x42mm"},"Lord Solar Leontus":{baseType:"80mm"},Manticore:{baseType:"hull",hullDimensions:{width:0,height:0}},"Militarum Tempestus Command Squad":{baseType:"25mm"},"Ministorum Priest":{baseType:"32mm"},"Nork Deddog":{baseType:"40mm"},"Ogryn Bodyguard":{baseType:"40mm"},"Ogryn squad":{baseType:"40mm"},"Primaris Psyker":{baseType:"32mm"},Ratlings:{baseType:"25mm"},"Rogal Dorn Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Rogal Dorn Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Scout Sentinels":{baseType:"80mm"},Shadowsword:{baseType:"hull",hullDimensions:{width:0,height:0}},"Sly Marbo":{baseType:"32mm"},Stormlord:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormsword:{baseType:"hull",hullDimensions:{width:0,height:0}},Taurox:{baseType:"hull",hullDimensions:{width:0,height:0}},"Taurox Prime":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tech-Priest Enginseer":{baseType:"32mm"},"Tempestus Aquilons":{baseType:"28.5mm"},"Tempestus Scions":{baseType:"25mm"},"Ursula Creed":{baseType:"32mm"},Valkyrie:{baseType:"120x92mm"},Wyvern:{baseType:"hull",hullDimensions:{width:0,height:0}},"Avenger Strike Fighter":{baseType:"120x92mm"},"Cyclops Demolition Vehicle":{baseType:"hull",hullDimensions:{width:0,height:0}}},"BLACK TEMPLARS":{"Black Templars Gladiator Lancer":{baseType:"100mm"},"Black Templars Gladiator Reaper":{baseType:"100mm"},"Black Templars Gladiator Valiant":{baseType:"100mm"},"Black Templars Impulsor":{baseType:"100mm"},"Black Templars Repulsor":{baseType:"100mm"},"Black Templars Repulsor Executioner":{baseType:"100mm"},Castellan:{baseType:"40mm"},"Chaplain Grimaldus":{baseType:"40mm"},"Chaplain Grimaldus: Cenobyte Servitors":{baseType:"28.5mm"},"Crusader Squad: Neophytes":{baseType:"28.5mm"},"Crusader Squad: Sword Brother/Initiates":{baseType:"32mm"},"High Marshal Helbrecht":{baseType:"60mm"},Marshal:{baseType:"40mm"},"Primaris Crusader Squad: Initiates":{baseType:"32mm"},"Primaris Crusader Squad: Neophytes":{baseType:"28.5mm"},"Primaris Crusader Squad: Sword Brother":{baseType:"40mm"},"Primaris Sword Brethren":{baseType:"40mm"},"The Emperorâs Champion":{baseType:"40mm"}},"BLOOD ANGELS":{Astorath:{baseType:"40mm"},"Baal Predator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blood Angels Captain":{baseType:"40mm"},"Chief Librarian Mephiston":{baseType:"40mm"},"Commander Dante":{baseType:"50mm"},"Death Company Captain":{baseType:"40mm"},"Death Company Captain with Jump Pack":{baseType:"40mm"},"Death Company Dreadnought":{baseType:"90mm"},"Death Company Marines":{baseType:"32mm"},"Death Company Marines with Bolt Rifles":{baseType:"32mm"},"Death Company Marines with Jump Packs":{baseType:"32mm"},Lemartes:{baseType:"40mm"},"Sanguinary Guard":{baseType:"40mm"},"Sanguinary Priest":{baseType:"40mm"},"The Sanguinor":{baseType:"40mm"}},"CHAOS DAEMONS":{"Beâlakor":{baseType:"100mm"},"Beasts of Nurgle":{baseType:"60mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodmaster:{baseType:"40mm"},Bloodthirster:{baseType:"120x92mm"},"Blue Horrors":{baseType:"25mm"},"Burning Chariot":{baseType:"120x92mm"},Changecaster:{baseType:"32mm"},"Contorted Epitome":{baseType:"75x42mm"},"Daemon Prince of Chaos":{baseType:"60mm"},"Daemon Prince of Chaos with Wings":{baseType:"60mm"},Daemonettes:{baseType:"25mm"},Epidemius:{baseType:"60mm"},"Exalted Flamer":{baseType:"75x42mm"},Fateskimmer:{baseType:"120x92mm"},"Feculent Gnarlmaw":{baseType:"hull",hullDimensions:{width:0,height:0}},Fiends:{baseType:"75x42mm"},Flamers:{baseType:"32mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Fluxmaster:{baseType:"Large Flying Base"},"Great Unclean One":{baseType:"130mm"},Hellflayers:{baseType:"120x92mm"},"Horticulous Slimux":{baseType:"105x70mm"},"Infernal Enrapturess":{baseType:"60x35.5mm"},"Kairos Fateweaver":{baseType:"100mm"},Karanak:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},Nurglings:{baseType:"40mm"},"Pink Horrors":{baseType:"32mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Poxbringer:{baseType:"32mm"},"Rendmaster on Blood Throne":{baseType:"120x92mm"},Rotigus:{baseType:"130mm"},Screamers:{baseType:"Small Flying Base"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"},Skarbrand:{baseType:"100mm"},"Skull Altar":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skull Cannon":{baseType:"120x92mm"},Skullmaster:{baseType:"90x52.5mm"},Skulltaker:{baseType:"40mm"},"Sloppity Bilepiper":{baseType:"32mm"},"Soul Grinder":{baseType:"160mm"},"Spoilpox Scrivener":{baseType:"40mm"},"Syllâesske":{baseType:"50mm"},"The Blue Scribes":{baseType:"Large Flying Base"},"The Changeling":{baseType:"40mm"},"The Masque of Slaanesh":{baseType:"32mm"},Tormentbringer:{baseType:"120x92mm"},Tranceweaver:{baseType:"32mm"}},"CHAOS KNIGHTS":{"Knight Abominant":{baseType:"170x109mm"},"Knight Desecrator":{baseType:"170x109mm"},"Knight Despoiler":{baseType:"170x109mm"},"Knight Rampager":{baseType:"170x109mm"},"Knight Tyrant":{baseType:"170x109mm"},"War Dog Brigand":{baseType:"100mm"},"War Dog Executioner":{baseType:"100mm"},"War Dog Huntsman":{baseType:"100mm"},"War Dog Karnivore":{baseType:"100mm"},"War Dog Stalker":{baseType:"100mm"},"Chaos Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Cerastus Knight Acheron":{baseType:"170x109mm"},"Chaos Cerastus Knight Atrapos":{baseType:"170x109mm"},"Chaos Cerastus Knight Castigator":{baseType:"170x109mm"},"Chaos Cerastus Knight Lancer":{baseType:"170x109mm"},"Chaos Questoris Knight Magaera":{baseType:"170x109mm"},"Chaos Questoris Knight Styrix":{baseType:"170x109mm"},"War Dog Moirax":{baseType:"100mm"}},"CHAOS SPACE MARINES":{"Abaddon the Despoiler":{baseType:"60mm"},"Accursed Cultists: Mutant":{baseType:"25mm"},"Accursed Cultists: Torment":{baseType:"40mm"},"Chaos Bikers":{baseType:"75x42mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Lord":{baseType:"40mm"},"Chaos Lord in Terminator Armour":{baseType:"40mm"},"Chaos Lord with Jump Pack":{baseType:"40mm"},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminator Squad":{baseType:"40mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},Chosen:{baseType:"32mm"},"Cultist Firebrand":{baseType:"32mm"},"Cultist Mob":{baseType:"25mm"},Cypher:{baseType:"32mm"},"Dark Apostle":{baseType:"40mm"},"Dark Apostle: Dark Disciple":{baseType:"25mm"},"Dark Commune: Blessed Blade":{baseType:"28.5mm"},"Dark Commune: Cult Demagogue, Mindwitch, Iconarch":{baseType:"32mm"},Defiler:{baseType:"160mm"},"Fabius Bile":{baseType:"40mm"},"Fabius Bile: Surgeon Acolyte":{baseType:"32mm"},"Fellgor beastmen":{baseType:"32mm"},Forgefiend:{baseType:"120x92mm"},"Haarken Worldclaimer":{baseType:"40mm"},Havocs:{baseType:"40mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Heretic Astartes Daemon Prince":{baseType:"60mm"},"Heretic Astartes Daemon Prince with Wings":{baseType:"60mm"},"Huron Blackheart":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},Legionaries:{baseType:"32mm"},"Lord Discordant on Helstalker":{baseType:"120x92mm"},"Master of Executions":{baseType:"40mm"},"Master of Possession":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},"Nemesis Claw":{baseType:"32mm"},"Noctilith Crown":{baseType:"hull",hullDimensions:{width:0,height:0}},Obliterators:{baseType:"50mm"},Possessed:{baseType:"40mm"},Raptors:{baseType:"32mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Traitor Enforcer":{baseType:"32mm"},"Traitor Enforcer: Traitor Ogryn":{baseType:"40mm"},"Traitor Guardsmen Squad":{baseType:"25mm"},"Vashtorr the Arkifane":{baseType:"80mm"},Venomcrawler:{baseType:"100mm"},"Warp Talons":{baseType:"32mm"},Warpsmith:{baseType:"60x35.5mm"}},"DARK ANGELS":{Asmodai:{baseType:"50mm"},Azrael:{baseType:"50mm"},Belial:{baseType:"50mm"},"Deathwing Knights":{baseType:"40mm"},"Deathwing Terminator Squad":{baseType:"40mm"},Ezekiel:{baseType:"25mm"},"Inner Circle Companions":{baseType:"40mm"},"Land Speeder Vengeance":{baseType:"Large Flying Base"},Lazarus:{baseType:"40mm"},"Lion ElâJonson":{baseType:"60mm"},"Nephilim Jetfighter":{baseType:"120x92mm"},"Ravenwing Black Knights":{baseType:"75x42mm"},"Ravenwing Command Squad":{baseType:"75x42mm"},"Ravenwing Dark Talon":{baseType:"120x92mm"},"Ravenwing Darkshroud":{baseType:"Large Flying Base"},Sammael:{baseType:"Large Flying Base"}},"DEATH GUARD":{"Biologus Putrifier":{baseType:"40mm"},"Blightlord Terminators":{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Nurgle":{baseType:"60mm"},"Daemon Prince of Nurgle with Wings":{baseType:"60mm"},"Deathshroud Terminators":{baseType:"40mm"},Defiler:{baseType:"160mm"},"Foetid Bloat-Drone":{baseType:"60mm"},"Foetid Bloat-drone with Heavy Blight Launcher":{baseType:"60mm"},"Foul Blightspawn":{baseType:"40mm"},Helbrute:{baseType:"60mm"},"Icon Bearer":{baseType:"32mm"},"Lord of Contagion":{baseType:"50mm"},"Lord of Poxes":{baseType:"40mm"},"Lord of Virulence":{baseType:"50mm"},"Malignant Plaguecaster":{baseType:"32mm"},"Miasmic Malignifier":{baseType:"hull",hullDimensions:{width:0,height:0}},Mortarion:{baseType:"100mm"},"Myphitic Blight-Haulers":{baseType:"80mm"},"Noxious Blightbringer":{baseType:"40mm"},"Plague Marines":{baseType:"32mm"},"Plague Surgeon":{baseType:"40mm"},"Plagueburst Crawler":{baseType:"hull",hullDimensions:{width:0,height:0}},Poxwalkers:{baseType:"25mm"},Tallyman:{baseType:"40mm"},Typhus:{baseType:"50mm"},"Beasts of Nurgle":{baseType:"60mm"},"Great Unclean One":{baseType:"130mm"},Nurglings:{baseType:"40mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Rotigus:{baseType:"130mm"}},DEATHWATCH:sd,DRUKHARI:rd,"EMPERORâS CHILDREN":{"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminators":{baseType:"40mm"},"Daemon Prince of Slaanesh":{baseType:"60mm"},"Daemon Prince of Slaanesh with Wings":{baseType:"60mm"},"Flawless Blades":{baseType:"40mm"},Fulgrim:{baseType:"130mm"},Heldrake:{baseType:"120x92mm"},Infractors:{baseType:"32mm"},"Lord Exultant":{baseType:"40mm"},"Lord Kakophonist":{baseType:"40mm"},"Lucius the Eternal":{baseType:"50mm"},Maulerfiend:{baseType:"120x92mm"},"Noise Marines":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},Tormentors:{baseType:"32mm"},Daemonettes:{baseType:"25mm"},Fiends:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"}},"GENESTEALER CULTS":{Aberrants:{baseType:"32mm"},Abominant:{baseType:"40mm"},"Achilles Ridgerunners":{baseType:"120x92mm"},"Acolyte Hybrids with Autopistols":{baseType:"32mm"},"Acolyte Hybrids with Hand Flamers":{baseType:"32mm"},"Acolyte Iconward":{baseType:"32mm"},"Atalan Jackals":{baseType:"60x35.5mm"},"Atalan Jackals: Wolfquad":{baseType:"60mm"},Benefictus:{baseType:"32mm"},Biophagus:{baseType:"25mm"},Clamavus:{baseType:"32mm"},"Goliath Rockgrinder":{baseType:"hull",hullDimensions:{width:0,height:0}},"Goliath Truck":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hybrid Metamorphs":{baseType:"32mm"},"Jackal Alphus":{baseType:"60x35.5mm"},Kelermorph:{baseType:"32mm"},Locus:{baseType:"32mm"},Magus:{baseType:"32mm"},"Neophyte Hybrids":{baseType:"25mm"},"Neophyte Hybrids: Heavy stubber, Mining laser, Seismic cannon":{baseType:"32mm"},Nexos:{baseType:"40mm"},Patriarch:{baseType:"50mm"},Primus:{baseType:"32mm"},"Purestrain Genestealers":{baseType:"32mm"},"Reductus Saboteur":{baseType:"32mm"},Sanctus:{baseType:"32mm"}},"GREY KNIGHTS":{"Brother-Captain":{baseType:"40mm"},"Brother-Captain Stern":{baseType:"40mm"},"Brotherhood Champion":{baseType:"32mm"},"Brotherhood Chaplain":{baseType:"40mm"},"Brotherhood Librarian":{baseType:"40mm"},"Brotherhood Techmarine":{baseType:"32mm"},"Brotherhood Terminator Squad":{baseType:"40mm"},"Castellan Crowe":{baseType:"40mm"},"Grand Master":{baseType:"40mm"},"Grand Master in Nemesis Dreadknight":{baseType:"120x92mm"},"Grand Master Voldus":{baseType:"40mm"},"Grey Knights Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Razorback":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Stormhawk Interceptor":{baseType:"120x92mm"},"Grey knights Stormraven Gunship":{baseType:"120x92mm"},"Grey knights Stormtalon Gunship":{baseType:"120x92mm"},"Grey Knights Venerable Dreadnought":{baseType:"60mm"},"Interceptor Squad":{baseType:"32mm"},"Kaldor Draigo":{baseType:"40mm"},"Nemesis Dreadknight":{baseType:"120x92mm"},"Paladin Squad":{baseType:"40mm"},"Purgation Squad":{baseType:"32mm"},"Purifier Squad":{baseType:"32mm"},Servitors:{baseType:"25mm"},"Strike Squad":{baseType:"32mm"},"Grey Knights Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}},"Land Raider Banisher":{baseType:"hull",hullDimensions:{width:0,height:0}}},"IMPERIAL AGENTS":{"Callidus Assassin":{baseType:"32mm"},"Corvus Blackstar":{baseType:"120x92mm"},"Culexus Assassin":{baseType:"32mm"},"Deathwatch Kill Team":{baseType:"32mm"},"Eversor Assassin":{baseType:"32mm"},"Exaction Squad":{baseType:"28.5mm"},"Exaction Squad: Cyber-mastiff":{baseType:"25mm"},"Grey Knights Terminator Squad":{baseType:"40mm"},"Imperial Navy Breachers":{baseType:"25mm"},"Imperial Navy Breachers: Navis las-volley, endurant shield":{baseType:"28.5mm"},"Imperial Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},Inquisitor:{baseType:"32mm"},"Inquisitor Coteaz":{baseType:"40mm"},"Inquisitor Draxus":{baseType:"32mm"},"Inquisitor Greyfax":{baseType:"32mm"},"Inquisitorial Agents":{baseType:"25mm"},"Inquisitorial Agents: Gun Servitors":{baseType:"32mm"},"Inquisitorial Chimera":{baseType:"hull",hullDimensions:{width:0,height:0}},"Ministorum Priest":{baseType:"32mm"},Navigator:{baseType:"32mm"},"Rogue Trader entourage":{baseType:"25mm"},Sanctifiers:{baseType:"25mm"},"Sisters of Battle Immolator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sisters of Battle Squad":{baseType:"32mm"},"Subductor Squad":{baseType:"28.5mm"},"Subductor Squad: Cyber-mastiff":{baseType:"25mm"},"Vigilant Squad":{baseType:"28.5mm"},"Vigilant Squad: Cyber-mastiff":{baseType:"25mm"},"Vindicare Assassin":{baseType:"32mm"},"Voidsmen-at-Arms":{baseType:"32mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},"IMPERIAL KNIGHTS":{"Armiger Helverin":{baseType:"100mm"},"Armiger Warglaive":{baseType:"100mm"},"Canis Rex":{baseType:"170x109mm"},"Knight Castellan":{baseType:"170x109mm"},"Knight Crusader":{baseType:"170x109mm"},"Knight Errant":{baseType:"170x109mm"},"Knight Gallant":{baseType:"170x109mm"},"Knight Paladin":{baseType:"170x109mm"},"Knight Preceptor":{baseType:"170x109mm"},"Knight Valiant":{baseType:"170x109mm"},"Knight Warden":{baseType:"170x109mm"},"Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armiger Moirax":{baseType:"100mm"},"Cerastus Knight Acheron":{baseType:"170x109mm"},"Cerastus Knight Atrapos":{baseType:"170x109mm"},"Cerastus Knight Castigator":{baseType:"170x109mm"},"Cerastus Knight Lancer":{baseType:"170x109mm"},"Questoris Knight Magaera":{baseType:"170x109mm"},"Questoris Knight Styrix":{baseType:"170x109mm"}},"LEAGUES OF VOTANN":{"BrÃ´khyr Iron-master":{baseType:"32mm"},"BrÃ´khyr Iron-master: E-COG":{baseType:"25mm"},"BrÃ´khyr Iron-master: Ironkin Assistant":{baseType:"28.5mm"},"BrÃ´khyr Thunderkyn":{baseType:"40mm"},"Cthonian Beserks":{baseType:"28.5mm"},"Cthonian Beserks: Mole grenade launcher":{baseType:"50mm"},"Einhyr Champion":{baseType:"40mm"},"Einhyr Hearthguard":{baseType:"32mm"},Grimnyr:{baseType:"40mm"},"Grimnyr: CORV":{baseType:"25mm"},"Hearthkyn Warriors":{baseType:"28.5mm"},"Hekaton Land Fortress":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hernkyn Pioneers":{baseType:"90x52.5mm"},"Hernkyn Yaegirs":{baseType:"28.5mm"},KÃ¢hl:{baseType:"40mm"},Sagitaur:{baseType:"hull",hullDimensions:{width:0,height:0}},"Ãthar the Destined":{baseType:"40mm"}},NECRONS:id,ORKS:od,"SPACE MARINES":{"Adrax Agatone":{baseType:"40mm"},"Aggressor Squad":{baseType:"40mm"},Ancient:{baseType:"40mm"},"Ancient in Terminator Armour":{baseType:"40mm"},Apothecary:{baseType:"40mm"},"Apothecary Biologis":{baseType:"40mm"},"Assault Intercessor Squad":{baseType:"32mm"},"Assault Intercessors with Jump Packs":{baseType:"32mm"},"Ballistus Dreadnought":{baseType:"90mm"},"Bladeguard Ancient":{baseType:"40mm"},"Bladeguard Veteran Squad":{baseType:"40mm"},"Brutalis Dreadnought":{baseType:"90mm"},Captain:{baseType:"40mm"},"Captain in Gravis Armour":{baseType:"40mm"},"Captain in Phobos Armour":{baseType:"40mm"},"Captain in Terminator Armour":{baseType:"50mm"},"Captain Sicarius":{baseType:"32mm"},"Captain with Jump Pack":{baseType:"40mm"},"Centurion Assault Squad":{baseType:"50mm"},"Centurion Devastator Squad":{baseType:"50mm"},Chaplain:{baseType:"40mm"},"Chaplain in Terminator Armour":{baseType:"40mm"},"Chaplain on Bike":{baseType:"90x52.5mm"},"Chaplain with Jump Pack":{baseType:"32mm"},"Chief Librarian Tigurius":{baseType:"40mm"},"Company Heroes":{baseType:"40mm"},"Darnath Lysander":{baseType:"50mm"},"Desolation Squad":{baseType:"32mm"},"Devastator Squad":{baseType:"32mm"},Dreadnought:{baseType:"60mm"},"Drop Pod":{baseType:"hull",hullDimensions:{width:0,height:0}},"Eliminator Squad":{baseType:"40mm"},"Eradicator Squad":{baseType:"40mm"},"Firestrike Servo-turrets":{baseType:"80mm"},"Gladiator Lancer":{baseType:"100mm"},"Gladiator Reaper":{baseType:"100mm"},"Gladiator Valiant":{baseType:"100mm"},"Hammerfall Bunker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Heavy Intercessor Squad":{baseType:"40mm"},"Hellblaster Squad":{baseType:"32mm"},Impulsor:{baseType:"100mm"},"Inceptor Squad":{baseType:"40mm"},"Incursor Squad":{baseType:"32mm"},"Infernus Squad":{baseType:"32mm"},"Infiltrator Squad":{baseType:"32mm"},"Intercessor Squad":{baseType:"32mm"},"Invader ATV":{baseType:"hull",hullDimensions:{width:0,height:0}},"Invictor Tactical Warsuit":{baseType:"90mm"},"Iron Father Feirros":{baseType:"40mm"},Judiciar:{baseType:"40mm"},"Kayvaan Shrike":{baseType:"40mm"},"Korâsarro Khan":{baseType:"40mm"},"Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},Librarian:{baseType:"40mm"},"Librarian in Phobos Armour":{baseType:"40mm"},"Librarian in Terminator Armour":{baseType:"40mm"},Lieutenant:{baseType:"40mm"},"Lieutenant in Phobos Armour":{baseType:"40mm"},"Lieutenant in Reiver Armour":{baseType:"40mm"},"Lieutenant Titus":{baseType:"40mm"},"Lieutenant with Combi-weapon":{baseType:"40mm"},"Marneus Calgar":{baseType:"50mm"},"Marneus Calgar: Victrix Honour Guard":{baseType:"40mm"},"Outrider Squad":{baseType:"90x52.5mm"},"Pedro Kantor":{baseType:"32mm"},"Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},Razorback:{baseType:"hull",hullDimensions:{width:0,height:0}},"Redemptor Dreadnought":{baseType:"90mm"},"Reiver Squad":{baseType:"32mm"},Repulsor:{baseType:"100mm"},"Repulsor Executioner":{baseType:"100mm"},Rhino:{baseType:"hull",hullDimensions:{width:0,height:0}},"Roboute Guilliman":{baseType:"60mm"},"Scout Squad":{baseType:"28.5mm"},"Sternguard Veteran Squad":{baseType:"32mm"},"Storm Speeder Hailstrike":{baseType:"90mm"},"Storm Speeder Hammerstrike":{baseType:"90mm"},"Storm Speeder Thunderstrike":{baseType:"90mm"},"Stormhawk Interceptor":{baseType:"120x92mm"},"Stormraven Gunship":{baseType:"120x92mm"},"Stormtalon Gunship":{baseType:"120x92mm"},"Suppressor Squad":{baseType:"40mm"},"Tactical Squad":{baseType:"32mm"},Techmarine:{baseType:"40mm"},"Terminator Assault Squad":{baseType:"40mm"},"Terminator Squad":{baseType:"40mm"},"Tor Garadon":{baseType:"40mm"},"Uriel Ventris":{baseType:"40mm"},"Vanguard Veteran Squad with Jump Packs":{baseType:"32mm"},Vindicator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Vulkan Heâstan":{baseType:"32mm"},Whirlwind:{baseType:"hull",hullDimensions:{width:0,height:0}},Astraeus:{baseType:"hull",hullDimensions:{width:0,height:0}},"Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}}},"SPACE WOLVES":{"Arjac Rockfist":{baseType:"50mm"},"Bjorn the Fell-handed":{baseType:"60mm"},"Blood Claws":{baseType:"32mm"},"Fenrisian Wolves":{baseType:"40mm"},"Grey Hunters":{baseType:"32mm"},"Iron Priest":{baseType:"32mm"},"Logan Grimnar":{baseType:"80mm"},Murderfang:{baseType:"60mm"},"Njal Stormcaller":{baseType:"40mm"},"Ragnar Blackmane":{baseType:"40mm"},"Thunderwolf Cavalry":{baseType:"60mm"},"Ulrik the Slayer":{baseType:"32mm"},"Venerable Dreadnought":{baseType:"60mm"},"Wolf Guard Battle Leader":{baseType:"40mm"},"Wolf Guard Headtakers":{baseType:"40mm"},"Wolf Guard Headtakers: Hunting Wolves":{baseType:"60x35.5mm"},"Wolf Guard Terminators":{baseType:"40mm"},"Wolf Priest":{baseType:"40mm"},Wulfen:{baseType:"40mm"},"Wulfen Dreadnought":{baseType:"60mm"},"Wulfen with Storm Shields":{baseType:"40mm"}},"TâAU EMPIRE":{"Breacher Team":{baseType:"25mm"},"Broadside Battlesuits":{baseType:"60mm"},"Cadre Fireblade":{baseType:"25mm"},"Commander Farsight":{baseType:"60mm"},"Commander in Coldstar Battlesuit":{baseType:"60mm"},"Commander in Enforcer Battlesuit":{baseType:"60mm"},"Commander Shadowsun":{baseType:"50mm"},"Crisis Fireknife Battlesuits":{baseType:"50mm"},"Crisis Starscythe Battlesuits":{baseType:"50mm"},"Crisis Sunforge Battlesuits":{baseType:"50mm"},Darkstrider:{baseType:"32mm"},Devilfish:{baseType:"Large Flying Base"},Ethereal:{baseType:"40mm"},"Firesight Team":{baseType:"40mm"},"Ghostkeel Battlesuit":{baseType:"105x70mm"},"Hammerhead Gunship":{baseType:"Large Flying Base"},"Kroot Carnivores":{baseType:"28.5mm"},"Kroot Farstalkers":{baseType:"28.5mm"},"Kroot Farstalkers: Kroot Kill-broker":{baseType:"32mm"},"Kroot Flesh Shaper":{baseType:"32mm"},"Kroot Hounds":{baseType:"28.5mm"},"Kroot Lone-spear":{baseType:"90x52.5mm"},"Kroot Trail Shaper":{baseType:"32mm"},"Kroot War Shaper":{baseType:"32mm"},"Krootox Rampagers":{baseType:"50mm"},"Krootox Riders":{baseType:"50mm"},"Pathfinder Team":{baseType:"25mm"},Piranhas:{baseType:"Large Flying Base"},"Razorshark Strike Fighter":{baseType:"120x92mm"},"Riptide Battlesuit":{baseType:"120x92mm"},"Sky Ray Gunship":{baseType:"Large Flying Base"},"Stealth Battlesuits":{baseType:"32mm"},Stormsurge:{baseType:"170x109mm"},"Strike Team":{baseType:"25mm"},"Sun Shark Bomber":{baseType:"120x92mm"},"Tidewall Defence Platform":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Droneport":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Gunrig":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Shieldline":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vespid Stingwings":{baseType:"28.5mm"},"AX-1-0 Tiger Shark":{baseType:"160mm"},Manta:{baseType:"hull",hullDimensions:{width:4,height:6}},"Taâunar Supremacy Armour":{baseType:"160mm"},"Tiger Shark":{baseType:"160mm"}},"THOUSAND SONS":{Ahriman:{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Daemon Prince of Tzeentch":{baseType:"60mm"},"Daemon Prince of Tzeentch with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},"Exalted Sorcerer":{baseType:"32mm"},"Exalted Sorcerer on Disc of Tzeentch":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Infernal Master":{baseType:"40mm"},"Magnus the Red":{baseType:"100mm"},Maulerfiend:{baseType:"120x92mm"},"Mutalith Vortex Beast":{baseType:"120x92mm"},"Rubric Marines":{baseType:"32mm"},"Scarab Occult Terminators":{baseType:"40mm"},"Sekhetar Robots":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Tzaangor Enlightened":{baseType:"40mm"},"Tzaangor Enlightened with Fatecaster Greatbows":{baseType:"40mm"},"Tzaangor Shaman":{baseType:"40mm"},Tzaangors:{baseType:"32mm"},"Blue Horrors":{baseType:"25mm"},Flamers:{baseType:"32mm"},"Kairos Fateweaver":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},"Pink Horrors":{baseType:"32mm"},Screamers:{baseType:"Small Flying Base"}},TYRANIDS:ld,"WORLD EATERS":{Angron:{baseType:"100mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Khorne":{baseType:"60mm"},"Daemon Prince of Khorne with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},Eightbound:{baseType:"40mm"},"Exalted Eightbound":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Goremongers:{baseType:"32mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},Jakhals:{baseType:"28.5mm"},"Jakhals: Dishonoured":{baseType:"40mm"},"KhÃ¢rn the Betrayer":{baseType:"40mm"},"Khorne Berzerkers":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Invocatus":{baseType:"90x52.5mm"},"Lord on Juggernaut":{baseType:"90x52.5mm"},"Master of Executions":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},Slaughterbound:{baseType:"50mm"},"Terminator Squad":{baseType:"40mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodthirster:{baseType:"120x92mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Skarbrand:{baseType:"100mm"}}},cd=rn(vs);function ud(){return Object.keys(vs)}function ml(t){return vs[t]?Object.keys(vs[t]):[]}function Xr(t,n){return!vs[t]||!vs[t][n]?null:vs[t][n]}Ga(cd,t=>Object.keys(t));function md(t,n){const a=t.FACTION_KEYWORD,r=t.UNITS||[],s=[],i=[],o={};for(const m of r){const h=m.name||"",d=nd(m.quantity);let p=Xr(a,h);if(!p){const u=dl(h,a);u&&(p=Xr(a,u))}if(!p){const{faction:u,unitName:y}=fd(h);u&&y&&(p=Xr(u,y))}if(p){o[h]||(o[h]=0),o[h]++;const u=o[h]>1?` #${o[h]}`:"",y=`${h}${u}`,g=dd(p,d,n,y);s.push(...g)}else i.push({id:"unmatched-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),unitName:h,quantity:d,points:m.points,section:m.section})}return{matched:hd(s),unmatched:i}}function dd(t,n,a,r,s){const i=[],o=pd(),l=t.baseType,m=yd(r,l);for(let h=0;h<n;h++){const p={id:gd(),baseType:l,playerId:a,x:0,y:0,rotation:0,unitId:o,unitName:r,name:m,imported:!0,inStaging:!0};l==="hull"&&(p.baseType="rect-custom",p.customWidth=t.hullDimensions?.width||5.5,p.customHeight=t.hullDimensions?.height||3),i.push(p)}return i}function hd(t){const i={};t.forEach(h=>{const d=h.unitId||"ungrouped";i[d]||(i[d]=[]),i[d].push(h)});let o=2,l=2,m=0;for(const h in i){const d=i[h];for(const p of d)p.x=o,p.y=l,o+=2,m++,m>=6&&(o=2,l+=2,m=0);m>0&&(o=2,l+=2,m=0)}return t}function dl(t,n){const a=ml(n);if(!a||a.length===0)return null;const r=ms(t);for(const l of a)if(ms(l)===r)return l;const s=r.replace(/s$/,""),i=r+"s";for(const l of a){const m=ms(l);if(m===s||m===i)return l}for(const l of a){const m=ms(l);if(r.includes(m)||m.includes(r))return l}const o=r.split(/\s+/).filter(l=>l.length>2);if(o.length>0)for(const l of a){const m=ms(l);if(o.every(h=>m.includes(h)))return l}return null}function fd(t){const n=ud(),a=ms(t);for(const r of n){const s=ml(r);if(s){for(const i of s)if(ms(i)===a)return{faction:r,unitName:i}}}for(const r of n){const s=dl(t,r);if(s)return{faction:r,unitName:s}}return{faction:null,unitName:null}}function ms(t){return String(t||"").toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim()}function pd(){return"unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function yd(t,n){if(!t)return"";const a=n.match(/(\d+)mm/),r=a?parseInt(a[1],10):null;return r&&r<50?vd(t):t}function vd(t){return t?t.replace(/\s*#\d+$/,"").split(/\s+/).filter(s=>s.length>0).slice(0,3).map(s=>s[0].toUpperCase()).join(""):""}function gd(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}var bd=ve('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),Td=ve('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div> <!>',1),xd=ve('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Selected</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <button class="danger svelte-1g40uyy"> </button></div>'),_d=ve('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Rotation</span> <span class="value svelte-1g40uyy"> </span></div>'),wd=ve('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div>'),Sd=ve('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),Ad=ve('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Base Type</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Player</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Position</span> <span class="value svelte-1g40uyy"> </span></div> <!> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-1g40uyy">Remove</button></div>'),Cd=ve('<p class="hint svelte-1g40uyy">Click a model to select it</p>'),Ed=ve('<p class="hint svelte-1g40uyy">Click and drag on battlefield to draw a measurement line</p>'),kd=ve('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Length</span> <span class="value svelte-1g40uyy"> </span></div> <button class="danger svelte-1g40uyy">Remove Line</button>',1),Md=ve('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Lines</span> <span class="value svelte-1g40uyy"> </span></div> <button class="secondary svelte-1g40uyy">Clear All Lines</button>',1),Rd=ve('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Line Tool Active (M)</label></div> <!> <!> <!> <div class="field svelte-1g40uyy" style="margin-top: 0.5rem; border-top: 1px solid #333; padding-top: 0.5rem;"><span class="label-text svelte-1g40uyy">Range Zones</span> <label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show 6" zones</label> <label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show 9" zones</label></div></div>'),Ld=ve('<div class="button-group vertical svelte-1g40uyy"><div class="button-row svelte-1g40uyy"><button title="Undo (Ctrl+Z)" class="svelte-1g40uyy">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-1g40uyy">Redo</button></div> <div class="button-row svelte-1g40uyy"><button title="Export deployment to share with others" class="svelte-1g40uyy">Export</button> <button title="Import deployment from JSON file" class="svelte-1g40uyy">Import</button></div> <input type="file" accept=".json" style="display: none;"/> <button title="Export battlefield as PNG image" class="svelte-1g40uyy">Export PNG</button> <button class="svelte-1g40uyy">Save to Browser</button> <button class="svelte-1g40uyy">Restore from Browser</button> <button class="secondary svelte-1g40uyy">Clear All Models</button> <button class="secondary svelte-1g40uyy">Clear Saved State</button></div>'),Dd=ve('<div class="player-toggle svelte-1g40uyy"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-1g40uyy"><div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Circles</h4> <div class="palette-grid svelte-1g40uyy"></div></div> <div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Ovals</h4> <div class="palette-grid svelte-1g40uyy"></div></div></div>',1),Id=ve('<div class="rect-hull-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="rect-width" class="svelte-1g40uyy">Width (inches)</label> <input id="rect-width" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <div class="field svelte-1g40uyy"><label for="rect-height" class="svelte-1g40uyy">Height (inches)</label> <input id="rect-height" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <button class="svelte-1g40uyy"> </button></div>'),$d=ge('<path stroke-width="0.10" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),Pd=ge('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),Nd=ge("<!><!>",1),Od=ge('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),Wd=ge('<g opacity="0.5" pointer-events="none"><!></g>'),Yd=ge('<g><rect rx="9" ry="9" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></rect></g>'),Hd=ge('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></ellipse></g>'),Fd=ge('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></circle>'),Bd=ge('<g><rect rx="6" ry="6" fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></rect></g>'),qd=ge('<g><ellipse fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></ellipse></g>'),Ud=ge('<circle fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></circle>'),Kd=ge("<!><!>",1),Gd=ge('<circle r="0.4" fill="rgba(147, 51, 234, 0.5)" stroke="#9333ea" stroke-width="0.1" pointer-events="none"></circle><line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="group-rotate-handle"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),zd=ge('<circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle><circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle>',1),Xd=ge('<g><line stroke-linecap="round"></line><!><g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g></g>'),Vd=ge('<g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" fill="#f59e0b" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g>'),jd=ge('<g class="measurement-line drawing"><line stroke="#f59e0b" stroke-width="0.15" stroke-dasharray="0.3,0.15" stroke-linecap="round" pointer-events="none"></line><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><!></g>'),Zd=ge('<line stroke-width="0.05" pointer-events="none"></line>'),Qd=ge('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),Jd=ge('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),eh=ge('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),th=ge("<!><!><!><!><!><!><!><!><!><!><!><!><!><!><!>",1),nh=ve('<main class="svelte-1g40uyy"><div class="layout svelte-1g40uyy"><div class="sidebar svelte-1g40uyy"><!> <!> <!> <!> <!> <!></div> <div class="main-content svelte-1g40uyy"><div class="battlefield-area svelte-1g40uyy"><div class="battlefield-container svelte-1g40uyy" role="presentation"><!></div> <div class="info svelte-1g40uyy"><p class="svelte-1g40uyy"> </p> <p class="hint svelte-1g40uyy">Drag to select | Ctrl+Click multi-select | Del remove | 1/2 player | L LoS | M measure</p></div></div></div></div></main> <!>',1);function ah(t,n){Hn(n,!1);const a=()=>Dt(Qa,"$selectedDeployment",d),r=()=>Dt(ca,"$selectedLayoutName",d),s=()=>Dt(Sa,"$selectedLayoutType",d),i=()=>Dt(ht,"$models",d),o=()=>Dt(Ci,"$loadedTerrain",d),l=()=>Dt(Dn,"$history",d),m=()=>Dt(al,"$player1Models",d),h=()=>Dt(sl,"$player2Models",d),[d,p]=Gs(),u=N(),y=N(),g=N(),_=N(),T=N(),E=N(),R=N(),L=N(),S=N(),A=N(),M=N(),D=N();let C=N(1),I=N(null),F=!1,le=null,$=N(null),he=N(!1),we=N(!1),ne=N(5.5),re=N(3),ue=N(!1),be=N([]),Le=[],ee=N(null),K=N(!1),j=N(null),xe=N(null),W=N([]),ye=N(new Set),ke=!1,dt=!1,fe=null,ae=!1,Fe=null,Ce=0,Bt=null,Qe=N([]),st=N(null),ut=N(!1),nt=N(null),yt=N(null),Mt=N(!1),un=N(!1),oe=N(!1);const De=5,Ge="warhammer-deployment-state";function It(){const w={deployment:a()?.name||null,layout:r()||null,layoutType:s()||null,models:i()};localStorage.setItem(Ge,JSON.stringify(w))}function _t(){const w=localStorage.getItem(Ge);if(w)try{const O=JSON.parse(w);O.models&&Array.isArray(O.models)&&(ht.set(O.models),Dn.clear())}catch(O){console.error("Failed to restore deployment state:",O)}}function Ot(){localStorage.removeItem(Ge),ht.clear()}function Vt(){const w={version:1,exportedAt:new Date().toISOString(),deployment:a()?{name:a().name,zones:a().zones,objectives:a().objectives}:null,terrain:{layoutName:r(),layoutType:s(),terrains:o().terrains,walls:o().walls},models:i()},O=JSON.stringify(w,null,2),H=new Blob([O],{type:"application/json"}),Q=URL.createObjectURL(H),ie=document.createElement("a");ie.href=Q,ie.download=`deployment-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(ie),ie.click(),document.body.removeChild(ie),URL.revokeObjectURL(Q)}async function Pn(){const O=`deployment-${new Date().toISOString().slice(0,10)}`;try{await Ai(o().terrains,o().walls,i(),O,a())}catch(H){alert("Failed to export PNG"),console.error("Export error:",H)}}let pn=N(null);function Jt(){e(pn)?.click()}function Ne(w){const O=w.target.files?.[0];if(!O)return;const H=new FileReader;H.onload=Q=>{try{const ie=JSON.parse(Q.target.result);Je(ie)}catch(ie){console.error("Failed to parse import file:",ie),alert("Failed to import: Invalid JSON file")}},H.readAsText(O),w.target.value=""}function Je(w){if(!w.version){alert("Invalid import file: missing version");return}if(w.deployment){const O=ol.find(H=>H.name===w.deployment.name);O?Qa.set(O):w.deployment.zones&&w.deployment.objectives&&Qa.set({name:w.deployment.name||"Imported",zones:w.deployment.zones,objectives:w.deployment.objectives})}else Qa.set(null);if(w.terrain){const{layoutName:O,layoutType:H,terrains:Q,walls:ie}=w.terrain;if(H==="preset"&&O){if(wi.find(me=>me.name===O))ca.set(O),Sa.set("preset");else if(Q||ie){const me=`imported-${Date.now()}`,Ae=localStorage.getItem("warhammer-deployment-layouts"),qe=Ae?JSON.parse(Ae):{};qe[me]={terrains:Q||[],walls:ie||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(qe)),ca.set(me),Sa.set("saved")}}else if(H==="saved"&&O){const ce=localStorage.getItem("warhammer-deployment-layouts"),me=ce?JSON.parse(ce):{};me[O]?(ca.set(O),Sa.set("saved")):(Q||ie)&&(me[O]={terrains:Q||[],walls:ie||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(me)),ca.set(O),Sa.set("saved"))}else if(Q||ie){const ce=`imported-${Date.now()}`,me=localStorage.getItem("warhammer-deployment-layouts"),Ae=me?JSON.parse(me):{};Ae[ce]={terrains:Q||[],walls:ie||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(Ae)),ca.set(ce),Sa.set("saved")}}w.models&&Array.isArray(w.models)&&(ht.set(w.models),Dn.clear()),v(W,[])}function rt(w,O){const ie=O===1?-4:64,ce=2;let me=ie,Ae=ce,qe=0;return w.map(Ze=>{const tt={...Ze,x:me,y:Ae,inStaging:!1};return Ae+=2,qe++,qe>=20&&(Ae=ce,me+=O===1?-2:2,qe=0),tt})}async function St(w){const{text:O,playerId:H}=w.detail;try{e(ee)&&e(ee).setLoading(!0);const{format:Q,data:ie}=await ed(O),{matched:ce,unmatched:me}=md(ie,H),Ae=ie.LIST_TITLE||`${ie.FACTION_KEYWORD} Army`;ii.addImport(Ae,O,ie,H),me.length>0?(v(be,me),Le=ce,v(ue,!0),e(ee)&&e(ee).setLoading(!1)):(rt(ce,H).forEach(Ze=>{ht.update(tt=>[...tt,Ze])}),e(ee)&&(e(ee).setSuccess(`Imported ${ce.length} models from ${ie.FACTION_KEYWORD} (${Q})`),e(ee).clearText()))}catch(Q){console.error("Failed to parse army list:",Q),e(ee)&&e(ee).setError(Q.message||"Failed to parse army list")}}function Ut(w){const{selected:O}=w.detail,H=[];for(const ce of O){const me=typeof ce.quantity=="string"?parseInt(ce.quantity.replace(/x/i,""),10)||1:ce.quantity||1,Ae="unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);for(let qe=0;qe<me;qe++)H.push({id:"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),baseType:ce.baseType,playerId:e(C),x:0,y:0,rotation:0,unitId:Ae,unitName:ce.unitName,name:ce.unitName,imported:!0})}const Q=[...Le,...H];rt(Q,e(C)).forEach(ce=>{ht.update(me=>[...me,ce])}),e(ee)&&(e(ee).setSuccess(`Imported ${Q.length} models`),e(ee).clearText()),v(be,[]),Le=[]}ws(()=>{window.addEventListener("keydown",Y)}),xi(()=>{window.removeEventListener("keydown",Y)});function Y(w){if(w.target.tagName==="INPUT")return;const O=e(W).length>0;if((w.ctrlKey||w.metaKey)&&w.key==="z"&&!w.shiftKey){w.preventDefault(),ht.undo();return}if((w.ctrlKey||w.metaKey)&&(w.key==="y"||w.shiftKey&&w.key==="z")){w.preventDefault(),ht.redo();return}if(w.key==="1"){w.preventDefault(),v(C,1);return}if(w.key==="2"){w.preventDefault(),v(C,2);return}if(w.key==="l"||w.key==="L"){w.preventDefault(),v(he,!e(he));return}if(w.key==="m"||w.key==="M"){w.preventDefault(),v(Mt,!e(Mt)),e(Mt)||(v(ut,!1),v(nt,null),v(yt,null));return}if(w.key==="Delete"||w.key==="Backspace"){if(w.preventDefault(),e(st)){v(Qe,e(Qe).filter(H=>H.id!==e(st))),v(st,null);return}e(W).length>0&&(e(W).forEach(H=>{ht.remove(H)}),v(W,[]));return}if(O&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(w.key)){w.preventDefault();const H=w.shiftKey?.1:1;let Q=0,ie=0;switch(w.key){case"ArrowUp":ie=-H;break;case"ArrowDown":ie=H;break;case"ArrowLeft":Q=-H;break;case"ArrowRight":Q=H;break}e(W).forEach(ce=>{const me=i().find(Ae=>Ae.id===ce);me&&ht.updateModel(ce,{x:me.x+Q,y:me.y+ie},!1)});return}if(w.key==="Escape"){B();return}}function B(w){if(ke){ke=!1;return}v(W,[]),v(st,null)}function Te(){return"line-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Be(w,O,H,Q){return Math.sqrt((H-w)**2+(Q-O)**2)}function Ee(w){if(!e($))return;w.preventDefault();const O=e($)(w.clientX,w.clientY);v(ut,!0),v(nt,{x:O.x,y:O.y}),v(yt,{x:O.x,y:O.y}),window.addEventListener("mousemove",ot),window.addEventListener("mouseup",at)}function ot(w){if(!e(ut)||!e($))return;const O=e($)(w.clientX,w.clientY);v(yt,{x:O.x,y:O.y})}function at(w){if(!e(ut))return;if(Be(e(nt).x,e(nt).y,e(yt).x,e(yt).y)>.5){const H={id:Te(),x1:e(nt).x,y1:e(nt).y,x2:e(yt).x,y2:e(yt).y};v(Qe,[...e(Qe),H]),v(st,H.id),v(W,[])}v(ut,!1),v(nt,null),v(yt,null),window.removeEventListener("mousemove",ot),window.removeEventListener("mouseup",at)}function $e(w,O){O?.stopPropagation(),v(st,w),v(W,[])}let ze=!1,Yt={x:0,y:0},Kt=null,qt=null;function ya(w,O){if(!e(Mt)||!e($))return;O.stopPropagation(),O.preventDefault();const H=e(Qe).find(me=>me.id===w);if(!H)return;ze=!0,Kt=w,qt=null,v(st,w),v(W,[]);const Q=e($)(O.clientX,O.clientY),ie=(H.x1+H.x2)/2,ce=(H.y1+H.y2)/2;Yt={x:Q.x-ie,y:Q.y-ce},window.addEventListener("mousemove",ga),window.addEventListener("mouseup",ra)}function va(w,O,H){!e(Mt)||!e($)||(H.stopPropagation(),H.preventDefault(),ze=!0,Kt=w,qt=O,v(st,w),v(W,[]),window.addEventListener("mousemove",ga),window.addEventListener("mouseup",ra))}function ga(w){if(!ze||!e($)||!Kt)return;const O=e($)(w.clientX,w.clientY);v(Qe,e(Qe).map(H=>{if(H.id!==Kt)return H;if(qt===1)return{...H,x1:O.x,y1:O.y};if(qt===2)return{...H,x2:O.x,y2:O.y};{const Q=O.x-Yt.x,ie=O.y-Yt.y,ce=(H.x1+H.x2)/2,me=(H.y1+H.y2)/2,Ae=Q-ce,qe=ie-me;return{...H,x1:H.x1+Ae,y1:H.y1+qe,x2:H.x2+Ae,y2:H.y2+qe}}}))}function ra(){ze=!1,Kt=null,qt=null,window.removeEventListener("mousemove",ga),window.removeEventListener("mouseup",ra)}function rs(){v(Qe,[]),v(st,null)}function wn(w){const O=w.target,H=O.closest(".model-base"),Q=O.closest(".measurement-line");if(H||Q||!e($))return;if(w.preventDefault(),e(Mt)){Ee(w);return}const ie=e($)(w.clientX,w.clientY);v(j,{x:ie.x,y:ie.y}),v(xe,{x:ie.x,y:ie.y}),v(K,!0),window.addEventListener("mousemove",Qn),window.addEventListener("mouseup",Bn)}function Qn(w){if(!e(K)||!e($))return;const O=e($)(w.clientX,w.clientY);v(xe,{x:O.x,y:O.y});const H=Math.min(e(j).x,e(xe).x),Q=Math.max(e(j).x,e(xe).x),ie=Math.min(e(j).y,e(xe).y),ce=Math.max(e(j).y,e(xe).y),me=new Set;i().forEach(Ae=>{Ae.x>=H&&Ae.x<=Q&&Ae.y>=ie&&Ae.y<=ce&&me.add(Ae.id)}),v(ye,me)}function Bn(w){if(!e(K))return;const O=Math.min(e(j).x,e(xe).x),H=Math.max(e(j).x,e(xe).x),Q=Math.min(e(j).y,e(xe).y),ie=Math.max(e(j).y,e(xe).y),ce=H-O,me=ie-Q;if(ce<.5&&me<.5)v(W,[]);else{const Ae=[];i().forEach(qe=>{qe.x>=O&&qe.x<=H&&qe.y>=Q&&qe.y<=ie&&Ae.push(qe.id)}),v(W,Ae),ke=!0}v(K,!1),v(j,null),v(xe,null),e(ye).clear(),v(ye,e(ye)),window.removeEventListener("mousemove",Qn),window.removeEventListener("mouseup",Bn)}function P(w,O){if(!e($))return;F=!0,le={x:O.clientX,y:O.clientY};const H=e($)(O.clientX,O.clientY);v(I,{baseType:w.type,x:H.x,y:H.y}),window.addEventListener("mousemove",Z),window.addEventListener("mouseup",se)}function Z(w){if(!F||!e(I)||!e($))return;const O=e($)(w.clientX,w.clientY);v(I,{...e(I),x:O.x,y:O.y})}function se(w){if(!F||!e(I)){F=!1,v(I,null),le=null,window.removeEventListener("mousemove",Z),window.removeEventListener("mouseup",se);return}const O=w.clientX-le.x,H=w.clientY-le.y,Q=Math.sqrt(O*O+H*H);let ie,ce;Q<De?(ie=30,ce=22):(ie=e(I).x,ce=e(I).y);const me=e(I).customWidth&&e(I).customHeight?{width:e(I).customWidth,height:e(I).customHeight}:null,Ae=ht.add(e(I).baseType,e(C),ie,ce,me);v(W,[Ae]),v(I,null),F=!1,le=null,window.removeEventListener("mousemove",Z),window.removeEventListener("mouseup",se)}function Pe(){const H={width:e(ne),height:e(re)},Q=ht.add("rect-custom",e(C),30,22,H);v(W,[Q])}function Oe(w,O){O&&(O.ctrlKey||O.metaKey||O.shiftKey)?e(W).includes(w)?v(W,e(W).filter(H=>H!==w)):v(W,[...e(W),w]):e(W).includes(w)&&e(W).length>1||v(W,[w])}function We(w,O,H){if(e(W).length>1&&e(W).includes(w)){dt||(dt=!0,fe={},e(W).forEach(ie=>{const ce=i().find(me=>me.id===ie);ce&&(fe[ie]={x:ce.x,y:ce.y})}));const Q=fe[w];if(Q){const ie=O-Q.x,ce=H-Q.y;e(W).forEach(me=>{const Ae=fe[me];Ae&&ht.updateModel(me,{x:Ae.x+ie,y:Ae.y+ce},!0)})}}else ht.updateModel(w,{x:O,y:H},!0)}function He(w,O,H,Q,ie){dt?(e(W).forEach(ce=>{const me=fe[ce],Ae=i().find(qe=>qe.id===ce);me&&Ae&&Dn.push({type:"move",modelId:ce,before:{x:me.x,y:me.y},after:{x:Ae.x,y:Ae.y}})}),dt=!1,fe=null):Dn.push({type:"move",modelId:w,before:{x:O,y:H},after:{x:Q,y:ie}})}function et(w,O){if(e(W).length>1&&e(W).includes(w)){if(!ae){ae=!0;let ce=0,me=0,Ae=0;const qe={};e(W).forEach(Ze=>{const tt=i().find(it=>it.id===Ze);tt&&(ce+=tt.x,me+=tt.y,Ae++,qe[Ze]={x:tt.x,y:tt.y,rotation:tt.rotation||0})}),Fe={x:ce/Ae,y:me/Ae},fe=qe}const H=i().find(ce=>ce.id===w),Q=fe[w];if(!H||!Q)return;const ie=O-Q.rotation;e(W).forEach(ce=>{const me=fe[ce];if(me){const Ae=me.x-Fe.x,qe=me.y-Fe.y,Ze=ie*Math.PI/180,tt=Math.cos(Ze),it=Math.sin(Ze),Zt=Ae*tt-qe*it,an=Ae*it+qe*tt;ht.updateModel(ce,{x:Fe.x+Zt,y:Fe.y+an,rotation:me.rotation+ie},!0)}})}else ht.updateModel(w,{rotation:O},!0)}function vt(w,O,H){ae?(e(W).forEach(Q=>{const ie=fe[Q],ce=i().find(me=>me.id===Q);ie&&ce&&Dn.push({type:"rotate",modelId:Q,before:{x:ie.x,y:ie.y,rotation:ie.rotation},after:{x:ce.x,y:ce.y,rotation:ce.rotation||0}})}),ae=!1,Fe=null,fe=null):Dn.push({type:"rotate",modelId:w,before:{rotation:O},after:{rotation:H}})}function en(w,O){ht.updateModel(w,{name:O})}function Ft(w){if(!e($)||e(u).length<2)return;w.preventDefault(),w.stopPropagation(),ae=!0,Bt={},e(u).forEach(H=>{Bt[H.id]={x:H.x,y:H.y,rotation:H.rotation||0}});const O=e($)(w.clientX,w.clientY);Ce=Math.atan2(O.y-e(g).y,O.x-e(g).x)*180/Math.PI,window.addEventListener("mousemove",At),window.addEventListener("mouseup",jt)}function At(w){if(!ae||!e($)||!e(g))return;const O=e($)(w.clientX,w.clientY);let Q=Math.atan2(O.y-e(g).y,O.x-e(g).x)*180/Math.PI-Ce;w.shiftKey||(Q=Math.round(Q/15)*15),v(tn,-45+Q);const ie=Q*Math.PI/180,ce=Math.cos(ie),me=Math.sin(ie);e(u).forEach(Ae=>{const qe=Bt[Ae.id];if(qe){const Ze=qe.x-e(g).x,tt=qe.y-e(g).y,it=Ze*ce-tt*me,Zt=Ze*me+tt*ce;ht.updateModel(Ae.id,{x:e(g).x+it,y:e(g).y+Zt,rotation:qe.rotation+Q},!0)}})}function jt(){ae&&Bt&&e(u).forEach(w=>{const O=Bt[w.id];O&&Dn.push({type:"rotate",modelId:w.id,before:{x:O.x,y:O.y,rotation:O.rotation},after:{x:w.x,y:w.y,rotation:w.rotation||0}})}),ae=!1,Bt=null,v(tn,-45),window.removeEventListener("mousemove",At),window.removeEventListener("mouseup",jt)}function on(){e(W).length>0&&(e(W).forEach(w=>{ht.remove(w)}),v(W,[]))}function Sn(){confirm("Clear all models?")&&(ht.clear(),v(W,[]))}function dn(w){if(fa(w.baseType))return{x:w.x,y:w.y,width:w.customWidth,height:w.customHeight,rotation:w.rotation||0,isRectangle:!0};const O=In(w.baseType,w);return bn(w.baseType)?{x:w.x,y:w.y,rx:O.width/2,ry:O.height/2,rotation:w.rotation||0}:{x:w.x,y:w.y,radius:O.radius}}let tn=N(-45);pe(()=>(e(W),i()),()=>{v(u,e(W).map(w=>i().find(O=>O.id===w)).filter(Boolean))}),pe(()=>e(u),()=>{v(y,e(u).length===1?e(u)[0]:null)}),pe(()=>e(u),()=>{v(g,e(u).length>1?(()=>{let w=0,O=0;return e(u).forEach(H=>{w+=H.x,O+=H.y}),{x:w/e(u).length,y:O/e(u).length}})():null)}),pe(()=>(e(u),e(g),bn),()=>{v(_,e(u).length>1?(()=>{let w=0;return e(u).forEach(O=>{const H=Math.sqrt(Math.pow(O.x-e(g).x,2)+Math.pow(O.y-e(g).y,2)),Q=In(O.baseType,O),ie=fa(O.baseType)?Math.max(O.customWidth,O.customHeight)/2:bn(O.baseType)?Math.max(Q.width,Q.height)/2:Q.radius;w=Math.max(w,H+ie)}),w+2})():0)}),pe(()=>(e(g),e(_),e(tn)),()=>{v(T,e(g)?e(g).x+e(_)*Math.cos(e(tn)*Math.PI/180):0)}),pe(()=>(e(g),e(_),e(tn)),()=>{v(E,e(g)?e(g).y+e(_)*Math.sin(e(tn)*Math.PI/180):0)}),pe(()=>(e(st),e(Qe)),()=>{v(R,e(st)?e(Qe).find(w=>w.id===e(st)):null)}),pe(()=>e(u),()=>{v(L,[...new Set(e(u).map(w=>w.playerId))])}),pe(()=>(e(u),i(),e(L)),()=>{v(S,e(u).length>0?i().filter(w=>!e(L).includes(w.playerId)):[])}),pe(()=>(o(),xs),()=>{v(A,o().terrains.map(w=>({id:w.id,vertices:xs(w)})))}),pe(()=>(o(),qa),()=>{v(M,o().walls.map(w=>dr(qa(w.shape,w.segments),w.x,w.y,w.rotation)))}),pe(()=>(e(u),e(he),e(S),e(A),e(M)),()=>{v(D,e(u).length>0&&e(he)&&e(S).length>0?e(u).flatMap(w=>e(S).map(O=>{const H=_i(dn(O),dn(w),e(A),e(M));return{sourceId:O.id,source:O,targetId:w.id,target:w,canSee:H.canSee,firstClearRay:H.firstClearRay,rays:H.rays}})):[])}),Ra(),Zn();var Et=nh(),Gt=_e(Et),yn=x(Gt),vn=x(yn),En=x(vn);cn(En,{title:"Selected Model",children:(w,O)=>{var H=xt(),Q=_e(H);{var ie=me=>{var Ae=xd(),qe=x(Ae),Ze=b(x(qe),2),tt=x(Ze),it=b(qe,2),Zt=x(it),an=x(Zt),$t=b(it,2);{var Rt=fn=>{var qn=Td(),ia=_e(qn),ba=x(ia),Ta=x(ba),La=b(ia,2);{var is=Da=>{var os=bd(),zs=b(x(os),2),Ue=x(zs);U(G=>Re(Ue,`${G??""}/${e(D),c(()=>e(D).length)??""} rays visible`),[()=>(e(D),c(()=>e(D).filter(G=>G.canSee).length))]),k(Da,os)};te(La,Da=>{e(D),c(()=>e(D).length>0)&&Da(is)})}Cn(Ta,()=>e(we),Da=>v(we,Da)),k(fn,qn)};te($t,fn=>{e(he)&&fn(Rt)})}var sn=b($t,2),Qt=x(sn);U(()=>{Re(tt,`${e(W),c(()=>e(W).length)??""} models`),Re(Qt,`Remove All (${e(W),c(()=>e(W).length)??""})`)}),Cn(an,()=>e(he),fn=>v(he,fn)),V("click",sn,on),k(me,Ae)},ce=me=>{var Ae=xt(),qe=_e(Ae);{var Ze=it=>{var Zt=Ad(),an=x(Zt),$t=b(x(an),2),Rt=b(an,2),sn=b(x(Rt),2),Qt=x(sn),fn=b(Rt,2),qn=b(x(fn),2),ia=x(qn),ba=b(fn,2),Ta=b(x(ba),2),La=x(Ta),is=b(ba,2);{var Da=mt=>{var Ht=_d(),ct=b(x(Ht),2),ft=x(ct);U(Ct=>Re(ft,`${Ct??""}Â°`),[()=>(e(y),c(()=>Math.round(e(y).rotation||0)))]),k(mt,Ht)};te(is,mt=>{J(bn),e(y),c(()=>bn(e(y).baseType))&&mt(Da)})}var os=b(is,2),zs=x(os),Ue=x(zs),G=b(os,2);{var Pt=mt=>{var Ht=wd(),ct=x(Ht),ft=x(ct);Cn(ft,()=>e(we),Ct=>v(we,Ct)),k(mt,Ht)};te(G,mt=>{e(he)&&mt(Pt)})}var kt=b(G,2);{var X=mt=>{var Ht=Sd(),ct=b(x(Ht),2),ft=x(ct);U(Ct=>Re(ft,`${Ct??""}/${e(D),c(()=>e(D).length)??""} visible`),[()=>(e(D),c(()=>e(D).filter(Ct=>Ct.canSee).length))]),k(mt,Ht)};te(kt,mt=>{e(he),e(D),c(()=>e(he)&&e(D).length>0)&&mt(X)})}var Me=b(kt,2);U((mt,Ht,ct)=>{Uo($t,(e(y),c(()=>e(y).name||""))),Re(Qt,mt),Re(ia,`Player ${e(y),c(()=>e(y).playerId)??""}`),Re(La,`${Ht??""}", ${ct??""}"`)},[()=>(J(In),e(y),c(()=>In(e(y).baseType,e(y))?.label||"Unknown")),()=>(e(y),c(()=>e(y).x.toFixed(1))),()=>(e(y),c(()=>e(y).y.toFixed(1)))]),V("change",$t,mt=>en(e(y).id,mt.target.value)),Cn(Ue,()=>e(he),mt=>v(he,mt)),V("click",Me,on),k(it,Zt)},tt=it=>{var Zt=Cd();k(it,Zt)};te(qe,it=>{e(y)?it(Ze):it(tt,!1)},!0)}k(me,Ae)};te(Q,me=>{e(W),c(()=>e(W).length>1)?me(ie):me(ce,!1)})}k(w,H)},$$slots:{default:!0}});var kn=b(En,2);cn(kn,{title:"Measure Tool",children:(w,O)=>{var H=Rd(),Q=x(H),ie=x(Q),ce=x(ie),me=b(Q,2);{var Ae=Qt=>{var fn=Ed();k(Qt,fn)};te(me,Qt=>{e(Mt)&&Qt(Ae)})}var qe=b(me,2);{var Ze=Qt=>{var fn=kd(),qn=_e(fn),ia=b(x(qn),2),ba=x(ia),Ta=b(qn,2);U(La=>Re(ba,`${La??""}"`),[()=>(e(R),c(()=>Be(e(R).x1,e(R).y1,e(R).x2,e(R).y2).toFixed(2)))]),V("click",Ta,()=>{v(Qe,e(Qe).filter(La=>La.id!==e(st))),v(st,null)}),k(Qt,fn)};te(qe,Qt=>{e(R)&&Qt(Ze)})}var tt=b(qe,2);{var it=Qt=>{var fn=Md(),qn=_e(fn),ia=b(x(qn),2),ba=x(ia),Ta=b(qn,2);U(()=>Re(ba,`${e(Qe),c(()=>e(Qe).length)??""} line${e(Qe),c(()=>e(Qe).length!==1?"s":"")??""}`)),V("click",Ta,rs),k(Qt,fn)};te(tt,Qt=>{e(Qe),c(()=>e(Qe).length>0)&&Qt(it)})}var Zt=b(tt,2),an=b(x(Zt),2),$t=x(an),Rt=b(an,2),sn=x(Rt);Cn(ce,()=>e(Mt),Qt=>v(Mt,Qt)),Cn($t,()=>e(un),Qt=>v(un,Qt)),Cn(sn,()=>e(oe),Qt=>v(oe,Qt)),k(w,H)},$$slots:{default:!0}});var hn=b(kn,2);cn(hn,{title:"Actions",children:(w,O)=>{var H=Ld(),Q=x(H),ie=x(Q),ce=b(ie,2),me=b(Q,2),Ae=x(me),qe=b(Ae,2),Ze=b(me,2);kr(Ze,Rt=>v(pn,Rt),()=>e(pn));var tt=b(Ze,2),it=b(tt,2),Zt=b(it,2),an=b(Zt,2),$t=b(an,2);U(()=>{ie.disabled=(l(),c(()=>!l().past.length)),ce.disabled=(l(),c(()=>!l().future.length))}),V("click",ie,()=>ht.undo()),V("click",ce,()=>ht.redo()),V("click",Ae,Vt),V("click",qe,Jt),V("change",Ze,Ne),V("click",tt,Pn),V("click",it,It),V("click",Zt,_t),V("click",an,Sn),V("click",$t,Ot),k(w,H)},$$slots:{default:!0}});var Ke=b(hn,2);cn(Ke,{title:"Import Army List",startOpen:!1,children:(w,O)=>{kr(Nm(w,{get currentPlayer(){return e(C)},$$events:{parse:St},$$legacy:!0}),H=>v(ee,H),()=>e(ee))},$$slots:{default:!0}});var q=b(Ke,2);cn(q,{title:"Add Models",children:(w,O)=>{var H=Dd(),Q=_e(H),ie=x(Q);let ce;var me=b(ie,2);let Ae;var qe=b(Q,2),Ze=x(qe),tt=b(x(Ze),2);Ye(tt,5,()=>(J(Vn),c(()=>Vn.circles)),lt,(an,$t)=>{Dr(an,{get baseSize(){return e($t)},get playerId(){return e(C)},onDragStart:P})});var it=b(Ze,2),Zt=b(x(it),2);Ye(Zt,5,()=>(J(Vn),c(()=>Vn.ovals)),lt,(an,$t)=>{Dr(an,{get baseSize(){return e($t)},get playerId(){return e(C)},onDragStart:P})}),U(()=>{ce=Tn(ie,1,"toggle-btn svelte-1g40uyy",null,ce,{active:e(C)===1}),Ae=Tn(me,1,"toggle-btn svelte-1g40uyy",null,Ae,{active:e(C)===2})}),V("click",ie,()=>v(C,1)),V("click",me,()=>v(C,2)),k(w,H)},$$slots:{default:!0}});var gt=b(q,2);cn(gt,{title:"Add Hull (Vehicle)",children:(w,O)=>{var H=Id(),Q=x(H),ie=b(x(Q),2),ce=b(Q,2),me=b(x(ce),2),Ae=b(ce,2),qe=x(Ae);U(()=>Re(qe,`Add ${e(ne)??""}" Ã ${e(re)??""}" Hull`)),Mn(ie,()=>e(ne),Ze=>v(ne,Ze)),Mn(me,()=>e(re),Ze=>v(re,Ze)),V("click",Ae,Pe),k(w,H)},$$slots:{default:!0}});var bt=b(vn,2),z=x(bt),Se=x(z),zt=x(Se);mr(zt,{children:$r,$$slots:{default:(w,O)=>{const H=Ie(()=>O.screenToSvg);var Q=th(),ie=_e(Q);{var ce=Ue=>{var G=bi();U(()=>Re(G,(e($),J(e(H)),c(()=>(v($,e(H)),""))))),k(Ue,G)};te(ie,Ue=>{e(H)&&!e($)&&Ue(ce)})}var me=b(ie);{var Ae=Ue=>{var G=Nd(),Pt=_e(G);Ye(Pt,1,()=>(a(),c(()=>a().zones)),lt,(X,Me)=>{var mt=$d();U(Ht=>{f(mt,"d",Ht),f(mt,"fill",(e(Me),c(()=>e(Me).color))),f(mt,"stroke",(e(Me),c(()=>e(Me).borderColor)))},[()=>(J(Hs),e(Me),c(()=>Hs(e(Me).path)))]),k(X,mt)});var kt=b(Pt);Ye(kt,1,()=>(a(),c(()=>a().objectives)),lt,(X,Me)=>{const mt=Ie(()=>(e(Me),c(()=>e(Me).isPrimary?"#fbbf24":"#9ca3af"))),Ht=Ie(()=>(e(Me),c(()=>e(Me).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var ct=Pd(),ft=_e(ct),Ct=b(ft),Jn=b(Ct);U(()=>{f(ft,"cx",(e(Me),c(()=>e(Me).x))),f(ft,"cy",(e(Me),c(()=>e(Me).y))),f(ft,"r",Hr),f(ft,"fill",e(Ht)),f(ft,"stroke",e(mt)),f(Ct,"cx",(e(Me),c(()=>e(Me).x))),f(Ct,"cy",(e(Me),c(()=>e(Me).y))),f(Ct,"r",Yr),f(Ct,"fill",e(mt)),f(Jn,"cx",(e(Me),c(()=>e(Me).x))),f(Jn,"cy",(e(Me),c(()=>e(Me).y)))}),k(X,ct)}),k(Ue,G)};te(me,Ue=>{a()&&Ue(Ae)})}var qe=b(me);te(qe,Ue=>{});var Ze=b(qe);te(Ze,Ue=>{});var tt=b(Ze);Ye(tt,1,()=>(o(),c(()=>o().terrains)),lt,(Ue,G)=>{var Pt=Od(),kt=x(Pt);U(()=>{f(Pt,"transform",`rotate(${e(G),c(()=>e(G).rotation)??""}, ${e(G),c(()=>e(G).x+e(G).width/2)??""}, ${e(G),c(()=>e(G).y+e(G).height/2)??""})`),f(kt,"x",(e(G),c(()=>e(G).x))),f(kt,"y",(e(G),c(()=>e(G).y))),f(kt,"width",(e(G),c(()=>e(G).width))),f(kt,"height",(e(G),c(()=>e(G).height)))}),k(Ue,Pt)});var it=b(tt);Ye(it,1,()=>(o(),c(()=>o().walls)),lt,(Ue,G)=>{var Pt=Wd(),kt=x(Pt);Wr(kt,{get id(){return e(G),c(()=>e(G).id)},get x(){return e(G),c(()=>e(G).x)},get y(){return e(G),c(()=>e(G).y)},get shape(){return e(G),c(()=>e(G).shape)},get segments(){return e(G),c(()=>e(G).segments)},get rotation(){return e(G),c(()=>e(G).rotation)},selected:!1,get screenToSvg(){return e(H)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),k(Ue,Pt)});var Zt=b(it);{var an=Ue=>{var G=xt(),Pt=_e(G);Ye(Pt,1,i,kt=>kt.id,(kt,X)=>{const Me=Ie(()=>(J(In),e(X),c(()=>In(e(X).baseType,e(X))))),mt=Ie(()=>(J(bn),e(X),c(()=>bn(e(X).baseType)))),Ht=Ie(()=>(J(fa),e(X),c(()=>fa(e(X).baseType)))),ct=Ie(()=>(e(X),c(()=>e(X).playerId===1?"rgba(59, 130, 246, 0.15)":"rgba(239, 68, 68, 0.15)"))),ft=Ie(()=>(e(X),c(()=>e(X).playerId===1?"#3b82f6":"#ef4444")));var Ct=Kd(),Jn=_e(Ct);{var As=xa=>{var oa=xt(),za=_e(oa);{var ls=Un=>{var Kn=Yd(),An=x(Kn);U(()=>{f(Kn,"transform",`rotate(${e(X),c(()=>e(X).rotation||0)??""}, ${e(X),c(()=>e(X).x)??""}, ${e(X),c(()=>e(X).y)??""})`),f(An,"x",(e(X),c(()=>e(X).x-e(X).customWidth/2-9))),f(An,"y",(e(X),c(()=>e(X).y-e(X).customHeight/2-9))),f(An,"width",(e(X),c(()=>e(X).customWidth+18))),f(An,"height",(e(X),c(()=>e(X).customHeight+18))),f(An,"fill",e(ct)),f(An,"stroke",e(ft))}),k(Un,Kn)},Fr=Un=>{var Kn=xt(),An=_e(Kn);{var Br=Gn=>{var ln=Hd(),ea=x(ln);U(()=>{f(ln,"transform",`rotate(${e(X),c(()=>e(X).rotation||0)??""}, ${e(X),c(()=>e(X).x)??""}, ${e(X),c(()=>e(X).y)??""})`),f(ea,"cx",(e(X),c(()=>e(X).x))),f(ea,"cy",(e(X),c(()=>e(X).y))),f(ea,"rx",(J(e(Me)),c(()=>e(Me).width/2+9))),f(ea,"ry",(J(e(Me)),c(()=>e(Me).height/2+9))),f(ea,"fill",e(ct)),f(ea,"stroke",e(ft))}),k(Gn,ln)},qr=Gn=>{var ln=Fd();U(()=>{f(ln,"cx",(e(X),c(()=>e(X).x))),f(ln,"cy",(e(X),c(()=>e(X).y))),f(ln,"r",(J(e(Me)),c(()=>e(Me).radius+9))),f(ln,"fill",e(ct)),f(ln,"stroke",e(ft))}),k(Gn,ln)};te(An,Gn=>{e(mt)?Gn(Br):Gn(qr,!1)},!0)}k(Un,Kn)};te(za,Un=>{e(Ht)?Un(ls):Un(Fr,!1)})}k(xa,oa)};te(Jn,xa=>{e(oe)&&xa(As)})}var Xs=b(Jn);{var Nn=xa=>{var oa=xt(),za=_e(oa);{var ls=Un=>{var Kn=Bd(),An=x(Kn);U(()=>{f(Kn,"transform",`rotate(${e(X),c(()=>e(X).rotation||0)??""}, ${e(X),c(()=>e(X).x)??""}, ${e(X),c(()=>e(X).y)??""})`),f(An,"x",(e(X),c(()=>e(X).x-e(X).customWidth/2-6))),f(An,"y",(e(X),c(()=>e(X).y-e(X).customHeight/2-6))),f(An,"width",(e(X),c(()=>e(X).customWidth+12))),f(An,"height",(e(X),c(()=>e(X).customHeight+12))),f(An,"stroke",e(ft))}),k(Un,Kn)},Fr=Un=>{var Kn=xt(),An=_e(Kn);{var Br=Gn=>{var ln=qd(),ea=x(ln);U(()=>{f(ln,"transform",`rotate(${e(X),c(()=>e(X).rotation||0)??""}, ${e(X),c(()=>e(X).x)??""}, ${e(X),c(()=>e(X).y)??""})`),f(ea,"cx",(e(X),c(()=>e(X).x))),f(ea,"cy",(e(X),c(()=>e(X).y))),f(ea,"rx",(J(e(Me)),c(()=>e(Me).width/2+6))),f(ea,"ry",(J(e(Me)),c(()=>e(Me).height/2+6))),f(ea,"stroke",e(ft))}),k(Gn,ln)},qr=Gn=>{var ln=Ud();U(()=>{f(ln,"cx",(e(X),c(()=>e(X).x))),f(ln,"cy",(e(X),c(()=>e(X).y))),f(ln,"r",(J(e(Me)),c(()=>e(Me).radius+6))),f(ln,"stroke",e(ft))}),k(Gn,ln)};te(An,Gn=>{e(mt)?Gn(Br):Gn(qr,!1)},!0)}k(Un,Kn)};te(za,Un=>{e(Ht)?Un(ls):Un(Fr,!1)})}k(xa,oa)};te(Xs,xa=>{e(un)&&xa(Nn)})}k(kt,Ct)}),k(Ue,G)};te(Zt,Ue=>{(e(un)||e(oe))&&Ue(an)})}var $t=b(Zt);Ye($t,1,i,Ue=>Ue.id,(Ue,G)=>{{let Pt=Ie(()=>(e(G),c(()=>e(G).name||""))),kt=Ie(()=>(e(W),e(G),c(()=>e(W).includes(e(G).id)))),X=Ie(()=>(e(W),e(G),c(()=>e(W).length>1&&e(W).includes(e(G).id)))),Me=Ie(()=>(e(W),e(G),e(ye),c(()=>!e(W).includes(e(G).id)&&e(ye).has(e(G).id))));rr(Ue,{get id(){return e(G),c(()=>e(G).id)},get x(){return e(G),c(()=>e(G).x)},get y(){return e(G),c(()=>e(G).y)},get baseType(){return e(G),c(()=>e(G).baseType)},get playerId(){return e(G),c(()=>e(G).playerId)},get rotation(){return e(G),c(()=>e(G).rotation)},get name(){return e(Pt)},get customWidth(){return e(G),c(()=>e(G).customWidth)},get customHeight(){return e(G),c(()=>e(G).customHeight)},get selected(){return e(kt)},get inGroupSelection(){return e(X)},get marqueePreview(){return e(Me)},get screenToSvg(){return e(H)},onSelect:Oe,onDrag:We,onDragEnd:He,onRotate:et,onRotateEnd:vt,onRename:en})}});var Rt=b($t);{var sn=Ue=>{rr(Ue,{id:"phantom",get x(){return e(I),c(()=>e(I).x)},get y(){return e(I),c(()=>e(I).y)},get baseType(){return e(I),c(()=>e(I).baseType)},get playerId(){return e(C)},rotation:0,get customWidth(){return e(I),c(()=>e(I).customWidth)},get customHeight(){return e(I),c(()=>e(I).customHeight)},selected:!1,get screenToSvg(){return e(H)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};te(Rt,Ue=>{e(I)&&Ue(sn)})}var Qt=b(Rt);{var fn=Ue=>{var G=Gd(),Pt=_e(G),kt=b(Pt),X=b(kt),Me=b(X);U(()=>{f(Pt,"cx",(e(g),c(()=>e(g).x))),f(Pt,"cy",(e(g),c(()=>e(g).y))),f(kt,"x1",(e(g),c(()=>e(g).x))),f(kt,"y1",(e(g),c(()=>e(g).y))),f(kt,"x2",e(T)),f(kt,"y2",e(E)),f(X,"cx",e(T)),f(X,"cy",e(E)),f(Me,"transform",`translate(${e(T)??""}, ${e(E)??""})`)}),V("mousedown",X,Ft),k(Ue,G)};te(Qt,Ue=>{e(g),e(u),c(()=>e(g)&&e(u).length>1)&&Ue(fn)})}var qn=b(Qt);Ye(qn,1,()=>e(Qe),Ue=>Ue.id,(Ue,G)=>{const Pt=Ie(()=>(e(G),c(()=>Be(e(G).x1,e(G).y1,e(G).x2,e(G).y2)))),kt=Ie(()=>(e(G),c(()=>(e(G).x1+e(G).x2)/2))),X=Ie(()=>(e(G),c(()=>(e(G).y1+e(G).y2)/2))),Me=Ie(()=>(e(G),e(st),c(()=>e(G).id===e(st))));var mt=Xd();let Ht;var ct=x(mt),ft=b(ct);{var Ct=Nn=>{var xa=zd(),oa=_e(xa),za=b(oa);U(()=>{f(oa,"cx",(e(G),c(()=>e(G).x1))),f(oa,"cy",(e(G),c(()=>e(G).y1))),f(oa,"fill",e(Me)?"#3b82f6":"#f59e0b"),f(za,"cx",(e(G),c(()=>e(G).x2))),f(za,"cy",(e(G),c(()=>e(G).y2))),f(za,"fill",e(Me)?"#3b82f6":"#f59e0b")}),V("mousedown",oa,ls=>va(e(G).id,1,ls)),V("mousedown",za,ls=>va(e(G).id,2,ls)),k(Nn,xa)};te(ft,Nn=>{e(Mt)&&Nn(Ct)})}var Jn=b(ft),As=b(x(Jn)),Xs=x(As);U(Nn=>{Ht=Tn(mt,0,"measurement-line",null,Ht,{selected:e(Me),"tool-active":e(Mt)}),f(ct,"x1",(e(G),c(()=>e(G).x1))),f(ct,"y1",(e(G),c(()=>e(G).y1))),f(ct,"x2",(e(G),c(()=>e(G).x2))),f(ct,"y2",(e(G),c(()=>e(G).y2))),f(ct,"stroke",e(Me)&&e(Mt)?"#3b82f6":"#f59e0b"),f(ct,"stroke-width",e(Me)&&e(Mt)?.2:.15),f(ct,"role",e(Mt)?"button":"presentation"),f(ct,"tabindex",e(Mt)?0:-1),f(Jn,"transform",`translate(${e(kt)??""}, ${e(X)??""})`),f(As,"fill",e(Me)&&e(Mt)?"#3b82f6":"#f59e0b"),Re(Xs,`${Nn??""}"`)},[()=>(J(e(Pt)),c(()=>e(Pt).toFixed(1)))]),V("click",ct,Nn=>e(Mt)&&$e(e(G).id,Nn)),V("mousedown",ct,Nn=>e(Mt)?ya(e(G).id,Nn):Nn.stopPropagation()),k(Ue,mt)});var ia=b(qn);{var ba=Ue=>{const G=Ie(()=>(e(nt),e(yt),c(()=>Be(e(nt).x,e(nt).y,e(yt).x,e(yt).y)))),Pt=Ie(()=>(e(nt),e(yt),c(()=>(e(nt).x+e(yt).x)/2))),kt=Ie(()=>(e(nt),e(yt),c(()=>(e(nt).y+e(yt).y)/2)));var X=jd(),Me=x(X),mt=b(Me),Ht=b(mt),ct=b(Ht);{var ft=Ct=>{var Jn=Vd(),As=b(x(Jn)),Xs=x(As);U(Nn=>{f(Jn,"transform",`translate(${e(Pt)??""}, ${e(kt)??""})`),Re(Xs,`${Nn??""}"`)},[()=>(J(e(G)),c(()=>e(G).toFixed(1)))]),k(Ct,Jn)};te(ct,Ct=>{e(G)>.5&&Ct(ft)})}U(()=>{f(Me,"x1",(e(nt),c(()=>e(nt).x))),f(Me,"y1",(e(nt),c(()=>e(nt).y))),f(Me,"x2",(e(yt),c(()=>e(yt).x))),f(Me,"y2",(e(yt),c(()=>e(yt).y))),f(mt,"cx",(e(nt),c(()=>e(nt).x))),f(mt,"cy",(e(nt),c(()=>e(nt).y))),f(Ht,"cx",(e(yt),c(()=>e(yt).x))),f(Ht,"cy",(e(yt),c(()=>e(yt).y)))}),k(Ue,X)};te(ia,Ue=>{e(ut)&&e(nt)&&e(yt)&&Ue(ba)})}var Ta=b(ia);{var La=Ue=>{var G=xt(),Pt=_e(G);Ye(Pt,1,()=>e(D),lt,(kt,X)=>{var Me=xt(),mt=_e(Me);Ye(mt,1,()=>(e(X),c(()=>e(X).rays)),lt,(Ht,ct)=>{var ft=Zd();U(()=>{f(ft,"x1",(e(ct),c(()=>e(ct).from.x))),f(ft,"y1",(e(ct),c(()=>e(ct).from.y))),f(ft,"x2",(e(ct),c(()=>e(ct).to.x))),f(ft,"y2",(e(ct),c(()=>e(ct).to.y))),f(ft,"stroke",(e(ct),c(()=>e(ct).blocked?"#ff000033":"#00ff0033")))}),k(Ht,ft)}),k(kt,Me)}),k(Ue,G)};te(Ta,Ue=>{e(we),e(he),e(u),e(D),c(()=>e(we)&&e(he)&&e(u).length>0&&e(D).length>0)&&Ue(La)})}var is=b(Ta);{var Da=Ue=>{var G=xt(),Pt=_e(G);Ye(Pt,1,()=>e(D),lt,(kt,X)=>{var Me=xt(),mt=_e(Me);{var Ht=ft=>{var Ct=Qd();U(()=>{f(Ct,"x1",(e(X),c(()=>e(X).firstClearRay.from.x))),f(Ct,"y1",(e(X),c(()=>e(X).firstClearRay.from.y))),f(Ct,"x2",(e(X),c(()=>e(X).firstClearRay.to.x))),f(Ct,"y2",(e(X),c(()=>e(X).firstClearRay.to.y)))}),k(ft,Ct)},ct=ft=>{var Ct=Jd();U(()=>{f(Ct,"x1",(e(X),c(()=>e(X).source.x))),f(Ct,"y1",(e(X),c(()=>e(X).source.y))),f(Ct,"x2",(e(X),c(()=>e(X).target.x))),f(Ct,"y2",(e(X),c(()=>e(X).target.y)))}),k(ft,Ct)};te(mt,ft=>{e(X),c(()=>e(X).firstClearRay)?ft(Ht):ft(ct,!1)})}k(kt,Me)}),k(Ue,G)};te(is,Ue=>{e(he),e(u),e(D),c(()=>e(he)&&e(u).length>0&&e(D).length>0)&&Ue(Da)})}var os=b(is);{var zs=Ue=>{const G=Ie(()=>(e(j),e(xe),c(()=>Math.min(e(j).x,e(xe).x)))),Pt=Ie(()=>(e(j),e(xe),c(()=>Math.min(e(j).y,e(xe).y)))),kt=Ie(()=>(e(xe),e(j),c(()=>Math.abs(e(xe).x-e(j).x)))),X=Ie(()=>(e(xe),e(j),c(()=>Math.abs(e(xe).y-e(j).y))));var Me=eh();U(()=>{f(Me,"x",e(G)),f(Me,"y",e(Pt)),f(Me,"width",e(kt)),f(Me,"height",e(X))}),k(Ue,Me)};te(os,Ue=>{e(K)&&e(j)&&e(xe)&&Ue(zs)})}k(w,Q)}}});var nn=b(Se,2),pt=x(nn),Tt=x(pt),je=b(Gt,2);Hm(je,{get unmatchedUnits(){return e(be)},get show(){return e(ue)},set show(w){v(ue,w)},$$events:{import:Ut,close:()=>{v(ue,!1)}},$$legacy:!0}),U(()=>Re(Tt,`Battlefield: 60" x 44" | ${m(),c(()=>m().length)??""} P1 models | ${h(),c(()=>h().length)??""} P2 models`)),V("mousedown",Se,wn),k(t,Et),Fn(),p()}var sh=ve('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">LoS Status</span> <span class="value svelte-hpuhtb"> </span></div>'),rh=ve('<div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Debug Rays</label></div> <!>',1),ih=ve('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Selected</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Line of Sight</label></div> <!> <button class="danger svelte-hpuhtb"> </button></div>'),oh=ve('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Rotation</span> <span class="value svelte-hpuhtb"> </span></div>'),lh=ve('<div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Debug Rays</label></div>'),ch=ve('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">LoS Status</span> <span class="value svelte-hpuhtb"> </span></div>'),uh=ve('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Base Type</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Player</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Position</span> <span class="value svelte-hpuhtb"> </span></div> <!> <div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-hpuhtb">Remove</button></div>'),mh=ve('<p class="hint svelte-hpuhtb">Click a model to select it</p>'),dh=ve('<p class="hint svelte-hpuhtb">Click and drag on battlefield to draw a measurement line</p>'),hh=ve('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Length</span> <span class="value svelte-hpuhtb"> </span></div> <button class="danger svelte-hpuhtb">Remove Line</button>',1),fh=ve('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Lines</span> <span class="value svelte-hpuhtb"> </span></div> <button class="secondary svelte-hpuhtb">Clear All Lines</button>',1),ph=ve('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Line Tool Active (M)</label></div> <!> <!> <!> <div class="field svelte-hpuhtb" style="margin-top: 0.5rem; border-top: 1px solid #333; padding-top: 0.5rem;"><span class="label-text svelte-hpuhtb">Range Zones</span> <label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show 6" zones</label> <label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show 9" zones</label></div></div>'),yh=ve('<div class="button-group vertical svelte-hpuhtb"><div class="button-row svelte-hpuhtb"><button title="Undo (Ctrl+Z)" class="svelte-hpuhtb">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-hpuhtb">Redo</button></div> <button title="Export battlefield as PNG image" class="svelte-hpuhtb">Export PNG</button></div>'),vh=ge('<path fill="none" stroke-width="0.15" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),gh=ge('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),bh=ge("<!><!>",1),Th=ge('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),xh=ge('<g opacity="0.5" pointer-events="none"><!></g>'),_h=ge('<g><rect rx="9" ry="9" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></rect></g>'),wh=ge('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></ellipse></g>'),Sh=ge('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></circle>'),Ah=ge('<g><rect rx="6" ry="6" fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></rect></g>'),Ch=ge('<g><ellipse fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></ellipse></g>'),Eh=ge('<circle fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></circle>'),kh=ge("<!><!>",1),Mh=ge('<circle r="0.4" fill="rgba(147, 51, 234, 0.5)" stroke="#9333ea" stroke-width="0.1" pointer-events="none"></circle><line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="group-rotate-handle"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),Rh=ge('<circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle><circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle>',1),Lh=ge('<g><line stroke-linecap="round"></line><!><g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g></g>'),Dh=ge('<g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" fill="#f59e0b" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g>'),Ih=ge('<g class="measurement-line drawing"><line stroke="#f59e0b" stroke-width="0.15" stroke-dasharray="0.3,0.15" stroke-linecap="round" pointer-events="none"></line><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><!></g>'),$h=ge('<line stroke-width="0.05" pointer-events="none"></line>'),Ph=ge('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),Nh=ge('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),Oh=ge('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),Wh=ge("<!><!><!><!><!><!><!><!><!><!><!><!>",1),Yh=ve('<main class="svelte-hpuhtb"><div class="layout svelte-hpuhtb"><div class="sidebar svelte-hpuhtb"><!> <!> <!></div> <div class="main-content svelte-hpuhtb"><div class="battlefield-area svelte-hpuhtb"><div class="battlefield-container svelte-hpuhtb" role="presentation"><!></div> <div class="info svelte-hpuhtb"><p class="svelte-hpuhtb"> </p> <p class="hint svelte-hpuhtb">Drag to select | Ctrl+Click multi-select | Del remove | L LoS | M measure</p></div></div></div></div></main>');function Hh(t,n){Hn(n,!1);const a=()=>Dt(Ci,"$loadedTerrain",m),r=()=>Dt(ht,"$models",m),s=()=>Dt(Qa,"$selectedDeployment",m),i=()=>Dt(Dn,"$history",m),o=()=>Dt(al,"$player1Models",m),l=()=>Dt(sl,"$player2Models",m),[m,h]=Gs(),d=N(),p=N(),u=N(),y=N(),g=N(),_=N(),T=N(),E=N(),R=N(),L=N(),S=N(),A=N();let M=N(null),D=N(!1),C=N(!1),I=N(!1),F=N(null),le=N(null),$=N([]),he=N(new Set),we=!1,ne=!1,re=null,ue=!1,be=null,Le=0,ee=null,K=N([]),j=N(null),xe=N(!1),W=N(null),ye=N(null),ke=N(!1),dt=N(!1),fe=N(!1);ws(()=>{window.addEventListener("keydown",Fe)}),xi(()=>{window.removeEventListener("keydown",Fe)});async function ae(){const Z=`battle-${new Date().toISOString().slice(0,10)}`;try{await Ai(a().terrains,a().walls,r(),Z,s())}catch(se){alert("Failed to export PNG"),console.error("Export error:",se)}}function Fe(P){if(P.target.tagName==="INPUT")return;const Z=e($).length>0;if((P.ctrlKey||P.metaKey)&&P.key==="z"&&!P.shiftKey){P.preventDefault(),ht.undo();return}if((P.ctrlKey||P.metaKey)&&(P.key==="y"||P.shiftKey&&P.key==="z")){P.preventDefault(),ht.redo();return}if(P.key==="l"||P.key==="L"){P.preventDefault(),v(D,!e(D));return}if(P.key==="m"||P.key==="M"){P.preventDefault(),v(ke,!e(ke)),e(ke)||(v(xe,!1),v(W,null),v(ye,null));return}if(P.key==="Delete"||P.key==="Backspace"){if(P.preventDefault(),e(j)){v(K,e(K).filter(se=>se.id!==e(j))),v(j,null);return}e($).length>0&&(e($).forEach(se=>{ht.remove(se)}),v($,[]));return}if(Z&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(P.key)){P.preventDefault();const se=P.shiftKey?.1:1;let Pe=0,Oe=0;switch(P.key){case"ArrowUp":Oe=-se;break;case"ArrowDown":Oe=se;break;case"ArrowLeft":Pe=-se;break;case"ArrowRight":Pe=se;break}e($).forEach(We=>{const He=r().find(et=>et.id===We);He&&ht.updateModel(We,{x:He.x+Pe,y:He.y+Oe},!1)});return}if(P.key==="Escape"){Ce();return}}function Ce(P){if(we){we=!1;return}v($,[]),v(j,null)}function Bt(){return"line-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Qe(P,Z,se,Pe){return Math.sqrt((se-P)**2+(Pe-Z)**2)}function st(P){if(!e(M))return;P.preventDefault();const Z=e(M)(P.clientX,P.clientY);v(xe,!0),v(W,{x:Z.x,y:Z.y}),v(ye,{x:Z.x,y:Z.y}),window.addEventListener("mousemove",ut),window.addEventListener("mouseup",nt)}function ut(P){if(!e(xe)||!e(M))return;const Z=e(M)(P.clientX,P.clientY);v(ye,{x:Z.x,y:Z.y})}function nt(P){if(!e(xe))return;if(Qe(e(W).x,e(W).y,e(ye).x,e(ye).y)>.5){const se={id:Bt(),x1:e(W).x,y1:e(W).y,x2:e(ye).x,y2:e(ye).y};v(K,[...e(K),se]),v(j,se.id),v($,[])}v(xe,!1),v(W,null),v(ye,null),window.removeEventListener("mousemove",ut),window.removeEventListener("mouseup",nt)}function yt(P,Z){Z?.stopPropagation(),v(j,P),v($,[])}let Mt=!1,un={x:0,y:0},oe=null,De=null;function Ge(P,Z){if(!e(ke)||!e(M))return;Z.stopPropagation(),Z.preventDefault();const se=e(K).find(He=>He.id===P);if(!se)return;Mt=!0,oe=P,De=null,v(j,P),v($,[]);const Pe=e(M)(Z.clientX,Z.clientY),Oe=(se.x1+se.x2)/2,We=(se.y1+se.y2)/2;un={x:Pe.x-Oe,y:Pe.y-We},window.addEventListener("mousemove",_t),window.addEventListener("mouseup",Ot)}function It(P,Z,se){!e(ke)||!e(M)||(se.stopPropagation(),se.preventDefault(),Mt=!0,oe=P,De=Z,v(j,P),v($,[]),window.addEventListener("mousemove",_t),window.addEventListener("mouseup",Ot))}function _t(P){if(!Mt||!e(M)||!oe)return;const Z=e(M)(P.clientX,P.clientY);v(K,e(K).map(se=>{if(se.id!==oe)return se;if(De===1)return{...se,x1:Z.x,y1:Z.y};if(De===2)return{...se,x2:Z.x,y2:Z.y};{const Pe=Z.x-un.x,Oe=Z.y-un.y,We=(se.x1+se.x2)/2,He=(se.y1+se.y2)/2,et=Pe-We,vt=Oe-He;return{...se,x1:se.x1+et,y1:se.y1+vt,x2:se.x2+et,y2:se.y2+vt}}}))}function Ot(){Mt=!1,oe=null,De=null,window.removeEventListener("mousemove",_t),window.removeEventListener("mouseup",Ot)}function Vt(){v(K,[]),v(j,null)}function Pn(P){const Z=P.target,se=Z.closest(".model-base"),Pe=Z.closest(".measurement-line");if(se||Pe||!e(M))return;if(P.preventDefault(),e(ke)){st(P);return}const Oe=e(M)(P.clientX,P.clientY);v(F,{x:Oe.x,y:Oe.y}),v(le,{x:Oe.x,y:Oe.y}),v(I,!0),window.addEventListener("mousemove",pn),window.addEventListener("mouseup",Jt)}function pn(P){if(!e(I)||!e(M))return;const Z=e(M)(P.clientX,P.clientY);v(le,{x:Z.x,y:Z.y});const se=Math.min(e(F).x,e(le).x),Pe=Math.max(e(F).x,e(le).x),Oe=Math.min(e(F).y,e(le).y),We=Math.max(e(F).y,e(le).y),He=new Set;r().forEach(et=>{et.x>=se&&et.x<=Pe&&et.y>=Oe&&et.y<=We&&He.add(et.id)}),v(he,He)}function Jt(P){if(!e(I))return;const Z=Math.min(e(F).x,e(le).x),se=Math.max(e(F).x,e(le).x),Pe=Math.min(e(F).y,e(le).y),Oe=Math.max(e(F).y,e(le).y),We=se-Z,He=Oe-Pe;if(We<.5&&He<.5)v($,[]);else{const et=[];r().forEach(vt=>{vt.x>=Z&&vt.x<=se&&vt.y>=Pe&&vt.y<=Oe&&et.push(vt.id)}),v($,et),we=!0}v(I,!1),v(F,null),v(le,null),e(he).clear(),v(he,e(he)),window.removeEventListener("mousemove",pn),window.removeEventListener("mouseup",Jt)}function Ne(P,Z){Z&&(Z.ctrlKey||Z.metaKey||Z.shiftKey)?e($).includes(P)?v($,e($).filter(se=>se!==P)):v($,[...e($),P]):e($).includes(P)&&e($).length>1||v($,[P])}function Je(P,Z,se){if(e($).length>1&&e($).includes(P)){ne||(ne=!0,re={},e($).forEach(Oe=>{const We=r().find(He=>He.id===Oe);We&&(re[Oe]={x:We.x,y:We.y})}));const Pe=re[P];if(Pe){const Oe=Z-Pe.x,We=se-Pe.y;e($).forEach(He=>{const et=re[He];et&&ht.updateModel(He,{x:et.x+Oe,y:et.y+We},!0)})}}else ht.updateModel(P,{x:Z,y:se},!0)}function rt(P,Z,se,Pe,Oe){ne?(e($).forEach(We=>{const He=re[We],et=r().find(vt=>vt.id===We);He&&et&&Dn.push({type:"move",modelId:We,before:{x:He.x,y:He.y},after:{x:et.x,y:et.y}})}),ne=!1,re=null):Dn.push({type:"move",modelId:P,before:{x:Z,y:se},after:{x:Pe,y:Oe}})}function St(P,Z){if(e($).length>1&&e($).includes(P)){if(!ue){ue=!0;let We=0,He=0,et=0;const vt={};e($).forEach(en=>{const Ft=r().find(At=>At.id===en);Ft&&(We+=Ft.x,He+=Ft.y,et++,vt[en]={x:Ft.x,y:Ft.y,rotation:Ft.rotation||0})}),be={x:We/et,y:He/et},re=vt}const se=r().find(We=>We.id===P),Pe=re[P];if(!se||!Pe)return;const Oe=Z-Pe.rotation;e($).forEach(We=>{const He=re[We];if(He){const et=He.x-be.x,vt=He.y-be.y,en=Oe*Math.PI/180,Ft=Math.cos(en),At=Math.sin(en),jt=et*Ft-vt*At,on=et*At+vt*Ft;ht.updateModel(We,{x:be.x+jt,y:be.y+on,rotation:He.rotation+Oe},!0)}})}else ht.updateModel(P,{rotation:Z},!0)}function Ut(P,Z,se){ue?(e($).forEach(Pe=>{const Oe=re[Pe],We=r().find(He=>He.id===Pe);Oe&&We&&Dn.push({type:"rotate",modelId:Pe,before:{x:Oe.x,y:Oe.y,rotation:Oe.rotation},after:{x:We.x,y:We.y,rotation:We.rotation||0}})}),ue=!1,be=null,re=null):Dn.push({type:"rotate",modelId:P,before:{rotation:Z},after:{rotation:se}})}function Y(P,Z){ht.updateModel(P,{name:Z})}function B(P){if(!e(M)||e(d).length<2)return;P.preventDefault(),P.stopPropagation(),ue=!0,ee={},e(d).forEach(se=>{ee[se.id]={x:se.x,y:se.y,rotation:se.rotation||0}});const Z=e(M)(P.clientX,P.clientY);Le=Math.atan2(Z.y-e(u).y,Z.x-e(u).x)*180/Math.PI,window.addEventListener("mousemove",Te),window.addEventListener("mouseup",Be)}function Te(P){if(!ue||!e(M)||!e(u))return;const Z=e(M)(P.clientX,P.clientY);let Pe=Math.atan2(Z.y-e(u).y,Z.x-e(u).x)*180/Math.PI-Le;P.shiftKey||(Pe=Math.round(Pe/15)*15),v(at,-45+Pe);const Oe=Pe*Math.PI/180,We=Math.cos(Oe),He=Math.sin(Oe);e(d).forEach(et=>{const vt=ee[et.id];if(vt){const en=vt.x-e(u).x,Ft=vt.y-e(u).y,At=en*We-Ft*He,jt=en*He+Ft*We;ht.updateModel(et.id,{x:e(u).x+At,y:e(u).y+jt,rotation:vt.rotation+Pe},!0)}})}function Be(){ue&&ee&&e(d).forEach(P=>{const Z=ee[P.id];Z&&Dn.push({type:"rotate",modelId:P.id,before:{x:Z.x,y:Z.y,rotation:Z.rotation},after:{x:P.x,y:P.y,rotation:P.rotation||0}})}),ue=!1,ee=null,v(at,-45),window.removeEventListener("mousemove",Te),window.removeEventListener("mouseup",Be)}function Ee(){e($).length>0&&(e($).forEach(P=>{ht.remove(P)}),v($,[]))}function ot(P){if(fa(P.baseType))return{x:P.x,y:P.y,width:P.customWidth,height:P.customHeight,rotation:P.rotation||0,isRectangle:!0};const Z=In(P.baseType,P);return bn(P.baseType)?{x:P.x,y:P.y,rx:Z.width/2,ry:Z.height/2,rotation:P.rotation||0}:{x:P.x,y:P.y,radius:Z.radius}}let at=N(-45);pe(()=>(e($),r()),()=>{v(d,e($).map(P=>r().find(Z=>Z.id===P)).filter(Boolean))}),pe(()=>e(d),()=>{v(p,e(d).length===1?e(d)[0]:null)}),pe(()=>e(d),()=>{v(u,e(d).length>1?(()=>{let P=0,Z=0;return e(d).forEach(se=>{P+=se.x,Z+=se.y}),{x:P/e(d).length,y:Z/e(d).length}})():null)}),pe(()=>(e(d),e(u),bn),()=>{v(y,e(d).length>1?(()=>{let P=0;return e(d).forEach(Z=>{const se=Math.sqrt(Math.pow(Z.x-e(u).x,2)+Math.pow(Z.y-e(u).y,2)),Pe=In(Z.baseType,Z),Oe=fa(Z.baseType)?Math.max(Z.customWidth,Z.customHeight)/2:bn(Z.baseType)?Math.max(Pe.width,Pe.height)/2:Pe.radius;P=Math.max(P,se+Oe)}),P+2})():0)}),pe(()=>(e(u),e(y),e(at)),()=>{v(g,e(u)?e(u).x+e(y)*Math.cos(e(at)*Math.PI/180):0)}),pe(()=>(e(u),e(y),e(at)),()=>{v(_,e(u)?e(u).y+e(y)*Math.sin(e(at)*Math.PI/180):0)}),pe(()=>(e(j),e(K)),()=>{v(T,e(j)?e(K).find(P=>P.id===e(j)):null)}),pe(()=>e(d),()=>{v(E,[...new Set(e(d).map(P=>P.playerId))])}),pe(()=>(e(d),r(),e(E)),()=>{v(R,e(d).length>0?r().filter(P=>!e(E).includes(P.playerId)):[])}),pe(()=>(a(),xs),()=>{v(L,a().terrains.map(P=>({id:P.id,vertices:xs(P)})))}),pe(()=>(a(),qa),()=>{v(S,a().walls.map(P=>dr(qa(P.shape,P.segments),P.x,P.y,P.rotation)))}),pe(()=>(e(d),e(D),e(R),e(L),e(S)),()=>{v(A,e(d).length>0&&e(D)&&e(R).length>0?e(d).flatMap(P=>e(R).map(Z=>{const se=_i(ot(Z),ot(P),e(L),e(S));return{sourceId:Z.id,source:Z,targetId:P.id,target:P,canSee:se.canSee,firstClearRay:se.firstClearRay,rays:se.rays}})):[])}),Ra(),Zn();var $e=Yh(),ze=x($e),Yt=x(ze),Kt=x(Yt);cn(Kt,{title:"Selected Model",children:(P,Z)=>{var se=xt(),Pe=_e(se);{var Oe=He=>{var et=ih(),vt=x(et),en=b(x(vt),2),Ft=x(en),At=b(vt,2),jt=x(At),on=x(jt),Sn=b(At,2);{var dn=Gt=>{var yn=rh(),vn=_e(yn),En=x(vn),kn=x(En),hn=b(vn,2);{var Ke=q=>{var gt=sh(),bt=b(x(gt),2),z=x(bt);U(Se=>Re(z,`${Se??""}/${e(A),c(()=>e(A).length)??""} visible`),[()=>(e(A),c(()=>e(A).filter(Se=>Se.canSee).length))]),k(q,gt)};te(hn,q=>{e(A),c(()=>e(A).length>0)&&q(Ke)})}Cn(kn,()=>e(C),q=>v(C,q)),k(Gt,yn)};te(Sn,Gt=>{e(D)&&Gt(dn)})}var tn=b(Sn,2),Et=x(tn);U(()=>{Re(Ft,`${e($),c(()=>e($).length)??""} models`),Re(Et,`Remove All (${e($),c(()=>e($).length)??""})`)}),Cn(on,()=>e(D),Gt=>v(D,Gt)),V("click",tn,Ee),k(He,et)},We=He=>{var et=xt(),vt=_e(et);{var en=At=>{var jt=uh(),on=x(jt),Sn=b(x(on),2),dn=b(on,2),tn=b(x(dn),2),Et=x(tn),Gt=b(dn,2),yn=b(x(Gt),2),vn=x(yn),En=b(Gt,2),kn=b(x(En),2),hn=x(kn),Ke=b(En,2);{var q=je=>{var w=oh(),O=b(x(w),2),H=x(O);U(Q=>Re(H,`${Q??""}Â°`),[()=>(e(p),c(()=>Math.round(e(p).rotation||0)))]),k(je,w)};te(Ke,je=>{J(bn),e(p),c(()=>bn(e(p).baseType))&&je(q)})}var gt=b(Ke,2),bt=x(gt),z=x(bt),Se=b(gt,2);{var zt=je=>{var w=lh(),O=x(w),H=x(O);Cn(H,()=>e(C),Q=>v(C,Q)),k(je,w)};te(Se,je=>{e(D)&&je(zt)})}var nn=b(Se,2);{var pt=je=>{var w=ch(),O=b(x(w),2),H=x(O);U(Q=>Re(H,`${Q??""}/${e(A),c(()=>e(A).length)??""} visible`),[()=>(e(A),c(()=>e(A).filter(Q=>Q.canSee).length))]),k(je,w)};te(nn,je=>{e(D),e(A),c(()=>e(D)&&e(A).length>0)&&je(pt)})}var Tt=b(nn,2);U((je,w,O)=>{Uo(Sn,(e(p),c(()=>e(p).name||""))),Re(Et,je),Re(vn,`Player ${e(p),c(()=>e(p).playerId)??""}`),Re(hn,`${w??""}", ${O??""}"`)},[()=>(J(In),e(p),c(()=>In(e(p).baseType,e(p))?.label||"Unknown")),()=>(e(p),c(()=>e(p).x.toFixed(1))),()=>(e(p),c(()=>e(p).y.toFixed(1)))]),V("change",Sn,je=>Y(e(p).id,je.target.value)),Cn(z,()=>e(D),je=>v(D,je)),V("click",Tt,Ee),k(At,jt)},Ft=At=>{var jt=mh();k(At,jt)};te(vt,At=>{e(p)?At(en):At(Ft,!1)},!0)}k(He,et)};te(Pe,He=>{e($),c(()=>e($).length>1)?He(Oe):He(We,!1)})}k(P,se)},$$slots:{default:!0}});var qt=b(Kt,2);cn(qt,{title:"Measure Tool",children:(P,Z)=>{var se=ph(),Pe=x(se),Oe=x(Pe),We=x(Oe),He=b(Pe,2);{var et=Et=>{var Gt=dh();k(Et,Gt)};te(He,Et=>{e(ke)&&Et(et)})}var vt=b(He,2);{var en=Et=>{var Gt=hh(),yn=_e(Gt),vn=b(x(yn),2),En=x(vn),kn=b(yn,2);U(hn=>Re(En,`${hn??""}"`),[()=>(e(T),c(()=>Qe(e(T).x1,e(T).y1,e(T).x2,e(T).y2).toFixed(2)))]),V("click",kn,()=>{v(K,e(K).filter(hn=>hn.id!==e(j))),v(j,null)}),k(Et,Gt)};te(vt,Et=>{e(T)&&Et(en)})}var Ft=b(vt,2);{var At=Et=>{var Gt=fh(),yn=_e(Gt),vn=b(x(yn),2),En=x(vn),kn=b(yn,2);U(()=>Re(En,`${e(K),c(()=>e(K).length)??""} line${e(K),c(()=>e(K).length!==1?"s":"")??""}`)),V("click",kn,Vt),k(Et,Gt)};te(Ft,Et=>{e(K),c(()=>e(K).length>0)&&Et(At)})}var jt=b(Ft,2),on=b(x(jt),2),Sn=x(on),dn=b(on,2),tn=x(dn);Cn(We,()=>e(ke),Et=>v(ke,Et)),Cn(Sn,()=>e(dt),Et=>v(dt,Et)),Cn(tn,()=>e(fe),Et=>v(fe,Et)),k(P,se)},$$slots:{default:!0}});var ya=b(qt,2);cn(ya,{title:"Actions",children:(P,Z)=>{var se=yh(),Pe=x(se),Oe=x(Pe),We=b(Oe,2),He=b(Pe,2);U(()=>{Oe.disabled=(i(),c(()=>!i().past.length)),We.disabled=(i(),c(()=>!i().future.length))}),V("click",Oe,()=>ht.undo()),V("click",We,()=>ht.redo()),V("click",He,ae),k(P,se)},$$slots:{default:!0}});var va=b(Yt,2),ga=x(va),ra=x(ga),rs=x(ra);mr(rs,{children:$r,$$slots:{default:(P,Z)=>{const se=Ie(()=>Z.screenToSvg);var Pe=Wh(),Oe=_e(Pe);{var We=Ke=>{var q=bi();U(()=>Re(q,(e(M),J(e(se)),c(()=>(v(M,e(se)),""))))),k(Ke,q)};te(Oe,Ke=>{e(se)&&!e(M)&&Ke(We)})}var He=b(Oe);{var et=Ke=>{var q=bh(),gt=_e(q);Ye(gt,1,()=>(s(),c(()=>s().zones)),lt,(z,Se)=>{var zt=vh();U(nn=>{f(zt,"d",nn),f(zt,"stroke",(e(Se),c(()=>e(Se).borderColor)))},[()=>(J(Hs),e(Se),c(()=>Hs(e(Se).path)))]),k(z,zt)});var bt=b(gt);Ye(bt,1,()=>(s(),c(()=>s().objectives)),lt,(z,Se)=>{const zt=Ie(()=>(e(Se),c(()=>e(Se).isPrimary?"#fbbf24":"#9ca3af"))),nn=Ie(()=>(e(Se),c(()=>e(Se).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var pt=gh(),Tt=_e(pt),je=b(Tt),w=b(je);U(()=>{f(Tt,"cx",(e(Se),c(()=>e(Se).x))),f(Tt,"cy",(e(Se),c(()=>e(Se).y))),f(Tt,"r",Hr),f(Tt,"fill",e(nn)),f(Tt,"stroke",e(zt)),f(je,"cx",(e(Se),c(()=>e(Se).x))),f(je,"cy",(e(Se),c(()=>e(Se).y))),f(je,"r",Yr),f(je,"fill",e(zt)),f(w,"cx",(e(Se),c(()=>e(Se).x))),f(w,"cy",(e(Se),c(()=>e(Se).y)))}),k(z,pt)}),k(Ke,q)};te(He,Ke=>{s()&&Ke(et)})}var vt=b(He);Ye(vt,1,()=>(a(),c(()=>a().terrains)),lt,(Ke,q)=>{var gt=Th(),bt=x(gt);U(()=>{f(gt,"transform",`rotate(${e(q),c(()=>e(q).rotation)??""}, ${e(q),c(()=>e(q).x+e(q).width/2)??""}, ${e(q),c(()=>e(q).y+e(q).height/2)??""})`),f(bt,"x",(e(q),c(()=>e(q).x))),f(bt,"y",(e(q),c(()=>e(q).y))),f(bt,"width",(e(q),c(()=>e(q).width))),f(bt,"height",(e(q),c(()=>e(q).height)))}),k(Ke,gt)});var en=b(vt);Ye(en,1,()=>(a(),c(()=>a().walls)),lt,(Ke,q)=>{var gt=xh(),bt=x(gt);Wr(bt,{get id(){return e(q),c(()=>e(q).id)},get x(){return e(q),c(()=>e(q).x)},get y(){return e(q),c(()=>e(q).y)},get shape(){return e(q),c(()=>e(q).shape)},get segments(){return e(q),c(()=>e(q).segments)},get rotation(){return e(q),c(()=>e(q).rotation)},selected:!1,get screenToSvg(){return e(se)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),k(Ke,gt)});var Ft=b(en);{var At=Ke=>{var q=xt(),gt=_e(q);Ye(gt,1,r,bt=>bt.id,(bt,z)=>{const Se=Ie(()=>(J(In),e(z),c(()=>In(e(z).baseType,e(z))))),zt=Ie(()=>(J(bn),e(z),c(()=>bn(e(z).baseType)))),nn=Ie(()=>(J(fa),e(z),c(()=>fa(e(z).baseType)))),pt=Ie(()=>(e(z),c(()=>e(z).playerId===1?"rgba(59, 130, 246, 0.15)":"rgba(239, 68, 68, 0.15)"))),Tt=Ie(()=>(e(z),c(()=>e(z).playerId===1?"#3b82f6":"#ef4444")));var je=kh(),w=_e(je);{var O=ie=>{var ce=xt(),me=_e(ce);{var Ae=Ze=>{var tt=_h(),it=x(tt);U(()=>{f(tt,"transform",`rotate(${e(z),c(()=>e(z).rotation||0)??""}, ${e(z),c(()=>e(z).x)??""}, ${e(z),c(()=>e(z).y)??""})`),f(it,"x",(e(z),c(()=>e(z).x-e(z).customWidth/2-9))),f(it,"y",(e(z),c(()=>e(z).y-e(z).customHeight/2-9))),f(it,"width",(e(z),c(()=>e(z).customWidth+18))),f(it,"height",(e(z),c(()=>e(z).customHeight+18))),f(it,"fill",e(pt)),f(it,"stroke",e(Tt))}),k(Ze,tt)},qe=Ze=>{var tt=xt(),it=_e(tt);{var Zt=$t=>{var Rt=wh(),sn=x(Rt);U(()=>{f(Rt,"transform",`rotate(${e(z),c(()=>e(z).rotation||0)??""}, ${e(z),c(()=>e(z).x)??""}, ${e(z),c(()=>e(z).y)??""})`),f(sn,"cx",(e(z),c(()=>e(z).x))),f(sn,"cy",(e(z),c(()=>e(z).y))),f(sn,"rx",(J(e(Se)),c(()=>e(Se).width/2+9))),f(sn,"ry",(J(e(Se)),c(()=>e(Se).height/2+9))),f(sn,"fill",e(pt)),f(sn,"stroke",e(Tt))}),k($t,Rt)},an=$t=>{var Rt=Sh();U(()=>{f(Rt,"cx",(e(z),c(()=>e(z).x))),f(Rt,"cy",(e(z),c(()=>e(z).y))),f(Rt,"r",(J(e(Se)),c(()=>e(Se).radius+9))),f(Rt,"fill",e(pt)),f(Rt,"stroke",e(Tt))}),k($t,Rt)};te(it,$t=>{e(zt)?$t(Zt):$t(an,!1)},!0)}k(Ze,tt)};te(me,Ze=>{e(nn)?Ze(Ae):Ze(qe,!1)})}k(ie,ce)};te(w,ie=>{e(fe)&&ie(O)})}var H=b(w);{var Q=ie=>{var ce=xt(),me=_e(ce);{var Ae=Ze=>{var tt=Ah(),it=x(tt);U(()=>{f(tt,"transform",`rotate(${e(z),c(()=>e(z).rotation||0)??""}, ${e(z),c(()=>e(z).x)??""}, ${e(z),c(()=>e(z).y)??""})`),f(it,"x",(e(z),c(()=>e(z).x-e(z).customWidth/2-6))),f(it,"y",(e(z),c(()=>e(z).y-e(z).customHeight/2-6))),f(it,"width",(e(z),c(()=>e(z).customWidth+12))),f(it,"height",(e(z),c(()=>e(z).customHeight+12))),f(it,"stroke",e(Tt))}),k(Ze,tt)},qe=Ze=>{var tt=xt(),it=_e(tt);{var Zt=$t=>{var Rt=Ch(),sn=x(Rt);U(()=>{f(Rt,"transform",`rotate(${e(z),c(()=>e(z).rotation||0)??""}, ${e(z),c(()=>e(z).x)??""}, ${e(z),c(()=>e(z).y)??""})`),f(sn,"cx",(e(z),c(()=>e(z).x))),f(sn,"cy",(e(z),c(()=>e(z).y))),f(sn,"rx",(J(e(Se)),c(()=>e(Se).width/2+6))),f(sn,"ry",(J(e(Se)),c(()=>e(Se).height/2+6))),f(sn,"stroke",e(Tt))}),k($t,Rt)},an=$t=>{var Rt=Eh();U(()=>{f(Rt,"cx",(e(z),c(()=>e(z).x))),f(Rt,"cy",(e(z),c(()=>e(z).y))),f(Rt,"r",(J(e(Se)),c(()=>e(Se).radius+6))),f(Rt,"stroke",e(Tt))}),k($t,Rt)};te(it,$t=>{e(zt)?$t(Zt):$t(an,!1)},!0)}k(Ze,tt)};te(me,Ze=>{e(nn)?Ze(Ae):Ze(qe,!1)})}k(ie,ce)};te(H,ie=>{e(dt)&&ie(Q)})}k(bt,je)}),k(Ke,q)};te(Ft,Ke=>{(e(dt)||e(fe))&&Ke(At)})}var jt=b(Ft);Ye(jt,1,r,Ke=>Ke.id,(Ke,q)=>{{let gt=Ie(()=>(e(q),c(()=>e(q).name||""))),bt=Ie(()=>(e($),e(q),c(()=>e($).includes(e(q).id)))),z=Ie(()=>(e($),e(q),c(()=>e($).length>1&&e($).includes(e(q).id)))),Se=Ie(()=>(e($),e(q),e(he),c(()=>!e($).includes(e(q).id)&&e(he).has(e(q).id))));rr(Ke,{get id(){return e(q),c(()=>e(q).id)},get x(){return e(q),c(()=>e(q).x)},get y(){return e(q),c(()=>e(q).y)},get baseType(){return e(q),c(()=>e(q).baseType)},get playerId(){return e(q),c(()=>e(q).playerId)},get rotation(){return e(q),c(()=>e(q).rotation)},get name(){return e(gt)},get customWidth(){return e(q),c(()=>e(q).customWidth)},get customHeight(){return e(q),c(()=>e(q).customHeight)},get selected(){return e(bt)},get inGroupSelection(){return e(z)},get marqueePreview(){return e(Se)},get screenToSvg(){return e(se)},onSelect:Ne,onDrag:Je,onDragEnd:rt,onRotate:St,onRotateEnd:Ut,onRename:Y})}});var on=b(jt);{var Sn=Ke=>{var q=Mh(),gt=_e(q),bt=b(gt),z=b(bt),Se=b(z);U(()=>{f(gt,"cx",(e(u),c(()=>e(u).x))),f(gt,"cy",(e(u),c(()=>e(u).y))),f(bt,"x1",(e(u),c(()=>e(u).x))),f(bt,"y1",(e(u),c(()=>e(u).y))),f(bt,"x2",e(g)),f(bt,"y2",e(_)),f(z,"cx",e(g)),f(z,"cy",e(_)),f(Se,"transform",`translate(${e(g)??""}, ${e(_)??""})`)}),V("mousedown",z,B),k(Ke,q)};te(on,Ke=>{e(u),e(d),c(()=>e(u)&&e(d).length>1)&&Ke(Sn)})}var dn=b(on);Ye(dn,1,()=>e(K),Ke=>Ke.id,(Ke,q)=>{const gt=Ie(()=>(e(q),c(()=>Qe(e(q).x1,e(q).y1,e(q).x2,e(q).y2)))),bt=Ie(()=>(e(q),c(()=>(e(q).x1+e(q).x2)/2))),z=Ie(()=>(e(q),c(()=>(e(q).y1+e(q).y2)/2))),Se=Ie(()=>(e(q),e(j),c(()=>e(q).id===e(j))));var zt=Lh();let nn;var pt=x(zt),Tt=b(pt);{var je=Q=>{var ie=Rh(),ce=_e(ie),me=b(ce);U(()=>{f(ce,"cx",(e(q),c(()=>e(q).x1))),f(ce,"cy",(e(q),c(()=>e(q).y1))),f(ce,"fill",e(Se)?"#3b82f6":"#f59e0b"),f(me,"cx",(e(q),c(()=>e(q).x2))),f(me,"cy",(e(q),c(()=>e(q).y2))),f(me,"fill",e(Se)?"#3b82f6":"#f59e0b")}),V("mousedown",ce,Ae=>It(e(q).id,1,Ae)),V("mousedown",me,Ae=>It(e(q).id,2,Ae)),k(Q,ie)};te(Tt,Q=>{e(ke)&&Q(je)})}var w=b(Tt),O=b(x(w)),H=x(O);U(Q=>{nn=Tn(zt,0,"measurement-line",null,nn,{selected:e(Se),"tool-active":e(ke)}),f(pt,"x1",(e(q),c(()=>e(q).x1))),f(pt,"y1",(e(q),c(()=>e(q).y1))),f(pt,"x2",(e(q),c(()=>e(q).x2))),f(pt,"y2",(e(q),c(()=>e(q).y2))),f(pt,"stroke",e(Se)&&e(ke)?"#3b82f6":"#f59e0b"),f(pt,"stroke-width",e(Se)&&e(ke)?.2:.15),f(pt,"role",e(ke)?"button":"presentation"),f(pt,"tabindex",e(ke)?0:-1),f(w,"transform",`translate(${e(bt)??""}, ${e(z)??""})`),f(O,"fill",e(Se)&&e(ke)?"#3b82f6":"#f59e0b"),Re(H,`${Q??""}"`)},[()=>(J(e(gt)),c(()=>e(gt).toFixed(1)))]),V("click",pt,Q=>e(ke)&&yt(e(q).id,Q)),V("mousedown",pt,Q=>e(ke)?Ge(e(q).id,Q):Q.stopPropagation()),k(Ke,zt)});var tn=b(dn);{var Et=Ke=>{const q=Ie(()=>(e(W),e(ye),c(()=>Qe(e(W).x,e(W).y,e(ye).x,e(ye).y)))),gt=Ie(()=>(e(W),e(ye),c(()=>(e(W).x+e(ye).x)/2))),bt=Ie(()=>(e(W),e(ye),c(()=>(e(W).y+e(ye).y)/2)));var z=Ih(),Se=x(z),zt=b(Se),nn=b(zt),pt=b(nn);{var Tt=je=>{var w=Dh(),O=b(x(w)),H=x(O);U(Q=>{f(w,"transform",`translate(${e(gt)??""}, ${e(bt)??""})`),Re(H,`${Q??""}"`)},[()=>(J(e(q)),c(()=>e(q).toFixed(1)))]),k(je,w)};te(pt,je=>{e(q)>.5&&je(Tt)})}U(()=>{f(Se,"x1",(e(W),c(()=>e(W).x))),f(Se,"y1",(e(W),c(()=>e(W).y))),f(Se,"x2",(e(ye),c(()=>e(ye).x))),f(Se,"y2",(e(ye),c(()=>e(ye).y))),f(zt,"cx",(e(W),c(()=>e(W).x))),f(zt,"cy",(e(W),c(()=>e(W).y))),f(nn,"cx",(e(ye),c(()=>e(ye).x))),f(nn,"cy",(e(ye),c(()=>e(ye).y)))}),k(Ke,z)};te(tn,Ke=>{e(xe)&&e(W)&&e(ye)&&Ke(Et)})}var Gt=b(tn);{var yn=Ke=>{var q=xt(),gt=_e(q);Ye(gt,1,()=>e(A),lt,(bt,z)=>{var Se=xt(),zt=_e(Se);Ye(zt,1,()=>(e(z),c(()=>e(z).rays)),lt,(nn,pt)=>{var Tt=$h();U(()=>{f(Tt,"x1",(e(pt),c(()=>e(pt).from.x))),f(Tt,"y1",(e(pt),c(()=>e(pt).from.y))),f(Tt,"x2",(e(pt),c(()=>e(pt).to.x))),f(Tt,"y2",(e(pt),c(()=>e(pt).to.y))),f(Tt,"stroke",(e(pt),c(()=>e(pt).blocked?"#ff000033":"#00ff0033")))}),k(nn,Tt)}),k(bt,Se)}),k(Ke,q)};te(Gt,Ke=>{e(C),e(D),e(d),e(A),c(()=>e(C)&&e(D)&&e(d).length>0&&e(A).length>0)&&Ke(yn)})}var vn=b(Gt);{var En=Ke=>{var q=xt(),gt=_e(q);Ye(gt,1,()=>e(A),lt,(bt,z)=>{var Se=xt(),zt=_e(Se);{var nn=Tt=>{var je=Ph();U(()=>{f(je,"x1",(e(z),c(()=>e(z).firstClearRay.from.x))),f(je,"y1",(e(z),c(()=>e(z).firstClearRay.from.y))),f(je,"x2",(e(z),c(()=>e(z).firstClearRay.to.x))),f(je,"y2",(e(z),c(()=>e(z).firstClearRay.to.y)))}),k(Tt,je)},pt=Tt=>{var je=Nh();U(()=>{f(je,"x1",(e(z),c(()=>e(z).source.x))),f(je,"y1",(e(z),c(()=>e(z).source.y))),f(je,"x2",(e(z),c(()=>e(z).target.x))),f(je,"y2",(e(z),c(()=>e(z).target.y)))}),k(Tt,je)};te(zt,Tt=>{e(z),c(()=>e(z).firstClearRay)?Tt(nn):Tt(pt,!1)})}k(bt,Se)}),k(Ke,q)};te(vn,Ke=>{e(D),e(d),e(A),c(()=>e(D)&&e(d).length>0&&e(A).length>0)&&Ke(En)})}var kn=b(vn);{var hn=Ke=>{const q=Ie(()=>(e(F),e(le),c(()=>Math.min(e(F).x,e(le).x)))),gt=Ie(()=>(e(F),e(le),c(()=>Math.min(e(F).y,e(le).y)))),bt=Ie(()=>(e(le),e(F),c(()=>Math.abs(e(le).x-e(F).x)))),z=Ie(()=>(e(le),e(F),c(()=>Math.abs(e(le).y-e(F).y))));var Se=Oh();U(()=>{f(Se,"x",e(q)),f(Se,"y",e(gt)),f(Se,"width",e(bt)),f(Se,"height",e(z))}),k(Ke,Se)};te(kn,Ke=>{e(I)&&e(F)&&e(le)&&Ke(hn)})}k(P,Pe)}}});var wn=b(ra,2),Qn=x(wn),Bn=x(Qn);U(()=>Re(Bn,`Battlefield: 60" x 44" | ${o(),c(()=>o().length)??""} P1 models | ${l(),c(()=>l().length)??""} P2 models`)),V("mousedown",ra,Pn),k(t,$e),Fn(),h()}var Fh=ve("<span> </span>"),Bh=ve('<span class="los-status svelte-12aohay">No enemies</span>'),qh=ve('<div class="controls svelte-12aohay"><label class="svelte-12aohay"><input type="checkbox" class="svelte-12aohay"/> Show debug rays</label> <!> <button class="export-btn svelte-12aohay">Export PNG</button></div>'),Uh=ve('<button class="svelte-12aohay"> </button>'),Kh=ve('<div class="button-group svelte-12aohay"></div>'),Gh=ve('<button class="svelte-12aohay"> </button>'),zh=ve('<div class="button-group svelte-12aohay"></div>'),Xh=ve('<div class="player-toggle svelte-12aohay"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-12aohay"><div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Circles</h4> <div class="palette-grid svelte-12aohay"></div></div> <div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Ovals</h4> <div class="palette-grid svelte-12aohay"></div></div></div>',1),Vh=ge('<line stroke-width="0.05"></line>'),jh=ge('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),Zh=ge('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),Qh=ge("<!><!><!><!><!><!><!>",1),Jh=ve('<p class="svelte-12aohay"> </p>'),ef=ve('<main class="svelte-12aohay"><div class="layout svelte-12aohay"><div class="sidebar svelte-12aohay"><!> <!> <!> <!></div> <div class="battlefield-area svelte-12aohay"><div class="battlefield-container svelte-12aohay"><!></div> <div class="info svelte-12aohay"><p class="svelte-12aohay"> </p> <!> <p class="hint svelte-12aohay">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function tf(t,n){Hn(n,!1);const a=()=>Dt(ja,"$debugModels",h),r=()=>Dt(us,"$debugSelectedModelId",h),s=()=>Dt(vr,"$debugTerrains",h),i=()=>Dt(gr,"$debugWalls",h),o=()=>Dt(Ki,"$debugMode",h),l=()=>Dt(br,"$debugSelectedTerrainId",h),m=()=>Dt(Tr,"$debugSelectedWallId",h),[h,d]=Gs(),p=N(),u=N(),y=N(),g=N(),_=N();function T(oe,De){vr.add(oe,De)}function E(oe){gr.add(oe)}function R(oe){br.set(oe),Tr.set(null),us.set(null)}function L(oe){Tr.set(oe),br.set(null),us.set(null)}function S(oe,De,Ge){vr.updateTerrain(oe,{x:De,y:Ge})}function A(oe,De,Ge){gr.updateWall(oe,{x:De,y:Ge})}function M(oe,De){vr.updateTerrain(oe,{rotation:De})}function D(oe,De){gr.updateWall(oe,{rotation:De})}let C=N(1),I=N(null),F=!1,le=null,$=N(null);const he=5;ws(()=>{if(a().length===0){const oe=ja.add("32mm",1,10,22);ja.add("32mm",2,50,22),us.set(oe)}});function we(oe,De){if(!e($))return;F=!0,le={x:De.clientX,y:De.clientY};const Ge=e($)(De.clientX,De.clientY);v(I,{baseType:oe.type,x:Ge.x,y:Ge.y}),window.addEventListener("mousemove",ne),window.addEventListener("mouseup",re)}function ne(oe){if(!F||!e(I)||!e($))return;const De=e($)(oe.clientX,oe.clientY);v(I,{...e(I),x:De.x,y:De.y})}function re(oe){if(!F||!e(I)){F=!1,v(I,null),le=null,window.removeEventListener("mousemove",ne),window.removeEventListener("mouseup",re);return}const De=oe.clientX-le.x,Ge=oe.clientY-le.y,It=Math.sqrt(De*De+Ge*Ge);let _t,Ot;It<he?(_t=30,Ot=22):(_t=e(I).x,Ot=e(I).y);const Vt=ja.add(e(I).baseType,e(C),_t,Ot);us.set(Vt),v(I,null),F=!1,le=null,window.removeEventListener("mousemove",ne),window.removeEventListener("mouseup",re)}function ue(oe){us.set(oe),br.set(null),Tr.set(null)}function be(oe,De,Ge){ja.updateModel(oe,{x:De,y:Ge},!0)}function Le(oe,De,Ge,It,_t){ri.push({type:"move",modelId:oe,before:{x:De,y:Ge},after:{x:It,y:_t}})}function ee(oe,De){ja.updateModel(oe,{rotation:De},!0)}function K(oe,De,Ge){ri.push({type:"rotate",modelId:oe,before:{rotation:De},after:{rotation:Ge}})}function j(oe,De){ja.updateModel(oe,{name:De})}function xe(oe){const De=In(oe.baseType);return bn(oe.baseType)?{x:oe.x,y:oe.y,rx:De.width/2,ry:De.height/2,rotation:oe.rotation||0}:{x:oe.x,y:oe.y,radius:De.radius}}async function W(){const De=`battlefield-debug-${new Date().toISOString().slice(0,10)}`;try{await Ai(s(),i(),a(),De)}catch(Ge){alert("Failed to export PNG"),console.error("Export error:",Ge)}}pe(()=>(a(),r()),()=>{v(p,a().find(oe=>oe.id===r()))}),pe(()=>(e(p),a()),()=>{v(u,e(p)?a().filter(oe=>oe.playerId!==e(p).playerId):[])}),pe(()=>(s(),xs),()=>{v(y,s().map(oe=>({id:oe.id,vertices:xs(oe)})))}),pe(()=>(i(),qa),()=>{v(g,i().map(oe=>dr(qa(oe.shape,oe.segments),oe.x,oe.y,oe.rotation)))}),pe(()=>(e(p),e(u),e(y),e(g)),()=>{v(_,e(p)&&e(u).length>0?e(u).map(oe=>{const De=_i(xe(oe),xe(e(p)),e(y),e(g));return{viewerId:oe.id,viewer:oe,canSee:De.canSee,firstClearRay:De.firstClearRay,rays:De.rays}}):[])}),Ra(),Zn();var ye=ef(),ke=x(ye),dt=x(ke),fe=x(dt);cn(fe,{title:"LOS Debug",children:(oe,De)=>{var Ge=qh(),It=x(Ge),_t=x(It),Ot=b(It,2);{var Vt=Jt=>{var Ne=Fh();let Je;var rt=x(Ne);U((St,Ut)=>{Je=Tn(Ne,1,"los-status svelte-12aohay",null,Je,St),Re(rt,`${Ut??""}/${e(_),c(()=>e(_).length)??""} visible`)},[()=>({"can-see":e(_).some(St=>St.canSee),blocked:!e(_).some(St=>St.canSee)}),()=>(e(_),c(()=>e(_).filter(St=>St.canSee).length))]),k(Jt,Ne)},Pn=Jt=>{var Ne=Bh();k(Jt,Ne)};te(Ot,Jt=>{e(p),e(_),c(()=>e(p)&&e(_).length>0)?Jt(Vt):Jt(Pn,!1)})}var pn=b(Ot,2);Cn(_t,o,Jt=>Wc(Ki,Jt)),V("click",pn,W),k(oe,Ge)},$$slots:{default:!0}});var ae=b(fe,2);cn(ae,{title:"Add Terrain",defaultOpen:!1,children:(oe,De)=>{var Ge=Kh();Ye(Ge,5,()=>Qo,lt,(It,_t)=>{var Ot=Uh(),Vt=x(Ot);U(()=>Re(Vt,(e(_t),c(()=>e(_t).label)))),V("click",Ot,()=>T(e(_t).width,e(_t).height)),k(It,Ot)}),k(oe,Ge)},$$slots:{default:!0}});var Fe=b(ae,2);cn(Fe,{title:"Add Wall",defaultOpen:!1,children:(oe,De)=>{var Ge=zh();Ye(Ge,5,()=>ai,lt,(It,_t)=>{var Ot=Gh(),Vt=x(Ot);U(()=>Re(Vt,(e(_t),c(()=>e(_t).label)))),V("click",Ot,()=>E(e(_t).shape)),k(It,Ot)}),k(oe,Ge)},$$slots:{default:!0}});var Ce=b(Fe,2);cn(Ce,{title:"Add Models",defaultOpen:!1,children:(oe,De)=>{var Ge=Xh(),It=_e(Ge),_t=x(It);let Ot;var Vt=b(_t,2);let Pn;var pn=b(It,2),Jt=x(pn),Ne=b(x(Jt),2);Ye(Ne,5,()=>(J(Vn),c(()=>Vn.circles)),lt,(St,Ut)=>{Dr(St,{get baseSize(){return e(Ut)},get playerId(){return e(C)},onDragStart:we})});var Je=b(Jt,2),rt=b(x(Je),2);Ye(rt,5,()=>(J(Vn),c(()=>Vn.ovals)),lt,(St,Ut)=>{Dr(St,{get baseSize(){return e(Ut)},get playerId(){return e(C)},onDragStart:we})}),U(()=>{Ot=Tn(_t,1,"toggle-btn svelte-12aohay",null,Ot,{active:e(C)===1}),Pn=Tn(Vt,1,"toggle-btn svelte-12aohay",null,Pn,{active:e(C)===2})}),V("click",_t,()=>v(C,1)),V("click",Vt,()=>v(C,2)),k(oe,Ge)},$$slots:{default:!0}});var Bt=b(dt,2),Qe=x(Bt),st=x(Qe);mr(st,{children:$r,$$slots:{default:(oe,De)=>{const Ge=Ie(()=>De.screenToSvg);var It=Qh(),_t=_e(It);{var Ot=Y=>{var B=bi();U(()=>Re(B,(e($),J(e(Ge)),c(()=>(v($,e(Ge)),""))))),k(Y,B)};te(_t,Y=>{e(Ge)&&!e($)&&Y(Ot)})}var Vt=b(_t);{var Pn=Y=>{var B=xt(),Te=_e(B);Ye(Te,1,()=>e(_),lt,(Be,Ee)=>{var ot=xt(),at=_e(ot);Ye(at,1,()=>(e(Ee),c(()=>e(Ee).rays)),lt,($e,ze)=>{var Yt=Vh();U(()=>{f(Yt,"x1",(e(ze),c(()=>e(ze).from.x))),f(Yt,"y1",(e(ze),c(()=>e(ze).from.y))),f(Yt,"x2",(e(ze),c(()=>e(ze).to.x))),f(Yt,"y2",(e(ze),c(()=>e(ze).to.y))),f(Yt,"stroke",(e(ze),c(()=>e(ze).blocked?"#ff000033":"#00ff0033")))}),k($e,Yt)}),k(Be,ot)}),k(Y,B)};te(Vt,Y=>{o(),e(p),e(_),c(()=>o()&&e(p)&&e(_).length>0)&&Y(Pn)})}var pn=b(Vt);Ye(pn,1,s,Y=>Y.id,(Y,B)=>{{let Te=Ie(()=>(e(B),l(),c(()=>e(B).id===l())));jo(Y,{get id(){return e(B),c(()=>e(B).id)},get x(){return e(B),c(()=>e(B).x)},get y(){return e(B),c(()=>e(B).y)},get width(){return e(B),c(()=>e(B).width)},get height(){return e(B),c(()=>e(B).height)},get rotation(){return e(B),c(()=>e(B).rotation)},get selected(){return e(Te)},get screenToSvg(){return e(Ge)},onSelect:R,onDrag:S,onRotate:M})}});var Jt=b(pn);Ye(Jt,1,i,Y=>Y.id,(Y,B)=>{{let Te=Ie(()=>(e(B),m(),c(()=>e(B).id===m())));Wr(Y,{get id(){return e(B),c(()=>e(B).id)},get x(){return e(B),c(()=>e(B).x)},get y(){return e(B),c(()=>e(B).y)},get shape(){return e(B),c(()=>e(B).shape)},get segments(){return e(B),c(()=>e(B).segments)},get rotation(){return e(B),c(()=>e(B).rotation)},get selected(){return e(Te)},get screenToSvg(){return e(Ge)},onSelect:L,onDrag:A,onRotate:D})}});var Ne=b(Jt);Ye(Ne,1,a,Y=>Y.id,(Y,B)=>{{let Te=Ie(()=>(e(B),c(()=>e(B).name||""))),Be=Ie(()=>(e(B),r(),c(()=>e(B).id===r())));rr(Y,{get id(){return e(B),c(()=>e(B).id)},get x(){return e(B),c(()=>e(B).x)},get y(){return e(B),c(()=>e(B).y)},get baseType(){return e(B),c(()=>e(B).baseType)},get playerId(){return e(B),c(()=>e(B).playerId)},get rotation(){return e(B),c(()=>e(B).rotation)},get name(){return e(Te)},get selected(){return e(Be)},get screenToSvg(){return e(Ge)},onSelect:ue,onDrag:be,onDragEnd:Le,onRotate:ee,onRotateEnd:K,onRename:j})}});var Je=b(Ne);{var rt=Y=>{var B=xt(),Te=_e(B);Ye(Te,1,()=>e(_),lt,(Be,Ee)=>{var ot=xt(),at=_e(ot);{var $e=Yt=>{var Kt=jh();U(()=>{f(Kt,"x1",(e(Ee),c(()=>e(Ee).firstClearRay.from.x))),f(Kt,"y1",(e(Ee),c(()=>e(Ee).firstClearRay.from.y))),f(Kt,"x2",(e(Ee),c(()=>e(Ee).firstClearRay.to.x))),f(Kt,"y2",(e(Ee),c(()=>e(Ee).firstClearRay.to.y)))}),k(Yt,Kt)},ze=Yt=>{var Kt=Zh();U(()=>{f(Kt,"x1",(e(p),c(()=>e(p).x))),f(Kt,"y1",(e(p),c(()=>e(p).y))),f(Kt,"x2",(e(Ee),c(()=>e(Ee).target.x))),f(Kt,"y2",(e(Ee),c(()=>e(Ee).target.y)))}),k(Yt,Kt)};te(at,Yt=>{e(Ee),c(()=>e(Ee).firstClearRay)?Yt($e):Yt(ze,!1)})}k(Be,ot)}),k(Y,B)};te(Je,Y=>{o(),e(p),e(_),c(()=>o()&&e(p)&&e(_).length>0)&&Y(rt)})}var St=b(Je);{var Ut=Y=>{rr(Y,{id:"phantom",get x(){return e(I),c(()=>e(I).x)},get y(){return e(I),c(()=>e(I).y)},get baseType(){return e(I),c(()=>e(I).baseType)},get playerId(){return e(C)},rotation:0,selected:!1,get screenToSvg(){return e(Ge)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};te(St,Y=>{e(I)&&Y(Ut)})}k(oe,It)}}});var ut=b(Qe,2),nt=x(ut),yt=x(nt),Mt=b(nt,2);{var un=oe=>{var De=Jh(),Ge=x(De);U(It=>Re(Ge,`Selected model LOS: ${It??""}/${e(_),c(()=>e(_).length)??""} visible`),[()=>(e(_),c(()=>e(_).filter(It=>It.canSee).length))]),k(oe,De)};te(Mt,oe=>{o(),e(p),e(_),c(()=>o()&&e(p)&&e(_).length>0)&&oe(un)})}U(()=>Re(yt,`Battlefield: 60" x 44" | ${s(),c(()=>s().length)??""} terrain | ${i(),c(()=>i().length)??""} walls | ${a(),c(()=>a().length)??""} models`)),k(t,ye),Fn(),d()}var nf=ve(`<div class="app-header svelte-1n46o8q"><h1 class="app-title svelte-1n46o8q">Fu'llasso</h1> <nav class="nav-links svelte-1n46o8q"><a href="#/setup">Battlefield Setup</a> <a href="#/deployment">Deployment</a> <a href="#/battle">Battle</a> <a href="#/">Layout Builder</a></nav></div> <!> <footer class="app-footer svelte-1n46o8q"><span>Built with love by <a href="https://github.com/barkin-aygun/wh40k-deploy" target="_blank" rel="noopener noreferrer" class="svelte-1n46o8q">@Volfied</a></span> <span class="separator svelte-1n46o8q">|</span> <span class="disclaimer svelte-1n46o8q">Warhammer 40,000 and all associated marks, logos, and images are trademarks and/or copyrights of Games Workshop Ltd. This is an unofficial fan project and is not affiliated with or endorsed by Games Workshop.</span></footer>`,1);function af(t,n){Hn(n,!1);let a=N("main");function r(){const R=window.location.hash;R==="#/debug"?v(a,"debug"):R==="#/setup"?v(a,"setup"):R==="#/deployment"?v(a,"deployment"):R==="#/battle"?v(a,"battle"):R==="#/"||R==="#/layout"?v(a,"main"):v(a,"setup")}ws(()=>(r(),window.addEventListener("hashchange",r),()=>window.removeEventListener("hashchange",r))),Zn();var s=nf(),i=_e(s),o=b(x(i),2),l=x(o);let m;var h=b(l,2);let d;var p=b(h,2);let u;var y=b(p,2);let g;var _=b(i,2);{var T=R=>{tf(R,{})},E=R=>{var L=xt(),S=_e(L);{var A=D=>{gm(D,{})},M=D=>{var C=xt(),I=_e(C);{var F=$=>{ah($,{})},le=$=>{var he=xt(),we=_e(he);{var ne=ue=>{Hh(ue,{})},re=ue=>{Ju(ue,{})};te(we,ue=>{e(a)==="battle"?ue(ne):ue(re,!1)},!0)}k($,he)};te(I,$=>{e(a)==="deployment"?$(F):$(le,!1)},!0)}k(D,C)};te(S,D=>{e(a)==="setup"?D(A):D(M,!1)},!0)}k(R,L)};te(_,R=>{e(a)==="debug"?R(T):R(E,!1)})}U(()=>{m=Tn(l,1,"svelte-1n46o8q",null,m,{active:e(a)==="setup"}),d=Tn(h,1,"svelte-1n46o8q",null,d,{active:e(a)==="deployment"}),u=Tn(p,1,"svelte-1n46o8q",null,u,{active:e(a)==="battle"}),g=Tn(y,1,"svelte-1n46o8q",null,g,{active:e(a)==="main"})}),k(t,s),Fn()}wc(af,{target:document.getElementById("app")});
//# sourceMappingURL=index-B3kV1RmO.js.map
