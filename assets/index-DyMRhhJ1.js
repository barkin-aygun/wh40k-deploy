(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();const si=!1;var zs=Array.isArray,kl=Array.prototype.indexOf,Xs=Array.from,ao=Object.defineProperty,yr=Object.getOwnPropertyDescriptor,ro=Object.getOwnPropertyDescriptors,Al=Object.prototype,Cl=Array.prototype,yi=Object.getPrototypeOf,Li=Object.isExtensible;const sr=()=>{};function El(t){return t()}function Os(t){for(var n=0;n<t.length;n++)t[n]()}function so(){var t,n,a=new Promise((s,r)=>{t=s,n=r});return{promise:a,resolve:t,reject:n}}const $n=2,Ws=4,bs=8,io=1<<24,ja=16,Ja=32,Ar=64,vi=128,ha=512,Ln=1024,Bn=2048,Ia=4096,sa=8192,Ka=16384,gi=32768,Ur=65536,$i=1<<17,oo=1<<18,Vr=1<<19,lo=1<<20,Ua=1<<25,Tr=32768,ii=1<<21,bi=1<<22,ir=1<<23,Ga=Symbol("$state"),Ml=Symbol("legacy props"),Rl=Symbol(""),Yr=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function co(){throw new Error("https://svelte.dev/e/invalid_default_snippet")}function Ti(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Dl(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Il(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ll(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function $l(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Pl(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Nl(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function Ol(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Wl(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Yl(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Hl(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Fl=1,Bl=2,uo=4,ql=8,Ul=16,Kl=1,Gl=2,zl=4,Xl=8,Vl=16,mo=1,jl=2,Dn=Symbol(),Jl="http://www.w3.org/1999/xhtml";function Zl(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Ql(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function ho(t){return t===this.v}function fo(t,n){return t!=t?n==n:t!==n||t!==null&&typeof t=="object"||typeof t=="function"}function po(t){return!fo(t,this.v)}let jr=!1,ec=!1;function tc(){jr=!0}let un=null;function Kr(t){un=t}function Vn(t,n=!1,a){un={p:un,i:!1,c:null,e:null,s:t,x:null,l:jr&&!n?{s:null,u:null,$:[]}:null}}function jn(t){var n=un,a=n.e;if(a!==null){n.e=null;for(var s of a)Io(s)}return t!==void 0&&(n.x=t),n.i=!0,un=n.p,t??{}}function Ts(){return!jr||un!==null&&un.l===null}let fr=[];function yo(){var t=fr;fr=[],Os(t)}function Jr(t){if(fr.length===0&&!hs){var n=fr;queueMicrotask(()=>{n===fr&&yo()})}fr.push(t)}function nc(){for(;fr.length>0;)yo()}function vo(t){var n=Zt;if(n===null)return Ot.f|=ir,t;if((n.f&gi)===0){if((n.f&vi)===0)throw t;n.b.error(t)}else Gr(t,n)}function Gr(t,n){for(;n!==null;){if((n.f&vi)!==0)try{n.b.error(t);return}catch(a){t=a}n=n.parent}throw t}const ac=-7169;function Cn(t,n){t.f=t.f&ac|n}function xi(t){(t.f&ha)!==0||t.deps===null?Cn(t,Ln):Cn(t,Ia)}function go(t){if(t!==null)for(const n of t)(n.f&$n)===0||(n.f&Tr)===0||(n.f^=Tr,go(n.deps))}function bo(t,n,a){(t.f&Bn)!==0?n.add(t):(t.f&Ia)!==0&&a.add(t),go(t.deps),Cn(t,Ln)}const As=new Set;let Vt=null,ms=null,Sa=null,ua=[],Vs=null,oi=!1,hs=!1;class Ma{committed=!1;current=new Map;previous=new Map;#t=new Set;#i=new Set;#e=0;#r=0;#s=null;#a=new Set;#n=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#r>0}process(n){ua=[],ms=null,this.apply();var a=[],s=[];for(const r of n)this.#o(r,a,s);this.is_fork||this.#c(),this.is_deferred()?(this.#l(s),this.#l(a)):(ms=this,Vt=null,Pi(s),Pi(a),ms=null,this.#s?.resolve()),Sa=null}#o(n,a,s){n.f^=Ln;for(var r=n.first,i=null;r!==null;){var l=r.f,c=(l&(Ja|Ar))!==0,d=c&&(l&Ln)!==0,h=d||(l&sa)!==0||this.skipped_effects.has(r);if(!h&&r.fn!==null){c?r.f^=Ln:i!==null&&(l&(Ws|bs|io))!==0?i.b.defer_effect(r):(l&Ws)!==0?a.push(r):Qr(r)&&((l&ja)!==0&&this.#a.add(r),zr(r));var y=r.first;if(y!==null){r=y;continue}}var p=r.parent;for(r=r.next;r===null&&p!==null;)p===i&&(i=null),r=p.next,p=p.parent}}#l(n){for(var a=0;a<n.length;a+=1)bo(n[a],this.#a,this.#n)}capture(n,a){a!==Dn&&!this.previous.has(n)&&this.previous.set(n,a),(n.f&ir)===0&&(this.current.set(n,n.v),Sa?.set(n,n.v))}activate(){Vt=this,this.apply()}deactivate(){Vt===this&&(Vt=null,Sa=null)}flush(){if(this.activate(),ua.length>0){if(To(),Vt!==null&&Vt!==this)return}else this.#e===0&&this.process([]);this.deactivate()}discard(){for(const n of this.#i)n(this);this.#i.clear()}#c(){if(this.#r===0){for(const n of this.#t)n();this.#t.clear()}this.#e===0&&this.#u()}#u(){if(As.size>1){this.previous.clear();var n=Sa,a=!0;for(const r of As){if(r===this){a=!1;continue}const i=[];for(const[c,d]of this.current){if(r.current.has(c))if(a&&d!==r.current.get(c))r.current.set(c,d);else continue;i.push(c)}if(i.length===0)continue;const l=[...r.current.keys()].filter(c=>!this.current.has(c));if(l.length>0){var s=ua;ua=[];const c=new Set,d=new Map;for(const h of i)xo(h,l,c,d);if(ua.length>0){Vt=r,r.apply();for(const h of ua)r.#o(h,[],[]);r.deactivate()}ua=s}}Vt=null,Sa=n}this.committed=!0,As.delete(this)}increment(n){this.#e+=1,n&&(this.#r+=1)}decrement(n){this.#e-=1,n&&(this.#r-=1),this.revive()}revive(){for(const n of this.#a)this.#n.delete(n),Cn(n,Bn),Va(n);for(const n of this.#n)Cn(n,Ia),Va(n);this.flush()}oncommit(n){this.#t.add(n)}ondiscard(n){this.#i.add(n)}settled(){return(this.#s??=so()).promise}static ensure(){if(Vt===null){const n=Vt=new Ma;As.add(Vt),hs||Ma.enqueue(()=>{Vt===n&&n.flush()})}return Vt}static enqueue(n){Jr(n)}apply(){}}function rc(t){var n=hs;hs=!0;try{for(var a;;){if(nc(),ua.length===0&&(Vt?.flush(),ua.length===0))return Vs=null,a;To()}}finally{hs=n}}function To(){var t=gr;oi=!0;var n=null;try{var a=0;for(Hs(!0);ua.length>0;){var s=Ma.ensure();if(a++>1e3){var r,i;sc()}s.process(ua),or.clear()}}finally{oi=!1,Hs(t),Vs=null}}function sc(){try{Pl()}catch(t){Gr(t,Vs)}}let Ya=null;function Pi(t){var n=t.length;if(n!==0){for(var a=0;a<n;){var s=t[a++];if((s.f&(Ka|sa))===0&&Qr(s)&&(Ya=new Set,zr(s),s.deps===null&&s.first===null&&s.nodes===null&&(s.teardown===null&&s.ac===null?No(s):s.fn=null),Ya?.size>0)){or.clear();for(const r of Ya){if((r.f&(Ka|sa))!==0)continue;const i=[r];let l=r.parent;for(;l!==null;)Ya.has(l)&&(Ya.delete(l),i.push(l)),l=l.parent;for(let c=i.length-1;c>=0;c--){const d=i[c];(d.f&(Ka|sa))===0&&zr(d)}}Ya.clear()}}Ya=null}}function xo(t,n,a,s){if(!a.has(t)&&(a.add(t),t.reactions!==null))for(const r of t.reactions){const i=r.f;(i&$n)!==0?xo(r,n,a,s):(i&(bi|ja))!==0&&(i&Bn)===0&&_o(r,n,s)&&(Cn(r,Bn),Va(r))}}function _o(t,n,a){const s=a.get(t);if(s!==void 0)return s;if(t.deps!==null)for(const r of t.deps){if(n.includes(r))return!0;if((r.f&$n)!==0&&_o(r,n,a))return a.set(r,!0),!0}return a.set(t,!1),!1}function Va(t){for(var n=Vs=t;n.parent!==null;){n=n.parent;var a=n.f;if(oi&&n===Zt&&(a&ja)!==0&&(a&oo)===0)return;if((a&(Ar|Ja))!==0){if((a&Ln)===0)return;n.f^=Ln}}ua.push(n)}function ic(t){let n=0,a=xr(0),s;return()=>{Si()&&(e(a),Zr(()=>(n===0&&(s=o(()=>t(()=>fs(a)))),n+=1,()=>{Jr(()=>{n-=1,n===0&&(s?.(),s=void 0,fs(a))})})))}}var oc=Ur|Vr|vi;function lc(t,n,a){new cc(t,n,a)}class cc{parent;is_pending=!1;#t;#i=null;#e;#r;#s;#a=null;#n=null;#o=null;#l=null;#c=null;#u=0;#d=0;#h=!1;#f=new Set;#p=new Set;#m=null;#T=ic(()=>(this.#m=xr(this.#u),()=>{this.#m=null}));constructor(n,a,s){this.#t=n,this.#e=a,this.#r=s,this.parent=Zt.b,this.is_pending=!!this.#e.pending,this.#s=ki(()=>{Zt.b=this;{var r=this.#g();try{this.#a=da(()=>s(r))}catch(i){this.error(i)}this.#d>0?this.#v():this.is_pending=!1}return()=>{this.#c?.remove()}},oc)}#x(){try{this.#a=da(()=>this.#r(this.#t))}catch(n){this.error(n)}}#_(){const n=this.#e.pending;n&&(this.#n=da(()=>n(this.#t)),Ma.enqueue(()=>{var a=this.#g();this.#a=this.#y(()=>(Ma.ensure(),da(()=>this.#r(a)))),this.#d>0?this.#v():(vr(this.#n,()=>{this.#n=null}),this.is_pending=!1)}))}#g(){var n=this.#t;return this.is_pending&&(this.#c=za(),this.#t.before(this.#c),n=this.#c),n}defer_effect(n){bo(n,this.#f,this.#p)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#e.pending}#y(n){var a=Zt,s=Ot,r=un;Da(this.#s),Gn(this.#s),Kr(this.#s.ctx);try{return n()}catch(i){return vo(i),null}finally{Da(a),Gn(s),Kr(r)}}#v(){const n=this.#e.pending;this.#a!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#c),Yo(this.#a,this.#l)),this.#n===null&&(this.#n=da(()=>n(this.#t)))}#b(n){if(!this.has_pending_snippet()){this.parent&&this.parent.#b(n);return}if(this.#d+=n,this.#d===0){this.is_pending=!1;for(const a of this.#f)Cn(a,Bn),Va(a);for(const a of this.#p)Cn(a,Ia),Va(a);this.#f.clear(),this.#p.clear(),this.#n&&vr(this.#n,()=>{this.#n=null}),this.#l&&(this.#t.before(this.#l),this.#l=null)}}update_pending_count(n){this.#b(n),this.#u+=n,this.#m&&_r(this.#m,this.#u)}get_effect_pending(){return this.#T(),e(this.#m)}error(n){var a=this.#e.onerror;let s=this.#e.failed;if(this.#h||!a&&!s)throw n;this.#a&&(Xn(this.#a),this.#a=null),this.#n&&(Xn(this.#n),this.#n=null),this.#o&&(Xn(this.#o),this.#o=null);var r=!1,i=!1;const l=()=>{if(r){Ql();return}r=!0,i&&Hl(),Ma.ensure(),this.#u=0,this.#o!==null&&vr(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#a=this.#y(()=>(this.#h=!1,da(()=>this.#r(this.#t)))),this.#d>0?this.#v():this.is_pending=!1};var c=Ot;try{Gn(null),i=!0,a?.(n,l),i=!1}catch(d){Gr(d,this.#s&&this.#s.parent)}finally{Gn(c)}s&&Jr(()=>{this.#o=this.#y(()=>{Ma.ensure(),this.#h=!0;try{return da(()=>{s(this.#t,()=>n,()=>l)})}catch(d){return Gr(d,this.#s.parent),null}finally{this.#h=!1}})})}}function uc(t,n,a,s){const r=Ts()?js:Re;if(a.length===0&&t.length===0){s(n.map(r));return}var i=Vt,l=Zt,c=dc();function d(){Promise.all(a.map(h=>mc(h))).then(h=>{c();try{s([...n.map(r),...h])}catch(y){(l.f&Ka)===0&&Gr(y,l)}i?.deactivate(),Ys()}).catch(h=>{Gr(h,l)})}t.length>0?Promise.all(t).then(()=>{c();try{return d()}finally{i?.deactivate(),Ys()}}):d()}function dc(){var t=Zt,n=Ot,a=un,s=Vt;return function(i=!0){Da(t),Gn(n),Kr(a),i&&s?.activate()}}function Ys(){Da(null),Gn(null),Kr(null)}function js(t){var n=$n|Bn,a=Ot!==null&&(Ot.f&$n)!==0?Ot:null;return Zt!==null&&(Zt.f|=Vr),{ctx:un,deps:null,effects:null,equals:ho,f:n,fn:t,reactions:null,rv:0,v:Dn,wv:0,parent:a??Zt,ac:null}}function mc(t,n,a){let s=Zt;s===null&&Dl();var r=s.b,i=void 0,l=xr(Dn),c=!Ot,d=new Map;return _c(()=>{var h=so();i=h.promise;try{Promise.resolve(t()).then(h.resolve,h.reject).then(()=>{y===Vt&&y.committed&&y.deactivate(),Ys()})}catch(f){h.reject(f),Ys()}var y=Vt;if(c){var p=r.is_rendered();r.update_pending_count(1),y.increment(p),d.get(y)?.reject(Yr),d.delete(y),d.set(y,h)}const m=(f,v=void 0)=>{if(y.activate(),v)v!==Yr&&(l.f|=ir,_r(l,v));else{(l.f&ir)!==0&&(l.f^=ir),_r(l,f);for(const[A,T]of d){if(d.delete(A),A===y)break;T.reject(Yr)}}c&&(r.update_pending_count(-1),y.decrement(p))};h.promise.then(m,f=>m(null,f||"unknown"))}),_s(()=>{for(const h of d.values())h.reject(Yr)}),new Promise(h=>{function y(p){function m(){p===i?h(l):y(i)}p.then(m,m)}y(i)})}function Re(t){const n=js(t);return n.equals=po,n}function wo(t){var n=t.effects;if(n!==null){t.effects=null;for(var a=0;a<n.length;a+=1)Xn(n[a])}}function hc(t){for(var n=t.parent;n!==null;){if((n.f&$n)===0)return(n.f&Ka)===0?n:null;n=n.parent}return null}function _i(t){var n,a=Zt;Da(hc(t));try{t.f&=~Tr,wo(t),n=Uo(t)}finally{Da(a)}return n}function So(t){var n=_i(t);if(!t.equals(n)&&(t.wv=Bo(),(!Vt?.is_fork||t.deps===null)&&(t.v=n,t.deps===null))){Cn(t,Ln);return}cr||(Sa!==null?(Si()||Vt?.is_fork)&&Sa.set(t,n):xi(t))}let li=new Set;const or=new Map;let ko=!1;function xr(t,n){var a={f:0,v:t,reactions:null,equals:ho,rv:0,wv:0};return a}function Qa(t,n){const a=xr(t);return Ac(a),a}function W(t,n=!1,a=!0){const s=xr(t);return n||(s.equals=po),jr&&a&&un!==null&&un.l!==null&&(un.l.s??=[]).push(s),s}function ei(t,n){return b(t,o(()=>e(t))),n}function b(t,n,a=!1){Ot!==null&&(!ka||(Ot.f&$i)!==0)&&Ts()&&(Ot.f&($n|ja|bi|$i))!==0&&!Xa?.includes(t)&&Yl();let s=a?Hr(n):n;return _r(t,s)}function _r(t,n){if(!t.equals(n)){var a=t.v;cr?or.set(t,n):or.set(t,a),t.v=n;var s=Ma.ensure();if(s.capture(t,a),(t.f&$n)!==0){const r=t;(t.f&Bn)!==0&&_i(r),xi(r)}t.wv=Bo(),Ao(t,Bn),Ts()&&Zt!==null&&(Zt.f&Ln)!==0&&(Zt.f&(Ja|Ar))===0&&(ca===null?Cc([t]):ca.push(t)),!s.is_fork&&li.size>0&&!ko&&fc()}return n}function fc(){ko=!1;var t=gr;Hs(!0);const n=Array.from(li);try{for(const a of n)(a.f&Ln)!==0&&Cn(a,Ia),Qr(a)&&zr(a)}finally{Hs(t)}li.clear()}function fs(t){b(t,t.v+1)}function Ao(t,n){var a=t.reactions;if(a!==null)for(var s=Ts(),r=a.length,i=0;i<r;i++){var l=a[i],c=l.f;if(!(!s&&l===Zt)){var d=(c&Bn)===0;if(d&&Cn(l,n),(c&$n)!==0){var h=l;Sa?.delete(h),(c&Tr)===0&&(c&ha&&(l.f|=Tr),Ao(h,Ia))}else d&&((c&ja)!==0&&Ya!==null&&Ya.add(l),Va(l))}}}function Hr(t){if(typeof t!="object"||t===null||Ga in t)return t;const n=yi(t);if(n!==Al&&n!==Cl)return t;var a=new Map,s=zs(t),r=Qa(0),i=br,l=c=>{if(br===i)return c();var d=Ot,h=br;Gn(null),Yi(i);var y=c();return Gn(d),Yi(h),y};return s&&a.set("length",Qa(t.length)),new Proxy(t,{defineProperty(c,d,h){(!("value"in h)||h.configurable===!1||h.enumerable===!1||h.writable===!1)&&Ol();var y=a.get(d);return y===void 0?y=l(()=>{var p=Qa(h.value);return a.set(d,p),p}):b(y,h.value,!0),!0},deleteProperty(c,d){var h=a.get(d);if(h===void 0){if(d in c){const y=l(()=>Qa(Dn));a.set(d,y),fs(r)}}else b(h,Dn),fs(r);return!0},get(c,d,h){if(d===Ga)return t;var y=a.get(d),p=d in c;if(y===void 0&&(!p||yr(c,d)?.writable)&&(y=l(()=>{var f=Hr(p?c[d]:Dn),v=Qa(f);return v}),a.set(d,y)),y!==void 0){var m=e(y);return m===Dn?void 0:m}return Reflect.get(c,d,h)},getOwnPropertyDescriptor(c,d){var h=Reflect.getOwnPropertyDescriptor(c,d);if(h&&"value"in h){var y=a.get(d);y&&(h.value=e(y))}else if(h===void 0){var p=a.get(d),m=p?.v;if(p!==void 0&&m!==Dn)return{enumerable:!0,configurable:!0,value:m,writable:!0}}return h},has(c,d){if(d===Ga)return!0;var h=a.get(d),y=h!==void 0&&h.v!==Dn||Reflect.has(c,d);if(h!==void 0||Zt!==null&&(!y||yr(c,d)?.writable)){h===void 0&&(h=l(()=>{var m=y?Hr(c[d]):Dn,f=Qa(m);return f}),a.set(d,h));var p=e(h);if(p===Dn)return!1}return y},set(c,d,h,y){var p=a.get(d),m=d in c;if(s&&d==="length")for(var f=h;f<p.v;f+=1){var v=a.get(f+"");v!==void 0?b(v,Dn):f in c&&(v=l(()=>Qa(Dn)),a.set(f+"",v))}if(p===void 0)(!m||yr(c,d)?.writable)&&(p=l(()=>Qa(void 0)),b(p,Hr(h)),a.set(d,p));else{m=p.v!==Dn;var A=l(()=>Hr(h));b(p,A)}var T=Reflect.getOwnPropertyDescriptor(c,d);if(T?.set&&T.set.call(y,h),!m){if(s&&typeof d=="string"){var E=a.get("length"),P=Number(d);Number.isInteger(P)&&P>=E.v&&b(E,P+1)}fs(r)}return!0},ownKeys(c){e(r);var d=Reflect.ownKeys(c).filter(p=>{var m=a.get(p);return m===void 0||m.v!==Dn});for(var[h,y]of a)y.v!==Dn&&!(h in c)&&d.push(h);return d},setPrototypeOf(){Wl()}})}function Ni(t){try{if(t!==null&&typeof t=="object"&&Ga in t)return t[Ga]}catch{}return t}function pc(t,n){return Object.is(Ni(t),Ni(n))}var pr,Co,Eo,Mo;function yc(){if(pr===void 0){pr=window,Co=/Firefox/.test(navigator.userAgent);var t=Element.prototype,n=Node.prototype,a=Text.prototype;Eo=yr(n,"firstChild").get,Mo=yr(n,"nextSibling").get,Li(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Li(a)&&(a.__t=void 0)}}function za(t=""){return document.createTextNode(t)}function Ba(t){return Eo.call(t)}function xs(t){return Mo.call(t)}function x(t,n){return Ba(t)}function ce(t,n=!1){{var a=Ba(t);return a instanceof Comment&&a.data===""?xs(a):a}}function g(t,n=1,a=!1){let s=t;for(;n--;)s=xs(s);return s}function vc(t){t.textContent=""}function Ro(){return!1}let Oi=!1;function gc(){Oi||(Oi=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const n of t.target.elements)n.__on_r?.()})},{capture:!0}))}function Js(t){var n=Ot,a=Zt;Gn(null),Da(null);try{return t()}finally{Gn(n),Da(a)}}function wi(t,n,a,s=a){t.addEventListener(n,()=>Js(a));const r=t.__on_r;r?t.__on_r=()=>{r(),s(!0)}:t.__on_r=()=>s(!0),gc()}function Do(t){Zt===null&&(Ot===null&&$l(),Ll()),cr&&Il()}function bc(t,n){var a=n.last;a===null?n.last=n.first=t:(a.next=t,t.prev=a,n.last=t)}function La(t,n,a){var s=Zt;s!==null&&(s.f&sa)!==0&&(t|=sa);var r={ctx:un,deps:null,nodes:null,f:t|Bn|ha,first:null,fn:n,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,wv:0,ac:null};if(a)try{zr(r),r.f|=gi}catch(c){throw Xn(r),c}else n!==null&&Va(r);var i=r;if(a&&i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&Vr)===0&&(i=i.first,(t&ja)!==0&&(t&Ur)!==0&&i!==null&&(i.f|=Ur)),i!==null&&(i.parent=s,s!==null&&bc(i,s),Ot!==null&&(Ot.f&$n)!==0&&(t&Ar)===0)){var l=Ot;(l.effects??=[]).push(i)}return r}function Si(){return Ot!==null&&!ka}function _s(t){const n=La(bs,null,!1);return Cn(n,Ln),n.teardown=t,n}function ci(t){Do();var n=Zt.f,a=!Ot&&(n&Ja)!==0&&(n&gi)===0;if(a){var s=un;(s.e??=[]).push(t)}else return Io(t)}function Io(t){return La(Ws|lo,t,!1)}function Tc(t){return Do(),La(bs|lo,t,!0)}function xc(t){Ma.ensure();const n=La(Ar|Vr,t,!0);return(a={})=>new Promise(s=>{a.outro?vr(n,()=>{Xn(n),s(void 0)}):(Xn(n),s(void 0))})}function Lo(t){return La(Ws,t,!1)}function me(t,n){var a=un,s={effect:null,ran:!1,deps:t};a.l.$.push(s),s.effect=Zr(()=>{t(),!s.ran&&(s.ran=!0,o(n))})}function $a(){var t=un;Zr(()=>{for(var n of t.l.$){n.deps();var a=n.effect;(a.f&Ln)!==0&&a.deps!==null&&Cn(a,Ia),Qr(a)&&zr(a),n.ran=!1}})}function _c(t){return La(bi|Vr,t,!0)}function Zr(t,n=0){return La(bs|n,t,!0)}function U(t,n=[],a=[],s=[]){uc(s,n,a,r=>{La(bs,()=>t(...r.map(e)),!0)})}function ki(t,n=0){var a=La(ja|n,t,!0);return a}function da(t){return La(Ja|Vr,t,!0)}function $o(t){var n=t.teardown;if(n!==null){const a=cr,s=Ot;Wi(!0),Gn(null);try{n.call(null)}finally{Wi(a),Gn(s)}}}function Po(t,n=!1){var a=t.first;for(t.first=t.last=null;a!==null;){const r=a.ac;r!==null&&Js(()=>{r.abort(Yr)});var s=a.next;(a.f&Ar)!==0?a.parent=null:Xn(a,n),a=s}}function wc(t){for(var n=t.first;n!==null;){var a=n.next;(n.f&Ja)===0&&Xn(n),n=a}}function Xn(t,n=!0){var a=!1;(n||(t.f&oo)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(Sc(t.nodes.start,t.nodes.end),a=!0),Po(t,n&&!a),Fs(t,0),Cn(t,Ka);var s=t.nodes&&t.nodes.t;if(s!==null)for(const i of s)i.stop();$o(t);var r=t.parent;r!==null&&r.first!==null&&No(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function Sc(t,n){for(;t!==null;){var a=t===n?null:xs(t);t.remove(),t=a}}function No(t){var n=t.parent,a=t.prev,s=t.next;a!==null&&(a.next=s),s!==null&&(s.prev=a),n!==null&&(n.first===t&&(n.first=s),n.last===t&&(n.last=a))}function vr(t,n,a=!0){var s=[];Oo(t,s,!0);var r=()=>{a&&Xn(t),n&&n()},i=s.length;if(i>0){var l=()=>--i||r();for(var c of s)c.out(l)}else r()}function Oo(t,n,a){if((t.f&sa)===0){t.f^=sa;var s=t.nodes&&t.nodes.t;if(s!==null)for(const c of s)(c.is_global||a)&&n.push(c);for(var r=t.first;r!==null;){var i=r.next,l=(r.f&Ur)!==0||(r.f&Ja)!==0&&(t.f&ja)!==0;Oo(r,n,l?a:!1),r=i}}}function Ai(t){Wo(t,!0)}function Wo(t,n){if((t.f&sa)!==0){t.f^=sa,(t.f&Ln)===0&&(Cn(t,Bn),Va(t));for(var a=t.first;a!==null;){var s=a.next,r=(a.f&Ur)!==0||(a.f&Ja)!==0;Wo(a,r?n:!1),a=s}var i=t.nodes&&t.nodes.t;if(i!==null)for(const l of i)(l.is_global||n)&&l.in()}}function Yo(t,n){if(t.nodes)for(var a=t.nodes.start,s=t.nodes.end;a!==null;){var r=a===s?null:xs(a);n.append(a),a=r}}let Wr=null;function kc(t){var n=Wr;try{if(Wr=new Set,o(t),n!==null)for(var a of Wr)n.add(a);return Wr}finally{Wr=n}}function Ho(t){for(var n of kc(t))_r(n,n.v)}let gr=!1;function Hs(t){gr=t}let cr=!1;function Wi(t){cr=t}let Ot=null,ka=!1;function Gn(t){Ot=t}let Zt=null;function Da(t){Zt=t}let Xa=null;function Ac(t){Ot!==null&&(Xa===null?Xa=[t]:Xa.push(t))}let Fn=null,ta=0,ca=null;function Cc(t){ca=t}let Fo=1,vs=0,br=vs;function Yi(t){br=t}function Bo(){return++Fo}function Qr(t){var n=t.f;if((n&Bn)!==0)return!0;if(n&$n&&(t.f&=~Tr),(n&Ia)!==0){for(var a=t.deps,s=a.length,r=0;r<s;r++){var i=a[r];if(Qr(i)&&So(i),i.wv>t.wv)return!0}(n&ha)!==0&&Sa===null&&Cn(t,Ln)}return!1}function qo(t,n,a=!0){var s=t.reactions;if(s!==null&&!Xa?.includes(t))for(var r=0;r<s.length;r++){var i=s[r];(i.f&$n)!==0?qo(i,n,!1):n===i&&(a?Cn(i,Bn):(i.f&Ln)!==0&&Cn(i,Ia),Va(i))}}function Uo(t){var n=Fn,a=ta,s=ca,r=Ot,i=Xa,l=un,c=ka,d=br,h=t.f;Fn=null,ta=0,ca=null,Ot=(h&(Ja|Ar))===0?t:null,Xa=null,Kr(t.ctx),ka=!1,br=++vs,t.ac!==null&&(Js(()=>{t.ac.abort(Yr)}),t.ac=null);try{t.f|=ii;var y=t.fn,p=y(),m=t.deps;if(Fn!==null){var f;if(Fs(t,ta),m!==null&&ta>0)for(m.length=ta+Fn.length,f=0;f<Fn.length;f++)m[ta+f]=Fn[f];else t.deps=m=Fn;if(Si()&&(t.f&ha)!==0)for(f=ta;f<m.length;f++)(m[f].reactions??=[]).push(t)}else m!==null&&ta<m.length&&(Fs(t,ta),m.length=ta);if(Ts()&&ca!==null&&!ka&&m!==null&&(t.f&($n|Ia|Bn))===0)for(f=0;f<ca.length;f++)qo(ca[f],t);return r!==null&&r!==t&&(vs++,ca!==null&&(s===null?s=ca:s.push(...ca))),(t.f&ir)!==0&&(t.f^=ir),p}catch(v){return vo(v)}finally{t.f^=ii,Fn=n,ta=a,ca=s,Ot=r,Xa=i,Kr(l),ka=c,br=d}}function Ec(t,n){let a=n.reactions;if(a!==null){var s=kl.call(a,t);if(s!==-1){var r=a.length-1;r===0?a=n.reactions=null:(a[s]=a[r],a.pop())}}if(a===null&&(n.f&$n)!==0&&(Fn===null||!Fn.includes(n))){var i=n;(i.f&ha)!==0&&(i.f^=ha,i.f&=~Tr),xi(i),wo(i),Fs(i,0)}}function Fs(t,n){var a=t.deps;if(a!==null)for(var s=n;s<a.length;s++)Ec(t,a[s])}function zr(t){var n=t.f;if((n&Ka)===0){Cn(t,Ln);var a=Zt,s=gr;Zt=t,gr=!0;try{(n&(ja|io))!==0?wc(t):Po(t),$o(t);var r=Uo(t);t.teardown=typeof r=="function"?r:null,t.wv=Fo;var i;si&&ec&&(t.f&Bn)!==0&&t.deps}finally{gr=s,Zt=a}}}async function Mc(){await Promise.resolve(),rc()}function e(t){var n=t.f,a=(n&$n)!==0;if(Wr?.add(t),Ot!==null&&!ka){var s=Zt!==null&&(Zt.f&Ka)!==0;if(!s&&!Xa?.includes(t)){var r=Ot.deps;if((Ot.f&ii)!==0)t.rv<vs&&(t.rv=vs,Fn===null&&r!==null&&r[ta]===t?ta++:Fn===null?Fn=[t]:Fn.includes(t)||Fn.push(t));else{(Ot.deps??=[]).push(t);var i=t.reactions;i===null?t.reactions=[Ot]:i.includes(Ot)||i.push(Ot)}}}if(cr&&or.has(t))return or.get(t);if(a){var l=t;if(cr){var c=l.v;return((l.f&Ln)===0&&l.reactions!==null||Go(l))&&(c=_i(l)),or.set(l,c),c}var d=(l.f&ha)===0&&!ka&&Ot!==null&&(gr||(Ot.f&ha)!==0),h=l.deps===null;Qr(l)&&(d&&(l.f|=ha),So(l)),d&&!h&&Ko(l)}if(Sa?.has(t))return Sa.get(t);if((t.f&ir)!==0)throw t.v;return t.v}function Ko(t){if(t.deps!==null){t.f|=ha;for(const n of t.deps)(n.reactions??=[]).push(t),(n.f&$n)!==0&&(n.f&ha)===0&&Ko(n)}}function Go(t){if(t.v===Dn)return!0;if(t.deps===null)return!1;for(const n of t.deps)if(or.has(n)||(n.f&$n)!==0&&Go(n))return!0;return!1}function o(t){var n=ka;try{return ka=!0,t()}finally{ka=n}}function L(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Ga in t)ui(t);else if(!Array.isArray(t))for(let n in t){const a=t[n];typeof a=="object"&&a&&Ga in a&&ui(a)}}}function ui(t,n=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!n.has(t)){n.add(t),t instanceof Date&&t.getTime();for(let s in t)try{ui(t[s],n)}catch{}const a=yi(t);if(a!==Object.prototype&&a!==Array.prototype&&a!==Map.prototype&&a!==Set.prototype&&a!==Date.prototype){const s=ro(a);for(let r in s){const i=s[r].get;if(i)try{i.call(t)}catch{}}}}}const Rc=["touchstart","touchmove"];function Dc(t){return Rc.includes(t)}const Ic=new Set,Hi=new Set;function Lc(t,n,a,s={}){function r(i){if(s.capture||cs.call(n,i),!i.cancelBubble)return Js(()=>a?.call(this,i))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Jr(()=>{n.addEventListener(t,r,s)}):n.addEventListener(t,r,s),r}function ne(t,n,a,s,r){var i={capture:s,passive:r},l=Lc(t,n,a,i);(n===document.body||n===window||n===document||n instanceof HTMLMediaElement)&&_s(()=>{n.removeEventListener(t,l,i)})}let Fi=null;function cs(t){var n=this,a=n.ownerDocument,s=t.type,r=t.composedPath?.()||[],i=r[0]||t.target;Fi=t;var l=0,c=Fi===t&&t.__root;if(c){var d=r.indexOf(c);if(d!==-1&&(n===document||n===window)){t.__root=n;return}var h=r.indexOf(n);if(h===-1)return;d<=h&&(l=d)}if(i=r[l]||t.target,i!==n){ao(t,"currentTarget",{configurable:!0,get(){return i||a}});var y=Ot,p=Zt;Gn(null),Da(null);try{for(var m,f=[];i!==null;){var v=i.assignedSlot||i.parentNode||i.host||null;try{var A=i["__"+s];A!=null&&(!i.disabled||t.target===i)&&A.call(i,t)}catch(T){m?f.push(T):m=T}if(t.cancelBubble||v===n||v===null)break;i=v}if(m){for(let T of f)queueMicrotask(()=>{throw T});throw m}}finally{t.__root=n,delete t.currentTarget,Gn(y),Da(p)}}}function zo(t){var n=document.createElement("template");return n.innerHTML=t.replaceAll("<!>","<!---->"),n.content}function Xr(t,n){var a=Zt;a.nodes===null&&(a.nodes={start:t,end:n,a:null,t:null})}function pe(t,n){var a=(n&mo)!==0,s=(n&jl)!==0,r,i=!t.startsWith("<!>");return()=>{r===void 0&&(r=zo(i?t:"<!>"+t),a||(r=Ba(r)));var l=s||Co?document.importNode(r,!0):r.cloneNode(!0);if(a){var c=Ba(l),d=l.lastChild;Xr(c,d)}else Xr(l,l);return l}}function $c(t,n,a="svg"){var s=!t.startsWith("<!>"),r=(n&mo)!==0,i=`<${a}>${s?t:"<!>"+t}</${a}>`,l;return()=>{if(!l){var c=zo(i),d=Ba(c);if(r)for(l=document.createDocumentFragment();Ba(d);)l.appendChild(Ba(d));else l=Ba(d)}var h=l.cloneNode(!0);if(r){var y=Ba(h),p=h.lastChild;Xr(y,p)}else Xr(h,h);return h}}function he(t,n){return $c(t,n,"svg")}function Xo(t=""){{var n=za(t+"");return Xr(n,n),n}}function Ge(){var t=document.createDocumentFragment(),n=document.createComment(""),a=za();return t.append(n,a),Xr(n,a),t}function w(t,n){t!==null&&t.before(n)}function Le(t,n){var a=n==null?"":typeof n=="object"?n+"":n;a!==(t.__t??=t.nodeValue)&&(t.__t=a,t.nodeValue=a+"")}function Pc(t,n){return Nc(t,n)}const Pr=new Map;function Nc(t,{target:n,anchor:a,props:s={},events:r,context:i,intro:l=!0}){yc();var c=new Set,d=p=>{for(var m=0;m<p.length;m++){var f=p[m];if(!c.has(f)){c.add(f);var v=Dc(f);n.addEventListener(f,cs,{passive:v});var A=Pr.get(f);A===void 0?(document.addEventListener(f,cs,{passive:v}),Pr.set(f,1)):Pr.set(f,A+1)}}};d(Xs(Ic)),Hi.add(d);var h=void 0,y=xc(()=>{var p=a??n.appendChild(za());return lc(p,{pending:()=>{}},m=>{if(i){Vn({});var f=un;f.c=i}r&&(s.$$events=r),h=t(m,s)||{},i&&jn()}),()=>{for(var m of c){n.removeEventListener(m,cs);var f=Pr.get(m);--f===0?(document.removeEventListener(m,cs),Pr.delete(m)):Pr.set(m,f)}Hi.delete(d),p!==a&&p.parentNode?.removeChild(p)}});return Oc.set(h,y),h}let Oc=new WeakMap;class Wc{anchor;#t=new Map;#i=new Map;#e=new Map;#r=new Set;#s=!0;constructor(n,a=!0){this.anchor=n,this.#s=a}#a=()=>{var n=Vt;if(this.#t.has(n)){var a=this.#t.get(n),s=this.#i.get(a);if(s)Ai(s),this.#r.delete(a);else{var r=this.#e.get(a);r&&(this.#i.set(a,r.effect),this.#e.delete(a),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),s=r.effect)}for(const[i,l]of this.#t){if(this.#t.delete(i),i===n)break;const c=this.#e.get(l);c&&(Xn(c.effect),this.#e.delete(l))}for(const[i,l]of this.#i){if(i===a||this.#r.has(i))continue;const c=()=>{if(Array.from(this.#t.values()).includes(i)){var h=document.createDocumentFragment();Yo(l,h),h.append(za()),this.#e.set(i,{effect:l,fragment:h})}else Xn(l);this.#r.delete(i),this.#i.delete(i)};this.#s||!s?(this.#r.add(i),vr(l,c,!1)):c()}}};#n=n=>{this.#t.delete(n);const a=Array.from(this.#t.values());for(const[s,r]of this.#e)a.includes(s)||(Xn(r.effect),this.#e.delete(s))};ensure(n,a){var s=Vt,r=Ro();if(a&&!this.#i.has(n)&&!this.#e.has(n))if(r){var i=document.createDocumentFragment(),l=za();i.append(l),this.#e.set(n,{effect:da(()=>a(l)),fragment:i})}else this.#i.set(n,da(()=>a(this.anchor)));if(this.#t.set(s,n),r){for(const[c,d]of this.#i)c===n?s.skipped_effects.delete(d):s.skipped_effects.add(d);for(const[c,d]of this.#e)c===n?s.skipped_effects.delete(d.effect):s.skipped_effects.add(d.effect);s.oncommit(this.#a),s.ondiscard(this.#n)}else this.#a()}}function j(t,n,a=!1){var s=new Wc(t),r=a?Ur:0;function i(l,c){s.ensure(l,c)}ki(()=>{var l=!1;n((c,d=!0)=>{l=!0,i(d,c)}),l||i(!1,null)},r)}function ft(t,n){return n}function Yc(t,n,a){for(var s=[],r=n.length,i,l=n.length,c=0;c<r;c++){let p=n[c];vr(p,()=>{if(i){if(i.pending.delete(p),i.done.add(p),i.pending.size===0){var m=t.outrogroups;di(Xs(i.done)),m.delete(i),m.size===0&&(t.outrogroups=null)}}else l-=1},!1)}if(l===0){var d=s.length===0&&a!==null;if(d){var h=a,y=h.parentNode;vc(y),y.append(h),t.items.clear()}di(n,!d)}else i={pending:new Set(n),done:new Set},(t.outrogroups??=new Set).add(i)}function di(t,n=!0){for(var a=0;a<t.length;a++)Xn(t[a],n)}var Bi;function Ve(t,n,a,s,r,i=null){var l=t,c=new Map,d=(n&uo)!==0;if(d){var h=t;l=h.appendChild(za())}var y=null,p=Re(()=>{var E=a();return zs(E)?E:E==null?[]:Xs(E)}),m,f=!0;function v(){T.fallback=y,Hc(T,m,l,n,s),y!==null&&(m.length===0?(y.f&Ua)===0?Ai(y):(y.f^=Ua,us(y,null,l)):vr(y,()=>{y=null}))}var A=ki(()=>{m=e(p);for(var E=m.length,P=new Set,M=Vt,k=Ro(),D=0;D<E;D+=1){var $=m[D],B=s($,D),F=f?null:c.get(B);F?(F.v&&_r(F.v,$),F.i&&_r(F.i,D),k&&M.skipped_effects.delete(F.e)):(F=Fc(c,f?l:Bi??=za(),$,B,D,r,n,a),f||(F.e.f|=Ua),c.set(B,F)),P.add(B)}if(E===0&&i&&!y&&(f?y=da(()=>i(l)):(y=da(()=>i(Bi??=za())),y.f|=Ua)),!f)if(k){for(const[G,q]of c)P.has(G)||M.skipped_effects.add(q.e);M.oncommit(v),M.ondiscard(()=>{})}else v();e(p)}),T={effect:A,items:c,outrogroups:null,fallback:y};f=!1}function Hc(t,n,a,s,r){var i=(s&ql)!==0,l=n.length,c=t.items,d=t.effect.first,h,y=null,p,m=[],f=[],v,A,T,E;if(i)for(E=0;E<l;E+=1)v=n[E],A=r(v,E),T=c.get(A).e,(T.f&Ua)===0&&(T.nodes?.a?.measure(),(p??=new Set).add(T));for(E=0;E<l;E+=1){if(v=n[E],A=r(v,E),T=c.get(A).e,t.outrogroups!==null)for(const q of t.outrogroups)q.pending.delete(T),q.done.delete(T);if((T.f&Ua)!==0)if(T.f^=Ua,T===d)us(T,null,a);else{var P=y?y.next:d;T===t.effect.last&&(t.effect.last=T.prev),T.prev&&(T.prev.next=T.next),T.next&&(T.next.prev=T.prev),er(t,y,T),er(t,T,P),us(T,P,a),y=T,m=[],f=[],d=y.next;continue}if((T.f&sa)!==0&&(Ai(T),i&&(T.nodes?.a?.unfix(),(p??=new Set).delete(T))),T!==d){if(h!==void 0&&h.has(T)){if(m.length<f.length){var M=f[0],k;y=M.prev;var D=m[0],$=m[m.length-1];for(k=0;k<m.length;k+=1)us(m[k],M,a);for(k=0;k<f.length;k+=1)h.delete(f[k]);er(t,D.prev,$.next),er(t,y,D),er(t,$,M),d=M,y=$,E-=1,m=[],f=[]}else h.delete(T),us(T,d,a),er(t,T.prev,T.next),er(t,T,y===null?t.effect.first:y.next),er(t,y,T),y=T;continue}for(m=[],f=[];d!==null&&d!==T;)(h??=new Set).add(d),f.push(d),d=d.next;if(d===null)continue}(T.f&Ua)===0&&m.push(T),y=T,d=T.next}if(t.outrogroups!==null){for(const q of t.outrogroups)q.pending.size===0&&(di(Xs(q.done)),t.outrogroups?.delete(q));t.outrogroups.size===0&&(t.outrogroups=null)}if(d!==null||h!==void 0){var B=[];if(h!==void 0)for(T of h)(T.f&sa)===0&&B.push(T);for(;d!==null;)(d.f&sa)===0&&d!==t.fallback&&B.push(d),d=d.next;var F=B.length;if(F>0){var G=(s&uo)!==0&&l===0?a:null;if(i){for(E=0;E<F;E+=1)B[E].nodes?.a?.measure();for(E=0;E<F;E+=1)B[E].nodes?.a?.fix()}Yc(t,B,G)}}i&&Jr(()=>{if(p!==void 0)for(T of p)T.nodes?.a?.apply()})}function Fc(t,n,a,s,r,i,l,c){var d=(l&Fl)!==0?(l&Ul)===0?W(a,!1,!1):xr(a):null,h=(l&Bl)!==0?xr(r):null;return{v:d,i:h,e:da(()=>(i(n,d??a,h??r,c),()=>{t.delete(s)}))}}function us(t,n,a){if(t.nodes)for(var s=t.nodes.start,r=t.nodes.end,i=n&&(n.f&Ua)===0?n.nodes.start:a;s!==null;){var l=xs(s);if(i.before(s),s===r)return;s=l}}function er(t,n,a){n===null?t.effect.first=a:n.next=a,a===null?t.effect.last=n:a.prev=n}function Vo(t,n,a,s,r){var i=n.$$slots?.[a],l=!1;i===!0&&(i=n.children,l=!0),i===void 0||i(t,l?()=>s:s)}const qi=[...` 	
\r\f \v\uFEFF`];function Bc(t,n,a){var s=t==null?"":""+t;if(a){for(var r in a)if(a[r])s=s?s+" "+r:r;else if(s.length)for(var i=r.length,l=0;(l=s.indexOf(r,l))>=0;){var c=l+i;(l===0||qi.includes(s[l-1]))&&(c===s.length||qi.includes(s[c]))?s=(l===0?"":s.substring(0,l))+s.substring(c+1):l=c}}return s===""?null:s}function qc(t,n){return t==null?null:String(t)}function Mn(t,n,a,s,r,i){var l=t.__className;if(l!==a||l===void 0){var c=Bc(a,s,i);c==null?t.removeAttribute("class"):n?t.className=c:t.setAttribute("class",c),t.__className=a}else if(i&&r!==i)for(var d in i){var h=!!i[d];(r==null||h!==!!r[d])&&t.classList.toggle(d,h)}return i}function Uc(t,n,a,s){var r=t.__style;if(r!==n){var i=qc(n);i==null?t.removeAttribute("style"):t.style.cssText=i,t.__style=n}return s}function jo(t,n,a=!1){if(t.multiple){if(n==null)return;if(!zs(n))return Zl();for(var s of t.options)s.selected=n.includes(ps(s));return}for(s of t.options){var r=ps(s);if(pc(r,n)){s.selected=!0;return}}(!a||n!==void 0)&&(t.selectedIndex=-1)}function Kc(t){var n=new MutationObserver(()=>{jo(t,t.__value)});n.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),_s(()=>{n.disconnect()})}function Jo(t,n,a=n){var s=new WeakSet,r=!0;wi(t,"change",i=>{var l=i?"[selected]":":checked",c;if(t.multiple)c=[].map.call(t.querySelectorAll(l),ps);else{var d=t.querySelector(l)??t.querySelector("option:not([disabled])");c=d&&ps(d)}a(c),Vt!==null&&s.add(Vt)}),Lo(()=>{var i=n();if(t===document.activeElement){var l=ms??Vt;if(s.has(l))return}if(jo(t,i,r),r&&i===void 0){var c=t.querySelector(":checked");c!==null&&(i=ps(c),a(i))}t.__value=i,r=!1}),Kc(t)}function ps(t){return"__value"in t?t.__value:t.value}const Gc=Symbol("is custom element"),zc=Symbol("is html");function Ha(t,n){var a=Zo(t);a.value===(a.value=n??void 0)||t.value===n&&(n!==0||t.nodeName!=="PROGRESS")||(t.value=n??"")}function u(t,n,a,s){var r=Zo(t);r[n]!==(r[n]=a)&&(n==="loading"&&(t[Rl]=a),a==null?t.removeAttribute(n):typeof a!="string"&&Xc(t).includes(n)?t[n]=a:t.setAttribute(n,a))}function Zo(t){return t.__attributes??={[Gc]:t.nodeName.includes("-"),[zc]:t.namespaceURI===Jl}}var Ui=new Map;function Xc(t){var n=t.getAttribute("is")||t.nodeName,a=Ui.get(n);if(a)return a;Ui.set(n,a=[]);for(var s,r=t,i=Element.prototype;i!==r;){s=ro(r);for(var l in s)s[l].set&&a.push(l);r=yi(r)}return a}function qr(t,n,a=n){var s=new WeakSet;wi(t,"input",async r=>{var i=r?t.defaultValue:t.value;if(i=ti(t)?ni(i):i,a(i),Vt!==null&&s.add(Vt),await Mc(),i!==(i=n())){var l=t.selectionStart,c=t.selectionEnd,d=t.value.length;if(t.value=i??"",c!==null){var h=t.value.length;l===c&&c===d&&h>d?(t.selectionStart=h,t.selectionEnd=h):(t.selectionStart=l,t.selectionEnd=Math.min(c,h))}}}),o(n)==null&&t.value&&(a(ti(t)?ni(t.value):t.value),Vt!==null&&s.add(Vt)),Zr(()=>{var r=n();if(t===document.activeElement){var i=ms??Vt;if(s.has(i))return}ti(t)&&r===ni(t.value)||t.type==="date"&&!r&&!t.value||r!==t.value&&(t.value=r??"")})}function En(t,n,a=n){wi(t,"change",s=>{var r=s?t.defaultChecked:t.checked;a(r)}),o(n)==null&&a(t.checked),Zr(()=>{var s=n();t.checked=!!s})}function ti(t){var n=t.type;return n==="number"||n==="range"}function ni(t){return t===""?null:+t}function ds(t,n,a){var s=yr(t,n);s&&s.set&&(t[n]=a,_s(()=>{t[n]=null}))}function Ki(t,n){return t===n||t?.[Ga]===n}function wr(t={},n,a,s){return Lo(()=>{var r,i;return Zr(()=>{r=i,i=[],o(()=>{t!==a(...i)&&(n(t,...i),r&&Ki(a(...r),t)&&n(null,...r))})}),()=>{Jr(()=>{i&&Ki(a(...i),t)&&n(null,...i)})}}),t}function ia(t=!1){const n=un,a=n.l.u;if(!a)return;let s=()=>L(n.s);if(t){let r=0,i={};const l=js(()=>{let c=!1;const d=n.s;for(const h in d)d[h]!==i[h]&&(i[h]=d[h],c=!0);return c&&r++,r});s=()=>e(l)}a.b.length&&Tc(()=>{Gi(n,s),Os(a.b)}),ci(()=>{const r=o(()=>a.m.map(El));return()=>{for(const i of r)typeof i=="function"&&i()}}),a.a.length&&ci(()=>{Gi(n,s),Os(a.a)})}function Gi(t,n){if(t.l.s)for(const a of t.l.s)e(a);n()}function Ci(t,n,a){if(t==null)return n(void 0),a&&a(void 0),sr;const s=o(()=>t.subscribe(n,a));return s.unsubscribe?()=>s.unsubscribe():s}const Nr=[];function Vc(t,n){return{subscribe:gn(t,n).subscribe}}function gn(t,n=sr){let a=null;const s=new Set;function r(c){if(fo(t,c)&&(t=c,a)){const d=!Nr.length;for(const h of s)h[1](),Nr.push(h,t);if(d){for(let h=0;h<Nr.length;h+=2)Nr[h][0](Nr[h+1]);Nr.length=0}}}function i(c){r(c(t))}function l(c,d=sr){const h=[c,d];return s.add(h),s.size===1&&(a=n(r,i)||sr),c(t),()=>{s.delete(h),s.size===0&&a&&(a(),a=null)}}return{set:r,update:i,subscribe:l}}function Pa(t,n,a){const s=!Array.isArray(t),r=s?[t]:t;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=n.length<2;return Vc(a,(l,c)=>{let d=!1;const h=[];let y=0,p=sr;const m=()=>{if(y)return;p();const v=n(s?h[0]:h,l,c);i?l(v):p=typeof v=="function"?v:sr},f=r.map((v,A)=>Ci(v,T=>{h[A]=T,y&=~(1<<A),d&&m()},()=>{y|=1<<A}));return d=!0,m(),function(){Os(f),p(),d=!1}})}function aa(t){let n;return Ci(t,a=>n=a)(),n}let Cs=!1,mi=Symbol();function Wt(t,n,a){const s=a[n]??={store:null,source:W(void 0),unsubscribe:sr};if(s.store!==t&&!(mi in a))if(s.unsubscribe(),s.store=t??null,t==null)s.source.v=void 0,s.unsubscribe=sr;else{var r=!0;s.unsubscribe=Ci(t,i=>{r?s.source.v=i:b(s.source,i)}),r=!1}return t&&mi in a?aa(t):e(s.source)}function jc(t,n){return t.set(n),n}function Cr(){const t={};function n(){_s(()=>{for(var a in t)t[a].unsubscribe();ao(t,mi,{enumerable:!1,value:!0})})}return[t,n]}function Jc(t){var n=Cs;try{return Cs=!1,[t(),Cs]}finally{Cs=n}}function we(t,n,a,s){var r=!jr||(a&Gl)!==0,i=(a&Xl)!==0,l=(a&Vl)!==0,c=s,d=!0,h=()=>(d&&(d=!1,c=l?o(s):s),c),y;if(i){var p=Ga in t||Ml in t;y=yr(t,n)?.set??(p&&n in t?M=>t[n]=M:void 0)}var m,f=!1;i?[m,f]=Jc(()=>t[n]):m=t[n],m===void 0&&s!==void 0&&(m=h(),y&&(r&&Nl(),y(m)));var v;if(r?v=()=>{var M=t[n];return M===void 0?h():(d=!0,M)}:v=()=>{var M=t[n];return M!==void 0&&(c=void 0),M===void 0?c:M},r&&(a&zl)===0)return v;if(y){var A=t.$$legacy;return(function(M,k){return arguments.length>0?((!r||!k||A||f)&&y(k?v():M),M):v()})}var T=!1,E=((a&Kl)!==0?js:Re)(()=>(T=!1,v()));i&&e(E);var P=Zt;return(function(M,k){if(arguments.length>0){const D=k?e(E):r&&i?Hr(M):M;return b(E,D),T=!0,c!==void 0&&(c=D),M}return cr&&T||(P.f&Ka)!==0?E.v:e(E)})}function Er(t){un===null&&Ti(),jr&&un.l!==null?Qc(un).m.push(t):ci(()=>{const n=o(t);if(typeof n=="function")return n})}function Qo(t){un===null&&Ti(),Er(()=>()=>o(t))}function Zc(t,n,{bubbles:a=!1,cancelable:s=!1}={}){return new CustomEvent(t,{detail:n,bubbles:a,cancelable:s})}function el(){const t=un;return t===null&&Ti(),(n,a,s)=>{const r=t.s.$$events?.[n];if(r){const i=zs(r)?r.slice():[r],l=Zc(n,a,s);for(const c of i)c.call(t.x,l);return!l.defaultPrevented}return!0}}function Qc(t){var n=t.l;return n.u??={a:[],b:[],m:[]}}const eu="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(eu);tc();function tu(t,n,a,s){const r=Fr(a,s,t),i=Fr(a,s,n),l=Fr(t,n,a),c=Fr(t,n,s);return!!((r>0&&i<0||r<0&&i>0)&&(l>0&&c<0||l<0&&c>0)||r===0&&Es(a,s,t)||i===0&&Es(a,s,n)||l===0&&Es(t,n,a)||c===0&&Es(t,n,s))}function Fr(t,n,a){return(a.x-t.x)*(n.y-t.y)-(n.x-t.x)*(a.y-t.y)}function Es(t,n,a){return Math.min(t.x,n.x)<=a.x&&a.x<=Math.max(t.x,n.x)&&Math.min(t.y,n.y)<=a.y&&a.y<=Math.max(t.y,n.y)}function zi(t,n,a,s=16){const r=[];for(let i=0;i<s;i++){const l=2*Math.PI*i/s;r.push({x:t+a*Math.cos(l),y:n+a*Math.sin(l)})}return r}function nu(t,n,a,s,r=0,i=16){const l=[],c=2*(a+s),d=r*Math.PI/180,h=Math.cos(d),y=Math.sin(d),p=i/c,m=Math.max(1,Math.round(a*p)),f=Math.max(1,Math.round(s*p)),v=a/2,A=s/2,T=[];for(let E=0;E<m;E++){const P=E/m;T.push({x:-v+a*P,y:-A})}for(let E=0;E<f;E++){const P=E/f;T.push({x:v,y:-A+s*P})}for(let E=0;E<m;E++){const P=E/m;T.push({x:v-a*P,y:A})}for(let E=0;E<f;E++){const P=E/f;T.push({x:-v,y:A-s*P})}for(const E of T)l.push({x:t+E.x*h-E.y*y,y:n+E.x*y+E.y*h});if(l.length>i){const E=[],P=l.length/i;for(let M=0;M<i;M++)E.push(l[Math.floor(M*P)]);return E}return l}function au(t,n,a,s,r=0,i=16){const l=[],c=r*Math.PI/180,d=Math.cos(c),h=Math.sin(c);for(let y=0;y<i;y++){const p=2*Math.PI*y/i,m=a*Math.cos(p),f=s*Math.sin(p);l.push({x:t+m*d-f*h,y:n+m*h+f*d})}return l}function Xi(t,n,a){const s=a.length;for(let r=0;r<s;r++){const i=a[r],l=a[(r+1)%s];if(tu(t,n,i,l))return!0}return!1}function tl(t,n,a){const s=a*Math.PI/180,r=Math.cos(s),i=Math.sin(s),l=t.x-n.x,c=t.y-n.y;return{x:n.x+l*r-c*i,y:n.y+l*i+c*r}}function nl(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function Sr(t){const n=nl(t),a=t.rotation||0;return[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}].map(r=>tl(r,n,a))}function ru(t){const r=t.x,i=t.y+t.height;return[{x:r,y:i},{x:r,y:i-8},{x:r+.5,y:i-8},{x:r+.5,y:i-.5},{x:r+4,y:i-.5},{x:r+4,y:i}]}function su(t){const n=ru(t),a=nl(t),s=t.rotation||0;return n.map(r=>tl(r,a,s))}function Bs(t,n){const a=n.length;let s=null;for(let r=0;r<a;r++){const i=n[r],l=n[(r+1)%a],c=(l.x-i.x)*(t.y-i.y)-(l.y-i.y)*(t.x-i.x);if(c!==0){const d=c>0;if(s===null)s=d;else if(s!==d)return!1}}return!0}function iu(t,n,a,s,r=.01){const i=Math.abs(Fr(t,n,a)),l=Math.abs(Fr(t,n,s)),c=Math.sqrt((n.x-t.x)**2+(n.y-t.y)**2),d=r*c;if(i>d||l>d)return!1;const h=n.x-t.x,y=n.y-t.y,p=Math.sqrt(h*h+y*y);if(p<r)return!1;const m=h/p,f=y/p,v=0,A=p,T=(a.x-t.x)*m+(a.y-t.y)*f,E=(s.x-t.x)*m+(s.y-t.y)*f,P=Math.min(v,A),M=Math.max(v,A),k=Math.min(T,E),D=Math.max(T,E),$=Math.max(P,k);return Math.min(M,D)-$>r}function ou(t,n,a=.1){const s=t.length,r=n.length;for(let i=0;i<s;i++){const l=t[i],c=t[(i+1)%s];for(let d=0;d<r;d++){const h=n[d],y=n[(d+1)%r];if(iu(l,c,h,y,a))return!0}}return!1}function lu(t){const n=t.length;if(n===0)return new Map;const a=Array.from({length:n},(c,d)=>d);function s(c){return a[c]!==c&&(a[c]=s(a[c])),a[c]}function r(c,d){const h=s(c),y=s(d);h!==y&&(a[h]=y)}for(let c=0;c<n;c++)for(let d=c+1;d<n;d++)ou(t[c].vertices,t[d].vertices)&&r(c,d);const i=new Map;t.forEach((c,d)=>i.set(c.id,d));const l=new Map;return t.forEach((c,d)=>{l.set(c.id,s(d))}),l}function cu(t,n,a){const s=n.get(t);return s===void 0?[t]:a.filter(r=>n.get(r.id)===s).map(r=>r.id)}const Ms=16;function qs(t){return t.isRectangle&&t.width!==void 0&&t.height!==void 0?nu(t.x,t.y,t.width,t.height,t.rotation||0,Ms):t.radius!==void 0?zi(t.x,t.y,t.radius,Ms):t.rx!==void 0&&t.ry!==void 0?au(t.x,t.y,t.rx,t.ry,t.rotation||0,Ms):zi(t.x,t.y,.5,Ms)}function uu(t,n){const a=qs(t);for(const s of a)if(Bs(s,n))return!0;return!!Bs({x:t.x,y:t.y},n)}function du(t,n){if(!Bs({x:t.x,y:t.y},n))return!1;const a=qs(t);for(const s of a)if(!Bs(s,n))return!1;return!0}function al(t,n,a,s){const r=qs(t),i=qs(n),l=lu(a),c=new Set;for(const p of a){const m=du(t,p.vertices),f=uu(n,p.vertices);if(m||f){const v=cu(p.id,l,a);for(const A of v)c.add(A)}}const d=[];let h=!1,y=null;for(const p of r)for(const m of i){const f={from:p,to:m,blocked:!1,blockedBy:null};let v=!1;for(const T of a)if(!c.has(T.id)&&Xi(p,m,T.vertices)){f.blocked=!0,f.blockedBy="terrain",v=!0;break}if(v){d.push(f);continue}let A=!1;for(const T of s)if(Xi(p,m,T)){f.blocked=!0,f.blockedBy="wall",A=!0;break}A||(f.blocked=!1,h||(y=f),h=!0),d.push(f)}return{canSee:h,rays:d,firstClearRay:y,terrainsIgnored:Array.from(c)}}function rl(t,n,a,s){const r=[];let i=null,l=!1;for(const c of t)for(const d of n){const h=al(c,d,a,s);r.push({modelA:c,modelB:d,...h}),h.canSee&&!l&&(l=!0,i=h)}return{canSee:l,firstClearResult:i,allResults:r}}const st={width:60,height:44},sl=gn([{id:"terrain1",x:20,y:16,width:6,height:12,rotation:0},{id:"terrain2",x:34,y:10,width:6,height:12,rotation:45},{id:"terrain3",x:44,y:20,width:6,height:12,rotation:-30}]);Pa(sl,t=>t.map(n=>su(n)));Pa(sl,t=>t.map(n=>({id:n.id,vertices:Sr(n)})));const Vi=gn(!1),re={player1:{primary:"#3b82f6",fill:"rgba(59, 130, 246, 0.5)",fillLight:"rgba(59, 130, 246, 0.3)",fillLighter:"rgba(59, 130, 246, 0.15)",zone:"rgba(59, 130, 246, 0.1)"},player2:{primary:"#ef4444",fill:"rgba(239, 68, 68, 0.5)",fillLight:"rgba(239, 68, 68, 0.3)",fillLighter:"rgba(239, 68, 68, 0.15)",zone:"rgba(239, 68, 68, 0.1)"},battlefield:{background:"#738973ff",gridFine:"#3a4a3a8c",gridCoarse:"#5a6a5a",ruler:"#666",rulerText:"#888",rulerBackground:"#1a1a1a"},terrain:{fill:"rgba(139, 90, 43, 0.3)",fillSelected:"rgba(59, 130, 246, 0.3)",fillStatic:"rgba(139, 90, 43, 0.6)",stroke:"#8b5a2b"},wall:{fill:"rgba(139, 69, 19, 0.8)",fillSelected:"rgba(139, 69, 19, 0.6)",stroke:"#5c3317"},objective:{primary:"#fbbf24",primaryControl:"rgba(251, 191, 36, 0.15)",secondary:"#9ca3af",secondaryControl:"rgba(156, 163, 175, 0.15)",center:"#000"},los:{visible:"#22c55e",blocked:"#ef4444",rayVisible:"#00ff0033",rayBlocked:"#ff000033"},selection:{highlight:"#3b82f6",highlightDark:"#1d4ed8",handle:"#9333ea",handleDark:"#7e22ce",dragRuler:"#fbbf24"}};function gs(t){return t===1?re.player1:re.player2}const il=1/25.4,Zs=40*il/2,Qs=3+20*il;function ol(t="item"){return t+"-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function mu(){const{subscribe:t,set:n,update:a}=gn([]);return{subscribe:t,set:n,update:a,add(s){const r=ol("zone");return a(i=>[...i,{id:r,...s}]),r},updateZone(s,r){a(i=>i.map(l=>l.id===s?{...l,...r}:l))},remove(s){a(r=>r.filter(i=>i.id!==s))},clear(){n([])}}}function hu(){const{subscribe:t,set:n,update:a}=gn([]);return{subscribe:t,set:n,update:a,add(s,r,i=!1){const l=ol("obj"),c=Math.round(s),d=Math.round(r);return a(h=>[...h,{id:l,x:c,y:d,isPrimary:i}]),l},updateObjective(s,r){a(i=>i.map(l=>l.id===s?{...l,...r}:l))},remove(s){a(r=>r.filter(i=>i.id!==s))},clear(){n([])}}}mu();hu();const ll=[{name:"Dawn of War",zones:[{name:"Player 1",color:re.player1.zone,borderColor:re.player1.primary,path:[{type:"M",x:0,y:32},{type:"L",x:60,y:32},{type:"L",x:60,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:re.player2.zone,borderColor:re.player2.primary,path:[{type:"M",x:0,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:12},{type:"L",x:0,y:12},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1}]},{name:"Hammer and Anvil",zones:[{name:"Player 1",color:re.player1.zone,borderColor:re.player1.primary,path:[{type:"M",x:0,y:0},{type:"L",x:18,y:0},{type:"L",x:18,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:re.player2.zone,borderColor:re.player2.primary,path:[{type:"M",x:42,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:42,y:44},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1}]},{name:"Tipping Point",zones:[{name:"Player 1",color:re.player1.zone,borderColor:re.player1.primary,path:[{type:"M",x:0,y:0},{type:"L",x:12,y:0},{type:"L",x:12,y:22},{type:"L",x:20,y:22},{type:"L",x:20,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:re.player2.zone,borderColor:re.player2.primary,path:[{type:"M",x:40,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:48,y:44},{type:"L",x:48,y:22},{type:"L",x:40,y:22},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:34,isPrimary:!1},{x:22,y:8,isPrimary:!1},{x:38,y:36,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Search and Destroy",zones:[{name:"Player 1",color:re.player1.zone,borderColor:re.player1.primary,path:[{type:"M",x:0,y:22},{type:"L",x:21,y:22},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:0,x:30,y:31},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:re.player2.zone,borderColor:re.player2.primary,path:[{type:"M",x:30,y:0},{type:"L",x:30,y:13},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:1,x:39,y:22},{type:"L",x:60,y:22},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:10,isPrimary:!1},{x:46,y:34,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Sweeping Engagement",zones:[{name:"Player 1",color:re.player1.zone,borderColor:re.player1.primary,path:[{type:"M",x:0,y:0},{type:"L",x:0,y:8},{type:"L",x:30,y:8},{type:"L",x:30,y:14},{type:"L",x:60,y:14},{type:"L",x:60,y:0},{type:"Z"}]},{name:"Player 2",color:re.player2.zone,borderColor:re.player2.primary,path:[{type:"M",x:0,y:44},{type:"L",x:60,y:44},{type:"L",x:60,y:36},{type:"L",x:30,y:36},{type:"L",x:30,y:30},{type:"L",x:0,y:30},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:18,isPrimary:!1},{x:50,y:26,isPrimary:!1},{x:18,y:38,isPrimary:!1},{x:42,y:6,isPrimary:!1}]},{name:"Crucible of Battle",zones:[{name:"Player 1",color:re.player1.zone,borderColor:re.player1.primary,path:[{type:"M",x:0,y:0},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:re.player2.zone,borderColor:re.player2.primary,path:[{type:"M",x:60,y:44},{type:"L",x:30,y:0},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:20,y:8,isPrimary:!1},{x:40,y:36,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]}];function kr(t){return t.map(n=>{switch(n.type){case"M":return`M ${n.x} ${n.y}`;case"L":return`L ${n.x} ${n.y}`;case"A":return`A ${n.rx} ${n.ry} ${n.rotation} ${n.largeArc} ${n.sweep} ${n.x} ${n.y}`;case"Z":return"Z";default:return""}}).join(" ")}const cl="warhammer-deployment-layouts",ul=[{label:'6" x 12"',width:6,height:12},{label:'5" x 10"',width:5,height:10},{label:'4" x 6"',width:4,height:6}],dl=[{label:"L 4x8",shape:"L-4x8"},{label:"L 4x8 ⌐",shape:"L-4x8-mirror"},{label:"C 4-8-4",shape:"C-4-8-4"},{label:"L 5x6",shape:"L-5x6"},{label:"L 5x6 ⌐",shape:"L-5x6-mirror"},{label:"L 4x6",shape:"L-4x6"},{label:"L 4x6 ⌐",shape:"L-4x6-mirror"}],ml=[{id:"gw",name:"GW",description:"Games Workshop official layouts",presets:[{name:"Layout 1",terrains:[{id:"a",x:28,y:0,width:4,height:6,rotation:0},{id:"b",x:28,y:38,width:4,height:6,rotation:0},{id:"c",x:6,y:5,width:6,height:12,rotation:0},{id:"d",x:48,y:27,width:6,height:12,rotation:0},{id:"e",x:16,y:28,width:6,height:12,rotation:0},{id:"f",x:7,y:19,width:6,height:12,rotation:90},{id:"g",x:38,y:4,width:6,height:12,rotation:0},{id:"h",x:47,y:13,width:6,height:12,rotation:90},{id:"i",x:32.74,y:23.59,width:5,height:10,rotation:135},{id:"j",x:35.06,y:19.5,width:4,height:6,rotation:45},{id:"k",x:22.07,y:10.17,width:5,height:10,rotation:-45},{id:"l",x:20.72,y:18.23,width:4,height:6,rotation:45}],walls:[{id:"wa",x:38,y:6,shape:"C-4-8-4",rotation:0},{id:"wb",x:18,y:30,shape:"C-4-8-4",rotation:180},{id:"wc",x:13.33,y:20.15,shape:"L-4x8-mirror",rotation:-90},{id:"wd",x:49.67,y:15.93,shape:"L-4x8-mirror",rotation:90},{id:"we",x:48.2,y:30.88,shape:"L-4x8",rotation:0},{id:"wf",x:7.84,y:5.01,shape:"L-4x8",rotation:180},{id:"wg",x:27.06,y:11.52,shape:"L-4x8-mirror",rotation:-45},{id:"wh",x:35.81,y:24.24,shape:"L-4x8-mirror",rotation:135}]},{name:"Layout 2",terrains:[{id:"a",x:31,y:7,width:4,height:6,rotation:-90},{id:"b",x:25,y:30,width:4,height:6,rotation:90},{id:"c",x:5,y:4,width:6,height:12,rotation:0},{id:"d",x:49,y:28,width:6,height:12,rotation:0},{id:"e",x:46,y:4,width:6,height:12,rotation:0},{id:"f",x:16.46,y:15.77,width:6,height:12,rotation:132.1},{id:"g",x:53,y:15,width:4,height:6,rotation:90},{id:"h",x:8,y:28,width:6,height:12,rotation:0},{id:"i",x:3,y:23,width:4,height:6,rotation:90},{id:"j",x:32.62,y:32.55,width:5,height:10,rotation:-90},{id:"k",x:22.48,y:.51,width:5,height:10,rotation:-90},{id:"l",x:37.5,y:16.2,width:6,height:12,rotation:132.1}],walls:[{id:"wa",x:49,y:32,shape:"L-4x8",rotation:0},{id:"wb",x:7,y:4,shape:"L-4x8",rotation:180},{id:"wc",x:46,y:8,shape:"L-4x8",rotation:0},{id:"wd",x:10,y:28,shape:"L-4x8",rotation:180},{id:"we",x:35.07,y:34.56,shape:"L-5x6-mirror",rotation:-90},{id:"wf",x:29.09,y:2.47,shape:"L-5x6-mirror",rotation:90},{id:"wg",x:17.86,y:17.53,shape:"C-4-8-4",rotation:135},{id:"wh",x:37.24,y:18.38,shape:"C-4-8-4",rotation:-45}]},{name:"Layout 3",terrains:[{id:"a",x:11,y:3,width:4,height:6,rotation:90},{id:"b",x:45,y:35,width:4,height:6,rotation:90},{id:"c",x:25,y:1,width:6,height:12,rotation:90},{id:"d",x:29,y:31,width:6,height:12,rotation:90},{id:"e",x:7.74,y:26.05,width:6,height:12,rotation:125.31},{id:"f",x:46.34,y:5.51,width:6,height:12,rotation:121.72},{id:"g",x:5.14,y:10.46,width:6,height:12,rotation:41.51},{id:"h",x:48.67,y:21.52,width:6,height:12,rotation:41.51},{id:"i",x:19.59,y:14.36,width:5,height:10,rotation:-38.13},{id:"j",x:20.69,y:24.37,width:4,height:6,rotation:-39.33},{id:"k",x:35.34,y:19.61,width:5,height:10,rotation:-38.13},{id:"l",x:35.31,y:13.5,width:4,height:6,rotation:-39.33}],walls:[{id:"aa",x:30,y:32,shape:"C-4-8-4",rotation:90},{id:"ab",x:26,y:4,shape:"C-4-8-4",rotation:-90},{id:"ac",x:8.19,y:11.64,shape:"L-4x8",rotation:222.46},{id:"ad",x:47.79,y:24.3,shape:"L-4x8",rotation:41.26},{id:"ae",x:38.64,y:20.09,shape:"L-5x6-mirror",rotation:141.31},{id:"af",x:25.26,y:17.9,shape:"L-5x6-mirror",rotation:-37.61},{id:"ag",x:14.37,y:28.38,shape:"L-4x8-mirror",rotation:-54.26},{id:"ah",x:48.75,y:7.3,shape:"L-4x8-mirror",rotation:122.02}]},{name:"Layout 4",terrains:[{id:"a",x:15,y:1,width:6,height:12,rotation:90},{id:"b",x:8,y:10,width:4,height:6,rotation:0},{id:"c",x:4,y:19,width:4,height:6,rotation:0},{id:"d",x:7.5,y:27.68,width:6,height:12,rotation:-48.57},{id:"e",x:46.53,y:4.24,width:6,height:12,rotation:-48.57},{id:"f",x:52,y:19,width:4,height:6,rotation:0},{id:"g",x:48,y:28,width:4,height:6,rotation:0},{id:"h",x:39,y:31,width:6,height:12,rotation:90},{id:"i",x:33.03,y:2.97,width:6,height:12,rotation:-37.25},{id:"j",x:20.96,y:28.96,width:6,height:12,rotation:-37.25},{id:"k",x:16.93,y:16.51,width:5,height:10,rotation:-41.85},{id:"l",x:37.96,y:17.43,width:5,height:10,rotation:-41.85}],walls:[{id:"aa",x:18,y:4,shape:"L-4x8",rotation:-90},{id:"ab",x:9.04,y:29.01,shape:"C-4-8-4",rotation:131.97},{id:"ac",x:47,y:7,shape:"C-4-8-4",rotation:-48.54},{id:"ad",x:38,y:32,shape:"L-4x8",rotation:90},{id:"ae",x:34.42,y:7.12,shape:"L-4x8",rotation:-37.53},{id:"af",x:21.57,y:28.8,shape:"L-4x8",rotation:142.46},{id:"ag",x:15.7,y:17.01,shape:"L-5x6",rotation:137.87},{id:"ah",x:39.17,y:20.85,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 5",terrains:[{id:"aa",x:27,y:1,width:6,height:12,rotation:90},{id:"ab",x:36.53,y:12.48,width:5,height:10,rotation:-90},{id:"ac",x:13,y:3,width:4,height:6,rotation:90},{id:"ad",x:43,y:35,width:4,height:6,rotation:90},{id:"ae",x:27,y:31,width:6,height:12,rotation:90},{id:"af",x:18.43,y:21.49,width:5,height:10,rotation:-90},{id:"ag",x:1,y:23,width:4,height:6,rotation:90},{id:"ah",x:55,y:15,width:4,height:6,rotation:90},{id:"ai",x:7.83,y:30.22,width:6,height:12,rotation:-60},{id:"aj",x:46.32,y:1.58,width:6,height:12,rotation:-60},{id:"ak",x:8.74,y:10.19,width:6,height:12,rotation:65.22},{id:"al",x:45.22,y:21.75,width:6,height:12,rotation:65.22}],walls:[{id:"a1",x:28,y:32,shape:"C-4-8-4",rotation:90},{id:"a2",x:28,y:4,shape:"C-4-8-4",rotation:-90},{id:"a3",x:11.88,y:12.29,shape:"L-4x8",rotation:-114.74},{id:"a4",x:43.97,y:23.59,shape:"L-4x8",rotation:64.22},{id:"a5",x:24.91,y:23.52,shape:"L-5x6-mirror",rotation:-90.37},{id:"a6",x:39,y:14.51,shape:"L-5x6-mirror",rotation:89.9},{id:"a7",x:7.58,y:30.57,shape:"L-4x8",rotation:120.93},{id:"a8",x:48.51,y:5.28,shape:"L-4x8",rotation:-59.06}]},{name:"Layout 6",terrains:[{id:"aa",x:13,y:1,width:6,height:12,rotation:90},{id:"ab",x:6,y:10,width:4,height:6,rotation:0},{id:"ac",x:25,y:11,width:4,height:6,rotation:90},{id:"ad",x:7.34,y:27.57,width:6,height:12,rotation:-40.32},{id:"ae",x:46.69,y:4.57,width:6,height:12,rotation:-41.9},{id:"af",x:31,y:27,width:4,height:6,rotation:-90},{id:"ag",x:50,y:28,width:4,height:6,rotation:0},{id:"ah",x:41,y:31,width:6,height:12,rotation:90},{id:"ai",x:34,y:4,width:6,height:12,rotation:0},{id:"aj",x:20,y:28,width:6,height:12,rotation:0},{id:"ak",x:15.7,y:15.03,width:5,height:10,rotation:-41.85},{id:"al",x:39.43,y:19.24,width:5,height:10,rotation:-39.95}],walls:[{id:"a1",x:16,y:4,shape:"L-4x8",rotation:-90},{id:"a2",x:9.04,y:29.01,shape:"C-4-8-4",rotation:140.05},{id:"a3",x:47,y:7.16,shape:"C-4-8-4",rotation:-41.53},{id:"a4",x:40,y:32,shape:"L-4x8",rotation:90},{id:"a5",x:34.15,y:7.88,shape:"L-4x8",rotation:0},{id:"a6",x:22,y:28,shape:"L-4x8",rotation:180},{id:"a7",x:14.47,y:15.47,shape:"L-5x6",rotation:137.87},{id:"a8",x:40.53,y:22.78,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 7",terrains:[{id:"aa",x:8,y:8,width:6,height:12,rotation:0},{id:"ab",x:6,y:28,width:6,height:12,rotation:0},{id:"ac",x:7,y:39,width:4,height:6,rotation:90},{id:"ad",x:18,y:26,width:5,height:10,rotation:0},{id:"ae",x:19,y:20,width:4,height:6,rotation:0},{id:"af",x:23,y:3,width:6,height:12,rotation:0},{id:"ag",x:31,y:29,width:6,height:12,rotation:0},{id:"ah",x:37,y:18,width:4,height:6,rotation:0},{id:"ai",x:37,y:8,width:5,height:10,rotation:0},{id:"aj",x:46,y:24,width:6,height:12,rotation:0},{id:"ak",x:48,y:4,width:6,height:12,rotation:0},{id:"al",x:49,y:-1,width:4,height:6,rotation:90}],walls:[{id:"a1",x:9,y:10,shape:"L-5x6",rotation:180},{id:"a2",x:11.44,y:31.97,shape:"L-4x8-mirror",rotation:0},{id:"a3",x:19,y:20,shape:"L-4x6",rotation:180},{id:"a4",x:22.53,y:30.02,shape:"L-5x6-mirror",rotation:0},{id:"a5",x:25,y:5,shape:"C-4-8-4",rotation:180},{id:"a6",x:31,y:31,shape:"C-4-8-4",rotation:0},{id:"a7",x:37,y:18,shape:"L-4x6",rotation:0},{id:"a8",x:41.51,y:8.09,shape:"L-5x6-mirror",rotation:180},{id:"a9",x:46,y:28,shape:"L-5x6",rotation:0},{id:"a10",x:51.51,y:4.01,shape:"L-4x8-mirror",rotation:180}]},{name:"Layout 8",terrains:[{id:"aa",x:23,y:22,width:4,height:6,rotation:0},{id:"ab",x:23,y:28,width:4,height:6,rotation:0},{id:"ac",x:33,y:16,width:4,height:6,rotation:0},{id:"ad",x:33,y:10,width:4,height:6,rotation:0},{id:"ae",x:41,y:19,width:6,height:12,rotation:0},{id:"af",x:13,y:13,width:6,height:12,rotation:0},{id:"ag",x:32,y:32,width:6,height:12,rotation:0},{id:"ah",x:22,y:0,width:6,height:12,rotation:0},{id:"ai",x:9.5,y:27.68,width:6,height:12,rotation:-48.69},{id:"aj",x:44.51,y:4.35,width:6,height:12,rotation:-48.69},{id:"ak",x:6.95,y:4,width:5,height:10,rotation:53.9},{id:"al",x:48,y:30,width:5,height:10,rotation:53.9}],walls:[{id:"a1",x:32,y:34,shape:"C-4-8-4",rotation:0},{id:"a2",x:24,y:2,shape:"C-4-8-4",rotation:180},{id:"a3",x:44.68,y:19.06,shape:"L-4x8-mirror",rotation:180},{id:"a4",x:18.43,y:16.91,shape:"L-4x8-mirror",rotation:0},{id:"a5",x:46.38,y:33.13,shape:"L-5x6",rotation:52.87},{id:"a6",x:8.55,y:4.89,shape:"L-5x6",rotation:-127.66},{id:"a7",x:16,y:30.28,shape:"L-4x8-mirror",rotation:-48.62},{id:"a8",x:46.91,y:5.85,shape:"L-4x8-mirror",rotation:132.19}]}]},{id:"uktc",name:"UKTC",description:"UK Team Championship layouts",presets:[{name:"UKTC 1",terrains:[{id:"a",x:15,y:16,width:6,height:12,rotation:0},{id:"b",x:39,y:16,width:6,height:12,rotation:0}],walls:[]},{name:"UKTC 2",terrains:[{id:"a",x:15,y:16,width:6,height:12,rotation:0},{id:"b",x:39,y:16,width:6,height:12,rotation:0}],walls:[]}]},{id:"wtc",name:"WTC",description:"World Team Championship layouts",presets:[{name:"WTC 1",terrains:[{id:"a",x:15,y:16,width:6,height:12,rotation:0},{id:"b",x:39,y:16,width:6,height:12,rotation:0}],walls:[]},{name:"WTC 2",terrains:[{id:"a",x:15,y:16,width:6,height:12,rotation:0},{id:"b",x:39,y:16,width:6,height:12,rotation:0}],walls:[]}]}],hl=ml.flatMap(t=>t.presets);function fu(){return"terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function qa(){const t=localStorage.getItem(cl);if(t)try{return JSON.parse(t)}catch(n){return console.error("Failed to parse saved layouts:",n),{}}return{}}function Us(t){localStorage.setItem(cl,JSON.stringify(t))}function fl(){const{subscribe:t,set:n,update:a}=gn([]);return{subscribe:t,set:n,update:a,add(s,r){a(i=>[...i,{id:fu(),x:30-s/2,y:22-r/2,width:s,height:r,rotation:0}])},updateTerrain(s,r){a(i=>i.map(l=>l.id===s?{...l,...r}:l))},remove(s){a(r=>r.filter(i=>i.id!==s))},clear(){n([])},save(s){const r=aa({subscribe:t}),i=qa();i[s]={terrains:r,savedAt:Date.now()},Us(i)},load(s){const r=qa();return r[s]?(n(r[s].terrains),!0):!1},deleteLayout(s){const r=qa();delete r[s],Us(r)},getSavedLayoutNames(){const s=qa();return Object.keys(s).map(r=>({name:r,savedAt:s[r].savedAt,terrainCount:s[r].terrains.length})).sort((r,i)=>i.savedAt-r.savedAt)},hasSaved(){const s=qa();return Object.keys(s).length>0}}}const xa=fl();function pl(){const{subscribe:t,set:n,update:a}=gn([]);return{subscribe:t,set:n,update:a,add(s){a(r=>[...r,{id:"wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),x:30,y:22,shape:s,rotation:0}])},updateWall(s,r){a(i=>i.map(l=>l.id===s?{...l,...r}:l))},remove(s){a(r=>r.filter(i=>i.id!==s))},clear(){n([])}}}const _a=pl(),Rs=fl(),Ds=pl(),os=gn(null),ls=gn(null);function $s(t){const n=t.includes("-mirror"),a=t.replace("-mirror","");if(a.startsWith("L-")){const s=a.match(/L-(\d+)x(\d+)/);if(s)return{type:"L",segments:[parseInt(s[1]),parseInt(s[2])],mirrored:n}}else if(a.startsWith("C-")){const s=a.match(/C-(\d+)-(\d+)-(\d+)/);if(s)return{type:"C",segments:[parseInt(s[1]),parseInt(s[2]),parseInt(s[3])],mirrored:n}}return{type:"L",segments:[4,8],mirrored:!1}}function Ca(t,n=null){const r=$s(t),i=n||r.segments,l=r.mirrored;if(r.type==="L"){const[c,d]=i;return l?[{x:0,y:0},{x:.5,y:0},{x:.5,y:d},{x:-c+.5,y:d},{x:-c+.5,y:d-.5},{x:0,y:d-.5}]:[{x:0,y:0},{x:.5,y:0},{x:.5,y:d-.5},{x:c,y:d-.5},{x:c,y:d},{x:0,y:d}]}else if(r.type==="C"){const[c,d,h]=i;return[{x:0,y:0},{x:h,y:0},{x:h,y:.5},{x:.5,y:.5},{x:.5,y:d-.5},{x:c,y:d-.5},{x:c,y:d},{x:0,y:d}]}return[]}function ws(t,n,a,s){if(t.length===0)return[];const r=t.map(E=>E.x),i=t.map(E=>E.y),l=Math.min(...r),c=Math.max(...r),d=Math.min(...i),h=Math.max(...i),y=c-l,p=h-d,m=n+l+y/2,f=a+d+p/2,v=s*Math.PI/180,A=Math.cos(v),T=Math.sin(v);return t.map(E=>{const P=n+E.x,M=a+E.y,k=P-m,D=M-f;return{x:m+k*A-D*T,y:f+k*T+D*A}})}Pa(_a,t=>t.map(n=>ws(Ca(n.shape,n.segments),n.x,n.y,n.rotation)));const Oa=gn(null),Wa=gn(null),Ei=gn([]);function pu(t,n=[]){const a=aa(xa),s=aa(_a),r=qa();r[t]={terrains:a,walls:s,models:n,savedAt:Date.now()},Us(r)}function yu(t){const n=qa();return n[t]?(xa.set(n[t].terrains||[]),_a.set(n[t].walls||[]),{terrains:n[t].terrains||[],walls:n[t].walls||[],models:n[t].models||[]}):null}function vu(t){const n=qa();delete n[t],Us(n)}function gu(){const t=qa();return Object.keys(t).map(n=>({name:n,savedAt:t[n].savedAt,terrainCount:(t[n].terrains||[]).length,wallCount:(t[n].walls||[]).length,modelCount:(t[n].models||[]).length})).sort((n,a)=>a.savedAt-n.savedAt)}function Ps(){Ei.set(gu())}function yl(){const{subscribe:t,set:n,update:a}=gn({past:[],future:[]});return{subscribe:t,push(s){a(r=>({past:[...r.past,s],future:[]}))},undo(){let s=null;return a(r=>{if(r.past.length===0)return r;const i=[...r.past];return s=i.pop(),{past:i,future:[s,...r.future]}}),s},redo(){let s=null;return a(r=>{if(r.future.length===0)return r;const i=[...r.future];return s=i.shift(),{past:[...r.past,s],future:i}}),s},canUndo(){return aa({subscribe:t}).past.length>0},canRedo(){return aa({subscribe:t}).future.length>0},clear(){n({past:[],future:[]})}}}const In=yl(),hi=yl(),bu=2;function Tu(t,n){const a=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)),s=ji(t),r=ji(n);return Math.max(0,a-s-r)}function ji(t){const n=Sn(t.baseType,t);return n?zn(t.baseType)?Math.min(t.customWidth,t.customHeight)/2:vn(t.baseType)?Math.min(n.width,n.height)/2:n.radius:.5}function xu(t){const n=new Map;for(const a of t)n.set(a.id,new Set);for(let a=0;a<t.length;a++)for(let s=a+1;s<t.length;s++)Tu(t[a],t[s])<=bu&&(n.get(t[a].id).add(t[s].id),n.get(t[s].id).add(t[a].id));return n}function _u(t,n){const a=new Set,s=[];for(const r of t){if(a.has(r.id))continue;const i=new Set,l=[r.id];for(;l.length>0;){const c=l.shift();if(!a.has(c)){a.add(c),i.add(c);for(const d of n.get(c))a.has(d)||l.push(d)}}s.push(i)}return s}function wu(t){if(t.length<=1)return{isCoherent:!0,violations:new Map};const n=t.length>=7?2:1,a=xu(t),s=_u(t,a),r=new Map;s.length;let i=s[0];for(const l of s)l.size>i.size&&(i=l);for(const l of t){const c=a.get(l.id).size,d=i.has(l.id);c>=n&&d||r.set(l.id,{model:l,requiredCount:n,actualCount:c,isDisconnected:!d,componentSize:s.find(p=>p.has(l.id))?.size||0})}return{isCoherent:r.size===0,violations:r,componentCount:s.length}}function Su(t){const n=new Map,a=new Map;for(const s of t)s.unitId&&(a.has(s.unitId)||a.set(s.unitId,[]),a.get(s.unitId).push(s));for(const[s,r]of a){const i=wu(r),l=r.length>=7?2:1;for(const c of r){const d=i.violations.get(c.id);n.set(c.id,{inCoherency:!d,requiredCount:l,actualCount:d?d.actualCount:l,unitSize:r.length,isDisconnected:d?.isDisconnected||!1,componentCount:i.componentCount})}}return n}const nn=1/25.4,ra={circles:[{type:"25mm",radius:25*nn/2,label:"25mm"},{type:"28.5mm",radius:28.5*nn/2,label:"28mm.5"},{type:"32mm",radius:32*nn/2,label:"32mm"},{type:"40mm",radius:40*nn/2,label:"40mm"},{type:"50mm",radius:50*nn/2,label:"50mm"},{type:"60mm",radius:60*nn/2,label:"60mm"},{type:"80mm",radius:80*nn/2,label:"80mm"},{type:"90mm",radius:90*nn/2,label:"90mm"},{type:"100mm",radius:100*nn/2,label:"100mm"},{type:"130mm",radius:130*nn/2,label:"130mm"},{type:"160mm",radius:160*nn/2,label:"160mm"}],ovals:[{type:"60x35.5mm",width:60*nn,height:35.5*nn,label:"60×35.5mm"},{type:"75x42mm",width:75*nn,height:42*nn,label:"75×42mm"},{type:"Small Flying Base",width:75*nn,height:42*nn,label:"Small Flying"},{type:"90x52.5mm",width:90*nn,height:52.5*nn,label:"90×52.5mm"},{type:"Large Flying Base",width:90*nn,height:52.5*nn,label:"Large Flying"},{type:"105x70mm",width:105*nn,height:70*nn,label:"105×70mm"},{type:"120x92mm",width:120*nn,height:92*nn,label:"120×92mm"},{type:"150x95mm",width:150*nn,height:95*nn,label:"150×95mm"},{type:"170x109mm",width:170*nn,height:109*nn,label:"170×109mm"}]};function Sn(t,n=null){const a=ra.circles.find(r=>r.type===t);if(a)return a;const s=ra.ovals.find(r=>r.type===t);return s||(zn(t)&&n?{type:t,width:n.customWidth,height:n.customHeight,label:`${n.customWidth.toFixed(1)}"×${n.customHeight.toFixed(1)}"`}:null)}function vn(t){return ra.ovals.some(n=>n.type===t)}function zn(t){return t&&t.startsWith("rect-")}function Ji(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function vl(t){const{subscribe:n,set:a,update:s}=gn([]);return{subscribe:n,set:a,update:s,add(r,i,l,c,d=null,h=!1){const y=Ji(),p={id:y,baseType:r,playerId:i,x:l,y:c,rotation:0};return d&&d.width&&d.height&&(p.customWidth=d.width,p.customHeight=d.height),s(m=>[...m,p]),!h&&t&&t.push({type:"add",modelId:y,model:{...p}}),y},updateModel(r,i,l=!1){let c=null,d=null;if(!l&&t){const y=aa({subscribe:n}).find(p=>p.id===r);y&&(c={...y},"x"in i||"y"in i?d="move":"rotation"in i&&(d="rotate"))}if(s(h=>h.map(y=>y.id===r?{...y,...i}:y)),!l&&t&&d&&c){const y=aa({subscribe:n}).find(p=>p.id===r);t.push({type:d,modelId:r,before:d==="move"?{x:c.x,y:c.y}:{rotation:c.rotation},after:d==="move"?{x:y.x,y:y.y}:{rotation:y.rotation}})}},remove(r,i=!1){let l=null;!i&&t&&(l=aa({subscribe:n}).find(d=>d.id===r)),s(c=>c.filter(d=>d.id!==r)),!i&&t&&l&&t.push({type:"remove",modelId:r,model:{...l}})},removeByPlayer(r){s(i=>i.filter(l=>l.playerId!==r))},addBatch(r,i=!1){const l=[];return s(c=>{const d=[...c];return r.forEach(h=>{const y=h.id||Ji(),p={...h,id:y};d.push(p),l.push(y),!i&&t&&t.push({type:"add",modelId:y,model:{...p}})}),d}),l},updateUnit(r,i,l=!1){s(c=>c.map(d=>d.unitId===r?{...d,...i}:d))},removeUnit(r,i=!1){const l=[];if(!i&&t){const c=aa({subscribe:n});l.push(...c.filter(d=>d.unitId===r))}s(c=>c.filter(d=>d.unitId!==r)),!i&&t&&l.forEach(c=>{t.push({type:"remove",modelId:c.id,model:{...c}})})},groupModels(r,i=!1){if(r.length<2)return null;const l=aa({subscribe:n}),c=r.map(p=>l.find(m=>m.id===p)).filter(Boolean);if(c.length<2||[...new Set(c.map(p=>p.playerId))].length>1)return null;const h="unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),y={};return c.forEach(p=>{y[p.id]=p.unitId||null}),s(p=>p.map(m=>r.includes(m.id)?{...m,unitId:h}:m)),!i&&t&&t.push({type:"group",modelIds:[...r],unitId:h,previousUnitIds:y}),h},ungroupModels(r,i=!1){const l=aa({subscribe:n}),c={};r.forEach(d=>{const h=l.find(y=>y.id===d);h&&(c[d]=h.unitId||null)}),s(d=>d.map(h=>r.includes(h.id)?{...h,unitId:null}:h)),!i&&t&&t.push({type:"ungroup",modelIds:[...r],previousUnitIds:c})},clear(){a([]),t&&t.clear()},undo(){if(!t)return;const r=t.undo();if(r)switch(r.type){case"add":this.remove(r.modelId,!0);break;case"remove":s(i=>[...i,r.model]);break;case"move":this.updateModel(r.modelId,r.before,!0);break;case"rotate":this.updateModel(r.modelId,r.before,!0);break;case"group":s(i=>i.map(l=>r.modelIds.includes(l.id)?{...l,unitId:r.previousUnitIds[l.id]}:l));break;case"ungroup":s(i=>i.map(l=>r.modelIds.includes(l.id)?{...l,unitId:r.previousUnitIds[l.id]}:l));break}},redo(){if(!t)return;const r=t.redo();if(r)switch(r.type){case"add":s(i=>[...i,r.model]);break;case"remove":this.remove(r.modelId,!0);break;case"move":this.updateModel(r.modelId,r.after,!0);break;case"rotate":this.updateModel(r.modelId,r.after,!0);break;case"group":s(i=>i.map(l=>r.modelIds.includes(l.id)?{...l,unitId:r.unitId}:l));break;case"ungroup":s(i=>i.map(l=>r.modelIds.includes(l.id)?{...l,unitId:null}:l));break}}}}const ct=vl(In),gl=Pa(ct,t=>t.filter(n=>n.playerId===1)),bl=Pa(ct,t=>t.filter(n=>n.playerId===2)),ku=gn(null);Pa([ct,ku],([t,n])=>n?t.find(a=>a.id===n):null);const tr=vl(hi),nr=gn(null);Pa([tr,nr],([t,n])=>n?t.find(a=>a.id===n):null);Pa(ct,t=>{const n=new Map;return t.forEach(a=>{a.unitId&&(n.has(a.unitId)||n.set(a.unitId,{unitId:a.unitId,playerId:a.playerId,models:[]}),n.get(a.unitId).models.push(a))}),Array.from(n.values())});const Au=Pa(ct,t=>Su(t)),Ns=gn({zoom:1,panX:0,panY:0});function Cu(){Ns.set({zoom:1,panX:0,panY:0})}var Eu=he('<line stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-1lx01iv"></circle>',1),Mu=he('<g><g><rect role="button" tabindex="0" class="svelte-1lx01iv"></rect></g><!></g>');function Ru(t,n){Vn(n,!1);const a=W(),s=W(),r=W(),i=W(),l=W();let c=we(n,"id",8),d=we(n,"x",8),h=we(n,"y",8),y=we(n,"width",8),p=we(n,"height",8),m=we(n,"rotation",8,0),f=we(n,"selected",8,!1),v=we(n,"screenToSvg",8),A=we(n,"onSelect",8,()=>{}),T=we(n,"onDrag",8,()=>{}),E=we(n,"onRotate",8,()=>{}),P=W(!1),M=!1,k={x:0,y:0};function D(be){be.stopPropagation(),A()(c())}function $(be){if(be.button!==0)return;be.preventDefault(),be.stopPropagation(),A()(c()),b(P,!0);const te=v()(be.clientX,be.clientY);k={x:te.x-d(),y:te.y-h()},window.addEventListener("mousemove",B),window.addEventListener("mouseup",F)}function B(be){if(!e(P))return;const te=v()(be.clientX,be.clientY);let Ae=te.x-k.x,ue=te.y-k.y;be.shiftKey||(Ae=Math.round(Ae),ue=Math.round(ue));const le=Math.max(y(),p())/2;Ae=Math.max(-le,Math.min(st.width-y()+le,Ae)),ue=Math.max(-le,Math.min(st.height-p()+le,ue)),T()(c(),Ae,ue)}function F(){b(P,!1),window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",F)}function G(be){be.preventDefault(),be.stopPropagation(),M=!0,window.addEventListener("mousemove",q),window.addEventListener("mouseup",ie)}function q(be){if(!M)return;const te=v()(be.clientX,be.clientY),Ae=te.x-e(a),ue=te.y-e(s);let le=Math.atan2(ue,Ae)*180/Math.PI+45;be.shiftKey||(le=Math.round(le/15)*15),E()(c(),le)}function ie(){M=!1,window.removeEventListener("mousemove",q),window.removeEventListener("mouseup",ie)}me(()=>(L(d()),L(y())),()=>{b(a,d()+y()/2)}),me(()=>(L(h()),L(p())),()=>{b(s,h()+p()/2)}),me(()=>(L(y()),L(p())),()=>{b(r,Math.max(y(),p())/2+1.5)}),me(()=>(e(a),e(r),L(m())),()=>{b(i,e(a)+e(r)*Math.cos((m()-45)*Math.PI/180))}),me(()=>(e(s),e(r),L(m())),()=>{b(l,e(s)+e(r)*Math.sin((m()-45)*Math.PI/180))}),$a(),ia();var ee=Mu();let fe;var se=x(ee),ae=x(se),De=g(se);{var ve=be=>{var te=Eu(),Ae=ce(te),ue=g(Ae);U(()=>{u(Ae,"x1",e(a)),u(Ae,"y1",e(s)),u(Ae,"x2",e(i)),u(Ae,"y2",e(l)),u(Ae,"stroke",(L(re),o(()=>re.selection.highlight))),u(ue,"cx",e(i)),u(ue,"cy",e(l)),u(ue,"fill",(L(re),o(()=>re.selection.highlight))),u(ue,"stroke",(L(re),o(()=>re.selection.highlightDark)))}),ne("mousedown",ue,G),w(be,te)};j(De,be=>{f()&&be(ve)})}U(()=>{fe=Mn(ee,0,"terrain-rect svelte-1lx01iv",null,fe,{selected:f(),dragging:e(P)}),u(se,"transform",`rotate(${m()??""}, ${e(a)??""}, ${e(s)??""})`),u(ae,"x",d()),u(ae,"y",h()),u(ae,"width",y()),u(ae,"height",p()),u(ae,"fill",(L(f()),L(re),o(()=>f()?re.terrain.fillSelected:re.terrain.fill))),u(ae,"stroke",(L(f()),L(re),o(()=>f()?re.selection.highlight:re.terrain.stroke))),u(ae,"stroke-width",f()?.15:.1)}),ne("click",ae,D),ne("mousedown",ae,$),w(t,ee),jn()}var Du=he('<line stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-x1kcna"></circle>',1),Iu=he('<g><g><path role="button" tabindex="0" class="svelte-x1kcna"></path></g><!></g>');function Mi(t,n){Vn(n,!1);const a=W(),s=W(),r=W(),i=W(),l=W(),c=W(),d=W(),h=W(),y=W(),p=W();let m=we(n,"id",8),f=we(n,"x",8),v=we(n,"y",8),A=we(n,"shape",8),T=we(n,"segments",8,null),E=we(n,"rotation",8,0),P=we(n,"selected",8,!1),M=we(n,"screenToSvg",8),k=we(n,"onSelect",8,()=>{}),D=we(n,"onDrag",8,()=>{}),$=we(n,"onRotate",8,()=>{});function B(ge){const Pe=ge.map(bt=>bt.x),de=ge.map(bt=>bt.y);return{minX:Math.min(...Pe),maxX:Math.max(...Pe),minY:Math.min(...de),maxY:Math.max(...de)}}let F=W(!1),G=!1,q={x:0,y:0};function ie(ge){ge.stopPropagation(),k()(m())}function ee(ge){if(ge.button!==0)return;ge.preventDefault(),ge.stopPropagation(),k()(m()),b(F,!0);const Pe=M()(ge.clientX,ge.clientY);q={x:Pe.x-f(),y:Pe.y-v()},window.addEventListener("mousemove",fe),window.addEventListener("mouseup",se)}function fe(ge){if(!e(F))return;const Pe=M()(ge.clientX,ge.clientY);let de=Pe.x-q.x,bt=Pe.y-q.y;ge.shiftKey||(de=Math.round(de),bt=Math.round(bt));const ut=Math.max(e(r),e(i));de=Math.max(-ut,Math.min(st.width+ut-e(r),de)),bt=Math.max(-ut,Math.min(st.height+ut-e(i),bt)),D()(m(),de,bt)}function se(){b(F,!1),window.removeEventListener("mousemove",fe),window.removeEventListener("mouseup",se)}function ae(ge){ge.preventDefault(),ge.stopPropagation(),G=!0,window.addEventListener("mousemove",De),window.addEventListener("mouseup",ve)}function De(ge){if(!G)return;const Pe=M()(ge.clientX,ge.clientY),de=Pe.x-e(l),bt=Pe.y-e(c);let ut=Math.atan2(bt,de)*180/Math.PI+45;ge.shiftKey||(ut=Math.round(ut/15)*15),$()(m(),ut)}function ve(){G=!1,window.removeEventListener("mousemove",De),window.removeEventListener("mouseup",ve)}me(()=>(L(A()),L(T())),()=>{b(a,Ca(A(),T()))}),me(()=>e(a),()=>{b(s,B(e(a)))}),me(()=>e(s),()=>{b(r,e(s).maxX-e(s).minX)}),me(()=>e(s),()=>{b(i,e(s).maxY-e(s).minY)}),me(()=>(L(f()),e(s),e(r)),()=>{b(l,f()+e(s).minX+e(r)/2)}),me(()=>(L(v()),e(s),e(i)),()=>{b(c,v()+e(s).minY+e(i)/2)}),me(()=>(e(a),L(f()),L(v())),()=>{b(d,e(a).length>0?`M ${e(a).map(ge=>`${f()+ge.x},${v()+ge.y}`).join(" L ")} Z`:"")}),me(()=>(e(r),e(i)),()=>{b(h,Math.max(e(r),e(i))/2+1.5)}),me(()=>(e(l),e(h),L(E())),()=>{b(y,e(l)+e(h)*Math.cos((E()-45)*Math.PI/180))}),me(()=>(e(c),e(h),L(E())),()=>{b(p,e(c)+e(h)*Math.sin((E()-45)*Math.PI/180))}),$a(),ia();var be=Iu();let te;var Ae=x(be),ue=x(Ae),le=g(Ae);{var Xe=ge=>{var Pe=Du(),de=ce(Pe),bt=g(de);U(()=>{u(de,"x1",e(l)),u(de,"y1",e(c)),u(de,"x2",e(y)),u(de,"y2",e(p)),u(de,"stroke",(L(re),o(()=>re.selection.highlight))),u(bt,"cx",e(y)),u(bt,"cy",e(p)),u(bt,"fill",(L(re),o(()=>re.selection.highlight))),u(bt,"stroke",(L(re),o(()=>re.selection.highlightDark)))}),ne("mousedown",bt,ae),w(ge,Pe)};j(le,ge=>{P()&&ge(Xe)})}U(()=>{te=Mn(be,0,"wall-piece svelte-x1kcna",null,te,{selected:P(),dragging:e(F)}),u(Ae,"transform",`rotate(${E()??""}, ${e(l)??""}, ${e(c)??""})`),u(ue,"d",e(d)),u(ue,"fill",(L(P()),L(re),o(()=>P()?re.wall.fillSelected:re.wall.fill))),u(ue,"stroke",(L(P()),L(re),o(()=>P()?re.selection.highlight:re.wall.stroke))),u(ue,"stroke-width",P()?.15:.1)}),ne("click",ue,ie),ne("mousedown",ue,ee),w(t,be),jn()}var Lu=he('<g class="svelte-1vg3k6o"><rect role="button" tabindex="0" class="svelte-1vg3k6o"></rect></g>'),$u=he('<g class="svelte-1vg3k6o"><ellipse role="button" tabindex="0" class="svelte-1vg3k6o"></ellipse></g>'),Pu=he('<circle role="button" tabindex="0" class="svelte-1vg3k6o"></circle>'),Nu=he('<text text-anchor="middle" dominant-baseline="middle" font-weight="bold" fill="white" stroke="black" stroke-width="0.02" paint-order="stroke" pointer-events="none" class="model-name svelte-1vg3k6o"> </text>'),Ou=he('<line stroke-width="0.1" stroke-dasharray="0.3,0.15" class="svelte-1vg3k6o"></line><circle r="0.8" stroke-width="0.1" role="button" tabindex="0" class="rotate-handle svelte-1vg3k6o"></circle><g pointer-events="none" class="svelte-1vg3k6o"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08" class="svelte-1vg3k6o"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08" class="svelte-1vg3k6o"></path></g>',1),Wu=he('<line stroke-width="0.12" stroke-dasharray="0.3,0.15" pointer-events="none" class="svelte-1vg3k6o"></line><circle r="0.25" pointer-events="none" class="svelte-1vg3k6o"></circle><text text-anchor="middle" dominant-baseline="middle" font-size="0.5" font-weight="bold" stroke="#000" stroke-width="0.05" paint-order="stroke" pointer-events="none" class="drag-ruler-label svelte-1vg3k6o"> </text>',1),Yu=he("<g><!><!><!><!></g>");function Ks(t,n){Vn(n,!1);const a=W(),s=W(),r=W(),i=W(),l=W(),c=W(),d=W(),h=W(),y=W(),p=W(),m=W(),f=W(),v=W(),A=W(),T=W(),E=W(),P=W(),M=W(),k=W(),D=W(),$=W(),B=W(),F=W();let G=we(n,"id",8),q=we(n,"x",8),ie=we(n,"y",8),ee=we(n,"baseType",8),fe=we(n,"playerId",8),se=we(n,"rotation",8,0),ae=we(n,"selected",8,!1),De=we(n,"marqueePreview",8,!1),ve=we(n,"inGroupSelection",8,!1),be=we(n,"name",8,""),te=we(n,"customWidth",8,null),Ae=we(n,"customHeight",8,null),ue=we(n,"unitStrokeColor",8,null),le=we(n,"coherencyViolation",8,!1),Xe=we(n,"screenToSvg",8),ge=we(n,"onSelect",8,()=>{}),Pe=we(n,"onDrag",8,()=>{}),de=we(n,"onDragEnd",8,()=>{}),bt=we(n,"onRotate",8,()=>{}),ut=we(n,"onRotateEnd",8,()=>{}),Yt=we(n,"onRename",8,()=>{}),_t=W(!1),it=!1,Tt={x:0,y:0},je=W(null),Qt=null;function Ht(Ce){Ce.stopPropagation()}function zt(Ce){Ce.stopPropagation();const Ee=prompt("Model name:",be());Ee!==null&&Yt()(G(),Ee)}function Ne(Ce){if(Ce.button!==0)return;Ce.preventDefault(),Ce.stopPropagation(),ge()(G(),Ce),b(_t,!0),b(je,{x:q(),y:ie()});const Ee=Xe()(Ce.clientX,Ce.clientY);Tt={x:Ee.x-q(),y:Ee.y-ie()},window.addEventListener("mousemove",Ke),window.addEventListener("mouseup",ze)}function Ke(Ce){if(!e(_t))return;const Ee=Xe()(Ce.clientX,Ce.clientY);let Qe=Ee.x-Tt.x,Lt=Ee.y-Tt.y;Pe()(G(),Qe,Lt)}function ze(){e(_t)&&e(je)&&((e(je).x!==q()||e(je).y!==ie())&&de()(G(),e(je).x,e(je).y,q(),ie()),b(je,null)),b(_t,!1),window.removeEventListener("mousemove",Ke),window.removeEventListener("mouseup",ze)}function xt(Ce){Ce.preventDefault(),Ce.stopPropagation(),it=!0,Qt=se(),window.addEventListener("mousemove",Z),window.addEventListener("mouseup",Ie)}function Z(Ce){if(!it)return;const Ee=Xe()(Ce.clientX,Ce.clientY),Qe=Ee.x-q(),Lt=Ee.y-ie();let jt=Math.atan2(Lt,Qe)*180/Math.PI+45;Ce.shiftKey||(jt=Math.round(jt/15)*15),bt()(G(),jt)}function Ie(){it&&Qt!==null&&(Qt!==se()&&ut()(G(),Qt,se()),Qt=null),it=!1,window.removeEventListener("mousemove",Z),window.removeEventListener("mouseup",Ie)}me(()=>(L(te()),L(Ae())),()=>{b(a,{customWidth:te(),customHeight:Ae()})}),me(()=>(L(ee()),e(a)),()=>{b(s,Sn(ee(),e(a)))}),me(()=>L(ee()),()=>{b(r,vn(ee()))}),me(()=>L(ee()),()=>{b(i,zn(ee()))}),me(()=>L(fe()),()=>{b(l,gs(fe()))}),me(()=>e(l),()=>{b(c,e(l).primary)}),me(()=>e(l),()=>{b(d,e(l).fill)}),me(()=>e(l),()=>{b(h,e(l).fillLight)}),me(()=>(L(ae()),L(De()),L(le())),()=>{b(y,ae()?.15:De()?.12:le()?.15:.1)}),me(()=>(L(ae()),e(c),L(De()),e(h),L(le()),e(d)),()=>{b(p,ae()?e(c):De()?e(h):le()?"rgba(239, 68, 68, 0.3)":e(d))}),me(()=>(L(le()),L(ue()),e(c)),()=>{b(m,le()?"#ef4444":ue()||e(c))}),me(()=>e(s),()=>{b(f,e(s)?.radius||.5)}),me(()=>e(s),()=>{b(v,e(s)?.width?e(s).width/2:0)}),me(()=>e(s),()=>{b(A,e(s)?.height?e(s).height/2:0)}),me(()=>(e(i),L(te())),()=>{b(T,e(i)&&te()||0)}),me(()=>(e(i),L(Ae())),()=>{b(E,e(i)&&Ae()||0)}),me(()=>(e(r),e(v),e(A),e(i),e(T),e(E)),()=>{b(P,e(r)?Math.max(e(v),e(A))+1:e(i)?Math.max(e(T),e(E))/2+1:0)}),me(()=>(L(q()),e(P),L(se())),()=>{b(M,q()+e(P)*Math.cos((se()-45)*Math.PI/180))}),me(()=>(L(ie()),e(P),L(se())),()=>{b(k,ie()+e(P)*Math.sin((se()-45)*Math.PI/180))}),me(()=>(e(_t),e(je),L(q()),L(ie())),()=>{b(D,e(_t)&&e(je)?Math.sqrt(Math.pow(q()-e(je).x,2)+Math.pow(ie()-e(je).y,2)):0)}),me(()=>(e(_t),e(je),L(q())),()=>{b($,e(_t)&&e(je)?(e(je).x+q())/2:0)}),me(()=>(e(_t),e(je),L(ie())),()=>{b(B,e(_t)&&e(je)?(e(je).y+ie())/2:0)}),me(()=>(e(i),e(T),e(E),e(r),e(v),e(A),e(f)),()=>{b(F,e(i)?Math.min(e(T),e(E))*.2:e(r)?Math.min(e(v),e(A))*.4:e(f)*.5)}),$a(),ia();var qe=Yu();let Ct;var pt=x(qe);{var ot=Ce=>{var Ee=Lu(),Qe=x(Ee);U(()=>{u(Ee,"transform",`rotate(${se()??""}, ${q()??""}, ${ie()??""})`),u(Qe,"x",q()-e(T)/2),u(Qe,"y",ie()-e(E)/2),u(Qe,"width",e(T)),u(Qe,"height",e(E)),u(Qe,"fill",e(p)),u(Qe,"stroke",e(m)),u(Qe,"stroke-width",e(y))}),ne("click",Qe,Ht),ne("dblclick",Qe,zt),ne("mousedown",Qe,Ne),w(Ce,Ee)},$t=Ce=>{var Ee=Ge(),Qe=ce(Ee);{var Lt=pn=>{var Bt=$u(),yn=x(Bt);U(()=>{u(Bt,"transform",`rotate(${se()??""}, ${q()??""}, ${ie()??""})`),u(yn,"cx",q()),u(yn,"cy",ie()),u(yn,"rx",e(v)),u(yn,"ry",e(A)),u(yn,"fill",e(p)),u(yn,"stroke",e(m)),u(yn,"stroke-width",e(y))}),ne("click",yn,Ht),ne("dblclick",yn,zt),ne("mousedown",yn,Ne),w(pn,Bt)},jt=pn=>{var Bt=Pu();U(()=>{u(Bt,"cx",q()),u(Bt,"cy",ie()),u(Bt,"r",e(f)),u(Bt,"fill",e(p)),u(Bt,"stroke",e(m)),u(Bt,"stroke-width",e(y))}),ne("click",Bt,Ht),ne("dblclick",Bt,zt),ne("mousedown",Bt,Ne),w(pn,Bt)};j(Qe,pn=>{e(r)?pn(Lt):pn(jt,!1)},!0)}w(Ce,Ee)};j(pt,Ce=>{e(i)?Ce(ot):Ce($t,!1)})}var Ft=g(pt);{var Et=Ce=>{var Ee=Nu(),Qe=x(Ee);U(()=>{u(Ee,"x",q()),u(Ee,"y",ie()),u(Ee,"font-size",e(F)),Le(Qe,be())}),w(Ce,Ee)};j(Ft,Ce=>{be()&&Ce(Et)})}var wt=g(Ft);{var It=Ce=>{var Ee=Ou(),Qe=ce(Ee),Lt=g(Qe),jt=g(Lt);U(()=>{u(Qe,"x1",q()),u(Qe,"y1",ie()),u(Qe,"x2",e(M)),u(Qe,"y2",e(k)),u(Qe,"stroke",(L(re),o(()=>re.selection.handle))),u(Lt,"cx",e(M)),u(Lt,"cy",e(k)),u(Lt,"fill",(L(re),o(()=>re.selection.handle))),u(Lt,"stroke",(L(re),o(()=>re.selection.handleDark))),u(jt,"transform",`translate(${e(M)??""}, ${e(k)??""})`)}),ne("mousedown",Lt,xt),w(Ce,Ee)};j(wt,Ce=>{ae()&&(e(r)||e(i))&&!ve()&&Ce(It)})}var hn=g(wt);{var fn=Ce=>{var Ee=Wu(),Qe=ce(Ee),Lt=g(Qe),jt=g(Lt),pn=x(jt);U(Bt=>{u(Qe,"x1",(e(je),o(()=>e(je).x))),u(Qe,"y1",(e(je),o(()=>e(je).y))),u(Qe,"x2",q()),u(Qe,"y2",ie()),u(Qe,"stroke",(L(re),o(()=>re.selection.dragRuler))),u(Lt,"cx",(e(je),o(()=>e(je).x))),u(Lt,"cy",(e(je),o(()=>e(je).y))),u(Lt,"fill",(L(re),o(()=>re.selection.dragRuler))),u(jt,"x",e($)),u(jt,"y",e(B)-.5),u(jt,"fill",(L(re),o(()=>re.selection.dragRuler))),Le(pn,`${Bt??""}"`)},[()=>(e(D),o(()=>e(D).toFixed(2)))]),w(Ce,Ee)};j(hn,Ce=>{e(_t)&&e(je)&&e(D)>.1&&Ce(fn)})}U(()=>Ct=Mn(qe,0,"model-base svelte-1vg3k6o",null,Ct,{selected:ae(),dragging:e(_t),"coherency-violation":le()})),w(t,qe),jn()}var Hu=he('<rect x="0" y="0"></rect>'),Fu=he('<line stroke-width="0.05"></line>'),Bu=he('<line stroke-width="0.05"></line>'),qu=he('<line stroke-width="0.08"></line>'),Uu=he('<line stroke-width="0.08"></line>'),Ku=he("<!><!><!><!>",1),Gu=he('<text text-anchor="middle" class="ruler-text svelte-lpn8p2"> </text>'),zu=he("<line></line><!>",1),Xu=he('<text text-anchor="middle" class="ruler-text svelte-lpn8p2"> </text>'),Vu=he("<line></line><!>",1),ju=he('<text text-anchor="middle" class="ruler-text svelte-lpn8p2"> </text>'),Ju=he("<line></line><!>",1),Zu=he('<text text-anchor="middle" class="ruler-text svelte-lpn8p2"> </text>'),Qu=he("<line></line><!>",1),ed=he("<!><!><!><!>",1),td=he('<path stroke-width="0.10" stroke-dasharray="0.5,0.25"></path>'),nd=he('<line stroke-width="0.05"></line>'),ad=he('<g><rect stroke-width="0.1"></rect></g>'),rd=he('<g><path stroke-width="0.1"></path></g>'),sd=he('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15"></circle><circle stroke-width="0.06"></circle><circle r="0.15"></circle>',1),id=he('<g><rect stroke-width="0.1"></rect></g>'),od=he('<g><ellipse stroke-width="0.1"></ellipse></g>'),ld=he('<circle stroke-width="0.1"></circle>'),cd=he('<line stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),ud=he('<line stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),dd=he('<svg preserveAspectRatio="xMidYMid meet"><!><rect></rect><!><!><g><!><!><!><!><!><!><!><!></g></svg>');function Ss(t,n){Vn(n,!1);const a=()=>Wt(Ns,"$battlefieldView",s),[s,r]=Cr(),i=W(),l=W(),c=W(),d=W(),h=W(),y=W(),p=W(),m=W();let f=W();const v=2,A=st.width+v*2,T=st.height+v*2;let E=we(n,"deploymentZones",8,null),P=we(n,"objectives",8,null),M=we(n,"terrains",8,null),k=we(n,"walls",8,null),D=we(n,"models",8,null),$=we(n,"losResults",8,null),B=we(n,"showGrid",8,!0),F=we(n,"showRuler",8,!0),G=we(n,"interactiveTerrain",8,!1),q=we(n,"interactiveWalls",8,!1),ie=we(n,"interactiveModels",8,!1),ee=we(n,"showDebugRays",8,!1),fe=we(n,"selectedTerrainId",8,null),se=we(n,"selectedWallId",8,null),ae=we(n,"selectedModelId",8,null),De=we(n,"onTerrainSelect",8,()=>{}),ve=we(n,"onTerrainDrag",8,()=>{}),be=we(n,"onTerrainRotate",8,()=>{}),te=we(n,"onWallSelect",8,()=>{}),Ae=we(n,"onWallDrag",8,()=>{}),ue=we(n,"onWallRotate",8,()=>{}),le=we(n,"onModelSelect",8,()=>{}),Xe=we(n,"onModelDrag",8,()=>{}),ge=we(n,"onModelDragEnd",8,()=>{}),Pe=we(n,"onModelRotate",8,()=>{}),de=we(n,"onModelRotateEnd",8,()=>{}),bt=we(n,"onModelRename",8,()=>{}),ut=we(n,"onBackgroundClick",8,()=>{}),Yt=W(!1),_t={x:0,y:0},it=W(!1);const Tt=.5,je=4;function Qt(oe,Ue){if(!e(f))return{x:0,y:0};const kt=e(f).createSVGPoint();kt.x=oe,kt.y=Ue;const At=kt.matrixTransform(e(f).getScreenCTM().inverse());return{x:At.x-v,y:At.y-v}}function Ht(oe){oe.preventDefault();const Ue=e(f).getBoundingClientRect(),kt=oe.clientX-Ue.left,At=oe.clientY-Ue.top,Se=e(c)+kt/Ue.width*e(i),at=e(d)+At/Ue.height*e(l),Ze=oe.deltaY>0?.9:1.1,$e=Math.max(Tt,Math.min(je,a().zoom*Ze)),He=A/$e,R=T/$e,nt=Se-kt/Ue.width*He,Mt=at-At/Ue.height*R;Ns.set({zoom:$e,panX:nt,panY:Mt})}function zt(oe){(oe.button===1||oe.button===0&&e(it))&&(oe.preventDefault(),b(Yt,!0),_t={x:oe.clientX,y:oe.clientY})}function Ne(oe){if(!e(Yt))return;const Ue=e(f).getBoundingClientRect(),kt=(oe.clientX-_t.x)/Ue.width*e(i),At=(oe.clientY-_t.y)/Ue.height*e(l);Ns.update(Se=>({...Se,panX:Se.panX-kt,panY:Se.panY-At})),_t={x:oe.clientX,y:oe.clientY}}function Ke(){b(Yt,!1)}function ze(oe){oe.code==="Space"&&!oe.repeat&&oe.target.tagName!=="INPUT"&&(oe.preventDefault(),b(it,!0))}function xt(oe){oe.code==="Space"&&b(it,!1)}function Z(){Cu()}function Ie(oe){(oe.target===oe.currentTarget||oe.target.tagName==="rect")&&ut()()}function qe(oe){const Ue=Ca(oe.shape,oe.segments);return Ue.length===0?"":`M ${Ue.map(kt=>`${oe.x+kt.x},${oe.y+kt.y}`).join(" L ")} Z`}function Ct(oe){const Ue=Ca(oe.shape,oe.segments);if(Ue.length===0)return{x:oe.x,y:oe.y};const kt=Ue.map(He=>He.x),At=Ue.map(He=>He.y),Se=Math.min(...kt),at=Math.max(...kt),Ze=Math.min(...At),$e=Math.max(...At);return{x:oe.x+Se+(at-Se)/2,y:oe.y+Ze+($e-Ze)/2}}me(()=>a(),()=>{b(i,A/a().zoom)}),me(()=>a(),()=>{b(l,T/a().zoom)}),me(()=>a(),()=>{b(c,a().panX)}),me(()=>a(),()=>{b(d,a().panY)}),me(()=>(e(c),e(d),e(i),e(l)),()=>{b(h,`${e(c)} ${e(d)} ${e(i)} ${e(l)}`)}),me(()=>st,()=>{b(y,Array.from({length:st.width+1},(oe,Ue)=>Ue))}),me(()=>st,()=>{b(p,Array.from({length:st.height+1},(oe,Ue)=>Ue))}),me(()=>(L(D()),L(ae())),()=>{b(m,D()?.find(oe=>oe.id===ae()))}),$a();var pt={screenToSvg:Qt};ia();var ot=dd();ne("keydown",pr,ze),ne("keyup",pr,xt),ne("mouseup",pr,Ke),ne("mousemove",pr,Ne);let $t;var Ft=x(ot);{var Et=oe=>{var Ue=Hu();U(()=>{u(Ue,"width",(L(st),o(()=>st.width+v*2))),u(Ue,"height",(L(st),o(()=>st.height+v*2))),u(Ue,"fill",(L(re),o(()=>re.battlefield.rulerBackground)))}),w(oe,Ue)};j(Ft,oe=>{F()&&oe(Et)})}var wt=g(Ft);u(wt,"x",v),u(wt,"y",v);var It=g(wt);{var hn=oe=>{var Ue=Ku(),kt=ce(Ue);Ve(kt,1,()=>(L(st),o(()=>Array(st.width+1))),ft,(Ze,$e,He)=>{var R=Fu();u(R,"x1",v+He),u(R,"y1",v),u(R,"x2",v+He),U(()=>{u(R,"y2",(L(st),o(()=>v+st.height))),u(R,"stroke",(L(re),o(()=>re.battlefield.gridFine)))}),w(Ze,R)});var At=g(kt);Ve(At,1,()=>(L(st),o(()=>Array(st.height+1))),ft,(Ze,$e,He)=>{var R=Bu();u(R,"x1",v),u(R,"y1",v+He),u(R,"y2",v+He),U(()=>{u(R,"x2",(L(st),o(()=>v+st.width))),u(R,"stroke",(L(re),o(()=>re.battlefield.gridFine)))}),w(Ze,R)});var Se=g(At);Ve(Se,1,()=>(L(st),o(()=>Array(Math.floor(st.width/6)+1))),ft,(Ze,$e,He)=>{var R=qu();u(R,"x1",v+He*6),u(R,"y1",v),u(R,"x2",v+He*6),U(()=>{u(R,"y2",(L(st),o(()=>v+st.height))),u(R,"stroke",(L(re),o(()=>re.battlefield.gridCoarse)))}),w(Ze,R)});var at=g(Se);Ve(at,1,()=>(L(st),o(()=>Array(Math.floor(st.height/6)+1))),ft,(Ze,$e,He)=>{var R=Uu();u(R,"x1",v),u(R,"y1",v+He*6),u(R,"y2",v+He*6),U(()=>{u(R,"x2",(L(st),o(()=>v+st.width))),u(R,"stroke",(L(re),o(()=>re.battlefield.gridCoarse)))}),w(Ze,R)}),w(oe,Ue)};j(It,oe=>{B()&&oe(hn)})}var fn=g(It);{var Ce=oe=>{var Ue=ed(),kt=ce(Ue);Ve(kt,1,()=>e(y),ft,(Ze,$e)=>{var He=zu(),R=ce(He);u(R,"y2",v);var nt=g(R);{var Mt=yt=>{var dt=Gu();u(dt,"y",1.2);var dn=x(dt);U(()=>{u(dt,"x",v+e($e)),Le(dn,`${e($e)??""}"`)}),w(yt,dt)};j(nt,yt=>{e($e)%6===0&&yt(Mt)})}U(()=>{u(R,"x1",v+e($e)),u(R,"y1",e($e)%6===0?.5:v-.8),u(R,"x2",v+e($e)),u(R,"stroke",(L(re),o(()=>re.battlefield.ruler))),u(R,"stroke-width",e($e)%6===0?.08:.04)}),w(Ze,He)});var At=g(kt);Ve(At,1,()=>e(y),ft,(Ze,$e)=>{var He=Vu(),R=ce(He),nt=g(R);{var Mt=yt=>{var dt=Xu(),dn=x(dt);U(()=>{u(dt,"x",v+e($e)),u(dt,"y",(L(st),o(()=>v+st.height+1.8))),Le(dn,`${e($e)??""}"`)}),w(yt,dt)};j(nt,yt=>{e($e)%6===0&&yt(Mt)})}U(()=>{u(R,"x1",v+e($e)),u(R,"y1",(L(st),o(()=>v+st.height))),u(R,"x2",v+e($e)),u(R,"y2",(L(st),e($e),o(()=>v+st.height+(e($e)%6===0?1.5:.8)))),u(R,"stroke",(L(re),o(()=>re.battlefield.ruler))),u(R,"stroke-width",e($e)%6===0?.08:.04)}),w(Ze,He)});var Se=g(At);Ve(Se,1,()=>e(p),ft,(Ze,$e)=>{var He=Ju(),R=ce(He);u(R,"x2",v);var nt=g(R);{var Mt=yt=>{var dt=ju();u(dt,"x",1);var dn=x(dt);U(()=>{u(dt,"y",v+e($e)+.35),Le(dn,`${e($e)??""}"`)}),w(yt,dt)};j(nt,yt=>{e($e)%6===0&&yt(Mt)})}U(()=>{u(R,"x1",e($e)%6===0?.5:v-.8),u(R,"y1",v+e($e)),u(R,"y2",v+e($e)),u(R,"stroke",(L(re),o(()=>re.battlefield.ruler))),u(R,"stroke-width",e($e)%6===0?.08:.04)}),w(Ze,He)});var at=g(Se);Ve(at,1,()=>e(p),ft,(Ze,$e)=>{var He=Qu(),R=ce(He),nt=g(R);{var Mt=yt=>{var dt=Zu(),dn=x(dt);U(()=>{u(dt,"x",(L(st),o(()=>v+st.width+1))),u(dt,"y",v+e($e)+.35),Le(dn,`${e($e)??""}"`)}),w(yt,dt)};j(nt,yt=>{e($e)%6===0&&yt(Mt)})}U(()=>{u(R,"x1",(L(st),o(()=>v+st.width))),u(R,"y1",v+e($e)),u(R,"x2",(L(st),e($e),o(()=>v+st.width+(e($e)%6===0?1.5:.8)))),u(R,"y2",v+e($e)),u(R,"stroke",(L(re),o(()=>re.battlefield.ruler))),u(R,"stroke-width",e($e)%6===0?.08:.04)}),w(Ze,He)}),w(oe,Ue)};j(fn,oe=>{F()&&oe(Ce)})}var Ee=g(fn);u(Ee,"transform","translate(2, 2)");var Qe=x(Ee);{var Lt=oe=>{var Ue=Ge(),kt=ce(Ue);Ve(kt,1,E,ft,(At,Se)=>{var at=td();U(Ze=>{u(at,"d",Ze),u(at,"fill",(e(Se),o(()=>e(Se).color))),u(at,"stroke",(e(Se),o(()=>e(Se).borderColor)))},[()=>(L(kr),e(Se),o(()=>kr(e(Se).path)))]),w(At,at)}),w(oe,Ue)};j(Qe,oe=>{E()&&oe(Lt)})}var jt=g(Qe);{var pn=oe=>{var Ue=Ge(),kt=ce(Ue);Ve(kt,1,$,ft,(At,Se)=>{var at=Ge(),Ze=ce(at);{var $e=He=>{var R=Ge(),nt=ce(R);Ve(nt,1,()=>(e(Se),o(()=>e(Se).rays)),ft,(Mt,yt)=>{var dt=nd();U(()=>{u(dt,"x1",(e(yt),o(()=>e(yt).from.x))),u(dt,"y1",(e(yt),o(()=>e(yt).from.y))),u(dt,"x2",(e(yt),o(()=>e(yt).to.x))),u(dt,"y2",(e(yt),o(()=>e(yt).to.y))),u(dt,"stroke",(e(yt),L(re),o(()=>e(yt).blocked?re.los.rayBlocked:re.los.rayVisible)))}),w(Mt,dt)}),w(He,R)};j(Ze,He=>{e(Se),o(()=>e(Se).rays)&&He($e)})}w(At,at)}),w(oe,Ue)};j(jt,oe=>{L(ee()),L($()),o(()=>ee()&&$()&&$().length>0)&&oe(pn)})}var Bt=g(jt);{var yn=oe=>{var Ue=Ge(),kt=ce(Ue);{var At=at=>{var Ze=Ge(),$e=ce(Ze);Ve($e,1,M,He=>He.id,(He,R)=>{{let nt=Re(()=>(e(R),L(fe()),o(()=>e(R).id===fe())));Ru(He,{get id(){return e(R),o(()=>e(R).id)},get x(){return e(R),o(()=>e(R).x)},get y(){return e(R),o(()=>e(R).y)},get width(){return e(R),o(()=>e(R).width)},get height(){return e(R),o(()=>e(R).height)},get rotation(){return e(R),o(()=>e(R).rotation)},get selected(){return e(nt)},screenToSvg:Qt,get onSelect(){return De()},get onDrag(){return ve()},get onRotate(){return be()}})}}),w(at,Ze)},Se=at=>{var Ze=Ge(),$e=ce(Ze);Ve($e,1,M,ft,(He,R)=>{const nt=Re(()=>(e(R),o(()=>e(R).x+e(R).width/2))),Mt=Re(()=>(e(R),o(()=>e(R).y+e(R).height/2)));var yt=ad(),dt=x(yt);U(()=>{u(yt,"transform",`rotate(${e(R),o(()=>e(R).rotation)??""}, ${e(nt)??""}, ${e(Mt)??""})`),u(dt,"x",(e(R),o(()=>e(R).x))),u(dt,"y",(e(R),o(()=>e(R).y))),u(dt,"width",(e(R),o(()=>e(R).width))),u(dt,"height",(e(R),o(()=>e(R).height))),u(dt,"fill",(L(re),o(()=>re.terrain.fillStatic))),u(dt,"stroke",(L(re),o(()=>re.terrain.stroke)))}),w(He,yt)}),w(at,Ze)};j(kt,at=>{G()?at(At):at(Se,!1)})}w(oe,Ue)};j(Bt,oe=>{M()&&oe(yn)})}var fa=g(Bt);{var Za=oe=>{var Ue=Ge(),kt=ce(Ue);{var At=at=>{var Ze=Ge(),$e=ce(Ze);Ve($e,1,k,He=>He.id,(He,R)=>{{let nt=Re(()=>(e(R),L(se()),o(()=>e(R).id===se())));Mi(He,{get id(){return e(R),o(()=>e(R).id)},get x(){return e(R),o(()=>e(R).x)},get y(){return e(R),o(()=>e(R).y)},get shape(){return e(R),o(()=>e(R).shape)},get segments(){return e(R),o(()=>e(R).segments)},get rotation(){return e(R),o(()=>e(R).rotation)},get selected(){return e(nt)},screenToSvg:Qt,get onSelect(){return te()},get onDrag(){return Ae()},get onRotate(){return ue()}})}}),w(at,Ze)},Se=at=>{var Ze=Ge(),$e=ce(Ze);Ve($e,1,k,ft,(He,R)=>{const nt=Re(()=>(e(R),o(()=>Ct(e(R)))));var Mt=rd(),yt=x(Mt);U(dt=>{u(Mt,"transform",`rotate(${e(R),o(()=>e(R).rotation)??""}, ${L(e(nt)),o(()=>e(nt).x)??""}, ${L(e(nt)),o(()=>e(nt).y)??""})`),u(yt,"d",dt),u(yt,"fill",(L(re),o(()=>re.wall.fill))),u(yt,"stroke",(L(re),o(()=>re.wall.stroke)))},[()=>(e(R),o(()=>qe(e(R))))]),w(He,Mt)}),w(at,Ze)};j(kt,at=>{q()?at(At):at(Se,!1)})}w(oe,Ue)};j(fa,oe=>{k()&&oe(Za)})}var Pn=g(fa);{var Rn=oe=>{var Ue=Ge(),kt=ce(Ue);Ve(kt,1,P,ft,(At,Se)=>{const at=Re(()=>(e(Se),L(re),o(()=>e(Se).isPrimary?re.objective.primary:re.objective.secondary))),Ze=Re(()=>(e(Se),L(re),o(()=>e(Se).isPrimary?re.objective.primaryControl:re.objective.secondaryControl)));var $e=sd(),He=ce($e),R=g(He),nt=g(R);U(()=>{u(He,"cx",(e(Se),o(()=>e(Se).x))),u(He,"cy",(e(Se),o(()=>e(Se).y))),u(He,"r",Qs),u(He,"fill",e(Ze)),u(He,"stroke",e(at)),u(R,"cx",(e(Se),o(()=>e(Se).x))),u(R,"cy",(e(Se),o(()=>e(Se).y))),u(R,"r",Zs),u(R,"fill",e(at)),u(R,"stroke",(L(re),o(()=>re.objective.center))),u(nt,"cx",(e(Se),o(()=>e(Se).x))),u(nt,"cy",(e(Se),o(()=>e(Se).y))),u(nt,"fill",(L(re),o(()=>re.objective.center)))}),w(At,$e)}),w(oe,Ue)};j(Pn,oe=>{P()&&oe(Rn)})}var Hn=g(Pn);{var qn=oe=>{var Ue=Ge(),kt=ce(Ue);{var At=at=>{var Ze=Ge(),$e=ce(Ze);Ve($e,1,D,He=>He.id,(He,R)=>{{let nt=Re(()=>(e(R),o(()=>e(R).name||""))),Mt=Re(()=>(e(R),L(ae()),o(()=>e(R).id===ae())));Ks(He,{get id(){return e(R),o(()=>e(R).id)},get x(){return e(R),o(()=>e(R).x)},get y(){return e(R),o(()=>e(R).y)},get baseType(){return e(R),o(()=>e(R).baseType)},get playerId(){return e(R),o(()=>e(R).playerId)},get rotation(){return e(R),o(()=>e(R).rotation)},get name(){return e(nt)},get selected(){return e(Mt)},screenToSvg:Qt,get onSelect(){return le()},get onDrag(){return Xe()},get onDragEnd(){return ge()},get onRotate(){return Pe()},get onRotateEnd(){return de()},get onRename(){return bt()}})}}),w(at,Ze)},Se=at=>{var Ze=Ge(),$e=ce(Ze);Ve($e,1,D,ft,(He,R)=>{const nt=Re(()=>(L(Sn),e(R),o(()=>Sn(e(R).baseType)))),Mt=Re(()=>(L(gs),e(R),o(()=>gs(e(R).playerId)))),yt=Re(()=>(L(vn),e(R),o(()=>vn(e(R).baseType)))),dt=Re(()=>(L(zn),e(R),o(()=>zn(e(R).baseType))));var dn=Ge(),Rr=ce(dn);{var Dr=Zn=>{var va=id(),Qn=x(va);U(()=>{u(va,"transform",`rotate(${e(R),o(()=>e(R).rotation||0)??""}, ${e(R),o(()=>e(R).x)??""}, ${e(R),o(()=>e(R).y)??""})`),u(Qn,"x",(e(R),o(()=>e(R).x-(e(R).customWidth||0)/2))),u(Qn,"y",(e(R),o(()=>e(R).y-(e(R).customHeight||0)/2))),u(Qn,"width",(e(R),o(()=>e(R).customWidth||0))),u(Qn,"height",(e(R),o(()=>e(R).customHeight||0))),u(Qn,"fill",(L(e(Mt)),o(()=>e(Mt).fill))),u(Qn,"stroke",(L(e(Mt)),o(()=>e(Mt).primary)))}),w(Zn,va)},es=Zn=>{var va=Ge(),Qn=ce(va);{var ts=I=>{var z=od(),Q=x(z);U(()=>{u(z,"transform",`rotate(${e(R),o(()=>e(R).rotation||0)??""}, ${e(R),o(()=>e(R).x)??""}, ${e(R),o(()=>e(R).y)??""})`),u(Q,"cx",(e(R),o(()=>e(R).x))),u(Q,"cy",(e(R),o(()=>e(R).y))),u(Q,"rx",(L(e(nt)),o(()=>e(nt).width/2))),u(Q,"ry",(L(e(nt)),o(()=>e(nt).height/2))),u(Q,"fill",(L(e(Mt)),o(()=>e(Mt).fill))),u(Q,"stroke",(L(e(Mt)),o(()=>e(Mt).primary)))}),w(I,z)},Ir=I=>{var z=ld();U(()=>{u(z,"cx",(e(R),o(()=>e(R).x))),u(z,"cy",(e(R),o(()=>e(R).y))),u(z,"r",(L(e(nt)),o(()=>e(nt).radius))),u(z,"fill",(L(e(Mt)),o(()=>e(Mt).fill))),u(z,"stroke",(L(e(Mt)),o(()=>e(Mt).primary)))}),w(I,z)};j(Qn,I=>{e(yt)?I(ts):I(Ir,!1)},!0)}w(Zn,va)};j(Rr,Zn=>{e(dt)?Zn(Dr):Zn(es,!1)})}w(He,dn)}),w(at,Ze)};j(kt,at=>{ie()?at(At):at(Se,!1)})}w(oe,Ue)};j(Hn,oe=>{D()&&oe(qn)})}var Nn=g(Hn);{var pa=oe=>{var Ue=Ge(),kt=ce(Ue);Ve(kt,1,$,ft,(At,Se)=>{var at=Ge(),Ze=ce(at);{var $e=R=>{var nt=cd();U(()=>{u(nt,"x1",(e(Se),o(()=>e(Se).firstClearRay.from.x))),u(nt,"y1",(e(Se),o(()=>e(Se).firstClearRay.from.y))),u(nt,"x2",(e(Se),o(()=>e(Se).firstClearRay.to.x))),u(nt,"y2",(e(Se),o(()=>e(Se).firstClearRay.to.y))),u(nt,"stroke",(L(re),o(()=>re.los.visible)))}),w(R,nt)},He=R=>{var nt=Ge(),Mt=ce(nt);{var yt=dt=>{var dn=ud();U(()=>{u(dn,"x1",(e(m),o(()=>e(m).x))),u(dn,"y1",(e(m),o(()=>e(m).y))),u(dn,"x2",(e(Se),o(()=>e(Se).viewer.x))),u(dn,"y2",(e(Se),o(()=>e(Se).viewer.y))),u(dn,"stroke",(L(re),o(()=>re.los.blocked)))}),w(dt,dn)};j(Mt,dt=>{e(Se),o(()=>e(Se).viewer)&&dt(yt)},!0)}w(R,nt)};j(Ze,R=>{e(Se),o(()=>e(Se).firstClearRay)?R($e):R(He,!1)})}w(At,at)}),w(oe,Ue)};j(Nn,oe=>{L(ee()),L($()),e(m),o(()=>ee()&&$()&&$().length>0&&e(m))&&oe(pa)})}var Jn=g(Nn);Vo(Jn,n,"default",{screenToSvg:Qt}),wr(ot,oe=>b(f,oe),()=>e(f)),U(()=>{u(ot,"viewBox",e(h)),$t=Mn(ot,0,"battlefield svelte-lpn8p2",null,$t,{panning:e(Yt)||e(it)}),u(wt,"width",(L(st),o(()=>st.width))),u(wt,"height",(L(st),o(()=>st.height))),u(wt,"fill",(L(re),o(()=>re.battlefield.background)))}),ne("wheel",ot,Ht),ne("mousedown",ot,zt),ne("dblclick",ot,Z),ne("click",ot,Ie),w(t,ot),ds(n,"screenToSvg",Qt);var ya=jn(pt);return r(),ya}var md=pe('<div class="section-content svelte-1ms4b45"><!></div>'),hd=pe('<section><div class="section-header svelte-1ms4b45" role="button" tabindex="0"><h3 class="svelte-1ms4b45"> </h3> <span class="toggle-icon svelte-1ms4b45"> </span></div> <!></section>');function kn(t,n){let a=we(n,"title",8),s=we(n,"defaultOpen",8,!0),r=W(s());function i(){b(r,!e(r))}var l=hd();let c;var d=x(l),h=x(d),y=x(h),p=g(h,2),m=x(p),f=g(d,2);{var v=A=>{var T=md(),E=x(T);Vo(E,n,"default",{}),w(A,T)};j(f,A=>{e(r)&&A(v)})}U(()=>{c=Mn(l,1,"collapsible-section svelte-1ms4b45",null,c,{collapsed:!e(r)}),Le(y,a()),Le(m,e(r)?"▼":"▶")}),ne("click",d,i),w(t,l)}const rr=gn(null),ma=gn(null),wa=gn(null),Ri=Pa([ma,wa],([t,n])=>{if(!t)return{terrains:[],walls:[]};if(n==="preset"){const a=hl.find(s=>s.name===t);return a?{terrains:a.terrains||[],walls:a.walls||[]}:{terrains:[],walls:[]}}else if(n==="saved"){const a=localStorage.getItem("warhammer-deployment-layouts");if(a)try{const s=JSON.parse(a);if(s[t])return{terrains:s[t].terrains||[],walls:s[t].walls||[]}}catch(s){console.error("Failed to load layout:",s)}}return{terrains:[],walls:[]}});var fd=pe('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),pd=pe('<button class="svelte-1jotvmi"> </button>'),yd=pe('<div class="button-group svelte-1jotvmi"></div>'),vd=pe('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),gd=pe('<button class="svelte-1jotvmi"> </button>'),bd=pe('<div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi"> </h4> <div class="button-group svelte-1jotvmi"></div></div>'),Td=pe('<button class="svelte-1jotvmi"> </button>'),xd=pe('<div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Saved</h4> <div class="button-group svelte-1jotvmi"></div></div>'),_d=pe('<div class="layout-sections svelte-1jotvmi"><!> <!></div>'),wd=pe('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Objectives:</span> <span class="value svelte-1jotvmi"> </span></div>'),Sd=pe('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Pieces:</span> <span class="value svelte-1jotvmi"> </span></div>'),kd=pe('<div class="summary svelte-1jotvmi"><div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Deployment:</span> <span class="value svelte-1jotvmi"> </span></div> <div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Terrain:</span> <span class="value svelte-1jotvmi"> </span></div> <!> <!></div>'),Ad=pe('<main class="svelte-1jotvmi"><div class="layout svelte-1jotvmi"><div class="sidebar svelte-1jotvmi"><!> <!> <!></div> <div class="battlefield-area svelte-1jotvmi"><div class="battlefield-container svelte-1jotvmi"><!></div> <div class="info svelte-1jotvmi"><p class="svelte-1jotvmi">Battlefield: 60" x 44"</p> <p class="hint svelte-1jotvmi">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function Cd(t,n){Vn(n,!1);const a=()=>Wt(rr,"$selectedDeployment",l),s=()=>Wt(ma,"$selectedLayoutName",l),r=()=>Wt(Ei,"$savedLayoutsList",l),i=()=>Wt(Ri,"$loadedTerrain",l),[l,c]=Cr();Er(()=>{Ps()});function d($){rr.set($)}function h($){ma.set($.name),wa.set("preset")}function y($){ma.set($),wa.set("saved")}function p(){ma.set(null),wa.set(null)}function m(){rr.set(null)}ia();var f=Ad(),v=x(f),A=x(v),T=x(A);kn(T,{title:"Deployment",children:($,B)=>{var F=Ge(),G=ce(F);{var q=ee=>{var fe=fd(),se=x(fe),ae=x(se),De=g(se,2);U(()=>Le(ae,a().name)),ne("click",De,m),w(ee,fe)},ie=ee=>{var fe=yd();Ve(fe,5,()=>ll,ft,(se,ae)=>{var De=pd(),ve=x(De);U(()=>Le(ve,e(ae).name)),ne("click",De,()=>d(e(ae))),w(se,De)}),w(ee,fe)};j(G,ee=>{a()?ee(q):ee(ie,!1)})}w($,F)},$$slots:{default:!0}});var E=g(T,2);kn(E,{title:"Terrain Layout",children:($,B)=>{var F=Ge(),G=ce(F);{var q=ee=>{var fe=vd(),se=x(fe),ae=x(se),De=g(se,2);U(()=>Le(ae,s())),ne("click",De,p),w(ee,fe)},ie=ee=>{var fe=_d(),se=x(fe);Ve(se,1,()=>ml,ft,(ve,be)=>{var te=bd(),Ae=x(te),ue=x(Ae),le=g(Ae,2);Ve(le,5,()=>e(be).presets,ft,(Xe,ge)=>{var Pe=gd(),de=x(Pe);U(()=>Le(de,e(ge).name)),ne("click",Pe,()=>h(e(ge))),w(Xe,Pe)}),U(()=>Le(ue,e(be).name)),w(ve,te)});var ae=g(se,2);{var De=ve=>{var be=xd(),te=g(x(be),2);Ve(te,5,r,ft,(Ae,ue)=>{var le=Td(),Xe=x(le);U(()=>Le(Xe,e(ue).name)),ne("click",le,()=>y(e(ue).name)),w(Ae,le)}),w(ve,be)};j(ae,ve=>{r().length>0&&ve(De)})}w(ee,fe)};j(G,ee=>{s()?ee(q):ee(ie,!1)})}w($,F)},$$slots:{default:!0}});var P=g(E,2);kn(P,{title:"Summary",children:($,B)=>{var F=kd(),G=x(F),q=g(x(G),2),ie=x(q),ee=g(G,2),fe=g(x(ee),2),se=x(fe),ae=g(ee,2);{var De=te=>{var Ae=wd(),ue=g(x(Ae),2),le=x(ue);U(()=>Le(le,a().objectives.length)),w(te,Ae)};j(ae,te=>{a()&&te(De)})}var ve=g(ae,2);{var be=te=>{var Ae=Sd(),ue=g(x(Ae),2),le=x(ue);U(()=>Le(le,`${i().terrains.length??""} terrain, ${i().walls.length??""} walls`)),w(te,Ae)};j(ve,te=>{(i().terrains.length>0||i().walls.length>0)&&te(be)})}U(()=>{Le(ie,a()?.name||"None"),Le(se,s()||"None")}),w($,F)},$$slots:{default:!0}});var M=g(A,2),k=x(M),D=x(k);{let $=Re(()=>a()?.zones),B=Re(()=>a()?.objectives);Ss(D,{get deploymentZones(){return e($)},get objectives(){return e(B)},get terrains(){return i().terrains},get walls(){return i().walls}})}w(t,f),jn(),c()}var Ed=he('<ellipse fill="none" stroke-width="2"></ellipse>'),Md=he('<circle fill="none" stroke-width="2"></circle>'),Rd=pe('<button class="palette-item svelte-1t25izx"><svg class="svelte-1t25izx"><!></svg> <span class="label svelte-1t25izx"> </span></button>');function Gs(t,n){Vn(n,!1);const a=W(),s=W(),r=W(),i=W(),l=W(),c=W();let d=we(n,"baseSize",8),h=we(n,"playerId",8),y=we(n,"onDragStart",8,()=>{});const p=3;function m(k){k.button===0&&(k.preventDefault(),y()(d(),k))}me(()=>L(h()),()=>{b(a,h()===1?"#3b82f6":"#ef4444")}),me(()=>L(d()),()=>{b(s,d().width!==void 0)}),me(()=>(e(s),L(d())),()=>{b(r,e(s)?null:d().radius*p)}),me(()=>(e(s),L(d())),()=>{b(i,e(s)?d().width/2*p:null)}),me(()=>(e(s),L(d())),()=>{b(l,e(s)?d().height/2*p:null)}),me(()=>(e(s),L(d())),()=>{b(c,e(s)?Math.max(d().width,d().height)*p:d().radius*2*p)}),$a(),ia();var f=Rd(),v=x(f),A=x(v);{var T=k=>{var D=Ed();U(()=>{u(D,"cx",(e(c)+8)/2),u(D,"cy",(e(c)+8)/2),u(D,"rx",e(i)),u(D,"ry",e(l)),u(D,"stroke",e(a))}),w(k,D)},E=k=>{var D=Md();U(()=>{u(D,"cx",(e(c)+8)/2),u(D,"cy",(e(c)+8)/2),u(D,"r",e(r)),u(D,"stroke",e(a))}),w(k,D)};j(A,k=>{e(s)?k(T):k(E,!1)})}var P=g(v,2),M=x(P);U(()=>{Uc(f,`border-color: ${e(a)??""}`),u(f,"title",(L(d()),o(()=>d().label))),u(v,"width",e(c)+8),u(v,"height",e(c)+8),u(v,"viewBox",`0 0 ${e(c)+8} ${e(c)+8}`),Le(M,(L(d()),o(()=>d().label)))}),ne("mousedown",f,m),w(t,f),jn()}const Tl="warhammer-imported-armies";function Dd(){try{const t=localStorage.getItem(Tl);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load army imports from storage:",t),[]}}function ai(t){try{localStorage.setItem(Tl,JSON.stringify(t))}catch(n){console.error("Failed to save army imports to storage:",n)}}function Id(){return"import-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Ld(){const{subscribe:t,set:n,update:a}=gn(Dd());return{subscribe:t,addImport(s,r,i,l){const c=Id(),d={id:c,name:s||"Unnamed Army",timestamp:Date.now(),rawText:r,parsedData:i,faction:i.FACTION_KEYWORD||"Unknown",totalPoints:i.TOTAL_ARMY_POINTS||"0pts",playerId:l};return a(h=>{const y=[...h,d];return ai(y),y}),c},removeImport(s){a(r=>{const i=r.filter(l=>l.id!==s);return ai(i),i})},getImport(s){return aa({subscribe:t}).find(i=>i.id===s)||null},clear(){n([]),ai([])}}}const fi=Ld();var $d=pe('<div class="error-message svelte-11ilo6m"> </div>'),Pd=pe('<div class="success-message svelte-11ilo6m"> </div>'),Nd=pe("<option> </option>"),Od=pe('<div class="army-import-panel svelte-11ilo6m"><div class="form-group svelte-11ilo6m"><label for="army-list-input" class="svelte-11ilo6m">Paste Army List:</label> <textarea id="army-list-input" placeholder="Paste your army list here (GW App, WTC, ListForge formats supported)" rows="12" class="svelte-11ilo6m"></textarea></div> <div class="button-group svelte-11ilo6m"><button class="svelte-11ilo6m"> </button> <button class="svelte-11ilo6m">Clear</button></div> <!> <!> <div class="divider svelte-11ilo6m"></div> <div class="form-group svelte-11ilo6m"><label for="import-select" class="svelte-11ilo6m">Load Previous Import:</label> <select id="import-select" class="svelte-11ilo6m"><option>-- Select an import --</option><!></select> <button class="load-button svelte-11ilo6m">Load</button></div></div>');function Wd(t,n){Vn(n,!1);const a=()=>Wt(fi,"$armyImports",s),[s,r]=Cr();let i=we(n,"currentPlayer",8,1);const l=el();let c=W(""),d=W(!1),h=W(""),y=W(""),p=W("");function m(){if(!e(c).trim()){b(h,"Please paste an army list");return}b(d,!0),b(h,""),b(y,""),l("parse",{text:e(c),playerId:i()})}function f(){if(!e(p))return;const ue=fi.getImport(e(p));ue&&(b(c,ue.rawText),b(y,`Loaded: ${ue.name} (${ue.faction}, ${ue.totalPoints})`),b(h,""))}function v(){b(c,""),b(h,""),b(y,"")}function A(ue){b(d,ue)}function T(ue){b(h,ue),b(y,""),b(d,!1)}function E(ue){b(y,ue),b(h,""),b(d,!1)}function P(){b(c,"")}var M={setLoading:A,setError:T,setSuccess:E,clearText:P};ia();var k=Od(),D=x(k),$=g(x(D),2),B=g(D,2),F=x(B),G=x(F),q=g(F,2),ie=g(B,2);{var ee=ue=>{var le=$d(),Xe=x(le);U(()=>Le(Xe,`⚠️ ${e(h)??""}`)),w(ue,le)};j(ie,ue=>{e(h)&&ue(ee)})}var fe=g(ie,2);{var se=ue=>{var le=Pd(),Xe=x(le);U(()=>Le(Xe,`✓ ${e(y)??""}`)),w(ue,le)};j(fe,ue=>{e(y)&&ue(se)})}var ae=g(fe,4),De=g(x(ae),2);U(()=>{e(p),Ho(()=>{e(d),a()})});var ve=x(De);ve.value=ve.__value="";var be=g(ve);Ve(be,1,a,ue=>ue.id,(ue,le)=>{var Xe=Nd(),ge=x(Xe),Pe={};U(()=>{Le(ge,`${e(le),o(()=>e(le).name)??""} (${e(le),o(()=>e(le).faction)??""}, ${e(le),o(()=>e(le).totalPoints)??""})`),Pe!==(Pe=(e(le),o(()=>e(le).id)))&&(Xe.value=(Xe.__value=(e(le),o(()=>e(le).id)))??"")}),w(ue,Xe)});var te=g(De,2);U(ue=>{$.disabled=e(d),F.disabled=ue,Le(G,e(d)?"Parsing...":"Parse Army List"),q.disabled=e(d),De.disabled=e(d),te.disabled=e(d)||!e(p)},[()=>(e(d),e(c),o(()=>e(d)||!e(c).trim()))]),qr($,()=>e(c),ue=>b(c,ue)),ne("click",F,m),ne("click",q,v),Jo(De,()=>e(p),ue=>b(p,ue)),ne("click",te,f),w(t,k),ds(n,"setLoading",A),ds(n,"setError",T),ds(n,"setSuccess",E),ds(n,"clearText",P);var Ae=jn(M);return r(),Ae}var Yd=pe("<option> </option>"),Hd=pe('<tr><td class="unit-name svelte-1qdui6g"> </td><td class="quantity svelte-1qdui6g"> </td><td class="svelte-1qdui6g"><select class="svelte-1qdui6g"></select></td><td class="skip-cell svelte-1qdui6g"><input type="checkbox" class="svelte-1qdui6g"/></td></tr>'),Fd=pe('<div class="dialog-overlay svelte-1qdui6g"><div class="dialog svelte-1qdui6g"><div class="dialog-header svelte-1qdui6g"><h3 class="svelte-1qdui6g">Unmatched Units</h3> <button class="close-button svelte-1qdui6g">&times;</button></div> <div class="dialog-content svelte-1qdui6g"><p class="info-text svelte-1qdui6g">The following units were not found in the database. Please select base sizes or skip them:</p> <div class="units-table svelte-1qdui6g"><table class="svelte-1qdui6g"><thead class="svelte-1qdui6g"><tr><th class="svelte-1qdui6g">Unit Name</th><th class="svelte-1qdui6g">Quantity</th><th class="svelte-1qdui6g">Base Size</th><th class="svelte-1qdui6g">Skip</th></tr></thead><tbody></tbody></table></div></div> <div class="dialog-footer svelte-1qdui6g"><button class="cancel-button svelte-1qdui6g">Cancel</button> <button class="import-button svelte-1qdui6g">Import Selected</button></div></div></div>');function Bd(t,n){Vn(n,!1);let a=we(n,"unmatchedUnits",24,()=>[]),s=we(n,"show",12,!1);const r=el();let i=W({});const l=[...ra.circles.map(m=>({value:m.type,label:m.label})),...ra.ovals.map(m=>({value:m.type,label:m.label})),{value:"rect-custom",label:"Custom Rectangle (Vehicle)"}];function c(){const m=a().filter(f=>!e(i)[f.id]?.skip).map(f=>({unitName:f.unitName,quantity:f.quantity,baseType:e(i)[f.id]?.baseType||"32mm"}));r("import",{selected:m}),d()}function d(){s(!1),r("close")}me(()=>L(a()),()=>{b(i,{}),a().forEach(m=>{ei(i,e(i)[m.id]={baseType:"32mm",skip:!1})})}),$a(),ia();var h=Ge(),y=ce(h);{var p=m=>{var f=Fd(),v=x(f),A=x(v),T=g(x(A),2),E=g(A,2),P=g(x(E),2),M=x(P),k=g(x(M));Ve(k,5,a,F=>F.id,(F,G)=>{var q=Hd();let ie;var ee=x(q),fe=x(ee),se=g(ee),ae=x(se),De=g(se),ve=x(De);U(()=>{e(i),Ho(()=>{e(G)})}),Ve(ve,5,()=>l,ft,(Ae,ue)=>{var le=Yd(),Xe=x(le),ge={};U(()=>{Le(Xe,(e(ue),o(()=>e(ue).label))),ge!==(ge=(e(ue),o(()=>e(ue).value)))&&(le.value=(le.__value=(e(ue),o(()=>e(ue).value)))??"")}),w(Ae,le)});var be=g(De),te=x(be);U(()=>{ie=Mn(q,1,"svelte-1qdui6g",null,ie,{skipped:e(i)[e(G).id]?.skip}),Le(fe,(e(G),o(()=>e(G).unitName))),Le(ae,(e(G),o(()=>e(G).quantity||"1x"))),ve.disabled=(e(i),e(G),o(()=>e(i)[e(G).id]?.skip))}),Jo(ve,()=>e(i)[e(G).id].baseType,Ae=>ei(i,e(i)[e(G).id].baseType=Ae)),En(te,()=>e(i)[e(G).id].skip,Ae=>ei(i,e(i)[e(G).id].skip=Ae)),w(F,q)});var D=g(E,2),$=x(D),B=g($,2);ne("click",T,d),ne("click",$,d),ne("click",B,c),ne("click",v,F=>F.stopPropagation()),ne("click",f,d),w(m,f)};j(y,m=>{s()&&m(p)})}w(t,h),jn()}function lr(t){const n=t.match(/^\s*/);return n?n[0].length:0}function ye(t){return t?t.toLowerCase().replace(/\s+/g," ").trim():""}function ur(t){const n=/^(?:(\d+)x?\s+)?(.*)/,a=t.trim().match(n);if(a){const s=a[1]?`${a[1]}x`:"1x";let r=a[2].trim();return r=r.replace(/^with\s+/i,"").trim(),{quantity:s,name:r}}return{quantity:"1x",name:t.trim()}}function Ea(t){return Array.isArray(t)&&t.sort((n,a)=>{const s=parseInt(String(n&&n.quantity||"1x").replace(/x/i,""),10)||1,r=parseInt(String(a&&a.quantity||"1x").replace(/x/i,""),10)||1;if(s!==r)return r-s;const i=n&&n.name?n.name.toString().toLowerCase():"",l=a&&a.name?a.name.toString().toLowerCase():"";return i<l?-1:i>l?1:0}),t}const Ra={"World Eaters":"Chaos","Chaos Space Marines":"Chaos","Emperor's Children":"Chaos","Death Guard":"Chaos","Chaos Daemons":"Chaos","Chaos Knights":"Chaos","Thousand Sons":"Chaos","Space Marines":"Imperium","Iron Hands":"Space Marines",Salamanders:"Space Marines","Space Wolves":"Space Marines",Ultramarines:"Space Marines","White Scars":"Space Marines","Adepta Sororitas":"Imperium","Astra Militarum":"Imperium","Imperial Fists":"Space Marines","Dark Angels":"Space Marines","Blood Angels":"Space Marines","Raven Guard":"Space Marines","Black Templars":"Space Marines",Deathwatch:"Space Marines","Grey Knights":"Imperium","Imperial Knights":"Imperium","Adeptus Custodes":"Imperium","Adeptus Titanicus":"Imperium","Adeptus Mechanicus":"Imperium","Agents of the Imperium":"Imperium",Aeldari:"Xenos",Drukhari:"Xenos",Ynnari:"Xenos",Harlequins:"Xenos",Necrons:"Xenos",Orks:"Xenos",Tyranids:"Xenos","T'au Empire":"Xenos",Tau:"Xenos","T'au":"Xenos","Genestealer Cults":"Xenos","Leagues of Votann":"Xenos"};function Mr(t){if(!t)return t;t.SUMMARY=t.SUMMARY||{};const n=t.SUMMARY;n.LIST_TITLE=n.LIST_TITLE||"",n.FACTION_KEYWORD&&(n.FACTION_KEYWORD=String(n.FACTION_KEYWORD).trim()),n.DETACHMENT&&(n.DETACHMENT=String(n.DETACHMENT).replace(/\u00A0/g," ").trim()),n.TOTAL_ARMY_POINTS&&(n.TOTAL_ARMY_POINTS=String(n.TOTAL_ARMY_POINTS).trim());const a=r=>{if(!r)return"";try{return r.toString().normalize("NFD").replace(new RegExp("\\p{M}","gu"),"").replace(/[\u2018\u2019\u201B\u2032]/g,"'").replace(/[^\w\s'\-]/g,"").toLowerCase().trim()}catch{return r.toString().toLowerCase().trim()}},s=n.FACTION_KEYWORD||null;if(s){const r=a(s);let i;for(const l of Object.keys(Ra))if(a(l)===r){i=l;break}if(i){const l=s.toString().replace(/[\u2018\u2019\u201B\u2032]/g,"'").trim();n.DISPLAY_FACTION=`${Ra[i]} - ${l}`}else n.DISPLAY_FACTION=n.DISPLAY_FACTION||s+(n.DETACHMENT?` - ${n.DETACHMENT}`:"")}else n.DETACHMENT?n.DISPLAY_FACTION=n.DISPLAY_FACTION||n.DETACHMENT:n.DISPLAY_FACTION=n.DISPLAY_FACTION||"";if(!n.FACTION_KEY){if(n.FACTION_KEYWORD)try{n.FACTION_KEY=n.FACTION_KEYWORD.toString().toLowerCase()}catch{n.FACTION_KEY=String(n.FACTION_KEYWORD).toLowerCase()}else if(n.DISPLAY_FACTION){const r=(n.DISPLAY_FACTION||"").split(" - ")[0];try{n.FACTION_KEY=r.toString().toLowerCase()}catch{n.FACTION_KEY=String(r).toLowerCase()}}}return t}function mr(t,n,a,s,r="",i=!1,l="wargear"){if(!t)return;t.items=t.items||[];const c=ur(String(n||"").trim()),d=c.quantity?String(c.quantity):"1x",h=c.name||"",y=ye(h);if(i){const m=String(a||""),f=String(r||"");if(ye(m)===ye(h)||f&&ye(f)===ye(h))return}const p=t.items.find(m=>ye(m.name||"")===y);if(p){const m=parseInt(String(p.quantity||"1x").replace(/x/i,""),10)||0,f=parseInt(String(d||"1x").replace(/x/i,""),10)||0;p.quantity=`${m+f}x`}else{const m=ye(h)==="warlord"?"special":l;t.items.push({quantity:d,name:h,items:[],type:m,nameshort:""})}}function qd(t,n){if(!t||!n)return;n.items=n.items||[];const a=t.trim(),s=a.match(/\(([^)]+)\)$/),r=s?` (${s[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),l=ye(i);if((n.items||[]).some(p=>p&&p.type==="special"&&ye((p.name||"").replace(/^Enhancement:\s*/i,""))===l))return;const h=`E: ${i.split(/\s+/).map(p=>p[0]?p[0].toUpperCase():"").join("")}${r}`.trim(),y={quantity:"1x",name:`Enhancement: ${i}`,nameshort:h,items:[],type:"special"};n.items.push(y)}function Ud(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=[];let s=0;const r=p=>/^(\d+)x?\s+/i.test(String(p||"").trim()),i=(p,m)=>{const f=String(p||"").trim();if(!f)return f;if(r(f)){const v=f.match(/^(\d+)x?\s+(.*)$/i);if(v){const A=parseInt(v[1],10)||1,T=v[2].trim();return`${Math.max(1,A*(parseInt(m,10)||1))}x ${T}`}return f}return`${m}x ${f}`};for(;s<t.length;s++){const m=(t[s]||"").trim();if(m){if(m.startsWith("+")||m.startsWith("&")){a.push(m);continue}break}}for(const p of a){if(p.startsWith("&")){const A=p.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);A&&(A[1].trim(),(A[3]||"").trim());continue}const f=p.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(f){const v=f[1].trim().toUpperCase(),A=f[2].trim();if(v==="FACTION KEYWORD"){const T=A.split(" - ");n.SUMMARY.FACTION_KEYWORD=T[T.length-1].trim()}else v==="DETACHMENT"?n.SUMMARY.DETACHMENT=A.replace(/\u00A0/g," "):v==="TOTAL ARMY POINTS"&&(n.SUMMARY.TOTAL_ARMY_POINTS=A)}}if(n.SUMMARY.LIST_TITLE="",n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD){const p=n.SUMMARY.FACTION_KEYWORD,m=Object.keys(Ra).find(v=>v.toLowerCase()===(p||"").toString().toLowerCase()),f=m?Ra[m]:null;f?n.SUMMARY.DISPLAY_FACTION=`${f} - ${p}`:n.SUMMARY.DISPLAY_FACTION=p+(n.SUMMARY.DETACHMENT?` - ${n.SUMMARY.DETACHMENT}`:"");try{n.SUMMARY.FACTION_KEY=p.toString().toLowerCase()}catch{}}let l=null,c=null;const d=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,h=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;for(;s<t.length;s++){const p=t[s]||"",m=p.trim();if(!m)continue;if(/^Enhancement:\s*/i.test(m)){const E=m.replace(/^Enhancement:\s*/i,"").trim();c&&qd(E,c);continue}const f=m.match(d);if(f){const E=f[1],P=f[2]?`${f[2]}x`:"1x",M=(f[3]||"").trim(),k=parseInt(f[4],10)||0,D=f[5],$={quantity:P,name:M,points:k,items:[],isComplex:!1,nameshort:""};E?(n.CHARACTER.push($),c=$):(n["OTHER DATASHEETS"]=n["OTHER DATASHEETS"]||[],n["OTHER DATASHEETS"].push($)),l=$,D&&D.split(",").map(B=>B.trim()).filter(Boolean).forEach(B=>mr($,B,$.name,n.SUMMARY.FACTION_KEYWORD||"",$.name,!0));continue}const v=p.match(h);if(v){const E=v[1].trim(),P=E.match(/^(\d+)\s+with\s+(.*)$/i);if(P&&l){const D=parseInt(P[1],10)||1,$=P[2],B=l.items&&l.items.length>0?l.items[l.items.length-1]:l;$.split(",").map(F=>F.trim()).filter(Boolean).forEach(F=>{const G=i(F,D);mr(B,G,B.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}const M=E.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(M&&l){const D=M[1],$=M[2].trim(),B=M[3]||"",F={quantity:D,name:$,items:[],type:"subunit"};if(l.items=l.items||[],l.items.push(F),B){const G=B.match(/^(\d+)\s+with\s+(.*)$/i);if(G){const q=parseInt(G[1],10)||1;G[2].split(",").map(ee=>ee.trim()).filter(Boolean).forEach(ee=>{const fe=i(ee,q);mr(F,fe,F.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)})}else B.split(",").map(q=>q.trim()).filter(Boolean).forEach(q=>mr(F,q,F.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0))}continue}const k=E.match(/^(\d+x?)\s+(.*)$/i);if(k&&l){const D={quantity:k[1],name:k[2].trim(),items:[],type:"subunit"};l.items=l.items||[],l.items.push(D);continue}if(l){mr(l,E,l.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0);continue}continue}const A=m.match(/^(\d+)\s+with\s+(.*)$/i);if(A&&l){const E=parseInt(A[1],10)||1,P=A[2],M=l.items&&l.items.length>0?l.items[l.items.length-1]:l;P.split(",").map(k=>k.trim()).filter(Boolean).forEach(k=>{const D=i(k,E);mr(M,D,M.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}const T=m.match(/^(.*?):\s*(.*)$/);if(T&&l){(T[2]||"").split(",").map(P=>P.trim()).filter(Boolean).forEach(P=>mr(l,P,l.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0));continue}}const y=[...n.CHARACTER||[],...n["OTHER DATASHEETS"]||[]];for(const p of y){p&&Array.isArray(p.items)&&p.items.length>0&&Ea(p.items);const m=p&&Array.isArray(p.items)?p.items.filter(f=>f&&f.type==="subunit"):[];for(const f of m)f&&Array.isArray(f.items)&&f.items.length>0&&Ea(f.items)}return Mr(n),n}function Ta(t,n,a,s,r="",i=!1,l="wargear"){if(!t)return;t.items=t.items||[];const c=String(n||"").trim();if(/battlesuit support system|homing beacon|marker drone/i.test(c))try{na.push(`processing raw=${c} for target=${t&&t.name}`)}catch{}let d=c.split(",").map(k=>k.trim()).filter(Boolean);try{const k=new Set;d=d.filter(D=>{const $=ye(Br(Fa(D)));return k.has($)?!1:(k.add($),!0)})}catch{}try{/stealth shas'vre|stealth battlesuits/i.test((t&&t.name||"")+(r||"")+c)&&na.push(`splitParts target=${t&&t.name} top=${r} parts=${JSON.stringify(d)}`)}catch{}if(d.length>1){d.forEach(k=>Ta(t,k,a,s,r,i,l));return}const h=ur(c),y=h.quantity!==void 0&&h.quantity!==null;let p=y?String(h.quantity):"1x",m=h.name||"";try{m=Br(Fa(m))}catch{}const f=/battlesuit support system|homing beacon|marker drone/i;try{const k=m.toLowerCase();if(k.includes("battlesuit support system")||k.includes("homing beacon")||k.includes("marker drone"))try{na.push(`addItemToTarget target=${t&&t.name} raw=${c}`)}catch{}}catch{}const v=m.match(/^(\d+)x\s+(.*)$/i);if(v){const k=parseInt(v[1],10)||1,D=parseInt(String(p||"1x").replace(/x/i,""),10)||1;p=`${Math.max(1,D*k)}x`,m=v[2]}try{na.push(`PARSE_QTY name=${m} parsedQtyRaw=${String(h.quantity||"")} qtyToken=${p}`)}catch{}let A=(k=>isNaN(k)?1:k)(parseInt(String(p||"1x").replace(/x/i,""),10)),T=A;try{if(t&&t.type==="subunit"){const k=parseInt(String(t.quantity||"1x").replace(/[^0-9]/g,""),10)||1;try{na.push(`CALC_EFFECTIVE target=${t&&t.name} parentQty=${k} parsedQty=${A} hasExplicit=${y}`)}catch{}T=y?A:k;try{na.push(`EFFECTIVE_QTY target=${t&&t.name} effectiveQty=${T}`)}catch{}}}catch{}const E=m,P=ye(m);if(i){const k=String(a||""),D=String(r||"");if(ye(k)===ye(m)||D&&ye(D)===ye(m)){if(f.test(m))try{na.push(`SKIP matched unitname name=${m} ctx=${k} top=${D}`)}catch{}return}}const M=t.items.find(k=>ye(k.name||"")===P);if(M){const k=parseInt(String(M.quantity||"1x").replace(/x/i,""),10)||0,D=k+T;M.quantity=`${D}x`;try{na.push(`UPDATED existing name=${m} existing=${k} added=${T} new=${D} target=${t&&t.name}`)}catch{}}else{const k=ye(m)==="warlord"?"special":l;t.items.push({quantity:`${T}x`,name:E,items:[],type:k,nameshort:""});try{na.push(`PUSHED new name=${m} quantity=${T} target=${t&&t.name}`)}catch{}}}function Fa(t){if(!t)return t;const n=t.toLowerCase();return n.includes("shield")&&n.includes("drone")?"Shield Drone":n.includes("marker")&&n.includes("drone")?"Marker Drone":n.includes("marker")&&n.includes("beacon")?"Homing Beacon":t}function Br(t){return t&&t.split(/\s+/).map(n=>!n||/[A-Z]/.test(n.slice(1))?n:n[0].toUpperCase()+n.slice(1).toLowerCase()).join(" ")}function Zi(t,n){if(!n)return`${t}x`;const a=String(n).trim(),s=a.match(/^(\d+)x\s+(.*)$/i);if(s){const r=parseInt(s[1],10)||1,i=s[2]||"";return`${Math.max(1,t*r)}x ${i}`}return`${t}x ${a}`}function Kd(t,n){if(!t||!n)return;n.items=n.items||[];const a=t.trim(),s=a.match(/\(([^)]+)\)$/),r=s?` (${s[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),l=ye(i);if((n.items||[]).some(p=>{if(!p||!p.name)return!1;const m=String(p.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]+\)$/,"").trim();return ye(m)===l}))return;const h=`E: ${i.split(/\s+/).map(p=>p[0]?p[0].toUpperCase():"").join("")}${r}`.trim(),y={quantity:"1x",name:`Enhancement: ${i}`,nameshort:h,items:[],type:"special"};n.items.push(y)}function Gd(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=[];let s=0;for(;s<t.length;s++){const y=(t[s]||"").trim();if(y){if(y.startsWith("+")){a.push(y);continue}if(!y.startsWith("&"))break}}for(const h of a){const p=h.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(p){const m=p[1].trim().toUpperCase(),f=p[2].trim();if(m==="FACTION KEYWORD"){const v=f.split(" - ");n.SUMMARY.FACTION_KEYWORD=v[v.length-1].trim()}else m==="DETACHMENT"?n.SUMMARY.DETACHMENT=f.replace(/\u00A0/g," "):m==="TOTAL ARMY POINTS"&&(n.SUMMARY.TOTAL_ARMY_POINTS=f)}}if(n.SUMMARY.LIST_TITLE="",n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD){const h=n.SUMMARY.FACTION_KEYWORD,y=Object.keys(Ra).find(m=>m.toLowerCase()===(h||"").toString().toLowerCase()),p=y?Ra[y]:null;p?n.SUMMARY.DISPLAY_FACTION=`${p} - ${h}`:n.SUMMARY.DISPLAY_FACTION=h+(n.SUMMARY.DETACHMENT?` - ${n.SUMMARY.DETACHMENT}`:"");try{n.SUMMARY.FACTION_KEY=h.toString().toLowerCase()}catch{}}const r=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,i=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;let l=null,c=null;for(;s<t.length;s++){const h=t[s]||"",y=h.trim();if(!y)continue;if(/^Enhancement:\s*/i.test(y)){const A=y.replace(/^Enhancement:\s*/i,"").trim();c&&Kd(A,c);continue}const p=y.match(r);if(p){const A=p[1],T=p[2]?`${p[2]}x`:"1x",E=(p[3]||"").trim(),P=parseInt(p[4],10)||0,M=p[5],k={quantity:T,name:E,points:P,items:[],isComplex:!1,nameshort:"",charId:A||null};A?(n.CHARACTER.push(k),c=k):(n["OTHER DATASHEETS"]=n["OTHER DATASHEETS"]||[],n["OTHER DATASHEETS"].push(k)),l=k,M&&M.split(",").map(D=>D.trim()).filter(Boolean).forEach(D=>Ta(k,D,k.name,n.SUMMARY.FACTION_KEYWORD||"",k.name,!0));continue}const m=h.match(i);if(m){const A=m[1].trim(),T=A.match(/^(\d+)\s+with\s+(.*)$/i);if(T&&l){const M=parseInt(T[1],10)||1,k=T[2],D=l.items&&l.items.length>0?l.items[l.items.length-1]:l;try{na.push(`WITHMATCH unit=${l.name} target=${D&&D.name} n=${M} rest=${k}`)}catch{}k.split(",").map($=>$.trim()).filter(Boolean).forEach($=>{const F=Br(Fa($));if(D&&D.type==="subunit"){try{na.push(`WITH->SUB target=${D.name} item=${F} n=${M}`)}catch{}Ta(D,`${M}x ${F}`,D.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)}else{try{na.push(`WITH->UNIT unit=${l.name} item=${F} n=${M}`)}catch{}Ta(D,Zi(M,F),D.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)}});continue}const E=A.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(E&&l){const M=E[1],k=E[2].trim(),D=E[3]||"",$={quantity:M,name:k,items:[],type:"subunit",_parent:l};if(l.items=l.items||[],l.items.push($),D){const B=D.match(/^(\d+)\s+with\s+(.*)$/i);B?B[2].split(",").map(G=>G.trim()).filter(Boolean).forEach(G=>{const q=Fa(G);Ta($,q,$.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)}):D.split(",").map(F=>F.trim()).filter(Boolean).forEach(F=>{const G=Fa(F);Ta($,G,$.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)})}continue}const P=A.match(/^(\d+x?)\s+(.*)$/i);if(P&&l)if(l.charId){const M=P[1],k=P[2].trim();Ta(l,`${M} ${k}`,l.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0);continue}else{const M={quantity:P[1],name:P[2].trim(),items:[],type:"subunit",_parent:l};l.items=l.items||[],l.items.push(M);continue}if(l){let M=A.split(",").map(D=>D.trim()).filter(Boolean);try{const D=l.items&&l.items.length>0?l.items[l.items.length-1]:null;D&&D.name&&(M=M.map($=>{const B=$.match(/^(.*)\s*\(([^)]+)\)\s*$/);if(B){const F=B[1].trim();if(ye(F)===ye(D.name))return F}return $}))}catch{}try{const D=new Set;M=M.filter($=>{const B=ye(Br(Fa($)));return D.has(B)?!1:(D.add(B),!0)})}catch{}let k=l;if(l.items&&l.items.length>0){const D=l.items[l.items.length-1];D&&D.type==="subunit"&&(k=D)}M.forEach(D=>{const $=Br(Fa(D));Ta(k,$,k.name||l.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}continue}const f=y.match(/^(\d+)\s+with\s+(.*)$/i);if(f&&l){const A=parseInt(f[1],10)||1,T=f[2],E=l.items&&l.items.length>0?l.items[l.items.length-1]:l;T.split(",").map(P=>P.trim()).filter(Boolean).forEach(P=>{const k=Br(Fa(P));E&&E.type==="subunit"?Ta(E,`${A}x ${k}`,E.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0):Ta(E,Zi(A,k),E.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}const v=y.match(/^(.*?):\s*(.*)$/);if(v&&l){(v[2]||"").split(",").map(T=>T.trim()).filter(Boolean).forEach(T=>{const E=Fa(T);Ta(l,E,l.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}}const d=[...n.CHARACTER||[],...n["OTHER DATASHEETS"]||[]];for(const h of d){h&&Array.isArray(h.items)&&h.items.length>0&&Ea(h.items);const y=h&&Array.isArray(h.items)?h.items.filter(p=>p&&p.type==="subunit"):[];for(const p of y)p&&Array.isArray(p.items)&&p.items.length>0&&Ea(p.items)}Mr(n);try{n.SUMMARY._parseDebug=(na||[]).slice(0,200)}catch{}return n}const na=[];function Is(t){const n=lr(t);if(n>0)return n;const a=(t||"").trim();return a.startsWith("◦")||a.startsWith("+")?2:0}function Ls(t){if(!t)return"";const n=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(t).split(/\s+/).map((a,s)=>{if(!a)return"";const r=a.toLowerCase();return s>0&&n.has(r)?r:r[0].toUpperCase()+r.slice(1)}).join(" ")}function Or(t,n,a,s,r="",i=!1,l="wargear",c=1){if(!t)return;t.items=t.items||[];const d=ur(String(n||"").trim()),h=d.quantity?String(d.quantity):"1x",y=d.name||"",p=ye(y);if(i){const f=String(a||""),v=String(r||"");if(ye(f)===ye(y)||v&&ye(v)===ye(y))return}const m=t.items.find(f=>ye(f.name||"")===p);if(m){const f=parseInt(String(m.quantity||"1x").replace(/x/i,""),10)||0,v=parseInt(String(h||"1x").replace(/x/i,""),10)||0;m.quantity=`${f+v}x`}else{const f=ye(y)==="warlord"?"special":l;t.items.push({quantity:h,name:y,items:[],type:f,nameshort:""})}}function Qi(t,n,a){if(!t||!n)return;n.items=n.items||[];const s=t.trim(),r=s.match(/\(([^)]+)\)$/),i=r?` (${r[1]})`:"",l=s.replace(/\s*\([^)]+\)$/,"").trim(),c=ye(l);if((n.items||[]).some(m=>m&&m.type==="special"&&ye((m.name||"").replace(/^Enhancement:\s*/i,""))===c))return;const y=`E: ${l.split(/\s+/).map(m=>m[0]?m[0].toUpperCase():"").join("")}${i}`.trim(),p={quantity:"1x",name:`Enhancement: ${l}`,nameshort:y,items:[],type:"special"};n.items.push(p)}function zd(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,s=t.findIndex(m=>a.test((m||"").trim().toUpperCase()));let i=(s===-1?t.slice(0,0):t.slice(0,s)).map(m=>(m||"").trim()).filter(m=>m&&!m.startsWith("Exported with"));const l=i.findIndex(m=>m&&m.trim()!=="");if(l!==-1){const m=i[l],f=m.match(/^(.*?)\s*\((\s*\d+\s*(?:pts|points)\s*)\)\s*$/i);if(f){n.SUMMARY.LIST_TITLE=f[1].trim();const $=(f[2].match(/(\d+)/)||[])[1]||"";$&&(n.SUMMARY.TOTAL_ARMY_POINTS=`${$}pts`)}else n.SUMMARY.LIST_TITLE=m;const v=[];for(let $=l+1;$<i.length;$++){const B=i[$];B&&v.push(B)}const A=["Combat Patrol","Incursion","Strike Force","Onslaught"],T=$=>{if(!$||!/\(/.test($))return!1;for(const B of A)if(new RegExp(B,"i").test($))return!0;return!1},E=new Set(Object.values(Ra).map($=>($||"").toString().toLowerCase())),P=v.filter($=>!(!$||T($)||E.has($.toLowerCase())));let M=null,k=null;const D=Object.keys(Ra).map($=>$.toLowerCase());for(const $ of P)D.includes(($||"").toString().toLowerCase())?M=$:k||(k=$);if(!M&&P.length>0&&(M=P[0],k=P.length>1?P[1]:k),M&&(n.SUMMARY.FACTION_KEYWORD=M),k&&(n.SUMMARY.DETACHMENT=k),M){const $=Object.keys(Ra).find(F=>F.toLowerCase()===M.toLowerCase()),B=$?Ra[$]:null;B?n.SUMMARY.DISPLAY_FACTION=`${B} - ${M}`:n.SUMMARY.DISPLAY_FACTION=M+(k?` - ${k}`:"");try{n.SUMMARY.FACTION_KEY=M.toString().toLowerCase()}catch{}}}const c=s===-1?0:s,d=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*$/i,h=/^\s*(?:•|\-|\+|◦)\s*(.*)$/;let y=null;for(let m=c;m<t.length;m++){const v=(t[m]||"").trim();if(!v||v.startsWith("Exported with"))continue;if(a.test(v.toUpperCase())){y=/^CHARACTERS?/i.test(v)?"CHARACTER":"OTHER DATASHEETS";continue}const A=v.match(d);if(A){const T=A[1].trim(),E=parseInt(String(A[2]).replace(/[\,\.\s]/g,""),10)||0;let P="1x",M=T;const k=T.match(/^([0-9]+x?)\s+(.*)$/i);k&&(P=k[1].toLowerCase(),M=k[2].trim());const D={quantity:P,name:M,points:E,items:[],isComplex:!1,nameshort:""},$=y==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[$]=n[$]||[],n[$].push(D);const B=[];let F=m+1;for(;F<t.length;){const ee=t[F]||"";if(!ee.trim()||a.test(ee.trim().toUpperCase())||d.test(ee.trim())||!/^\s+/.test(ee)&&!h.test(ee))break;B.push(ee),F++}const G=(()=>{for(let ee=0;ee<B.length;ee++){const fe=B[ee];if(!fe.match(h))continue;const ae=Is(fe);for(let De=ee+1;De<B.length;De++){const ve=B[De];if(!ve.trim()||Is(ve)<=ae)break;if(h.test(ve))return!0}}return!1})();let q=null,ie=0;for(let ee=0;ee<B.length;ee++){const fe=B[ee],se=fe.trim(),ae=fe.match(h),De=Is(fe);if(ae){const ve=ae[1].trim(),be=ve.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(ve)){Qi(ve.replace(/^Enhancement:\s*/i,"").trim(),D,n.SUMMARY.FACTION_KEYWORD||"");continue}else if(be){Qi(ve.trim(),D,n.SUMMARY.FACTION_KEYWORD||"");continue}if(G){if(q&&typeof ie=="number"&&De>ie){Or(q,ve,q.name,n.SUMMARY.FACTION_KEYWORD||"",D.name,!1);continue}if(!(()=>{for(let ge=ee+1;ge<B.length;ge++){const Pe=B[ge];if(!Pe.trim()||Is(Pe)<=De)break;if(h.test(Pe))return!0}return!1})()){q=null,Or(D,ve,D.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}q=null;const Ae=ve.match(/^(\d+x?)\s+(.*)$/i),ue=Ae?Ae[1]:"1x",le=Ae?Ae[2].trim():ve,Xe={quantity:ue,name:le,items:[],type:"subunit"};D.items=D.items||[],D.items.push(Xe),q=Xe,ie=De;continue}Or(D,ve,D.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(q&&De>ie){Or(q,se,q.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}Or(D,se,D.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1)}m=F-1;continue}}function p(m,f){if(!(!m||typeof m!="object")){if(typeof m.name!="string"&&(m.name=""),typeof m.quantity!="string"&&(m.quantity=m.quantity?String(m.quantity):"1x"),typeof m.type!="string"&&(m.type=m.type||"wargear"),typeof m.nameshort!="string"&&(m.nameshort=m.nameshort||""),Array.isArray(m.items)||(m.items=[]),/^Enhancement:/i.test(m.name)){const v=m.name.replace(/^Enhancement:\s*/i,"").trim();m.type="special",m.nameshort=m.nameshort||(()=>{const A=v.match(/\(([^)]+)\)$/),T=A?` (${A[1]})`:"";return`E: ${v.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(M=>M[0]?M[0].toUpperCase():"").join("")}${T}`.trim()})(),m.name=`Enhancement: ${Ls(v.replace(/\s*\([^)]+\)$/,"").trim())}`}else m.name=f?m.name:Ls(m.name);ye(m.name)==="warlord"&&(m.type="special"),m.items=(m.items||[]).map(v=>{if(!v)return null;if(typeof v=="string"){const A={quantity:"1x",name:v.trim(),items:[],type:/^Enhancement:/i.test(v)?"special":"wargear",nameshort:""};return p(A,m.name),A.name&&(A.name=Ls(A.name)),A}return p(v,m.name),v&&v.name&&(v.name=Ls(v.name)),v}).filter(Boolean)}}for(const m of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[m]))for(const f of n[m]){p(f);const v=(f.items||[]).filter(A=>A&&A.type==="subunit");if(v.length>0)if(v.every(T=>ye(T.name||"")===ye(f.name||""))){const T=new Map;let E=0;for(const P of v){const M=parseInt(String(P.quantity||"1x").replace(/x/i,""),10)||1;E+=M;for(const k of P.items||[]){const D={items:[]};Or(D,`${k.quantity||"1x"} ${k.name}`,f.name,n.SUMMARY.FACTION_KEYWORD||"",k.type||"wargear",1);for(const $ of D.items){const B=ye($.name||"");if(T.has(B)){const F=T.get(B),G=parseInt(String(F.quantity||"1x").replace(/x/i,""),10)||0,q=parseInt(String($.quantity||"1x").replace(/x/i,""),10)||0;F.quantity=`${G+q}x`}else T.set(B,$)}}}f.items=Array.from(T.values()),E>0&&(f.quantity=`${E}x`),f.isComplex=!1}else{const T=v.reduce((E,P)=>E+(parseInt(String(P.quantity||"1x").replace(/x/i,""),10)||0),0);T>0&&(f.quantity=`${T}x`),f.isComplex=!0}else f.isComplex=!1;Array.isArray(f.items)&&f.items.length>0&&Ea(f.items)}return Mr(n),n}function eo(t){if(!t)return"";const n=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(t).split(/\s+/).map((a,s)=>{if(!a)return"";const r=a.toLowerCase();return s>0&&n.has(r)?r:r[0].toUpperCase()+r.slice(1)}).join(" ")}function ar(t,n,a,s,r="",i=!1,l="wargear",c=1){if(!t)return;t.items=t.items||[];const d=ur(String(n||"").trim()),h=d.quantity?String(d.quantity):"1x",y=parseInt(String(h||"1x").replace(/[^0-9]/g,""),10)||1,p=`${y*(c||1)}x`;let m=d.name||"";if(!i)try{const A=m.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(A){const T=A[1].trim(),E=A[2].trim(),P=ye(T),M=ye(a||""),k=ye(r||"");P&&(P===M||P===k||M.startsWith(P+" ")||k.startsWith(P+" ")||P.startsWith(M+" ")||P.startsWith(k+" "))&&(m=E)}}catch{}const f=ye(m);if(i){const A=String(a||""),T=String(r||""),E=ye(m),P=ye(A),M=ye(T),k=P&&E.startsWith(P+" "),D=M&&E.startsWith(M+" ");if(P&&(E===P||k)||M&&(E===M||D)){const $=m.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if($){const B=$[1].trim(),F=$[2].trim(),G=ye(B);if(G===P||G===M||G.startsWith(P+" ")||G.startsWith(M+" ")){if(t&&t._deferredParenthetical&&ye(t._deferredParenthetical)===ye(F)||t&&t._deferredParenthetical&&ye(t._deferredParenthetical)===ye(F)||(t.items||[]).some(ie=>ye(ie.name||"")===ye(F)))return;ar(t,F,a,s,r,!1,l,y);return}}return}}const v=t.items.find(A=>ye(A.name||"")===f);if(v){const A=parseInt(String(v.quantity||"1x").replace(/x/i,""),10)||0,T=parseInt(String(p||"1x").replace(/x/i,""),10)||0;v.quantity=`${A+T}x`}else{const A=ye(m)==="warlord"?"special":l;t.items.push({quantity:p,name:m,items:[],type:A,nameshort:""})}}function pi(t,n,a){if(!t||!n)return;n.items=n.items||[];const s=t.trim(),r=s.match(/\(([^)]+)\)$/),i=r?` (${r[1]})`:"",l=s.replace(/\s*\([^)]+\)$/,"").trim(),c=ye(l);if((n.items||[]).some(m=>m&&m.type==="special"&&ye((m.name||"").replace(/^Enhancement:\s*/i,""))===c))return;const y=`E: ${l.split(/\s+/).map(m=>m[0]?m[0].toUpperCase():"").join("")}${i}`.trim(),p={quantity:"1x",name:`Enhancement: ${l}`,nameshort:y,items:[],type:"special"};n.items.push(p)}function to(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,s=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*(?::\s*(.*))?$/i,r=/^\s*(?:•|\-|\+|◦)\s*(.*)$/;let i=null;for(let c=0;c<t.length;c++){const h=(t[c]||"").trim();if(!h)continue;if(a.test(h.toUpperCase())){i=/^CHARACTERS?/i.test(h)?"CHARACTER":"OTHER DATASHEETS";continue}const y=h.match(s);if(y){const p=y[1].trim(),m=parseInt(String(y[2]).replace(/[\,\.\s]/g,""),10)||0;let f="1x",v=p;const A=p.match(/^([0-9]+x?)\s+(.*)$/i);A&&(f=A[1].toLowerCase(),v=A[2].trim());const T={quantity:f,name:v,points:m,items:[],isComplex:!1,nameshort:""},E=i==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[E]=n[E]||[],n[E].push(T);const P=y[3]||"";P&&P.split(",").map(F=>F.trim()).filter(Boolean).forEach(F=>ar(T,F,T.name,n.SUMMARY.FACTION_KEYWORD||"",T.name,!0));const M=[];let k=c+1;for(;k<t.length;){const F=t[k]||"";if(!F.trim()||a.test(F.trim().toUpperCase())||s.test(F.trim())||!/^\s+/.test(F)&&!r.test(F))break;M.push(F),k++}const D=(()=>{for(let F=0;F<M.length;F++){const G=M[F];if(!G.match(r))continue;const ie=lr(G);for(let ee=F+1;ee<M.length;ee++){const fe=M[ee];if(!fe.trim()||lr(fe)<=ie)break;if(r.test(fe))return!0}}return!1})();let $=null,B=0;for(let F=0;F<M.length;F++){const G=M[F],q=G.trim(),ie=G.match(r),ee=lr(G);if(ie){const fe=ie[1].trim(),se=fe.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(fe)){pi(fe.replace(/^Enhancement:\s*/i,"").trim(),T,n.SUMMARY.FACTION_KEYWORD||"");continue}else if(se){pi(fe.trim(),T,n.SUMMARY.FACTION_KEYWORD||"");continue}if(D){if($&&typeof B=="number"&&ee>B){const te=fe.split(",").map(Ae=>Ae.trim()).filter(Boolean);for(let Ae of te){const ue=Ae.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(ue){const le=ue[1].trim(),Xe=ue[2].trim();if(ye(le)===ye($.name)){const ge=te.some(ut=>ye(ut)===ye(Xe)),Pe=($.items||[]).some(ut=>ye(ut.name||"")===ye(Xe));if(ge||Pe)continue;const de=ur(Ae),bt=parseInt(String(de.quantity||"1x").replace(/[^0-9]/g,""),10)||1;ar($,Xe,$.name,n.SUMMARY.FACTION_KEYWORD||"",T.name,!1,"wargear",bt);continue}}ar($,Ae,$.name,n.SUMMARY.FACTION_KEYWORD||"",T.name,!0)}continue}$=null;const ae=fe.match(/^(\d+x?)\s+(.*)$/i),De=ae?ae[1]:"1x";let ve=ae?ae[2].trim():fe;try{const te=ve.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(te){const Ae=te[1].trim(),ue=te[2].trim(),le=ye(Ae),Xe=ye(T.name||""),ge=ye(unitTopName||T.name||"");if(le&&(le===Xe||Xe.startsWith(le)||le.startsWith(Xe)||ge.startsWith(le)||le.startsWith(ge))){ve=Ae;const Pe={quantity:De,name:ve,items:[],type:"subunit"};Pe._deferredParenthetical=ue,Pe._deferredParentheticalQty=parseInt(String(De||"1x").replace(/[^0-9]/g,""),10)||1,T.items=T.items||[],T.items.push(Pe),$=Pe,B=ee;continue}}}catch{}const be={quantity:De,name:ve,items:[],type:"subunit"};T.items=T.items||[],T.items.push(be),$=be,B=ee;continue}ar(T,fe,T.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if($&&ee>B){ar($,q,$.name,n.SUMMARY.FACTION_KEYWORD||"",T.name,!0);continue}ar(T,q,T.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1)}c=k-1;continue}}function l(c,d){if(!(!c||typeof c!="object")){if(typeof c.name!="string"&&(c.name=""),typeof c.quantity!="string"&&(c.quantity=c.quantity?String(c.quantity):"1x"),typeof c.type!="string"&&(c.type=c.type||"wargear"),typeof c.nameshort!="string"&&(c.nameshort=c.nameshort||""),Array.isArray(c.items)||(c.items=[]),/^Enhancement:/i.test(c.name)){const h=c.name.replace(/^Enhancement:\s*/i,"").trim();c.type="special",c.nameshort=c.nameshort||(()=>{const y=h.match(/\(([^)]+)\)$/),p=y?` (${y[1]})`:"";return`E: ${h.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(v=>v[0]?v[0].toUpperCase():"").join("")}${p}`.trim()})(),c.name=`Enhancement: ${eo(h.replace(/\s*\([^)]+\)$/,"").trim())}`}else c.name=d?c.name:eo(c.name);ye(c.name)==="warlord"&&(c.type="special"),c.items=(c.items||[]).map(h=>{if(!h)return null;if(typeof h=="string"){const y={quantity:"1x",name:h.trim(),items:[],type:/^Enhancement:/i.test(h)?"special":"wargear",nameshort:""};return l(y,c.name),y}return l(h,c.name),h}).filter(Boolean)}}for(const c of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[c]))for(const d of n[c]){l(d);const h=(d.items||[]).filter(p=>p&&p.type==="subunit");if(h.length>0)if(h.every(m=>ye(m.name||"")===ye(d.name||""))){const m=new Map;let f=0;for(const v of h){const A=parseInt(String(v.quantity||"1x").replace(/x/i,""),10)||1;f+=A;for(const T of v.items||[]){const E={items:[]};ar(E,`${T.quantity||"1x"} ${T.name}`,d.name,n.SUMMARY.FACTION_KEYWORD||"",T.type||"wargear",1);for(const P of E.items){const M=ye(P.name||"");if(m.has(M)){const k=m.get(M),D=parseInt(String(k.quantity||"1x").replace(/x/i,""),10)||0,$=parseInt(String(P.quantity||"1x").replace(/x/i,""),10)||0;k.quantity=`${D+$}x`}else m.set(M,P)}}}d.items=Array.from(m.values()),f>0&&(d.quantity=`${f}x`),d.isComplex=!1}else{const m=h.reduce((f,v)=>f+(parseInt(String(v.quantity||"1x").replace(/x/i,""),10)||0),0);m>0&&(d.quantity=`${m}x`),d.isComplex=!1}else d.isComplex=!1;if(Array.isArray(d.items)&&d.items.length===1&&d.items[0]&&d.items[0].type==="subunit"){const p=d.items[0];Array.isArray(p.items)&&p.items.length>0&&(d.items=p.items.slice(),d.isComplex=!1)}Array.isArray(d.items)&&d.items.length>0&&Ea(d.items);const y=(d.items||[]).filter(p=>p&&p.type==="subunit");for(const p of y)Array.isArray(p.items)&&p.items.length>0&&Ea(p.items)}return Mr(n),n}function Xd(t){if(!Array.isArray(t))return to(t);const n=[];let a=0;for(;a<t.length;a++){const p=String(t[a]||"").trim();if(!p){n.push(p);continue}if(p.startsWith("+")||p.startsWith("&")){n.push(p);continue}break}const s=[],r={};for(const y of n){if(!y)continue;if(y.startsWith("&")){const v=y.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);v&&s.push({enh:v[1].trim(),target:(v[3]||"").trim(),charId:v[2]||null});continue}const m=y.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(m){const f=m[1].trim().toUpperCase(),v=m[2].trim();if(f==="ENHANCEMENT"){const A=v.match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);A?s.push({enh:A[1].trim(),target:(A[3]||"").trim(),charId:A[2]||null}):s.push({enh:v,target:null,charId:null})}else if(f==="FACTION KEYWORD"){const A=v.split(" - ");r.faction=A[A.length-1].trim()}else f==="DETACHMENT"?r.detachment=v.replace(/\u00A0/g," "):f==="TOTAL ARMY POINTS"&&(r.points=v)}}const i=t.slice(a),l=[];for(const y of i){if(!y){l.push(y);continue}let p=String(y);p=p.replace(/^\s*Char\d+:\s*/i,"");const m=p.match(/^(.*\))\s*:\s*(.+)$/);m?(l.push(m[1]),l.push("  • "+m[2])):l.push(p)}const c=to(l);c.SUMMARY=c.SUMMARY||{},r.faction&&(c.SUMMARY.FACTION_KEYWORD=r.faction),r.detachment&&(c.SUMMARY.DETACHMENT=r.detachment),r.points&&(c.SUMMARY.TOTAL_ARMY_POINTS=r.points);const d=[...c.CHARACTER||[],...c["OTHER DATASHEETS"]||[]],h=y=>{const p=ye(String(y||""));for(const m of d){const f=m&&Array.isArray(m.items)?m.items:[];for(const v of f){if(!v||!v.name)continue;const A=String(v.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,"").trim();if(ye(A)===p)return!0}}return!1};for(const y of s){if(!y||!y.enh||h(y.enh))continue;let p=null;const m=f=>String(f||"").toLowerCase().replace(/[^a-z0-9 ]/g,"").trim();if(y.charId){const f=parseInt(String(y.charId).replace(/[^0-9]/g,""),10);!Number.isNaN(f)&&f>0&&Array.isArray(c.CHARACTER)&&c.CHARACTER[f-1]&&(p=c.CHARACTER[f-1])}!p&&y.target&&(p=d.find(f=>m(f.name).includes(m(y.target))||m(`${f.quantity} ${f.name}`).includes(m(y.target)))),!p&&d.length===1&&(p=d[0]),p&&pi(y.enh,p,c.SUMMARY.FACTION_KEYWORD||"")}try{for(const y of["CHARACTER","OTHER DATASHEETS"]){const p=c[y];if(Array.isArray(p))for(const m of p)m&&typeof m=="object"&&Object.prototype.hasOwnProperty.call(m,"type")&&delete m.type}for(const y of["CHARACTER","OTHER DATASHEETS"]){const p=c[y];if(Array.isArray(p)){for(const m of p)if(!(!m||!Array.isArray(m.items))){for(const f of m.items.filter(v=>v&&v.type==="subunit"))if(f&&f._deferredParenthetical)try{delete f._deferredParenthetical,delete f._deferredParentheticalQty}catch{}}}}}catch{}return Mr(c),c}function Vd(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=t.map(h=>String(h||"")).find(h=>h.trim()),s=t.findIndex(h=>String(h||"").trim());if(a){const h=a.split(/\s*-\s*/).map(y=>y.trim()).filter(Boolean);if(n.SUMMARY.FACTION_FAMILY=h[0]||"",n.SUMMARY.FACTION_KEYWORD=h[1]||"",h.length>=3){const p=h[h.length-1].match(/\[\s*(\d{2,5})\s*pts?\s*\]$/i);p?(n.SUMMARY.TOTAL_ARMY_POINTS=`${p[1]}pts`,h.length===3?n.SUMMARY.LIST_TITLE=h[2]:n.SUMMARY.LIST_TITLE=h.slice(2,h.length-1).join(" - ")):n.SUMMARY.LIST_TITLE=h.slice(2).join(" - ")}n.SUMMARY.DISPLAY_FACTION=a.trim()}for(let h=0;h<Math.min(t.length,40);h++){const y=String(t[h]||"").trim();if(!y)continue;const p=y.match(/^Detachment:\s*(.*)$/i);p&&(n.SUMMARY.DETACHMENT=p[1].trim());const m=y.match(/^TOTAL ARMY POINTS:\s*(.*)$/i);m&&(n.SUMMARY.TOTAL_ARMY_POINTS=m[1].trim());const f=y.match(/^FACTION KEYWORD:\s*(.*)$/i);f&&(n.SUMMARY.FACTION_KEYWORD=f[1].trim());const v=y.match(/^Battle Size:\s*(.*)$/i);v&&(n.SUMMARY.BATTLE_SIZE=v[1].trim());const A=y.match(/^#+\s*(?:\+{1,2}\s*)?(.*)\[\s*\d{2,5}\s*pts?\s*\]$/i);if(A&&!n.SUMMARY.LIST_TITLE){const T=A[1].trim();/Army\s+Roster/i.test(T)||/\+\+/.test(T)?n.SUMMARY.LIST_TITLE="":n.SUMMARY.LIST_TITLE=T}}if(!n.SUMMARY.FACTION_KEYWORD&&n.SUMMARY.DISPLAY_FACTION){const h=n.SUMMARY.DISPLAY_FACTION.split(" - ");h.length>=2?n.SUMMARY.FACTION_KEYWORD=h[1].trim():n.SUMMARY.FACTION_KEYWORD=n.SUMMARY.DISPLAY_FACTION.replace(/\s*\[.*$/,"").trim()}const r=/^(?:(\d+)x?\s+)?(.+?)\s*\[\s*(\d{1,4})\s*pts?\s*\]\s*(?::\s*(.*))?$/i,i=/^\s*(?:•|\-|\+)\s*(.*)$/;let l=null,c=null;for(let h=0;h<t.length;h++){const y=String(t[h]||""),p=y.trim();if(!p||h===s)continue;if(p.startsWith("#")){const v=p.match(/^#+\s*(.+?)\s*(?:\[\s*\d+\s*pts?\s*\])?$/i);if(v){const A=v[1].trim();/character|epic|hero|hq/i.test(A)?l="CHARACTER":l="OTHER DATASHEETS"}continue}const m=p.match(r);if(m){const v=m[1]?`${m[1]}x`:"1x",A=(m[2]||"").trim(),T=parseInt(m[3],10)||0,E=m[4]||"",P={quantity:v,name:A,points:T,items:[],isComplex:!1,nameshort:""};l||(l="OTHER DATASHEETS"),n[l]=n[l]||[],n[l].push(P),c=P,E&&E.split(",").map(M=>M.trim()).filter(Boolean).forEach(M=>{d(c,M,c.name,n.SUMMARY.FACTION_KEYWORD||"",c.name,!0)});continue}const f=y.match(i);if(f&&c){const v=f[1].trim(),A=v.match(/^(\d+)\s+with\s+(.*)$/i);if(A&&c){const P=parseInt(A[1],10)||1,M=A[2],k=c.items&&c.items.length>0?c.items[c.items.length-1]:c;M.split(",").map(D=>D.trim()).filter(Boolean).forEach(D=>d(k,`${P}x ${D}`,k.name,n.SUMMARY.FACTION_KEYWORD||"",c.name,!0));continue}const T=v.match(/^(\d+x?)\s+([^:]+):\s*(.*)$/i);if(T){const P=T[1];let M=T[2].trim();const k=T[3]||"";M=M.replace(/\s+w\/.*$/i,"").trim();const D={quantity:P,name:M,items:[],type:"subunit"};if(k){const $=k.match(/^(\d+)\s+with\s+(.*)$/i);if($){const B=parseInt($[1],10)||1;$[2].split(",").map(G=>G.trim()).filter(Boolean).forEach(G=>d(D,`${B}x ${G}`,D.name,n.SUMMARY.FACTION_KEYWORD||"",c.name,!0))}else k.split(",").map(B=>B.trim()).filter(Boolean).forEach(B=>d(D,B,D.name,n.SUMMARY.FACTION_KEYWORD||"",c.name,!0))}c.items=c.items||[],c.items.push(D);continue}const E=v.match(/^(\d+x?)\s+(.*)$/i);if(E&&c){let P=E[2].trim();P=P.replace(/\s+w\/.*$/i,"").trim();const M={quantity:E[1],name:P,items:[],type:"subunit"};c.items=c.items||[],c.items.push(M);continue}d(c,v,c.name,n.SUMMARY.FACTION_KEYWORD||"",c.name,!0);continue}}function d(h,y,p,m,f="",v=!1,A="wargear"){if(!h)return;h.items=h.items||[];const T=String(y||"").trim(),E=ur(T),P=E.quantity?String(E.quantity):"1x",M=/^\s*\d+x?\s+/i.test(T);let k=E.name||"";const D=k.match(/^(.*?)\s*\(([^)]+)\)$/);if(D){const q=(D[1]||"").trim(),ie=(D[2]||"").trim();(/\bDrone\b/i.test(q)||/\bDrone\b/i.test(k))&&(k=ie)}const $=ye(k);if(v){const q=String(p||""),ie=String(f||"");if(ye(q)===ye(k)||ie&&ye(ie)===ye(k))return}const B=parseInt(String(P||"1x").replace(/x/i,""),10)||1;let F=B;if(h&&h.type==="subunit"){const q=parseInt(String(h.quantity||"1x").replace(/[^0-9]/g,""),10)||1;F=M?B:q}const G=h.items.find(q=>ye(q.name||"")===$);if(G){const q=parseInt(String(G.quantity||"1x").replace(/x/i,""),10)||0;G.quantity=`${q+F}x`}else{const q=ye(k)==="warlord"?"special":A;h.items.push({quantity:`${F}x`,name:k,items:[],type:q,nameshort:""})}}for(const h of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[h]))for(const y of n[h]){if(!y||!Array.isArray(y.items)||y.items.length===0)continue;if(y.items.filter(f=>f&&f.type==="subunit").length>1){const f=new Map,v=[];for(const A of y.items){if(!A||A.type!=="subunit"){v.push(A);continue}const T=ye(A.name||"");if(!f.has(T))f.set(T,{quantity:A.quantity||"1x",name:A.name,items:Array.isArray(A.items)?A.items.slice():[],type:"subunit"});else{const E=f.get(T),P=parseInt(String(E.quantity||"1x").replace(/[^0-9]/g,""),10)||0,M=parseInt(String(A.quantity||"1x").replace(/[^0-9]/g,""),10)||0;E.quantity=`${P+M}x`;const k=new Map;for(const D of E.items||[]){const $=ye(D&&D.name||"");$&&k.set($,{quantity:D.quantity||"1x",name:D.name,items:[],type:D.type||"wargear",nameshort:D.nameshort||""})}for(const D of A.items||[]){const $=ye(D&&D.name||"");if($)if(k.has($)){const B=k.get($),F=parseInt(String(B.quantity||"1x").replace(/[^0-9]/g,""),10)||0,G=parseInt(String(D.quantity||"1x").replace(/[^0-9]/g,""),10)||0;B.quantity=`${F+G}x`}else k.set($,{quantity:D.quantity||"1x",name:D.name,items:[],type:D.type||"wargear",nameshort:D.nameshort||""})}E.items=Array.from(k.values())}}y.items=[...v,...Array.from(f.values())]}y&&Array.isArray(y.items)&&y.items.length>0&&Ea(y.items);const m=y&&Array.isArray(y.items)?y.items.filter(f=>f&&f.type==="subunit"):[];for(const f of m)f&&Array.isArray(f.items)&&f.items.length>0&&Ea(f.items)}return Mr(n),n}function jd(t,n=40){return(Array.isArray(t)?t:String(t||"").split(/\r?\n/)).slice(0,n)}function Jd(t){const n=Array.isArray(t)?t:String(t||"").split(/\r?\n/),a=jd(n,40),s=n.join(`
`),r={NRNR:{score:0,breakdown:{},maxScore:8},"WTC-Compact":{score:0,breakdown:{},maxScore:8},WTC:{score:0,breakdown:{},maxScore:8},GWAPP:{score:0,breakdown:{},maxScore:7},"NR-GW":{score:0,breakdown:{},maxScore:7},LF:{score:0,breakdown:{},maxScore:7}},i=a.some(ae=>/-\s*\[\s*\d{2,5}\s*pts?\s*\]$/i.test(ae)),l=a.some(ae=>/^#{1,3}\s+/.test(ae)),c=a.some(ae=>/^\s*#?\s*\+\+\s*Army Roster\s*\+\+/i.test(ae)),d=a.some(ae=>/^\s*##\s+/.test(ae)),h=/(.+?)\s*[\(\[]\s*([0-9]{1,4})\s*(?:pts|points)\s*[\)\]]/i,y=s.match(new RegExp(h.source,"g"))||[],p=s.match(/^[ \t]*(?:•|\-|\+)\s*(?:\d+x?)\s+[^:]+:/gmi)||[],m=s.match(/\b[A-Za-z0-9\-\'’ ]+\s*\([^\)]+\)/g)||[],f=/(^|\n)\s*Char\d+:.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)\s*:\s*/i,v=(s.match(new RegExp(f.source,"gi"))||[]).length,A=a.some(ae=>/^(List Name|Factions Used|Army Points|Detachment Rule):/i.test(ae.trim())),T=a.some(ae=>/-\s*\(\s*\d+\s*Points?\s*\)\s*$/i.test(ae)),E=s.match(/^(Epic Hero|Epic Heroes|Character|Characters|Battleline|Infantry|Beast|Vehicle|Dedicated Transport|Other Datasheets):\s*$/gmi)||[],P=(s.match(/^\s*•\s*(?:E:|Enhancement:)/gmi)||[]).length,M=(s.match(/^\s*•\s+/gmi)||[]).length;A&&(r.LF.score+=4,r.LF.breakdown.headerKeys=4),T&&(r.LF.score+=4,r.LF.breakdown.titleLine=4),E.length>=2&&(r.LF.score+=3,r.LF.breakdown.sectionColons=E.length),M>5&&(r.LF.score+=1,r.LF.breakdown.bullets=M),P>0&&(r.LF.score+=1,r.LF.breakdown.enhancementLines=P),(A||T||E.length>=2)&&(r.NRNR.score-=1,r.WTC.score-=1,r["WTC-Compact"].score-=1,r.GWAPP.score-=1,r["NR-GW"].score-=3),i&&(r.NRNR.score+=2,r.NRNR.breakdown.titleWithBracketedPts=2),l&&(r.NRNR.score+=3,r.NRNR.breakdown.markdownHeading=3),c&&(r.NRNR.score+=2,r.NRNR.breakdown.armyRoster=2),d&&(r.NRNR.score+=1,r.NRNR.breakdown.doubleHashSections=1),y.length>=3&&(r.NRNR.score+=1,r.NRNR.breakdown.unitLines=1),p.length>0&&(r.NRNR.score+=1,r.NRNR.breakdown.bulletWithQty=p.length),m.length>0&&(r.NRNR.score+=.5,r.NRNR.breakdown.parenItem=m.length);const k=a.join(`
`);/^[ \t]*[+&]/m.test(k)&&(r["WTC-Compact"].score+=3,r["WTC-Compact"].breakdown.headerPlusAmp=3),/(FACTION KEYWORD|DETACHMENT|TOTAL ARMY POINTS)/i.test(k)&&(r["WTC-Compact"].score+=2,r["WTC-Compact"].breakdown.headerKeys=2),y.length>=2&&(r["WTC-Compact"].score+=1,r["WTC-Compact"].breakdown.unitLines=1),v>0&&(r["WTC-Compact"].score+=5,r["WTC-Compact"].breakdown.inlineCharList=v),/^\s*[+&]/m.test(k)&&(r.WTC.score+=1,r.WTC.breakdown.headerPlusAmp=1),/NUMBER OF UNITS:/i.test(k)&&(r.WTC.score+=2,r.WTC.breakdown.numberOfUnits=2);const D=(s.match(/(^|\n)\s*Char\d+:/gi)||[]).length>0;D&&(r.WTC.score+=3,r.WTC.breakdown.charMarkers=3),(l||c||d)&&(r.WTC.score-=2,r.WTC.breakdown.nrnrPenalty=-2,r["WTC-Compact"].score-=1,r["WTC-Compact"].breakdown.nrnrPenalty=-1);const $=(s.match(/^\s*\d+\s+with\s+/gmi)||[]).length;$>0&&(r.WTC.score+=2,r.WTC.breakdown.withLines=$,r["WTC-Compact"].score+=2,r["WTC-Compact"].breakdown.withLines=$),a.some(ae=>/^(?:CHARACTER|OTHER DATASHEETS|CHARACTERS)\s*$/.test((ae||"").trim()))&&(r.WTC.score+=1,r.WTC.breakdown.sectionHeaders=1),D&&(r["WTC-Compact"].score-=1,r["WTC-Compact"].breakdown.charMarkerPenalty=-1),v>0&&(r.WTC.score-=2,r.WTC.breakdown.compactInlinePenalty=-2);const B=/Exported with/i.test(s);(/Exported with/i.test(k)||B)&&(r.GWAPP.score+=6,r.GWAPP.breakdown.exportedWith=6),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS)\b/i.test(s)&&(r.GWAPP.score+=2,r.GWAPP.breakdown.sectionHeaders=2),/\(\s*\d+\s*(?:pts|points)\s*\)/i.test(k)&&(r.GWAPP.score+=1,r.GWAPP.breakdown.titleParenPts=1),B&&(r["NR-GW"].score-=4,r["NR-GW"].breakdown.gwappPenalty=-4),/^\s*Strike Force\s*\(\s*\d{2,5}\s*points\s*\)/mi.test(s)&&(r.GWAPP.score+=3,r.GWAPP.breakdown.strikeForce=3),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|DEDICATED TRANSPORTS)\b/i.test(s)&&(r["NR-GW"].score+=2,r["NR-GW"].breakdown.sectionHeaders=2);const F=(s.match(/^[ \t]*(?:•|\u2022|◦|\-|\+)\s+/gmi)||[]).length;F>0&&!B&&(r["NR-GW"].score+=1,r["NR-GW"].breakdown.bulletCount=F),m.length>0&&!B&&(r["NR-GW"].score+=1,r["NR-GW"].breakdown.parenItem=m.length);const G=(s.match(/^[ \t]*(?:•|\u2022|◦|\-|\+)\s*\d+x?\s+[A-Za-z0-9\-\'’]+/gmi)||[]).length;G>=3&&!D&&!B&&(r["NR-GW"].score+=3,r["NR-GW"].breakdown.bulletQty=G);const q=/^(?:\s*)\d+x?\s+.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)/i,ie=n.filter(ae=>q.test(ae)).length;if(ie>=2&&!D&&!B&&(r["NR-GW"].score+=2,r["NR-GW"].breakdown.unitLinesNoChar=ie),!D&&!B&&(G>=3||ie>=2)&&(r.WTC.score-=2,r.WTC.breakdown.nrGwPenalty=-2,r["WTC-Compact"].score-=2,r["WTC-Compact"].breakdown.nrGwPenalty=-2),(l||c)&&(r["NR-GW"].score-=1,r["NR-GW"].breakdown.nrnrPenalty2=-1),s.indexOf("’")!==-1)for(const ae of Object.keys(r))r[ae].score+=.5,r[ae].breakdown=r[ae].breakdown||{},r[ae].breakdown.unicodeApostrophe=.5;const ee={};for(const ae of Object.keys(r)){const De=r[ae],ve=Math.max(0,Math.min(1,De.score/(De.maxScore||8)));ee[ae]={score:De.score,confidence:ve,scoreBreakdown:De.breakdown}}const fe=Object.keys(ee).sort((ae,De)=>ee[De].score-ee[ae].score)[0],se=ee[fe]||{score:0,confidence:0};return{format:fe,confidence:se.confidence,score:se.score,scoreBreakdown:se.scoreBreakdown,all:ee}}function xl(t){const n=String(t||"").trim().match(/^(\d+)\s+(.*)$/);return n&&!/^\d+x\b/i.test(String(t||""))?`${n[1]}x ${n[2]}`:t}function _l(t){const n=String(t||"").trim().replace(/^E:\s*/i,"").replace(/^Enhancement:\s*/i,"").trim(),a=n.match(/\(([^)]*pts?[^)]*)\)\s*$/i),s=n.replace(/\s*\([^)]*\)\s*$/,"").trim(),i=`E: ${s.split(/\s+/).map(l=>l[0]?l[0].toUpperCase():"").join("")}${a?` (${a[1].trim()})`:""}`.trim();return{quantity:"1x",name:`Enhancement: ${s}`,nameshort:i,items:[],type:"special"}}function Zd(t,n){if(!t)return;t.items=t.items||[];const a=xl(String(n||"").trim());if(/^(E:|Enhancement:)/i.test(a)){const r=_l(a),i=ye(r.name.replace(/^Enhancement:\s*/i,""));(t.items||[]).some(c=>/^Enhancement:/i.test(c.name||"")&&ye(String(c.name).replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,""))===i)||t.items.push(r);return}const s=a.split(",").map(r=>r.trim()).filter(Boolean);for(const r of s){const i=ur(r.replace(/^with\s+/i,"")),l=i.quantity||"1x",c=i.name||"";if(!c)continue;const d=ye(c),h=t.items.find(y=>ye(y.name||"")===d);if(h){const y=parseInt(String(h.quantity||"1x").replace(/[^0-9]/g,""),10)||0,p=parseInt(String(l).replace(/[^0-9]/g,""),10)||0;h.quantity=`${y+p}x`}else t.items.push({quantity:l,name:c,items:[],type:"wargear",nameshort:""})}}function Qd(t,n){const a=t[n]||"",s=lr(a);for(let r=n+1;r<t.length;r++){const i=t[r]||"";if(!i.trim())continue;const l=lr(i),c=/^\s*•\s*/.test(i);return l>s&&c}return!1}function em(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=t.slice(0,30).map(m=>String(m||""));let s=!1;for(const m of a){const f=m.match(/^\s*([A-Za-z ][A-Za-z ]*):\s*(.*)$/);if(!f)continue;const v=f[1].trim().toLowerCase(),A=f[2].trim();if(v==="list name"&&(n.SUMMARY.LIST_TITLE=A,s=!0),v==="factions used"&&(n.SUMMARY.FACTION_KEYWORD=A,s=!0),v==="army points"){const T=parseInt(A.replace(/[^0-9]/g,""),10);T&&(n.SUMMARY.TOTAL_ARMY_POINTS=`${T}pts`,s=!0)}v==="detachment rule"&&(n.SUMMARY.DETACHMENT=A,s=!0)}if(!s){const m=t.find(f=>String(f||"").trim());if(m){const f=String(m).match(/^(.*?)\s*-\s*(.*?)\s*-\s*(.*?)\s*\((\d+)\s*Points?\)/i);f&&(n.SUMMARY.LIST_TITLE=f[1].trim(),n.SUMMARY.FACTION_KEYWORD=f[2].trim(),n.SUMMARY.DETACHMENT=f[3].trim(),n.SUMMARY.TOTAL_ARMY_POINTS=`${parseInt(f[4],10)}pts`)}}const r=/^\s*([A-Za-z ]+):\s*$/,i=/^\s*(.*?)\s*\((\d+)\s*pts?\)\s*$/i,l=/^\s*•\s*(.*)$/;let c=null;const d=[];for(let m=0;m<t.length;m++){const f=String(t[m]||"");if(!f.trim())continue;const A=f.match(r);if(A){const $=A[1].trim().toLowerCase();c=/hero|character/.test($)?"CHARACTER":"OTHER DATASHEETS",d.length=0;continue}const T=f.match(i);if(T&&lr(f)===0){const $=T[1].trim(),B=parseInt(T[2],10)||0,F={quantity:"1x",name:$,points:B,items:[],isComplex:!1,nameshort:""},G=c==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[G]=n[G]||[],n[G].push(F),d.length=0,d.push({indent:0,node:F});continue}const E=f.match(l);if(!E)continue;const P=E[1].trim(),M=lr(f);for(;d.length>0&&M<=d[d.length-1].indent;)d.pop();const k=d.length>0?d[d.length-1].node:null;if(!k||/^B:\s*/i.test(P))continue;if(/^(E:|Enhancement:)/i.test(P)){const $=_l(P),B=d[0]?d[0].node:k;B.items=B.items||[],(B.items||[]).some(G=>/^Enhancement:/i.test(G.name||"")&&ye(G.name)===ye($.name))||B.items.push($);continue}if(Qd(t,m)){const $=ur(xl(P));let B=$.name||"";B=B.replace(/\s+w\/.*$/i,"").trim();const F={quantity:$.quantity||"1x",name:B,items:[],type:"subunit"};k.items=k.items||[],k.items.push(F),d.push({indent:M,node:F});continue}Zd(k,P)}function h(m){const f=parseInt(String(m||"1x").replace(/[^0-9]/g,""),10);return Number.isFinite(f)&&f>0?f:1}for(const m of["CHARACTER","OTHER DATASHEETS"]){const f=n[m]||[];for(const v of f){const A=Array.isArray(v.items)?v.items:[],T=A.filter(k=>k&&k.type==="subunit");if(T.length<=1)continue;const E=new Map;for(const k of T){const D=ye((k.name||"").replace(/\s+w\/.*/i,"").trim());E.has(D)||E.set(D,{name:k.name,qty:0,wargear:new Map});const $=E.get(D);$.qty+=h(k.quantity);const B=Array.isArray(k.items)?k.items:[];for(const F of B){const G=ye(F.name||""),q=$.wargear.get(G)||{name:F.name,qty:0,type:F.type||"wargear"};q.qty+=h(F.quantity),$.wargear.has(G),$.wargear.set(G,q)}}const P=A.filter(k=>!(k&&k.type==="subunit")),M=[];for(const[,k]of E){const D={quantity:`${k.qty}x`,name:k.name,items:[],type:"subunit"};for(const[,$]of k.wargear)D.items.push({quantity:`${$.qty}x`,name:$.name,items:[],type:$.type||"wargear",nameshort:""});M.push(D)}v.items=[...P,...M]}}const y=n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD?String(n.SUMMARY.FACTION_KEYWORD).trim():"";function p(m){if(!m||!y)return m;const f=new RegExp("^"+y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\s+","i");return String(m).replace(f,"").trim()}if(y)for(const m of["CHARACTER","OTHER DATASHEETS"]){const f=n[m]||[];for(const v of f){v.name=p(v.name);const A=(v.items||[]).filter(T=>T&&T.type==="subunit");for(const T of A)T.name=p(T.name)}}for(const m of["CHARACTER","OTHER DATASHEETS"]){const f=n[m]||[];for(const v of f){Array.isArray(v.items)&&v.items.length>0&&Ea(v.items);const A=(v.items||[]).filter(T=>T&&T.type==="subunit");for(const T of A)Array.isArray(T.items)&&T.items.length>0&&Ea(T.items)}}return Mr(n),n}function tm(t){try{const n=Jd(t).format;return n==="NRNR"?"NRNR":n==="WTC-Compact"?"WTC_COMPACT":n==="WTC"?"WTC":n==="GWAPP"?"GW_APP":n==="NR-GW"?"NR_GW":n==="LF"?"LF":"UNKNOWN"}catch{const a=Array.isArray(t)?t.slice(0,25):[],s=a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i)||/^\s*\+\s*DETACHMENT:/i.test(i)),r=a.some(i=>/^(?:CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i.test((i||"").trim().toUpperCase()));return s&&r?"NR_GW":a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i))?"WTC_COMPACT":r?"GW_APP":"UNKNOWN"}}async function nm(t){if(!t||typeof t!="string")throw new Error("Invalid army list text");const n=t.split(`
`),a=tm(n);if(a==="UNKNOWN")throw new Error("Unable to detect army list format. Supported formats: GW App, WTC, WTC Compact, NR-GW, NR-NR, ListForge");let s;try{switch(a){case"GW_APP":s=zd(n);break;case"WTC":s=Gd(n);break;case"WTC_COMPACT":s=Ud(n);break;case"NR_GW":s=Xd(n);break;case"NRNR":s=Vd(n);break;case"LF":s=em(n);break;default:throw new Error(`Unsupported format: ${a}`)}}catch(i){throw console.error("Parse error:",i),new Error(`Failed to parse ${a} format: ${i.message}`)}const r=am(s);return{format:a,data:r}}function am(t,n){const a=t.SUMMARY||{},s=[],r=["CHARACTER","CHARACTERS","BATTLELINE","OTHER DATASHEETS","ALLIED UNITS","DEDICATED TRANSPORTS"];for(const i of r)t[i]&&Array.isArray(t[i])&&s.push(...t[i].map(l=>({...l,section:i})));return{FACTION_KEYWORD:a.FACTION_KEYWORD||a.FACTION_KEY||"Unknown",DETACHMENT:a.DETACHMENT||"",TOTAL_ARMY_POINTS:a.TOTAL_ARMY_POINTS||"0pts",LIST_TITLE:a.LIST_TITLE||"",UNITS:s}}function rm(t){if(!t)return 1;const n=String(t).match(/(\d+)/);return n?parseInt(n[1],10):1}const sm={Asurmen:{baseType:"40mm"},Autarch:{baseType:"32mm"},"Autarch wayleaper":{baseType:"32mm"},"Avatar of Khaine":{baseType:"80mm"},Baharroth:{baseType:"40mm"},"Corsair Voidreavers":{baseType:"28.5mm"},"Corsair Voidscarred":{baseType:"28.5mm"},"Crimson Hunter":{baseType:"120x92mm"},"D-cannon Platform":{baseType:"40mm"},"Dark Reapers":{baseType:"28.5mm"},"Death Jester":{baseType:"25mm"},"Dire Avengers":{baseType:"28.5mm"},"Eldrad Ulthran":{baseType:"32mm"},Falcon:{baseType:"Large Flying Base"},Farseer:{baseType:"25mm"},"Farseer Skyrunner":{baseType:"Small Flying Base"},"Fire Dragons":{baseType:"28.5mm"},"Fire Prism":{baseType:"Large Flying Base"},Fuegan:{baseType:"40mm"},"Guardian Defenders":{baseType:"28.5mm"},"Guardian Defenders: Heavy Weapon Platform":{baseType:"40mm"},"Hemlock Wraithfighter":{baseType:"120x92mm"},"Howling Banshees":{baseType:"28.5mm"},"Jain Zar":{baseType:"40mm"},Lhykhis:{baseType:"40mm"},"Maugan Ra":{baseType:"40mm"},"Night Spinner":{baseType:"Large Flying Base"},Rangers:{baseType:"28.5mm"},"Shadow Weaver Platform":{baseType:"40mm"},Shadowseer:{baseType:"25mm"},"Shining Spears":{baseType:"Large Flying Base"},"Shroud Runners":{baseType:"Large Flying Base"},Skyweavers:{baseType:"Large Flying Base"},Solitaire:{baseType:"25mm"},Spiritseer:{baseType:"25mm"},Starweaver:{baseType:"Large Flying Base"},"Storm Guardians":{baseType:"28.5mm"},"Storm Guardians: Serpent’s Scale Platform":{baseType:"40mm"},"Striking Scorpions":{baseType:"28.5mm"},"Swooping Hawks":{baseType:"28.5mm"},"The Visarch":{baseType:"32mm"}},im={"Corvus Blackstar":{baseType:"120x92mm"},"Deathwatch Terminator Squad":{baseType:"40mm"},"Deathwatch Veterans":{baseType:"32mm"},"Fortis Kill Team":{baseType:"32mm"},"Indomitor Kill Team":{baseType:"40mm"},"Spectrus Kill Team":{baseType:"32mm"},"Spectrus Kill Team: Kill Team Infiltrators with bolt sniper rifles":{baseType:"40mm"},"Talonstrike Kill Team":{baseType:"32mm"},"Talonstrike Kill Team: Kill Team Heavy Intercessors with Jump Packs":{baseType:"40mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},om={Archon:{baseType:"25mm"},Beastmaster:{baseType:"Small Flying Base"},"Beastmaster: Clawed Fiends, Khymerae, Razorwing Flocks":{baseType:"40mm"},"Court of the Archon: Sslyth":{baseType:"40mm"},"Court of the Archon: Ur-Ghul, Lhamaean, Medusae":{baseType:"25mm"},Cronos:{baseType:"Large Flying Base"},Drazhar:{baseType:"40mm"},Grotesques:{baseType:"40mm"},Haemonculus:{baseType:"25mm"},Hellions:{baseType:"Small Flying Base"},Incubi:{baseType:"28.5mm"},"Kabalite Warriors":{baseType:"25mm"},"Lelith Hesperax":{baseType:"32mm"},Mandrakes:{baseType:"28.5mm"},Raider:{baseType:"Large Flying Base"},Ravager:{baseType:"Large Flying Base"},"Razorwing Jetfighter":{baseType:"120x92mm"},Reavers:{baseType:"Small Flying Base"},Scourges:{baseType:"32mm"},Succubus:{baseType:"25mm"},Talos:{baseType:"Large Flying Base"},"Urien Rakarth":{baseType:"25mm"},Venom:{baseType:"Large Flying Base"},"Voidraven Bomber":{baseType:"120x92mm"},Wracks:{baseType:"25mm"},Wyches:{baseType:"25mm"}},lm={"Annihilation Barge":{baseType:"Large Flying Base"},"C’tan Shard of the Deceiver":{baseType:"40mm"},"C’tan Shard of the Nightbringer":{baseType:"40mm"},"C’tan Shard of the Void Dragon":{baseType:"80mm"},"Canoptek Doomstalker":{baseType:"90mm"},"Canoptek Reanimator":{baseType:"60mm"},"Canoptek Scarab Swarms":{baseType:"40mm"},"Canoptek Spyders":{baseType:"60mm"},"Canoptek Wraiths":{baseType:"50mm"},"Catacomb Command Barge":{baseType:"Large Flying Base"},Chronomancer:{baseType:"40mm"},"Convergence of Dominion":{baseType:"hull",hullDimensions:{width:0,height:0}},Cryptothralls:{baseType:"32mm"},Deathmarks:{baseType:"32mm"},"Doom Scythe":{baseType:"120x92mm"},"Doomsday Ark":{baseType:"Large Flying Base"},"Flayed Ones":{baseType:"28.5mm"},"Ghost Ark":{baseType:"Large Flying Base"},"Hexmark Destroyer":{baseType:"50mm"},"Illuminor Szeras":{baseType:"80mm"},Immortals:{baseType:"32mm"},"Imotekh the Stormlord":{baseType:"40mm"},"Lokhust Destroyers":{baseType:"Large Flying Base"},"Lokhust Heavy Destroyers":{baseType:"60mm"},"Lokhust Lord":{baseType:"Large Flying Base"},Lychguard:{baseType:"32mm"},Monolith:{baseType:"160mm"},"Necron Warriors":{baseType:"32mm"},"Night Scythe":{baseType:"120x92mm"},Obelisk:{baseType:"120x92mm"},"Ophydian Destroyers":{baseType:"50mm"},"Orikan the Diviner":{baseType:"40mm"},Overlord:{baseType:"40mm"},"Overlord with Translocation Shroud":{baseType:"40mm"},Plasmancer:{baseType:"32mm"},Psychomancer:{baseType:"40mm"},"Royal Warden":{baseType:"32mm"},"Skorpekh Destroyers":{baseType:"50mm"},"Skorpekh Lord":{baseType:"60mm"},Technomancer:{baseType:"50mm"},"Tesseract Vault":{baseType:"120x92mm"},"The Silent King: Szarekh":{baseType:"100mm"},"The Silent King: Triarchal Menhir":{baseType:"50mm"},"Tomb Blades":{baseType:"Small Flying Base"},"Transcendent C’tan":{baseType:"60mm"},"Trazyn the Infinite":{baseType:"40mm"},"Triarch Praetorians":{baseType:"32mm"},"Triarch Stalker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Seraptek Heavy Construct":{baseType:"hull",hullDimensions:{width:0,height:0}}},cm={Battlewagon:{baseType:"hull",hullDimensions:{width:0,height:0}},"Beast Snagga Boyz":{baseType:"32mm"},Beastboss:{baseType:"50mm"},"Beastboss on Squigosaur":{baseType:"80mm"},"Big Mek":{baseType:"50mm"},"Big Mek in Mega Armour":{baseType:"40mm"},"Big Mek with Shokk Attack Gun":{baseType:"40mm"},"Big’ed Bossbunka":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blitza-bommer":{baseType:"120x92mm"},"Boomdakka Snazzwagon":{baseType:"150x95mm"},"Boss Snikrot":{baseType:"40mm"},Boyz:{baseType:"32mm"},"Breaka Boyz":{baseType:"32mm"},"Breaka Boyz: Boss Nob":{baseType:"40mm"},"Burna Boyz":{baseType:"32mm"},"Burna-bommer":{baseType:"120x92mm"},Dakkajet:{baseType:"120x92mm"},"Deff Dread":{baseType:"60mm"},"Deffkilla Wartrike":{baseType:"150x95mm"},Deffkoptas:{baseType:"75x42mm"},"Flash Gitz":{baseType:"40mm"},"Ghazghkull Thraka":{baseType:"80mm"},"Ghazghkull Thraka: Makari":{baseType:"25mm"},Gorkanaut:{baseType:"170x109mm"},Gretchin:{baseType:"25mm"},"Gretchin: Runtherd":{baseType:"32mm"},"Hunta Rig":{baseType:"170x109mm"},"Kill Rig":{baseType:"170x109mm"},"Killa Kans":{baseType:"60mm"},Kommandos:{baseType:"32mm"},"Kustom Boosta-blasta":{baseType:"150x95mm"},Lootas:{baseType:"32mm"},Meganobz:{baseType:"40mm"},"Megatrakk Scrapjet":{baseType:"150x95mm"},Mek:{baseType:"32mm"},"Mek Gunz":{baseType:"hull",hullDimensions:{width:0,height:0}},Morkanaut:{baseType:"170x109mm"},"Mozrog Skragbad":{baseType:"80mm"},Nobz:{baseType:"32mm"},Painboss:{baseType:"40mm"},Painboy:{baseType:"32mm"},"Rukkatrukk Squigbuggy":{baseType:"150x95mm"},"Shokkjump Dragsta":{baseType:"150x95mm"},"Squighog Boyz":{baseType:"75x42mm"},"Squighog Boyz: Nob on Smasha Squig":{baseType:"90x52.5mm"},Stompa:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormboyz:{baseType:"32mm"},Tankbustas:{baseType:"32mm"},"Tankbustas: Boss Nob":{baseType:"40mm"},Trukk:{baseType:"hull",hullDimensions:{width:0,height:0}},Warbikers:{baseType:"75x42mm"},Warboss:{baseType:"40mm"},"Warboss in Mega Armour":{baseType:"50mm"},"Wazbom Blastajet":{baseType:"150x95mm"},Weirdboy:{baseType:"40mm"},Wurrboy:{baseType:"32mm"},"Zodgrod Wortsnagga":{baseType:"50mm"},"Gargantuan Squiggoth":{baseType:"hull",hullDimensions:{width:0,height:0}}},um={Barbgaunts:{baseType:"40mm"},Biovores:{baseType:"80mm"},Broodlord:{baseType:"75x42mm"},Carnifexes:{baseType:"105x70mm"},Deathleaper:{baseType:"60mm"},Exocrine:{baseType:"120x92mm"},Gargoyles:{baseType:"Small Flying Base"},Genestealers:{baseType:"32mm"},Harpy:{baseType:"120x92mm"},Haruspex:{baseType:"120x92mm"},"Hive Crone":{baseType:"120x92mm"},"Hive Guard":{baseType:"50mm"},"Hive Tyrant":{baseType:"50mm"},Hormagaunts:{baseType:"28.5mm"},Lictor:{baseType:"50mm"},Maleceptor:{baseType:"120x92mm"},Mawloc:{baseType:"120x92mm"},"Mucolid Spores":{baseType:"40mm"},Neurogaunts:{baseType:"25mm"},"Neurogaunts: Nodebeasts":{baseType:"28.5mm"},Neurolictor:{baseType:"50mm"},Neurotyrant:{baseType:"50mm"},"Norn Assimilator":{baseType:"100mm"},"Norn Emissary":{baseType:"100mm"},"Old One Eye":{baseType:"105x70mm"},"Parasite of Mortrex":{baseType:"40mm"},Psychophage:{baseType:"120x92mm"},Pyrovores:{baseType:"80mm"},Raveners:{baseType:"40mm"},"Ripper Swarms":{baseType:"40mm"},"Screamer-killer":{baseType:"90mm"},"Spore MInes":{baseType:"25mm"},Sporocyst:{baseType:"hull",hullDimensions:{width:0,height:0}},Termagants:{baseType:"28.5mm"},Tervigon:{baseType:"120x92mm"},"The Swarmlord":{baseType:"60mm"},Toxicrene:{baseType:"120x92mm"},Trygon:{baseType:"120x92mm"},"Tyranid Warriors with Melee Bio-weapons":{baseType:"50mm"},"Tyranid Warriors with Ranged Bio-weapons":{baseType:"50mm"},Tyrannocyte:{baseType:"100mm"},Tyrannofex:{baseType:"120x92mm"},"Tyrant Guard":{baseType:"50mm"},Venomthropes:{baseType:"40mm"},"Von Ryan’s Leapers":{baseType:"40mm"},"Winged Hive Tyrant":{baseType:"60mm"},"Winged Tyranid Prime":{baseType:"50mm"},Zoanthropes:{baseType:"40mm"},Harridan:{baseType:"hull",hullDimensions:{width:4,height:6}},Hierophant:{baseType:"hull",hullDimensions:{width:0,height:0}}},Di={"ADEPTA SORORITAS":{"Aestred Thurga and Agathae Dolan: Aestred Thurga":{baseType:"32mm"},"Aestred Thurga and Agathae Dolan: Agathae Dolan":{baseType:"25mm"},"Arco-flagellants":{baseType:"25mm"},"Battle Sisters Squad":{baseType:"32mm"},Canoness:{baseType:"32mm"},"Canoness with Jump Pack":{baseType:"32mm"},Castigator:{baseType:"hull",hullDimensions:{width:6,height:8}},"Celestian Sacresants":{baseType:"32mm"},Daemonifuge:{baseType:"32mm"},Dialogus:{baseType:"40mm"},Dogmata:{baseType:"32mm"},"Dominion Squad":{baseType:"32mm"},Exorcist:{baseType:"hull",hullDimensions:{width:3.5,height:6}},Hospitaller:{baseType:"50mm"},Imagifier:{baseType:"32mm"},Immolator:{baseType:"hull",hullDimensions:{width:4,height:6}},"Junith Eruita":{baseType:"50mm"},"Ministorum Priest":{baseType:"32mm"},Mortifiers:{baseType:"50mm"},"Morvenn Vahl":{baseType:"60mm"},Palatine:{baseType:"32mm"},"Paragon Warsuits":{baseType:"50mm"},"Penitent Engines":{baseType:"50mm"},"Repentia Squad: Repentia Superior":{baseType:"32mm"},"Repentia Squad: Sister Repentia":{baseType:"28.5mm"},"Retributor Squad":{baseType:"32mm"},"Saint Celestine":{baseType:"40mm"},"Saint Celestine: Geminae Superia":{baseType:"32mm"},Sanctifiers:{baseType:"25mm"},"Seraphim Squad":{baseType:"32mm"},"Sisters Novitiate Squad: Novitiate Superior":{baseType:"32mm"},"Sisters Novitiate Squad: Sister Novitiate":{baseType:"28.5mm"},"Sororitas Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Triumph of Saint Katherine":{baseType:"120x92mm"},"Zephyrim Squad":{baseType:"32mm"}},"ADEPTUS CUSTODES":{Aleya:{baseType:"32mm"},"Allarus Custodians":{baseType:"40mm"},"Anathema Psykana Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blade Champion":{baseType:"40mm"},"Custodian Guard":{baseType:"40mm"},"Custodian Wardens":{baseType:"40mm"},"Knight-Centura":{baseType:"32mm"},Prosecutors:{baseType:"32mm"},"Shield-Captain":{baseType:"40mm"},"Shield-Captain in Allarus Terminator Armour":{baseType:"40mm"},"Shield-Captain on Dawneagle Jetbike":{baseType:"75x42mm"},"Trajann Valoris":{baseType:"40mm"},Valerian:{baseType:"40mm"},"Venerable Contemptor Dreadnought":{baseType:"60mm"},"Venerable Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vertus Praetors":{baseType:"75x42mm"},Vigilators:{baseType:"32mm"},Witchseekers:{baseType:"32mm"},"Agamatus Custodians":{baseType:"75x42mm"},"Aquilon Custodians":{baseType:"50mm"},"Ares Gunship":{baseType:"160mm"},"Caladius Grav-tank":{baseType:"170x109mm"},"Contemptor-Achillus Dreadnought":{baseType:"60mm"},"Contemptor-Galatus Dreadnought":{baseType:"60mm"},"Coronus Grav-carrier":{baseType:"170x109mm"},"Custodian Guard with Adrasite and Pyrithite Spears":{baseType:"40mm"},"Orion Assault Dropship":{baseType:"160mm"},"Pallas Grav-attack":{baseType:"105x70mm"},"Sagittarum Custodians":{baseType:"40mm"},"Telemon Heavy Dreadnought":{baseType:"100mm"},"Venatari Custodians":{baseType:"40mm"}},"ADEPTUS MECHANICUS":{"Archaeopter Fusilave":{baseType:"170x109mm"},"Archaeopter Stratoraptor":{baseType:"170x109mm"},"Archaeopter Transvector":{baseType:"170x109mm"},"Belisarius Cawl":{baseType:"105x70mm"},"Corpuscarii Electro-Priests":{baseType:"32mm"},"Cybernetica Datasmith":{baseType:"32mm"},"Fulgurite Electro-Priests":{baseType:"32mm"},"Ironstrider Ballistarii":{baseType:"105x70mm"},"Kastelan Robots":{baseType:"60mm"},"Kataphron Breachers":{baseType:"60mm"},"Kataphron Destroyers":{baseType:"60mm"},"Onager Dunecrawler":{baseType:"130mm"},"Pteraxii Skystalkers":{baseType:"40mm"},"Pteraxii Sterylizors":{baseType:"40mm"},"Serberys Raiders":{baseType:"60x35.5mm"},"Serberys Sulphurhounds":{baseType:"60x35.5mm"},"Sicarian Infiltrators":{baseType:"40mm"},"Sicarian Ruststalkers":{baseType:"40mm"},"Skitarii Marshal":{baseType:"32mm"},"Skitarii Rangers":{baseType:"25mm"},"Skitarii Rangers/Skitarii Vanguard: Transuranic Arquebus":{baseType:"60x35.5mm"},"Skitarii Vanguard":{baseType:"25mm"},"Skorpius Disintegrator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skorpius Dunerider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sydonian Dragoons with Radium Jezzails":{baseType:"105x70mm"},"Sydonian Dragoons with Taser Lances":{baseType:"105x70mm"},"Sydonian Skatros":{baseType:"40mm"},"Tech-Priest Dominus":{baseType:"50mm"},"Tech-Priest Enginseer":{baseType:"32mm"},"Tech-Priest Manipulus":{baseType:"50mm"},Technoarcheologist:{baseType:"32mm"}},"ADEPTUS TITANICUS":{"Reaver Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warbringer Nemesis Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warhound Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warlord Titan":{baseType:"hull",hullDimensions:{width:0,height:0}}},AELDARI:sm,"ASTRA MILITARUM":{"Aegis Defence Line":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armoured Sentinels":{baseType:"80mm"},"Artillery Team":{baseType:"130mm"},"Attilan Rough Riders":{baseType:"60x35.5mm"},Baneblade:{baseType:"hull",hullDimensions:{width:0,height:0}},Banehammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Banesword:{baseType:"hull",hullDimensions:{width:0,height:0}},Basilisk:{baseType:"hull",hullDimensions:{width:0,height:0}},"Bullgryn squad":{baseType:"40mm"},"Cadian Castellan":{baseType:"28.5mm"},"Cadian Command Squad":{baseType:"28.5mm"},"Cadian Heavy Weapons Squad":{baseType:"50mm"},"Cadian Shock Troops":{baseType:"25mm"},"Catachan Command Squad":{baseType:"25mm"},"Catachan Heavy Weapons Squad":{baseType:"60mm"},"Catachan Jungle Fighters":{baseType:"25mm"},Chimera:{baseType:"hull",hullDimensions:{width:0,height:0}},Commissar:{baseType:"28.5mm"},"Death Korps of Krieg":{baseType:"25mm"},"Death Riders":{baseType:"60x35.5mm"},Deathstrike:{baseType:"hull",hullDimensions:{width:0,height:0}},Doomhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},"Field Ordnance Battery":{baseType:"100mm"},"Gaunt’s Ghosts":{baseType:"28.5mm"},Hellhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Hellhound:{baseType:"hull",hullDimensions:{width:0,height:0}},Hydra:{baseType:"hull",hullDimensions:{width:0,height:0}},Kasrkin:{baseType:"28.5mm"},"Krieg Combat Engineers":{baseType:"25mm"},"Krieg Command Squad":{baseType:"25mm"},"Krieg Command Squad: Lord Commissar":{baseType:"32mm"},"Krieg Heavy Weapons Squad":{baseType:"50mm"},"Krieg Heavy Weapons Squad: Fire Coordinator":{baseType:"25mm"},"Leman Russ Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Demolisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Eradicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Executioner":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Exterminator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Punisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Vanquisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Marshal Dreir":{baseType:"75x42mm"},"Lord Solar Leontus":{baseType:"80mm"},Manticore:{baseType:"hull",hullDimensions:{width:0,height:0}},"Militarum Tempestus Command Squad":{baseType:"25mm"},"Ministorum Priest":{baseType:"32mm"},"Nork Deddog":{baseType:"40mm"},"Ogryn Bodyguard":{baseType:"40mm"},"Ogryn squad":{baseType:"40mm"},"Primaris Psyker":{baseType:"32mm"},Ratlings:{baseType:"25mm"},"Rogal Dorn Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Rogal Dorn Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Scout Sentinels":{baseType:"80mm"},Shadowsword:{baseType:"hull",hullDimensions:{width:0,height:0}},"Sly Marbo":{baseType:"32mm"},Stormlord:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormsword:{baseType:"hull",hullDimensions:{width:0,height:0}},Taurox:{baseType:"hull",hullDimensions:{width:0,height:0}},"Taurox Prime":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tech-Priest Enginseer":{baseType:"32mm"},"Tempestus Aquilons":{baseType:"28.5mm"},"Tempestus Scions":{baseType:"25mm"},"Ursula Creed":{baseType:"32mm"},Valkyrie:{baseType:"120x92mm"},Wyvern:{baseType:"hull",hullDimensions:{width:0,height:0}},"Avenger Strike Fighter":{baseType:"120x92mm"},"Cyclops Demolition Vehicle":{baseType:"hull",hullDimensions:{width:0,height:0}}},"BLACK TEMPLARS":{"Black Templars Gladiator Lancer":{baseType:"100mm"},"Black Templars Gladiator Reaper":{baseType:"100mm"},"Black Templars Gladiator Valiant":{baseType:"100mm"},"Black Templars Impulsor":{baseType:"100mm"},"Black Templars Repulsor":{baseType:"100mm"},"Black Templars Repulsor Executioner":{baseType:"100mm"},Castellan:{baseType:"40mm"},"Chaplain Grimaldus":{baseType:"40mm"},"Chaplain Grimaldus: Cenobyte Servitors":{baseType:"28.5mm"},"Crusader Squad: Neophytes":{baseType:"28.5mm"},"Crusader Squad: Sword Brother/Initiates":{baseType:"32mm"},"High Marshal Helbrecht":{baseType:"60mm"},Marshal:{baseType:"40mm"},"Primaris Crusader Squad: Initiates":{baseType:"32mm"},"Primaris Crusader Squad: Neophytes":{baseType:"28.5mm"},"Primaris Crusader Squad: Sword Brother":{baseType:"40mm"},"Primaris Sword Brethren":{baseType:"40mm"},"The Emperor’s Champion":{baseType:"40mm"}},"BLOOD ANGELS":{Astorath:{baseType:"40mm"},"Baal Predator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blood Angels Captain":{baseType:"40mm"},"Chief Librarian Mephiston":{baseType:"40mm"},"Commander Dante":{baseType:"50mm"},"Death Company Captain":{baseType:"40mm"},"Death Company Captain with Jump Pack":{baseType:"40mm"},"Death Company Dreadnought":{baseType:"90mm"},"Death Company Marines":{baseType:"32mm"},"Death Company Marines with Bolt Rifles":{baseType:"32mm"},"Death Company Marines with Jump Packs":{baseType:"32mm"},Lemartes:{baseType:"40mm"},"Sanguinary Guard":{baseType:"40mm"},"Sanguinary Priest":{baseType:"40mm"},"The Sanguinor":{baseType:"40mm"}},"CHAOS DAEMONS":{"Be’lakor":{baseType:"100mm"},"Beasts of Nurgle":{baseType:"60mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodmaster:{baseType:"40mm"},Bloodthirster:{baseType:"120x92mm"},"Blue Horrors":{baseType:"25mm"},"Burning Chariot":{baseType:"120x92mm"},Changecaster:{baseType:"32mm"},"Contorted Epitome":{baseType:"75x42mm"},"Daemon Prince of Chaos":{baseType:"60mm"},"Daemon Prince of Chaos with Wings":{baseType:"60mm"},Daemonettes:{baseType:"25mm"},Epidemius:{baseType:"60mm"},"Exalted Flamer":{baseType:"75x42mm"},Fateskimmer:{baseType:"120x92mm"},"Feculent Gnarlmaw":{baseType:"hull",hullDimensions:{width:0,height:0}},Fiends:{baseType:"75x42mm"},Flamers:{baseType:"32mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Fluxmaster:{baseType:"Large Flying Base"},"Great Unclean One":{baseType:"130mm"},Hellflayers:{baseType:"120x92mm"},"Horticulous Slimux":{baseType:"105x70mm"},"Infernal Enrapturess":{baseType:"60x35.5mm"},"Kairos Fateweaver":{baseType:"100mm"},Karanak:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},Nurglings:{baseType:"40mm"},"Pink Horrors":{baseType:"32mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Poxbringer:{baseType:"32mm"},"Rendmaster on Blood Throne":{baseType:"120x92mm"},Rotigus:{baseType:"130mm"},Screamers:{baseType:"Small Flying Base"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"},Skarbrand:{baseType:"100mm"},"Skull Altar":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skull Cannon":{baseType:"120x92mm"},Skullmaster:{baseType:"90x52.5mm"},Skulltaker:{baseType:"40mm"},"Sloppity Bilepiper":{baseType:"32mm"},"Soul Grinder":{baseType:"160mm"},"Spoilpox Scrivener":{baseType:"40mm"},"Syll’esske":{baseType:"50mm"},"The Blue Scribes":{baseType:"Large Flying Base"},"The Changeling":{baseType:"40mm"},"The Masque of Slaanesh":{baseType:"32mm"},Tormentbringer:{baseType:"120x92mm"},Tranceweaver:{baseType:"32mm"}},"CHAOS KNIGHTS":{"Knight Abominant":{baseType:"170x109mm"},"Knight Desecrator":{baseType:"170x109mm"},"Knight Despoiler":{baseType:"170x109mm"},"Knight Rampager":{baseType:"170x109mm"},"Knight Tyrant":{baseType:"170x109mm"},"War Dog Brigand":{baseType:"100mm"},"War Dog Executioner":{baseType:"100mm"},"War Dog Huntsman":{baseType:"100mm"},"War Dog Karnivore":{baseType:"100mm"},"War Dog Stalker":{baseType:"100mm"},"Chaos Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Cerastus Knight Acheron":{baseType:"170x109mm"},"Chaos Cerastus Knight Atrapos":{baseType:"170x109mm"},"Chaos Cerastus Knight Castigator":{baseType:"170x109mm"},"Chaos Cerastus Knight Lancer":{baseType:"170x109mm"},"Chaos Questoris Knight Magaera":{baseType:"170x109mm"},"Chaos Questoris Knight Styrix":{baseType:"170x109mm"},"War Dog Moirax":{baseType:"100mm"}},"CHAOS SPACE MARINES":{"Abaddon the Despoiler":{baseType:"60mm"},"Accursed Cultists: Mutant":{baseType:"25mm"},"Accursed Cultists: Torment":{baseType:"40mm"},"Chaos Bikers":{baseType:"75x42mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Lord":{baseType:"40mm"},"Chaos Lord in Terminator Armour":{baseType:"40mm"},"Chaos Lord with Jump Pack":{baseType:"40mm"},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminator Squad":{baseType:"40mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},Chosen:{baseType:"32mm"},"Cultist Firebrand":{baseType:"32mm"},"Cultist Mob":{baseType:"25mm"},Cypher:{baseType:"32mm"},"Dark Apostle":{baseType:"40mm"},"Dark Apostle: Dark Disciple":{baseType:"25mm"},"Dark Commune: Blessed Blade":{baseType:"28.5mm"},"Dark Commune: Cult Demagogue, Mindwitch, Iconarch":{baseType:"32mm"},Defiler:{baseType:"160mm"},"Fabius Bile":{baseType:"40mm"},"Fabius Bile: Surgeon Acolyte":{baseType:"32mm"},"Fellgor beastmen":{baseType:"32mm"},Forgefiend:{baseType:"120x92mm"},"Haarken Worldclaimer":{baseType:"40mm"},Havocs:{baseType:"40mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Heretic Astartes Daemon Prince":{baseType:"60mm"},"Heretic Astartes Daemon Prince with Wings":{baseType:"60mm"},"Huron Blackheart":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},Legionaries:{baseType:"32mm"},"Lord Discordant on Helstalker":{baseType:"120x92mm"},"Master of Executions":{baseType:"40mm"},"Master of Possession":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},"Nemesis Claw":{baseType:"32mm"},"Noctilith Crown":{baseType:"hull",hullDimensions:{width:0,height:0}},Obliterators:{baseType:"50mm"},Possessed:{baseType:"40mm"},Raptors:{baseType:"32mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Traitor Enforcer":{baseType:"32mm"},"Traitor Enforcer: Traitor Ogryn":{baseType:"40mm"},"Traitor Guardsmen Squad":{baseType:"25mm"},"Vashtorr the Arkifane":{baseType:"80mm"},Venomcrawler:{baseType:"100mm"},"Warp Talons":{baseType:"32mm"},Warpsmith:{baseType:"60x35.5mm"}},"DARK ANGELS":{Asmodai:{baseType:"50mm"},Azrael:{baseType:"50mm"},Belial:{baseType:"50mm"},"Deathwing Knights":{baseType:"40mm"},"Deathwing Terminator Squad":{baseType:"40mm"},Ezekiel:{baseType:"25mm"},"Inner Circle Companions":{baseType:"40mm"},"Land Speeder Vengeance":{baseType:"Large Flying Base"},Lazarus:{baseType:"40mm"},"Lion El’Jonson":{baseType:"60mm"},"Nephilim Jetfighter":{baseType:"120x92mm"},"Ravenwing Black Knights":{baseType:"75x42mm"},"Ravenwing Command Squad":{baseType:"75x42mm"},"Ravenwing Dark Talon":{baseType:"120x92mm"},"Ravenwing Darkshroud":{baseType:"Large Flying Base"},Sammael:{baseType:"Large Flying Base"}},"DEATH GUARD":{"Biologus Putrifier":{baseType:"40mm"},"Blightlord Terminators":{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Nurgle":{baseType:"60mm"},"Daemon Prince of Nurgle with Wings":{baseType:"60mm"},"Deathshroud Terminators":{baseType:"40mm"},Defiler:{baseType:"160mm"},"Foetid Bloat-Drone":{baseType:"60mm"},"Foetid Bloat-drone with Heavy Blight Launcher":{baseType:"60mm"},"Foul Blightspawn":{baseType:"40mm"},Helbrute:{baseType:"60mm"},"Icon Bearer":{baseType:"32mm"},"Lord of Contagion":{baseType:"50mm"},"Lord of Poxes":{baseType:"40mm"},"Lord of Virulence":{baseType:"50mm"},"Malignant Plaguecaster":{baseType:"32mm"},"Miasmic Malignifier":{baseType:"hull",hullDimensions:{width:0,height:0}},Mortarion:{baseType:"100mm"},"Myphitic Blight-Haulers":{baseType:"80mm"},"Noxious Blightbringer":{baseType:"40mm"},"Plague Marines":{baseType:"32mm"},"Plague Surgeon":{baseType:"40mm"},"Plagueburst Crawler":{baseType:"hull",hullDimensions:{width:0,height:0}},Poxwalkers:{baseType:"25mm"},Tallyman:{baseType:"40mm"},Typhus:{baseType:"50mm"},"Beasts of Nurgle":{baseType:"60mm"},"Great Unclean One":{baseType:"130mm"},Nurglings:{baseType:"40mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Rotigus:{baseType:"130mm"}},DEATHWATCH:im,DRUKHARI:om,"EMPEROR’S CHILDREN":{"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminators":{baseType:"40mm"},"Daemon Prince of Slaanesh":{baseType:"60mm"},"Daemon Prince of Slaanesh with Wings":{baseType:"60mm"},"Flawless Blades":{baseType:"40mm"},Fulgrim:{baseType:"130mm"},Heldrake:{baseType:"120x92mm"},Infractors:{baseType:"32mm"},"Lord Exultant":{baseType:"40mm"},"Lord Kakophonist":{baseType:"40mm"},"Lucius the Eternal":{baseType:"50mm"},Maulerfiend:{baseType:"120x92mm"},"Noise Marines":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},Tormentors:{baseType:"32mm"},Daemonettes:{baseType:"25mm"},Fiends:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"}},"GENESTEALER CULTS":{Aberrants:{baseType:"32mm"},Abominant:{baseType:"40mm"},"Achilles Ridgerunners":{baseType:"120x92mm"},"Acolyte Hybrids with Autopistols":{baseType:"32mm"},"Acolyte Hybrids with Hand Flamers":{baseType:"32mm"},"Acolyte Iconward":{baseType:"32mm"},"Atalan Jackals":{baseType:"60x35.5mm"},"Atalan Jackals: Wolfquad":{baseType:"60mm"},Benefictus:{baseType:"32mm"},Biophagus:{baseType:"25mm"},Clamavus:{baseType:"32mm"},"Goliath Rockgrinder":{baseType:"hull",hullDimensions:{width:0,height:0}},"Goliath Truck":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hybrid Metamorphs":{baseType:"32mm"},"Jackal Alphus":{baseType:"60x35.5mm"},Kelermorph:{baseType:"32mm"},Locus:{baseType:"32mm"},Magus:{baseType:"32mm"},"Neophyte Hybrids":{baseType:"25mm"},"Neophyte Hybrids: Heavy stubber, Mining laser, Seismic cannon":{baseType:"32mm"},Nexos:{baseType:"40mm"},Patriarch:{baseType:"50mm"},Primus:{baseType:"32mm"},"Purestrain Genestealers":{baseType:"32mm"},"Reductus Saboteur":{baseType:"32mm"},Sanctus:{baseType:"32mm"}},"GREY KNIGHTS":{"Brother-Captain":{baseType:"40mm"},"Brother-Captain Stern":{baseType:"40mm"},"Brotherhood Champion":{baseType:"32mm"},"Brotherhood Chaplain":{baseType:"40mm"},"Brotherhood Librarian":{baseType:"40mm"},"Brotherhood Techmarine":{baseType:"32mm"},"Brotherhood Terminator Squad":{baseType:"40mm"},"Castellan Crowe":{baseType:"40mm"},"Grand Master":{baseType:"40mm"},"Grand Master in Nemesis Dreadknight":{baseType:"120x92mm"},"Grand Master Voldus":{baseType:"40mm"},"Grey Knights Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Razorback":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Stormhawk Interceptor":{baseType:"120x92mm"},"Grey knights Stormraven Gunship":{baseType:"120x92mm"},"Grey knights Stormtalon Gunship":{baseType:"120x92mm"},"Grey Knights Venerable Dreadnought":{baseType:"60mm"},"Interceptor Squad":{baseType:"32mm"},"Kaldor Draigo":{baseType:"40mm"},"Nemesis Dreadknight":{baseType:"120x92mm"},"Paladin Squad":{baseType:"40mm"},"Purgation Squad":{baseType:"32mm"},"Purifier Squad":{baseType:"32mm"},Servitors:{baseType:"25mm"},"Strike Squad":{baseType:"32mm"},"Grey Knights Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}},"Land Raider Banisher":{baseType:"hull",hullDimensions:{width:0,height:0}}},"IMPERIAL AGENTS":{"Callidus Assassin":{baseType:"32mm"},"Corvus Blackstar":{baseType:"120x92mm"},"Culexus Assassin":{baseType:"32mm"},"Deathwatch Kill Team":{baseType:"32mm"},"Eversor Assassin":{baseType:"32mm"},"Exaction Squad":{baseType:"28.5mm"},"Exaction Squad: Cyber-mastiff":{baseType:"25mm"},"Grey Knights Terminator Squad":{baseType:"40mm"},"Imperial Navy Breachers":{baseType:"25mm"},"Imperial Navy Breachers: Navis las-volley, endurant shield":{baseType:"28.5mm"},"Imperial Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},Inquisitor:{baseType:"32mm"},"Inquisitor Coteaz":{baseType:"40mm"},"Inquisitor Draxus":{baseType:"32mm"},"Inquisitor Greyfax":{baseType:"32mm"},"Inquisitorial Agents":{baseType:"25mm"},"Inquisitorial Agents: Gun Servitors":{baseType:"32mm"},"Inquisitorial Chimera":{baseType:"hull",hullDimensions:{width:0,height:0}},"Ministorum Priest":{baseType:"32mm"},Navigator:{baseType:"32mm"},"Rogue Trader entourage":{baseType:"25mm"},Sanctifiers:{baseType:"25mm"},"Sisters of Battle Immolator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sisters of Battle Squad":{baseType:"32mm"},"Subductor Squad":{baseType:"28.5mm"},"Subductor Squad: Cyber-mastiff":{baseType:"25mm"},"Vigilant Squad":{baseType:"28.5mm"},"Vigilant Squad: Cyber-mastiff":{baseType:"25mm"},"Vindicare Assassin":{baseType:"32mm"},"Voidsmen-at-Arms":{baseType:"32mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},"IMPERIAL KNIGHTS":{"Armiger Helverin":{baseType:"100mm"},"Armiger Warglaive":{baseType:"100mm"},"Canis Rex":{baseType:"170x109mm"},"Knight Castellan":{baseType:"170x109mm"},"Knight Crusader":{baseType:"170x109mm"},"Knight Errant":{baseType:"170x109mm"},"Knight Gallant":{baseType:"170x109mm"},"Knight Paladin":{baseType:"170x109mm"},"Knight Preceptor":{baseType:"170x109mm"},"Knight Valiant":{baseType:"170x109mm"},"Knight Warden":{baseType:"170x109mm"},"Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armiger Moirax":{baseType:"100mm"},"Cerastus Knight Acheron":{baseType:"170x109mm"},"Cerastus Knight Atrapos":{baseType:"170x109mm"},"Cerastus Knight Castigator":{baseType:"170x109mm"},"Cerastus Knight Lancer":{baseType:"170x109mm"},"Questoris Knight Magaera":{baseType:"170x109mm"},"Questoris Knight Styrix":{baseType:"170x109mm"}},"LEAGUES OF VOTANN":{"Brôkhyr Iron-master":{baseType:"32mm"},"Brôkhyr Iron-master: E-COG":{baseType:"25mm"},"Brôkhyr Iron-master: Ironkin Assistant":{baseType:"28.5mm"},"Brôkhyr Thunderkyn":{baseType:"40mm"},"Cthonian Beserks":{baseType:"28.5mm"},"Cthonian Beserks: Mole grenade launcher":{baseType:"50mm"},"Einhyr Champion":{baseType:"40mm"},"Einhyr Hearthguard":{baseType:"32mm"},Grimnyr:{baseType:"40mm"},"Grimnyr: CORV":{baseType:"25mm"},"Hearthkyn Warriors":{baseType:"28.5mm"},"Hekaton Land Fortress":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hernkyn Pioneers":{baseType:"90x52.5mm"},"Hernkyn Yaegirs":{baseType:"28.5mm"},Kâhl:{baseType:"40mm"},Sagitaur:{baseType:"hull",hullDimensions:{width:0,height:0}},"Ûthar the Destined":{baseType:"40mm"}},NECRONS:lm,ORKS:cm,"SPACE MARINES":{"Adrax Agatone":{baseType:"40mm"},"Aggressor Squad":{baseType:"40mm"},Ancient:{baseType:"40mm"},"Ancient in Terminator Armour":{baseType:"40mm"},Apothecary:{baseType:"40mm"},"Apothecary Biologis":{baseType:"40mm"},"Assault Intercessor Squad":{baseType:"32mm"},"Assault Intercessors with Jump Packs":{baseType:"32mm"},"Ballistus Dreadnought":{baseType:"90mm"},"Bladeguard Ancient":{baseType:"40mm"},"Bladeguard Veteran Squad":{baseType:"40mm"},"Brutalis Dreadnought":{baseType:"90mm"},Captain:{baseType:"40mm"},"Captain in Gravis Armour":{baseType:"40mm"},"Captain in Phobos Armour":{baseType:"40mm"},"Captain in Terminator Armour":{baseType:"50mm"},"Captain Sicarius":{baseType:"32mm"},"Captain with Jump Pack":{baseType:"40mm"},"Centurion Assault Squad":{baseType:"50mm"},"Centurion Devastator Squad":{baseType:"50mm"},Chaplain:{baseType:"40mm"},"Chaplain in Terminator Armour":{baseType:"40mm"},"Chaplain on Bike":{baseType:"90x52.5mm"},"Chaplain with Jump Pack":{baseType:"32mm"},"Chief Librarian Tigurius":{baseType:"40mm"},"Company Heroes":{baseType:"40mm"},"Darnath Lysander":{baseType:"50mm"},"Desolation Squad":{baseType:"32mm"},"Devastator Squad":{baseType:"32mm"},Dreadnought:{baseType:"60mm"},"Drop Pod":{baseType:"hull",hullDimensions:{width:0,height:0}},"Eliminator Squad":{baseType:"40mm"},"Eradicator Squad":{baseType:"40mm"},"Firestrike Servo-turrets":{baseType:"80mm"},"Gladiator Lancer":{baseType:"100mm"},"Gladiator Reaper":{baseType:"100mm"},"Gladiator Valiant":{baseType:"100mm"},"Hammerfall Bunker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Heavy Intercessor Squad":{baseType:"40mm"},"Hellblaster Squad":{baseType:"32mm"},Impulsor:{baseType:"100mm"},"Inceptor Squad":{baseType:"40mm"},"Incursor Squad":{baseType:"32mm"},"Infernus Squad":{baseType:"32mm"},"Infiltrator Squad":{baseType:"32mm"},"Intercessor Squad":{baseType:"32mm"},"Invader ATV":{baseType:"hull",hullDimensions:{width:0,height:0}},"Invictor Tactical Warsuit":{baseType:"90mm"},"Iron Father Feirros":{baseType:"40mm"},Judiciar:{baseType:"40mm"},"Kayvaan Shrike":{baseType:"40mm"},"Kor’sarro Khan":{baseType:"40mm"},"Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},Librarian:{baseType:"40mm"},"Librarian in Phobos Armour":{baseType:"40mm"},"Librarian in Terminator Armour":{baseType:"40mm"},Lieutenant:{baseType:"40mm"},"Lieutenant in Phobos Armour":{baseType:"40mm"},"Lieutenant in Reiver Armour":{baseType:"40mm"},"Lieutenant Titus":{baseType:"40mm"},"Lieutenant with Combi-weapon":{baseType:"40mm"},"Marneus Calgar":{baseType:"50mm"},"Marneus Calgar: Victrix Honour Guard":{baseType:"40mm"},"Outrider Squad":{baseType:"90x52.5mm"},"Pedro Kantor":{baseType:"32mm"},"Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},Razorback:{baseType:"hull",hullDimensions:{width:0,height:0}},"Redemptor Dreadnought":{baseType:"90mm"},"Reiver Squad":{baseType:"32mm"},Repulsor:{baseType:"100mm"},"Repulsor Executioner":{baseType:"100mm"},Rhino:{baseType:"hull",hullDimensions:{width:0,height:0}},"Roboute Guilliman":{baseType:"60mm"},"Scout Squad":{baseType:"28.5mm"},"Sternguard Veteran Squad":{baseType:"32mm"},"Storm Speeder Hailstrike":{baseType:"90mm"},"Storm Speeder Hammerstrike":{baseType:"90mm"},"Storm Speeder Thunderstrike":{baseType:"90mm"},"Stormhawk Interceptor":{baseType:"120x92mm"},"Stormraven Gunship":{baseType:"120x92mm"},"Stormtalon Gunship":{baseType:"120x92mm"},"Suppressor Squad":{baseType:"40mm"},"Tactical Squad":{baseType:"32mm"},Techmarine:{baseType:"40mm"},"Terminator Assault Squad":{baseType:"40mm"},"Terminator Squad":{baseType:"40mm"},"Tor Garadon":{baseType:"40mm"},"Uriel Ventris":{baseType:"40mm"},"Vanguard Veteran Squad with Jump Packs":{baseType:"32mm"},Vindicator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Vulkan He’stan":{baseType:"32mm"},Whirlwind:{baseType:"hull",hullDimensions:{width:0,height:0}},Astraeus:{baseType:"hull",hullDimensions:{width:0,height:0}},"Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}}},"SPACE WOLVES":{"Arjac Rockfist":{baseType:"50mm"},"Bjorn the Fell-handed":{baseType:"60mm"},"Blood Claws":{baseType:"32mm"},"Fenrisian Wolves":{baseType:"40mm"},"Grey Hunters":{baseType:"32mm"},"Iron Priest":{baseType:"32mm"},"Logan Grimnar":{baseType:"80mm"},Murderfang:{baseType:"60mm"},"Njal Stormcaller":{baseType:"40mm"},"Ragnar Blackmane":{baseType:"40mm"},"Thunderwolf Cavalry":{baseType:"60mm"},"Ulrik the Slayer":{baseType:"32mm"},"Venerable Dreadnought":{baseType:"60mm"},"Wolf Guard Battle Leader":{baseType:"40mm"},"Wolf Guard Headtakers":{baseType:"40mm"},"Wolf Guard Headtakers: Hunting Wolves":{baseType:"60x35.5mm"},"Wolf Guard Terminators":{baseType:"40mm"},"Wolf Priest":{baseType:"40mm"},Wulfen:{baseType:"40mm"},"Wulfen Dreadnought":{baseType:"60mm"},"Wulfen with Storm Shields":{baseType:"40mm"}},"T’AU EMPIRE":{"Breacher Team":{baseType:"25mm"},"Broadside Battlesuits":{baseType:"60mm"},"Cadre Fireblade":{baseType:"25mm"},"Commander Farsight":{baseType:"60mm"},"Commander in Coldstar Battlesuit":{baseType:"60mm"},"Commander in Enforcer Battlesuit":{baseType:"60mm"},"Commander Shadowsun":{baseType:"50mm"},"Crisis Fireknife Battlesuits":{baseType:"50mm"},"Crisis Starscythe Battlesuits":{baseType:"50mm"},"Crisis Sunforge Battlesuits":{baseType:"50mm"},Darkstrider:{baseType:"32mm"},Devilfish:{baseType:"Large Flying Base"},Ethereal:{baseType:"40mm"},"Firesight Team":{baseType:"40mm"},"Ghostkeel Battlesuit":{baseType:"105x70mm"},"Hammerhead Gunship":{baseType:"Large Flying Base"},"Kroot Carnivores":{baseType:"28.5mm"},"Kroot Farstalkers":{baseType:"28.5mm"},"Kroot Farstalkers: Kroot Kill-broker":{baseType:"32mm"},"Kroot Flesh Shaper":{baseType:"32mm"},"Kroot Hounds":{baseType:"28.5mm"},"Kroot Lone-spear":{baseType:"90x52.5mm"},"Kroot Trail Shaper":{baseType:"32mm"},"Kroot War Shaper":{baseType:"32mm"},"Krootox Rampagers":{baseType:"50mm"},"Krootox Riders":{baseType:"50mm"},"Pathfinder Team":{baseType:"25mm"},Piranhas:{baseType:"Large Flying Base"},"Razorshark Strike Fighter":{baseType:"120x92mm"},"Riptide Battlesuit":{baseType:"120x92mm"},"Sky Ray Gunship":{baseType:"Large Flying Base"},"Stealth Battlesuits":{baseType:"32mm"},Stormsurge:{baseType:"170x109mm"},"Strike Team":{baseType:"25mm"},"Sun Shark Bomber":{baseType:"120x92mm"},"Tidewall Defence Platform":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Droneport":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Gunrig":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Shieldline":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vespid Stingwings":{baseType:"28.5mm"},"AX-1-0 Tiger Shark":{baseType:"160mm"},Manta:{baseType:"hull",hullDimensions:{width:4,height:6}},"Ta’unar Supremacy Armour":{baseType:"160mm"},"Tiger Shark":{baseType:"160mm"}},"THOUSAND SONS":{Ahriman:{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Daemon Prince of Tzeentch":{baseType:"60mm"},"Daemon Prince of Tzeentch with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},"Exalted Sorcerer":{baseType:"32mm"},"Exalted Sorcerer on Disc of Tzeentch":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Infernal Master":{baseType:"40mm"},"Magnus the Red":{baseType:"100mm"},Maulerfiend:{baseType:"120x92mm"},"Mutalith Vortex Beast":{baseType:"120x92mm"},"Rubric Marines":{baseType:"32mm"},"Scarab Occult Terminators":{baseType:"40mm"},"Sekhetar Robots":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Tzaangor Enlightened":{baseType:"40mm"},"Tzaangor Enlightened with Fatecaster Greatbows":{baseType:"40mm"},"Tzaangor Shaman":{baseType:"40mm"},Tzaangors:{baseType:"32mm"},"Blue Horrors":{baseType:"25mm"},Flamers:{baseType:"32mm"},"Kairos Fateweaver":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},"Pink Horrors":{baseType:"32mm"},Screamers:{baseType:"Small Flying Base"}},TYRANIDS:um,"WORLD EATERS":{Angron:{baseType:"100mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Khorne":{baseType:"60mm"},"Daemon Prince of Khorne with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},Eightbound:{baseType:"40mm"},"Exalted Eightbound":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Goremongers:{baseType:"32mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},Jakhals:{baseType:"28.5mm"},"Jakhals: Dishonoured":{baseType:"40mm"},"Khârn the Betrayer":{baseType:"40mm"},"Khorne Berzerkers":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Invocatus":{baseType:"90x52.5mm"},"Lord on Juggernaut":{baseType:"90x52.5mm"},"Master of Executions":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},Slaughterbound:{baseType:"50mm"},"Terminator Squad":{baseType:"40mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodthirster:{baseType:"120x92mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Skarbrand:{baseType:"100mm"}}};function dm(){return Object.keys(Di)}function wl(t){const n=Di[t];return n?Object.keys(n):[]}function ri(t,n){const a=Di[t];return a&&a[n]||null}function mm(t,n){const a=t.FACTION_KEYWORD,s=t.UNITS||[],r=[],i=[],l={};for(const d of s){const h=d.name||"",y=rm(d.quantity);let p=ri(a,h);if(!p){const m=Sl(h,a);m&&(p=ri(a,m))}if(!p){const{faction:m,unitName:f}=pm(h);m&&f&&(p=ri(m,f))}if(p){l[h]||(l[h]=0),l[h]++;const m=l[h]>1?` #${l[h]}`:"",f=`${h}${m}`,v=hm(p,y,n,f);r.push(...v)}else i.push({id:"unmatched-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),unitName:h,quantity:y,points:d.points,section:d.section})}return{matched:fm(r),unmatched:i}}function hm(t,n,a,s,r){const i=[],l=ym(),c=t.baseType,d=vm(s,c);for(let h=0;h<n;h++){const p={id:bm(),baseType:c,playerId:a,x:0,y:0,rotation:0,unitId:l,unitName:s,name:d,imported:!0,inStaging:!0};c==="hull"&&(p.baseType="rect-custom",p.customWidth=t.hullDimensions?.width||5.5,p.customHeight=t.hullDimensions?.height||3),i.push(p)}return i}function fm(t){const i={};t.forEach(h=>{const y=h.unitId||"ungrouped";i[y]||(i[y]=[]),i[y].push(h)});let l=2,c=2,d=0;for(const h in i){const y=i[h];for(const p of y)p.x=l,p.y=c,l+=2,d++,d>=6&&(l=2,c+=2,d=0);d>0&&(l=2,c+=2,d=0)}return t}function Sl(t,n){const a=wl(n);if(!a||a.length===0)return null;const s=hr(t);for(const c of a)if(hr(c)===s)return c;const r=s.replace(/s$/,""),i=s+"s";for(const c of a){const d=hr(c);if(d===r||d===i)return c}for(const c of a){const d=hr(c);if(s.includes(d)||d.includes(s))return c}const l=s.split(/\s+/).filter(c=>c.length>2);if(l.length>0)for(const c of a){const d=hr(c);if(l.every(h=>d.includes(h)))return c}return null}function pm(t){const n=dm(),a=hr(t);for(const s of n){const r=wl(s);if(r){for(const i of r)if(hr(i)===a)return{faction:s,unitName:i}}}for(const s of n){const r=Sl(t,s);if(r)return{faction:s,unitName:r}}return{faction:null,unitName:null}}function hr(t){return String(t||"").toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim()}function ym(){return"unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function vm(t,n){if(!t)return"";const a=n.match(/(\d+)mm/),s=a?parseInt(a[1],10):null;return s&&s<50?gm(t):t}function gm(t){return t?t.replace(/\s*#\d+$/,"").split(/\s+/).filter(r=>r.length>0).slice(0,3).map(r=>r[0].toUpperCase()).join(""):""}function bm(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}const Aa={battlefield:{fill:"#adbeadff"},terrain:{fill:"rgba(116, 102, 63, 0.71)",stroke:"#8b5a2b",strokeWidth:.15},wall:{fill:"rgba(52, 45, 39, 1)",stroke:"#000000ba",strokeWidth:.15},player1:{fill:"rgba(59, 130, 246, 0.6)",stroke:"#3b82f6",strokeWidth:.12},player2:{fill:"rgba(239, 68, 68, 0.6)",stroke:"#ef4444",strokeWidth:.12},modelName:{fill:"#ffffff",stroke:"#000000",strokeWidth:.05,fontWeight:"bold"},deploymentZone:{fillOpacity:.2,strokeWidth:.2,strokeDasharray:"0.5,0.25"},objective:{primary:{fill:"#9ca3af",stroke:"#000000",strokeWidth:.08},secondary:{fill:"#9ca3af",stroke:"#000000",strokeWidth:.08},controlRadius:{fillOpacity:.15,strokeWidth:.06,strokeDasharray:"0.3,0.15"},centerDot:{fill:"#000000",radius:.15}}},ys={pixelsPerInch:50,pngScale:2,fontSizeMultiplier:{circle:.8,oval:.6,rectangle:.35}};function Tm(t){const n=Aa.deploymentZone;return`<path
    d="${kr(t.path)}"
    fill="${t.borderColor}"
    fill-opacity="${n.fillOpacity}"
    stroke="${t.borderColor}"
    stroke-width="${n.strokeWidth}"
    stroke-dasharray="${n.strokeDasharray}"
  />`}function xm(t){const n=t.isPrimary?Aa.objective.primary:Aa.objective.secondary,a=Aa.objective.controlRadius,s=Aa.objective.centerDot,r=`<circle
    cx="${t.x}"
    cy="${t.y}"
    r="${Qs}"
    fill="${n.fill}"
    fill-opacity="${a.fillOpacity}"
    stroke="${n.fill}"
    stroke-width="${a.strokeWidth}"
    stroke-dasharray="${a.strokeDasharray}"
  />`,i=`<circle
    cx="${t.x}"
    cy="${t.y}"
    r="${Zs}"
    fill="${n.fill}"
    stroke="${n.stroke}"
    stroke-width="${n.strokeWidth}"
  />`,l=`<circle
    cx="${t.x}"
    cy="${t.y}"
    r="${s.radius}"
    fill="${s.fill}"
  />`;return r+i+l}function _m(t){const{x:n,y:a,width:s,height:r,rotation:i}=t,l=n+s/2,c=a+r/2,d=Aa.terrain;return`<rect
    x="${n}"
    y="${a}"
    width="${s}"
    height="${r}"
    transform="rotate(${i}, ${l}, ${c})"
    fill="${d.fill}"
    stroke="${d.stroke}"
    stroke-width="${d.strokeWidth}"
  />`}function wm(t){const n=Ca(t.shape,t.segments),a=ws(n,t.x,t.y,t.rotation);if(a.length===0)return"";const s=a.map((i,l)=>`${l===0?"M":"L"} ${i.x} ${i.y}`).join(" ")+" Z",r=Aa.wall;return`<path
    d="${s}"
    fill="${r.fill}"
    stroke="${r.stroke}"
    stroke-width="${r.strokeWidth}"
  />`}function Sm(t){const n=Sn(t.baseType,t),a=vn(t.baseType),s=zn(t.baseType),r=t.playerId===1?Aa.player1:Aa.player2,i=Aa.modelName;let l="",c=0;if(s){const h=t.customWidth||0,y=t.customHeight||0,p=t.x,m=t.y;c=Math.min(h,y)*ys.fontSizeMultiplier.rectangle,l=`<g transform="rotate(${t.rotation||0}, ${p}, ${m})">
      <rect
        x="${p-h/2}"
        y="${m-y/2}"
        width="${h}"
        height="${y}"
        fill="${r.fill}"
        stroke="${r.stroke}"
        stroke-width="${r.strokeWidth}"
      />
    </g>`}else if(a){const h=n.width/2,y=n.height/2;c=Math.min(h,y)*ys.fontSizeMultiplier.oval,l=`<g transform="rotate(${t.rotation||0}, ${t.x}, ${t.y})">
      <ellipse
        cx="${t.x}"
        cy="${t.y}"
        rx="${h}"
        ry="${y}"
        fill="${r.fill}"
        stroke="${r.stroke}"
        stroke-width="${r.strokeWidth}"
      />
    </g>`}else{const h=n?.radius||.5;c=h*ys.fontSizeMultiplier.circle,l=`<circle
      cx="${t.x}"
      cy="${t.y}"
      r="${h}"
      fill="${r.fill}"
      stroke="${r.stroke}"
      stroke-width="${r.strokeWidth}"
    />`}let d="";return t.name&&(d=`<text
      x="${t.x}"
      y="${t.y}"
      text-anchor="middle"
      dominant-baseline="middle"
      font-size="${c}"
      font-weight="${i.fontWeight}"
      fill="${i.fill}"
      stroke="${i.stroke}"
      stroke-width="${i.strokeWidth}"
      paint-order="stroke"
    >${km(t.name)}</text>`),l+d}function km(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Am(t,n,a,s=null){const r=st.width,i=st.height,l=Aa.battlefield.fill,c=ys.pixelsPerInch,d=t.map(_m).join(`
    `),h=n.map(wm).join(`
    `),y=a.map(Sm).join(`
    `),p=s?.zones?s.zones.map(Tm).join(`
    `):"",m=s?.objectives?s.objectives.map(xm).join(`
    `):"";return`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${r} ${i}" width="${r*c}" height="${i*c}">
  <!-- Battlefield background -->
  <rect x="0" y="0" width="${r}" height="${i}" fill="${l}" />

  <!-- Deployment zones -->
  <g id="deployment-zones">
    ${p}
  </g>

  <!-- Objectives -->
  <g id="objectives">
    ${m}
  </g>

  <!-- Terrain pieces -->
  <g id="terrains">
    ${d}
  </g>

  <!-- Wall pieces -->
  <g id="walls">
    ${h}
  </g>

  <!-- Model bases -->
  <g id="models">
    ${y}
  </g>
</svg>`}function Cm(t,n=1){return new Promise((a,s)=>{const r=new Image,i=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),l=URL.createObjectURL(i);r.onload=()=>{const c=document.createElement("canvas");c.width=r.width*n,c.height=r.height*n;const d=c.getContext("2d");d.scale(n,n),d.drawImage(r,0,0),URL.revokeObjectURL(l),c.toBlob(h=>{h?a(h):s(new Error("Failed to create PNG blob"))},"image/png")},r.onerror=()=>{URL.revokeObjectURL(l),s(new Error("Failed to load SVG image"))},r.src=l})}async function Ii(t,n,a=[],s="battlefield",r=null){try{const i=Am(t,n,a,r),l=await Cm(i,ys.pngScale),c=URL.createObjectURL(l),d=document.createElement("a");return d.href=c,d.download=`${s}.png`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(c),!0}catch(i){throw console.error("Failed to export PNG:",i),i}}var Em=pe('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),Mm=pe('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div> <!>',1),Rm=pe('<button class="svelte-1g40uyy">Group (Ctrl+G)</button>'),Dm=pe('<button class="svelte-1g40uyy">Ungroup (Ctrl+Shift+G)</button>'),Im=pe('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Selected</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <!> <!> <button class="danger svelte-1g40uyy"> </button></div>'),Lm=pe('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Rotation</span> <span class="value svelte-1g40uyy"> </span></div>'),$m=pe('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div>'),Pm=pe('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),Nm=pe('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Base Type</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Player</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Position</span> <span class="value svelte-1g40uyy"> </span></div> <!> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-1g40uyy">Remove</button></div>'),Om=pe('<p class="hint svelte-1g40uyy">Click a model to select it</p>'),Wm=pe('<p class="hint svelte-1g40uyy">Click and drag on battlefield to draw a measurement line</p>'),Ym=pe('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Length</span> <span class="value svelte-1g40uyy"> </span></div> <button class="danger svelte-1g40uyy">Remove Line</button>',1),Hm=pe('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Lines</span> <span class="value svelte-1g40uyy"> </span></div> <button class="secondary svelte-1g40uyy">Clear All Lines</button>',1),Fm=pe('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Line Tool Active (M)</label></div> <!> <!> <!> <div class="field svelte-1g40uyy" style="margin-top: 0.5rem; border-top: 1px solid #333; padding-top: 0.5rem;"><span class="label-text svelte-1g40uyy">Range Zones</span> <label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show 6" zones</label> <label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show 9" zones</label> <label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show 12" zones</label></div></div>'),Bm=pe('<div class="button-group vertical svelte-1g40uyy"><div class="button-row svelte-1g40uyy"><button title="Undo (Ctrl+Z)" class="svelte-1g40uyy">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-1g40uyy">Redo</button></div> <div class="button-row svelte-1g40uyy"><button title="Export deployment to share with others" class="svelte-1g40uyy">Export</button> <button title="Import deployment from JSON file" class="svelte-1g40uyy">Import</button></div> <input type="file" accept=".json" style="display: none;"/> <button title="Export battlefield as PNG image" class="svelte-1g40uyy">Export PNG</button> <button class="svelte-1g40uyy">Save to Browser</button> <button class="svelte-1g40uyy">Restore from Browser</button> <button class="secondary svelte-1g40uyy">Clear All Models</button></div>'),qm=pe('<div class="player-toggle svelte-1g40uyy"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-1g40uyy"><div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Circles</h4> <div class="palette-grid svelte-1g40uyy"></div></div> <div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Ovals</h4> <div class="palette-grid svelte-1g40uyy"></div></div></div>',1),Um=pe('<div class="rect-hull-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="rect-width" class="svelte-1g40uyy">Width (inches)</label> <input id="rect-width" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <div class="field svelte-1g40uyy"><label for="rect-height" class="svelte-1g40uyy">Height (inches)</label> <input id="rect-height" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <button class="svelte-1g40uyy"> </button></div>'),Km=he('<path stroke-width="0.10" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),Gm=he('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),zm=he("<!><!>",1),Xm=he('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),Vm=he('<g opacity="0.5" pointer-events="none"><!></g>'),jm=he('<g><rect rx="12" ry="12" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></rect></g>'),Jm=he('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></ellipse></g>'),Zm=he('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></circle>'),Qm=he('<g><rect rx="9" ry="9" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></rect></g>'),eh=he('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></ellipse></g>'),th=he('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></circle>'),nh=he('<g><rect rx="6" ry="6" fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></rect></g>'),ah=he('<g><ellipse fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></ellipse></g>'),rh=he('<circle fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></circle>'),sh=he("<!><!><!>",1),ih=he('<circle r="0.4" fill="rgba(147, 51, 234, 0.5)" stroke="#9333ea" stroke-width="0.1" pointer-events="none"></circle><line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="group-rotate-handle"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),oh=he('<circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle><circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle>',1),lh=he('<g><line stroke-linecap="round"></line><!><g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g></g>'),ch=he('<g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" fill="#f59e0b" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g>'),uh=he('<g class="measurement-line drawing"><line stroke="#f59e0b" stroke-width="0.15" stroke-dasharray="0.3,0.15" stroke-linecap="round" pointer-events="none"></line><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><!></g>'),dh=he('<line stroke-width="0.05" pointer-events="none"></line>'),mh=he('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),hh=he('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),fh=he('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),ph=he("<!><!><!><!><!><!><!><!><!><!><!><!><!><!><!>",1),yh=pe('<main class="svelte-1g40uyy"><div class="layout svelte-1g40uyy"><div class="sidebar svelte-1g40uyy"><!> <!> <!> <!> <!> <!></div> <div class="main-content svelte-1g40uyy"><div class="battlefield-area svelte-1g40uyy"><div class="battlefield-container svelte-1g40uyy" role="presentation"><!></div> <div class="info svelte-1g40uyy"><p class="svelte-1g40uyy"> </p> <p class="hint svelte-1g40uyy">Drag to select | Ctrl+Click multi-select | Del remove | 1/2 player | L LoS | M measure</p></div></div></div></div></main> <!>',1);function no(t,n){Vn(n,!1);const a=()=>Wt(rr,"$selectedDeployment",y),s=()=>Wt(ma,"$selectedLayoutName",y),r=()=>Wt(wa,"$selectedLayoutType",y),i=()=>Wt(ct,"$models",y),l=()=>Wt(Ri,"$loadedTerrain",y),c=()=>Wt(In,"$history",y),d=()=>Wt(gl,"$player1Models",y),h=()=>Wt(bl,"$player2Models",y),[y,p]=Cr(),m=W(),f=W(),v=W(),A=W(),T=W(),E=W(),P=W(),M=W(),k=W(),D=W(),$=W(),B=W(),F=W(),G=W();let q=W(1),ie=W(null),ee=!1,fe=null,se=W(null),ae=W(!1),De=W(!1),ve=W(5.5),be=W(3),te=W(!1),Ae=W([]),ue=[],le=W(null),Xe=W(!1),ge=W(null),Pe=W(null),de=W([]),bt=W(new Set),ut=!1,Yt=!1,_t=null,it=!1,Tt=null,je=0,Qt=null,Ht=W([]),zt=W(null),Ne=W(!1),Ke=W(null),ze=W(null),xt=W(!1),Z=W(!1),Ie=W(!1),qe=W(!1);const Ct=5,pt="warhammer-deployment-state";function ot(){const S={deployment:a()?.name||null,layout:s()||null,layoutType:r()||null,models:i()};localStorage.setItem(pt,JSON.stringify(S))}function $t(){const S=localStorage.getItem(pt);if(S)try{const O=JSON.parse(S);O.models&&Array.isArray(O.models)&&(ct.set(O.models),In.clear())}catch(O){console.error("Failed to restore deployment state:",O)}}function Ft(){const S={version:1,exportedAt:new Date().toISOString(),deployment:a()?{name:a().name,zones:a().zones,objectives:a().objectives}:null,terrain:{layoutName:s(),layoutType:r(),terrains:l().terrains,walls:l().walls},models:i()},O=JSON.stringify(S,null,2),H=new Blob([O],{type:"application/json"}),Y=URL.createObjectURL(H),_=document.createElement("a");_.href=Y,_.download=`deployment-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(Y)}async function Et(){const O=`deployment-${new Date().toISOString().slice(0,10)}`;try{await Ii(l().terrains,l().walls,i(),O,a())}catch(H){alert("Failed to export PNG"),console.error("Export error:",H)}}let wt=W(null);function It(){e(wt)?.click()}function hn(S){const O=S.target.files?.[0];if(!O)return;const H=new FileReader;H.onload=Y=>{try{const _=JSON.parse(Y.target.result);fn(_)}catch(_){console.error("Failed to parse import file:",_),alert("Failed to import: Invalid JSON file")}},H.readAsText(O),S.target.value=""}function fn(S){if(!S.version){alert("Invalid import file: missing version");return}if(S.deployment){const O=ll.find(H=>H.name===S.deployment.name);O?rr.set(O):S.deployment.zones&&S.deployment.objectives&&rr.set({name:S.deployment.name||"Imported",zones:S.deployment.zones,objectives:S.deployment.objectives})}else rr.set(null);if(S.terrain){const{layoutName:O,layoutType:H,terrains:Y,walls:_}=S.terrain;if(H==="preset"&&O){if(hl.find(J=>J.name===O))ma.set(O),wa.set("preset");else if(Y||_){const J=`imported-${Date.now()}`,C=localStorage.getItem("warhammer-deployment-layouts"),K=C?JSON.parse(C):{};K[J]={terrains:Y||[],walls:_||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(K)),ma.set(J),wa.set("saved")}}else if(H==="saved"&&O){const V=localStorage.getItem("warhammer-deployment-layouts"),J=V?JSON.parse(V):{};J[O]?(ma.set(O),wa.set("saved")):(Y||_)&&(J[O]={terrains:Y||[],walls:_||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(J)),ma.set(O),wa.set("saved"))}else if(Y||_){const V=`imported-${Date.now()}`,J=localStorage.getItem("warhammer-deployment-layouts"),C=J?JSON.parse(J):{};C[V]={terrains:Y||[],walls:_||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(C)),ma.set(V),wa.set("saved")}}S.models&&Array.isArray(S.models)&&(ct.set(S.models),In.clear()),b(de,[])}function Ce(S,O){const _=O===1?-4:64,V=2;let J=_,C=V,K=0;return S.map(Me=>{const We={...Me,x:J,y:C,inStaging:!1};return C+=2,K++,K>=20&&(C=V,J+=O===1?-2:2,K=0),We})}async function Ee(S){const{text:O,playerId:H}=S.detail;try{e(le)&&e(le).setLoading(!0);const{format:Y,data:_}=await nm(O),{matched:V,unmatched:J}=mm(_,H),C=_.LIST_TITLE||`${_.FACTION_KEYWORD} Army`;fi.addImport(C,O,_,H),J.length>0?(b(Ae,J),ue=V,b(te,!0),e(le)&&e(le).setLoading(!1)):(Ce(V,H).forEach(Me=>{ct.update(We=>[...We,Me])}),e(le)&&(e(le).setSuccess(`Imported ${V.length} models from ${_.FACTION_KEYWORD} (${Y})`),e(le).clearText()))}catch(Y){console.error("Failed to parse army list:",Y),e(le)&&e(le).setError(Y.message||"Failed to parse army list")}}function Qe(S){const{selected:O}=S.detail,H=[];for(const V of O){const J=typeof V.quantity=="string"?parseInt(V.quantity.replace(/x/i,""),10)||1:V.quantity||1,C="unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);for(let K=0;K<J;K++)H.push({id:"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),baseType:V.baseType,playerId:e(q),x:0,y:0,rotation:0,unitId:C,unitName:V.unitName,name:V.unitName,imported:!0})}const Y=[...ue,...H];Ce(Y,e(q)).forEach(V=>{ct.update(J=>[...J,V])}),e(le)&&(e(le).setSuccess(`Imported ${Y.length} models`),e(le).clearText()),b(Ae,[]),ue=[]}Er(()=>{window.addEventListener("keydown",Lt)}),Qo(()=>{window.removeEventListener("keydown",Lt)});function Lt(S){if(S.target.tagName==="INPUT")return;const O=e(de).length>0;if((S.ctrlKey||S.metaKey)&&S.key==="z"&&!S.shiftKey){S.preventDefault(),ct.undo();return}if((S.ctrlKey||S.metaKey)&&(S.key==="y"||S.shiftKey&&S.key==="z")){S.preventDefault(),ct.redo();return}if((S.ctrlKey||S.metaKey)&&S.key==="g"&&!S.shiftKey){S.preventDefault(),Rr();return}if((S.ctrlKey||S.metaKey)&&S.shiftKey&&S.key==="G"){S.preventDefault(),Dr();return}if(S.key==="1"){S.preventDefault(),b(q,1);return}if(S.key==="2"){S.preventDefault(),b(q,2);return}if(S.key==="l"||S.key==="L"){S.preventDefault(),b(ae,!e(ae));return}if(S.key==="m"||S.key==="M"){S.preventDefault(),b(xt,!e(xt)),e(xt)||(b(Ne,!1),b(Ke,null),b(ze,null));return}if(S.key==="Delete"||S.key==="Backspace"){if(S.preventDefault(),e(zt)){b(Ht,e(Ht).filter(H=>H.id!==e(zt))),b(zt,null);return}e(de).length>0&&(e(de).forEach(H=>{ct.remove(H)}),b(de,[]));return}if(O&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(S.key)){S.preventDefault();const H=S.shiftKey?.1:1;let Y=0,_=0;switch(S.key){case"ArrowUp":_=-H;break;case"ArrowDown":_=H;break;case"ArrowLeft":Y=-H;break;case"ArrowRight":Y=H;break}e(de).forEach(V=>{const J=i().find(C=>C.id===V);J&&ct.updateModel(V,{x:J.x+Y,y:J.y+_},!1)});return}if(S.key==="Escape"){jt();return}}function jt(S){if(ut){ut=!1;return}b(de,[]),b(zt,null)}function pn(){return"line-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Bt(S,O,H,Y){return Math.sqrt((H-S)**2+(Y-O)**2)}function yn(S){if(!e(se))return;S.preventDefault();const O=e(se)(S.clientX,S.clientY);b(Ne,!0),b(Ke,{x:O.x,y:O.y}),b(ze,{x:O.x,y:O.y}),window.addEventListener("mousemove",fa),window.addEventListener("mouseup",Za)}function fa(S){if(!e(Ne)||!e(se))return;const O=e(se)(S.clientX,S.clientY);b(ze,{x:O.x,y:O.y})}function Za(S){if(!e(Ne))return;if(Bt(e(Ke).x,e(Ke).y,e(ze).x,e(ze).y)>.5){const H={id:pn(),x1:e(Ke).x,y1:e(Ke).y,x2:e(ze).x,y2:e(ze).y};b(Ht,[...e(Ht),H]),b(zt,H.id),b(de,[])}b(Ne,!1),b(Ke,null),b(ze,null),window.removeEventListener("mousemove",fa),window.removeEventListener("mouseup",Za)}function Pn(S,O){O?.stopPropagation(),b(zt,S),b(de,[])}let Rn=!1,Hn={x:0,y:0},qn=null,Nn=null;function pa(S,O){if(!e(xt)||!e(se))return;O.stopPropagation(),O.preventDefault();const H=e(Ht).find(J=>J.id===S);if(!H)return;Rn=!0,qn=S,Nn=null,b(zt,S),b(de,[]);const Y=e(se)(O.clientX,O.clientY),_=(H.x1+H.x2)/2,V=(H.y1+H.y2)/2;Hn={x:Y.x-_,y:Y.y-V},window.addEventListener("mousemove",ya),window.addEventListener("mouseup",oe)}function Jn(S,O,H){!e(xt)||!e(se)||(H.stopPropagation(),H.preventDefault(),Rn=!0,qn=S,Nn=O,b(zt,S),b(de,[]),window.addEventListener("mousemove",ya),window.addEventListener("mouseup",oe))}function ya(S){if(!Rn||!e(se)||!qn)return;const O=e(se)(S.clientX,S.clientY);b(Ht,e(Ht).map(H=>{if(H.id!==qn)return H;if(Nn===1)return{...H,x1:O.x,y1:O.y};if(Nn===2)return{...H,x2:O.x,y2:O.y};{const Y=O.x-Hn.x,_=O.y-Hn.y,V=(H.x1+H.x2)/2,J=(H.y1+H.y2)/2,C=Y-V,K=_-J;return{...H,x1:H.x1+C,y1:H.y1+K,x2:H.x2+C,y2:H.y2+K}}}))}function oe(){Rn=!1,qn=null,Nn=null,window.removeEventListener("mousemove",ya),window.removeEventListener("mouseup",oe)}function Ue(){b(Ht,[]),b(zt,null)}function kt(S){const O=S.target,H=O.closest(".model-base"),Y=O.closest(".measurement-line");if(H||Y||!e(se))return;if(S.preventDefault(),e(xt)){yn(S);return}const _=e(se)(S.clientX,S.clientY);b(ge,{x:_.x,y:_.y}),b(Pe,{x:_.x,y:_.y}),b(Xe,!0),window.addEventListener("mousemove",At),window.addEventListener("mouseup",Se)}function At(S){if(!e(Xe)||!e(se))return;const O=e(se)(S.clientX,S.clientY);b(Pe,{x:O.x,y:O.y});const H=Math.min(e(ge).x,e(Pe).x),Y=Math.max(e(ge).x,e(Pe).x),_=Math.min(e(ge).y,e(Pe).y),V=Math.max(e(ge).y,e(Pe).y),J=new Set;i().forEach(C=>{C.x>=H&&C.x<=Y&&C.y>=_&&C.y<=V&&J.add(C.id)}),b(bt,J)}function Se(S){if(!e(Xe))return;const O=Math.min(e(ge).x,e(Pe).x),H=Math.max(e(ge).x,e(Pe).x),Y=Math.min(e(ge).y,e(Pe).y),_=Math.max(e(ge).y,e(Pe).y),V=H-O,J=_-Y;if(V<.5&&J<.5)b(de,[]);else{const C=[];i().forEach(K=>{K.x>=O&&K.x<=H&&K.y>=Y&&K.y<=_&&C.push(K.id)}),b(de,C),ut=!0}b(Xe,!1),b(ge,null),b(Pe,null),e(bt).clear(),b(bt,e(bt)),window.removeEventListener("mousemove",At),window.removeEventListener("mouseup",Se)}function at(S,O){if(!e(se))return;ee=!0,fe={x:O.clientX,y:O.clientY};const H=e(se)(O.clientX,O.clientY);b(ie,{baseType:S.type,x:H.x,y:H.y}),window.addEventListener("mousemove",Ze),window.addEventListener("mouseup",$e)}function Ze(S){if(!ee||!e(ie)||!e(se))return;const O=e(se)(S.clientX,S.clientY);b(ie,{...e(ie),x:O.x,y:O.y})}function $e(S){if(!ee||!e(ie)){ee=!1,b(ie,null),fe=null,window.removeEventListener("mousemove",Ze),window.removeEventListener("mouseup",$e);return}const O=S.clientX-fe.x,H=S.clientY-fe.y,Y=Math.sqrt(O*O+H*H);let _,V;Y<Ct?(_=30,V=22):(_=e(ie).x,V=e(ie).y);const J=e(ie).customWidth&&e(ie).customHeight?{width:e(ie).customWidth,height:e(ie).customHeight}:null,C=ct.add(e(ie).baseType,e(q),_,V,J);b(de,[C]),b(ie,null),ee=!1,fe=null,window.removeEventListener("mousemove",Ze),window.removeEventListener("mouseup",$e)}function He(){const H={width:e(ve),height:e(be)},Y=ct.add("rect-custom",e(q),30,22,H);b(de,[Y])}function R(S,O){if(O&&(O.ctrlKey||O.metaKey||O.shiftKey))e(de).includes(S)?b(de,e(de).filter(H=>H!==S)):b(de,[...e(de),S]);else{if(e(de).includes(S))return;{const H=i().find(Y=>Y.id===S);if(H&&H.unitId){const Y=i().filter(_=>_.unitId===H.unitId).map(_=>_.id);b(de,Y)}else b(de,[S])}}}function nt(S,O,H){if(e(de).length>1&&e(de).includes(S)){Yt||(Yt=!0,_t={},e(de).forEach(_=>{const V=i().find(J=>J.id===_);V&&(_t[_]={x:V.x,y:V.y})}));const Y=_t[S];if(Y){const _=O-Y.x,V=H-Y.y;e(de).forEach(J=>{const C=_t[J];C&&ct.updateModel(J,{x:C.x+_,y:C.y+V},!0)})}}else ct.updateModel(S,{x:O,y:H},!0)}function Mt(S,O,H,Y,_){Yt?(e(de).forEach(V=>{const J=_t[V],C=i().find(K=>K.id===V);J&&C&&In.push({type:"move",modelId:V,before:{x:J.x,y:J.y},after:{x:C.x,y:C.y}})}),Yt=!1,_t=null):In.push({type:"move",modelId:S,before:{x:O,y:H},after:{x:Y,y:_}})}function yt(S,O){if(e(de).length>1&&e(de).includes(S)){if(!it){it=!0;let V=0,J=0,C=0;const K={};e(de).forEach(Me=>{const We=i().find(_e=>_e.id===Me);We&&(V+=We.x,J+=We.y,C++,K[Me]={x:We.x,y:We.y,rotation:We.rotation||0})}),Tt={x:V/C,y:J/C},_t=K}const H=i().find(V=>V.id===S),Y=_t[S];if(!H||!Y)return;const _=O-Y.rotation;e(de).forEach(V=>{const J=_t[V];if(J){const C=J.x-Tt.x,K=J.y-Tt.y,Me=_*Math.PI/180,We=Math.cos(Me),_e=Math.sin(Me),Fe=C*We-K*_e,rt=C*_e+K*We;ct.updateModel(V,{x:Tt.x+Fe,y:Tt.y+rt,rotation:J.rotation+_},!0)}})}else ct.updateModel(S,{rotation:O},!0)}function dt(S,O,H){it?(e(de).forEach(Y=>{const _=_t[Y],V=i().find(J=>J.id===Y);_&&V&&In.push({type:"rotate",modelId:Y,before:{x:_.x,y:_.y,rotation:_.rotation},after:{x:V.x,y:V.y,rotation:V.rotation||0}})}),it=!1,Tt=null,_t=null):In.push({type:"rotate",modelId:S,before:{rotation:O},after:{rotation:H}})}function dn(S,O){ct.updateModel(S,{name:O})}function Rr(){if(e(de).length<2)return;const S=e(de).map(H=>i().find(Y=>Y.id===H)).filter(Boolean);if([...new Set(S.map(H=>H.playerId))].length>1){alert("Cannot group models from different players");return}ct.groupModels(e(de))}function Dr(){if(e(de).length===0)return;const S=e(de).filter(O=>{const H=i().find(Y=>Y.id===O);return H&&H.unitId});S.length>0&&ct.ungroupModels(S)}function es(S){if(!e(se)||e(m).length<2)return;S.preventDefault(),S.stopPropagation(),it=!0,Qt={},e(m).forEach(H=>{Qt[H.id]={x:H.x,y:H.y,rotation:H.rotation||0}});const O=e(se)(S.clientX,S.clientY);je=Math.atan2(O.y-e(T).y,O.x-e(T).x)*180/Math.PI,window.addEventListener("mousemove",Zn),window.addEventListener("mouseup",va)}function Zn(S){if(!it||!e(se)||!e(T))return;const O=e(se)(S.clientX,S.clientY);let Y=Math.atan2(O.y-e(T).y,O.x-e(T).x)*180/Math.PI-je;S.shiftKey||(Y=Math.round(Y/15)*15),b(Q,-45+Y);const _=Y*Math.PI/180,V=Math.cos(_),J=Math.sin(_);e(m).forEach(C=>{const K=Qt[C.id];if(K){const Me=K.x-e(T).x,We=K.y-e(T).y,_e=Me*V-We*J,Fe=Me*J+We*V;ct.updateModel(C.id,{x:e(T).x+_e,y:e(T).y+Fe,rotation:K.rotation+Y},!0)}})}function va(){it&&Qt&&e(m).forEach(S=>{const O=Qt[S.id];O&&In.push({type:"rotate",modelId:S.id,before:{x:O.x,y:O.y,rotation:O.rotation},after:{x:S.x,y:S.y,rotation:S.rotation||0}})}),it=!1,Qt=null,b(Q,-45),window.removeEventListener("mousemove",Zn),window.removeEventListener("mouseup",va)}function Qn(){e(de).length>0&&(e(de).forEach(S=>{ct.remove(S)}),b(de,[]))}function ts(){confirm("Clear all models?")&&(ct.clear(),b(de,[]))}function Ir(S){if(zn(S.baseType))return{x:S.x,y:S.y,width:S.customWidth,height:S.customHeight,rotation:S.rotation||0,isRectangle:!0};const O=Sn(S.baseType,S);return vn(S.baseType)?{x:S.x,y:S.y,rx:O.width/2,ry:O.height/2,rotation:S.rotation||0}:{x:S.x,y:S.y,radius:O.radius}}const I=["#f97316","#f59e0b","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e","#fb7185","#fdba74","#fcd34d"];function z(S){if(!S)return null;let O=0;for(let Y=0;Y<S.length;Y++)O=(O<<5)-O+S.charCodeAt(Y),O=O&O;const H=Math.abs(O)%I.length;return console.log(I[H]),I[H]}let Q=W(-45);me(()=>(e(de),i()),()=>{b(m,e(de).map(S=>i().find(O=>O.id===S)).filter(Boolean))}),me(()=>e(m),()=>{b(f,e(m).length===1?e(m)[0]:null)}),me(()=>e(m),()=>{b(v,e(m).length<2?!1:[...new Set(e(m).map(O=>O.playerId))].length===1)}),me(()=>e(m),()=>{b(A,e(m).some(S=>S.unitId))}),me(()=>e(m),()=>{b(T,e(m).length>1?(()=>{let S=0,O=0;return e(m).forEach(H=>{S+=H.x,O+=H.y}),{x:S/e(m).length,y:O/e(m).length}})():null)}),me(()=>(e(m),e(T),vn),()=>{b(E,e(m).length>1?(()=>{let S=0;return e(m).forEach(O=>{const H=Math.sqrt(Math.pow(O.x-e(T).x,2)+Math.pow(O.y-e(T).y,2)),Y=Sn(O.baseType,O),_=zn(O.baseType)?Math.max(O.customWidth,O.customHeight)/2:vn(O.baseType)?Math.max(Y.width,Y.height)/2:Y.radius;S=Math.max(S,H+_)}),S+2})():0)}),me(()=>(e(T),e(E),e(Q)),()=>{b(P,e(T)?e(T).x+e(E)*Math.cos(e(Q)*Math.PI/180):0)}),me(()=>(e(T),e(E),e(Q)),()=>{b(M,e(T)?e(T).y+e(E)*Math.sin(e(Q)*Math.PI/180):0)}),me(()=>(e(zt),e(Ht)),()=>{b(k,e(zt)?e(Ht).find(S=>S.id===e(zt)):null)}),me(()=>e(m),()=>{b(D,[...new Set(e(m).map(S=>S.playerId))])}),me(()=>(e(m),i(),e(D)),()=>{b($,e(m).length>0?i().filter(S=>!e(D).includes(S.playerId)):[])}),me(()=>(l(),Sr),()=>{b(B,l().terrains.map(S=>({id:S.id,vertices:Sr(S)})))}),me(()=>(l(),Ca),()=>{b(F,l().walls.map(S=>ws(Ca(S.shape,S.segments),S.x,S.y,S.rotation)))}),me(()=>(e(m),e(ae),e($),e(B),e(F)),()=>{b(G,e(m).length>0&&e(ae)&&e($).length>0?(()=>{const S=new Map;e(m).forEach(Y=>{const _=Y.unitId||`single-${Y.id}`;S.has(_)||S.set(_,[]),S.get(_).push(Y)});const O=new Map;e($).forEach(Y=>{const _=Y.unitId||`single-${Y.id}`;O.has(_)||O.set(_,[]),O.get(_).push(Y)});const H=[];for(const Y of S.values())for(const _ of O.values()){const V=_.map(K=>Ir(K)),J=Y.map(K=>Ir(K)),C=rl(V,J,e(B),e(F));C.canSee?_.forEach(K=>{Y.forEach(Me=>{H.push({sourceId:K.id,source:K,targetId:Me.id,target:Me,canSee:!0,firstClearRay:C.firstClearResult?.firstClearRay,rays:C.firstClearResult?.rays||[]})})}):_.forEach(K=>{Y.forEach(Me=>{H.push({sourceId:K.id,source:K,targetId:Me.id,target:Me,canSee:!1,firstClearRay:null,rays:[]})})})}return H})():[])}),$a(),ia();var Te=yh(),xe=ce(Te),et=x(xe),Ye=x(et),tt=x(Ye);kn(tt,{title:"Selected Model",children:(S,O)=>{var H=Ge(),Y=ce(H);{var _=J=>{var C=Im(),K=x(C),Me=g(x(K),2),We=x(Me),_e=g(K,2),Fe=x(_e),rt=x(Fe),Kt=g(_e,2);{var vt=Nt=>{var on=Mm(),Tn=ce(on),Gt=x(Tn),en=x(Gt),Dt=g(Tn,2);{var Be=X=>{var Je=Em(),Oe=g(x(Je),2),N=x(Oe);U(ke=>Le(N,`${ke??""}/${e(G),o(()=>e(G).length)??""} rays visible`),[()=>(e(G),o(()=>e(G).filter(ke=>ke.canSee).length))]),w(X,Je)};j(Dt,X=>{e(G),o(()=>e(G).length>0)&&X(Be)})}En(en,()=>e(De),X=>b(De,X)),w(Nt,on)};j(Kt,Nt=>{e(ae)&&Nt(vt)})}var Rt=g(Kt,2);{var Pt=Nt=>{var on=Rm();ne("click",on,Rr),w(Nt,on)};j(Rt,Nt=>{e(v)&&Nt(Pt)})}var mn=g(Rt,2);{var mt=Nt=>{var on=Dm();ne("click",on,Dr),w(Nt,on)};j(mn,Nt=>{e(A)&&Nt(mt)})}var qt=g(mn,2),sn=x(qt);U(()=>{Le(We,`${e(de),o(()=>e(de).length)??""} models`),Le(sn,`Remove All (${e(de),o(()=>e(de).length)??""})`)}),En(rt,()=>e(ae),Nt=>b(ae,Nt)),ne("click",qt,Qn),w(J,C)},V=J=>{var C=Ge(),K=ce(C);{var Me=_e=>{var Fe=Nm(),rt=x(Fe),Kt=g(x(rt),2),vt=g(rt,2),Rt=g(x(vt),2),Pt=x(Rt),mn=g(vt,2),mt=g(x(mn),2),qt=x(mt),sn=g(mn,2),Nt=g(x(sn),2),on=x(Nt),Tn=g(sn,2);{var Gt=gt=>{var tn=Lm(),ht=g(x(tn),2),St=x(ht);U(Ut=>Le(St,`${Ut??""}°`),[()=>(e(f),o(()=>Math.round(e(f).rotation||0)))]),w(gt,tn)};j(Tn,gt=>{L(vn),e(f),o(()=>vn(e(f).baseType))&&gt(Gt)})}var en=g(Tn,2),Dt=x(en),Be=x(Dt),X=g(en,2);{var Je=gt=>{var tn=$m(),ht=x(tn),St=x(ht);En(St,()=>e(De),Ut=>b(De,Ut)),w(gt,tn)};j(X,gt=>{e(ae)&&gt(Je)})}var Oe=g(X,2);{var N=gt=>{var tn=Pm(),ht=g(x(tn),2),St=x(ht);U(Ut=>Le(St,`${Ut??""}/${e(G),o(()=>e(G).length)??""} visible`),[()=>(e(G),o(()=>e(G).filter(Ut=>Ut.canSee).length))]),w(gt,tn)};j(Oe,gt=>{e(ae),e(G),o(()=>e(ae)&&e(G).length>0)&&gt(N)})}var ke=g(Oe,2);U((gt,tn,ht)=>{Ha(Kt,(e(f),o(()=>e(f).name||""))),Le(Pt,gt),Le(qt,`Player ${e(f),o(()=>e(f).playerId)??""}`),Le(on,`${tn??""}", ${ht??""}"`)},[()=>(L(Sn),e(f),o(()=>Sn(e(f).baseType,e(f))?.label||"Unknown")),()=>(e(f),o(()=>e(f).x.toFixed(1))),()=>(e(f),o(()=>e(f).y.toFixed(1)))]),ne("change",Kt,gt=>dn(e(f).id,gt.target.value)),En(Be,()=>e(ae),gt=>b(ae,gt)),ne("click",ke,Qn),w(_e,Fe)},We=_e=>{var Fe=Om();w(_e,Fe)};j(K,_e=>{e(f)?_e(Me):_e(We,!1)},!0)}w(J,C)};j(Y,J=>{e(de),o(()=>e(de).length>1)?J(_):J(V,!1)})}w(S,H)},$$slots:{default:!0}});var lt=g(tt,2);kn(lt,{title:"Measure Tool",children:(S,O)=>{var H=Fm(),Y=x(H),_=x(Y),V=x(_),J=g(Y,2);{var C=mt=>{var qt=Wm();w(mt,qt)};j(J,mt=>{e(xt)&&mt(C)})}var K=g(J,2);{var Me=mt=>{var qt=Ym(),sn=ce(qt),Nt=g(x(sn),2),on=x(Nt),Tn=g(sn,2);U(Gt=>Le(on,`${Gt??""}"`),[()=>(e(k),o(()=>Bt(e(k).x1,e(k).y1,e(k).x2,e(k).y2).toFixed(2)))]),ne("click",Tn,()=>{b(Ht,e(Ht).filter(Gt=>Gt.id!==e(zt))),b(zt,null)}),w(mt,qt)};j(K,mt=>{e(k)&&mt(Me)})}var We=g(K,2);{var _e=mt=>{var qt=Hm(),sn=ce(qt),Nt=g(x(sn),2),on=x(Nt),Tn=g(sn,2);U(()=>Le(on,`${e(Ht),o(()=>e(Ht).length)??""} line${e(Ht),o(()=>e(Ht).length!==1?"s":"")??""}`)),ne("click",Tn,Ue),w(mt,qt)};j(We,mt=>{e(Ht),o(()=>e(Ht).length>0)&&mt(_e)})}var Fe=g(We,2),rt=g(x(Fe),2),Kt=x(rt),vt=g(rt,2),Rt=x(vt),Pt=g(vt,2),mn=x(Pt);En(V,()=>e(xt),mt=>b(xt,mt)),En(Kt,()=>e(Z),mt=>b(Z,mt)),En(Rt,()=>e(Ie),mt=>b(Ie,mt)),En(mn,()=>e(qe),mt=>b(qe,mt)),w(S,H)},$$slots:{default:!0}});var Jt=g(lt,2);kn(Jt,{title:"Actions",children:(S,O)=>{var H=Bm(),Y=x(H),_=x(Y),V=g(_,2),J=g(Y,2),C=x(J),K=g(C,2),Me=g(J,2);wr(Me,Kt=>b(wt,Kt),()=>e(wt));var We=g(Me,2),_e=g(We,2),Fe=g(_e,2),rt=g(Fe,2);U(()=>{_.disabled=(c(),o(()=>!c().past.length)),V.disabled=(c(),o(()=>!c().future.length))}),ne("click",_,()=>ct.undo()),ne("click",V,()=>ct.redo()),ne("click",C,Ft),ne("click",K,It),ne("change",Me,hn),ne("click",We,Et),ne("click",_e,ot),ne("click",Fe,$t),ne("click",rt,ts),w(S,H)},$$slots:{default:!0}});var an=g(Jt,2);kn(an,{title:"Import Army List",startOpen:!1,children:(S,O)=>{wr(Wd(S,{get currentPlayer(){return e(q)},$$events:{parse:Ee},$$legacy:!0}),H=>b(le,H),()=>e(le))},$$slots:{default:!0}});var ln=g(an,2);kn(ln,{title:"Add Models",children:(S,O)=>{var H=qm(),Y=ce(H),_=x(Y);let V;var J=g(_,2);let C;var K=g(Y,2),Me=x(K),We=g(x(Me),2);Ve(We,5,()=>(L(ra),o(()=>ra.circles)),ft,(rt,Kt)=>{Gs(rt,{get baseSize(){return e(Kt)},get playerId(){return e(q)},onDragStart:at})});var _e=g(Me,2),Fe=g(x(_e),2);Ve(Fe,5,()=>(L(ra),o(()=>ra.ovals)),ft,(rt,Kt)=>{Gs(rt,{get baseSize(){return e(Kt)},get playerId(){return e(q)},onDragStart:at})}),U(()=>{V=Mn(_,1,"toggle-btn svelte-1g40uyy",null,V,{active:e(q)===1}),C=Mn(J,1,"toggle-btn svelte-1g40uyy",null,C,{active:e(q)===2})}),ne("click",_,()=>b(q,1)),ne("click",J,()=>b(q,2)),w(S,H)},$$slots:{default:!0}});var bn=g(ln,2);kn(bn,{title:"Add Hull (Vehicle)",children:(S,O)=>{var H=Um(),Y=x(H),_=g(x(Y),2),V=g(Y,2),J=g(x(V),2),C=g(V,2),K=x(C);U(()=>Le(K,`Add ${e(ve)??""}" × ${e(be)??""}" Hull`)),qr(_,()=>e(ve),Me=>b(ve,Me)),qr(J,()=>e(be),Me=>b(be,Me)),ne("click",C,He),w(S,H)},$$slots:{default:!0}});var On=g(Ye,2),ea=x(On),Un=x(ea),ga=x(Un);Ss(ga,{children:co,$$slots:{default:(S,O)=>{const H=Re(()=>O.screenToSvg);var Y=ph(),_=ce(Y);{var V=Be=>{var X=Xo();U(()=>Le(X,(e(se),L(e(H)),o(()=>(b(se,e(H)),""))))),w(Be,X)};j(_,Be=>{e(H)&&!e(se)&&Be(V)})}var J=g(_);{var C=Be=>{var X=zm(),Je=ce(X);Ve(Je,1,()=>(a(),o(()=>a().zones)),ft,(N,ke)=>{var gt=Km();U(tn=>{u(gt,"d",tn),u(gt,"fill",(e(ke),o(()=>e(ke).color))),u(gt,"stroke",(e(ke),o(()=>e(ke).borderColor)))},[()=>(L(kr),e(ke),o(()=>kr(e(ke).path)))]),w(N,gt)});var Oe=g(Je);Ve(Oe,1,()=>(a(),o(()=>a().objectives)),ft,(N,ke)=>{const gt=Re(()=>(e(ke),o(()=>e(ke).isPrimary?"#fbbf24":"#9ca3af"))),tn=Re(()=>(e(ke),o(()=>e(ke).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var ht=Gm(),St=ce(ht),Ut=g(St),oa=g(Ut);U(()=>{u(St,"cx",(e(ke),o(()=>e(ke).x))),u(St,"cy",(e(ke),o(()=>e(ke).y))),u(St,"r",Qs),u(St,"fill",e(tn)),u(St,"stroke",e(gt)),u(Ut,"cx",(e(ke),o(()=>e(ke).x))),u(Ut,"cy",(e(ke),o(()=>e(ke).y))),u(Ut,"r",Zs),u(Ut,"fill",e(gt)),u(oa,"cx",(e(ke),o(()=>e(ke).x))),u(oa,"cy",(e(ke),o(()=>e(ke).y)))}),w(N,ht)}),w(Be,X)};j(J,Be=>{a()&&Be(C)})}var K=g(J);j(K,Be=>{});var Me=g(K);j(Me,Be=>{});var We=g(Me);Ve(We,1,()=>(l(),o(()=>l().terrains)),ft,(Be,X)=>{var Je=Xm(),Oe=x(Je);U(()=>{u(Je,"transform",`rotate(${e(X),o(()=>e(X).rotation)??""}, ${e(X),o(()=>e(X).x+e(X).width/2)??""}, ${e(X),o(()=>e(X).y+e(X).height/2)??""})`),u(Oe,"x",(e(X),o(()=>e(X).x))),u(Oe,"y",(e(X),o(()=>e(X).y))),u(Oe,"width",(e(X),o(()=>e(X).width))),u(Oe,"height",(e(X),o(()=>e(X).height)))}),w(Be,Je)});var _e=g(We);Ve(_e,1,()=>(l(),o(()=>l().walls)),ft,(Be,X)=>{var Je=Vm(),Oe=x(Je);Mi(Oe,{get id(){return e(X),o(()=>e(X).id)},get x(){return e(X),o(()=>e(X).x)},get y(){return e(X),o(()=>e(X).y)},get shape(){return e(X),o(()=>e(X).shape)},get segments(){return e(X),o(()=>e(X).segments)},get rotation(){return e(X),o(()=>e(X).rotation)},selected:!1,get screenToSvg(){return e(H)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),w(Be,Je)});var Fe=g(_e);{var rt=Be=>{var X=Ge(),Je=ce(X);Ve(Je,1,i,Oe=>Oe.id,(Oe,N)=>{const ke=Re(()=>(L(Sn),e(N),o(()=>Sn(e(N).baseType,e(N))))),gt=Re(()=>(L(vn),e(N),o(()=>vn(e(N).baseType)))),tn=Re(()=>(L(zn),e(N),o(()=>zn(e(N).baseType)))),ht=Re(()=>(e(N),o(()=>e(N).playerId===1?"rgba(59, 130, 246, 0.15)":"rgba(239, 68, 68, 0.15)"))),St=Re(()=>(e(N),o(()=>e(N).playerId===1?"#3b82f6":"#ef4444")));var Ut=sh(),oa=ce(Ut);{var Lr=Yn=>{var la=Ge(),ns=ce(la);{var as=xn=>{var _n=jm(),cn=x(_n);U(()=>{u(_n,"transform",`rotate(${e(N),o(()=>e(N).rotation||0)??""}, ${e(N),o(()=>e(N).x)??""}, ${e(N),o(()=>e(N).y)??""})`),u(cn,"x",(e(N),o(()=>e(N).x-e(N).customWidth/2-12))),u(cn,"y",(e(N),o(()=>e(N).y-e(N).customHeight/2-12))),u(cn,"width",(e(N),o(()=>e(N).customWidth+24))),u(cn,"height",(e(N),o(()=>e(N).customHeight+24))),u(cn,"fill",e(ht)),u(cn,"stroke",e(St))}),w(xn,_n)},rs=xn=>{var _n=Ge(),cn=ce(_n);{var ss=wn=>{var Xt=Jm(),An=x(Xt);U(()=>{u(Xt,"transform",`rotate(${e(N),o(()=>e(N).rotation||0)??""}, ${e(N),o(()=>e(N).x)??""}, ${e(N),o(()=>e(N).y)??""})`),u(An,"cx",(e(N),o(()=>e(N).x))),u(An,"cy",(e(N),o(()=>e(N).y))),u(An,"rx",(L(e(ke)),o(()=>e(ke).width/2+12))),u(An,"ry",(L(e(ke)),o(()=>e(ke).height/2+12))),u(An,"fill",e(ht)),u(An,"stroke",e(St))}),w(wn,Xt)},is=wn=>{var Xt=Zm();U(()=>{u(Xt,"cx",(e(N),o(()=>e(N).x))),u(Xt,"cy",(e(N),o(()=>e(N).y))),u(Xt,"r",(L(e(ke)),o(()=>e(ke).radius+12))),u(Xt,"fill",e(ht)),u(Xt,"stroke",e(St))}),w(wn,Xt)};j(cn,wn=>{e(gt)?wn(ss):wn(is,!1)},!0)}w(xn,_n)};j(ns,xn=>{e(tn)?xn(as):xn(rs,!1)})}w(Yn,la)};j(oa,Yn=>{e(qe)&&Yn(Lr)})}var $r=g(oa);{var Kn=Yn=>{var la=Ge(),ns=ce(la);{var as=xn=>{var _n=Qm(),cn=x(_n);U(()=>{u(_n,"transform",`rotate(${e(N),o(()=>e(N).rotation||0)??""}, ${e(N),o(()=>e(N).x)??""}, ${e(N),o(()=>e(N).y)??""})`),u(cn,"x",(e(N),o(()=>e(N).x-e(N).customWidth/2-9))),u(cn,"y",(e(N),o(()=>e(N).y-e(N).customHeight/2-9))),u(cn,"width",(e(N),o(()=>e(N).customWidth+18))),u(cn,"height",(e(N),o(()=>e(N).customHeight+18))),u(cn,"fill",e(ht)),u(cn,"stroke",e(St))}),w(xn,_n)},rs=xn=>{var _n=Ge(),cn=ce(_n);{var ss=wn=>{var Xt=eh(),An=x(Xt);U(()=>{u(Xt,"transform",`rotate(${e(N),o(()=>e(N).rotation||0)??""}, ${e(N),o(()=>e(N).x)??""}, ${e(N),o(()=>e(N).y)??""})`),u(An,"cx",(e(N),o(()=>e(N).x))),u(An,"cy",(e(N),o(()=>e(N).y))),u(An,"rx",(L(e(ke)),o(()=>e(ke).width/2+9))),u(An,"ry",(L(e(ke)),o(()=>e(ke).height/2+9))),u(An,"fill",e(ht)),u(An,"stroke",e(St))}),w(wn,Xt)},is=wn=>{var Xt=th();U(()=>{u(Xt,"cx",(e(N),o(()=>e(N).x))),u(Xt,"cy",(e(N),o(()=>e(N).y))),u(Xt,"r",(L(e(ke)),o(()=>e(ke).radius+9))),u(Xt,"fill",e(ht)),u(Xt,"stroke",e(St))}),w(wn,Xt)};j(cn,wn=>{e(gt)?wn(ss):wn(is,!1)},!0)}w(xn,_n)};j(ns,xn=>{e(tn)?xn(as):xn(rs,!1)})}w(Yn,la)};j($r,Yn=>{e(Ie)&&Yn(Kn)})}var ks=g($r);{var dr=Yn=>{var la=Ge(),ns=ce(la);{var as=xn=>{var _n=nh(),cn=x(_n);U(()=>{u(_n,"transform",`rotate(${e(N),o(()=>e(N).rotation||0)??""}, ${e(N),o(()=>e(N).x)??""}, ${e(N),o(()=>e(N).y)??""})`),u(cn,"x",(e(N),o(()=>e(N).x-e(N).customWidth/2-6))),u(cn,"y",(e(N),o(()=>e(N).y-e(N).customHeight/2-6))),u(cn,"width",(e(N),o(()=>e(N).customWidth+12))),u(cn,"height",(e(N),o(()=>e(N).customHeight+12))),u(cn,"stroke",e(St))}),w(xn,_n)},rs=xn=>{var _n=Ge(),cn=ce(_n);{var ss=wn=>{var Xt=ah(),An=x(Xt);U(()=>{u(Xt,"transform",`rotate(${e(N),o(()=>e(N).rotation||0)??""}, ${e(N),o(()=>e(N).x)??""}, ${e(N),o(()=>e(N).y)??""})`),u(An,"cx",(e(N),o(()=>e(N).x))),u(An,"cy",(e(N),o(()=>e(N).y))),u(An,"rx",(L(e(ke)),o(()=>e(ke).width/2+6))),u(An,"ry",(L(e(ke)),o(()=>e(ke).height/2+6))),u(An,"stroke",e(St))}),w(wn,Xt)},is=wn=>{var Xt=rh();U(()=>{u(Xt,"cx",(e(N),o(()=>e(N).x))),u(Xt,"cy",(e(N),o(()=>e(N).y))),u(Xt,"r",(L(e(ke)),o(()=>e(ke).radius+6))),u(Xt,"stroke",e(St))}),w(wn,Xt)};j(cn,wn=>{e(gt)?wn(ss):wn(is,!1)},!0)}w(xn,_n)};j(ns,xn=>{e(tn)?xn(as):xn(rs,!1)})}w(Yn,la)};j(ks,Yn=>{e(Z)&&Yn(dr)})}w(Oe,Ut)}),w(Be,X)};j(Fe,Be=>{(e(Z)||e(Ie)||e(qe))&&Be(rt)})}var Kt=g(Fe);Ve(Kt,1,i,Be=>Be.id,(Be,X)=>{{let Je=Re(()=>(e(X),o(()=>e(X).name||""))),Oe=Re(()=>(e(X),o(()=>z(e(X).unitId)))),N=Re(()=>(e(de),e(X),o(()=>e(de).includes(e(X).id)))),ke=Re(()=>(e(de),e(X),o(()=>e(de).length>1&&e(de).includes(e(X).id)))),gt=Re(()=>(e(de),e(X),e(bt),o(()=>!e(de).includes(e(X).id)&&e(bt).has(e(X).id))));Ks(Be,{get id(){return e(X),o(()=>e(X).id)},get x(){return e(X),o(()=>e(X).x)},get y(){return e(X),o(()=>e(X).y)},get baseType(){return e(X),o(()=>e(X).baseType)},get playerId(){return e(X),o(()=>e(X).playerId)},get rotation(){return e(X),o(()=>e(X).rotation)},get name(){return e(Je)},get customWidth(){return e(X),o(()=>e(X).customWidth)},get customHeight(){return e(X),o(()=>e(X).customHeight)},get unitStrokeColor(){return e(Oe)},get selected(){return e(N)},get inGroupSelection(){return e(ke)},get marqueePreview(){return e(gt)},get screenToSvg(){return e(H)},onSelect:R,onDrag:nt,onDragEnd:Mt,onRotate:yt,onRotateEnd:dt,onRename:dn})}});var vt=g(Kt);{var Rt=Be=>{Ks(Be,{id:"phantom",get x(){return e(ie),o(()=>e(ie).x)},get y(){return e(ie),o(()=>e(ie).y)},get baseType(){return e(ie),o(()=>e(ie).baseType)},get playerId(){return e(q)},rotation:0,get customWidth(){return e(ie),o(()=>e(ie).customWidth)},get customHeight(){return e(ie),o(()=>e(ie).customHeight)},selected:!1,get screenToSvg(){return e(H)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};j(vt,Be=>{e(ie)&&Be(Rt)})}var Pt=g(vt);{var mn=Be=>{var X=ih(),Je=ce(X),Oe=g(Je),N=g(Oe),ke=g(N);U(()=>{u(Je,"cx",(e(T),o(()=>e(T).x))),u(Je,"cy",(e(T),o(()=>e(T).y))),u(Oe,"x1",(e(T),o(()=>e(T).x))),u(Oe,"y1",(e(T),o(()=>e(T).y))),u(Oe,"x2",e(P)),u(Oe,"y2",e(M)),u(N,"cx",e(P)),u(N,"cy",e(M)),u(ke,"transform",`translate(${e(P)??""}, ${e(M)??""})`)}),ne("mousedown",N,es),w(Be,X)};j(Pt,Be=>{e(T),e(m),o(()=>e(T)&&e(m).length>1)&&Be(mn)})}var mt=g(Pt);Ve(mt,1,()=>e(Ht),Be=>Be.id,(Be,X)=>{const Je=Re(()=>(e(X),o(()=>Bt(e(X).x1,e(X).y1,e(X).x2,e(X).y2)))),Oe=Re(()=>(e(X),o(()=>(e(X).x1+e(X).x2)/2))),N=Re(()=>(e(X),o(()=>(e(X).y1+e(X).y2)/2))),ke=Re(()=>(e(X),e(zt),o(()=>e(X).id===e(zt))));var gt=lh();let tn;var ht=x(gt),St=g(ht);{var Ut=Kn=>{var ks=oh(),dr=ce(ks),Yn=g(dr);U(()=>{u(dr,"cx",(e(X),o(()=>e(X).x1))),u(dr,"cy",(e(X),o(()=>e(X).y1))),u(dr,"fill",e(ke)?"#3b82f6":"#f59e0b"),u(Yn,"cx",(e(X),o(()=>e(X).x2))),u(Yn,"cy",(e(X),o(()=>e(X).y2))),u(Yn,"fill",e(ke)?"#3b82f6":"#f59e0b")}),ne("mousedown",dr,la=>Jn(e(X).id,1,la)),ne("mousedown",Yn,la=>Jn(e(X).id,2,la)),w(Kn,ks)};j(St,Kn=>{e(xt)&&Kn(Ut)})}var oa=g(St),Lr=g(x(oa)),$r=x(Lr);U(Kn=>{tn=Mn(gt,0,"measurement-line",null,tn,{selected:e(ke),"tool-active":e(xt)}),u(ht,"x1",(e(X),o(()=>e(X).x1))),u(ht,"y1",(e(X),o(()=>e(X).y1))),u(ht,"x2",(e(X),o(()=>e(X).x2))),u(ht,"y2",(e(X),o(()=>e(X).y2))),u(ht,"stroke",e(ke)&&e(xt)?"#3b82f6":"#f59e0b"),u(ht,"stroke-width",e(ke)&&e(xt)?.2:.15),u(ht,"role",e(xt)?"button":"presentation"),u(ht,"tabindex",e(xt)?0:-1),u(oa,"transform",`translate(${e(Oe)??""}, ${e(N)??""})`),u(Lr,"fill",e(ke)&&e(xt)?"#3b82f6":"#f59e0b"),Le($r,`${Kn??""}"`)},[()=>(L(e(Je)),o(()=>e(Je).toFixed(1)))]),ne("click",ht,Kn=>e(xt)&&Pn(e(X).id,Kn)),ne("mousedown",ht,Kn=>e(xt)?pa(e(X).id,Kn):Kn.stopPropagation()),w(Be,gt)});var qt=g(mt);{var sn=Be=>{const X=Re(()=>(e(Ke),e(ze),o(()=>Bt(e(Ke).x,e(Ke).y,e(ze).x,e(ze).y)))),Je=Re(()=>(e(Ke),e(ze),o(()=>(e(Ke).x+e(ze).x)/2))),Oe=Re(()=>(e(Ke),e(ze),o(()=>(e(Ke).y+e(ze).y)/2)));var N=uh(),ke=x(N),gt=g(ke),tn=g(gt),ht=g(tn);{var St=Ut=>{var oa=ch(),Lr=g(x(oa)),$r=x(Lr);U(Kn=>{u(oa,"transform",`translate(${e(Je)??""}, ${e(Oe)??""})`),Le($r,`${Kn??""}"`)},[()=>(L(e(X)),o(()=>e(X).toFixed(1)))]),w(Ut,oa)};j(ht,Ut=>{e(X)>.5&&Ut(St)})}U(()=>{u(ke,"x1",(e(Ke),o(()=>e(Ke).x))),u(ke,"y1",(e(Ke),o(()=>e(Ke).y))),u(ke,"x2",(e(ze),o(()=>e(ze).x))),u(ke,"y2",(e(ze),o(()=>e(ze).y))),u(gt,"cx",(e(Ke),o(()=>e(Ke).x))),u(gt,"cy",(e(Ke),o(()=>e(Ke).y))),u(tn,"cx",(e(ze),o(()=>e(ze).x))),u(tn,"cy",(e(ze),o(()=>e(ze).y)))}),w(Be,N)};j(qt,Be=>{e(Ne)&&e(Ke)&&e(ze)&&Be(sn)})}var Nt=g(qt);{var on=Be=>{var X=Ge(),Je=ce(X);Ve(Je,1,()=>e(G),ft,(Oe,N)=>{var ke=Ge(),gt=ce(ke);Ve(gt,1,()=>(e(N),o(()=>e(N).rays)),ft,(tn,ht)=>{var St=dh();U(()=>{u(St,"x1",(e(ht),o(()=>e(ht).from.x))),u(St,"y1",(e(ht),o(()=>e(ht).from.y))),u(St,"x2",(e(ht),o(()=>e(ht).to.x))),u(St,"y2",(e(ht),o(()=>e(ht).to.y))),u(St,"stroke",(e(ht),o(()=>e(ht).blocked?"#ff000033":"#00ff0033")))}),w(tn,St)}),w(Oe,ke)}),w(Be,X)};j(Nt,Be=>{e(De),e(ae),e(m),e(G),o(()=>e(De)&&e(ae)&&e(m).length>0&&e(G).length>0)&&Be(on)})}var Tn=g(Nt);{var Gt=Be=>{var X=Ge(),Je=ce(X);Ve(Je,1,()=>e(G),ft,(Oe,N)=>{var ke=Ge(),gt=ce(ke);{var tn=St=>{var Ut=mh();U(()=>{u(Ut,"x1",(e(N),o(()=>e(N).firstClearRay.from.x))),u(Ut,"y1",(e(N),o(()=>e(N).firstClearRay.from.y))),u(Ut,"x2",(e(N),o(()=>e(N).firstClearRay.to.x))),u(Ut,"y2",(e(N),o(()=>e(N).firstClearRay.to.y)))}),w(St,Ut)},ht=St=>{var Ut=hh();U(()=>{u(Ut,"x1",(e(N),o(()=>e(N).source.x))),u(Ut,"y1",(e(N),o(()=>e(N).source.y))),u(Ut,"x2",(e(N),o(()=>e(N).target.x))),u(Ut,"y2",(e(N),o(()=>e(N).target.y)))}),w(St,Ut)};j(gt,St=>{e(N),o(()=>e(N).firstClearRay)?St(tn):St(ht,!1)})}w(Oe,ke)}),w(Be,X)};j(Tn,Be=>{e(ae),e(m),e(G),o(()=>e(ae)&&e(m).length>0&&e(G).length>0)&&Be(Gt)})}var en=g(Tn);{var Dt=Be=>{const X=Re(()=>(e(ge),e(Pe),o(()=>Math.min(e(ge).x,e(Pe).x)))),Je=Re(()=>(e(ge),e(Pe),o(()=>Math.min(e(ge).y,e(Pe).y)))),Oe=Re(()=>(e(Pe),e(ge),o(()=>Math.abs(e(Pe).x-e(ge).x)))),N=Re(()=>(e(Pe),e(ge),o(()=>Math.abs(e(Pe).y-e(ge).y))));var ke=fh();U(()=>{u(ke,"x",e(X)),u(ke,"y",e(Je)),u(ke,"width",e(Oe)),u(ke,"height",e(N))}),w(Be,ke)};j(en,Be=>{e(Xe)&&e(ge)&&e(Pe)&&Be(Dt)})}w(S,Y)}}});var Na=g(Un,2),ba=x(Na),rn=x(ba),Wn=g(xe,2);Bd(Wn,{get unmatchedUnits(){return e(Ae)},get show(){return e(te)},set show(S){b(te,S)},$$events:{import:Qe,close:()=>{b(te,!1)}},$$legacy:!0}),U(()=>Le(rn,`Battlefield: 60" x 44" | ${d(),o(()=>d().length)??""} P1 models | ${h(),o(()=>h().length)??""} P2 models`)),ne("mousedown",Un,kt),w(t,Te),jn(),p()}var vh=pe('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">LoS Status</span> <span class="value svelte-hpuhtb"> </span></div>'),gh=pe('<div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Debug Rays</label></div> <!>',1),bh=pe('<span class="value warning svelte-hpuhtb">Unit split into groups</span>'),Th=pe('<span class="value warning svelte-hpuhtb"> </span>'),xh=pe('<div class="field coherency-warning svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Coherency</span> <!></div>'),_h=pe('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Coherency</span> <span class="value ok svelte-hpuhtb">All models in coherency</span></div>'),wh=pe('<button class="svelte-hpuhtb">Group (Ctrl+G)</button>'),Sh=pe('<button class="svelte-hpuhtb">Ungroup (Ctrl+Shift+G)</button>'),kh=pe('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Selected</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Line of Sight</label></div> <!> <!> <!> <!> <button class="danger svelte-hpuhtb"> </button></div>'),Ah=pe('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Rotation</span> <span class="value svelte-hpuhtb"> </span></div>'),Ch=pe('<span class="value warning svelte-hpuhtb">Disconnected from unit</span>'),Eh=pe('<span class="value warning svelte-hpuhtb"> </span>'),Mh=pe('<span class="value ok svelte-hpuhtb">In coherency</span>'),Rh=pe('<div><span class="label-text svelte-hpuhtb">Coherency</span> <!></div>'),Dh=pe('<div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Debug Rays</label></div>'),Ih=pe('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">LoS Status</span> <span class="value svelte-hpuhtb"> </span></div>'),Lh=pe('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Base Type</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Player</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Position</span> <span class="value svelte-hpuhtb"> </span></div> <!> <!> <div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-hpuhtb">Remove</button></div>'),$h=pe('<p class="hint svelte-hpuhtb">Click a model to select it</p>'),Ph=pe('<p class="hint svelte-hpuhtb">Click and drag on battlefield to draw a measurement line</p>'),Nh=pe('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Length</span> <span class="value svelte-hpuhtb"> </span></div> <button class="danger svelte-hpuhtb">Remove Line</button>',1),Oh=pe('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Lines</span> <span class="value svelte-hpuhtb"> </span></div> <button class="secondary svelte-hpuhtb">Clear All Lines</button>',1),Wh=pe('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Line Tool Active (M)</label></div> <!> <!> <!> <div class="field svelte-hpuhtb" style="margin-top: 0.5rem; border-top: 1px solid #333; padding-top: 0.5rem;"><span class="label-text svelte-hpuhtb">Range Zones</span> <label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show 6" zones</label> <label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show 9" zones</label> <label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show 12" zones</label></div></div>'),Yh=pe('<div class="button-group vertical svelte-hpuhtb"><div class="button-row svelte-hpuhtb"><button title="Undo (Ctrl+Z)" class="svelte-hpuhtb">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-hpuhtb">Redo</button></div> <div class="button-row svelte-hpuhtb"><button title="Export battle state to share" class="svelte-hpuhtb">Export</button> <button title="Import battle state from JSON" class="svelte-hpuhtb">Import</button></div> <input type="file" accept=".json" style="display: none;"/> <button title="Export battlefield as PNG image" class="svelte-hpuhtb">Export PNG</button> <button class="svelte-hpuhtb">Save to Browser</button> <button class="svelte-hpuhtb">Restore from Browser</button> <button class="secondary svelte-hpuhtb">Clear All Models</button></div>'),Hh=he('<path fill="none" stroke-width="0.15" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),Fh=he('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),Bh=he("<!><!>",1),qh=he('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),Uh=he('<g opacity="0.5" pointer-events="none"><!></g>'),Kh=he('<g><rect rx="12" ry="12" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></rect></g>'),Gh=he('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></ellipse></g>'),zh=he('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></circle>'),Xh=he('<g><rect rx="9" ry="9" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></rect></g>'),Vh=he('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></ellipse></g>'),jh=he('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></circle>'),Jh=he('<g><rect rx="6" ry="6" fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></rect></g>'),Zh=he('<g><ellipse fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></ellipse></g>'),Qh=he('<circle fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></circle>'),ef=he("<!><!><!>",1),tf=he('<circle r="0.4" fill="rgba(147, 51, 234, 0.5)" stroke="#9333ea" stroke-width="0.1" pointer-events="none"></circle><line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="group-rotate-handle"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),nf=he('<circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle><circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle>',1),af=he('<g><line stroke-linecap="round"></line><!><g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g></g>'),rf=he('<g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" fill="#f59e0b" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g>'),sf=he('<g class="measurement-line drawing"><line stroke="#f59e0b" stroke-width="0.15" stroke-dasharray="0.3,0.15" stroke-linecap="round" pointer-events="none"></line><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><!></g>'),of=he('<line stroke-width="0.05" pointer-events="none"></line>'),lf=he('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),cf=he('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),uf=he('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),df=he("<!><!><!><!><!><!><!><!><!><!><!><!>",1),mf=pe('<main class="svelte-hpuhtb"><div class="layout svelte-hpuhtb"><div class="sidebar svelte-hpuhtb"><!> <!> <!></div> <div class="main-content svelte-hpuhtb"><div class="battlefield-area svelte-hpuhtb"><div class="battlefield-container svelte-hpuhtb" role="presentation"><!></div> <div class="info svelte-hpuhtb"><p class="svelte-hpuhtb"> </p> <p class="hint svelte-hpuhtb">Drag to select | Ctrl+Click multi-select | Del remove | L LoS | M measure</p></div></div></div></div></main>');function hf(t,n){Vn(n,!1);const a=()=>Wt(Ri,"$loadedTerrain",p),s=()=>Wt(ct,"$models",p),r=()=>Wt(rr,"$selectedDeployment",p),i=()=>Wt(ma,"$selectedLayoutName",p),l=()=>Wt(wa,"$selectedLayoutType",p),c=()=>Wt(Au,"$coherencyStatus",p),d=()=>Wt(In,"$history",p),h=()=>Wt(gl,"$player1Models",p),y=()=>Wt(bl,"$player2Models",p),[p,m]=Cr(),f=W(),v=W(),A=W(),T=W(),E=W(),P=W(),M=W(),k=W(),D=W(),$=W(),B=W(),F=W(),G=W(),q=W(),ie=W(),ee=W();let fe=W(null),se=W(!1),ae=W(!1),De=W(!1),ve=W(null),be=W(null),te=W([]),Ae=W(new Set),ue=!1,le=!1,Xe=null,ge=!1,Pe=null,de=0,bt=null,ut=W([]),Yt=W(null),_t=W(!1),it=W(null),Tt=W(null),je=W(!1),Qt=W(!1),Ht=W(!1),zt=W(!1);Er(()=>{window.addEventListener("keydown",ot)}),Qo(()=>{window.removeEventListener("keydown",ot)});async function Ne(){const z=`battle-${new Date().toISOString().slice(0,10)}`;try{await Ii(a().terrains,a().walls,s(),z,r())}catch(Q){alert("Failed to export PNG"),console.error("Export error:",Q)}}const Ke="warhammer-battle-state";let ze=W();function xt(){const I={deployment:r()?.name||null,layout:i()||null,layoutType:l()||null,models:s()};localStorage.setItem(Ke,JSON.stringify(I))}function Z(){const I=localStorage.getItem(Ke);if(I)try{const z=JSON.parse(I);z.models&&Array.isArray(z.models)&&(ct.set(z.models),In.clear())}catch(z){console.error("Failed to restore battle state:",z)}}function Ie(){const I={version:1,exportedAt:new Date().toISOString(),deployment:r()?{name:r().name,zones:r().zones,objectives:r().objectives}:null,terrain:{layoutName:i(),layoutType:l(),terrains:a().terrains,walls:a().walls},models:s().map(Ye=>({id:Ye.id,baseType:Ye.baseType,playerId:Ye.playerId,x:Ye.x,y:Ye.y,rotation:Ye.rotation||0,name:Ye.name||"",customWidth:Ye.customWidth,customHeight:Ye.customHeight}))},z=JSON.stringify(I,null,2),Q=new Blob([z],{type:"application/json"}),Te=URL.createObjectURL(Q),xe=document.createElement("a");xe.href=Te;const et=new Date().toISOString().slice(0,10);xe.download=`battle-${et}.json`,document.body.appendChild(xe),xe.click(),document.body.removeChild(xe),URL.revokeObjectURL(Te)}function qe(){e(ze)?.click()}function Ct(I){const z=I.target.files?.[0];if(!z)return;const Q=new FileReader;Q.onload=Te=>{try{const xe=JSON.parse(Te.target.result);xe.models&&Array.isArray(xe.models)&&(ct.set(xe.models),In.clear())}catch(xe){console.error("Failed to parse import file:",xe),alert("Failed to import: Invalid JSON file")}},Q.readAsText(z),I.target.value=""}function pt(){confirm("Clear all models?")&&(ct.clear(),b(te,[]))}function ot(I){if(I.target.tagName==="INPUT")return;const z=e(te).length>0;if((I.ctrlKey||I.metaKey)&&I.key==="z"&&!I.shiftKey){I.preventDefault(),ct.undo();return}if((I.ctrlKey||I.metaKey)&&(I.key==="y"||I.shiftKey&&I.key==="z")){I.preventDefault(),ct.redo();return}if((I.ctrlKey||I.metaKey)&&I.key==="g"&&!I.shiftKey){I.preventDefault(),oe();return}if((I.ctrlKey||I.metaKey)&&I.shiftKey&&I.key==="G"){I.preventDefault(),Ue();return}if(I.key==="l"||I.key==="L"){I.preventDefault(),b(se,!e(se));return}if(I.key==="m"||I.key==="M"){I.preventDefault(),b(je,!e(je)),e(je)||(b(_t,!1),b(it,null),b(Tt,null));return}if(I.key==="Delete"||I.key==="Backspace"){if(I.preventDefault(),e(Yt)){b(ut,e(ut).filter(Q=>Q.id!==e(Yt))),b(Yt,null);return}e(te).length>0&&(e(te).forEach(Q=>{ct.remove(Q)}),b(te,[]));return}if(z&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(I.key)){I.preventDefault();const Q=I.shiftKey?.1:1;let Te=0,xe=0;switch(I.key){case"ArrowUp":xe=-Q;break;case"ArrowDown":xe=Q;break;case"ArrowLeft":Te=-Q;break;case"ArrowRight":Te=Q;break}e(te).forEach(et=>{const Ye=s().find(tt=>tt.id===et);Ye&&ct.updateModel(et,{x:Ye.x+Te,y:Ye.y+xe},!1)});return}if(I.key==="Escape"){$t();return}}function $t(I){if(ue){ue=!1;return}b(te,[]),b(Yt,null)}function Ft(){return"line-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Et(I,z,Q,Te){return Math.sqrt((Q-I)**2+(Te-z)**2)}function wt(I){if(!e(fe))return;I.preventDefault();const z=e(fe)(I.clientX,I.clientY);b(_t,!0),b(it,{x:z.x,y:z.y}),b(Tt,{x:z.x,y:z.y}),window.addEventListener("mousemove",It),window.addEventListener("mouseup",hn)}function It(I){if(!e(_t)||!e(fe))return;const z=e(fe)(I.clientX,I.clientY);b(Tt,{x:z.x,y:z.y})}function hn(I){if(!e(_t))return;if(Et(e(it).x,e(it).y,e(Tt).x,e(Tt).y)>.5){const Q={id:Ft(),x1:e(it).x,y1:e(it).y,x2:e(Tt).x,y2:e(Tt).y};b(ut,[...e(ut),Q]),b(Yt,Q.id),b(te,[])}b(_t,!1),b(it,null),b(Tt,null),window.removeEventListener("mousemove",It),window.removeEventListener("mouseup",hn)}function fn(I,z){z?.stopPropagation(),b(Yt,I),b(te,[])}let Ce=!1,Ee={x:0,y:0},Qe=null,Lt=null;function jt(I,z){if(!e(je)||!e(fe))return;z.stopPropagation(),z.preventDefault();const Q=e(ut).find(Ye=>Ye.id===I);if(!Q)return;Ce=!0,Qe=I,Lt=null,b(Yt,I),b(te,[]);const Te=e(fe)(z.clientX,z.clientY),xe=(Q.x1+Q.x2)/2,et=(Q.y1+Q.y2)/2;Ee={x:Te.x-xe,y:Te.y-et},window.addEventListener("mousemove",Bt),window.addEventListener("mouseup",yn)}function pn(I,z,Q){!e(je)||!e(fe)||(Q.stopPropagation(),Q.preventDefault(),Ce=!0,Qe=I,Lt=z,b(Yt,I),b(te,[]),window.addEventListener("mousemove",Bt),window.addEventListener("mouseup",yn))}function Bt(I){if(!Ce||!e(fe)||!Qe)return;const z=e(fe)(I.clientX,I.clientY);b(ut,e(ut).map(Q=>{if(Q.id!==Qe)return Q;if(Lt===1)return{...Q,x1:z.x,y1:z.y};if(Lt===2)return{...Q,x2:z.x,y2:z.y};{const Te=z.x-Ee.x,xe=z.y-Ee.y,et=(Q.x1+Q.x2)/2,Ye=(Q.y1+Q.y2)/2,tt=Te-et,lt=xe-Ye;return{...Q,x1:Q.x1+tt,y1:Q.y1+lt,x2:Q.x2+tt,y2:Q.y2+lt}}}))}function yn(){Ce=!1,Qe=null,Lt=null,window.removeEventListener("mousemove",Bt),window.removeEventListener("mouseup",yn)}function fa(){b(ut,[]),b(Yt,null)}function Za(I){const z=I.target,Q=z.closest(".model-base"),Te=z.closest(".measurement-line");if(Q||Te||!e(fe))return;if(I.preventDefault(),e(je)){wt(I);return}const xe=e(fe)(I.clientX,I.clientY);b(ve,{x:xe.x,y:xe.y}),b(be,{x:xe.x,y:xe.y}),b(De,!0),window.addEventListener("mousemove",Pn),window.addEventListener("mouseup",Rn)}function Pn(I){if(!e(De)||!e(fe))return;const z=e(fe)(I.clientX,I.clientY);b(be,{x:z.x,y:z.y});const Q=Math.min(e(ve).x,e(be).x),Te=Math.max(e(ve).x,e(be).x),xe=Math.min(e(ve).y,e(be).y),et=Math.max(e(ve).y,e(be).y),Ye=new Set;s().forEach(tt=>{tt.x>=Q&&tt.x<=Te&&tt.y>=xe&&tt.y<=et&&Ye.add(tt.id)}),b(Ae,Ye)}function Rn(I){if(!e(De))return;const z=Math.min(e(ve).x,e(be).x),Q=Math.max(e(ve).x,e(be).x),Te=Math.min(e(ve).y,e(be).y),xe=Math.max(e(ve).y,e(be).y),et=Q-z,Ye=xe-Te;if(et<.5&&Ye<.5)b(te,[]);else{const tt=[];s().forEach(lt=>{lt.x>=z&&lt.x<=Q&&lt.y>=Te&&lt.y<=xe&&tt.push(lt.id)}),b(te,tt),ue=!0}b(De,!1),b(ve,null),b(be,null),e(Ae).clear(),b(Ae,e(Ae)),window.removeEventListener("mousemove",Pn),window.removeEventListener("mouseup",Rn)}function Hn(I,z){if(z&&(z.ctrlKey||z.metaKey||z.shiftKey))e(te).includes(I)?b(te,e(te).filter(Q=>Q!==I)):b(te,[...e(te),I]);else{if(e(te).includes(I))return;{const Q=s().find(Te=>Te.id===I);if(Q&&Q.unitId){const Te=s().filter(xe=>xe.unitId===Q.unitId).map(xe=>xe.id);b(te,Te)}else b(te,[I])}}}function qn(I,z,Q){if(e(te).length>1&&e(te).includes(I)){le||(le=!0,Xe={},e(te).forEach(xe=>{const et=s().find(Ye=>Ye.id===xe);et&&(Xe[xe]={x:et.x,y:et.y})}));const Te=Xe[I];if(Te){const xe=z-Te.x,et=Q-Te.y;e(te).forEach(Ye=>{const tt=Xe[Ye];tt&&ct.updateModel(Ye,{x:tt.x+xe,y:tt.y+et},!0)})}}else ct.updateModel(I,{x:z,y:Q},!0)}function Nn(I,z,Q,Te,xe){le?(e(te).forEach(et=>{const Ye=Xe[et],tt=s().find(lt=>lt.id===et);Ye&&tt&&In.push({type:"move",modelId:et,before:{x:Ye.x,y:Ye.y},after:{x:tt.x,y:tt.y}})}),le=!1,Xe=null):In.push({type:"move",modelId:I,before:{x:z,y:Q},after:{x:Te,y:xe}})}function pa(I,z){if(e(te).length>1&&e(te).includes(I)){if(!ge){ge=!0;let et=0,Ye=0,tt=0;const lt={};e(te).forEach(Jt=>{const an=s().find(ln=>ln.id===Jt);an&&(et+=an.x,Ye+=an.y,tt++,lt[Jt]={x:an.x,y:an.y,rotation:an.rotation||0})}),Pe={x:et/tt,y:Ye/tt},Xe=lt}const Q=s().find(et=>et.id===I),Te=Xe[I];if(!Q||!Te)return;const xe=z-Te.rotation;e(te).forEach(et=>{const Ye=Xe[et];if(Ye){const tt=Ye.x-Pe.x,lt=Ye.y-Pe.y,Jt=xe*Math.PI/180,an=Math.cos(Jt),ln=Math.sin(Jt),bn=tt*an-lt*ln,On=tt*ln+lt*an;ct.updateModel(et,{x:Pe.x+bn,y:Pe.y+On,rotation:Ye.rotation+xe},!0)}})}else ct.updateModel(I,{rotation:z},!0)}function Jn(I,z,Q){ge?(e(te).forEach(Te=>{const xe=Xe[Te],et=s().find(Ye=>Ye.id===Te);xe&&et&&In.push({type:"rotate",modelId:Te,before:{x:xe.x,y:xe.y,rotation:xe.rotation},after:{x:et.x,y:et.y,rotation:et.rotation||0}})}),ge=!1,Pe=null,Xe=null):In.push({type:"rotate",modelId:I,before:{rotation:z},after:{rotation:Q}})}function ya(I,z){ct.updateModel(I,{name:z})}function oe(){if(e(te).length<2)return;const I=e(te).map(Q=>s().find(Te=>Te.id===Q)).filter(Boolean);if([...new Set(I.map(Q=>Q.playerId))].length>1){alert("Cannot group models from different players");return}ct.groupModels(e(te))}function Ue(){if(e(te).length===0)return;const I=e(te).filter(z=>{const Q=s().find(Te=>Te.id===z);return Q&&Q.unitId});I.length>0&&ct.ungroupModels(I)}function kt(I){if(!e(fe)||e(f).length<2)return;I.preventDefault(),I.stopPropagation(),ge=!0,bt={},e(f).forEach(Q=>{bt[Q.id]={x:Q.x,y:Q.y,rotation:Q.rotation||0}});const z=e(fe)(I.clientX,I.clientY);de=Math.atan2(z.y-e(M).y,z.x-e(M).x)*180/Math.PI,window.addEventListener("mousemove",At),window.addEventListener("mouseup",Se)}function At(I){if(!ge||!e(fe)||!e(M))return;const z=e(fe)(I.clientX,I.clientY);let Te=Math.atan2(z.y-e(M).y,z.x-e(M).x)*180/Math.PI-de;I.shiftKey||(Te=Math.round(Te/15)*15),b(R,-45+Te);const xe=Te*Math.PI/180,et=Math.cos(xe),Ye=Math.sin(xe);e(f).forEach(tt=>{const lt=bt[tt.id];if(lt){const Jt=lt.x-e(M).x,an=lt.y-e(M).y,ln=Jt*et-an*Ye,bn=Jt*Ye+an*et;ct.updateModel(tt.id,{x:e(M).x+ln,y:e(M).y+bn,rotation:lt.rotation+Te},!0)}})}function Se(){ge&&bt&&e(f).forEach(I=>{const z=bt[I.id];z&&In.push({type:"rotate",modelId:I.id,before:{x:z.x,y:z.y,rotation:z.rotation},after:{x:I.x,y:I.y,rotation:I.rotation||0}})}),ge=!1,bt=null,b(R,-45),window.removeEventListener("mousemove",At),window.removeEventListener("mouseup",Se)}function at(){e(te).length>0&&(e(te).forEach(I=>{ct.remove(I)}),b(te,[]))}function Ze(I){if(zn(I.baseType))return{x:I.x,y:I.y,width:I.customWidth,height:I.customHeight,rotation:I.rotation||0,isRectangle:!0};const z=Sn(I.baseType,I);return vn(I.baseType)?{x:I.x,y:I.y,rx:z.width/2,ry:z.height/2,rotation:I.rotation||0}:{x:I.x,y:I.y,radius:z.radius}}const $e=["#f97316","#f59e0b","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e","#fb7185","#fdba74","#fcd34d"];function He(I){if(!I)return null;let z=0;for(let Te=0;Te<I.length;Te++)z=(z<<5)-z+I.charCodeAt(Te),z=z&z;const Q=Math.abs(z)%$e.length;return $e[Q]}let R=W(-45);me(()=>(e(te),s()),()=>{b(f,e(te).map(I=>s().find(z=>z.id===I)).filter(Boolean))}),me(()=>e(f),()=>{b(v,e(f).length===1?e(f)[0]:null)}),me(()=>e(f),()=>{b(A,e(f).length<2?!1:[...new Set(e(f).map(z=>z.playerId))].length===1)}),me(()=>e(f),()=>{b(T,e(f).some(I=>I.unitId))}),me(()=>(e(f),c()),()=>{b(E,e(f).filter(I=>{const z=c().get(I.id);return z&&!z.inCoherency}))}),me(()=>e(E),()=>{b(P,e(E).length>0)}),me(()=>e(f),()=>{b(M,e(f).length>1?(()=>{let I=0,z=0;return e(f).forEach(Q=>{I+=Q.x,z+=Q.y}),{x:I/e(f).length,y:z/e(f).length}})():null)}),me(()=>(e(f),e(M),vn),()=>{b(k,e(f).length>1?(()=>{let I=0;return e(f).forEach(z=>{const Q=Math.sqrt(Math.pow(z.x-e(M).x,2)+Math.pow(z.y-e(M).y,2)),Te=Sn(z.baseType,z),xe=zn(z.baseType)?Math.max(z.customWidth,z.customHeight)/2:vn(z.baseType)?Math.max(Te.width,Te.height)/2:Te.radius;I=Math.max(I,Q+xe)}),I+2})():0)}),me(()=>(e(M),e(k),e(R)),()=>{b(D,e(M)?e(M).x+e(k)*Math.cos(e(R)*Math.PI/180):0)}),me(()=>(e(M),e(k),e(R)),()=>{b($,e(M)?e(M).y+e(k)*Math.sin(e(R)*Math.PI/180):0)}),me(()=>(e(Yt),e(ut)),()=>{b(B,e(Yt)?e(ut).find(I=>I.id===e(Yt)):null)}),me(()=>e(f),()=>{b(F,[...new Set(e(f).map(I=>I.playerId))])}),me(()=>(e(f),s(),e(F)),()=>{b(G,e(f).length>0?s().filter(I=>!e(F).includes(I.playerId)):[])}),me(()=>(a(),Sr),()=>{b(q,a().terrains.map(I=>({id:I.id,vertices:Sr(I)})))}),me(()=>(a(),Ca),()=>{b(ie,a().walls.map(I=>ws(Ca(I.shape,I.segments),I.x,I.y,I.rotation)))}),me(()=>(e(f),e(se),e(G),e(q),e(ie)),()=>{b(ee,e(f).length>0&&e(se)&&e(G).length>0?(()=>{const I=new Map;e(f).forEach(Te=>{const xe=Te.unitId||`single-${Te.id}`;I.has(xe)||I.set(xe,[]),I.get(xe).push(Te)});const z=new Map;e(G).forEach(Te=>{const xe=Te.unitId||`single-${Te.id}`;z.has(xe)||z.set(xe,[]),z.get(xe).push(Te)});const Q=[];for(const Te of I.values())for(const xe of z.values()){const et=xe.map(lt=>Ze(lt)),Ye=Te.map(lt=>Ze(lt)),tt=rl(et,Ye,e(q),e(ie));tt.canSee?xe.forEach(lt=>{Te.forEach(Jt=>{Q.push({sourceId:lt.id,source:lt,targetId:Jt.id,target:Jt,canSee:!0,firstClearRay:tt.firstClearResult?.firstClearRay,rays:tt.firstClearResult?.rays||[]})})}):xe.forEach(lt=>{Te.forEach(Jt=>{Q.push({sourceId:lt.id,source:lt,targetId:Jt.id,target:Jt,canSee:!1,firstClearRay:null,rays:[]})})})}return Q})():[])}),$a(),ia();var nt=mf(),Mt=x(nt),yt=x(Mt),dt=x(yt);kn(dt,{title:"Selected Model",children:(I,z)=>{var Q=Ge(),Te=ce(Q);{var xe=Ye=>{var tt=kh(),lt=x(tt),Jt=g(x(lt),2),an=x(Jt),ln=g(lt,2),bn=x(ln),On=x(bn),ea=g(ln,2);{var Un=_=>{var V=gh(),J=ce(V),C=x(J),K=x(C),Me=g(J,2);{var We=_e=>{var Fe=vh(),rt=g(x(Fe),2),Kt=x(rt);U(vt=>Le(Kt,`${vt??""}/${e(ee),o(()=>e(ee).length)??""} visible`),[()=>(e(ee),o(()=>e(ee).filter(vt=>vt.canSee).length))]),w(_e,Fe)};j(Me,_e=>{e(ee),o(()=>e(ee).length>0)&&_e(We)})}En(K,()=>e(ae),_e=>b(ae,_e)),w(_,V)};j(ea,_=>{e(se)&&_(Un)})}var ga=g(ea,2);{var Na=_=>{const V=Re(()=>(e(E),c(),o(()=>e(E).filter(We=>c().get(We.id)?.isDisconnected).length)));var J=xh(),C=g(x(J),2);{var K=We=>{var _e=bh();w(We,_e)},Me=We=>{var _e=Th(),Fe=x(_e);U(()=>Le(Fe,`${e(E),o(()=>e(E).length)??""} model${e(E),o(()=>e(E).length!==1?"s":"")??""} out of coherency`)),w(We,_e)};j(C,We=>{e(V)>0?We(K):We(Me,!1)})}w(_,J)},ba=_=>{var V=Ge(),J=ce(V);{var C=K=>{var Me=_h();w(K,Me)};j(J,K=>{e(f),o(()=>e(f).some(Me=>Me.unitId))&&K(C)},!0)}w(_,V)};j(ga,_=>{e(P)?_(Na):_(ba,!1)})}var rn=g(ga,2);{var Wn=_=>{var V=wh();ne("click",V,oe),w(_,V)};j(rn,_=>{e(A)&&_(Wn)})}var S=g(rn,2);{var O=_=>{var V=Sh();ne("click",V,Ue),w(_,V)};j(S,_=>{e(T)&&_(O)})}var H=g(S,2),Y=x(H);U(()=>{Le(an,`${e(te),o(()=>e(te).length)??""} models`),Le(Y,`Remove All (${e(te),o(()=>e(te).length)??""})`)}),En(On,()=>e(se),_=>b(se,_)),ne("click",H,at),w(Ye,tt)},et=Ye=>{var tt=Ge(),lt=ce(tt);{var Jt=ln=>{var bn=Lh(),On=x(bn),ea=g(x(On),2),Un=g(On,2),ga=g(x(Un),2),Na=x(ga),ba=g(Un,2),rn=g(x(ba),2),Wn=x(rn),S=g(ba,2),O=g(x(S),2),H=x(O),Y=g(S,2);{var _=vt=>{var Rt=Ah(),Pt=g(x(Rt),2),mn=x(Pt);U(mt=>Le(mn,`${mt??""}°`),[()=>(e(v),o(()=>Math.round(e(v).rotation||0)))]),w(vt,Rt)};j(Y,vt=>{L(vn),e(v),o(()=>vn(e(v).baseType))&&vt(_)})}var V=g(Y,2);{var J=vt=>{const Rt=Re(()=>(c(),e(v),o(()=>c().get(e(v).id))));var Pt=Rh();let mn;var mt=g(x(Pt),2);{var qt=Nt=>{var on=Ge(),Tn=ce(on);{var Gt=Dt=>{var Be=Ch();w(Dt,Be)},en=Dt=>{var Be=Eh(),X=x(Be);U(()=>Le(X,`Need ${L(e(Rt)),o(()=>e(Rt).requiredCount)??""} nearby, have ${L(e(Rt)),o(()=>e(Rt).actualCount)??""}`)),w(Dt,Be)};j(Tn,Dt=>{L(e(Rt)),o(()=>e(Rt).isDisconnected)?Dt(Gt):Dt(en,!1)})}w(Nt,on)},sn=Nt=>{var on=Mh();w(Nt,on)};j(mt,Nt=>{L(e(Rt)),o(()=>e(Rt)&&!e(Rt).inCoherency)?Nt(qt):Nt(sn,!1)})}U(()=>mn=Mn(Pt,1,"field svelte-hpuhtb",null,mn,{"coherency-warning":e(Rt)&&!e(Rt).inCoherency})),w(vt,Pt)};j(V,vt=>{e(v),o(()=>e(v).unitId)&&vt(J)})}var C=g(V,2),K=x(C),Me=x(K),We=g(C,2);{var _e=vt=>{var Rt=Dh(),Pt=x(Rt),mn=x(Pt);En(mn,()=>e(ae),mt=>b(ae,mt)),w(vt,Rt)};j(We,vt=>{e(se)&&vt(_e)})}var Fe=g(We,2);{var rt=vt=>{var Rt=Ih(),Pt=g(x(Rt),2),mn=x(Pt);U(mt=>Le(mn,`${mt??""}/${e(ee),o(()=>e(ee).length)??""} visible`),[()=>(e(ee),o(()=>e(ee).filter(mt=>mt.canSee).length))]),w(vt,Rt)};j(Fe,vt=>{e(se),e(ee),o(()=>e(se)&&e(ee).length>0)&&vt(rt)})}var Kt=g(Fe,2);U((vt,Rt,Pt)=>{Ha(ea,(e(v),o(()=>e(v).name||""))),Le(Na,vt),Le(Wn,`Player ${e(v),o(()=>e(v).playerId)??""}`),Le(H,`${Rt??""}", ${Pt??""}"`)},[()=>(L(Sn),e(v),o(()=>Sn(e(v).baseType,e(v))?.label||"Unknown")),()=>(e(v),o(()=>e(v).x.toFixed(1))),()=>(e(v),o(()=>e(v).y.toFixed(1)))]),ne("change",ea,vt=>ya(e(v).id,vt.target.value)),En(Me,()=>e(se),vt=>b(se,vt)),ne("click",Kt,at),w(ln,bn)},an=ln=>{var bn=$h();w(ln,bn)};j(lt,ln=>{e(v)?ln(Jt):ln(an,!1)},!0)}w(Ye,tt)};j(Te,Ye=>{e(te),o(()=>e(te).length>1)?Ye(xe):Ye(et,!1)})}w(I,Q)},$$slots:{default:!0}});var dn=g(dt,2);kn(dn,{title:"Measure Tool",children:(I,z)=>{var Q=Wh(),Te=x(Q),xe=x(Te),et=x(xe),Ye=g(Te,2);{var tt=rn=>{var Wn=Ph();w(rn,Wn)};j(Ye,rn=>{e(je)&&rn(tt)})}var lt=g(Ye,2);{var Jt=rn=>{var Wn=Nh(),S=ce(Wn),O=g(x(S),2),H=x(O),Y=g(S,2);U(_=>Le(H,`${_??""}"`),[()=>(e(B),o(()=>Et(e(B).x1,e(B).y1,e(B).x2,e(B).y2).toFixed(2)))]),ne("click",Y,()=>{b(ut,e(ut).filter(_=>_.id!==e(Yt))),b(Yt,null)}),w(rn,Wn)};j(lt,rn=>{e(B)&&rn(Jt)})}var an=g(lt,2);{var ln=rn=>{var Wn=Oh(),S=ce(Wn),O=g(x(S),2),H=x(O),Y=g(S,2);U(()=>Le(H,`${e(ut),o(()=>e(ut).length)??""} line${e(ut),o(()=>e(ut).length!==1?"s":"")??""}`)),ne("click",Y,fa),w(rn,Wn)};j(an,rn=>{e(ut),o(()=>e(ut).length>0)&&rn(ln)})}var bn=g(an,2),On=g(x(bn),2),ea=x(On),Un=g(On,2),ga=x(Un),Na=g(Un,2),ba=x(Na);En(et,()=>e(je),rn=>b(je,rn)),En(ea,()=>e(Qt),rn=>b(Qt,rn)),En(ga,()=>e(Ht),rn=>b(Ht,rn)),En(ba,()=>e(zt),rn=>b(zt,rn)),w(I,Q)},$$slots:{default:!0}});var Rr=g(dn,2);kn(Rr,{title:"Actions",children:(I,z)=>{var Q=Yh(),Te=x(Q),xe=x(Te),et=g(xe,2),Ye=g(Te,2),tt=x(Ye),lt=g(tt,2),Jt=g(Ye,2);wr(Jt,ea=>b(ze,ea),()=>e(ze));var an=g(Jt,2),ln=g(an,2),bn=g(ln,2),On=g(bn,2);U(()=>{xe.disabled=(d(),o(()=>!d().past.length)),et.disabled=(d(),o(()=>!d().future.length))}),ne("click",xe,()=>ct.undo()),ne("click",et,()=>ct.redo()),ne("click",tt,Ie),ne("click",lt,qe),ne("change",Jt,Ct),ne("click",an,Ne),ne("click",ln,xt),ne("click",bn,Z),ne("click",On,pt),w(I,Q)},$$slots:{default:!0}});var Dr=g(yt,2),es=x(Dr),Zn=x(es),va=x(Zn);Ss(va,{children:co,$$slots:{default:(I,z)=>{const Q=Re(()=>z.screenToSvg);var Te=df(),xe=ce(Te);{var et=Y=>{var _=Xo();U(()=>Le(_,(e(fe),L(e(Q)),o(()=>(b(fe,e(Q)),""))))),w(Y,_)};j(xe,Y=>{e(Q)&&!e(fe)&&Y(et)})}var Ye=g(xe);{var tt=Y=>{var _=Bh(),V=ce(_);Ve(V,1,()=>(r(),o(()=>r().zones)),ft,(C,K)=>{var Me=Hh();U(We=>{u(Me,"d",We),u(Me,"stroke",(e(K),o(()=>e(K).borderColor)))},[()=>(L(kr),e(K),o(()=>kr(e(K).path)))]),w(C,Me)});var J=g(V);Ve(J,1,()=>(r(),o(()=>r().objectives)),ft,(C,K)=>{const Me=Re(()=>(e(K),o(()=>e(K).isPrimary?"#fbbf24":"#9ca3af"))),We=Re(()=>(e(K),o(()=>e(K).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var _e=Fh(),Fe=ce(_e),rt=g(Fe),Kt=g(rt);U(()=>{u(Fe,"cx",(e(K),o(()=>e(K).x))),u(Fe,"cy",(e(K),o(()=>e(K).y))),u(Fe,"r",Qs),u(Fe,"fill",e(We)),u(Fe,"stroke",e(Me)),u(rt,"cx",(e(K),o(()=>e(K).x))),u(rt,"cy",(e(K),o(()=>e(K).y))),u(rt,"r",Zs),u(rt,"fill",e(Me)),u(Kt,"cx",(e(K),o(()=>e(K).x))),u(Kt,"cy",(e(K),o(()=>e(K).y)))}),w(C,_e)}),w(Y,_)};j(Ye,Y=>{r()&&Y(tt)})}var lt=g(Ye);Ve(lt,1,()=>(a(),o(()=>a().terrains)),ft,(Y,_)=>{var V=qh(),J=x(V);U(()=>{u(V,"transform",`rotate(${e(_),o(()=>e(_).rotation)??""}, ${e(_),o(()=>e(_).x+e(_).width/2)??""}, ${e(_),o(()=>e(_).y+e(_).height/2)??""})`),u(J,"x",(e(_),o(()=>e(_).x))),u(J,"y",(e(_),o(()=>e(_).y))),u(J,"width",(e(_),o(()=>e(_).width))),u(J,"height",(e(_),o(()=>e(_).height)))}),w(Y,V)});var Jt=g(lt);Ve(Jt,1,()=>(a(),o(()=>a().walls)),ft,(Y,_)=>{var V=Uh(),J=x(V);Mi(J,{get id(){return e(_),o(()=>e(_).id)},get x(){return e(_),o(()=>e(_).x)},get y(){return e(_),o(()=>e(_).y)},get shape(){return e(_),o(()=>e(_).shape)},get segments(){return e(_),o(()=>e(_).segments)},get rotation(){return e(_),o(()=>e(_).rotation)},selected:!1,get screenToSvg(){return e(Q)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),w(Y,V)});var an=g(Jt);{var ln=Y=>{var _=Ge(),V=ce(_);Ve(V,1,s,J=>J.id,(J,C)=>{const K=Re(()=>(L(Sn),e(C),o(()=>Sn(e(C).baseType,e(C))))),Me=Re(()=>(L(vn),e(C),o(()=>vn(e(C).baseType)))),We=Re(()=>(L(zn),e(C),o(()=>zn(e(C).baseType)))),_e=Re(()=>(e(C),o(()=>e(C).playerId===1?"rgba(59, 130, 246, 0.15)":"rgba(239, 68, 68, 0.15)"))),Fe=Re(()=>(e(C),o(()=>e(C).playerId===1?"#3b82f6":"#ef4444")));var rt=ef(),Kt=ce(rt);{var vt=qt=>{var sn=Ge(),Nt=ce(sn);{var on=Gt=>{var en=Kh(),Dt=x(en);U(()=>{u(en,"transform",`rotate(${e(C),o(()=>e(C).rotation||0)??""}, ${e(C),o(()=>e(C).x)??""}, ${e(C),o(()=>e(C).y)??""})`),u(Dt,"x",(e(C),o(()=>e(C).x-e(C).customWidth/2-12))),u(Dt,"y",(e(C),o(()=>e(C).y-e(C).customHeight/2-12))),u(Dt,"width",(e(C),o(()=>e(C).customWidth+24))),u(Dt,"height",(e(C),o(()=>e(C).customHeight+24))),u(Dt,"fill",e(_e)),u(Dt,"stroke",e(Fe))}),w(Gt,en)},Tn=Gt=>{var en=Ge(),Dt=ce(en);{var Be=Je=>{var Oe=Gh(),N=x(Oe);U(()=>{u(Oe,"transform",`rotate(${e(C),o(()=>e(C).rotation||0)??""}, ${e(C),o(()=>e(C).x)??""}, ${e(C),o(()=>e(C).y)??""})`),u(N,"cx",(e(C),o(()=>e(C).x))),u(N,"cy",(e(C),o(()=>e(C).y))),u(N,"rx",(L(e(K)),o(()=>e(K).width/2+12))),u(N,"ry",(L(e(K)),o(()=>e(K).height/2+12))),u(N,"fill",e(_e)),u(N,"stroke",e(Fe))}),w(Je,Oe)},X=Je=>{var Oe=zh();U(()=>{u(Oe,"cx",(e(C),o(()=>e(C).x))),u(Oe,"cy",(e(C),o(()=>e(C).y))),u(Oe,"r",(L(e(K)),o(()=>e(K).radius+12))),u(Oe,"fill",e(_e)),u(Oe,"stroke",e(Fe))}),w(Je,Oe)};j(Dt,Je=>{e(Me)?Je(Be):Je(X,!1)},!0)}w(Gt,en)};j(Nt,Gt=>{e(We)?Gt(on):Gt(Tn,!1)})}w(qt,sn)};j(Kt,qt=>{e(zt)&&qt(vt)})}var Rt=g(Kt);{var Pt=qt=>{var sn=Ge(),Nt=ce(sn);{var on=Gt=>{var en=Xh(),Dt=x(en);U(()=>{u(en,"transform",`rotate(${e(C),o(()=>e(C).rotation||0)??""}, ${e(C),o(()=>e(C).x)??""}, ${e(C),o(()=>e(C).y)??""})`),u(Dt,"x",(e(C),o(()=>e(C).x-e(C).customWidth/2-9))),u(Dt,"y",(e(C),o(()=>e(C).y-e(C).customHeight/2-9))),u(Dt,"width",(e(C),o(()=>e(C).customWidth+18))),u(Dt,"height",(e(C),o(()=>e(C).customHeight+18))),u(Dt,"fill",e(_e)),u(Dt,"stroke",e(Fe))}),w(Gt,en)},Tn=Gt=>{var en=Ge(),Dt=ce(en);{var Be=Je=>{var Oe=Vh(),N=x(Oe);U(()=>{u(Oe,"transform",`rotate(${e(C),o(()=>e(C).rotation||0)??""}, ${e(C),o(()=>e(C).x)??""}, ${e(C),o(()=>e(C).y)??""})`),u(N,"cx",(e(C),o(()=>e(C).x))),u(N,"cy",(e(C),o(()=>e(C).y))),u(N,"rx",(L(e(K)),o(()=>e(K).width/2+9))),u(N,"ry",(L(e(K)),o(()=>e(K).height/2+9))),u(N,"fill",e(_e)),u(N,"stroke",e(Fe))}),w(Je,Oe)},X=Je=>{var Oe=jh();U(()=>{u(Oe,"cx",(e(C),o(()=>e(C).x))),u(Oe,"cy",(e(C),o(()=>e(C).y))),u(Oe,"r",(L(e(K)),o(()=>e(K).radius+9))),u(Oe,"fill",e(_e)),u(Oe,"stroke",e(Fe))}),w(Je,Oe)};j(Dt,Je=>{e(Me)?Je(Be):Je(X,!1)},!0)}w(Gt,en)};j(Nt,Gt=>{e(We)?Gt(on):Gt(Tn,!1)})}w(qt,sn)};j(Rt,qt=>{e(Ht)&&qt(Pt)})}var mn=g(Rt);{var mt=qt=>{var sn=Ge(),Nt=ce(sn);{var on=Gt=>{var en=Jh(),Dt=x(en);U(()=>{u(en,"transform",`rotate(${e(C),o(()=>e(C).rotation||0)??""}, ${e(C),o(()=>e(C).x)??""}, ${e(C),o(()=>e(C).y)??""})`),u(Dt,"x",(e(C),o(()=>e(C).x-e(C).customWidth/2-6))),u(Dt,"y",(e(C),o(()=>e(C).y-e(C).customHeight/2-6))),u(Dt,"width",(e(C),o(()=>e(C).customWidth+12))),u(Dt,"height",(e(C),o(()=>e(C).customHeight+12))),u(Dt,"stroke",e(Fe))}),w(Gt,en)},Tn=Gt=>{var en=Ge(),Dt=ce(en);{var Be=Je=>{var Oe=Zh(),N=x(Oe);U(()=>{u(Oe,"transform",`rotate(${e(C),o(()=>e(C).rotation||0)??""}, ${e(C),o(()=>e(C).x)??""}, ${e(C),o(()=>e(C).y)??""})`),u(N,"cx",(e(C),o(()=>e(C).x))),u(N,"cy",(e(C),o(()=>e(C).y))),u(N,"rx",(L(e(K)),o(()=>e(K).width/2+6))),u(N,"ry",(L(e(K)),o(()=>e(K).height/2+6))),u(N,"stroke",e(Fe))}),w(Je,Oe)},X=Je=>{var Oe=Qh();U(()=>{u(Oe,"cx",(e(C),o(()=>e(C).x))),u(Oe,"cy",(e(C),o(()=>e(C).y))),u(Oe,"r",(L(e(K)),o(()=>e(K).radius+6))),u(Oe,"stroke",e(Fe))}),w(Je,Oe)};j(Dt,Je=>{e(Me)?Je(Be):Je(X,!1)},!0)}w(Gt,en)};j(Nt,Gt=>{e(We)?Gt(on):Gt(Tn,!1)})}w(qt,sn)};j(mn,qt=>{e(Qt)&&qt(mt)})}w(J,rt)}),w(Y,_)};j(an,Y=>{(e(Qt)||e(Ht)||e(zt))&&Y(ln)})}var bn=g(an);Ve(bn,1,s,Y=>Y.id,(Y,_)=>{const V=Re(()=>(c(),e(_),o(()=>c().get(e(_).id))));{let J=Re(()=>(e(_),o(()=>e(_).name||""))),C=Re(()=>(e(_),o(()=>He(e(_).unitId)))),K=Re(()=>(L(e(V)),o(()=>e(V)?!e(V).inCoherency:!1))),Me=Re(()=>(e(te),e(_),o(()=>e(te).includes(e(_).id)))),We=Re(()=>(e(te),e(_),o(()=>e(te).length>1&&e(te).includes(e(_).id)))),_e=Re(()=>(e(te),e(_),e(Ae),o(()=>!e(te).includes(e(_).id)&&e(Ae).has(e(_).id))));Ks(Y,{get id(){return e(_),o(()=>e(_).id)},get x(){return e(_),o(()=>e(_).x)},get y(){return e(_),o(()=>e(_).y)},get baseType(){return e(_),o(()=>e(_).baseType)},get playerId(){return e(_),o(()=>e(_).playerId)},get rotation(){return e(_),o(()=>e(_).rotation)},get name(){return e(J)},get customWidth(){return e(_),o(()=>e(_).customWidth)},get customHeight(){return e(_),o(()=>e(_).customHeight)},get unitStrokeColor(){return e(C)},get coherencyViolation(){return e(K)},get selected(){return e(Me)},get inGroupSelection(){return e(We)},get marqueePreview(){return e(_e)},get screenToSvg(){return e(Q)},onSelect:Hn,onDrag:qn,onDragEnd:Nn,onRotate:pa,onRotateEnd:Jn,onRename:ya})}});var On=g(bn);{var ea=Y=>{var _=tf(),V=ce(_),J=g(V),C=g(J),K=g(C);U(()=>{u(V,"cx",(e(M),o(()=>e(M).x))),u(V,"cy",(e(M),o(()=>e(M).y))),u(J,"x1",(e(M),o(()=>e(M).x))),u(J,"y1",(e(M),o(()=>e(M).y))),u(J,"x2",e(D)),u(J,"y2",e($)),u(C,"cx",e(D)),u(C,"cy",e($)),u(K,"transform",`translate(${e(D)??""}, ${e($)??""})`)}),ne("mousedown",C,kt),w(Y,_)};j(On,Y=>{e(M),e(f),o(()=>e(M)&&e(f).length>1)&&Y(ea)})}var Un=g(On);Ve(Un,1,()=>e(ut),Y=>Y.id,(Y,_)=>{const V=Re(()=>(e(_),o(()=>Et(e(_).x1,e(_).y1,e(_).x2,e(_).y2)))),J=Re(()=>(e(_),o(()=>(e(_).x1+e(_).x2)/2))),C=Re(()=>(e(_),o(()=>(e(_).y1+e(_).y2)/2))),K=Re(()=>(e(_),e(Yt),o(()=>e(_).id===e(Yt))));var Me=af();let We;var _e=x(Me),Fe=g(_e);{var rt=Pt=>{var mn=nf(),mt=ce(mn),qt=g(mt);U(()=>{u(mt,"cx",(e(_),o(()=>e(_).x1))),u(mt,"cy",(e(_),o(()=>e(_).y1))),u(mt,"fill",e(K)?"#3b82f6":"#f59e0b"),u(qt,"cx",(e(_),o(()=>e(_).x2))),u(qt,"cy",(e(_),o(()=>e(_).y2))),u(qt,"fill",e(K)?"#3b82f6":"#f59e0b")}),ne("mousedown",mt,sn=>pn(e(_).id,1,sn)),ne("mousedown",qt,sn=>pn(e(_).id,2,sn)),w(Pt,mn)};j(Fe,Pt=>{e(je)&&Pt(rt)})}var Kt=g(Fe),vt=g(x(Kt)),Rt=x(vt);U(Pt=>{We=Mn(Me,0,"measurement-line",null,We,{selected:e(K),"tool-active":e(je)}),u(_e,"x1",(e(_),o(()=>e(_).x1))),u(_e,"y1",(e(_),o(()=>e(_).y1))),u(_e,"x2",(e(_),o(()=>e(_).x2))),u(_e,"y2",(e(_),o(()=>e(_).y2))),u(_e,"stroke",e(K)&&e(je)?"#3b82f6":"#f59e0b"),u(_e,"stroke-width",e(K)&&e(je)?.2:.15),u(_e,"role",e(je)?"button":"presentation"),u(_e,"tabindex",e(je)?0:-1),u(Kt,"transform",`translate(${e(J)??""}, ${e(C)??""})`),u(vt,"fill",e(K)&&e(je)?"#3b82f6":"#f59e0b"),Le(Rt,`${Pt??""}"`)},[()=>(L(e(V)),o(()=>e(V).toFixed(1)))]),ne("click",_e,Pt=>e(je)&&fn(e(_).id,Pt)),ne("mousedown",_e,Pt=>e(je)?jt(e(_).id,Pt):Pt.stopPropagation()),w(Y,Me)});var ga=g(Un);{var Na=Y=>{const _=Re(()=>(e(it),e(Tt),o(()=>Et(e(it).x,e(it).y,e(Tt).x,e(Tt).y)))),V=Re(()=>(e(it),e(Tt),o(()=>(e(it).x+e(Tt).x)/2))),J=Re(()=>(e(it),e(Tt),o(()=>(e(it).y+e(Tt).y)/2)));var C=sf(),K=x(C),Me=g(K),We=g(Me),_e=g(We);{var Fe=rt=>{var Kt=rf(),vt=g(x(Kt)),Rt=x(vt);U(Pt=>{u(Kt,"transform",`translate(${e(V)??""}, ${e(J)??""})`),Le(Rt,`${Pt??""}"`)},[()=>(L(e(_)),o(()=>e(_).toFixed(1)))]),w(rt,Kt)};j(_e,rt=>{e(_)>.5&&rt(Fe)})}U(()=>{u(K,"x1",(e(it),o(()=>e(it).x))),u(K,"y1",(e(it),o(()=>e(it).y))),u(K,"x2",(e(Tt),o(()=>e(Tt).x))),u(K,"y2",(e(Tt),o(()=>e(Tt).y))),u(Me,"cx",(e(it),o(()=>e(it).x))),u(Me,"cy",(e(it),o(()=>e(it).y))),u(We,"cx",(e(Tt),o(()=>e(Tt).x))),u(We,"cy",(e(Tt),o(()=>e(Tt).y)))}),w(Y,C)};j(ga,Y=>{e(_t)&&e(it)&&e(Tt)&&Y(Na)})}var ba=g(ga);{var rn=Y=>{var _=Ge(),V=ce(_);Ve(V,1,()=>e(ee),ft,(J,C)=>{var K=Ge(),Me=ce(K);Ve(Me,1,()=>(e(C),o(()=>e(C).rays)),ft,(We,_e)=>{var Fe=of();U(()=>{u(Fe,"x1",(e(_e),o(()=>e(_e).from.x))),u(Fe,"y1",(e(_e),o(()=>e(_e).from.y))),u(Fe,"x2",(e(_e),o(()=>e(_e).to.x))),u(Fe,"y2",(e(_e),o(()=>e(_e).to.y))),u(Fe,"stroke",(e(_e),o(()=>e(_e).blocked?"#ff000033":"#00ff0033")))}),w(We,Fe)}),w(J,K)}),w(Y,_)};j(ba,Y=>{e(ae),e(se),e(f),e(ee),o(()=>e(ae)&&e(se)&&e(f).length>0&&e(ee).length>0)&&Y(rn)})}var Wn=g(ba);{var S=Y=>{var _=Ge(),V=ce(_);Ve(V,1,()=>e(ee),ft,(J,C)=>{var K=Ge(),Me=ce(K);{var We=Fe=>{var rt=lf();U(()=>{u(rt,"x1",(e(C),o(()=>e(C).firstClearRay.from.x))),u(rt,"y1",(e(C),o(()=>e(C).firstClearRay.from.y))),u(rt,"x2",(e(C),o(()=>e(C).firstClearRay.to.x))),u(rt,"y2",(e(C),o(()=>e(C).firstClearRay.to.y)))}),w(Fe,rt)},_e=Fe=>{var rt=cf();U(()=>{u(rt,"x1",(e(C),o(()=>e(C).source.x))),u(rt,"y1",(e(C),o(()=>e(C).source.y))),u(rt,"x2",(e(C),o(()=>e(C).target.x))),u(rt,"y2",(e(C),o(()=>e(C).target.y)))}),w(Fe,rt)};j(Me,Fe=>{e(C),o(()=>e(C).firstClearRay)?Fe(We):Fe(_e,!1)})}w(J,K)}),w(Y,_)};j(Wn,Y=>{e(se),e(f),e(ee),o(()=>e(se)&&e(f).length>0&&e(ee).length>0)&&Y(S)})}var O=g(Wn);{var H=Y=>{const _=Re(()=>(e(ve),e(be),o(()=>Math.min(e(ve).x,e(be).x)))),V=Re(()=>(e(ve),e(be),o(()=>Math.min(e(ve).y,e(be).y)))),J=Re(()=>(e(be),e(ve),o(()=>Math.abs(e(be).x-e(ve).x)))),C=Re(()=>(e(be),e(ve),o(()=>Math.abs(e(be).y-e(ve).y))));var K=uf();U(()=>{u(K,"x",e(_)),u(K,"y",e(V)),u(K,"width",e(J)),u(K,"height",e(C))}),w(Y,K)};j(O,Y=>{e(De)&&e(ve)&&e(be)&&Y(H)})}w(I,Te)}}});var Qn=g(Zn,2),ts=x(Qn),Ir=x(ts);U(()=>Le(Ir,`Battlefield: 60" x 44" | ${h(),o(()=>h().length)??""} P1 models | ${y(),o(()=>y().length)??""} P2 models`)),ne("mousedown",Zn,Za),w(t,nt),jn(),m()}var ff=pe("<span> </span>"),pf=pe('<span class="los-status svelte-12aohay">No enemies</span>'),yf=pe('<div class="controls svelte-12aohay"><label class="svelte-12aohay"><input type="checkbox" class="svelte-12aohay"/> Show debug rays</label> <!> <button class="export-btn svelte-12aohay">Export PNG</button></div>'),vf=pe('<button class="svelte-12aohay"> </button>'),gf=pe('<div class="button-group svelte-12aohay"></div>'),bf=pe('<button class="svelte-12aohay"> </button>'),Tf=pe('<div class="button-group svelte-12aohay"></div>'),xf=pe('<div class="player-toggle svelte-12aohay"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-12aohay"><div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Circles</h4> <div class="palette-grid svelte-12aohay"></div></div> <div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Ovals</h4> <div class="palette-grid svelte-12aohay"></div></div></div>',1),_f=he('<ellipse stroke-width="0.1"></ellipse>'),wf=he('<circle stroke-width="0.1"></circle>'),Sf=pe('<p class="svelte-12aohay"> </p>'),kf=pe('<main class="svelte-12aohay"><div class="layout svelte-12aohay"><div class="sidebar svelte-12aohay"><!> <!> <!> <!></div> <div class="battlefield-area svelte-12aohay"><div class="battlefield-container svelte-12aohay"><!></div> <div class="info svelte-12aohay"><p class="svelte-12aohay"> </p> <!> <p class="hint svelte-12aohay">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function Af(t,n){Vn(n,!1);const a=()=>Wt(tr,"$debugModels",h),s=()=>Wt(nr,"$debugSelectedModelId",h),r=()=>Wt(Rs,"$debugTerrains",h),i=()=>Wt(Ds,"$debugWalls",h),l=()=>Wt(Vi,"$debugMode",h),c=()=>Wt(os,"$debugSelectedTerrainId",h),d=()=>Wt(ls,"$debugSelectedWallId",h),[h,y]=Cr(),p=W(),m=W(),f=W(),v=W(),A=W();let T=W();function E(Z,Ie){Rs.add(Z,Ie)}function P(Z){Ds.add(Z)}function M(Z){os.set(Z),ls.set(null),nr.set(null)}function k(Z){ls.set(Z),os.set(null),nr.set(null)}function D(Z,Ie,qe){Rs.updateTerrain(Z,{x:Ie,y:qe})}function $(Z,Ie,qe){Ds.updateWall(Z,{x:Ie,y:qe})}function B(Z,Ie){Rs.updateTerrain(Z,{rotation:Ie})}function F(Z,Ie){Ds.updateWall(Z,{rotation:Ie})}let G=W(1),q=W(null),ie=!1,ee=null;const fe=5;Er(()=>{if(a().length===0){const Z=tr.add("32mm",1,10,22);tr.add("32mm",2,50,22),nr.set(Z)}});function se(Z,Ie){if(!e(T))return;ie=!0,ee={x:Ie.clientX,y:Ie.clientY};const qe=e(T).screenToSvg(Ie.clientX,Ie.clientY);b(q,{baseType:Z.type,x:qe.x,y:qe.y}),window.addEventListener("mousemove",ae),window.addEventListener("mouseup",De)}function ae(Z){if(!ie||!e(q)||!e(T))return;const Ie=e(T).screenToSvg(Z.clientX,Z.clientY);b(q,{...e(q),x:Ie.x,y:Ie.y})}function De(Z){if(!ie||!e(q)){ie=!1,b(q,null),ee=null,window.removeEventListener("mousemove",ae),window.removeEventListener("mouseup",De);return}const Ie=Z.clientX-ee.x,qe=Z.clientY-ee.y,Ct=Math.sqrt(Ie*Ie+qe*qe);let pt,ot;Ct<fe?(pt=30,ot=22):(pt=e(q).x,ot=e(q).y);const $t=tr.add(e(q).baseType,e(G),pt,ot);nr.set($t),b(q,null),ie=!1,ee=null,window.removeEventListener("mousemove",ae),window.removeEventListener("mouseup",De)}function ve(Z){nr.set(Z),os.set(null),ls.set(null)}function be(Z,Ie,qe){tr.updateModel(Z,{x:Ie,y:qe},!0)}function te(Z,Ie,qe,Ct,pt){hi.push({type:"move",modelId:Z,before:{x:Ie,y:qe},after:{x:Ct,y:pt}})}function Ae(Z,Ie){tr.updateModel(Z,{rotation:Ie},!0)}function ue(Z,Ie,qe){hi.push({type:"rotate",modelId:Z,before:{rotation:Ie},after:{rotation:qe}})}function le(Z,Ie){tr.updateModel(Z,{name:Ie})}function Xe(){os.set(null),ls.set(null),nr.set(null)}function ge(Z){const Ie=Sn(Z.baseType);return vn(Z.baseType)?{x:Z.x,y:Z.y,rx:Ie.width/2,ry:Ie.height/2,rotation:Z.rotation||0}:{x:Z.x,y:Z.y,radius:Ie.radius}}async function Pe(){const Ie=`battlefield-debug-${new Date().toISOString().slice(0,10)}`;try{await Ii(r(),i(),a(),Ie)}catch(qe){alert("Failed to export PNG"),console.error("Export error:",qe)}}me(()=>(a(),s()),()=>{b(p,a().find(Z=>Z.id===s()))}),me(()=>(e(p),a()),()=>{b(m,e(p)?a().filter(Z=>Z.playerId!==e(p).playerId):[])}),me(()=>(r(),Sr),()=>{b(f,r().map(Z=>({id:Z.id,vertices:Sr(Z)})))}),me(()=>(i(),Ca),()=>{b(v,i().map(Z=>ws(Ca(Z.shape,Z.segments),Z.x,Z.y,Z.rotation)))}),me(()=>(e(p),e(m),e(f),e(v)),()=>{b(A,e(p)&&e(m).length>0?e(m).map(Z=>{const Ie=al(ge(Z),ge(e(p)),e(f),e(v));return{viewerId:Z.id,viewer:Z,canSee:Ie.canSee,firstClearRay:Ie.firstClearRay,rays:Ie.rays}}):[])}),$a(),ia();var de=kf(),bt=x(de),ut=x(bt),Yt=x(ut);kn(Yt,{title:"LOS Debug",children:(Z,Ie)=>{var qe=yf(),Ct=x(qe),pt=x(Ct),ot=g(Ct,2);{var $t=wt=>{var It=ff();let hn;var fn=x(It);U((Ce,Ee)=>{hn=Mn(It,1,"los-status svelte-12aohay",null,hn,Ce),Le(fn,`${Ee??""}/${e(A),o(()=>e(A).length)??""} visible`)},[()=>({"can-see":e(A).some(Ce=>Ce.canSee),blocked:!e(A).some(Ce=>Ce.canSee)}),()=>(e(A),o(()=>e(A).filter(Ce=>Ce.canSee).length))]),w(wt,It)},Ft=wt=>{var It=pf();w(wt,It)};j(ot,wt=>{e(p),e(A),o(()=>e(p)&&e(A).length>0)?wt($t):wt(Ft,!1)})}var Et=g(ot,2);En(pt,l,wt=>jc(Vi,wt)),ne("click",Et,Pe),w(Z,qe)},$$slots:{default:!0}});var _t=g(Yt,2);kn(_t,{title:"Add Terrain",defaultOpen:!1,children:(Z,Ie)=>{var qe=gf();Ve(qe,5,()=>ul,ft,(Ct,pt)=>{var ot=vf(),$t=x(ot);U(()=>Le($t,(e(pt),o(()=>e(pt).label)))),ne("click",ot,()=>E(e(pt).width,e(pt).height)),w(Ct,ot)}),w(Z,qe)},$$slots:{default:!0}});var it=g(_t,2);kn(it,{title:"Add Wall",defaultOpen:!1,children:(Z,Ie)=>{var qe=Tf();Ve(qe,5,()=>dl,ft,(Ct,pt)=>{var ot=bf(),$t=x(ot);U(()=>Le($t,(e(pt),o(()=>e(pt).label)))),ne("click",ot,()=>P(e(pt).shape)),w(Ct,ot)}),w(Z,qe)},$$slots:{default:!0}});var Tt=g(it,2);kn(Tt,{title:"Add Models",defaultOpen:!1,children:(Z,Ie)=>{var qe=xf(),Ct=ce(qe),pt=x(Ct);let ot;var $t=g(pt,2);let Ft;var Et=g(Ct,2),wt=x(Et),It=g(x(wt),2);Ve(It,5,()=>(L(ra),o(()=>ra.circles)),ft,(Ce,Ee)=>{Gs(Ce,{get baseSize(){return e(Ee)},get playerId(){return e(G)},onDragStart:se})});var hn=g(wt,2),fn=g(x(hn),2);Ve(fn,5,()=>(L(ra),o(()=>ra.ovals)),ft,(Ce,Ee)=>{Gs(Ce,{get baseSize(){return e(Ee)},get playerId(){return e(G)},onDragStart:se})}),U(()=>{ot=Mn(pt,1,"toggle-btn svelte-12aohay",null,ot,{active:e(G)===1}),Ft=Mn($t,1,"toggle-btn svelte-12aohay",null,Ft,{active:e(G)===2})}),ne("click",pt,()=>b(G,1)),ne("click",$t,()=>b(G,2)),w(Z,qe)},$$slots:{default:!0}});var je=g(ut,2),Qt=x(je),Ht=x(Qt);wr(Ss(Ht,{get terrains(){return r()},get walls(){return i()},get models(){return a()},get losResults(){return e(A)},interactiveTerrain:!0,interactiveWalls:!0,interactiveModels:!0,get showDebugRays(){return l()},get selectedTerrainId(){return c()},get selectedWallId(){return d()},get selectedModelId(){return s()},onTerrainSelect:M,onTerrainDrag:D,onTerrainRotate:B,onWallSelect:k,onWallDrag:$,onWallRotate:F,onModelSelect:ve,onModelDrag:be,onModelDragEnd:te,onModelRotate:Ae,onModelRotateEnd:ue,onModelRename:le,onBackgroundClick:Xe,children:(Z,Ie)=>{var qe=Ge(),Ct=ce(qe);{var pt=ot=>{const $t=Re(()=>(L(Sn),e(q),o(()=>Sn(e(q).baseType)))),Ft=Re(()=>(L(vn),e(q),o(()=>vn(e(q).baseType)))),Et=Re(()=>(L(gs),e(G),o(()=>gs(e(G)))));var wt=Ge(),It=ce(wt);{var hn=Ce=>{var Ee=_f();U(()=>{u(Ee,"cx",(e(q),o(()=>e(q).x))),u(Ee,"cy",(e(q),o(()=>e(q).y))),u(Ee,"rx",(L(e($t)),o(()=>e($t).width/2))),u(Ee,"ry",(L(e($t)),o(()=>e($t).height/2))),u(Ee,"fill",(L(e(Et)),o(()=>e(Et).fillLight))),u(Ee,"stroke",(L(e(Et)),o(()=>e(Et).primary)))}),w(Ce,Ee)},fn=Ce=>{var Ee=wf();U(()=>{u(Ee,"cx",(e(q),o(()=>e(q).x))),u(Ee,"cy",(e(q),o(()=>e(q).y))),u(Ee,"r",(L(e($t)),o(()=>e($t).radius))),u(Ee,"fill",(L(e(Et)),o(()=>e(Et).fillLight))),u(Ee,"stroke",(L(e(Et)),o(()=>e(Et).primary)))}),w(Ce,Ee)};j(It,Ce=>{e(Ft)?Ce(hn):Ce(fn,!1)})}w(ot,wt)};j(Ct,ot=>{e(q)&&ot(pt)})}w(Z,qe)},$$slots:{default:!0},$$legacy:!0}),Z=>b(T,Z),()=>e(T));var zt=g(Qt,2),Ne=x(zt),Ke=x(Ne),ze=g(Ne,2);{var xt=Z=>{var Ie=Sf(),qe=x(Ie);U(Ct=>Le(qe,`Selected model LOS: ${Ct??""}/${e(A),o(()=>e(A).length)??""} visible`),[()=>(e(A),o(()=>e(A).filter(Ct=>Ct.canSee).length))]),w(Z,Ie)};j(ze,Z=>{l(),e(p),e(A),o(()=>l()&&e(p)&&e(A).length>0)&&Z(xt)})}U(()=>Le(Ke,`Battlefield: 60" x 44" | ${r(),o(()=>r().length)??""} terrain | ${i(),o(()=>i().length)??""} walls | ${a(),o(()=>a().length)??""} models`)),w(t,de),jn(),y()}var Cf=pe('<button class="svelte-yk5o9r"> </button>'),Ef=pe('<div class="button-group svelte-yk5o9r"></div> <div class="custom-size-section svelte-yk5o9r"><span class="section-label svelte-yk5o9r">Custom Size</span> <div class="dimension-inputs svelte-yk5o9r"><div class="dimension-input svelte-yk5o9r"><label class="svelte-yk5o9r">W</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div> <span class="dimension-separator svelte-yk5o9r">×</span> <div class="dimension-input svelte-yk5o9r"><label class="svelte-yk5o9r">H</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div> <button class="svelte-yk5o9r">Add</button></div></div>',1),Mf=pe('<button class="svelte-yk5o9r"> </button>'),Rf=pe('<div class="button-group svelte-yk5o9r"></div>'),Df=pe('<div class="selected-info svelte-yk5o9r"><div class="field svelte-yk5o9r"><span class="label svelte-yk5o9r">Type</span> <span class="value svelte-yk5o9r">Terrain</span></div> <div class="field svelte-yk5o9r"><span class="label svelte-yk5o9r">Position</span> <span class="value svelte-yk5o9r"> </span></div> <div class="field svelte-yk5o9r"><span class="label svelte-yk5o9r">Rotation</span> <span class="value svelte-yk5o9r"> </span></div> <div class="edit-section svelte-yk5o9r"><span class="section-label svelte-yk5o9r">Dimensions</span> <div class="dimension-inputs svelte-yk5o9r"><div class="dimension-input svelte-yk5o9r"><label class="svelte-yk5o9r">W</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div> <span class="dimension-separator svelte-yk5o9r">×</span> <div class="dimension-input svelte-yk5o9r"><label class="svelte-yk5o9r">H</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div></div></div> <button class="danger svelte-yk5o9r">Delete Terrain</button></div>'),If=pe('<div class="segment-inputs svelte-yk5o9r"><div class="segment-input svelte-yk5o9r"><label class="svelte-yk5o9r">Width</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div> <div class="segment-input svelte-yk5o9r"><label class="svelte-yk5o9r">Height</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div></div>'),Lf=pe('<div class="segment-inputs svelte-yk5o9r"><div class="segment-input svelte-yk5o9r"><label class="svelte-yk5o9r">Top</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div> <div class="segment-input svelte-yk5o9r"><label class="svelte-yk5o9r">Height</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div> <div class="segment-input svelte-yk5o9r"><label class="svelte-yk5o9r">Bottom</label> <input type="number" min="1" max="20" step="0.5" class="svelte-yk5o9r"/></div></div>'),$f=pe('<div class="selected-info svelte-yk5o9r"><div class="field svelte-yk5o9r"><span class="label svelte-yk5o9r">Type</span> <span class="value svelte-yk5o9r"> </span></div> <div class="field svelte-yk5o9r"><span class="label svelte-yk5o9r">Position</span> <span class="value svelte-yk5o9r"> </span></div> <div class="field svelte-yk5o9r"><span class="label svelte-yk5o9r">Rotation</span> <span class="value svelte-yk5o9r"> </span></div> <div class="edit-section svelte-yk5o9r"><span class="section-label svelte-yk5o9r">Segments</span> <!></div> <button class="danger svelte-yk5o9r">Delete Wall</button></div>'),Pf=pe('<p class="hint svelte-yk5o9r">Click terrain or wall to select</p>'),Nf=pe('<div class="saved-layout-item svelte-yk5o9r"><button class="layout-btn svelte-yk5o9r"> <span class="layout-meta svelte-yk5o9r"> </span></button> <button class="delete-btn svelte-yk5o9r" title="Delete">×</button></div>'),Of=pe('<div class="saved-layouts svelte-yk5o9r"><span class="section-label svelte-yk5o9r">Saved Layouts</span> <!></div>'),Wf=pe('<div class="save-section svelte-yk5o9r"><div class="save-row svelte-yk5o9r"><input type="text" placeholder="Layout name..." class="svelte-yk5o9r"/> <button class="svelte-yk5o9r">Save</button></div> <!> <div class="export-section svelte-yk5o9r"><span class="section-label svelte-yk5o9r">File Export/Import</span> <div class="button-row svelte-yk5o9r"><button class="svelte-yk5o9r">Export JSON</button> <button class="svelte-yk5o9r">Import JSON</button></div> <input type="file" accept=".json" style="display: none;"/></div> <button class="secondary svelte-yk5o9r">Clear All</button></div>'),Yf=pe('<main class="svelte-yk5o9r"><div class="layout svelte-yk5o9r"><div class="sidebar svelte-yk5o9r"><!> <!> <!> <!></div> <div class="battlefield-area svelte-yk5o9r"><div class="battlefield-container svelte-yk5o9r"><!></div> <div class="info svelte-yk5o9r"><p class="svelte-yk5o9r"> </p> <p class="hint svelte-yk5o9r">Del to remove | Scroll to zoom | Space+drag to pan | Shift+drag for fine rotation</p></div></div></div></main>');function Hf(t,n){Vn(n,!1);const a=()=>Wt(Oa,"$selectedTerrainId",c),s=()=>Wt(Wa,"$selectedWallId",c),r=()=>Wt(xa,"$layoutTerrains",c),i=()=>Wt(_a,"$layoutWalls",c),l=()=>Wt(Ei,"$savedLayoutsList",c),[c,d]=Cr(),h=W(),y=W(),p=W(),m=W();let f=W(),v=W(""),A=W(),T=W(6),E=W(12);Er(()=>{Ps()});function P(Ne,Ke){xa.add(Ne,Ke)}function M(){e(T)>0&&e(E)>0&&xa.add(e(T),e(E))}function k(Ne){Oa.set(Ne),Wa.set(null)}function D(Ne,Ke,ze){xa.updateTerrain(Ne,{x:Ke,y:ze})}function $(Ne,Ke){xa.updateTerrain(Ne,{rotation:Ke})}function B(Ne,Ke){a()&&Ke>0&&xa.updateTerrain(a(),{[Ne]:Ke})}function F(){a()&&(xa.remove(a()),Oa.set(null))}function G(Ne){_a.add(Ne)}function q(Ne){Wa.set(Ne),Oa.set(null)}function ie(Ne,Ke,ze){_a.updateWall(Ne,{x:Ke,y:ze})}function ee(Ne,Ke){_a.updateWall(Ne,{rotation:Ke})}function fe(){s()&&(_a.remove(s()),Wa.set(null))}function se(Ne,Ke){if(s()&&e(y)&&Ke>0){const ze=$s(e(y).shape),Z=[...e(y).segments||ze.segments];Z[Ne]=Ke,_a.updateWall(s(),{segments:Z})}}function ae(){Oa.set(null),Wa.set(null)}function De(){confirm("Clear all terrain and walls?")&&(xa.clear(),_a.clear(),Oa.set(null),Wa.set(null))}function ve(){if(!e(v).trim()){alert("Please enter a layout name");return}pu(e(v).trim()),Ps(),b(v,"")}function be(Ne){yu(Ne),Oa.set(null),Wa.set(null)}function te(Ne,Ke){Ke.stopPropagation(),confirm(`Delete layout "${Ne}"?`)&&(vu(Ne),Ps())}function Ae(){const Ne={version:1,exportedAt:new Date().toISOString(),terrains:r(),walls:i()},Ke=JSON.stringify(Ne,null,2),ze=new Blob([Ke],{type:"application/json"}),xt=URL.createObjectURL(ze),Z=document.createElement("a");Z.href=xt;const Ie=new Date().toISOString().slice(0,10);Z.download=`layout-${Ie}.json`,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z),URL.revokeObjectURL(xt)}function ue(){e(A)?.click()}function le(Ne){const Ke=Ne.target.files?.[0];if(!Ke)return;const ze=new FileReader;ze.onload=xt=>{try{const Z=JSON.parse(xt.target.result);Z.terrains&&Array.isArray(Z.terrains)&&xa.set(Z.terrains),Z.walls&&Array.isArray(Z.walls)&&_a.set(Z.walls),Oa.set(null),Wa.set(null)}catch(Z){console.error("Failed to parse layout file:",Z),alert("Failed to import: Invalid JSON file")}},ze.readAsText(Ke),Ne.target.value=""}function Xe(Ne){Ne.target.tagName!=="INPUT"&&((Ne.key==="Delete"||Ne.key==="Backspace")&&(Ne.preventDefault(),a()?F():s()&&fe()),Ne.key==="Escape"&&(Oa.set(null),Wa.set(null)))}me(()=>(r(),a()),()=>{b(h,r().find(Ne=>Ne.id===a()))}),me(()=>(i(),s()),()=>{b(y,i().find(Ne=>Ne.id===s()))}),me(()=>(e(y),$s),()=>{b(p,e(y)?$s(e(y).shape):null)}),me(()=>(e(y),e(p)),()=>{b(m,e(y)?.segments||e(p)?.segments||[])}),$a(),ia();var ge=Yf();ne("keydown",pr,Xe);var Pe=x(ge),de=x(Pe),bt=x(de);kn(bt,{title:"Add Terrain",children:(Ne,Ke)=>{var ze=Ef(),xt=ce(ze);Ve(xt,5,()=>ul,ft,(Ft,Et)=>{var wt=Cf(),It=x(wt);U(()=>Le(It,(e(Et),o(()=>e(Et).label)))),ne("click",wt,()=>P(e(Et).width,e(Et).height)),w(Ft,wt)});var Z=g(xt,2),Ie=g(x(Z),2),qe=x(Ie),Ct=g(x(qe),2),pt=g(qe,4),ot=g(x(pt),2),$t=g(pt,2);qr(Ct,()=>e(T),Ft=>b(T,Ft)),qr(ot,()=>e(E),Ft=>b(E,Ft)),ne("click",$t,M),w(Ne,ze)},$$slots:{default:!0}});var ut=g(bt,2);kn(ut,{title:"Add Wall",children:(Ne,Ke)=>{var ze=Rf();Ve(ze,5,()=>dl,ft,(xt,Z)=>{var Ie=Mf(),qe=x(Ie);U(()=>Le(qe,(e(Z),o(()=>e(Z).label)))),ne("click",Ie,()=>G(e(Z).shape)),w(xt,Ie)}),w(Ne,ze)},$$slots:{default:!0}});var Yt=g(ut,2);kn(Yt,{title:"Selected",children:(Ne,Ke)=>{var ze=Ge(),xt=ce(ze);{var Z=qe=>{var Ct=Df(),pt=g(x(Ct),2),ot=g(x(pt),2),$t=x(ot),Ft=g(pt,2),Et=g(x(Ft),2),wt=x(Et),It=g(Ft,2),hn=g(x(It),2),fn=x(hn),Ce=g(x(fn),2),Ee=g(fn,4),Qe=g(x(Ee),2),Lt=g(It,2);U((jt,pn,Bt)=>{Le($t,`${jt??""}", ${pn??""}"`),Le(wt,`${Bt??""}°`),Ha(Ce,(e(h),o(()=>e(h).width))),Ha(Qe,(e(h),o(()=>e(h).height)))},[()=>(e(h),o(()=>e(h).x.toFixed(1))),()=>(e(h),o(()=>e(h).y.toFixed(1))),()=>(e(h),o(()=>Math.round(e(h).rotation||0)))]),ne("change",Ce,jt=>B("width",parseFloat(jt.target.value))),ne("change",Qe,jt=>B("height",parseFloat(jt.target.value))),ne("click",Lt,F),w(qe,Ct)},Ie=qe=>{var Ct=Ge(),pt=ce(Ct);{var ot=Ft=>{var Et=$f(),wt=x(Et),It=g(x(wt),2),hn=x(It),fn=g(wt,2),Ce=g(x(fn),2),Ee=x(Ce),Qe=g(fn,2),Lt=g(x(Qe),2),jt=x(Lt),pn=g(Qe,2),Bt=g(x(pn),2);{var yn=Pn=>{var Rn=If(),Hn=x(Rn),qn=g(x(Hn),2),Nn=g(Hn,2),pa=g(x(Nn),2);U(()=>{Ha(qn,(e(m),o(()=>e(m)[0]))),Ha(pa,(e(m),o(()=>e(m)[1])))}),ne("change",qn,Jn=>se(0,parseFloat(Jn.target.value))),ne("change",pa,Jn=>se(1,parseFloat(Jn.target.value))),w(Pn,Rn)},fa=Pn=>{var Rn=Ge(),Hn=ce(Rn);{var qn=Nn=>{var pa=Lf(),Jn=x(pa),ya=g(x(Jn),2),oe=g(Jn,2),Ue=g(x(oe),2),kt=g(oe,2),At=g(x(kt),2);U(()=>{Ha(ya,(e(m),o(()=>e(m)[0]))),Ha(Ue,(e(m),o(()=>e(m)[1]))),Ha(At,(e(m),o(()=>e(m)[2])))}),ne("change",ya,Se=>se(0,parseFloat(Se.target.value))),ne("change",Ue,Se=>se(1,parseFloat(Se.target.value))),ne("change",At,Se=>se(2,parseFloat(Se.target.value))),w(Nn,pa)};j(Hn,Nn=>{e(p),o(()=>e(p)?.type==="C")&&Nn(qn)},!0)}w(Pn,Rn)};j(Bt,Pn=>{e(p),o(()=>e(p)?.type==="L")?Pn(yn):Pn(fa,!1)})}var Za=g(pn,2);U((Pn,Rn,Hn)=>{Le(hn,`${e(p),o(()=>e(p)?.type)??""}-Wall ${e(p),o(()=>e(p)?.mirrored?"(mirrored)":"")??""}`),Le(Ee,`${Pn??""}", ${Rn??""}"`),Le(jt,`${Hn??""}°`)},[()=>(e(y),o(()=>e(y).x.toFixed(1))),()=>(e(y),o(()=>e(y).y.toFixed(1))),()=>(e(y),o(()=>Math.round(e(y).rotation||0)))]),ne("click",Za,fe),w(Ft,Et)},$t=Ft=>{var Et=Pf();w(Ft,Et)};j(pt,Ft=>{e(y)?Ft(ot):Ft($t,!1)},!0)}w(qe,Ct)};j(xt,qe=>{e(h)?qe(Z):qe(Ie,!1)})}w(Ne,ze)},$$slots:{default:!0}});var _t=g(Yt,2);kn(_t,{title:"Save & Load",children:(Ne,Ke)=>{var ze=Wf(),xt=x(ze),Z=x(xt),Ie=g(Z,2),qe=g(xt,2);{var Ct=It=>{var hn=Of(),fn=g(x(hn),2);Ve(fn,1,l,ft,(Ce,Ee)=>{var Qe=Nf(),Lt=x(Qe),jt=x(Lt),pn=g(jt),Bt=x(pn),yn=g(Lt,2);U(()=>{Le(jt,`${e(Ee),o(()=>e(Ee).name)??""} `),Le(Bt,`${e(Ee),o(()=>e(Ee).terrainCount)??""}T ${e(Ee),o(()=>e(Ee).wallCount)??""}W`)}),ne("click",Lt,()=>be(e(Ee).name)),ne("click",yn,fa=>te(e(Ee).name,fa)),w(Ce,Qe)}),w(It,hn)};j(qe,It=>{l(),o(()=>l().length>0)&&It(Ct)})}var pt=g(qe,2),ot=g(x(pt),2),$t=x(ot),Ft=g($t,2),Et=g(ot,2);wr(Et,It=>b(A,It),()=>e(A));var wt=g(pt,2);qr(Z,()=>e(v),It=>b(v,It)),ne("keydown",Z,It=>It.key==="Enter"&&ve()),ne("click",Ie,ve),ne("click",$t,Ae),ne("click",Ft,ue),ne("change",Et,le),ne("click",wt,De),w(Ne,ze)},$$slots:{default:!0}});var it=g(de,2),Tt=x(it),je=x(Tt);wr(Ss(je,{get terrains(){return r()},get walls(){return i()},models:[],interactiveTerrain:!0,interactiveWalls:!0,get selectedTerrainId(){return a()},get selectedWallId(){return s()},onTerrainSelect:k,onTerrainDrag:D,onTerrainRotate:$,onWallSelect:q,onWallDrag:ie,onWallRotate:ee,onBackgroundClick:ae,$$legacy:!0}),Ne=>b(f,Ne),()=>e(f));var Qt=g(Tt,2),Ht=x(Qt),zt=x(Ht);U(()=>Le(zt,`Battlefield: 60" × 44" | ${r(),o(()=>r().length)??""} terrain | ${i(),o(()=>i().length)??""} walls`)),w(t,ge),jn(),d()}var Ff=pe('<div class="app-header svelte-1n46o8q"><h1 class="app-title svelte-1n46o8q">Procinctum</h1> <nav class="nav-links svelte-1n46o8q"><a href="#/setup">Battlefield Setup</a> <a href="#/deployment">Deployment</a> <a href="#/battle">Battle</a> <a href="#/layout">Layout Builder</a></nav></div> <!> <footer class="app-footer svelte-1n46o8q"><span>Built with love by <a href="https://github.com/barkin-aygun/wh40k-deploy" target="_blank" rel="noopener noreferrer" class="svelte-1n46o8q">@Volfied</a></span> <span class="separator svelte-1n46o8q">|</span> <span class="disclaimer svelte-1n46o8q">Warhammer 40,000 and all associated marks, logos, and images are trademarks and/or copyrights of Games Workshop Ltd. This is an unofficial fan project and is not affiliated with or endorsed by Games Workshop.<br/><a href="https://github.com/desjani/40kCompactor" target="_blank" rel="noopener noreferrer" class="svelte-1n46o8q">40KCompactor</a> by Desjani</span></footer>',1);function Bf(t,n){Vn(n,!1);let a=W("main");function s(){const P=window.location.hash;P==="#/debug"?b(a,"debug"):P==="#/setup"?b(a,"setup"):P==="#/deployment"?b(a,"deployment"):P==="#/battle"?b(a,"battle"):P==="#/layout"?b(a,"layout"):b(a,"deployment")}Er(()=>(s(),window.addEventListener("hashchange",s),()=>window.removeEventListener("hashchange",s))),ia();var r=Ff(),i=ce(r),l=g(x(i),2),c=x(l);let d;var h=g(c,2);let y;var p=g(h,2);let m;var f=g(p,2);let v;var A=g(i,2);{var T=P=>{Af(P,{})},E=P=>{var M=Ge(),k=ce(M);{var D=B=>{Cd(B,{})},$=B=>{var F=Ge(),G=ce(F);{var q=ee=>{no(ee,{})},ie=ee=>{var fe=Ge(),se=ce(fe);{var ae=ve=>{hf(ve,{})},De=ve=>{var be=Ge(),te=ce(be);{var Ae=le=>{Hf(le,{})},ue=le=>{no(le,{})};j(te,le=>{e(a)==="layout"?le(Ae):le(ue,!1)},!0)}w(ve,be)};j(se,ve=>{e(a)==="battle"?ve(ae):ve(De,!1)},!0)}w(ee,fe)};j(G,ee=>{e(a)==="deployment"?ee(q):ee(ie,!1)},!0)}w(B,F)};j(k,B=>{e(a)==="setup"?B(D):B($,!1)},!0)}w(P,M)};j(A,P=>{e(a)==="debug"?P(T):P(E,!1)})}U(()=>{d=Mn(c,1,"svelte-1n46o8q",null,d,{active:e(a)==="setup"}),y=Mn(h,1,"svelte-1n46o8q",null,y,{active:e(a)==="deployment"}),m=Mn(p,1,"svelte-1n46o8q",null,m,{active:e(a)==="battle"}),v=Mn(f,1,"svelte-1n46o8q",null,v,{active:e(a)==="layout"})}),w(t,r),jn()}Pc(Bf,{target:document.getElementById("app")});
//# sourceMappingURL=index-DyMRhhJ1.js.map
