(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const Qr=!1;var mr=Array.isArray,pl=Array.prototype.indexOf,Yr=Array.from,eo=Object.defineProperty,hs=Object.getOwnPropertyDescriptor,to=Object.getOwnPropertyDescriptors,vl=Object.prototype,gl=Array.prototype,mi=Object.getPrototypeOf,Ri=Object.isExtensible;const ts=()=>{};function bl(t){return t()}function Mr(t){for(var a=0;a<t.length;a++)t[a]()}function ao(){var t,a,n=new Promise((r,s)=>{t=r,a=s});return{promise:n,resolve:t,reject:a}}const Ea=2,Rr=4,dr=8,no=1<<24,zn=16,Xn=32,_s=64,di=128,cn=512,ka=1024,Wa=2048,En=4096,Ja=8192,Fn=16384,hi=32768,Ns=65536,Li=1<<17,so=1<<18,Bs=1<<19,ro=1<<20,Hn=1<<25,gs=32768,Jr=1<<21,fi=1<<22,as=1<<23,Bn=Symbol("$state"),Tl=Symbol("legacy props"),xl=Symbol(""),Ls=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Hr(){throw new Error("https://svelte.dev/e/invalid_default_snippet")}function yi(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function _l(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function wl(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Sl(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Al(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Cl(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function kl(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function El(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ml(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Rl(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Ll(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Dl=1,Il=2,io=4,$l=8,Pl=16,Nl=1,Ol=2,Wl=4,Yl=8,Hl=16,oo=1,Fl=2,Sa=Symbol(),Bl="http://www.w3.org/1999/xhtml";function ql(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Ul(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function lo(t){return t===this.v}function co(t,a){return t!=t?a==a:t!==a||t!==null&&typeof t=="object"||typeof t=="function"}function uo(t){return!co(t,this.v)}let qs=!1,Kl=!1;function Gl(){qs=!0}let ea=null;function Os(t){ea=t}function Ka(t,a=!1,n){ea={p:ea,i:!1,c:null,e:null,s:t,x:null,l:qs&&!a?{s:null,u:null,$:[]}:null}}function Ga(t){var a=ea,n=a.e;if(n!==null){a.e=null;for(var r of n)Eo(r)}return t!==void 0&&(a.x=t),a.i=!0,ea=a.p,t??{}}function hr(){return!qs||ea!==null&&ea.l===null}let ds=[];function mo(){var t=ds;ds=[],Mr(t)}function Us(t){if(ds.length===0&&!rr){var a=ds;queueMicrotask(()=>{a===ds&&mo()})}ds.push(t)}function zl(){for(;ds.length>0;)mo()}function ho(t){var a=Wt;if(a===null)return kt.f|=as,t;if((a.f&hi)===0){if((a.f&di)===0)throw t;a.b.error(t)}else Ws(t,a)}function Ws(t,a){for(;a!==null;){if((a.f&di)!==0)try{a.b.error(t);return}catch(n){t=n}a=a.parent}throw t}const Xl=-7169;function ga(t,a){t.f=t.f&Xl|a}function pi(t){(t.f&cn)!==0||t.deps===null?ga(t,ka):ga(t,En)}function fo(t){if(t!==null)for(const a of t)(a.f&Ea)===0||(a.f&gs)===0||(a.f^=gs,fo(a.deps))}function yo(t,a,n){(t.f&Wa)!==0?a.add(t):(t.f&En)!==0&&n.add(t),fo(t.deps),ga(t,ka)}const br=new Set;let Pt=null,sr=null,yn=null,on=[],Fr=null,ei=!1,rr=!1;class An{committed=!1;current=new Map;previous=new Map;#t=new Set;#i=new Set;#e=0;#s=0;#r=null;#n=new Set;#a=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#s>0}process(a){on=[],sr=null,this.apply();var n=[],r=[];for(const s of a)this.#o(s,n,r);this.is_fork||this.#c(),this.is_deferred()?(this.#l(r),this.#l(n)):(sr=this,Pt=null,Di(r),Di(n),sr=null,this.#r?.resolve()),yn=null}#o(a,n,r){a.f^=ka;for(var s=a.first,i=null;s!==null;){var o=s.f,c=(o&(Xn|_s))!==0,m=c&&(o&ka)!==0,f=m||(o&Ja)!==0||this.skipped_effects.has(s);if(!f&&s.fn!==null){c?s.f^=ka:i!==null&&(o&(Rr|dr|no))!==0?i.b.defer_effect(s):(o&Rr)!==0?n.push(s):Gs(s)&&((o&zn)!==0&&this.#n.add(s),Ys(s));var d=s.first;if(d!==null){s=d;continue}}var y=s.parent;for(s=s.next;s===null&&y!==null;)y===i&&(i=null),s=y.next,y=y.parent}}#l(a){for(var n=0;n<a.length;n+=1)yo(a[n],this.#n,this.#a)}capture(a,n){n!==Sa&&!this.previous.has(a)&&this.previous.set(a,n),(a.f&as)===0&&(this.current.set(a,a.v),yn?.set(a,a.v))}activate(){Pt=this,this.apply()}deactivate(){Pt===this&&(Pt=null,yn=null)}flush(){if(this.activate(),on.length>0){if(po(),Pt!==null&&Pt!==this)return}else this.#e===0&&this.process([]);this.deactivate()}discard(){for(const a of this.#i)a(this);this.#i.clear()}#c(){if(this.#s===0){for(const a of this.#t)a();this.#t.clear()}this.#e===0&&this.#u()}#u(){if(br.size>1){this.previous.clear();var a=yn,n=!0;for(const s of br){if(s===this){n=!1;continue}const i=[];for(const[c,m]of this.current){if(s.current.has(c))if(n&&m!==s.current.get(c))s.current.set(c,m);else continue;i.push(c)}if(i.length===0)continue;const o=[...s.current.keys()].filter(c=>!this.current.has(c));if(o.length>0){var r=on;on=[];const c=new Set,m=new Map;for(const f of i)vo(f,o,c,m);if(on.length>0){Pt=s,s.apply();for(const f of on)s.#o(f,[],[]);s.deactivate()}on=r}}Pt=null,yn=a}this.committed=!0,br.delete(this)}increment(a){this.#e+=1,a&&(this.#s+=1)}decrement(a){this.#e-=1,a&&(this.#s-=1),this.revive()}revive(){for(const a of this.#n)this.#a.delete(a),ga(a,Wa),Kn(a);for(const a of this.#a)ga(a,En),Kn(a);this.flush()}oncommit(a){this.#t.add(a)}ondiscard(a){this.#i.add(a)}settled(){return(this.#r??=ao()).promise}static ensure(){if(Pt===null){const a=Pt=new An;br.add(Pt),rr||An.enqueue(()=>{Pt===a&&a.flush()})}return Pt}static enqueue(a){Us(a)}apply(){}}function Vl(t){var a=rr;rr=!0;try{for(var n;;){if(zl(),on.length===0&&(Pt?.flush(),on.length===0))return Fr=null,n;po()}}finally{rr=a}}function po(){var t=ys;ei=!0;var a=null;try{var n=0;for(Dr(!0);on.length>0;){var r=An.ensure();if(n++>1e3){var s,i;jl()}r.process(on),ns.clear()}}finally{ei=!1,Dr(t),Fr=null}}function jl(){try{Cl()}catch(t){Ws(t,Fr)}}let Nn=null;function Di(t){var a=t.length;if(a!==0){for(var n=0;n<a;){var r=t[n++];if((r.f&(Fn|Ja))===0&&Gs(r)&&(Nn=new Set,Ys(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?Do(r):r.fn=null),Nn?.size>0)){ns.clear();for(const s of Nn){if((s.f&(Fn|Ja))!==0)continue;const i=[s];let o=s.parent;for(;o!==null;)Nn.has(o)&&(Nn.delete(o),i.push(o)),o=o.parent;for(let c=i.length-1;c>=0;c--){const m=i[c];(m.f&(Fn|Ja))===0&&Ys(m)}}Nn.clear()}}Nn=null}}function vo(t,a,n,r){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const s of t.reactions){const i=s.f;(i&Ea)!==0?vo(s,a,n,r):(i&(fi|zn))!==0&&(i&Wa)===0&&go(s,a,r)&&(ga(s,Wa),Kn(s))}}function go(t,a,n){const r=n.get(t);if(r!==void 0)return r;if(t.deps!==null)for(const s of t.deps){if(a.includes(s))return!0;if((s.f&Ea)!==0&&go(s,a,n))return n.set(s,!0),!0}return n.set(t,!1),!1}function Kn(t){for(var a=Fr=t;a.parent!==null;){a=a.parent;var n=a.f;if(ei&&a===Wt&&(n&zn)!==0&&(n&so)===0)return;if((n&(_s|Xn))!==0){if((n&ka)===0)return;a.f^=ka}}on.push(a)}function Zl(t){let a=0,n=bs(0),r;return()=>{bi()&&(e(n),Ks(()=>(a===0&&(r=l(()=>t(()=>ir(n)))),a+=1,()=>{Us(()=>{a-=1,a===0&&(r?.(),r=void 0,ir(n))})})))}}var Ql=Ns|Bs|di;function Jl(t,a,n){new ec(t,a,n)}class ec{parent;is_pending=!1;#t;#i=null;#e;#s;#r;#n=null;#a=null;#o=null;#l=null;#c=null;#u=0;#m=0;#h=!1;#f=new Set;#y=new Set;#d=null;#T=Zl(()=>(this.#d=bs(this.#u),()=>{this.#d=null}));constructor(a,n,r){this.#t=a,this.#e=n,this.#s=r,this.parent=Wt.b,this.is_pending=!!this.#e.pending,this.#r=Ti(()=>{Wt.b=this;{var s=this.#g();try{this.#n=ln(()=>r(s))}catch(i){this.error(i)}this.#m>0?this.#v():this.is_pending=!1}return()=>{this.#c?.remove()}},Ql)}#x(){try{this.#n=ln(()=>this.#s(this.#t))}catch(a){this.error(a)}}#_(){const a=this.#e.pending;a&&(this.#a=ln(()=>a(this.#t)),An.enqueue(()=>{var n=this.#g();this.#n=this.#p(()=>(An.ensure(),ln(()=>this.#s(n)))),this.#m>0?this.#v():(fs(this.#a,()=>{this.#a=null}),this.is_pending=!1)}))}#g(){var a=this.#t;return this.is_pending&&(this.#c=qn(),this.#t.before(this.#c),a=this.#c),a}defer_effect(a){yo(a,this.#f,this.#y)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#e.pending}#p(a){var n=Wt,r=kt,s=ea;kn(this.#r),qa(this.#r),Os(this.#r.ctx);try{return a()}catch(i){return ho(i),null}finally{kn(n),qa(r),Os(s)}}#v(){const a=this.#e.pending;this.#n!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#c),Po(this.#n,this.#l)),this.#a===null&&(this.#a=ln(()=>a(this.#t)))}#b(a){if(!this.has_pending_snippet()){this.parent&&this.parent.#b(a);return}if(this.#m+=a,this.#m===0){this.is_pending=!1;for(const n of this.#f)ga(n,Wa),Kn(n);for(const n of this.#y)ga(n,En),Kn(n);this.#f.clear(),this.#y.clear(),this.#a&&fs(this.#a,()=>{this.#a=null}),this.#l&&(this.#t.before(this.#l),this.#l=null)}}update_pending_count(a){this.#b(a),this.#u+=a,this.#d&&Ts(this.#d,this.#u)}get_effect_pending(){return this.#T(),e(this.#d)}error(a){var n=this.#e.onerror;let r=this.#e.failed;if(this.#h||!n&&!r)throw a;this.#n&&(Ua(this.#n),this.#n=null),this.#a&&(Ua(this.#a),this.#a=null),this.#o&&(Ua(this.#o),this.#o=null);var s=!1,i=!1;const o=()=>{if(s){Ul();return}s=!0,i&&Ll(),An.ensure(),this.#u=0,this.#o!==null&&fs(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#n=this.#p(()=>(this.#h=!1,ln(()=>this.#s(this.#t)))),this.#m>0?this.#v():this.is_pending=!1};var c=kt;try{qa(null),i=!0,n?.(a,o),i=!1}catch(m){Ws(m,this.#r&&this.#r.parent)}finally{qa(c)}r&&Us(()=>{this.#o=this.#p(()=>{An.ensure(),this.#h=!0;try{return ln(()=>{r(this.#t,()=>a,()=>o)})}catch(m){return Ws(m,this.#r.parent),null}finally{this.#h=!1}})})}}function tc(t,a,n,r){const s=hr()?Br:$e;if(n.length===0&&t.length===0){r(a.map(s));return}var i=Pt,o=Wt,c=ac();function m(){Promise.all(n.map(f=>nc(f))).then(f=>{c();try{r([...a.map(s),...f])}catch(d){(o.f&Fn)===0&&Ws(d,o)}i?.deactivate(),Lr()}).catch(f=>{Ws(f,o)})}t.length>0?Promise.all(t).then(()=>{c();try{return m()}finally{i?.deactivate(),Lr()}}):m()}function ac(){var t=Wt,a=kt,n=ea,r=Pt;return function(i=!0){kn(t),qa(a),Os(n),i&&r?.activate()}}function Lr(){kn(null),qa(null),Os(null)}function Br(t){var a=Ea|Wa,n=kt!==null&&(kt.f&Ea)!==0?kt:null;return Wt!==null&&(Wt.f|=Bs),{ctx:ea,deps:null,effects:null,equals:lo,f:a,fn:t,reactions:null,rv:0,v:Sa,wv:0,parent:n??Wt,ac:null}}function nc(t,a,n){let r=Wt;r===null&&_l();var s=r.b,i=void 0,o=bs(Sa),c=!kt,m=new Map;return hc(()=>{var f=ao();i=f.promise;try{Promise.resolve(t()).then(f.resolve,f.reject).then(()=>{d===Pt&&d.committed&&d.deactivate(),Lr()})}catch(p){f.reject(p),Lr()}var d=Pt;if(c){var y=s.is_rendered();s.update_pending_count(1),d.increment(y),m.get(d)?.reject(Ls),m.delete(d),m.set(d,f)}const u=(p,g=void 0)=>{if(d.activate(),g)g!==Ls&&(o.f|=as,Ts(o,g));else{(o.f&as)!==0&&(o.f^=as),Ts(o,p);for(const[_,x]of m){if(m.delete(_),_===d)break;x.reject(Ls)}}c&&(s.update_pending_count(-1),d.decrement(y))};f.promise.then(u,p=>u(null,p||"unknown"))}),yr(()=>{for(const f of m.values())f.reject(Ls)}),new Promise(f=>{function d(y){function u(){y===i?f(o):d(i)}y.then(u,u)}d(i)})}function $e(t){const a=Br(t);return a.equals=uo,a}function bo(t){var a=t.effects;if(a!==null){t.effects=null;for(var n=0;n<a.length;n+=1)Ua(a[n])}}function sc(t){for(var a=t.parent;a!==null;){if((a.f&Ea)===0)return(a.f&Fn)===0?a:null;a=a.parent}return null}function vi(t){var a,n=Wt;kn(sc(t));try{t.f&=~gs,bo(t),a=Ho(t)}finally{kn(n)}return a}function To(t){var a=vi(t);if(!t.equals(a)&&(t.wv=Wo(),(!Pt?.is_fork||t.deps===null)&&(t.v=a,t.deps===null))){ga(t,ka);return}rs||(yn!==null?(bi()||Pt?.is_fork)&&yn.set(t,a):pi(t))}let ti=new Set;const ns=new Map;let xo=!1;function bs(t,a){var n={f:0,v:t,reactions:null,equals:lo,rv:0,wv:0};return n}function jn(t,a){const n=bs(t);return vc(n),n}function P(t,a=!1,n=!0){const r=bs(t);return a||(r.equals=uo),qs&&n&&ea!==null&&ea.l!==null&&(ea.l.s??=[]).push(r),r}function zr(t,a){return v(t,l(()=>e(t))),a}function v(t,a,n=!1){kt!==null&&(!pn||(kt.f&Li)!==0)&&hr()&&(kt.f&(Ea|zn|fi|Li))!==0&&!Un?.includes(t)&&Rl();let r=n?Ds(a):a;return Ts(t,r)}function Ts(t,a){if(!t.equals(a)){var n=t.v;rs?ns.set(t,a):ns.set(t,n),t.v=a;var r=An.ensure();if(r.capture(t,n),(t.f&Ea)!==0){const s=t;(t.f&Wa)!==0&&vi(s),pi(s)}t.wv=Wo(),_o(t,Wa),hr()&&Wt!==null&&(Wt.f&ka)!==0&&(Wt.f&(Xn|_s))===0&&(rn===null?gc([t]):rn.push(t)),!r.is_fork&&ti.size>0&&!xo&&rc()}return a}function rc(){xo=!1;var t=ys;Dr(!0);const a=Array.from(ti);try{for(const n of a)(n.f&ka)!==0&&ga(n,En),Gs(n)&&Ys(n)}finally{Dr(t)}ti.clear()}function ir(t){v(t,t.v+1)}function _o(t,a){var n=t.reactions;if(n!==null)for(var r=hr(),s=n.length,i=0;i<s;i++){var o=n[i],c=o.f;if(!(!r&&o===Wt)){var m=(c&Wa)===0;if(m&&ga(o,a),(c&Ea)!==0){var f=o;yn?.delete(f),(c&gs)===0&&(c&cn&&(o.f|=gs),_o(f,En))}else m&&((c&zn)!==0&&Nn!==null&&Nn.add(o),Kn(o))}}}function Ds(t){if(typeof t!="object"||t===null||Bn in t)return t;const a=mi(t);if(a!==vl&&a!==gl)return t;var n=new Map,r=mr(t),s=jn(0),i=ps,o=c=>{if(ps===i)return c();var m=kt,f=ps;qa(null),Ni(i);var d=c();return qa(m),Ni(f),d};return r&&n.set("length",jn(t.length)),new Proxy(t,{defineProperty(c,m,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&El();var d=n.get(m);return d===void 0?d=o(()=>{var y=jn(f.value);return n.set(m,y),y}):v(d,f.value,!0),!0},deleteProperty(c,m){var f=n.get(m);if(f===void 0){if(m in c){const d=o(()=>jn(Sa));n.set(m,d),ir(s)}}else v(f,Sa),ir(s);return!0},get(c,m,f){if(m===Bn)return t;var d=n.get(m),y=m in c;if(d===void 0&&(!y||hs(c,m)?.writable)&&(d=o(()=>{var p=Ds(y?c[m]:Sa),g=jn(p);return g}),n.set(m,d)),d!==void 0){var u=e(d);return u===Sa?void 0:u}return Reflect.get(c,m,f)},getOwnPropertyDescriptor(c,m){var f=Reflect.getOwnPropertyDescriptor(c,m);if(f&&"value"in f){var d=n.get(m);d&&(f.value=e(d))}else if(f===void 0){var y=n.get(m),u=y?.v;if(y!==void 0&&u!==Sa)return{enumerable:!0,configurable:!0,value:u,writable:!0}}return f},has(c,m){if(m===Bn)return!0;var f=n.get(m),d=f!==void 0&&f.v!==Sa||Reflect.has(c,m);if(f!==void 0||Wt!==null&&(!d||hs(c,m)?.writable)){f===void 0&&(f=o(()=>{var u=d?Ds(c[m]):Sa,p=jn(u);return p}),n.set(m,f));var y=e(f);if(y===Sa)return!1}return d},set(c,m,f,d){var y=n.get(m),u=m in c;if(r&&m==="length")for(var p=f;p<y.v;p+=1){var g=n.get(p+"");g!==void 0?v(g,Sa):p in c&&(g=o(()=>jn(Sa)),n.set(p+"",g))}if(y===void 0)(!u||hs(c,m)?.writable)&&(y=o(()=>jn(void 0)),v(y,Ds(f)),n.set(m,y));else{u=y.v!==Sa;var _=o(()=>Ds(f));v(y,_)}var x=Reflect.getOwnPropertyDescriptor(c,m);if(x?.set&&x.set.call(d,f),!u){if(r&&typeof m=="string"){var E=n.get("length"),R=Number(m);Number.isInteger(R)&&R>=E.v&&v(E,R+1)}ir(s)}return!0},ownKeys(c){e(s);var m=Reflect.ownKeys(c).filter(y=>{var u=n.get(y);return u===void 0||u.v!==Sa});for(var[f,d]of n)d.v!==Sa&&!(f in c)&&m.push(f);return m},setPrototypeOf(){Ml()}})}function Ii(t){try{if(t!==null&&typeof t=="object"&&Bn in t)return t[Bn]}catch{}return t}function ic(t,a){return Object.is(Ii(t),Ii(a))}var Is,wo,So,Ao;function oc(){if(Is===void 0){Is=window,wo=/Firefox/.test(navigator.userAgent);var t=Element.prototype,a=Node.prototype,n=Text.prototype;So=hs(a,"firstChild").get,Ao=hs(a,"nextSibling").get,Ri(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Ri(n)&&(n.__t=void 0)}}function qn(t=""){return document.createTextNode(t)}function Wn(t){return So.call(t)}function fr(t){return Ao.call(t)}function T(t,a){return Wn(t)}function Te(t,a=!1){{var n=Wn(t);return n instanceof Comment&&n.data===""?fr(n):n}}function b(t,a=1,n=!1){let r=t;for(;a--;)r=fr(r);return r}function lc(t){t.textContent=""}function Co(){return!1}let $i=!1;function cc(){$i||($i=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const a of t.target.elements)a.__on_r?.()})},{capture:!0}))}function qr(t){var a=kt,n=Wt;qa(null),kn(null);try{return t()}finally{qa(a),kn(n)}}function gi(t,a,n,r=n){t.addEventListener(a,()=>qr(n));const s=t.__on_r;s?t.__on_r=()=>{s(),r(!0)}:t.__on_r=()=>r(!0),cc()}function ko(t){Wt===null&&(kt===null&&Al(),Sl()),rs&&wl()}function uc(t,a){var n=a.last;n===null?a.last=a.first=t:(n.next=t,t.prev=n,a.last=t)}function Mn(t,a,n){var r=Wt;r!==null&&(r.f&Ja)!==0&&(t|=Ja);var s={ctx:ea,deps:null,nodes:null,f:t|Wa|cn,first:null,fn:a,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{Ys(s),s.f|=hi}catch(c){throw Ua(s),c}else a!==null&&Kn(s);var i=s;if(n&&i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&Bs)===0&&(i=i.first,(t&zn)!==0&&(t&Ns)!==0&&i!==null&&(i.f|=Ns)),i!==null&&(i.parent=r,r!==null&&uc(i,r),kt!==null&&(kt.f&Ea)!==0&&(t&_s)===0)){var o=kt;(o.effects??=[]).push(i)}return s}function bi(){return kt!==null&&!pn}function yr(t){const a=Mn(dr,null,!1);return ga(a,ka),a.teardown=t,a}function ai(t){ko();var a=Wt.f,n=!kt&&(a&Xn)!==0&&(a&hi)===0;if(n){var r=ea;(r.e??=[]).push(t)}else return Eo(t)}function Eo(t){return Mn(Rr|ro,t,!1)}function mc(t){return ko(),Mn(dr|ro,t,!0)}function dc(t){An.ensure();const a=Mn(_s|Bs,t,!0);return(n={})=>new Promise(r=>{n.outro?fs(a,()=>{Ua(a),r(void 0)}):(Ua(a),r(void 0))})}function Mo(t){return Mn(Rr,t,!1)}function pe(t,a){var n=ea,r={effect:null,ran:!1,deps:t};n.l.$.push(r),r.effect=Ks(()=>{t(),!r.ran&&(r.ran=!0,l(a))})}function Rn(){var t=ea;Ks(()=>{for(var a of t.l.$){a.deps();var n=a.effect;(n.f&ka)!==0&&n.deps!==null&&ga(n,En),Gs(n)&&Ys(n),a.ran=!1}})}function hc(t){return Mn(fi|Bs,t,!0)}function Ks(t,a=0){return Mn(dr|a,t,!0)}function K(t,a=[],n=[],r=[]){tc(r,a,n,s=>{Mn(dr,()=>t(...s.map(e)),!0)})}function Ti(t,a=0){var n=Mn(zn|a,t,!0);return n}function ln(t){return Mn(Xn|Bs,t,!0)}function Ro(t){var a=t.teardown;if(a!==null){const n=rs,r=kt;Pi(!0),qa(null);try{a.call(null)}finally{Pi(n),qa(r)}}}function Lo(t,a=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const s=n.ac;s!==null&&qr(()=>{s.abort(Ls)});var r=n.next;(n.f&_s)!==0?n.parent=null:Ua(n,a),n=r}}function fc(t){for(var a=t.first;a!==null;){var n=a.next;(a.f&Xn)===0&&Ua(a),a=n}}function Ua(t,a=!0){var n=!1;(a||(t.f&so)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(yc(t.nodes.start,t.nodes.end),n=!0),Lo(t,a&&!n),Ir(t,0),ga(t,Fn);var r=t.nodes&&t.nodes.t;if(r!==null)for(const i of r)i.stop();Ro(t);var s=t.parent;s!==null&&s.first!==null&&Do(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function yc(t,a){for(;t!==null;){var n=t===a?null:fr(t);t.remove(),t=n}}function Do(t){var a=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),a!==null&&(a.first===t&&(a.first=r),a.last===t&&(a.last=n))}function fs(t,a,n=!0){var r=[];Io(t,r,!0);var s=()=>{n&&Ua(t),a&&a()},i=r.length;if(i>0){var o=()=>--i||s();for(var c of r)c.out(o)}else s()}function Io(t,a,n){if((t.f&Ja)===0){t.f^=Ja;var r=t.nodes&&t.nodes.t;if(r!==null)for(const c of r)(c.is_global||n)&&a.push(c);for(var s=t.first;s!==null;){var i=s.next,o=(s.f&Ns)!==0||(s.f&Xn)!==0&&(t.f&zn)!==0;Io(s,a,o?n:!1),s=i}}}function xi(t){$o(t,!0)}function $o(t,a){if((t.f&Ja)!==0){t.f^=Ja,(t.f&ka)===0&&(ga(t,Wa),Kn(t));for(var n=t.first;n!==null;){var r=n.next,s=(n.f&Ns)!==0||(n.f&Xn)!==0;$o(n,s?a:!1),n=r}var i=t.nodes&&t.nodes.t;if(i!==null)for(const o of i)(o.is_global||a)&&o.in()}}function Po(t,a){if(t.nodes)for(var n=t.nodes.start,r=t.nodes.end;n!==null;){var s=n===r?null:fr(n);a.append(n),n=s}}let Rs=null;function pc(t){var a=Rs;try{if(Rs=new Set,l(t),a!==null)for(var n of Rs)a.add(n);return Rs}finally{Rs=a}}function No(t){for(var a of pc(t))Ts(a,a.v)}let ys=!1;function Dr(t){ys=t}let rs=!1;function Pi(t){rs=t}let kt=null,pn=!1;function qa(t){kt=t}let Wt=null;function kn(t){Wt=t}let Un=null;function vc(t){kt!==null&&(Un===null?Un=[t]:Un.push(t))}let Pa=null,ja=0,rn=null;function gc(t){rn=t}let Oo=1,cr=0,ps=cr;function Ni(t){ps=t}function Wo(){return++Oo}function Gs(t){var a=t.f;if((a&Wa)!==0)return!0;if(a&Ea&&(t.f&=~gs),(a&En)!==0){for(var n=t.deps,r=n.length,s=0;s<r;s++){var i=n[s];if(Gs(i)&&To(i),i.wv>t.wv)return!0}(a&cn)!==0&&yn===null&&ga(t,ka)}return!1}function Yo(t,a,n=!0){var r=t.reactions;if(r!==null&&!Un?.includes(t))for(var s=0;s<r.length;s++){var i=r[s];(i.f&Ea)!==0?Yo(i,a,!1):a===i&&(n?ga(i,Wa):(i.f&ka)!==0&&ga(i,En),Kn(i))}}function Ho(t){var a=Pa,n=ja,r=rn,s=kt,i=Un,o=ea,c=pn,m=ps,f=t.f;Pa=null,ja=0,rn=null,kt=(f&(Xn|_s))===0?t:null,Un=null,Os(t.ctx),pn=!1,ps=++cr,t.ac!==null&&(qr(()=>{t.ac.abort(Ls)}),t.ac=null);try{t.f|=Jr;var d=t.fn,y=d(),u=t.deps;if(Pa!==null){var p;if(Ir(t,ja),u!==null&&ja>0)for(u.length=ja+Pa.length,p=0;p<Pa.length;p++)u[ja+p]=Pa[p];else t.deps=u=Pa;if(bi()&&(t.f&cn)!==0)for(p=ja;p<u.length;p++)(u[p].reactions??=[]).push(t)}else u!==null&&ja<u.length&&(Ir(t,ja),u.length=ja);if(hr()&&rn!==null&&!pn&&u!==null&&(t.f&(Ea|En|Wa))===0)for(p=0;p<rn.length;p++)Yo(rn[p],t);return s!==null&&s!==t&&(cr++,rn!==null&&(r===null?r=rn:r.push(...rn))),(t.f&as)!==0&&(t.f^=as),y}catch(g){return ho(g)}finally{t.f^=Jr,Pa=a,ja=n,rn=r,kt=s,Un=i,Os(o),pn=c,ps=m}}function bc(t,a){let n=a.reactions;if(n!==null){var r=pl.call(n,t);if(r!==-1){var s=n.length-1;s===0?n=a.reactions=null:(n[r]=n[s],n.pop())}}if(n===null&&(a.f&Ea)!==0&&(Pa===null||!Pa.includes(a))){var i=a;(i.f&cn)!==0&&(i.f^=cn,i.f&=~gs),pi(i),bo(i),Ir(i,0)}}function Ir(t,a){var n=t.deps;if(n!==null)for(var r=a;r<n.length;r++)bc(t,n[r])}function Ys(t){var a=t.f;if((a&Fn)===0){ga(t,ka);var n=Wt,r=ys;Wt=t,ys=!0;try{(a&(zn|no))!==0?fc(t):Lo(t),Ro(t);var s=Ho(t);t.teardown=typeof s=="function"?s:null,t.wv=Oo;var i;Qr&&Kl&&(t.f&Wa)!==0&&t.deps}finally{ys=r,Wt=n}}}async function Tc(){await Promise.resolve(),Vl()}function e(t){var a=t.f,n=(a&Ea)!==0;if(Rs?.add(t),kt!==null&&!pn){var r=Wt!==null&&(Wt.f&Fn)!==0;if(!r&&!Un?.includes(t)){var s=kt.deps;if((kt.f&Jr)!==0)t.rv<cr&&(t.rv=cr,Pa===null&&s!==null&&s[ja]===t?ja++:Pa===null?Pa=[t]:Pa.includes(t)||Pa.push(t));else{(kt.deps??=[]).push(t);var i=t.reactions;i===null?t.reactions=[kt]:i.includes(kt)||i.push(kt)}}}if(rs&&ns.has(t))return ns.get(t);if(n){var o=t;if(rs){var c=o.v;return((o.f&ka)===0&&o.reactions!==null||Bo(o))&&(c=vi(o)),ns.set(o,c),c}var m=(o.f&cn)===0&&!pn&&kt!==null&&(ys||(kt.f&cn)!==0),f=o.deps===null;Gs(o)&&(m&&(o.f|=cn),To(o)),m&&!f&&Fo(o)}if(yn?.has(t))return yn.get(t);if((t.f&as)!==0)throw t.v;return t.v}function Fo(t){if(t.deps!==null){t.f|=cn;for(const a of t.deps)(a.reactions??=[]).push(t),(a.f&Ea)!==0&&(a.f&cn)===0&&Fo(a)}}function Bo(t){if(t.v===Sa)return!0;if(t.deps===null)return!1;for(const a of t.deps)if(ns.has(a)||(a.f&Ea)!==0&&Bo(a))return!0;return!1}function l(t){var a=pn;try{return pn=!0,t()}finally{pn=a}}function j(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Bn in t)ni(t);else if(!Array.isArray(t))for(let a in t){const n=t[a];typeof n=="object"&&n&&Bn in n&&ni(n)}}}function ni(t,a=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!a.has(t)){a.add(t),t instanceof Date&&t.getTime();for(let r in t)try{ni(t[r],a)}catch{}const n=mi(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=to(n);for(let s in r){const i=r[s].get;if(i)try{i.call(t)}catch{}}}}}const xc=["touchstart","touchmove"];function _c(t){return xc.includes(t)}const wc=new Set,Oi=new Set;function Sc(t,a,n,r={}){function s(i){if(r.capture||er.call(a,i),!i.cancelBubble)return qr(()=>n?.call(this,i))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Us(()=>{a.addEventListener(t,s,r)}):a.addEventListener(t,s,r),s}function V(t,a,n,r,s){var i={capture:r,passive:s},o=Sc(t,a,n,i);(a===document.body||a===window||a===document||a instanceof HTMLMediaElement)&&yr(()=>{a.removeEventListener(t,o,i)})}let Wi=null;function er(t){var a=this,n=a.ownerDocument,r=t.type,s=t.composedPath?.()||[],i=s[0]||t.target;Wi=t;var o=0,c=Wi===t&&t.__root;if(c){var m=s.indexOf(c);if(m!==-1&&(a===document||a===window)){t.__root=a;return}var f=s.indexOf(a);if(f===-1)return;m<=f&&(o=m)}if(i=s[o]||t.target,i!==a){eo(t,"currentTarget",{configurable:!0,get(){return i||n}});var d=kt,y=Wt;qa(null),kn(null);try{for(var u,p=[];i!==null;){var g=i.assignedSlot||i.parentNode||i.host||null;try{var _=i["__"+r];_!=null&&(!i.disabled||t.target===i)&&_.call(i,t)}catch(x){u?p.push(x):u=x}if(t.cancelBubble||g===a||g===null)break;i=g}if(u){for(let x of p)queueMicrotask(()=>{throw x});throw u}}finally{t.__root=a,delete t.currentTarget,qa(d),kn(y)}}}function qo(t){var a=document.createElement("template");return a.innerHTML=t.replaceAll("<!>","<!---->"),a.content}function Hs(t,a){var n=Wt;n.nodes===null&&(n.nodes={start:t,end:a,a:null,t:null})}function ge(t,a){var n=(a&oo)!==0,r=(a&Fl)!==0,s,i=!t.startsWith("<!>");return()=>{s===void 0&&(s=qo(i?t:"<!>"+t),n||(s=Wn(s)));var o=r||wo?document.importNode(s,!0):s.cloneNode(!0);if(n){var c=Wn(o),m=o.lastChild;Hs(c,m)}else Hs(o,o);return o}}function Ac(t,a,n="svg"){var r=!t.startsWith("<!>"),s=(a&oo)!==0,i=`<${n}>${r?t:"<!>"+t}</${n}>`,o;return()=>{if(!o){var c=qo(i),m=Wn(c);if(s)for(o=document.createDocumentFragment();Wn(m);)o.appendChild(Wn(m));else o=Wn(m)}var f=o.cloneNode(!0);if(s){var d=Wn(f),y=f.lastChild;Hs(d,y)}else Hs(f,f);return f}}function he(t,a){return Ac(t,a,"svg")}function _i(t=""){{var a=qn(t+"");return Hs(a,a),a}}function ft(){var t=document.createDocumentFragment(),a=document.createComment(""),n=qn();return t.append(a,n),Hs(a,n),t}function C(t,a){t!==null&&t.before(a)}function Le(t,a){var n=a==null?"":typeof a=="object"?a+"":a;n!==(t.__t??=t.nodeValue)&&(t.__t=n,t.nodeValue=n+"")}function Cc(t,a){return kc(t,a)}const ks=new Map;function kc(t,{target:a,anchor:n,props:r={},events:s,context:i,intro:o=!0}){oc();var c=new Set,m=y=>{for(var u=0;u<y.length;u++){var p=y[u];if(!c.has(p)){c.add(p);var g=_c(p);a.addEventListener(p,er,{passive:g});var _=ks.get(p);_===void 0?(document.addEventListener(p,er,{passive:g}),ks.set(p,1)):ks.set(p,_+1)}}};m(Yr(wc)),Oi.add(m);var f=void 0,d=dc(()=>{var y=n??a.appendChild(qn());return Jl(y,{pending:()=>{}},u=>{if(i){Ka({});var p=ea;p.c=i}s&&(r.$$events=s),f=t(u,r)||{},i&&Ga()}),()=>{for(var u of c){a.removeEventListener(u,er);var p=ks.get(u);--p===0?(document.removeEventListener(u,er),ks.delete(u)):ks.set(u,p)}Oi.delete(m),y!==n&&y.parentNode?.removeChild(y)}});return Ec.set(f,d),f}let Ec=new WeakMap;class Mc{anchor;#t=new Map;#i=new Map;#e=new Map;#s=new Set;#r=!0;constructor(a,n=!0){this.anchor=a,this.#r=n}#n=()=>{var a=Pt;if(this.#t.has(a)){var n=this.#t.get(a),r=this.#i.get(n);if(r)xi(r),this.#s.delete(n);else{var s=this.#e.get(n);s&&(this.#i.set(n,s.effect),this.#e.delete(n),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),r=s.effect)}for(const[i,o]of this.#t){if(this.#t.delete(i),i===a)break;const c=this.#e.get(o);c&&(Ua(c.effect),this.#e.delete(o))}for(const[i,o]of this.#i){if(i===n||this.#s.has(i))continue;const c=()=>{if(Array.from(this.#t.values()).includes(i)){var f=document.createDocumentFragment();Po(o,f),f.append(qn()),this.#e.set(i,{effect:o,fragment:f})}else Ua(o);this.#s.delete(i),this.#i.delete(i)};this.#r||!r?(this.#s.add(i),fs(o,c,!1)):c()}}};#a=a=>{this.#t.delete(a);const n=Array.from(this.#t.values());for(const[r,s]of this.#e)n.includes(r)||(Ua(s.effect),this.#e.delete(r))};ensure(a,n){var r=Pt,s=Co();if(n&&!this.#i.has(a)&&!this.#e.has(a))if(s){var i=document.createDocumentFragment(),o=qn();i.append(o),this.#e.set(a,{effect:ln(()=>n(o)),fragment:i})}else this.#i.set(a,ln(()=>n(this.anchor)));if(this.#t.set(r,a),s){for(const[c,m]of this.#i)c===a?r.skipped_effects.delete(m):r.skipped_effects.add(m);for(const[c,m]of this.#e)c===a?r.skipped_effects.delete(m.effect):r.skipped_effects.add(m.effect);r.oncommit(this.#n),r.ondiscard(this.#a)}else this.#n()}}function ee(t,a,n=!1){var r=new Mc(t),s=n?Ns:0;function i(o,c){r.ensure(o,c)}Ti(()=>{var o=!1;a((c,m=!0)=>{o=!0,i(m,c)}),o||i(!1,null)},s)}function it(t,a){return a}function Rc(t,a,n){for(var r=[],s=a.length,i,o=a.length,c=0;c<s;c++){let y=a[c];fs(y,()=>{if(i){if(i.pending.delete(y),i.done.add(y),i.pending.size===0){var u=t.outrogroups;si(Yr(i.done)),u.delete(i),u.size===0&&(t.outrogroups=null)}}else o-=1},!1)}if(o===0){var m=r.length===0&&n!==null;if(m){var f=n,d=f.parentNode;lc(d),d.append(f),t.items.clear()}si(a,!m)}else i={pending:new Set(a),done:new Set},(t.outrogroups??=new Set).add(i)}function si(t,a=!0){for(var n=0;n<t.length;n++)Ua(t[n],a)}var Yi;function He(t,a,n,r,s,i=null){var o=t,c=new Map,m=(a&io)!==0;if(m){var f=t;o=f.appendChild(qn())}var d=null,y=$e(()=>{var E=n();return mr(E)?E:E==null?[]:Yr(E)}),u,p=!0;function g(){x.fallback=d,Lc(x,u,o,a,r),d!==null&&(u.length===0?(d.f&Hn)===0?xi(d):(d.f^=Hn,tr(d,null,o)):fs(d,()=>{d=null}))}var _=Ti(()=>{u=e(y);for(var E=u.length,R=new Set,L=Pt,S=Co(),A=0;A<E;A+=1){var M=u[A],D=r(M,A),k=p?null:c.get(D);k?(k.v&&Ts(k.v,M),k.i&&Ts(k.i,A),S&&L.skipped_effects.delete(k.e)):(k=Dc(c,p?o:Yi??=qn(),M,D,A,s,a,n),p||(k.e.f|=Hn),c.set(D,k)),R.add(D)}if(E===0&&i&&!d&&(p?d=ln(()=>i(o)):(d=ln(()=>i(Yi??=qn())),d.f|=Hn)),!p)if(S){for(const[I,U]of c)R.has(I)||L.skipped_effects.add(U.e);L.oncommit(g),L.ondiscard(()=>{})}else g();e(y)}),x={effect:_,items:c,outrogroups:null,fallback:d};p=!1}function Lc(t,a,n,r,s){var i=(r&$l)!==0,o=a.length,c=t.items,m=t.effect.first,f,d=null,y,u=[],p=[],g,_,x,E;if(i)for(E=0;E<o;E+=1)g=a[E],_=s(g,E),x=c.get(_).e,(x.f&Hn)===0&&(x.nodes?.a?.measure(),(y??=new Set).add(x));for(E=0;E<o;E+=1){if(g=a[E],_=s(g,E),x=c.get(_).e,t.outrogroups!==null)for(const U of t.outrogroups)U.pending.delete(x),U.done.delete(x);if((x.f&Hn)!==0)if(x.f^=Hn,x===m)tr(x,null,n);else{var R=d?d.next:m;x===t.effect.last&&(t.effect.last=x.prev),x.prev&&(x.prev.next=x.next),x.next&&(x.next.prev=x.prev),Zn(t,d,x),Zn(t,x,R),tr(x,R,n),d=x,u=[],p=[],m=d.next;continue}if((x.f&Ja)!==0&&(xi(x),i&&(x.nodes?.a?.unfix(),(y??=new Set).delete(x))),x!==m){if(f!==void 0&&f.has(x)){if(u.length<p.length){var L=p[0],S;d=L.prev;var A=u[0],M=u[u.length-1];for(S=0;S<u.length;S+=1)tr(u[S],L,n);for(S=0;S<p.length;S+=1)f.delete(p[S]);Zn(t,A.prev,M.next),Zn(t,d,A),Zn(t,M,L),m=L,d=M,E-=1,u=[],p=[]}else f.delete(x),tr(x,m,n),Zn(t,x.prev,x.next),Zn(t,x,d===null?t.effect.first:d.next),Zn(t,d,x),d=x;continue}for(u=[],p=[];m!==null&&m!==x;)(f??=new Set).add(m),p.push(m),m=m.next;if(m===null)continue}(x.f&Hn)===0&&u.push(x),d=x,m=x.next}if(t.outrogroups!==null){for(const U of t.outrogroups)U.pending.size===0&&(si(Yr(U.done)),t.outrogroups?.delete(U));t.outrogroups.size===0&&(t.outrogroups=null)}if(m!==null||f!==void 0){var D=[];if(f!==void 0)for(x of f)(x.f&Ja)===0&&D.push(x);for(;m!==null;)(m.f&Ja)===0&&m!==t.fallback&&D.push(m),m=m.next;var k=D.length;if(k>0){var I=(r&io)!==0&&o===0?n:null;if(i){for(E=0;E<k;E+=1)D[E].nodes?.a?.measure();for(E=0;E<k;E+=1)D[E].nodes?.a?.fix()}Rc(t,D,I)}}i&&Us(()=>{if(y!==void 0)for(x of y)x.nodes?.a?.apply()})}function Dc(t,a,n,r,s,i,o,c){var m=(o&Dl)!==0?(o&Pl)===0?P(n,!1,!1):bs(n):null,f=(o&Il)!==0?bs(s):null;return{v:m,i:f,e:ln(()=>(i(a,m??n,f??s,c),()=>{t.delete(r)}))}}function tr(t,a,n){if(t.nodes)for(var r=t.nodes.start,s=t.nodes.end,i=a&&(a.f&Hn)===0?a.nodes.start:n;r!==null;){var o=fr(r);if(i.before(r),r===s)return;r=o}}function Zn(t,a,n){a===null?t.effect.first=n:a.next=n,n===null?t.effect.last=a:n.prev=a}function Uo(t,a,n,r,s){var i=a.$$slots?.[n],o=!1;i===!0&&(i=a.children,o=!0),i===void 0||i(t,o?()=>r:r)}const Hi=[...` 	
\r\fÂ \v\uFEFF`];function Ic(t,a,n){var r=t==null?"":""+t;if(n){for(var s in n)if(n[s])r=r?r+" "+s:s;else if(r.length)for(var i=s.length,o=0;(o=r.indexOf(s,o))>=0;){var c=o+i;(o===0||Hi.includes(r[o-1]))&&(c===r.length||Hi.includes(r[c]))?r=(o===0?"":r.substring(0,o))+r.substring(c+1):o=c}}return r===""?null:r}function $c(t,a){return t==null?null:String(t)}function Ca(t,a,n,r,s,i){var o=t.__className;if(o!==n||o===void 0){var c=Ic(n,r,i);c==null?t.removeAttribute("class"):a?t.className=c:t.setAttribute("class",c),t.__className=n}else if(i&&s!==i)for(var m in i){var f=!!i[m];(s==null||f!==!!s[m])&&t.classList.toggle(m,f)}return i}function Pc(t,a,n,r){var s=t.__style;if(s!==a){var i=$c(a);i==null?t.removeAttribute("style"):t.style.cssText=i,t.__style=a}return r}function Ko(t,a,n=!1){if(t.multiple){if(a==null)return;if(!mr(a))return ql();for(var r of t.options)r.selected=a.includes(or(r));return}for(r of t.options){var s=or(r);if(ic(s,a)){r.selected=!0;return}}(!n||a!==void 0)&&(t.selectedIndex=-1)}function Nc(t){var a=new MutationObserver(()=>{Ko(t,t.__value)});a.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),yr(()=>{a.disconnect()})}function Go(t,a,n=a){var r=new WeakSet,s=!0;gi(t,"change",i=>{var o=i?"[selected]":":checked",c;if(t.multiple)c=[].map.call(t.querySelectorAll(o),or);else{var m=t.querySelector(o)??t.querySelector("option:not([disabled])");c=m&&or(m)}n(c),Pt!==null&&r.add(Pt)}),Mo(()=>{var i=a();if(t===document.activeElement){var o=sr??Pt;if(r.has(o))return}if(Ko(t,i,s),s&&i===void 0){var c=t.querySelector(":checked");c!==null&&(i=or(c),n(i))}t.__value=i,s=!1}),Nc(t)}function or(t){return"__value"in t?t.__value:t.value}const Oc=Symbol("is custom element"),Wc=Symbol("is html");function zo(t,a){var n=Xo(t);n.value===(n.value=a??void 0)||t.value===a&&(a!==0||t.nodeName!=="PROGRESS")||(t.value=a??"")}function h(t,a,n,r){var s=Xo(t);s[a]!==(s[a]=n)&&(a==="loading"&&(t[xl]=n),n==null?t.removeAttribute(a):typeof n!="string"&&Yc(t).includes(a)?t[a]=n:t.setAttribute(a,n))}function Xo(t){return t.__attributes??={[Oc]:t.nodeName.includes("-"),[Wc]:t.namespaceURI===Bl}}var Fi=new Map;function Yc(t){var a=t.getAttribute("is")||t.nodeName,n=Fi.get(a);if(n)return n;Fi.set(a,n=[]);for(var r,s=t,i=Element.prototype;i!==s;){r=to(s);for(var o in r)r[o].set&&n.push(o);s=mi(s)}return n}function Ia(t,a,n=a){var r=new WeakSet;gi(t,"input",async s=>{var i=s?t.defaultValue:t.value;if(i=Xr(t)?Vr(i):i,n(i),Pt!==null&&r.add(Pt),await Tc(),i!==(i=a())){var o=t.selectionStart,c=t.selectionEnd,m=t.value.length;if(t.value=i??"",c!==null){var f=t.value.length;o===c&&c===m&&f>m?(t.selectionStart=f,t.selectionEnd=f):(t.selectionStart=o,t.selectionEnd=Math.min(c,f))}}}),l(a)==null&&t.value&&(n(Xr(t)?Vr(t.value):t.value),Pt!==null&&r.add(Pt)),Ks(()=>{var s=a();if(t===document.activeElement){var i=sr??Pt;if(r.has(i))return}Xr(t)&&s===Vr(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function _a(t,a,n=a){gi(t,"change",r=>{var s=r?t.defaultChecked:t.checked;n(s)}),l(a)==null&&n(t.checked),Ks(()=>{var r=a();t.checked=!!r})}function Xr(t){var a=t.type;return a==="number"||a==="range"}function Vr(t){return t===""?null:+t}function ar(t,a,n){var r=hs(t,a);r&&r.set&&(t[a]=n,yr(()=>{t[a]=null}))}function Bi(t,a){return t===a||t?.[Bn]===a}function $r(t={},a,n,r){return Mo(()=>{var s,i;return Ks(()=>{s=i,i=[],l(()=>{t!==n(...i)&&(a(t,...i),s&&Bi(n(...s),t)&&a(null,...s))})}),()=>{Us(()=>{i&&Bi(n(...i),t)&&a(null,...i)})}}),t}function qi(t){return function(...a){var n=a[0];return n.stopPropagation(),t?.apply(this,a)}}function en(t=!1){const a=ea,n=a.l.u;if(!n)return;let r=()=>j(a.s);if(t){let s=0,i={};const o=Br(()=>{let c=!1;const m=a.s;for(const f in m)m[f]!==i[f]&&(i[f]=m[f],c=!0);return c&&s++,s});r=()=>e(o)}n.b.length&&mc(()=>{Ui(a,r),Mr(n.b)}),ai(()=>{const s=l(()=>n.m.map(bl));return()=>{for(const i of s)typeof i=="function"&&i()}}),n.a.length&&ai(()=>{Ui(a,r),Mr(n.a)})}function Ui(t,a){if(t.l.s)for(const n of t.l.s)e(n);a()}function Ki(t,a){var n=t.$$events?.[a.type],r=mr(n)?n.slice():n==null?[]:[n];for(var s of r)s.call(this,a)}function wi(t,a,n){if(t==null)return a(void 0),n&&n(void 0),ts;const r=l(()=>t.subscribe(a,n));return r.unsubscribe?()=>r.unsubscribe():r}const Es=[];function Hc(t,a){return{subscribe:oa(t,a).subscribe}}function oa(t,a=ts){let n=null;const r=new Set;function s(c){if(co(t,c)&&(t=c,n)){const m=!Es.length;for(const f of r)f[1](),Es.push(f,t);if(m){for(let f=0;f<Es.length;f+=2)Es[f][0](Es[f+1]);Es.length=0}}}function i(c){s(c(t))}function o(c,m=ts){const f=[c,m];return r.add(f),r.size===1&&(n=a(s,i)||ts),c(t),()=>{r.delete(f),r.size===0&&n&&(n(),n=null)}}return{set:s,update:i,subscribe:o}}function Vn(t,a,n){const r=!Array.isArray(t),s=r?[t]:t;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=a.length<2;return Hc(n,(o,c)=>{let m=!1;const f=[];let d=0,y=ts;const u=()=>{if(d)return;y();const g=a(r?f[0]:f,o,c);i?o(g):y=typeof g=="function"?g:ts},p=s.map((g,_)=>wi(g,x=>{f[_]=x,d&=~(1<<_),m&&u()},()=>{d|=1<<_}));return m=!0,u(),function(){Mr(p),y(),m=!1}})}function vn(t){let a;return wi(t,n=>a=n)(),a}let Tr=!1,ri=Symbol();function Nt(t,a,n){const r=n[a]??={store:null,source:P(void 0),unsubscribe:ts};if(r.store!==t&&!(ri in n))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=ts;else{var s=!0;r.unsubscribe=wi(t,i=>{s?r.source.v=i:v(r.source,i)}),s=!1}return t&&ri in n?vn(t):e(r.source)}function Fc(t,a){return t.set(a),a}function zs(){const t={};function a(){yr(()=>{for(var n in t)t[n].unsubscribe();eo(t,ri,{enumerable:!1,value:!0})})}return[t,a]}function Bc(t){var a=Tr;try{return Tr=!1,[t(),Tr]}finally{Tr=a}}function ze(t,a,n,r){var s=!qs||(n&Ol)!==0,i=(n&Yl)!==0,o=(n&Hl)!==0,c=r,m=!0,f=()=>(m&&(m=!1,c=o?l(r):r),c),d;if(i){var y=Bn in t||Tl in t;d=hs(t,a)?.set??(y&&a in t?L=>t[a]=L:void 0)}var u,p=!1;i?[u,p]=Bc(()=>t[a]):u=t[a],u===void 0&&r!==void 0&&(u=f(),d&&(s&&kl(),d(u)));var g;if(s?g=()=>{var L=t[a];return L===void 0?f():(m=!0,L)}:g=()=>{var L=t[a];return L!==void 0&&(c=void 0),L===void 0?c:L},s&&(n&Wl)===0)return g;if(d){var _=t.$$legacy;return(function(L,S){return arguments.length>0?((!s||!S||_||p)&&d(S?g():L),L):g()})}var x=!1,E=((n&Nl)!==0?Br:$e)(()=>(x=!1,g()));i&&e(E);var R=Wt;return(function(L,S){if(arguments.length>0){const A=S?e(E):s&&i?Ds(L):L;return v(E,A),x=!0,c!==void 0&&(c=A),L}return rs&&x||(R.f&Fn)!==0?E.v:e(E)})}function ws(t){ea===null&&yi(),qs&&ea.l!==null?Uc(ea).m.push(t):ai(()=>{const a=l(t);if(typeof a=="function")return a})}function Si(t){ea===null&&yi(),ws(()=>()=>l(t))}function qc(t,a,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:a,bubbles:n,cancelable:r})}function Vo(){const t=ea;return t===null&&yi(),(a,n,r)=>{const s=t.s.$$events?.[a];if(s){const i=mr(s)?s.slice():[s],o=qc(a,n,r);for(const c of i)c.call(t.x,o);return!o.defaultPrevented}return!0}}function Uc(t){var a=t.l;return a.u??={a:[],b:[],m:[]}}const Kc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Kc);Gl();function Gc(t,a,n,r){const s=$s(n,r,t),i=$s(n,r,a),o=$s(t,a,n),c=$s(t,a,r);return!!((s>0&&i<0||s<0&&i>0)&&(o>0&&c<0||o<0&&c>0)||s===0&&xr(n,r,t)||i===0&&xr(n,r,a)||o===0&&xr(t,a,n)||c===0&&xr(t,a,r))}function $s(t,a,n){return(n.x-t.x)*(a.y-t.y)-(a.x-t.x)*(n.y-t.y)}function xr(t,a,n){return Math.min(t.x,a.x)<=n.x&&n.x<=Math.max(t.x,a.x)&&Math.min(t.y,a.y)<=n.y&&n.y<=Math.max(t.y,a.y)}function Gi(t,a,n,r=16){const s=[];for(let i=0;i<r;i++){const o=2*Math.PI*i/r;s.push({x:t+n*Math.cos(o),y:a+n*Math.sin(o)})}return s}function zc(t,a,n,r,s=0,i=16){const o=[],c=2*(n+r),m=s*Math.PI/180,f=Math.cos(m),d=Math.sin(m),y=i/c,u=Math.max(1,Math.round(n*y)),p=Math.max(1,Math.round(r*y)),g=n/2,_=r/2,x=[];for(let E=0;E<u;E++){const R=E/u;x.push({x:-g+n*R,y:-_})}for(let E=0;E<p;E++){const R=E/p;x.push({x:g,y:-_+r*R})}for(let E=0;E<u;E++){const R=E/u;x.push({x:g-n*R,y:_})}for(let E=0;E<p;E++){const R=E/p;x.push({x:-g,y:_-r*R})}for(const E of x)o.push({x:t+E.x*f-E.y*d,y:a+E.x*d+E.y*f});if(o.length>i){const E=[],R=o.length/i;for(let L=0;L<i;L++)E.push(o[Math.floor(L*R)]);return E}return o}function Xc(t,a,n,r,s=0,i=16){const o=[],c=s*Math.PI/180,m=Math.cos(c),f=Math.sin(c);for(let d=0;d<i;d++){const y=2*Math.PI*d/i,u=n*Math.cos(y),p=r*Math.sin(y);o.push({x:t+u*m-p*f,y:a+u*f+p*m})}return o}function zi(t,a,n){const r=n.length;for(let s=0;s<r;s++){const i=n[s],o=n[(s+1)%r];if(Gc(t,a,i,o))return!0}return!1}function jo(t,a,n){const r=n*Math.PI/180,s=Math.cos(r),i=Math.sin(r),o=t.x-a.x,c=t.y-a.y;return{x:a.x+o*s-c*i,y:a.y+o*i+c*s}}function Zo(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function xs(t){const a=Zo(t),n=t.rotation||0;return[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}].map(s=>jo(s,a,n))}function Vc(t){const s=t.x,i=t.y+t.height;return[{x:s,y:i},{x:s,y:i-8},{x:s+.5,y:i-8},{x:s+.5,y:i-.5},{x:s+4,y:i-.5},{x:s+4,y:i}]}function jc(t){const a=Vc(t),n=Zo(t),r=t.rotation||0;return a.map(s=>jo(s,n,r))}function Pr(t,a){const n=a.length;let r=null;for(let s=0;s<n;s++){const i=a[s],o=a[(s+1)%n],c=(o.x-i.x)*(t.y-i.y)-(o.y-i.y)*(t.x-i.x);if(c!==0){const m=c>0;if(r===null)r=m;else if(r!==m)return!1}}return!0}function Zc(t,a,n,r,s=.01){const i=Math.abs($s(t,a,n)),o=Math.abs($s(t,a,r)),c=Math.sqrt((a.x-t.x)**2+(a.y-t.y)**2),m=s*c;if(i>m||o>m)return!1;const f=a.x-t.x,d=a.y-t.y,y=Math.sqrt(f*f+d*d);if(y<s)return!1;const u=f/y,p=d/y,g=0,_=y,x=(n.x-t.x)*u+(n.y-t.y)*p,E=(r.x-t.x)*u+(r.y-t.y)*p,R=Math.min(g,_),L=Math.max(g,_),S=Math.min(x,E),A=Math.max(x,E),M=Math.max(R,S);return Math.min(L,A)-M>s}function Qc(t,a,n=.1){const r=t.length,s=a.length;for(let i=0;i<r;i++){const o=t[i],c=t[(i+1)%r];for(let m=0;m<s;m++){const f=a[m],d=a[(m+1)%s];if(Zc(o,c,f,d,n))return!0}}return!1}function Jc(t){const a=t.length;if(a===0)return new Map;const n=Array.from({length:a},(c,m)=>m);function r(c){return n[c]!==c&&(n[c]=r(n[c])),n[c]}function s(c,m){const f=r(c),d=r(m);f!==d&&(n[f]=d)}for(let c=0;c<a;c++)for(let m=c+1;m<a;m++)Qc(t[c].vertices,t[m].vertices)&&s(c,m);const i=new Map;t.forEach((c,m)=>i.set(c.id,m));const o=new Map;return t.forEach((c,m)=>{o.set(c.id,r(m))}),o}function eu(t,a,n){const r=a.get(t);return r===void 0?[t]:n.filter(s=>a.get(s.id)===r).map(s=>s.id)}const _r=16;function Nr(t){return t.isRectangle&&t.width!==void 0&&t.height!==void 0?zc(t.x,t.y,t.width,t.height,t.rotation||0,_r):t.radius!==void 0?Gi(t.x,t.y,t.radius,_r):t.rx!==void 0&&t.ry!==void 0?Xc(t.x,t.y,t.rx,t.ry,t.rotation||0,_r):Gi(t.x,t.y,.5,_r)}function tu(t,a){const n=Nr(t);for(const r of n)if(Pr(r,a))return!0;return!!Pr({x:t.x,y:t.y},a)}function au(t,a){if(!Pr({x:t.x,y:t.y},a))return!1;const n=Nr(t);for(const r of n)if(!Pr(r,a))return!1;return!0}function Ai(t,a,n,r){const s=Nr(t),i=Nr(a),o=Jc(n),c=new Set;for(const y of n){const u=au(t,y.vertices),p=tu(a,y.vertices);if(u||p){const g=eu(y.id,o,n);for(const _ of g)c.add(_)}}const m=[];let f=!1,d=null;for(const y of s)for(const u of i){const p={from:y,to:u,blocked:!1,blockedBy:null};let g=!1;for(const x of n)if(!c.has(x.id)&&zi(y,u,x.vertices)){p.blocked=!0,p.blockedBy="terrain",g=!0;break}if(g){m.push(p);continue}let _=!1;for(const x of r)if(zi(y,u,x)){p.blocked=!0,p.blockedBy="wall",_=!0;break}_||(p.blocked=!1,f||(d=p),f=!0),m.push(p)}return{canSee:f,rays:m,firstClearRay:d,terrainsIgnored:Array.from(c)}}const Xe={width:60,height:44},Qo=oa([{id:"terrain1",x:20,y:16,width:6,height:12,rotation:0},{id:"terrain2",x:34,y:10,width:6,height:12,rotation:45},{id:"terrain3",x:44,y:20,width:6,height:12,rotation:-30}]);Vn(Qo,t=>t.map(a=>jc(a)));Vn(Qo,t=>t.map(a=>({id:a.id,vertices:xs(a)})));const Xi=oa(!1);var nu=he('<line stroke="#3a4a3a" stroke-width="0.05"></line>'),su=he('<line stroke="#3a4a3a" stroke-width="0.05"></line>'),ru=he('<line stroke="#5a6a5a" stroke-width="0.08"></line>'),iu=he('<line stroke="#5a6a5a" stroke-width="0.08"></line>'),ou=he('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),lu=he('<line stroke="#666"></line><!>',1),cu=he('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),uu=he('<line stroke="#666"></line><!>',1),mu=he('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),du=he('<line stroke="#666"></line><!>',1),hu=he('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),fu=he('<line stroke="#666"></line><!>',1),yu=he('<svg preserveAspectRatio="xMidYMid meet"><rect x="0" y="0" fill="#1a1a1a"></rect><rect fill="#4a5a4a"></rect><!><!><!><!><!><!><!><!><g><!></g></svg>');function pr(t,a){Ka(a,!1);const n=P(),r=P(),s=P(),i=P(),o=P(),c=P(),m=P();let f=P();const d=2,y=Xe.width+d*2,u=Xe.height+d*2;let p=P(1),g=P(0),_=P(0),x=P(!1),E={x:0,y:0},R=P(!1);const L=.5,S=4;function A(ye,ae){if(!e(f))return{x:0,y:0};const qe=e(f).createSVGPoint();qe.x=ye,qe.y=ae;const ke=qe.matrixTransform(e(f).getScreenCTM().inverse());return{x:ke.x-d,y:ke.y-d}}function M(ye){ye.preventDefault();const ae=e(f).getBoundingClientRect(),qe=ye.clientX-ae.left,ke=ye.clientY-ae.top,zt=e(s)+qe/ae.width*e(n),st=e(i)+ke/ae.height*e(r),Ze=ye.deltaY>0?.9:1.1,pt=Math.max(L,Math.min(S,e(p)*Ze)),tt=y/pt,Tt=u/pt,Yt=zt-qe/ae.width*tt,la=st-ke/ae.height*Tt;v(p,pt),v(g,Yt),v(_,la)}function D(ye){(ye.button===1||ye.button===0&&e(R))&&(ye.preventDefault(),v(x,!0),E={x:ye.clientX,y:ye.clientY})}function k(ye){if(!e(x))return;const ae=e(f).getBoundingClientRect(),qe=(ye.clientX-E.x)/ae.width*e(n),ke=(ye.clientY-E.y)/ae.height*e(r);v(g,e(g)-qe),v(_,e(_)-ke),E={x:ye.clientX,y:ye.clientY}}function I(){v(x,!1)}function U(ye){ye.code==="Space"&&!ye.repeat&&ye.target.tagName!=="INPUT"&&(ye.preventDefault(),v(R,!0))}function le(ye){ye.code==="Space"&&v(R,!1)}function N(){v(p,1),v(g,0),v(_,0)}pe(()=>e(p),()=>{v(n,y/e(p))}),pe(()=>e(p),()=>{v(r,u/e(p))}),pe(()=>e(g),()=>{v(s,e(g))}),pe(()=>e(_),()=>{v(i,e(_))}),pe(()=>(e(s),e(i),e(n),e(r)),()=>{v(o,`${e(s)} ${e(i)} ${e(n)} ${e(r)}`)}),pe(()=>Xe,()=>{v(c,Array.from({length:Xe.width+1},(ye,ae)=>ae))}),pe(()=>Xe,()=>{v(m,Array.from({length:Xe.height+1},(ye,ae)=>ae))}),Rn();var fe={screenToSvg:A};en();var Ce=yu();V("keydown",Is,U),V("keyup",Is,le),V("mouseup",Is,I),V("mousemove",Is,k);let ne;var re=T(Ce),ce=b(re);h(ce,"x",d),h(ce,"y",d);var xe=b(ce);He(xe,1,()=>(j(Xe),l(()=>Array(Xe.width+1))),it,(ye,ae,qe)=>{var ke=nu();h(ke,"x1",d+qe),h(ke,"y1",d),h(ke,"x2",d+qe),K(()=>h(ke,"y2",(j(Xe),l(()=>d+Xe.height)))),C(ye,ke)});var Ie=b(xe);He(Ie,1,()=>(j(Xe),l(()=>Array(Xe.height+1))),it,(ye,ae,qe)=>{var ke=su();h(ke,"x1",d),h(ke,"y1",d+qe),h(ke,"y2",d+qe),K(()=>h(ke,"x2",(j(Xe),l(()=>d+Xe.width)))),C(ye,ke)});var te=b(Ie);He(te,1,()=>(j(Xe),l(()=>Array(Math.floor(Xe.width/6)+1))),it,(ye,ae,qe)=>{var ke=ru();h(ke,"x1",d+qe*6),h(ke,"y1",d),h(ke,"x2",d+qe*6),K(()=>h(ke,"y2",(j(Xe),l(()=>d+Xe.height)))),C(ye,ke)});var z=b(te);He(z,1,()=>(j(Xe),l(()=>Array(Math.floor(Xe.height/6)+1))),it,(ye,ae,qe)=>{var ke=iu();h(ke,"x1",d),h(ke,"y1",d+qe*6),h(ke,"y2",d+qe*6),K(()=>h(ke,"x2",(j(Xe),l(()=>d+Xe.width)))),C(ye,ke)});var Z=b(z);He(Z,1,()=>e(c),it,(ye,ae)=>{var qe=lu(),ke=Te(qe);h(ke,"y2",d);var zt=b(ke);{var st=Ze=>{var pt=ou();h(pt,"y",1.2);var tt=T(pt);K(()=>{h(pt,"x",d+e(ae)),Le(tt,`${e(ae)??""}"`)}),C(Ze,pt)};ee(zt,Ze=>{e(ae)%6===0&&Ze(st)})}K(()=>{h(ke,"x1",d+e(ae)),h(ke,"y1",e(ae)%6===0?.5:d-.8),h(ke,"x2",d+e(ae)),h(ke,"stroke-width",e(ae)%6===0?.08:.04)}),C(ye,qe)});var Se=b(Z);He(Se,1,()=>e(c),it,(ye,ae)=>{var qe=uu(),ke=Te(qe),zt=b(ke);{var st=Ze=>{var pt=cu(),tt=T(pt);K(()=>{h(pt,"x",d+e(ae)),h(pt,"y",(j(Xe),l(()=>d+Xe.height+1.8))),Le(tt,`${e(ae)??""}"`)}),C(Ze,pt)};ee(zt,Ze=>{e(ae)%6===0&&Ze(st)})}K(()=>{h(ke,"x1",d+e(ae)),h(ke,"y1",(j(Xe),l(()=>d+Xe.height))),h(ke,"x2",d+e(ae)),h(ke,"y2",(j(Xe),e(ae),l(()=>d+Xe.height+(e(ae)%6===0?1.5:.8)))),h(ke,"stroke-width",e(ae)%6===0?.08:.04)}),C(ye,qe)});var H=b(Se);He(H,1,()=>e(m),it,(ye,ae)=>{var qe=du(),ke=Te(qe);h(ke,"x2",d);var zt=b(ke);{var st=Ze=>{var pt=mu();h(pt,"x",1);var tt=T(pt);K(()=>{h(pt,"y",d+e(ae)+.35),Le(tt,`${e(ae)??""}"`)}),C(Ze,pt)};ee(zt,Ze=>{e(ae)%6===0&&Ze(st)})}K(()=>{h(ke,"x1",e(ae)%6===0?.5:d-.8),h(ke,"y1",d+e(ae)),h(ke,"y2",d+e(ae)),h(ke,"stroke-width",e(ae)%6===0?.08:.04)}),C(ye,qe)});var ve=b(H);He(ve,1,()=>e(m),it,(ye,ae)=>{var qe=fu(),ke=Te(qe),zt=b(ke);{var st=Ze=>{var pt=hu(),tt=T(pt);K(()=>{h(pt,"x",(j(Xe),l(()=>d+Xe.width+1))),h(pt,"y",d+e(ae)+.35),Le(tt,`${e(ae)??""}"`)}),C(Ze,pt)};ee(zt,Ze=>{e(ae)%6===0&&Ze(st)})}K(()=>{h(ke,"x1",(j(Xe),l(()=>d+Xe.width))),h(ke,"y1",d+e(ae)),h(ke,"x2",(j(Xe),e(ae),l(()=>d+Xe.width+(e(ae)%6===0?1.5:.8)))),h(ke,"y2",d+e(ae)),h(ke,"stroke-width",e(ae)%6===0?.08:.04)}),C(ye,qe)});var Me=b(ve);h(Me,"transform","translate(2, 2)");var yt=T(Me);return Uo(yt,a,"default",{screenToSvg:A}),$r(Ce,ye=>v(f,ye),()=>e(f)),K(()=>{h(Ce,"viewBox",e(o)),ne=Ca(Ce,0,"battlefield svelte-n43bnt",null,ne,{panning:e(x)||e(R)}),h(re,"width",(j(Xe),l(()=>Xe.width+d*2))),h(re,"height",(j(Xe),l(()=>Xe.height+d*2))),h(ce,"width",(j(Xe),l(()=>Xe.width))),h(ce,"height",(j(Xe),l(()=>Xe.height)))}),V("wheel",Ce,M),V("mousedown",Ce,D),V("dblclick",Ce,N),C(t,Ce),ar(a,"screenToSvg",A),Ga(fe)}var pu=he('<line stroke="#3b82f6" stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" fill="#3b82f6" stroke="#1d4ed8" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-trljjm"></circle>',1),vu=he('<g><g><rect role="button" tabindex="0" class="svelte-trljjm"></rect></g><!></g>');function Jo(t,a){Ka(a,!1);const n=P(),r=P(),s=P(),i=P(),o=P();let c=ze(a,"id",8),m=ze(a,"x",8),f=ze(a,"y",8),d=ze(a,"width",8),y=ze(a,"height",8),u=ze(a,"rotation",8,0),p=ze(a,"selected",8,!1),g=ze(a,"screenToSvg",8),_=ze(a,"onSelect",8,()=>{}),x=ze(a,"onDrag",8,()=>{}),E=ze(a,"onRotate",8,()=>{}),R=P(!1),L=!1,S={x:0,y:0};function A(xe){xe.stopPropagation(),_()(c())}function M(xe){if(xe.button!==0)return;xe.preventDefault(),xe.stopPropagation(),_()(c()),v(R,!0);const Ie=g()(xe.clientX,xe.clientY);S={x:Ie.x-m(),y:Ie.y-f()},window.addEventListener("mousemove",D),window.addEventListener("mouseup",k)}function D(xe){if(!e(R))return;const Ie=g()(xe.clientX,xe.clientY);let te=Ie.x-S.x,z=Ie.y-S.y;xe.shiftKey||(te=Math.round(te),z=Math.round(z));const Z=Math.max(d(),y())/2;te=Math.max(-Z,Math.min(Xe.width-d()+Z,te)),z=Math.max(-Z,Math.min(Xe.height-y()+Z,z)),x()(c(),te,z)}function k(){v(R,!1),window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",k)}function I(xe){xe.preventDefault(),xe.stopPropagation(),L=!0,window.addEventListener("mousemove",U),window.addEventListener("mouseup",le)}function U(xe){if(!L)return;const Ie=g()(xe.clientX,xe.clientY),te=Ie.x-e(n),z=Ie.y-e(r);let Z=Math.atan2(z,te)*180/Math.PI+45;xe.shiftKey||(Z=Math.round(Z/15)*15),E()(c(),Z)}function le(){L=!1,window.removeEventListener("mousemove",U),window.removeEventListener("mouseup",le)}pe(()=>(j(m()),j(d())),()=>{v(n,m()+d()/2)}),pe(()=>(j(f()),j(y())),()=>{v(r,f()+y()/2)}),pe(()=>(j(d()),j(y())),()=>{v(s,Math.max(d(),y())/2+1.5)}),pe(()=>(e(n),e(s),j(u())),()=>{v(i,e(n)+e(s)*Math.cos((u()-45)*Math.PI/180))}),pe(()=>(e(r),e(s),j(u())),()=>{v(o,e(r)+e(s)*Math.sin((u()-45)*Math.PI/180))}),Rn(),en();var N=vu();let fe;var Ce=T(N),ne=T(Ce),re=b(Ce);{var ce=xe=>{var Ie=pu(),te=Te(Ie),z=b(te);K(()=>{h(te,"x1",e(n)),h(te,"y1",e(r)),h(te,"x2",e(i)),h(te,"y2",e(o)),h(z,"cx",e(i)),h(z,"cy",e(o))}),V("mousedown",z,I),C(xe,Ie)};ee(re,xe=>{p()&&xe(ce)})}K(()=>{fe=Ca(N,0,"terrain-rect svelte-trljjm",null,fe,{selected:p(),dragging:e(R)}),h(Ce,"transform",`rotate(${u()??""}, ${e(n)??""}, ${e(r)??""})`),h(ne,"x",m()),h(ne,"y",f()),h(ne,"width",d()),h(ne,"height",y()),h(ne,"fill",p()?"rgba(59, 130, 246, 0.3)":"rgba(139, 90, 43, 0.3)"),h(ne,"stroke",p()?"#3b82f6":"#8b5a2b"),h(ne,"stroke-width",p()?.15:.1)}),V("click",ne,A),V("mousedown",ne,M),C(t,N),Ga()}const el="warhammer-deployment-layouts",tl=[{label:'6" x 12"',width:6,height:12},{label:'5" x 10"',width:5,height:10},{label:'4" x 6"',width:4,height:6}],ii=[{label:"L 4x8",shape:"L-4x8"},{label:"L 4x8 â",shape:"L-4x8-mirror"},{label:"C 4-8-4",shape:"C-4-8-4"},{label:"L 5x6",shape:"L-5x6"},{label:"L 5x6 â",shape:"L-5x6-mirror"},{label:"L 4x6",shape:"L-4x6"},{label:"L 4x6 â",shape:"L-4x6-mirror"}],Ci=[{name:"Layout 1",terrains:[{id:"a",x:28,y:0,width:4,height:6,rotation:0},{id:"b",x:28,y:38,width:4,height:6,rotation:0},{id:"c",x:6,y:5,width:6,height:12,rotation:0},{id:"d",x:48,y:27,width:6,height:12,rotation:0},{id:"e",x:16,y:28,width:6,height:12,rotation:0},{id:"f",x:7,y:19,width:6,height:12,rotation:90},{id:"g",x:38,y:4,width:6,height:12,rotation:0},{id:"h",x:47,y:13,width:6,height:12,rotation:90},{id:"i",x:32.74,y:23.59,width:5,height:10,rotation:135},{id:"j",x:35.06,y:19.5,width:4,height:6,rotation:45},{id:"k",x:22.07,y:10.17,width:5,height:10,rotation:-45},{id:"l",x:20.72,y:18.23,width:4,height:6,rotation:45}],walls:[{id:"wa",x:38,y:6,shape:"C-4-8-4",rotation:0},{id:"wb",x:18,y:30,shape:"C-4-8-4",rotation:180},{id:"wc",x:13.33,y:20.15,shape:"L-4x8-mirror",rotation:-90},{id:"wd",x:49.67,y:15.93,shape:"L-4x8-mirror",rotation:90},{id:"we",x:48.2,y:30.88,shape:"L-4x8",rotation:0},{id:"wf",x:7.84,y:5.01,shape:"L-4x8",rotation:180},{id:"wg",x:27.06,y:11.52,shape:"L-4x8-mirror",rotation:-45},{id:"wh",x:35.81,y:24.24,shape:"L-4x8-mirror",rotation:135}]},{name:"Layout 2",terrains:[{id:"a",x:31,y:7,width:4,height:6,rotation:-90},{id:"b",x:25,y:30,width:4,height:6,rotation:90},{id:"c",x:5,y:4,width:6,height:12,rotation:0},{id:"d",x:49,y:28,width:6,height:12,rotation:0},{id:"e",x:46,y:4,width:6,height:12,rotation:0},{id:"f",x:16.46,y:15.77,width:6,height:12,rotation:132.1},{id:"g",x:53,y:15,width:4,height:6,rotation:90},{id:"h",x:8,y:28,width:6,height:12,rotation:0},{id:"i",x:3,y:23,width:4,height:6,rotation:90},{id:"j",x:32.62,y:32.55,width:5,height:10,rotation:-90},{id:"k",x:22.48,y:.51,width:5,height:10,rotation:-90},{id:"l",x:37.5,y:16.2,width:6,height:12,rotation:132.1}],walls:[{id:"wa",x:49,y:32,shape:"L-4x8",rotation:0},{id:"wb",x:7,y:4,shape:"L-4x8",rotation:180},{id:"wc",x:46,y:8,shape:"L-4x8",rotation:0},{id:"wd",x:10,y:28,shape:"L-4x8",rotation:180},{id:"we",x:35.07,y:34.56,shape:"L-5x6-mirror",rotation:-90},{id:"wf",x:29.09,y:2.47,shape:"L-5x6-mirror",rotation:90},{id:"wg",x:17.86,y:17.53,shape:"C-4-8-4",rotation:135},{id:"wh",x:37.24,y:18.38,shape:"C-4-8-4",rotation:-45}]},{name:"Layout 3",terrains:[{id:"a",x:11,y:3,width:4,height:6,rotation:90},{id:"b",x:45,y:35,width:4,height:6,rotation:90},{id:"c",x:25,y:1,width:6,height:12,rotation:90},{id:"d",x:29,y:31,width:6,height:12,rotation:90},{id:"e",x:7.74,y:26.05,width:6,height:12,rotation:125.31},{id:"f",x:46.34,y:5.51,width:6,height:12,rotation:121.72},{id:"g",x:5.14,y:10.46,width:6,height:12,rotation:41.51},{id:"h",x:48.67,y:21.52,width:6,height:12,rotation:41.51},{id:"i",x:19.59,y:14.36,width:5,height:10,rotation:-38.13},{id:"j",x:20.69,y:24.37,width:4,height:6,rotation:-39.33},{id:"k",x:35.34,y:19.61,width:5,height:10,rotation:-38.13},{id:"l",x:35.31,y:13.5,width:4,height:6,rotation:-39.33}],walls:[{id:"aa",x:30,y:32,shape:"C-4-8-4",rotation:90},{id:"ab",x:26,y:4,shape:"C-4-8-4",rotation:-90},{id:"ac",x:8.19,y:11.64,shape:"L-4x8",rotation:222.46},{id:"ad",x:47.79,y:24.3,shape:"L-4x8",rotation:41.26},{id:"ae",x:38.64,y:20.09,shape:"L-5x6-mirror",rotation:141.31},{id:"af",x:25.26,y:17.9,shape:"L-5x6-mirror",rotation:-37.61},{id:"ag",x:14.37,y:28.38,shape:"L-4x8-mirror",rotation:-54.26},{id:"ah",x:48.75,y:7.3,shape:"L-4x8-mirror",rotation:122.02}]},{name:"Layout 4",terrains:[{id:"a",x:15,y:1,width:6,height:12,rotation:90},{id:"b",x:8,y:10,width:4,height:6,rotation:0},{id:"c",x:4,y:19,width:4,height:6,rotation:0},{id:"d",x:7.5,y:27.68,width:6,height:12,rotation:-48.57},{id:"e",x:46.53,y:4.24,width:6,height:12,rotation:-48.57},{id:"f",x:52,y:19,width:4,height:6,rotation:0},{id:"g",x:48,y:28,width:4,height:6,rotation:0},{id:"h",x:39,y:31,width:6,height:12,rotation:90},{id:"i",x:33.03,y:2.97,width:6,height:12,rotation:-37.25},{id:"j",x:20.96,y:28.96,width:6,height:12,rotation:-37.25},{id:"k",x:16.93,y:16.51,width:5,height:10,rotation:-41.85},{id:"l",x:37.96,y:17.43,width:5,height:10,rotation:-41.85}],walls:[{id:"aa",x:18,y:4,shape:"L-4x8",rotation:-90},{id:"ab",x:9.04,y:29.01,shape:"C-4-8-4",rotation:131.97},{id:"ac",x:47,y:7,shape:"C-4-8-4",rotation:-48.54},{id:"ad",x:38,y:32,shape:"L-4x8",rotation:90},{id:"ae",x:34.42,y:7.12,shape:"L-4x8",rotation:-37.53},{id:"af",x:21.57,y:28.8,shape:"L-4x8",rotation:142.46},{id:"ag",x:15.7,y:17.01,shape:"L-5x6",rotation:137.87},{id:"ah",x:39.17,y:20.85,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 5",terrains:[{id:"aa",x:27,y:1,width:6,height:12,rotation:90},{id:"ab",x:36.53,y:12.48,width:5,height:10,rotation:-90},{id:"ac",x:13,y:3,width:4,height:6,rotation:90},{id:"ad",x:43,y:35,width:4,height:6,rotation:90},{id:"ae",x:27,y:31,width:6,height:12,rotation:90},{id:"af",x:18.43,y:21.49,width:5,height:10,rotation:-90},{id:"ag",x:1,y:23,width:4,height:6,rotation:90},{id:"ah",x:55,y:15,width:4,height:6,rotation:90},{id:"ai",x:7.83,y:30.22,width:6,height:12,rotation:-60},{id:"aj",x:46.32,y:1.58,width:6,height:12,rotation:-60},{id:"ak",x:8.74,y:10.19,width:6,height:12,rotation:65.22},{id:"al",x:45.22,y:21.75,width:6,height:12,rotation:65.22}],walls:[{id:"a1",x:28,y:32,shape:"C-4-8-4",rotation:90},{id:"a2",x:28,y:4,shape:"C-4-8-4",rotation:-90},{id:"a3",x:11.88,y:12.29,shape:"L-4x8",rotation:-114.74},{id:"a4",x:43.97,y:23.59,shape:"L-4x8",rotation:64.22},{id:"a5",x:24.91,y:23.52,shape:"L-5x6-mirror",rotation:-90.37},{id:"a6",x:39,y:14.51,shape:"L-5x6-mirror",rotation:89.9},{id:"a7",x:7.58,y:30.57,shape:"L-4x8",rotation:120.93},{id:"a8",x:48.51,y:5.28,shape:"L-4x8",rotation:-59.06}]},{name:"Layout 6",terrains:[{id:"aa",x:13,y:1,width:6,height:12,rotation:90},{id:"ab",x:6,y:10,width:4,height:6,rotation:0},{id:"ac",x:25,y:11,width:4,height:6,rotation:90},{id:"ad",x:7.34,y:27.57,width:6,height:12,rotation:-40.32},{id:"ae",x:46.69,y:4.57,width:6,height:12,rotation:-41.9},{id:"af",x:31,y:27,width:4,height:6,rotation:-90},{id:"ag",x:50,y:28,width:4,height:6,rotation:0},{id:"ah",x:41,y:31,width:6,height:12,rotation:90},{id:"ai",x:34,y:4,width:6,height:12,rotation:0},{id:"aj",x:20,y:28,width:6,height:12,rotation:0},{id:"ak",x:15.7,y:15.03,width:5,height:10,rotation:-41.85},{id:"al",x:39.43,y:19.24,width:5,height:10,rotation:-39.95}],walls:[{id:"a1",x:16,y:4,shape:"L-4x8",rotation:-90},{id:"a2",x:9.04,y:29.01,shape:"C-4-8-4",rotation:140.05},{id:"a3",x:47,y:7.16,shape:"C-4-8-4",rotation:-41.53},{id:"a4",x:40,y:32,shape:"L-4x8",rotation:90},{id:"a5",x:34.15,y:7.88,shape:"L-4x8",rotation:0},{id:"a6",x:22,y:28,shape:"L-4x8",rotation:180},{id:"a7",x:14.47,y:15.47,shape:"L-5x6",rotation:137.87},{id:"a8",x:40.53,y:22.78,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 7",terrains:[{id:"aa",x:8,y:8,width:6,height:12,rotation:0},{id:"ab",x:6,y:28,width:6,height:12,rotation:0},{id:"ac",x:7,y:39,width:4,height:6,rotation:90},{id:"ad",x:18,y:26,width:5,height:10,rotation:0},{id:"ae",x:19,y:20,width:4,height:6,rotation:0},{id:"af",x:23,y:3,width:6,height:12,rotation:0},{id:"ag",x:31,y:29,width:6,height:12,rotation:0},{id:"ah",x:37,y:18,width:4,height:6,rotation:0},{id:"ai",x:37,y:8,width:5,height:10,rotation:0},{id:"aj",x:46,y:24,width:6,height:12,rotation:0},{id:"ak",x:48,y:4,width:6,height:12,rotation:0},{id:"al",x:49,y:-1,width:4,height:6,rotation:90}],walls:[{id:"a1",x:9,y:10,shape:"L-5x6",rotation:180},{id:"a2",x:11.44,y:31.97,shape:"L-4x8-mirror",rotation:0},{id:"a3",x:19,y:20,shape:"L-4x6",rotation:180},{id:"a4",x:22.53,y:30.02,shape:"L-5x6-mirror",rotation:0},{id:"a5",x:25,y:5,shape:"C-4-8-4",rotation:180},{id:"a6",x:31,y:31,shape:"C-4-8-4",rotation:0},{id:"a7",x:37,y:18,shape:"L-4x6",rotation:0},{id:"a8",x:41.51,y:8.09,shape:"L-5x6-mirror",rotation:180},{id:"a9",x:46,y:28,shape:"L-5x6",rotation:0},{id:"a10",x:51.51,y:4.01,shape:"L-4x8-mirror",rotation:180}]},{name:"Layout 8",terrains:[{id:"aa",x:23,y:22,width:4,height:6,rotation:0},{id:"ab",x:23,y:28,width:4,height:6,rotation:0},{id:"ac",x:33,y:16,width:4,height:6,rotation:0},{id:"ad",x:33,y:10,width:4,height:6,rotation:0},{id:"ae",x:41,y:19,width:6,height:12,rotation:0},{id:"af",x:13,y:13,width:6,height:12,rotation:0},{id:"ag",x:32,y:32,width:6,height:12,rotation:0},{id:"ah",x:22,y:0,width:6,height:12,rotation:0},{id:"ai",x:9.5,y:27.68,width:6,height:12,rotation:-48.69},{id:"aj",x:44.51,y:4.35,width:6,height:12,rotation:-48.69},{id:"ak",x:6.95,y:4,width:5,height:10,rotation:53.9},{id:"al",x:48,y:30,width:5,height:10,rotation:53.9}],walls:[{id:"a1",x:32,y:34,shape:"C-4-8-4",rotation:0},{id:"a2",x:24,y:2,shape:"C-4-8-4",rotation:180},{id:"a3",x:44.68,y:19.06,shape:"L-4x8-mirror",rotation:180},{id:"a4",x:18.43,y:16.91,shape:"L-4x8-mirror",rotation:0},{id:"a5",x:46.38,y:33.13,shape:"L-5x6",rotation:52.87},{id:"a6",x:8.55,y:4.89,shape:"L-5x6",rotation:-127.66},{id:"a7",x:16,y:30.28,shape:"L-4x8-mirror",rotation:-48.62},{id:"a8",x:46.91,y:5.85,shape:"L-4x8-mirror",rotation:132.19}]}];function gu(){return"terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Yn(){const t=localStorage.getItem(el);if(t)try{return JSON.parse(t)}catch(a){return console.error("Failed to parse saved layouts:",a),{}}return{}}function Or(t){localStorage.setItem(el,JSON.stringify(t))}function al(){const{subscribe:t,set:a,update:n}=oa([]);return{subscribe:t,set:a,update:n,add(r,s){n(i=>[...i,{id:gu(),x:30-r/2,y:22-s/2,width:r,height:s,rotation:0}])},updateTerrain(r,s){n(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){n(s=>s.filter(i=>i.id!==r))},clear(){a([])},save(r){const s=vn({subscribe:t}),i=Yn();i[r]={terrains:s,savedAt:Date.now()},Or(i)},load(r){const s=Yn();return s[r]?(a(s[r].terrains),!0):!1},deleteLayout(r){const s=Yn();delete s[r],Or(s)},getSavedLayoutNames(){const r=Yn();return Object.keys(r).map(s=>({name:s,savedAt:r[s].savedAt,terrainCount:r[s].terrains.length})).sort((s,i)=>i.savedAt-s.savedAt)},hasSaved(){const r=Yn();return Object.keys(r).length>0}}}const Ba=al();function nl(){const{subscribe:t,set:a,update:n}=oa([]);return{subscribe:t,set:a,update:n,add(r){n(s=>[...s,{id:"wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),x:30,y:22,shape:r,rotation:0}])},updateWall(r,s){n(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){n(s=>s.filter(i=>i.id!==r))},clear(){a([])}}}const $a=nl(),wr=al(),Sr=nl(),Ar=oa(null),Cr=oa(null);function oi(t){const a=t.includes("-mirror"),n=t.replace("-mirror","");if(n.startsWith("L-")){const r=n.match(/L-(\d+)x(\d+)/);if(r)return{type:"L",segments:[parseInt(r[1]),parseInt(r[2])],mirrored:a}}else if(n.startsWith("C-")){const r=n.match(/C-(\d+)-(\d+)-(\d+)/);if(r)return{type:"C",segments:[parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],mirrored:a}}return{type:"L",segments:[4,8],mirrored:!1}}function Gn(t,a=null){const s=oi(t),i=a||s.segments,o=s.mirrored;if(s.type==="L"){const[c,m]=i;return o?[{x:0,y:0},{x:.5,y:0},{x:.5,y:m},{x:-c+.5,y:m},{x:-c+.5,y:m-.5},{x:0,y:m-.5}]:[{x:0,y:0},{x:.5,y:0},{x:.5,y:m-.5},{x:c,y:m-.5},{x:c,y:m},{x:0,y:m}]}else if(s.type==="C"){const[c,m,f]=i;return[{x:0,y:0},{x:f,y:0},{x:f,y:.5},{x:.5,y:.5},{x:.5,y:m-.5},{x:c,y:m-.5},{x:c,y:m},{x:0,y:m}]}return[]}function vr(t,a,n,r){if(t.length===0)return[];const s=t.map(E=>E.x),i=t.map(E=>E.y),o=Math.min(...s),c=Math.max(...s),m=Math.min(...i),f=Math.max(...i),d=c-o,y=f-m,u=a+o+d/2,p=n+m+y/2,g=r*Math.PI/180,_=Math.cos(g),x=Math.sin(g);return t.map(E=>{const R=a+E.x,L=n+E.y,S=R-u,A=L-p;return{x:u+S*_-A*x,y:p+S*x+A*_}})}Vn($a,t=>t.map(a=>vr(Gn(a.shape,a.segments),a.x,a.y,a.rotation)));const _n=oa(null),wn=oa(null),ki=oa([]);function bu(t,a=[]){const n=vn(Ba),r=vn($a),s=Yn();s[t]={terrains:n,walls:r,models:a,savedAt:Date.now()},Or(s)}function Tu(t){const a=Yn();return a[t]?(Ba.set(a[t].terrains||[]),$a.set(a[t].walls||[]),{terrains:a[t].terrains||[],walls:a[t].walls||[],models:a[t].models||[]}):null}function xu(t){const a=Yn();delete a[t],Or(a)}function _u(){const t=Yn();return Object.keys(t).map(a=>({name:a,savedAt:t[a].savedAt,terrainCount:(t[a].terrains||[]).length,wallCount:(t[a].walls||[]).length,modelCount:(t[a].models||[]).length})).sort((a,n)=>n.savedAt-a.savedAt)}function nr(){ki.set(_u())}var wu=he('<line stroke="#3b82f6" stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" fill="#3b82f6" stroke="#1d4ed8" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-1tez9jd"></circle>',1),Su=he('<g><g><path role="button" tabindex="0" class="svelte-1tez9jd"></path></g><!></g>');function Ur(t,a){Ka(a,!1);const n=P(),r=P(),s=P(),i=P(),o=P(),c=P(),m=P(),f=P(),d=P(),y=P();let u=ze(a,"id",8),p=ze(a,"x",8),g=ze(a,"y",8),_=ze(a,"shape",8),x=ze(a,"segments",8,null),E=ze(a,"rotation",8,0),R=ze(a,"selected",8,!1),L=ze(a,"screenToSvg",8),S=ze(a,"onSelect",8,()=>{}),A=ze(a,"onDrag",8,()=>{}),M=ze(a,"onRotate",8,()=>{});function D(H){const ve=H.map(yt=>yt.x),Me=H.map(yt=>yt.y);return{minX:Math.min(...ve),maxX:Math.max(...ve),minY:Math.min(...Me),maxY:Math.max(...Me)}}let k=P(!1),I=!1,U={x:0,y:0};function le(H){H.stopPropagation(),S()(u())}function N(H){if(H.button!==0)return;H.preventDefault(),H.stopPropagation(),S()(u()),v(k,!0);const ve=L()(H.clientX,H.clientY);U={x:ve.x-p(),y:ve.y-g()},window.addEventListener("mousemove",fe),window.addEventListener("mouseup",Ce)}function fe(H){if(!e(k))return;const ve=L()(H.clientX,H.clientY);let Me=ve.x-U.x,yt=ve.y-U.y;H.shiftKey||(Me=Math.round(Me),yt=Math.round(yt));const ye=Math.max(e(s),e(i));Me=Math.max(-ye,Math.min(Xe.width+ye-e(s),Me)),yt=Math.max(-ye,Math.min(Xe.height+ye-e(i),yt)),A()(u(),Me,yt)}function Ce(){v(k,!1),window.removeEventListener("mousemove",fe),window.removeEventListener("mouseup",Ce)}function ne(H){H.preventDefault(),H.stopPropagation(),I=!0,window.addEventListener("mousemove",re),window.addEventListener("mouseup",ce)}function re(H){if(!I)return;const ve=L()(H.clientX,H.clientY),Me=ve.x-e(o),yt=ve.y-e(c);let ye=Math.atan2(yt,Me)*180/Math.PI+45;H.shiftKey||(ye=Math.round(ye/15)*15),M()(u(),ye)}function ce(){I=!1,window.removeEventListener("mousemove",re),window.removeEventListener("mouseup",ce)}pe(()=>(j(_()),j(x())),()=>{v(n,Gn(_(),x()))}),pe(()=>e(n),()=>{v(r,D(e(n)))}),pe(()=>e(r),()=>{v(s,e(r).maxX-e(r).minX)}),pe(()=>e(r),()=>{v(i,e(r).maxY-e(r).minY)}),pe(()=>(j(p()),e(r),e(s)),()=>{v(o,p()+e(r).minX+e(s)/2)}),pe(()=>(j(g()),e(r),e(i)),()=>{v(c,g()+e(r).minY+e(i)/2)}),pe(()=>(e(n),j(p()),j(g())),()=>{v(m,e(n).length>0?`M ${e(n).map(H=>`${p()+H.x},${g()+H.y}`).join(" L ")} Z`:"")}),pe(()=>(e(s),e(i)),()=>{v(f,Math.max(e(s),e(i))/2+1.5)}),pe(()=>(e(o),e(f),j(E())),()=>{v(d,e(o)+e(f)*Math.cos((E()-45)*Math.PI/180))}),pe(()=>(e(c),e(f),j(E())),()=>{v(y,e(c)+e(f)*Math.sin((E()-45)*Math.PI/180))}),Rn(),en();var xe=Su();let Ie;var te=T(xe),z=T(te),Z=b(te);{var Se=H=>{var ve=wu(),Me=Te(ve),yt=b(Me);K(()=>{h(Me,"x1",e(o)),h(Me,"y1",e(c)),h(Me,"x2",e(d)),h(Me,"y2",e(y)),h(yt,"cx",e(d)),h(yt,"cy",e(y))}),V("mousedown",yt,ne),C(H,ve)};ee(Z,H=>{R()&&H(Se)})}K(()=>{Ie=Ca(xe,0,"wall-piece svelte-1tez9jd",null,Ie,{selected:R(),dragging:e(k)}),h(te,"transform",`rotate(${E()??""}, ${e(o)??""}, ${e(c)??""})`),h(z,"d",e(m)),h(z,"fill",R()?"rgba(139, 69, 19, 0.6)":"rgba(139, 69, 19, 0.8)"),h(z,"stroke",R()?"#3b82f6":"#5c3317"),h(z,"stroke-width",R()?.15:.1)}),V("click",z,le),V("mousedown",z,N),C(t,xe),Ga()}var Au=ge('<div class="section-content svelte-7o4pd4"><!></div>'),Cu=ge('<section><div class="section-header svelte-7o4pd4" role="button" tabindex="0"><h3 class="svelte-7o4pd4"> </h3> <span class="toggle-icon svelte-7o4pd4"> </span></div> <!></section>');function fa(t,a){let n=ze(a,"title",8),r=ze(a,"defaultOpen",8,!0),s=P(r());function i(){v(s,!e(s))}var o=Cu();let c;var m=T(o),f=T(m),d=T(f),y=b(f,2),u=T(y),p=b(m,2);{var g=_=>{var x=Au(),E=T(x);Uo(E,a,"default",{}),C(_,x)};ee(p,_=>{e(s)&&_(g)})}K(()=>{c=Ca(o,1,"collapsible-section svelte-7o4pd4",null,c,{collapsed:!e(s)}),Le(d,n()),Le(u,e(s)?"â¼":"â¶")}),V("click",m,i),C(t,o)}const gn={battlefield:{fill:"#adbeadff"},terrain:{fill:"rgba(116, 102, 63, 0.71)",stroke:"#8b5a2b",strokeWidth:.15},wall:{fill:"rgba(52, 45, 39, 1)",stroke:"#000000ba",strokeWidth:.15},player1:{fill:"rgba(59, 130, 246, 0.6)",stroke:"#3b82f6",strokeWidth:.12},player2:{fill:"rgba(239, 68, 68, 0.6)",stroke:"#ef4444",strokeWidth:.12},modelName:{fill:"#ffffff",stroke:"#000000",strokeWidth:.05,fontWeight:"bold"},deploymentZone:{fillOpacity:.2,strokeWidth:.2,strokeDasharray:"0.5,0.25"},objective:{primary:{fill:"#9ca3af",stroke:"#000000",strokeWidth:.08},secondary:{fill:"#9ca3af",stroke:"#000000",strokeWidth:.08},controlRadius:{fillOpacity:.15,strokeWidth:.06,strokeDasharray:"0.3,0.15"},centerDot:{fill:"#000000",radius:.15}}};function sl(){const{subscribe:t,set:a,update:n}=oa({past:[],future:[]});return{subscribe:t,push(r){n(s=>({past:[...s.past,r],future:[]}))},undo(){let r=null;return n(s=>{if(s.past.length===0)return s;const i=[...s.past];return r=i.pop(),{past:i,future:[r,...s.future]}}),r},redo(){let r=null;return n(s=>{if(s.future.length===0)return s;const i=[...s.future];return r=i.shift(),{past:[...s.past,r],future:i}}),r},canUndo(){return vn({subscribe:t}).past.length>0},canRedo(){return vn({subscribe:t}).future.length>0},clear(){a({past:[],future:[]})}}}const Na=sl(),li=sl(),Ut=1/25.4,Qa={circles:[{type:"25mm",radius:25*Ut/2,label:"25mm"},{type:"28.5mm",radius:28.5*Ut/2,label:"28mm.5"},{type:"32mm",radius:32*Ut/2,label:"32mm"},{type:"40mm",radius:40*Ut/2,label:"40mm"},{type:"50mm",radius:50*Ut/2,label:"50mm"},{type:"60mm",radius:60*Ut/2,label:"60mm"},{type:"80mm",radius:80*Ut/2,label:"80mm"},{type:"90mm",radius:90*Ut/2,label:"90mm"},{type:"100mm",radius:100*Ut/2,label:"100mm"},{type:"130mm",radius:130*Ut/2,label:"130mm"},{type:"160mm",radius:160*Ut/2,label:"160mm"}],ovals:[{type:"60x35.5mm",width:60*Ut,height:35.5*Ut,label:"60Ã35.5mm"},{type:"75x42mm",width:75*Ut,height:42*Ut,label:"75Ã42mm"},{type:"Small Flying Base",width:75*Ut,height:42*Ut,label:"Small Flying"},{type:"90x52.5mm",width:90*Ut,height:52.5*Ut,label:"90Ã52.5mm"},{type:"Large Flying Base",width:90*Ut,height:52.5*Ut,label:"Large Flying"},{type:"105x70mm",width:105*Ut,height:70*Ut,label:"105Ã70mm"},{type:"120x92mm",width:120*Ut,height:92*Ut,label:"120Ã92mm"},{type:"150x95mm",width:150*Ut,height:95*Ut,label:"150Ã95mm"},{type:"170x109mm",width:170*Ut,height:109*Ut,label:"170Ã109mm"}]};function Oa(t,a=null){const n=Qa.circles.find(s=>s.type===t);if(n)return n;const r=Qa.ovals.find(s=>s.type===t);return r||(bn(t)&&a?{type:t,width:a.customWidth,height:a.customHeight,label:`${a.customWidth.toFixed(1)}"Ã${a.customHeight.toFixed(1)}"`}:null)}function Aa(t){return Qa.ovals.some(a=>a.type===t)}function bn(t){return t&&t.startsWith("rect-")}function Vi(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function rl(t){const{subscribe:a,set:n,update:r}=oa([]);return{subscribe:a,set:n,update:r,add(s,i,o,c,m=null,f=!1){const d=Vi(),y={id:d,baseType:s,playerId:i,x:o,y:c,rotation:0};return m&&m.width&&m.height&&(y.customWidth=m.width,y.customHeight=m.height),r(u=>[...u,y]),!f&&t&&t.push({type:"add",modelId:d,model:{...y}}),d},updateModel(s,i,o=!1){let c=null,m=null;if(!o&&t){const d=vn({subscribe:a}).find(y=>y.id===s);d&&(c={...d},"x"in i||"y"in i?m="move":"rotation"in i&&(m="rotate"))}if(r(f=>f.map(d=>d.id===s?{...d,...i}:d)),!o&&t&&m&&c){const d=vn({subscribe:a}).find(y=>y.id===s);t.push({type:m,modelId:s,before:m==="move"?{x:c.x,y:c.y}:{rotation:c.rotation},after:m==="move"?{x:d.x,y:d.y}:{rotation:d.rotation}})}},remove(s,i=!1){let o=null;!i&&t&&(o=vn({subscribe:a}).find(m=>m.id===s)),r(c=>c.filter(m=>m.id!==s)),!i&&t&&o&&t.push({type:"remove",modelId:s,model:{...o}})},removeByPlayer(s){r(i=>i.filter(o=>o.playerId!==s))},addBatch(s,i=!1){const o=[];return r(c=>{const m=[...c];return s.forEach(f=>{const d=f.id||Vi(),y={...f,id:d};m.push(y),o.push(d),!i&&t&&t.push({type:"add",modelId:d,model:{...y}})}),m}),o},updateUnit(s,i,o=!1){r(c=>c.map(m=>m.unitId===s?{...m,...i}:m))},removeUnit(s,i=!1){const o=[];if(!i&&t){const c=vn({subscribe:a});o.push(...c.filter(m=>m.unitId===s))}r(c=>c.filter(m=>m.unitId!==s)),!i&&t&&o.forEach(c=>{t.push({type:"remove",modelId:c.id,model:{...c}})})},clear(){n([]),t&&t.clear()},undo(){if(!t)return;const s=t.undo();if(s)switch(s.type){case"add":this.remove(s.modelId,!0);break;case"remove":r(i=>[...i,s.model]);break;case"move":this.updateModel(s.modelId,s.before,!0);break;case"rotate":this.updateModel(s.modelId,s.before,!0);break}},redo(){if(!t)return;const s=t.redo();if(s)switch(s.type){case"add":r(i=>[...i,s.model]);break;case"remove":this.remove(s.modelId,!0);break;case"move":this.updateModel(s.modelId,s.after,!0);break;case"rotate":this.updateModel(s.modelId,s.after,!0);break}}}}const gt=rl(Na),il=Vn(gt,t=>t.filter(a=>a.playerId===1)),ol=Vn(gt,t=>t.filter(a=>a.playerId===2)),ku=oa(null);Vn([gt,ku],([t,a])=>a?t.find(n=>n.id===a):null);const Qn=rl(li),us=oa(null);Vn([Qn,us],([t,a])=>a?t.find(n=>n.id===a):null);const ll=1/25.4,Kr=40*ll/2,Gr=3+20*ll;function cl(t="item"){return t+"-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Eu(){const{subscribe:t,set:a,update:n}=oa([]);return{subscribe:t,set:a,update:n,add(r){const s=cl("zone");return n(i=>[...i,{id:s,...r}]),s},updateZone(r,s){n(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){n(s=>s.filter(i=>i.id!==r))},clear(){a([])}}}function Mu(){const{subscribe:t,set:a,update:n}=oa([]);return{subscribe:t,set:a,update:n,add(r,s,i=!1){const o=cl("obj"),c=Math.round(r),m=Math.round(s);return n(f=>[...f,{id:o,x:c,y:m,isPrimary:i}]),o},updateObjective(r,s){n(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){n(s=>s.filter(i=>i.id!==r))},clear(){a([])}}}Eu();Mu();const ul=[{name:"Dawn of War",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:32},{type:"L",x:60,y:32},{type:"L",x:60,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:0,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:12},{type:"L",x:0,y:12},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1}]},{name:"Hammer and Anvil",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:18,y:0},{type:"L",x:18,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:42,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:42,y:44},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1}]},{name:"Tipping Point",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:12,y:0},{type:"L",x:12,y:22},{type:"L",x:20,y:22},{type:"L",x:20,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:40,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:48,y:44},{type:"L",x:48,y:22},{type:"L",x:40,y:22},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:34,isPrimary:!1},{x:22,y:8,isPrimary:!1},{x:38,y:36,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Search and Destroy",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:22},{type:"L",x:21,y:22},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:0,x:30,y:31},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:30,y:0},{type:"L",x:30,y:13},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:1,x:39,y:22},{type:"L",x:60,y:22},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:10,isPrimary:!1},{x:46,y:34,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Sweeping Engagement",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:0,y:8},{type:"L",x:30,y:8},{type:"L",x:30,y:14},{type:"L",x:60,y:14},{type:"L",x:60,y:0},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:0,y:44},{type:"L",x:60,y:44},{type:"L",x:60,y:36},{type:"L",x:30,y:36},{type:"L",x:30,y:30},{type:"L",x:0,y:30},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:18,isPrimary:!1},{x:50,y:26,isPrimary:!1},{x:18,y:38,isPrimary:!1},{x:42,y:6,isPrimary:!1}]},{name:"Crucible of Battle",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:60,y:44},{type:"L",x:30,y:0},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:20,y:8,isPrimary:!1},{x:40,y:36,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]}];function Fs(t){return t.map(a=>{switch(a.type){case"M":return`M ${a.x} ${a.y}`;case"L":return`L ${a.x} ${a.y}`;case"A":return`A ${a.rx} ${a.ry} ${a.rotation} ${a.largeArc} ${a.sweep} ${a.x} ${a.y}`;case"Z":return"Z";default:return""}}).join(" ")}const lr={pixelsPerInch:50,pngScale:2,fontSizeMultiplier:{circle:.8,oval:.6,rectangle:.35}};function Ru(t){const a=gn.deploymentZone;return`<path
    d="${Fs(t.path)}"
    fill="${t.borderColor}"
    fill-opacity="${a.fillOpacity}"
    stroke="${t.borderColor}"
    stroke-width="${a.strokeWidth}"
    stroke-dasharray="${a.strokeDasharray}"
  />`}function Lu(t){const a=t.isPrimary?gn.objective.primary:gn.objective.secondary,n=gn.objective.controlRadius,r=gn.objective.centerDot,s=`<circle
    cx="${t.x}"
    cy="${t.y}"
    r="${Gr}"
    fill="${a.fill}"
    fill-opacity="${n.fillOpacity}"
    stroke="${a.fill}"
    stroke-width="${n.strokeWidth}"
    stroke-dasharray="${n.strokeDasharray}"
  />`,i=`<circle
    cx="${t.x}"
    cy="${t.y}"
    r="${Kr}"
    fill="${a.fill}"
    stroke="${a.stroke}"
    stroke-width="${a.strokeWidth}"
  />`,o=`<circle
    cx="${t.x}"
    cy="${t.y}"
    r="${r.radius}"
    fill="${r.fill}"
  />`;return s+i+o}function Du(t){const{x:a,y:n,width:r,height:s,rotation:i}=t,o=a+r/2,c=n+s/2,m=gn.terrain;return`<rect
    x="${a}"
    y="${n}"
    width="${r}"
    height="${s}"
    transform="rotate(${i}, ${o}, ${c})"
    fill="${m.fill}"
    stroke="${m.stroke}"
    stroke-width="${m.strokeWidth}"
  />`}function Iu(t){const a=Gn(t.shape,t.segments),n=vr(a,t.x,t.y,t.rotation);if(n.length===0)return"";const r=n.map((i,o)=>`${o===0?"M":"L"} ${i.x} ${i.y}`).join(" ")+" Z",s=gn.wall;return`<path
    d="${r}"
    fill="${s.fill}"
    stroke="${s.stroke}"
    stroke-width="${s.strokeWidth}"
  />`}function $u(t){const a=Oa(t.baseType,t),n=Aa(t.baseType),r=bn(t.baseType),s=t.playerId===1?gn.player1:gn.player2,i=gn.modelName;let o="",c=0;if(r){const f=t.customWidth||0,d=t.customHeight||0,y=t.x,u=t.y;c=Math.min(f,d)*lr.fontSizeMultiplier.rectangle,o=`<g transform="rotate(${t.rotation||0}, ${y}, ${u})">
      <rect
        x="${y-f/2}"
        y="${u-d/2}"
        width="${f}"
        height="${d}"
        fill="${s.fill}"
        stroke="${s.stroke}"
        stroke-width="${s.strokeWidth}"
      />
    </g>`}else if(n){const f=a.width/2,d=a.height/2;c=Math.min(f,d)*lr.fontSizeMultiplier.oval,o=`<g transform="rotate(${t.rotation||0}, ${t.x}, ${t.y})">
      <ellipse
        cx="${t.x}"
        cy="${t.y}"
        rx="${f}"
        ry="${d}"
        fill="${s.fill}"
        stroke="${s.stroke}"
        stroke-width="${s.strokeWidth}"
      />
    </g>`}else{const f=a?.radius||.5;c=f*lr.fontSizeMultiplier.circle,o=`<circle
      cx="${t.x}"
      cy="${t.y}"
      r="${f}"
      fill="${s.fill}"
      stroke="${s.stroke}"
      stroke-width="${s.strokeWidth}"
    />`}let m="";return t.name&&(m=`<text
      x="${t.x}"
      y="${t.y}"
      text-anchor="middle"
      dominant-baseline="middle"
      font-size="${c}"
      font-weight="${i.fontWeight}"
      fill="${i.fill}"
      stroke="${i.stroke}"
      stroke-width="${i.strokeWidth}"
      paint-order="stroke"
    >${Pu(t.name)}</text>`),o+m}function Pu(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Nu(t,a,n,r=null){const s=Xe.width,i=Xe.height,o=gn.battlefield.fill,c=lr.pixelsPerInch,m=t.map(Du).join(`
    `),f=a.map(Iu).join(`
    `),d=n.map($u).join(`
    `),y=r?.zones?r.zones.map(Ru).join(`
    `):"",u=r?.objectives?r.objectives.map(Lu).join(`
    `):"";return`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${s} ${i}" width="${s*c}" height="${i*c}">
  <!-- Battlefield background -->
  <rect x="0" y="0" width="${s}" height="${i}" fill="${o}" />

  <!-- Deployment zones -->
  <g id="deployment-zones">
    ${y}
  </g>

  <!-- Objectives -->
  <g id="objectives">
    ${u}
  </g>

  <!-- Terrain pieces -->
  <g id="terrains">
    ${m}
  </g>

  <!-- Wall pieces -->
  <g id="walls">
    ${f}
  </g>

  <!-- Model bases -->
  <g id="models">
    ${d}
  </g>
</svg>`}function Ou(t,a=1){return new Promise((n,r)=>{const s=new Image,i=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(i);s.onload=()=>{const c=document.createElement("canvas");c.width=s.width*a,c.height=s.height*a;const m=c.getContext("2d");m.scale(a,a),m.drawImage(s,0,0),URL.revokeObjectURL(o),c.toBlob(f=>{f?n(f):r(new Error("Failed to create PNG blob"))},"image/png")},s.onerror=()=>{URL.revokeObjectURL(o),r(new Error("Failed to load SVG image"))},s.src=o})}async function Ei(t,a,n=[],r="battlefield",s=null){try{const i=Nu(t,a,n,s),o=await Ou(i,lr.pngScale),c=URL.createObjectURL(o),m=document.createElement("a");return m.href=c,m.download=`${r}.png`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(c),!0}catch(i){throw console.error("Failed to export PNG:",i),i}}var Wu=ge('<button class="svelte-10mgcx0"> </button>'),Yu=ge('<div class="button-group svelte-10mgcx0"></div>'),Hu=ge('<button class="svelte-10mgcx0"> </button>'),Fu=ge('<div class="button-group svelte-10mgcx0"></div>'),Bu=ge('<div class="field svelte-10mgcx0"><label for="edit-width" class="svelte-10mgcx0">Width (inches)</label> <input id="edit-width" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-height" class="svelte-10mgcx0">Length (inches)</label> <input id="edit-height" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-rotation" class="svelte-10mgcx0">Rotation (Â°)</label> <input id="edit-rotation" type="number" step="15" class="svelte-10mgcx0"/></div>',1),qu=ge('<div class="field svelte-10mgcx0"><label for="edit-seg1" class="svelte-10mgcx0">Horizontal (inches)</label> <input id="edit-seg1" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg2" class="svelte-10mgcx0">Vertical (inches)</label> <input id="edit-seg2" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div>',1),Uu=ge('<div class="field svelte-10mgcx0"><label for="edit-seg1" class="svelte-10mgcx0">Top Width (inches)</label> <input id="edit-seg1" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg2" class="svelte-10mgcx0">Length (inches)</label> <input id="edit-seg2" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg3" class="svelte-10mgcx0">Bottom Width (inches)</label> <input id="edit-seg3" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div>',1),Ku=ge('<div class="field svelte-10mgcx0"><span class="label-text svelte-10mgcx0">Shape</span> <span class="value svelte-10mgcx0"> </span></div> <!> <div class="field svelte-10mgcx0"><label for="edit-rotation" class="svelte-10mgcx0">Rotation (Â°)</label> <input id="edit-rotation" type="number" step="15" class="svelte-10mgcx0"/></div>',1),Gu=ge('<div class="edit-form svelte-10mgcx0"><div class="field svelte-10mgcx0"><label for="edit-x" class="svelte-10mgcx0">X (inches)</label> <input id="edit-x" type="number" step="0.1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-y" class="svelte-10mgcx0">Y (inches)</label> <input id="edit-y" type="number" step="0.1" class="svelte-10mgcx0"/></div> <!> <button class="danger svelte-10mgcx0">Remove</button></div>'),zu=ge('<p class="hint svelte-10mgcx0">Click a piece to select it</p>'),Xu=ge('<div class="button-group vertical svelte-10mgcx0"><button class="svelte-10mgcx0">Save Layout</button> <button class="svelte-10mgcx0">Load Layout</button> <div class="button-row svelte-10mgcx0"><button class="secondary small svelte-10mgcx0">Export</button> <button class="secondary small svelte-10mgcx0">Import</button></div> <button class="secondary svelte-10mgcx0">Clear All</button></div>'),Vu=ge("<!> <!>",1),ju=ge('<div class="modal-overlay svelte-10mgcx0" role="presentation"><div class="modal svelte-10mgcx0" role="dialog"><h2 class="svelte-10mgcx0">Save Layout</h2> <div class="modal-field svelte-10mgcx0"><label for="layout-name" class="svelte-10mgcx0">Layout Name</label> <input id="layout-name" type="text" placeholder="Enter a name..." class="svelte-10mgcx0"/></div> <div class="modal-actions svelte-10mgcx0"><button class="secondary svelte-10mgcx0">Cancel</button> <button class="svelte-10mgcx0">Save</button></div></div></div>'),Zu=ge('<p class="hint svelte-10mgcx0">No saved layouts yet</p>'),Qu=ge('<div class="layout-item svelte-10mgcx0" role="button" tabindex="0"><div class="layout-info svelte-10mgcx0"><span class="layout-name svelte-10mgcx0"> </span> <span class="layout-meta svelte-10mgcx0"> </span></div> <button class="delete-btn svelte-10mgcx0" title="Delete">Ã</button></div>'),Ju=ge('<div class="layout-list svelte-10mgcx0"></div>'),em=ge('<div class="modal-overlay svelte-10mgcx0" role="presentation"><div class="modal svelte-10mgcx0" role="dialog"><h2 class="svelte-10mgcx0">Load Layout</h2> <!> <div class="modal-actions svelte-10mgcx0"><button class="secondary svelte-10mgcx0">Cancel</button></div></div></div>'),tm=ge('<main class="svelte-10mgcx0"><div class="layout svelte-10mgcx0"><div class="sidebar svelte-10mgcx0"><!> <!> <!> <!> <input type="file" accept=".json" style="display: none;"/></div> <div class="battlefield-area svelte-10mgcx0"><div class="battlefield-container svelte-10mgcx0" role="presentation"><!></div> <div class="info svelte-10mgcx0"><p class="svelte-10mgcx0"> </p> <p class="hint svelte-10mgcx0">Scroll to zoom | Space+drag or middle-click to pan | Double-click to reset view</p></div></div></div></main> <!> <!>',1);function am(t,a){Ka(a,!1);const n=()=>Nt(_n,"$selectedTerrainId",c),r=()=>Nt(wn,"$selectedWallId",c),s=()=>Nt(Ba,"$layoutTerrains",c),i=()=>Nt($a,"$layoutWalls",c),o=()=>Nt(ki,"$savedLayoutsList",c),[c,m]=zs(),f=P(),d=P();let y=P(!1),u=P(!1),p=P(""),g=null;ws(()=>{nr(),window.addEventListener("keydown",_)}),Si(()=>{window.removeEventListener("keydown",_)});function _(F){if(F.target.tagName==="INPUT"||e(y)||e(u))return;const q=n()||r();if((F.key==="Delete"||F.key==="Backspace")&&q){F.preventDefault(),Ie();return}if(q&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(F.key)){F.preventDefault();const we=F.shiftKey?.1:1;let Ke=0,Ae=0;switch(F.key){case"ArrowUp":Ae=-we;break;case"ArrowDown":Ae=we;break;case"ArrowLeft":Ke=-we;break;case"ArrowRight":Ke=we;break}if(n()){const ot=s().find(mt=>mt.id===n());ot&&Ba.updateTerrain(n(),{x:ot.x+Ke,y:ot.y+Ae})}else if(r()){const ot=i().find(mt=>mt.id===r());ot&&$a.updateWall(r(),{x:ot.x+Ke,y:ot.y+Ae})}return}if(F.key==="c"&&(F.ctrlKey||F.metaKey)&&q){if(F.preventDefault(),n()){const we=s().find(Ke=>Ke.id===n());we&&(g={type:"terrain",data:{...we}})}else if(r()){const we=i().find(Ke=>Ke.id===r());we&&(g={type:"wall",data:{...we}})}return}if(F.key==="v"&&(F.ctrlKey||F.metaKey)&&g){if(F.preventDefault(),g.type==="terrain"){const we="terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),Ke={...g.data,id:we,x:g.data.x+2,y:g.data.y+2};Ba.update(Ae=>[...Ae,Ke]),_n.set(we),wn.set(null),g.data.x+=2,g.data.y+=2}else if(g.type==="wall"){const we="wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),Ke={...g.data,id:we,x:g.data.x+2,y:g.data.y+2};$a.update(Ae=>[...Ae,Ke]),wn.set(we),_n.set(null),g.data.x+=2,g.data.y+=2}return}if(F.key==="Escape"){Ce();return}}let x=P(""),E=P(""),R=P(""),L=P(""),S=P(""),A=P(""),M=P(""),D=P("");function k(F){return F.segments?F.segments:oi(F.shape).segments}function I(F){return oi(F.shape).type}function U(F,q){Ba.add(F,q)}function le(F){$a.add(F)}function N(F){_n.set(F),wn.set(null)}function fe(F){wn.set(F),_n.set(null)}function Ce(){_n.set(null),wn.set(null)}function ne(F,q,we){Ba.updateTerrain(F,{x:q,y:we})}function re(F,q,we){$a.updateWall(F,{x:q,y:we})}function ce(F,q){Ba.updateTerrain(F,{rotation:q})}function xe(F,q){$a.updateWall(F,{rotation:q})}function Ie(){n()?(Ba.remove(n()),_n.set(null)):r()&&($a.remove(r()),wn.set(null))}function te(){const F=parseFloat(e(x)),q=parseFloat(e(E));!isNaN(F)&&!isNaN(q)&&(n()?Ba.updateTerrain(n(),{x:F,y:q}):r()&&$a.updateWall(r(),{x:F,y:q}))}function z(){if(!n())return;const F=parseFloat(e(R)),q=parseFloat(e(L));!isNaN(F)&&!isNaN(q)&&F>0&&q>0&&Ba.updateTerrain(n(),{width:F,height:q})}function Z(){const F=parseFloat(e(S));isNaN(F)||(n()?Ba.updateTerrain(n(),{rotation:F}):r()&&$a.updateWall(r(),{rotation:F}))}function Se(){if(!r()||!e(d))return;const F=I(e(d)),q=parseFloat(e(A)),we=parseFloat(e(M));if(isNaN(q)||isNaN(we)||q<=0||we<=0)return;let Ke;if(F==="C"){const Ae=parseFloat(e(D));if(isNaN(Ae)||Ae<=0)return;Ke=[q,we,Ae]}else Ke=[q,we];$a.updateWall(r(),{segments:Ke})}function H(){v(p,""),v(y,!0)}function ve(){e(p).trim()&&(bu(e(p).trim()),nr(),v(y,!1),v(p,""))}function Me(){nr(),v(u,!0)}function yt(F){Tu(F),_n.set(null),wn.set(null),v(u,!1)}function ye(F,q){q.stopPropagation(),confirm(`Delete layout "${F}"?`)&&(xu(F),nr())}function ae(){confirm("Clear all terrain and walls?")&&(Ba.clear(),$a.clear(),_n.set(null),wn.set(null))}function qe(F){return new Date(F).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function ke(F){const q=ii.find(we=>we.shape===F);return q?q.label:F}function zt(){const F=prompt("Layout name (for the recipient):","Custom Layout");if(F===null)return;const q=s(),we=i(),Ke={version:1,name:F||"Custom Layout",exportedAt:new Date().toISOString(),terrainCount:q.length,wallCount:we.length,terrains:q,walls:we},Ae=JSON.stringify(Ke,null,2),ot=new Blob([Ae],{type:"application/json"}),mt=URL.createObjectURL(ot),De=document.createElement("a");De.href=mt;const Ve=(F||"layout").toLowerCase().replace(/[^a-z0-9]+/g,"-");De.download=`${Ve}-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(De),De.click(),document.body.removeChild(De),URL.revokeObjectURL(mt)}let st=P();function Ze(){e(st).click()}function pt(F){const q=F.target.files[0];if(!q)return;const we=new FileReader;we.onload=Ke=>{try{const Ae=JSON.parse(Ke.target.result);Ae.terrains&&Array.isArray(Ae.terrains)&&Ba.set(Ae.terrains),Ae.walls&&Array.isArray(Ae.walls)&&$a.set(Ae.walls),_n.set(null),wn.set(null);const ot=Ae.name||"Unknown",mt=Ae.terrains?.length||0,De=Ae.walls?.length||0;alert(`Imported "${ot}"
${mt} terrain(s), ${De} wall(s)`)}catch(Ae){alert("Failed to import layout: Invalid file format"),console.error("Import error:",Ae)}},we.readAsText(q),F.target.value=""}pe(()=>(s(),n()),()=>{v(f,s().find(F=>F.id===n()))}),pe(()=>(i(),r()),()=>{v(d,i().find(F=>F.id===r()))}),pe(()=>(e(f),e(d)),()=>{if(e(f))v(x,e(f).x.toFixed(1)),v(E,e(f).y.toFixed(1)),v(R,e(f).width.toString()),v(L,e(f).height.toString()),v(S,Math.round(e(f).rotation).toString());else if(e(d)){v(x,e(d).x.toFixed(1)),v(E,e(d).y.toFixed(1)),v(S,Math.round(e(d).rotation).toString());const F=k(e(d));v(A,F[0]?.toString()||""),v(M,F[1]?.toString()||""),v(D,F[2]?.toString()||"")}}),Rn(),en();var tt=tm(),Tt=Te(tt),Yt=T(Tt),la=T(Yt),oe=T(la);fa(oe,{title:"Add Terrain",children:(F,q)=>{var we=Yu();He(we,5,()=>tl,it,(Ke,Ae)=>{var ot=Wu(),mt=T(ot);K(()=>Le(mt,(e(Ae),l(()=>e(Ae).label)))),V("click",ot,()=>U(e(Ae).width,e(Ae).height)),C(Ke,ot)}),C(F,we)},$$slots:{default:!0}});var Re=b(oe,2);fa(Re,{title:"Add Wall",children:(F,q)=>{var we=Fu();He(we,5,()=>ii,it,(Ke,Ae)=>{var ot=Hu(),mt=T(ot);K(()=>Le(mt,(e(Ae),l(()=>e(Ae).label)))),V("click",ot,()=>le(e(Ae).shape)),C(Ke,ot)}),C(F,we)},$$slots:{default:!0}});var Ue=b(Re,2);{let F=$e(()=>e(f)?"Terrain":e(d)?"Wall":"Item");fa(Ue,{get title(){return`Selected ${e(F)??""}`},children:(q,we)=>{var Ke=ft(),Ae=Te(Ke);{var ot=De=>{var Ve=Gu(),Kt=T(Ve),ta=b(T(Kt),2),Vt=b(Kt,2),La=b(T(Vt),2),Ln=b(Vt,2);{var Dn=Ma=>{var mn=Bu(),za=Te(mn),$n=b(T(za),2),$=b(za,2),J=b(T($),2),ie=b($,2),Pe=b(T(ie),2);Ia($n,()=>e(R),Ne=>v(R,Ne)),V("change",$n,z),Ia(J,()=>e(L),Ne=>v(L,Ne)),V("change",J,z),Ia(Pe,()=>e(S),Ne=>v(S,Ne)),V("change",Pe,Z),C(Ma,mn)},In=Ma=>{var mn=ft(),za=Te(mn);{var $n=$=>{var J=Ku(),ie=Te(J),Pe=b(T(ie),2),Ne=T(Pe),Ge=b(ie,2);{var Fe=Ct=>{var Ft=qu(),na=Te(Ft),ca=b(T(na),2),wa=b(na,2),ya=b(T(wa),2);Ia(ca,()=>e(A),sa=>v(A,sa)),V("change",ca,Se),Ia(ya,()=>e(M),sa=>v(M,sa)),V("change",ya,Se),C(Ct,Ft)},et=Ct=>{var Ft=ft(),na=Te(Ft);{var ca=wa=>{var ya=Uu(),sa=Te(ya),Xa=b(T(sa),2),pa=b(sa,2),It=b(T(pa),2),ua=b(pa,2),ba=b(T(ua),2);Ia(Xa,()=>e(A),Ta=>v(A,Ta)),V("change",Xa,Se),Ia(It,()=>e(M),Ta=>v(M,Ta)),V("change",It,Se),Ia(ba,()=>e(D),Ta=>v(D,Ta)),V("change",ba,Se),C(wa,ya)};ee(na,wa=>{e(d),l(()=>I(e(d))==="C")&&wa(ca)},!0)}C(Ct,Ft)};ee(Ge,Ct=>{e(d),l(()=>I(e(d))==="L")?Ct(Fe):Ct(et,!1)})}var _t=b(Ge,2),aa=b(T(_t),2);K(Ct=>Le(Ne,Ct),[()=>(e(d),l(()=>ke(e(d).shape)))]),Ia(aa,()=>e(S),Ct=>v(S,Ct)),V("change",aa,Z),C($,J)};ee(za,$=>{e(d)&&$($n)},!0)}C(Ma,mn)};ee(Ln,Ma=>{e(f)?Ma(Dn):Ma(In,!1)})}var un=b(Ln,2);Ia(ta,()=>e(x),Ma=>v(x,Ma)),V("change",ta,te),Ia(La,()=>e(E),Ma=>v(E,Ma)),V("change",La,te),V("click",un,Ie),C(De,Ve)},mt=De=>{var Ve=zu();C(De,Ve)};ee(Ae,De=>{e(f)||e(d)?De(ot):De(mt,!1)})}C(q,Ke)},$$slots:{default:!0}})}var Dt=b(Ue,2);fa(Dt,{title:"Layout",children:(F,q)=>{var we=Xu(),Ke=T(we),Ae=b(Ke,2),ot=b(Ae,2),mt=T(ot),De=b(mt,2),Ve=b(ot,2);K(()=>Ae.disabled=(o(),l(()=>o().length===0))),V("click",Ke,H),V("click",Ae,Me),V("click",mt,zt),V("click",De,Ze),V("click",Ve,ae),C(F,we)},$$slots:{default:!0}});var Et=b(Dt,2);$r(Et,F=>v(st,F),()=>e(st));var Ht=b(la,2),Xt=T(Ht),Ya=T(Xt);pr(Ya,{children:Hr,$$slots:{default:(F,q)=>{const we=$e(()=>q.screenToSvg);var Ke=Vu(),Ae=Te(Ke);He(Ae,1,s,mt=>mt.id,(mt,De)=>{{let Ve=$e(()=>(e(De),n(),l(()=>e(De).id===n())));Jo(mt,{get id(){return e(De),l(()=>e(De).id)},get x(){return e(De),l(()=>e(De).x)},get y(){return e(De),l(()=>e(De).y)},get width(){return e(De),l(()=>e(De).width)},get height(){return e(De),l(()=>e(De).height)},get rotation(){return e(De),l(()=>e(De).rotation)},get selected(){return e(Ve)},get screenToSvg(){return e(we)},onSelect:N,onDrag:ne,onRotate:ce})}});var ot=b(Ae,2);He(ot,1,i,mt=>mt.id,(mt,De)=>{{let Ve=$e(()=>(e(De),r(),l(()=>e(De).id===r())));Ur(mt,{get id(){return e(De),l(()=>e(De).id)},get x(){return e(De),l(()=>e(De).x)},get y(){return e(De),l(()=>e(De).y)},get shape(){return e(De),l(()=>e(De).shape)},get segments(){return e(De),l(()=>e(De).segments)},get rotation(){return e(De),l(()=>e(De).rotation)},get selected(){return e(Ve)},get screenToSvg(){return e(we)},onSelect:fe,onDrag:re,onRotate:xe})}}),C(F,Ke)}}});var Ha=b(Xt,2),Zt=T(Ha),Oe=T(Zt),Je=b(Tt,2);{var rt=F=>{var q=ju(),we=T(q),Ke=b(T(we),2),Ae=b(T(Ke),2),ot=b(Ke,2),mt=T(ot),De=b(mt,2);K(Ve=>De.disabled=Ve,[()=>(e(p),l(()=>!e(p).trim()))]),Ia(Ae,()=>e(p),Ve=>v(p,Ve)),V("keydown",Ae,Ve=>Ve.key==="Enter"&&ve()),V("click",mt,()=>v(y,!1)),V("click",De,ve),V("click",we,qi(function(Ve){Ki.call(this,a,Ve)})),V("click",q,()=>v(y,!1)),C(F,q)};ee(Je,F=>{e(y)&&F(rt)})}var At=b(Je,2);{var Qt=F=>{var q=em(),we=T(q),Ke=b(T(we),2);{var Ae=Ve=>{var Kt=Zu();C(Ve,Kt)},ot=Ve=>{var Kt=Ju();He(Kt,5,o,it,(ta,Vt)=>{var La=Qu(),Ln=T(La),Dn=T(Ln),In=T(Dn),un=b(Dn,2),Ma=T(un),mn=b(Ln,2);K(za=>{Le(In,(e(Vt),l(()=>e(Vt).name))),Le(Ma,`${e(Vt),l(()=>e(Vt).terrainCount)??""} terrain${e(Vt),l(()=>e(Vt).terrainCount!==1?"s":"")??""}, ${e(Vt),l(()=>e(Vt).wallCount||0)??""} wall${e(Vt),l(()=>(e(Vt).wallCount||0)!==1?"s":"")??""} Â· ${za??""}`)},[()=>(e(Vt),l(()=>qe(e(Vt).savedAt)))]),V("click",mn,za=>ye(e(Vt).name,za)),V("click",La,()=>yt(e(Vt).name)),C(ta,La)}),C(Ve,Kt)};ee(Ke,Ve=>{o(),l(()=>o().length===0)?Ve(Ae):Ve(ot,!1)})}var mt=b(Ke,2),De=T(mt);V("click",De,()=>v(u,!1)),V("click",we,qi(function(Ve){Ki.call(this,a,Ve)})),V("click",q,()=>v(u,!1)),C(F,q)};ee(At,F=>{e(u)&&F(Qt)})}K(()=>Le(Oe,`Battlefield: 60" x 44" | ${s(),l(()=>s().length)??""} terrain${s(),l(()=>s().length!==1?"s":"")??""} | ${i(),l(()=>i().length)??""} wall${i(),l(()=>i().length!==1?"s":"")??""}`)),V("change",Et,pt),V("click",Xt,Ce),C(t,tt),Ga(),m()}const es=oa(null),fn=oa(null),Sn=oa(null),Mi=Vn([fn,Sn],([t,a])=>{if(!t)return{terrains:[],walls:[]};if(a==="preset"){const n=Ci.find(r=>r.name===t);return n?{terrains:n.terrains||[],walls:n.walls||[]}:{terrains:[],walls:[]}}else if(a==="saved"){const n=localStorage.getItem("warhammer-deployment-layouts");if(n)try{const r=JSON.parse(n);if(r[t])return{terrains:r[t].terrains||[],walls:r[t].walls||[]}}catch(r){console.error("Failed to load layout:",r)}}return{terrains:[],walls:[]}});var nm=ge('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),sm=ge('<button class="svelte-1jotvmi"> </button>'),rm=ge('<div class="button-group svelte-1jotvmi"></div>'),im=ge('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),om=ge('<button class="svelte-1jotvmi"> </button>'),lm=ge('<button class="svelte-1jotvmi"> </button>'),cm=ge('<div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Saved</h4> <div class="button-group svelte-1jotvmi"></div></div>'),um=ge('<div class="layout-sections svelte-1jotvmi"><div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Presets</h4> <div class="button-group svelte-1jotvmi"></div></div> <!></div>'),mm=ge('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Objectives:</span> <span class="value svelte-1jotvmi"> </span></div>'),dm=ge('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Pieces:</span> <span class="value svelte-1jotvmi"> </span></div>'),hm=ge('<div class="summary svelte-1jotvmi"><div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Deployment:</span> <span class="value svelte-1jotvmi"> </span></div> <div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Terrain:</span> <span class="value svelte-1jotvmi"> </span></div> <!> <!></div>'),fm=he('<path stroke-width="0.10" stroke-dasharray="0.5,0.25"></path>'),ym=he('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15"></circle><circle stroke="#000" stroke-width="0.06"></circle><circle r="0.15" fill="#000"></circle>',1),pm=he("<!><!>",1),vm=he('<g><rect fill="rgba(139, 90, 43, 0.6)" stroke="#8b5a2b" stroke-width="0.1"></rect></g>'),gm=he('<g><path fill="rgba(139, 69, 19, 0.8)" stroke="#5c3317" stroke-width="0.1"></path></g>'),bm=he("<!><!><!>",1),Tm=ge('<main class="svelte-1jotvmi"><div class="layout svelte-1jotvmi"><div class="sidebar svelte-1jotvmi"><!> <!> <!></div> <div class="battlefield-area svelte-1jotvmi"><div class="battlefield-container svelte-1jotvmi"><!></div> <div class="info svelte-1jotvmi"><p class="svelte-1jotvmi">Battlefield: 60" x 44"</p> <p class="hint svelte-1jotvmi">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function xm(t,a){Ka(a,!1);const n=()=>Nt(es,"$selectedDeployment",o),r=()=>Nt(fn,"$selectedLayoutName",o),s=()=>Nt(ki,"$savedLayoutsList",o),i=()=>Nt(Mi,"$loadedTerrain",o),[o,c]=zs();ws(()=>{nr()});function m(k){es.set(k)}function f(k){fn.set(k.name),Sn.set("preset")}function d(k){fn.set(k),Sn.set("saved")}function y(){fn.set(null),Sn.set(null)}function u(){es.set(null)}function p(k){let U=[];switch(k.shape){case"L-4x8":U=[{x:0,y:0},{x:.5,y:0},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];break;case"L-4x8-mirror":U=[{x:0,y:0},{x:.5,y:0},{x:.5,y:8},{x:-4+.5,y:8},{x:-4+.5,y:8-.5},{x:0,y:8-.5}];break;case"C-4-8-4":U=[{x:0,y:0},{x:4,y:0},{x:4,y:.5},{x:.5,y:.5},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];break;case"L-5x6":U=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:5,y:6-.5},{x:5,y:6},{x:0,y:6}];break;case"L-5x6-mirror":U=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-5+.5,y:6},{x:-5+.5,y:6-.5},{x:0,y:6-.5}];break;case"L-4x6":U=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:4,y:6-.5},{x:4,y:6},{x:0,y:6}];break;case"L-4x6-mirror":U=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-4+.5,y:6},{x:-4+.5,y:6-.5},{x:0,y:6-.5}];break;default:return""}return`M ${U.map(le=>`${k.x+le.x},${k.y+le.y}`).join(" L ")} Z`}function g(k){switch(k.shape){case"L-4x8":return{x:k.x+2,y:k.y+4};case"L-4x8-mirror":return{x:k.x-2+.5,y:k.y+4};case"C-4-8-4":return{x:k.x+2,y:k.y+4};case"L-5x6":return{x:k.x+2.5,y:k.y+3};case"L-5x6-mirror":return{x:k.x-2.5+.5,y:k.y+3};case"L-4x6":return{x:k.x+2,y:k.y+3};case"L-4x6-mirror":return{x:k.x-2+.5,y:k.y+3};default:return{x:k.x,y:k.y}}}en();var _=Tm(),x=T(_),E=T(x),R=T(E);fa(R,{title:"Deployment",children:(k,I)=>{var U=ft(),le=Te(U);{var N=Ce=>{var ne=nm(),re=T(ne),ce=T(re),xe=b(re,2);K(()=>Le(ce,n().name)),V("click",xe,u),C(Ce,ne)},fe=Ce=>{var ne=rm();He(ne,5,()=>ul,it,(re,ce)=>{var xe=sm(),Ie=T(xe);K(()=>Le(Ie,e(ce).name)),V("click",xe,()=>m(e(ce))),C(re,xe)}),C(Ce,ne)};ee(le,Ce=>{n()?Ce(N):Ce(fe,!1)})}C(k,U)},$$slots:{default:!0}});var L=b(R,2);fa(L,{title:"Terrain Layout",children:(k,I)=>{var U=ft(),le=Te(U);{var N=Ce=>{var ne=im(),re=T(ne),ce=T(re),xe=b(re,2);K(()=>Le(ce,r())),V("click",xe,y),C(Ce,ne)},fe=Ce=>{var ne=um(),re=T(ne),ce=b(T(re),2);He(ce,5,()=>Ci,it,(te,z)=>{var Z=om(),Se=T(Z);K(()=>Le(Se,e(z).name)),V("click",Z,()=>f(e(z))),C(te,Z)});var xe=b(re,2);{var Ie=te=>{var z=cm(),Z=b(T(z),2);He(Z,5,s,it,(Se,H)=>{var ve=lm(),Me=T(ve);K(()=>Le(Me,e(H).name)),V("click",ve,()=>d(e(H).name)),C(Se,ve)}),C(te,z)};ee(xe,te=>{s().length>0&&te(Ie)})}C(Ce,ne)};ee(le,Ce=>{r()?Ce(N):Ce(fe,!1)})}C(k,U)},$$slots:{default:!0}});var S=b(L,2);fa(S,{title:"Summary",children:(k,I)=>{var U=hm(),le=T(U),N=b(T(le),2),fe=T(N),Ce=b(le,2),ne=b(T(Ce),2),re=T(ne),ce=b(Ce,2);{var xe=z=>{var Z=mm(),Se=b(T(Z),2),H=T(Se);K(()=>Le(H,n().objectives.length)),C(z,Z)};ee(ce,z=>{n()&&z(xe)})}var Ie=b(ce,2);{var te=z=>{var Z=dm(),Se=b(T(Z),2),H=T(Se);K(()=>Le(H,`${i().terrains.length??""} terrain, ${i().walls.length??""} walls`)),C(z,Z)};ee(Ie,z=>{(i().terrains.length>0||i().walls.length>0)&&z(te)})}K(()=>{Le(fe,n()?.name||"None"),Le(re,r()||"None")}),C(k,U)},$$slots:{default:!0}});var A=b(E,2),M=T(A),D=T(M);pr(D,{children:(k,I)=>{var U=bm(),le=Te(U);{var N=ne=>{var re=pm(),ce=Te(re);He(ce,1,()=>n().zones,it,(Ie,te)=>{var z=fm();K(Z=>{h(z,"d",Z),h(z,"fill",e(te).color),h(z,"stroke",e(te).borderColor)},[()=>Fs(e(te).path)]),C(Ie,z)});var xe=b(ce);He(xe,1,()=>n().objectives,it,(Ie,te)=>{const z=$e(()=>e(te).isPrimary?"#fbbf24":"#9ca3af"),Z=$e(()=>e(te).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)");var Se=ym(),H=Te(Se),ve=b(H),Me=b(ve);K(()=>{h(H,"cx",e(te).x),h(H,"cy",e(te).y),h(H,"r",Gr),h(H,"fill",e(Z)),h(H,"stroke",e(z)),h(ve,"cx",e(te).x),h(ve,"cy",e(te).y),h(ve,"r",Kr),h(ve,"fill",e(z)),h(Me,"cx",e(te).x),h(Me,"cy",e(te).y)}),C(Ie,Se)}),C(ne,re)};ee(le,ne=>{n()&&ne(N)})}var fe=b(le);He(fe,1,()=>i().terrains,it,(ne,re)=>{const ce=$e(()=>e(re).x+e(re).width/2),xe=$e(()=>e(re).y+e(re).height/2);var Ie=vm(),te=T(Ie);K(()=>{h(Ie,"transform",`rotate(${e(re).rotation??""}, ${e(ce)??""}, ${e(xe)??""})`),h(te,"x",e(re).x),h(te,"y",e(re).y),h(te,"width",e(re).width),h(te,"height",e(re).height)}),C(ne,Ie)});var Ce=b(fe);He(Ce,1,()=>i().walls,it,(ne,re)=>{const ce=$e(()=>g(e(re)));var xe=gm(),Ie=T(xe);K(te=>{h(xe,"transform",`rotate(${e(re).rotation??""}, ${e(ce).x??""}, ${e(ce).y??""})`),h(Ie,"d",te)},[()=>p(e(re))]),C(ne,xe)}),C(k,U)},$$slots:{default:!0}}),C(t,_),Ga(),c()}var _m=he('<g><rect role="button" tabindex="0" class="svelte-hycs6b"></rect></g>'),wm=he('<g><ellipse role="button" tabindex="0" class="svelte-hycs6b"></ellipse></g>'),Sm=he('<circle role="button" tabindex="0" class="svelte-hycs6b"></circle>'),Am=he('<text text-anchor="middle" dominant-baseline="middle" font-weight="bold" fill="white" stroke="black" stroke-width="0.02" paint-order="stroke" pointer-events="none" class="model-name"> </text>'),Cm=he('<line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="rotate-handle svelte-hycs6b"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),km=he('<line stroke="#fbbf24" stroke-width="0.12" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.25" fill="#fbbf24" pointer-events="none" class="svelte-hycs6b"></circle><text text-anchor="middle" dominant-baseline="middle" font-size="0.5" font-weight="bold" fill="#fbbf24" stroke="#000" stroke-width="0.05" paint-order="stroke" pointer-events="none" class="drag-ruler-label svelte-hycs6b"> </text>',1),Em=he("<g><!><!><!><!></g>");function ur(t,a){Ka(a,!1);const n=P(),r=P(),s=P(),i=P(),o=P(),c=P(),m=P(),f=P(),d=P(),y=P(),u=P(),p=P(),g=P(),_=P(),x=P(),E=P(),R=P(),L=P(),S=P(),A=P(),M=P();let D=ze(a,"id",8),k=ze(a,"x",8),I=ze(a,"y",8),U=ze(a,"baseType",8),le=ze(a,"playerId",8),N=ze(a,"rotation",8,0),fe=ze(a,"selected",8,!1),Ce=ze(a,"marqueePreview",8,!1),ne=ze(a,"inGroupSelection",8,!1),re=ze(a,"name",8,""),ce=ze(a,"customWidth",8,null),xe=ze(a,"customHeight",8,null),Ie=ze(a,"screenToSvg",8),te=ze(a,"onSelect",8,()=>{}),z=ze(a,"onDrag",8,()=>{}),Z=ze(a,"onDragEnd",8,()=>{}),Se=ze(a,"onRotate",8,()=>{}),H=ze(a,"onRotateEnd",8,()=>{}),ve=ze(a,"onRename",8,()=>{}),Me=P(!1),yt=!1,ye={x:0,y:0},ae=P(null),qe=null;function ke(Oe){Oe.stopPropagation()}function zt(Oe){Oe.stopPropagation();const Je=prompt("Model name:",re());Je!==null&&ve()(D(),Je)}function st(Oe){if(Oe.button!==0)return;Oe.preventDefault(),Oe.stopPropagation(),te()(D(),Oe),v(Me,!0),v(ae,{x:k(),y:I()});const Je=Ie()(Oe.clientX,Oe.clientY);ye={x:Je.x-k(),y:Je.y-I()},window.addEventListener("mousemove",Ze),window.addEventListener("mouseup",pt)}function Ze(Oe){if(!e(Me))return;const Je=Ie()(Oe.clientX,Oe.clientY);let rt=Je.x-ye.x,At=Je.y-ye.y;z()(D(),rt,At)}function pt(){e(Me)&&e(ae)&&((e(ae).x!==k()||e(ae).y!==I())&&Z()(D(),e(ae).x,e(ae).y,k(),I()),v(ae,null)),v(Me,!1),window.removeEventListener("mousemove",Ze),window.removeEventListener("mouseup",pt)}function tt(Oe){Oe.preventDefault(),Oe.stopPropagation(),yt=!0,qe=N(),window.addEventListener("mousemove",Tt),window.addEventListener("mouseup",Yt)}function Tt(Oe){if(!yt)return;const Je=Ie()(Oe.clientX,Oe.clientY),rt=Je.x-k(),At=Je.y-I();let Qt=Math.atan2(At,rt)*180/Math.PI+45;Oe.shiftKey||(Qt=Math.round(Qt/15)*15),Se()(D(),Qt)}function Yt(){yt&&qe!==null&&(qe!==N()&&H()(D(),qe,N()),qe=null),yt=!1,window.removeEventListener("mousemove",Tt),window.removeEventListener("mouseup",Yt)}pe(()=>(j(ce()),j(xe())),()=>{v(n,{customWidth:ce(),customHeight:xe()})}),pe(()=>(j(U()),e(n)),()=>{v(r,Oa(U(),e(n)))}),pe(()=>j(U()),()=>{v(s,Aa(U()))}),pe(()=>j(U()),()=>{v(i,bn(U()))}),pe(()=>j(le()),()=>{v(o,le()===1?"#3b82f6":"#ef4444")}),pe(()=>j(le()),()=>{v(c,le()===1?"rgba(59, 130, 246, 0.5)":"rgba(239, 68, 68, 0.5)")}),pe(()=>j(le()),()=>{v(m,le()===1?"rgba(59, 130, 246, 0.3)":"rgba(239, 68, 68, 0.3)")}),pe(()=>(j(fe()),j(Ce())),()=>{v(f,fe()?.15:Ce()?.12:.1)}),pe(()=>(j(fe()),e(o),j(Ce()),e(m),e(c)),()=>{v(d,fe()?e(o):Ce()?e(m):e(c))}),pe(()=>e(r),()=>{v(y,e(r)?.radius||.5)}),pe(()=>e(r),()=>{v(u,e(r)?.width?e(r).width/2:0)}),pe(()=>e(r),()=>{v(p,e(r)?.height?e(r).height/2:0)}),pe(()=>(e(i),j(ce())),()=>{v(g,e(i)&&ce()||0)}),pe(()=>(e(i),j(xe())),()=>{v(_,e(i)&&xe()||0)}),pe(()=>(e(s),e(u),e(p),e(i),e(g),e(_)),()=>{v(x,e(s)?Math.max(e(u),e(p))+1:e(i)?Math.max(e(g),e(_))/2+1:0)}),pe(()=>(j(k()),e(x),j(N())),()=>{v(E,k()+e(x)*Math.cos((N()-45)*Math.PI/180))}),pe(()=>(j(I()),e(x),j(N())),()=>{v(R,I()+e(x)*Math.sin((N()-45)*Math.PI/180))}),pe(()=>(e(Me),e(ae),j(k()),j(I())),()=>{v(L,e(Me)&&e(ae)?Math.sqrt(Math.pow(k()-e(ae).x,2)+Math.pow(I()-e(ae).y,2)):0)}),pe(()=>(e(Me),e(ae),j(k())),()=>{v(S,e(Me)&&e(ae)?(e(ae).x+k())/2:0)}),pe(()=>(e(Me),e(ae),j(I())),()=>{v(A,e(Me)&&e(ae)?(e(ae).y+I())/2:0)}),pe(()=>(e(i),e(g),e(_),e(s),e(u),e(p),e(y)),()=>{v(M,e(i)?Math.min(e(g),e(_))*.2:e(s)?Math.min(e(u),e(p))*.4:e(y)*.5)}),Rn(),en();var la=Em();let oe;var Re=T(la);{var Ue=Oe=>{var Je=_m(),rt=T(Je);K(()=>{h(Je,"transform",`rotate(${N()??""}, ${k()??""}, ${I()??""})`),h(rt,"x",k()-e(g)/2),h(rt,"y",I()-e(_)/2),h(rt,"width",e(g)),h(rt,"height",e(_)),h(rt,"fill",e(d)),h(rt,"stroke",e(o)),h(rt,"stroke-width",e(f))}),V("click",rt,ke),V("dblclick",rt,zt),V("mousedown",rt,st),C(Oe,Je)},Dt=Oe=>{var Je=ft(),rt=Te(Je);{var At=F=>{var q=wm(),we=T(q);K(()=>{h(q,"transform",`rotate(${N()??""}, ${k()??""}, ${I()??""})`),h(we,"cx",k()),h(we,"cy",I()),h(we,"rx",e(u)),h(we,"ry",e(p)),h(we,"fill",e(d)),h(we,"stroke",e(o)),h(we,"stroke-width",e(f))}),V("click",we,ke),V("dblclick",we,zt),V("mousedown",we,st),C(F,q)},Qt=F=>{var q=Sm();K(()=>{h(q,"cx",k()),h(q,"cy",I()),h(q,"r",e(y)),h(q,"fill",e(d)),h(q,"stroke",e(o)),h(q,"stroke-width",e(f))}),V("click",q,ke),V("dblclick",q,zt),V("mousedown",q,st),C(F,q)};ee(rt,F=>{e(s)?F(At):F(Qt,!1)},!0)}C(Oe,Je)};ee(Re,Oe=>{e(i)?Oe(Ue):Oe(Dt,!1)})}var Et=b(Re);{var Ht=Oe=>{var Je=Am(),rt=T(Je);K(()=>{h(Je,"x",k()),h(Je,"y",I()),h(Je,"font-size",e(M)),Le(rt,re())}),C(Oe,Je)};ee(Et,Oe=>{re()&&Oe(Ht)})}var Xt=b(Et);{var Ya=Oe=>{var Je=Cm(),rt=Te(Je),At=b(rt),Qt=b(At);K(()=>{h(rt,"x1",k()),h(rt,"y1",I()),h(rt,"x2",e(E)),h(rt,"y2",e(R)),h(At,"cx",e(E)),h(At,"cy",e(R)),h(Qt,"transform",`translate(${e(E)??""}, ${e(R)??""})`)}),V("mousedown",At,tt),C(Oe,Je)};ee(Xt,Oe=>{fe()&&(e(s)||e(i))&&!ne()&&Oe(Ya)})}var Ha=b(Xt);{var Zt=Oe=>{var Je=km(),rt=Te(Je),At=b(rt),Qt=b(At),F=T(Qt);K(q=>{h(rt,"x1",(e(ae),l(()=>e(ae).x))),h(rt,"y1",(e(ae),l(()=>e(ae).y))),h(rt,"x2",k()),h(rt,"y2",I()),h(At,"cx",(e(ae),l(()=>e(ae).x))),h(At,"cy",(e(ae),l(()=>e(ae).y))),h(Qt,"x",e(S)),h(Qt,"y",e(A)-.5),Le(F,`${q??""}"`)},[()=>(e(L),l(()=>e(L).toFixed(2)))]),C(Oe,Je)};ee(Ha,Oe=>{e(Me)&&e(ae)&&e(L)>.1&&Oe(Zt)})}K(()=>oe=Ca(la,0,"model-base svelte-hycs6b",null,oe,{selected:fe(),dragging:e(Me)})),C(t,la),Ga()}var Mm=he('<ellipse fill="none" stroke-width="2"></ellipse>'),Rm=he('<circle fill="none" stroke-width="2"></circle>'),Lm=ge('<button class="palette-item svelte-1urec28"><svg class="svelte-1urec28"><!></svg> <span class="label svelte-1urec28"> </span></button>');function Wr(t,a){Ka(a,!1);const n=P(),r=P(),s=P(),i=P(),o=P(),c=P();let m=ze(a,"baseSize",8),f=ze(a,"playerId",8),d=ze(a,"onDragStart",8,()=>{});const y=3;function u(S){S.button===0&&(S.preventDefault(),d()(m(),S))}pe(()=>j(f()),()=>{v(n,f()===1?"#3b82f6":"#ef4444")}),pe(()=>j(m()),()=>{v(r,m().width!==void 0)}),pe(()=>(e(r),j(m())),()=>{v(s,e(r)?null:m().radius*y)}),pe(()=>(e(r),j(m())),()=>{v(i,e(r)?m().width/2*y:null)}),pe(()=>(e(r),j(m())),()=>{v(o,e(r)?m().height/2*y:null)}),pe(()=>(e(r),j(m())),()=>{v(c,e(r)?Math.max(m().width,m().height)*y:m().radius*2*y)}),Rn(),en();var p=Lm(),g=T(p),_=T(g);{var x=S=>{var A=Mm();K(()=>{h(A,"cx",(e(c)+8)/2),h(A,"cy",(e(c)+8)/2),h(A,"rx",e(i)),h(A,"ry",e(o)),h(A,"stroke",e(n))}),C(S,A)},E=S=>{var A=Rm();K(()=>{h(A,"cx",(e(c)+8)/2),h(A,"cy",(e(c)+8)/2),h(A,"r",e(s)),h(A,"stroke",e(n))}),C(S,A)};ee(_,S=>{e(r)?S(x):S(E,!1)})}var R=b(g,2),L=T(R);K(()=>{Pc(p,`border-color: ${e(n)??""}`),h(p,"title",(j(m()),l(()=>m().label))),h(g,"width",e(c)+8),h(g,"height",e(c)+8),h(g,"viewBox",`0 0 ${e(c)+8} ${e(c)+8}`),Le(L,(j(m()),l(()=>m().label)))}),V("mousedown",p,u),C(t,p),Ga()}const ml="warhammer-imported-armies";function Dm(){try{const t=localStorage.getItem(ml);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load army imports from storage:",t),[]}}function jr(t){try{localStorage.setItem(ml,JSON.stringify(t))}catch(a){console.error("Failed to save army imports to storage:",a)}}function Im(){return"import-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function $m(){const{subscribe:t,set:a,update:n}=oa(Dm());return{subscribe:t,addImport(r,s,i,o){const c=Im(),m={id:c,name:r||"Unnamed Army",timestamp:Date.now(),rawText:s,parsedData:i,faction:i.FACTION_KEYWORD||"Unknown",totalPoints:i.TOTAL_ARMY_POINTS||"0pts",playerId:o};return n(f=>{const d=[...f,m];return jr(d),d}),c},removeImport(r){n(s=>{const i=s.filter(o=>o.id!==r);return jr(i),i})},getImport(r){return vn({subscribe:t}).find(i=>i.id===r)||null},clear(){a([]),jr([])}}}const ci=$m();var Pm=ge('<div class="error-message svelte-leqhjl"> </div>'),Nm=ge('<div class="success-message svelte-leqhjl"> </div>'),Om=ge("<option> </option>"),Wm=ge('<div class="army-import-panel svelte-leqhjl"><div class="form-group svelte-leqhjl"><label for="army-list-input" class="svelte-leqhjl">Paste Army List:</label> <textarea id="army-list-input" placeholder="Paste your army list here (GW App, WTC, ListForge formats supported)" rows="12" class="svelte-leqhjl"></textarea></div> <div class="button-group svelte-leqhjl"><button class="svelte-leqhjl"> </button> <button class="svelte-leqhjl">Clear</button></div> <!> <!> <div class="divider svelte-leqhjl"></div> <div class="form-group svelte-leqhjl"><label for="import-select" class="svelte-leqhjl">Load Previous Import:</label> <select id="import-select" class="svelte-leqhjl"><option>-- Select an import --</option><!></select> <button class="load-button svelte-leqhjl">Load</button></div></div>');function Ym(t,a){Ka(a,!1);const n=()=>Nt(ci,"$armyImports",r),[r,s]=zs();let i=ze(a,"currentPlayer",8,1);const o=Vo();let c=P(""),m=P(!1),f=P(""),d=P(""),y=P("");function u(){if(!e(c).trim()){v(f,"Please paste an army list");return}v(m,!0),v(f,""),v(d,""),o("parse",{text:e(c),playerId:i()})}function p(){if(!e(y))return;const z=ci.getImport(e(y));z&&(v(c,z.rawText),v(d,`Loaded: ${z.name} (${z.faction}, ${z.totalPoints})`),v(f,""))}function g(){v(c,""),v(f,""),v(d,"")}function _(z){v(m,z)}function x(z){v(f,z),v(d,""),v(m,!1)}function E(z){v(d,z),v(f,""),v(m,!1)}function R(){v(c,"")}var L={setLoading:_,setError:x,setSuccess:E,clearText:R};en();var S=Wm(),A=T(S),M=b(T(A),2),D=b(A,2),k=T(D),I=T(k),U=b(k,2),le=b(D,2);{var N=z=>{var Z=Pm(),Se=T(Z);K(()=>Le(Se,`â ï¸ ${e(f)??""}`)),C(z,Z)};ee(le,z=>{e(f)&&z(N)})}var fe=b(le,2);{var Ce=z=>{var Z=Nm(),Se=T(Z);K(()=>Le(Se,`â ${e(d)??""}`)),C(z,Z)};ee(fe,z=>{e(d)&&z(Ce)})}var ne=b(fe,4),re=b(T(ne),2);K(()=>{e(y),No(()=>{e(m),n()})});var ce=T(re);ce.value=ce.__value="";var xe=b(ce);He(xe,1,n,z=>z.id,(z,Z)=>{var Se=Om(),H=T(Se),ve={};K(()=>{Le(H,`${e(Z),l(()=>e(Z).name)??""} (${e(Z),l(()=>e(Z).faction)??""}, ${e(Z),l(()=>e(Z).totalPoints)??""})`),ve!==(ve=(e(Z),l(()=>e(Z).id)))&&(Se.value=(Se.__value=(e(Z),l(()=>e(Z).id)))??"")}),C(z,Se)});var Ie=b(re,2);K(z=>{M.disabled=e(m),k.disabled=z,Le(I,e(m)?"Parsing...":"Parse Army List"),U.disabled=e(m),re.disabled=e(m),Ie.disabled=e(m)||!e(y)},[()=>(e(m),e(c),l(()=>e(m)||!e(c).trim()))]),Ia(M,()=>e(c),z=>v(c,z)),V("click",k,u),V("click",U,g),Go(re,()=>e(y),z=>v(y,z)),V("click",Ie,p),C(t,S),ar(a,"setLoading",_),ar(a,"setError",x),ar(a,"setSuccess",E),ar(a,"clearText",R);var te=Ga(L);return s(),te}var Hm=ge("<option> </option>"),Fm=ge('<tr><td class="unit-name svelte-1xyf33v"> </td><td class="quantity svelte-1xyf33v"> </td><td class="svelte-1xyf33v"><select class="svelte-1xyf33v"></select></td><td class="skip-cell svelte-1xyf33v"><input type="checkbox" class="svelte-1xyf33v"/></td></tr>'),Bm=ge('<div class="dialog-overlay svelte-1xyf33v"><div class="dialog svelte-1xyf33v"><div class="dialog-header svelte-1xyf33v"><h3 class="svelte-1xyf33v">Unmatched Units</h3> <button class="close-button svelte-1xyf33v">&times;</button></div> <div class="dialog-content svelte-1xyf33v"><p class="info-text svelte-1xyf33v">The following units were not found in the database. Please select base sizes or skip them:</p> <div class="units-table svelte-1xyf33v"><table class="svelte-1xyf33v"><thead class="svelte-1xyf33v"><tr><th class="svelte-1xyf33v">Unit Name</th><th class="svelte-1xyf33v">Quantity</th><th class="svelte-1xyf33v">Base Size</th><th class="svelte-1xyf33v">Skip</th></tr></thead><tbody></tbody></table></div></div> <div class="dialog-footer svelte-1xyf33v"><button class="cancel-button svelte-1xyf33v">Cancel</button> <button class="import-button svelte-1xyf33v">Import Selected</button></div></div></div>');function qm(t,a){Ka(a,!1);let n=ze(a,"unmatchedUnits",24,()=>[]),r=ze(a,"show",12,!1);const s=Vo();let i=P({});const o=[...Qa.circles.map(u=>({value:u.type,label:u.label})),...Qa.ovals.map(u=>({value:u.type,label:u.label})),{value:"rect-custom",label:"Custom Rectangle (Vehicle)"}];function c(){const u=n().filter(p=>!e(i)[p.id]?.skip).map(p=>({unitName:p.unitName,quantity:p.quantity,baseType:e(i)[p.id]?.baseType||"32mm"}));s("import",{selected:u}),m()}function m(){r(!1),s("close")}pe(()=>j(n()),()=>{v(i,{}),n().forEach(u=>{zr(i,e(i)[u.id]={baseType:"32mm",skip:!1})})}),Rn(),en();var f=ft(),d=Te(f);{var y=u=>{var p=Bm(),g=T(p),_=T(g),x=b(T(_),2),E=b(_,2),R=b(T(E),2),L=T(R),S=b(T(L));He(S,5,n,k=>k.id,(k,I)=>{var U=Fm();let le;var N=T(U),fe=T(N),Ce=b(N),ne=T(Ce),re=b(Ce),ce=T(re);K(()=>{e(i),No(()=>{e(I)})}),He(ce,5,()=>o,it,(te,z)=>{var Z=Hm(),Se=T(Z),H={};K(()=>{Le(Se,(e(z),l(()=>e(z).label))),H!==(H=(e(z),l(()=>e(z).value)))&&(Z.value=(Z.__value=(e(z),l(()=>e(z).value)))??"")}),C(te,Z)});var xe=b(re),Ie=T(xe);K(()=>{le=Ca(U,1,"svelte-1xyf33v",null,le,{skipped:e(i)[e(I).id]?.skip}),Le(fe,(e(I),l(()=>e(I).unitName))),Le(ne,(e(I),l(()=>e(I).quantity||"1x"))),ce.disabled=(e(i),e(I),l(()=>e(i)[e(I).id]?.skip))}),Go(ce,()=>e(i)[e(I).id].baseType,te=>zr(i,e(i)[e(I).id].baseType=te)),_a(Ie,()=>e(i)[e(I).id].skip,te=>zr(i,e(i)[e(I).id].skip=te)),C(k,U)});var A=b(E,2),M=T(A),D=b(M,2);V("click",x,m),V("click",M,m),V("click",D,c),V("click",g,k=>k.stopPropagation()),V("click",p,m),C(u,p)};ee(d,u=>{r()&&u(y)})}C(t,f),Ga()}function ss(t){const a=t.match(/^\s*/);return a?a[0].length:0}function de(t){return t?t.toLowerCase().replace(/\s+/g," ").trim():""}function is(t){const a=/^(?:(\d+)x?\s+)?(.*)/,n=t.trim().match(a);if(n){const r=n[1]?`${n[1]}x`:"1x";let s=n[2].trim();return s=s.replace(/^with\s+/i,"").trim(),{quantity:r,name:s}}return{quantity:"1x",name:t.trim()}}function Tn(t){return Array.isArray(t)&&t.sort((a,n)=>{const r=parseInt(String(a&&a.quantity||"1x").replace(/x/i,""),10)||1,s=parseInt(String(n&&n.quantity||"1x").replace(/x/i,""),10)||1;if(r!==s)return s-r;const i=a&&a.name?a.name.toString().toLowerCase():"",o=n&&n.name?n.name.toString().toLowerCase():"";return i<o?-1:i>o?1:0}),t}const Cn={"World Eaters":"Chaos","Chaos Space Marines":"Chaos","Emperor's Children":"Chaos","Death Guard":"Chaos","Chaos Daemons":"Chaos","Chaos Knights":"Chaos","Thousand Sons":"Chaos","Space Marines":"Imperium","Iron Hands":"Space Marines",Salamanders:"Space Marines","Space Wolves":"Space Marines",Ultramarines:"Space Marines","White Scars":"Space Marines","Adepta Sororitas":"Imperium","Astra Militarum":"Imperium","Imperial Fists":"Space Marines","Dark Angels":"Space Marines","Blood Angels":"Space Marines","Raven Guard":"Space Marines","Black Templars":"Space Marines",Deathwatch:"Space Marines","Grey Knights":"Imperium","Imperial Knights":"Imperium","Adeptus Custodes":"Imperium","Adeptus Titanicus":"Imperium","Adeptus Mechanicus":"Imperium","Agents of the Imperium":"Imperium",Aeldari:"Xenos",Drukhari:"Xenos",Ynnari:"Xenos",Harlequins:"Xenos",Necrons:"Xenos",Orks:"Xenos",Tyranids:"Xenos","T'au Empire":"Xenos",Tau:"Xenos","T'au":"Xenos","Genestealer Cults":"Xenos","Leagues of Votann":"Xenos"};function Ss(t){if(!t)return t;t.SUMMARY=t.SUMMARY||{};const a=t.SUMMARY;a.LIST_TITLE=a.LIST_TITLE||"",a.FACTION_KEYWORD&&(a.FACTION_KEYWORD=String(a.FACTION_KEYWORD).trim()),a.DETACHMENT&&(a.DETACHMENT=String(a.DETACHMENT).replace(/\u00A0/g," ").trim()),a.TOTAL_ARMY_POINTS&&(a.TOTAL_ARMY_POINTS=String(a.TOTAL_ARMY_POINTS).trim());const n=s=>{if(!s)return"";try{return s.toString().normalize("NFD").replace(new RegExp("\\p{M}","gu"),"").replace(/[\u2018\u2019\u201B\u2032]/g,"'").replace(/[^\w\s'\-]/g,"").toLowerCase().trim()}catch{return s.toString().toLowerCase().trim()}},r=a.FACTION_KEYWORD||null;if(r){const s=n(r);let i;for(const o of Object.keys(Cn))if(n(o)===s){i=o;break}if(i){const o=r.toString().replace(/[\u2018\u2019\u201B\u2032]/g,"'").trim();a.DISPLAY_FACTION=`${Cn[i]} - ${o}`}else a.DISPLAY_FACTION=a.DISPLAY_FACTION||r+(a.DETACHMENT?` - ${a.DETACHMENT}`:"")}else a.DETACHMENT?a.DISPLAY_FACTION=a.DISPLAY_FACTION||a.DETACHMENT:a.DISPLAY_FACTION=a.DISPLAY_FACTION||"";if(!a.FACTION_KEY){if(a.FACTION_KEYWORD)try{a.FACTION_KEY=a.FACTION_KEYWORD.toString().toLowerCase()}catch{a.FACTION_KEY=String(a.FACTION_KEYWORD).toLowerCase()}else if(a.DISPLAY_FACTION){const s=(a.DISPLAY_FACTION||"").split(" - ")[0];try{a.FACTION_KEY=s.toString().toLowerCase()}catch{a.FACTION_KEY=String(s).toLowerCase()}}}return t}function cs(t,a,n,r,s="",i=!1,o="wargear"){if(!t)return;t.items=t.items||[];const c=is(String(a||"").trim()),m=c.quantity?String(c.quantity):"1x",f=c.name||"",d=de(f);if(i){const u=String(n||""),p=String(s||"");if(de(u)===de(f)||p&&de(p)===de(f))return}const y=t.items.find(u=>de(u.name||"")===d);if(y){const u=parseInt(String(y.quantity||"1x").replace(/x/i,""),10)||0,p=parseInt(String(m||"1x").replace(/x/i,""),10)||0;y.quantity=`${u+p}x`}else{const u=de(f)==="warlord"?"special":o;t.items.push({quantity:m,name:f,items:[],type:u,nameshort:""})}}function Um(t,a){if(!t||!a)return;a.items=a.items||[];const n=t.trim(),r=n.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",i=n.replace(/\s*\([^)]+\)$/,"").trim(),o=de(i);if((a.items||[]).some(y=>y&&y.type==="special"&&de((y.name||"").replace(/^Enhancement:\s*/i,""))===o))return;const f=`E: ${i.split(/\s+/).map(y=>y[0]?y[0].toUpperCase():"").join("")}${s}`.trim(),d={quantity:"1x",name:`Enhancement: ${i}`,nameshort:f,items:[],type:"special"};a.items.push(d)}function Km(t){const a={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return a;const n=[];let r=0;const s=y=>/^(\d+)x?\s+/i.test(String(y||"").trim()),i=(y,u)=>{const p=String(y||"").trim();if(!p)return p;if(s(p)){const g=p.match(/^(\d+)x?\s+(.*)$/i);if(g){const _=parseInt(g[1],10)||1,x=g[2].trim();return`${Math.max(1,_*(parseInt(u,10)||1))}x ${x}`}return p}return`${u}x ${p}`};for(;r<t.length;r++){const u=(t[r]||"").trim();if(u){if(u.startsWith("+")||u.startsWith("&")){n.push(u);continue}break}}for(const y of n){if(y.startsWith("&")){const _=y.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);_&&(_[1].trim(),(_[3]||"").trim());continue}const p=y.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(p){const g=p[1].trim().toUpperCase(),_=p[2].trim();if(g==="FACTION KEYWORD"){const x=_.split(" - ");a.SUMMARY.FACTION_KEYWORD=x[x.length-1].trim()}else g==="DETACHMENT"?a.SUMMARY.DETACHMENT=_.replace(/\u00A0/g," "):g==="TOTAL ARMY POINTS"&&(a.SUMMARY.TOTAL_ARMY_POINTS=_)}}if(a.SUMMARY.LIST_TITLE="",a.SUMMARY&&a.SUMMARY.FACTION_KEYWORD){const y=a.SUMMARY.FACTION_KEYWORD,u=Object.keys(Cn).find(g=>g.toLowerCase()===(y||"").toString().toLowerCase()),p=u?Cn[u]:null;p?a.SUMMARY.DISPLAY_FACTION=`${p} - ${y}`:a.SUMMARY.DISPLAY_FACTION=y+(a.SUMMARY.DETACHMENT?` - ${a.SUMMARY.DETACHMENT}`:"");try{a.SUMMARY.FACTION_KEY=y.toString().toLowerCase()}catch{}}let o=null,c=null;const m=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,f=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;for(;r<t.length;r++){const y=t[r]||"",u=y.trim();if(!u)continue;if(/^Enhancement:\s*/i.test(u)){const E=u.replace(/^Enhancement:\s*/i,"").trim();c&&Um(E,c);continue}const p=u.match(m);if(p){const E=p[1],R=p[2]?`${p[2]}x`:"1x",L=(p[3]||"").trim(),S=parseInt(p[4],10)||0,A=p[5],M={quantity:R,name:L,points:S,items:[],isComplex:!1,nameshort:""};E?(a.CHARACTER.push(M),c=M):(a["OTHER DATASHEETS"]=a["OTHER DATASHEETS"]||[],a["OTHER DATASHEETS"].push(M)),o=M,A&&A.split(",").map(D=>D.trim()).filter(Boolean).forEach(D=>cs(M,D,M.name,a.SUMMARY.FACTION_KEYWORD||"",M.name,!0));continue}const g=y.match(f);if(g){const E=g[1].trim(),R=E.match(/^(\d+)\s+with\s+(.*)$/i);if(R&&o){const A=parseInt(R[1],10)||1,M=R[2],D=o.items&&o.items.length>0?o.items[o.items.length-1]:o;M.split(",").map(k=>k.trim()).filter(Boolean).forEach(k=>{const I=i(k,A);cs(D,I,D.name,a.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const L=E.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(L&&o){const A=L[1],M=L[2].trim(),D=L[3]||"",k={quantity:A,name:M,items:[],type:"subunit"};if(o.items=o.items||[],o.items.push(k),D){const I=D.match(/^(\d+)\s+with\s+(.*)$/i);if(I){const U=parseInt(I[1],10)||1;I[2].split(",").map(N=>N.trim()).filter(Boolean).forEach(N=>{const fe=i(N,U);cs(k,fe,k.name,a.SUMMARY.FACTION_KEYWORD||"",o.name,!0)})}else D.split(",").map(U=>U.trim()).filter(Boolean).forEach(U=>cs(k,U,k.name,a.SUMMARY.FACTION_KEYWORD||"",o.name,!0))}continue}const S=E.match(/^(\d+x?)\s+(.*)$/i);if(S&&o){const A={quantity:S[1],name:S[2].trim(),items:[],type:"subunit"};o.items=o.items||[],o.items.push(A);continue}if(o){cs(o,E,o.name,a.SUMMARY.FACTION_KEYWORD||"",o.name,!0);continue}continue}const _=u.match(/^(\d+)\s+with\s+(.*)$/i);if(_&&o){const E=parseInt(_[1],10)||1,R=_[2],L=o.items&&o.items.length>0?o.items[o.items.length-1]:o;R.split(",").map(S=>S.trim()).filter(Boolean).forEach(S=>{const A=i(S,E);cs(L,A,L.name,a.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const x=u.match(/^(.*?):\s*(.*)$/);if(x&&o){(x[2]||"").split(",").map(R=>R.trim()).filter(Boolean).forEach(R=>cs(o,R,o.name,a.SUMMARY.FACTION_KEYWORD||"",o.name,!0));continue}}const d=[...a.CHARACTER||[],...a["OTHER DATASHEETS"]||[]];for(const y of d){y&&Array.isArray(y.items)&&y.items.length>0&&Tn(y.items);const u=y&&Array.isArray(y.items)?y.items.filter(p=>p&&p.type==="subunit"):[];for(const p of u)p&&Array.isArray(p.items)&&p.items.length>0&&Tn(p.items)}return Ss(a),a}function hn(t,a,n,r,s="",i=!1,o="wargear"){if(!t)return;t.items=t.items||[];const c=String(a||"").trim();if(/battlesuit support system|homing beacon|marker drone/i.test(c))try{Za.push(`processing raw=${c} for target=${t&&t.name}`)}catch{}let m=c.split(",").map(S=>S.trim()).filter(Boolean);try{const S=new Set;m=m.filter(A=>{const M=de(Ps(On(A)));return S.has(M)?!1:(S.add(M),!0)})}catch{}try{/stealth shas'vre|stealth battlesuits/i.test((t&&t.name||"")+(s||"")+c)&&Za.push(`splitParts target=${t&&t.name} top=${s} parts=${JSON.stringify(m)}`)}catch{}if(m.length>1){m.forEach(S=>hn(t,S,n,r,s,i,o));return}const f=is(c),d=f.quantity!==void 0&&f.quantity!==null;let y=d?String(f.quantity):"1x",u=f.name||"";try{u=Ps(On(u))}catch{}const p=/battlesuit support system|homing beacon|marker drone/i;try{const S=u.toLowerCase();if(S.includes("battlesuit support system")||S.includes("homing beacon")||S.includes("marker drone"))try{Za.push(`addItemToTarget target=${t&&t.name} raw=${c}`)}catch{}}catch{}const g=u.match(/^(\d+)x\s+(.*)$/i);if(g){const S=parseInt(g[1],10)||1,A=parseInt(String(y||"1x").replace(/x/i,""),10)||1;y=`${Math.max(1,A*S)}x`,u=g[2]}try{Za.push(`PARSE_QTY name=${u} parsedQtyRaw=${String(f.quantity||"")} qtyToken=${y}`)}catch{}let _=(S=>isNaN(S)?1:S)(parseInt(String(y||"1x").replace(/x/i,""),10)),x=_;try{if(t&&t.type==="subunit"){const S=parseInt(String(t.quantity||"1x").replace(/[^0-9]/g,""),10)||1;try{Za.push(`CALC_EFFECTIVE target=${t&&t.name} parentQty=${S} parsedQty=${_} hasExplicit=${d}`)}catch{}x=d?_:S;try{Za.push(`EFFECTIVE_QTY target=${t&&t.name} effectiveQty=${x}`)}catch{}}}catch{}const E=u,R=de(u);if(i){const S=String(n||""),A=String(s||"");if(de(S)===de(u)||A&&de(A)===de(u)){if(p.test(u))try{Za.push(`SKIP matched unitname name=${u} ctx=${S} top=${A}`)}catch{}return}}const L=t.items.find(S=>de(S.name||"")===R);if(L){const S=parseInt(String(L.quantity||"1x").replace(/x/i,""),10)||0,A=S+x;L.quantity=`${A}x`;try{Za.push(`UPDATED existing name=${u} existing=${S} added=${x} new=${A} target=${t&&t.name}`)}catch{}}else{const S=de(u)==="warlord"?"special":o;t.items.push({quantity:`${x}x`,name:E,items:[],type:S,nameshort:""});try{Za.push(`PUSHED new name=${u} quantity=${x} target=${t&&t.name}`)}catch{}}}function On(t){if(!t)return t;const a=t.toLowerCase();return a.includes("shield")&&a.includes("drone")?"Shield Drone":a.includes("marker")&&a.includes("drone")?"Marker Drone":a.includes("marker")&&a.includes("beacon")?"Homing Beacon":t}function Ps(t){return t&&t.split(/\s+/).map(a=>!a||/[A-Z]/.test(a.slice(1))?a:a[0].toUpperCase()+a.slice(1).toLowerCase()).join(" ")}function ji(t,a){if(!a)return`${t}x`;const n=String(a).trim(),r=n.match(/^(\d+)x\s+(.*)$/i);if(r){const s=parseInt(r[1],10)||1,i=r[2]||"";return`${Math.max(1,t*s)}x ${i}`}return`${t}x ${n}`}function Gm(t,a){if(!t||!a)return;a.items=a.items||[];const n=t.trim(),r=n.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",i=n.replace(/\s*\([^)]+\)$/,"").trim(),o=de(i);if((a.items||[]).some(y=>{if(!y||!y.name)return!1;const u=String(y.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]+\)$/,"").trim();return de(u)===o}))return;const f=`E: ${i.split(/\s+/).map(y=>y[0]?y[0].toUpperCase():"").join("")}${s}`.trim(),d={quantity:"1x",name:`Enhancement: ${i}`,nameshort:f,items:[],type:"special"};a.items.push(d)}function zm(t){const a={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return a;const n=[];let r=0;for(;r<t.length;r++){const d=(t[r]||"").trim();if(d){if(d.startsWith("+")){n.push(d);continue}if(!d.startsWith("&"))break}}for(const f of n){const y=f.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(y){const u=y[1].trim().toUpperCase(),p=y[2].trim();if(u==="FACTION KEYWORD"){const g=p.split(" - ");a.SUMMARY.FACTION_KEYWORD=g[g.length-1].trim()}else u==="DETACHMENT"?a.SUMMARY.DETACHMENT=p.replace(/\u00A0/g," "):u==="TOTAL ARMY POINTS"&&(a.SUMMARY.TOTAL_ARMY_POINTS=p)}}if(a.SUMMARY.LIST_TITLE="",a.SUMMARY&&a.SUMMARY.FACTION_KEYWORD){const f=a.SUMMARY.FACTION_KEYWORD,d=Object.keys(Cn).find(u=>u.toLowerCase()===(f||"").toString().toLowerCase()),y=d?Cn[d]:null;y?a.SUMMARY.DISPLAY_FACTION=`${y} - ${f}`:a.SUMMARY.DISPLAY_FACTION=f+(a.SUMMARY.DETACHMENT?` - ${a.SUMMARY.DETACHMENT}`:"");try{a.SUMMARY.FACTION_KEY=f.toString().toLowerCase()}catch{}}const s=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,i=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;let o=null,c=null;for(;r<t.length;r++){const f=t[r]||"",d=f.trim();if(!d)continue;if(/^Enhancement:\s*/i.test(d)){const _=d.replace(/^Enhancement:\s*/i,"").trim();c&&Gm(_,c);continue}const y=d.match(s);if(y){const _=y[1],x=y[2]?`${y[2]}x`:"1x",E=(y[3]||"").trim(),R=parseInt(y[4],10)||0,L=y[5],S={quantity:x,name:E,points:R,items:[],isComplex:!1,nameshort:"",charId:_||null};_?(a.CHARACTER.push(S),c=S):(a["OTHER DATASHEETS"]=a["OTHER DATASHEETS"]||[],a["OTHER DATASHEETS"].push(S)),o=S,L&&L.split(",").map(A=>A.trim()).filter(Boolean).forEach(A=>hn(S,A,S.name,a.SUMMARY.FACTION_KEYWORD||"",S.name,!0));continue}const u=f.match(i);if(u){const _=u[1].trim(),x=_.match(/^(\d+)\s+with\s+(.*)$/i);if(x&&o){const L=parseInt(x[1],10)||1,S=x[2],A=o.items&&o.items.length>0?o.items[o.items.length-1]:o;try{Za.push(`WITHMATCH unit=${o.name} target=${A&&A.name} n=${L} rest=${S}`)}catch{}S.split(",").map(M=>M.trim()).filter(Boolean).forEach(M=>{const k=Ps(On(M));if(A&&A.type==="subunit"){try{Za.push(`WITH->SUB target=${A.name} item=${k} n=${L}`)}catch{}hn(A,`${L}x ${k}`,A.name,a.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}else{try{Za.push(`WITH->UNIT unit=${o.name} item=${k} n=${L}`)}catch{}hn(A,ji(L,k),A.name,a.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}});continue}const E=_.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(E&&o){const L=E[1],S=E[2].trim(),A=E[3]||"",M={quantity:L,name:S,items:[],type:"subunit",_parent:o};if(o.items=o.items||[],o.items.push(M),A){const D=A.match(/^(\d+)\s+with\s+(.*)$/i);D?D[2].split(",").map(I=>I.trim()).filter(Boolean).forEach(I=>{const U=On(I);hn(M,U,M.name,a.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}):A.split(",").map(k=>k.trim()).filter(Boolean).forEach(k=>{const I=On(k);hn(M,I,M.name,a.SUMMARY.FACTION_KEYWORD||"",o.name,!0)})}continue}const R=_.match(/^(\d+x?)\s+(.*)$/i);if(R&&o)if(o.charId){const L=R[1],S=R[2].trim();hn(o,`${L} ${S}`,o.name,a.SUMMARY.FACTION_KEYWORD||"",o.name,!0);continue}else{const L={quantity:R[1],name:R[2].trim(),items:[],type:"subunit",_parent:o};o.items=o.items||[],o.items.push(L);continue}if(o){let L=_.split(",").map(A=>A.trim()).filter(Boolean);try{const A=o.items&&o.items.length>0?o.items[o.items.length-1]:null;A&&A.name&&(L=L.map(M=>{const D=M.match(/^(.*)\s*\(([^)]+)\)\s*$/);if(D){const k=D[1].trim();if(de(k)===de(A.name))return k}return M}))}catch{}try{const A=new Set;L=L.filter(M=>{const D=de(Ps(On(M)));return A.has(D)?!1:(A.add(D),!0)})}catch{}let S=o;if(o.items&&o.items.length>0){const A=o.items[o.items.length-1];A&&A.type==="subunit"&&(S=A)}L.forEach(A=>{const M=Ps(On(A));hn(S,M,S.name||o.name,a.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}continue}const p=d.match(/^(\d+)\s+with\s+(.*)$/i);if(p&&o){const _=parseInt(p[1],10)||1,x=p[2],E=o.items&&o.items.length>0?o.items[o.items.length-1]:o;x.split(",").map(R=>R.trim()).filter(Boolean).forEach(R=>{const S=Ps(On(R));E&&E.type==="subunit"?hn(E,`${_}x ${S}`,E.name,a.SUMMARY.FACTION_KEYWORD||"",o.name,!0):hn(E,ji(_,S),E.name,a.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const g=d.match(/^(.*?):\s*(.*)$/);if(g&&o){(g[2]||"").split(",").map(x=>x.trim()).filter(Boolean).forEach(x=>{const E=On(x);hn(o,E,o.name,a.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}}const m=[...a.CHARACTER||[],...a["OTHER DATASHEETS"]||[]];for(const f of m){f&&Array.isArray(f.items)&&f.items.length>0&&Tn(f.items);const d=f&&Array.isArray(f.items)?f.items.filter(y=>y&&y.type==="subunit"):[];for(const y of d)y&&Array.isArray(y.items)&&y.items.length>0&&Tn(y.items)}Ss(a);try{a.SUMMARY._parseDebug=(Za||[]).slice(0,200)}catch{}return a}const Za=[];function kr(t){const a=ss(t);if(a>0)return a;const n=(t||"").trim();return n.startsWith("â¦")||n.startsWith("+")?2:0}function Er(t){if(!t)return"";const a=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(t).split(/\s+/).map((n,r)=>{if(!n)return"";const s=n.toLowerCase();return r>0&&a.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function Ms(t,a,n,r,s="",i=!1,o="wargear",c=1){if(!t)return;t.items=t.items||[];const m=is(String(a||"").trim()),f=m.quantity?String(m.quantity):"1x",d=m.name||"",y=de(d);if(i){const p=String(n||""),g=String(s||"");if(de(p)===de(d)||g&&de(g)===de(d))return}const u=t.items.find(p=>de(p.name||"")===y);if(u){const p=parseInt(String(u.quantity||"1x").replace(/x/i,""),10)||0,g=parseInt(String(f||"1x").replace(/x/i,""),10)||0;u.quantity=`${p+g}x`}else{const p=de(d)==="warlord"?"special":o;t.items.push({quantity:f,name:d,items:[],type:p,nameshort:""})}}function Zi(t,a,n){if(!t||!a)return;a.items=a.items||[];const r=t.trim(),s=r.match(/\(([^)]+)\)$/),i=s?` (${s[1]})`:"",o=r.replace(/\s*\([^)]+\)$/,"").trim(),c=de(o);if((a.items||[]).some(u=>u&&u.type==="special"&&de((u.name||"").replace(/^Enhancement:\s*/i,""))===c))return;const d=`E: ${o.split(/\s+/).map(u=>u[0]?u[0].toUpperCase():"").join("")}${i}`.trim(),y={quantity:"1x",name:`Enhancement: ${o}`,nameshort:d,items:[],type:"special"};a.items.push(y)}function Xm(t){const a={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},n=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=t.findIndex(u=>n.test((u||"").trim().toUpperCase()));let i=(r===-1?t.slice(0,0):t.slice(0,r)).map(u=>(u||"").trim()).filter(u=>u&&!u.startsWith("Exported with"));const o=i.findIndex(u=>u&&u.trim()!=="");if(o!==-1){const u=i[o],p=u.match(/^(.*?)\s*\((\s*\d+\s*(?:pts|points)\s*)\)\s*$/i);if(p){a.SUMMARY.LIST_TITLE=p[1].trim();const M=(p[2].match(/(\d+)/)||[])[1]||"";M&&(a.SUMMARY.TOTAL_ARMY_POINTS=`${M}pts`)}else a.SUMMARY.LIST_TITLE=u;const g=[];for(let M=o+1;M<i.length;M++){const D=i[M];D&&g.push(D)}const _=["Combat Patrol","Incursion","Strike Force","Onslaught"],x=M=>{if(!M||!/\(/.test(M))return!1;for(const D of _)if(new RegExp(D,"i").test(M))return!0;return!1},E=new Set(Object.values(Cn).map(M=>(M||"").toString().toLowerCase())),R=g.filter(M=>!(!M||x(M)||E.has(M.toLowerCase())));let L=null,S=null;const A=Object.keys(Cn).map(M=>M.toLowerCase());for(const M of R)A.includes((M||"").toString().toLowerCase())?L=M:S||(S=M);if(!L&&R.length>0&&(L=R[0],S=R.length>1?R[1]:S),L&&(a.SUMMARY.FACTION_KEYWORD=L),S&&(a.SUMMARY.DETACHMENT=S),L){const M=Object.keys(Cn).find(k=>k.toLowerCase()===L.toLowerCase()),D=M?Cn[M]:null;D?a.SUMMARY.DISPLAY_FACTION=`${D} - ${L}`:a.SUMMARY.DISPLAY_FACTION=L+(S?` - ${S}`:"");try{a.SUMMARY.FACTION_KEY=L.toString().toLowerCase()}catch{}}}const c=r===-1?0:r,m=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*$/i,f=/^\s*(?:â¢|\-|\+|â¦)\s*(.*)$/;let d=null;for(let u=c;u<t.length;u++){const g=(t[u]||"").trim();if(!g||g.startsWith("Exported with"))continue;if(n.test(g.toUpperCase())){d=/^CHARACTERS?/i.test(g)?"CHARACTER":"OTHER DATASHEETS";continue}const _=g.match(m);if(_){const x=_[1].trim(),E=parseInt(String(_[2]).replace(/[\,\.\s]/g,""),10)||0;let R="1x",L=x;const S=x.match(/^([0-9]+x?)\s+(.*)$/i);S&&(R=S[1].toLowerCase(),L=S[2].trim());const A={quantity:R,name:L,points:E,items:[],isComplex:!1,nameshort:""},M=d==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";a[M]=a[M]||[],a[M].push(A);const D=[];let k=u+1;for(;k<t.length;){const N=t[k]||"";if(!N.trim()||n.test(N.trim().toUpperCase())||m.test(N.trim())||!/^\s+/.test(N)&&!f.test(N))break;D.push(N),k++}const I=(()=>{for(let N=0;N<D.length;N++){const fe=D[N];if(!fe.match(f))continue;const ne=kr(fe);for(let re=N+1;re<D.length;re++){const ce=D[re];if(!ce.trim()||kr(ce)<=ne)break;if(f.test(ce))return!0}}return!1})();let U=null,le=0;for(let N=0;N<D.length;N++){const fe=D[N],Ce=fe.trim(),ne=fe.match(f),re=kr(fe);if(ne){const ce=ne[1].trim(),xe=ce.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(ce)){Zi(ce.replace(/^Enhancement:\s*/i,"").trim(),A,a.SUMMARY.FACTION_KEYWORD||"");continue}else if(xe){Zi(ce.trim(),A,a.SUMMARY.FACTION_KEYWORD||"");continue}if(I){if(U&&typeof le=="number"&&re>le){Ms(U,ce,U.name,a.SUMMARY.FACTION_KEYWORD||"",A.name,!1);continue}if(!(()=>{for(let H=N+1;H<D.length;H++){const ve=D[H];if(!ve.trim()||kr(ve)<=re)break;if(f.test(ve))return!0}return!1})()){U=null,Ms(A,ce,A.name,a.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}U=null;const te=ce.match(/^(\d+x?)\s+(.*)$/i),z=te?te[1]:"1x",Z=te?te[2].trim():ce,Se={quantity:z,name:Z,items:[],type:"subunit"};A.items=A.items||[],A.items.push(Se),U=Se,le=re;continue}Ms(A,ce,A.name,a.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(U&&re>le){Ms(U,Ce,U.name,a.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}Ms(A,Ce,A.name,a.SUMMARY.FACTION_KEYWORD||"","wargear",1)}u=k-1;continue}}function y(u,p){if(!(!u||typeof u!="object")){if(typeof u.name!="string"&&(u.name=""),typeof u.quantity!="string"&&(u.quantity=u.quantity?String(u.quantity):"1x"),typeof u.type!="string"&&(u.type=u.type||"wargear"),typeof u.nameshort!="string"&&(u.nameshort=u.nameshort||""),Array.isArray(u.items)||(u.items=[]),/^Enhancement:/i.test(u.name)){const g=u.name.replace(/^Enhancement:\s*/i,"").trim();u.type="special",u.nameshort=u.nameshort||(()=>{const _=g.match(/\(([^)]+)\)$/),x=_?` (${_[1]})`:"";return`E: ${g.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(L=>L[0]?L[0].toUpperCase():"").join("")}${x}`.trim()})(),u.name=`Enhancement: ${Er(g.replace(/\s*\([^)]+\)$/,"").trim())}`}else u.name=p?u.name:Er(u.name);de(u.name)==="warlord"&&(u.type="special"),u.items=(u.items||[]).map(g=>{if(!g)return null;if(typeof g=="string"){const _={quantity:"1x",name:g.trim(),items:[],type:/^Enhancement:/i.test(g)?"special":"wargear",nameshort:""};return y(_,u.name),_.name&&(_.name=Er(_.name)),_}return y(g,u.name),g&&g.name&&(g.name=Er(g.name)),g}).filter(Boolean)}}for(const u of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(a[u]))for(const p of a[u]){y(p);const g=(p.items||[]).filter(_=>_&&_.type==="subunit");if(g.length>0)if(g.every(x=>de(x.name||"")===de(p.name||""))){const x=new Map;let E=0;for(const R of g){const L=parseInt(String(R.quantity||"1x").replace(/x/i,""),10)||1;E+=L;for(const S of R.items||[]){const A={items:[]};Ms(A,`${S.quantity||"1x"} ${S.name}`,p.name,a.SUMMARY.FACTION_KEYWORD||"",S.type||"wargear",1);for(const M of A.items){const D=de(M.name||"");if(x.has(D)){const k=x.get(D),I=parseInt(String(k.quantity||"1x").replace(/x/i,""),10)||0,U=parseInt(String(M.quantity||"1x").replace(/x/i,""),10)||0;k.quantity=`${I+U}x`}else x.set(D,M)}}}p.items=Array.from(x.values()),E>0&&(p.quantity=`${E}x`),p.isComplex=!1}else{const x=g.reduce((E,R)=>E+(parseInt(String(R.quantity||"1x").replace(/x/i,""),10)||0),0);x>0&&(p.quantity=`${x}x`),p.isComplex=!0}else p.isComplex=!1;Array.isArray(p.items)&&p.items.length>0&&Tn(p.items)}return Ss(a),a}function Qi(t){if(!t)return"";const a=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(t).split(/\s+/).map((n,r)=>{if(!n)return"";const s=n.toLowerCase();return r>0&&a.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function Jn(t,a,n,r,s="",i=!1,o="wargear",c=1){if(!t)return;t.items=t.items||[];const m=is(String(a||"").trim()),f=m.quantity?String(m.quantity):"1x",d=parseInt(String(f||"1x").replace(/[^0-9]/g,""),10)||1,y=`${d*(c||1)}x`;let u=m.name||"";if(!i)try{const _=u.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(_){const x=_[1].trim(),E=_[2].trim(),R=de(x),L=de(n||""),S=de(s||"");R&&(R===L||R===S||L.startsWith(R+" ")||S.startsWith(R+" ")||R.startsWith(L+" ")||R.startsWith(S+" "))&&(u=E)}}catch{}const p=de(u);if(i){const _=String(n||""),x=String(s||""),E=de(u),R=de(_),L=de(x),S=R&&E.startsWith(R+" "),A=L&&E.startsWith(L+" ");if(R&&(E===R||S)||L&&(E===L||A)){const M=u.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(M){const D=M[1].trim(),k=M[2].trim(),I=de(D);if(I===R||I===L||I.startsWith(R+" ")||I.startsWith(L+" ")){if(t&&t._deferredParenthetical&&de(t._deferredParenthetical)===de(k)||t&&t._deferredParenthetical&&de(t._deferredParenthetical)===de(k)||(t.items||[]).some(le=>de(le.name||"")===de(k)))return;Jn(t,k,n,r,s,!1,o,d);return}}return}}const g=t.items.find(_=>de(_.name||"")===p);if(g){const _=parseInt(String(g.quantity||"1x").replace(/x/i,""),10)||0,x=parseInt(String(y||"1x").replace(/x/i,""),10)||0;g.quantity=`${_+x}x`}else{const _=de(u)==="warlord"?"special":o;t.items.push({quantity:y,name:u,items:[],type:_,nameshort:""})}}function ui(t,a,n){if(!t||!a)return;a.items=a.items||[];const r=t.trim(),s=r.match(/\(([^)]+)\)$/),i=s?` (${s[1]})`:"",o=r.replace(/\s*\([^)]+\)$/,"").trim(),c=de(o);if((a.items||[]).some(u=>u&&u.type==="special"&&de((u.name||"").replace(/^Enhancement:\s*/i,""))===c))return;const d=`E: ${o.split(/\s+/).map(u=>u[0]?u[0].toUpperCase():"").join("")}${i}`.trim(),y={quantity:"1x",name:`Enhancement: ${o}`,nameshort:d,items:[],type:"special"};a.items.push(y)}function Ji(t){const a={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},n=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*(?::\s*(.*))?$/i,s=/^\s*(?:â¢|\-|\+|â¦)\s*(.*)$/;let i=null;for(let c=0;c<t.length;c++){const f=(t[c]||"").trim();if(!f)continue;if(n.test(f.toUpperCase())){i=/^CHARACTERS?/i.test(f)?"CHARACTER":"OTHER DATASHEETS";continue}const d=f.match(r);if(d){const y=d[1].trim(),u=parseInt(String(d[2]).replace(/[\,\.\s]/g,""),10)||0;let p="1x",g=y;const _=y.match(/^([0-9]+x?)\s+(.*)$/i);_&&(p=_[1].toLowerCase(),g=_[2].trim());const x={quantity:p,name:g,points:u,items:[],isComplex:!1,nameshort:""},E=i==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";a[E]=a[E]||[],a[E].push(x);const R=d[3]||"";R&&R.split(",").map(k=>k.trim()).filter(Boolean).forEach(k=>Jn(x,k,x.name,a.SUMMARY.FACTION_KEYWORD||"",x.name,!0));const L=[];let S=c+1;for(;S<t.length;){const k=t[S]||"";if(!k.trim()||n.test(k.trim().toUpperCase())||r.test(k.trim())||!/^\s+/.test(k)&&!s.test(k))break;L.push(k),S++}const A=(()=>{for(let k=0;k<L.length;k++){const I=L[k];if(!I.match(s))continue;const le=ss(I);for(let N=k+1;N<L.length;N++){const fe=L[N];if(!fe.trim()||ss(fe)<=le)break;if(s.test(fe))return!0}}return!1})();let M=null,D=0;for(let k=0;k<L.length;k++){const I=L[k],U=I.trim(),le=I.match(s),N=ss(I);if(le){const fe=le[1].trim(),Ce=fe.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(fe)){ui(fe.replace(/^Enhancement:\s*/i,"").trim(),x,a.SUMMARY.FACTION_KEYWORD||"");continue}else if(Ce){ui(fe.trim(),x,a.SUMMARY.FACTION_KEYWORD||"");continue}if(A){if(M&&typeof D=="number"&&N>D){const Ie=fe.split(",").map(te=>te.trim()).filter(Boolean);for(let te of Ie){const z=te.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(z){const Z=z[1].trim(),Se=z[2].trim();if(de(Z)===de(M.name)){const H=Ie.some(ye=>de(ye)===de(Se)),ve=(M.items||[]).some(ye=>de(ye.name||"")===de(Se));if(H||ve)continue;const Me=is(te),yt=parseInt(String(Me.quantity||"1x").replace(/[^0-9]/g,""),10)||1;Jn(M,Se,M.name,a.SUMMARY.FACTION_KEYWORD||"",x.name,!1,"wargear",yt);continue}}Jn(M,te,M.name,a.SUMMARY.FACTION_KEYWORD||"",x.name,!0)}continue}M=null;const ne=fe.match(/^(\d+x?)\s+(.*)$/i),re=ne?ne[1]:"1x";let ce=ne?ne[2].trim():fe;try{const Ie=ce.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(Ie){const te=Ie[1].trim(),z=Ie[2].trim(),Z=de(te),Se=de(x.name||""),H=de(unitTopName||x.name||"");if(Z&&(Z===Se||Se.startsWith(Z)||Z.startsWith(Se)||H.startsWith(Z)||Z.startsWith(H))){ce=te;const ve={quantity:re,name:ce,items:[],type:"subunit"};ve._deferredParenthetical=z,ve._deferredParentheticalQty=parseInt(String(re||"1x").replace(/[^0-9]/g,""),10)||1,x.items=x.items||[],x.items.push(ve),M=ve,D=N;continue}}}catch{}const xe={quantity:re,name:ce,items:[],type:"subunit"};x.items=x.items||[],x.items.push(xe),M=xe,D=N;continue}Jn(x,fe,x.name,a.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(M&&N>D){Jn(M,U,M.name,a.SUMMARY.FACTION_KEYWORD||"",x.name,!0);continue}Jn(x,U,x.name,a.SUMMARY.FACTION_KEYWORD||"","wargear",1)}c=S-1;continue}}function o(c,m){if(!(!c||typeof c!="object")){if(typeof c.name!="string"&&(c.name=""),typeof c.quantity!="string"&&(c.quantity=c.quantity?String(c.quantity):"1x"),typeof c.type!="string"&&(c.type=c.type||"wargear"),typeof c.nameshort!="string"&&(c.nameshort=c.nameshort||""),Array.isArray(c.items)||(c.items=[]),/^Enhancement:/i.test(c.name)){const f=c.name.replace(/^Enhancement:\s*/i,"").trim();c.type="special",c.nameshort=c.nameshort||(()=>{const d=f.match(/\(([^)]+)\)$/),y=d?` (${d[1]})`:"";return`E: ${f.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(g=>g[0]?g[0].toUpperCase():"").join("")}${y}`.trim()})(),c.name=`Enhancement: ${Qi(f.replace(/\s*\([^)]+\)$/,"").trim())}`}else c.name=m?c.name:Qi(c.name);de(c.name)==="warlord"&&(c.type="special"),c.items=(c.items||[]).map(f=>{if(!f)return null;if(typeof f=="string"){const d={quantity:"1x",name:f.trim(),items:[],type:/^Enhancement:/i.test(f)?"special":"wargear",nameshort:""};return o(d,c.name),d}return o(f,c.name),f}).filter(Boolean)}}for(const c of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(a[c]))for(const m of a[c]){o(m);const f=(m.items||[]).filter(y=>y&&y.type==="subunit");if(f.length>0)if(f.every(u=>de(u.name||"")===de(m.name||""))){const u=new Map;let p=0;for(const g of f){const _=parseInt(String(g.quantity||"1x").replace(/x/i,""),10)||1;p+=_;for(const x of g.items||[]){const E={items:[]};Jn(E,`${x.quantity||"1x"} ${x.name}`,m.name,a.SUMMARY.FACTION_KEYWORD||"",x.type||"wargear",1);for(const R of E.items){const L=de(R.name||"");if(u.has(L)){const S=u.get(L),A=parseInt(String(S.quantity||"1x").replace(/x/i,""),10)||0,M=parseInt(String(R.quantity||"1x").replace(/x/i,""),10)||0;S.quantity=`${A+M}x`}else u.set(L,R)}}}m.items=Array.from(u.values()),p>0&&(m.quantity=`${p}x`),m.isComplex=!1}else{const u=f.reduce((p,g)=>p+(parseInt(String(g.quantity||"1x").replace(/x/i,""),10)||0),0);u>0&&(m.quantity=`${u}x`),m.isComplex=!1}else m.isComplex=!1;if(Array.isArray(m.items)&&m.items.length===1&&m.items[0]&&m.items[0].type==="subunit"){const y=m.items[0];Array.isArray(y.items)&&y.items.length>0&&(m.items=y.items.slice(),m.isComplex=!1)}Array.isArray(m.items)&&m.items.length>0&&Tn(m.items);const d=(m.items||[]).filter(y=>y&&y.type==="subunit");for(const y of d)Array.isArray(y.items)&&y.items.length>0&&Tn(y.items)}return Ss(a),a}function Vm(t){if(!Array.isArray(t))return Ji(t);const a=[];let n=0;for(;n<t.length;n++){const y=String(t[n]||"").trim();if(!y){a.push(y);continue}if(y.startsWith("+")||y.startsWith("&")){a.push(y);continue}break}const r=[],s={};for(const d of a){if(!d)continue;if(d.startsWith("&")){const g=d.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);g&&r.push({enh:g[1].trim(),target:(g[3]||"").trim(),charId:g[2]||null});continue}const u=d.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(u){const p=u[1].trim().toUpperCase(),g=u[2].trim();if(p==="ENHANCEMENT"){const _=g.match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);_?r.push({enh:_[1].trim(),target:(_[3]||"").trim(),charId:_[2]||null}):r.push({enh:g,target:null,charId:null})}else if(p==="FACTION KEYWORD"){const _=g.split(" - ");s.faction=_[_.length-1].trim()}else p==="DETACHMENT"?s.detachment=g.replace(/\u00A0/g," "):p==="TOTAL ARMY POINTS"&&(s.points=g)}}const i=t.slice(n),o=[];for(const d of i){if(!d){o.push(d);continue}let y=String(d);y=y.replace(/^\s*Char\d+:\s*/i,"");const u=y.match(/^(.*\))\s*:\s*(.+)$/);u?(o.push(u[1]),o.push("  â¢ "+u[2])):o.push(y)}const c=Ji(o);c.SUMMARY=c.SUMMARY||{},s.faction&&(c.SUMMARY.FACTION_KEYWORD=s.faction),s.detachment&&(c.SUMMARY.DETACHMENT=s.detachment),s.points&&(c.SUMMARY.TOTAL_ARMY_POINTS=s.points);const m=[...c.CHARACTER||[],...c["OTHER DATASHEETS"]||[]],f=d=>{const y=de(String(d||""));for(const u of m){const p=u&&Array.isArray(u.items)?u.items:[];for(const g of p){if(!g||!g.name)continue;const _=String(g.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,"").trim();if(de(_)===y)return!0}}return!1};for(const d of r){if(!d||!d.enh||f(d.enh))continue;let y=null;const u=p=>String(p||"").toLowerCase().replace(/[^a-z0-9 ]/g,"").trim();if(d.charId){const p=parseInt(String(d.charId).replace(/[^0-9]/g,""),10);!Number.isNaN(p)&&p>0&&Array.isArray(c.CHARACTER)&&c.CHARACTER[p-1]&&(y=c.CHARACTER[p-1])}!y&&d.target&&(y=m.find(p=>u(p.name).includes(u(d.target))||u(`${p.quantity} ${p.name}`).includes(u(d.target)))),!y&&m.length===1&&(y=m[0]),y&&ui(d.enh,y,c.SUMMARY.FACTION_KEYWORD||"")}try{for(const d of["CHARACTER","OTHER DATASHEETS"]){const y=c[d];if(Array.isArray(y))for(const u of y)u&&typeof u=="object"&&Object.prototype.hasOwnProperty.call(u,"type")&&delete u.type}for(const d of["CHARACTER","OTHER DATASHEETS"]){const y=c[d];if(Array.isArray(y)){for(const u of y)if(!(!u||!Array.isArray(u.items))){for(const p of u.items.filter(g=>g&&g.type==="subunit"))if(p&&p._deferredParenthetical)try{delete p._deferredParenthetical,delete p._deferredParentheticalQty}catch{}}}}}catch{}return Ss(c),c}function jm(t){const a={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return a;const n=t.map(f=>String(f||"")).find(f=>f.trim()),r=t.findIndex(f=>String(f||"").trim());if(n){const f=n.split(/\s*-\s*/).map(d=>d.trim()).filter(Boolean);if(a.SUMMARY.FACTION_FAMILY=f[0]||"",a.SUMMARY.FACTION_KEYWORD=f[1]||"",f.length>=3){const y=f[f.length-1].match(/\[\s*(\d{2,5})\s*pts?\s*\]$/i);y?(a.SUMMARY.TOTAL_ARMY_POINTS=`${y[1]}pts`,f.length===3?a.SUMMARY.LIST_TITLE=f[2]:a.SUMMARY.LIST_TITLE=f.slice(2,f.length-1).join(" - ")):a.SUMMARY.LIST_TITLE=f.slice(2).join(" - ")}a.SUMMARY.DISPLAY_FACTION=n.trim()}for(let f=0;f<Math.min(t.length,40);f++){const d=String(t[f]||"").trim();if(!d)continue;const y=d.match(/^Detachment:\s*(.*)$/i);y&&(a.SUMMARY.DETACHMENT=y[1].trim());const u=d.match(/^TOTAL ARMY POINTS:\s*(.*)$/i);u&&(a.SUMMARY.TOTAL_ARMY_POINTS=u[1].trim());const p=d.match(/^FACTION KEYWORD:\s*(.*)$/i);p&&(a.SUMMARY.FACTION_KEYWORD=p[1].trim());const g=d.match(/^Battle Size:\s*(.*)$/i);g&&(a.SUMMARY.BATTLE_SIZE=g[1].trim());const _=d.match(/^#+\s*(?:\+{1,2}\s*)?(.*)\[\s*\d{2,5}\s*pts?\s*\]$/i);if(_&&!a.SUMMARY.LIST_TITLE){const x=_[1].trim();/Army\s+Roster/i.test(x)||/\+\+/.test(x)?a.SUMMARY.LIST_TITLE="":a.SUMMARY.LIST_TITLE=x}}if(!a.SUMMARY.FACTION_KEYWORD&&a.SUMMARY.DISPLAY_FACTION){const f=a.SUMMARY.DISPLAY_FACTION.split(" - ");f.length>=2?a.SUMMARY.FACTION_KEYWORD=f[1].trim():a.SUMMARY.FACTION_KEYWORD=a.SUMMARY.DISPLAY_FACTION.replace(/\s*\[.*$/,"").trim()}const s=/^(?:(\d+)x?\s+)?(.+?)\s*\[\s*(\d{1,4})\s*pts?\s*\]\s*(?::\s*(.*))?$/i,i=/^\s*(?:â¢|\-|\+)\s*(.*)$/;let o=null,c=null;for(let f=0;f<t.length;f++){const d=String(t[f]||""),y=d.trim();if(!y||f===r)continue;if(y.startsWith("#")){const g=y.match(/^#+\s*(.+?)\s*(?:\[\s*\d+\s*pts?\s*\])?$/i);if(g){const _=g[1].trim();/character|epic|hero|hq/i.test(_)?o="CHARACTER":o="OTHER DATASHEETS"}continue}const u=y.match(s);if(u){const g=u[1]?`${u[1]}x`:"1x",_=(u[2]||"").trim(),x=parseInt(u[3],10)||0,E=u[4]||"",R={quantity:g,name:_,points:x,items:[],isComplex:!1,nameshort:""};o||(o="OTHER DATASHEETS"),a[o]=a[o]||[],a[o].push(R),c=R,E&&E.split(",").map(L=>L.trim()).filter(Boolean).forEach(L=>{m(c,L,c.name,a.SUMMARY.FACTION_KEYWORD||"",c.name,!0)});continue}const p=d.match(i);if(p&&c){const g=p[1].trim(),_=g.match(/^(\d+)\s+with\s+(.*)$/i);if(_&&c){const R=parseInt(_[1],10)||1,L=_[2],S=c.items&&c.items.length>0?c.items[c.items.length-1]:c;L.split(",").map(A=>A.trim()).filter(Boolean).forEach(A=>m(S,`${R}x ${A}`,S.name,a.SUMMARY.FACTION_KEYWORD||"",c.name,!0));continue}const x=g.match(/^(\d+x?)\s+([^:]+):\s*(.*)$/i);if(x){const R=x[1];let L=x[2].trim();const S=x[3]||"";L=L.replace(/\s+w\/.*$/i,"").trim();const A={quantity:R,name:L,items:[],type:"subunit"};if(S){const M=S.match(/^(\d+)\s+with\s+(.*)$/i);if(M){const D=parseInt(M[1],10)||1;M[2].split(",").map(I=>I.trim()).filter(Boolean).forEach(I=>m(A,`${D}x ${I}`,A.name,a.SUMMARY.FACTION_KEYWORD||"",c.name,!0))}else S.split(",").map(D=>D.trim()).filter(Boolean).forEach(D=>m(A,D,A.name,a.SUMMARY.FACTION_KEYWORD||"",c.name,!0))}c.items=c.items||[],c.items.push(A);continue}const E=g.match(/^(\d+x?)\s+(.*)$/i);if(E&&c){let R=E[2].trim();R=R.replace(/\s+w\/.*$/i,"").trim();const L={quantity:E[1],name:R,items:[],type:"subunit"};c.items=c.items||[],c.items.push(L);continue}m(c,g,c.name,a.SUMMARY.FACTION_KEYWORD||"",c.name,!0);continue}}function m(f,d,y,u,p="",g=!1,_="wargear"){if(!f)return;f.items=f.items||[];const x=String(d||"").trim(),E=is(x),R=E.quantity?String(E.quantity):"1x",L=/^\s*\d+x?\s+/i.test(x);let S=E.name||"";const A=S.match(/^(.*?)\s*\(([^)]+)\)$/);if(A){const U=(A[1]||"").trim(),le=(A[2]||"").trim();(/\bDrone\b/i.test(U)||/\bDrone\b/i.test(S))&&(S=le)}const M=de(S);if(g){const U=String(y||""),le=String(p||"");if(de(U)===de(S)||le&&de(le)===de(S))return}const D=parseInt(String(R||"1x").replace(/x/i,""),10)||1;let k=D;if(f&&f.type==="subunit"){const U=parseInt(String(f.quantity||"1x").replace(/[^0-9]/g,""),10)||1;k=L?D:U}const I=f.items.find(U=>de(U.name||"")===M);if(I){const U=parseInt(String(I.quantity||"1x").replace(/x/i,""),10)||0;I.quantity=`${U+k}x`}else{const U=de(S)==="warlord"?"special":_;f.items.push({quantity:`${k}x`,name:S,items:[],type:U,nameshort:""})}}for(const f of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(a[f]))for(const d of a[f]){if(!d||!Array.isArray(d.items)||d.items.length===0)continue;if(d.items.filter(p=>p&&p.type==="subunit").length>1){const p=new Map,g=[];for(const _ of d.items){if(!_||_.type!=="subunit"){g.push(_);continue}const x=de(_.name||"");if(!p.has(x))p.set(x,{quantity:_.quantity||"1x",name:_.name,items:Array.isArray(_.items)?_.items.slice():[],type:"subunit"});else{const E=p.get(x),R=parseInt(String(E.quantity||"1x").replace(/[^0-9]/g,""),10)||0,L=parseInt(String(_.quantity||"1x").replace(/[^0-9]/g,""),10)||0;E.quantity=`${R+L}x`;const S=new Map;for(const A of E.items||[]){const M=de(A&&A.name||"");M&&S.set(M,{quantity:A.quantity||"1x",name:A.name,items:[],type:A.type||"wargear",nameshort:A.nameshort||""})}for(const A of _.items||[]){const M=de(A&&A.name||"");if(M)if(S.has(M)){const D=S.get(M),k=parseInt(String(D.quantity||"1x").replace(/[^0-9]/g,""),10)||0,I=parseInt(String(A.quantity||"1x").replace(/[^0-9]/g,""),10)||0;D.quantity=`${k+I}x`}else S.set(M,{quantity:A.quantity||"1x",name:A.name,items:[],type:A.type||"wargear",nameshort:A.nameshort||""})}E.items=Array.from(S.values())}}d.items=[...g,...Array.from(p.values())]}d&&Array.isArray(d.items)&&d.items.length>0&&Tn(d.items);const u=d&&Array.isArray(d.items)?d.items.filter(p=>p&&p.type==="subunit"):[];for(const p of u)p&&Array.isArray(p.items)&&p.items.length>0&&Tn(p.items)}return Ss(a),a}function Zm(t,a=40){return(Array.isArray(t)?t:String(t||"").split(/\r?\n/)).slice(0,a)}function Qm(t){const a=Array.isArray(t)?t:String(t||"").split(/\r?\n/),n=Zm(a,40),r=a.join(`
`),s={NRNR:{score:0,breakdown:{},maxScore:8},"WTC-Compact":{score:0,breakdown:{},maxScore:8},WTC:{score:0,breakdown:{},maxScore:8},GWAPP:{score:0,breakdown:{},maxScore:7},"NR-GW":{score:0,breakdown:{},maxScore:7},LF:{score:0,breakdown:{},maxScore:7}},i=n.some(ne=>/-\s*\[\s*\d{2,5}\s*pts?\s*\]$/i.test(ne)),o=n.some(ne=>/^#{1,3}\s+/.test(ne)),c=n.some(ne=>/^\s*#?\s*\+\+\s*Army Roster\s*\+\+/i.test(ne)),m=n.some(ne=>/^\s*##\s+/.test(ne)),f=/(.+?)\s*[\(\[]\s*([0-9]{1,4})\s*(?:pts|points)\s*[\)\]]/i,d=r.match(new RegExp(f.source,"g"))||[],y=r.match(/^[ \t]*(?:â¢|\-|\+)\s*(?:\d+x?)\s+[^:]+:/gmi)||[],u=r.match(/\b[A-Za-z0-9\-\'â ]+\s*\([^\)]+\)/g)||[],p=/(^|\n)\s*Char\d+:.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)\s*:\s*/i,g=(r.match(new RegExp(p.source,"gi"))||[]).length,_=n.some(ne=>/^(List Name|Factions Used|Army Points|Detachment Rule):/i.test(ne.trim())),x=n.some(ne=>/-\s*\(\s*\d+\s*Points?\s*\)\s*$/i.test(ne)),E=r.match(/^(Epic Hero|Epic Heroes|Character|Characters|Battleline|Infantry|Beast|Vehicle|Dedicated Transport|Other Datasheets):\s*$/gmi)||[],R=(r.match(/^\s*â¢\s*(?:E:|Enhancement:)/gmi)||[]).length,L=(r.match(/^\s*â¢\s+/gmi)||[]).length;_&&(s.LF.score+=4,s.LF.breakdown.headerKeys=4),x&&(s.LF.score+=4,s.LF.breakdown.titleLine=4),E.length>=2&&(s.LF.score+=3,s.LF.breakdown.sectionColons=E.length),L>5&&(s.LF.score+=1,s.LF.breakdown.bullets=L),R>0&&(s.LF.score+=1,s.LF.breakdown.enhancementLines=R),(_||x||E.length>=2)&&(s.NRNR.score-=1,s.WTC.score-=1,s["WTC-Compact"].score-=1,s.GWAPP.score-=1,s["NR-GW"].score-=3),i&&(s.NRNR.score+=2,s.NRNR.breakdown.titleWithBracketedPts=2),o&&(s.NRNR.score+=3,s.NRNR.breakdown.markdownHeading=3),c&&(s.NRNR.score+=2,s.NRNR.breakdown.armyRoster=2),m&&(s.NRNR.score+=1,s.NRNR.breakdown.doubleHashSections=1),d.length>=3&&(s.NRNR.score+=1,s.NRNR.breakdown.unitLines=1),y.length>0&&(s.NRNR.score+=1,s.NRNR.breakdown.bulletWithQty=y.length),u.length>0&&(s.NRNR.score+=.5,s.NRNR.breakdown.parenItem=u.length);const S=n.join(`
`);/^[ \t]*[+&]/m.test(S)&&(s["WTC-Compact"].score+=3,s["WTC-Compact"].breakdown.headerPlusAmp=3),/(FACTION KEYWORD|DETACHMENT|TOTAL ARMY POINTS)/i.test(S)&&(s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.headerKeys=2),d.length>=2&&(s["WTC-Compact"].score+=1,s["WTC-Compact"].breakdown.unitLines=1),g>0&&(s["WTC-Compact"].score+=5,s["WTC-Compact"].breakdown.inlineCharList=g),/^\s*[+&]/m.test(S)&&(s.WTC.score+=1,s.WTC.breakdown.headerPlusAmp=1),/NUMBER OF UNITS:/i.test(S)&&(s.WTC.score+=2,s.WTC.breakdown.numberOfUnits=2);const A=(r.match(/(^|\n)\s*Char\d+:/gi)||[]).length>0;A&&(s.WTC.score+=3,s.WTC.breakdown.charMarkers=3),(o||c||m)&&(s.WTC.score-=2,s.WTC.breakdown.nrnrPenalty=-2,s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.nrnrPenalty=-1);const M=(r.match(/^\s*\d+\s+with\s+/gmi)||[]).length;M>0&&(s.WTC.score+=2,s.WTC.breakdown.withLines=M,s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.withLines=M),n.some(ne=>/^(?:CHARACTER|OTHER DATASHEETS|CHARACTERS)\s*$/.test((ne||"").trim()))&&(s.WTC.score+=1,s.WTC.breakdown.sectionHeaders=1),A&&(s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.charMarkerPenalty=-1),g>0&&(s.WTC.score-=2,s.WTC.breakdown.compactInlinePenalty=-2);const D=/Exported with/i.test(r);(/Exported with/i.test(S)||D)&&(s.GWAPP.score+=6,s.GWAPP.breakdown.exportedWith=6),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS)\b/i.test(r)&&(s.GWAPP.score+=2,s.GWAPP.breakdown.sectionHeaders=2),/\(\s*\d+\s*(?:pts|points)\s*\)/i.test(S)&&(s.GWAPP.score+=1,s.GWAPP.breakdown.titleParenPts=1),D&&(s["NR-GW"].score-=4,s["NR-GW"].breakdown.gwappPenalty=-4),/^\s*Strike Force\s*\(\s*\d{2,5}\s*points\s*\)/mi.test(r)&&(s.GWAPP.score+=3,s.GWAPP.breakdown.strikeForce=3),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|DEDICATED TRANSPORTS)\b/i.test(r)&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.sectionHeaders=2);const k=(r.match(/^[ \t]*(?:â¢|\u2022|â¦|\-|\+)\s+/gmi)||[]).length;k>0&&!D&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.bulletCount=k),u.length>0&&!D&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.parenItem=u.length);const I=(r.match(/^[ \t]*(?:â¢|\u2022|â¦|\-|\+)\s*\d+x?\s+[A-Za-z0-9\-\'â]+/gmi)||[]).length;I>=3&&!A&&!D&&(s["NR-GW"].score+=3,s["NR-GW"].breakdown.bulletQty=I);const U=/^(?:\s*)\d+x?\s+.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)/i,le=a.filter(ne=>U.test(ne)).length;if(le>=2&&!A&&!D&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.unitLinesNoChar=le),!A&&!D&&(I>=3||le>=2)&&(s.WTC.score-=2,s.WTC.breakdown.nrGwPenalty=-2,s["WTC-Compact"].score-=2,s["WTC-Compact"].breakdown.nrGwPenalty=-2),(o||c)&&(s["NR-GW"].score-=1,s["NR-GW"].breakdown.nrnrPenalty2=-1),r.indexOf("â")!==-1)for(const ne of Object.keys(s))s[ne].score+=.5,s[ne].breakdown=s[ne].breakdown||{},s[ne].breakdown.unicodeApostrophe=.5;const N={};for(const ne of Object.keys(s)){const re=s[ne],ce=Math.max(0,Math.min(1,re.score/(re.maxScore||8)));N[ne]={score:re.score,confidence:ce,scoreBreakdown:re.breakdown}}const fe=Object.keys(N).sort((ne,re)=>N[re].score-N[ne].score)[0],Ce=N[fe]||{score:0,confidence:0};return{format:fe,confidence:Ce.confidence,score:Ce.score,scoreBreakdown:Ce.scoreBreakdown,all:N}}function dl(t){const a=String(t||"").trim().match(/^(\d+)\s+(.*)$/);return a&&!/^\d+x\b/i.test(String(t||""))?`${a[1]}x ${a[2]}`:t}function hl(t){const a=String(t||"").trim().replace(/^E:\s*/i,"").replace(/^Enhancement:\s*/i,"").trim(),n=a.match(/\(([^)]*pts?[^)]*)\)\s*$/i),r=a.replace(/\s*\([^)]*\)\s*$/,"").trim(),i=`E: ${r.split(/\s+/).map(o=>o[0]?o[0].toUpperCase():"").join("")}${n?` (${n[1].trim()})`:""}`.trim();return{quantity:"1x",name:`Enhancement: ${r}`,nameshort:i,items:[],type:"special"}}function Jm(t,a){if(!t)return;t.items=t.items||[];const n=dl(String(a||"").trim());if(/^(E:|Enhancement:)/i.test(n)){const s=hl(n),i=de(s.name.replace(/^Enhancement:\s*/i,""));(t.items||[]).some(c=>/^Enhancement:/i.test(c.name||"")&&de(String(c.name).replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,""))===i)||t.items.push(s);return}const r=n.split(",").map(s=>s.trim()).filter(Boolean);for(const s of r){const i=is(s.replace(/^with\s+/i,"")),o=i.quantity||"1x",c=i.name||"";if(!c)continue;const m=de(c),f=t.items.find(d=>de(d.name||"")===m);if(f){const d=parseInt(String(f.quantity||"1x").replace(/[^0-9]/g,""),10)||0,y=parseInt(String(o).replace(/[^0-9]/g,""),10)||0;f.quantity=`${d+y}x`}else t.items.push({quantity:o,name:c,items:[],type:"wargear",nameshort:""})}}function ed(t,a){const n=t[a]||"",r=ss(n);for(let s=a+1;s<t.length;s++){const i=t[s]||"";if(!i.trim())continue;const o=ss(i),c=/^\s*â¢\s*/.test(i);return o>r&&c}return!1}function td(t){const a={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return a;const n=t.slice(0,30).map(u=>String(u||""));let r=!1;for(const u of n){const p=u.match(/^\s*([A-Za-z ][A-Za-z ]*):\s*(.*)$/);if(!p)continue;const g=p[1].trim().toLowerCase(),_=p[2].trim();if(g==="list name"&&(a.SUMMARY.LIST_TITLE=_,r=!0),g==="factions used"&&(a.SUMMARY.FACTION_KEYWORD=_,r=!0),g==="army points"){const x=parseInt(_.replace(/[^0-9]/g,""),10);x&&(a.SUMMARY.TOTAL_ARMY_POINTS=`${x}pts`,r=!0)}g==="detachment rule"&&(a.SUMMARY.DETACHMENT=_,r=!0)}if(!r){const u=t.find(p=>String(p||"").trim());if(u){const p=String(u).match(/^(.*?)\s*-\s*(.*?)\s*-\s*(.*?)\s*\((\d+)\s*Points?\)/i);p&&(a.SUMMARY.LIST_TITLE=p[1].trim(),a.SUMMARY.FACTION_KEYWORD=p[2].trim(),a.SUMMARY.DETACHMENT=p[3].trim(),a.SUMMARY.TOTAL_ARMY_POINTS=`${parseInt(p[4],10)}pts`)}}const s=/^\s*([A-Za-z ]+):\s*$/,i=/^\s*(.*?)\s*\((\d+)\s*pts?\)\s*$/i,o=/^\s*â¢\s*(.*)$/;let c=null;const m=[];for(let u=0;u<t.length;u++){const p=String(t[u]||"");if(!p.trim())continue;const _=p.match(s);if(_){const M=_[1].trim().toLowerCase();c=/hero|character/.test(M)?"CHARACTER":"OTHER DATASHEETS",m.length=0;continue}const x=p.match(i);if(x&&ss(p)===0){const M=x[1].trim(),D=parseInt(x[2],10)||0,k={quantity:"1x",name:M,points:D,items:[],isComplex:!1,nameshort:""},I=c==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";a[I]=a[I]||[],a[I].push(k),m.length=0,m.push({indent:0,node:k});continue}const E=p.match(o);if(!E)continue;const R=E[1].trim(),L=ss(p);for(;m.length>0&&L<=m[m.length-1].indent;)m.pop();const S=m.length>0?m[m.length-1].node:null;if(!S||/^B:\s*/i.test(R))continue;if(/^(E:|Enhancement:)/i.test(R)){const M=hl(R),D=m[0]?m[0].node:S;D.items=D.items||[],(D.items||[]).some(I=>/^Enhancement:/i.test(I.name||"")&&de(I.name)===de(M.name))||D.items.push(M);continue}if(ed(t,u)){const M=is(dl(R));let D=M.name||"";D=D.replace(/\s+w\/.*$/i,"").trim();const k={quantity:M.quantity||"1x",name:D,items:[],type:"subunit"};S.items=S.items||[],S.items.push(k),m.push({indent:L,node:k});continue}Jm(S,R)}function f(u){const p=parseInt(String(u||"1x").replace(/[^0-9]/g,""),10);return Number.isFinite(p)&&p>0?p:1}for(const u of["CHARACTER","OTHER DATASHEETS"]){const p=a[u]||[];for(const g of p){const _=Array.isArray(g.items)?g.items:[],x=_.filter(S=>S&&S.type==="subunit");if(x.length<=1)continue;const E=new Map;for(const S of x){const A=de((S.name||"").replace(/\s+w\/.*/i,"").trim());E.has(A)||E.set(A,{name:S.name,qty:0,wargear:new Map});const M=E.get(A);M.qty+=f(S.quantity);const D=Array.isArray(S.items)?S.items:[];for(const k of D){const I=de(k.name||""),U=M.wargear.get(I)||{name:k.name,qty:0,type:k.type||"wargear"};U.qty+=f(k.quantity),M.wargear.has(I),M.wargear.set(I,U)}}const R=_.filter(S=>!(S&&S.type==="subunit")),L=[];for(const[,S]of E){const A={quantity:`${S.qty}x`,name:S.name,items:[],type:"subunit"};for(const[,M]of S.wargear)A.items.push({quantity:`${M.qty}x`,name:M.name,items:[],type:M.type||"wargear",nameshort:""});L.push(A)}g.items=[...R,...L]}}const d=a.SUMMARY&&a.SUMMARY.FACTION_KEYWORD?String(a.SUMMARY.FACTION_KEYWORD).trim():"";function y(u){if(!u||!d)return u;const p=new RegExp("^"+d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\s+","i");return String(u).replace(p,"").trim()}if(d)for(const u of["CHARACTER","OTHER DATASHEETS"]){const p=a[u]||[];for(const g of p){g.name=y(g.name);const _=(g.items||[]).filter(x=>x&&x.type==="subunit");for(const x of _)x.name=y(x.name)}}for(const u of["CHARACTER","OTHER DATASHEETS"]){const p=a[u]||[];for(const g of p){Array.isArray(g.items)&&g.items.length>0&&Tn(g.items);const _=(g.items||[]).filter(x=>x&&x.type==="subunit");for(const x of _)Array.isArray(x.items)&&x.items.length>0&&Tn(x.items)}}return Ss(a),a}function ad(t){try{const a=Qm(t).format;return a==="NRNR"?"NRNR":a==="WTC-Compact"?"WTC_COMPACT":a==="WTC"?"WTC":a==="GWAPP"?"GW_APP":a==="NR-GW"?"NR_GW":a==="LF"?"LF":"UNKNOWN"}catch{const n=Array.isArray(t)?t.slice(0,25):[],r=n.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i)||/^\s*\+\s*DETACHMENT:/i.test(i)),s=n.some(i=>/^(?:CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i.test((i||"").trim().toUpperCase()));return r&&s?"NR_GW":n.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i))?"WTC_COMPACT":s?"GW_APP":"UNKNOWN"}}async function nd(t){if(!t||typeof t!="string")throw new Error("Invalid army list text");const a=t.split(`
`),n=ad(a);if(n==="UNKNOWN")throw new Error("Unable to detect army list format. Supported formats: GW App, WTC, WTC Compact, NR-GW, NR-NR, ListForge");let r;try{switch(n){case"GW_APP":r=Xm(a);break;case"WTC":r=zm(a);break;case"WTC_COMPACT":r=Km(a);break;case"NR_GW":r=Vm(a);break;case"NRNR":r=jm(a);break;case"LF":r=td(a);break;default:throw new Error(`Unsupported format: ${n}`)}}catch(i){throw console.error("Parse error:",i),new Error(`Failed to parse ${n} format: ${i.message}`)}const s=sd(r);return{format:n,data:s}}function sd(t,a){const n=t.SUMMARY||{},r=[],s=["CHARACTER","CHARACTERS","BATTLELINE","OTHER DATASHEETS","ALLIED UNITS","DEDICATED TRANSPORTS"];for(const i of s)t[i]&&Array.isArray(t[i])&&r.push(...t[i].map(o=>({...o,section:i})));return{FACTION_KEYWORD:n.FACTION_KEYWORD||n.FACTION_KEY||"Unknown",DETACHMENT:n.DETACHMENT||"",TOTAL_ARMY_POINTS:n.TOTAL_ARMY_POINTS||"0pts",LIST_TITLE:n.LIST_TITLE||"",UNITS:r}}function rd(t){if(!t)return 1;const a=String(t).match(/(\d+)/);return a?parseInt(a[1],10):1}const id={Asurmen:{baseType:"40mm"},Autarch:{baseType:"32mm"},"Autarch wayleaper":{baseType:"32mm"},"Avatar of Khaine":{baseType:"80mm"},Baharroth:{baseType:"40mm"},"Corsair Voidreavers":{baseType:"28.5mm"},"Corsair Voidscarred":{baseType:"28.5mm"},"Crimson Hunter":{baseType:"120x92mm"},"D-cannon Platform":{baseType:"40mm"},"Dark Reapers":{baseType:"28.5mm"},"Death Jester":{baseType:"25mm"},"Dire Avengers":{baseType:"28.5mm"},"Eldrad Ulthran":{baseType:"32mm"},Falcon:{baseType:"Large Flying Base"},Farseer:{baseType:"25mm"},"Farseer Skyrunner":{baseType:"Small Flying Base"},"Fire Dragons":{baseType:"28.5mm"},"Fire Prism":{baseType:"Large Flying Base"},Fuegan:{baseType:"40mm"},"Guardian Defenders":{baseType:"28.5mm"},"Guardian Defenders: Heavy Weapon Platform":{baseType:"40mm"},"Hemlock Wraithfighter":{baseType:"120x92mm"},"Howling Banshees":{baseType:"28.5mm"},"Jain Zar":{baseType:"40mm"},Lhykhis:{baseType:"40mm"},"Maugan Ra":{baseType:"40mm"},"Night Spinner":{baseType:"Large Flying Base"},Rangers:{baseType:"28.5mm"},"Shadow Weaver Platform":{baseType:"40mm"},Shadowseer:{baseType:"25mm"},"Shining Spears":{baseType:"Large Flying Base"},"Shroud Runners":{baseType:"Large Flying Base"},Skyweavers:{baseType:"Large Flying Base"},Solitaire:{baseType:"25mm"},Spiritseer:{baseType:"25mm"},Starweaver:{baseType:"Large Flying Base"},"Storm Guardians":{baseType:"28.5mm"},"Storm Guardians: Serpentâs Scale Platform":{baseType:"40mm"},"Striking Scorpions":{baseType:"28.5mm"},"Swooping Hawks":{baseType:"28.5mm"},"The Visarch":{baseType:"32mm"}},od={"Corvus Blackstar":{baseType:"120x92mm"},"Deathwatch Terminator Squad":{baseType:"40mm"},"Deathwatch Veterans":{baseType:"32mm"},"Fortis Kill Team":{baseType:"32mm"},"Indomitor Kill Team":{baseType:"40mm"},"Spectrus Kill Team":{baseType:"32mm"},"Spectrus Kill Team: Kill Team Infiltrators with bolt sniper rifles":{baseType:"40mm"},"Talonstrike Kill Team":{baseType:"32mm"},"Talonstrike Kill Team: Kill Team Heavy Intercessors with Jump Packs":{baseType:"40mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},ld={Archon:{baseType:"25mm"},Beastmaster:{baseType:"Small Flying Base"},"Beastmaster: Clawed Fiends, Khymerae, Razorwing Flocks":{baseType:"40mm"},"Court of the Archon: Sslyth":{baseType:"40mm"},"Court of the Archon: Ur-Ghul, Lhamaean, Medusae":{baseType:"25mm"},Cronos:{baseType:"Large Flying Base"},Drazhar:{baseType:"40mm"},Grotesques:{baseType:"40mm"},Haemonculus:{baseType:"25mm"},Hellions:{baseType:"Small Flying Base"},Incubi:{baseType:"28.5mm"},"Kabalite Warriors":{baseType:"25mm"},"Lelith Hesperax":{baseType:"32mm"},Mandrakes:{baseType:"28.5mm"},Raider:{baseType:"Large Flying Base"},Ravager:{baseType:"Large Flying Base"},"Razorwing Jetfighter":{baseType:"120x92mm"},Reavers:{baseType:"Small Flying Base"},Scourges:{baseType:"32mm"},Succubus:{baseType:"25mm"},Talos:{baseType:"Large Flying Base"},"Urien Rakarth":{baseType:"25mm"},Venom:{baseType:"Large Flying Base"},"Voidraven Bomber":{baseType:"120x92mm"},Wracks:{baseType:"25mm"},Wyches:{baseType:"25mm"}},cd={"Annihilation Barge":{baseType:"Large Flying Base"},"Câtan Shard of the Deceiver":{baseType:"40mm"},"Câtan Shard of the Nightbringer":{baseType:"40mm"},"Câtan Shard of the Void Dragon":{baseType:"80mm"},"Canoptek Doomstalker":{baseType:"90mm"},"Canoptek Reanimator":{baseType:"60mm"},"Canoptek Scarab Swarms":{baseType:"40mm"},"Canoptek Spyders":{baseType:"60mm"},"Canoptek Wraiths":{baseType:"50mm"},"Catacomb Command Barge":{baseType:"Large Flying Base"},Chronomancer:{baseType:"40mm"},"Convergence of Dominion":{baseType:"hull",hullDimensions:{width:0,height:0}},Cryptothralls:{baseType:"32mm"},Deathmarks:{baseType:"32mm"},"Doom Scythe":{baseType:"120x92mm"},"Doomsday Ark":{baseType:"Large Flying Base"},"Flayed Ones":{baseType:"28.5mm"},"Ghost Ark":{baseType:"Large Flying Base"},"Hexmark Destroyer":{baseType:"50mm"},"Illuminor Szeras":{baseType:"80mm"},Immortals:{baseType:"32mm"},"Imotekh the Stormlord":{baseType:"40mm"},"Lokhust Destroyers":{baseType:"Large Flying Base"},"Lokhust Heavy Destroyers":{baseType:"60mm"},"Lokhust Lord":{baseType:"Large Flying Base"},Lychguard:{baseType:"32mm"},Monolith:{baseType:"160mm"},"Necron Warriors":{baseType:"32mm"},"Night Scythe":{baseType:"120x92mm"},Obelisk:{baseType:"120x92mm"},"Ophydian Destroyers":{baseType:"50mm"},"Orikan the Diviner":{baseType:"40mm"},Overlord:{baseType:"40mm"},"Overlord with Translocation Shroud":{baseType:"40mm"},Plasmancer:{baseType:"32mm"},Psychomancer:{baseType:"40mm"},"Royal Warden":{baseType:"32mm"},"Skorpekh Destroyers":{baseType:"50mm"},"Skorpekh Lord":{baseType:"60mm"},Technomancer:{baseType:"50mm"},"Tesseract Vault":{baseType:"120x92mm"},"The Silent King: Szarekh":{baseType:"100mm"},"The Silent King: Triarchal Menhir":{baseType:"50mm"},"Tomb Blades":{baseType:"Small Flying Base"},"Transcendent Câtan":{baseType:"60mm"},"Trazyn the Infinite":{baseType:"40mm"},"Triarch Praetorians":{baseType:"32mm"},"Triarch Stalker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Seraptek Heavy Construct":{baseType:"hull",hullDimensions:{width:0,height:0}}},ud={Battlewagon:{baseType:"hull",hullDimensions:{width:0,height:0}},"Beast Snagga Boyz":{baseType:"32mm"},Beastboss:{baseType:"50mm"},"Beastboss on Squigosaur":{baseType:"80mm"},"Big Mek":{baseType:"50mm"},"Big Mek in Mega Armour":{baseType:"40mm"},"Big Mek with Shokk Attack Gun":{baseType:"40mm"},"Bigâed Bossbunka":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blitza-bommer":{baseType:"120x92mm"},"Boomdakka Snazzwagon":{baseType:"150x95mm"},"Boss Snikrot":{baseType:"40mm"},Boyz:{baseType:"32mm"},"Breaka Boyz":{baseType:"32mm"},"Breaka Boyz: Boss Nob":{baseType:"40mm"},"Burna Boyz":{baseType:"32mm"},"Burna-bommer":{baseType:"120x92mm"},Dakkajet:{baseType:"120x92mm"},"Deff Dread":{baseType:"60mm"},"Deffkilla Wartrike":{baseType:"150x95mm"},Deffkoptas:{baseType:"75x42mm"},"Flash Gitz":{baseType:"40mm"},"Ghazghkull Thraka":{baseType:"80mm"},"Ghazghkull Thraka: Makari":{baseType:"25mm"},Gorkanaut:{baseType:"170x109mm"},Gretchin:{baseType:"25mm"},"Gretchin: Runtherd":{baseType:"32mm"},"Hunta Rig":{baseType:"170x109mm"},"Kill Rig":{baseType:"170x109mm"},"Killa Kans":{baseType:"60mm"},Kommandos:{baseType:"32mm"},"Kustom Boosta-blasta":{baseType:"150x95mm"},Lootas:{baseType:"32mm"},Meganobz:{baseType:"40mm"},"Megatrakk Scrapjet":{baseType:"150x95mm"},Mek:{baseType:"32mm"},"Mek Gunz":{baseType:"hull",hullDimensions:{width:0,height:0}},Morkanaut:{baseType:"170x109mm"},"Mozrog Skragbad":{baseType:"80mm"},Nobz:{baseType:"32mm"},Painboss:{baseType:"40mm"},Painboy:{baseType:"32mm"},"Rukkatrukk Squigbuggy":{baseType:"150x95mm"},"Shokkjump Dragsta":{baseType:"150x95mm"},"Squighog Boyz":{baseType:"75x42mm"},"Squighog Boyz: Nob on Smasha Squig":{baseType:"90x52.5mm"},Stompa:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormboyz:{baseType:"32mm"},Tankbustas:{baseType:"32mm"},"Tankbustas: Boss Nob":{baseType:"40mm"},Trukk:{baseType:"hull",hullDimensions:{width:0,height:0}},Warbikers:{baseType:"75x42mm"},Warboss:{baseType:"40mm"},"Warboss in Mega Armour":{baseType:"50mm"},"Wazbom Blastajet":{baseType:"150x95mm"},Weirdboy:{baseType:"40mm"},Wurrboy:{baseType:"32mm"},"Zodgrod Wortsnagga":{baseType:"50mm"},"Gargantuan Squiggoth":{baseType:"hull",hullDimensions:{width:0,height:0}}},md={Barbgaunts:{baseType:"40mm"},Biovores:{baseType:"80mm"},Broodlord:{baseType:"75x42mm"},Carnifexes:{baseType:"105x70mm"},Deathleaper:{baseType:"60mm"},Exocrine:{baseType:"120x92mm"},Gargoyles:{baseType:"Small Flying Base"},Genestealers:{baseType:"32mm"},Harpy:{baseType:"120x92mm"},Haruspex:{baseType:"120x92mm"},"Hive Crone":{baseType:"120x92mm"},"Hive Guard":{baseType:"50mm"},"Hive Tyrant":{baseType:"50mm"},Hormagaunts:{baseType:"28.5mm"},Lictor:{baseType:"50mm"},Maleceptor:{baseType:"120x92mm"},Mawloc:{baseType:"120x92mm"},"Mucolid Spores":{baseType:"40mm"},Neurogaunts:{baseType:"25mm"},"Neurogaunts: Nodebeasts":{baseType:"28.5mm"},Neurolictor:{baseType:"50mm"},Neurotyrant:{baseType:"50mm"},"Norn Assimilator":{baseType:"100mm"},"Norn Emissary":{baseType:"100mm"},"Old One Eye":{baseType:"105x70mm"},"Parasite of Mortrex":{baseType:"40mm"},Psychophage:{baseType:"120x92mm"},Pyrovores:{baseType:"80mm"},Raveners:{baseType:"40mm"},"Ripper Swarms":{baseType:"40mm"},"Screamer-killer":{baseType:"90mm"},"Spore MInes":{baseType:"25mm"},Sporocyst:{baseType:"hull",hullDimensions:{width:0,height:0}},Termagants:{baseType:"28.5mm"},Tervigon:{baseType:"120x92mm"},"The Swarmlord":{baseType:"60mm"},Toxicrene:{baseType:"120x92mm"},Trygon:{baseType:"120x92mm"},"Tyranid Warriors with Melee Bio-weapons":{baseType:"50mm"},"Tyranid Warriors with Ranged Bio-weapons":{baseType:"50mm"},Tyrannocyte:{baseType:"100mm"},Tyrannofex:{baseType:"120x92mm"},"Tyrant Guard":{baseType:"50mm"},Venomthropes:{baseType:"40mm"},"Von Ryanâs Leapers":{baseType:"40mm"},"Winged Hive Tyrant":{baseType:"60mm"},"Winged Tyranid Prime":{baseType:"50mm"},Zoanthropes:{baseType:"40mm"},Harridan:{baseType:"hull",hullDimensions:{width:4,height:6}},Hierophant:{baseType:"hull",hullDimensions:{width:0,height:0}}},vs={"ADEPTA SORORITAS":{"Aestred Thurga and Agathae Dolan: Aestred Thurga":{baseType:"32mm"},"Aestred Thurga and Agathae Dolan: Agathae Dolan":{baseType:"25mm"},"Arco-flagellants":{baseType:"25mm"},"Battle Sisters Squad":{baseType:"32mm"},Canoness:{baseType:"32mm"},"Canoness with Jump Pack":{baseType:"32mm"},Castigator:{baseType:"hull",hullDimensions:{width:6,height:8}},"Celestian Sacresants":{baseType:"32mm"},Daemonifuge:{baseType:"32mm"},Dialogus:{baseType:"40mm"},Dogmata:{baseType:"32mm"},"Dominion Squad":{baseType:"32mm"},Exorcist:{baseType:"hull",hullDimensions:{width:3.5,height:6}},Hospitaller:{baseType:"50mm"},Imagifier:{baseType:"32mm"},Immolator:{baseType:"hull",hullDimensions:{width:4,height:6}},"Junith Eruita":{baseType:"50mm"},"Ministorum Priest":{baseType:"32mm"},Mortifiers:{baseType:"50mm"},"Morvenn Vahl":{baseType:"60mm"},Palatine:{baseType:"32mm"},"Paragon Warsuits":{baseType:"50mm"},"Penitent Engines":{baseType:"50mm"},"Repentia Squad: Repentia Superior":{baseType:"32mm"},"Repentia Squad: Sister Repentia":{baseType:"28.5mm"},"Retributor Squad":{baseType:"32mm"},"Saint Celestine":{baseType:"40mm"},"Saint Celestine: Geminae Superia":{baseType:"32mm"},Sanctifiers:{baseType:"25mm"},"Seraphim Squad":{baseType:"32mm"},"Sisters Novitiate Squad: Novitiate Superior":{baseType:"32mm"},"Sisters Novitiate Squad: Sister Novitiate":{baseType:"28.5mm"},"Sororitas Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Triumph of Saint Katherine":{baseType:"120x92mm"},"Zephyrim Squad":{baseType:"32mm"}},"ADEPTUS CUSTODES":{Aleya:{baseType:"32mm"},"Allarus Custodians":{baseType:"40mm"},"Anathema Psykana Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blade Champion":{baseType:"40mm"},"Custodian Guard":{baseType:"40mm"},"Custodian Wardens":{baseType:"40mm"},"Knight-Centura":{baseType:"32mm"},Prosecutors:{baseType:"32mm"},"Shield-Captain":{baseType:"40mm"},"Shield-Captain in Allarus Terminator Armour":{baseType:"40mm"},"Shield-Captain on Dawneagle Jetbike":{baseType:"75x42mm"},"Trajann Valoris":{baseType:"40mm"},Valerian:{baseType:"40mm"},"Venerable Contemptor Dreadnought":{baseType:"60mm"},"Venerable Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vertus Praetors":{baseType:"75x42mm"},Vigilators:{baseType:"32mm"},Witchseekers:{baseType:"32mm"},"Agamatus Custodians":{baseType:"75x42mm"},"Aquilon Custodians":{baseType:"50mm"},"Ares Gunship":{baseType:"160mm"},"Caladius Grav-tank":{baseType:"170x109mm"},"Contemptor-Achillus Dreadnought":{baseType:"60mm"},"Contemptor-Galatus Dreadnought":{baseType:"60mm"},"Coronus Grav-carrier":{baseType:"170x109mm"},"Custodian Guard with Adrasite and Pyrithite Spears":{baseType:"40mm"},"Orion Assault Dropship":{baseType:"160mm"},"Pallas Grav-attack":{baseType:"105x70mm"},"Sagittarum Custodians":{baseType:"40mm"},"Telemon Heavy Dreadnought":{baseType:"100mm"},"Venatari Custodians":{baseType:"40mm"}},"ADEPTUS MECHANICUS":{"Archaeopter Fusilave":{baseType:"170x109mm"},"Archaeopter Stratoraptor":{baseType:"170x109mm"},"Archaeopter Transvector":{baseType:"170x109mm"},"Belisarius Cawl":{baseType:"105x70mm"},"Corpuscarii Electro-Priests":{baseType:"32mm"},"Cybernetica Datasmith":{baseType:"32mm"},"Fulgurite Electro-Priests":{baseType:"32mm"},"Ironstrider Ballistarii":{baseType:"105x70mm"},"Kastelan Robots":{baseType:"60mm"},"Kataphron Breachers":{baseType:"60mm"},"Kataphron Destroyers":{baseType:"60mm"},"Onager Dunecrawler":{baseType:"130mm"},"Pteraxii Skystalkers":{baseType:"40mm"},"Pteraxii Sterylizors":{baseType:"40mm"},"Serberys Raiders":{baseType:"60x35.5mm"},"Serberys Sulphurhounds":{baseType:"60x35.5mm"},"Sicarian Infiltrators":{baseType:"40mm"},"Sicarian Ruststalkers":{baseType:"40mm"},"Skitarii Marshal":{baseType:"32mm"},"Skitarii Rangers":{baseType:"25mm"},"Skitarii Rangers/Skitarii Vanguard: Transuranic Arquebus":{baseType:"60x35.5mm"},"Skitarii Vanguard":{baseType:"25mm"},"Skorpius Disintegrator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skorpius Dunerider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sydonian Dragoons with Radium Jezzails":{baseType:"105x70mm"},"Sydonian Dragoons with Taser Lances":{baseType:"105x70mm"},"Sydonian Skatros":{baseType:"40mm"},"Tech-Priest Dominus":{baseType:"50mm"},"Tech-Priest Enginseer":{baseType:"32mm"},"Tech-Priest Manipulus":{baseType:"50mm"},Technoarcheologist:{baseType:"32mm"}},"ADEPTUS TITANICUS":{"Reaver Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warbringer Nemesis Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warhound Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warlord Titan":{baseType:"hull",hullDimensions:{width:0,height:0}}},AELDARI:id,"ASTRA MILITARUM":{"Aegis Defence Line":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armoured Sentinels":{baseType:"80mm"},"Artillery Team":{baseType:"130mm"},"Attilan Rough Riders":{baseType:"60x35.5mm"},Baneblade:{baseType:"hull",hullDimensions:{width:0,height:0}},Banehammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Banesword:{baseType:"hull",hullDimensions:{width:0,height:0}},Basilisk:{baseType:"hull",hullDimensions:{width:0,height:0}},"Bullgryn squad":{baseType:"40mm"},"Cadian Castellan":{baseType:"28.5mm"},"Cadian Command Squad":{baseType:"28.5mm"},"Cadian Heavy Weapons Squad":{baseType:"50mm"},"Cadian Shock Troops":{baseType:"25mm"},"Catachan Command Squad":{baseType:"25mm"},"Catachan Heavy Weapons Squad":{baseType:"60mm"},"Catachan Jungle Fighters":{baseType:"25mm"},Chimera:{baseType:"hull",hullDimensions:{width:0,height:0}},Commissar:{baseType:"28.5mm"},"Death Korps of Krieg":{baseType:"25mm"},"Death Riders":{baseType:"60x35.5mm"},Deathstrike:{baseType:"hull",hullDimensions:{width:0,height:0}},Doomhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},"Field Ordnance Battery":{baseType:"100mm"},"Gauntâs Ghosts":{baseType:"28.5mm"},Hellhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Hellhound:{baseType:"hull",hullDimensions:{width:0,height:0}},Hydra:{baseType:"hull",hullDimensions:{width:0,height:0}},Kasrkin:{baseType:"28.5mm"},"Krieg Combat Engineers":{baseType:"25mm"},"Krieg Command Squad":{baseType:"25mm"},"Krieg Command Squad: Lord Commissar":{baseType:"32mm"},"Krieg Heavy Weapons Squad":{baseType:"50mm"},"Krieg Heavy Weapons Squad: Fire Coordinator":{baseType:"25mm"},"Leman Russ Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Demolisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Eradicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Executioner":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Exterminator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Punisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Vanquisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Marshal Dreir":{baseType:"75x42mm"},"Lord Solar Leontus":{baseType:"80mm"},Manticore:{baseType:"hull",hullDimensions:{width:0,height:0}},"Militarum Tempestus Command Squad":{baseType:"25mm"},"Ministorum Priest":{baseType:"32mm"},"Nork Deddog":{baseType:"40mm"},"Ogryn Bodyguard":{baseType:"40mm"},"Ogryn squad":{baseType:"40mm"},"Primaris Psyker":{baseType:"32mm"},Ratlings:{baseType:"25mm"},"Rogal Dorn Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Rogal Dorn Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Scout Sentinels":{baseType:"80mm"},Shadowsword:{baseType:"hull",hullDimensions:{width:0,height:0}},"Sly Marbo":{baseType:"32mm"},Stormlord:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormsword:{baseType:"hull",hullDimensions:{width:0,height:0}},Taurox:{baseType:"hull",hullDimensions:{width:0,height:0}},"Taurox Prime":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tech-Priest Enginseer":{baseType:"32mm"},"Tempestus Aquilons":{baseType:"28.5mm"},"Tempestus Scions":{baseType:"25mm"},"Ursula Creed":{baseType:"32mm"},Valkyrie:{baseType:"120x92mm"},Wyvern:{baseType:"hull",hullDimensions:{width:0,height:0}},"Avenger Strike Fighter":{baseType:"120x92mm"},"Cyclops Demolition Vehicle":{baseType:"hull",hullDimensions:{width:0,height:0}}},"BLACK TEMPLARS":{"Black Templars Gladiator Lancer":{baseType:"100mm"},"Black Templars Gladiator Reaper":{baseType:"100mm"},"Black Templars Gladiator Valiant":{baseType:"100mm"},"Black Templars Impulsor":{baseType:"100mm"},"Black Templars Repulsor":{baseType:"100mm"},"Black Templars Repulsor Executioner":{baseType:"100mm"},Castellan:{baseType:"40mm"},"Chaplain Grimaldus":{baseType:"40mm"},"Chaplain Grimaldus: Cenobyte Servitors":{baseType:"28.5mm"},"Crusader Squad: Neophytes":{baseType:"28.5mm"},"Crusader Squad: Sword Brother/Initiates":{baseType:"32mm"},"High Marshal Helbrecht":{baseType:"60mm"},Marshal:{baseType:"40mm"},"Primaris Crusader Squad: Initiates":{baseType:"32mm"},"Primaris Crusader Squad: Neophytes":{baseType:"28.5mm"},"Primaris Crusader Squad: Sword Brother":{baseType:"40mm"},"Primaris Sword Brethren":{baseType:"40mm"},"The Emperorâs Champion":{baseType:"40mm"}},"BLOOD ANGELS":{Astorath:{baseType:"40mm"},"Baal Predator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blood Angels Captain":{baseType:"40mm"},"Chief Librarian Mephiston":{baseType:"40mm"},"Commander Dante":{baseType:"50mm"},"Death Company Captain":{baseType:"40mm"},"Death Company Captain with Jump Pack":{baseType:"40mm"},"Death Company Dreadnought":{baseType:"90mm"},"Death Company Marines":{baseType:"32mm"},"Death Company Marines with Bolt Rifles":{baseType:"32mm"},"Death Company Marines with Jump Packs":{baseType:"32mm"},Lemartes:{baseType:"40mm"},"Sanguinary Guard":{baseType:"40mm"},"Sanguinary Priest":{baseType:"40mm"},"The Sanguinor":{baseType:"40mm"}},"CHAOS DAEMONS":{"Beâlakor":{baseType:"100mm"},"Beasts of Nurgle":{baseType:"60mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodmaster:{baseType:"40mm"},Bloodthirster:{baseType:"120x92mm"},"Blue Horrors":{baseType:"25mm"},"Burning Chariot":{baseType:"120x92mm"},Changecaster:{baseType:"32mm"},"Contorted Epitome":{baseType:"75x42mm"},"Daemon Prince of Chaos":{baseType:"60mm"},"Daemon Prince of Chaos with Wings":{baseType:"60mm"},Daemonettes:{baseType:"25mm"},Epidemius:{baseType:"60mm"},"Exalted Flamer":{baseType:"75x42mm"},Fateskimmer:{baseType:"120x92mm"},"Feculent Gnarlmaw":{baseType:"hull",hullDimensions:{width:0,height:0}},Fiends:{baseType:"75x42mm"},Flamers:{baseType:"32mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Fluxmaster:{baseType:"Large Flying Base"},"Great Unclean One":{baseType:"130mm"},Hellflayers:{baseType:"120x92mm"},"Horticulous Slimux":{baseType:"105x70mm"},"Infernal Enrapturess":{baseType:"60x35.5mm"},"Kairos Fateweaver":{baseType:"100mm"},Karanak:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},Nurglings:{baseType:"40mm"},"Pink Horrors":{baseType:"32mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Poxbringer:{baseType:"32mm"},"Rendmaster on Blood Throne":{baseType:"120x92mm"},Rotigus:{baseType:"130mm"},Screamers:{baseType:"Small Flying Base"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"},Skarbrand:{baseType:"100mm"},"Skull Altar":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skull Cannon":{baseType:"120x92mm"},Skullmaster:{baseType:"90x52.5mm"},Skulltaker:{baseType:"40mm"},"Sloppity Bilepiper":{baseType:"32mm"},"Soul Grinder":{baseType:"160mm"},"Spoilpox Scrivener":{baseType:"40mm"},"Syllâesske":{baseType:"50mm"},"The Blue Scribes":{baseType:"Large Flying Base"},"The Changeling":{baseType:"40mm"},"The Masque of Slaanesh":{baseType:"32mm"},Tormentbringer:{baseType:"120x92mm"},Tranceweaver:{baseType:"32mm"}},"CHAOS KNIGHTS":{"Knight Abominant":{baseType:"170x109mm"},"Knight Desecrator":{baseType:"170x109mm"},"Knight Despoiler":{baseType:"170x109mm"},"Knight Rampager":{baseType:"170x109mm"},"Knight Tyrant":{baseType:"170x109mm"},"War Dog Brigand":{baseType:"100mm"},"War Dog Executioner":{baseType:"100mm"},"War Dog Huntsman":{baseType:"100mm"},"War Dog Karnivore":{baseType:"100mm"},"War Dog Stalker":{baseType:"100mm"},"Chaos Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Cerastus Knight Acheron":{baseType:"170x109mm"},"Chaos Cerastus Knight Atrapos":{baseType:"170x109mm"},"Chaos Cerastus Knight Castigator":{baseType:"170x109mm"},"Chaos Cerastus Knight Lancer":{baseType:"170x109mm"},"Chaos Questoris Knight Magaera":{baseType:"170x109mm"},"Chaos Questoris Knight Styrix":{baseType:"170x109mm"},"War Dog Moirax":{baseType:"100mm"}},"CHAOS SPACE MARINES":{"Abaddon the Despoiler":{baseType:"60mm"},"Accursed Cultists: Mutant":{baseType:"25mm"},"Accursed Cultists: Torment":{baseType:"40mm"},"Chaos Bikers":{baseType:"75x42mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Lord":{baseType:"40mm"},"Chaos Lord in Terminator Armour":{baseType:"40mm"},"Chaos Lord with Jump Pack":{baseType:"40mm"},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminator Squad":{baseType:"40mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},Chosen:{baseType:"32mm"},"Cultist Firebrand":{baseType:"32mm"},"Cultist Mob":{baseType:"25mm"},Cypher:{baseType:"32mm"},"Dark Apostle":{baseType:"40mm"},"Dark Apostle: Dark Disciple":{baseType:"25mm"},"Dark Commune: Blessed Blade":{baseType:"28.5mm"},"Dark Commune: Cult Demagogue, Mindwitch, Iconarch":{baseType:"32mm"},Defiler:{baseType:"160mm"},"Fabius Bile":{baseType:"40mm"},"Fabius Bile: Surgeon Acolyte":{baseType:"32mm"},"Fellgor beastmen":{baseType:"32mm"},Forgefiend:{baseType:"120x92mm"},"Haarken Worldclaimer":{baseType:"40mm"},Havocs:{baseType:"40mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Heretic Astartes Daemon Prince":{baseType:"60mm"},"Heretic Astartes Daemon Prince with Wings":{baseType:"60mm"},"Huron Blackheart":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},Legionaries:{baseType:"32mm"},"Lord Discordant on Helstalker":{baseType:"120x92mm"},"Master of Executions":{baseType:"40mm"},"Master of Possession":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},"Nemesis Claw":{baseType:"32mm"},"Noctilith Crown":{baseType:"hull",hullDimensions:{width:0,height:0}},Obliterators:{baseType:"50mm"},Possessed:{baseType:"40mm"},Raptors:{baseType:"32mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Traitor Enforcer":{baseType:"32mm"},"Traitor Enforcer: Traitor Ogryn":{baseType:"40mm"},"Traitor Guardsmen Squad":{baseType:"25mm"},"Vashtorr the Arkifane":{baseType:"80mm"},Venomcrawler:{baseType:"100mm"},"Warp Talons":{baseType:"32mm"},Warpsmith:{baseType:"60x35.5mm"}},"DARK ANGELS":{Asmodai:{baseType:"50mm"},Azrael:{baseType:"50mm"},Belial:{baseType:"50mm"},"Deathwing Knights":{baseType:"40mm"},"Deathwing Terminator Squad":{baseType:"40mm"},Ezekiel:{baseType:"25mm"},"Inner Circle Companions":{baseType:"40mm"},"Land Speeder Vengeance":{baseType:"Large Flying Base"},Lazarus:{baseType:"40mm"},"Lion ElâJonson":{baseType:"60mm"},"Nephilim Jetfighter":{baseType:"120x92mm"},"Ravenwing Black Knights":{baseType:"75x42mm"},"Ravenwing Command Squad":{baseType:"75x42mm"},"Ravenwing Dark Talon":{baseType:"120x92mm"},"Ravenwing Darkshroud":{baseType:"Large Flying Base"},Sammael:{baseType:"Large Flying Base"}},"DEATH GUARD":{"Biologus Putrifier":{baseType:"40mm"},"Blightlord Terminators":{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Nurgle":{baseType:"60mm"},"Daemon Prince of Nurgle with Wings":{baseType:"60mm"},"Deathshroud Terminators":{baseType:"40mm"},Defiler:{baseType:"160mm"},"Foetid Bloat-Drone":{baseType:"60mm"},"Foetid Bloat-drone with Heavy Blight Launcher":{baseType:"60mm"},"Foul Blightspawn":{baseType:"40mm"},Helbrute:{baseType:"60mm"},"Icon Bearer":{baseType:"32mm"},"Lord of Contagion":{baseType:"50mm"},"Lord of Poxes":{baseType:"40mm"},"Lord of Virulence":{baseType:"50mm"},"Malignant Plaguecaster":{baseType:"32mm"},"Miasmic Malignifier":{baseType:"hull",hullDimensions:{width:0,height:0}},Mortarion:{baseType:"100mm"},"Myphitic Blight-Haulers":{baseType:"80mm"},"Noxious Blightbringer":{baseType:"40mm"},"Plague Marines":{baseType:"32mm"},"Plague Surgeon":{baseType:"40mm"},"Plagueburst Crawler":{baseType:"hull",hullDimensions:{width:0,height:0}},Poxwalkers:{baseType:"25mm"},Tallyman:{baseType:"40mm"},Typhus:{baseType:"50mm"},"Beasts of Nurgle":{baseType:"60mm"},"Great Unclean One":{baseType:"130mm"},Nurglings:{baseType:"40mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Rotigus:{baseType:"130mm"}},DEATHWATCH:od,DRUKHARI:ld,"EMPERORâS CHILDREN":{"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminators":{baseType:"40mm"},"Daemon Prince of Slaanesh":{baseType:"60mm"},"Daemon Prince of Slaanesh with Wings":{baseType:"60mm"},"Flawless Blades":{baseType:"40mm"},Fulgrim:{baseType:"130mm"},Heldrake:{baseType:"120x92mm"},Infractors:{baseType:"32mm"},"Lord Exultant":{baseType:"40mm"},"Lord Kakophonist":{baseType:"40mm"},"Lucius the Eternal":{baseType:"50mm"},Maulerfiend:{baseType:"120x92mm"},"Noise Marines":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},Tormentors:{baseType:"32mm"},Daemonettes:{baseType:"25mm"},Fiends:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"}},"GENESTEALER CULTS":{Aberrants:{baseType:"32mm"},Abominant:{baseType:"40mm"},"Achilles Ridgerunners":{baseType:"120x92mm"},"Acolyte Hybrids with Autopistols":{baseType:"32mm"},"Acolyte Hybrids with Hand Flamers":{baseType:"32mm"},"Acolyte Iconward":{baseType:"32mm"},"Atalan Jackals":{baseType:"60x35.5mm"},"Atalan Jackals: Wolfquad":{baseType:"60mm"},Benefictus:{baseType:"32mm"},Biophagus:{baseType:"25mm"},Clamavus:{baseType:"32mm"},"Goliath Rockgrinder":{baseType:"hull",hullDimensions:{width:0,height:0}},"Goliath Truck":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hybrid Metamorphs":{baseType:"32mm"},"Jackal Alphus":{baseType:"60x35.5mm"},Kelermorph:{baseType:"32mm"},Locus:{baseType:"32mm"},Magus:{baseType:"32mm"},"Neophyte Hybrids":{baseType:"25mm"},"Neophyte Hybrids: Heavy stubber, Mining laser, Seismic cannon":{baseType:"32mm"},Nexos:{baseType:"40mm"},Patriarch:{baseType:"50mm"},Primus:{baseType:"32mm"},"Purestrain Genestealers":{baseType:"32mm"},"Reductus Saboteur":{baseType:"32mm"},Sanctus:{baseType:"32mm"}},"GREY KNIGHTS":{"Brother-Captain":{baseType:"40mm"},"Brother-Captain Stern":{baseType:"40mm"},"Brotherhood Champion":{baseType:"32mm"},"Brotherhood Chaplain":{baseType:"40mm"},"Brotherhood Librarian":{baseType:"40mm"},"Brotherhood Techmarine":{baseType:"32mm"},"Brotherhood Terminator Squad":{baseType:"40mm"},"Castellan Crowe":{baseType:"40mm"},"Grand Master":{baseType:"40mm"},"Grand Master in Nemesis Dreadknight":{baseType:"120x92mm"},"Grand Master Voldus":{baseType:"40mm"},"Grey Knights Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Razorback":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Stormhawk Interceptor":{baseType:"120x92mm"},"Grey knights Stormraven Gunship":{baseType:"120x92mm"},"Grey knights Stormtalon Gunship":{baseType:"120x92mm"},"Grey Knights Venerable Dreadnought":{baseType:"60mm"},"Interceptor Squad":{baseType:"32mm"},"Kaldor Draigo":{baseType:"40mm"},"Nemesis Dreadknight":{baseType:"120x92mm"},"Paladin Squad":{baseType:"40mm"},"Purgation Squad":{baseType:"32mm"},"Purifier Squad":{baseType:"32mm"},Servitors:{baseType:"25mm"},"Strike Squad":{baseType:"32mm"},"Grey Knights Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}},"Land Raider Banisher":{baseType:"hull",hullDimensions:{width:0,height:0}}},"IMPERIAL AGENTS":{"Callidus Assassin":{baseType:"32mm"},"Corvus Blackstar":{baseType:"120x92mm"},"Culexus Assassin":{baseType:"32mm"},"Deathwatch Kill Team":{baseType:"32mm"},"Eversor Assassin":{baseType:"32mm"},"Exaction Squad":{baseType:"28.5mm"},"Exaction Squad: Cyber-mastiff":{baseType:"25mm"},"Grey Knights Terminator Squad":{baseType:"40mm"},"Imperial Navy Breachers":{baseType:"25mm"},"Imperial Navy Breachers: Navis las-volley, endurant shield":{baseType:"28.5mm"},"Imperial Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},Inquisitor:{baseType:"32mm"},"Inquisitor Coteaz":{baseType:"40mm"},"Inquisitor Draxus":{baseType:"32mm"},"Inquisitor Greyfax":{baseType:"32mm"},"Inquisitorial Agents":{baseType:"25mm"},"Inquisitorial Agents: Gun Servitors":{baseType:"32mm"},"Inquisitorial Chimera":{baseType:"hull",hullDimensions:{width:0,height:0}},"Ministorum Priest":{baseType:"32mm"},Navigator:{baseType:"32mm"},"Rogue Trader entourage":{baseType:"25mm"},Sanctifiers:{baseType:"25mm"},"Sisters of Battle Immolator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sisters of Battle Squad":{baseType:"32mm"},"Subductor Squad":{baseType:"28.5mm"},"Subductor Squad: Cyber-mastiff":{baseType:"25mm"},"Vigilant Squad":{baseType:"28.5mm"},"Vigilant Squad: Cyber-mastiff":{baseType:"25mm"},"Vindicare Assassin":{baseType:"32mm"},"Voidsmen-at-Arms":{baseType:"32mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},"IMPERIAL KNIGHTS":{"Armiger Helverin":{baseType:"100mm"},"Armiger Warglaive":{baseType:"100mm"},"Canis Rex":{baseType:"170x109mm"},"Knight Castellan":{baseType:"170x109mm"},"Knight Crusader":{baseType:"170x109mm"},"Knight Errant":{baseType:"170x109mm"},"Knight Gallant":{baseType:"170x109mm"},"Knight Paladin":{baseType:"170x109mm"},"Knight Preceptor":{baseType:"170x109mm"},"Knight Valiant":{baseType:"170x109mm"},"Knight Warden":{baseType:"170x109mm"},"Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armiger Moirax":{baseType:"100mm"},"Cerastus Knight Acheron":{baseType:"170x109mm"},"Cerastus Knight Atrapos":{baseType:"170x109mm"},"Cerastus Knight Castigator":{baseType:"170x109mm"},"Cerastus Knight Lancer":{baseType:"170x109mm"},"Questoris Knight Magaera":{baseType:"170x109mm"},"Questoris Knight Styrix":{baseType:"170x109mm"}},"LEAGUES OF VOTANN":{"BrÃ´khyr Iron-master":{baseType:"32mm"},"BrÃ´khyr Iron-master: E-COG":{baseType:"25mm"},"BrÃ´khyr Iron-master: Ironkin Assistant":{baseType:"28.5mm"},"BrÃ´khyr Thunderkyn":{baseType:"40mm"},"Cthonian Beserks":{baseType:"28.5mm"},"Cthonian Beserks: Mole grenade launcher":{baseType:"50mm"},"Einhyr Champion":{baseType:"40mm"},"Einhyr Hearthguard":{baseType:"32mm"},Grimnyr:{baseType:"40mm"},"Grimnyr: CORV":{baseType:"25mm"},"Hearthkyn Warriors":{baseType:"28.5mm"},"Hekaton Land Fortress":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hernkyn Pioneers":{baseType:"90x52.5mm"},"Hernkyn Yaegirs":{baseType:"28.5mm"},KÃ¢hl:{baseType:"40mm"},Sagitaur:{baseType:"hull",hullDimensions:{width:0,height:0}},"Ãthar the Destined":{baseType:"40mm"}},NECRONS:cd,ORKS:ud,"SPACE MARINES":{"Adrax Agatone":{baseType:"40mm"},"Aggressor Squad":{baseType:"40mm"},Ancient:{baseType:"40mm"},"Ancient in Terminator Armour":{baseType:"40mm"},Apothecary:{baseType:"40mm"},"Apothecary Biologis":{baseType:"40mm"},"Assault Intercessor Squad":{baseType:"32mm"},"Assault Intercessors with Jump Packs":{baseType:"32mm"},"Ballistus Dreadnought":{baseType:"90mm"},"Bladeguard Ancient":{baseType:"40mm"},"Bladeguard Veteran Squad":{baseType:"40mm"},"Brutalis Dreadnought":{baseType:"90mm"},Captain:{baseType:"40mm"},"Captain in Gravis Armour":{baseType:"40mm"},"Captain in Phobos Armour":{baseType:"40mm"},"Captain in Terminator Armour":{baseType:"50mm"},"Captain Sicarius":{baseType:"32mm"},"Captain with Jump Pack":{baseType:"40mm"},"Centurion Assault Squad":{baseType:"50mm"},"Centurion Devastator Squad":{baseType:"50mm"},Chaplain:{baseType:"40mm"},"Chaplain in Terminator Armour":{baseType:"40mm"},"Chaplain on Bike":{baseType:"90x52.5mm"},"Chaplain with Jump Pack":{baseType:"32mm"},"Chief Librarian Tigurius":{baseType:"40mm"},"Company Heroes":{baseType:"40mm"},"Darnath Lysander":{baseType:"50mm"},"Desolation Squad":{baseType:"32mm"},"Devastator Squad":{baseType:"32mm"},Dreadnought:{baseType:"60mm"},"Drop Pod":{baseType:"hull",hullDimensions:{width:0,height:0}},"Eliminator Squad":{baseType:"40mm"},"Eradicator Squad":{baseType:"40mm"},"Firestrike Servo-turrets":{baseType:"80mm"},"Gladiator Lancer":{baseType:"100mm"},"Gladiator Reaper":{baseType:"100mm"},"Gladiator Valiant":{baseType:"100mm"},"Hammerfall Bunker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Heavy Intercessor Squad":{baseType:"40mm"},"Hellblaster Squad":{baseType:"32mm"},Impulsor:{baseType:"100mm"},"Inceptor Squad":{baseType:"40mm"},"Incursor Squad":{baseType:"32mm"},"Infernus Squad":{baseType:"32mm"},"Infiltrator Squad":{baseType:"32mm"},"Intercessor Squad":{baseType:"32mm"},"Invader ATV":{baseType:"hull",hullDimensions:{width:0,height:0}},"Invictor Tactical Warsuit":{baseType:"90mm"},"Iron Father Feirros":{baseType:"40mm"},Judiciar:{baseType:"40mm"},"Kayvaan Shrike":{baseType:"40mm"},"Korâsarro Khan":{baseType:"40mm"},"Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},Librarian:{baseType:"40mm"},"Librarian in Phobos Armour":{baseType:"40mm"},"Librarian in Terminator Armour":{baseType:"40mm"},Lieutenant:{baseType:"40mm"},"Lieutenant in Phobos Armour":{baseType:"40mm"},"Lieutenant in Reiver Armour":{baseType:"40mm"},"Lieutenant Titus":{baseType:"40mm"},"Lieutenant with Combi-weapon":{baseType:"40mm"},"Marneus Calgar":{baseType:"50mm"},"Marneus Calgar: Victrix Honour Guard":{baseType:"40mm"},"Outrider Squad":{baseType:"90x52.5mm"},"Pedro Kantor":{baseType:"32mm"},"Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},Razorback:{baseType:"hull",hullDimensions:{width:0,height:0}},"Redemptor Dreadnought":{baseType:"90mm"},"Reiver Squad":{baseType:"32mm"},Repulsor:{baseType:"100mm"},"Repulsor Executioner":{baseType:"100mm"},Rhino:{baseType:"hull",hullDimensions:{width:0,height:0}},"Roboute Guilliman":{baseType:"60mm"},"Scout Squad":{baseType:"28.5mm"},"Sternguard Veteran Squad":{baseType:"32mm"},"Storm Speeder Hailstrike":{baseType:"90mm"},"Storm Speeder Hammerstrike":{baseType:"90mm"},"Storm Speeder Thunderstrike":{baseType:"90mm"},"Stormhawk Interceptor":{baseType:"120x92mm"},"Stormraven Gunship":{baseType:"120x92mm"},"Stormtalon Gunship":{baseType:"120x92mm"},"Suppressor Squad":{baseType:"40mm"},"Tactical Squad":{baseType:"32mm"},Techmarine:{baseType:"40mm"},"Terminator Assault Squad":{baseType:"40mm"},"Terminator Squad":{baseType:"40mm"},"Tor Garadon":{baseType:"40mm"},"Uriel Ventris":{baseType:"40mm"},"Vanguard Veteran Squad with Jump Packs":{baseType:"32mm"},Vindicator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Vulkan Heâstan":{baseType:"32mm"},Whirlwind:{baseType:"hull",hullDimensions:{width:0,height:0}},Astraeus:{baseType:"hull",hullDimensions:{width:0,height:0}},"Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}}},"SPACE WOLVES":{"Arjac Rockfist":{baseType:"50mm"},"Bjorn the Fell-handed":{baseType:"60mm"},"Blood Claws":{baseType:"32mm"},"Fenrisian Wolves":{baseType:"40mm"},"Grey Hunters":{baseType:"32mm"},"Iron Priest":{baseType:"32mm"},"Logan Grimnar":{baseType:"80mm"},Murderfang:{baseType:"60mm"},"Njal Stormcaller":{baseType:"40mm"},"Ragnar Blackmane":{baseType:"40mm"},"Thunderwolf Cavalry":{baseType:"60mm"},"Ulrik the Slayer":{baseType:"32mm"},"Venerable Dreadnought":{baseType:"60mm"},"Wolf Guard Battle Leader":{baseType:"40mm"},"Wolf Guard Headtakers":{baseType:"40mm"},"Wolf Guard Headtakers: Hunting Wolves":{baseType:"60x35.5mm"},"Wolf Guard Terminators":{baseType:"40mm"},"Wolf Priest":{baseType:"40mm"},Wulfen:{baseType:"40mm"},"Wulfen Dreadnought":{baseType:"60mm"},"Wulfen with Storm Shields":{baseType:"40mm"}},"TâAU EMPIRE":{"Breacher Team":{baseType:"25mm"},"Broadside Battlesuits":{baseType:"60mm"},"Cadre Fireblade":{baseType:"25mm"},"Commander Farsight":{baseType:"60mm"},"Commander in Coldstar Battlesuit":{baseType:"60mm"},"Commander in Enforcer Battlesuit":{baseType:"60mm"},"Commander Shadowsun":{baseType:"50mm"},"Crisis Fireknife Battlesuits":{baseType:"50mm"},"Crisis Starscythe Battlesuits":{baseType:"50mm"},"Crisis Sunforge Battlesuits":{baseType:"50mm"},Darkstrider:{baseType:"32mm"},Devilfish:{baseType:"Large Flying Base"},Ethereal:{baseType:"40mm"},"Firesight Team":{baseType:"40mm"},"Ghostkeel Battlesuit":{baseType:"105x70mm"},"Hammerhead Gunship":{baseType:"Large Flying Base"},"Kroot Carnivores":{baseType:"28.5mm"},"Kroot Farstalkers":{baseType:"28.5mm"},"Kroot Farstalkers: Kroot Kill-broker":{baseType:"32mm"},"Kroot Flesh Shaper":{baseType:"32mm"},"Kroot Hounds":{baseType:"28.5mm"},"Kroot Lone-spear":{baseType:"90x52.5mm"},"Kroot Trail Shaper":{baseType:"32mm"},"Kroot War Shaper":{baseType:"32mm"},"Krootox Rampagers":{baseType:"50mm"},"Krootox Riders":{baseType:"50mm"},"Pathfinder Team":{baseType:"25mm"},Piranhas:{baseType:"Large Flying Base"},"Razorshark Strike Fighter":{baseType:"120x92mm"},"Riptide Battlesuit":{baseType:"120x92mm"},"Sky Ray Gunship":{baseType:"Large Flying Base"},"Stealth Battlesuits":{baseType:"32mm"},Stormsurge:{baseType:"170x109mm"},"Strike Team":{baseType:"25mm"},"Sun Shark Bomber":{baseType:"120x92mm"},"Tidewall Defence Platform":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Droneport":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Gunrig":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Shieldline":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vespid Stingwings":{baseType:"28.5mm"},"AX-1-0 Tiger Shark":{baseType:"160mm"},Manta:{baseType:"hull",hullDimensions:{width:4,height:6}},"Taâunar Supremacy Armour":{baseType:"160mm"},"Tiger Shark":{baseType:"160mm"}},"THOUSAND SONS":{Ahriman:{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Daemon Prince of Tzeentch":{baseType:"60mm"},"Daemon Prince of Tzeentch with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},"Exalted Sorcerer":{baseType:"32mm"},"Exalted Sorcerer on Disc of Tzeentch":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Infernal Master":{baseType:"40mm"},"Magnus the Red":{baseType:"100mm"},Maulerfiend:{baseType:"120x92mm"},"Mutalith Vortex Beast":{baseType:"120x92mm"},"Rubric Marines":{baseType:"32mm"},"Scarab Occult Terminators":{baseType:"40mm"},"Sekhetar Robots":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Tzaangor Enlightened":{baseType:"40mm"},"Tzaangor Enlightened with Fatecaster Greatbows":{baseType:"40mm"},"Tzaangor Shaman":{baseType:"40mm"},Tzaangors:{baseType:"32mm"},"Blue Horrors":{baseType:"25mm"},Flamers:{baseType:"32mm"},"Kairos Fateweaver":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},"Pink Horrors":{baseType:"32mm"},Screamers:{baseType:"Small Flying Base"}},TYRANIDS:md,"WORLD EATERS":{Angron:{baseType:"100mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Khorne":{baseType:"60mm"},"Daemon Prince of Khorne with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},Eightbound:{baseType:"40mm"},"Exalted Eightbound":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Goremongers:{baseType:"32mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},Jakhals:{baseType:"28.5mm"},"Jakhals: Dishonoured":{baseType:"40mm"},"KhÃ¢rn the Betrayer":{baseType:"40mm"},"Khorne Berzerkers":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Invocatus":{baseType:"90x52.5mm"},"Lord on Juggernaut":{baseType:"90x52.5mm"},"Master of Executions":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},Slaughterbound:{baseType:"50mm"},"Terminator Squad":{baseType:"40mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodthirster:{baseType:"120x92mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Skarbrand:{baseType:"100mm"}}},dd=oa(vs);function hd(){return Object.keys(vs)}function fl(t){return vs[t]?Object.keys(vs[t]):[]}function Zr(t,a){return!vs[t]||!vs[t][a]?null:vs[t][a]}Vn(dd,t=>Object.keys(t));function fd(t,a){const n=t.FACTION_KEYWORD,r=t.UNITS||[],s=[],i=[],o={};for(const m of r){const f=m.name||"",d=rd(m.quantity);let y=Zr(n,f);if(!y){const u=yl(f,n);u&&(y=Zr(n,u))}if(!y){const{faction:u,unitName:p}=vd(f);u&&p&&(y=Zr(u,p))}if(y){o[f]||(o[f]=0),o[f]++;const u=o[f]>1?` #${o[f]}`:"",p=`${f}${u}`,g=yd(y,d,a,p);s.push(...g)}else i.push({id:"unmatched-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),unitName:f,quantity:d,points:m.points,section:m.section})}return{matched:pd(s),unmatched:i}}function yd(t,a,n,r,s){const i=[],o=gd(),c=t.baseType,m=bd(r,c);for(let f=0;f<a;f++){const y={id:xd(),baseType:c,playerId:n,x:0,y:0,rotation:0,unitId:o,unitName:r,name:m,imported:!0,inStaging:!0};c==="hull"&&(y.baseType="rect-custom",y.customWidth=t.hullDimensions?.width||5.5,y.customHeight=t.hullDimensions?.height||3),i.push(y)}return i}function pd(t){const i={};t.forEach(f=>{const d=f.unitId||"ungrouped";i[d]||(i[d]=[]),i[d].push(f)});let o=2,c=2,m=0;for(const f in i){const d=i[f];for(const y of d)y.x=o,y.y=c,o+=2,m++,m>=6&&(o=2,c+=2,m=0);m>0&&(o=2,c+=2,m=0)}return t}function yl(t,a){const n=fl(a);if(!n||n.length===0)return null;const r=ms(t);for(const c of n)if(ms(c)===r)return c;const s=r.replace(/s$/,""),i=r+"s";for(const c of n){const m=ms(c);if(m===s||m===i)return c}for(const c of n){const m=ms(c);if(r.includes(m)||m.includes(r))return c}const o=r.split(/\s+/).filter(c=>c.length>2);if(o.length>0)for(const c of n){const m=ms(c);if(o.every(f=>m.includes(f)))return c}return null}function vd(t){const a=hd(),n=ms(t);for(const r of a){const s=fl(r);if(s){for(const i of s)if(ms(i)===n)return{faction:r,unitName:i}}}for(const r of a){const s=yl(t,r);if(s)return{faction:r,unitName:s}}return{faction:null,unitName:null}}function ms(t){return String(t||"").toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim()}function gd(){return"unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function bd(t,a){if(!t)return"";const n=a.match(/(\d+)mm/),r=n?parseInt(n[1],10):null;return r&&r<50?Td(t):t}function Td(t){return t?t.replace(/\s*#\d+$/,"").split(/\s+/).filter(s=>s.length>0).slice(0,3).map(s=>s[0].toUpperCase()).join(""):""}function xd(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}var _d=ge('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),wd=ge('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div> <!>',1),Sd=ge('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Selected</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <button class="danger svelte-1g40uyy"> </button></div>'),Ad=ge('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Rotation</span> <span class="value svelte-1g40uyy"> </span></div>'),Cd=ge('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div>'),kd=ge('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),Ed=ge('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Base Type</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Player</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Position</span> <span class="value svelte-1g40uyy"> </span></div> <!> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-1g40uyy">Remove</button></div>'),Md=ge('<p class="hint svelte-1g40uyy">Click a model to select it</p>'),Rd=ge('<p class="hint svelte-1g40uyy">Click and drag on battlefield to draw a measurement line</p>'),Ld=ge('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Length</span> <span class="value svelte-1g40uyy"> </span></div> <button class="danger svelte-1g40uyy">Remove Line</button>',1),Dd=ge('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Lines</span> <span class="value svelte-1g40uyy"> </span></div> <button class="secondary svelte-1g40uyy">Clear All Lines</button>',1),Id=ge('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Line Tool Active (M)</label></div> <!> <!> <!> <div class="field svelte-1g40uyy" style="margin-top: 0.5rem; border-top: 1px solid #333; padding-top: 0.5rem;"><span class="label-text svelte-1g40uyy">Range Zones</span> <label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show 6" zones</label> <label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show 9" zones</label> <label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show 12" zones</label></div></div>'),$d=ge('<div class="button-group vertical svelte-1g40uyy"><div class="button-row svelte-1g40uyy"><button title="Undo (Ctrl+Z)" class="svelte-1g40uyy">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-1g40uyy">Redo</button></div> <div class="button-row svelte-1g40uyy"><button title="Export deployment to share with others" class="svelte-1g40uyy">Export</button> <button title="Import deployment from JSON file" class="svelte-1g40uyy">Import</button></div> <input type="file" accept=".json" style="display: none;"/> <button title="Export battlefield as PNG image" class="svelte-1g40uyy">Export PNG</button> <button class="svelte-1g40uyy">Save to Browser</button> <button class="svelte-1g40uyy">Restore from Browser</button> <button class="secondary svelte-1g40uyy">Clear All Models</button> <button class="secondary svelte-1g40uyy">Clear Saved State</button></div>'),Pd=ge('<div class="player-toggle svelte-1g40uyy"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-1g40uyy"><div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Circles</h4> <div class="palette-grid svelte-1g40uyy"></div></div> <div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Ovals</h4> <div class="palette-grid svelte-1g40uyy"></div></div></div>',1),Nd=ge('<div class="rect-hull-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="rect-width" class="svelte-1g40uyy">Width (inches)</label> <input id="rect-width" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <div class="field svelte-1g40uyy"><label for="rect-height" class="svelte-1g40uyy">Height (inches)</label> <input id="rect-height" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <button class="svelte-1g40uyy"> </button></div>'),Od=he('<path stroke-width="0.10" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),Wd=he('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),Yd=he("<!><!>",1),Hd=he('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),Fd=he('<g opacity="0.5" pointer-events="none"><!></g>'),Bd=he('<g><rect rx="12" ry="12" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></rect></g>'),qd=he('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></ellipse></g>'),Ud=he('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></circle>'),Kd=he('<g><rect rx="9" ry="9" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></rect></g>'),Gd=he('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></ellipse></g>'),zd=he('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></circle>'),Xd=he('<g><rect rx="6" ry="6" fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></rect></g>'),Vd=he('<g><ellipse fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></ellipse></g>'),jd=he('<circle fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></circle>'),Zd=he("<!><!><!>",1),Qd=he('<circle r="0.4" fill="rgba(147, 51, 234, 0.5)" stroke="#9333ea" stroke-width="0.1" pointer-events="none"></circle><line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="group-rotate-handle"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),Jd=he('<circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle><circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle>',1),eh=he('<g><line stroke-linecap="round"></line><!><g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g></g>'),th=he('<g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" fill="#f59e0b" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g>'),ah=he('<g class="measurement-line drawing"><line stroke="#f59e0b" stroke-width="0.15" stroke-dasharray="0.3,0.15" stroke-linecap="round" pointer-events="none"></line><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><!></g>'),nh=he('<line stroke-width="0.05" pointer-events="none"></line>'),sh=he('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),rh=he('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),ih=he('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),oh=he("<!><!><!><!><!><!><!><!><!><!><!><!><!><!><!>",1),lh=ge('<main class="svelte-1g40uyy"><div class="layout svelte-1g40uyy"><div class="sidebar svelte-1g40uyy"><!> <!> <!> <!> <!> <!></div> <div class="main-content svelte-1g40uyy"><div class="battlefield-area svelte-1g40uyy"><div class="battlefield-container svelte-1g40uyy" role="presentation"><!></div> <div class="info svelte-1g40uyy"><p class="svelte-1g40uyy"> </p> <p class="hint svelte-1g40uyy">Drag to select | Ctrl+Click multi-select | Del remove | 1/2 player | L LoS | M measure</p></div></div></div></div></main> <!>',1);function ch(t,a){Ka(a,!1);const n=()=>Nt(es,"$selectedDeployment",d),r=()=>Nt(fn,"$selectedLayoutName",d),s=()=>Nt(Sn,"$selectedLayoutType",d),i=()=>Nt(gt,"$models",d),o=()=>Nt(Mi,"$loadedTerrain",d),c=()=>Nt(Na,"$history",d),m=()=>Nt(il,"$player1Models",d),f=()=>Nt(ol,"$player2Models",d),[d,y]=zs(),u=P(),p=P(),g=P(),_=P(),x=P(),E=P(),R=P(),L=P(),S=P(),A=P(),M=P(),D=P();let k=P(1),I=P(null),U=!1,le=null,N=P(null),fe=P(!1),Ce=P(!1),ne=P(5.5),re=P(3),ce=P(!1),xe=P([]),Ie=[],te=P(null),z=P(!1),Z=P(null),Se=P(null),H=P([]),ve=P(new Set),Me=!1,yt=!1,ye=null,ae=!1,qe=null,ke=0,zt=null,st=P([]),Ze=P(null),pt=P(!1),tt=P(null),Tt=P(null),Yt=P(!1),la=P(!1),oe=P(!1),Re=P(!1);const Ue=5,Dt="warhammer-deployment-state";function Et(){const w={deployment:n()?.name||null,layout:r()||null,layoutType:s()||null,models:i()};localStorage.setItem(Dt,JSON.stringify(w))}function Ht(){const w=localStorage.getItem(Dt);if(w)try{const O=JSON.parse(w);O.models&&Array.isArray(O.models)&&(gt.set(O.models),Na.clear())}catch(O){console.error("Failed to restore deployment state:",O)}}function Xt(){localStorage.removeItem(Dt),gt.clear()}function Ya(){const w={version:1,exportedAt:new Date().toISOString(),deployment:n()?{name:n().name,zones:n().zones,objectives:n().objectives}:null,terrain:{layoutName:r(),layoutType:s(),terrains:o().terrains,walls:o().walls},models:i()},O=JSON.stringify(w,null,2),B=new Blob([O],{type:"application/json"}),Q=URL.createObjectURL(B),ue=document.createElement("a");ue.href=Q,ue.download=`deployment-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(ue),ue.click(),document.body.removeChild(ue),URL.revokeObjectURL(Q)}async function Ha(){const O=`deployment-${new Date().toISOString().slice(0,10)}`;try{await Ei(o().terrains,o().walls,i(),O,n())}catch(B){alert("Failed to export PNG"),console.error("Export error:",B)}}let Zt=P(null);function Oe(){e(Zt)?.click()}function Je(w){const O=w.target.files?.[0];if(!O)return;const B=new FileReader;B.onload=Q=>{try{const ue=JSON.parse(Q.target.result);rt(ue)}catch(ue){console.error("Failed to parse import file:",ue),alert("Failed to import: Invalid JSON file")}},B.readAsText(O),w.target.value=""}function rt(w){if(!w.version){alert("Invalid import file: missing version");return}if(w.deployment){const O=ul.find(B=>B.name===w.deployment.name);O?es.set(O):w.deployment.zones&&w.deployment.objectives&&es.set({name:w.deployment.name||"Imported",zones:w.deployment.zones,objectives:w.deployment.objectives})}else es.set(null);if(w.terrain){const{layoutName:O,layoutType:B,terrains:Q,walls:ue}=w.terrain;if(B==="preset"&&O){if(Ci.find(se=>se.name===O))fn.set(O),Sn.set("preset");else if(Q||ue){const se=`imported-${Date.now()}`,_e=localStorage.getItem("warhammer-deployment-layouts"),Ye=_e?JSON.parse(_e):{};Ye[se]={terrains:Q||[],walls:ue||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(Ye)),fn.set(se),Sn.set("saved")}}else if(B==="saved"&&O){const me=localStorage.getItem("warhammer-deployment-layouts"),se=me?JSON.parse(me):{};se[O]?(fn.set(O),Sn.set("saved")):(Q||ue)&&(se[O]={terrains:Q||[],walls:ue||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(se)),fn.set(O),Sn.set("saved"))}else if(Q||ue){const me=`imported-${Date.now()}`,se=localStorage.getItem("warhammer-deployment-layouts"),_e=se?JSON.parse(se):{};_e[me]={terrains:Q||[],walls:ue||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(_e)),fn.set(me),Sn.set("saved")}}w.models&&Array.isArray(w.models)&&(gt.set(w.models),Na.clear()),v(H,[])}function At(w,O){const ue=O===1?-4:64,me=2;let se=ue,_e=me,Ye=0;return w.map(bt=>{const xt={...bt,x:se,y:_e,inStaging:!1};return _e+=2,Ye++,Ye>=20&&(_e=me,se+=O===1?-2:2,Ye=0),xt})}async function Qt(w){const{text:O,playerId:B}=w.detail;try{e(te)&&e(te).setLoading(!0);const{format:Q,data:ue}=await nd(O),{matched:me,unmatched:se}=fd(ue,B),_e=ue.LIST_TITLE||`${ue.FACTION_KEYWORD} Army`;ci.addImport(_e,O,ue,B),se.length>0?(v(xe,se),Ie=me,v(ce,!0),e(te)&&e(te).setLoading(!1)):(At(me,B).forEach(bt=>{gt.update(xt=>[...xt,bt])}),e(te)&&(e(te).setSuccess(`Imported ${me.length} models from ${ue.FACTION_KEYWORD} (${Q})`),e(te).clearText()))}catch(Q){console.error("Failed to parse army list:",Q),e(te)&&e(te).setError(Q.message||"Failed to parse army list")}}function F(w){const{selected:O}=w.detail,B=[];for(const me of O){const se=typeof me.quantity=="string"?parseInt(me.quantity.replace(/x/i,""),10)||1:me.quantity||1,_e="unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);for(let Ye=0;Ye<se;Ye++)B.push({id:"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),baseType:me.baseType,playerId:e(k),x:0,y:0,rotation:0,unitId:_e,unitName:me.unitName,name:me.unitName,imported:!0})}const Q=[...Ie,...B];At(Q,e(k)).forEach(me=>{gt.update(se=>[...se,me])}),e(te)&&(e(te).setSuccess(`Imported ${Q.length} models`),e(te).clearText()),v(xe,[]),Ie=[]}ws(()=>{window.addEventListener("keydown",q)}),Si(()=>{window.removeEventListener("keydown",q)});function q(w){if(w.target.tagName==="INPUT")return;const O=e(H).length>0;if((w.ctrlKey||w.metaKey)&&w.key==="z"&&!w.shiftKey){w.preventDefault(),gt.undo();return}if((w.ctrlKey||w.metaKey)&&(w.key==="y"||w.shiftKey&&w.key==="z")){w.preventDefault(),gt.redo();return}if(w.key==="1"){w.preventDefault(),v(k,1);return}if(w.key==="2"){w.preventDefault(),v(k,2);return}if(w.key==="l"||w.key==="L"){w.preventDefault(),v(fe,!e(fe));return}if(w.key==="m"||w.key==="M"){w.preventDefault(),v(Yt,!e(Yt)),e(Yt)||(v(pt,!1),v(tt,null),v(Tt,null));return}if(w.key==="Delete"||w.key==="Backspace"){if(w.preventDefault(),e(Ze)){v(st,e(st).filter(B=>B.id!==e(Ze))),v(Ze,null);return}e(H).length>0&&(e(H).forEach(B=>{gt.remove(B)}),v(H,[]));return}if(O&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(w.key)){w.preventDefault();const B=w.shiftKey?.1:1;let Q=0,ue=0;switch(w.key){case"ArrowUp":ue=-B;break;case"ArrowDown":ue=B;break;case"ArrowLeft":Q=-B;break;case"ArrowRight":Q=B;break}e(H).forEach(me=>{const se=i().find(_e=>_e.id===me);se&&gt.updateModel(me,{x:se.x+Q,y:se.y+ue},!1)});return}if(w.key==="Escape"){we();return}}function we(w){if(Me){Me=!1;return}v(H,[]),v(Ze,null)}function Ke(){return"line-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Ae(w,O,B,Q){return Math.sqrt((B-w)**2+(Q-O)**2)}function ot(w){if(!e(N))return;w.preventDefault();const O=e(N)(w.clientX,w.clientY);v(pt,!0),v(tt,{x:O.x,y:O.y}),v(Tt,{x:O.x,y:O.y}),window.addEventListener("mousemove",mt),window.addEventListener("mouseup",De)}function mt(w){if(!e(pt)||!e(N))return;const O=e(N)(w.clientX,w.clientY);v(Tt,{x:O.x,y:O.y})}function De(w){if(!e(pt))return;if(Ae(e(tt).x,e(tt).y,e(Tt).x,e(Tt).y)>.5){const B={id:Ke(),x1:e(tt).x,y1:e(tt).y,x2:e(Tt).x,y2:e(Tt).y};v(st,[...e(st),B]),v(Ze,B.id),v(H,[])}v(pt,!1),v(tt,null),v(Tt,null),window.removeEventListener("mousemove",mt),window.removeEventListener("mouseup",De)}function Ve(w,O){O?.stopPropagation(),v(Ze,w),v(H,[])}let Kt=!1,ta={x:0,y:0},Vt=null,La=null;function Ln(w,O){if(!e(Yt)||!e(N))return;O.stopPropagation(),O.preventDefault();const B=e(st).find(se=>se.id===w);if(!B)return;Kt=!0,Vt=w,La=null,v(Ze,w),v(H,[]);const Q=e(N)(O.clientX,O.clientY),ue=(B.x1+B.x2)/2,me=(B.y1+B.y2)/2;ta={x:Q.x-ue,y:Q.y-me},window.addEventListener("mousemove",In),window.addEventListener("mouseup",un)}function Dn(w,O,B){!e(Yt)||!e(N)||(B.stopPropagation(),B.preventDefault(),Kt=!0,Vt=w,La=O,v(Ze,w),v(H,[]),window.addEventListener("mousemove",In),window.addEventListener("mouseup",un))}function In(w){if(!Kt||!e(N)||!Vt)return;const O=e(N)(w.clientX,w.clientY);v(st,e(st).map(B=>{if(B.id!==Vt)return B;if(La===1)return{...B,x1:O.x,y1:O.y};if(La===2)return{...B,x2:O.x,y2:O.y};{const Q=O.x-ta.x,ue=O.y-ta.y,me=(B.x1+B.x2)/2,se=(B.y1+B.y2)/2,_e=Q-me,Ye=ue-se;return{...B,x1:B.x1+_e,y1:B.y1+Ye,x2:B.x2+_e,y2:B.y2+Ye}}}))}function un(){Kt=!1,Vt=null,La=null,window.removeEventListener("mousemove",In),window.removeEventListener("mouseup",un)}function Ma(){v(st,[]),v(Ze,null)}function mn(w){const O=w.target,B=O.closest(".model-base"),Q=O.closest(".measurement-line");if(B||Q||!e(N))return;if(w.preventDefault(),e(Yt)){ot(w);return}const ue=e(N)(w.clientX,w.clientY);v(Z,{x:ue.x,y:ue.y}),v(Se,{x:ue.x,y:ue.y}),v(z,!0),window.addEventListener("mousemove",za),window.addEventListener("mouseup",$n)}function za(w){if(!e(z)||!e(N))return;const O=e(N)(w.clientX,w.clientY);v(Se,{x:O.x,y:O.y});const B=Math.min(e(Z).x,e(Se).x),Q=Math.max(e(Z).x,e(Se).x),ue=Math.min(e(Z).y,e(Se).y),me=Math.max(e(Z).y,e(Se).y),se=new Set;i().forEach(_e=>{_e.x>=B&&_e.x<=Q&&_e.y>=ue&&_e.y<=me&&se.add(_e.id)}),v(ve,se)}function $n(w){if(!e(z))return;const O=Math.min(e(Z).x,e(Se).x),B=Math.max(e(Z).x,e(Se).x),Q=Math.min(e(Z).y,e(Se).y),ue=Math.max(e(Z).y,e(Se).y),me=B-O,se=ue-Q;if(me<.5&&se<.5)v(H,[]);else{const _e=[];i().forEach(Ye=>{Ye.x>=O&&Ye.x<=B&&Ye.y>=Q&&Ye.y<=ue&&_e.push(Ye.id)}),v(H,_e),Me=!0}v(z,!1),v(Z,null),v(Se,null),e(ve).clear(),v(ve,e(ve)),window.removeEventListener("mousemove",za),window.removeEventListener("mouseup",$n)}function $(w,O){if(!e(N))return;U=!0,le={x:O.clientX,y:O.clientY};const B=e(N)(O.clientX,O.clientY);v(I,{baseType:w.type,x:B.x,y:B.y}),window.addEventListener("mousemove",J),window.addEventListener("mouseup",ie)}function J(w){if(!U||!e(I)||!e(N))return;const O=e(N)(w.clientX,w.clientY);v(I,{...e(I),x:O.x,y:O.y})}function ie(w){if(!U||!e(I)){U=!1,v(I,null),le=null,window.removeEventListener("mousemove",J),window.removeEventListener("mouseup",ie);return}const O=w.clientX-le.x,B=w.clientY-le.y,Q=Math.sqrt(O*O+B*B);let ue,me;Q<Ue?(ue=30,me=22):(ue=e(I).x,me=e(I).y);const se=e(I).customWidth&&e(I).customHeight?{width:e(I).customWidth,height:e(I).customHeight}:null,_e=gt.add(e(I).baseType,e(k),ue,me,se);v(H,[_e]),v(I,null),U=!1,le=null,window.removeEventListener("mousemove",J),window.removeEventListener("mouseup",ie)}function Pe(){const B={width:e(ne),height:e(re)},Q=gt.add("rect-custom",e(k),30,22,B);v(H,[Q])}function Ne(w,O){O&&(O.ctrlKey||O.metaKey||O.shiftKey)?e(H).includes(w)?v(H,e(H).filter(B=>B!==w)):v(H,[...e(H),w]):e(H).includes(w)&&e(H).length>1||v(H,[w])}function Ge(w,O,B){if(e(H).length>1&&e(H).includes(w)){yt||(yt=!0,ye={},e(H).forEach(ue=>{const me=i().find(se=>se.id===ue);me&&(ye[ue]={x:me.x,y:me.y})}));const Q=ye[w];if(Q){const ue=O-Q.x,me=B-Q.y;e(H).forEach(se=>{const _e=ye[se];_e&&gt.updateModel(se,{x:_e.x+ue,y:_e.y+me},!0)})}}else gt.updateModel(w,{x:O,y:B},!0)}function Fe(w,O,B,Q,ue){yt?(e(H).forEach(me=>{const se=ye[me],_e=i().find(Ye=>Ye.id===me);se&&_e&&Na.push({type:"move",modelId:me,before:{x:se.x,y:se.y},after:{x:_e.x,y:_e.y}})}),yt=!1,ye=null):Na.push({type:"move",modelId:w,before:{x:O,y:B},after:{x:Q,y:ue}})}function et(w,O){if(e(H).length>1&&e(H).includes(w)){if(!ae){ae=!0;let me=0,se=0,_e=0;const Ye={};e(H).forEach(bt=>{const xt=i().find(je=>je.id===bt);xt&&(me+=xt.x,se+=xt.y,_e++,Ye[bt]={x:xt.x,y:xt.y,rotation:xt.rotation||0})}),qe={x:me/_e,y:se/_e},ye=Ye}const B=i().find(me=>me.id===w),Q=ye[w];if(!B||!Q)return;const ue=O-Q.rotation;e(H).forEach(me=>{const se=ye[me];if(se){const _e=se.x-qe.x,Ye=se.y-qe.y,bt=ue*Math.PI/180,xt=Math.cos(bt),je=Math.sin(bt),lt=_e*xt-Ye*je,at=_e*je+Ye*xt;gt.updateModel(me,{x:qe.x+lt,y:qe.y+at,rotation:se.rotation+ue},!0)}})}else gt.updateModel(w,{rotation:O},!0)}function _t(w,O,B){ae?(e(H).forEach(Q=>{const ue=ye[Q],me=i().find(se=>se.id===Q);ue&&me&&Na.push({type:"rotate",modelId:Q,before:{x:ue.x,y:ue.y,rotation:ue.rotation},after:{x:me.x,y:me.y,rotation:me.rotation||0}})}),ae=!1,qe=null,ye=null):Na.push({type:"rotate",modelId:w,before:{rotation:O},after:{rotation:B}})}function aa(w,O){gt.updateModel(w,{name:O})}function Ct(w){if(!e(N)||e(u).length<2)return;w.preventDefault(),w.stopPropagation(),ae=!0,zt={},e(u).forEach(B=>{zt[B.id]={x:B.x,y:B.y,rotation:B.rotation||0}});const O=e(N)(w.clientX,w.clientY);ke=Math.atan2(O.y-e(g).y,O.x-e(g).x)*180/Math.PI,window.addEventListener("mousemove",Ft),window.addEventListener("mouseup",na)}function Ft(w){if(!ae||!e(N)||!e(g))return;const O=e(N)(w.clientX,w.clientY);let Q=Math.atan2(O.y-e(g).y,O.x-e(g).x)*180/Math.PI-ke;w.shiftKey||(Q=Math.round(Q/15)*15),v(sa,-45+Q);const ue=Q*Math.PI/180,me=Math.cos(ue),se=Math.sin(ue);e(u).forEach(_e=>{const Ye=zt[_e.id];if(Ye){const bt=Ye.x-e(g).x,xt=Ye.y-e(g).y,je=bt*me-xt*se,lt=bt*se+xt*me;gt.updateModel(_e.id,{x:e(g).x+je,y:e(g).y+lt,rotation:Ye.rotation+Q},!0)}})}function na(){ae&&zt&&e(u).forEach(w=>{const O=zt[w.id];O&&Na.push({type:"rotate",modelId:w.id,before:{x:O.x,y:O.y,rotation:O.rotation},after:{x:w.x,y:w.y,rotation:w.rotation||0}})}),ae=!1,zt=null,v(sa,-45),window.removeEventListener("mousemove",Ft),window.removeEventListener("mouseup",na)}function ca(){e(H).length>0&&(e(H).forEach(w=>{gt.remove(w)}),v(H,[]))}function wa(){confirm("Clear all models?")&&(gt.clear(),v(H,[]))}function ya(w){if(bn(w.baseType))return{x:w.x,y:w.y,width:w.customWidth,height:w.customHeight,rotation:w.rotation||0,isRectangle:!0};const O=Oa(w.baseType,w);return Aa(w.baseType)?{x:w.x,y:w.y,rx:O.width/2,ry:O.height/2,rotation:w.rotation||0}:{x:w.x,y:w.y,radius:O.radius}}let sa=P(-45);pe(()=>(e(H),i()),()=>{v(u,e(H).map(w=>i().find(O=>O.id===w)).filter(Boolean))}),pe(()=>e(u),()=>{v(p,e(u).length===1?e(u)[0]:null)}),pe(()=>e(u),()=>{v(g,e(u).length>1?(()=>{let w=0,O=0;return e(u).forEach(B=>{w+=B.x,O+=B.y}),{x:w/e(u).length,y:O/e(u).length}})():null)}),pe(()=>(e(u),e(g),Aa),()=>{v(_,e(u).length>1?(()=>{let w=0;return e(u).forEach(O=>{const B=Math.sqrt(Math.pow(O.x-e(g).x,2)+Math.pow(O.y-e(g).y,2)),Q=Oa(O.baseType,O),ue=bn(O.baseType)?Math.max(O.customWidth,O.customHeight)/2:Aa(O.baseType)?Math.max(Q.width,Q.height)/2:Q.radius;w=Math.max(w,B+ue)}),w+2})():0)}),pe(()=>(e(g),e(_),e(sa)),()=>{v(x,e(g)?e(g).x+e(_)*Math.cos(e(sa)*Math.PI/180):0)}),pe(()=>(e(g),e(_),e(sa)),()=>{v(E,e(g)?e(g).y+e(_)*Math.sin(e(sa)*Math.PI/180):0)}),pe(()=>(e(Ze),e(st)),()=>{v(R,e(Ze)?e(st).find(w=>w.id===e(Ze)):null)}),pe(()=>e(u),()=>{v(L,[...new Set(e(u).map(w=>w.playerId))])}),pe(()=>(e(u),i(),e(L)),()=>{v(S,e(u).length>0?i().filter(w=>!e(L).includes(w.playerId)):[])}),pe(()=>(o(),xs),()=>{v(A,o().terrains.map(w=>({id:w.id,vertices:xs(w)})))}),pe(()=>(o(),Gn),()=>{v(M,o().walls.map(w=>vr(Gn(w.shape,w.segments),w.x,w.y,w.rotation)))}),pe(()=>(e(u),e(fe),e(S),e(A),e(M)),()=>{v(D,e(u).length>0&&e(fe)&&e(S).length>0?e(u).flatMap(w=>e(S).map(O=>{const B=Ai(ya(O),ya(w),e(A),e(M));return{sourceId:O.id,source:O,targetId:w.id,target:w,canSee:B.canSee,firstClearRay:B.firstClearRay,rays:B.rays}})):[])}),Rn(),en();var Xa=lh(),pa=Te(Xa),It=T(pa),ua=T(It),ba=T(ua);fa(ba,{title:"Selected Model",children:(w,O)=>{var B=ft(),Q=Te(B);{var ue=se=>{var _e=Sd(),Ye=T(_e),bt=b(T(Ye),2),xt=T(bt),je=b(Ye,2),lt=T(je),at=T(lt),ia=b(je,2);{var xa=Lt=>{var Gt=wd(),Da=Te(Gt),an=T(Da),xn=T(an),Pn=b(Da,2);{var dn=Va=>{var os=_d(),Xs=b(T(os),2),Be=T(Xs);K(X=>Le(Be,`${X??""}/${e(D),l(()=>e(D).length)??""} rays visible`),[()=>(e(D),l(()=>e(D).filter(X=>X.canSee).length))]),C(Va,os)};ee(Pn,Va=>{e(D),l(()=>e(D).length>0)&&Va(dn)})}_a(xn,()=>e(Ce),Va=>v(Ce,Va)),C(Lt,Gt)};ee(ia,Lt=>{e(fe)&&Lt(xa)})}var Bt=b(ia,2),ht=T(Bt);K(()=>{Le(xt,`${e(H),l(()=>e(H).length)??""} models`),Le(ht,`Remove All (${e(H),l(()=>e(H).length)??""})`)}),_a(at,()=>e(fe),Lt=>v(fe,Lt)),V("click",Bt,ca),C(se,_e)},me=se=>{var _e=ft(),Ye=Te(_e);{var bt=je=>{var lt=Ed(),at=T(lt),ia=b(T(at),2),xa=b(at,2),Bt=b(T(xa),2),ht=T(Bt),Lt=b(xa,2),Gt=b(T(Lt),2),Da=T(Gt),an=b(Lt,2),xn=b(T(an),2),Pn=T(xn),dn=b(an,2);{var Va=ct=>{var qt=Ad(),nt=b(T(qt),2),ut=T(nt);K(Mt=>Le(ut,`${Mt??""}Â°`),[()=>(e(p),l(()=>Math.round(e(p).rotation||0)))]),C(ct,qt)};ee(dn,ct=>{j(Aa),e(p),l(()=>Aa(e(p).baseType))&&ct(Va)})}var os=b(dn,2),Xs=T(os),Be=T(Xs),X=b(os,2);{var Ot=ct=>{var qt=Cd(),nt=T(qt),ut=T(nt);_a(ut,()=>e(Ce),Mt=>v(Ce,Mt)),C(ct,qt)};ee(X,ct=>{e(fe)&&ct(Ot)})}var Rt=b(X,2);{var Y=ct=>{var qt=kd(),nt=b(T(qt),2),ut=T(nt);K(Mt=>Le(ut,`${Mt??""}/${e(D),l(()=>e(D).length)??""} visible`),[()=>(e(D),l(()=>e(D).filter(Mt=>Mt.canSee).length))]),C(ct,qt)};ee(Rt,ct=>{e(fe),e(D),l(()=>e(fe)&&e(D).length>0)&&ct(Y)})}var Ee=b(Rt,2);K((ct,qt,nt)=>{zo(ia,(e(p),l(()=>e(p).name||""))),Le(ht,ct),Le(Da,`Player ${e(p),l(()=>e(p).playerId)??""}`),Le(Pn,`${qt??""}", ${nt??""}"`)},[()=>(j(Oa),e(p),l(()=>Oa(e(p).baseType,e(p))?.label||"Unknown")),()=>(e(p),l(()=>e(p).x.toFixed(1))),()=>(e(p),l(()=>e(p).y.toFixed(1)))]),V("change",ia,ct=>aa(e(p).id,ct.target.value)),_a(Be,()=>e(fe),ct=>v(fe,ct)),V("click",Ee,ca),C(je,lt)},xt=je=>{var lt=Md();C(je,lt)};ee(Ye,je=>{e(p)?je(bt):je(xt,!1)},!0)}C(se,_e)};ee(Q,se=>{e(H),l(()=>e(H).length>1)?se(ue):se(me,!1)})}C(w,B)},$$slots:{default:!0}});var Ta=b(ba,2);fa(Ta,{title:"Measure Tool",children:(w,O)=>{var B=Id(),Q=T(B),ue=T(Q),me=T(ue),se=b(Q,2);{var _e=Gt=>{var Da=Rd();C(Gt,Da)};ee(se,Gt=>{e(Yt)&&Gt(_e)})}var Ye=b(se,2);{var bt=Gt=>{var Da=Ld(),an=Te(Da),xn=b(T(an),2),Pn=T(xn),dn=b(an,2);K(Va=>Le(Pn,`${Va??""}"`),[()=>(e(R),l(()=>Ae(e(R).x1,e(R).y1,e(R).x2,e(R).y2).toFixed(2)))]),V("click",dn,()=>{v(st,e(st).filter(Va=>Va.id!==e(Ze))),v(Ze,null)}),C(Gt,Da)};ee(Ye,Gt=>{e(R)&&Gt(bt)})}var xt=b(Ye,2);{var je=Gt=>{var Da=Dd(),an=Te(Da),xn=b(T(an),2),Pn=T(xn),dn=b(an,2);K(()=>Le(Pn,`${e(st),l(()=>e(st).length)??""} line${e(st),l(()=>e(st).length!==1?"s":"")??""}`)),V("click",dn,Ma),C(Gt,Da)};ee(xt,Gt=>{e(st),l(()=>e(st).length>0)&&Gt(je)})}var lt=b(xt,2),at=b(T(lt),2),ia=T(at),xa=b(at,2),Bt=T(xa),ht=b(xa,2),Lt=T(ht);_a(me,()=>e(Yt),Gt=>v(Yt,Gt)),_a(ia,()=>e(la),Gt=>v(la,Gt)),_a(Bt,()=>e(oe),Gt=>v(oe,Gt)),_a(Lt,()=>e(Re),Gt=>v(Re,Gt)),C(w,B)},$$slots:{default:!0}});var tn=b(Ta,2);fa(tn,{title:"Actions",children:(w,O)=>{var B=$d(),Q=T(B),ue=T(Q),me=b(ue,2),se=b(Q,2),_e=T(se),Ye=b(_e,2),bt=b(se,2);$r(bt,xa=>v(Zt,xa),()=>e(Zt));var xt=b(bt,2),je=b(xt,2),lt=b(je,2),at=b(lt,2),ia=b(at,2);K(()=>{ue.disabled=(c(),l(()=>!c().past.length)),me.disabled=(c(),l(()=>!c().future.length))}),V("click",ue,()=>gt.undo()),V("click",me,()=>gt.redo()),V("click",_e,Ya),V("click",Ye,Oe),V("change",bt,Je),V("click",xt,Ha),V("click",je,Et),V("click",lt,Ht),V("click",at,wa),V("click",ia,Xt),C(w,B)},$$slots:{default:!0}});var We=b(tn,2);fa(We,{title:"Import Army List",startOpen:!1,children:(w,O)=>{$r(Ym(w,{get currentPlayer(){return e(k)},$$events:{parse:Qt},$$legacy:!0}),B=>v(te,B),()=>e(te))},$$slots:{default:!0}});var G=b(We,2);fa(G,{title:"Add Models",children:(w,O)=>{var B=Pd(),Q=Te(B),ue=T(Q);let me;var se=b(ue,2);let _e;var Ye=b(Q,2),bt=T(Ye),xt=b(T(bt),2);He(xt,5,()=>(j(Qa),l(()=>Qa.circles)),it,(at,ia)=>{Wr(at,{get baseSize(){return e(ia)},get playerId(){return e(k)},onDragStart:$})});var je=b(bt,2),lt=b(T(je),2);He(lt,5,()=>(j(Qa),l(()=>Qa.ovals)),it,(at,ia)=>{Wr(at,{get baseSize(){return e(ia)},get playerId(){return e(k)},onDragStart:$})}),K(()=>{me=Ca(ue,1,"toggle-btn svelte-1g40uyy",null,me,{active:e(k)===1}),_e=Ca(se,1,"toggle-btn svelte-1g40uyy",null,_e,{active:e(k)===2})}),V("click",ue,()=>v(k,1)),V("click",se,()=>v(k,2)),C(w,B)},$$slots:{default:!0}});var wt=b(G,2);fa(wt,{title:"Add Hull (Vehicle)",children:(w,O)=>{var B=Nd(),Q=T(B),ue=b(T(Q),2),me=b(Q,2),se=b(T(me),2),_e=b(me,2),Ye=T(_e);K(()=>Le(Ye,`Add ${e(ne)??""}" Ã ${e(re)??""}" Hull`)),Ia(ue,()=>e(ne),bt=>v(ne,bt)),Ia(se,()=>e(re),bt=>v(re,bt)),V("click",_e,Pe),C(w,B)},$$slots:{default:!0}});var St=b(ua,2),W=T(St),be=T(W),jt=T(be);pr(jt,{children:Hr,$$slots:{default:(w,O)=>{const B=$e(()=>O.screenToSvg);var Q=oh(),ue=Te(Q);{var me=Be=>{var X=_i();K(()=>Le(X,(e(N),j(e(B)),l(()=>(v(N,e(B)),""))))),C(Be,X)};ee(ue,Be=>{e(B)&&!e(N)&&Be(me)})}var se=b(ue);{var _e=Be=>{var X=Yd(),Ot=Te(X);He(Ot,1,()=>(n(),l(()=>n().zones)),it,(Y,Ee)=>{var ct=Od();K(qt=>{h(ct,"d",qt),h(ct,"fill",(e(Ee),l(()=>e(Ee).color))),h(ct,"stroke",(e(Ee),l(()=>e(Ee).borderColor)))},[()=>(j(Fs),e(Ee),l(()=>Fs(e(Ee).path)))]),C(Y,ct)});var Rt=b(Ot);He(Rt,1,()=>(n(),l(()=>n().objectives)),it,(Y,Ee)=>{const ct=$e(()=>(e(Ee),l(()=>e(Ee).isPrimary?"#fbbf24":"#9ca3af"))),qt=$e(()=>(e(Ee),l(()=>e(Ee).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var nt=Wd(),ut=Te(nt),Mt=b(ut),nn=b(Mt);K(()=>{h(ut,"cx",(e(Ee),l(()=>e(Ee).x))),h(ut,"cy",(e(Ee),l(()=>e(Ee).y))),h(ut,"r",Gr),h(ut,"fill",e(qt)),h(ut,"stroke",e(ct)),h(Mt,"cx",(e(Ee),l(()=>e(Ee).x))),h(Mt,"cy",(e(Ee),l(()=>e(Ee).y))),h(Mt,"r",Kr),h(Mt,"fill",e(ct)),h(nn,"cx",(e(Ee),l(()=>e(Ee).x))),h(nn,"cy",(e(Ee),l(()=>e(Ee).y)))}),C(Y,nt)}),C(Be,X)};ee(se,Be=>{n()&&Be(_e)})}var Ye=b(se);ee(Ye,Be=>{});var bt=b(Ye);ee(bt,Be=>{});var xt=b(bt);He(xt,1,()=>(o(),l(()=>o().terrains)),it,(Be,X)=>{var Ot=Hd(),Rt=T(Ot);K(()=>{h(Ot,"transform",`rotate(${e(X),l(()=>e(X).rotation)??""}, ${e(X),l(()=>e(X).x+e(X).width/2)??""}, ${e(X),l(()=>e(X).y+e(X).height/2)??""})`),h(Rt,"x",(e(X),l(()=>e(X).x))),h(Rt,"y",(e(X),l(()=>e(X).y))),h(Rt,"width",(e(X),l(()=>e(X).width))),h(Rt,"height",(e(X),l(()=>e(X).height)))}),C(Be,Ot)});var je=b(xt);He(je,1,()=>(o(),l(()=>o().walls)),it,(Be,X)=>{var Ot=Fd(),Rt=T(Ot);Ur(Rt,{get id(){return e(X),l(()=>e(X).id)},get x(){return e(X),l(()=>e(X).x)},get y(){return e(X),l(()=>e(X).y)},get shape(){return e(X),l(()=>e(X).shape)},get segments(){return e(X),l(()=>e(X).segments)},get rotation(){return e(X),l(()=>e(X).rotation)},selected:!1,get screenToSvg(){return e(B)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),C(Be,Ot)});var lt=b(je);{var at=Be=>{var X=ft(),Ot=Te(X);He(Ot,1,i,Rt=>Rt.id,(Rt,Y)=>{const Ee=$e(()=>(j(Oa),e(Y),l(()=>Oa(e(Y).baseType,e(Y))))),ct=$e(()=>(j(Aa),e(Y),l(()=>Aa(e(Y).baseType)))),qt=$e(()=>(j(bn),e(Y),l(()=>bn(e(Y).baseType)))),nt=$e(()=>(e(Y),l(()=>e(Y).playerId===1?"rgba(59, 130, 246, 0.15)":"rgba(239, 68, 68, 0.15)"))),ut=$e(()=>(e(Y),l(()=>e(Y).playerId===1?"#3b82f6":"#ef4444")));var Mt=Zd(),nn=Te(Mt);{var As=Ra=>{var sn=ft(),Vs=Te(sn);{var js=ma=>{var da=Bd(),Jt=T(da);K(()=>{h(da,"transform",`rotate(${e(Y),l(()=>e(Y).rotation||0)??""}, ${e(Y),l(()=>e(Y).x)??""}, ${e(Y),l(()=>e(Y).y)??""})`),h(Jt,"x",(e(Y),l(()=>e(Y).x-e(Y).customWidth/2-12))),h(Jt,"y",(e(Y),l(()=>e(Y).y-e(Y).customHeight/2-12))),h(Jt,"width",(e(Y),l(()=>e(Y).customWidth+24))),h(Jt,"height",(e(Y),l(()=>e(Y).customHeight+24))),h(Jt,"fill",e(nt)),h(Jt,"stroke",e(ut))}),C(ma,da)},Zs=ma=>{var da=ft(),Jt=Te(da);{var Qs=ha=>{var $t=qd(),va=T($t);K(()=>{h($t,"transform",`rotate(${e(Y),l(()=>e(Y).rotation||0)??""}, ${e(Y),l(()=>e(Y).x)??""}, ${e(Y),l(()=>e(Y).y)??""})`),h(va,"cx",(e(Y),l(()=>e(Y).x))),h(va,"cy",(e(Y),l(()=>e(Y).y))),h(va,"rx",(j(e(Ee)),l(()=>e(Ee).width/2+12))),h(va,"ry",(j(e(Ee)),l(()=>e(Ee).height/2+12))),h(va,"fill",e(nt)),h(va,"stroke",e(ut))}),C(ha,$t)},Js=ha=>{var $t=Ud();K(()=>{h($t,"cx",(e(Y),l(()=>e(Y).x))),h($t,"cy",(e(Y),l(()=>e(Y).y))),h($t,"r",(j(e(Ee)),l(()=>e(Ee).radius+12))),h($t,"fill",e(nt)),h($t,"stroke",e(ut))}),C(ha,$t)};ee(Jt,ha=>{e(ct)?ha(Qs):ha(Js,!1)},!0)}C(ma,da)};ee(Vs,ma=>{e(qt)?ma(js):ma(Zs,!1)})}C(Ra,sn)};ee(nn,Ra=>{e(Re)&&Ra(As)})}var Cs=b(nn);{var Fa=Ra=>{var sn=ft(),Vs=Te(sn);{var js=ma=>{var da=Kd(),Jt=T(da);K(()=>{h(da,"transform",`rotate(${e(Y),l(()=>e(Y).rotation||0)??""}, ${e(Y),l(()=>e(Y).x)??""}, ${e(Y),l(()=>e(Y).y)??""})`),h(Jt,"x",(e(Y),l(()=>e(Y).x-e(Y).customWidth/2-9))),h(Jt,"y",(e(Y),l(()=>e(Y).y-e(Y).customHeight/2-9))),h(Jt,"width",(e(Y),l(()=>e(Y).customWidth+18))),h(Jt,"height",(e(Y),l(()=>e(Y).customHeight+18))),h(Jt,"fill",e(nt)),h(Jt,"stroke",e(ut))}),C(ma,da)},Zs=ma=>{var da=ft(),Jt=Te(da);{var Qs=ha=>{var $t=Gd(),va=T($t);K(()=>{h($t,"transform",`rotate(${e(Y),l(()=>e(Y).rotation||0)??""}, ${e(Y),l(()=>e(Y).x)??""}, ${e(Y),l(()=>e(Y).y)??""})`),h(va,"cx",(e(Y),l(()=>e(Y).x))),h(va,"cy",(e(Y),l(()=>e(Y).y))),h(va,"rx",(j(e(Ee)),l(()=>e(Ee).width/2+9))),h(va,"ry",(j(e(Ee)),l(()=>e(Ee).height/2+9))),h(va,"fill",e(nt)),h(va,"stroke",e(ut))}),C(ha,$t)},Js=ha=>{var $t=zd();K(()=>{h($t,"cx",(e(Y),l(()=>e(Y).x))),h($t,"cy",(e(Y),l(()=>e(Y).y))),h($t,"r",(j(e(Ee)),l(()=>e(Ee).radius+9))),h($t,"fill",e(nt)),h($t,"stroke",e(ut))}),C(ha,$t)};ee(Jt,ha=>{e(ct)?ha(Qs):ha(Js,!1)},!0)}C(ma,da)};ee(Vs,ma=>{e(qt)?ma(js):ma(Zs,!1)})}C(Ra,sn)};ee(Cs,Ra=>{e(oe)&&Ra(Fa)})}var gr=b(Cs);{var ls=Ra=>{var sn=ft(),Vs=Te(sn);{var js=ma=>{var da=Xd(),Jt=T(da);K(()=>{h(da,"transform",`rotate(${e(Y),l(()=>e(Y).rotation||0)??""}, ${e(Y),l(()=>e(Y).x)??""}, ${e(Y),l(()=>e(Y).y)??""})`),h(Jt,"x",(e(Y),l(()=>e(Y).x-e(Y).customWidth/2-6))),h(Jt,"y",(e(Y),l(()=>e(Y).y-e(Y).customHeight/2-6))),h(Jt,"width",(e(Y),l(()=>e(Y).customWidth+12))),h(Jt,"height",(e(Y),l(()=>e(Y).customHeight+12))),h(Jt,"stroke",e(ut))}),C(ma,da)},Zs=ma=>{var da=ft(),Jt=Te(da);{var Qs=ha=>{var $t=Vd(),va=T($t);K(()=>{h($t,"transform",`rotate(${e(Y),l(()=>e(Y).rotation||0)??""}, ${e(Y),l(()=>e(Y).x)??""}, ${e(Y),l(()=>e(Y).y)??""})`),h(va,"cx",(e(Y),l(()=>e(Y).x))),h(va,"cy",(e(Y),l(()=>e(Y).y))),h(va,"rx",(j(e(Ee)),l(()=>e(Ee).width/2+6))),h(va,"ry",(j(e(Ee)),l(()=>e(Ee).height/2+6))),h(va,"stroke",e(ut))}),C(ha,$t)},Js=ha=>{var $t=jd();K(()=>{h($t,"cx",(e(Y),l(()=>e(Y).x))),h($t,"cy",(e(Y),l(()=>e(Y).y))),h($t,"r",(j(e(Ee)),l(()=>e(Ee).radius+6))),h($t,"stroke",e(ut))}),C(ha,$t)};ee(Jt,ha=>{e(ct)?ha(Qs):ha(Js,!1)},!0)}C(ma,da)};ee(Vs,ma=>{e(qt)?ma(js):ma(Zs,!1)})}C(Ra,sn)};ee(gr,Ra=>{e(la)&&Ra(ls)})}C(Rt,Mt)}),C(Be,X)};ee(lt,Be=>{(e(la)||e(oe)||e(Re))&&Be(at)})}var ia=b(lt);He(ia,1,i,Be=>Be.id,(Be,X)=>{{let Ot=$e(()=>(e(X),l(()=>e(X).name||""))),Rt=$e(()=>(e(H),e(X),l(()=>e(H).includes(e(X).id)))),Y=$e(()=>(e(H),e(X),l(()=>e(H).length>1&&e(H).includes(e(X).id)))),Ee=$e(()=>(e(H),e(X),e(ve),l(()=>!e(H).includes(e(X).id)&&e(ve).has(e(X).id))));ur(Be,{get id(){return e(X),l(()=>e(X).id)},get x(){return e(X),l(()=>e(X).x)},get y(){return e(X),l(()=>e(X).y)},get baseType(){return e(X),l(()=>e(X).baseType)},get playerId(){return e(X),l(()=>e(X).playerId)},get rotation(){return e(X),l(()=>e(X).rotation)},get name(){return e(Ot)},get customWidth(){return e(X),l(()=>e(X).customWidth)},get customHeight(){return e(X),l(()=>e(X).customHeight)},get selected(){return e(Rt)},get inGroupSelection(){return e(Y)},get marqueePreview(){return e(Ee)},get screenToSvg(){return e(B)},onSelect:Ne,onDrag:Ge,onDragEnd:Fe,onRotate:et,onRotateEnd:_t,onRename:aa})}});var xa=b(ia);{var Bt=Be=>{ur(Be,{id:"phantom",get x(){return e(I),l(()=>e(I).x)},get y(){return e(I),l(()=>e(I).y)},get baseType(){return e(I),l(()=>e(I).baseType)},get playerId(){return e(k)},rotation:0,get customWidth(){return e(I),l(()=>e(I).customWidth)},get customHeight(){return e(I),l(()=>e(I).customHeight)},selected:!1,get screenToSvg(){return e(B)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};ee(xa,Be=>{e(I)&&Be(Bt)})}var ht=b(xa);{var Lt=Be=>{var X=Qd(),Ot=Te(X),Rt=b(Ot),Y=b(Rt),Ee=b(Y);K(()=>{h(Ot,"cx",(e(g),l(()=>e(g).x))),h(Ot,"cy",(e(g),l(()=>e(g).y))),h(Rt,"x1",(e(g),l(()=>e(g).x))),h(Rt,"y1",(e(g),l(()=>e(g).y))),h(Rt,"x2",e(x)),h(Rt,"y2",e(E)),h(Y,"cx",e(x)),h(Y,"cy",e(E)),h(Ee,"transform",`translate(${e(x)??""}, ${e(E)??""})`)}),V("mousedown",Y,Ct),C(Be,X)};ee(ht,Be=>{e(g),e(u),l(()=>e(g)&&e(u).length>1)&&Be(Lt)})}var Gt=b(ht);He(Gt,1,()=>e(st),Be=>Be.id,(Be,X)=>{const Ot=$e(()=>(e(X),l(()=>Ae(e(X).x1,e(X).y1,e(X).x2,e(X).y2)))),Rt=$e(()=>(e(X),l(()=>(e(X).x1+e(X).x2)/2))),Y=$e(()=>(e(X),l(()=>(e(X).y1+e(X).y2)/2))),Ee=$e(()=>(e(X),e(Ze),l(()=>e(X).id===e(Ze))));var ct=eh();let qt;var nt=T(ct),ut=b(nt);{var Mt=Fa=>{var gr=Jd(),ls=Te(gr),Ra=b(ls);K(()=>{h(ls,"cx",(e(X),l(()=>e(X).x1))),h(ls,"cy",(e(X),l(()=>e(X).y1))),h(ls,"fill",e(Ee)?"#3b82f6":"#f59e0b"),h(Ra,"cx",(e(X),l(()=>e(X).x2))),h(Ra,"cy",(e(X),l(()=>e(X).y2))),h(Ra,"fill",e(Ee)?"#3b82f6":"#f59e0b")}),V("mousedown",ls,sn=>Dn(e(X).id,1,sn)),V("mousedown",Ra,sn=>Dn(e(X).id,2,sn)),C(Fa,gr)};ee(ut,Fa=>{e(Yt)&&Fa(Mt)})}var nn=b(ut),As=b(T(nn)),Cs=T(As);K(Fa=>{qt=Ca(ct,0,"measurement-line",null,qt,{selected:e(Ee),"tool-active":e(Yt)}),h(nt,"x1",(e(X),l(()=>e(X).x1))),h(nt,"y1",(e(X),l(()=>e(X).y1))),h(nt,"x2",(e(X),l(()=>e(X).x2))),h(nt,"y2",(e(X),l(()=>e(X).y2))),h(nt,"stroke",e(Ee)&&e(Yt)?"#3b82f6":"#f59e0b"),h(nt,"stroke-width",e(Ee)&&e(Yt)?.2:.15),h(nt,"role",e(Yt)?"button":"presentation"),h(nt,"tabindex",e(Yt)?0:-1),h(nn,"transform",`translate(${e(Rt)??""}, ${e(Y)??""})`),h(As,"fill",e(Ee)&&e(Yt)?"#3b82f6":"#f59e0b"),Le(Cs,`${Fa??""}"`)},[()=>(j(e(Ot)),l(()=>e(Ot).toFixed(1)))]),V("click",nt,Fa=>e(Yt)&&Ve(e(X).id,Fa)),V("mousedown",nt,Fa=>e(Yt)?Ln(e(X).id,Fa):Fa.stopPropagation()),C(Be,ct)});var Da=b(Gt);{var an=Be=>{const X=$e(()=>(e(tt),e(Tt),l(()=>Ae(e(tt).x,e(tt).y,e(Tt).x,e(Tt).y)))),Ot=$e(()=>(e(tt),e(Tt),l(()=>(e(tt).x+e(Tt).x)/2))),Rt=$e(()=>(e(tt),e(Tt),l(()=>(e(tt).y+e(Tt).y)/2)));var Y=ah(),Ee=T(Y),ct=b(Ee),qt=b(ct),nt=b(qt);{var ut=Mt=>{var nn=th(),As=b(T(nn)),Cs=T(As);K(Fa=>{h(nn,"transform",`translate(${e(Ot)??""}, ${e(Rt)??""})`),Le(Cs,`${Fa??""}"`)},[()=>(j(e(X)),l(()=>e(X).toFixed(1)))]),C(Mt,nn)};ee(nt,Mt=>{e(X)>.5&&Mt(ut)})}K(()=>{h(Ee,"x1",(e(tt),l(()=>e(tt).x))),h(Ee,"y1",(e(tt),l(()=>e(tt).y))),h(Ee,"x2",(e(Tt),l(()=>e(Tt).x))),h(Ee,"y2",(e(Tt),l(()=>e(Tt).y))),h(ct,"cx",(e(tt),l(()=>e(tt).x))),h(ct,"cy",(e(tt),l(()=>e(tt).y))),h(qt,"cx",(e(Tt),l(()=>e(Tt).x))),h(qt,"cy",(e(Tt),l(()=>e(Tt).y)))}),C(Be,Y)};ee(Da,Be=>{e(pt)&&e(tt)&&e(Tt)&&Be(an)})}var xn=b(Da);{var Pn=Be=>{var X=ft(),Ot=Te(X);He(Ot,1,()=>e(D),it,(Rt,Y)=>{var Ee=ft(),ct=Te(Ee);He(ct,1,()=>(e(Y),l(()=>e(Y).rays)),it,(qt,nt)=>{var ut=nh();K(()=>{h(ut,"x1",(e(nt),l(()=>e(nt).from.x))),h(ut,"y1",(e(nt),l(()=>e(nt).from.y))),h(ut,"x2",(e(nt),l(()=>e(nt).to.x))),h(ut,"y2",(e(nt),l(()=>e(nt).to.y))),h(ut,"stroke",(e(nt),l(()=>e(nt).blocked?"#ff000033":"#00ff0033")))}),C(qt,ut)}),C(Rt,Ee)}),C(Be,X)};ee(xn,Be=>{e(Ce),e(fe),e(u),e(D),l(()=>e(Ce)&&e(fe)&&e(u).length>0&&e(D).length>0)&&Be(Pn)})}var dn=b(xn);{var Va=Be=>{var X=ft(),Ot=Te(X);He(Ot,1,()=>e(D),it,(Rt,Y)=>{var Ee=ft(),ct=Te(Ee);{var qt=ut=>{var Mt=sh();K(()=>{h(Mt,"x1",(e(Y),l(()=>e(Y).firstClearRay.from.x))),h(Mt,"y1",(e(Y),l(()=>e(Y).firstClearRay.from.y))),h(Mt,"x2",(e(Y),l(()=>e(Y).firstClearRay.to.x))),h(Mt,"y2",(e(Y),l(()=>e(Y).firstClearRay.to.y)))}),C(ut,Mt)},nt=ut=>{var Mt=rh();K(()=>{h(Mt,"x1",(e(Y),l(()=>e(Y).source.x))),h(Mt,"y1",(e(Y),l(()=>e(Y).source.y))),h(Mt,"x2",(e(Y),l(()=>e(Y).target.x))),h(Mt,"y2",(e(Y),l(()=>e(Y).target.y)))}),C(ut,Mt)};ee(ct,ut=>{e(Y),l(()=>e(Y).firstClearRay)?ut(qt):ut(nt,!1)})}C(Rt,Ee)}),C(Be,X)};ee(dn,Be=>{e(fe),e(u),e(D),l(()=>e(fe)&&e(u).length>0&&e(D).length>0)&&Be(Va)})}var os=b(dn);{var Xs=Be=>{const X=$e(()=>(e(Z),e(Se),l(()=>Math.min(e(Z).x,e(Se).x)))),Ot=$e(()=>(e(Z),e(Se),l(()=>Math.min(e(Z).y,e(Se).y)))),Rt=$e(()=>(e(Se),e(Z),l(()=>Math.abs(e(Se).x-e(Z).x)))),Y=$e(()=>(e(Se),e(Z),l(()=>Math.abs(e(Se).y-e(Z).y))));var Ee=ih();K(()=>{h(Ee,"x",e(X)),h(Ee,"y",e(Ot)),h(Ee,"width",e(Rt)),h(Ee,"height",e(Y))}),C(Be,Ee)};ee(os,Be=>{e(z)&&e(Z)&&e(Se)&&Be(Xs)})}C(w,Q)}}});var ra=b(be,2),dt=T(ra),vt=T(dt),Qe=b(pa,2);qm(Qe,{get unmatchedUnits(){return e(xe)},get show(){return e(ce)},set show(w){v(ce,w)},$$events:{import:F,close:()=>{v(ce,!1)}},$$legacy:!0}),K(()=>Le(vt,`Battlefield: 60" x 44" | ${m(),l(()=>m().length)??""} P1 models | ${f(),l(()=>f().length)??""} P2 models`)),V("mousedown",be,mn),C(t,Xa),Ga(),y()}var uh=ge('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">LoS Status</span> <span class="value svelte-hpuhtb"> </span></div>'),mh=ge('<div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Debug Rays</label></div> <!>',1),dh=ge('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Selected</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Line of Sight</label></div> <!> <button class="danger svelte-hpuhtb"> </button></div>'),hh=ge('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Rotation</span> <span class="value svelte-hpuhtb"> </span></div>'),fh=ge('<div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Debug Rays</label></div>'),yh=ge('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">LoS Status</span> <span class="value svelte-hpuhtb"> </span></div>'),ph=ge('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Base Type</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Player</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Position</span> <span class="value svelte-hpuhtb"> </span></div> <!> <div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-hpuhtb">Remove</button></div>'),vh=ge('<p class="hint svelte-hpuhtb">Click a model to select it</p>'),gh=ge('<p class="hint svelte-hpuhtb">Click and drag on battlefield to draw a measurement line</p>'),bh=ge('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Length</span> <span class="value svelte-hpuhtb"> </span></div> <button class="danger svelte-hpuhtb">Remove Line</button>',1),Th=ge('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Lines</span> <span class="value svelte-hpuhtb"> </span></div> <button class="secondary svelte-hpuhtb">Clear All Lines</button>',1),xh=ge('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Line Tool Active (M)</label></div> <!> <!> <!> <div class="field svelte-hpuhtb" style="margin-top: 0.5rem; border-top: 1px solid #333; padding-top: 0.5rem;"><span class="label-text svelte-hpuhtb">Range Zones</span> <label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show 6" zones</label> <label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show 9" zones</label> <label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show 12" zones</label></div></div>'),_h=ge('<div class="button-group vertical svelte-hpuhtb"><div class="button-row svelte-hpuhtb"><button title="Undo (Ctrl+Z)" class="svelte-hpuhtb">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-hpuhtb">Redo</button></div> <button title="Export battlefield as PNG image" class="svelte-hpuhtb">Export PNG</button></div>'),wh=he('<path fill="none" stroke-width="0.15" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),Sh=he('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),Ah=he("<!><!>",1),Ch=he('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),kh=he('<g opacity="0.5" pointer-events="none"><!></g>'),Eh=he('<g><rect rx="12" ry="12" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></rect></g>'),Mh=he('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></ellipse></g>'),Rh=he('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></circle>'),Lh=he('<g><rect rx="9" ry="9" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></rect></g>'),Dh=he('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></ellipse></g>'),Ih=he('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></circle>'),$h=he('<g><rect rx="6" ry="6" fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></rect></g>'),Ph=he('<g><ellipse fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></ellipse></g>'),Nh=he('<circle fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></circle>'),Oh=he("<!><!><!>",1),Wh=he('<circle r="0.4" fill="rgba(147, 51, 234, 0.5)" stroke="#9333ea" stroke-width="0.1" pointer-events="none"></circle><line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="group-rotate-handle"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),Yh=he('<circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle><circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle>',1),Hh=he('<g><line stroke-linecap="round"></line><!><g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g></g>'),Fh=he('<g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" fill="#f59e0b" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g>'),Bh=he('<g class="measurement-line drawing"><line stroke="#f59e0b" stroke-width="0.15" stroke-dasharray="0.3,0.15" stroke-linecap="round" pointer-events="none"></line><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><!></g>'),qh=he('<line stroke-width="0.05" pointer-events="none"></line>'),Uh=he('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),Kh=he('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),Gh=he('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),zh=he("<!><!><!><!><!><!><!><!><!><!><!><!>",1),Xh=ge('<main class="svelte-hpuhtb"><div class="layout svelte-hpuhtb"><div class="sidebar svelte-hpuhtb"><!> <!> <!></div> <div class="main-content svelte-hpuhtb"><div class="battlefield-area svelte-hpuhtb"><div class="battlefield-container svelte-hpuhtb" role="presentation"><!></div> <div class="info svelte-hpuhtb"><p class="svelte-hpuhtb"> </p> <p class="hint svelte-hpuhtb">Drag to select | Ctrl+Click multi-select | Del remove | L LoS | M measure</p></div></div></div></div></main>');function Vh(t,a){Ka(a,!1);const n=()=>Nt(Mi,"$loadedTerrain",m),r=()=>Nt(gt,"$models",m),s=()=>Nt(es,"$selectedDeployment",m),i=()=>Nt(Na,"$history",m),o=()=>Nt(il,"$player1Models",m),c=()=>Nt(ol,"$player2Models",m),[m,f]=zs(),d=P(),y=P(),u=P(),p=P(),g=P(),_=P(),x=P(),E=P(),R=P(),L=P(),S=P(),A=P();let M=P(null),D=P(!1),k=P(!1),I=P(!1),U=P(null),le=P(null),N=P([]),fe=P(new Set),Ce=!1,ne=!1,re=null,ce=!1,xe=null,Ie=0,te=null,z=P([]),Z=P(null),Se=P(!1),H=P(null),ve=P(null),Me=P(!1),yt=P(!1),ye=P(!1),ae=P(!1);ws(()=>{window.addEventListener("keydown",ke)}),Si(()=>{window.removeEventListener("keydown",ke)});async function qe(){const J=`battle-${new Date().toISOString().slice(0,10)}`;try{await Ei(n().terrains,n().walls,r(),J,s())}catch(ie){alert("Failed to export PNG"),console.error("Export error:",ie)}}function ke($){if($.target.tagName==="INPUT")return;const J=e(N).length>0;if(($.ctrlKey||$.metaKey)&&$.key==="z"&&!$.shiftKey){$.preventDefault(),gt.undo();return}if(($.ctrlKey||$.metaKey)&&($.key==="y"||$.shiftKey&&$.key==="z")){$.preventDefault(),gt.redo();return}if($.key==="l"||$.key==="L"){$.preventDefault(),v(D,!e(D));return}if($.key==="m"||$.key==="M"){$.preventDefault(),v(Me,!e(Me)),e(Me)||(v(Se,!1),v(H,null),v(ve,null));return}if($.key==="Delete"||$.key==="Backspace"){if($.preventDefault(),e(Z)){v(z,e(z).filter(ie=>ie.id!==e(Z))),v(Z,null);return}e(N).length>0&&(e(N).forEach(ie=>{gt.remove(ie)}),v(N,[]));return}if(J&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes($.key)){$.preventDefault();const ie=$.shiftKey?.1:1;let Pe=0,Ne=0;switch($.key){case"ArrowUp":Ne=-ie;break;case"ArrowDown":Ne=ie;break;case"ArrowLeft":Pe=-ie;break;case"ArrowRight":Pe=ie;break}e(N).forEach(Ge=>{const Fe=r().find(et=>et.id===Ge);Fe&&gt.updateModel(Ge,{x:Fe.x+Pe,y:Fe.y+Ne},!1)});return}if($.key==="Escape"){zt();return}}function zt($){if(Ce){Ce=!1;return}v(N,[]),v(Z,null)}function st(){return"line-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Ze($,J,ie,Pe){return Math.sqrt((ie-$)**2+(Pe-J)**2)}function pt($){if(!e(M))return;$.preventDefault();const J=e(M)($.clientX,$.clientY);v(Se,!0),v(H,{x:J.x,y:J.y}),v(ve,{x:J.x,y:J.y}),window.addEventListener("mousemove",tt),window.addEventListener("mouseup",Tt)}function tt($){if(!e(Se)||!e(M))return;const J=e(M)($.clientX,$.clientY);v(ve,{x:J.x,y:J.y})}function Tt($){if(!e(Se))return;if(Ze(e(H).x,e(H).y,e(ve).x,e(ve).y)>.5){const ie={id:st(),x1:e(H).x,y1:e(H).y,x2:e(ve).x,y2:e(ve).y};v(z,[...e(z),ie]),v(Z,ie.id),v(N,[])}v(Se,!1),v(H,null),v(ve,null),window.removeEventListener("mousemove",tt),window.removeEventListener("mouseup",Tt)}function Yt($,J){J?.stopPropagation(),v(Z,$),v(N,[])}let la=!1,oe={x:0,y:0},Re=null,Ue=null;function Dt($,J){if(!e(Me)||!e(M))return;J.stopPropagation(),J.preventDefault();const ie=e(z).find(Fe=>Fe.id===$);if(!ie)return;la=!0,Re=$,Ue=null,v(Z,$),v(N,[]);const Pe=e(M)(J.clientX,J.clientY),Ne=(ie.x1+ie.x2)/2,Ge=(ie.y1+ie.y2)/2;oe={x:Pe.x-Ne,y:Pe.y-Ge},window.addEventListener("mousemove",Ht),window.addEventListener("mouseup",Xt)}function Et($,J,ie){!e(Me)||!e(M)||(ie.stopPropagation(),ie.preventDefault(),la=!0,Re=$,Ue=J,v(Z,$),v(N,[]),window.addEventListener("mousemove",Ht),window.addEventListener("mouseup",Xt))}function Ht($){if(!la||!e(M)||!Re)return;const J=e(M)($.clientX,$.clientY);v(z,e(z).map(ie=>{if(ie.id!==Re)return ie;if(Ue===1)return{...ie,x1:J.x,y1:J.y};if(Ue===2)return{...ie,x2:J.x,y2:J.y};{const Pe=J.x-oe.x,Ne=J.y-oe.y,Ge=(ie.x1+ie.x2)/2,Fe=(ie.y1+ie.y2)/2,et=Pe-Ge,_t=Ne-Fe;return{...ie,x1:ie.x1+et,y1:ie.y1+_t,x2:ie.x2+et,y2:ie.y2+_t}}}))}function Xt(){la=!1,Re=null,Ue=null,window.removeEventListener("mousemove",Ht),window.removeEventListener("mouseup",Xt)}function Ya(){v(z,[]),v(Z,null)}function Ha($){const J=$.target,ie=J.closest(".model-base"),Pe=J.closest(".measurement-line");if(ie||Pe||!e(M))return;if($.preventDefault(),e(Me)){pt($);return}const Ne=e(M)($.clientX,$.clientY);v(U,{x:Ne.x,y:Ne.y}),v(le,{x:Ne.x,y:Ne.y}),v(I,!0),window.addEventListener("mousemove",Zt),window.addEventListener("mouseup",Oe)}function Zt($){if(!e(I)||!e(M))return;const J=e(M)($.clientX,$.clientY);v(le,{x:J.x,y:J.y});const ie=Math.min(e(U).x,e(le).x),Pe=Math.max(e(U).x,e(le).x),Ne=Math.min(e(U).y,e(le).y),Ge=Math.max(e(U).y,e(le).y),Fe=new Set;r().forEach(et=>{et.x>=ie&&et.x<=Pe&&et.y>=Ne&&et.y<=Ge&&Fe.add(et.id)}),v(fe,Fe)}function Oe($){if(!e(I))return;const J=Math.min(e(U).x,e(le).x),ie=Math.max(e(U).x,e(le).x),Pe=Math.min(e(U).y,e(le).y),Ne=Math.max(e(U).y,e(le).y),Ge=ie-J,Fe=Ne-Pe;if(Ge<.5&&Fe<.5)v(N,[]);else{const et=[];r().forEach(_t=>{_t.x>=J&&_t.x<=ie&&_t.y>=Pe&&_t.y<=Ne&&et.push(_t.id)}),v(N,et),Ce=!0}v(I,!1),v(U,null),v(le,null),e(fe).clear(),v(fe,e(fe)),window.removeEventListener("mousemove",Zt),window.removeEventListener("mouseup",Oe)}function Je($,J){J&&(J.ctrlKey||J.metaKey||J.shiftKey)?e(N).includes($)?v(N,e(N).filter(ie=>ie!==$)):v(N,[...e(N),$]):e(N).includes($)&&e(N).length>1||v(N,[$])}function rt($,J,ie){if(e(N).length>1&&e(N).includes($)){ne||(ne=!0,re={},e(N).forEach(Ne=>{const Ge=r().find(Fe=>Fe.id===Ne);Ge&&(re[Ne]={x:Ge.x,y:Ge.y})}));const Pe=re[$];if(Pe){const Ne=J-Pe.x,Ge=ie-Pe.y;e(N).forEach(Fe=>{const et=re[Fe];et&&gt.updateModel(Fe,{x:et.x+Ne,y:et.y+Ge},!0)})}}else gt.updateModel($,{x:J,y:ie},!0)}function At($,J,ie,Pe,Ne){ne?(e(N).forEach(Ge=>{const Fe=re[Ge],et=r().find(_t=>_t.id===Ge);Fe&&et&&Na.push({type:"move",modelId:Ge,before:{x:Fe.x,y:Fe.y},after:{x:et.x,y:et.y}})}),ne=!1,re=null):Na.push({type:"move",modelId:$,before:{x:J,y:ie},after:{x:Pe,y:Ne}})}function Qt($,J){if(e(N).length>1&&e(N).includes($)){if(!ce){ce=!0;let Ge=0,Fe=0,et=0;const _t={};e(N).forEach(aa=>{const Ct=r().find(Ft=>Ft.id===aa);Ct&&(Ge+=Ct.x,Fe+=Ct.y,et++,_t[aa]={x:Ct.x,y:Ct.y,rotation:Ct.rotation||0})}),xe={x:Ge/et,y:Fe/et},re=_t}const ie=r().find(Ge=>Ge.id===$),Pe=re[$];if(!ie||!Pe)return;const Ne=J-Pe.rotation;e(N).forEach(Ge=>{const Fe=re[Ge];if(Fe){const et=Fe.x-xe.x,_t=Fe.y-xe.y,aa=Ne*Math.PI/180,Ct=Math.cos(aa),Ft=Math.sin(aa),na=et*Ct-_t*Ft,ca=et*Ft+_t*Ct;gt.updateModel(Ge,{x:xe.x+na,y:xe.y+ca,rotation:Fe.rotation+Ne},!0)}})}else gt.updateModel($,{rotation:J},!0)}function F($,J,ie){ce?(e(N).forEach(Pe=>{const Ne=re[Pe],Ge=r().find(Fe=>Fe.id===Pe);Ne&&Ge&&Na.push({type:"rotate",modelId:Pe,before:{x:Ne.x,y:Ne.y,rotation:Ne.rotation},after:{x:Ge.x,y:Ge.y,rotation:Ge.rotation||0}})}),ce=!1,xe=null,re=null):Na.push({type:"rotate",modelId:$,before:{rotation:J},after:{rotation:ie}})}function q($,J){gt.updateModel($,{name:J})}function we($){if(!e(M)||e(d).length<2)return;$.preventDefault(),$.stopPropagation(),ce=!0,te={},e(d).forEach(ie=>{te[ie.id]={x:ie.x,y:ie.y,rotation:ie.rotation||0}});const J=e(M)($.clientX,$.clientY);Ie=Math.atan2(J.y-e(u).y,J.x-e(u).x)*180/Math.PI,window.addEventListener("mousemove",Ke),window.addEventListener("mouseup",Ae)}function Ke($){if(!ce||!e(M)||!e(u))return;const J=e(M)($.clientX,$.clientY);let Pe=Math.atan2(J.y-e(u).y,J.x-e(u).x)*180/Math.PI-Ie;$.shiftKey||(Pe=Math.round(Pe/15)*15),v(De,-45+Pe);const Ne=Pe*Math.PI/180,Ge=Math.cos(Ne),Fe=Math.sin(Ne);e(d).forEach(et=>{const _t=te[et.id];if(_t){const aa=_t.x-e(u).x,Ct=_t.y-e(u).y,Ft=aa*Ge-Ct*Fe,na=aa*Fe+Ct*Ge;gt.updateModel(et.id,{x:e(u).x+Ft,y:e(u).y+na,rotation:_t.rotation+Pe},!0)}})}function Ae(){ce&&te&&e(d).forEach($=>{const J=te[$.id];J&&Na.push({type:"rotate",modelId:$.id,before:{x:J.x,y:J.y,rotation:J.rotation},after:{x:$.x,y:$.y,rotation:$.rotation||0}})}),ce=!1,te=null,v(De,-45),window.removeEventListener("mousemove",Ke),window.removeEventListener("mouseup",Ae)}function ot(){e(N).length>0&&(e(N).forEach($=>{gt.remove($)}),v(N,[]))}function mt($){if(bn($.baseType))return{x:$.x,y:$.y,width:$.customWidth,height:$.customHeight,rotation:$.rotation||0,isRectangle:!0};const J=Oa($.baseType,$);return Aa($.baseType)?{x:$.x,y:$.y,rx:J.width/2,ry:J.height/2,rotation:$.rotation||0}:{x:$.x,y:$.y,radius:J.radius}}let De=P(-45);pe(()=>(e(N),r()),()=>{v(d,e(N).map($=>r().find(J=>J.id===$)).filter(Boolean))}),pe(()=>e(d),()=>{v(y,e(d).length===1?e(d)[0]:null)}),pe(()=>e(d),()=>{v(u,e(d).length>1?(()=>{let $=0,J=0;return e(d).forEach(ie=>{$+=ie.x,J+=ie.y}),{x:$/e(d).length,y:J/e(d).length}})():null)}),pe(()=>(e(d),e(u),Aa),()=>{v(p,e(d).length>1?(()=>{let $=0;return e(d).forEach(J=>{const ie=Math.sqrt(Math.pow(J.x-e(u).x,2)+Math.pow(J.y-e(u).y,2)),Pe=Oa(J.baseType,J),Ne=bn(J.baseType)?Math.max(J.customWidth,J.customHeight)/2:Aa(J.baseType)?Math.max(Pe.width,Pe.height)/2:Pe.radius;$=Math.max($,ie+Ne)}),$+2})():0)}),pe(()=>(e(u),e(p),e(De)),()=>{v(g,e(u)?e(u).x+e(p)*Math.cos(e(De)*Math.PI/180):0)}),pe(()=>(e(u),e(p),e(De)),()=>{v(_,e(u)?e(u).y+e(p)*Math.sin(e(De)*Math.PI/180):0)}),pe(()=>(e(Z),e(z)),()=>{v(x,e(Z)?e(z).find($=>$.id===e(Z)):null)}),pe(()=>e(d),()=>{v(E,[...new Set(e(d).map($=>$.playerId))])}),pe(()=>(e(d),r(),e(E)),()=>{v(R,e(d).length>0?r().filter($=>!e(E).includes($.playerId)):[])}),pe(()=>(n(),xs),()=>{v(L,n().terrains.map($=>({id:$.id,vertices:xs($)})))}),pe(()=>(n(),Gn),()=>{v(S,n().walls.map($=>vr(Gn($.shape,$.segments),$.x,$.y,$.rotation)))}),pe(()=>(e(d),e(D),e(R),e(L),e(S)),()=>{v(A,e(d).length>0&&e(D)&&e(R).length>0?e(d).flatMap($=>e(R).map(J=>{const ie=Ai(mt(J),mt($),e(L),e(S));return{sourceId:J.id,source:J,targetId:$.id,target:$,canSee:ie.canSee,firstClearRay:ie.firstClearRay,rays:ie.rays}})):[])}),Rn(),en();var Ve=Xh(),Kt=T(Ve),ta=T(Kt),Vt=T(ta);fa(Vt,{title:"Selected Model",children:($,J)=>{var ie=ft(),Pe=Te(ie);{var Ne=Fe=>{var et=dh(),_t=T(et),aa=b(T(_t),2),Ct=T(aa),Ft=b(_t,2),na=T(Ft),ca=T(na),wa=b(Ft,2);{var ya=pa=>{var It=mh(),ua=Te(It),ba=T(ua),Ta=T(ba),tn=b(ua,2);{var We=G=>{var wt=uh(),St=b(T(wt),2),W=T(St);K(be=>Le(W,`${be??""}/${e(A),l(()=>e(A).length)??""} visible`),[()=>(e(A),l(()=>e(A).filter(be=>be.canSee).length))]),C(G,wt)};ee(tn,G=>{e(A),l(()=>e(A).length>0)&&G(We)})}_a(Ta,()=>e(k),G=>v(k,G)),C(pa,It)};ee(wa,pa=>{e(D)&&pa(ya)})}var sa=b(wa,2),Xa=T(sa);K(()=>{Le(Ct,`${e(N),l(()=>e(N).length)??""} models`),Le(Xa,`Remove All (${e(N),l(()=>e(N).length)??""})`)}),_a(ca,()=>e(D),pa=>v(D,pa)),V("click",sa,ot),C(Fe,et)},Ge=Fe=>{var et=ft(),_t=Te(et);{var aa=Ft=>{var na=ph(),ca=T(na),wa=b(T(ca),2),ya=b(ca,2),sa=b(T(ya),2),Xa=T(sa),pa=b(ya,2),It=b(T(pa),2),ua=T(It),ba=b(pa,2),Ta=b(T(ba),2),tn=T(Ta),We=b(ba,2);{var G=Qe=>{var w=hh(),O=b(T(w),2),B=T(O);K(Q=>Le(B,`${Q??""}Â°`),[()=>(e(y),l(()=>Math.round(e(y).rotation||0)))]),C(Qe,w)};ee(We,Qe=>{j(Aa),e(y),l(()=>Aa(e(y).baseType))&&Qe(G)})}var wt=b(We,2),St=T(wt),W=T(St),be=b(wt,2);{var jt=Qe=>{var w=fh(),O=T(w),B=T(O);_a(B,()=>e(k),Q=>v(k,Q)),C(Qe,w)};ee(be,Qe=>{e(D)&&Qe(jt)})}var ra=b(be,2);{var dt=Qe=>{var w=yh(),O=b(T(w),2),B=T(O);K(Q=>Le(B,`${Q??""}/${e(A),l(()=>e(A).length)??""} visible`),[()=>(e(A),l(()=>e(A).filter(Q=>Q.canSee).length))]),C(Qe,w)};ee(ra,Qe=>{e(D),e(A),l(()=>e(D)&&e(A).length>0)&&Qe(dt)})}var vt=b(ra,2);K((Qe,w,O)=>{zo(wa,(e(y),l(()=>e(y).name||""))),Le(Xa,Qe),Le(ua,`Player ${e(y),l(()=>e(y).playerId)??""}`),Le(tn,`${w??""}", ${O??""}"`)},[()=>(j(Oa),e(y),l(()=>Oa(e(y).baseType,e(y))?.label||"Unknown")),()=>(e(y),l(()=>e(y).x.toFixed(1))),()=>(e(y),l(()=>e(y).y.toFixed(1)))]),V("change",wa,Qe=>q(e(y).id,Qe.target.value)),_a(W,()=>e(D),Qe=>v(D,Qe)),V("click",vt,ot),C(Ft,na)},Ct=Ft=>{var na=vh();C(Ft,na)};ee(_t,Ft=>{e(y)?Ft(aa):Ft(Ct,!1)},!0)}C(Fe,et)};ee(Pe,Fe=>{e(N),l(()=>e(N).length>1)?Fe(Ne):Fe(Ge,!1)})}C($,ie)},$$slots:{default:!0}});var La=b(Vt,2);fa(La,{title:"Measure Tool",children:($,J)=>{var ie=xh(),Pe=T(ie),Ne=T(Pe),Ge=T(Ne),Fe=b(Pe,2);{var et=It=>{var ua=gh();C(It,ua)};ee(Fe,It=>{e(Me)&&It(et)})}var _t=b(Fe,2);{var aa=It=>{var ua=bh(),ba=Te(ua),Ta=b(T(ba),2),tn=T(Ta),We=b(ba,2);K(G=>Le(tn,`${G??""}"`),[()=>(e(x),l(()=>Ze(e(x).x1,e(x).y1,e(x).x2,e(x).y2).toFixed(2)))]),V("click",We,()=>{v(z,e(z).filter(G=>G.id!==e(Z))),v(Z,null)}),C(It,ua)};ee(_t,It=>{e(x)&&It(aa)})}var Ct=b(_t,2);{var Ft=It=>{var ua=Th(),ba=Te(ua),Ta=b(T(ba),2),tn=T(Ta),We=b(ba,2);K(()=>Le(tn,`${e(z),l(()=>e(z).length)??""} line${e(z),l(()=>e(z).length!==1?"s":"")??""}`)),V("click",We,Ya),C(It,ua)};ee(Ct,It=>{e(z),l(()=>e(z).length>0)&&It(Ft)})}var na=b(Ct,2),ca=b(T(na),2),wa=T(ca),ya=b(ca,2),sa=T(ya),Xa=b(ya,2),pa=T(Xa);_a(Ge,()=>e(Me),It=>v(Me,It)),_a(wa,()=>e(yt),It=>v(yt,It)),_a(sa,()=>e(ye),It=>v(ye,It)),_a(pa,()=>e(ae),It=>v(ae,It)),C($,ie)},$$slots:{default:!0}});var Ln=b(La,2);fa(Ln,{title:"Actions",children:($,J)=>{var ie=_h(),Pe=T(ie),Ne=T(Pe),Ge=b(Ne,2),Fe=b(Pe,2);K(()=>{Ne.disabled=(i(),l(()=>!i().past.length)),Ge.disabled=(i(),l(()=>!i().future.length))}),V("click",Ne,()=>gt.undo()),V("click",Ge,()=>gt.redo()),V("click",Fe,qe),C($,ie)},$$slots:{default:!0}});var Dn=b(ta,2),In=T(Dn),un=T(In),Ma=T(un);pr(Ma,{children:Hr,$$slots:{default:($,J)=>{const ie=$e(()=>J.screenToSvg);var Pe=zh(),Ne=Te(Pe);{var Ge=We=>{var G=_i();K(()=>Le(G,(e(M),j(e(ie)),l(()=>(v(M,e(ie)),""))))),C(We,G)};ee(Ne,We=>{e(ie)&&!e(M)&&We(Ge)})}var Fe=b(Ne);{var et=We=>{var G=Ah(),wt=Te(G);He(wt,1,()=>(s(),l(()=>s().zones)),it,(W,be)=>{var jt=wh();K(ra=>{h(jt,"d",ra),h(jt,"stroke",(e(be),l(()=>e(be).borderColor)))},[()=>(j(Fs),e(be),l(()=>Fs(e(be).path)))]),C(W,jt)});var St=b(wt);He(St,1,()=>(s(),l(()=>s().objectives)),it,(W,be)=>{const jt=$e(()=>(e(be),l(()=>e(be).isPrimary?"#fbbf24":"#9ca3af"))),ra=$e(()=>(e(be),l(()=>e(be).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var dt=Sh(),vt=Te(dt),Qe=b(vt),w=b(Qe);K(()=>{h(vt,"cx",(e(be),l(()=>e(be).x))),h(vt,"cy",(e(be),l(()=>e(be).y))),h(vt,"r",Gr),h(vt,"fill",e(ra)),h(vt,"stroke",e(jt)),h(Qe,"cx",(e(be),l(()=>e(be).x))),h(Qe,"cy",(e(be),l(()=>e(be).y))),h(Qe,"r",Kr),h(Qe,"fill",e(jt)),h(w,"cx",(e(be),l(()=>e(be).x))),h(w,"cy",(e(be),l(()=>e(be).y)))}),C(W,dt)}),C(We,G)};ee(Fe,We=>{s()&&We(et)})}var _t=b(Fe);He(_t,1,()=>(n(),l(()=>n().terrains)),it,(We,G)=>{var wt=Ch(),St=T(wt);K(()=>{h(wt,"transform",`rotate(${e(G),l(()=>e(G).rotation)??""}, ${e(G),l(()=>e(G).x+e(G).width/2)??""}, ${e(G),l(()=>e(G).y+e(G).height/2)??""})`),h(St,"x",(e(G),l(()=>e(G).x))),h(St,"y",(e(G),l(()=>e(G).y))),h(St,"width",(e(G),l(()=>e(G).width))),h(St,"height",(e(G),l(()=>e(G).height)))}),C(We,wt)});var aa=b(_t);He(aa,1,()=>(n(),l(()=>n().walls)),it,(We,G)=>{var wt=kh(),St=T(wt);Ur(St,{get id(){return e(G),l(()=>e(G).id)},get x(){return e(G),l(()=>e(G).x)},get y(){return e(G),l(()=>e(G).y)},get shape(){return e(G),l(()=>e(G).shape)},get segments(){return e(G),l(()=>e(G).segments)},get rotation(){return e(G),l(()=>e(G).rotation)},selected:!1,get screenToSvg(){return e(ie)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),C(We,wt)});var Ct=b(aa);{var Ft=We=>{var G=ft(),wt=Te(G);He(wt,1,r,St=>St.id,(St,W)=>{const be=$e(()=>(j(Oa),e(W),l(()=>Oa(e(W).baseType,e(W))))),jt=$e(()=>(j(Aa),e(W),l(()=>Aa(e(W).baseType)))),ra=$e(()=>(j(bn),e(W),l(()=>bn(e(W).baseType)))),dt=$e(()=>(e(W),l(()=>e(W).playerId===1?"rgba(59, 130, 246, 0.15)":"rgba(239, 68, 68, 0.15)"))),vt=$e(()=>(e(W),l(()=>e(W).playerId===1?"#3b82f6":"#ef4444")));var Qe=Oh(),w=Te(Qe);{var O=se=>{var _e=ft(),Ye=Te(_e);{var bt=je=>{var lt=Eh(),at=T(lt);K(()=>{h(lt,"transform",`rotate(${e(W),l(()=>e(W).rotation||0)??""}, ${e(W),l(()=>e(W).x)??""}, ${e(W),l(()=>e(W).y)??""})`),h(at,"x",(e(W),l(()=>e(W).x-e(W).customWidth/2-12))),h(at,"y",(e(W),l(()=>e(W).y-e(W).customHeight/2-12))),h(at,"width",(e(W),l(()=>e(W).customWidth+24))),h(at,"height",(e(W),l(()=>e(W).customHeight+24))),h(at,"fill",e(dt)),h(at,"stroke",e(vt))}),C(je,lt)},xt=je=>{var lt=ft(),at=Te(lt);{var ia=Bt=>{var ht=Mh(),Lt=T(ht);K(()=>{h(ht,"transform",`rotate(${e(W),l(()=>e(W).rotation||0)??""}, ${e(W),l(()=>e(W).x)??""}, ${e(W),l(()=>e(W).y)??""})`),h(Lt,"cx",(e(W),l(()=>e(W).x))),h(Lt,"cy",(e(W),l(()=>e(W).y))),h(Lt,"rx",(j(e(be)),l(()=>e(be).width/2+12))),h(Lt,"ry",(j(e(be)),l(()=>e(be).height/2+12))),h(Lt,"fill",e(dt)),h(Lt,"stroke",e(vt))}),C(Bt,ht)},xa=Bt=>{var ht=Rh();K(()=>{h(ht,"cx",(e(W),l(()=>e(W).x))),h(ht,"cy",(e(W),l(()=>e(W).y))),h(ht,"r",(j(e(be)),l(()=>e(be).radius+12))),h(ht,"fill",e(dt)),h(ht,"stroke",e(vt))}),C(Bt,ht)};ee(at,Bt=>{e(jt)?Bt(ia):Bt(xa,!1)},!0)}C(je,lt)};ee(Ye,je=>{e(ra)?je(bt):je(xt,!1)})}C(se,_e)};ee(w,se=>{e(ae)&&se(O)})}var B=b(w);{var Q=se=>{var _e=ft(),Ye=Te(_e);{var bt=je=>{var lt=Lh(),at=T(lt);K(()=>{h(lt,"transform",`rotate(${e(W),l(()=>e(W).rotation||0)??""}, ${e(W),l(()=>e(W).x)??""}, ${e(W),l(()=>e(W).y)??""})`),h(at,"x",(e(W),l(()=>e(W).x-e(W).customWidth/2-9))),h(at,"y",(e(W),l(()=>e(W).y-e(W).customHeight/2-9))),h(at,"width",(e(W),l(()=>e(W).customWidth+18))),h(at,"height",(e(W),l(()=>e(W).customHeight+18))),h(at,"fill",e(dt)),h(at,"stroke",e(vt))}),C(je,lt)},xt=je=>{var lt=ft(),at=Te(lt);{var ia=Bt=>{var ht=Dh(),Lt=T(ht);K(()=>{h(ht,"transform",`rotate(${e(W),l(()=>e(W).rotation||0)??""}, ${e(W),l(()=>e(W).x)??""}, ${e(W),l(()=>e(W).y)??""})`),h(Lt,"cx",(e(W),l(()=>e(W).x))),h(Lt,"cy",(e(W),l(()=>e(W).y))),h(Lt,"rx",(j(e(be)),l(()=>e(be).width/2+9))),h(Lt,"ry",(j(e(be)),l(()=>e(be).height/2+9))),h(Lt,"fill",e(dt)),h(Lt,"stroke",e(vt))}),C(Bt,ht)},xa=Bt=>{var ht=Ih();K(()=>{h(ht,"cx",(e(W),l(()=>e(W).x))),h(ht,"cy",(e(W),l(()=>e(W).y))),h(ht,"r",(j(e(be)),l(()=>e(be).radius+9))),h(ht,"fill",e(dt)),h(ht,"stroke",e(vt))}),C(Bt,ht)};ee(at,Bt=>{e(jt)?Bt(ia):Bt(xa,!1)},!0)}C(je,lt)};ee(Ye,je=>{e(ra)?je(bt):je(xt,!1)})}C(se,_e)};ee(B,se=>{e(ye)&&se(Q)})}var ue=b(B);{var me=se=>{var _e=ft(),Ye=Te(_e);{var bt=je=>{var lt=$h(),at=T(lt);K(()=>{h(lt,"transform",`rotate(${e(W),l(()=>e(W).rotation||0)??""}, ${e(W),l(()=>e(W).x)??""}, ${e(W),l(()=>e(W).y)??""})`),h(at,"x",(e(W),l(()=>e(W).x-e(W).customWidth/2-6))),h(at,"y",(e(W),l(()=>e(W).y-e(W).customHeight/2-6))),h(at,"width",(e(W),l(()=>e(W).customWidth+12))),h(at,"height",(e(W),l(()=>e(W).customHeight+12))),h(at,"stroke",e(vt))}),C(je,lt)},xt=je=>{var lt=ft(),at=Te(lt);{var ia=Bt=>{var ht=Ph(),Lt=T(ht);K(()=>{h(ht,"transform",`rotate(${e(W),l(()=>e(W).rotation||0)??""}, ${e(W),l(()=>e(W).x)??""}, ${e(W),l(()=>e(W).y)??""})`),h(Lt,"cx",(e(W),l(()=>e(W).x))),h(Lt,"cy",(e(W),l(()=>e(W).y))),h(Lt,"rx",(j(e(be)),l(()=>e(be).width/2+6))),h(Lt,"ry",(j(e(be)),l(()=>e(be).height/2+6))),h(Lt,"stroke",e(vt))}),C(Bt,ht)},xa=Bt=>{var ht=Nh();K(()=>{h(ht,"cx",(e(W),l(()=>e(W).x))),h(ht,"cy",(e(W),l(()=>e(W).y))),h(ht,"r",(j(e(be)),l(()=>e(be).radius+6))),h(ht,"stroke",e(vt))}),C(Bt,ht)};ee(at,Bt=>{e(jt)?Bt(ia):Bt(xa,!1)},!0)}C(je,lt)};ee(Ye,je=>{e(ra)?je(bt):je(xt,!1)})}C(se,_e)};ee(ue,se=>{e(yt)&&se(me)})}C(St,Qe)}),C(We,G)};ee(Ct,We=>{(e(yt)||e(ye)||e(ae))&&We(Ft)})}var na=b(Ct);He(na,1,r,We=>We.id,(We,G)=>{{let wt=$e(()=>(e(G),l(()=>e(G).name||""))),St=$e(()=>(e(N),e(G),l(()=>e(N).includes(e(G).id)))),W=$e(()=>(e(N),e(G),l(()=>e(N).length>1&&e(N).includes(e(G).id)))),be=$e(()=>(e(N),e(G),e(fe),l(()=>!e(N).includes(e(G).id)&&e(fe).has(e(G).id))));ur(We,{get id(){return e(G),l(()=>e(G).id)},get x(){return e(G),l(()=>e(G).x)},get y(){return e(G),l(()=>e(G).y)},get baseType(){return e(G),l(()=>e(G).baseType)},get playerId(){return e(G),l(()=>e(G).playerId)},get rotation(){return e(G),l(()=>e(G).rotation)},get name(){return e(wt)},get customWidth(){return e(G),l(()=>e(G).customWidth)},get customHeight(){return e(G),l(()=>e(G).customHeight)},get selected(){return e(St)},get inGroupSelection(){return e(W)},get marqueePreview(){return e(be)},get screenToSvg(){return e(ie)},onSelect:Je,onDrag:rt,onDragEnd:At,onRotate:Qt,onRotateEnd:F,onRename:q})}});var ca=b(na);{var wa=We=>{var G=Wh(),wt=Te(G),St=b(wt),W=b(St),be=b(W);K(()=>{h(wt,"cx",(e(u),l(()=>e(u).x))),h(wt,"cy",(e(u),l(()=>e(u).y))),h(St,"x1",(e(u),l(()=>e(u).x))),h(St,"y1",(e(u),l(()=>e(u).y))),h(St,"x2",e(g)),h(St,"y2",e(_)),h(W,"cx",e(g)),h(W,"cy",e(_)),h(be,"transform",`translate(${e(g)??""}, ${e(_)??""})`)}),V("mousedown",W,we),C(We,G)};ee(ca,We=>{e(u),e(d),l(()=>e(u)&&e(d).length>1)&&We(wa)})}var ya=b(ca);He(ya,1,()=>e(z),We=>We.id,(We,G)=>{const wt=$e(()=>(e(G),l(()=>Ze(e(G).x1,e(G).y1,e(G).x2,e(G).y2)))),St=$e(()=>(e(G),l(()=>(e(G).x1+e(G).x2)/2))),W=$e(()=>(e(G),l(()=>(e(G).y1+e(G).y2)/2))),be=$e(()=>(e(G),e(Z),l(()=>e(G).id===e(Z))));var jt=Hh();let ra;var dt=T(jt),vt=b(dt);{var Qe=Q=>{var ue=Yh(),me=Te(ue),se=b(me);K(()=>{h(me,"cx",(e(G),l(()=>e(G).x1))),h(me,"cy",(e(G),l(()=>e(G).y1))),h(me,"fill",e(be)?"#3b82f6":"#f59e0b"),h(se,"cx",(e(G),l(()=>e(G).x2))),h(se,"cy",(e(G),l(()=>e(G).y2))),h(se,"fill",e(be)?"#3b82f6":"#f59e0b")}),V("mousedown",me,_e=>Et(e(G).id,1,_e)),V("mousedown",se,_e=>Et(e(G).id,2,_e)),C(Q,ue)};ee(vt,Q=>{e(Me)&&Q(Qe)})}var w=b(vt),O=b(T(w)),B=T(O);K(Q=>{ra=Ca(jt,0,"measurement-line",null,ra,{selected:e(be),"tool-active":e(Me)}),h(dt,"x1",(e(G),l(()=>e(G).x1))),h(dt,"y1",(e(G),l(()=>e(G).y1))),h(dt,"x2",(e(G),l(()=>e(G).x2))),h(dt,"y2",(e(G),l(()=>e(G).y2))),h(dt,"stroke",e(be)&&e(Me)?"#3b82f6":"#f59e0b"),h(dt,"stroke-width",e(be)&&e(Me)?.2:.15),h(dt,"role",e(Me)?"button":"presentation"),h(dt,"tabindex",e(Me)?0:-1),h(w,"transform",`translate(${e(St)??""}, ${e(W)??""})`),h(O,"fill",e(be)&&e(Me)?"#3b82f6":"#f59e0b"),Le(B,`${Q??""}"`)},[()=>(j(e(wt)),l(()=>e(wt).toFixed(1)))]),V("click",dt,Q=>e(Me)&&Yt(e(G).id,Q)),V("mousedown",dt,Q=>e(Me)?Dt(e(G).id,Q):Q.stopPropagation()),C(We,jt)});var sa=b(ya);{var Xa=We=>{const G=$e(()=>(e(H),e(ve),l(()=>Ze(e(H).x,e(H).y,e(ve).x,e(ve).y)))),wt=$e(()=>(e(H),e(ve),l(()=>(e(H).x+e(ve).x)/2))),St=$e(()=>(e(H),e(ve),l(()=>(e(H).y+e(ve).y)/2)));var W=Bh(),be=T(W),jt=b(be),ra=b(jt),dt=b(ra);{var vt=Qe=>{var w=Fh(),O=b(T(w)),B=T(O);K(Q=>{h(w,"transform",`translate(${e(wt)??""}, ${e(St)??""})`),Le(B,`${Q??""}"`)},[()=>(j(e(G)),l(()=>e(G).toFixed(1)))]),C(Qe,w)};ee(dt,Qe=>{e(G)>.5&&Qe(vt)})}K(()=>{h(be,"x1",(e(H),l(()=>e(H).x))),h(be,"y1",(e(H),l(()=>e(H).y))),h(be,"x2",(e(ve),l(()=>e(ve).x))),h(be,"y2",(e(ve),l(()=>e(ve).y))),h(jt,"cx",(e(H),l(()=>e(H).x))),h(jt,"cy",(e(H),l(()=>e(H).y))),h(ra,"cx",(e(ve),l(()=>e(ve).x))),h(ra,"cy",(e(ve),l(()=>e(ve).y)))}),C(We,W)};ee(sa,We=>{e(Se)&&e(H)&&e(ve)&&We(Xa)})}var pa=b(sa);{var It=We=>{var G=ft(),wt=Te(G);He(wt,1,()=>e(A),it,(St,W)=>{var be=ft(),jt=Te(be);He(jt,1,()=>(e(W),l(()=>e(W).rays)),it,(ra,dt)=>{var vt=qh();K(()=>{h(vt,"x1",(e(dt),l(()=>e(dt).from.x))),h(vt,"y1",(e(dt),l(()=>e(dt).from.y))),h(vt,"x2",(e(dt),l(()=>e(dt).to.x))),h(vt,"y2",(e(dt),l(()=>e(dt).to.y))),h(vt,"stroke",(e(dt),l(()=>e(dt).blocked?"#ff000033":"#00ff0033")))}),C(ra,vt)}),C(St,be)}),C(We,G)};ee(pa,We=>{e(k),e(D),e(d),e(A),l(()=>e(k)&&e(D)&&e(d).length>0&&e(A).length>0)&&We(It)})}var ua=b(pa);{var ba=We=>{var G=ft(),wt=Te(G);He(wt,1,()=>e(A),it,(St,W)=>{var be=ft(),jt=Te(be);{var ra=vt=>{var Qe=Uh();K(()=>{h(Qe,"x1",(e(W),l(()=>e(W).firstClearRay.from.x))),h(Qe,"y1",(e(W),l(()=>e(W).firstClearRay.from.y))),h(Qe,"x2",(e(W),l(()=>e(W).firstClearRay.to.x))),h(Qe,"y2",(e(W),l(()=>e(W).firstClearRay.to.y)))}),C(vt,Qe)},dt=vt=>{var Qe=Kh();K(()=>{h(Qe,"x1",(e(W),l(()=>e(W).source.x))),h(Qe,"y1",(e(W),l(()=>e(W).source.y))),h(Qe,"x2",(e(W),l(()=>e(W).target.x))),h(Qe,"y2",(e(W),l(()=>e(W).target.y)))}),C(vt,Qe)};ee(jt,vt=>{e(W),l(()=>e(W).firstClearRay)?vt(ra):vt(dt,!1)})}C(St,be)}),C(We,G)};ee(ua,We=>{e(D),e(d),e(A),l(()=>e(D)&&e(d).length>0&&e(A).length>0)&&We(ba)})}var Ta=b(ua);{var tn=We=>{const G=$e(()=>(e(U),e(le),l(()=>Math.min(e(U).x,e(le).x)))),wt=$e(()=>(e(U),e(le),l(()=>Math.min(e(U).y,e(le).y)))),St=$e(()=>(e(le),e(U),l(()=>Math.abs(e(le).x-e(U).x)))),W=$e(()=>(e(le),e(U),l(()=>Math.abs(e(le).y-e(U).y))));var be=Gh();K(()=>{h(be,"x",e(G)),h(be,"y",e(wt)),h(be,"width",e(St)),h(be,"height",e(W))}),C(We,be)};ee(Ta,We=>{e(I)&&e(U)&&e(le)&&We(tn)})}C($,Pe)}}});var mn=b(un,2),za=T(mn),$n=T(za);K(()=>Le($n,`Battlefield: 60" x 44" | ${o(),l(()=>o().length)??""} P1 models | ${c(),l(()=>c().length)??""} P2 models`)),V("mousedown",un,Ha),C(t,Ve),Ga(),f()}var jh=ge("<span> </span>"),Zh=ge('<span class="los-status svelte-12aohay">No enemies</span>'),Qh=ge('<div class="controls svelte-12aohay"><label class="svelte-12aohay"><input type="checkbox" class="svelte-12aohay"/> Show debug rays</label> <!> <button class="export-btn svelte-12aohay">Export PNG</button></div>'),Jh=ge('<button class="svelte-12aohay"> </button>'),ef=ge('<div class="button-group svelte-12aohay"></div>'),tf=ge('<button class="svelte-12aohay"> </button>'),af=ge('<div class="button-group svelte-12aohay"></div>'),nf=ge('<div class="player-toggle svelte-12aohay"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-12aohay"><div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Circles</h4> <div class="palette-grid svelte-12aohay"></div></div> <div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Ovals</h4> <div class="palette-grid svelte-12aohay"></div></div></div>',1),sf=he('<line stroke-width="0.05"></line>'),rf=he('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),of=he('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),lf=he("<!><!><!><!><!><!><!>",1),cf=ge('<p class="svelte-12aohay"> </p>'),uf=ge('<main class="svelte-12aohay"><div class="layout svelte-12aohay"><div class="sidebar svelte-12aohay"><!> <!> <!> <!></div> <div class="battlefield-area svelte-12aohay"><div class="battlefield-container svelte-12aohay"><!></div> <div class="info svelte-12aohay"><p class="svelte-12aohay"> </p> <!> <p class="hint svelte-12aohay">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function mf(t,a){Ka(a,!1);const n=()=>Nt(Qn,"$debugModels",f),r=()=>Nt(us,"$debugSelectedModelId",f),s=()=>Nt(wr,"$debugTerrains",f),i=()=>Nt(Sr,"$debugWalls",f),o=()=>Nt(Xi,"$debugMode",f),c=()=>Nt(Ar,"$debugSelectedTerrainId",f),m=()=>Nt(Cr,"$debugSelectedWallId",f),[f,d]=zs(),y=P(),u=P(),p=P(),g=P(),_=P();function x(oe,Re){wr.add(oe,Re)}function E(oe){Sr.add(oe)}function R(oe){Ar.set(oe),Cr.set(null),us.set(null)}function L(oe){Cr.set(oe),Ar.set(null),us.set(null)}function S(oe,Re,Ue){wr.updateTerrain(oe,{x:Re,y:Ue})}function A(oe,Re,Ue){Sr.updateWall(oe,{x:Re,y:Ue})}function M(oe,Re){wr.updateTerrain(oe,{rotation:Re})}function D(oe,Re){Sr.updateWall(oe,{rotation:Re})}let k=P(1),I=P(null),U=!1,le=null,N=P(null);const fe=5;ws(()=>{if(n().length===0){const oe=Qn.add("32mm",1,10,22);Qn.add("32mm",2,50,22),us.set(oe)}});function Ce(oe,Re){if(!e(N))return;U=!0,le={x:Re.clientX,y:Re.clientY};const Ue=e(N)(Re.clientX,Re.clientY);v(I,{baseType:oe.type,x:Ue.x,y:Ue.y}),window.addEventListener("mousemove",ne),window.addEventListener("mouseup",re)}function ne(oe){if(!U||!e(I)||!e(N))return;const Re=e(N)(oe.clientX,oe.clientY);v(I,{...e(I),x:Re.x,y:Re.y})}function re(oe){if(!U||!e(I)){U=!1,v(I,null),le=null,window.removeEventListener("mousemove",ne),window.removeEventListener("mouseup",re);return}const Re=oe.clientX-le.x,Ue=oe.clientY-le.y,Dt=Math.sqrt(Re*Re+Ue*Ue);let Et,Ht;Dt<fe?(Et=30,Ht=22):(Et=e(I).x,Ht=e(I).y);const Xt=Qn.add(e(I).baseType,e(k),Et,Ht);us.set(Xt),v(I,null),U=!1,le=null,window.removeEventListener("mousemove",ne),window.removeEventListener("mouseup",re)}function ce(oe){us.set(oe),Ar.set(null),Cr.set(null)}function xe(oe,Re,Ue){Qn.updateModel(oe,{x:Re,y:Ue},!0)}function Ie(oe,Re,Ue,Dt,Et){li.push({type:"move",modelId:oe,before:{x:Re,y:Ue},after:{x:Dt,y:Et}})}function te(oe,Re){Qn.updateModel(oe,{rotation:Re},!0)}function z(oe,Re,Ue){li.push({type:"rotate",modelId:oe,before:{rotation:Re},after:{rotation:Ue}})}function Z(oe,Re){Qn.updateModel(oe,{name:Re})}function Se(oe){const Re=Oa(oe.baseType);return Aa(oe.baseType)?{x:oe.x,y:oe.y,rx:Re.width/2,ry:Re.height/2,rotation:oe.rotation||0}:{x:oe.x,y:oe.y,radius:Re.radius}}async function H(){const Re=`battlefield-debug-${new Date().toISOString().slice(0,10)}`;try{await Ei(s(),i(),n(),Re)}catch(Ue){alert("Failed to export PNG"),console.error("Export error:",Ue)}}pe(()=>(n(),r()),()=>{v(y,n().find(oe=>oe.id===r()))}),pe(()=>(e(y),n()),()=>{v(u,e(y)?n().filter(oe=>oe.playerId!==e(y).playerId):[])}),pe(()=>(s(),xs),()=>{v(p,s().map(oe=>({id:oe.id,vertices:xs(oe)})))}),pe(()=>(i(),Gn),()=>{v(g,i().map(oe=>vr(Gn(oe.shape,oe.segments),oe.x,oe.y,oe.rotation)))}),pe(()=>(e(y),e(u),e(p),e(g)),()=>{v(_,e(y)&&e(u).length>0?e(u).map(oe=>{const Re=Ai(Se(oe),Se(e(y)),e(p),e(g));return{viewerId:oe.id,viewer:oe,canSee:Re.canSee,firstClearRay:Re.firstClearRay,rays:Re.rays}}):[])}),Rn(),en();var ve=uf(),Me=T(ve),yt=T(Me),ye=T(yt);fa(ye,{title:"LOS Debug",children:(oe,Re)=>{var Ue=Qh(),Dt=T(Ue),Et=T(Dt),Ht=b(Dt,2);{var Xt=Zt=>{var Oe=jh();let Je;var rt=T(Oe);K((At,Qt)=>{Je=Ca(Oe,1,"los-status svelte-12aohay",null,Je,At),Le(rt,`${Qt??""}/${e(_),l(()=>e(_).length)??""} visible`)},[()=>({"can-see":e(_).some(At=>At.canSee),blocked:!e(_).some(At=>At.canSee)}),()=>(e(_),l(()=>e(_).filter(At=>At.canSee).length))]),C(Zt,Oe)},Ya=Zt=>{var Oe=Zh();C(Zt,Oe)};ee(Ht,Zt=>{e(y),e(_),l(()=>e(y)&&e(_).length>0)?Zt(Xt):Zt(Ya,!1)})}var Ha=b(Ht,2);_a(Et,o,Zt=>Fc(Xi,Zt)),V("click",Ha,H),C(oe,Ue)},$$slots:{default:!0}});var ae=b(ye,2);fa(ae,{title:"Add Terrain",defaultOpen:!1,children:(oe,Re)=>{var Ue=ef();He(Ue,5,()=>tl,it,(Dt,Et)=>{var Ht=Jh(),Xt=T(Ht);K(()=>Le(Xt,(e(Et),l(()=>e(Et).label)))),V("click",Ht,()=>x(e(Et).width,e(Et).height)),C(Dt,Ht)}),C(oe,Ue)},$$slots:{default:!0}});var qe=b(ae,2);fa(qe,{title:"Add Wall",defaultOpen:!1,children:(oe,Re)=>{var Ue=af();He(Ue,5,()=>ii,it,(Dt,Et)=>{var Ht=tf(),Xt=T(Ht);K(()=>Le(Xt,(e(Et),l(()=>e(Et).label)))),V("click",Ht,()=>E(e(Et).shape)),C(Dt,Ht)}),C(oe,Ue)},$$slots:{default:!0}});var ke=b(qe,2);fa(ke,{title:"Add Models",defaultOpen:!1,children:(oe,Re)=>{var Ue=nf(),Dt=Te(Ue),Et=T(Dt);let Ht;var Xt=b(Et,2);let Ya;var Ha=b(Dt,2),Zt=T(Ha),Oe=b(T(Zt),2);He(Oe,5,()=>(j(Qa),l(()=>Qa.circles)),it,(At,Qt)=>{Wr(At,{get baseSize(){return e(Qt)},get playerId(){return e(k)},onDragStart:Ce})});var Je=b(Zt,2),rt=b(T(Je),2);He(rt,5,()=>(j(Qa),l(()=>Qa.ovals)),it,(At,Qt)=>{Wr(At,{get baseSize(){return e(Qt)},get playerId(){return e(k)},onDragStart:Ce})}),K(()=>{Ht=Ca(Et,1,"toggle-btn svelte-12aohay",null,Ht,{active:e(k)===1}),Ya=Ca(Xt,1,"toggle-btn svelte-12aohay",null,Ya,{active:e(k)===2})}),V("click",Et,()=>v(k,1)),V("click",Xt,()=>v(k,2)),C(oe,Ue)},$$slots:{default:!0}});var zt=b(yt,2),st=T(zt),Ze=T(st);pr(Ze,{children:Hr,$$slots:{default:(oe,Re)=>{const Ue=$e(()=>Re.screenToSvg);var Dt=lf(),Et=Te(Dt);{var Ht=F=>{var q=_i();K(()=>Le(q,(e(N),j(e(Ue)),l(()=>(v(N,e(Ue)),""))))),C(F,q)};ee(Et,F=>{e(Ue)&&!e(N)&&F(Ht)})}var Xt=b(Et);{var Ya=F=>{var q=ft(),we=Te(q);He(we,1,()=>e(_),it,(Ke,Ae)=>{var ot=ft(),mt=Te(ot);He(mt,1,()=>(e(Ae),l(()=>e(Ae).rays)),it,(De,Ve)=>{var Kt=sf();K(()=>{h(Kt,"x1",(e(Ve),l(()=>e(Ve).from.x))),h(Kt,"y1",(e(Ve),l(()=>e(Ve).from.y))),h(Kt,"x2",(e(Ve),l(()=>e(Ve).to.x))),h(Kt,"y2",(e(Ve),l(()=>e(Ve).to.y))),h(Kt,"stroke",(e(Ve),l(()=>e(Ve).blocked?"#ff000033":"#00ff0033")))}),C(De,Kt)}),C(Ke,ot)}),C(F,q)};ee(Xt,F=>{o(),e(y),e(_),l(()=>o()&&e(y)&&e(_).length>0)&&F(Ya)})}var Ha=b(Xt);He(Ha,1,s,F=>F.id,(F,q)=>{{let we=$e(()=>(e(q),c(),l(()=>e(q).id===c())));Jo(F,{get id(){return e(q),l(()=>e(q).id)},get x(){return e(q),l(()=>e(q).x)},get y(){return e(q),l(()=>e(q).y)},get width(){return e(q),l(()=>e(q).width)},get height(){return e(q),l(()=>e(q).height)},get rotation(){return e(q),l(()=>e(q).rotation)},get selected(){return e(we)},get screenToSvg(){return e(Ue)},onSelect:R,onDrag:S,onRotate:M})}});var Zt=b(Ha);He(Zt,1,i,F=>F.id,(F,q)=>{{let we=$e(()=>(e(q),m(),l(()=>e(q).id===m())));Ur(F,{get id(){return e(q),l(()=>e(q).id)},get x(){return e(q),l(()=>e(q).x)},get y(){return e(q),l(()=>e(q).y)},get shape(){return e(q),l(()=>e(q).shape)},get segments(){return e(q),l(()=>e(q).segments)},get rotation(){return e(q),l(()=>e(q).rotation)},get selected(){return e(we)},get screenToSvg(){return e(Ue)},onSelect:L,onDrag:A,onRotate:D})}});var Oe=b(Zt);He(Oe,1,n,F=>F.id,(F,q)=>{{let we=$e(()=>(e(q),l(()=>e(q).name||""))),Ke=$e(()=>(e(q),r(),l(()=>e(q).id===r())));ur(F,{get id(){return e(q),l(()=>e(q).id)},get x(){return e(q),l(()=>e(q).x)},get y(){return e(q),l(()=>e(q).y)},get baseType(){return e(q),l(()=>e(q).baseType)},get playerId(){return e(q),l(()=>e(q).playerId)},get rotation(){return e(q),l(()=>e(q).rotation)},get name(){return e(we)},get selected(){return e(Ke)},get screenToSvg(){return e(Ue)},onSelect:ce,onDrag:xe,onDragEnd:Ie,onRotate:te,onRotateEnd:z,onRename:Z})}});var Je=b(Oe);{var rt=F=>{var q=ft(),we=Te(q);He(we,1,()=>e(_),it,(Ke,Ae)=>{var ot=ft(),mt=Te(ot);{var De=Kt=>{var ta=rf();K(()=>{h(ta,"x1",(e(Ae),l(()=>e(Ae).firstClearRay.from.x))),h(ta,"y1",(e(Ae),l(()=>e(Ae).firstClearRay.from.y))),h(ta,"x2",(e(Ae),l(()=>e(Ae).firstClearRay.to.x))),h(ta,"y2",(e(Ae),l(()=>e(Ae).firstClearRay.to.y)))}),C(Kt,ta)},Ve=Kt=>{var ta=of();K(()=>{h(ta,"x1",(e(y),l(()=>e(y).x))),h(ta,"y1",(e(y),l(()=>e(y).y))),h(ta,"x2",(e(Ae),l(()=>e(Ae).target.x))),h(ta,"y2",(e(Ae),l(()=>e(Ae).target.y)))}),C(Kt,ta)};ee(mt,Kt=>{e(Ae),l(()=>e(Ae).firstClearRay)?Kt(De):Kt(Ve,!1)})}C(Ke,ot)}),C(F,q)};ee(Je,F=>{o(),e(y),e(_),l(()=>o()&&e(y)&&e(_).length>0)&&F(rt)})}var At=b(Je);{var Qt=F=>{ur(F,{id:"phantom",get x(){return e(I),l(()=>e(I).x)},get y(){return e(I),l(()=>e(I).y)},get baseType(){return e(I),l(()=>e(I).baseType)},get playerId(){return e(k)},rotation:0,selected:!1,get screenToSvg(){return e(Ue)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};ee(At,F=>{e(I)&&F(Qt)})}C(oe,Dt)}}});var pt=b(st,2),tt=T(pt),Tt=T(tt),Yt=b(tt,2);{var la=oe=>{var Re=cf(),Ue=T(Re);K(Dt=>Le(Ue,`Selected model LOS: ${Dt??""}/${e(_),l(()=>e(_).length)??""} visible`),[()=>(e(_),l(()=>e(_).filter(Dt=>Dt.canSee).length))]),C(oe,Re)};ee(Yt,oe=>{o(),e(y),e(_),l(()=>o()&&e(y)&&e(_).length>0)&&oe(la)})}K(()=>Le(Tt,`Battlefield: 60" x 44" | ${s(),l(()=>s().length)??""} terrain | ${i(),l(()=>i().length)??""} walls | ${n(),l(()=>n().length)??""} models`)),C(t,ve),Ga(),d()}var df=ge(`<div class="app-header svelte-1n46o8q"><h1 class="app-title svelte-1n46o8q">Fu'llasso</h1> <nav class="nav-links svelte-1n46o8q"><a href="#/setup">Battlefield Setup</a> <a href="#/deployment">Deployment</a> <a href="#/battle">Battle</a> <a href="#/">Layout Builder</a></nav></div> <!> <footer class="app-footer svelte-1n46o8q"><span>Built with love by <a href="https://github.com/barkin-aygun/wh40k-deploy" target="_blank" rel="noopener noreferrer" class="svelte-1n46o8q">@Volfied</a></span> <span class="separator svelte-1n46o8q">|</span> <span class="disclaimer svelte-1n46o8q">Warhammer 40,000 and all associated marks, logos, and images are trademarks and/or copyrights of Games Workshop Ltd. This is an unofficial fan project and is not affiliated with or endorsed by Games Workshop.</span></footer>`,1);function hf(t,a){Ka(a,!1);let n=P("main");function r(){const R=window.location.hash;R==="#/debug"?v(n,"debug"):R==="#/setup"?v(n,"setup"):R==="#/deployment"?v(n,"deployment"):R==="#/battle"?v(n,"battle"):R==="#/"||R==="#/layout"?v(n,"main"):v(n,"setup")}ws(()=>(r(),window.addEventListener("hashchange",r),()=>window.removeEventListener("hashchange",r))),en();var s=df(),i=Te(s),o=b(T(i),2),c=T(o);let m;var f=b(c,2);let d;var y=b(f,2);let u;var p=b(y,2);let g;var _=b(i,2);{var x=R=>{mf(R,{})},E=R=>{var L=ft(),S=Te(L);{var A=D=>{xm(D,{})},M=D=>{var k=ft(),I=Te(k);{var U=N=>{ch(N,{})},le=N=>{var fe=ft(),Ce=Te(fe);{var ne=ce=>{Vh(ce,{})},re=ce=>{am(ce,{})};ee(Ce,ce=>{e(n)==="battle"?ce(ne):ce(re,!1)},!0)}C(N,fe)};ee(I,N=>{e(n)==="deployment"?N(U):N(le,!1)},!0)}C(D,k)};ee(S,D=>{e(n)==="setup"?D(A):D(M,!1)},!0)}C(R,L)};ee(_,R=>{e(n)==="debug"?R(x):R(E,!1)})}K(()=>{m=Ca(c,1,"svelte-1n46o8q",null,m,{active:e(n)==="setup"}),d=Ca(f,1,"svelte-1n46o8q",null,d,{active:e(n)==="deployment"}),u=Ca(y,1,"svelte-1n46o8q",null,u,{active:e(n)==="battle"}),g=Ca(p,1,"svelte-1n46o8q",null,g,{active:e(n)==="main"})}),C(t,s),Ga()}Cc(hf,{target:document.getElementById("app")});
//# sourceMappingURL=index-3ncojlFf.js.map
