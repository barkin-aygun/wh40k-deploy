(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();const js=!1;var Os=Array.isArray,yl=Array.prototype.indexOf,Ws=Array.from,ji=Object.defineProperty,ir=Object.getOwnPropertyDescriptor,Zi=Object.getOwnPropertyDescriptors,vl=Object.prototype,gl=Array.prototype,li=Object.getPrototypeOf,Ai=Object.isExtensible;const Xa=()=>{};function bl(t){return t()}function Ms(t){for(var n=0;n<t.length;n++)t[n]()}function Ji(){var t,n,a=new Promise((s,r)=>{t=s,n=r});return{promise:a,resolve:t,reject:n}}const Mn=2,Es=4,ds=8,Qi=1<<24,Oa=16,Wa=32,pr=64,ci=128,sa=512,kn=1024,On=2048,_a=4096,jn=8192,Ia=16384,ui=32768,$r=65536,Ci=1<<17,eo=1<<18,Yr=1<<19,to=1<<20,Da=1<<25,ur=32768,Zs=1<<21,mi=1<<22,Va=1<<23,La=Symbol("$state"),Tl=Symbol("legacy props"),xl=Symbol(""),Er=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function no(){throw new Error("https://svelte.dev/e/invalid_default_snippet")}function hi(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function _l(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function wl(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Sl(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Al(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Cl(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function kl(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function Ml(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function El(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Rl(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Dl(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Il=1,Ll=2,ao=4,$l=8,Pl=16,Nl=1,Ol=2,Wl=4,Yl=8,Hl=16,ro=1,Bl=2,An=Symbol(),Fl="http://www.w3.org/1999/xhtml";function ql(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Ul(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function so(t){return t===this.v}function io(t,n){return t!=t?n==n:t!==n||t!==null&&typeof t=="object"||typeof t=="function"}function oo(t){return!io(t,this.v)}let Hr=!1,Kl=!1;function Gl(){Hr=!0}let rn=null;function Pr(t){rn=t}function Zn(t,n=!1,a){rn={p:rn,i:!1,c:null,e:null,s:t,x:null,l:Hr&&!n?{s:null,u:null,$:[]}:null}}function Jn(t){var n=rn,a=n.e;if(a!==null){n.e=null;for(var s of a)Ao(s)}return t!==void 0&&(n.x=t),n.i=!0,rn=n.p,t??{}}function fs(){return!Hr||rn!==null&&rn.l===null}let sr=[];function lo(){var t=sr;sr=[],Ms(t)}function Br(t){if(sr.length===0&&!is){var n=sr;queueMicrotask(()=>{n===sr&&lo()})}sr.push(t)}function zl(){for(;sr.length>0;)lo()}function co(t){var n=Bt;if(n===null)return kt.f|=Va,t;if((n.f&ui)===0){if((n.f&ci)===0)throw t;n.b.error(t)}else Nr(t,n)}function Nr(t,n){for(;n!==null;){if((n.f&ci)!==0)try{n.b.error(t);return}catch(a){t=a}n=n.parent}throw t}const Xl=-7169;function bn(t,n){t.f=t.f&Xl|n}function di(t){(t.f&sa)!==0||t.deps===null?bn(t,kn):bn(t,_a)}function uo(t){if(t!==null)for(const n of t)(n.f&Mn)===0||(n.f&ur)===0||(n.f^=ur,uo(n.deps))}function mo(t,n,a){(t.f&On)!==0?n.add(t):(t.f&_a)!==0&&a.add(t),uo(t.deps),bn(t,kn)}const bs=new Set;let Ot=null,ss=null,da=null,na=[],Ys=null,Js=!1,is=!1;class ba{committed=!1;current=new Map;previous=new Map;#t=new Set;#i=new Set;#e=0;#r=0;#s=null;#a=new Set;#n=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#r>0}process(n){na=[],ss=null,this.apply();var a=[],s=[];for(const r of n)this.#o(r,a,s);this.is_fork||this.#c(),this.is_deferred()?(this.#l(s),this.#l(a)):(ss=this,Ot=null,ki(s),ki(a),ss=null,this.#s?.resolve()),da=null}#o(n,a,s){n.f^=kn;for(var r=n.first,i=null;r!==null;){var l=r.f,c=(l&(Wa|pr))!==0,m=c&&(l&kn)!==0,d=m||(l&jn)!==0||this.skipped_effects.has(r);if(!d&&r.fn!==null){c?r.f^=kn:i!==null&&(l&(Es|ds|Qi))!==0?i.b.defer_effect(r):(l&Es)!==0?a.push(r):qr(r)&&((l&Oa)!==0&&this.#a.add(r),Or(r));var y=r.first;if(y!==null){r=y;continue}}var p=r.parent;for(r=r.next;r===null&&p!==null;)p===i&&(i=null),r=p.next,p=p.parent}}#l(n){for(var a=0;a<n.length;a+=1)mo(n[a],this.#a,this.#n)}capture(n,a){a!==An&&!this.previous.has(n)&&this.previous.set(n,a),(n.f&Va)===0&&(this.current.set(n,n.v),da?.set(n,n.v))}activate(){Ot=this,this.apply()}deactivate(){Ot===this&&(Ot=null,da=null)}flush(){if(this.activate(),na.length>0){if(ho(),Ot!==null&&Ot!==this)return}else this.#e===0&&this.process([]);this.deactivate()}discard(){for(const n of this.#i)n(this);this.#i.clear()}#c(){if(this.#r===0){for(const n of this.#t)n();this.#t.clear()}this.#e===0&&this.#u()}#u(){if(bs.size>1){this.previous.clear();var n=da,a=!0;for(const r of bs){if(r===this){a=!1;continue}const i=[];for(const[c,m]of this.current){if(r.current.has(c))if(a&&m!==r.current.get(c))r.current.set(c,m);else continue;i.push(c)}if(i.length===0)continue;const l=[...r.current.keys()].filter(c=>!this.current.has(c));if(l.length>0){var s=na;na=[];const c=new Set,m=new Map;for(const d of i)fo(d,l,c,m);if(na.length>0){Ot=r,r.apply();for(const d of na)r.#o(d,[],[]);r.deactivate()}na=s}}Ot=null,da=n}this.committed=!0,bs.delete(this)}increment(n){this.#e+=1,n&&(this.#r+=1)}decrement(n){this.#e-=1,n&&(this.#r-=1),this.revive()}revive(){for(const n of this.#a)this.#n.delete(n),bn(n,On),Na(n);for(const n of this.#n)bn(n,_a),Na(n);this.flush()}oncommit(n){this.#t.add(n)}ondiscard(n){this.#i.add(n)}settled(){return(this.#s??=Ji()).promise}static ensure(){if(Ot===null){const n=Ot=new ba;bs.add(Ot),is||ba.enqueue(()=>{Ot===n&&n.flush()})}return Ot}static enqueue(n){Br(n)}apply(){}}function Vl(t){var n=is;is=!0;try{for(var a;;){if(zl(),na.length===0&&(Ot?.flush(),na.length===0))return Ys=null,a;ho()}}finally{is=n}}function ho(){var t=lr;Js=!0;var n=null;try{var a=0;for(Ds(!0);na.length>0;){var s=ba.ensure();if(a++>1e3){var r,i;jl()}s.process(na),ja.clear()}}finally{Js=!1,Ds(t),Ys=null}}function jl(){try{Cl()}catch(t){Nr(t,Ys)}}let Ma=null;function ki(t){var n=t.length;if(n!==0){for(var a=0;a<n;){var s=t[a++];if((s.f&(Ia|jn))===0&&qr(s)&&(Ma=new Set,Or(s),s.deps===null&&s.first===null&&s.nodes===null&&(s.teardown===null&&s.ac===null?Eo(s):s.fn=null),Ma?.size>0)){ja.clear();for(const r of Ma){if((r.f&(Ia|jn))!==0)continue;const i=[r];let l=r.parent;for(;l!==null;)Ma.has(l)&&(Ma.delete(l),i.push(l)),l=l.parent;for(let c=i.length-1;c>=0;c--){const m=i[c];(m.f&(Ia|jn))===0&&Or(m)}}Ma.clear()}}Ma=null}}function fo(t,n,a,s){if(!a.has(t)&&(a.add(t),t.reactions!==null))for(const r of t.reactions){const i=r.f;(i&Mn)!==0?fo(r,n,a,s):(i&(mi|Oa))!==0&&(i&On)===0&&po(r,n,s)&&(bn(r,On),Na(r))}}function po(t,n,a){const s=a.get(t);if(s!==void 0)return s;if(t.deps!==null)for(const r of t.deps){if(n.includes(r))return!0;if((r.f&Mn)!==0&&po(r,n,a))return a.set(r,!0),!0}return a.set(t,!1),!1}function Na(t){for(var n=Ys=t;n.parent!==null;){n=n.parent;var a=n.f;if(Js&&n===Bt&&(a&Oa)!==0&&(a&eo)===0)return;if((a&(pr|Wa))!==0){if((a&kn)===0)return;n.f^=kn}}na.push(n)}function Zl(t){let n=0,a=mr(0),s;return()=>{yi()&&(e(a),Fr(()=>(n===0&&(s=o(()=>t(()=>os(a)))),n+=1,()=>{Br(()=>{n-=1,n===0&&(s?.(),s=void 0,os(a))})})))}}var Jl=$r|Yr|ci;function Ql(t,n,a){new ec(t,n,a)}class ec{parent;is_pending=!1;#t;#i=null;#e;#r;#s;#a=null;#n=null;#o=null;#l=null;#c=null;#u=0;#m=0;#d=!1;#f=new Set;#p=new Set;#h=null;#T=Zl(()=>(this.#h=mr(this.#u),()=>{this.#h=null}));constructor(n,a,s){this.#t=n,this.#e=a,this.#r=s,this.parent=Bt.b,this.is_pending=!!this.#e.pending,this.#s=vi(()=>{Bt.b=this;{var r=this.#g();try{this.#a=aa(()=>s(r))}catch(i){this.error(i)}this.#m>0?this.#v():this.is_pending=!1}return()=>{this.#c?.remove()}},Jl)}#x(){try{this.#a=aa(()=>this.#r(this.#t))}catch(n){this.error(n)}}#_(){const n=this.#e.pending;n&&(this.#n=aa(()=>n(this.#t)),ba.enqueue(()=>{var a=this.#g();this.#a=this.#y(()=>(ba.ensure(),aa(()=>this.#r(a)))),this.#m>0?this.#v():(or(this.#n,()=>{this.#n=null}),this.is_pending=!1)}))}#g(){var n=this.#t;return this.is_pending&&(this.#c=$a(),this.#t.before(this.#c),n=this.#c),n}defer_effect(n){mo(n,this.#f,this.#p)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#e.pending}#y(n){var a=Bt,s=kt,r=rn;xa(this.#s),Bn(this.#s),Pr(this.#s.ctx);try{return n()}catch(i){return co(i),null}finally{xa(a),Bn(s),Pr(r)}}#v(){const n=this.#e.pending;this.#a!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#c),Io(this.#a,this.#l)),this.#n===null&&(this.#n=aa(()=>n(this.#t)))}#b(n){if(!this.has_pending_snippet()){this.parent&&this.parent.#b(n);return}if(this.#m+=n,this.#m===0){this.is_pending=!1;for(const a of this.#f)bn(a,On),Na(a);for(const a of this.#p)bn(a,_a),Na(a);this.#f.clear(),this.#p.clear(),this.#n&&or(this.#n,()=>{this.#n=null}),this.#l&&(this.#t.before(this.#l),this.#l=null)}}update_pending_count(n){this.#b(n),this.#u+=n,this.#h&&hr(this.#h,this.#u)}get_effect_pending(){return this.#T(),e(this.#h)}error(n){var a=this.#e.onerror;let s=this.#e.failed;if(this.#d||!a&&!s)throw n;this.#a&&(qn(this.#a),this.#a=null),this.#n&&(qn(this.#n),this.#n=null),this.#o&&(qn(this.#o),this.#o=null);var r=!1,i=!1;const l=()=>{if(r){Ul();return}r=!0,i&&Dl(),ba.ensure(),this.#u=0,this.#o!==null&&or(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#a=this.#y(()=>(this.#d=!1,aa(()=>this.#r(this.#t)))),this.#m>0?this.#v():this.is_pending=!1};var c=kt;try{Bn(null),i=!0,a?.(n,l),i=!1}catch(m){Nr(m,this.#s&&this.#s.parent)}finally{Bn(c)}s&&Br(()=>{this.#o=this.#y(()=>{ba.ensure(),this.#d=!0;try{return aa(()=>{s(this.#t,()=>n,()=>l)})}catch(m){return Nr(m,this.#s.parent),null}finally{this.#d=!1}})})}}function tc(t,n,a,s){const r=fs()?Hs:Ce;if(a.length===0&&t.length===0){s(n.map(r));return}var i=Ot,l=Bt,c=nc();function m(){Promise.all(a.map(d=>ac(d))).then(d=>{c();try{s([...n.map(r),...d])}catch(y){(l.f&Ia)===0&&Nr(y,l)}i?.deactivate(),Rs()}).catch(d=>{Nr(d,l)})}t.length>0?Promise.all(t).then(()=>{c();try{return m()}finally{i?.deactivate(),Rs()}}):m()}function nc(){var t=Bt,n=kt,a=rn,s=Ot;return function(i=!0){xa(t),Bn(n),Pr(a),i&&s?.activate()}}function Rs(){xa(null),Bn(null),Pr(null)}function Hs(t){var n=Mn|On,a=kt!==null&&(kt.f&Mn)!==0?kt:null;return Bt!==null&&(Bt.f|=Yr),{ctx:rn,deps:null,effects:null,equals:so,f:n,fn:t,reactions:null,rv:0,v:An,wv:0,parent:a??Bt,ac:null}}function ac(t,n,a){let s=Bt;s===null&&_l();var r=s.b,i=void 0,l=mr(An),c=!kt,m=new Map;return dc(()=>{var d=Ji();i=d.promise;try{Promise.resolve(t()).then(d.resolve,d.reject).then(()=>{y===Ot&&y.committed&&y.deactivate(),Rs()})}catch(f){d.reject(f),Rs()}var y=Ot;if(c){var p=r.is_rendered();r.update_pending_count(1),y.increment(p),m.get(y)?.reject(Er),m.delete(y),m.set(y,d)}const h=(f,v=void 0)=>{if(y.activate(),v)v!==Er&&(l.f|=Va,hr(l,v));else{(l.f&Va)!==0&&(l.f^=Va),hr(l,f);for(const[k,b]of m){if(m.delete(k),k===y)break;b.reject(Er)}}c&&(r.update_pending_count(-1),y.decrement(p))};d.promise.then(h,f=>h(null,f||"unknown"))}),ys(()=>{for(const d of m.values())d.reject(Er)}),new Promise(d=>{function y(p){function h(){p===i?d(l):y(i)}p.then(h,h)}y(i)})}function Ce(t){const n=Hs(t);return n.equals=oo,n}function yo(t){var n=t.effects;if(n!==null){t.effects=null;for(var a=0;a<n.length;a+=1)qn(n[a])}}function rc(t){for(var n=t.parent;n!==null;){if((n.f&Mn)===0)return(n.f&Ia)===0?n:null;n=n.parent}return null}function fi(t){var n,a=Bt;xa(rc(t));try{t.f&=~ur,yo(t),n=Oo(t)}finally{xa(a)}return n}function vo(t){var n=fi(t);if(!t.equals(n)&&(t.wv=Po(),(!Ot?.is_fork||t.deps===null)&&(t.v=n,t.deps===null))){bn(t,kn);return}Ja||(da!==null?(yi()||Ot?.is_fork)&&da.set(t,n):di(t))}let Qs=new Set;const ja=new Map;let go=!1;function mr(t,n){var a={f:0,v:t,reactions:null,equals:so,rv:0,wv:0};return a}function Fa(t,n){const a=mr(t);return vc(a),a}function Y(t,n=!1,a=!0){const s=mr(t);return n||(s.equals=oo),Hr&&a&&rn!==null&&rn.l!==null&&(rn.l.s??=[]).push(s),s}function Ks(t,n){return g(t,o(()=>e(t))),n}function g(t,n,a=!1){kt!==null&&(!fa||(kt.f&Ci)!==0)&&fs()&&(kt.f&(Mn|Oa|mi|Ci))!==0&&!Pa?.includes(t)&&Rl();let s=a?Rr(n):n;return hr(t,s)}function hr(t,n){if(!t.equals(n)){var a=t.v;Ja?ja.set(t,n):ja.set(t,a),t.v=n;var s=ba.ensure();if(s.capture(t,a),(t.f&Mn)!==0){const r=t;(t.f&On)!==0&&fi(r),di(r)}t.wv=Po(),bo(t,On),fs()&&Bt!==null&&(Bt.f&kn)!==0&&(Bt.f&(Wa|pr))===0&&(ta===null?gc([t]):ta.push(t)),!s.is_fork&&Qs.size>0&&!go&&sc()}return n}function sc(){go=!1;var t=lr;Ds(!0);const n=Array.from(Qs);try{for(const a of n)(a.f&kn)!==0&&bn(a,_a),qr(a)&&Or(a)}finally{Ds(t)}Qs.clear()}function os(t){g(t,t.v+1)}function bo(t,n){var a=t.reactions;if(a!==null)for(var s=fs(),r=a.length,i=0;i<r;i++){var l=a[i],c=l.f;if(!(!s&&l===Bt)){var m=(c&On)===0;if(m&&bn(l,n),(c&Mn)!==0){var d=l;da?.delete(d),(c&ur)===0&&(c&sa&&(l.f|=ur),bo(d,_a))}else m&&((c&Oa)!==0&&Ma!==null&&Ma.add(l),Na(l))}}}function Rr(t){if(typeof t!="object"||t===null||La in t)return t;const n=li(t);if(n!==vl&&n!==gl)return t;var a=new Map,s=Os(t),r=Fa(0),i=cr,l=c=>{if(cr===i)return c();var m=kt,d=cr;Bn(null),Di(i);var y=c();return Bn(m),Di(d),y};return s&&a.set("length",Fa(t.length)),new Proxy(t,{defineProperty(c,m,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&Ml();var y=a.get(m);return y===void 0?y=l(()=>{var p=Fa(d.value);return a.set(m,p),p}):g(y,d.value,!0),!0},deleteProperty(c,m){var d=a.get(m);if(d===void 0){if(m in c){const y=l(()=>Fa(An));a.set(m,y),os(r)}}else g(d,An),os(r);return!0},get(c,m,d){if(m===La)return t;var y=a.get(m),p=m in c;if(y===void 0&&(!p||ir(c,m)?.writable)&&(y=l(()=>{var f=Rr(p?c[m]:An),v=Fa(f);return v}),a.set(m,y)),y!==void 0){var h=e(y);return h===An?void 0:h}return Reflect.get(c,m,d)},getOwnPropertyDescriptor(c,m){var d=Reflect.getOwnPropertyDescriptor(c,m);if(d&&"value"in d){var y=a.get(m);y&&(d.value=e(y))}else if(d===void 0){var p=a.get(m),h=p?.v;if(p!==void 0&&h!==An)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return d},has(c,m){if(m===La)return!0;var d=a.get(m),y=d!==void 0&&d.v!==An||Reflect.has(c,m);if(d!==void 0||Bt!==null&&(!y||ir(c,m)?.writable)){d===void 0&&(d=l(()=>{var h=y?Rr(c[m]):An,f=Fa(h);return f}),a.set(m,d));var p=e(d);if(p===An)return!1}return y},set(c,m,d,y){var p=a.get(m),h=m in c;if(s&&m==="length")for(var f=d;f<p.v;f+=1){var v=a.get(f+"");v!==void 0?g(v,An):f in c&&(v=l(()=>Fa(An)),a.set(f+"",v))}if(p===void 0)(!h||ir(c,m)?.writable)&&(p=l(()=>Fa(void 0)),g(p,Rr(d)),a.set(m,p));else{h=p.v!==An;var k=l(()=>Rr(d));g(p,k)}var b=Reflect.getOwnPropertyDescriptor(c,m);if(b?.set&&b.set.call(y,d),!h){if(s&&typeof m=="string"){var M=a.get("length"),P=Number(m);Number.isInteger(P)&&P>=M.v&&g(M,P+1)}os(r)}return!0},ownKeys(c){e(r);var m=Reflect.ownKeys(c).filter(p=>{var h=a.get(p);return h===void 0||h.v!==An});for(var[d,y]of a)y.v!==An&&!(d in c)&&m.push(d);return m},setPrototypeOf(){El()}})}function Mi(t){try{if(t!==null&&typeof t=="object"&&La in t)return t[La]}catch{}return t}function ic(t,n){return Object.is(Mi(t),Mi(n))}var Dr,To,xo,_o;function oc(){if(Dr===void 0){Dr=window,To=/Firefox/.test(navigator.userAgent);var t=Element.prototype,n=Node.prototype,a=Text.prototype;xo=ir(n,"firstChild").get,_o=ir(n,"nextSibling").get,Ai(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Ai(a)&&(a.__t=void 0)}}function $a(t=""){return document.createTextNode(t)}function Ra(t){return xo.call(t)}function ps(t){return _o.call(t)}function w(t,n){return Ra(t)}function ce(t,n=!1){{var a=Ra(t);return a instanceof Comment&&a.data===""?ps(a):a}}function T(t,n=1,a=!1){let s=t;for(;n--;)s=ps(s);return s}function lc(t){t.textContent=""}function wo(){return!1}let Ei=!1;function cc(){Ei||(Ei=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const n of t.target.elements)n.__on_r?.()})},{capture:!0}))}function Bs(t){var n=kt,a=Bt;Bn(null),xa(null);try{return t()}finally{Bn(n),xa(a)}}function pi(t,n,a,s=a){t.addEventListener(n,()=>Bs(a));const r=t.__on_r;r?t.__on_r=()=>{r(),s(!0)}:t.__on_r=()=>s(!0),cc()}function So(t){Bt===null&&(kt===null&&Al(),Sl()),Ja&&wl()}function uc(t,n){var a=n.last;a===null?n.last=n.first=t:(a.next=t,t.prev=a,n.last=t)}function wa(t,n,a){var s=Bt;s!==null&&(s.f&jn)!==0&&(t|=jn);var r={ctx:rn,deps:null,nodes:null,f:t|On|sa,first:null,fn:n,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,wv:0,ac:null};if(a)try{Or(r),r.f|=ui}catch(c){throw qn(r),c}else n!==null&&Na(r);var i=r;if(a&&i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&Yr)===0&&(i=i.first,(t&Oa)!==0&&(t&$r)!==0&&i!==null&&(i.f|=$r)),i!==null&&(i.parent=s,s!==null&&uc(i,s),kt!==null&&(kt.f&Mn)!==0&&(t&pr)===0)){var l=kt;(l.effects??=[]).push(i)}return r}function yi(){return kt!==null&&!fa}function ys(t){const n=wa(ds,null,!1);return bn(n,kn),n.teardown=t,n}function ei(t){So();var n=Bt.f,a=!kt&&(n&Wa)!==0&&(n&ui)===0;if(a){var s=rn;(s.e??=[]).push(t)}else return Ao(t)}function Ao(t){return wa(Es|to,t,!1)}function mc(t){return So(),wa(ds|to,t,!0)}function hc(t){ba.ensure();const n=wa(pr|Yr,t,!0);return(a={})=>new Promise(s=>{a.outro?or(n,()=>{qn(n),s(void 0)}):(qn(n),s(void 0))})}function Co(t){return wa(Es,t,!1)}function he(t,n){var a=rn,s={effect:null,ran:!1,deps:t};a.l.$.push(s),s.effect=Fr(()=>{t(),!s.ran&&(s.ran=!0,o(n))})}function Ya(){var t=rn;Fr(()=>{for(var n of t.l.$){n.deps();var a=n.effect;(a.f&kn)!==0&&a.deps!==null&&bn(a,_a),qr(a)&&Or(a),n.ran=!1}})}function dc(t){return wa(mi|Yr,t,!0)}function Fr(t,n=0){return wa(ds|n,t,!0)}function X(t,n=[],a=[],s=[]){tc(s,n,a,r=>{wa(ds,()=>t(...r.map(e)),!0)})}function vi(t,n=0){var a=wa(Oa|n,t,!0);return a}function aa(t){return wa(Wa|Yr,t,!0)}function ko(t){var n=t.teardown;if(n!==null){const a=Ja,s=kt;Ri(!0),Bn(null);try{n.call(null)}finally{Ri(a),Bn(s)}}}function Mo(t,n=!1){var a=t.first;for(t.first=t.last=null;a!==null;){const r=a.ac;r!==null&&Bs(()=>{r.abort(Er)});var s=a.next;(a.f&pr)!==0?a.parent=null:qn(a,n),a=s}}function fc(t){for(var n=t.first;n!==null;){var a=n.next;(n.f&Wa)===0&&qn(n),n=a}}function qn(t,n=!0){var a=!1;(n||(t.f&eo)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(pc(t.nodes.start,t.nodes.end),a=!0),Mo(t,n&&!a),Is(t,0),bn(t,Ia);var s=t.nodes&&t.nodes.t;if(s!==null)for(const i of s)i.stop();ko(t);var r=t.parent;r!==null&&r.first!==null&&Eo(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function pc(t,n){for(;t!==null;){var a=t===n?null:ps(t);t.remove(),t=a}}function Eo(t){var n=t.parent,a=t.prev,s=t.next;a!==null&&(a.next=s),s!==null&&(s.prev=a),n!==null&&(n.first===t&&(n.first=s),n.last===t&&(n.last=a))}function or(t,n,a=!0){var s=[];Ro(t,s,!0);var r=()=>{a&&qn(t),n&&n()},i=s.length;if(i>0){var l=()=>--i||r();for(var c of s)c.out(l)}else r()}function Ro(t,n,a){if((t.f&jn)===0){t.f^=jn;var s=t.nodes&&t.nodes.t;if(s!==null)for(const c of s)(c.is_global||a)&&n.push(c);for(var r=t.first;r!==null;){var i=r.next,l=(r.f&$r)!==0||(r.f&Wa)!==0&&(t.f&Oa)!==0;Ro(r,n,l?a:!1),r=i}}}function gi(t){Do(t,!0)}function Do(t,n){if((t.f&jn)!==0){t.f^=jn,(t.f&kn)===0&&(bn(t,On),Na(t));for(var a=t.first;a!==null;){var s=a.next,r=(a.f&$r)!==0||(a.f&Wa)!==0;Do(a,r?n:!1),a=s}var i=t.nodes&&t.nodes.t;if(i!==null)for(const l of i)(l.is_global||n)&&l.in()}}function Io(t,n){if(t.nodes)for(var a=t.nodes.start,s=t.nodes.end;a!==null;){var r=a===s?null:ps(a);n.append(a),a=r}}let kr=null;function yc(t){var n=kr;try{if(kr=new Set,o(t),n!==null)for(var a of kr)n.add(a);return kr}finally{kr=n}}function Lo(t){for(var n of yc(t))hr(n,n.v)}let lr=!1;function Ds(t){lr=t}let Ja=!1;function Ri(t){Ja=t}let kt=null,fa=!1;function Bn(t){kt=t}let Bt=null;function xa(t){Bt=t}let Pa=null;function vc(t){kt!==null&&(Pa===null?Pa=[t]:Pa.push(t))}let Nn=null,zn=0,ta=null;function gc(t){ta=t}let $o=1,us=0,cr=us;function Di(t){cr=t}function Po(){return++$o}function qr(t){var n=t.f;if((n&On)!==0)return!0;if(n&Mn&&(t.f&=~ur),(n&_a)!==0){for(var a=t.deps,s=a.length,r=0;r<s;r++){var i=a[r];if(qr(i)&&vo(i),i.wv>t.wv)return!0}(n&sa)!==0&&da===null&&bn(t,kn)}return!1}function No(t,n,a=!0){var s=t.reactions;if(s!==null&&!Pa?.includes(t))for(var r=0;r<s.length;r++){var i=s[r];(i.f&Mn)!==0?No(i,n,!1):n===i&&(a?bn(i,On):(i.f&kn)!==0&&bn(i,_a),Na(i))}}function Oo(t){var n=Nn,a=zn,s=ta,r=kt,i=Pa,l=rn,c=fa,m=cr,d=t.f;Nn=null,zn=0,ta=null,kt=(d&(Wa|pr))===0?t:null,Pa=null,Pr(t.ctx),fa=!1,cr=++us,t.ac!==null&&(Bs(()=>{t.ac.abort(Er)}),t.ac=null);try{t.f|=Zs;var y=t.fn,p=y(),h=t.deps;if(Nn!==null){var f;if(Is(t,zn),h!==null&&zn>0)for(h.length=zn+Nn.length,f=0;f<Nn.length;f++)h[zn+f]=Nn[f];else t.deps=h=Nn;if(yi()&&(t.f&sa)!==0)for(f=zn;f<h.length;f++)(h[f].reactions??=[]).push(t)}else h!==null&&zn<h.length&&(Is(t,zn),h.length=zn);if(fs()&&ta!==null&&!fa&&h!==null&&(t.f&(Mn|_a|On))===0)for(f=0;f<ta.length;f++)No(ta[f],t);return r!==null&&r!==t&&(us++,ta!==null&&(s===null?s=ta:s.push(...ta))),(t.f&Va)!==0&&(t.f^=Va),p}catch(v){return co(v)}finally{t.f^=Zs,Nn=n,zn=a,ta=s,kt=r,Pa=i,Pr(l),fa=c,cr=m}}function bc(t,n){let a=n.reactions;if(a!==null){var s=yl.call(a,t);if(s!==-1){var r=a.length-1;r===0?a=n.reactions=null:(a[s]=a[r],a.pop())}}if(a===null&&(n.f&Mn)!==0&&(Nn===null||!Nn.includes(n))){var i=n;(i.f&sa)!==0&&(i.f^=sa,i.f&=~ur),di(i),yo(i),Is(i,0)}}function Is(t,n){var a=t.deps;if(a!==null)for(var s=n;s<a.length;s++)bc(t,a[s])}function Or(t){var n=t.f;if((n&Ia)===0){bn(t,kn);var a=Bt,s=lr;Bt=t,lr=!0;try{(n&(Oa|Qi))!==0?fc(t):Mo(t),ko(t);var r=Oo(t);t.teardown=typeof r=="function"?r:null,t.wv=$o;var i;js&&Kl&&(t.f&On)!==0&&t.deps}finally{lr=s,Bt=a}}}async function Tc(){await Promise.resolve(),Vl()}function e(t){var n=t.f,a=(n&Mn)!==0;if(kr?.add(t),kt!==null&&!fa){var s=Bt!==null&&(Bt.f&Ia)!==0;if(!s&&!Pa?.includes(t)){var r=kt.deps;if((kt.f&Zs)!==0)t.rv<us&&(t.rv=us,Nn===null&&r!==null&&r[zn]===t?zn++:Nn===null?Nn=[t]:Nn.includes(t)||Nn.push(t));else{(kt.deps??=[]).push(t);var i=t.reactions;i===null?t.reactions=[kt]:i.includes(kt)||i.push(kt)}}}if(Ja&&ja.has(t))return ja.get(t);if(a){var l=t;if(Ja){var c=l.v;return((l.f&kn)===0&&l.reactions!==null||Yo(l))&&(c=fi(l)),ja.set(l,c),c}var m=(l.f&sa)===0&&!fa&&kt!==null&&(lr||(kt.f&sa)!==0),d=l.deps===null;qr(l)&&(m&&(l.f|=sa),vo(l)),m&&!d&&Wo(l)}if(da?.has(t))return da.get(t);if((t.f&Va)!==0)throw t.v;return t.v}function Wo(t){if(t.deps!==null){t.f|=sa;for(const n of t.deps)(n.reactions??=[]).push(t),(n.f&Mn)!==0&&(n.f&sa)===0&&Wo(n)}}function Yo(t){if(t.v===An)return!0;if(t.deps===null)return!1;for(const n of t.deps)if(ja.has(n)||(n.f&Mn)!==0&&Yo(n))return!0;return!1}function o(t){var n=fa;try{return fa=!0,t()}finally{fa=n}}function L(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(La in t)ti(t);else if(!Array.isArray(t))for(let n in t){const a=t[n];typeof a=="object"&&a&&La in a&&ti(a)}}}function ti(t,n=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!n.has(t)){n.add(t),t instanceof Date&&t.getTime();for(let s in t)try{ti(t[s],n)}catch{}const a=li(t);if(a!==Object.prototype&&a!==Array.prototype&&a!==Map.prototype&&a!==Set.prototype&&a!==Date.prototype){const s=Zi(a);for(let r in s){const i=s[r].get;if(i)try{i.call(t)}catch{}}}}}const xc=["touchstart","touchmove"];function _c(t){return xc.includes(t)}const wc=new Set,Ii=new Set;function Sc(t,n,a,s={}){function r(i){if(s.capture||ns.call(n,i),!i.cancelBubble)return Bs(()=>a?.call(this,i))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Br(()=>{n.addEventListener(t,r,s)}):n.addEventListener(t,r,s),r}function oe(t,n,a,s,r){var i={capture:s,passive:r},l=Sc(t,n,a,i);(n===document.body||n===window||n===document||n instanceof HTMLMediaElement)&&ys(()=>{n.removeEventListener(t,l,i)})}let Li=null;function ns(t){var n=this,a=n.ownerDocument,s=t.type,r=t.composedPath?.()||[],i=r[0]||t.target;Li=t;var l=0,c=Li===t&&t.__root;if(c){var m=r.indexOf(c);if(m!==-1&&(n===document||n===window)){t.__root=n;return}var d=r.indexOf(n);if(d===-1)return;m<=d&&(l=m)}if(i=r[l]||t.target,i!==n){ji(t,"currentTarget",{configurable:!0,get(){return i||a}});var y=kt,p=Bt;Bn(null),xa(null);try{for(var h,f=[];i!==null;){var v=i.assignedSlot||i.parentNode||i.host||null;try{var k=i["__"+s];k!=null&&(!i.disabled||t.target===i)&&k.call(i,t)}catch(b){h?f.push(b):h=b}if(t.cancelBubble||v===n||v===null)break;i=v}if(h){for(let b of f)queueMicrotask(()=>{throw b});throw h}}finally{t.__root=n,delete t.currentTarget,Bn(y),xa(p)}}}function Ho(t){var n=document.createElement("template");return n.innerHTML=t.replaceAll("<!>","<!---->"),n.content}function Wr(t,n){var a=Bt;a.nodes===null&&(a.nodes={start:t,end:n,a:null,t:null})}function Se(t,n){var a=(n&ro)!==0,s=(n&Bl)!==0,r,i=!t.startsWith("<!>");return()=>{r===void 0&&(r=Ho(i?t:"<!>"+t),a||(r=Ra(r)));var l=s||To?document.importNode(r,!0):r.cloneNode(!0);if(a){var c=Ra(l),m=l.lastChild;Wr(c,m)}else Wr(l,l);return l}}function Ac(t,n,a="svg"){var s=!t.startsWith("<!>"),r=(n&ro)!==0,i=`<${a}>${s?t:"<!>"+t}</${a}>`,l;return()=>{if(!l){var c=Ho(i),m=Ra(c);if(r)for(l=document.createDocumentFragment();Ra(m);)l.appendChild(Ra(m));else l=Ra(m)}var d=l.cloneNode(!0);if(r){var y=Ra(d),p=d.lastChild;Wr(y,p)}else Wr(d,d);return d}}function le(t,n){return Ac(t,n,"svg")}function Bo(t=""){{var n=$a(t+"");return Wr(n,n),n}}function qe(){var t=document.createDocumentFragment(),n=document.createComment(""),a=$a();return t.append(n,a),Wr(n,a),t}function A(t,n){t!==null&&t.before(n)}function Ye(t,n){var a=n==null?"":typeof n=="object"?n+"":n;a!==(t.__t??=t.nodeValue)&&(t.__t=a,t.nodeValue=a+"")}function Cc(t,n){return kc(t,n)}const Sr=new Map;function kc(t,{target:n,anchor:a,props:s={},events:r,context:i,intro:l=!0}){oc();var c=new Set,m=p=>{for(var h=0;h<p.length;h++){var f=p[h];if(!c.has(f)){c.add(f);var v=_c(f);n.addEventListener(f,ns,{passive:v});var k=Sr.get(f);k===void 0?(document.addEventListener(f,ns,{passive:v}),Sr.set(f,1)):Sr.set(f,k+1)}}};m(Ws(wc)),Ii.add(m);var d=void 0,y=hc(()=>{var p=a??n.appendChild($a());return Ql(p,{pending:()=>{}},h=>{if(i){Zn({});var f=rn;f.c=i}r&&(s.$$events=r),d=t(h,s)||{},i&&Jn()}),()=>{for(var h of c){n.removeEventListener(h,ns);var f=Sr.get(h);--f===0?(document.removeEventListener(h,ns),Sr.delete(h)):Sr.set(h,f)}Ii.delete(m),p!==a&&p.parentNode?.removeChild(p)}});return Mc.set(d,y),d}let Mc=new WeakMap;class Ec{anchor;#t=new Map;#i=new Map;#e=new Map;#r=new Set;#s=!0;constructor(n,a=!0){this.anchor=n,this.#s=a}#a=()=>{var n=Ot;if(this.#t.has(n)){var a=this.#t.get(n),s=this.#i.get(a);if(s)gi(s),this.#r.delete(a);else{var r=this.#e.get(a);r&&(this.#i.set(a,r.effect),this.#e.delete(a),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),s=r.effect)}for(const[i,l]of this.#t){if(this.#t.delete(i),i===n)break;const c=this.#e.get(l);c&&(qn(c.effect),this.#e.delete(l))}for(const[i,l]of this.#i){if(i===a||this.#r.has(i))continue;const c=()=>{if(Array.from(this.#t.values()).includes(i)){var d=document.createDocumentFragment();Io(l,d),d.append($a()),this.#e.set(i,{effect:l,fragment:d})}else qn(l);this.#r.delete(i),this.#i.delete(i)};this.#s||!s?(this.#r.add(i),or(l,c,!1)):c()}}};#n=n=>{this.#t.delete(n);const a=Array.from(this.#t.values());for(const[s,r]of this.#e)a.includes(s)||(qn(r.effect),this.#e.delete(s))};ensure(n,a){var s=Ot,r=wo();if(a&&!this.#i.has(n)&&!this.#e.has(n))if(r){var i=document.createDocumentFragment(),l=$a();i.append(l),this.#e.set(n,{effect:aa(()=>a(l)),fragment:i})}else this.#i.set(n,aa(()=>a(this.anchor)));if(this.#t.set(s,n),r){for(const[c,m]of this.#i)c===n?s.skipped_effects.delete(m):s.skipped_effects.add(m);for(const[c,m]of this.#e)c===n?s.skipped_effects.delete(m.effect):s.skipped_effects.add(m.effect);s.oncommit(this.#a),s.ondiscard(this.#n)}else this.#a()}}function Z(t,n,a=!1){var s=new Ec(t),r=a?$r:0;function i(l,c){s.ensure(l,c)}vi(()=>{var l=!1;n((c,m=!0)=>{l=!0,i(m,c)}),l||i(!1,null)},r)}function ft(t,n){return n}function Rc(t,n,a){for(var s=[],r=n.length,i,l=n.length,c=0;c<r;c++){let p=n[c];or(p,()=>{if(i){if(i.pending.delete(p),i.done.add(p),i.pending.size===0){var h=t.outrogroups;ni(Ws(i.done)),h.delete(i),h.size===0&&(t.outrogroups=null)}}else l-=1},!1)}if(l===0){var m=s.length===0&&a!==null;if(m){var d=a,y=d.parentNode;lc(y),y.append(d),t.items.clear()}ni(n,!m)}else i={pending:new Set(n),done:new Set},(t.outrogroups??=new Set).add(i)}function ni(t,n=!0){for(var a=0;a<t.length;a++)qn(t[a],n)}var $i;function je(t,n,a,s,r,i=null){var l=t,c=new Map,m=(n&ao)!==0;if(m){var d=t;l=d.appendChild($a())}var y=null,p=Ce(()=>{var M=a();return Os(M)?M:M==null?[]:Ws(M)}),h,f=!0;function v(){b.fallback=y,Dc(b,h,l,n,s),y!==null&&(h.length===0?(y.f&Da)===0?gi(y):(y.f^=Da,as(y,null,l)):or(y,()=>{y=null}))}var k=vi(()=>{h=e(p);for(var M=h.length,P=new Set,E=Ot,S=wo(),I=0;I<M;I+=1){var $=h[I],U=s($,I),B=f?null:c.get(U);B?(B.v&&hr(B.v,$),B.i&&hr(B.i,I),S&&E.skipped_effects.delete(B.e)):(B=Ic(c,f?l:$i??=$a(),$,U,I,r,n,a),f||(B.e.f|=Da),c.set(U,B)),P.add(U)}if(M===0&&i&&!y&&(f?y=aa(()=>i(l)):(y=aa(()=>i($i??=$a())),y.f|=Da)),!f)if(S){for(const[G,q]of c)P.has(G)||E.skipped_effects.add(q.e);E.oncommit(v),E.ondiscard(()=>{})}else v();e(p)}),b={effect:k,items:c,outrogroups:null,fallback:y};f=!1}function Dc(t,n,a,s,r){var i=(s&$l)!==0,l=n.length,c=t.items,m=t.effect.first,d,y=null,p,h=[],f=[],v,k,b,M;if(i)for(M=0;M<l;M+=1)v=n[M],k=r(v,M),b=c.get(k).e,(b.f&Da)===0&&(b.nodes?.a?.measure(),(p??=new Set).add(b));for(M=0;M<l;M+=1){if(v=n[M],k=r(v,M),b=c.get(k).e,t.outrogroups!==null)for(const q of t.outrogroups)q.pending.delete(b),q.done.delete(b);if((b.f&Da)!==0)if(b.f^=Da,b===m)as(b,null,a);else{var P=y?y.next:m;b===t.effect.last&&(t.effect.last=b.prev),b.prev&&(b.prev.next=b.next),b.next&&(b.next.prev=b.prev),qa(t,y,b),qa(t,b,P),as(b,P,a),y=b,h=[],f=[],m=y.next;continue}if((b.f&jn)!==0&&(gi(b),i&&(b.nodes?.a?.unfix(),(p??=new Set).delete(b))),b!==m){if(d!==void 0&&d.has(b)){if(h.length<f.length){var E=f[0],S;y=E.prev;var I=h[0],$=h[h.length-1];for(S=0;S<h.length;S+=1)as(h[S],E,a);for(S=0;S<f.length;S+=1)d.delete(f[S]);qa(t,I.prev,$.next),qa(t,y,I),qa(t,$,E),m=E,y=$,M-=1,h=[],f=[]}else d.delete(b),as(b,m,a),qa(t,b.prev,b.next),qa(t,b,y===null?t.effect.first:y.next),qa(t,y,b),y=b;continue}for(h=[],f=[];m!==null&&m!==b;)(d??=new Set).add(m),f.push(m),m=m.next;if(m===null)continue}(b.f&Da)===0&&h.push(b),y=b,m=b.next}if(t.outrogroups!==null){for(const q of t.outrogroups)q.pending.size===0&&(ni(Ws(q.done)),t.outrogroups?.delete(q));t.outrogroups.size===0&&(t.outrogroups=null)}if(m!==null||d!==void 0){var U=[];if(d!==void 0)for(b of d)(b.f&jn)===0&&U.push(b);for(;m!==null;)(m.f&jn)===0&&m!==t.fallback&&U.push(m),m=m.next;var B=U.length;if(B>0){var G=(s&ao)!==0&&l===0?a:null;if(i){for(M=0;M<B;M+=1)U[M].nodes?.a?.measure();for(M=0;M<B;M+=1)U[M].nodes?.a?.fix()}Rc(t,U,G)}}i&&Br(()=>{if(p!==void 0)for(b of p)b.nodes?.a?.apply()})}function Ic(t,n,a,s,r,i,l,c){var m=(l&Il)!==0?(l&Pl)===0?Y(a,!1,!1):mr(a):null,d=(l&Ll)!==0?mr(r):null;return{v:m,i:d,e:aa(()=>(i(n,m??a,d??r,c),()=>{t.delete(s)}))}}function as(t,n,a){if(t.nodes)for(var s=t.nodes.start,r=t.nodes.end,i=n&&(n.f&Da)===0?n.nodes.start:a;s!==null;){var l=ps(s);if(i.before(s),s===r)return;s=l}}function qa(t,n,a){n===null?t.effect.first=a:n.next=a,a===null?t.effect.last=n:a.prev=n}function Fo(t,n,a,s,r){var i=n.$$slots?.[a],l=!1;i===!0&&(i=n.children,l=!0),i===void 0||i(t,l?()=>s:s)}const Pi=[...` 	
\r\f \v\uFEFF`];function Lc(t,n,a){var s=t==null?"":""+t;if(a){for(var r in a)if(a[r])s=s?s+" "+r:r;else if(s.length)for(var i=r.length,l=0;(l=s.indexOf(r,l))>=0;){var c=l+i;(l===0||Pi.includes(s[l-1]))&&(c===s.length||Pi.includes(s[c]))?s=(l===0?"":s.substring(0,l))+s.substring(c+1):l=c}}return s===""?null:s}function $c(t,n){return t==null?null:String(t)}function wn(t,n,a,s,r,i){var l=t.__className;if(l!==a||l===void 0){var c=Lc(a,s,i);c==null?t.removeAttribute("class"):n?t.className=c:t.setAttribute("class",c),t.__className=a}else if(i&&r!==i)for(var m in i){var d=!!i[m];(r==null||d!==!!r[m])&&t.classList.toggle(m,d)}return i}function Pc(t,n,a,s){var r=t.__style;if(r!==n){var i=$c(n);i==null?t.removeAttribute("style"):t.style.cssText=i,t.__style=n}return s}function qo(t,n,a=!1){if(t.multiple){if(n==null)return;if(!Os(n))return ql();for(var s of t.options)s.selected=n.includes(ls(s));return}for(s of t.options){var r=ls(s);if(ic(r,n)){s.selected=!0;return}}(!a||n!==void 0)&&(t.selectedIndex=-1)}function Nc(t){var n=new MutationObserver(()=>{qo(t,t.__value)});n.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ys(()=>{n.disconnect()})}function Uo(t,n,a=n){var s=new WeakSet,r=!0;pi(t,"change",i=>{var l=i?"[selected]":":checked",c;if(t.multiple)c=[].map.call(t.querySelectorAll(l),ls);else{var m=t.querySelector(l)??t.querySelector("option:not([disabled])");c=m&&ls(m)}a(c),Ot!==null&&s.add(Ot)}),Co(()=>{var i=n();if(t===document.activeElement){var l=ss??Ot;if(s.has(l))return}if(qo(t,i,r),r&&i===void 0){var c=t.querySelector(":checked");c!==null&&(i=ls(c),a(i))}t.__value=i,r=!1}),Nc(t)}function ls(t){return"__value"in t?t.__value:t.value}const Oc=Symbol("is custom element"),Wc=Symbol("is html");function Ko(t,n){var a=Go(t);a.value===(a.value=n??void 0)||t.value===n&&(n!==0||t.nodeName!=="PROGRESS")||(t.value=n??"")}function u(t,n,a,s){var r=Go(t);r[n]!==(r[n]=a)&&(n==="loading"&&(t[xl]=a),a==null?t.removeAttribute(n):typeof a!="string"&&Yc(t).includes(n)?t[n]=a:t.setAttribute(n,a))}function Go(t){return t.__attributes??={[Oc]:t.nodeName.includes("-"),[Wc]:t.namespaceURI===Fl}}var Ni=new Map;function Yc(t){var n=t.getAttribute("is")||t.nodeName,a=Ni.get(n);if(a)return a;Ni.set(n,a=[]);for(var s,r=t,i=Element.prototype;i!==r;){s=Zi(r);for(var l in s)s[l].set&&a.push(l);r=li(r)}return a}function ai(t,n,a=n){var s=new WeakSet;pi(t,"input",async r=>{var i=r?t.defaultValue:t.value;if(i=Gs(t)?zs(i):i,a(i),Ot!==null&&s.add(Ot),await Tc(),i!==(i=n())){var l=t.selectionStart,c=t.selectionEnd,m=t.value.length;if(t.value=i??"",c!==null){var d=t.value.length;l===c&&c===m&&d>m?(t.selectionStart=d,t.selectionEnd=d):(t.selectionStart=l,t.selectionEnd=Math.min(c,d))}}}),o(n)==null&&t.value&&(a(Gs(t)?zs(t.value):t.value),Ot!==null&&s.add(Ot)),Fr(()=>{var r=n();if(t===document.activeElement){var i=ss??Ot;if(s.has(i))return}Gs(t)&&r===zs(t.value)||t.type==="date"&&!r&&!t.value||r!==t.value&&(t.value=r??"")})}function _n(t,n,a=n){pi(t,"change",s=>{var r=s?t.defaultChecked:t.checked;a(r)}),o(n)==null&&a(t.checked),Fr(()=>{var s=n();t.checked=!!s})}function Gs(t){var n=t.type;return n==="number"||n==="range"}function zs(t){return t===""?null:+t}function rs(t,n,a){var s=ir(t,n);s&&s.set&&(t[n]=a,ys(()=>{t[n]=null}))}function Oi(t,n){return t===n||t?.[La]===n}function ms(t={},n,a,s){return Co(()=>{var r,i;return Fr(()=>{r=i,i=[],o(()=>{t!==a(...i)&&(n(t,...i),r&&Oi(a(...r),t)&&n(null,...r))})}),()=>{Br(()=>{i&&Oi(a(...i),t)&&n(null,...i)})}}),t}function ia(t=!1){const n=rn,a=n.l.u;if(!a)return;let s=()=>L(n.s);if(t){let r=0,i={};const l=Hs(()=>{let c=!1;const m=n.s;for(const d in m)m[d]!==i[d]&&(i[d]=m[d],c=!0);return c&&r++,r});s=()=>e(l)}a.b.length&&mc(()=>{Wi(n,s),Ms(a.b)}),ei(()=>{const r=o(()=>a.m.map(bl));return()=>{for(const i of r)typeof i=="function"&&i()}}),a.a.length&&ei(()=>{Wi(n,s),Ms(a.a)})}function Wi(t,n){if(t.l.s)for(const a of t.l.s)e(a);n()}function bi(t,n,a){if(t==null)return n(void 0),a&&a(void 0),Xa;const s=o(()=>t.subscribe(n,a));return s.unsubscribe?()=>s.unsubscribe():s}const Ar=[];function Hc(t,n){return{subscribe:Tn(t,n).subscribe}}function Tn(t,n=Xa){let a=null;const s=new Set;function r(c){if(io(t,c)&&(t=c,a)){const m=!Ar.length;for(const d of s)d[1](),Ar.push(d,t);if(m){for(let d=0;d<Ar.length;d+=2)Ar[d][0](Ar[d+1]);Ar.length=0}}}function i(c){r(c(t))}function l(c,m=Xa){const d=[c,m];return s.add(d),s.size===1&&(a=n(r,i)||Xa),c(t),()=>{s.delete(d),s.size===0&&a&&(a(),a=null)}}return{set:r,update:i,subscribe:l}}function Sa(t,n,a){const s=!Array.isArray(t),r=s?[t]:t;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=n.length<2;return Hc(a,(l,c)=>{let m=!1;const d=[];let y=0,p=Xa;const h=()=>{if(y)return;p();const v=n(s?d[0]:d,l,c);i?l(v):p=typeof v=="function"?v:Xa},f=r.map((v,k)=>bi(v,b=>{d[k]=b,y&=~(1<<k),m&&h()},()=>{y|=1<<k}));return m=!0,h(),function(){Ms(f),p(),m=!1}})}function ma(t){let n;return bi(t,a=>n=a)(),n}let Ts=!1,ri=Symbol();function Ht(t,n,a){const s=a[n]??={store:null,source:Y(void 0),unsubscribe:Xa};if(s.store!==t&&!(ri in a))if(s.unsubscribe(),s.store=t??null,t==null)s.source.v=void 0,s.unsubscribe=Xa;else{var r=!0;s.unsubscribe=bi(t,i=>{r?s.source.v=i:g(s.source,i)}),r=!1}return t&&ri in a?ma(t):e(s.source)}function Bc(t,n){return t.set(n),n}function Ur(){const t={};function n(){ys(()=>{for(var a in t)t[a].unsubscribe();ji(t,ri,{enumerable:!1,value:!0})})}return[t,n]}function Fc(t){var n=Ts;try{return Ts=!1,[t(),Ts]}finally{Ts=n}}function Te(t,n,a,s){var r=!Hr||(a&Ol)!==0,i=(a&Yl)!==0,l=(a&Hl)!==0,c=s,m=!0,d=()=>(m&&(m=!1,c=l?o(s):s),c),y;if(i){var p=La in t||Tl in t;y=ir(t,n)?.set??(p&&n in t?E=>t[n]=E:void 0)}var h,f=!1;i?[h,f]=Fc(()=>t[n]):h=t[n],h===void 0&&s!==void 0&&(h=d(),y&&(r&&kl(),y(h)));var v;if(r?v=()=>{var E=t[n];return E===void 0?d():(m=!0,E)}:v=()=>{var E=t[n];return E!==void 0&&(c=void 0),E===void 0?c:E},r&&(a&Wl)===0)return v;if(y){var k=t.$$legacy;return(function(E,S){return arguments.length>0?((!r||!S||k||f)&&y(S?v():E),E):v()})}var b=!1,M=((a&Nl)!==0?Hs:Ce)(()=>(b=!1,v()));i&&e(M);var P=Bt;return(function(E,S){if(arguments.length>0){const I=S?e(M):r&&i?Rr(E):E;return g(M,I),b=!0,c!==void 0&&(c=I),E}return Ja&&b||(P.f&Ia)!==0?M.v:e(M)})}function Kr(t){rn===null&&hi(),Hr&&rn.l!==null?Uc(rn).m.push(t):ei(()=>{const n=o(t);if(typeof n=="function")return n})}function zo(t){rn===null&&hi(),Kr(()=>()=>o(t))}function qc(t,n,{bubbles:a=!1,cancelable:s=!1}={}){return new CustomEvent(t,{detail:n,bubbles:a,cancelable:s})}function Xo(){const t=rn;return t===null&&hi(),(n,a,s)=>{const r=t.s.$$events?.[n];if(r){const i=Os(r)?r.slice():[r],l=qc(n,a,s);for(const c of i)c.call(t.x,l);return!l.defaultPrevented}return!0}}function Uc(t){var n=t.l;return n.u??={a:[],b:[],m:[]}}const Kc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Kc);Gl();function Gc(t,n,a,s){const r=Ir(a,s,t),i=Ir(a,s,n),l=Ir(t,n,a),c=Ir(t,n,s);return!!((r>0&&i<0||r<0&&i>0)&&(l>0&&c<0||l<0&&c>0)||r===0&&xs(a,s,t)||i===0&&xs(a,s,n)||l===0&&xs(t,n,a)||c===0&&xs(t,n,s))}function Ir(t,n,a){return(a.x-t.x)*(n.y-t.y)-(n.x-t.x)*(a.y-t.y)}function xs(t,n,a){return Math.min(t.x,n.x)<=a.x&&a.x<=Math.max(t.x,n.x)&&Math.min(t.y,n.y)<=a.y&&a.y<=Math.max(t.y,n.y)}function Yi(t,n,a,s=16){const r=[];for(let i=0;i<s;i++){const l=2*Math.PI*i/s;r.push({x:t+a*Math.cos(l),y:n+a*Math.sin(l)})}return r}function zc(t,n,a,s,r=0,i=16){const l=[],c=2*(a+s),m=r*Math.PI/180,d=Math.cos(m),y=Math.sin(m),p=i/c,h=Math.max(1,Math.round(a*p)),f=Math.max(1,Math.round(s*p)),v=a/2,k=s/2,b=[];for(let M=0;M<h;M++){const P=M/h;b.push({x:-v+a*P,y:-k})}for(let M=0;M<f;M++){const P=M/f;b.push({x:v,y:-k+s*P})}for(let M=0;M<h;M++){const P=M/h;b.push({x:v-a*P,y:k})}for(let M=0;M<f;M++){const P=M/f;b.push({x:-v,y:k-s*P})}for(const M of b)l.push({x:t+M.x*d-M.y*y,y:n+M.x*y+M.y*d});if(l.length>i){const M=[],P=l.length/i;for(let E=0;E<i;E++)M.push(l[Math.floor(E*P)]);return M}return l}function Xc(t,n,a,s,r=0,i=16){const l=[],c=r*Math.PI/180,m=Math.cos(c),d=Math.sin(c);for(let y=0;y<i;y++){const p=2*Math.PI*y/i,h=a*Math.cos(p),f=s*Math.sin(p);l.push({x:t+h*m-f*d,y:n+h*d+f*m})}return l}function Hi(t,n,a){const s=a.length;for(let r=0;r<s;r++){const i=a[r],l=a[(r+1)%s];if(Gc(t,n,i,l))return!0}return!1}function Vo(t,n,a){const s=a*Math.PI/180,r=Math.cos(s),i=Math.sin(s),l=t.x-n.x,c=t.y-n.y;return{x:n.x+l*r-c*i,y:n.y+l*i+c*r}}function jo(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function dr(t){const n=jo(t),a=t.rotation||0;return[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}].map(r=>Vo(r,n,a))}function Vc(t){const r=t.x,i=t.y+t.height;return[{x:r,y:i},{x:r,y:i-8},{x:r+.5,y:i-8},{x:r+.5,y:i-.5},{x:r+4,y:i-.5},{x:r+4,y:i}]}function jc(t){const n=Vc(t),a=jo(t),s=t.rotation||0;return n.map(r=>Vo(r,a,s))}function Ls(t,n){const a=n.length;let s=null;for(let r=0;r<a;r++){const i=n[r],l=n[(r+1)%a],c=(l.x-i.x)*(t.y-i.y)-(l.y-i.y)*(t.x-i.x);if(c!==0){const m=c>0;if(s===null)s=m;else if(s!==m)return!1}}return!0}function Zc(t,n,a,s,r=.01){const i=Math.abs(Ir(t,n,a)),l=Math.abs(Ir(t,n,s)),c=Math.sqrt((n.x-t.x)**2+(n.y-t.y)**2),m=r*c;if(i>m||l>m)return!1;const d=n.x-t.x,y=n.y-t.y,p=Math.sqrt(d*d+y*y);if(p<r)return!1;const h=d/p,f=y/p,v=0,k=p,b=(a.x-t.x)*h+(a.y-t.y)*f,M=(s.x-t.x)*h+(s.y-t.y)*f,P=Math.min(v,k),E=Math.max(v,k),S=Math.min(b,M),I=Math.max(b,M),$=Math.max(P,S);return Math.min(E,I)-$>r}function Jc(t,n,a=.1){const s=t.length,r=n.length;for(let i=0;i<s;i++){const l=t[i],c=t[(i+1)%s];for(let m=0;m<r;m++){const d=n[m],y=n[(m+1)%r];if(Zc(l,c,d,y,a))return!0}}return!1}function Qc(t){const n=t.length;if(n===0)return new Map;const a=Array.from({length:n},(c,m)=>m);function s(c){return a[c]!==c&&(a[c]=s(a[c])),a[c]}function r(c,m){const d=s(c),y=s(m);d!==y&&(a[d]=y)}for(let c=0;c<n;c++)for(let m=c+1;m<n;m++)Jc(t[c].vertices,t[m].vertices)&&r(c,m);const i=new Map;t.forEach((c,m)=>i.set(c.id,m));const l=new Map;return t.forEach((c,m)=>{l.set(c.id,s(m))}),l}function eu(t,n,a){const s=n.get(t);return s===void 0?[t]:a.filter(r=>n.get(r.id)===s).map(r=>r.id)}const _s=16;function $s(t){return t.isRectangle&&t.width!==void 0&&t.height!==void 0?zc(t.x,t.y,t.width,t.height,t.rotation||0,_s):t.radius!==void 0?Yi(t.x,t.y,t.radius,_s):t.rx!==void 0&&t.ry!==void 0?Xc(t.x,t.y,t.rx,t.ry,t.rotation||0,_s):Yi(t.x,t.y,.5,_s)}function tu(t,n){const a=$s(t);for(const s of a)if(Ls(s,n))return!0;return!!Ls({x:t.x,y:t.y},n)}function nu(t,n){if(!Ls({x:t.x,y:t.y},n))return!1;const a=$s(t);for(const s of a)if(!Ls(s,n))return!1;return!0}function Zo(t,n,a,s){const r=$s(t),i=$s(n),l=Qc(a),c=new Set;for(const p of a){const h=nu(t,p.vertices),f=tu(n,p.vertices);if(h||f){const v=eu(p.id,l,a);for(const k of v)c.add(k)}}const m=[];let d=!1,y=null;for(const p of r)for(const h of i){const f={from:p,to:h,blocked:!1,blockedBy:null};let v=!1;for(const b of a)if(!c.has(b.id)&&Hi(p,h,b.vertices)){f.blocked=!0,f.blockedBy="terrain",v=!0;break}if(v){m.push(f);continue}let k=!1;for(const b of s)if(Hi(p,h,b)){f.blocked=!0,f.blockedBy="wall",k=!0;break}k||(f.blocked=!1,d||(y=f),d=!0),m.push(f)}return{canSee:d,rays:m,firstClearRay:y,terrainsIgnored:Array.from(c)}}function Jo(t,n,a,s){const r=[];let i=null,l=!1;for(const c of t)for(const m of n){const d=Zo(c,m,a,s);r.push({modelA:c,modelB:m,...d}),d.canSee&&!l&&(l=!0,i=d)}return{canSee:l,firstClearResult:i,allResults:r}}const et={width:60,height:44},Qo=Tn([{id:"terrain1",x:20,y:16,width:6,height:12,rotation:0},{id:"terrain2",x:34,y:10,width:6,height:12,rotation:45},{id:"terrain3",x:44,y:20,width:6,height:12,rotation:-30}]);Sa(Qo,t=>t.map(n=>jc(n)));Sa(Qo,t=>t.map(n=>({id:n.id,vertices:dr(n)})));const Bi=Tn(!1),te={player1:{primary:"#3b82f6",fill:"rgba(59, 130, 246, 0.5)",fillLight:"rgba(59, 130, 246, 0.3)",fillLighter:"rgba(59, 130, 246, 0.15)",zone:"rgba(59, 130, 246, 0.1)"},player2:{primary:"#ef4444",fill:"rgba(239, 68, 68, 0.5)",fillLight:"rgba(239, 68, 68, 0.3)",fillLighter:"rgba(239, 68, 68, 0.15)",zone:"rgba(239, 68, 68, 0.1)"},battlefield:{background:"#738973ff",gridFine:"#3a4a3a8c",gridCoarse:"#5a6a5a",ruler:"#666",rulerText:"#888",rulerBackground:"#1a1a1a"},terrain:{fill:"rgba(139, 90, 43, 0.3)",fillSelected:"rgba(59, 130, 246, 0.3)",fillStatic:"rgba(139, 90, 43, 0.6)",stroke:"#8b5a2b"},wall:{fill:"rgba(139, 69, 19, 0.8)",fillSelected:"rgba(139, 69, 19, 0.6)",stroke:"#5c3317"},objective:{primary:"#fbbf24",primaryControl:"rgba(251, 191, 36, 0.15)",secondary:"#9ca3af",secondaryControl:"rgba(156, 163, 175, 0.15)",center:"#000"},los:{visible:"#22c55e",blocked:"#ef4444",rayVisible:"#00ff0033",rayBlocked:"#ff000033"},selection:{highlight:"#3b82f6",highlightDark:"#1d4ed8",handle:"#9333ea",handleDark:"#7e22ce",dragRuler:"#fbbf24"}};function hs(t){return t===1?te.player1:te.player2}const el=1/25.4,Fs=40*el/2,qs=3+20*el;function tl(t="item"){return t+"-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function au(){const{subscribe:t,set:n,update:a}=Tn([]);return{subscribe:t,set:n,update:a,add(s){const r=tl("zone");return a(i=>[...i,{id:r,...s}]),r},updateZone(s,r){a(i=>i.map(l=>l.id===s?{...l,...r}:l))},remove(s){a(r=>r.filter(i=>i.id!==s))},clear(){n([])}}}function ru(){const{subscribe:t,set:n,update:a}=Tn([]);return{subscribe:t,set:n,update:a,add(s,r,i=!1){const l=tl("obj"),c=Math.round(s),m=Math.round(r);return a(d=>[...d,{id:l,x:c,y:m,isPrimary:i}]),l},updateObjective(s,r){a(i=>i.map(l=>l.id===s?{...l,...r}:l))},remove(s){a(r=>r.filter(i=>i.id!==s))},clear(){n([])}}}au();ru();const nl=[{name:"Dawn of War",zones:[{name:"Player 1",color:te.player1.zone,borderColor:te.player1.primary,path:[{type:"M",x:0,y:32},{type:"L",x:60,y:32},{type:"L",x:60,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:te.player2.zone,borderColor:te.player2.primary,path:[{type:"M",x:0,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:12},{type:"L",x:0,y:12},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1}]},{name:"Hammer and Anvil",zones:[{name:"Player 1",color:te.player1.zone,borderColor:te.player1.primary,path:[{type:"M",x:0,y:0},{type:"L",x:18,y:0},{type:"L",x:18,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:te.player2.zone,borderColor:te.player2.primary,path:[{type:"M",x:42,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:42,y:44},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1}]},{name:"Tipping Point",zones:[{name:"Player 1",color:te.player1.zone,borderColor:te.player1.primary,path:[{type:"M",x:0,y:0},{type:"L",x:12,y:0},{type:"L",x:12,y:22},{type:"L",x:20,y:22},{type:"L",x:20,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:te.player2.zone,borderColor:te.player2.primary,path:[{type:"M",x:40,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:48,y:44},{type:"L",x:48,y:22},{type:"L",x:40,y:22},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:34,isPrimary:!1},{x:22,y:8,isPrimary:!1},{x:38,y:36,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Search and Destroy",zones:[{name:"Player 1",color:te.player1.zone,borderColor:te.player1.primary,path:[{type:"M",x:0,y:22},{type:"L",x:21,y:22},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:0,x:30,y:31},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:te.player2.zone,borderColor:te.player2.primary,path:[{type:"M",x:30,y:0},{type:"L",x:30,y:13},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:1,x:39,y:22},{type:"L",x:60,y:22},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:10,isPrimary:!1},{x:46,y:34,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Sweeping Engagement",zones:[{name:"Player 1",color:te.player1.zone,borderColor:te.player1.primary,path:[{type:"M",x:0,y:0},{type:"L",x:0,y:8},{type:"L",x:30,y:8},{type:"L",x:30,y:14},{type:"L",x:60,y:14},{type:"L",x:60,y:0},{type:"Z"}]},{name:"Player 2",color:te.player2.zone,borderColor:te.player2.primary,path:[{type:"M",x:0,y:44},{type:"L",x:60,y:44},{type:"L",x:60,y:36},{type:"L",x:30,y:36},{type:"L",x:30,y:30},{type:"L",x:0,y:30},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:18,isPrimary:!1},{x:50,y:26,isPrimary:!1},{x:18,y:38,isPrimary:!1},{x:42,y:6,isPrimary:!1}]},{name:"Crucible of Battle",zones:[{name:"Player 1",color:te.player1.zone,borderColor:te.player1.primary,path:[{type:"M",x:0,y:0},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:te.player2.zone,borderColor:te.player2.primary,path:[{type:"M",x:60,y:44},{type:"L",x:30,y:0},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:20,y:8,isPrimary:!1},{x:40,y:36,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]}];function fr(t){return t.map(n=>{switch(n.type){case"M":return`M ${n.x} ${n.y}`;case"L":return`L ${n.x} ${n.y}`;case"A":return`A ${n.rx} ${n.ry} ${n.rotation} ${n.largeArc} ${n.sweep} ${n.x} ${n.y}`;case"Z":return"Z";default:return""}}).join(" ")}const al="warhammer-deployment-layouts",su=[{label:'6" x 12"',width:6,height:12},{label:'5" x 10"',width:5,height:10},{label:'4" x 6"',width:4,height:6}],iu=[{label:"L 4x8",shape:"L-4x8"},{label:"L 4x8 ⌐",shape:"L-4x8-mirror"},{label:"C 4-8-4",shape:"C-4-8-4"},{label:"L 5x6",shape:"L-5x6"},{label:"L 5x6 ⌐",shape:"L-5x6-mirror"},{label:"L 4x6",shape:"L-4x6"},{label:"L 4x6 ⌐",shape:"L-4x6-mirror"}],Ti=[{name:"Layout 1",terrains:[{id:"a",x:28,y:0,width:4,height:6,rotation:0},{id:"b",x:28,y:38,width:4,height:6,rotation:0},{id:"c",x:6,y:5,width:6,height:12,rotation:0},{id:"d",x:48,y:27,width:6,height:12,rotation:0},{id:"e",x:16,y:28,width:6,height:12,rotation:0},{id:"f",x:7,y:19,width:6,height:12,rotation:90},{id:"g",x:38,y:4,width:6,height:12,rotation:0},{id:"h",x:47,y:13,width:6,height:12,rotation:90},{id:"i",x:32.74,y:23.59,width:5,height:10,rotation:135},{id:"j",x:35.06,y:19.5,width:4,height:6,rotation:45},{id:"k",x:22.07,y:10.17,width:5,height:10,rotation:-45},{id:"l",x:20.72,y:18.23,width:4,height:6,rotation:45}],walls:[{id:"wa",x:38,y:6,shape:"C-4-8-4",rotation:0},{id:"wb",x:18,y:30,shape:"C-4-8-4",rotation:180},{id:"wc",x:13.33,y:20.15,shape:"L-4x8-mirror",rotation:-90},{id:"wd",x:49.67,y:15.93,shape:"L-4x8-mirror",rotation:90},{id:"we",x:48.2,y:30.88,shape:"L-4x8",rotation:0},{id:"wf",x:7.84,y:5.01,shape:"L-4x8",rotation:180},{id:"wg",x:27.06,y:11.52,shape:"L-4x8-mirror",rotation:-45},{id:"wh",x:35.81,y:24.24,shape:"L-4x8-mirror",rotation:135}]},{name:"Layout 2",terrains:[{id:"a",x:31,y:7,width:4,height:6,rotation:-90},{id:"b",x:25,y:30,width:4,height:6,rotation:90},{id:"c",x:5,y:4,width:6,height:12,rotation:0},{id:"d",x:49,y:28,width:6,height:12,rotation:0},{id:"e",x:46,y:4,width:6,height:12,rotation:0},{id:"f",x:16.46,y:15.77,width:6,height:12,rotation:132.1},{id:"g",x:53,y:15,width:4,height:6,rotation:90},{id:"h",x:8,y:28,width:6,height:12,rotation:0},{id:"i",x:3,y:23,width:4,height:6,rotation:90},{id:"j",x:32.62,y:32.55,width:5,height:10,rotation:-90},{id:"k",x:22.48,y:.51,width:5,height:10,rotation:-90},{id:"l",x:37.5,y:16.2,width:6,height:12,rotation:132.1}],walls:[{id:"wa",x:49,y:32,shape:"L-4x8",rotation:0},{id:"wb",x:7,y:4,shape:"L-4x8",rotation:180},{id:"wc",x:46,y:8,shape:"L-4x8",rotation:0},{id:"wd",x:10,y:28,shape:"L-4x8",rotation:180},{id:"we",x:35.07,y:34.56,shape:"L-5x6-mirror",rotation:-90},{id:"wf",x:29.09,y:2.47,shape:"L-5x6-mirror",rotation:90},{id:"wg",x:17.86,y:17.53,shape:"C-4-8-4",rotation:135},{id:"wh",x:37.24,y:18.38,shape:"C-4-8-4",rotation:-45}]},{name:"Layout 3",terrains:[{id:"a",x:11,y:3,width:4,height:6,rotation:90},{id:"b",x:45,y:35,width:4,height:6,rotation:90},{id:"c",x:25,y:1,width:6,height:12,rotation:90},{id:"d",x:29,y:31,width:6,height:12,rotation:90},{id:"e",x:7.74,y:26.05,width:6,height:12,rotation:125.31},{id:"f",x:46.34,y:5.51,width:6,height:12,rotation:121.72},{id:"g",x:5.14,y:10.46,width:6,height:12,rotation:41.51},{id:"h",x:48.67,y:21.52,width:6,height:12,rotation:41.51},{id:"i",x:19.59,y:14.36,width:5,height:10,rotation:-38.13},{id:"j",x:20.69,y:24.37,width:4,height:6,rotation:-39.33},{id:"k",x:35.34,y:19.61,width:5,height:10,rotation:-38.13},{id:"l",x:35.31,y:13.5,width:4,height:6,rotation:-39.33}],walls:[{id:"aa",x:30,y:32,shape:"C-4-8-4",rotation:90},{id:"ab",x:26,y:4,shape:"C-4-8-4",rotation:-90},{id:"ac",x:8.19,y:11.64,shape:"L-4x8",rotation:222.46},{id:"ad",x:47.79,y:24.3,shape:"L-4x8",rotation:41.26},{id:"ae",x:38.64,y:20.09,shape:"L-5x6-mirror",rotation:141.31},{id:"af",x:25.26,y:17.9,shape:"L-5x6-mirror",rotation:-37.61},{id:"ag",x:14.37,y:28.38,shape:"L-4x8-mirror",rotation:-54.26},{id:"ah",x:48.75,y:7.3,shape:"L-4x8-mirror",rotation:122.02}]},{name:"Layout 4",terrains:[{id:"a",x:15,y:1,width:6,height:12,rotation:90},{id:"b",x:8,y:10,width:4,height:6,rotation:0},{id:"c",x:4,y:19,width:4,height:6,rotation:0},{id:"d",x:7.5,y:27.68,width:6,height:12,rotation:-48.57},{id:"e",x:46.53,y:4.24,width:6,height:12,rotation:-48.57},{id:"f",x:52,y:19,width:4,height:6,rotation:0},{id:"g",x:48,y:28,width:4,height:6,rotation:0},{id:"h",x:39,y:31,width:6,height:12,rotation:90},{id:"i",x:33.03,y:2.97,width:6,height:12,rotation:-37.25},{id:"j",x:20.96,y:28.96,width:6,height:12,rotation:-37.25},{id:"k",x:16.93,y:16.51,width:5,height:10,rotation:-41.85},{id:"l",x:37.96,y:17.43,width:5,height:10,rotation:-41.85}],walls:[{id:"aa",x:18,y:4,shape:"L-4x8",rotation:-90},{id:"ab",x:9.04,y:29.01,shape:"C-4-8-4",rotation:131.97},{id:"ac",x:47,y:7,shape:"C-4-8-4",rotation:-48.54},{id:"ad",x:38,y:32,shape:"L-4x8",rotation:90},{id:"ae",x:34.42,y:7.12,shape:"L-4x8",rotation:-37.53},{id:"af",x:21.57,y:28.8,shape:"L-4x8",rotation:142.46},{id:"ag",x:15.7,y:17.01,shape:"L-5x6",rotation:137.87},{id:"ah",x:39.17,y:20.85,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 5",terrains:[{id:"aa",x:27,y:1,width:6,height:12,rotation:90},{id:"ab",x:36.53,y:12.48,width:5,height:10,rotation:-90},{id:"ac",x:13,y:3,width:4,height:6,rotation:90},{id:"ad",x:43,y:35,width:4,height:6,rotation:90},{id:"ae",x:27,y:31,width:6,height:12,rotation:90},{id:"af",x:18.43,y:21.49,width:5,height:10,rotation:-90},{id:"ag",x:1,y:23,width:4,height:6,rotation:90},{id:"ah",x:55,y:15,width:4,height:6,rotation:90},{id:"ai",x:7.83,y:30.22,width:6,height:12,rotation:-60},{id:"aj",x:46.32,y:1.58,width:6,height:12,rotation:-60},{id:"ak",x:8.74,y:10.19,width:6,height:12,rotation:65.22},{id:"al",x:45.22,y:21.75,width:6,height:12,rotation:65.22}],walls:[{id:"a1",x:28,y:32,shape:"C-4-8-4",rotation:90},{id:"a2",x:28,y:4,shape:"C-4-8-4",rotation:-90},{id:"a3",x:11.88,y:12.29,shape:"L-4x8",rotation:-114.74},{id:"a4",x:43.97,y:23.59,shape:"L-4x8",rotation:64.22},{id:"a5",x:24.91,y:23.52,shape:"L-5x6-mirror",rotation:-90.37},{id:"a6",x:39,y:14.51,shape:"L-5x6-mirror",rotation:89.9},{id:"a7",x:7.58,y:30.57,shape:"L-4x8",rotation:120.93},{id:"a8",x:48.51,y:5.28,shape:"L-4x8",rotation:-59.06}]},{name:"Layout 6",terrains:[{id:"aa",x:13,y:1,width:6,height:12,rotation:90},{id:"ab",x:6,y:10,width:4,height:6,rotation:0},{id:"ac",x:25,y:11,width:4,height:6,rotation:90},{id:"ad",x:7.34,y:27.57,width:6,height:12,rotation:-40.32},{id:"ae",x:46.69,y:4.57,width:6,height:12,rotation:-41.9},{id:"af",x:31,y:27,width:4,height:6,rotation:-90},{id:"ag",x:50,y:28,width:4,height:6,rotation:0},{id:"ah",x:41,y:31,width:6,height:12,rotation:90},{id:"ai",x:34,y:4,width:6,height:12,rotation:0},{id:"aj",x:20,y:28,width:6,height:12,rotation:0},{id:"ak",x:15.7,y:15.03,width:5,height:10,rotation:-41.85},{id:"al",x:39.43,y:19.24,width:5,height:10,rotation:-39.95}],walls:[{id:"a1",x:16,y:4,shape:"L-4x8",rotation:-90},{id:"a2",x:9.04,y:29.01,shape:"C-4-8-4",rotation:140.05},{id:"a3",x:47,y:7.16,shape:"C-4-8-4",rotation:-41.53},{id:"a4",x:40,y:32,shape:"L-4x8",rotation:90},{id:"a5",x:34.15,y:7.88,shape:"L-4x8",rotation:0},{id:"a6",x:22,y:28,shape:"L-4x8",rotation:180},{id:"a7",x:14.47,y:15.47,shape:"L-5x6",rotation:137.87},{id:"a8",x:40.53,y:22.78,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 7",terrains:[{id:"aa",x:8,y:8,width:6,height:12,rotation:0},{id:"ab",x:6,y:28,width:6,height:12,rotation:0},{id:"ac",x:7,y:39,width:4,height:6,rotation:90},{id:"ad",x:18,y:26,width:5,height:10,rotation:0},{id:"ae",x:19,y:20,width:4,height:6,rotation:0},{id:"af",x:23,y:3,width:6,height:12,rotation:0},{id:"ag",x:31,y:29,width:6,height:12,rotation:0},{id:"ah",x:37,y:18,width:4,height:6,rotation:0},{id:"ai",x:37,y:8,width:5,height:10,rotation:0},{id:"aj",x:46,y:24,width:6,height:12,rotation:0},{id:"ak",x:48,y:4,width:6,height:12,rotation:0},{id:"al",x:49,y:-1,width:4,height:6,rotation:90}],walls:[{id:"a1",x:9,y:10,shape:"L-5x6",rotation:180},{id:"a2",x:11.44,y:31.97,shape:"L-4x8-mirror",rotation:0},{id:"a3",x:19,y:20,shape:"L-4x6",rotation:180},{id:"a4",x:22.53,y:30.02,shape:"L-5x6-mirror",rotation:0},{id:"a5",x:25,y:5,shape:"C-4-8-4",rotation:180},{id:"a6",x:31,y:31,shape:"C-4-8-4",rotation:0},{id:"a7",x:37,y:18,shape:"L-4x6",rotation:0},{id:"a8",x:41.51,y:8.09,shape:"L-5x6-mirror",rotation:180},{id:"a9",x:46,y:28,shape:"L-5x6",rotation:0},{id:"a10",x:51.51,y:4.01,shape:"L-4x8-mirror",rotation:180}]},{name:"Layout 8",terrains:[{id:"aa",x:23,y:22,width:4,height:6,rotation:0},{id:"ab",x:23,y:28,width:4,height:6,rotation:0},{id:"ac",x:33,y:16,width:4,height:6,rotation:0},{id:"ad",x:33,y:10,width:4,height:6,rotation:0},{id:"ae",x:41,y:19,width:6,height:12,rotation:0},{id:"af",x:13,y:13,width:6,height:12,rotation:0},{id:"ag",x:32,y:32,width:6,height:12,rotation:0},{id:"ah",x:22,y:0,width:6,height:12,rotation:0},{id:"ai",x:9.5,y:27.68,width:6,height:12,rotation:-48.69},{id:"aj",x:44.51,y:4.35,width:6,height:12,rotation:-48.69},{id:"ak",x:6.95,y:4,width:5,height:10,rotation:53.9},{id:"al",x:48,y:30,width:5,height:10,rotation:53.9}],walls:[{id:"a1",x:32,y:34,shape:"C-4-8-4",rotation:0},{id:"a2",x:24,y:2,shape:"C-4-8-4",rotation:180},{id:"a3",x:44.68,y:19.06,shape:"L-4x8-mirror",rotation:180},{id:"a4",x:18.43,y:16.91,shape:"L-4x8-mirror",rotation:0},{id:"a5",x:46.38,y:33.13,shape:"L-5x6",rotation:52.87},{id:"a6",x:8.55,y:4.89,shape:"L-5x6",rotation:-127.66},{id:"a7",x:16,y:30.28,shape:"L-4x8-mirror",rotation:-48.62},{id:"a8",x:46.91,y:5.85,shape:"L-4x8-mirror",rotation:132.19}]}];function ou(){return"terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Mr(){const t=localStorage.getItem(al);if(t)try{return JSON.parse(t)}catch(n){return console.error("Failed to parse saved layouts:",n),{}}return{}}function Fi(t){localStorage.setItem(al,JSON.stringify(t))}function rl(){const{subscribe:t,set:n,update:a}=Tn([]);return{subscribe:t,set:n,update:a,add(s,r){a(i=>[...i,{id:ou(),x:30-s/2,y:22-r/2,width:s,height:r,rotation:0}])},updateTerrain(s,r){a(i=>i.map(l=>l.id===s?{...l,...r}:l))},remove(s){a(r=>r.filter(i=>i.id!==s))},clear(){n([])},save(s){const r=ma({subscribe:t}),i=Mr();i[s]={terrains:r,savedAt:Date.now()},Fi(i)},load(s){const r=Mr();return r[s]?(n(r[s].terrains),!0):!1},deleteLayout(s){const r=Mr();delete r[s],Fi(r)},getSavedLayoutNames(){const s=Mr();return Object.keys(s).map(r=>({name:r,savedAt:s[r].savedAt,terrainCount:s[r].terrains.length})).sort((r,i)=>i.savedAt-r.savedAt)},hasSaved(){const s=Mr();return Object.keys(s).length>0}}}rl();function sl(){const{subscribe:t,set:n,update:a}=Tn([]);return{subscribe:t,set:n,update:a,add(s){a(r=>[...r,{id:"wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),x:30,y:22,shape:s,rotation:0}])},updateWall(s,r){a(i=>i.map(l=>l.id===s?{...l,...r}:l))},remove(s){a(r=>r.filter(i=>i.id!==s))},clear(){n([])}}}const lu=sl(),ws=rl(),Ss=sl(),es=Tn(null),ts=Tn(null);function cu(t){const n=t.includes("-mirror"),a=t.replace("-mirror","");if(a.startsWith("L-")){const s=a.match(/L-(\d+)x(\d+)/);if(s)return{type:"L",segments:[parseInt(s[1]),parseInt(s[2])],mirrored:n}}else if(a.startsWith("C-")){const s=a.match(/C-(\d+)-(\d+)-(\d+)/);if(s)return{type:"C",segments:[parseInt(s[1]),parseInt(s[2]),parseInt(s[3])],mirrored:n}}return{type:"L",segments:[4,8],mirrored:!1}}function ya(t,n=null){const r=cu(t),i=n||r.segments,l=r.mirrored;if(r.type==="L"){const[c,m]=i;return l?[{x:0,y:0},{x:.5,y:0},{x:.5,y:m},{x:-c+.5,y:m},{x:-c+.5,y:m-.5},{x:0,y:m-.5}]:[{x:0,y:0},{x:.5,y:0},{x:.5,y:m-.5},{x:c,y:m-.5},{x:c,y:m},{x:0,y:m}]}else if(r.type==="C"){const[c,m,d]=i;return[{x:0,y:0},{x:d,y:0},{x:d,y:.5},{x:.5,y:.5},{x:.5,y:m-.5},{x:c,y:m-.5},{x:c,y:m},{x:0,y:m}]}return[]}function vs(t,n,a,s){if(t.length===0)return[];const r=t.map(M=>M.x),i=t.map(M=>M.y),l=Math.min(...r),c=Math.max(...r),m=Math.min(...i),d=Math.max(...i),y=c-l,p=d-m,h=n+l+y/2,f=a+m+p/2,v=s*Math.PI/180,k=Math.cos(v),b=Math.sin(v);return t.map(M=>{const P=n+M.x,E=a+M.y,S=P-h,I=E-f;return{x:h+S*k-I*b,y:f+S*b+I*k}})}Sa(lu,t=>t.map(n=>vs(ya(n.shape,n.segments),n.x,n.y,n.rotation)));const il=Tn([]);function uu(){const t=Mr();return Object.keys(t).map(n=>({name:n,savedAt:t[n].savedAt,terrainCount:(t[n].terrains||[]).length,wallCount:(t[n].walls||[]).length,modelCount:(t[n].models||[]).length})).sort((n,a)=>a.savedAt-n.savedAt)}function mu(){il.set(uu())}function ol(){const{subscribe:t,set:n,update:a}=Tn({past:[],future:[]});return{subscribe:t,push(s){a(r=>({past:[...r.past,s],future:[]}))},undo(){let s=null;return a(r=>{if(r.past.length===0)return r;const i=[...r.past];return s=i.pop(),{past:i,future:[s,...r.future]}}),s},redo(){let s=null;return a(r=>{if(r.future.length===0)return r;const i=[...r.future];return s=i.shift(),{past:[...r.past,s],future:i}}),s},canUndo(){return ma({subscribe:t}).past.length>0},canRedo(){return ma({subscribe:t}).future.length>0},clear(){n({past:[],future:[]})}}}const Cn=ol(),si=ol(),hu=2;function du(t,n){const a=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)),s=qi(t),r=qi(n);return Math.max(0,a-s-r)}function qi(t){const n=pn(t.baseType,t);return n?Fn(t.baseType)?Math.min(t.customWidth,t.customHeight)/2:cn(t.baseType)?Math.min(n.width,n.height)/2:n.radius:.5}function fu(t){const n=new Map;for(const a of t)n.set(a.id,new Set);for(let a=0;a<t.length;a++)for(let s=a+1;s<t.length;s++)du(t[a],t[s])<=hu&&(n.get(t[a].id).add(t[s].id),n.get(t[s].id).add(t[a].id));return n}function pu(t,n){const a=new Set,s=[];for(const r of t){if(a.has(r.id))continue;const i=new Set,l=[r.id];for(;l.length>0;){const c=l.shift();if(!a.has(c)){a.add(c),i.add(c);for(const m of n.get(c))a.has(m)||l.push(m)}}s.push(i)}return s}function yu(t){if(t.length<=1)return{isCoherent:!0,violations:new Map};const n=t.length>=7?2:1,a=fu(t),s=pu(t,a),r=new Map;s.length;let i=s[0];for(const l of s)l.size>i.size&&(i=l);for(const l of t){const c=a.get(l.id).size,m=i.has(l.id);c>=n&&m||r.set(l.id,{model:l,requiredCount:n,actualCount:c,isDisconnected:!m,componentSize:s.find(p=>p.has(l.id))?.size||0})}return{isCoherent:r.size===0,violations:r,componentCount:s.length}}function vu(t){const n=new Map,a=new Map;for(const s of t)s.unitId&&(a.has(s.unitId)||a.set(s.unitId,[]),a.get(s.unitId).push(s));for(const[s,r]of a){const i=yu(r),l=r.length>=7?2:1;for(const c of r){const m=i.violations.get(c.id);n.set(c.id,{inCoherency:!m,requiredCount:l,actualCount:m?m.actualCount:l,unitSize:r.length,isDisconnected:m?.isDisconnected||!1,componentCount:i.componentCount})}}return n}const Kt=1/25.4,Vn={circles:[{type:"25mm",radius:25*Kt/2,label:"25mm"},{type:"28.5mm",radius:28.5*Kt/2,label:"28mm.5"},{type:"32mm",radius:32*Kt/2,label:"32mm"},{type:"40mm",radius:40*Kt/2,label:"40mm"},{type:"50mm",radius:50*Kt/2,label:"50mm"},{type:"60mm",radius:60*Kt/2,label:"60mm"},{type:"80mm",radius:80*Kt/2,label:"80mm"},{type:"90mm",radius:90*Kt/2,label:"90mm"},{type:"100mm",radius:100*Kt/2,label:"100mm"},{type:"130mm",radius:130*Kt/2,label:"130mm"},{type:"160mm",radius:160*Kt/2,label:"160mm"}],ovals:[{type:"60x35.5mm",width:60*Kt,height:35.5*Kt,label:"60×35.5mm"},{type:"75x42mm",width:75*Kt,height:42*Kt,label:"75×42mm"},{type:"Small Flying Base",width:75*Kt,height:42*Kt,label:"Small Flying"},{type:"90x52.5mm",width:90*Kt,height:52.5*Kt,label:"90×52.5mm"},{type:"Large Flying Base",width:90*Kt,height:52.5*Kt,label:"Large Flying"},{type:"105x70mm",width:105*Kt,height:70*Kt,label:"105×70mm"},{type:"120x92mm",width:120*Kt,height:92*Kt,label:"120×92mm"},{type:"150x95mm",width:150*Kt,height:95*Kt,label:"150×95mm"},{type:"170x109mm",width:170*Kt,height:109*Kt,label:"170×109mm"}]};function pn(t,n=null){const a=Vn.circles.find(r=>r.type===t);if(a)return a;const s=Vn.ovals.find(r=>r.type===t);return s||(Fn(t)&&n?{type:t,width:n.customWidth,height:n.customHeight,label:`${n.customWidth.toFixed(1)}"×${n.customHeight.toFixed(1)}"`}:null)}function cn(t){return Vn.ovals.some(n=>n.type===t)}function Fn(t){return t&&t.startsWith("rect-")}function Ui(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function ll(t){const{subscribe:n,set:a,update:s}=Tn([]);return{subscribe:n,set:a,update:s,add(r,i,l,c,m=null,d=!1){const y=Ui(),p={id:y,baseType:r,playerId:i,x:l,y:c,rotation:0};return m&&m.width&&m.height&&(p.customWidth=m.width,p.customHeight=m.height),s(h=>[...h,p]),!d&&t&&t.push({type:"add",modelId:y,model:{...p}}),y},updateModel(r,i,l=!1){let c=null,m=null;if(!l&&t){const y=ma({subscribe:n}).find(p=>p.id===r);y&&(c={...y},"x"in i||"y"in i?m="move":"rotation"in i&&(m="rotate"))}if(s(d=>d.map(y=>y.id===r?{...y,...i}:y)),!l&&t&&m&&c){const y=ma({subscribe:n}).find(p=>p.id===r);t.push({type:m,modelId:r,before:m==="move"?{x:c.x,y:c.y}:{rotation:c.rotation},after:m==="move"?{x:y.x,y:y.y}:{rotation:y.rotation}})}},remove(r,i=!1){let l=null;!i&&t&&(l=ma({subscribe:n}).find(m=>m.id===r)),s(c=>c.filter(m=>m.id!==r)),!i&&t&&l&&t.push({type:"remove",modelId:r,model:{...l}})},removeByPlayer(r){s(i=>i.filter(l=>l.playerId!==r))},addBatch(r,i=!1){const l=[];return s(c=>{const m=[...c];return r.forEach(d=>{const y=d.id||Ui(),p={...d,id:y};m.push(p),l.push(y),!i&&t&&t.push({type:"add",modelId:y,model:{...p}})}),m}),l},updateUnit(r,i,l=!1){s(c=>c.map(m=>m.unitId===r?{...m,...i}:m))},removeUnit(r,i=!1){const l=[];if(!i&&t){const c=ma({subscribe:n});l.push(...c.filter(m=>m.unitId===r))}s(c=>c.filter(m=>m.unitId!==r)),!i&&t&&l.forEach(c=>{t.push({type:"remove",modelId:c.id,model:{...c}})})},groupModels(r,i=!1){if(r.length<2)return null;const l=ma({subscribe:n}),c=r.map(p=>l.find(h=>h.id===p)).filter(Boolean);if(c.length<2||[...new Set(c.map(p=>p.playerId))].length>1)return null;const d="unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),y={};return c.forEach(p=>{y[p.id]=p.unitId||null}),s(p=>p.map(h=>r.includes(h.id)?{...h,unitId:d}:h)),!i&&t&&t.push({type:"group",modelIds:[...r],unitId:d,previousUnitIds:y}),d},ungroupModels(r,i=!1){const l=ma({subscribe:n}),c={};r.forEach(m=>{const d=l.find(y=>y.id===m);d&&(c[m]=d.unitId||null)}),s(m=>m.map(d=>r.includes(d.id)?{...d,unitId:null}:d)),!i&&t&&t.push({type:"ungroup",modelIds:[...r],previousUnitIds:c})},clear(){a([]),t&&t.clear()},undo(){if(!t)return;const r=t.undo();if(r)switch(r.type){case"add":this.remove(r.modelId,!0);break;case"remove":s(i=>[...i,r.model]);break;case"move":this.updateModel(r.modelId,r.before,!0);break;case"rotate":this.updateModel(r.modelId,r.before,!0);break;case"group":s(i=>i.map(l=>r.modelIds.includes(l.id)?{...l,unitId:r.previousUnitIds[l.id]}:l));break;case"ungroup":s(i=>i.map(l=>r.modelIds.includes(l.id)?{...l,unitId:r.previousUnitIds[l.id]}:l));break}},redo(){if(!t)return;const r=t.redo();if(r)switch(r.type){case"add":s(i=>[...i,r.model]);break;case"remove":this.remove(r.modelId,!0);break;case"move":this.updateModel(r.modelId,r.after,!0);break;case"rotate":this.updateModel(r.modelId,r.after,!0);break;case"group":s(i=>i.map(l=>r.modelIds.includes(l.id)?{...l,unitId:r.unitId}:l));break;case"ungroup":s(i=>i.map(l=>r.modelIds.includes(l.id)?{...l,unitId:null}:l));break}}}}const at=ll(Cn),cl=Sa(at,t=>t.filter(n=>n.playerId===1)),ul=Sa(at,t=>t.filter(n=>n.playerId===2)),gu=Tn(null);Sa([at,gu],([t,n])=>n?t.find(a=>a.id===n):null);const Ua=ll(si),Ka=Tn(null);Sa([Ua,Ka],([t,n])=>n?t.find(a=>a.id===n):null);Sa(at,t=>{const n=new Map;return t.forEach(a=>{a.unitId&&(n.has(a.unitId)||n.set(a.unitId,{unitId:a.unitId,playerId:a.playerId,models:[]}),n.get(a.unitId).models.push(a))}),Array.from(n.values())});const bu=Sa(at,t=>vu(t)),ks=Tn({zoom:1,panX:0,panY:0});function Tu(){ks.set({zoom:1,panX:0,panY:0})}var xu=le('<line stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-1lx01iv"></circle>',1),_u=le('<g><g><rect role="button" tabindex="0" class="svelte-1lx01iv"></rect></g><!></g>');function wu(t,n){Zn(n,!1);const a=Y(),s=Y(),r=Y(),i=Y(),l=Y();let c=Te(n,"id",8),m=Te(n,"x",8),d=Te(n,"y",8),y=Te(n,"width",8),p=Te(n,"height",8),h=Te(n,"rotation",8,0),f=Te(n,"selected",8,!1),v=Te(n,"screenToSvg",8),k=Te(n,"onSelect",8,()=>{}),b=Te(n,"onDrag",8,()=>{}),M=Te(n,"onRotate",8,()=>{}),P=Y(!1),E=!1,S={x:0,y:0};function I(xe){xe.stopPropagation(),k()(c())}function $(xe){if(xe.button!==0)return;xe.preventDefault(),xe.stopPropagation(),k()(c()),g(P,!0);const ee=v()(xe.clientX,xe.clientY);S={x:ee.x-m(),y:ee.y-d()},window.addEventListener("mousemove",U),window.addEventListener("mouseup",B)}function U(xe){if(!e(P))return;const ee=v()(xe.clientX,xe.clientY);let ke=ee.x-S.x,ue=ee.y-S.y;xe.shiftKey||(ke=Math.round(ke),ue=Math.round(ue));const ye=Math.max(y(),p())/2;ke=Math.max(-ye,Math.min(et.width-y()+ye,ke)),ue=Math.max(-ye,Math.min(et.height-p()+ye,ue)),b()(c(),ke,ue)}function B(){g(P,!1),window.removeEventListener("mousemove",U),window.removeEventListener("mouseup",B)}function G(xe){xe.preventDefault(),xe.stopPropagation(),E=!0,window.addEventListener("mousemove",q),window.addEventListener("mouseup",ae)}function q(xe){if(!E)return;const ee=v()(xe.clientX,xe.clientY),ke=ee.x-e(a),ue=ee.y-e(s);let ye=Math.atan2(ue,ke)*180/Math.PI+45;xe.shiftKey||(ye=Math.round(ye/15)*15),M()(c(),ye)}function ae(){E=!1,window.removeEventListener("mousemove",q),window.removeEventListener("mouseup",ae)}he(()=>(L(m()),L(y())),()=>{g(a,m()+y()/2)}),he(()=>(L(d()),L(p())),()=>{g(s,d()+p()/2)}),he(()=>(L(y()),L(p())),()=>{g(r,Math.max(y(),p())/2+1.5)}),he(()=>(e(a),e(r),L(h())),()=>{g(i,e(a)+e(r)*Math.cos((h()-45)*Math.PI/180))}),he(()=>(e(s),e(r),L(h())),()=>{g(l,e(s)+e(r)*Math.sin((h()-45)*Math.PI/180))}),Ya(),ia();var Q=_u();let de;var re=w(Q),ne=w(re),Ee=T(re);{var _e=xe=>{var ee=xu(),ke=ce(ee),ue=T(ke);X(()=>{u(ke,"x1",e(a)),u(ke,"y1",e(s)),u(ke,"x2",e(i)),u(ke,"y2",e(l)),u(ke,"stroke",(L(te),o(()=>te.selection.highlight))),u(ue,"cx",e(i)),u(ue,"cy",e(l)),u(ue,"fill",(L(te),o(()=>te.selection.highlight))),u(ue,"stroke",(L(te),o(()=>te.selection.highlightDark)))}),oe("mousedown",ue,G),A(xe,ee)};Z(Ee,xe=>{f()&&xe(_e)})}X(()=>{de=wn(Q,0,"terrain-rect svelte-1lx01iv",null,de,{selected:f(),dragging:e(P)}),u(re,"transform",`rotate(${h()??""}, ${e(a)??""}, ${e(s)??""})`),u(ne,"x",m()),u(ne,"y",d()),u(ne,"width",y()),u(ne,"height",p()),u(ne,"fill",(L(f()),L(te),o(()=>f()?te.terrain.fillSelected:te.terrain.fill))),u(ne,"stroke",(L(f()),L(te),o(()=>f()?te.selection.highlight:te.terrain.stroke))),u(ne,"stroke-width",f()?.15:.1)}),oe("click",ne,I),oe("mousedown",ne,$),A(t,Q),Jn()}var Su=le('<line stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-x1kcna"></circle>',1),Au=le('<g><g><path role="button" tabindex="0" class="svelte-x1kcna"></path></g><!></g>');function xi(t,n){Zn(n,!1);const a=Y(),s=Y(),r=Y(),i=Y(),l=Y(),c=Y(),m=Y(),d=Y(),y=Y(),p=Y();let h=Te(n,"id",8),f=Te(n,"x",8),v=Te(n,"y",8),k=Te(n,"shape",8),b=Te(n,"segments",8,null),M=Te(n,"rotation",8,0),P=Te(n,"selected",8,!1),E=Te(n,"screenToSvg",8),S=Te(n,"onSelect",8,()=>{}),I=Te(n,"onDrag",8,()=>{}),$=Te(n,"onRotate",8,()=>{});function U(ve){const We=ve.map(pt=>pt.x),me=ve.map(pt=>pt.y);return{minX:Math.min(...We),maxX:Math.max(...We),minY:Math.min(...me),maxY:Math.max(...me)}}let B=Y(!1),G=!1,q={x:0,y:0};function ae(ve){ve.stopPropagation(),S()(h())}function Q(ve){if(ve.button!==0)return;ve.preventDefault(),ve.stopPropagation(),S()(h()),g(B,!0);const We=E()(ve.clientX,ve.clientY);q={x:We.x-f(),y:We.y-v()},window.addEventListener("mousemove",de),window.addEventListener("mouseup",re)}function de(ve){if(!e(B))return;const We=E()(ve.clientX,ve.clientY);let me=We.x-q.x,pt=We.y-q.y;ve.shiftKey||(me=Math.round(me),pt=Math.round(pt));const lt=Math.max(e(r),e(i));me=Math.max(-lt,Math.min(et.width+lt-e(r),me)),pt=Math.max(-lt,Math.min(et.height+lt-e(i),pt)),I()(h(),me,pt)}function re(){g(B,!1),window.removeEventListener("mousemove",de),window.removeEventListener("mouseup",re)}function ne(ve){ve.preventDefault(),ve.stopPropagation(),G=!0,window.addEventListener("mousemove",Ee),window.addEventListener("mouseup",_e)}function Ee(ve){if(!G)return;const We=E()(ve.clientX,ve.clientY),me=We.x-e(l),pt=We.y-e(c);let lt=Math.atan2(pt,me)*180/Math.PI+45;ve.shiftKey||(lt=Math.round(lt/15)*15),$()(h(),lt)}function _e(){G=!1,window.removeEventListener("mousemove",Ee),window.removeEventListener("mouseup",_e)}he(()=>(L(k()),L(b())),()=>{g(a,ya(k(),b()))}),he(()=>e(a),()=>{g(s,U(e(a)))}),he(()=>e(s),()=>{g(r,e(s).maxX-e(s).minX)}),he(()=>e(s),()=>{g(i,e(s).maxY-e(s).minY)}),he(()=>(L(f()),e(s),e(r)),()=>{g(l,f()+e(s).minX+e(r)/2)}),he(()=>(L(v()),e(s),e(i)),()=>{g(c,v()+e(s).minY+e(i)/2)}),he(()=>(e(a),L(f()),L(v())),()=>{g(m,e(a).length>0?`M ${e(a).map(ve=>`${f()+ve.x},${v()+ve.y}`).join(" L ")} Z`:"")}),he(()=>(e(r),e(i)),()=>{g(d,Math.max(e(r),e(i))/2+1.5)}),he(()=>(e(l),e(d),L(M())),()=>{g(y,e(l)+e(d)*Math.cos((M()-45)*Math.PI/180))}),he(()=>(e(c),e(d),L(M())),()=>{g(p,e(c)+e(d)*Math.sin((M()-45)*Math.PI/180))}),Ya(),ia();var xe=Au();let ee;var ke=w(xe),ue=w(ke),ye=T(ke);{var Ke=ve=>{var We=Su(),me=ce(We),pt=T(me);X(()=>{u(me,"x1",e(l)),u(me,"y1",e(c)),u(me,"x2",e(y)),u(me,"y2",e(p)),u(me,"stroke",(L(te),o(()=>te.selection.highlight))),u(pt,"cx",e(y)),u(pt,"cy",e(p)),u(pt,"fill",(L(te),o(()=>te.selection.highlight))),u(pt,"stroke",(L(te),o(()=>te.selection.highlightDark)))}),oe("mousedown",pt,ne),A(ve,We)};Z(ye,ve=>{P()&&ve(Ke)})}X(()=>{ee=wn(xe,0,"wall-piece svelte-x1kcna",null,ee,{selected:P(),dragging:e(B)}),u(ke,"transform",`rotate(${M()??""}, ${e(l)??""}, ${e(c)??""})`),u(ue,"d",e(m)),u(ue,"fill",(L(P()),L(te),o(()=>P()?te.wall.fillSelected:te.wall.fill))),u(ue,"stroke",(L(P()),L(te),o(()=>P()?te.selection.highlight:te.wall.stroke))),u(ue,"stroke-width",P()?.15:.1)}),oe("click",ue,ae),oe("mousedown",ue,Q),A(t,xe),Jn()}var Cu=le('<g class="svelte-1vg3k6o"><rect role="button" tabindex="0" class="svelte-1vg3k6o"></rect></g>'),ku=le('<g class="svelte-1vg3k6o"><ellipse role="button" tabindex="0" class="svelte-1vg3k6o"></ellipse></g>'),Mu=le('<circle role="button" tabindex="0" class="svelte-1vg3k6o"></circle>'),Eu=le('<text text-anchor="middle" dominant-baseline="middle" font-weight="bold" fill="white" stroke="black" stroke-width="0.02" paint-order="stroke" pointer-events="none" class="model-name svelte-1vg3k6o"> </text>'),Ru=le('<line stroke-width="0.1" stroke-dasharray="0.3,0.15" class="svelte-1vg3k6o"></line><circle r="0.8" stroke-width="0.1" role="button" tabindex="0" class="rotate-handle svelte-1vg3k6o"></circle><g pointer-events="none" class="svelte-1vg3k6o"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08" class="svelte-1vg3k6o"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08" class="svelte-1vg3k6o"></path></g>',1),Du=le('<line stroke-width="0.12" stroke-dasharray="0.3,0.15" pointer-events="none" class="svelte-1vg3k6o"></line><circle r="0.25" pointer-events="none" class="svelte-1vg3k6o"></circle><text text-anchor="middle" dominant-baseline="middle" font-size="0.5" font-weight="bold" stroke="#000" stroke-width="0.05" paint-order="stroke" pointer-events="none" class="drag-ruler-label svelte-1vg3k6o"> </text>',1),Iu=le("<g><!><!><!><!></g>");function Ps(t,n){Zn(n,!1);const a=Y(),s=Y(),r=Y(),i=Y(),l=Y(),c=Y(),m=Y(),d=Y(),y=Y(),p=Y(),h=Y(),f=Y(),v=Y(),k=Y(),b=Y(),M=Y(),P=Y(),E=Y(),S=Y(),I=Y(),$=Y(),U=Y(),B=Y();let G=Te(n,"id",8),q=Te(n,"x",8),ae=Te(n,"y",8),Q=Te(n,"baseType",8),de=Te(n,"playerId",8),re=Te(n,"rotation",8,0),ne=Te(n,"selected",8,!1),Ee=Te(n,"marqueePreview",8,!1),_e=Te(n,"inGroupSelection",8,!1),xe=Te(n,"name",8,""),ee=Te(n,"customWidth",8,null),ke=Te(n,"customHeight",8,null),ue=Te(n,"unitStrokeColor",8,null),ye=Te(n,"coherencyViolation",8,!1),Ke=Te(n,"screenToSvg",8),ve=Te(n,"onSelect",8,()=>{}),We=Te(n,"onDrag",8,()=>{}),me=Te(n,"onDragEnd",8,()=>{}),pt=Te(n,"onRotate",8,()=>{}),lt=Te(n,"onRotateEnd",8,()=>{}),Pt=Te(n,"onRename",8,()=>{}),yt=Y(!1),st=!1,vt={x:0,y:0},ze=Y(null),Zt=null;function It(De){De.stopPropagation()}function Ft(De){De.stopPropagation();const Be=prompt("Model name:",xe());Be!==null&&Pt()(G(),Be)}function Sn(De){if(De.button!==0)return;De.preventDefault(),De.stopPropagation(),ve()(G(),De),g(yt,!0),g(ze,{x:q(),y:ae()});const Be=Ke()(De.clientX,De.clientY);vt={x:Be.x-q(),y:Be.y-ae()},window.addEventListener("mousemove",Rt),window.addEventListener("mouseup",St)}function Rt(De){if(!e(yt))return;const Be=Ke()(De.clientX,De.clientY);let ct=Be.x-vt.x,zt=Be.y-vt.y;We()(G(),ct,zt)}function St(){e(yt)&&e(ze)&&((e(ze).x!==q()||e(ze).y!==ae())&&me()(G(),e(ze).x,e(ze).y,q(),ae()),g(ze,null)),g(yt,!1),window.removeEventListener("mousemove",Rt),window.removeEventListener("mouseup",St)}function en(De){De.preventDefault(),De.stopPropagation(),st=!0,Zt=re(),window.addEventListener("mousemove",ie),window.addEventListener("mouseup",He)}function ie(De){if(!st)return;const Be=Ke()(De.clientX,De.clientY),ct=Be.x-q(),zt=Be.y-ae();let vn=Math.atan2(zt,ct)*180/Math.PI+45;De.shiftKey||(vn=Math.round(vn/15)*15),pt()(G(),vn)}function He(){st&&Zt!==null&&(Zt!==re()&&lt()(G(),Zt,re()),Zt=null),st=!1,window.removeEventListener("mousemove",ie),window.removeEventListener("mouseup",He)}he(()=>(L(ee()),L(ke())),()=>{g(a,{customWidth:ee(),customHeight:ke()})}),he(()=>(L(Q()),e(a)),()=>{g(s,pn(Q(),e(a)))}),he(()=>L(Q()),()=>{g(r,cn(Q()))}),he(()=>L(Q()),()=>{g(i,Fn(Q()))}),he(()=>L(de()),()=>{g(l,hs(de()))}),he(()=>e(l),()=>{g(c,e(l).primary)}),he(()=>e(l),()=>{g(m,e(l).fill)}),he(()=>e(l),()=>{g(d,e(l).fillLight)}),he(()=>(L(ne()),L(Ee()),L(ye())),()=>{g(y,ne()?.15:Ee()?.12:ye()?.15:.1)}),he(()=>(L(ne()),e(c),L(Ee()),e(d),L(ye()),e(m)),()=>{g(p,ne()?e(c):Ee()?e(d):ye()?"rgba(239, 68, 68, 0.3)":e(m))}),he(()=>(L(ye()),L(ue()),e(c)),()=>{g(h,ye()?"#ef4444":ue()||e(c))}),he(()=>e(s),()=>{g(f,e(s)?.radius||.5)}),he(()=>e(s),()=>{g(v,e(s)?.width?e(s).width/2:0)}),he(()=>e(s),()=>{g(k,e(s)?.height?e(s).height/2:0)}),he(()=>(e(i),L(ee())),()=>{g(b,e(i)&&ee()||0)}),he(()=>(e(i),L(ke())),()=>{g(M,e(i)&&ke()||0)}),he(()=>(e(r),e(v),e(k),e(i),e(b),e(M)),()=>{g(P,e(r)?Math.max(e(v),e(k))+1:e(i)?Math.max(e(b),e(M))/2+1:0)}),he(()=>(L(q()),e(P),L(re())),()=>{g(E,q()+e(P)*Math.cos((re()-45)*Math.PI/180))}),he(()=>(L(ae()),e(P),L(re())),()=>{g(S,ae()+e(P)*Math.sin((re()-45)*Math.PI/180))}),he(()=>(e(yt),e(ze),L(q()),L(ae())),()=>{g(I,e(yt)&&e(ze)?Math.sqrt(Math.pow(q()-e(ze).x,2)+Math.pow(ae()-e(ze).y,2)):0)}),he(()=>(e(yt),e(ze),L(q())),()=>{g($,e(yt)&&e(ze)?(e(ze).x+q())/2:0)}),he(()=>(e(yt),e(ze),L(ae())),()=>{g(U,e(yt)&&e(ze)?(e(ze).y+ae())/2:0)}),he(()=>(e(i),e(b),e(M),e(r),e(v),e(k),e(f)),()=>{g(B,e(i)?Math.min(e(b),e(M))*.2:e(r)?Math.min(e(v),e(k))*.4:e(f)*.5)}),Ya(),ia();var tt=Iu();let Gt;var Lt=w(tt);{var gt=De=>{var Be=Cu(),ct=w(Be);X(()=>{u(Be,"transform",`rotate(${re()??""}, ${q()??""}, ${ae()??""})`),u(ct,"x",q()-e(b)/2),u(ct,"y",ae()-e(M)/2),u(ct,"width",e(b)),u(ct,"height",e(M)),u(ct,"fill",e(p)),u(ct,"stroke",e(h)),u(ct,"stroke-width",e(y))}),oe("click",ct,It),oe("dblclick",ct,Ft),oe("mousedown",ct,Sn),A(De,Be)},tn=De=>{var Be=qe(),ct=ce(Be);{var zt=Pn=>{var Xt=ku(),xn=w(Xt);X(()=>{u(Xt,"transform",`rotate(${re()??""}, ${q()??""}, ${ae()??""})`),u(xn,"cx",q()),u(xn,"cy",ae()),u(xn,"rx",e(v)),u(xn,"ry",e(k)),u(xn,"fill",e(p)),u(xn,"stroke",e(h)),u(xn,"stroke-width",e(y))}),oe("click",xn,It),oe("dblclick",xn,Ft),oe("mousedown",xn,Sn),A(Pn,Xt)},vn=Pn=>{var Xt=Mu();X(()=>{u(Xt,"cx",q()),u(Xt,"cy",ae()),u(Xt,"r",e(f)),u(Xt,"fill",e(p)),u(Xt,"stroke",e(h)),u(Xt,"stroke-width",e(y))}),oe("click",Xt,It),oe("dblclick",Xt,Ft),oe("mousedown",Xt,Sn),A(Pn,Xt)};Z(ct,Pn=>{e(r)?Pn(zt):Pn(vn,!1)},!0)}A(De,Be)};Z(Lt,De=>{e(i)?De(gt):De(tn,!1)})}var En=T(Lt);{var sn=De=>{var Be=Eu(),ct=w(Be);X(()=>{u(Be,"x",q()),u(Be,"y",ae()),u(Be,"font-size",e(B)),Ye(ct,xe())}),A(De,Be)};Z(En,De=>{xe()&&De(sn)})}var Wt=T(En);{var yn=De=>{var Be=Ru(),ct=ce(Be),zt=T(ct),vn=T(zt);X(()=>{u(ct,"x1",q()),u(ct,"y1",ae()),u(ct,"x2",e(E)),u(ct,"y2",e(S)),u(ct,"stroke",(L(te),o(()=>te.selection.handle))),u(zt,"cx",e(E)),u(zt,"cy",e(S)),u(zt,"fill",(L(te),o(()=>te.selection.handle))),u(zt,"stroke",(L(te),o(()=>te.selection.handleDark))),u(vn,"transform",`translate(${e(E)??""}, ${e(S)??""})`)}),oe("mousedown",zt,en),A(De,Be)};Z(Wt,De=>{ne()&&(e(r)||e(i))&&!_e()&&De(yn)})}var $n=T(Wt);{var Wn=De=>{var Be=Du(),ct=ce(Be),zt=T(ct),vn=T(zt),Pn=w(vn);X(Xt=>{u(ct,"x1",(e(ze),o(()=>e(ze).x))),u(ct,"y1",(e(ze),o(()=>e(ze).y))),u(ct,"x2",q()),u(ct,"y2",ae()),u(ct,"stroke",(L(te),o(()=>te.selection.dragRuler))),u(zt,"cx",(e(ze),o(()=>e(ze).x))),u(zt,"cy",(e(ze),o(()=>e(ze).y))),u(zt,"fill",(L(te),o(()=>te.selection.dragRuler))),u(vn,"x",e($)),u(vn,"y",e(U)-.5),u(vn,"fill",(L(te),o(()=>te.selection.dragRuler))),Ye(Pn,`${Xt??""}"`)},[()=>(e(I),o(()=>e(I).toFixed(2)))]),A(De,Be)};Z($n,De=>{e(yt)&&e(ze)&&e(I)>.1&&De(Wn)})}X(()=>Gt=wn(tt,0,"model-base svelte-1vg3k6o",null,Gt,{selected:ne(),dragging:e(yt),"coherency-violation":ye()})),A(t,tt),Jn()}var Lu=le('<rect x="0" y="0"></rect>'),$u=le('<line stroke-width="0.05"></line>'),Pu=le('<line stroke-width="0.05"></line>'),Nu=le('<line stroke-width="0.08"></line>'),Ou=le('<line stroke-width="0.08"></line>'),Wu=le("<!><!><!><!>",1),Yu=le('<text text-anchor="middle" class="ruler-text svelte-lpn8p2"> </text>'),Hu=le("<line></line><!>",1),Bu=le('<text text-anchor="middle" class="ruler-text svelte-lpn8p2"> </text>'),Fu=le("<line></line><!>",1),qu=le('<text text-anchor="middle" class="ruler-text svelte-lpn8p2"> </text>'),Uu=le("<line></line><!>",1),Ku=le('<text text-anchor="middle" class="ruler-text svelte-lpn8p2"> </text>'),Gu=le("<line></line><!>",1),zu=le("<!><!><!><!>",1),Xu=le('<path stroke-width="0.10" stroke-dasharray="0.5,0.25"></path>'),Vu=le('<line stroke-width="0.05"></line>'),ju=le('<g><rect stroke-width="0.1"></rect></g>'),Zu=le('<g><path stroke-width="0.1"></path></g>'),Ju=le('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15"></circle><circle stroke-width="0.06"></circle><circle r="0.15"></circle>',1),Qu=le('<g><rect stroke-width="0.1"></rect></g>'),em=le('<g><ellipse stroke-width="0.1"></ellipse></g>'),tm=le('<circle stroke-width="0.1"></circle>'),nm=le('<line stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),am=le('<line stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),rm=le('<svg preserveAspectRatio="xMidYMid meet"><!><rect></rect><!><!><g><!><!><!><!><!><!><!><!></g></svg>');function Us(t,n){Zn(n,!1);const a=()=>Ht(ks,"$battlefieldView",s),[s,r]=Ur(),i=Y(),l=Y(),c=Y(),m=Y(),d=Y(),y=Y(),p=Y(),h=Y();let f=Y();const v=2,k=et.width+v*2,b=et.height+v*2;let M=Te(n,"deploymentZones",8,null),P=Te(n,"objectives",8,null),E=Te(n,"terrains",8,null),S=Te(n,"walls",8,null),I=Te(n,"models",8,null),$=Te(n,"losResults",8,null),U=Te(n,"showGrid",8,!0),B=Te(n,"showRuler",8,!0),G=Te(n,"interactiveTerrain",8,!1),q=Te(n,"interactiveWalls",8,!1),ae=Te(n,"interactiveModels",8,!1),Q=Te(n,"showDebugRays",8,!1),de=Te(n,"selectedTerrainId",8,null),re=Te(n,"selectedWallId",8,null),ne=Te(n,"selectedModelId",8,null),Ee=Te(n,"onTerrainSelect",8,()=>{}),_e=Te(n,"onTerrainDrag",8,()=>{}),xe=Te(n,"onTerrainRotate",8,()=>{}),ee=Te(n,"onWallSelect",8,()=>{}),ke=Te(n,"onWallDrag",8,()=>{}),ue=Te(n,"onWallRotate",8,()=>{}),ye=Te(n,"onModelSelect",8,()=>{}),Ke=Te(n,"onModelDrag",8,()=>{}),ve=Te(n,"onModelDragEnd",8,()=>{}),We=Te(n,"onModelRotate",8,()=>{}),me=Te(n,"onModelRotateEnd",8,()=>{}),pt=Te(n,"onModelRename",8,()=>{}),lt=Te(n,"onBackgroundClick",8,()=>{}),Pt=Y(!1),yt={x:0,y:0},st=Y(!1);const vt=.5,ze=4;function Zt(se,Fe){if(!e(f))return{x:0,y:0};const bt=e(f).createSVGPoint();bt.x=se,bt.y=Fe;const wt=bt.matrixTransform(e(f).getScreenCTM().inverse());return{x:wt.x-v,y:wt.y-v}}function It(se){se.preventDefault();const Fe=e(f).getBoundingClientRect(),bt=se.clientX-Fe.left,wt=se.clientY-Fe.top,Me=e(c)+bt/Fe.width*e(i),Je=e(m)+wt/Fe.height*e(l),Ge=se.deltaY>0?.9:1.1,Re=Math.max(vt,Math.min(ze,a().zoom*Ge)),Pe=k/Re,R=b/Re,Ze=Me-bt/Fe.width*Pe,Tt=Je-wt/Fe.height*R;ks.set({zoom:Re,panX:Ze,panY:Tt})}function Ft(se){(se.button===1||se.button===0&&e(st))&&(se.preventDefault(),g(Pt,!0),yt={x:se.clientX,y:se.clientY})}function Sn(se){if(!e(Pt))return;const Fe=e(f).getBoundingClientRect(),bt=(se.clientX-yt.x)/Fe.width*e(i),wt=(se.clientY-yt.y)/Fe.height*e(l);ks.update(Me=>({...Me,panX:Me.panX-bt,panY:Me.panY-wt})),yt={x:se.clientX,y:se.clientY}}function Rt(){g(Pt,!1)}function St(se){se.code==="Space"&&!se.repeat&&se.target.tagName!=="INPUT"&&(se.preventDefault(),g(st,!0))}function en(se){se.code==="Space"&&g(st,!1)}function ie(){Tu()}function He(se){(se.target===se.currentTarget||se.target.tagName==="rect")&&lt()()}function tt(se){const Fe=ya(se.shape,se.segments);return Fe.length===0?"":`M ${Fe.map(bt=>`${se.x+bt.x},${se.y+bt.y}`).join(" L ")} Z`}function Gt(se){const Fe=ya(se.shape,se.segments);if(Fe.length===0)return{x:se.x,y:se.y};const bt=Fe.map(Pe=>Pe.x),wt=Fe.map(Pe=>Pe.y),Me=Math.min(...bt),Je=Math.max(...bt),Ge=Math.min(...wt),Re=Math.max(...wt);return{x:se.x+Me+(Je-Me)/2,y:se.y+Ge+(Re-Ge)/2}}he(()=>a(),()=>{g(i,k/a().zoom)}),he(()=>a(),()=>{g(l,b/a().zoom)}),he(()=>a(),()=>{g(c,a().panX)}),he(()=>a(),()=>{g(m,a().panY)}),he(()=>(e(c),e(m),e(i),e(l)),()=>{g(d,`${e(c)} ${e(m)} ${e(i)} ${e(l)}`)}),he(()=>et,()=>{g(y,Array.from({length:et.width+1},(se,Fe)=>Fe))}),he(()=>et,()=>{g(p,Array.from({length:et.height+1},(se,Fe)=>Fe))}),he(()=>(L(I()),L(ne())),()=>{g(h,I()?.find(se=>se.id===ne()))}),Ya();var Lt={screenToSvg:Zt};ia();var gt=rm();oe("keydown",Dr,St),oe("keyup",Dr,en),oe("mouseup",Dr,Rt),oe("mousemove",Dr,Sn);let tn;var En=w(gt);{var sn=se=>{var Fe=Lu();X(()=>{u(Fe,"width",(L(et),o(()=>et.width+v*2))),u(Fe,"height",(L(et),o(()=>et.height+v*2))),u(Fe,"fill",(L(te),o(()=>te.battlefield.rulerBackground)))}),A(se,Fe)};Z(En,se=>{B()&&se(sn)})}var Wt=T(En);u(Wt,"x",v),u(Wt,"y",v);var yn=T(Wt);{var $n=se=>{var Fe=Wu(),bt=ce(Fe);je(bt,1,()=>(L(et),o(()=>Array(et.width+1))),ft,(Ge,Re,Pe)=>{var R=$u();u(R,"x1",v+Pe),u(R,"y1",v),u(R,"x2",v+Pe),X(()=>{u(R,"y2",(L(et),o(()=>v+et.height))),u(R,"stroke",(L(te),o(()=>te.battlefield.gridFine)))}),A(Ge,R)});var wt=T(bt);je(wt,1,()=>(L(et),o(()=>Array(et.height+1))),ft,(Ge,Re,Pe)=>{var R=Pu();u(R,"x1",v),u(R,"y1",v+Pe),u(R,"y2",v+Pe),X(()=>{u(R,"x2",(L(et),o(()=>v+et.width))),u(R,"stroke",(L(te),o(()=>te.battlefield.gridFine)))}),A(Ge,R)});var Me=T(wt);je(Me,1,()=>(L(et),o(()=>Array(Math.floor(et.width/6)+1))),ft,(Ge,Re,Pe)=>{var R=Nu();u(R,"x1",v+Pe*6),u(R,"y1",v),u(R,"x2",v+Pe*6),X(()=>{u(R,"y2",(L(et),o(()=>v+et.height))),u(R,"stroke",(L(te),o(()=>te.battlefield.gridCoarse)))}),A(Ge,R)});var Je=T(Me);je(Je,1,()=>(L(et),o(()=>Array(Math.floor(et.height/6)+1))),ft,(Ge,Re,Pe)=>{var R=Ou();u(R,"x1",v),u(R,"y1",v+Pe*6),u(R,"y2",v+Pe*6),X(()=>{u(R,"x2",(L(et),o(()=>v+et.width))),u(R,"stroke",(L(te),o(()=>te.battlefield.gridCoarse)))}),A(Ge,R)}),A(se,Fe)};Z(yn,se=>{U()&&se($n)})}var Wn=T(yn);{var De=se=>{var Fe=zu(),bt=ce(Fe);je(bt,1,()=>e(y),ft,(Ge,Re)=>{var Pe=Hu(),R=ce(Pe);u(R,"y2",v);var Ze=T(R);{var Tt=ut=>{var rt=Yu();u(rt,"y",1.2);var on=w(rt);X(()=>{u(rt,"x",v+e(Re)),Ye(on,`${e(Re)??""}"`)}),A(ut,rt)};Z(Ze,ut=>{e(Re)%6===0&&ut(Tt)})}X(()=>{u(R,"x1",v+e(Re)),u(R,"y1",e(Re)%6===0?.5:v-.8),u(R,"x2",v+e(Re)),u(R,"stroke",(L(te),o(()=>te.battlefield.ruler))),u(R,"stroke-width",e(Re)%6===0?.08:.04)}),A(Ge,Pe)});var wt=T(bt);je(wt,1,()=>e(y),ft,(Ge,Re)=>{var Pe=Fu(),R=ce(Pe),Ze=T(R);{var Tt=ut=>{var rt=Bu(),on=w(rt);X(()=>{u(rt,"x",v+e(Re)),u(rt,"y",(L(et),o(()=>v+et.height+1.8))),Ye(on,`${e(Re)??""}"`)}),A(ut,rt)};Z(Ze,ut=>{e(Re)%6===0&&ut(Tt)})}X(()=>{u(R,"x1",v+e(Re)),u(R,"y1",(L(et),o(()=>v+et.height))),u(R,"x2",v+e(Re)),u(R,"y2",(L(et),e(Re),o(()=>v+et.height+(e(Re)%6===0?1.5:.8)))),u(R,"stroke",(L(te),o(()=>te.battlefield.ruler))),u(R,"stroke-width",e(Re)%6===0?.08:.04)}),A(Ge,Pe)});var Me=T(wt);je(Me,1,()=>e(p),ft,(Ge,Re)=>{var Pe=Uu(),R=ce(Pe);u(R,"x2",v);var Ze=T(R);{var Tt=ut=>{var rt=qu();u(rt,"x",1);var on=w(rt);X(()=>{u(rt,"y",v+e(Re)+.35),Ye(on,`${e(Re)??""}"`)}),A(ut,rt)};Z(Ze,ut=>{e(Re)%6===0&&ut(Tt)})}X(()=>{u(R,"x1",e(Re)%6===0?.5:v-.8),u(R,"y1",v+e(Re)),u(R,"y2",v+e(Re)),u(R,"stroke",(L(te),o(()=>te.battlefield.ruler))),u(R,"stroke-width",e(Re)%6===0?.08:.04)}),A(Ge,Pe)});var Je=T(Me);je(Je,1,()=>e(p),ft,(Ge,Re)=>{var Pe=Gu(),R=ce(Pe),Ze=T(R);{var Tt=ut=>{var rt=Ku(),on=w(rt);X(()=>{u(rt,"x",(L(et),o(()=>v+et.width+1))),u(rt,"y",v+e(Re)+.35),Ye(on,`${e(Re)??""}"`)}),A(ut,rt)};Z(Ze,ut=>{e(Re)%6===0&&ut(Tt)})}X(()=>{u(R,"x1",(L(et),o(()=>v+et.width))),u(R,"y1",v+e(Re)),u(R,"x2",(L(et),e(Re),o(()=>v+et.width+(e(Re)%6===0?1.5:.8)))),u(R,"y2",v+e(Re)),u(R,"stroke",(L(te),o(()=>te.battlefield.ruler))),u(R,"stroke-width",e(Re)%6===0?.08:.04)}),A(Ge,Pe)}),A(se,Fe)};Z(Wn,se=>{B()&&se(De)})}var Be=T(Wn);u(Be,"transform","translate(2, 2)");var ct=w(Be);{var zt=se=>{var Fe=qe(),bt=ce(Fe);je(bt,1,M,ft,(wt,Me)=>{var Je=Xu();X(Ge=>{u(Je,"d",Ge),u(Je,"fill",(e(Me),o(()=>e(Me).color))),u(Je,"stroke",(e(Me),o(()=>e(Me).borderColor)))},[()=>(L(fr),e(Me),o(()=>fr(e(Me).path)))]),A(wt,Je)}),A(se,Fe)};Z(ct,se=>{M()&&se(zt)})}var vn=T(ct);{var Pn=se=>{var Fe=qe(),bt=ce(Fe);je(bt,1,$,ft,(wt,Me)=>{var Je=qe(),Ge=ce(Je);{var Re=Pe=>{var R=qe(),Ze=ce(R);je(Ze,1,()=>(e(Me),o(()=>e(Me).rays)),ft,(Tt,ut)=>{var rt=Vu();X(()=>{u(rt,"x1",(e(ut),o(()=>e(ut).from.x))),u(rt,"y1",(e(ut),o(()=>e(ut).from.y))),u(rt,"x2",(e(ut),o(()=>e(ut).to.x))),u(rt,"y2",(e(ut),o(()=>e(ut).to.y))),u(rt,"stroke",(e(ut),L(te),o(()=>e(ut).blocked?te.los.rayBlocked:te.los.rayVisible)))}),A(Tt,rt)}),A(Pe,R)};Z(Ge,Pe=>{e(Me),o(()=>e(Me).rays)&&Pe(Re)})}A(wt,Je)}),A(se,Fe)};Z(vn,se=>{L(Q()),L($()),o(()=>Q()&&$()&&$().length>0)&&se(Pn)})}var Xt=T(vn);{var xn=se=>{var Fe=qe(),bt=ce(Fe);{var wt=Je=>{var Ge=qe(),Re=ce(Ge);je(Re,1,E,Pe=>Pe.id,(Pe,R)=>{{let Ze=Ce(()=>(e(R),L(de()),o(()=>e(R).id===de())));wu(Pe,{get id(){return e(R),o(()=>e(R).id)},get x(){return e(R),o(()=>e(R).x)},get y(){return e(R),o(()=>e(R).y)},get width(){return e(R),o(()=>e(R).width)},get height(){return e(R),o(()=>e(R).height)},get rotation(){return e(R),o(()=>e(R).rotation)},get selected(){return e(Ze)},screenToSvg:Zt,get onSelect(){return Ee()},get onDrag(){return _e()},get onRotate(){return xe()}})}}),A(Je,Ge)},Me=Je=>{var Ge=qe(),Re=ce(Ge);je(Re,1,E,ft,(Pe,R)=>{const Ze=Ce(()=>(e(R),o(()=>e(R).x+e(R).width/2))),Tt=Ce(()=>(e(R),o(()=>e(R).y+e(R).height/2)));var ut=ju(),rt=w(ut);X(()=>{u(ut,"transform",`rotate(${e(R),o(()=>e(R).rotation)??""}, ${e(Ze)??""}, ${e(Tt)??""})`),u(rt,"x",(e(R),o(()=>e(R).x))),u(rt,"y",(e(R),o(()=>e(R).y))),u(rt,"width",(e(R),o(()=>e(R).width))),u(rt,"height",(e(R),o(()=>e(R).height))),u(rt,"fill",(L(te),o(()=>te.terrain.fillStatic))),u(rt,"stroke",(L(te),o(()=>te.terrain.stroke)))}),A(Pe,ut)}),A(Je,Ge)};Z(bt,Je=>{G()?Je(wt):Je(Me,!1)})}A(se,Fe)};Z(Xt,se=>{E()&&se(xn)})}var er=T(Xt);{var vr=se=>{var Fe=qe(),bt=ce(Fe);{var wt=Je=>{var Ge=qe(),Re=ce(Ge);je(Re,1,S,Pe=>Pe.id,(Pe,R)=>{{let Ze=Ce(()=>(e(R),L(re()),o(()=>e(R).id===re())));xi(Pe,{get id(){return e(R),o(()=>e(R).id)},get x(){return e(R),o(()=>e(R).x)},get y(){return e(R),o(()=>e(R).y)},get shape(){return e(R),o(()=>e(R).shape)},get segments(){return e(R),o(()=>e(R).segments)},get rotation(){return e(R),o(()=>e(R).rotation)},get selected(){return e(Ze)},screenToSvg:Zt,get onSelect(){return ee()},get onDrag(){return ke()},get onRotate(){return ue()}})}}),A(Je,Ge)},Me=Je=>{var Ge=qe(),Re=ce(Ge);je(Re,1,S,ft,(Pe,R)=>{const Ze=Ce(()=>(e(R),o(()=>Gt(e(R)))));var Tt=Zu(),ut=w(Tt);X(rt=>{u(Tt,"transform",`rotate(${e(R),o(()=>e(R).rotation)??""}, ${L(e(Ze)),o(()=>e(Ze).x)??""}, ${L(e(Ze)),o(()=>e(Ze).y)??""})`),u(ut,"d",rt),u(ut,"fill",(L(te),o(()=>te.wall.fill))),u(ut,"stroke",(L(te),o(()=>te.wall.stroke)))},[()=>(e(R),o(()=>tt(e(R))))]),A(Pe,Tt)}),A(Je,Ge)};Z(bt,Je=>{q()?Je(wt):Je(Me,!1)})}A(se,Fe)};Z(er,se=>{S()&&se(vr)})}var tr=T(er);{var Aa=se=>{var Fe=qe(),bt=ce(Fe);je(bt,1,P,ft,(wt,Me)=>{const Je=Ce(()=>(e(Me),L(te),o(()=>e(Me).isPrimary?te.objective.primary:te.objective.secondary))),Ge=Ce(()=>(e(Me),L(te),o(()=>e(Me).isPrimary?te.objective.primaryControl:te.objective.secondaryControl)));var Re=Ju(),Pe=ce(Re),R=T(Pe),Ze=T(R);X(()=>{u(Pe,"cx",(e(Me),o(()=>e(Me).x))),u(Pe,"cy",(e(Me),o(()=>e(Me).y))),u(Pe,"r",qs),u(Pe,"fill",e(Ge)),u(Pe,"stroke",e(Je)),u(R,"cx",(e(Me),o(()=>e(Me).x))),u(R,"cy",(e(Me),o(()=>e(Me).y))),u(R,"r",Fs),u(R,"fill",e(Je)),u(R,"stroke",(L(te),o(()=>te.objective.center))),u(Ze,"cx",(e(Me),o(()=>e(Me).x))),u(Ze,"cy",(e(Me),o(()=>e(Me).y))),u(Ze,"fill",(L(te),o(()=>te.objective.center)))}),A(wt,Re)}),A(se,Fe)};Z(tr,se=>{P()&&se(Aa)})}var Ha=T(tr);{var Ca=se=>{var Fe=qe(),bt=ce(Fe);{var wt=Je=>{var Ge=qe(),Re=ce(Ge);je(Re,1,I,Pe=>Pe.id,(Pe,R)=>{{let Ze=Ce(()=>(e(R),o(()=>e(R).name||""))),Tt=Ce(()=>(e(R),L(ne()),o(()=>e(R).id===ne())));Ps(Pe,{get id(){return e(R),o(()=>e(R).id)},get x(){return e(R),o(()=>e(R).x)},get y(){return e(R),o(()=>e(R).y)},get baseType(){return e(R),o(()=>e(R).baseType)},get playerId(){return e(R),o(()=>e(R).playerId)},get rotation(){return e(R),o(()=>e(R).rotation)},get name(){return e(Ze)},get selected(){return e(Tt)},screenToSvg:Zt,get onSelect(){return ye()},get onDrag(){return Ke()},get onDragEnd(){return ve()},get onRotate(){return We()},get onRotateEnd(){return me()},get onRename(){return pt()}})}}),A(Je,Ge)},Me=Je=>{var Ge=qe(),Re=ce(Ge);je(Re,1,I,ft,(Pe,R)=>{const Ze=Ce(()=>(L(pn),e(R),o(()=>pn(e(R).baseType)))),Tt=Ce(()=>(L(hs),e(R),o(()=>hs(e(R).playerId)))),ut=Ce(()=>(L(cn),e(R),o(()=>cn(e(R).baseType)))),rt=Ce(()=>(L(Fn),e(R),o(()=>Fn(e(R).baseType))));var on=qe(),br=ce(on);{var Tr=Un=>{var oa=Qu(),Kn=w(oa);X(()=>{u(oa,"transform",`rotate(${e(R),o(()=>e(R).rotation||0)??""}, ${e(R),o(()=>e(R).x)??""}, ${e(R),o(()=>e(R).y)??""})`),u(Kn,"x",(e(R),o(()=>e(R).x-(e(R).customWidth||0)/2))),u(Kn,"y",(e(R),o(()=>e(R).y-(e(R).customHeight||0)/2))),u(Kn,"width",(e(R),o(()=>e(R).customWidth||0))),u(Kn,"height",(e(R),o(()=>e(R).customHeight||0))),u(Kn,"fill",(L(e(Tt)),o(()=>e(Tt).fill))),u(Kn,"stroke",(L(e(Tt)),o(()=>e(Tt).primary)))}),A(Un,oa)},zr=Un=>{var oa=qe(),Kn=ce(oa);{var Xr=D=>{var K=em(),J=w(K);X(()=>{u(K,"transform",`rotate(${e(R),o(()=>e(R).rotation||0)??""}, ${e(R),o(()=>e(R).x)??""}, ${e(R),o(()=>e(R).y)??""})`),u(J,"cx",(e(R),o(()=>e(R).x))),u(J,"cy",(e(R),o(()=>e(R).y))),u(J,"rx",(L(e(Ze)),o(()=>e(Ze).width/2))),u(J,"ry",(L(e(Ze)),o(()=>e(Ze).height/2))),u(J,"fill",(L(e(Tt)),o(()=>e(Tt).fill))),u(J,"stroke",(L(e(Tt)),o(()=>e(Tt).primary)))}),A(D,K)},xr=D=>{var K=tm();X(()=>{u(K,"cx",(e(R),o(()=>e(R).x))),u(K,"cy",(e(R),o(()=>e(R).y))),u(K,"r",(L(e(Ze)),o(()=>e(Ze).radius))),u(K,"fill",(L(e(Tt)),o(()=>e(Tt).fill))),u(K,"stroke",(L(e(Tt)),o(()=>e(Tt).primary)))}),A(D,K)};Z(Kn,D=>{e(ut)?D(Xr):D(xr,!1)},!0)}A(Un,oa)};Z(br,Un=>{e(rt)?Un(Tr):Un(zr,!1)})}A(Pe,on)}),A(Je,Ge)};Z(bt,Je=>{ae()?Je(wt):Je(Me,!1)})}A(se,Fe)};Z(Ha,se=>{I()&&se(Ca)})}var ga=T(Ha);{var Gr=se=>{var Fe=qe(),bt=ce(Fe);je(bt,1,$,ft,(wt,Me)=>{var Je=qe(),Ge=ce(Je);{var Re=R=>{var Ze=nm();X(()=>{u(Ze,"x1",(e(Me),o(()=>e(Me).firstClearRay.from.x))),u(Ze,"y1",(e(Me),o(()=>e(Me).firstClearRay.from.y))),u(Ze,"x2",(e(Me),o(()=>e(Me).firstClearRay.to.x))),u(Ze,"y2",(e(Me),o(()=>e(Me).firstClearRay.to.y))),u(Ze,"stroke",(L(te),o(()=>te.los.visible)))}),A(R,Ze)},Pe=R=>{var Ze=qe(),Tt=ce(Ze);{var ut=rt=>{var on=am();X(()=>{u(on,"x1",(e(h),o(()=>e(h).x))),u(on,"y1",(e(h),o(()=>e(h).y))),u(on,"x2",(e(Me),o(()=>e(Me).viewer.x))),u(on,"y2",(e(Me),o(()=>e(Me).viewer.y))),u(on,"stroke",(L(te),o(()=>te.los.blocked)))}),A(rt,on)};Z(Tt,rt=>{e(Me),o(()=>e(Me).viewer)&&rt(ut)},!0)}A(R,Ze)};Z(Ge,R=>{e(Me),o(()=>e(Me).firstClearRay)?R(Re):R(Pe,!1)})}A(wt,Je)}),A(se,Fe)};Z(ga,se=>{L(Q()),L($()),e(h),o(()=>Q()&&$()&&$().length>0&&e(h))&&se(Gr)})}var gr=T(ga);Fo(gr,n,"default",{screenToSvg:Zt}),ms(gt,se=>g(f,se),()=>e(f)),X(()=>{u(gt,"viewBox",e(d)),tn=wn(gt,0,"battlefield svelte-lpn8p2",null,tn,{panning:e(Pt)||e(st)}),u(Wt,"width",(L(et),o(()=>et.width))),u(Wt,"height",(L(et),o(()=>et.height))),u(Wt,"fill",(L(te),o(()=>te.battlefield.background)))}),oe("wheel",gt,It),oe("mousedown",gt,Ft),oe("dblclick",gt,ie),oe("click",gt,He),A(t,gt),rs(n,"screenToSvg",Zt);var Ba=Jn(Lt);return r(),Ba}var sm=Se('<div class="section-content svelte-1ms4b45"><!></div>'),im=Se('<section><div class="section-header svelte-1ms4b45" role="button" tabindex="0"><h3 class="svelte-1ms4b45"> </h3> <span class="toggle-icon svelte-1ms4b45"> </span></div> <!></section>');function Ln(t,n){let a=Te(n,"title",8),s=Te(n,"defaultOpen",8,!0),r=Y(s());function i(){g(r,!e(r))}var l=im();let c;var m=w(l),d=w(m),y=w(d),p=T(d,2),h=w(p),f=T(m,2);{var v=k=>{var b=sm(),M=w(b);Fo(M,n,"default",{}),A(k,b)};Z(f,k=>{e(r)&&k(v)})}X(()=>{c=wn(l,1,"collapsible-section svelte-1ms4b45",null,c,{collapsed:!e(r)}),Ye(y,a()),Ye(h,e(r)?"▼":"▶")}),oe("click",m,i),A(t,l)}const za=Tn(null),ra=Tn(null),ha=Tn(null),_i=Sa([ra,ha],([t,n])=>{if(!t)return{terrains:[],walls:[]};if(n==="preset"){const a=Ti.find(s=>s.name===t);return a?{terrains:a.terrains||[],walls:a.walls||[]}:{terrains:[],walls:[]}}else if(n==="saved"){const a=localStorage.getItem("warhammer-deployment-layouts");if(a)try{const s=JSON.parse(a);if(s[t])return{terrains:s[t].terrains||[],walls:s[t].walls||[]}}catch(s){console.error("Failed to load layout:",s)}}return{terrains:[],walls:[]}});var om=Se('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),lm=Se('<button class="svelte-1jotvmi"> </button>'),cm=Se('<div class="button-group svelte-1jotvmi"></div>'),um=Se('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),mm=Se('<button class="svelte-1jotvmi"> </button>'),hm=Se('<button class="svelte-1jotvmi"> </button>'),dm=Se('<div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Saved</h4> <div class="button-group svelte-1jotvmi"></div></div>'),fm=Se('<div class="layout-sections svelte-1jotvmi"><div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Presets</h4> <div class="button-group svelte-1jotvmi"></div></div> <!></div>'),pm=Se('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Objectives:</span> <span class="value svelte-1jotvmi"> </span></div>'),ym=Se('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Pieces:</span> <span class="value svelte-1jotvmi"> </span></div>'),vm=Se('<div class="summary svelte-1jotvmi"><div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Deployment:</span> <span class="value svelte-1jotvmi"> </span></div> <div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Terrain:</span> <span class="value svelte-1jotvmi"> </span></div> <!> <!></div>'),gm=Se('<main class="svelte-1jotvmi"><div class="layout svelte-1jotvmi"><div class="sidebar svelte-1jotvmi"><!> <!> <!></div> <div class="battlefield-area svelte-1jotvmi"><div class="battlefield-container svelte-1jotvmi"><!></div> <div class="info svelte-1jotvmi"><p class="svelte-1jotvmi">Battlefield: 60" x 44"</p> <p class="hint svelte-1jotvmi">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function bm(t,n){Zn(n,!1);const a=()=>Ht(za,"$selectedDeployment",l),s=()=>Ht(ra,"$selectedLayoutName",l),r=()=>Ht(il,"$savedLayoutsList",l),i=()=>Ht(_i,"$loadedTerrain",l),[l,c]=Ur();Kr(()=>{mu()});function m($){za.set($)}function d($){ra.set($.name),ha.set("preset")}function y($){ra.set($),ha.set("saved")}function p(){ra.set(null),ha.set(null)}function h(){za.set(null)}ia();var f=gm(),v=w(f),k=w(v),b=w(k);Ln(b,{title:"Deployment",children:($,U)=>{var B=qe(),G=ce(B);{var q=Q=>{var de=om(),re=w(de),ne=w(re),Ee=T(re,2);X(()=>Ye(ne,a().name)),oe("click",Ee,h),A(Q,de)},ae=Q=>{var de=cm();je(de,5,()=>nl,ft,(re,ne)=>{var Ee=lm(),_e=w(Ee);X(()=>Ye(_e,e(ne).name)),oe("click",Ee,()=>m(e(ne))),A(re,Ee)}),A(Q,de)};Z(G,Q=>{a()?Q(q):Q(ae,!1)})}A($,B)},$$slots:{default:!0}});var M=T(b,2);Ln(M,{title:"Terrain Layout",children:($,U)=>{var B=qe(),G=ce(B);{var q=Q=>{var de=um(),re=w(de),ne=w(re),Ee=T(re,2);X(()=>Ye(ne,s())),oe("click",Ee,p),A(Q,de)},ae=Q=>{var de=fm(),re=w(de),ne=T(w(re),2);je(ne,5,()=>Ti,ft,(xe,ee)=>{var ke=mm(),ue=w(ke);X(()=>Ye(ue,e(ee).name)),oe("click",ke,()=>d(e(ee))),A(xe,ke)});var Ee=T(re,2);{var _e=xe=>{var ee=dm(),ke=T(w(ee),2);je(ke,5,r,ft,(ue,ye)=>{var Ke=hm(),ve=w(Ke);X(()=>Ye(ve,e(ye).name)),oe("click",Ke,()=>y(e(ye).name)),A(ue,Ke)}),A(xe,ee)};Z(Ee,xe=>{r().length>0&&xe(_e)})}A(Q,de)};Z(G,Q=>{s()?Q(q):Q(ae,!1)})}A($,B)},$$slots:{default:!0}});var P=T(M,2);Ln(P,{title:"Summary",children:($,U)=>{var B=vm(),G=w(B),q=T(w(G),2),ae=w(q),Q=T(G,2),de=T(w(Q),2),re=w(de),ne=T(Q,2);{var Ee=ee=>{var ke=pm(),ue=T(w(ke),2),ye=w(ue);X(()=>Ye(ye,a().objectives.length)),A(ee,ke)};Z(ne,ee=>{a()&&ee(Ee)})}var _e=T(ne,2);{var xe=ee=>{var ke=ym(),ue=T(w(ke),2),ye=w(ue);X(()=>Ye(ye,`${i().terrains.length??""} terrain, ${i().walls.length??""} walls`)),A(ee,ke)};Z(_e,ee=>{(i().terrains.length>0||i().walls.length>0)&&ee(xe)})}X(()=>{Ye(ae,a()?.name||"None"),Ye(re,s()||"None")}),A($,B)},$$slots:{default:!0}});var E=T(k,2),S=w(E),I=w(S);{let $=Ce(()=>a()?.zones),U=Ce(()=>a()?.objectives);Us(I,{get deploymentZones(){return e($)},get objectives(){return e(U)},get terrains(){return i().terrains},get walls(){return i().walls}})}A(t,f),Jn(),c()}var Tm=le('<ellipse fill="none" stroke-width="2"></ellipse>'),xm=le('<circle fill="none" stroke-width="2"></circle>'),_m=Se('<button class="palette-item svelte-1t25izx"><svg class="svelte-1t25izx"><!></svg> <span class="label svelte-1t25izx"> </span></button>');function Ns(t,n){Zn(n,!1);const a=Y(),s=Y(),r=Y(),i=Y(),l=Y(),c=Y();let m=Te(n,"baseSize",8),d=Te(n,"playerId",8),y=Te(n,"onDragStart",8,()=>{});const p=3;function h(S){S.button===0&&(S.preventDefault(),y()(m(),S))}he(()=>L(d()),()=>{g(a,d()===1?"#3b82f6":"#ef4444")}),he(()=>L(m()),()=>{g(s,m().width!==void 0)}),he(()=>(e(s),L(m())),()=>{g(r,e(s)?null:m().radius*p)}),he(()=>(e(s),L(m())),()=>{g(i,e(s)?m().width/2*p:null)}),he(()=>(e(s),L(m())),()=>{g(l,e(s)?m().height/2*p:null)}),he(()=>(e(s),L(m())),()=>{g(c,e(s)?Math.max(m().width,m().height)*p:m().radius*2*p)}),Ya(),ia();var f=_m(),v=w(f),k=w(v);{var b=S=>{var I=Tm();X(()=>{u(I,"cx",(e(c)+8)/2),u(I,"cy",(e(c)+8)/2),u(I,"rx",e(i)),u(I,"ry",e(l)),u(I,"stroke",e(a))}),A(S,I)},M=S=>{var I=xm();X(()=>{u(I,"cx",(e(c)+8)/2),u(I,"cy",(e(c)+8)/2),u(I,"r",e(r)),u(I,"stroke",e(a))}),A(S,I)};Z(k,S=>{e(s)?S(b):S(M,!1)})}var P=T(v,2),E=w(P);X(()=>{Pc(f,`border-color: ${e(a)??""}`),u(f,"title",(L(m()),o(()=>m().label))),u(v,"width",e(c)+8),u(v,"height",e(c)+8),u(v,"viewBox",`0 0 ${e(c)+8} ${e(c)+8}`),Ye(E,(L(m()),o(()=>m().label)))}),oe("mousedown",f,h),A(t,f),Jn()}const ml="warhammer-imported-armies";function wm(){try{const t=localStorage.getItem(ml);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load army imports from storage:",t),[]}}function Xs(t){try{localStorage.setItem(ml,JSON.stringify(t))}catch(n){console.error("Failed to save army imports to storage:",n)}}function Sm(){return"import-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Am(){const{subscribe:t,set:n,update:a}=Tn(wm());return{subscribe:t,addImport(s,r,i,l){const c=Sm(),m={id:c,name:s||"Unnamed Army",timestamp:Date.now(),rawText:r,parsedData:i,faction:i.FACTION_KEYWORD||"Unknown",totalPoints:i.TOTAL_ARMY_POINTS||"0pts",playerId:l};return a(d=>{const y=[...d,m];return Xs(y),y}),c},removeImport(s){a(r=>{const i=r.filter(l=>l.id!==s);return Xs(i),i})},getImport(s){return ma({subscribe:t}).find(i=>i.id===s)||null},clear(){n([]),Xs([])}}}const ii=Am();var Cm=Se('<div class="error-message svelte-11ilo6m"> </div>'),km=Se('<div class="success-message svelte-11ilo6m"> </div>'),Mm=Se("<option> </option>"),Em=Se('<div class="army-import-panel svelte-11ilo6m"><div class="form-group svelte-11ilo6m"><label for="army-list-input" class="svelte-11ilo6m">Paste Army List:</label> <textarea id="army-list-input" placeholder="Paste your army list here (GW App, WTC, ListForge formats supported)" rows="12" class="svelte-11ilo6m"></textarea></div> <div class="button-group svelte-11ilo6m"><button class="svelte-11ilo6m"> </button> <button class="svelte-11ilo6m">Clear</button></div> <!> <!> <div class="divider svelte-11ilo6m"></div> <div class="form-group svelte-11ilo6m"><label for="import-select" class="svelte-11ilo6m">Load Previous Import:</label> <select id="import-select" class="svelte-11ilo6m"><option>-- Select an import --</option><!></select> <button class="load-button svelte-11ilo6m">Load</button></div></div>');function Rm(t,n){Zn(n,!1);const a=()=>Ht(ii,"$armyImports",s),[s,r]=Ur();let i=Te(n,"currentPlayer",8,1);const l=Xo();let c=Y(""),m=Y(!1),d=Y(""),y=Y(""),p=Y("");function h(){if(!e(c).trim()){g(d,"Please paste an army list");return}g(m,!0),g(d,""),g(y,""),l("parse",{text:e(c),playerId:i()})}function f(){if(!e(p))return;const ue=ii.getImport(e(p));ue&&(g(c,ue.rawText),g(y,`Loaded: ${ue.name} (${ue.faction}, ${ue.totalPoints})`),g(d,""))}function v(){g(c,""),g(d,""),g(y,"")}function k(ue){g(m,ue)}function b(ue){g(d,ue),g(y,""),g(m,!1)}function M(ue){g(y,ue),g(d,""),g(m,!1)}function P(){g(c,"")}var E={setLoading:k,setError:b,setSuccess:M,clearText:P};ia();var S=Em(),I=w(S),$=T(w(I),2),U=T(I,2),B=w(U),G=w(B),q=T(B,2),ae=T(U,2);{var Q=ue=>{var ye=Cm(),Ke=w(ye);X(()=>Ye(Ke,`⚠️ ${e(d)??""}`)),A(ue,ye)};Z(ae,ue=>{e(d)&&ue(Q)})}var de=T(ae,2);{var re=ue=>{var ye=km(),Ke=w(ye);X(()=>Ye(Ke,`✓ ${e(y)??""}`)),A(ue,ye)};Z(de,ue=>{e(y)&&ue(re)})}var ne=T(de,4),Ee=T(w(ne),2);X(()=>{e(p),Lo(()=>{e(m),a()})});var _e=w(Ee);_e.value=_e.__value="";var xe=T(_e);je(xe,1,a,ue=>ue.id,(ue,ye)=>{var Ke=Mm(),ve=w(Ke),We={};X(()=>{Ye(ve,`${e(ye),o(()=>e(ye).name)??""} (${e(ye),o(()=>e(ye).faction)??""}, ${e(ye),o(()=>e(ye).totalPoints)??""})`),We!==(We=(e(ye),o(()=>e(ye).id)))&&(Ke.value=(Ke.__value=(e(ye),o(()=>e(ye).id)))??"")}),A(ue,Ke)});var ee=T(Ee,2);X(ue=>{$.disabled=e(m),B.disabled=ue,Ye(G,e(m)?"Parsing...":"Parse Army List"),q.disabled=e(m),Ee.disabled=e(m),ee.disabled=e(m)||!e(p)},[()=>(e(m),e(c),o(()=>e(m)||!e(c).trim()))]),ai($,()=>e(c),ue=>g(c,ue)),oe("click",B,h),oe("click",q,v),Uo(Ee,()=>e(p),ue=>g(p,ue)),oe("click",ee,f),A(t,S),rs(n,"setLoading",k),rs(n,"setError",b),rs(n,"setSuccess",M),rs(n,"clearText",P);var ke=Jn(E);return r(),ke}var Dm=Se("<option> </option>"),Im=Se('<tr><td class="unit-name svelte-1qdui6g"> </td><td class="quantity svelte-1qdui6g"> </td><td class="svelte-1qdui6g"><select class="svelte-1qdui6g"></select></td><td class="skip-cell svelte-1qdui6g"><input type="checkbox" class="svelte-1qdui6g"/></td></tr>'),Lm=Se('<div class="dialog-overlay svelte-1qdui6g"><div class="dialog svelte-1qdui6g"><div class="dialog-header svelte-1qdui6g"><h3 class="svelte-1qdui6g">Unmatched Units</h3> <button class="close-button svelte-1qdui6g">&times;</button></div> <div class="dialog-content svelte-1qdui6g"><p class="info-text svelte-1qdui6g">The following units were not found in the database. Please select base sizes or skip them:</p> <div class="units-table svelte-1qdui6g"><table class="svelte-1qdui6g"><thead class="svelte-1qdui6g"><tr><th class="svelte-1qdui6g">Unit Name</th><th class="svelte-1qdui6g">Quantity</th><th class="svelte-1qdui6g">Base Size</th><th class="svelte-1qdui6g">Skip</th></tr></thead><tbody></tbody></table></div></div> <div class="dialog-footer svelte-1qdui6g"><button class="cancel-button svelte-1qdui6g">Cancel</button> <button class="import-button svelte-1qdui6g">Import Selected</button></div></div></div>');function $m(t,n){Zn(n,!1);let a=Te(n,"unmatchedUnits",24,()=>[]),s=Te(n,"show",12,!1);const r=Xo();let i=Y({});const l=[...Vn.circles.map(h=>({value:h.type,label:h.label})),...Vn.ovals.map(h=>({value:h.type,label:h.label})),{value:"rect-custom",label:"Custom Rectangle (Vehicle)"}];function c(){const h=a().filter(f=>!e(i)[f.id]?.skip).map(f=>({unitName:f.unitName,quantity:f.quantity,baseType:e(i)[f.id]?.baseType||"32mm"}));r("import",{selected:h}),m()}function m(){s(!1),r("close")}he(()=>L(a()),()=>{g(i,{}),a().forEach(h=>{Ks(i,e(i)[h.id]={baseType:"32mm",skip:!1})})}),Ya(),ia();var d=qe(),y=ce(d);{var p=h=>{var f=Lm(),v=w(f),k=w(v),b=T(w(k),2),M=T(k,2),P=T(w(M),2),E=w(P),S=T(w(E));je(S,5,a,B=>B.id,(B,G)=>{var q=Im();let ae;var Q=w(q),de=w(Q),re=T(Q),ne=w(re),Ee=T(re),_e=w(Ee);X(()=>{e(i),Lo(()=>{e(G)})}),je(_e,5,()=>l,ft,(ke,ue)=>{var ye=Dm(),Ke=w(ye),ve={};X(()=>{Ye(Ke,(e(ue),o(()=>e(ue).label))),ve!==(ve=(e(ue),o(()=>e(ue).value)))&&(ye.value=(ye.__value=(e(ue),o(()=>e(ue).value)))??"")}),A(ke,ye)});var xe=T(Ee),ee=w(xe);X(()=>{ae=wn(q,1,"svelte-1qdui6g",null,ae,{skipped:e(i)[e(G).id]?.skip}),Ye(de,(e(G),o(()=>e(G).unitName))),Ye(ne,(e(G),o(()=>e(G).quantity||"1x"))),_e.disabled=(e(i),e(G),o(()=>e(i)[e(G).id]?.skip))}),Uo(_e,()=>e(i)[e(G).id].baseType,ke=>Ks(i,e(i)[e(G).id].baseType=ke)),_n(ee,()=>e(i)[e(G).id].skip,ke=>Ks(i,e(i)[e(G).id].skip=ke)),A(B,q)});var I=T(M,2),$=w(I),U=T($,2);oe("click",b,m),oe("click",$,m),oe("click",U,c),oe("click",v,B=>B.stopPropagation()),oe("click",f,m),A(h,f)};Z(y,h=>{s()&&h(p)})}A(t,d),Jn()}function Za(t){const n=t.match(/^\s*/);return n?n[0].length:0}function fe(t){return t?t.toLowerCase().replace(/\s+/g," ").trim():""}function Qa(t){const n=/^(?:(\d+)x?\s+)?(.*)/,a=t.trim().match(n);if(a){const s=a[1]?`${a[1]}x`:"1x";let r=a[2].trim();return r=r.replace(/^with\s+/i,"").trim(),{quantity:s,name:r}}return{quantity:"1x",name:t.trim()}}function va(t){return Array.isArray(t)&&t.sort((n,a)=>{const s=parseInt(String(n&&n.quantity||"1x").replace(/x/i,""),10)||1,r=parseInt(String(a&&a.quantity||"1x").replace(/x/i,""),10)||1;if(s!==r)return r-s;const i=n&&n.name?n.name.toString().toLowerCase():"",l=a&&a.name?a.name.toString().toLowerCase():"";return i<l?-1:i>l?1:0}),t}const Ta={"World Eaters":"Chaos","Chaos Space Marines":"Chaos","Emperor's Children":"Chaos","Death Guard":"Chaos","Chaos Daemons":"Chaos","Chaos Knights":"Chaos","Thousand Sons":"Chaos","Space Marines":"Imperium","Iron Hands":"Space Marines",Salamanders:"Space Marines","Space Wolves":"Space Marines",Ultramarines:"Space Marines","White Scars":"Space Marines","Adepta Sororitas":"Imperium","Astra Militarum":"Imperium","Imperial Fists":"Space Marines","Dark Angels":"Space Marines","Blood Angels":"Space Marines","Raven Guard":"Space Marines","Black Templars":"Space Marines",Deathwatch:"Space Marines","Grey Knights":"Imperium","Imperial Knights":"Imperium","Adeptus Custodes":"Imperium","Adeptus Titanicus":"Imperium","Adeptus Mechanicus":"Imperium","Agents of the Imperium":"Imperium",Aeldari:"Xenos",Drukhari:"Xenos",Ynnari:"Xenos",Harlequins:"Xenos",Necrons:"Xenos",Orks:"Xenos",Tyranids:"Xenos","T'au Empire":"Xenos",Tau:"Xenos","T'au":"Xenos","Genestealer Cults":"Xenos","Leagues of Votann":"Xenos"};function yr(t){if(!t)return t;t.SUMMARY=t.SUMMARY||{};const n=t.SUMMARY;n.LIST_TITLE=n.LIST_TITLE||"",n.FACTION_KEYWORD&&(n.FACTION_KEYWORD=String(n.FACTION_KEYWORD).trim()),n.DETACHMENT&&(n.DETACHMENT=String(n.DETACHMENT).replace(/\u00A0/g," ").trim()),n.TOTAL_ARMY_POINTS&&(n.TOTAL_ARMY_POINTS=String(n.TOTAL_ARMY_POINTS).trim());const a=r=>{if(!r)return"";try{return r.toString().normalize("NFD").replace(new RegExp("\\p{M}","gu"),"").replace(/[\u2018\u2019\u201B\u2032]/g,"'").replace(/[^\w\s'\-]/g,"").toLowerCase().trim()}catch{return r.toString().toLowerCase().trim()}},s=n.FACTION_KEYWORD||null;if(s){const r=a(s);let i;for(const l of Object.keys(Ta))if(a(l)===r){i=l;break}if(i){const l=s.toString().replace(/[\u2018\u2019\u201B\u2032]/g,"'").trim();n.DISPLAY_FACTION=`${Ta[i]} - ${l}`}else n.DISPLAY_FACTION=n.DISPLAY_FACTION||s+(n.DETACHMENT?` - ${n.DETACHMENT}`:"")}else n.DETACHMENT?n.DISPLAY_FACTION=n.DISPLAY_FACTION||n.DETACHMENT:n.DISPLAY_FACTION=n.DISPLAY_FACTION||"";if(!n.FACTION_KEY){if(n.FACTION_KEYWORD)try{n.FACTION_KEY=n.FACTION_KEYWORD.toString().toLowerCase()}catch{n.FACTION_KEY=String(n.FACTION_KEYWORD).toLowerCase()}else if(n.DISPLAY_FACTION){const r=(n.DISPLAY_FACTION||"").split(" - ")[0];try{n.FACTION_KEY=r.toString().toLowerCase()}catch{n.FACTION_KEY=String(r).toLowerCase()}}}return t}function ar(t,n,a,s,r="",i=!1,l="wargear"){if(!t)return;t.items=t.items||[];const c=Qa(String(n||"").trim()),m=c.quantity?String(c.quantity):"1x",d=c.name||"",y=fe(d);if(i){const h=String(a||""),f=String(r||"");if(fe(h)===fe(d)||f&&fe(f)===fe(d))return}const p=t.items.find(h=>fe(h.name||"")===y);if(p){const h=parseInt(String(p.quantity||"1x").replace(/x/i,""),10)||0,f=parseInt(String(m||"1x").replace(/x/i,""),10)||0;p.quantity=`${h+f}x`}else{const h=fe(d)==="warlord"?"special":l;t.items.push({quantity:m,name:d,items:[],type:h,nameshort:""})}}function Pm(t,n){if(!t||!n)return;n.items=n.items||[];const a=t.trim(),s=a.match(/\(([^)]+)\)$/),r=s?` (${s[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),l=fe(i);if((n.items||[]).some(p=>p&&p.type==="special"&&fe((p.name||"").replace(/^Enhancement:\s*/i,""))===l))return;const d=`E: ${i.split(/\s+/).map(p=>p[0]?p[0].toUpperCase():"").join("")}${r}`.trim(),y={quantity:"1x",name:`Enhancement: ${i}`,nameshort:d,items:[],type:"special"};n.items.push(y)}function Nm(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=[];let s=0;const r=p=>/^(\d+)x?\s+/i.test(String(p||"").trim()),i=(p,h)=>{const f=String(p||"").trim();if(!f)return f;if(r(f)){const v=f.match(/^(\d+)x?\s+(.*)$/i);if(v){const k=parseInt(v[1],10)||1,b=v[2].trim();return`${Math.max(1,k*(parseInt(h,10)||1))}x ${b}`}return f}return`${h}x ${f}`};for(;s<t.length;s++){const h=(t[s]||"").trim();if(h){if(h.startsWith("+")||h.startsWith("&")){a.push(h);continue}break}}for(const p of a){if(p.startsWith("&")){const k=p.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);k&&(k[1].trim(),(k[3]||"").trim());continue}const f=p.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(f){const v=f[1].trim().toUpperCase(),k=f[2].trim();if(v==="FACTION KEYWORD"){const b=k.split(" - ");n.SUMMARY.FACTION_KEYWORD=b[b.length-1].trim()}else v==="DETACHMENT"?n.SUMMARY.DETACHMENT=k.replace(/\u00A0/g," "):v==="TOTAL ARMY POINTS"&&(n.SUMMARY.TOTAL_ARMY_POINTS=k)}}if(n.SUMMARY.LIST_TITLE="",n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD){const p=n.SUMMARY.FACTION_KEYWORD,h=Object.keys(Ta).find(v=>v.toLowerCase()===(p||"").toString().toLowerCase()),f=h?Ta[h]:null;f?n.SUMMARY.DISPLAY_FACTION=`${f} - ${p}`:n.SUMMARY.DISPLAY_FACTION=p+(n.SUMMARY.DETACHMENT?` - ${n.SUMMARY.DETACHMENT}`:"");try{n.SUMMARY.FACTION_KEY=p.toString().toLowerCase()}catch{}}let l=null,c=null;const m=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,d=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;for(;s<t.length;s++){const p=t[s]||"",h=p.trim();if(!h)continue;if(/^Enhancement:\s*/i.test(h)){const M=h.replace(/^Enhancement:\s*/i,"").trim();c&&Pm(M,c);continue}const f=h.match(m);if(f){const M=f[1],P=f[2]?`${f[2]}x`:"1x",E=(f[3]||"").trim(),S=parseInt(f[4],10)||0,I=f[5],$={quantity:P,name:E,points:S,items:[],isComplex:!1,nameshort:""};M?(n.CHARACTER.push($),c=$):(n["OTHER DATASHEETS"]=n["OTHER DATASHEETS"]||[],n["OTHER DATASHEETS"].push($)),l=$,I&&I.split(",").map(U=>U.trim()).filter(Boolean).forEach(U=>ar($,U,$.name,n.SUMMARY.FACTION_KEYWORD||"",$.name,!0));continue}const v=p.match(d);if(v){const M=v[1].trim(),P=M.match(/^(\d+)\s+with\s+(.*)$/i);if(P&&l){const I=parseInt(P[1],10)||1,$=P[2],U=l.items&&l.items.length>0?l.items[l.items.length-1]:l;$.split(",").map(B=>B.trim()).filter(Boolean).forEach(B=>{const G=i(B,I);ar(U,G,U.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}const E=M.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(E&&l){const I=E[1],$=E[2].trim(),U=E[3]||"",B={quantity:I,name:$,items:[],type:"subunit"};if(l.items=l.items||[],l.items.push(B),U){const G=U.match(/^(\d+)\s+with\s+(.*)$/i);if(G){const q=parseInt(G[1],10)||1;G[2].split(",").map(Q=>Q.trim()).filter(Boolean).forEach(Q=>{const de=i(Q,q);ar(B,de,B.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)})}else U.split(",").map(q=>q.trim()).filter(Boolean).forEach(q=>ar(B,q,B.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0))}continue}const S=M.match(/^(\d+x?)\s+(.*)$/i);if(S&&l){const I={quantity:S[1],name:S[2].trim(),items:[],type:"subunit"};l.items=l.items||[],l.items.push(I);continue}if(l){ar(l,M,l.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0);continue}continue}const k=h.match(/^(\d+)\s+with\s+(.*)$/i);if(k&&l){const M=parseInt(k[1],10)||1,P=k[2],E=l.items&&l.items.length>0?l.items[l.items.length-1]:l;P.split(",").map(S=>S.trim()).filter(Boolean).forEach(S=>{const I=i(S,M);ar(E,I,E.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}const b=h.match(/^(.*?):\s*(.*)$/);if(b&&l){(b[2]||"").split(",").map(P=>P.trim()).filter(Boolean).forEach(P=>ar(l,P,l.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0));continue}}const y=[...n.CHARACTER||[],...n["OTHER DATASHEETS"]||[]];for(const p of y){p&&Array.isArray(p.items)&&p.items.length>0&&va(p.items);const h=p&&Array.isArray(p.items)?p.items.filter(f=>f&&f.type==="subunit"):[];for(const f of h)f&&Array.isArray(f.items)&&f.items.length>0&&va(f.items)}return yr(n),n}function ua(t,n,a,s,r="",i=!1,l="wargear"){if(!t)return;t.items=t.items||[];const c=String(n||"").trim();if(/battlesuit support system|homing beacon|marker drone/i.test(c))try{Xn.push(`processing raw=${c} for target=${t&&t.name}`)}catch{}let m=c.split(",").map(S=>S.trim()).filter(Boolean);try{const S=new Set;m=m.filter(I=>{const $=fe(Lr(Ea(I)));return S.has($)?!1:(S.add($),!0)})}catch{}try{/stealth shas'vre|stealth battlesuits/i.test((t&&t.name||"")+(r||"")+c)&&Xn.push(`splitParts target=${t&&t.name} top=${r} parts=${JSON.stringify(m)}`)}catch{}if(m.length>1){m.forEach(S=>ua(t,S,a,s,r,i,l));return}const d=Qa(c),y=d.quantity!==void 0&&d.quantity!==null;let p=y?String(d.quantity):"1x",h=d.name||"";try{h=Lr(Ea(h))}catch{}const f=/battlesuit support system|homing beacon|marker drone/i;try{const S=h.toLowerCase();if(S.includes("battlesuit support system")||S.includes("homing beacon")||S.includes("marker drone"))try{Xn.push(`addItemToTarget target=${t&&t.name} raw=${c}`)}catch{}}catch{}const v=h.match(/^(\d+)x\s+(.*)$/i);if(v){const S=parseInt(v[1],10)||1,I=parseInt(String(p||"1x").replace(/x/i,""),10)||1;p=`${Math.max(1,I*S)}x`,h=v[2]}try{Xn.push(`PARSE_QTY name=${h} parsedQtyRaw=${String(d.quantity||"")} qtyToken=${p}`)}catch{}let k=(S=>isNaN(S)?1:S)(parseInt(String(p||"1x").replace(/x/i,""),10)),b=k;try{if(t&&t.type==="subunit"){const S=parseInt(String(t.quantity||"1x").replace(/[^0-9]/g,""),10)||1;try{Xn.push(`CALC_EFFECTIVE target=${t&&t.name} parentQty=${S} parsedQty=${k} hasExplicit=${y}`)}catch{}b=y?k:S;try{Xn.push(`EFFECTIVE_QTY target=${t&&t.name} effectiveQty=${b}`)}catch{}}}catch{}const M=h,P=fe(h);if(i){const S=String(a||""),I=String(r||"");if(fe(S)===fe(h)||I&&fe(I)===fe(h)){if(f.test(h))try{Xn.push(`SKIP matched unitname name=${h} ctx=${S} top=${I}`)}catch{}return}}const E=t.items.find(S=>fe(S.name||"")===P);if(E){const S=parseInt(String(E.quantity||"1x").replace(/x/i,""),10)||0,I=S+b;E.quantity=`${I}x`;try{Xn.push(`UPDATED existing name=${h} existing=${S} added=${b} new=${I} target=${t&&t.name}`)}catch{}}else{const S=fe(h)==="warlord"?"special":l;t.items.push({quantity:`${b}x`,name:M,items:[],type:S,nameshort:""});try{Xn.push(`PUSHED new name=${h} quantity=${b} target=${t&&t.name}`)}catch{}}}function Ea(t){if(!t)return t;const n=t.toLowerCase();return n.includes("shield")&&n.includes("drone")?"Shield Drone":n.includes("marker")&&n.includes("drone")?"Marker Drone":n.includes("marker")&&n.includes("beacon")?"Homing Beacon":t}function Lr(t){return t&&t.split(/\s+/).map(n=>!n||/[A-Z]/.test(n.slice(1))?n:n[0].toUpperCase()+n.slice(1).toLowerCase()).join(" ")}function Ki(t,n){if(!n)return`${t}x`;const a=String(n).trim(),s=a.match(/^(\d+)x\s+(.*)$/i);if(s){const r=parseInt(s[1],10)||1,i=s[2]||"";return`${Math.max(1,t*r)}x ${i}`}return`${t}x ${a}`}function Om(t,n){if(!t||!n)return;n.items=n.items||[];const a=t.trim(),s=a.match(/\(([^)]+)\)$/),r=s?` (${s[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),l=fe(i);if((n.items||[]).some(p=>{if(!p||!p.name)return!1;const h=String(p.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]+\)$/,"").trim();return fe(h)===l}))return;const d=`E: ${i.split(/\s+/).map(p=>p[0]?p[0].toUpperCase():"").join("")}${r}`.trim(),y={quantity:"1x",name:`Enhancement: ${i}`,nameshort:d,items:[],type:"special"};n.items.push(y)}function Wm(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=[];let s=0;for(;s<t.length;s++){const y=(t[s]||"").trim();if(y){if(y.startsWith("+")){a.push(y);continue}if(!y.startsWith("&"))break}}for(const d of a){const p=d.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(p){const h=p[1].trim().toUpperCase(),f=p[2].trim();if(h==="FACTION KEYWORD"){const v=f.split(" - ");n.SUMMARY.FACTION_KEYWORD=v[v.length-1].trim()}else h==="DETACHMENT"?n.SUMMARY.DETACHMENT=f.replace(/\u00A0/g," "):h==="TOTAL ARMY POINTS"&&(n.SUMMARY.TOTAL_ARMY_POINTS=f)}}if(n.SUMMARY.LIST_TITLE="",n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD){const d=n.SUMMARY.FACTION_KEYWORD,y=Object.keys(Ta).find(h=>h.toLowerCase()===(d||"").toString().toLowerCase()),p=y?Ta[y]:null;p?n.SUMMARY.DISPLAY_FACTION=`${p} - ${d}`:n.SUMMARY.DISPLAY_FACTION=d+(n.SUMMARY.DETACHMENT?` - ${n.SUMMARY.DETACHMENT}`:"");try{n.SUMMARY.FACTION_KEY=d.toString().toLowerCase()}catch{}}const r=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,i=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;let l=null,c=null;for(;s<t.length;s++){const d=t[s]||"",y=d.trim();if(!y)continue;if(/^Enhancement:\s*/i.test(y)){const k=y.replace(/^Enhancement:\s*/i,"").trim();c&&Om(k,c);continue}const p=y.match(r);if(p){const k=p[1],b=p[2]?`${p[2]}x`:"1x",M=(p[3]||"").trim(),P=parseInt(p[4],10)||0,E=p[5],S={quantity:b,name:M,points:P,items:[],isComplex:!1,nameshort:"",charId:k||null};k?(n.CHARACTER.push(S),c=S):(n["OTHER DATASHEETS"]=n["OTHER DATASHEETS"]||[],n["OTHER DATASHEETS"].push(S)),l=S,E&&E.split(",").map(I=>I.trim()).filter(Boolean).forEach(I=>ua(S,I,S.name,n.SUMMARY.FACTION_KEYWORD||"",S.name,!0));continue}const h=d.match(i);if(h){const k=h[1].trim(),b=k.match(/^(\d+)\s+with\s+(.*)$/i);if(b&&l){const E=parseInt(b[1],10)||1,S=b[2],I=l.items&&l.items.length>0?l.items[l.items.length-1]:l;try{Xn.push(`WITHMATCH unit=${l.name} target=${I&&I.name} n=${E} rest=${S}`)}catch{}S.split(",").map($=>$.trim()).filter(Boolean).forEach($=>{const B=Lr(Ea($));if(I&&I.type==="subunit"){try{Xn.push(`WITH->SUB target=${I.name} item=${B} n=${E}`)}catch{}ua(I,`${E}x ${B}`,I.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)}else{try{Xn.push(`WITH->UNIT unit=${l.name} item=${B} n=${E}`)}catch{}ua(I,Ki(E,B),I.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)}});continue}const M=k.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(M&&l){const E=M[1],S=M[2].trim(),I=M[3]||"",$={quantity:E,name:S,items:[],type:"subunit",_parent:l};if(l.items=l.items||[],l.items.push($),I){const U=I.match(/^(\d+)\s+with\s+(.*)$/i);U?U[2].split(",").map(G=>G.trim()).filter(Boolean).forEach(G=>{const q=Ea(G);ua($,q,$.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)}):I.split(",").map(B=>B.trim()).filter(Boolean).forEach(B=>{const G=Ea(B);ua($,G,$.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)})}continue}const P=k.match(/^(\d+x?)\s+(.*)$/i);if(P&&l)if(l.charId){const E=P[1],S=P[2].trim();ua(l,`${E} ${S}`,l.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0);continue}else{const E={quantity:P[1],name:P[2].trim(),items:[],type:"subunit",_parent:l};l.items=l.items||[],l.items.push(E);continue}if(l){let E=k.split(",").map(I=>I.trim()).filter(Boolean);try{const I=l.items&&l.items.length>0?l.items[l.items.length-1]:null;I&&I.name&&(E=E.map($=>{const U=$.match(/^(.*)\s*\(([^)]+)\)\s*$/);if(U){const B=U[1].trim();if(fe(B)===fe(I.name))return B}return $}))}catch{}try{const I=new Set;E=E.filter($=>{const U=fe(Lr(Ea($)));return I.has(U)?!1:(I.add(U),!0)})}catch{}let S=l;if(l.items&&l.items.length>0){const I=l.items[l.items.length-1];I&&I.type==="subunit"&&(S=I)}E.forEach(I=>{const $=Lr(Ea(I));ua(S,$,S.name||l.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}continue}const f=y.match(/^(\d+)\s+with\s+(.*)$/i);if(f&&l){const k=parseInt(f[1],10)||1,b=f[2],M=l.items&&l.items.length>0?l.items[l.items.length-1]:l;b.split(",").map(P=>P.trim()).filter(Boolean).forEach(P=>{const S=Lr(Ea(P));M&&M.type==="subunit"?ua(M,`${k}x ${S}`,M.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0):ua(M,Ki(k,S),M.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}const v=y.match(/^(.*?):\s*(.*)$/);if(v&&l){(v[2]||"").split(",").map(b=>b.trim()).filter(Boolean).forEach(b=>{const M=Ea(b);ua(l,M,l.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}}const m=[...n.CHARACTER||[],...n["OTHER DATASHEETS"]||[]];for(const d of m){d&&Array.isArray(d.items)&&d.items.length>0&&va(d.items);const y=d&&Array.isArray(d.items)?d.items.filter(p=>p&&p.type==="subunit"):[];for(const p of y)p&&Array.isArray(p.items)&&p.items.length>0&&va(p.items)}yr(n);try{n.SUMMARY._parseDebug=(Xn||[]).slice(0,200)}catch{}return n}const Xn=[];function As(t){const n=Za(t);if(n>0)return n;const a=(t||"").trim();return a.startsWith("◦")||a.startsWith("+")?2:0}function Cs(t){if(!t)return"";const n=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(t).split(/\s+/).map((a,s)=>{if(!a)return"";const r=a.toLowerCase();return s>0&&n.has(r)?r:r[0].toUpperCase()+r.slice(1)}).join(" ")}function Cr(t,n,a,s,r="",i=!1,l="wargear",c=1){if(!t)return;t.items=t.items||[];const m=Qa(String(n||"").trim()),d=m.quantity?String(m.quantity):"1x",y=m.name||"",p=fe(y);if(i){const f=String(a||""),v=String(r||"");if(fe(f)===fe(y)||v&&fe(v)===fe(y))return}const h=t.items.find(f=>fe(f.name||"")===p);if(h){const f=parseInt(String(h.quantity||"1x").replace(/x/i,""),10)||0,v=parseInt(String(d||"1x").replace(/x/i,""),10)||0;h.quantity=`${f+v}x`}else{const f=fe(y)==="warlord"?"special":l;t.items.push({quantity:d,name:y,items:[],type:f,nameshort:""})}}function Gi(t,n,a){if(!t||!n)return;n.items=n.items||[];const s=t.trim(),r=s.match(/\(([^)]+)\)$/),i=r?` (${r[1]})`:"",l=s.replace(/\s*\([^)]+\)$/,"").trim(),c=fe(l);if((n.items||[]).some(h=>h&&h.type==="special"&&fe((h.name||"").replace(/^Enhancement:\s*/i,""))===c))return;const y=`E: ${l.split(/\s+/).map(h=>h[0]?h[0].toUpperCase():"").join("")}${i}`.trim(),p={quantity:"1x",name:`Enhancement: ${l}`,nameshort:y,items:[],type:"special"};n.items.push(p)}function Ym(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,s=t.findIndex(h=>a.test((h||"").trim().toUpperCase()));let i=(s===-1?t.slice(0,0):t.slice(0,s)).map(h=>(h||"").trim()).filter(h=>h&&!h.startsWith("Exported with"));const l=i.findIndex(h=>h&&h.trim()!=="");if(l!==-1){const h=i[l],f=h.match(/^(.*?)\s*\((\s*\d+\s*(?:pts|points)\s*)\)\s*$/i);if(f){n.SUMMARY.LIST_TITLE=f[1].trim();const $=(f[2].match(/(\d+)/)||[])[1]||"";$&&(n.SUMMARY.TOTAL_ARMY_POINTS=`${$}pts`)}else n.SUMMARY.LIST_TITLE=h;const v=[];for(let $=l+1;$<i.length;$++){const U=i[$];U&&v.push(U)}const k=["Combat Patrol","Incursion","Strike Force","Onslaught"],b=$=>{if(!$||!/\(/.test($))return!1;for(const U of k)if(new RegExp(U,"i").test($))return!0;return!1},M=new Set(Object.values(Ta).map($=>($||"").toString().toLowerCase())),P=v.filter($=>!(!$||b($)||M.has($.toLowerCase())));let E=null,S=null;const I=Object.keys(Ta).map($=>$.toLowerCase());for(const $ of P)I.includes(($||"").toString().toLowerCase())?E=$:S||(S=$);if(!E&&P.length>0&&(E=P[0],S=P.length>1?P[1]:S),E&&(n.SUMMARY.FACTION_KEYWORD=E),S&&(n.SUMMARY.DETACHMENT=S),E){const $=Object.keys(Ta).find(B=>B.toLowerCase()===E.toLowerCase()),U=$?Ta[$]:null;U?n.SUMMARY.DISPLAY_FACTION=`${U} - ${E}`:n.SUMMARY.DISPLAY_FACTION=E+(S?` - ${S}`:"");try{n.SUMMARY.FACTION_KEY=E.toString().toLowerCase()}catch{}}}const c=s===-1?0:s,m=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*$/i,d=/^\s*(?:•|\-|\+|◦)\s*(.*)$/;let y=null;for(let h=c;h<t.length;h++){const v=(t[h]||"").trim();if(!v||v.startsWith("Exported with"))continue;if(a.test(v.toUpperCase())){y=/^CHARACTERS?/i.test(v)?"CHARACTER":"OTHER DATASHEETS";continue}const k=v.match(m);if(k){const b=k[1].trim(),M=parseInt(String(k[2]).replace(/[\,\.\s]/g,""),10)||0;let P="1x",E=b;const S=b.match(/^([0-9]+x?)\s+(.*)$/i);S&&(P=S[1].toLowerCase(),E=S[2].trim());const I={quantity:P,name:E,points:M,items:[],isComplex:!1,nameshort:""},$=y==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[$]=n[$]||[],n[$].push(I);const U=[];let B=h+1;for(;B<t.length;){const Q=t[B]||"";if(!Q.trim()||a.test(Q.trim().toUpperCase())||m.test(Q.trim())||!/^\s+/.test(Q)&&!d.test(Q))break;U.push(Q),B++}const G=(()=>{for(let Q=0;Q<U.length;Q++){const de=U[Q];if(!de.match(d))continue;const ne=As(de);for(let Ee=Q+1;Ee<U.length;Ee++){const _e=U[Ee];if(!_e.trim()||As(_e)<=ne)break;if(d.test(_e))return!0}}return!1})();let q=null,ae=0;for(let Q=0;Q<U.length;Q++){const de=U[Q],re=de.trim(),ne=de.match(d),Ee=As(de);if(ne){const _e=ne[1].trim(),xe=_e.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(_e)){Gi(_e.replace(/^Enhancement:\s*/i,"").trim(),I,n.SUMMARY.FACTION_KEYWORD||"");continue}else if(xe){Gi(_e.trim(),I,n.SUMMARY.FACTION_KEYWORD||"");continue}if(G){if(q&&typeof ae=="number"&&Ee>ae){Cr(q,_e,q.name,n.SUMMARY.FACTION_KEYWORD||"",I.name,!1);continue}if(!(()=>{for(let ve=Q+1;ve<U.length;ve++){const We=U[ve];if(!We.trim()||As(We)<=Ee)break;if(d.test(We))return!0}return!1})()){q=null,Cr(I,_e,I.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}q=null;const ke=_e.match(/^(\d+x?)\s+(.*)$/i),ue=ke?ke[1]:"1x",ye=ke?ke[2].trim():_e,Ke={quantity:ue,name:ye,items:[],type:"subunit"};I.items=I.items||[],I.items.push(Ke),q=Ke,ae=Ee;continue}Cr(I,_e,I.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(q&&Ee>ae){Cr(q,re,q.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}Cr(I,re,I.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1)}h=B-1;continue}}function p(h,f){if(!(!h||typeof h!="object")){if(typeof h.name!="string"&&(h.name=""),typeof h.quantity!="string"&&(h.quantity=h.quantity?String(h.quantity):"1x"),typeof h.type!="string"&&(h.type=h.type||"wargear"),typeof h.nameshort!="string"&&(h.nameshort=h.nameshort||""),Array.isArray(h.items)||(h.items=[]),/^Enhancement:/i.test(h.name)){const v=h.name.replace(/^Enhancement:\s*/i,"").trim();h.type="special",h.nameshort=h.nameshort||(()=>{const k=v.match(/\(([^)]+)\)$/),b=k?` (${k[1]})`:"";return`E: ${v.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(E=>E[0]?E[0].toUpperCase():"").join("")}${b}`.trim()})(),h.name=`Enhancement: ${Cs(v.replace(/\s*\([^)]+\)$/,"").trim())}`}else h.name=f?h.name:Cs(h.name);fe(h.name)==="warlord"&&(h.type="special"),h.items=(h.items||[]).map(v=>{if(!v)return null;if(typeof v=="string"){const k={quantity:"1x",name:v.trim(),items:[],type:/^Enhancement:/i.test(v)?"special":"wargear",nameshort:""};return p(k,h.name),k.name&&(k.name=Cs(k.name)),k}return p(v,h.name),v&&v.name&&(v.name=Cs(v.name)),v}).filter(Boolean)}}for(const h of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[h]))for(const f of n[h]){p(f);const v=(f.items||[]).filter(k=>k&&k.type==="subunit");if(v.length>0)if(v.every(b=>fe(b.name||"")===fe(f.name||""))){const b=new Map;let M=0;for(const P of v){const E=parseInt(String(P.quantity||"1x").replace(/x/i,""),10)||1;M+=E;for(const S of P.items||[]){const I={items:[]};Cr(I,`${S.quantity||"1x"} ${S.name}`,f.name,n.SUMMARY.FACTION_KEYWORD||"",S.type||"wargear",1);for(const $ of I.items){const U=fe($.name||"");if(b.has(U)){const B=b.get(U),G=parseInt(String(B.quantity||"1x").replace(/x/i,""),10)||0,q=parseInt(String($.quantity||"1x").replace(/x/i,""),10)||0;B.quantity=`${G+q}x`}else b.set(U,$)}}}f.items=Array.from(b.values()),M>0&&(f.quantity=`${M}x`),f.isComplex=!1}else{const b=v.reduce((M,P)=>M+(parseInt(String(P.quantity||"1x").replace(/x/i,""),10)||0),0);b>0&&(f.quantity=`${b}x`),f.isComplex=!0}else f.isComplex=!1;Array.isArray(f.items)&&f.items.length>0&&va(f.items)}return yr(n),n}function zi(t){if(!t)return"";const n=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(t).split(/\s+/).map((a,s)=>{if(!a)return"";const r=a.toLowerCase();return s>0&&n.has(r)?r:r[0].toUpperCase()+r.slice(1)}).join(" ")}function Ga(t,n,a,s,r="",i=!1,l="wargear",c=1){if(!t)return;t.items=t.items||[];const m=Qa(String(n||"").trim()),d=m.quantity?String(m.quantity):"1x",y=parseInt(String(d||"1x").replace(/[^0-9]/g,""),10)||1,p=`${y*(c||1)}x`;let h=m.name||"";if(!i)try{const k=h.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(k){const b=k[1].trim(),M=k[2].trim(),P=fe(b),E=fe(a||""),S=fe(r||"");P&&(P===E||P===S||E.startsWith(P+" ")||S.startsWith(P+" ")||P.startsWith(E+" ")||P.startsWith(S+" "))&&(h=M)}}catch{}const f=fe(h);if(i){const k=String(a||""),b=String(r||""),M=fe(h),P=fe(k),E=fe(b),S=P&&M.startsWith(P+" "),I=E&&M.startsWith(E+" ");if(P&&(M===P||S)||E&&(M===E||I)){const $=h.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if($){const U=$[1].trim(),B=$[2].trim(),G=fe(U);if(G===P||G===E||G.startsWith(P+" ")||G.startsWith(E+" ")){if(t&&t._deferredParenthetical&&fe(t._deferredParenthetical)===fe(B)||t&&t._deferredParenthetical&&fe(t._deferredParenthetical)===fe(B)||(t.items||[]).some(ae=>fe(ae.name||"")===fe(B)))return;Ga(t,B,a,s,r,!1,l,y);return}}return}}const v=t.items.find(k=>fe(k.name||"")===f);if(v){const k=parseInt(String(v.quantity||"1x").replace(/x/i,""),10)||0,b=parseInt(String(p||"1x").replace(/x/i,""),10)||0;v.quantity=`${k+b}x`}else{const k=fe(h)==="warlord"?"special":l;t.items.push({quantity:p,name:h,items:[],type:k,nameshort:""})}}function oi(t,n,a){if(!t||!n)return;n.items=n.items||[];const s=t.trim(),r=s.match(/\(([^)]+)\)$/),i=r?` (${r[1]})`:"",l=s.replace(/\s*\([^)]+\)$/,"").trim(),c=fe(l);if((n.items||[]).some(h=>h&&h.type==="special"&&fe((h.name||"").replace(/^Enhancement:\s*/i,""))===c))return;const y=`E: ${l.split(/\s+/).map(h=>h[0]?h[0].toUpperCase():"").join("")}${i}`.trim(),p={quantity:"1x",name:`Enhancement: ${l}`,nameshort:y,items:[],type:"special"};n.items.push(p)}function Xi(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,s=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*(?::\s*(.*))?$/i,r=/^\s*(?:•|\-|\+|◦)\s*(.*)$/;let i=null;for(let c=0;c<t.length;c++){const d=(t[c]||"").trim();if(!d)continue;if(a.test(d.toUpperCase())){i=/^CHARACTERS?/i.test(d)?"CHARACTER":"OTHER DATASHEETS";continue}const y=d.match(s);if(y){const p=y[1].trim(),h=parseInt(String(y[2]).replace(/[\,\.\s]/g,""),10)||0;let f="1x",v=p;const k=p.match(/^([0-9]+x?)\s+(.*)$/i);k&&(f=k[1].toLowerCase(),v=k[2].trim());const b={quantity:f,name:v,points:h,items:[],isComplex:!1,nameshort:""},M=i==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[M]=n[M]||[],n[M].push(b);const P=y[3]||"";P&&P.split(",").map(B=>B.trim()).filter(Boolean).forEach(B=>Ga(b,B,b.name,n.SUMMARY.FACTION_KEYWORD||"",b.name,!0));const E=[];let S=c+1;for(;S<t.length;){const B=t[S]||"";if(!B.trim()||a.test(B.trim().toUpperCase())||s.test(B.trim())||!/^\s+/.test(B)&&!r.test(B))break;E.push(B),S++}const I=(()=>{for(let B=0;B<E.length;B++){const G=E[B];if(!G.match(r))continue;const ae=Za(G);for(let Q=B+1;Q<E.length;Q++){const de=E[Q];if(!de.trim()||Za(de)<=ae)break;if(r.test(de))return!0}}return!1})();let $=null,U=0;for(let B=0;B<E.length;B++){const G=E[B],q=G.trim(),ae=G.match(r),Q=Za(G);if(ae){const de=ae[1].trim(),re=de.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(de)){oi(de.replace(/^Enhancement:\s*/i,"").trim(),b,n.SUMMARY.FACTION_KEYWORD||"");continue}else if(re){oi(de.trim(),b,n.SUMMARY.FACTION_KEYWORD||"");continue}if(I){if($&&typeof U=="number"&&Q>U){const ee=de.split(",").map(ke=>ke.trim()).filter(Boolean);for(let ke of ee){const ue=ke.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(ue){const ye=ue[1].trim(),Ke=ue[2].trim();if(fe(ye)===fe($.name)){const ve=ee.some(lt=>fe(lt)===fe(Ke)),We=($.items||[]).some(lt=>fe(lt.name||"")===fe(Ke));if(ve||We)continue;const me=Qa(ke),pt=parseInt(String(me.quantity||"1x").replace(/[^0-9]/g,""),10)||1;Ga($,Ke,$.name,n.SUMMARY.FACTION_KEYWORD||"",b.name,!1,"wargear",pt);continue}}Ga($,ke,$.name,n.SUMMARY.FACTION_KEYWORD||"",b.name,!0)}continue}$=null;const ne=de.match(/^(\d+x?)\s+(.*)$/i),Ee=ne?ne[1]:"1x";let _e=ne?ne[2].trim():de;try{const ee=_e.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(ee){const ke=ee[1].trim(),ue=ee[2].trim(),ye=fe(ke),Ke=fe(b.name||""),ve=fe(unitTopName||b.name||"");if(ye&&(ye===Ke||Ke.startsWith(ye)||ye.startsWith(Ke)||ve.startsWith(ye)||ye.startsWith(ve))){_e=ke;const We={quantity:Ee,name:_e,items:[],type:"subunit"};We._deferredParenthetical=ue,We._deferredParentheticalQty=parseInt(String(Ee||"1x").replace(/[^0-9]/g,""),10)||1,b.items=b.items||[],b.items.push(We),$=We,U=Q;continue}}}catch{}const xe={quantity:Ee,name:_e,items:[],type:"subunit"};b.items=b.items||[],b.items.push(xe),$=xe,U=Q;continue}Ga(b,de,b.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if($&&Q>U){Ga($,q,$.name,n.SUMMARY.FACTION_KEYWORD||"",b.name,!0);continue}Ga(b,q,b.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1)}c=S-1;continue}}function l(c,m){if(!(!c||typeof c!="object")){if(typeof c.name!="string"&&(c.name=""),typeof c.quantity!="string"&&(c.quantity=c.quantity?String(c.quantity):"1x"),typeof c.type!="string"&&(c.type=c.type||"wargear"),typeof c.nameshort!="string"&&(c.nameshort=c.nameshort||""),Array.isArray(c.items)||(c.items=[]),/^Enhancement:/i.test(c.name)){const d=c.name.replace(/^Enhancement:\s*/i,"").trim();c.type="special",c.nameshort=c.nameshort||(()=>{const y=d.match(/\(([^)]+)\)$/),p=y?` (${y[1]})`:"";return`E: ${d.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(v=>v[0]?v[0].toUpperCase():"").join("")}${p}`.trim()})(),c.name=`Enhancement: ${zi(d.replace(/\s*\([^)]+\)$/,"").trim())}`}else c.name=m?c.name:zi(c.name);fe(c.name)==="warlord"&&(c.type="special"),c.items=(c.items||[]).map(d=>{if(!d)return null;if(typeof d=="string"){const y={quantity:"1x",name:d.trim(),items:[],type:/^Enhancement:/i.test(d)?"special":"wargear",nameshort:""};return l(y,c.name),y}return l(d,c.name),d}).filter(Boolean)}}for(const c of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[c]))for(const m of n[c]){l(m);const d=(m.items||[]).filter(p=>p&&p.type==="subunit");if(d.length>0)if(d.every(h=>fe(h.name||"")===fe(m.name||""))){const h=new Map;let f=0;for(const v of d){const k=parseInt(String(v.quantity||"1x").replace(/x/i,""),10)||1;f+=k;for(const b of v.items||[]){const M={items:[]};Ga(M,`${b.quantity||"1x"} ${b.name}`,m.name,n.SUMMARY.FACTION_KEYWORD||"",b.type||"wargear",1);for(const P of M.items){const E=fe(P.name||"");if(h.has(E)){const S=h.get(E),I=parseInt(String(S.quantity||"1x").replace(/x/i,""),10)||0,$=parseInt(String(P.quantity||"1x").replace(/x/i,""),10)||0;S.quantity=`${I+$}x`}else h.set(E,P)}}}m.items=Array.from(h.values()),f>0&&(m.quantity=`${f}x`),m.isComplex=!1}else{const h=d.reduce((f,v)=>f+(parseInt(String(v.quantity||"1x").replace(/x/i,""),10)||0),0);h>0&&(m.quantity=`${h}x`),m.isComplex=!1}else m.isComplex=!1;if(Array.isArray(m.items)&&m.items.length===1&&m.items[0]&&m.items[0].type==="subunit"){const p=m.items[0];Array.isArray(p.items)&&p.items.length>0&&(m.items=p.items.slice(),m.isComplex=!1)}Array.isArray(m.items)&&m.items.length>0&&va(m.items);const y=(m.items||[]).filter(p=>p&&p.type==="subunit");for(const p of y)Array.isArray(p.items)&&p.items.length>0&&va(p.items)}return yr(n),n}function Hm(t){if(!Array.isArray(t))return Xi(t);const n=[];let a=0;for(;a<t.length;a++){const p=String(t[a]||"").trim();if(!p){n.push(p);continue}if(p.startsWith("+")||p.startsWith("&")){n.push(p);continue}break}const s=[],r={};for(const y of n){if(!y)continue;if(y.startsWith("&")){const v=y.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);v&&s.push({enh:v[1].trim(),target:(v[3]||"").trim(),charId:v[2]||null});continue}const h=y.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(h){const f=h[1].trim().toUpperCase(),v=h[2].trim();if(f==="ENHANCEMENT"){const k=v.match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);k?s.push({enh:k[1].trim(),target:(k[3]||"").trim(),charId:k[2]||null}):s.push({enh:v,target:null,charId:null})}else if(f==="FACTION KEYWORD"){const k=v.split(" - ");r.faction=k[k.length-1].trim()}else f==="DETACHMENT"?r.detachment=v.replace(/\u00A0/g," "):f==="TOTAL ARMY POINTS"&&(r.points=v)}}const i=t.slice(a),l=[];for(const y of i){if(!y){l.push(y);continue}let p=String(y);p=p.replace(/^\s*Char\d+:\s*/i,"");const h=p.match(/^(.*\))\s*:\s*(.+)$/);h?(l.push(h[1]),l.push("  • "+h[2])):l.push(p)}const c=Xi(l);c.SUMMARY=c.SUMMARY||{},r.faction&&(c.SUMMARY.FACTION_KEYWORD=r.faction),r.detachment&&(c.SUMMARY.DETACHMENT=r.detachment),r.points&&(c.SUMMARY.TOTAL_ARMY_POINTS=r.points);const m=[...c.CHARACTER||[],...c["OTHER DATASHEETS"]||[]],d=y=>{const p=fe(String(y||""));for(const h of m){const f=h&&Array.isArray(h.items)?h.items:[];for(const v of f){if(!v||!v.name)continue;const k=String(v.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,"").trim();if(fe(k)===p)return!0}}return!1};for(const y of s){if(!y||!y.enh||d(y.enh))continue;let p=null;const h=f=>String(f||"").toLowerCase().replace(/[^a-z0-9 ]/g,"").trim();if(y.charId){const f=parseInt(String(y.charId).replace(/[^0-9]/g,""),10);!Number.isNaN(f)&&f>0&&Array.isArray(c.CHARACTER)&&c.CHARACTER[f-1]&&(p=c.CHARACTER[f-1])}!p&&y.target&&(p=m.find(f=>h(f.name).includes(h(y.target))||h(`${f.quantity} ${f.name}`).includes(h(y.target)))),!p&&m.length===1&&(p=m[0]),p&&oi(y.enh,p,c.SUMMARY.FACTION_KEYWORD||"")}try{for(const y of["CHARACTER","OTHER DATASHEETS"]){const p=c[y];if(Array.isArray(p))for(const h of p)h&&typeof h=="object"&&Object.prototype.hasOwnProperty.call(h,"type")&&delete h.type}for(const y of["CHARACTER","OTHER DATASHEETS"]){const p=c[y];if(Array.isArray(p)){for(const h of p)if(!(!h||!Array.isArray(h.items))){for(const f of h.items.filter(v=>v&&v.type==="subunit"))if(f&&f._deferredParenthetical)try{delete f._deferredParenthetical,delete f._deferredParentheticalQty}catch{}}}}}catch{}return yr(c),c}function Bm(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=t.map(d=>String(d||"")).find(d=>d.trim()),s=t.findIndex(d=>String(d||"").trim());if(a){const d=a.split(/\s*-\s*/).map(y=>y.trim()).filter(Boolean);if(n.SUMMARY.FACTION_FAMILY=d[0]||"",n.SUMMARY.FACTION_KEYWORD=d[1]||"",d.length>=3){const p=d[d.length-1].match(/\[\s*(\d{2,5})\s*pts?\s*\]$/i);p?(n.SUMMARY.TOTAL_ARMY_POINTS=`${p[1]}pts`,d.length===3?n.SUMMARY.LIST_TITLE=d[2]:n.SUMMARY.LIST_TITLE=d.slice(2,d.length-1).join(" - ")):n.SUMMARY.LIST_TITLE=d.slice(2).join(" - ")}n.SUMMARY.DISPLAY_FACTION=a.trim()}for(let d=0;d<Math.min(t.length,40);d++){const y=String(t[d]||"").trim();if(!y)continue;const p=y.match(/^Detachment:\s*(.*)$/i);p&&(n.SUMMARY.DETACHMENT=p[1].trim());const h=y.match(/^TOTAL ARMY POINTS:\s*(.*)$/i);h&&(n.SUMMARY.TOTAL_ARMY_POINTS=h[1].trim());const f=y.match(/^FACTION KEYWORD:\s*(.*)$/i);f&&(n.SUMMARY.FACTION_KEYWORD=f[1].trim());const v=y.match(/^Battle Size:\s*(.*)$/i);v&&(n.SUMMARY.BATTLE_SIZE=v[1].trim());const k=y.match(/^#+\s*(?:\+{1,2}\s*)?(.*)\[\s*\d{2,5}\s*pts?\s*\]$/i);if(k&&!n.SUMMARY.LIST_TITLE){const b=k[1].trim();/Army\s+Roster/i.test(b)||/\+\+/.test(b)?n.SUMMARY.LIST_TITLE="":n.SUMMARY.LIST_TITLE=b}}if(!n.SUMMARY.FACTION_KEYWORD&&n.SUMMARY.DISPLAY_FACTION){const d=n.SUMMARY.DISPLAY_FACTION.split(" - ");d.length>=2?n.SUMMARY.FACTION_KEYWORD=d[1].trim():n.SUMMARY.FACTION_KEYWORD=n.SUMMARY.DISPLAY_FACTION.replace(/\s*\[.*$/,"").trim()}const r=/^(?:(\d+)x?\s+)?(.+?)\s*\[\s*(\d{1,4})\s*pts?\s*\]\s*(?::\s*(.*))?$/i,i=/^\s*(?:•|\-|\+)\s*(.*)$/;let l=null,c=null;for(let d=0;d<t.length;d++){const y=String(t[d]||""),p=y.trim();if(!p||d===s)continue;if(p.startsWith("#")){const v=p.match(/^#+\s*(.+?)\s*(?:\[\s*\d+\s*pts?\s*\])?$/i);if(v){const k=v[1].trim();/character|epic|hero|hq/i.test(k)?l="CHARACTER":l="OTHER DATASHEETS"}continue}const h=p.match(r);if(h){const v=h[1]?`${h[1]}x`:"1x",k=(h[2]||"").trim(),b=parseInt(h[3],10)||0,M=h[4]||"",P={quantity:v,name:k,points:b,items:[],isComplex:!1,nameshort:""};l||(l="OTHER DATASHEETS"),n[l]=n[l]||[],n[l].push(P),c=P,M&&M.split(",").map(E=>E.trim()).filter(Boolean).forEach(E=>{m(c,E,c.name,n.SUMMARY.FACTION_KEYWORD||"",c.name,!0)});continue}const f=y.match(i);if(f&&c){const v=f[1].trim(),k=v.match(/^(\d+)\s+with\s+(.*)$/i);if(k&&c){const P=parseInt(k[1],10)||1,E=k[2],S=c.items&&c.items.length>0?c.items[c.items.length-1]:c;E.split(",").map(I=>I.trim()).filter(Boolean).forEach(I=>m(S,`${P}x ${I}`,S.name,n.SUMMARY.FACTION_KEYWORD||"",c.name,!0));continue}const b=v.match(/^(\d+x?)\s+([^:]+):\s*(.*)$/i);if(b){const P=b[1];let E=b[2].trim();const S=b[3]||"";E=E.replace(/\s+w\/.*$/i,"").trim();const I={quantity:P,name:E,items:[],type:"subunit"};if(S){const $=S.match(/^(\d+)\s+with\s+(.*)$/i);if($){const U=parseInt($[1],10)||1;$[2].split(",").map(G=>G.trim()).filter(Boolean).forEach(G=>m(I,`${U}x ${G}`,I.name,n.SUMMARY.FACTION_KEYWORD||"",c.name,!0))}else S.split(",").map(U=>U.trim()).filter(Boolean).forEach(U=>m(I,U,I.name,n.SUMMARY.FACTION_KEYWORD||"",c.name,!0))}c.items=c.items||[],c.items.push(I);continue}const M=v.match(/^(\d+x?)\s+(.*)$/i);if(M&&c){let P=M[2].trim();P=P.replace(/\s+w\/.*$/i,"").trim();const E={quantity:M[1],name:P,items:[],type:"subunit"};c.items=c.items||[],c.items.push(E);continue}m(c,v,c.name,n.SUMMARY.FACTION_KEYWORD||"",c.name,!0);continue}}function m(d,y,p,h,f="",v=!1,k="wargear"){if(!d)return;d.items=d.items||[];const b=String(y||"").trim(),M=Qa(b),P=M.quantity?String(M.quantity):"1x",E=/^\s*\d+x?\s+/i.test(b);let S=M.name||"";const I=S.match(/^(.*?)\s*\(([^)]+)\)$/);if(I){const q=(I[1]||"").trim(),ae=(I[2]||"").trim();(/\bDrone\b/i.test(q)||/\bDrone\b/i.test(S))&&(S=ae)}const $=fe(S);if(v){const q=String(p||""),ae=String(f||"");if(fe(q)===fe(S)||ae&&fe(ae)===fe(S))return}const U=parseInt(String(P||"1x").replace(/x/i,""),10)||1;let B=U;if(d&&d.type==="subunit"){const q=parseInt(String(d.quantity||"1x").replace(/[^0-9]/g,""),10)||1;B=E?U:q}const G=d.items.find(q=>fe(q.name||"")===$);if(G){const q=parseInt(String(G.quantity||"1x").replace(/x/i,""),10)||0;G.quantity=`${q+B}x`}else{const q=fe(S)==="warlord"?"special":k;d.items.push({quantity:`${B}x`,name:S,items:[],type:q,nameshort:""})}}for(const d of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[d]))for(const y of n[d]){if(!y||!Array.isArray(y.items)||y.items.length===0)continue;if(y.items.filter(f=>f&&f.type==="subunit").length>1){const f=new Map,v=[];for(const k of y.items){if(!k||k.type!=="subunit"){v.push(k);continue}const b=fe(k.name||"");if(!f.has(b))f.set(b,{quantity:k.quantity||"1x",name:k.name,items:Array.isArray(k.items)?k.items.slice():[],type:"subunit"});else{const M=f.get(b),P=parseInt(String(M.quantity||"1x").replace(/[^0-9]/g,""),10)||0,E=parseInt(String(k.quantity||"1x").replace(/[^0-9]/g,""),10)||0;M.quantity=`${P+E}x`;const S=new Map;for(const I of M.items||[]){const $=fe(I&&I.name||"");$&&S.set($,{quantity:I.quantity||"1x",name:I.name,items:[],type:I.type||"wargear",nameshort:I.nameshort||""})}for(const I of k.items||[]){const $=fe(I&&I.name||"");if($)if(S.has($)){const U=S.get($),B=parseInt(String(U.quantity||"1x").replace(/[^0-9]/g,""),10)||0,G=parseInt(String(I.quantity||"1x").replace(/[^0-9]/g,""),10)||0;U.quantity=`${B+G}x`}else S.set($,{quantity:I.quantity||"1x",name:I.name,items:[],type:I.type||"wargear",nameshort:I.nameshort||""})}M.items=Array.from(S.values())}}y.items=[...v,...Array.from(f.values())]}y&&Array.isArray(y.items)&&y.items.length>0&&va(y.items);const h=y&&Array.isArray(y.items)?y.items.filter(f=>f&&f.type==="subunit"):[];for(const f of h)f&&Array.isArray(f.items)&&f.items.length>0&&va(f.items)}return yr(n),n}function Fm(t,n=40){return(Array.isArray(t)?t:String(t||"").split(/\r?\n/)).slice(0,n)}function qm(t){const n=Array.isArray(t)?t:String(t||"").split(/\r?\n/),a=Fm(n,40),s=n.join(`
`),r={NRNR:{score:0,breakdown:{},maxScore:8},"WTC-Compact":{score:0,breakdown:{},maxScore:8},WTC:{score:0,breakdown:{},maxScore:8},GWAPP:{score:0,breakdown:{},maxScore:7},"NR-GW":{score:0,breakdown:{},maxScore:7},LF:{score:0,breakdown:{},maxScore:7}},i=a.some(ne=>/-\s*\[\s*\d{2,5}\s*pts?\s*\]$/i.test(ne)),l=a.some(ne=>/^#{1,3}\s+/.test(ne)),c=a.some(ne=>/^\s*#?\s*\+\+\s*Army Roster\s*\+\+/i.test(ne)),m=a.some(ne=>/^\s*##\s+/.test(ne)),d=/(.+?)\s*[\(\[]\s*([0-9]{1,4})\s*(?:pts|points)\s*[\)\]]/i,y=s.match(new RegExp(d.source,"g"))||[],p=s.match(/^[ \t]*(?:•|\-|\+)\s*(?:\d+x?)\s+[^:]+:/gmi)||[],h=s.match(/\b[A-Za-z0-9\-\'’ ]+\s*\([^\)]+\)/g)||[],f=/(^|\n)\s*Char\d+:.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)\s*:\s*/i,v=(s.match(new RegExp(f.source,"gi"))||[]).length,k=a.some(ne=>/^(List Name|Factions Used|Army Points|Detachment Rule):/i.test(ne.trim())),b=a.some(ne=>/-\s*\(\s*\d+\s*Points?\s*\)\s*$/i.test(ne)),M=s.match(/^(Epic Hero|Epic Heroes|Character|Characters|Battleline|Infantry|Beast|Vehicle|Dedicated Transport|Other Datasheets):\s*$/gmi)||[],P=(s.match(/^\s*•\s*(?:E:|Enhancement:)/gmi)||[]).length,E=(s.match(/^\s*•\s+/gmi)||[]).length;k&&(r.LF.score+=4,r.LF.breakdown.headerKeys=4),b&&(r.LF.score+=4,r.LF.breakdown.titleLine=4),M.length>=2&&(r.LF.score+=3,r.LF.breakdown.sectionColons=M.length),E>5&&(r.LF.score+=1,r.LF.breakdown.bullets=E),P>0&&(r.LF.score+=1,r.LF.breakdown.enhancementLines=P),(k||b||M.length>=2)&&(r.NRNR.score-=1,r.WTC.score-=1,r["WTC-Compact"].score-=1,r.GWAPP.score-=1,r["NR-GW"].score-=3),i&&(r.NRNR.score+=2,r.NRNR.breakdown.titleWithBracketedPts=2),l&&(r.NRNR.score+=3,r.NRNR.breakdown.markdownHeading=3),c&&(r.NRNR.score+=2,r.NRNR.breakdown.armyRoster=2),m&&(r.NRNR.score+=1,r.NRNR.breakdown.doubleHashSections=1),y.length>=3&&(r.NRNR.score+=1,r.NRNR.breakdown.unitLines=1),p.length>0&&(r.NRNR.score+=1,r.NRNR.breakdown.bulletWithQty=p.length),h.length>0&&(r.NRNR.score+=.5,r.NRNR.breakdown.parenItem=h.length);const S=a.join(`
`);/^[ \t]*[+&]/m.test(S)&&(r["WTC-Compact"].score+=3,r["WTC-Compact"].breakdown.headerPlusAmp=3),/(FACTION KEYWORD|DETACHMENT|TOTAL ARMY POINTS)/i.test(S)&&(r["WTC-Compact"].score+=2,r["WTC-Compact"].breakdown.headerKeys=2),y.length>=2&&(r["WTC-Compact"].score+=1,r["WTC-Compact"].breakdown.unitLines=1),v>0&&(r["WTC-Compact"].score+=5,r["WTC-Compact"].breakdown.inlineCharList=v),/^\s*[+&]/m.test(S)&&(r.WTC.score+=1,r.WTC.breakdown.headerPlusAmp=1),/NUMBER OF UNITS:/i.test(S)&&(r.WTC.score+=2,r.WTC.breakdown.numberOfUnits=2);const I=(s.match(/(^|\n)\s*Char\d+:/gi)||[]).length>0;I&&(r.WTC.score+=3,r.WTC.breakdown.charMarkers=3),(l||c||m)&&(r.WTC.score-=2,r.WTC.breakdown.nrnrPenalty=-2,r["WTC-Compact"].score-=1,r["WTC-Compact"].breakdown.nrnrPenalty=-1);const $=(s.match(/^\s*\d+\s+with\s+/gmi)||[]).length;$>0&&(r.WTC.score+=2,r.WTC.breakdown.withLines=$,r["WTC-Compact"].score+=2,r["WTC-Compact"].breakdown.withLines=$),a.some(ne=>/^(?:CHARACTER|OTHER DATASHEETS|CHARACTERS)\s*$/.test((ne||"").trim()))&&(r.WTC.score+=1,r.WTC.breakdown.sectionHeaders=1),I&&(r["WTC-Compact"].score-=1,r["WTC-Compact"].breakdown.charMarkerPenalty=-1),v>0&&(r.WTC.score-=2,r.WTC.breakdown.compactInlinePenalty=-2);const U=/Exported with/i.test(s);(/Exported with/i.test(S)||U)&&(r.GWAPP.score+=6,r.GWAPP.breakdown.exportedWith=6),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS)\b/i.test(s)&&(r.GWAPP.score+=2,r.GWAPP.breakdown.sectionHeaders=2),/\(\s*\d+\s*(?:pts|points)\s*\)/i.test(S)&&(r.GWAPP.score+=1,r.GWAPP.breakdown.titleParenPts=1),U&&(r["NR-GW"].score-=4,r["NR-GW"].breakdown.gwappPenalty=-4),/^\s*Strike Force\s*\(\s*\d{2,5}\s*points\s*\)/mi.test(s)&&(r.GWAPP.score+=3,r.GWAPP.breakdown.strikeForce=3),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|DEDICATED TRANSPORTS)\b/i.test(s)&&(r["NR-GW"].score+=2,r["NR-GW"].breakdown.sectionHeaders=2);const B=(s.match(/^[ \t]*(?:•|\u2022|◦|\-|\+)\s+/gmi)||[]).length;B>0&&!U&&(r["NR-GW"].score+=1,r["NR-GW"].breakdown.bulletCount=B),h.length>0&&!U&&(r["NR-GW"].score+=1,r["NR-GW"].breakdown.parenItem=h.length);const G=(s.match(/^[ \t]*(?:•|\u2022|◦|\-|\+)\s*\d+x?\s+[A-Za-z0-9\-\'’]+/gmi)||[]).length;G>=3&&!I&&!U&&(r["NR-GW"].score+=3,r["NR-GW"].breakdown.bulletQty=G);const q=/^(?:\s*)\d+x?\s+.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)/i,ae=n.filter(ne=>q.test(ne)).length;if(ae>=2&&!I&&!U&&(r["NR-GW"].score+=2,r["NR-GW"].breakdown.unitLinesNoChar=ae),!I&&!U&&(G>=3||ae>=2)&&(r.WTC.score-=2,r.WTC.breakdown.nrGwPenalty=-2,r["WTC-Compact"].score-=2,r["WTC-Compact"].breakdown.nrGwPenalty=-2),(l||c)&&(r["NR-GW"].score-=1,r["NR-GW"].breakdown.nrnrPenalty2=-1),s.indexOf("’")!==-1)for(const ne of Object.keys(r))r[ne].score+=.5,r[ne].breakdown=r[ne].breakdown||{},r[ne].breakdown.unicodeApostrophe=.5;const Q={};for(const ne of Object.keys(r)){const Ee=r[ne],_e=Math.max(0,Math.min(1,Ee.score/(Ee.maxScore||8)));Q[ne]={score:Ee.score,confidence:_e,scoreBreakdown:Ee.breakdown}}const de=Object.keys(Q).sort((ne,Ee)=>Q[Ee].score-Q[ne].score)[0],re=Q[de]||{score:0,confidence:0};return{format:de,confidence:re.confidence,score:re.score,scoreBreakdown:re.scoreBreakdown,all:Q}}function hl(t){const n=String(t||"").trim().match(/^(\d+)\s+(.*)$/);return n&&!/^\d+x\b/i.test(String(t||""))?`${n[1]}x ${n[2]}`:t}function dl(t){const n=String(t||"").trim().replace(/^E:\s*/i,"").replace(/^Enhancement:\s*/i,"").trim(),a=n.match(/\(([^)]*pts?[^)]*)\)\s*$/i),s=n.replace(/\s*\([^)]*\)\s*$/,"").trim(),i=`E: ${s.split(/\s+/).map(l=>l[0]?l[0].toUpperCase():"").join("")}${a?` (${a[1].trim()})`:""}`.trim();return{quantity:"1x",name:`Enhancement: ${s}`,nameshort:i,items:[],type:"special"}}function Um(t,n){if(!t)return;t.items=t.items||[];const a=hl(String(n||"").trim());if(/^(E:|Enhancement:)/i.test(a)){const r=dl(a),i=fe(r.name.replace(/^Enhancement:\s*/i,""));(t.items||[]).some(c=>/^Enhancement:/i.test(c.name||"")&&fe(String(c.name).replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,""))===i)||t.items.push(r);return}const s=a.split(",").map(r=>r.trim()).filter(Boolean);for(const r of s){const i=Qa(r.replace(/^with\s+/i,"")),l=i.quantity||"1x",c=i.name||"";if(!c)continue;const m=fe(c),d=t.items.find(y=>fe(y.name||"")===m);if(d){const y=parseInt(String(d.quantity||"1x").replace(/[^0-9]/g,""),10)||0,p=parseInt(String(l).replace(/[^0-9]/g,""),10)||0;d.quantity=`${y+p}x`}else t.items.push({quantity:l,name:c,items:[],type:"wargear",nameshort:""})}}function Km(t,n){const a=t[n]||"",s=Za(a);for(let r=n+1;r<t.length;r++){const i=t[r]||"";if(!i.trim())continue;const l=Za(i),c=/^\s*•\s*/.test(i);return l>s&&c}return!1}function Gm(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=t.slice(0,30).map(h=>String(h||""));let s=!1;for(const h of a){const f=h.match(/^\s*([A-Za-z ][A-Za-z ]*):\s*(.*)$/);if(!f)continue;const v=f[1].trim().toLowerCase(),k=f[2].trim();if(v==="list name"&&(n.SUMMARY.LIST_TITLE=k,s=!0),v==="factions used"&&(n.SUMMARY.FACTION_KEYWORD=k,s=!0),v==="army points"){const b=parseInt(k.replace(/[^0-9]/g,""),10);b&&(n.SUMMARY.TOTAL_ARMY_POINTS=`${b}pts`,s=!0)}v==="detachment rule"&&(n.SUMMARY.DETACHMENT=k,s=!0)}if(!s){const h=t.find(f=>String(f||"").trim());if(h){const f=String(h).match(/^(.*?)\s*-\s*(.*?)\s*-\s*(.*?)\s*\((\d+)\s*Points?\)/i);f&&(n.SUMMARY.LIST_TITLE=f[1].trim(),n.SUMMARY.FACTION_KEYWORD=f[2].trim(),n.SUMMARY.DETACHMENT=f[3].trim(),n.SUMMARY.TOTAL_ARMY_POINTS=`${parseInt(f[4],10)}pts`)}}const r=/^\s*([A-Za-z ]+):\s*$/,i=/^\s*(.*?)\s*\((\d+)\s*pts?\)\s*$/i,l=/^\s*•\s*(.*)$/;let c=null;const m=[];for(let h=0;h<t.length;h++){const f=String(t[h]||"");if(!f.trim())continue;const k=f.match(r);if(k){const $=k[1].trim().toLowerCase();c=/hero|character/.test($)?"CHARACTER":"OTHER DATASHEETS",m.length=0;continue}const b=f.match(i);if(b&&Za(f)===0){const $=b[1].trim(),U=parseInt(b[2],10)||0,B={quantity:"1x",name:$,points:U,items:[],isComplex:!1,nameshort:""},G=c==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[G]=n[G]||[],n[G].push(B),m.length=0,m.push({indent:0,node:B});continue}const M=f.match(l);if(!M)continue;const P=M[1].trim(),E=Za(f);for(;m.length>0&&E<=m[m.length-1].indent;)m.pop();const S=m.length>0?m[m.length-1].node:null;if(!S||/^B:\s*/i.test(P))continue;if(/^(E:|Enhancement:)/i.test(P)){const $=dl(P),U=m[0]?m[0].node:S;U.items=U.items||[],(U.items||[]).some(G=>/^Enhancement:/i.test(G.name||"")&&fe(G.name)===fe($.name))||U.items.push($);continue}if(Km(t,h)){const $=Qa(hl(P));let U=$.name||"";U=U.replace(/\s+w\/.*$/i,"").trim();const B={quantity:$.quantity||"1x",name:U,items:[],type:"subunit"};S.items=S.items||[],S.items.push(B),m.push({indent:E,node:B});continue}Um(S,P)}function d(h){const f=parseInt(String(h||"1x").replace(/[^0-9]/g,""),10);return Number.isFinite(f)&&f>0?f:1}for(const h of["CHARACTER","OTHER DATASHEETS"]){const f=n[h]||[];for(const v of f){const k=Array.isArray(v.items)?v.items:[],b=k.filter(S=>S&&S.type==="subunit");if(b.length<=1)continue;const M=new Map;for(const S of b){const I=fe((S.name||"").replace(/\s+w\/.*/i,"").trim());M.has(I)||M.set(I,{name:S.name,qty:0,wargear:new Map});const $=M.get(I);$.qty+=d(S.quantity);const U=Array.isArray(S.items)?S.items:[];for(const B of U){const G=fe(B.name||""),q=$.wargear.get(G)||{name:B.name,qty:0,type:B.type||"wargear"};q.qty+=d(B.quantity),$.wargear.has(G),$.wargear.set(G,q)}}const P=k.filter(S=>!(S&&S.type==="subunit")),E=[];for(const[,S]of M){const I={quantity:`${S.qty}x`,name:S.name,items:[],type:"subunit"};for(const[,$]of S.wargear)I.items.push({quantity:`${$.qty}x`,name:$.name,items:[],type:$.type||"wargear",nameshort:""});E.push(I)}v.items=[...P,...E]}}const y=n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD?String(n.SUMMARY.FACTION_KEYWORD).trim():"";function p(h){if(!h||!y)return h;const f=new RegExp("^"+y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\s+","i");return String(h).replace(f,"").trim()}if(y)for(const h of["CHARACTER","OTHER DATASHEETS"]){const f=n[h]||[];for(const v of f){v.name=p(v.name);const k=(v.items||[]).filter(b=>b&&b.type==="subunit");for(const b of k)b.name=p(b.name)}}for(const h of["CHARACTER","OTHER DATASHEETS"]){const f=n[h]||[];for(const v of f){Array.isArray(v.items)&&v.items.length>0&&va(v.items);const k=(v.items||[]).filter(b=>b&&b.type==="subunit");for(const b of k)Array.isArray(b.items)&&b.items.length>0&&va(b.items)}}return yr(n),n}function zm(t){try{const n=qm(t).format;return n==="NRNR"?"NRNR":n==="WTC-Compact"?"WTC_COMPACT":n==="WTC"?"WTC":n==="GWAPP"?"GW_APP":n==="NR-GW"?"NR_GW":n==="LF"?"LF":"UNKNOWN"}catch{const a=Array.isArray(t)?t.slice(0,25):[],s=a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i)||/^\s*\+\s*DETACHMENT:/i.test(i)),r=a.some(i=>/^(?:CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i.test((i||"").trim().toUpperCase()));return s&&r?"NR_GW":a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i))?"WTC_COMPACT":r?"GW_APP":"UNKNOWN"}}async function Xm(t){if(!t||typeof t!="string")throw new Error("Invalid army list text");const n=t.split(`
`),a=zm(n);if(a==="UNKNOWN")throw new Error("Unable to detect army list format. Supported formats: GW App, WTC, WTC Compact, NR-GW, NR-NR, ListForge");let s;try{switch(a){case"GW_APP":s=Ym(n);break;case"WTC":s=Wm(n);break;case"WTC_COMPACT":s=Nm(n);break;case"NR_GW":s=Hm(n);break;case"NRNR":s=Bm(n);break;case"LF":s=Gm(n);break;default:throw new Error(`Unsupported format: ${a}`)}}catch(i){throw console.error("Parse error:",i),new Error(`Failed to parse ${a} format: ${i.message}`)}const r=Vm(s);return{format:a,data:r}}function Vm(t,n){const a=t.SUMMARY||{},s=[],r=["CHARACTER","CHARACTERS","BATTLELINE","OTHER DATASHEETS","ALLIED UNITS","DEDICATED TRANSPORTS"];for(const i of r)t[i]&&Array.isArray(t[i])&&s.push(...t[i].map(l=>({...l,section:i})));return{FACTION_KEYWORD:a.FACTION_KEYWORD||a.FACTION_KEY||"Unknown",DETACHMENT:a.DETACHMENT||"",TOTAL_ARMY_POINTS:a.TOTAL_ARMY_POINTS||"0pts",LIST_TITLE:a.LIST_TITLE||"",UNITS:s}}function jm(t){if(!t)return 1;const n=String(t).match(/(\d+)/);return n?parseInt(n[1],10):1}const Zm={Asurmen:{baseType:"40mm"},Autarch:{baseType:"32mm"},"Autarch wayleaper":{baseType:"32mm"},"Avatar of Khaine":{baseType:"80mm"},Baharroth:{baseType:"40mm"},"Corsair Voidreavers":{baseType:"28.5mm"},"Corsair Voidscarred":{baseType:"28.5mm"},"Crimson Hunter":{baseType:"120x92mm"},"D-cannon Platform":{baseType:"40mm"},"Dark Reapers":{baseType:"28.5mm"},"Death Jester":{baseType:"25mm"},"Dire Avengers":{baseType:"28.5mm"},"Eldrad Ulthran":{baseType:"32mm"},Falcon:{baseType:"Large Flying Base"},Farseer:{baseType:"25mm"},"Farseer Skyrunner":{baseType:"Small Flying Base"},"Fire Dragons":{baseType:"28.5mm"},"Fire Prism":{baseType:"Large Flying Base"},Fuegan:{baseType:"40mm"},"Guardian Defenders":{baseType:"28.5mm"},"Guardian Defenders: Heavy Weapon Platform":{baseType:"40mm"},"Hemlock Wraithfighter":{baseType:"120x92mm"},"Howling Banshees":{baseType:"28.5mm"},"Jain Zar":{baseType:"40mm"},Lhykhis:{baseType:"40mm"},"Maugan Ra":{baseType:"40mm"},"Night Spinner":{baseType:"Large Flying Base"},Rangers:{baseType:"28.5mm"},"Shadow Weaver Platform":{baseType:"40mm"},Shadowseer:{baseType:"25mm"},"Shining Spears":{baseType:"Large Flying Base"},"Shroud Runners":{baseType:"Large Flying Base"},Skyweavers:{baseType:"Large Flying Base"},Solitaire:{baseType:"25mm"},Spiritseer:{baseType:"25mm"},Starweaver:{baseType:"Large Flying Base"},"Storm Guardians":{baseType:"28.5mm"},"Storm Guardians: Serpent’s Scale Platform":{baseType:"40mm"},"Striking Scorpions":{baseType:"28.5mm"},"Swooping Hawks":{baseType:"28.5mm"},"The Visarch":{baseType:"32mm"}},Jm={"Corvus Blackstar":{baseType:"120x92mm"},"Deathwatch Terminator Squad":{baseType:"40mm"},"Deathwatch Veterans":{baseType:"32mm"},"Fortis Kill Team":{baseType:"32mm"},"Indomitor Kill Team":{baseType:"40mm"},"Spectrus Kill Team":{baseType:"32mm"},"Spectrus Kill Team: Kill Team Infiltrators with bolt sniper rifles":{baseType:"40mm"},"Talonstrike Kill Team":{baseType:"32mm"},"Talonstrike Kill Team: Kill Team Heavy Intercessors with Jump Packs":{baseType:"40mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},Qm={Archon:{baseType:"25mm"},Beastmaster:{baseType:"Small Flying Base"},"Beastmaster: Clawed Fiends, Khymerae, Razorwing Flocks":{baseType:"40mm"},"Court of the Archon: Sslyth":{baseType:"40mm"},"Court of the Archon: Ur-Ghul, Lhamaean, Medusae":{baseType:"25mm"},Cronos:{baseType:"Large Flying Base"},Drazhar:{baseType:"40mm"},Grotesques:{baseType:"40mm"},Haemonculus:{baseType:"25mm"},Hellions:{baseType:"Small Flying Base"},Incubi:{baseType:"28.5mm"},"Kabalite Warriors":{baseType:"25mm"},"Lelith Hesperax":{baseType:"32mm"},Mandrakes:{baseType:"28.5mm"},Raider:{baseType:"Large Flying Base"},Ravager:{baseType:"Large Flying Base"},"Razorwing Jetfighter":{baseType:"120x92mm"},Reavers:{baseType:"Small Flying Base"},Scourges:{baseType:"32mm"},Succubus:{baseType:"25mm"},Talos:{baseType:"Large Flying Base"},"Urien Rakarth":{baseType:"25mm"},Venom:{baseType:"Large Flying Base"},"Voidraven Bomber":{baseType:"120x92mm"},Wracks:{baseType:"25mm"},Wyches:{baseType:"25mm"}},eh={"Annihilation Barge":{baseType:"Large Flying Base"},"C’tan Shard of the Deceiver":{baseType:"40mm"},"C’tan Shard of the Nightbringer":{baseType:"40mm"},"C’tan Shard of the Void Dragon":{baseType:"80mm"},"Canoptek Doomstalker":{baseType:"90mm"},"Canoptek Reanimator":{baseType:"60mm"},"Canoptek Scarab Swarms":{baseType:"40mm"},"Canoptek Spyders":{baseType:"60mm"},"Canoptek Wraiths":{baseType:"50mm"},"Catacomb Command Barge":{baseType:"Large Flying Base"},Chronomancer:{baseType:"40mm"},"Convergence of Dominion":{baseType:"hull",hullDimensions:{width:0,height:0}},Cryptothralls:{baseType:"32mm"},Deathmarks:{baseType:"32mm"},"Doom Scythe":{baseType:"120x92mm"},"Doomsday Ark":{baseType:"Large Flying Base"},"Flayed Ones":{baseType:"28.5mm"},"Ghost Ark":{baseType:"Large Flying Base"},"Hexmark Destroyer":{baseType:"50mm"},"Illuminor Szeras":{baseType:"80mm"},Immortals:{baseType:"32mm"},"Imotekh the Stormlord":{baseType:"40mm"},"Lokhust Destroyers":{baseType:"Large Flying Base"},"Lokhust Heavy Destroyers":{baseType:"60mm"},"Lokhust Lord":{baseType:"Large Flying Base"},Lychguard:{baseType:"32mm"},Monolith:{baseType:"160mm"},"Necron Warriors":{baseType:"32mm"},"Night Scythe":{baseType:"120x92mm"},Obelisk:{baseType:"120x92mm"},"Ophydian Destroyers":{baseType:"50mm"},"Orikan the Diviner":{baseType:"40mm"},Overlord:{baseType:"40mm"},"Overlord with Translocation Shroud":{baseType:"40mm"},Plasmancer:{baseType:"32mm"},Psychomancer:{baseType:"40mm"},"Royal Warden":{baseType:"32mm"},"Skorpekh Destroyers":{baseType:"50mm"},"Skorpekh Lord":{baseType:"60mm"},Technomancer:{baseType:"50mm"},"Tesseract Vault":{baseType:"120x92mm"},"The Silent King: Szarekh":{baseType:"100mm"},"The Silent King: Triarchal Menhir":{baseType:"50mm"},"Tomb Blades":{baseType:"Small Flying Base"},"Transcendent C’tan":{baseType:"60mm"},"Trazyn the Infinite":{baseType:"40mm"},"Triarch Praetorians":{baseType:"32mm"},"Triarch Stalker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Seraptek Heavy Construct":{baseType:"hull",hullDimensions:{width:0,height:0}}},th={Battlewagon:{baseType:"hull",hullDimensions:{width:0,height:0}},"Beast Snagga Boyz":{baseType:"32mm"},Beastboss:{baseType:"50mm"},"Beastboss on Squigosaur":{baseType:"80mm"},"Big Mek":{baseType:"50mm"},"Big Mek in Mega Armour":{baseType:"40mm"},"Big Mek with Shokk Attack Gun":{baseType:"40mm"},"Big’ed Bossbunka":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blitza-bommer":{baseType:"120x92mm"},"Boomdakka Snazzwagon":{baseType:"150x95mm"},"Boss Snikrot":{baseType:"40mm"},Boyz:{baseType:"32mm"},"Breaka Boyz":{baseType:"32mm"},"Breaka Boyz: Boss Nob":{baseType:"40mm"},"Burna Boyz":{baseType:"32mm"},"Burna-bommer":{baseType:"120x92mm"},Dakkajet:{baseType:"120x92mm"},"Deff Dread":{baseType:"60mm"},"Deffkilla Wartrike":{baseType:"150x95mm"},Deffkoptas:{baseType:"75x42mm"},"Flash Gitz":{baseType:"40mm"},"Ghazghkull Thraka":{baseType:"80mm"},"Ghazghkull Thraka: Makari":{baseType:"25mm"},Gorkanaut:{baseType:"170x109mm"},Gretchin:{baseType:"25mm"},"Gretchin: Runtherd":{baseType:"32mm"},"Hunta Rig":{baseType:"170x109mm"},"Kill Rig":{baseType:"170x109mm"},"Killa Kans":{baseType:"60mm"},Kommandos:{baseType:"32mm"},"Kustom Boosta-blasta":{baseType:"150x95mm"},Lootas:{baseType:"32mm"},Meganobz:{baseType:"40mm"},"Megatrakk Scrapjet":{baseType:"150x95mm"},Mek:{baseType:"32mm"},"Mek Gunz":{baseType:"hull",hullDimensions:{width:0,height:0}},Morkanaut:{baseType:"170x109mm"},"Mozrog Skragbad":{baseType:"80mm"},Nobz:{baseType:"32mm"},Painboss:{baseType:"40mm"},Painboy:{baseType:"32mm"},"Rukkatrukk Squigbuggy":{baseType:"150x95mm"},"Shokkjump Dragsta":{baseType:"150x95mm"},"Squighog Boyz":{baseType:"75x42mm"},"Squighog Boyz: Nob on Smasha Squig":{baseType:"90x52.5mm"},Stompa:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormboyz:{baseType:"32mm"},Tankbustas:{baseType:"32mm"},"Tankbustas: Boss Nob":{baseType:"40mm"},Trukk:{baseType:"hull",hullDimensions:{width:0,height:0}},Warbikers:{baseType:"75x42mm"},Warboss:{baseType:"40mm"},"Warboss in Mega Armour":{baseType:"50mm"},"Wazbom Blastajet":{baseType:"150x95mm"},Weirdboy:{baseType:"40mm"},Wurrboy:{baseType:"32mm"},"Zodgrod Wortsnagga":{baseType:"50mm"},"Gargantuan Squiggoth":{baseType:"hull",hullDimensions:{width:0,height:0}}},nh={Barbgaunts:{baseType:"40mm"},Biovores:{baseType:"80mm"},Broodlord:{baseType:"75x42mm"},Carnifexes:{baseType:"105x70mm"},Deathleaper:{baseType:"60mm"},Exocrine:{baseType:"120x92mm"},Gargoyles:{baseType:"Small Flying Base"},Genestealers:{baseType:"32mm"},Harpy:{baseType:"120x92mm"},Haruspex:{baseType:"120x92mm"},"Hive Crone":{baseType:"120x92mm"},"Hive Guard":{baseType:"50mm"},"Hive Tyrant":{baseType:"50mm"},Hormagaunts:{baseType:"28.5mm"},Lictor:{baseType:"50mm"},Maleceptor:{baseType:"120x92mm"},Mawloc:{baseType:"120x92mm"},"Mucolid Spores":{baseType:"40mm"},Neurogaunts:{baseType:"25mm"},"Neurogaunts: Nodebeasts":{baseType:"28.5mm"},Neurolictor:{baseType:"50mm"},Neurotyrant:{baseType:"50mm"},"Norn Assimilator":{baseType:"100mm"},"Norn Emissary":{baseType:"100mm"},"Old One Eye":{baseType:"105x70mm"},"Parasite of Mortrex":{baseType:"40mm"},Psychophage:{baseType:"120x92mm"},Pyrovores:{baseType:"80mm"},Raveners:{baseType:"40mm"},"Ripper Swarms":{baseType:"40mm"},"Screamer-killer":{baseType:"90mm"},"Spore MInes":{baseType:"25mm"},Sporocyst:{baseType:"hull",hullDimensions:{width:0,height:0}},Termagants:{baseType:"28.5mm"},Tervigon:{baseType:"120x92mm"},"The Swarmlord":{baseType:"60mm"},Toxicrene:{baseType:"120x92mm"},Trygon:{baseType:"120x92mm"},"Tyranid Warriors with Melee Bio-weapons":{baseType:"50mm"},"Tyranid Warriors with Ranged Bio-weapons":{baseType:"50mm"},Tyrannocyte:{baseType:"100mm"},Tyrannofex:{baseType:"120x92mm"},"Tyrant Guard":{baseType:"50mm"},Venomthropes:{baseType:"40mm"},"Von Ryan’s Leapers":{baseType:"40mm"},"Winged Hive Tyrant":{baseType:"60mm"},"Winged Tyranid Prime":{baseType:"50mm"},Zoanthropes:{baseType:"40mm"},Harridan:{baseType:"hull",hullDimensions:{width:4,height:6}},Hierophant:{baseType:"hull",hullDimensions:{width:0,height:0}}},wi={"ADEPTA SORORITAS":{"Aestred Thurga and Agathae Dolan: Aestred Thurga":{baseType:"32mm"},"Aestred Thurga and Agathae Dolan: Agathae Dolan":{baseType:"25mm"},"Arco-flagellants":{baseType:"25mm"},"Battle Sisters Squad":{baseType:"32mm"},Canoness:{baseType:"32mm"},"Canoness with Jump Pack":{baseType:"32mm"},Castigator:{baseType:"hull",hullDimensions:{width:6,height:8}},"Celestian Sacresants":{baseType:"32mm"},Daemonifuge:{baseType:"32mm"},Dialogus:{baseType:"40mm"},Dogmata:{baseType:"32mm"},"Dominion Squad":{baseType:"32mm"},Exorcist:{baseType:"hull",hullDimensions:{width:3.5,height:6}},Hospitaller:{baseType:"50mm"},Imagifier:{baseType:"32mm"},Immolator:{baseType:"hull",hullDimensions:{width:4,height:6}},"Junith Eruita":{baseType:"50mm"},"Ministorum Priest":{baseType:"32mm"},Mortifiers:{baseType:"50mm"},"Morvenn Vahl":{baseType:"60mm"},Palatine:{baseType:"32mm"},"Paragon Warsuits":{baseType:"50mm"},"Penitent Engines":{baseType:"50mm"},"Repentia Squad: Repentia Superior":{baseType:"32mm"},"Repentia Squad: Sister Repentia":{baseType:"28.5mm"},"Retributor Squad":{baseType:"32mm"},"Saint Celestine":{baseType:"40mm"},"Saint Celestine: Geminae Superia":{baseType:"32mm"},Sanctifiers:{baseType:"25mm"},"Seraphim Squad":{baseType:"32mm"},"Sisters Novitiate Squad: Novitiate Superior":{baseType:"32mm"},"Sisters Novitiate Squad: Sister Novitiate":{baseType:"28.5mm"},"Sororitas Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Triumph of Saint Katherine":{baseType:"120x92mm"},"Zephyrim Squad":{baseType:"32mm"}},"ADEPTUS CUSTODES":{Aleya:{baseType:"32mm"},"Allarus Custodians":{baseType:"40mm"},"Anathema Psykana Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blade Champion":{baseType:"40mm"},"Custodian Guard":{baseType:"40mm"},"Custodian Wardens":{baseType:"40mm"},"Knight-Centura":{baseType:"32mm"},Prosecutors:{baseType:"32mm"},"Shield-Captain":{baseType:"40mm"},"Shield-Captain in Allarus Terminator Armour":{baseType:"40mm"},"Shield-Captain on Dawneagle Jetbike":{baseType:"75x42mm"},"Trajann Valoris":{baseType:"40mm"},Valerian:{baseType:"40mm"},"Venerable Contemptor Dreadnought":{baseType:"60mm"},"Venerable Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vertus Praetors":{baseType:"75x42mm"},Vigilators:{baseType:"32mm"},Witchseekers:{baseType:"32mm"},"Agamatus Custodians":{baseType:"75x42mm"},"Aquilon Custodians":{baseType:"50mm"},"Ares Gunship":{baseType:"160mm"},"Caladius Grav-tank":{baseType:"170x109mm"},"Contemptor-Achillus Dreadnought":{baseType:"60mm"},"Contemptor-Galatus Dreadnought":{baseType:"60mm"},"Coronus Grav-carrier":{baseType:"170x109mm"},"Custodian Guard with Adrasite and Pyrithite Spears":{baseType:"40mm"},"Orion Assault Dropship":{baseType:"160mm"},"Pallas Grav-attack":{baseType:"105x70mm"},"Sagittarum Custodians":{baseType:"40mm"},"Telemon Heavy Dreadnought":{baseType:"100mm"},"Venatari Custodians":{baseType:"40mm"}},"ADEPTUS MECHANICUS":{"Archaeopter Fusilave":{baseType:"170x109mm"},"Archaeopter Stratoraptor":{baseType:"170x109mm"},"Archaeopter Transvector":{baseType:"170x109mm"},"Belisarius Cawl":{baseType:"105x70mm"},"Corpuscarii Electro-Priests":{baseType:"32mm"},"Cybernetica Datasmith":{baseType:"32mm"},"Fulgurite Electro-Priests":{baseType:"32mm"},"Ironstrider Ballistarii":{baseType:"105x70mm"},"Kastelan Robots":{baseType:"60mm"},"Kataphron Breachers":{baseType:"60mm"},"Kataphron Destroyers":{baseType:"60mm"},"Onager Dunecrawler":{baseType:"130mm"},"Pteraxii Skystalkers":{baseType:"40mm"},"Pteraxii Sterylizors":{baseType:"40mm"},"Serberys Raiders":{baseType:"60x35.5mm"},"Serberys Sulphurhounds":{baseType:"60x35.5mm"},"Sicarian Infiltrators":{baseType:"40mm"},"Sicarian Ruststalkers":{baseType:"40mm"},"Skitarii Marshal":{baseType:"32mm"},"Skitarii Rangers":{baseType:"25mm"},"Skitarii Rangers/Skitarii Vanguard: Transuranic Arquebus":{baseType:"60x35.5mm"},"Skitarii Vanguard":{baseType:"25mm"},"Skorpius Disintegrator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skorpius Dunerider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sydonian Dragoons with Radium Jezzails":{baseType:"105x70mm"},"Sydonian Dragoons with Taser Lances":{baseType:"105x70mm"},"Sydonian Skatros":{baseType:"40mm"},"Tech-Priest Dominus":{baseType:"50mm"},"Tech-Priest Enginseer":{baseType:"32mm"},"Tech-Priest Manipulus":{baseType:"50mm"},Technoarcheologist:{baseType:"32mm"}},"ADEPTUS TITANICUS":{"Reaver Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warbringer Nemesis Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warhound Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warlord Titan":{baseType:"hull",hullDimensions:{width:0,height:0}}},AELDARI:Zm,"ASTRA MILITARUM":{"Aegis Defence Line":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armoured Sentinels":{baseType:"80mm"},"Artillery Team":{baseType:"130mm"},"Attilan Rough Riders":{baseType:"60x35.5mm"},Baneblade:{baseType:"hull",hullDimensions:{width:0,height:0}},Banehammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Banesword:{baseType:"hull",hullDimensions:{width:0,height:0}},Basilisk:{baseType:"hull",hullDimensions:{width:0,height:0}},"Bullgryn squad":{baseType:"40mm"},"Cadian Castellan":{baseType:"28.5mm"},"Cadian Command Squad":{baseType:"28.5mm"},"Cadian Heavy Weapons Squad":{baseType:"50mm"},"Cadian Shock Troops":{baseType:"25mm"},"Catachan Command Squad":{baseType:"25mm"},"Catachan Heavy Weapons Squad":{baseType:"60mm"},"Catachan Jungle Fighters":{baseType:"25mm"},Chimera:{baseType:"hull",hullDimensions:{width:0,height:0}},Commissar:{baseType:"28.5mm"},"Death Korps of Krieg":{baseType:"25mm"},"Death Riders":{baseType:"60x35.5mm"},Deathstrike:{baseType:"hull",hullDimensions:{width:0,height:0}},Doomhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},"Field Ordnance Battery":{baseType:"100mm"},"Gaunt’s Ghosts":{baseType:"28.5mm"},Hellhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Hellhound:{baseType:"hull",hullDimensions:{width:0,height:0}},Hydra:{baseType:"hull",hullDimensions:{width:0,height:0}},Kasrkin:{baseType:"28.5mm"},"Krieg Combat Engineers":{baseType:"25mm"},"Krieg Command Squad":{baseType:"25mm"},"Krieg Command Squad: Lord Commissar":{baseType:"32mm"},"Krieg Heavy Weapons Squad":{baseType:"50mm"},"Krieg Heavy Weapons Squad: Fire Coordinator":{baseType:"25mm"},"Leman Russ Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Demolisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Eradicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Executioner":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Exterminator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Punisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Vanquisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Marshal Dreir":{baseType:"75x42mm"},"Lord Solar Leontus":{baseType:"80mm"},Manticore:{baseType:"hull",hullDimensions:{width:0,height:0}},"Militarum Tempestus Command Squad":{baseType:"25mm"},"Ministorum Priest":{baseType:"32mm"},"Nork Deddog":{baseType:"40mm"},"Ogryn Bodyguard":{baseType:"40mm"},"Ogryn squad":{baseType:"40mm"},"Primaris Psyker":{baseType:"32mm"},Ratlings:{baseType:"25mm"},"Rogal Dorn Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Rogal Dorn Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Scout Sentinels":{baseType:"80mm"},Shadowsword:{baseType:"hull",hullDimensions:{width:0,height:0}},"Sly Marbo":{baseType:"32mm"},Stormlord:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormsword:{baseType:"hull",hullDimensions:{width:0,height:0}},Taurox:{baseType:"hull",hullDimensions:{width:0,height:0}},"Taurox Prime":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tech-Priest Enginseer":{baseType:"32mm"},"Tempestus Aquilons":{baseType:"28.5mm"},"Tempestus Scions":{baseType:"25mm"},"Ursula Creed":{baseType:"32mm"},Valkyrie:{baseType:"120x92mm"},Wyvern:{baseType:"hull",hullDimensions:{width:0,height:0}},"Avenger Strike Fighter":{baseType:"120x92mm"},"Cyclops Demolition Vehicle":{baseType:"hull",hullDimensions:{width:0,height:0}}},"BLACK TEMPLARS":{"Black Templars Gladiator Lancer":{baseType:"100mm"},"Black Templars Gladiator Reaper":{baseType:"100mm"},"Black Templars Gladiator Valiant":{baseType:"100mm"},"Black Templars Impulsor":{baseType:"100mm"},"Black Templars Repulsor":{baseType:"100mm"},"Black Templars Repulsor Executioner":{baseType:"100mm"},Castellan:{baseType:"40mm"},"Chaplain Grimaldus":{baseType:"40mm"},"Chaplain Grimaldus: Cenobyte Servitors":{baseType:"28.5mm"},"Crusader Squad: Neophytes":{baseType:"28.5mm"},"Crusader Squad: Sword Brother/Initiates":{baseType:"32mm"},"High Marshal Helbrecht":{baseType:"60mm"},Marshal:{baseType:"40mm"},"Primaris Crusader Squad: Initiates":{baseType:"32mm"},"Primaris Crusader Squad: Neophytes":{baseType:"28.5mm"},"Primaris Crusader Squad: Sword Brother":{baseType:"40mm"},"Primaris Sword Brethren":{baseType:"40mm"},"The Emperor’s Champion":{baseType:"40mm"}},"BLOOD ANGELS":{Astorath:{baseType:"40mm"},"Baal Predator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blood Angels Captain":{baseType:"40mm"},"Chief Librarian Mephiston":{baseType:"40mm"},"Commander Dante":{baseType:"50mm"},"Death Company Captain":{baseType:"40mm"},"Death Company Captain with Jump Pack":{baseType:"40mm"},"Death Company Dreadnought":{baseType:"90mm"},"Death Company Marines":{baseType:"32mm"},"Death Company Marines with Bolt Rifles":{baseType:"32mm"},"Death Company Marines with Jump Packs":{baseType:"32mm"},Lemartes:{baseType:"40mm"},"Sanguinary Guard":{baseType:"40mm"},"Sanguinary Priest":{baseType:"40mm"},"The Sanguinor":{baseType:"40mm"}},"CHAOS DAEMONS":{"Be’lakor":{baseType:"100mm"},"Beasts of Nurgle":{baseType:"60mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodmaster:{baseType:"40mm"},Bloodthirster:{baseType:"120x92mm"},"Blue Horrors":{baseType:"25mm"},"Burning Chariot":{baseType:"120x92mm"},Changecaster:{baseType:"32mm"},"Contorted Epitome":{baseType:"75x42mm"},"Daemon Prince of Chaos":{baseType:"60mm"},"Daemon Prince of Chaos with Wings":{baseType:"60mm"},Daemonettes:{baseType:"25mm"},Epidemius:{baseType:"60mm"},"Exalted Flamer":{baseType:"75x42mm"},Fateskimmer:{baseType:"120x92mm"},"Feculent Gnarlmaw":{baseType:"hull",hullDimensions:{width:0,height:0}},Fiends:{baseType:"75x42mm"},Flamers:{baseType:"32mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Fluxmaster:{baseType:"Large Flying Base"},"Great Unclean One":{baseType:"130mm"},Hellflayers:{baseType:"120x92mm"},"Horticulous Slimux":{baseType:"105x70mm"},"Infernal Enrapturess":{baseType:"60x35.5mm"},"Kairos Fateweaver":{baseType:"100mm"},Karanak:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},Nurglings:{baseType:"40mm"},"Pink Horrors":{baseType:"32mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Poxbringer:{baseType:"32mm"},"Rendmaster on Blood Throne":{baseType:"120x92mm"},Rotigus:{baseType:"130mm"},Screamers:{baseType:"Small Flying Base"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"},Skarbrand:{baseType:"100mm"},"Skull Altar":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skull Cannon":{baseType:"120x92mm"},Skullmaster:{baseType:"90x52.5mm"},Skulltaker:{baseType:"40mm"},"Sloppity Bilepiper":{baseType:"32mm"},"Soul Grinder":{baseType:"160mm"},"Spoilpox Scrivener":{baseType:"40mm"},"Syll’esske":{baseType:"50mm"},"The Blue Scribes":{baseType:"Large Flying Base"},"The Changeling":{baseType:"40mm"},"The Masque of Slaanesh":{baseType:"32mm"},Tormentbringer:{baseType:"120x92mm"},Tranceweaver:{baseType:"32mm"}},"CHAOS KNIGHTS":{"Knight Abominant":{baseType:"170x109mm"},"Knight Desecrator":{baseType:"170x109mm"},"Knight Despoiler":{baseType:"170x109mm"},"Knight Rampager":{baseType:"170x109mm"},"Knight Tyrant":{baseType:"170x109mm"},"War Dog Brigand":{baseType:"100mm"},"War Dog Executioner":{baseType:"100mm"},"War Dog Huntsman":{baseType:"100mm"},"War Dog Karnivore":{baseType:"100mm"},"War Dog Stalker":{baseType:"100mm"},"Chaos Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Cerastus Knight Acheron":{baseType:"170x109mm"},"Chaos Cerastus Knight Atrapos":{baseType:"170x109mm"},"Chaos Cerastus Knight Castigator":{baseType:"170x109mm"},"Chaos Cerastus Knight Lancer":{baseType:"170x109mm"},"Chaos Questoris Knight Magaera":{baseType:"170x109mm"},"Chaos Questoris Knight Styrix":{baseType:"170x109mm"},"War Dog Moirax":{baseType:"100mm"}},"CHAOS SPACE MARINES":{"Abaddon the Despoiler":{baseType:"60mm"},"Accursed Cultists: Mutant":{baseType:"25mm"},"Accursed Cultists: Torment":{baseType:"40mm"},"Chaos Bikers":{baseType:"75x42mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Lord":{baseType:"40mm"},"Chaos Lord in Terminator Armour":{baseType:"40mm"},"Chaos Lord with Jump Pack":{baseType:"40mm"},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminator Squad":{baseType:"40mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},Chosen:{baseType:"32mm"},"Cultist Firebrand":{baseType:"32mm"},"Cultist Mob":{baseType:"25mm"},Cypher:{baseType:"32mm"},"Dark Apostle":{baseType:"40mm"},"Dark Apostle: Dark Disciple":{baseType:"25mm"},"Dark Commune: Blessed Blade":{baseType:"28.5mm"},"Dark Commune: Cult Demagogue, Mindwitch, Iconarch":{baseType:"32mm"},Defiler:{baseType:"160mm"},"Fabius Bile":{baseType:"40mm"},"Fabius Bile: Surgeon Acolyte":{baseType:"32mm"},"Fellgor beastmen":{baseType:"32mm"},Forgefiend:{baseType:"120x92mm"},"Haarken Worldclaimer":{baseType:"40mm"},Havocs:{baseType:"40mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Heretic Astartes Daemon Prince":{baseType:"60mm"},"Heretic Astartes Daemon Prince with Wings":{baseType:"60mm"},"Huron Blackheart":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},Legionaries:{baseType:"32mm"},"Lord Discordant on Helstalker":{baseType:"120x92mm"},"Master of Executions":{baseType:"40mm"},"Master of Possession":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},"Nemesis Claw":{baseType:"32mm"},"Noctilith Crown":{baseType:"hull",hullDimensions:{width:0,height:0}},Obliterators:{baseType:"50mm"},Possessed:{baseType:"40mm"},Raptors:{baseType:"32mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Traitor Enforcer":{baseType:"32mm"},"Traitor Enforcer: Traitor Ogryn":{baseType:"40mm"},"Traitor Guardsmen Squad":{baseType:"25mm"},"Vashtorr the Arkifane":{baseType:"80mm"},Venomcrawler:{baseType:"100mm"},"Warp Talons":{baseType:"32mm"},Warpsmith:{baseType:"60x35.5mm"}},"DARK ANGELS":{Asmodai:{baseType:"50mm"},Azrael:{baseType:"50mm"},Belial:{baseType:"50mm"},"Deathwing Knights":{baseType:"40mm"},"Deathwing Terminator Squad":{baseType:"40mm"},Ezekiel:{baseType:"25mm"},"Inner Circle Companions":{baseType:"40mm"},"Land Speeder Vengeance":{baseType:"Large Flying Base"},Lazarus:{baseType:"40mm"},"Lion El’Jonson":{baseType:"60mm"},"Nephilim Jetfighter":{baseType:"120x92mm"},"Ravenwing Black Knights":{baseType:"75x42mm"},"Ravenwing Command Squad":{baseType:"75x42mm"},"Ravenwing Dark Talon":{baseType:"120x92mm"},"Ravenwing Darkshroud":{baseType:"Large Flying Base"},Sammael:{baseType:"Large Flying Base"}},"DEATH GUARD":{"Biologus Putrifier":{baseType:"40mm"},"Blightlord Terminators":{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Nurgle":{baseType:"60mm"},"Daemon Prince of Nurgle with Wings":{baseType:"60mm"},"Deathshroud Terminators":{baseType:"40mm"},Defiler:{baseType:"160mm"},"Foetid Bloat-Drone":{baseType:"60mm"},"Foetid Bloat-drone with Heavy Blight Launcher":{baseType:"60mm"},"Foul Blightspawn":{baseType:"40mm"},Helbrute:{baseType:"60mm"},"Icon Bearer":{baseType:"32mm"},"Lord of Contagion":{baseType:"50mm"},"Lord of Poxes":{baseType:"40mm"},"Lord of Virulence":{baseType:"50mm"},"Malignant Plaguecaster":{baseType:"32mm"},"Miasmic Malignifier":{baseType:"hull",hullDimensions:{width:0,height:0}},Mortarion:{baseType:"100mm"},"Myphitic Blight-Haulers":{baseType:"80mm"},"Noxious Blightbringer":{baseType:"40mm"},"Plague Marines":{baseType:"32mm"},"Plague Surgeon":{baseType:"40mm"},"Plagueburst Crawler":{baseType:"hull",hullDimensions:{width:0,height:0}},Poxwalkers:{baseType:"25mm"},Tallyman:{baseType:"40mm"},Typhus:{baseType:"50mm"},"Beasts of Nurgle":{baseType:"60mm"},"Great Unclean One":{baseType:"130mm"},Nurglings:{baseType:"40mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Rotigus:{baseType:"130mm"}},DEATHWATCH:Jm,DRUKHARI:Qm,"EMPEROR’S CHILDREN":{"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminators":{baseType:"40mm"},"Daemon Prince of Slaanesh":{baseType:"60mm"},"Daemon Prince of Slaanesh with Wings":{baseType:"60mm"},"Flawless Blades":{baseType:"40mm"},Fulgrim:{baseType:"130mm"},Heldrake:{baseType:"120x92mm"},Infractors:{baseType:"32mm"},"Lord Exultant":{baseType:"40mm"},"Lord Kakophonist":{baseType:"40mm"},"Lucius the Eternal":{baseType:"50mm"},Maulerfiend:{baseType:"120x92mm"},"Noise Marines":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},Tormentors:{baseType:"32mm"},Daemonettes:{baseType:"25mm"},Fiends:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"}},"GENESTEALER CULTS":{Aberrants:{baseType:"32mm"},Abominant:{baseType:"40mm"},"Achilles Ridgerunners":{baseType:"120x92mm"},"Acolyte Hybrids with Autopistols":{baseType:"32mm"},"Acolyte Hybrids with Hand Flamers":{baseType:"32mm"},"Acolyte Iconward":{baseType:"32mm"},"Atalan Jackals":{baseType:"60x35.5mm"},"Atalan Jackals: Wolfquad":{baseType:"60mm"},Benefictus:{baseType:"32mm"},Biophagus:{baseType:"25mm"},Clamavus:{baseType:"32mm"},"Goliath Rockgrinder":{baseType:"hull",hullDimensions:{width:0,height:0}},"Goliath Truck":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hybrid Metamorphs":{baseType:"32mm"},"Jackal Alphus":{baseType:"60x35.5mm"},Kelermorph:{baseType:"32mm"},Locus:{baseType:"32mm"},Magus:{baseType:"32mm"},"Neophyte Hybrids":{baseType:"25mm"},"Neophyte Hybrids: Heavy stubber, Mining laser, Seismic cannon":{baseType:"32mm"},Nexos:{baseType:"40mm"},Patriarch:{baseType:"50mm"},Primus:{baseType:"32mm"},"Purestrain Genestealers":{baseType:"32mm"},"Reductus Saboteur":{baseType:"32mm"},Sanctus:{baseType:"32mm"}},"GREY KNIGHTS":{"Brother-Captain":{baseType:"40mm"},"Brother-Captain Stern":{baseType:"40mm"},"Brotherhood Champion":{baseType:"32mm"},"Brotherhood Chaplain":{baseType:"40mm"},"Brotherhood Librarian":{baseType:"40mm"},"Brotherhood Techmarine":{baseType:"32mm"},"Brotherhood Terminator Squad":{baseType:"40mm"},"Castellan Crowe":{baseType:"40mm"},"Grand Master":{baseType:"40mm"},"Grand Master in Nemesis Dreadknight":{baseType:"120x92mm"},"Grand Master Voldus":{baseType:"40mm"},"Grey Knights Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Razorback":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Stormhawk Interceptor":{baseType:"120x92mm"},"Grey knights Stormraven Gunship":{baseType:"120x92mm"},"Grey knights Stormtalon Gunship":{baseType:"120x92mm"},"Grey Knights Venerable Dreadnought":{baseType:"60mm"},"Interceptor Squad":{baseType:"32mm"},"Kaldor Draigo":{baseType:"40mm"},"Nemesis Dreadknight":{baseType:"120x92mm"},"Paladin Squad":{baseType:"40mm"},"Purgation Squad":{baseType:"32mm"},"Purifier Squad":{baseType:"32mm"},Servitors:{baseType:"25mm"},"Strike Squad":{baseType:"32mm"},"Grey Knights Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}},"Land Raider Banisher":{baseType:"hull",hullDimensions:{width:0,height:0}}},"IMPERIAL AGENTS":{"Callidus Assassin":{baseType:"32mm"},"Corvus Blackstar":{baseType:"120x92mm"},"Culexus Assassin":{baseType:"32mm"},"Deathwatch Kill Team":{baseType:"32mm"},"Eversor Assassin":{baseType:"32mm"},"Exaction Squad":{baseType:"28.5mm"},"Exaction Squad: Cyber-mastiff":{baseType:"25mm"},"Grey Knights Terminator Squad":{baseType:"40mm"},"Imperial Navy Breachers":{baseType:"25mm"},"Imperial Navy Breachers: Navis las-volley, endurant shield":{baseType:"28.5mm"},"Imperial Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},Inquisitor:{baseType:"32mm"},"Inquisitor Coteaz":{baseType:"40mm"},"Inquisitor Draxus":{baseType:"32mm"},"Inquisitor Greyfax":{baseType:"32mm"},"Inquisitorial Agents":{baseType:"25mm"},"Inquisitorial Agents: Gun Servitors":{baseType:"32mm"},"Inquisitorial Chimera":{baseType:"hull",hullDimensions:{width:0,height:0}},"Ministorum Priest":{baseType:"32mm"},Navigator:{baseType:"32mm"},"Rogue Trader entourage":{baseType:"25mm"},Sanctifiers:{baseType:"25mm"},"Sisters of Battle Immolator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sisters of Battle Squad":{baseType:"32mm"},"Subductor Squad":{baseType:"28.5mm"},"Subductor Squad: Cyber-mastiff":{baseType:"25mm"},"Vigilant Squad":{baseType:"28.5mm"},"Vigilant Squad: Cyber-mastiff":{baseType:"25mm"},"Vindicare Assassin":{baseType:"32mm"},"Voidsmen-at-Arms":{baseType:"32mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},"IMPERIAL KNIGHTS":{"Armiger Helverin":{baseType:"100mm"},"Armiger Warglaive":{baseType:"100mm"},"Canis Rex":{baseType:"170x109mm"},"Knight Castellan":{baseType:"170x109mm"},"Knight Crusader":{baseType:"170x109mm"},"Knight Errant":{baseType:"170x109mm"},"Knight Gallant":{baseType:"170x109mm"},"Knight Paladin":{baseType:"170x109mm"},"Knight Preceptor":{baseType:"170x109mm"},"Knight Valiant":{baseType:"170x109mm"},"Knight Warden":{baseType:"170x109mm"},"Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armiger Moirax":{baseType:"100mm"},"Cerastus Knight Acheron":{baseType:"170x109mm"},"Cerastus Knight Atrapos":{baseType:"170x109mm"},"Cerastus Knight Castigator":{baseType:"170x109mm"},"Cerastus Knight Lancer":{baseType:"170x109mm"},"Questoris Knight Magaera":{baseType:"170x109mm"},"Questoris Knight Styrix":{baseType:"170x109mm"}},"LEAGUES OF VOTANN":{"Brôkhyr Iron-master":{baseType:"32mm"},"Brôkhyr Iron-master: E-COG":{baseType:"25mm"},"Brôkhyr Iron-master: Ironkin Assistant":{baseType:"28.5mm"},"Brôkhyr Thunderkyn":{baseType:"40mm"},"Cthonian Beserks":{baseType:"28.5mm"},"Cthonian Beserks: Mole grenade launcher":{baseType:"50mm"},"Einhyr Champion":{baseType:"40mm"},"Einhyr Hearthguard":{baseType:"32mm"},Grimnyr:{baseType:"40mm"},"Grimnyr: CORV":{baseType:"25mm"},"Hearthkyn Warriors":{baseType:"28.5mm"},"Hekaton Land Fortress":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hernkyn Pioneers":{baseType:"90x52.5mm"},"Hernkyn Yaegirs":{baseType:"28.5mm"},Kâhl:{baseType:"40mm"},Sagitaur:{baseType:"hull",hullDimensions:{width:0,height:0}},"Ûthar the Destined":{baseType:"40mm"}},NECRONS:eh,ORKS:th,"SPACE MARINES":{"Adrax Agatone":{baseType:"40mm"},"Aggressor Squad":{baseType:"40mm"},Ancient:{baseType:"40mm"},"Ancient in Terminator Armour":{baseType:"40mm"},Apothecary:{baseType:"40mm"},"Apothecary Biologis":{baseType:"40mm"},"Assault Intercessor Squad":{baseType:"32mm"},"Assault Intercessors with Jump Packs":{baseType:"32mm"},"Ballistus Dreadnought":{baseType:"90mm"},"Bladeguard Ancient":{baseType:"40mm"},"Bladeguard Veteran Squad":{baseType:"40mm"},"Brutalis Dreadnought":{baseType:"90mm"},Captain:{baseType:"40mm"},"Captain in Gravis Armour":{baseType:"40mm"},"Captain in Phobos Armour":{baseType:"40mm"},"Captain in Terminator Armour":{baseType:"50mm"},"Captain Sicarius":{baseType:"32mm"},"Captain with Jump Pack":{baseType:"40mm"},"Centurion Assault Squad":{baseType:"50mm"},"Centurion Devastator Squad":{baseType:"50mm"},Chaplain:{baseType:"40mm"},"Chaplain in Terminator Armour":{baseType:"40mm"},"Chaplain on Bike":{baseType:"90x52.5mm"},"Chaplain with Jump Pack":{baseType:"32mm"},"Chief Librarian Tigurius":{baseType:"40mm"},"Company Heroes":{baseType:"40mm"},"Darnath Lysander":{baseType:"50mm"},"Desolation Squad":{baseType:"32mm"},"Devastator Squad":{baseType:"32mm"},Dreadnought:{baseType:"60mm"},"Drop Pod":{baseType:"hull",hullDimensions:{width:0,height:0}},"Eliminator Squad":{baseType:"40mm"},"Eradicator Squad":{baseType:"40mm"},"Firestrike Servo-turrets":{baseType:"80mm"},"Gladiator Lancer":{baseType:"100mm"},"Gladiator Reaper":{baseType:"100mm"},"Gladiator Valiant":{baseType:"100mm"},"Hammerfall Bunker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Heavy Intercessor Squad":{baseType:"40mm"},"Hellblaster Squad":{baseType:"32mm"},Impulsor:{baseType:"100mm"},"Inceptor Squad":{baseType:"40mm"},"Incursor Squad":{baseType:"32mm"},"Infernus Squad":{baseType:"32mm"},"Infiltrator Squad":{baseType:"32mm"},"Intercessor Squad":{baseType:"32mm"},"Invader ATV":{baseType:"hull",hullDimensions:{width:0,height:0}},"Invictor Tactical Warsuit":{baseType:"90mm"},"Iron Father Feirros":{baseType:"40mm"},Judiciar:{baseType:"40mm"},"Kayvaan Shrike":{baseType:"40mm"},"Kor’sarro Khan":{baseType:"40mm"},"Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},Librarian:{baseType:"40mm"},"Librarian in Phobos Armour":{baseType:"40mm"},"Librarian in Terminator Armour":{baseType:"40mm"},Lieutenant:{baseType:"40mm"},"Lieutenant in Phobos Armour":{baseType:"40mm"},"Lieutenant in Reiver Armour":{baseType:"40mm"},"Lieutenant Titus":{baseType:"40mm"},"Lieutenant with Combi-weapon":{baseType:"40mm"},"Marneus Calgar":{baseType:"50mm"},"Marneus Calgar: Victrix Honour Guard":{baseType:"40mm"},"Outrider Squad":{baseType:"90x52.5mm"},"Pedro Kantor":{baseType:"32mm"},"Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},Razorback:{baseType:"hull",hullDimensions:{width:0,height:0}},"Redemptor Dreadnought":{baseType:"90mm"},"Reiver Squad":{baseType:"32mm"},Repulsor:{baseType:"100mm"},"Repulsor Executioner":{baseType:"100mm"},Rhino:{baseType:"hull",hullDimensions:{width:0,height:0}},"Roboute Guilliman":{baseType:"60mm"},"Scout Squad":{baseType:"28.5mm"},"Sternguard Veteran Squad":{baseType:"32mm"},"Storm Speeder Hailstrike":{baseType:"90mm"},"Storm Speeder Hammerstrike":{baseType:"90mm"},"Storm Speeder Thunderstrike":{baseType:"90mm"},"Stormhawk Interceptor":{baseType:"120x92mm"},"Stormraven Gunship":{baseType:"120x92mm"},"Stormtalon Gunship":{baseType:"120x92mm"},"Suppressor Squad":{baseType:"40mm"},"Tactical Squad":{baseType:"32mm"},Techmarine:{baseType:"40mm"},"Terminator Assault Squad":{baseType:"40mm"},"Terminator Squad":{baseType:"40mm"},"Tor Garadon":{baseType:"40mm"},"Uriel Ventris":{baseType:"40mm"},"Vanguard Veteran Squad with Jump Packs":{baseType:"32mm"},Vindicator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Vulkan He’stan":{baseType:"32mm"},Whirlwind:{baseType:"hull",hullDimensions:{width:0,height:0}},Astraeus:{baseType:"hull",hullDimensions:{width:0,height:0}},"Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}}},"SPACE WOLVES":{"Arjac Rockfist":{baseType:"50mm"},"Bjorn the Fell-handed":{baseType:"60mm"},"Blood Claws":{baseType:"32mm"},"Fenrisian Wolves":{baseType:"40mm"},"Grey Hunters":{baseType:"32mm"},"Iron Priest":{baseType:"32mm"},"Logan Grimnar":{baseType:"80mm"},Murderfang:{baseType:"60mm"},"Njal Stormcaller":{baseType:"40mm"},"Ragnar Blackmane":{baseType:"40mm"},"Thunderwolf Cavalry":{baseType:"60mm"},"Ulrik the Slayer":{baseType:"32mm"},"Venerable Dreadnought":{baseType:"60mm"},"Wolf Guard Battle Leader":{baseType:"40mm"},"Wolf Guard Headtakers":{baseType:"40mm"},"Wolf Guard Headtakers: Hunting Wolves":{baseType:"60x35.5mm"},"Wolf Guard Terminators":{baseType:"40mm"},"Wolf Priest":{baseType:"40mm"},Wulfen:{baseType:"40mm"},"Wulfen Dreadnought":{baseType:"60mm"},"Wulfen with Storm Shields":{baseType:"40mm"}},"T’AU EMPIRE":{"Breacher Team":{baseType:"25mm"},"Broadside Battlesuits":{baseType:"60mm"},"Cadre Fireblade":{baseType:"25mm"},"Commander Farsight":{baseType:"60mm"},"Commander in Coldstar Battlesuit":{baseType:"60mm"},"Commander in Enforcer Battlesuit":{baseType:"60mm"},"Commander Shadowsun":{baseType:"50mm"},"Crisis Fireknife Battlesuits":{baseType:"50mm"},"Crisis Starscythe Battlesuits":{baseType:"50mm"},"Crisis Sunforge Battlesuits":{baseType:"50mm"},Darkstrider:{baseType:"32mm"},Devilfish:{baseType:"Large Flying Base"},Ethereal:{baseType:"40mm"},"Firesight Team":{baseType:"40mm"},"Ghostkeel Battlesuit":{baseType:"105x70mm"},"Hammerhead Gunship":{baseType:"Large Flying Base"},"Kroot Carnivores":{baseType:"28.5mm"},"Kroot Farstalkers":{baseType:"28.5mm"},"Kroot Farstalkers: Kroot Kill-broker":{baseType:"32mm"},"Kroot Flesh Shaper":{baseType:"32mm"},"Kroot Hounds":{baseType:"28.5mm"},"Kroot Lone-spear":{baseType:"90x52.5mm"},"Kroot Trail Shaper":{baseType:"32mm"},"Kroot War Shaper":{baseType:"32mm"},"Krootox Rampagers":{baseType:"50mm"},"Krootox Riders":{baseType:"50mm"},"Pathfinder Team":{baseType:"25mm"},Piranhas:{baseType:"Large Flying Base"},"Razorshark Strike Fighter":{baseType:"120x92mm"},"Riptide Battlesuit":{baseType:"120x92mm"},"Sky Ray Gunship":{baseType:"Large Flying Base"},"Stealth Battlesuits":{baseType:"32mm"},Stormsurge:{baseType:"170x109mm"},"Strike Team":{baseType:"25mm"},"Sun Shark Bomber":{baseType:"120x92mm"},"Tidewall Defence Platform":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Droneport":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Gunrig":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Shieldline":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vespid Stingwings":{baseType:"28.5mm"},"AX-1-0 Tiger Shark":{baseType:"160mm"},Manta:{baseType:"hull",hullDimensions:{width:4,height:6}},"Ta’unar Supremacy Armour":{baseType:"160mm"},"Tiger Shark":{baseType:"160mm"}},"THOUSAND SONS":{Ahriman:{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Daemon Prince of Tzeentch":{baseType:"60mm"},"Daemon Prince of Tzeentch with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},"Exalted Sorcerer":{baseType:"32mm"},"Exalted Sorcerer on Disc of Tzeentch":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Infernal Master":{baseType:"40mm"},"Magnus the Red":{baseType:"100mm"},Maulerfiend:{baseType:"120x92mm"},"Mutalith Vortex Beast":{baseType:"120x92mm"},"Rubric Marines":{baseType:"32mm"},"Scarab Occult Terminators":{baseType:"40mm"},"Sekhetar Robots":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Tzaangor Enlightened":{baseType:"40mm"},"Tzaangor Enlightened with Fatecaster Greatbows":{baseType:"40mm"},"Tzaangor Shaman":{baseType:"40mm"},Tzaangors:{baseType:"32mm"},"Blue Horrors":{baseType:"25mm"},Flamers:{baseType:"32mm"},"Kairos Fateweaver":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},"Pink Horrors":{baseType:"32mm"},Screamers:{baseType:"Small Flying Base"}},TYRANIDS:nh,"WORLD EATERS":{Angron:{baseType:"100mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Khorne":{baseType:"60mm"},"Daemon Prince of Khorne with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},Eightbound:{baseType:"40mm"},"Exalted Eightbound":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Goremongers:{baseType:"32mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},Jakhals:{baseType:"28.5mm"},"Jakhals: Dishonoured":{baseType:"40mm"},"Khârn the Betrayer":{baseType:"40mm"},"Khorne Berzerkers":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Invocatus":{baseType:"90x52.5mm"},"Lord on Juggernaut":{baseType:"90x52.5mm"},"Master of Executions":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},Slaughterbound:{baseType:"50mm"},"Terminator Squad":{baseType:"40mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodthirster:{baseType:"120x92mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Skarbrand:{baseType:"100mm"}}};function ah(){return Object.keys(wi)}function fl(t){const n=wi[t];return n?Object.keys(n):[]}function Vs(t,n){const a=wi[t];return a&&a[n]||null}function rh(t,n){const a=t.FACTION_KEYWORD,s=t.UNITS||[],r=[],i=[],l={};for(const m of s){const d=m.name||"",y=jm(m.quantity);let p=Vs(a,d);if(!p){const h=pl(d,a);h&&(p=Vs(a,h))}if(!p){const{faction:h,unitName:f}=oh(d);h&&f&&(p=Vs(h,f))}if(p){l[d]||(l[d]=0),l[d]++;const h=l[d]>1?` #${l[d]}`:"",f=`${d}${h}`,v=sh(p,y,n,f);r.push(...v)}else i.push({id:"unmatched-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),unitName:d,quantity:y,points:m.points,section:m.section})}return{matched:ih(r),unmatched:i}}function sh(t,n,a,s,r){const i=[],l=lh(),c=t.baseType,m=ch(s,c);for(let d=0;d<n;d++){const p={id:mh(),baseType:c,playerId:a,x:0,y:0,rotation:0,unitId:l,unitName:s,name:m,imported:!0,inStaging:!0};c==="hull"&&(p.baseType="rect-custom",p.customWidth=t.hullDimensions?.width||5.5,p.customHeight=t.hullDimensions?.height||3),i.push(p)}return i}function ih(t){const i={};t.forEach(d=>{const y=d.unitId||"ungrouped";i[y]||(i[y]=[]),i[y].push(d)});let l=2,c=2,m=0;for(const d in i){const y=i[d];for(const p of y)p.x=l,p.y=c,l+=2,m++,m>=6&&(l=2,c+=2,m=0);m>0&&(l=2,c+=2,m=0)}return t}function pl(t,n){const a=fl(n);if(!a||a.length===0)return null;const s=rr(t);for(const c of a)if(rr(c)===s)return c;const r=s.replace(/s$/,""),i=s+"s";for(const c of a){const m=rr(c);if(m===r||m===i)return c}for(const c of a){const m=rr(c);if(s.includes(m)||m.includes(s))return c}const l=s.split(/\s+/).filter(c=>c.length>2);if(l.length>0)for(const c of a){const m=rr(c);if(l.every(d=>m.includes(d)))return c}return null}function oh(t){const n=ah(),a=rr(t);for(const s of n){const r=fl(s);if(r){for(const i of r)if(rr(i)===a)return{faction:s,unitName:i}}}for(const s of n){const r=pl(t,s);if(r)return{faction:s,unitName:r}}return{faction:null,unitName:null}}function rr(t){return String(t||"").toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim()}function lh(){return"unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function ch(t,n){if(!t)return"";const a=n.match(/(\d+)mm/),s=a?parseInt(a[1],10):null;return s&&s<50?uh(t):t}function uh(t){return t?t.replace(/\s*#\d+$/,"").split(/\s+/).filter(r=>r.length>0).slice(0,3).map(r=>r[0].toUpperCase()).join(""):""}function mh(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}const pa={battlefield:{fill:"#adbeadff"},terrain:{fill:"rgba(116, 102, 63, 0.71)",stroke:"#8b5a2b",strokeWidth:.15},wall:{fill:"rgba(52, 45, 39, 1)",stroke:"#000000ba",strokeWidth:.15},player1:{fill:"rgba(59, 130, 246, 0.6)",stroke:"#3b82f6",strokeWidth:.12},player2:{fill:"rgba(239, 68, 68, 0.6)",stroke:"#ef4444",strokeWidth:.12},modelName:{fill:"#ffffff",stroke:"#000000",strokeWidth:.05,fontWeight:"bold"},deploymentZone:{fillOpacity:.2,strokeWidth:.2,strokeDasharray:"0.5,0.25"},objective:{primary:{fill:"#9ca3af",stroke:"#000000",strokeWidth:.08},secondary:{fill:"#9ca3af",stroke:"#000000",strokeWidth:.08},controlRadius:{fillOpacity:.15,strokeWidth:.06,strokeDasharray:"0.3,0.15"},centerDot:{fill:"#000000",radius:.15}}},cs={pixelsPerInch:50,pngScale:2,fontSizeMultiplier:{circle:.8,oval:.6,rectangle:.35}};function hh(t){const n=pa.deploymentZone;return`<path
    d="${fr(t.path)}"
    fill="${t.borderColor}"
    fill-opacity="${n.fillOpacity}"
    stroke="${t.borderColor}"
    stroke-width="${n.strokeWidth}"
    stroke-dasharray="${n.strokeDasharray}"
  />`}function dh(t){const n=t.isPrimary?pa.objective.primary:pa.objective.secondary,a=pa.objective.controlRadius,s=pa.objective.centerDot,r=`<circle
    cx="${t.x}"
    cy="${t.y}"
    r="${qs}"
    fill="${n.fill}"
    fill-opacity="${a.fillOpacity}"
    stroke="${n.fill}"
    stroke-width="${a.strokeWidth}"
    stroke-dasharray="${a.strokeDasharray}"
  />`,i=`<circle
    cx="${t.x}"
    cy="${t.y}"
    r="${Fs}"
    fill="${n.fill}"
    stroke="${n.stroke}"
    stroke-width="${n.strokeWidth}"
  />`,l=`<circle
    cx="${t.x}"
    cy="${t.y}"
    r="${s.radius}"
    fill="${s.fill}"
  />`;return r+i+l}function fh(t){const{x:n,y:a,width:s,height:r,rotation:i}=t,l=n+s/2,c=a+r/2,m=pa.terrain;return`<rect
    x="${n}"
    y="${a}"
    width="${s}"
    height="${r}"
    transform="rotate(${i}, ${l}, ${c})"
    fill="${m.fill}"
    stroke="${m.stroke}"
    stroke-width="${m.strokeWidth}"
  />`}function ph(t){const n=ya(t.shape,t.segments),a=vs(n,t.x,t.y,t.rotation);if(a.length===0)return"";const s=a.map((i,l)=>`${l===0?"M":"L"} ${i.x} ${i.y}`).join(" ")+" Z",r=pa.wall;return`<path
    d="${s}"
    fill="${r.fill}"
    stroke="${r.stroke}"
    stroke-width="${r.strokeWidth}"
  />`}function yh(t){const n=pn(t.baseType,t),a=cn(t.baseType),s=Fn(t.baseType),r=t.playerId===1?pa.player1:pa.player2,i=pa.modelName;let l="",c=0;if(s){const d=t.customWidth||0,y=t.customHeight||0,p=t.x,h=t.y;c=Math.min(d,y)*cs.fontSizeMultiplier.rectangle,l=`<g transform="rotate(${t.rotation||0}, ${p}, ${h})">
      <rect
        x="${p-d/2}"
        y="${h-y/2}"
        width="${d}"
        height="${y}"
        fill="${r.fill}"
        stroke="${r.stroke}"
        stroke-width="${r.strokeWidth}"
      />
    </g>`}else if(a){const d=n.width/2,y=n.height/2;c=Math.min(d,y)*cs.fontSizeMultiplier.oval,l=`<g transform="rotate(${t.rotation||0}, ${t.x}, ${t.y})">
      <ellipse
        cx="${t.x}"
        cy="${t.y}"
        rx="${d}"
        ry="${y}"
        fill="${r.fill}"
        stroke="${r.stroke}"
        stroke-width="${r.strokeWidth}"
      />
    </g>`}else{const d=n?.radius||.5;c=d*cs.fontSizeMultiplier.circle,l=`<circle
      cx="${t.x}"
      cy="${t.y}"
      r="${d}"
      fill="${r.fill}"
      stroke="${r.stroke}"
      stroke-width="${r.strokeWidth}"
    />`}let m="";return t.name&&(m=`<text
      x="${t.x}"
      y="${t.y}"
      text-anchor="middle"
      dominant-baseline="middle"
      font-size="${c}"
      font-weight="${i.fontWeight}"
      fill="${i.fill}"
      stroke="${i.stroke}"
      stroke-width="${i.strokeWidth}"
      paint-order="stroke"
    >${vh(t.name)}</text>`),l+m}function vh(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function gh(t,n,a,s=null){const r=et.width,i=et.height,l=pa.battlefield.fill,c=cs.pixelsPerInch,m=t.map(fh).join(`
    `),d=n.map(ph).join(`
    `),y=a.map(yh).join(`
    `),p=s?.zones?s.zones.map(hh).join(`
    `):"",h=s?.objectives?s.objectives.map(dh).join(`
    `):"";return`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${r} ${i}" width="${r*c}" height="${i*c}">
  <!-- Battlefield background -->
  <rect x="0" y="0" width="${r}" height="${i}" fill="${l}" />

  <!-- Deployment zones -->
  <g id="deployment-zones">
    ${p}
  </g>

  <!-- Objectives -->
  <g id="objectives">
    ${h}
  </g>

  <!-- Terrain pieces -->
  <g id="terrains">
    ${m}
  </g>

  <!-- Wall pieces -->
  <g id="walls">
    ${d}
  </g>

  <!-- Model bases -->
  <g id="models">
    ${y}
  </g>
</svg>`}function bh(t,n=1){return new Promise((a,s)=>{const r=new Image,i=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),l=URL.createObjectURL(i);r.onload=()=>{const c=document.createElement("canvas");c.width=r.width*n,c.height=r.height*n;const m=c.getContext("2d");m.scale(n,n),m.drawImage(r,0,0),URL.revokeObjectURL(l),c.toBlob(d=>{d?a(d):s(new Error("Failed to create PNG blob"))},"image/png")},r.onerror=()=>{URL.revokeObjectURL(l),s(new Error("Failed to load SVG image"))},r.src=l})}async function Si(t,n,a=[],s="battlefield",r=null){try{const i=gh(t,n,a,r),l=await bh(i,cs.pngScale),c=URL.createObjectURL(l),m=document.createElement("a");return m.href=c,m.download=`${s}.png`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(c),!0}catch(i){throw console.error("Failed to export PNG:",i),i}}var Th=Se('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),xh=Se('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div> <!>',1),_h=Se('<button class="svelte-1g40uyy">Group (Ctrl+G)</button>'),wh=Se('<button class="svelte-1g40uyy">Ungroup (Ctrl+Shift+G)</button>'),Sh=Se('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Selected</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <!> <!> <button class="danger svelte-1g40uyy"> </button></div>'),Ah=Se('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Rotation</span> <span class="value svelte-1g40uyy"> </span></div>'),Ch=Se('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div>'),kh=Se('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),Mh=Se('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Base Type</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Player</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Position</span> <span class="value svelte-1g40uyy"> </span></div> <!> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-1g40uyy">Remove</button></div>'),Eh=Se('<p class="hint svelte-1g40uyy">Click a model to select it</p>'),Rh=Se('<p class="hint svelte-1g40uyy">Click and drag on battlefield to draw a measurement line</p>'),Dh=Se('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Length</span> <span class="value svelte-1g40uyy"> </span></div> <button class="danger svelte-1g40uyy">Remove Line</button>',1),Ih=Se('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Lines</span> <span class="value svelte-1g40uyy"> </span></div> <button class="secondary svelte-1g40uyy">Clear All Lines</button>',1),Lh=Se('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Line Tool Active (M)</label></div> <!> <!> <!> <div class="field svelte-1g40uyy" style="margin-top: 0.5rem; border-top: 1px solid #333; padding-top: 0.5rem;"><span class="label-text svelte-1g40uyy">Range Zones</span> <label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show 6" zones</label> <label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show 9" zones</label> <label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show 12" zones</label></div></div>'),$h=Se('<div class="button-group vertical svelte-1g40uyy"><div class="button-row svelte-1g40uyy"><button title="Undo (Ctrl+Z)" class="svelte-1g40uyy">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-1g40uyy">Redo</button></div> <div class="button-row svelte-1g40uyy"><button title="Export deployment to share with others" class="svelte-1g40uyy">Export</button> <button title="Import deployment from JSON file" class="svelte-1g40uyy">Import</button></div> <input type="file" accept=".json" style="display: none;"/> <button title="Export battlefield as PNG image" class="svelte-1g40uyy">Export PNG</button> <button class="svelte-1g40uyy">Save to Browser</button> <button class="svelte-1g40uyy">Restore from Browser</button> <button class="secondary svelte-1g40uyy">Clear All Models</button></div>'),Ph=Se('<div class="player-toggle svelte-1g40uyy"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-1g40uyy"><div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Circles</h4> <div class="palette-grid svelte-1g40uyy"></div></div> <div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Ovals</h4> <div class="palette-grid svelte-1g40uyy"></div></div></div>',1),Nh=Se('<div class="rect-hull-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="rect-width" class="svelte-1g40uyy">Width (inches)</label> <input id="rect-width" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <div class="field svelte-1g40uyy"><label for="rect-height" class="svelte-1g40uyy">Height (inches)</label> <input id="rect-height" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <button class="svelte-1g40uyy"> </button></div>'),Oh=le('<path stroke-width="0.10" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),Wh=le('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),Yh=le("<!><!>",1),Hh=le('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),Bh=le('<g opacity="0.5" pointer-events="none"><!></g>'),Fh=le('<g><rect rx="12" ry="12" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></rect></g>'),qh=le('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></ellipse></g>'),Uh=le('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></circle>'),Kh=le('<g><rect rx="9" ry="9" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></rect></g>'),Gh=le('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></ellipse></g>'),zh=le('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></circle>'),Xh=le('<g><rect rx="6" ry="6" fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></rect></g>'),Vh=le('<g><ellipse fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></ellipse></g>'),jh=le('<circle fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></circle>'),Zh=le("<!><!><!>",1),Jh=le('<circle r="0.4" fill="rgba(147, 51, 234, 0.5)" stroke="#9333ea" stroke-width="0.1" pointer-events="none"></circle><line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="group-rotate-handle"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),Qh=le('<circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle><circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle>',1),ed=le('<g><line stroke-linecap="round"></line><!><g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g></g>'),td=le('<g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" fill="#f59e0b" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g>'),nd=le('<g class="measurement-line drawing"><line stroke="#f59e0b" stroke-width="0.15" stroke-dasharray="0.3,0.15" stroke-linecap="round" pointer-events="none"></line><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><!></g>'),ad=le('<line stroke-width="0.05" pointer-events="none"></line>'),rd=le('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),sd=le('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),id=le('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),od=le("<!><!><!><!><!><!><!><!><!><!><!><!><!><!><!>",1),ld=Se('<main class="svelte-1g40uyy"><div class="layout svelte-1g40uyy"><div class="sidebar svelte-1g40uyy"><!> <!> <!> <!> <!> <!></div> <div class="main-content svelte-1g40uyy"><div class="battlefield-area svelte-1g40uyy"><div class="battlefield-container svelte-1g40uyy" role="presentation"><!></div> <div class="info svelte-1g40uyy"><p class="svelte-1g40uyy"> </p> <p class="hint svelte-1g40uyy">Drag to select | Ctrl+Click multi-select | Del remove | 1/2 player | L LoS | M measure</p></div></div></div></div></main> <!>',1);function Vi(t,n){Zn(n,!1);const a=()=>Ht(za,"$selectedDeployment",y),s=()=>Ht(ra,"$selectedLayoutName",y),r=()=>Ht(ha,"$selectedLayoutType",y),i=()=>Ht(at,"$models",y),l=()=>Ht(_i,"$loadedTerrain",y),c=()=>Ht(Cn,"$history",y),m=()=>Ht(cl,"$player1Models",y),d=()=>Ht(ul,"$player2Models",y),[y,p]=Ur(),h=Y(),f=Y(),v=Y(),k=Y(),b=Y(),M=Y(),P=Y(),E=Y(),S=Y(),I=Y(),$=Y(),U=Y(),B=Y(),G=Y();let q=Y(1),ae=Y(null),Q=!1,de=null,re=Y(null),ne=Y(!1),Ee=Y(!1),_e=Y(5.5),xe=Y(3),ee=Y(!1),ke=Y([]),ue=[],ye=Y(null),Ke=Y(!1),ve=Y(null),We=Y(null),me=Y([]),pt=Y(new Set),lt=!1,Pt=!1,yt=null,st=!1,vt=null,ze=0,Zt=null,It=Y([]),Ft=Y(null),Sn=Y(!1),Rt=Y(null),St=Y(null),en=Y(!1),ie=Y(!1),He=Y(!1),tt=Y(!1);const Gt=5,Lt="warhammer-deployment-state";function gt(){const _={deployment:a()?.name||null,layout:s()||null,layoutType:r()||null,models:i()};localStorage.setItem(Lt,JSON.stringify(_))}function tn(){const _=localStorage.getItem(Lt);if(_)try{const O=JSON.parse(_);O.models&&Array.isArray(O.models)&&(at.set(O.models),Cn.clear())}catch(O){console.error("Failed to restore deployment state:",O)}}function En(){const _={version:1,exportedAt:new Date().toISOString(),deployment:a()?{name:a().name,zones:a().zones,objectives:a().objectives}:null,terrain:{layoutName:s(),layoutType:r(),terrains:l().terrains,walls:l().walls},models:i()},O=JSON.stringify(_,null,2),H=new Blob([O],{type:"application/json"}),W=URL.createObjectURL(H),x=document.createElement("a");x.href=W,x.download=`deployment-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(W)}async function sn(){const O=`deployment-${new Date().toISOString().slice(0,10)}`;try{await Si(l().terrains,l().walls,i(),O,a())}catch(H){alert("Failed to export PNG"),console.error("Export error:",H)}}let Wt=Y(null);function yn(){e(Wt)?.click()}function $n(_){const O=_.target.files?.[0];if(!O)return;const H=new FileReader;H.onload=W=>{try{const x=JSON.parse(W.target.result);Wn(x)}catch(x){console.error("Failed to parse import file:",x),alert("Failed to import: Invalid JSON file")}},H.readAsText(O),_.target.value=""}function Wn(_){if(!_.version){alert("Invalid import file: missing version");return}if(_.deployment){const O=nl.find(H=>H.name===_.deployment.name);O?za.set(O):_.deployment.zones&&_.deployment.objectives&&za.set({name:_.deployment.name||"Imported",zones:_.deployment.zones,objectives:_.deployment.objectives})}else za.set(null);if(_.terrain){const{layoutName:O,layoutType:H,terrains:W,walls:x}=_.terrain;if(H==="preset"&&O){if(Ti.find(j=>j.name===O))ra.set(O),ha.set("preset");else if(W||x){const j=`imported-${Date.now()}`,C=localStorage.getItem("warhammer-deployment-layouts"),F=C?JSON.parse(C):{};F[j]={terrains:W||[],walls:x||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(F)),ra.set(j),ha.set("saved")}}else if(H==="saved"&&O){const V=localStorage.getItem("warhammer-deployment-layouts"),j=V?JSON.parse(V):{};j[O]?(ra.set(O),ha.set("saved")):(W||x)&&(j[O]={terrains:W||[],walls:x||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(j)),ra.set(O),ha.set("saved"))}else if(W||x){const V=`imported-${Date.now()}`,j=localStorage.getItem("warhammer-deployment-layouts"),C=j?JSON.parse(j):{};C[V]={terrains:W||[],walls:x||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(C)),ra.set(V),ha.set("saved")}}_.models&&Array.isArray(_.models)&&(at.set(_.models),Cn.clear()),g(me,[])}function De(_,O){const x=O===1?-4:64,V=2;let j=x,C=V,F=0;return _.map(Ae=>{const Le={...Ae,x:j,y:C,inStaging:!1};return C+=2,F++,F>=20&&(C=V,j+=O===1?-2:2,F=0),Le})}async function Be(_){const{text:O,playerId:H}=_.detail;try{e(ye)&&e(ye).setLoading(!0);const{format:W,data:x}=await Xm(O),{matched:V,unmatched:j}=rh(x,H),C=x.LIST_TITLE||`${x.FACTION_KEYWORD} Army`;ii.addImport(C,O,x,H),j.length>0?(g(ke,j),ue=V,g(ee,!0),e(ye)&&e(ye).setLoading(!1)):(De(V,H).forEach(Ae=>{at.update(Le=>[...Le,Ae])}),e(ye)&&(e(ye).setSuccess(`Imported ${V.length} models from ${x.FACTION_KEYWORD} (${W})`),e(ye).clearText()))}catch(W){console.error("Failed to parse army list:",W),e(ye)&&e(ye).setError(W.message||"Failed to parse army list")}}function ct(_){const{selected:O}=_.detail,H=[];for(const V of O){const j=typeof V.quantity=="string"?parseInt(V.quantity.replace(/x/i,""),10)||1:V.quantity||1,C="unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);for(let F=0;F<j;F++)H.push({id:"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),baseType:V.baseType,playerId:e(q),x:0,y:0,rotation:0,unitId:C,unitName:V.unitName,name:V.unitName,imported:!0})}const W=[...ue,...H];De(W,e(q)).forEach(V=>{at.update(j=>[...j,V])}),e(ye)&&(e(ye).setSuccess(`Imported ${W.length} models`),e(ye).clearText()),g(ke,[]),ue=[]}Kr(()=>{window.addEventListener("keydown",zt)}),zo(()=>{window.removeEventListener("keydown",zt)});function zt(_){if(_.target.tagName==="INPUT")return;const O=e(me).length>0;if((_.ctrlKey||_.metaKey)&&_.key==="z"&&!_.shiftKey){_.preventDefault(),at.undo();return}if((_.ctrlKey||_.metaKey)&&(_.key==="y"||_.shiftKey&&_.key==="z")){_.preventDefault(),at.redo();return}if((_.ctrlKey||_.metaKey)&&_.key==="g"&&!_.shiftKey){_.preventDefault(),br();return}if((_.ctrlKey||_.metaKey)&&_.shiftKey&&_.key==="G"){_.preventDefault(),Tr();return}if(_.key==="1"){_.preventDefault(),g(q,1);return}if(_.key==="2"){_.preventDefault(),g(q,2);return}if(_.key==="l"||_.key==="L"){_.preventDefault(),g(ne,!e(ne));return}if(_.key==="m"||_.key==="M"){_.preventDefault(),g(en,!e(en)),e(en)||(g(Sn,!1),g(Rt,null),g(St,null));return}if(_.key==="Delete"||_.key==="Backspace"){if(_.preventDefault(),e(Ft)){g(It,e(It).filter(H=>H.id!==e(Ft))),g(Ft,null);return}e(me).length>0&&(e(me).forEach(H=>{at.remove(H)}),g(me,[]));return}if(O&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(_.key)){_.preventDefault();const H=_.shiftKey?.1:1;let W=0,x=0;switch(_.key){case"ArrowUp":x=-H;break;case"ArrowDown":x=H;break;case"ArrowLeft":W=-H;break;case"ArrowRight":W=H;break}e(me).forEach(V=>{const j=i().find(C=>C.id===V);j&&at.updateModel(V,{x:j.x+W,y:j.y+x},!1)});return}if(_.key==="Escape"){vn();return}}function vn(_){if(lt){lt=!1;return}g(me,[]),g(Ft,null)}function Pn(){return"line-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Xt(_,O,H,W){return Math.sqrt((H-_)**2+(W-O)**2)}function xn(_){if(!e(re))return;_.preventDefault();const O=e(re)(_.clientX,_.clientY);g(Sn,!0),g(Rt,{x:O.x,y:O.y}),g(St,{x:O.x,y:O.y}),window.addEventListener("mousemove",er),window.addEventListener("mouseup",vr)}function er(_){if(!e(Sn)||!e(re))return;const O=e(re)(_.clientX,_.clientY);g(St,{x:O.x,y:O.y})}function vr(_){if(!e(Sn))return;if(Xt(e(Rt).x,e(Rt).y,e(St).x,e(St).y)>.5){const H={id:Pn(),x1:e(Rt).x,y1:e(Rt).y,x2:e(St).x,y2:e(St).y};g(It,[...e(It),H]),g(Ft,H.id),g(me,[])}g(Sn,!1),g(Rt,null),g(St,null),window.removeEventListener("mousemove",er),window.removeEventListener("mouseup",vr)}function tr(_,O){O?.stopPropagation(),g(Ft,_),g(me,[])}let Aa=!1,Ha={x:0,y:0},Ca=null,ga=null;function Gr(_,O){if(!e(en)||!e(re))return;O.stopPropagation(),O.preventDefault();const H=e(It).find(j=>j.id===_);if(!H)return;Aa=!0,Ca=_,ga=null,g(Ft,_),g(me,[]);const W=e(re)(O.clientX,O.clientY),x=(H.x1+H.x2)/2,V=(H.y1+H.y2)/2;Ha={x:W.x-x,y:W.y-V},window.addEventListener("mousemove",Ba),window.addEventListener("mouseup",se)}function gr(_,O,H){!e(en)||!e(re)||(H.stopPropagation(),H.preventDefault(),Aa=!0,Ca=_,ga=O,g(Ft,_),g(me,[]),window.addEventListener("mousemove",Ba),window.addEventListener("mouseup",se))}function Ba(_){if(!Aa||!e(re)||!Ca)return;const O=e(re)(_.clientX,_.clientY);g(It,e(It).map(H=>{if(H.id!==Ca)return H;if(ga===1)return{...H,x1:O.x,y1:O.y};if(ga===2)return{...H,x2:O.x,y2:O.y};{const W=O.x-Ha.x,x=O.y-Ha.y,V=(H.x1+H.x2)/2,j=(H.y1+H.y2)/2,C=W-V,F=x-j;return{...H,x1:H.x1+C,y1:H.y1+F,x2:H.x2+C,y2:H.y2+F}}}))}function se(){Aa=!1,Ca=null,ga=null,window.removeEventListener("mousemove",Ba),window.removeEventListener("mouseup",se)}function Fe(){g(It,[]),g(Ft,null)}function bt(_){const O=_.target,H=O.closest(".model-base"),W=O.closest(".measurement-line");if(H||W||!e(re))return;if(_.preventDefault(),e(en)){xn(_);return}const x=e(re)(_.clientX,_.clientY);g(ve,{x:x.x,y:x.y}),g(We,{x:x.x,y:x.y}),g(Ke,!0),window.addEventListener("mousemove",wt),window.addEventListener("mouseup",Me)}function wt(_){if(!e(Ke)||!e(re))return;const O=e(re)(_.clientX,_.clientY);g(We,{x:O.x,y:O.y});const H=Math.min(e(ve).x,e(We).x),W=Math.max(e(ve).x,e(We).x),x=Math.min(e(ve).y,e(We).y),V=Math.max(e(ve).y,e(We).y),j=new Set;i().forEach(C=>{C.x>=H&&C.x<=W&&C.y>=x&&C.y<=V&&j.add(C.id)}),g(pt,j)}function Me(_){if(!e(Ke))return;const O=Math.min(e(ve).x,e(We).x),H=Math.max(e(ve).x,e(We).x),W=Math.min(e(ve).y,e(We).y),x=Math.max(e(ve).y,e(We).y),V=H-O,j=x-W;if(V<.5&&j<.5)g(me,[]);else{const C=[];i().forEach(F=>{F.x>=O&&F.x<=H&&F.y>=W&&F.y<=x&&C.push(F.id)}),g(me,C),lt=!0}g(Ke,!1),g(ve,null),g(We,null),e(pt).clear(),g(pt,e(pt)),window.removeEventListener("mousemove",wt),window.removeEventListener("mouseup",Me)}function Je(_,O){if(!e(re))return;Q=!0,de={x:O.clientX,y:O.clientY};const H=e(re)(O.clientX,O.clientY);g(ae,{baseType:_.type,x:H.x,y:H.y}),window.addEventListener("mousemove",Ge),window.addEventListener("mouseup",Re)}function Ge(_){if(!Q||!e(ae)||!e(re))return;const O=e(re)(_.clientX,_.clientY);g(ae,{...e(ae),x:O.x,y:O.y})}function Re(_){if(!Q||!e(ae)){Q=!1,g(ae,null),de=null,window.removeEventListener("mousemove",Ge),window.removeEventListener("mouseup",Re);return}const O=_.clientX-de.x,H=_.clientY-de.y,W=Math.sqrt(O*O+H*H);let x,V;W<Gt?(x=30,V=22):(x=e(ae).x,V=e(ae).y);const j=e(ae).customWidth&&e(ae).customHeight?{width:e(ae).customWidth,height:e(ae).customHeight}:null,C=at.add(e(ae).baseType,e(q),x,V,j);g(me,[C]),g(ae,null),Q=!1,de=null,window.removeEventListener("mousemove",Ge),window.removeEventListener("mouseup",Re)}function Pe(){const H={width:e(_e),height:e(xe)},W=at.add("rect-custom",e(q),30,22,H);g(me,[W])}function R(_,O){if(O&&(O.ctrlKey||O.metaKey||O.shiftKey))e(me).includes(_)?g(me,e(me).filter(H=>H!==_)):g(me,[...e(me),_]);else{if(e(me).includes(_))return;{const H=i().find(W=>W.id===_);if(H&&H.unitId){const W=i().filter(x=>x.unitId===H.unitId).map(x=>x.id);g(me,W)}else g(me,[_])}}}function Ze(_,O,H){if(e(me).length>1&&e(me).includes(_)){Pt||(Pt=!0,yt={},e(me).forEach(x=>{const V=i().find(j=>j.id===x);V&&(yt[x]={x:V.x,y:V.y})}));const W=yt[_];if(W){const x=O-W.x,V=H-W.y;e(me).forEach(j=>{const C=yt[j];C&&at.updateModel(j,{x:C.x+x,y:C.y+V},!0)})}}else at.updateModel(_,{x:O,y:H},!0)}function Tt(_,O,H,W,x){Pt?(e(me).forEach(V=>{const j=yt[V],C=i().find(F=>F.id===V);j&&C&&Cn.push({type:"move",modelId:V,before:{x:j.x,y:j.y},after:{x:C.x,y:C.y}})}),Pt=!1,yt=null):Cn.push({type:"move",modelId:_,before:{x:O,y:H},after:{x:W,y:x}})}function ut(_,O){if(e(me).length>1&&e(me).includes(_)){if(!st){st=!0;let V=0,j=0,C=0;const F={};e(me).forEach(Ae=>{const Le=i().find(be=>be.id===Ae);Le&&(V+=Le.x,j+=Le.y,C++,F[Ae]={x:Le.x,y:Le.y,rotation:Le.rotation||0})}),vt={x:V/C,y:j/C},yt=F}const H=i().find(V=>V.id===_),W=yt[_];if(!H||!W)return;const x=O-W.rotation;e(me).forEach(V=>{const j=yt[V];if(j){const C=j.x-vt.x,F=j.y-vt.y,Ae=x*Math.PI/180,Le=Math.cos(Ae),be=Math.sin(Ae),Ne=C*Le-F*be,Qe=C*be+F*Le;at.updateModel(V,{x:vt.x+Ne,y:vt.y+Qe,rotation:j.rotation+x},!0)}})}else at.updateModel(_,{rotation:O},!0)}function rt(_,O,H){st?(e(me).forEach(W=>{const x=yt[W],V=i().find(j=>j.id===W);x&&V&&Cn.push({type:"rotate",modelId:W,before:{x:x.x,y:x.y,rotation:x.rotation},after:{x:V.x,y:V.y,rotation:V.rotation||0}})}),st=!1,vt=null,yt=null):Cn.push({type:"rotate",modelId:_,before:{rotation:O},after:{rotation:H}})}function on(_,O){at.updateModel(_,{name:O})}function br(){if(e(me).length<2)return;const _=e(me).map(H=>i().find(W=>W.id===H)).filter(Boolean);if([...new Set(_.map(H=>H.playerId))].length>1){alert("Cannot group models from different players");return}at.groupModels(e(me))}function Tr(){if(e(me).length===0)return;const _=e(me).filter(O=>{const H=i().find(W=>W.id===O);return H&&H.unitId});_.length>0&&at.ungroupModels(_)}function zr(_){if(!e(re)||e(h).length<2)return;_.preventDefault(),_.stopPropagation(),st=!0,Zt={},e(h).forEach(H=>{Zt[H.id]={x:H.x,y:H.y,rotation:H.rotation||0}});const O=e(re)(_.clientX,_.clientY);ze=Math.atan2(O.y-e(b).y,O.x-e(b).x)*180/Math.PI,window.addEventListener("mousemove",Un),window.addEventListener("mouseup",oa)}function Un(_){if(!st||!e(re)||!e(b))return;const O=e(re)(_.clientX,_.clientY);let W=Math.atan2(O.y-e(b).y,O.x-e(b).x)*180/Math.PI-ze;_.shiftKey||(W=Math.round(W/15)*15),g(J,-45+W);const x=W*Math.PI/180,V=Math.cos(x),j=Math.sin(x);e(h).forEach(C=>{const F=Zt[C.id];if(F){const Ae=F.x-e(b).x,Le=F.y-e(b).y,be=Ae*V-Le*j,Ne=Ae*j+Le*V;at.updateModel(C.id,{x:e(b).x+be,y:e(b).y+Ne,rotation:F.rotation+W},!0)}})}function oa(){st&&Zt&&e(h).forEach(_=>{const O=Zt[_.id];O&&Cn.push({type:"rotate",modelId:_.id,before:{x:O.x,y:O.y,rotation:O.rotation},after:{x:_.x,y:_.y,rotation:_.rotation||0}})}),st=!1,Zt=null,g(J,-45),window.removeEventListener("mousemove",Un),window.removeEventListener("mouseup",oa)}function Kn(){e(me).length>0&&(e(me).forEach(_=>{at.remove(_)}),g(me,[]))}function Xr(){confirm("Clear all models?")&&(at.clear(),g(me,[]))}function xr(_){if(Fn(_.baseType))return{x:_.x,y:_.y,width:_.customWidth,height:_.customHeight,rotation:_.rotation||0,isRectangle:!0};const O=pn(_.baseType,_);return cn(_.baseType)?{x:_.x,y:_.y,rx:O.width/2,ry:O.height/2,rotation:_.rotation||0}:{x:_.x,y:_.y,radius:O.radius}}const D=["#f97316","#f59e0b","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e","#fb7185","#fdba74","#fcd34d"];function K(_){if(!_)return null;let O=0;for(let W=0;W<_.length;W++)O=(O<<5)-O+_.charCodeAt(W),O=O&O;const H=Math.abs(O)%D.length;return console.log(D[H]),D[H]}let J=Y(-45);he(()=>(e(me),i()),()=>{g(h,e(me).map(_=>i().find(O=>O.id===_)).filter(Boolean))}),he(()=>e(h),()=>{g(f,e(h).length===1?e(h)[0]:null)}),he(()=>e(h),()=>{g(v,e(h).length<2?!1:[...new Set(e(h).map(O=>O.playerId))].length===1)}),he(()=>e(h),()=>{g(k,e(h).some(_=>_.unitId))}),he(()=>e(h),()=>{g(b,e(h).length>1?(()=>{let _=0,O=0;return e(h).forEach(H=>{_+=H.x,O+=H.y}),{x:_/e(h).length,y:O/e(h).length}})():null)}),he(()=>(e(h),e(b),cn),()=>{g(M,e(h).length>1?(()=>{let _=0;return e(h).forEach(O=>{const H=Math.sqrt(Math.pow(O.x-e(b).x,2)+Math.pow(O.y-e(b).y,2)),W=pn(O.baseType,O),x=Fn(O.baseType)?Math.max(O.customWidth,O.customHeight)/2:cn(O.baseType)?Math.max(W.width,W.height)/2:W.radius;_=Math.max(_,H+x)}),_+2})():0)}),he(()=>(e(b),e(M),e(J)),()=>{g(P,e(b)?e(b).x+e(M)*Math.cos(e(J)*Math.PI/180):0)}),he(()=>(e(b),e(M),e(J)),()=>{g(E,e(b)?e(b).y+e(M)*Math.sin(e(J)*Math.PI/180):0)}),he(()=>(e(Ft),e(It)),()=>{g(S,e(Ft)?e(It).find(_=>_.id===e(Ft)):null)}),he(()=>e(h),()=>{g(I,[...new Set(e(h).map(_=>_.playerId))])}),he(()=>(e(h),i(),e(I)),()=>{g($,e(h).length>0?i().filter(_=>!e(I).includes(_.playerId)):[])}),he(()=>(l(),dr),()=>{g(U,l().terrains.map(_=>({id:_.id,vertices:dr(_)})))}),he(()=>(l(),ya),()=>{g(B,l().walls.map(_=>vs(ya(_.shape,_.segments),_.x,_.y,_.rotation)))}),he(()=>(e(h),e(ne),e($),e(U),e(B)),()=>{g(G,e(h).length>0&&e(ne)&&e($).length>0?(()=>{const _=new Map;e(h).forEach(W=>{const x=W.unitId||`single-${W.id}`;_.has(x)||_.set(x,[]),_.get(x).push(W)});const O=new Map;e($).forEach(W=>{const x=W.unitId||`single-${W.id}`;O.has(x)||O.set(x,[]),O.get(x).push(W)});const H=[];for(const W of _.values())for(const x of O.values()){const V=x.map(F=>xr(F)),j=W.map(F=>xr(F)),C=Jo(V,j,e(U),e(B));C.canSee?x.forEach(F=>{W.forEach(Ae=>{H.push({sourceId:F.id,source:F,targetId:Ae.id,target:Ae,canSee:!0,firstClearRay:C.firstClearResult?.firstClearRay,rays:C.firstClearResult?.rays||[]})})}):x.forEach(F=>{W.forEach(Ae=>{H.push({sourceId:F.id,source:F,targetId:Ae.id,target:Ae,canSee:!1,firstClearRay:null,rays:[]})})})}return H})():[])}),Ya(),ia();var pe=ld(),ge=ce(pe),Xe=w(ge),$e=w(Xe),Ve=w($e);Ln(Ve,{title:"Selected Model",children:(_,O)=>{var H=qe(),W=ce(H);{var x=j=>{var C=Sh(),F=w(C),Ae=T(w(F),2),Le=w(Ae),be=T(F,2),Ne=w(be),Qe=w(Ne),Dt=T(be,2);{var mt=Ct=>{var Qt=xh(),mn=ce(Qt),$t=w(mn),qt=w($t),_t=T(mn,2);{var Oe=z=>{var Ue=Th(),Ie=T(w(Ue),2),N=w(Ie);X(we=>Ye(N,`${we??""}/${e(G),o(()=>e(G).length)??""} rays visible`),[()=>(e(G),o(()=>e(G).filter(we=>we.canSee).length))]),A(z,Ue)};Z(_t,z=>{e(G),o(()=>e(G).length>0)&&z(Oe)})}_n(qt,()=>e(Ee),z=>g(Ee,z)),A(Ct,Qt)};Z(Dt,Ct=>{e(ne)&&Ct(mt)})}var xt=T(Dt,2);{var At=Ct=>{var Qt=_h();oe("click",Qt,br),A(Ct,Qt)};Z(xt,Ct=>{e(v)&&Ct(At)})}var ln=T(xt,2);{var it=Ct=>{var Qt=wh();oe("click",Qt,Tr),A(Ct,Qt)};Z(ln,Ct=>{e(k)&&Ct(it)})}var Mt=T(ln,2),Jt=w(Mt);X(()=>{Ye(Le,`${e(me),o(()=>e(me).length)??""} models`),Ye(Jt,`Remove All (${e(me),o(()=>e(me).length)??""})`)}),_n(Qe,()=>e(ne),Ct=>g(ne,Ct)),oe("click",Mt,Kn),A(j,C)},V=j=>{var C=qe(),F=ce(C);{var Ae=be=>{var Ne=Mh(),Qe=w(Ne),Dt=T(w(Qe),2),mt=T(Qe,2),xt=T(w(mt),2),At=w(xt),ln=T(mt,2),it=T(w(ln),2),Mt=w(it),Jt=T(ln,2),Ct=T(w(Jt),2),Qt=w(Ct),mn=T(Jt,2);{var $t=ht=>{var Ut=Ah(),ot=T(w(Ut),2),dt=w(ot);X(Et=>Ye(dt,`${Et??""}°`),[()=>(e(f),o(()=>Math.round(e(f).rotation||0)))]),A(ht,Ut)};Z(mn,ht=>{L(cn),e(f),o(()=>cn(e(f).baseType))&&ht($t)})}var qt=T(mn,2),_t=w(qt),Oe=w(_t),z=T(qt,2);{var Ue=ht=>{var Ut=Ch(),ot=w(Ut),dt=w(ot);_n(dt,()=>e(Ee),Et=>g(Ee,Et)),A(ht,Ut)};Z(z,ht=>{e(ne)&&ht(Ue)})}var Ie=T(z,2);{var N=ht=>{var Ut=kh(),ot=T(w(Ut),2),dt=w(ot);X(Et=>Ye(dt,`${Et??""}/${e(G),o(()=>e(G).length)??""} visible`),[()=>(e(G),o(()=>e(G).filter(Et=>Et.canSee).length))]),A(ht,Ut)};Z(Ie,ht=>{e(ne),e(G),o(()=>e(ne)&&e(G).length>0)&&ht(N)})}var we=T(Ie,2);X((ht,Ut,ot)=>{Ko(Dt,(e(f),o(()=>e(f).name||""))),Ye(At,ht),Ye(Mt,`Player ${e(f),o(()=>e(f).playerId)??""}`),Ye(Qt,`${Ut??""}", ${ot??""}"`)},[()=>(L(pn),e(f),o(()=>pn(e(f).baseType,e(f))?.label||"Unknown")),()=>(e(f),o(()=>e(f).x.toFixed(1))),()=>(e(f),o(()=>e(f).y.toFixed(1)))]),oe("change",Dt,ht=>on(e(f).id,ht.target.value)),_n(Oe,()=>e(ne),ht=>g(ne,ht)),oe("click",we,Kn),A(be,Ne)},Le=be=>{var Ne=Eh();A(be,Ne)};Z(F,be=>{e(f)?be(Ae):be(Le,!1)},!0)}A(j,C)};Z(W,j=>{e(me),o(()=>e(me).length>1)?j(x):j(V,!1)})}A(_,H)},$$slots:{default:!0}});var nt=T(Ve,2);Ln(nt,{title:"Measure Tool",children:(_,O)=>{var H=Lh(),W=w(H),x=w(W),V=w(x),j=T(W,2);{var C=it=>{var Mt=Rh();A(it,Mt)};Z(j,it=>{e(en)&&it(C)})}var F=T(j,2);{var Ae=it=>{var Mt=Dh(),Jt=ce(Mt),Ct=T(w(Jt),2),Qt=w(Ct),mn=T(Jt,2);X($t=>Ye(Qt,`${$t??""}"`),[()=>(e(S),o(()=>Xt(e(S).x1,e(S).y1,e(S).x2,e(S).y2).toFixed(2)))]),oe("click",mn,()=>{g(It,e(It).filter($t=>$t.id!==e(Ft))),g(Ft,null)}),A(it,Mt)};Z(F,it=>{e(S)&&it(Ae)})}var Le=T(F,2);{var be=it=>{var Mt=Ih(),Jt=ce(Mt),Ct=T(w(Jt),2),Qt=w(Ct),mn=T(Jt,2);X(()=>Ye(Qt,`${e(It),o(()=>e(It).length)??""} line${e(It),o(()=>e(It).length!==1?"s":"")??""}`)),oe("click",mn,Fe),A(it,Mt)};Z(Le,it=>{e(It),o(()=>e(It).length>0)&&it(be)})}var Ne=T(Le,2),Qe=T(w(Ne),2),Dt=w(Qe),mt=T(Qe,2),xt=w(mt),At=T(mt,2),ln=w(At);_n(V,()=>e(en),it=>g(en,it)),_n(Dt,()=>e(ie),it=>g(ie,it)),_n(xt,()=>e(He),it=>g(He,it)),_n(ln,()=>e(tt),it=>g(tt,it)),A(_,H)},$$slots:{default:!0}});var Yt=T(nt,2);Ln(Yt,{title:"Actions",children:(_,O)=>{var H=$h(),W=w(H),x=w(W),V=T(x,2),j=T(W,2),C=w(j),F=T(C,2),Ae=T(j,2);ms(Ae,Dt=>g(Wt,Dt),()=>e(Wt));var Le=T(Ae,2),be=T(Le,2),Ne=T(be,2),Qe=T(Ne,2);X(()=>{x.disabled=(c(),o(()=>!c().past.length)),V.disabled=(c(),o(()=>!c().future.length))}),oe("click",x,()=>at.undo()),oe("click",V,()=>at.redo()),oe("click",C,En),oe("click",F,yn),oe("change",Ae,$n),oe("click",Le,sn),oe("click",be,gt),oe("click",Ne,tn),oe("click",Qe,Xr),A(_,H)},$$slots:{default:!0}});var Vt=T(Yt,2);Ln(Vt,{title:"Import Army List",startOpen:!1,children:(_,O)=>{ms(Rm(_,{get currentPlayer(){return e(q)},$$events:{parse:Be},$$legacy:!0}),H=>g(ye,H),()=>e(ye))},$$slots:{default:!0}});var nn=T(Vt,2);Ln(nn,{title:"Add Models",children:(_,O)=>{var H=Ph(),W=ce(H),x=w(W);let V;var j=T(x,2);let C;var F=T(W,2),Ae=w(F),Le=T(w(Ae),2);je(Le,5,()=>(L(Vn),o(()=>Vn.circles)),ft,(Qe,Dt)=>{Ns(Qe,{get baseSize(){return e(Dt)},get playerId(){return e(q)},onDragStart:Je})});var be=T(Ae,2),Ne=T(w(be),2);je(Ne,5,()=>(L(Vn),o(()=>Vn.ovals)),ft,(Qe,Dt)=>{Ns(Qe,{get baseSize(){return e(Dt)},get playerId(){return e(q)},onDragStart:Je})}),X(()=>{V=wn(x,1,"toggle-btn svelte-1g40uyy",null,V,{active:e(q)===1}),C=wn(j,1,"toggle-btn svelte-1g40uyy",null,C,{active:e(q)===2})}),oe("click",x,()=>g(q,1)),oe("click",j,()=>g(q,2)),A(_,H)},$$slots:{default:!0}});var un=T(nn,2);Ln(un,{title:"Add Hull (Vehicle)",children:(_,O)=>{var H=Nh(),W=w(H),x=T(w(W),2),V=T(W,2),j=T(w(V),2),C=T(V,2),F=w(C);X(()=>Ye(F,`Add ${e(_e)??""}" × ${e(xe)??""}" Hull`)),ai(x,()=>e(_e),Ae=>g(_e,Ae)),ai(j,()=>e(xe),Ae=>g(xe,Ae)),oe("click",C,Pe),A(_,H)},$$slots:{default:!0}});var Rn=T($e,2),Gn=w(Rn),Yn=w(Gn),la=w(Yn);Us(la,{children:no,$$slots:{default:(_,O)=>{const H=Ce(()=>O.screenToSvg);var W=od(),x=ce(W);{var V=Oe=>{var z=Bo();X(()=>Ye(z,(e(re),L(e(H)),o(()=>(g(re,e(H)),""))))),A(Oe,z)};Z(x,Oe=>{e(H)&&!e(re)&&Oe(V)})}var j=T(x);{var C=Oe=>{var z=Yh(),Ue=ce(z);je(Ue,1,()=>(a(),o(()=>a().zones)),ft,(N,we)=>{var ht=Oh();X(Ut=>{u(ht,"d",Ut),u(ht,"fill",(e(we),o(()=>e(we).color))),u(ht,"stroke",(e(we),o(()=>e(we).borderColor)))},[()=>(L(fr),e(we),o(()=>fr(e(we).path)))]),A(N,ht)});var Ie=T(Ue);je(Ie,1,()=>(a(),o(()=>a().objectives)),ft,(N,we)=>{const ht=Ce(()=>(e(we),o(()=>e(we).isPrimary?"#fbbf24":"#9ca3af"))),Ut=Ce(()=>(e(we),o(()=>e(we).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var ot=Wh(),dt=ce(ot),Et=T(dt),Qn=T(Et);X(()=>{u(dt,"cx",(e(we),o(()=>e(we).x))),u(dt,"cy",(e(we),o(()=>e(we).y))),u(dt,"r",qs),u(dt,"fill",e(Ut)),u(dt,"stroke",e(ht)),u(Et,"cx",(e(we),o(()=>e(we).x))),u(Et,"cy",(e(we),o(()=>e(we).y))),u(Et,"r",Fs),u(Et,"fill",e(ht)),u(Qn,"cx",(e(we),o(()=>e(we).x))),u(Qn,"cy",(e(we),o(()=>e(we).y)))}),A(N,ot)}),A(Oe,z)};Z(j,Oe=>{a()&&Oe(C)})}var F=T(j);Z(F,Oe=>{});var Ae=T(F);Z(Ae,Oe=>{});var Le=T(Ae);je(Le,1,()=>(l(),o(()=>l().terrains)),ft,(Oe,z)=>{var Ue=Hh(),Ie=w(Ue);X(()=>{u(Ue,"transform",`rotate(${e(z),o(()=>e(z).rotation)??""}, ${e(z),o(()=>e(z).x+e(z).width/2)??""}, ${e(z),o(()=>e(z).y+e(z).height/2)??""})`),u(Ie,"x",(e(z),o(()=>e(z).x))),u(Ie,"y",(e(z),o(()=>e(z).y))),u(Ie,"width",(e(z),o(()=>e(z).width))),u(Ie,"height",(e(z),o(()=>e(z).height)))}),A(Oe,Ue)});var be=T(Le);je(be,1,()=>(l(),o(()=>l().walls)),ft,(Oe,z)=>{var Ue=Bh(),Ie=w(Ue);xi(Ie,{get id(){return e(z),o(()=>e(z).id)},get x(){return e(z),o(()=>e(z).x)},get y(){return e(z),o(()=>e(z).y)},get shape(){return e(z),o(()=>e(z).shape)},get segments(){return e(z),o(()=>e(z).segments)},get rotation(){return e(z),o(()=>e(z).rotation)},selected:!1,get screenToSvg(){return e(H)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),A(Oe,Ue)});var Ne=T(be);{var Qe=Oe=>{var z=qe(),Ue=ce(z);je(Ue,1,i,Ie=>Ie.id,(Ie,N)=>{const we=Ce(()=>(L(pn),e(N),o(()=>pn(e(N).baseType,e(N))))),ht=Ce(()=>(L(cn),e(N),o(()=>cn(e(N).baseType)))),Ut=Ce(()=>(L(Fn),e(N),o(()=>Fn(e(N).baseType)))),ot=Ce(()=>(e(N),o(()=>e(N).playerId===1?"rgba(59, 130, 246, 0.15)":"rgba(239, 68, 68, 0.15)"))),dt=Ce(()=>(e(N),o(()=>e(N).playerId===1?"#3b82f6":"#ef4444")));var Et=Zh(),Qn=ce(Et);{var _r=In=>{var ea=qe(),Vr=ce(ea);{var jr=hn=>{var dn=Fh(),an=w(dn);X(()=>{u(dn,"transform",`rotate(${e(N),o(()=>e(N).rotation||0)??""}, ${e(N),o(()=>e(N).x)??""}, ${e(N),o(()=>e(N).y)??""})`),u(an,"x",(e(N),o(()=>e(N).x-e(N).customWidth/2-12))),u(an,"y",(e(N),o(()=>e(N).y-e(N).customHeight/2-12))),u(an,"width",(e(N),o(()=>e(N).customWidth+24))),u(an,"height",(e(N),o(()=>e(N).customHeight+24))),u(an,"fill",e(ot)),u(an,"stroke",e(dt))}),A(hn,dn)},Zr=hn=>{var dn=qe(),an=ce(dn);{var Jr=fn=>{var Nt=qh(),gn=w(Nt);X(()=>{u(Nt,"transform",`rotate(${e(N),o(()=>e(N).rotation||0)??""}, ${e(N),o(()=>e(N).x)??""}, ${e(N),o(()=>e(N).y)??""})`),u(gn,"cx",(e(N),o(()=>e(N).x))),u(gn,"cy",(e(N),o(()=>e(N).y))),u(gn,"rx",(L(e(we)),o(()=>e(we).width/2+12))),u(gn,"ry",(L(e(we)),o(()=>e(we).height/2+12))),u(gn,"fill",e(ot)),u(gn,"stroke",e(dt))}),A(fn,Nt)},Qr=fn=>{var Nt=Uh();X(()=>{u(Nt,"cx",(e(N),o(()=>e(N).x))),u(Nt,"cy",(e(N),o(()=>e(N).y))),u(Nt,"r",(L(e(we)),o(()=>e(we).radius+12))),u(Nt,"fill",e(ot)),u(Nt,"stroke",e(dt))}),A(fn,Nt)};Z(an,fn=>{e(ht)?fn(Jr):fn(Qr,!1)},!0)}A(hn,dn)};Z(Vr,hn=>{e(Ut)?hn(jr):hn(Zr,!1)})}A(In,ea)};Z(Qn,In=>{e(tt)&&In(_r)})}var wr=T(Qn);{var Hn=In=>{var ea=qe(),Vr=ce(ea);{var jr=hn=>{var dn=Kh(),an=w(dn);X(()=>{u(dn,"transform",`rotate(${e(N),o(()=>e(N).rotation||0)??""}, ${e(N),o(()=>e(N).x)??""}, ${e(N),o(()=>e(N).y)??""})`),u(an,"x",(e(N),o(()=>e(N).x-e(N).customWidth/2-9))),u(an,"y",(e(N),o(()=>e(N).y-e(N).customHeight/2-9))),u(an,"width",(e(N),o(()=>e(N).customWidth+18))),u(an,"height",(e(N),o(()=>e(N).customHeight+18))),u(an,"fill",e(ot)),u(an,"stroke",e(dt))}),A(hn,dn)},Zr=hn=>{var dn=qe(),an=ce(dn);{var Jr=fn=>{var Nt=Gh(),gn=w(Nt);X(()=>{u(Nt,"transform",`rotate(${e(N),o(()=>e(N).rotation||0)??""}, ${e(N),o(()=>e(N).x)??""}, ${e(N),o(()=>e(N).y)??""})`),u(gn,"cx",(e(N),o(()=>e(N).x))),u(gn,"cy",(e(N),o(()=>e(N).y))),u(gn,"rx",(L(e(we)),o(()=>e(we).width/2+9))),u(gn,"ry",(L(e(we)),o(()=>e(we).height/2+9))),u(gn,"fill",e(ot)),u(gn,"stroke",e(dt))}),A(fn,Nt)},Qr=fn=>{var Nt=zh();X(()=>{u(Nt,"cx",(e(N),o(()=>e(N).x))),u(Nt,"cy",(e(N),o(()=>e(N).y))),u(Nt,"r",(L(e(we)),o(()=>e(we).radius+9))),u(Nt,"fill",e(ot)),u(Nt,"stroke",e(dt))}),A(fn,Nt)};Z(an,fn=>{e(ht)?fn(Jr):fn(Qr,!1)},!0)}A(hn,dn)};Z(Vr,hn=>{e(Ut)?hn(jr):hn(Zr,!1)})}A(In,ea)};Z(wr,In=>{e(He)&&In(Hn)})}var gs=T(wr);{var nr=In=>{var ea=qe(),Vr=ce(ea);{var jr=hn=>{var dn=Xh(),an=w(dn);X(()=>{u(dn,"transform",`rotate(${e(N),o(()=>e(N).rotation||0)??""}, ${e(N),o(()=>e(N).x)??""}, ${e(N),o(()=>e(N).y)??""})`),u(an,"x",(e(N),o(()=>e(N).x-e(N).customWidth/2-6))),u(an,"y",(e(N),o(()=>e(N).y-e(N).customHeight/2-6))),u(an,"width",(e(N),o(()=>e(N).customWidth+12))),u(an,"height",(e(N),o(()=>e(N).customHeight+12))),u(an,"stroke",e(dt))}),A(hn,dn)},Zr=hn=>{var dn=qe(),an=ce(dn);{var Jr=fn=>{var Nt=Vh(),gn=w(Nt);X(()=>{u(Nt,"transform",`rotate(${e(N),o(()=>e(N).rotation||0)??""}, ${e(N),o(()=>e(N).x)??""}, ${e(N),o(()=>e(N).y)??""})`),u(gn,"cx",(e(N),o(()=>e(N).x))),u(gn,"cy",(e(N),o(()=>e(N).y))),u(gn,"rx",(L(e(we)),o(()=>e(we).width/2+6))),u(gn,"ry",(L(e(we)),o(()=>e(we).height/2+6))),u(gn,"stroke",e(dt))}),A(fn,Nt)},Qr=fn=>{var Nt=jh();X(()=>{u(Nt,"cx",(e(N),o(()=>e(N).x))),u(Nt,"cy",(e(N),o(()=>e(N).y))),u(Nt,"r",(L(e(we)),o(()=>e(we).radius+6))),u(Nt,"stroke",e(dt))}),A(fn,Nt)};Z(an,fn=>{e(ht)?fn(Jr):fn(Qr,!1)},!0)}A(hn,dn)};Z(Vr,hn=>{e(Ut)?hn(jr):hn(Zr,!1)})}A(In,ea)};Z(gs,In=>{e(ie)&&In(nr)})}A(Ie,Et)}),A(Oe,z)};Z(Ne,Oe=>{(e(ie)||e(He)||e(tt))&&Oe(Qe)})}var Dt=T(Ne);je(Dt,1,i,Oe=>Oe.id,(Oe,z)=>{{let Ue=Ce(()=>(e(z),o(()=>e(z).name||""))),Ie=Ce(()=>(e(z),o(()=>K(e(z).unitId)))),N=Ce(()=>(e(me),e(z),o(()=>e(me).includes(e(z).id)))),we=Ce(()=>(e(me),e(z),o(()=>e(me).length>1&&e(me).includes(e(z).id)))),ht=Ce(()=>(e(me),e(z),e(pt),o(()=>!e(me).includes(e(z).id)&&e(pt).has(e(z).id))));Ps(Oe,{get id(){return e(z),o(()=>e(z).id)},get x(){return e(z),o(()=>e(z).x)},get y(){return e(z),o(()=>e(z).y)},get baseType(){return e(z),o(()=>e(z).baseType)},get playerId(){return e(z),o(()=>e(z).playerId)},get rotation(){return e(z),o(()=>e(z).rotation)},get name(){return e(Ue)},get customWidth(){return e(z),o(()=>e(z).customWidth)},get customHeight(){return e(z),o(()=>e(z).customHeight)},get unitStrokeColor(){return e(Ie)},get selected(){return e(N)},get inGroupSelection(){return e(we)},get marqueePreview(){return e(ht)},get screenToSvg(){return e(H)},onSelect:R,onDrag:Ze,onDragEnd:Tt,onRotate:ut,onRotateEnd:rt,onRename:on})}});var mt=T(Dt);{var xt=Oe=>{Ps(Oe,{id:"phantom",get x(){return e(ae),o(()=>e(ae).x)},get y(){return e(ae),o(()=>e(ae).y)},get baseType(){return e(ae),o(()=>e(ae).baseType)},get playerId(){return e(q)},rotation:0,get customWidth(){return e(ae),o(()=>e(ae).customWidth)},get customHeight(){return e(ae),o(()=>e(ae).customHeight)},selected:!1,get screenToSvg(){return e(H)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};Z(mt,Oe=>{e(ae)&&Oe(xt)})}var At=T(mt);{var ln=Oe=>{var z=Jh(),Ue=ce(z),Ie=T(Ue),N=T(Ie),we=T(N);X(()=>{u(Ue,"cx",(e(b),o(()=>e(b).x))),u(Ue,"cy",(e(b),o(()=>e(b).y))),u(Ie,"x1",(e(b),o(()=>e(b).x))),u(Ie,"y1",(e(b),o(()=>e(b).y))),u(Ie,"x2",e(P)),u(Ie,"y2",e(E)),u(N,"cx",e(P)),u(N,"cy",e(E)),u(we,"transform",`translate(${e(P)??""}, ${e(E)??""})`)}),oe("mousedown",N,zr),A(Oe,z)};Z(At,Oe=>{e(b),e(h),o(()=>e(b)&&e(h).length>1)&&Oe(ln)})}var it=T(At);je(it,1,()=>e(It),Oe=>Oe.id,(Oe,z)=>{const Ue=Ce(()=>(e(z),o(()=>Xt(e(z).x1,e(z).y1,e(z).x2,e(z).y2)))),Ie=Ce(()=>(e(z),o(()=>(e(z).x1+e(z).x2)/2))),N=Ce(()=>(e(z),o(()=>(e(z).y1+e(z).y2)/2))),we=Ce(()=>(e(z),e(Ft),o(()=>e(z).id===e(Ft))));var ht=ed();let Ut;var ot=w(ht),dt=T(ot);{var Et=Hn=>{var gs=Qh(),nr=ce(gs),In=T(nr);X(()=>{u(nr,"cx",(e(z),o(()=>e(z).x1))),u(nr,"cy",(e(z),o(()=>e(z).y1))),u(nr,"fill",e(we)?"#3b82f6":"#f59e0b"),u(In,"cx",(e(z),o(()=>e(z).x2))),u(In,"cy",(e(z),o(()=>e(z).y2))),u(In,"fill",e(we)?"#3b82f6":"#f59e0b")}),oe("mousedown",nr,ea=>gr(e(z).id,1,ea)),oe("mousedown",In,ea=>gr(e(z).id,2,ea)),A(Hn,gs)};Z(dt,Hn=>{e(en)&&Hn(Et)})}var Qn=T(dt),_r=T(w(Qn)),wr=w(_r);X(Hn=>{Ut=wn(ht,0,"measurement-line",null,Ut,{selected:e(we),"tool-active":e(en)}),u(ot,"x1",(e(z),o(()=>e(z).x1))),u(ot,"y1",(e(z),o(()=>e(z).y1))),u(ot,"x2",(e(z),o(()=>e(z).x2))),u(ot,"y2",(e(z),o(()=>e(z).y2))),u(ot,"stroke",e(we)&&e(en)?"#3b82f6":"#f59e0b"),u(ot,"stroke-width",e(we)&&e(en)?.2:.15),u(ot,"role",e(en)?"button":"presentation"),u(ot,"tabindex",e(en)?0:-1),u(Qn,"transform",`translate(${e(Ie)??""}, ${e(N)??""})`),u(_r,"fill",e(we)&&e(en)?"#3b82f6":"#f59e0b"),Ye(wr,`${Hn??""}"`)},[()=>(L(e(Ue)),o(()=>e(Ue).toFixed(1)))]),oe("click",ot,Hn=>e(en)&&tr(e(z).id,Hn)),oe("mousedown",ot,Hn=>e(en)?Gr(e(z).id,Hn):Hn.stopPropagation()),A(Oe,ht)});var Mt=T(it);{var Jt=Oe=>{const z=Ce(()=>(e(Rt),e(St),o(()=>Xt(e(Rt).x,e(Rt).y,e(St).x,e(St).y)))),Ue=Ce(()=>(e(Rt),e(St),o(()=>(e(Rt).x+e(St).x)/2))),Ie=Ce(()=>(e(Rt),e(St),o(()=>(e(Rt).y+e(St).y)/2)));var N=nd(),we=w(N),ht=T(we),Ut=T(ht),ot=T(Ut);{var dt=Et=>{var Qn=td(),_r=T(w(Qn)),wr=w(_r);X(Hn=>{u(Qn,"transform",`translate(${e(Ue)??""}, ${e(Ie)??""})`),Ye(wr,`${Hn??""}"`)},[()=>(L(e(z)),o(()=>e(z).toFixed(1)))]),A(Et,Qn)};Z(ot,Et=>{e(z)>.5&&Et(dt)})}X(()=>{u(we,"x1",(e(Rt),o(()=>e(Rt).x))),u(we,"y1",(e(Rt),o(()=>e(Rt).y))),u(we,"x2",(e(St),o(()=>e(St).x))),u(we,"y2",(e(St),o(()=>e(St).y))),u(ht,"cx",(e(Rt),o(()=>e(Rt).x))),u(ht,"cy",(e(Rt),o(()=>e(Rt).y))),u(Ut,"cx",(e(St),o(()=>e(St).x))),u(Ut,"cy",(e(St),o(()=>e(St).y)))}),A(Oe,N)};Z(Mt,Oe=>{e(Sn)&&e(Rt)&&e(St)&&Oe(Jt)})}var Ct=T(Mt);{var Qt=Oe=>{var z=qe(),Ue=ce(z);je(Ue,1,()=>e(G),ft,(Ie,N)=>{var we=qe(),ht=ce(we);je(ht,1,()=>(e(N),o(()=>e(N).rays)),ft,(Ut,ot)=>{var dt=ad();X(()=>{u(dt,"x1",(e(ot),o(()=>e(ot).from.x))),u(dt,"y1",(e(ot),o(()=>e(ot).from.y))),u(dt,"x2",(e(ot),o(()=>e(ot).to.x))),u(dt,"y2",(e(ot),o(()=>e(ot).to.y))),u(dt,"stroke",(e(ot),o(()=>e(ot).blocked?"#ff000033":"#00ff0033")))}),A(Ut,dt)}),A(Ie,we)}),A(Oe,z)};Z(Ct,Oe=>{e(Ee),e(ne),e(h),e(G),o(()=>e(Ee)&&e(ne)&&e(h).length>0&&e(G).length>0)&&Oe(Qt)})}var mn=T(Ct);{var $t=Oe=>{var z=qe(),Ue=ce(z);je(Ue,1,()=>e(G),ft,(Ie,N)=>{var we=qe(),ht=ce(we);{var Ut=dt=>{var Et=rd();X(()=>{u(Et,"x1",(e(N),o(()=>e(N).firstClearRay.from.x))),u(Et,"y1",(e(N),o(()=>e(N).firstClearRay.from.y))),u(Et,"x2",(e(N),o(()=>e(N).firstClearRay.to.x))),u(Et,"y2",(e(N),o(()=>e(N).firstClearRay.to.y)))}),A(dt,Et)},ot=dt=>{var Et=sd();X(()=>{u(Et,"x1",(e(N),o(()=>e(N).source.x))),u(Et,"y1",(e(N),o(()=>e(N).source.y))),u(Et,"x2",(e(N),o(()=>e(N).target.x))),u(Et,"y2",(e(N),o(()=>e(N).target.y)))}),A(dt,Et)};Z(ht,dt=>{e(N),o(()=>e(N).firstClearRay)?dt(Ut):dt(ot,!1)})}A(Ie,we)}),A(Oe,z)};Z(mn,Oe=>{e(ne),e(h),e(G),o(()=>e(ne)&&e(h).length>0&&e(G).length>0)&&Oe($t)})}var qt=T(mn);{var _t=Oe=>{const z=Ce(()=>(e(ve),e(We),o(()=>Math.min(e(ve).x,e(We).x)))),Ue=Ce(()=>(e(ve),e(We),o(()=>Math.min(e(ve).y,e(We).y)))),Ie=Ce(()=>(e(We),e(ve),o(()=>Math.abs(e(We).x-e(ve).x)))),N=Ce(()=>(e(We),e(ve),o(()=>Math.abs(e(We).y-e(ve).y))));var we=id();X(()=>{u(we,"x",e(z)),u(we,"y",e(Ue)),u(we,"width",e(Ie)),u(we,"height",e(N))}),A(Oe,we)};Z(qt,Oe=>{e(Ke)&&e(ve)&&e(We)&&Oe(_t)})}A(_,W)}}});var ka=T(Yn,2),ca=w(ka),jt=w(ca),Dn=T(ge,2);$m(Dn,{get unmatchedUnits(){return e(ke)},get show(){return e(ee)},set show(_){g(ee,_)},$$events:{import:ct,close:()=>{g(ee,!1)}},$$legacy:!0}),X(()=>Ye(jt,`Battlefield: 60" x 44" | ${m(),o(()=>m().length)??""} P1 models | ${d(),o(()=>d().length)??""} P2 models`)),oe("mousedown",Yn,bt),A(t,pe),Jn(),p()}var cd=Se('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">LoS Status</span> <span class="value svelte-hpuhtb"> </span></div>'),ud=Se('<div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Debug Rays</label></div> <!>',1),md=Se('<span class="value warning svelte-hpuhtb">Unit split into groups</span>'),hd=Se('<span class="value warning svelte-hpuhtb"> </span>'),dd=Se('<div class="field coherency-warning svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Coherency</span> <!></div>'),fd=Se('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Coherency</span> <span class="value ok svelte-hpuhtb">All models in coherency</span></div>'),pd=Se('<button class="svelte-hpuhtb">Group (Ctrl+G)</button>'),yd=Se('<button class="svelte-hpuhtb">Ungroup (Ctrl+Shift+G)</button>'),vd=Se('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Selected</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Line of Sight</label></div> <!> <!> <!> <!> <button class="danger svelte-hpuhtb"> </button></div>'),gd=Se('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Rotation</span> <span class="value svelte-hpuhtb"> </span></div>'),bd=Se('<span class="value warning svelte-hpuhtb">Disconnected from unit</span>'),Td=Se('<span class="value warning svelte-hpuhtb"> </span>'),xd=Se('<span class="value ok svelte-hpuhtb">In coherency</span>'),_d=Se('<div><span class="label-text svelte-hpuhtb">Coherency</span> <!></div>'),wd=Se('<div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Debug Rays</label></div>'),Sd=Se('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">LoS Status</span> <span class="value svelte-hpuhtb"> </span></div>'),Ad=Se('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Base Type</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Player</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Position</span> <span class="value svelte-hpuhtb"> </span></div> <!> <!> <div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-hpuhtb">Remove</button></div>'),Cd=Se('<p class="hint svelte-hpuhtb">Click a model to select it</p>'),kd=Se('<p class="hint svelte-hpuhtb">Click and drag on battlefield to draw a measurement line</p>'),Md=Se('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Length</span> <span class="value svelte-hpuhtb"> </span></div> <button class="danger svelte-hpuhtb">Remove Line</button>',1),Ed=Se('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Lines</span> <span class="value svelte-hpuhtb"> </span></div> <button class="secondary svelte-hpuhtb">Clear All Lines</button>',1),Rd=Se('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Line Tool Active (M)</label></div> <!> <!> <!> <div class="field svelte-hpuhtb" style="margin-top: 0.5rem; border-top: 1px solid #333; padding-top: 0.5rem;"><span class="label-text svelte-hpuhtb">Range Zones</span> <label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show 6" zones</label> <label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show 9" zones</label> <label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show 12" zones</label></div></div>'),Dd=Se('<div class="button-group vertical svelte-hpuhtb"><div class="button-row svelte-hpuhtb"><button title="Undo (Ctrl+Z)" class="svelte-hpuhtb">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-hpuhtb">Redo</button></div> <div class="button-row svelte-hpuhtb"><button title="Export battle state to share" class="svelte-hpuhtb">Export</button> <button title="Import battle state from JSON" class="svelte-hpuhtb">Import</button></div> <input type="file" accept=".json" style="display: none;"/> <button title="Export battlefield as PNG image" class="svelte-hpuhtb">Export PNG</button> <button class="svelte-hpuhtb">Save to Browser</button> <button class="svelte-hpuhtb">Restore from Browser</button> <button class="secondary svelte-hpuhtb">Clear All Models</button></div>'),Id=le('<path fill="none" stroke-width="0.15" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),Ld=le('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),$d=le("<!><!>",1),Pd=le('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),Nd=le('<g opacity="0.5" pointer-events="none"><!></g>'),Od=le('<g><rect rx="12" ry="12" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></rect></g>'),Wd=le('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></ellipse></g>'),Yd=le('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.4"></circle>'),Hd=le('<g><rect rx="9" ry="9" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></rect></g>'),Bd=le('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></ellipse></g>'),Fd=le('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></circle>'),qd=le('<g><rect rx="6" ry="6" fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></rect></g>'),Ud=le('<g><ellipse fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></ellipse></g>'),Kd=le('<circle fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></circle>'),Gd=le("<!><!><!>",1),zd=le('<circle r="0.4" fill="rgba(147, 51, 234, 0.5)" stroke="#9333ea" stroke-width="0.1" pointer-events="none"></circle><line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="group-rotate-handle"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),Xd=le('<circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle><circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle>',1),Vd=le('<g><line stroke-linecap="round"></line><!><g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g></g>'),jd=le('<g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" fill="#f59e0b" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g>'),Zd=le('<g class="measurement-line drawing"><line stroke="#f59e0b" stroke-width="0.15" stroke-dasharray="0.3,0.15" stroke-linecap="round" pointer-events="none"></line><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><!></g>'),Jd=le('<line stroke-width="0.05" pointer-events="none"></line>'),Qd=le('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),ef=le('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),tf=le('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),nf=le("<!><!><!><!><!><!><!><!><!><!><!><!>",1),af=Se('<main class="svelte-hpuhtb"><div class="layout svelte-hpuhtb"><div class="sidebar svelte-hpuhtb"><!> <!> <!></div> <div class="main-content svelte-hpuhtb"><div class="battlefield-area svelte-hpuhtb"><div class="battlefield-container svelte-hpuhtb" role="presentation"><!></div> <div class="info svelte-hpuhtb"><p class="svelte-hpuhtb"> </p> <p class="hint svelte-hpuhtb">Drag to select | Ctrl+Click multi-select | Del remove | L LoS | M measure</p></div></div></div></div></main>');function rf(t,n){Zn(n,!1);const a=()=>Ht(_i,"$loadedTerrain",p),s=()=>Ht(at,"$models",p),r=()=>Ht(za,"$selectedDeployment",p),i=()=>Ht(ra,"$selectedLayoutName",p),l=()=>Ht(ha,"$selectedLayoutType",p),c=()=>Ht(bu,"$coherencyStatus",p),m=()=>Ht(Cn,"$history",p),d=()=>Ht(cl,"$player1Models",p),y=()=>Ht(ul,"$player2Models",p),[p,h]=Ur(),f=Y(),v=Y(),k=Y(),b=Y(),M=Y(),P=Y(),E=Y(),S=Y(),I=Y(),$=Y(),U=Y(),B=Y(),G=Y(),q=Y(),ae=Y(),Q=Y();let de=Y(null),re=Y(!1),ne=Y(!1),Ee=Y(!1),_e=Y(null),xe=Y(null),ee=Y([]),ke=Y(new Set),ue=!1,ye=!1,Ke=null,ve=!1,We=null,me=0,pt=null,lt=Y([]),Pt=Y(null),yt=Y(!1),st=Y(null),vt=Y(null),ze=Y(!1),Zt=Y(!1),It=Y(!1),Ft=Y(!1);Kr(()=>{window.addEventListener("keydown",gt)}),zo(()=>{window.removeEventListener("keydown",gt)});async function Sn(){const K=`battle-${new Date().toISOString().slice(0,10)}`;try{await Si(a().terrains,a().walls,s(),K,r())}catch(J){alert("Failed to export PNG"),console.error("Export error:",J)}}const Rt="warhammer-battle-state";let St=Y();function en(){const D={deployment:r()?.name||null,layout:i()||null,layoutType:l()||null,models:s()};localStorage.setItem(Rt,JSON.stringify(D))}function ie(){const D=localStorage.getItem(Rt);if(D)try{const K=JSON.parse(D);K.models&&Array.isArray(K.models)&&(at.set(K.models),Cn.clear())}catch(K){console.error("Failed to restore battle state:",K)}}function He(){const D={version:1,exportedAt:new Date().toISOString(),deployment:r()?{name:r().name,zones:r().zones,objectives:r().objectives}:null,terrain:{layoutName:i(),layoutType:l(),terrains:a().terrains,walls:a().walls},models:s().map($e=>({id:$e.id,baseType:$e.baseType,playerId:$e.playerId,x:$e.x,y:$e.y,rotation:$e.rotation||0,name:$e.name||"",customWidth:$e.customWidth,customHeight:$e.customHeight}))},K=JSON.stringify(D,null,2),J=new Blob([K],{type:"application/json"}),pe=URL.createObjectURL(J),ge=document.createElement("a");ge.href=pe;const Xe=new Date().toISOString().slice(0,10);ge.download=`battle-${Xe}.json`,document.body.appendChild(ge),ge.click(),document.body.removeChild(ge),URL.revokeObjectURL(pe)}function tt(){e(St)?.click()}function Gt(D){const K=D.target.files?.[0];if(!K)return;const J=new FileReader;J.onload=pe=>{try{const ge=JSON.parse(pe.target.result);ge.models&&Array.isArray(ge.models)&&(at.set(ge.models),Cn.clear())}catch(ge){console.error("Failed to parse import file:",ge),alert("Failed to import: Invalid JSON file")}},J.readAsText(K),D.target.value=""}function Lt(){confirm("Clear all models?")&&(at.clear(),g(ee,[]))}function gt(D){if(D.target.tagName==="INPUT")return;const K=e(ee).length>0;if((D.ctrlKey||D.metaKey)&&D.key==="z"&&!D.shiftKey){D.preventDefault(),at.undo();return}if((D.ctrlKey||D.metaKey)&&(D.key==="y"||D.shiftKey&&D.key==="z")){D.preventDefault(),at.redo();return}if((D.ctrlKey||D.metaKey)&&D.key==="g"&&!D.shiftKey){D.preventDefault(),se();return}if((D.ctrlKey||D.metaKey)&&D.shiftKey&&D.key==="G"){D.preventDefault(),Fe();return}if(D.key==="l"||D.key==="L"){D.preventDefault(),g(re,!e(re));return}if(D.key==="m"||D.key==="M"){D.preventDefault(),g(ze,!e(ze)),e(ze)||(g(yt,!1),g(st,null),g(vt,null));return}if(D.key==="Delete"||D.key==="Backspace"){if(D.preventDefault(),e(Pt)){g(lt,e(lt).filter(J=>J.id!==e(Pt))),g(Pt,null);return}e(ee).length>0&&(e(ee).forEach(J=>{at.remove(J)}),g(ee,[]));return}if(K&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(D.key)){D.preventDefault();const J=D.shiftKey?.1:1;let pe=0,ge=0;switch(D.key){case"ArrowUp":ge=-J;break;case"ArrowDown":ge=J;break;case"ArrowLeft":pe=-J;break;case"ArrowRight":pe=J;break}e(ee).forEach(Xe=>{const $e=s().find(Ve=>Ve.id===Xe);$e&&at.updateModel(Xe,{x:$e.x+pe,y:$e.y+ge},!1)});return}if(D.key==="Escape"){tn();return}}function tn(D){if(ue){ue=!1;return}g(ee,[]),g(Pt,null)}function En(){return"line-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function sn(D,K,J,pe){return Math.sqrt((J-D)**2+(pe-K)**2)}function Wt(D){if(!e(de))return;D.preventDefault();const K=e(de)(D.clientX,D.clientY);g(yt,!0),g(st,{x:K.x,y:K.y}),g(vt,{x:K.x,y:K.y}),window.addEventListener("mousemove",yn),window.addEventListener("mouseup",$n)}function yn(D){if(!e(yt)||!e(de))return;const K=e(de)(D.clientX,D.clientY);g(vt,{x:K.x,y:K.y})}function $n(D){if(!e(yt))return;if(sn(e(st).x,e(st).y,e(vt).x,e(vt).y)>.5){const J={id:En(),x1:e(st).x,y1:e(st).y,x2:e(vt).x,y2:e(vt).y};g(lt,[...e(lt),J]),g(Pt,J.id),g(ee,[])}g(yt,!1),g(st,null),g(vt,null),window.removeEventListener("mousemove",yn),window.removeEventListener("mouseup",$n)}function Wn(D,K){K?.stopPropagation(),g(Pt,D),g(ee,[])}let De=!1,Be={x:0,y:0},ct=null,zt=null;function vn(D,K){if(!e(ze)||!e(de))return;K.stopPropagation(),K.preventDefault();const J=e(lt).find($e=>$e.id===D);if(!J)return;De=!0,ct=D,zt=null,g(Pt,D),g(ee,[]);const pe=e(de)(K.clientX,K.clientY),ge=(J.x1+J.x2)/2,Xe=(J.y1+J.y2)/2;Be={x:pe.x-ge,y:pe.y-Xe},window.addEventListener("mousemove",Xt),window.addEventListener("mouseup",xn)}function Pn(D,K,J){!e(ze)||!e(de)||(J.stopPropagation(),J.preventDefault(),De=!0,ct=D,zt=K,g(Pt,D),g(ee,[]),window.addEventListener("mousemove",Xt),window.addEventListener("mouseup",xn))}function Xt(D){if(!De||!e(de)||!ct)return;const K=e(de)(D.clientX,D.clientY);g(lt,e(lt).map(J=>{if(J.id!==ct)return J;if(zt===1)return{...J,x1:K.x,y1:K.y};if(zt===2)return{...J,x2:K.x,y2:K.y};{const pe=K.x-Be.x,ge=K.y-Be.y,Xe=(J.x1+J.x2)/2,$e=(J.y1+J.y2)/2,Ve=pe-Xe,nt=ge-$e;return{...J,x1:J.x1+Ve,y1:J.y1+nt,x2:J.x2+Ve,y2:J.y2+nt}}}))}function xn(){De=!1,ct=null,zt=null,window.removeEventListener("mousemove",Xt),window.removeEventListener("mouseup",xn)}function er(){g(lt,[]),g(Pt,null)}function vr(D){const K=D.target,J=K.closest(".model-base"),pe=K.closest(".measurement-line");if(J||pe||!e(de))return;if(D.preventDefault(),e(ze)){Wt(D);return}const ge=e(de)(D.clientX,D.clientY);g(_e,{x:ge.x,y:ge.y}),g(xe,{x:ge.x,y:ge.y}),g(Ee,!0),window.addEventListener("mousemove",tr),window.addEventListener("mouseup",Aa)}function tr(D){if(!e(Ee)||!e(de))return;const K=e(de)(D.clientX,D.clientY);g(xe,{x:K.x,y:K.y});const J=Math.min(e(_e).x,e(xe).x),pe=Math.max(e(_e).x,e(xe).x),ge=Math.min(e(_e).y,e(xe).y),Xe=Math.max(e(_e).y,e(xe).y),$e=new Set;s().forEach(Ve=>{Ve.x>=J&&Ve.x<=pe&&Ve.y>=ge&&Ve.y<=Xe&&$e.add(Ve.id)}),g(ke,$e)}function Aa(D){if(!e(Ee))return;const K=Math.min(e(_e).x,e(xe).x),J=Math.max(e(_e).x,e(xe).x),pe=Math.min(e(_e).y,e(xe).y),ge=Math.max(e(_e).y,e(xe).y),Xe=J-K,$e=ge-pe;if(Xe<.5&&$e<.5)g(ee,[]);else{const Ve=[];s().forEach(nt=>{nt.x>=K&&nt.x<=J&&nt.y>=pe&&nt.y<=ge&&Ve.push(nt.id)}),g(ee,Ve),ue=!0}g(Ee,!1),g(_e,null),g(xe,null),e(ke).clear(),g(ke,e(ke)),window.removeEventListener("mousemove",tr),window.removeEventListener("mouseup",Aa)}function Ha(D,K){if(K&&(K.ctrlKey||K.metaKey||K.shiftKey))e(ee).includes(D)?g(ee,e(ee).filter(J=>J!==D)):g(ee,[...e(ee),D]);else{if(e(ee).includes(D))return;{const J=s().find(pe=>pe.id===D);if(J&&J.unitId){const pe=s().filter(ge=>ge.unitId===J.unitId).map(ge=>ge.id);g(ee,pe)}else g(ee,[D])}}}function Ca(D,K,J){if(e(ee).length>1&&e(ee).includes(D)){ye||(ye=!0,Ke={},e(ee).forEach(ge=>{const Xe=s().find($e=>$e.id===ge);Xe&&(Ke[ge]={x:Xe.x,y:Xe.y})}));const pe=Ke[D];if(pe){const ge=K-pe.x,Xe=J-pe.y;e(ee).forEach($e=>{const Ve=Ke[$e];Ve&&at.updateModel($e,{x:Ve.x+ge,y:Ve.y+Xe},!0)})}}else at.updateModel(D,{x:K,y:J},!0)}function ga(D,K,J,pe,ge){ye?(e(ee).forEach(Xe=>{const $e=Ke[Xe],Ve=s().find(nt=>nt.id===Xe);$e&&Ve&&Cn.push({type:"move",modelId:Xe,before:{x:$e.x,y:$e.y},after:{x:Ve.x,y:Ve.y}})}),ye=!1,Ke=null):Cn.push({type:"move",modelId:D,before:{x:K,y:J},after:{x:pe,y:ge}})}function Gr(D,K){if(e(ee).length>1&&e(ee).includes(D)){if(!ve){ve=!0;let Xe=0,$e=0,Ve=0;const nt={};e(ee).forEach(Yt=>{const Vt=s().find(nn=>nn.id===Yt);Vt&&(Xe+=Vt.x,$e+=Vt.y,Ve++,nt[Yt]={x:Vt.x,y:Vt.y,rotation:Vt.rotation||0})}),We={x:Xe/Ve,y:$e/Ve},Ke=nt}const J=s().find(Xe=>Xe.id===D),pe=Ke[D];if(!J||!pe)return;const ge=K-pe.rotation;e(ee).forEach(Xe=>{const $e=Ke[Xe];if($e){const Ve=$e.x-We.x,nt=$e.y-We.y,Yt=ge*Math.PI/180,Vt=Math.cos(Yt),nn=Math.sin(Yt),un=Ve*Vt-nt*nn,Rn=Ve*nn+nt*Vt;at.updateModel(Xe,{x:We.x+un,y:We.y+Rn,rotation:$e.rotation+ge},!0)}})}else at.updateModel(D,{rotation:K},!0)}function gr(D,K,J){ve?(e(ee).forEach(pe=>{const ge=Ke[pe],Xe=s().find($e=>$e.id===pe);ge&&Xe&&Cn.push({type:"rotate",modelId:pe,before:{x:ge.x,y:ge.y,rotation:ge.rotation},after:{x:Xe.x,y:Xe.y,rotation:Xe.rotation||0}})}),ve=!1,We=null,Ke=null):Cn.push({type:"rotate",modelId:D,before:{rotation:K},after:{rotation:J}})}function Ba(D,K){at.updateModel(D,{name:K})}function se(){if(e(ee).length<2)return;const D=e(ee).map(J=>s().find(pe=>pe.id===J)).filter(Boolean);if([...new Set(D.map(J=>J.playerId))].length>1){alert("Cannot group models from different players");return}at.groupModels(e(ee))}function Fe(){if(e(ee).length===0)return;const D=e(ee).filter(K=>{const J=s().find(pe=>pe.id===K);return J&&J.unitId});D.length>0&&at.ungroupModels(D)}function bt(D){if(!e(de)||e(f).length<2)return;D.preventDefault(),D.stopPropagation(),ve=!0,pt={},e(f).forEach(J=>{pt[J.id]={x:J.x,y:J.y,rotation:J.rotation||0}});const K=e(de)(D.clientX,D.clientY);me=Math.atan2(K.y-e(E).y,K.x-e(E).x)*180/Math.PI,window.addEventListener("mousemove",wt),window.addEventListener("mouseup",Me)}function wt(D){if(!ve||!e(de)||!e(E))return;const K=e(de)(D.clientX,D.clientY);let pe=Math.atan2(K.y-e(E).y,K.x-e(E).x)*180/Math.PI-me;D.shiftKey||(pe=Math.round(pe/15)*15),g(R,-45+pe);const ge=pe*Math.PI/180,Xe=Math.cos(ge),$e=Math.sin(ge);e(f).forEach(Ve=>{const nt=pt[Ve.id];if(nt){const Yt=nt.x-e(E).x,Vt=nt.y-e(E).y,nn=Yt*Xe-Vt*$e,un=Yt*$e+Vt*Xe;at.updateModel(Ve.id,{x:e(E).x+nn,y:e(E).y+un,rotation:nt.rotation+pe},!0)}})}function Me(){ve&&pt&&e(f).forEach(D=>{const K=pt[D.id];K&&Cn.push({type:"rotate",modelId:D.id,before:{x:K.x,y:K.y,rotation:K.rotation},after:{x:D.x,y:D.y,rotation:D.rotation||0}})}),ve=!1,pt=null,g(R,-45),window.removeEventListener("mousemove",wt),window.removeEventListener("mouseup",Me)}function Je(){e(ee).length>0&&(e(ee).forEach(D=>{at.remove(D)}),g(ee,[]))}function Ge(D){if(Fn(D.baseType))return{x:D.x,y:D.y,width:D.customWidth,height:D.customHeight,rotation:D.rotation||0,isRectangle:!0};const K=pn(D.baseType,D);return cn(D.baseType)?{x:D.x,y:D.y,rx:K.width/2,ry:K.height/2,rotation:D.rotation||0}:{x:D.x,y:D.y,radius:K.radius}}const Re=["#f97316","#f59e0b","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e","#fb7185","#fdba74","#fcd34d"];function Pe(D){if(!D)return null;let K=0;for(let pe=0;pe<D.length;pe++)K=(K<<5)-K+D.charCodeAt(pe),K=K&K;const J=Math.abs(K)%Re.length;return Re[J]}let R=Y(-45);he(()=>(e(ee),s()),()=>{g(f,e(ee).map(D=>s().find(K=>K.id===D)).filter(Boolean))}),he(()=>e(f),()=>{g(v,e(f).length===1?e(f)[0]:null)}),he(()=>e(f),()=>{g(k,e(f).length<2?!1:[...new Set(e(f).map(K=>K.playerId))].length===1)}),he(()=>e(f),()=>{g(b,e(f).some(D=>D.unitId))}),he(()=>(e(f),c()),()=>{g(M,e(f).filter(D=>{const K=c().get(D.id);return K&&!K.inCoherency}))}),he(()=>e(M),()=>{g(P,e(M).length>0)}),he(()=>e(f),()=>{g(E,e(f).length>1?(()=>{let D=0,K=0;return e(f).forEach(J=>{D+=J.x,K+=J.y}),{x:D/e(f).length,y:K/e(f).length}})():null)}),he(()=>(e(f),e(E),cn),()=>{g(S,e(f).length>1?(()=>{let D=0;return e(f).forEach(K=>{const J=Math.sqrt(Math.pow(K.x-e(E).x,2)+Math.pow(K.y-e(E).y,2)),pe=pn(K.baseType,K),ge=Fn(K.baseType)?Math.max(K.customWidth,K.customHeight)/2:cn(K.baseType)?Math.max(pe.width,pe.height)/2:pe.radius;D=Math.max(D,J+ge)}),D+2})():0)}),he(()=>(e(E),e(S),e(R)),()=>{g(I,e(E)?e(E).x+e(S)*Math.cos(e(R)*Math.PI/180):0)}),he(()=>(e(E),e(S),e(R)),()=>{g($,e(E)?e(E).y+e(S)*Math.sin(e(R)*Math.PI/180):0)}),he(()=>(e(Pt),e(lt)),()=>{g(U,e(Pt)?e(lt).find(D=>D.id===e(Pt)):null)}),he(()=>e(f),()=>{g(B,[...new Set(e(f).map(D=>D.playerId))])}),he(()=>(e(f),s(),e(B)),()=>{g(G,e(f).length>0?s().filter(D=>!e(B).includes(D.playerId)):[])}),he(()=>(a(),dr),()=>{g(q,a().terrains.map(D=>({id:D.id,vertices:dr(D)})))}),he(()=>(a(),ya),()=>{g(ae,a().walls.map(D=>vs(ya(D.shape,D.segments),D.x,D.y,D.rotation)))}),he(()=>(e(f),e(re),e(G),e(q),e(ae)),()=>{g(Q,e(f).length>0&&e(re)&&e(G).length>0?(()=>{const D=new Map;e(f).forEach(pe=>{const ge=pe.unitId||`single-${pe.id}`;D.has(ge)||D.set(ge,[]),D.get(ge).push(pe)});const K=new Map;e(G).forEach(pe=>{const ge=pe.unitId||`single-${pe.id}`;K.has(ge)||K.set(ge,[]),K.get(ge).push(pe)});const J=[];for(const pe of D.values())for(const ge of K.values()){const Xe=ge.map(nt=>Ge(nt)),$e=pe.map(nt=>Ge(nt)),Ve=Jo(Xe,$e,e(q),e(ae));Ve.canSee?ge.forEach(nt=>{pe.forEach(Yt=>{J.push({sourceId:nt.id,source:nt,targetId:Yt.id,target:Yt,canSee:!0,firstClearRay:Ve.firstClearResult?.firstClearRay,rays:Ve.firstClearResult?.rays||[]})})}):ge.forEach(nt=>{pe.forEach(Yt=>{J.push({sourceId:nt.id,source:nt,targetId:Yt.id,target:Yt,canSee:!1,firstClearRay:null,rays:[]})})})}return J})():[])}),Ya(),ia();var Ze=af(),Tt=w(Ze),ut=w(Tt),rt=w(ut);Ln(rt,{title:"Selected Model",children:(D,K)=>{var J=qe(),pe=ce(J);{var ge=$e=>{var Ve=vd(),nt=w(Ve),Yt=T(w(nt),2),Vt=w(Yt),nn=T(nt,2),un=w(nn),Rn=w(un),Gn=T(nn,2);{var Yn=x=>{var V=ud(),j=ce(V),C=w(j),F=w(C),Ae=T(j,2);{var Le=be=>{var Ne=cd(),Qe=T(w(Ne),2),Dt=w(Qe);X(mt=>Ye(Dt,`${mt??""}/${e(Q),o(()=>e(Q).length)??""} visible`),[()=>(e(Q),o(()=>e(Q).filter(mt=>mt.canSee).length))]),A(be,Ne)};Z(Ae,be=>{e(Q),o(()=>e(Q).length>0)&&be(Le)})}_n(F,()=>e(ne),be=>g(ne,be)),A(x,V)};Z(Gn,x=>{e(re)&&x(Yn)})}var la=T(Gn,2);{var ka=x=>{const V=Ce(()=>(e(M),c(),o(()=>e(M).filter(Le=>c().get(Le.id)?.isDisconnected).length)));var j=dd(),C=T(w(j),2);{var F=Le=>{var be=md();A(Le,be)},Ae=Le=>{var be=hd(),Ne=w(be);X(()=>Ye(Ne,`${e(M),o(()=>e(M).length)??""} model${e(M),o(()=>e(M).length!==1?"s":"")??""} out of coherency`)),A(Le,be)};Z(C,Le=>{e(V)>0?Le(F):Le(Ae,!1)})}A(x,j)},ca=x=>{var V=qe(),j=ce(V);{var C=F=>{var Ae=fd();A(F,Ae)};Z(j,F=>{e(f),o(()=>e(f).some(Ae=>Ae.unitId))&&F(C)},!0)}A(x,V)};Z(la,x=>{e(P)?x(ka):x(ca,!1)})}var jt=T(la,2);{var Dn=x=>{var V=pd();oe("click",V,se),A(x,V)};Z(jt,x=>{e(k)&&x(Dn)})}var _=T(jt,2);{var O=x=>{var V=yd();oe("click",V,Fe),A(x,V)};Z(_,x=>{e(b)&&x(O)})}var H=T(_,2),W=w(H);X(()=>{Ye(Vt,`${e(ee),o(()=>e(ee).length)??""} models`),Ye(W,`Remove All (${e(ee),o(()=>e(ee).length)??""})`)}),_n(Rn,()=>e(re),x=>g(re,x)),oe("click",H,Je),A($e,Ve)},Xe=$e=>{var Ve=qe(),nt=ce(Ve);{var Yt=nn=>{var un=Ad(),Rn=w(un),Gn=T(w(Rn),2),Yn=T(Rn,2),la=T(w(Yn),2),ka=w(la),ca=T(Yn,2),jt=T(w(ca),2),Dn=w(jt),_=T(ca,2),O=T(w(_),2),H=w(O),W=T(_,2);{var x=mt=>{var xt=gd(),At=T(w(xt),2),ln=w(At);X(it=>Ye(ln,`${it??""}°`),[()=>(e(v),o(()=>Math.round(e(v).rotation||0)))]),A(mt,xt)};Z(W,mt=>{L(cn),e(v),o(()=>cn(e(v).baseType))&&mt(x)})}var V=T(W,2);{var j=mt=>{const xt=Ce(()=>(c(),e(v),o(()=>c().get(e(v).id))));var At=_d();let ln;var it=T(w(At),2);{var Mt=Ct=>{var Qt=qe(),mn=ce(Qt);{var $t=_t=>{var Oe=bd();A(_t,Oe)},qt=_t=>{var Oe=Td(),z=w(Oe);X(()=>Ye(z,`Need ${L(e(xt)),o(()=>e(xt).requiredCount)??""} nearby, have ${L(e(xt)),o(()=>e(xt).actualCount)??""}`)),A(_t,Oe)};Z(mn,_t=>{L(e(xt)),o(()=>e(xt).isDisconnected)?_t($t):_t(qt,!1)})}A(Ct,Qt)},Jt=Ct=>{var Qt=xd();A(Ct,Qt)};Z(it,Ct=>{L(e(xt)),o(()=>e(xt)&&!e(xt).inCoherency)?Ct(Mt):Ct(Jt,!1)})}X(()=>ln=wn(At,1,"field svelte-hpuhtb",null,ln,{"coherency-warning":e(xt)&&!e(xt).inCoherency})),A(mt,At)};Z(V,mt=>{e(v),o(()=>e(v).unitId)&&mt(j)})}var C=T(V,2),F=w(C),Ae=w(F),Le=T(C,2);{var be=mt=>{var xt=wd(),At=w(xt),ln=w(At);_n(ln,()=>e(ne),it=>g(ne,it)),A(mt,xt)};Z(Le,mt=>{e(re)&&mt(be)})}var Ne=T(Le,2);{var Qe=mt=>{var xt=Sd(),At=T(w(xt),2),ln=w(At);X(it=>Ye(ln,`${it??""}/${e(Q),o(()=>e(Q).length)??""} visible`),[()=>(e(Q),o(()=>e(Q).filter(it=>it.canSee).length))]),A(mt,xt)};Z(Ne,mt=>{e(re),e(Q),o(()=>e(re)&&e(Q).length>0)&&mt(Qe)})}var Dt=T(Ne,2);X((mt,xt,At)=>{Ko(Gn,(e(v),o(()=>e(v).name||""))),Ye(ka,mt),Ye(Dn,`Player ${e(v),o(()=>e(v).playerId)??""}`),Ye(H,`${xt??""}", ${At??""}"`)},[()=>(L(pn),e(v),o(()=>pn(e(v).baseType,e(v))?.label||"Unknown")),()=>(e(v),o(()=>e(v).x.toFixed(1))),()=>(e(v),o(()=>e(v).y.toFixed(1)))]),oe("change",Gn,mt=>Ba(e(v).id,mt.target.value)),_n(Ae,()=>e(re),mt=>g(re,mt)),oe("click",Dt,Je),A(nn,un)},Vt=nn=>{var un=Cd();A(nn,un)};Z(nt,nn=>{e(v)?nn(Yt):nn(Vt,!1)},!0)}A($e,Ve)};Z(pe,$e=>{e(ee),o(()=>e(ee).length>1)?$e(ge):$e(Xe,!1)})}A(D,J)},$$slots:{default:!0}});var on=T(rt,2);Ln(on,{title:"Measure Tool",children:(D,K)=>{var J=Rd(),pe=w(J),ge=w(pe),Xe=w(ge),$e=T(pe,2);{var Ve=jt=>{var Dn=kd();A(jt,Dn)};Z($e,jt=>{e(ze)&&jt(Ve)})}var nt=T($e,2);{var Yt=jt=>{var Dn=Md(),_=ce(Dn),O=T(w(_),2),H=w(O),W=T(_,2);X(x=>Ye(H,`${x??""}"`),[()=>(e(U),o(()=>sn(e(U).x1,e(U).y1,e(U).x2,e(U).y2).toFixed(2)))]),oe("click",W,()=>{g(lt,e(lt).filter(x=>x.id!==e(Pt))),g(Pt,null)}),A(jt,Dn)};Z(nt,jt=>{e(U)&&jt(Yt)})}var Vt=T(nt,2);{var nn=jt=>{var Dn=Ed(),_=ce(Dn),O=T(w(_),2),H=w(O),W=T(_,2);X(()=>Ye(H,`${e(lt),o(()=>e(lt).length)??""} line${e(lt),o(()=>e(lt).length!==1?"s":"")??""}`)),oe("click",W,er),A(jt,Dn)};Z(Vt,jt=>{e(lt),o(()=>e(lt).length>0)&&jt(nn)})}var un=T(Vt,2),Rn=T(w(un),2),Gn=w(Rn),Yn=T(Rn,2),la=w(Yn),ka=T(Yn,2),ca=w(ka);_n(Xe,()=>e(ze),jt=>g(ze,jt)),_n(Gn,()=>e(Zt),jt=>g(Zt,jt)),_n(la,()=>e(It),jt=>g(It,jt)),_n(ca,()=>e(Ft),jt=>g(Ft,jt)),A(D,J)},$$slots:{default:!0}});var br=T(on,2);Ln(br,{title:"Actions",children:(D,K)=>{var J=Dd(),pe=w(J),ge=w(pe),Xe=T(ge,2),$e=T(pe,2),Ve=w($e),nt=T(Ve,2),Yt=T($e,2);ms(Yt,Gn=>g(St,Gn),()=>e(St));var Vt=T(Yt,2),nn=T(Vt,2),un=T(nn,2),Rn=T(un,2);X(()=>{ge.disabled=(m(),o(()=>!m().past.length)),Xe.disabled=(m(),o(()=>!m().future.length))}),oe("click",ge,()=>at.undo()),oe("click",Xe,()=>at.redo()),oe("click",Ve,He),oe("click",nt,tt),oe("change",Yt,Gt),oe("click",Vt,Sn),oe("click",nn,en),oe("click",un,ie),oe("click",Rn,Lt),A(D,J)},$$slots:{default:!0}});var Tr=T(ut,2),zr=w(Tr),Un=w(zr),oa=w(Un);Us(oa,{children:no,$$slots:{default:(D,K)=>{const J=Ce(()=>K.screenToSvg);var pe=nf(),ge=ce(pe);{var Xe=W=>{var x=Bo();X(()=>Ye(x,(e(de),L(e(J)),o(()=>(g(de,e(J)),""))))),A(W,x)};Z(ge,W=>{e(J)&&!e(de)&&W(Xe)})}var $e=T(ge);{var Ve=W=>{var x=$d(),V=ce(x);je(V,1,()=>(r(),o(()=>r().zones)),ft,(C,F)=>{var Ae=Id();X(Le=>{u(Ae,"d",Le),u(Ae,"stroke",(e(F),o(()=>e(F).borderColor)))},[()=>(L(fr),e(F),o(()=>fr(e(F).path)))]),A(C,Ae)});var j=T(V);je(j,1,()=>(r(),o(()=>r().objectives)),ft,(C,F)=>{const Ae=Ce(()=>(e(F),o(()=>e(F).isPrimary?"#fbbf24":"#9ca3af"))),Le=Ce(()=>(e(F),o(()=>e(F).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var be=Ld(),Ne=ce(be),Qe=T(Ne),Dt=T(Qe);X(()=>{u(Ne,"cx",(e(F),o(()=>e(F).x))),u(Ne,"cy",(e(F),o(()=>e(F).y))),u(Ne,"r",qs),u(Ne,"fill",e(Le)),u(Ne,"stroke",e(Ae)),u(Qe,"cx",(e(F),o(()=>e(F).x))),u(Qe,"cy",(e(F),o(()=>e(F).y))),u(Qe,"r",Fs),u(Qe,"fill",e(Ae)),u(Dt,"cx",(e(F),o(()=>e(F).x))),u(Dt,"cy",(e(F),o(()=>e(F).y)))}),A(C,be)}),A(W,x)};Z($e,W=>{r()&&W(Ve)})}var nt=T($e);je(nt,1,()=>(a(),o(()=>a().terrains)),ft,(W,x)=>{var V=Pd(),j=w(V);X(()=>{u(V,"transform",`rotate(${e(x),o(()=>e(x).rotation)??""}, ${e(x),o(()=>e(x).x+e(x).width/2)??""}, ${e(x),o(()=>e(x).y+e(x).height/2)??""})`),u(j,"x",(e(x),o(()=>e(x).x))),u(j,"y",(e(x),o(()=>e(x).y))),u(j,"width",(e(x),o(()=>e(x).width))),u(j,"height",(e(x),o(()=>e(x).height)))}),A(W,V)});var Yt=T(nt);je(Yt,1,()=>(a(),o(()=>a().walls)),ft,(W,x)=>{var V=Nd(),j=w(V);xi(j,{get id(){return e(x),o(()=>e(x).id)},get x(){return e(x),o(()=>e(x).x)},get y(){return e(x),o(()=>e(x).y)},get shape(){return e(x),o(()=>e(x).shape)},get segments(){return e(x),o(()=>e(x).segments)},get rotation(){return e(x),o(()=>e(x).rotation)},selected:!1,get screenToSvg(){return e(J)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),A(W,V)});var Vt=T(Yt);{var nn=W=>{var x=qe(),V=ce(x);je(V,1,s,j=>j.id,(j,C)=>{const F=Ce(()=>(L(pn),e(C),o(()=>pn(e(C).baseType,e(C))))),Ae=Ce(()=>(L(cn),e(C),o(()=>cn(e(C).baseType)))),Le=Ce(()=>(L(Fn),e(C),o(()=>Fn(e(C).baseType)))),be=Ce(()=>(e(C),o(()=>e(C).playerId===1?"rgba(59, 130, 246, 0.15)":"rgba(239, 68, 68, 0.15)"))),Ne=Ce(()=>(e(C),o(()=>e(C).playerId===1?"#3b82f6":"#ef4444")));var Qe=Gd(),Dt=ce(Qe);{var mt=Mt=>{var Jt=qe(),Ct=ce(Jt);{var Qt=$t=>{var qt=Od(),_t=w(qt);X(()=>{u(qt,"transform",`rotate(${e(C),o(()=>e(C).rotation||0)??""}, ${e(C),o(()=>e(C).x)??""}, ${e(C),o(()=>e(C).y)??""})`),u(_t,"x",(e(C),o(()=>e(C).x-e(C).customWidth/2-12))),u(_t,"y",(e(C),o(()=>e(C).y-e(C).customHeight/2-12))),u(_t,"width",(e(C),o(()=>e(C).customWidth+24))),u(_t,"height",(e(C),o(()=>e(C).customHeight+24))),u(_t,"fill",e(be)),u(_t,"stroke",e(Ne))}),A($t,qt)},mn=$t=>{var qt=qe(),_t=ce(qt);{var Oe=Ue=>{var Ie=Wd(),N=w(Ie);X(()=>{u(Ie,"transform",`rotate(${e(C),o(()=>e(C).rotation||0)??""}, ${e(C),o(()=>e(C).x)??""}, ${e(C),o(()=>e(C).y)??""})`),u(N,"cx",(e(C),o(()=>e(C).x))),u(N,"cy",(e(C),o(()=>e(C).y))),u(N,"rx",(L(e(F)),o(()=>e(F).width/2+12))),u(N,"ry",(L(e(F)),o(()=>e(F).height/2+12))),u(N,"fill",e(be)),u(N,"stroke",e(Ne))}),A(Ue,Ie)},z=Ue=>{var Ie=Yd();X(()=>{u(Ie,"cx",(e(C),o(()=>e(C).x))),u(Ie,"cy",(e(C),o(()=>e(C).y))),u(Ie,"r",(L(e(F)),o(()=>e(F).radius+12))),u(Ie,"fill",e(be)),u(Ie,"stroke",e(Ne))}),A(Ue,Ie)};Z(_t,Ue=>{e(Ae)?Ue(Oe):Ue(z,!1)},!0)}A($t,qt)};Z(Ct,$t=>{e(Le)?$t(Qt):$t(mn,!1)})}A(Mt,Jt)};Z(Dt,Mt=>{e(Ft)&&Mt(mt)})}var xt=T(Dt);{var At=Mt=>{var Jt=qe(),Ct=ce(Jt);{var Qt=$t=>{var qt=Hd(),_t=w(qt);X(()=>{u(qt,"transform",`rotate(${e(C),o(()=>e(C).rotation||0)??""}, ${e(C),o(()=>e(C).x)??""}, ${e(C),o(()=>e(C).y)??""})`),u(_t,"x",(e(C),o(()=>e(C).x-e(C).customWidth/2-9))),u(_t,"y",(e(C),o(()=>e(C).y-e(C).customHeight/2-9))),u(_t,"width",(e(C),o(()=>e(C).customWidth+18))),u(_t,"height",(e(C),o(()=>e(C).customHeight+18))),u(_t,"fill",e(be)),u(_t,"stroke",e(Ne))}),A($t,qt)},mn=$t=>{var qt=qe(),_t=ce(qt);{var Oe=Ue=>{var Ie=Bd(),N=w(Ie);X(()=>{u(Ie,"transform",`rotate(${e(C),o(()=>e(C).rotation||0)??""}, ${e(C),o(()=>e(C).x)??""}, ${e(C),o(()=>e(C).y)??""})`),u(N,"cx",(e(C),o(()=>e(C).x))),u(N,"cy",(e(C),o(()=>e(C).y))),u(N,"rx",(L(e(F)),o(()=>e(F).width/2+9))),u(N,"ry",(L(e(F)),o(()=>e(F).height/2+9))),u(N,"fill",e(be)),u(N,"stroke",e(Ne))}),A(Ue,Ie)},z=Ue=>{var Ie=Fd();X(()=>{u(Ie,"cx",(e(C),o(()=>e(C).x))),u(Ie,"cy",(e(C),o(()=>e(C).y))),u(Ie,"r",(L(e(F)),o(()=>e(F).radius+9))),u(Ie,"fill",e(be)),u(Ie,"stroke",e(Ne))}),A(Ue,Ie)};Z(_t,Ue=>{e(Ae)?Ue(Oe):Ue(z,!1)},!0)}A($t,qt)};Z(Ct,$t=>{e(Le)?$t(Qt):$t(mn,!1)})}A(Mt,Jt)};Z(xt,Mt=>{e(It)&&Mt(At)})}var ln=T(xt);{var it=Mt=>{var Jt=qe(),Ct=ce(Jt);{var Qt=$t=>{var qt=qd(),_t=w(qt);X(()=>{u(qt,"transform",`rotate(${e(C),o(()=>e(C).rotation||0)??""}, ${e(C),o(()=>e(C).x)??""}, ${e(C),o(()=>e(C).y)??""})`),u(_t,"x",(e(C),o(()=>e(C).x-e(C).customWidth/2-6))),u(_t,"y",(e(C),o(()=>e(C).y-e(C).customHeight/2-6))),u(_t,"width",(e(C),o(()=>e(C).customWidth+12))),u(_t,"height",(e(C),o(()=>e(C).customHeight+12))),u(_t,"stroke",e(Ne))}),A($t,qt)},mn=$t=>{var qt=qe(),_t=ce(qt);{var Oe=Ue=>{var Ie=Ud(),N=w(Ie);X(()=>{u(Ie,"transform",`rotate(${e(C),o(()=>e(C).rotation||0)??""}, ${e(C),o(()=>e(C).x)??""}, ${e(C),o(()=>e(C).y)??""})`),u(N,"cx",(e(C),o(()=>e(C).x))),u(N,"cy",(e(C),o(()=>e(C).y))),u(N,"rx",(L(e(F)),o(()=>e(F).width/2+6))),u(N,"ry",(L(e(F)),o(()=>e(F).height/2+6))),u(N,"stroke",e(Ne))}),A(Ue,Ie)},z=Ue=>{var Ie=Kd();X(()=>{u(Ie,"cx",(e(C),o(()=>e(C).x))),u(Ie,"cy",(e(C),o(()=>e(C).y))),u(Ie,"r",(L(e(F)),o(()=>e(F).radius+6))),u(Ie,"stroke",e(Ne))}),A(Ue,Ie)};Z(_t,Ue=>{e(Ae)?Ue(Oe):Ue(z,!1)},!0)}A($t,qt)};Z(Ct,$t=>{e(Le)?$t(Qt):$t(mn,!1)})}A(Mt,Jt)};Z(ln,Mt=>{e(Zt)&&Mt(it)})}A(j,Qe)}),A(W,x)};Z(Vt,W=>{(e(Zt)||e(It)||e(Ft))&&W(nn)})}var un=T(Vt);je(un,1,s,W=>W.id,(W,x)=>{const V=Ce(()=>(c(),e(x),o(()=>c().get(e(x).id))));{let j=Ce(()=>(e(x),o(()=>e(x).name||""))),C=Ce(()=>(e(x),o(()=>Pe(e(x).unitId)))),F=Ce(()=>(L(e(V)),o(()=>e(V)?!e(V).inCoherency:!1))),Ae=Ce(()=>(e(ee),e(x),o(()=>e(ee).includes(e(x).id)))),Le=Ce(()=>(e(ee),e(x),o(()=>e(ee).length>1&&e(ee).includes(e(x).id)))),be=Ce(()=>(e(ee),e(x),e(ke),o(()=>!e(ee).includes(e(x).id)&&e(ke).has(e(x).id))));Ps(W,{get id(){return e(x),o(()=>e(x).id)},get x(){return e(x),o(()=>e(x).x)},get y(){return e(x),o(()=>e(x).y)},get baseType(){return e(x),o(()=>e(x).baseType)},get playerId(){return e(x),o(()=>e(x).playerId)},get rotation(){return e(x),o(()=>e(x).rotation)},get name(){return e(j)},get customWidth(){return e(x),o(()=>e(x).customWidth)},get customHeight(){return e(x),o(()=>e(x).customHeight)},get unitStrokeColor(){return e(C)},get coherencyViolation(){return e(F)},get selected(){return e(Ae)},get inGroupSelection(){return e(Le)},get marqueePreview(){return e(be)},get screenToSvg(){return e(J)},onSelect:Ha,onDrag:Ca,onDragEnd:ga,onRotate:Gr,onRotateEnd:gr,onRename:Ba})}});var Rn=T(un);{var Gn=W=>{var x=zd(),V=ce(x),j=T(V),C=T(j),F=T(C);X(()=>{u(V,"cx",(e(E),o(()=>e(E).x))),u(V,"cy",(e(E),o(()=>e(E).y))),u(j,"x1",(e(E),o(()=>e(E).x))),u(j,"y1",(e(E),o(()=>e(E).y))),u(j,"x2",e(I)),u(j,"y2",e($)),u(C,"cx",e(I)),u(C,"cy",e($)),u(F,"transform",`translate(${e(I)??""}, ${e($)??""})`)}),oe("mousedown",C,bt),A(W,x)};Z(Rn,W=>{e(E),e(f),o(()=>e(E)&&e(f).length>1)&&W(Gn)})}var Yn=T(Rn);je(Yn,1,()=>e(lt),W=>W.id,(W,x)=>{const V=Ce(()=>(e(x),o(()=>sn(e(x).x1,e(x).y1,e(x).x2,e(x).y2)))),j=Ce(()=>(e(x),o(()=>(e(x).x1+e(x).x2)/2))),C=Ce(()=>(e(x),o(()=>(e(x).y1+e(x).y2)/2))),F=Ce(()=>(e(x),e(Pt),o(()=>e(x).id===e(Pt))));var Ae=Vd();let Le;var be=w(Ae),Ne=T(be);{var Qe=At=>{var ln=Xd(),it=ce(ln),Mt=T(it);X(()=>{u(it,"cx",(e(x),o(()=>e(x).x1))),u(it,"cy",(e(x),o(()=>e(x).y1))),u(it,"fill",e(F)?"#3b82f6":"#f59e0b"),u(Mt,"cx",(e(x),o(()=>e(x).x2))),u(Mt,"cy",(e(x),o(()=>e(x).y2))),u(Mt,"fill",e(F)?"#3b82f6":"#f59e0b")}),oe("mousedown",it,Jt=>Pn(e(x).id,1,Jt)),oe("mousedown",Mt,Jt=>Pn(e(x).id,2,Jt)),A(At,ln)};Z(Ne,At=>{e(ze)&&At(Qe)})}var Dt=T(Ne),mt=T(w(Dt)),xt=w(mt);X(At=>{Le=wn(Ae,0,"measurement-line",null,Le,{selected:e(F),"tool-active":e(ze)}),u(be,"x1",(e(x),o(()=>e(x).x1))),u(be,"y1",(e(x),o(()=>e(x).y1))),u(be,"x2",(e(x),o(()=>e(x).x2))),u(be,"y2",(e(x),o(()=>e(x).y2))),u(be,"stroke",e(F)&&e(ze)?"#3b82f6":"#f59e0b"),u(be,"stroke-width",e(F)&&e(ze)?.2:.15),u(be,"role",e(ze)?"button":"presentation"),u(be,"tabindex",e(ze)?0:-1),u(Dt,"transform",`translate(${e(j)??""}, ${e(C)??""})`),u(mt,"fill",e(F)&&e(ze)?"#3b82f6":"#f59e0b"),Ye(xt,`${At??""}"`)},[()=>(L(e(V)),o(()=>e(V).toFixed(1)))]),oe("click",be,At=>e(ze)&&Wn(e(x).id,At)),oe("mousedown",be,At=>e(ze)?vn(e(x).id,At):At.stopPropagation()),A(W,Ae)});var la=T(Yn);{var ka=W=>{const x=Ce(()=>(e(st),e(vt),o(()=>sn(e(st).x,e(st).y,e(vt).x,e(vt).y)))),V=Ce(()=>(e(st),e(vt),o(()=>(e(st).x+e(vt).x)/2))),j=Ce(()=>(e(st),e(vt),o(()=>(e(st).y+e(vt).y)/2)));var C=Zd(),F=w(C),Ae=T(F),Le=T(Ae),be=T(Le);{var Ne=Qe=>{var Dt=jd(),mt=T(w(Dt)),xt=w(mt);X(At=>{u(Dt,"transform",`translate(${e(V)??""}, ${e(j)??""})`),Ye(xt,`${At??""}"`)},[()=>(L(e(x)),o(()=>e(x).toFixed(1)))]),A(Qe,Dt)};Z(be,Qe=>{e(x)>.5&&Qe(Ne)})}X(()=>{u(F,"x1",(e(st),o(()=>e(st).x))),u(F,"y1",(e(st),o(()=>e(st).y))),u(F,"x2",(e(vt),o(()=>e(vt).x))),u(F,"y2",(e(vt),o(()=>e(vt).y))),u(Ae,"cx",(e(st),o(()=>e(st).x))),u(Ae,"cy",(e(st),o(()=>e(st).y))),u(Le,"cx",(e(vt),o(()=>e(vt).x))),u(Le,"cy",(e(vt),o(()=>e(vt).y)))}),A(W,C)};Z(la,W=>{e(yt)&&e(st)&&e(vt)&&W(ka)})}var ca=T(la);{var jt=W=>{var x=qe(),V=ce(x);je(V,1,()=>e(Q),ft,(j,C)=>{var F=qe(),Ae=ce(F);je(Ae,1,()=>(e(C),o(()=>e(C).rays)),ft,(Le,be)=>{var Ne=Jd();X(()=>{u(Ne,"x1",(e(be),o(()=>e(be).from.x))),u(Ne,"y1",(e(be),o(()=>e(be).from.y))),u(Ne,"x2",(e(be),o(()=>e(be).to.x))),u(Ne,"y2",(e(be),o(()=>e(be).to.y))),u(Ne,"stroke",(e(be),o(()=>e(be).blocked?"#ff000033":"#00ff0033")))}),A(Le,Ne)}),A(j,F)}),A(W,x)};Z(ca,W=>{e(ne),e(re),e(f),e(Q),o(()=>e(ne)&&e(re)&&e(f).length>0&&e(Q).length>0)&&W(jt)})}var Dn=T(ca);{var _=W=>{var x=qe(),V=ce(x);je(V,1,()=>e(Q),ft,(j,C)=>{var F=qe(),Ae=ce(F);{var Le=Ne=>{var Qe=Qd();X(()=>{u(Qe,"x1",(e(C),o(()=>e(C).firstClearRay.from.x))),u(Qe,"y1",(e(C),o(()=>e(C).firstClearRay.from.y))),u(Qe,"x2",(e(C),o(()=>e(C).firstClearRay.to.x))),u(Qe,"y2",(e(C),o(()=>e(C).firstClearRay.to.y)))}),A(Ne,Qe)},be=Ne=>{var Qe=ef();X(()=>{u(Qe,"x1",(e(C),o(()=>e(C).source.x))),u(Qe,"y1",(e(C),o(()=>e(C).source.y))),u(Qe,"x2",(e(C),o(()=>e(C).target.x))),u(Qe,"y2",(e(C),o(()=>e(C).target.y)))}),A(Ne,Qe)};Z(Ae,Ne=>{e(C),o(()=>e(C).firstClearRay)?Ne(Le):Ne(be,!1)})}A(j,F)}),A(W,x)};Z(Dn,W=>{e(re),e(f),e(Q),o(()=>e(re)&&e(f).length>0&&e(Q).length>0)&&W(_)})}var O=T(Dn);{var H=W=>{const x=Ce(()=>(e(_e),e(xe),o(()=>Math.min(e(_e).x,e(xe).x)))),V=Ce(()=>(e(_e),e(xe),o(()=>Math.min(e(_e).y,e(xe).y)))),j=Ce(()=>(e(xe),e(_e),o(()=>Math.abs(e(xe).x-e(_e).x)))),C=Ce(()=>(e(xe),e(_e),o(()=>Math.abs(e(xe).y-e(_e).y))));var F=tf();X(()=>{u(F,"x",e(x)),u(F,"y",e(V)),u(F,"width",e(j)),u(F,"height",e(C))}),A(W,F)};Z(O,W=>{e(Ee)&&e(_e)&&e(xe)&&W(H)})}A(D,pe)}}});var Kn=T(Un,2),Xr=w(Kn),xr=w(Xr);X(()=>Ye(xr,`Battlefield: 60" x 44" | ${d(),o(()=>d().length)??""} P1 models | ${y(),o(()=>y().length)??""} P2 models`)),oe("mousedown",Un,vr),A(t,Ze),Jn(),h()}var sf=Se("<span> </span>"),of=Se('<span class="los-status svelte-12aohay">No enemies</span>'),lf=Se('<div class="controls svelte-12aohay"><label class="svelte-12aohay"><input type="checkbox" class="svelte-12aohay"/> Show debug rays</label> <!> <button class="export-btn svelte-12aohay">Export PNG</button></div>'),cf=Se('<button class="svelte-12aohay"> </button>'),uf=Se('<div class="button-group svelte-12aohay"></div>'),mf=Se('<button class="svelte-12aohay"> </button>'),hf=Se('<div class="button-group svelte-12aohay"></div>'),df=Se('<div class="player-toggle svelte-12aohay"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-12aohay"><div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Circles</h4> <div class="palette-grid svelte-12aohay"></div></div> <div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Ovals</h4> <div class="palette-grid svelte-12aohay"></div></div></div>',1),ff=le('<ellipse stroke-width="0.1"></ellipse>'),pf=le('<circle stroke-width="0.1"></circle>'),yf=Se('<p class="svelte-12aohay"> </p>'),vf=Se('<main class="svelte-12aohay"><div class="layout svelte-12aohay"><div class="sidebar svelte-12aohay"><!> <!> <!> <!></div> <div class="battlefield-area svelte-12aohay"><div class="battlefield-container svelte-12aohay"><!></div> <div class="info svelte-12aohay"><p class="svelte-12aohay"> </p> <!> <p class="hint svelte-12aohay">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function gf(t,n){Zn(n,!1);const a=()=>Ht(Ua,"$debugModels",d),s=()=>Ht(Ka,"$debugSelectedModelId",d),r=()=>Ht(ws,"$debugTerrains",d),i=()=>Ht(Ss,"$debugWalls",d),l=()=>Ht(Bi,"$debugMode",d),c=()=>Ht(es,"$debugSelectedTerrainId",d),m=()=>Ht(ts,"$debugSelectedWallId",d),[d,y]=Ur(),p=Y(),h=Y(),f=Y(),v=Y(),k=Y();let b=Y();function M(ie,He){ws.add(ie,He)}function P(ie){Ss.add(ie)}function E(ie){es.set(ie),ts.set(null),Ka.set(null)}function S(ie){ts.set(ie),es.set(null),Ka.set(null)}function I(ie,He,tt){ws.updateTerrain(ie,{x:He,y:tt})}function $(ie,He,tt){Ss.updateWall(ie,{x:He,y:tt})}function U(ie,He){ws.updateTerrain(ie,{rotation:He})}function B(ie,He){Ss.updateWall(ie,{rotation:He})}let G=Y(1),q=Y(null),ae=!1,Q=null;const de=5;Kr(()=>{if(a().length===0){const ie=Ua.add("32mm",1,10,22);Ua.add("32mm",2,50,22),Ka.set(ie)}});function re(ie,He){if(!e(b))return;ae=!0,Q={x:He.clientX,y:He.clientY};const tt=e(b).screenToSvg(He.clientX,He.clientY);g(q,{baseType:ie.type,x:tt.x,y:tt.y}),window.addEventListener("mousemove",ne),window.addEventListener("mouseup",Ee)}function ne(ie){if(!ae||!e(q)||!e(b))return;const He=e(b).screenToSvg(ie.clientX,ie.clientY);g(q,{...e(q),x:He.x,y:He.y})}function Ee(ie){if(!ae||!e(q)){ae=!1,g(q,null),Q=null,window.removeEventListener("mousemove",ne),window.removeEventListener("mouseup",Ee);return}const He=ie.clientX-Q.x,tt=ie.clientY-Q.y,Gt=Math.sqrt(He*He+tt*tt);let Lt,gt;Gt<de?(Lt=30,gt=22):(Lt=e(q).x,gt=e(q).y);const tn=Ua.add(e(q).baseType,e(G),Lt,gt);Ka.set(tn),g(q,null),ae=!1,Q=null,window.removeEventListener("mousemove",ne),window.removeEventListener("mouseup",Ee)}function _e(ie){Ka.set(ie),es.set(null),ts.set(null)}function xe(ie,He,tt){Ua.updateModel(ie,{x:He,y:tt},!0)}function ee(ie,He,tt,Gt,Lt){si.push({type:"move",modelId:ie,before:{x:He,y:tt},after:{x:Gt,y:Lt}})}function ke(ie,He){Ua.updateModel(ie,{rotation:He},!0)}function ue(ie,He,tt){si.push({type:"rotate",modelId:ie,before:{rotation:He},after:{rotation:tt}})}function ye(ie,He){Ua.updateModel(ie,{name:He})}function Ke(){es.set(null),ts.set(null),Ka.set(null)}function ve(ie){const He=pn(ie.baseType);return cn(ie.baseType)?{x:ie.x,y:ie.y,rx:He.width/2,ry:He.height/2,rotation:ie.rotation||0}:{x:ie.x,y:ie.y,radius:He.radius}}async function We(){const He=`battlefield-debug-${new Date().toISOString().slice(0,10)}`;try{await Si(r(),i(),a(),He)}catch(tt){alert("Failed to export PNG"),console.error("Export error:",tt)}}he(()=>(a(),s()),()=>{g(p,a().find(ie=>ie.id===s()))}),he(()=>(e(p),a()),()=>{g(h,e(p)?a().filter(ie=>ie.playerId!==e(p).playerId):[])}),he(()=>(r(),dr),()=>{g(f,r().map(ie=>({id:ie.id,vertices:dr(ie)})))}),he(()=>(i(),ya),()=>{g(v,i().map(ie=>vs(ya(ie.shape,ie.segments),ie.x,ie.y,ie.rotation)))}),he(()=>(e(p),e(h),e(f),e(v)),()=>{g(k,e(p)&&e(h).length>0?e(h).map(ie=>{const He=Zo(ve(ie),ve(e(p)),e(f),e(v));return{viewerId:ie.id,viewer:ie,canSee:He.canSee,firstClearRay:He.firstClearRay,rays:He.rays}}):[])}),Ya(),ia();var me=vf(),pt=w(me),lt=w(pt),Pt=w(lt);Ln(Pt,{title:"LOS Debug",children:(ie,He)=>{var tt=lf(),Gt=w(tt),Lt=w(Gt),gt=T(Gt,2);{var tn=Wt=>{var yn=sf();let $n;var Wn=w(yn);X((De,Be)=>{$n=wn(yn,1,"los-status svelte-12aohay",null,$n,De),Ye(Wn,`${Be??""}/${e(k),o(()=>e(k).length)??""} visible`)},[()=>({"can-see":e(k).some(De=>De.canSee),blocked:!e(k).some(De=>De.canSee)}),()=>(e(k),o(()=>e(k).filter(De=>De.canSee).length))]),A(Wt,yn)},En=Wt=>{var yn=of();A(Wt,yn)};Z(gt,Wt=>{e(p),e(k),o(()=>e(p)&&e(k).length>0)?Wt(tn):Wt(En,!1)})}var sn=T(gt,2);_n(Lt,l,Wt=>Bc(Bi,Wt)),oe("click",sn,We),A(ie,tt)},$$slots:{default:!0}});var yt=T(Pt,2);Ln(yt,{title:"Add Terrain",defaultOpen:!1,children:(ie,He)=>{var tt=uf();je(tt,5,()=>su,ft,(Gt,Lt)=>{var gt=cf(),tn=w(gt);X(()=>Ye(tn,(e(Lt),o(()=>e(Lt).label)))),oe("click",gt,()=>M(e(Lt).width,e(Lt).height)),A(Gt,gt)}),A(ie,tt)},$$slots:{default:!0}});var st=T(yt,2);Ln(st,{title:"Add Wall",defaultOpen:!1,children:(ie,He)=>{var tt=hf();je(tt,5,()=>iu,ft,(Gt,Lt)=>{var gt=mf(),tn=w(gt);X(()=>Ye(tn,(e(Lt),o(()=>e(Lt).label)))),oe("click",gt,()=>P(e(Lt).shape)),A(Gt,gt)}),A(ie,tt)},$$slots:{default:!0}});var vt=T(st,2);Ln(vt,{title:"Add Models",defaultOpen:!1,children:(ie,He)=>{var tt=df(),Gt=ce(tt),Lt=w(Gt);let gt;var tn=T(Lt,2);let En;var sn=T(Gt,2),Wt=w(sn),yn=T(w(Wt),2);je(yn,5,()=>(L(Vn),o(()=>Vn.circles)),ft,(De,Be)=>{Ns(De,{get baseSize(){return e(Be)},get playerId(){return e(G)},onDragStart:re})});var $n=T(Wt,2),Wn=T(w($n),2);je(Wn,5,()=>(L(Vn),o(()=>Vn.ovals)),ft,(De,Be)=>{Ns(De,{get baseSize(){return e(Be)},get playerId(){return e(G)},onDragStart:re})}),X(()=>{gt=wn(Lt,1,"toggle-btn svelte-12aohay",null,gt,{active:e(G)===1}),En=wn(tn,1,"toggle-btn svelte-12aohay",null,En,{active:e(G)===2})}),oe("click",Lt,()=>g(G,1)),oe("click",tn,()=>g(G,2)),A(ie,tt)},$$slots:{default:!0}});var ze=T(lt,2),Zt=w(ze),It=w(Zt);ms(Us(It,{get terrains(){return r()},get walls(){return i()},get models(){return a()},get losResults(){return e(k)},interactiveTerrain:!0,interactiveWalls:!0,interactiveModels:!0,get showDebugRays(){return l()},get selectedTerrainId(){return c()},get selectedWallId(){return m()},get selectedModelId(){return s()},onTerrainSelect:E,onTerrainDrag:I,onTerrainRotate:U,onWallSelect:S,onWallDrag:$,onWallRotate:B,onModelSelect:_e,onModelDrag:xe,onModelDragEnd:ee,onModelRotate:ke,onModelRotateEnd:ue,onModelRename:ye,onBackgroundClick:Ke,children:(ie,He)=>{var tt=qe(),Gt=ce(tt);{var Lt=gt=>{const tn=Ce(()=>(L(pn),e(q),o(()=>pn(e(q).baseType)))),En=Ce(()=>(L(cn),e(q),o(()=>cn(e(q).baseType)))),sn=Ce(()=>(L(hs),e(G),o(()=>hs(e(G)))));var Wt=qe(),yn=ce(Wt);{var $n=De=>{var Be=ff();X(()=>{u(Be,"cx",(e(q),o(()=>e(q).x))),u(Be,"cy",(e(q),o(()=>e(q).y))),u(Be,"rx",(L(e(tn)),o(()=>e(tn).width/2))),u(Be,"ry",(L(e(tn)),o(()=>e(tn).height/2))),u(Be,"fill",(L(e(sn)),o(()=>e(sn).fillLight))),u(Be,"stroke",(L(e(sn)),o(()=>e(sn).primary)))}),A(De,Be)},Wn=De=>{var Be=pf();X(()=>{u(Be,"cx",(e(q),o(()=>e(q).x))),u(Be,"cy",(e(q),o(()=>e(q).y))),u(Be,"r",(L(e(tn)),o(()=>e(tn).radius))),u(Be,"fill",(L(e(sn)),o(()=>e(sn).fillLight))),u(Be,"stroke",(L(e(sn)),o(()=>e(sn).primary)))}),A(De,Be)};Z(yn,De=>{e(En)?De($n):De(Wn,!1)})}A(gt,Wt)};Z(Gt,gt=>{e(q)&&gt(Lt)})}A(ie,tt)},$$slots:{default:!0},$$legacy:!0}),ie=>g(b,ie),()=>e(b));var Ft=T(Zt,2),Sn=w(Ft),Rt=w(Sn),St=T(Sn,2);{var en=ie=>{var He=yf(),tt=w(He);X(Gt=>Ye(tt,`Selected model LOS: ${Gt??""}/${e(k),o(()=>e(k).length)??""} visible`),[()=>(e(k),o(()=>e(k).filter(Gt=>Gt.canSee).length))]),A(ie,He)};Z(St,ie=>{l(),e(p),e(k),o(()=>l()&&e(p)&&e(k).length>0)&&ie(en)})}X(()=>Ye(Rt,`Battlefield: 60" x 44" | ${r(),o(()=>r().length)??""} terrain | ${i(),o(()=>i().length)??""} walls | ${a(),o(()=>a().length)??""} models`)),A(t,me),Jn(),y()}var bf=Se('<div class="app-header svelte-1n46o8q"><h1 class="app-title svelte-1n46o8q">Procinctum</h1> <nav class="nav-links svelte-1n46o8q"><a href="#/setup">Battlefield Setup</a> <a href="#/deployment">Deployment</a> <a href="#/battle">Battle</a> <a href="#/">Layout Builder</a></nav></div> <!> <footer class="app-footer svelte-1n46o8q"><span>Built with love by <a href="https://github.com/barkin-aygun/wh40k-deploy" target="_blank" rel="noopener noreferrer" class="svelte-1n46o8q">@Volfied</a></span> <span class="separator svelte-1n46o8q">|</span> <span class="disclaimer svelte-1n46o8q">Warhammer 40,000 and all associated marks, logos, and images are trademarks and/or copyrights of Games Workshop Ltd. This is an unofficial fan project and is not affiliated with or endorsed by Games Workshop.<br/><a href="https://github.com/desjani/40kCompactor" target="_blank" rel="noopener noreferrer" class="svelte-1n46o8q">40KCompactor</a> by Desjani</span></footer>',1);function Tf(t,n){Zn(n,!1);let a=Y("main");function s(){const P=window.location.hash;P==="#/debug"?g(a,"debug"):P==="#/setup"?g(a,"setup"):P==="#/deployment"?g(a,"deployment"):P==="#/battle"?g(a,"battle"):P==="#/"?g(a,"deployment"):g(a,"setup")}Kr(()=>(s(),window.addEventListener("hashchange",s),()=>window.removeEventListener("hashchange",s))),ia();var r=bf(),i=ce(r),l=T(w(i),2),c=w(l);let m;var d=T(c,2);let y;var p=T(d,2);let h;var f=T(p,2);let v;var k=T(i,2);{var b=P=>{gf(P,{})},M=P=>{var E=qe(),S=ce(E);{var I=U=>{bm(U,{})},$=U=>{var B=qe(),G=ce(B);{var q=Q=>{Vi(Q,{})},ae=Q=>{var de=qe(),re=ce(de);{var ne=_e=>{rf(_e,{})},Ee=_e=>{Vi(_e,{})};Z(re,_e=>{e(a)==="battle"?_e(ne):_e(Ee,!1)},!0)}A(Q,de)};Z(G,Q=>{e(a)==="deployment"?Q(q):Q(ae,!1)},!0)}A(U,B)};Z(S,U=>{e(a)==="setup"?U(I):U($,!1)},!0)}A(P,E)};Z(k,P=>{e(a)==="debug"?P(b):P(M,!1)})}X(()=>{m=wn(c,1,"svelte-1n46o8q",null,m,{active:e(a)==="setup"}),y=wn(d,1,"svelte-1n46o8q",null,y,{active:e(a)==="deployment"}),h=wn(p,1,"svelte-1n46o8q",null,h,{active:e(a)==="battle"}),v=wn(f,1,"svelte-1n46o8q",null,v,{active:e(a)==="main"})}),A(t,r),Jn()}Cc(Tf,{target:document.getElementById("app")});
//# sourceMappingURL=index-D4RpjUzc.js.map
