(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=a(s);fetch(s.href,i)}})();const Ur=!1;var ar=Array.isArray,cl=Array.prototype.indexOf,Rr=Array.from,zi=Object.defineProperty,ms=Object.getOwnPropertyDescriptor,Xi=Object.getOwnPropertyDescriptors,ul=Object.prototype,ml=Array.prototype,ai=Object.getPrototypeOf,wi=Object.isExtensible;const Va=()=>{};function dl(t){return t()}function br(t){for(var n=0;n<t.length;n++)t[n]()}function Vi(){var t,n,a=new Promise((r,s)=>{t=r,n=s});return{promise:a,resolve:t,reject:n}}const Tn=2,Tr=4,sr=8,ji=1<<24,Ha=16,Fa=32,Ts=64,si=128,sa=512,bn=1024,Dn=2048,Aa=4096,Vn=8192,Pa=16384,ri=32768,Is=65536,Si=1<<17,Qi=1<<18,Ws=1<<19,Zi=1<<20,$a=1<<25,ps=32768,Kr=1<<21,ii=1<<22,ja=1<<23,Na=Symbol("$state"),hl=Symbol("legacy props"),fl=Symbol(""),Ms=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function kr(){throw new Error("https://svelte.dev/e/invalid_default_snippet")}function oi(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function yl(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function pl(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function vl(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function gl(t){throw new Error("https://svelte.dev/e/effect_orphan")}function bl(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Tl(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function xl(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function _l(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function wl(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Sl(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Al=1,Cl=2,Ji=4,El=8,Ml=16,Rl=1,kl=2,Ll=4,Dl=8,Il=16,eo=1,$l=2,vn=Symbol(),Pl="http://www.w3.org/1999/xhtml";function Nl(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Ol(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function to(t){return t===this.v}function no(t,n){return t!=t?n==n:t!==n||t!==null&&typeof t=="object"||typeof t=="function"}function ao(t){return!no(t,this.v)}let Ys=!1,Wl=!1;function Yl(){Ys=!0}let zt=null;function $s(t){zt=t}function Yn(t,n=!1,a){zt={p:zt,i:!1,c:null,e:null,s:t,x:null,l:Ys&&!n?{s:null,u:null,$:[]}:null}}function Hn(t){var n=zt,a=n.e;if(a!==null){n.e=null;for(var r of a)xo(r)}return t!==void 0&&(n.x=t),n.i=!0,zt=n.p,t??{}}function rr(){return!Ys||zt!==null&&zt.l===null}let us=[];function so(){var t=us;us=[],br(t)}function Hs(t){if(us.length===0&&!Qs){var n=us;queueMicrotask(()=>{n===us&&so()})}us.push(t)}function Hl(){for(;us.length>0;)so()}function ro(t){var n=Ot;if(n===null)return wt.f|=ja,t;if((n.f&ri)===0){if((n.f&si)===0)throw t;n.b.error(t)}else Ps(t,n)}function Ps(t,n){for(;n!==null;){if((n.f&si)!==0)try{n.b.error(t);return}catch(a){t=a}n=n.parent}throw t}const Fl=-7169;function un(t,n){t.f=t.f&Fl|n}function li(t){(t.f&sa)!==0||t.deps===null?un(t,bn):un(t,Aa)}function io(t){if(t!==null)for(const n of t)(n.f&Tn)===0||(n.f&ps)===0||(n.f^=ps,io(n.deps))}function oo(t,n,a){(t.f&Dn)!==0?n.add(t):(t.f&Aa)!==0&&a.add(t),io(t.deps),un(t,bn)}const cr=new Set;let kt=null,js=null,ma=null,na=[],Lr=null,Gr=!1,Qs=!1;class xa{committed=!1;current=new Map;previous=new Map;#t=new Set;#i=new Set;#e=0;#s=0;#r=null;#a=new Set;#n=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#s>0}process(n){na=[],js=null,this.apply();var a=[],r=[];for(const s of n)this.#o(s,a,r);this.is_fork||this.#c(),this.is_deferred()?(this.#l(r),this.#l(a)):(js=this,kt=null,Ai(r),Ai(a),js=null,this.#r?.resolve()),ma=null}#o(n,a,r){n.f^=bn;for(var s=n.first,i=null;s!==null;){var o=s.f,c=(o&(Fa|Ts))!==0,d=c&&(o&bn)!==0,h=d||(o&Vn)!==0||this.skipped_effects.has(s);if(!h&&s.fn!==null){c?s.f^=bn:i!==null&&(o&(Tr|sr|ji))!==0?i.b.defer_effect(s):(o&Tr)!==0?a.push(s):Bs(s)&&((o&Ha)!==0&&this.#a.add(s),Ns(s));var m=s.first;if(m!==null){s=m;continue}}var y=s.parent;for(s=s.next;s===null&&y!==null;)y===i&&(i=null),s=y.next,y=y.parent}}#l(n){for(var a=0;a<n.length;a+=1)oo(n[a],this.#a,this.#n)}capture(n,a){a!==vn&&!this.previous.has(n)&&this.previous.set(n,a),(n.f&ja)===0&&(this.current.set(n,n.v),ma?.set(n,n.v))}activate(){kt=this,this.apply()}deactivate(){kt===this&&(kt=null,ma=null)}flush(){if(this.activate(),na.length>0){if(lo(),kt!==null&&kt!==this)return}else this.#e===0&&this.process([]);this.deactivate()}discard(){for(const n of this.#i)n(this);this.#i.clear()}#c(){if(this.#s===0){for(const n of this.#t)n();this.#t.clear()}this.#e===0&&this.#u()}#u(){if(cr.size>1){this.previous.clear();var n=ma,a=!0;for(const s of cr){if(s===this){a=!1;continue}const i=[];for(const[c,d]of this.current){if(s.current.has(c))if(a&&d!==s.current.get(c))s.current.set(c,d);else continue;i.push(c)}if(i.length===0)continue;const o=[...s.current.keys()].filter(c=>!this.current.has(c));if(o.length>0){var r=na;na=[];const c=new Set,d=new Map;for(const h of i)co(h,o,c,d);if(na.length>0){kt=s,s.apply();for(const h of na)s.#o(h,[],[]);s.deactivate()}na=r}}kt=null,ma=n}this.committed=!0,cr.delete(this)}increment(n){this.#e+=1,n&&(this.#s+=1)}decrement(n){this.#e-=1,n&&(this.#s-=1),this.revive()}revive(){for(const n of this.#a)this.#n.delete(n),un(n,Dn),Ya(n);for(const n of this.#n)un(n,Aa),Ya(n);this.flush()}oncommit(n){this.#t.add(n)}ondiscard(n){this.#i.add(n)}settled(){return(this.#r??=Vi()).promise}static ensure(){if(kt===null){const n=kt=new xa;cr.add(kt),Qs||xa.enqueue(()=>{kt===n&&n.flush()})}return kt}static enqueue(n){Hs(n)}apply(){}}function Bl(t){var n=Qs;Qs=!0;try{for(var a;;){if(Hl(),na.length===0&&(kt?.flush(),na.length===0))return Lr=null,a;lo()}}finally{Qs=n}}function lo(){var t=hs;Gr=!0;var n=null;try{var a=0;for(_r(!0);na.length>0;){var r=xa.ensure();if(a++>1e3){var s,i;ql()}r.process(na),Qa.clear()}}finally{Gr=!1,_r(t),Lr=null}}function ql(){try{bl()}catch(t){Ps(t,Lr)}}let ka=null;function Ai(t){var n=t.length;if(n!==0){for(var a=0;a<n;){var r=t[a++];if((r.f&(Pa|Vn))===0&&Bs(r)&&(ka=new Set,Ns(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?Ao(r):r.fn=null),ka?.size>0)){Qa.clear();for(const s of ka){if((s.f&(Pa|Vn))!==0)continue;const i=[s];let o=s.parent;for(;o!==null;)ka.has(o)&&(ka.delete(o),i.push(o)),o=o.parent;for(let c=i.length-1;c>=0;c--){const d=i[c];(d.f&(Pa|Vn))===0&&Ns(d)}}ka.clear()}}ka=null}}function co(t,n,a,r){if(!a.has(t)&&(a.add(t),t.reactions!==null))for(const s of t.reactions){const i=s.f;(i&Tn)!==0?co(s,n,a,r):(i&(ii|Ha))!==0&&(i&Dn)===0&&uo(s,n,r)&&(un(s,Dn),Ya(s))}}function uo(t,n,a){const r=a.get(t);if(r!==void 0)return r;if(t.deps!==null)for(const s of t.deps){if(n.includes(s))return!0;if((s.f&Tn)!==0&&uo(s,n,a))return a.set(s,!0),!0}return a.set(t,!1),!1}function Ya(t){for(var n=Lr=t;n.parent!==null;){n=n.parent;var a=n.f;if(Gr&&n===Ot&&(a&Ha)!==0&&(a&Qi)===0)return;if((a&(Ts|Fa))!==0){if((a&bn)===0)return;n.f^=bn}}na.push(n)}function Ul(t){let n=0,a=vs(0),r;return()=>{mi()&&(e(a),Fs(()=>(n===0&&(r=l(()=>t(()=>Zs(a)))),n+=1,()=>{Hs(()=>{n-=1,n===0&&(r?.(),r=void 0,Zs(a))})})))}}var Kl=Is|Ws|si;function Gl(t,n,a){new zl(t,n,a)}class zl{parent;is_pending=!1;#t;#i=null;#e;#s;#r;#a=null;#n=null;#o=null;#l=null;#c=null;#u=0;#m=0;#h=!1;#f=new Set;#y=new Set;#d=null;#T=Ul(()=>(this.#d=vs(this.#u),()=>{this.#d=null}));constructor(n,a,r){this.#t=n,this.#e=a,this.#s=r,this.parent=Ot.b,this.is_pending=!!this.#e.pending,this.#r=di(()=>{Ot.b=this;{var s=this.#g();try{this.#a=aa(()=>r(s))}catch(i){this.error(i)}this.#m>0?this.#v():this.is_pending=!1}return()=>{this.#c?.remove()}},Kl)}#x(){try{this.#a=aa(()=>this.#s(this.#t))}catch(n){this.error(n)}}#_(){const n=this.#e.pending;n&&(this.#n=aa(()=>n(this.#t)),xa.enqueue(()=>{var a=this.#g();this.#a=this.#p(()=>(xa.ensure(),aa(()=>this.#s(a)))),this.#m>0?this.#v():(ds(this.#n,()=>{this.#n=null}),this.is_pending=!1)}))}#g(){var n=this.#t;return this.is_pending&&(this.#c=Oa(),this.#t.before(this.#c),n=this.#c),n}defer_effect(n){oo(n,this.#f,this.#y)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#e.pending}#p(n){var a=Ot,r=wt,s=zt;Sa(this.#r),On(this.#r),$s(this.#r.ctx);try{return n()}catch(i){return ro(i),null}finally{Sa(a),On(r),$s(s)}}#v(){const n=this.#e.pending;this.#a!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#c),Mo(this.#a,this.#l)),this.#n===null&&(this.#n=aa(()=>n(this.#t)))}#b(n){if(!this.has_pending_snippet()){this.parent&&this.parent.#b(n);return}if(this.#m+=n,this.#m===0){this.is_pending=!1;for(const a of this.#f)un(a,Dn),Ya(a);for(const a of this.#y)un(a,Aa),Ya(a);this.#f.clear(),this.#y.clear(),this.#n&&ds(this.#n,()=>{this.#n=null}),this.#l&&(this.#t.before(this.#l),this.#l=null)}}update_pending_count(n){this.#b(n),this.#u+=n,this.#d&&gs(this.#d,this.#u)}get_effect_pending(){return this.#T(),e(this.#d)}error(n){var a=this.#e.onerror;let r=this.#e.failed;if(this.#h||!a&&!r)throw n;this.#a&&(Wn(this.#a),this.#a=null),this.#n&&(Wn(this.#n),this.#n=null),this.#o&&(Wn(this.#o),this.#o=null);var s=!1,i=!1;const o=()=>{if(s){Ol();return}s=!0,i&&Sl(),xa.ensure(),this.#u=0,this.#o!==null&&ds(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#a=this.#p(()=>(this.#h=!1,aa(()=>this.#s(this.#t)))),this.#m>0?this.#v():this.is_pending=!1};var c=wt;try{On(null),i=!0,a?.(n,o),i=!1}catch(d){Ps(d,this.#r&&this.#r.parent)}finally{On(c)}r&&Hs(()=>{this.#o=this.#p(()=>{xa.ensure(),this.#h=!0;try{return aa(()=>{r(this.#t,()=>n,()=>o)})}catch(d){return Ps(d,this.#r.parent),null}finally{this.#h=!1}})})}}function Xl(t,n,a,r){const s=rr()?Dr:Ie;if(a.length===0&&t.length===0){r(n.map(s));return}var i=kt,o=Ot,c=Vl();function d(){Promise.all(a.map(h=>jl(h))).then(h=>{c();try{r([...n.map(s),...h])}catch(m){(o.f&Pa)===0&&Ps(m,o)}i?.deactivate(),xr()}).catch(h=>{Ps(h,o)})}t.length>0?Promise.all(t).then(()=>{c();try{return d()}finally{i?.deactivate(),xr()}}):d()}function Vl(){var t=Ot,n=wt,a=zt,r=kt;return function(i=!0){Sa(t),On(n),$s(a),i&&r?.activate()}}function xr(){Sa(null),On(null),$s(null)}function Dr(t){var n=Tn|Dn,a=wt!==null&&(wt.f&Tn)!==0?wt:null;return Ot!==null&&(Ot.f|=Ws),{ctx:zt,deps:null,effects:null,equals:to,f:n,fn:t,reactions:null,rv:0,v:vn,wv:0,parent:a??Ot,ac:null}}function jl(t,n,a){let r=Ot;r===null&&yl();var s=r.b,i=void 0,o=vs(vn),c=!wt,d=new Map;return ic(()=>{var h=Vi();i=h.promise;try{Promise.resolve(t()).then(h.resolve,h.reject).then(()=>{m===kt&&m.committed&&m.deactivate(),xr()})}catch(p){h.reject(p),xr()}var m=kt;if(c){var y=s.is_rendered();s.update_pending_count(1),m.increment(y),d.get(m)?.reject(Ms),d.delete(m),d.set(m,h)}const u=(p,g=void 0)=>{if(m.activate(),g)g!==Ms&&(o.f|=ja,gs(o,g));else{(o.f&ja)!==0&&(o.f^=ja),gs(o,p);for(const[_,T]of d){if(d.delete(_),_===m)break;T.reject(Ms)}}c&&(s.update_pending_count(-1),m.decrement(y))};h.promise.then(u,p=>u(null,p||"unknown"))}),or(()=>{for(const h of d.values())h.reject(Ms)}),new Promise(h=>{function m(y){function u(){y===i?h(o):m(i)}y.then(u,u)}m(i)})}function Ie(t){const n=Dr(t);return n.equals=ao,n}function mo(t){var n=t.effects;if(n!==null){t.effects=null;for(var a=0;a<n.length;a+=1)Wn(n[a])}}function Ql(t){for(var n=t.parent;n!==null;){if((n.f&Tn)===0)return(n.f&Pa)===0?n:null;n=n.parent}return null}function ci(t){var n,a=Ot;Sa(Ql(t));try{t.f&=~ps,mo(t),n=Io(t)}finally{Sa(a)}return n}function ho(t){var n=ci(t);if(!t.equals(n)&&(t.wv=Lo(),(!kt?.is_fork||t.deps===null)&&(t.v=n,t.deps===null))){un(t,bn);return}Ja||(ma!==null?(mi()||kt?.is_fork)&&ma.set(t,n):li(t))}let zr=new Set;const Qa=new Map;let fo=!1;function vs(t,n){var a={f:0,v:t,reactions:null,equals:to,rv:0,wv:0};return a}function Ua(t,n){const a=vs(t);return uc(a),a}function O(t,n=!1,a=!0){const r=vs(t);return n||(r.equals=ao),Ys&&a&&zt!==null&&zt.l!==null&&(zt.l.s??=[]).push(r),r}function Yr(t,n){return v(t,l(()=>e(t))),n}function v(t,n,a=!1){wt!==null&&(!da||(wt.f&Si)!==0)&&rr()&&(wt.f&(Tn|Ha|ii|Si))!==0&&!Wa?.includes(t)&&wl();let r=a?Rs(n):n;return gs(t,r)}function gs(t,n){if(!t.equals(n)){var a=t.v;Ja?Qa.set(t,n):Qa.set(t,a),t.v=n;var r=xa.ensure();if(r.capture(t,a),(t.f&Tn)!==0){const s=t;(t.f&Dn)!==0&&ci(s),li(s)}t.wv=Lo(),yo(t,Dn),rr()&&Ot!==null&&(Ot.f&bn)!==0&&(Ot.f&(Fa|Ts))===0&&(ta===null?mc([t]):ta.push(t)),!r.is_fork&&zr.size>0&&!fo&&Zl()}return n}function Zl(){fo=!1;var t=hs;_r(!0);const n=Array.from(zr);try{for(const a of n)(a.f&bn)!==0&&un(a,Aa),Bs(a)&&Ns(a)}finally{_r(t)}zr.clear()}function Zs(t){v(t,t.v+1)}function yo(t,n){var a=t.reactions;if(a!==null)for(var r=rr(),s=a.length,i=0;i<s;i++){var o=a[i],c=o.f;if(!(!r&&o===Ot)){var d=(c&Dn)===0;if(d&&un(o,n),(c&Tn)!==0){var h=o;ma?.delete(h),(c&ps)===0&&(c&sa&&(o.f|=ps),yo(h,Aa))}else d&&((c&Ha)!==0&&ka!==null&&ka.add(o),Ya(o))}}}function Rs(t){if(typeof t!="object"||t===null||Na in t)return t;const n=ai(t);if(n!==ul&&n!==ml)return t;var a=new Map,r=ar(t),s=Ua(0),i=fs,o=c=>{if(fs===i)return c();var d=wt,h=fs;On(null),Ri(i);var m=c();return On(d),Ri(h),m};return r&&a.set("length",Ua(t.length)),new Proxy(t,{defineProperty(c,d,h){(!("value"in h)||h.configurable===!1||h.enumerable===!1||h.writable===!1)&&xl();var m=a.get(d);return m===void 0?m=o(()=>{var y=Ua(h.value);return a.set(d,y),y}):v(m,h.value,!0),!0},deleteProperty(c,d){var h=a.get(d);if(h===void 0){if(d in c){const m=o(()=>Ua(vn));a.set(d,m),Zs(s)}}else v(h,vn),Zs(s);return!0},get(c,d,h){if(d===Na)return t;var m=a.get(d),y=d in c;if(m===void 0&&(!y||ms(c,d)?.writable)&&(m=o(()=>{var p=Rs(y?c[d]:vn),g=Ua(p);return g}),a.set(d,m)),m!==void 0){var u=e(m);return u===vn?void 0:u}return Reflect.get(c,d,h)},getOwnPropertyDescriptor(c,d){var h=Reflect.getOwnPropertyDescriptor(c,d);if(h&&"value"in h){var m=a.get(d);m&&(h.value=e(m))}else if(h===void 0){var y=a.get(d),u=y?.v;if(y!==void 0&&u!==vn)return{enumerable:!0,configurable:!0,value:u,writable:!0}}return h},has(c,d){if(d===Na)return!0;var h=a.get(d),m=h!==void 0&&h.v!==vn||Reflect.has(c,d);if(h!==void 0||Ot!==null&&(!m||ms(c,d)?.writable)){h===void 0&&(h=o(()=>{var u=m?Rs(c[d]):vn,p=Ua(u);return p}),a.set(d,h));var y=e(h);if(y===vn)return!1}return m},set(c,d,h,m){var y=a.get(d),u=d in c;if(r&&d==="length")for(var p=h;p<y.v;p+=1){var g=a.get(p+"");g!==void 0?v(g,vn):p in c&&(g=o(()=>Ua(vn)),a.set(p+"",g))}if(y===void 0)(!u||ms(c,d)?.writable)&&(y=o(()=>Ua(void 0)),v(y,Rs(h)),a.set(d,y));else{u=y.v!==vn;var _=o(()=>Rs(h));v(y,_)}var T=Reflect.getOwnPropertyDescriptor(c,d);if(T?.set&&T.set.call(m,h),!u){if(r&&typeof d=="string"){var E=a.get("length"),k=Number(d);Number.isInteger(k)&&k>=E.v&&v(E,k+1)}Zs(s)}return!0},ownKeys(c){e(s);var d=Reflect.ownKeys(c).filter(y=>{var u=a.get(y);return u===void 0||u.v!==vn});for(var[h,m]of a)m.v!==vn&&!(h in c)&&d.push(h);return d},setPrototypeOf(){_l()}})}function Ci(t){try{if(t!==null&&typeof t=="object"&&Na in t)return t[Na]}catch{}return t}function Jl(t,n){return Object.is(Ci(t),Ci(n))}var ks,po,vo,go;function ec(){if(ks===void 0){ks=window,po=/Firefox/.test(navigator.userAgent);var t=Element.prototype,n=Node.prototype,a=Text.prototype;vo=ms(n,"firstChild").get,go=ms(n,"nextSibling").get,wi(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),wi(a)&&(a.__t=void 0)}}function Oa(t=""){return document.createTextNode(t)}function Da(t){return vo.call(t)}function ir(t){return go.call(t)}function x(t,n){return Da(t)}function _e(t,n=!1){{var a=Da(t);return a instanceof Comment&&a.data===""?ir(a):a}}function b(t,n=1,a=!1){let r=t;for(;n--;)r=ir(r);return r}function tc(t){t.textContent=""}function bo(){return!1}let Ei=!1;function nc(){Ei||(Ei=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const n of t.target.elements)n.__on_r?.()})},{capture:!0}))}function Ir(t){var n=wt,a=Ot;On(null),Sa(null);try{return t()}finally{On(n),Sa(a)}}function ui(t,n,a,r=a){t.addEventListener(n,()=>Ir(a));const s=t.__on_r;s?t.__on_r=()=>{s(),r(!0)}:t.__on_r=()=>r(!0),nc()}function To(t){Ot===null&&(wt===null&&gl(),vl()),Ja&&pl()}function ac(t,n){var a=n.last;a===null?n.last=n.first=t:(a.next=t,t.prev=a,n.last=t)}function Ca(t,n,a){var r=Ot;r!==null&&(r.f&Vn)!==0&&(t|=Vn);var s={ctx:zt,deps:null,nodes:null,f:t|Dn|sa,first:null,fn:n,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(a)try{Ns(s),s.f|=ri}catch(c){throw Wn(s),c}else n!==null&&Ya(s);var i=s;if(a&&i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&Ws)===0&&(i=i.first,(t&Ha)!==0&&(t&Is)!==0&&i!==null&&(i.f|=Is)),i!==null&&(i.parent=r,r!==null&&ac(i,r),wt!==null&&(wt.f&Tn)!==0&&(t&Ts)===0)){var o=wt;(o.effects??=[]).push(i)}return s}function mi(){return wt!==null&&!da}function or(t){const n=Ca(sr,null,!1);return un(n,bn),n.teardown=t,n}function Xr(t){To();var n=Ot.f,a=!wt&&(n&Fa)!==0&&(n&ri)===0;if(a){var r=zt;(r.e??=[]).push(t)}else return xo(t)}function xo(t){return Ca(Tr|Zi,t,!1)}function sc(t){return To(),Ca(sr|Zi,t,!0)}function rc(t){xa.ensure();const n=Ca(Ts|Ws,t,!0);return(a={})=>new Promise(r=>{a.outro?ds(n,()=>{Wn(n),r(void 0)}):(Wn(n),r(void 0))})}function _o(t){return Ca(Tr,t,!1)}function ye(t,n){var a=zt,r={effect:null,ran:!1,deps:t};a.l.$.push(r),r.effect=Fs(()=>{t(),!r.ran&&(r.ran=!0,l(n))})}function Ea(){var t=zt;Fs(()=>{for(var n of t.l.$){n.deps();var a=n.effect;(a.f&bn)!==0&&a.deps!==null&&un(a,Aa),Bs(a)&&Ns(a),n.ran=!1}})}function ic(t){return Ca(ii|Ws,t,!0)}function Fs(t,n=0){return Ca(sr|n,t,!0)}function q(t,n=[],a=[],r=[]){Xl(r,n,a,s=>{Ca(sr,()=>t(...s.map(e)),!0)})}function di(t,n=0){var a=Ca(Ha|n,t,!0);return a}function aa(t){return Ca(Fa|Ws,t,!0)}function wo(t){var n=t.teardown;if(n!==null){const a=Ja,r=wt;Mi(!0),On(null);try{n.call(null)}finally{Mi(a),On(r)}}}function So(t,n=!1){var a=t.first;for(t.first=t.last=null;a!==null;){const s=a.ac;s!==null&&Ir(()=>{s.abort(Ms)});var r=a.next;(a.f&Ts)!==0?a.parent=null:Wn(a,n),a=r}}function oc(t){for(var n=t.first;n!==null;){var a=n.next;(n.f&Fa)===0&&Wn(n),n=a}}function Wn(t,n=!0){var a=!1;(n||(t.f&Qi)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(lc(t.nodes.start,t.nodes.end),a=!0),So(t,n&&!a),wr(t,0),un(t,Pa);var r=t.nodes&&t.nodes.t;if(r!==null)for(const i of r)i.stop();wo(t);var s=t.parent;s!==null&&s.first!==null&&Ao(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function lc(t,n){for(;t!==null;){var a=t===n?null:ir(t);t.remove(),t=a}}function Ao(t){var n=t.parent,a=t.prev,r=t.next;a!==null&&(a.next=r),r!==null&&(r.prev=a),n!==null&&(n.first===t&&(n.first=r),n.last===t&&(n.last=a))}function ds(t,n,a=!0){var r=[];Co(t,r,!0);var s=()=>{a&&Wn(t),n&&n()},i=r.length;if(i>0){var o=()=>--i||s();for(var c of r)c.out(o)}else s()}function Co(t,n,a){if((t.f&Vn)===0){t.f^=Vn;var r=t.nodes&&t.nodes.t;if(r!==null)for(const c of r)(c.is_global||a)&&n.push(c);for(var s=t.first;s!==null;){var i=s.next,o=(s.f&Is)!==0||(s.f&Fa)!==0&&(t.f&Ha)!==0;Co(s,n,o?a:!1),s=i}}}function hi(t){Eo(t,!0)}function Eo(t,n){if((t.f&Vn)!==0){t.f^=Vn,(t.f&bn)===0&&(un(t,Dn),Ya(t));for(var a=t.first;a!==null;){var r=a.next,s=(a.f&Is)!==0||(a.f&Fa)!==0;Eo(a,s?n:!1),a=r}var i=t.nodes&&t.nodes.t;if(i!==null)for(const o of i)(o.is_global||n)&&o.in()}}function Mo(t,n){if(t.nodes)for(var a=t.nodes.start,r=t.nodes.end;a!==null;){var s=a===r?null:ir(a);n.append(a),a=s}}let Es=null;function cc(t){var n=Es;try{if(Es=new Set,l(t),n!==null)for(var a of Es)n.add(a);return Es}finally{Es=n}}function Ro(t){for(var n of cc(t))gs(n,n.v)}let hs=!1;function _r(t){hs=t}let Ja=!1;function Mi(t){Ja=t}let wt=null,da=!1;function On(t){wt=t}let Ot=null;function Sa(t){Ot=t}let Wa=null;function uc(t){wt!==null&&(Wa===null?Wa=[t]:Wa.push(t))}let kn=null,Gn=0,ta=null;function mc(t){ta=t}let ko=1,er=0,fs=er;function Ri(t){fs=t}function Lo(){return++ko}function Bs(t){var n=t.f;if((n&Dn)!==0)return!0;if(n&Tn&&(t.f&=~ps),(n&Aa)!==0){for(var a=t.deps,r=a.length,s=0;s<r;s++){var i=a[s];if(Bs(i)&&ho(i),i.wv>t.wv)return!0}(n&sa)!==0&&ma===null&&un(t,bn)}return!1}function Do(t,n,a=!0){var r=t.reactions;if(r!==null&&!Wa?.includes(t))for(var s=0;s<r.length;s++){var i=r[s];(i.f&Tn)!==0?Do(i,n,!1):n===i&&(a?un(i,Dn):(i.f&bn)!==0&&un(i,Aa),Ya(i))}}function Io(t){var n=kn,a=Gn,r=ta,s=wt,i=Wa,o=zt,c=da,d=fs,h=t.f;kn=null,Gn=0,ta=null,wt=(h&(Fa|Ts))===0?t:null,Wa=null,$s(t.ctx),da=!1,fs=++er,t.ac!==null&&(Ir(()=>{t.ac.abort(Ms)}),t.ac=null);try{t.f|=Kr;var m=t.fn,y=m(),u=t.deps;if(kn!==null){var p;if(wr(t,Gn),u!==null&&Gn>0)for(u.length=Gn+kn.length,p=0;p<kn.length;p++)u[Gn+p]=kn[p];else t.deps=u=kn;if(mi()&&(t.f&sa)!==0)for(p=Gn;p<u.length;p++)(u[p].reactions??=[]).push(t)}else u!==null&&Gn<u.length&&(wr(t,Gn),u.length=Gn);if(rr()&&ta!==null&&!da&&u!==null&&(t.f&(Tn|Aa|Dn))===0)for(p=0;p<ta.length;p++)Do(ta[p],t);return s!==null&&s!==t&&(er++,ta!==null&&(r===null?r=ta:r.push(...ta))),(t.f&ja)!==0&&(t.f^=ja),y}catch(g){return ro(g)}finally{t.f^=Kr,kn=n,Gn=a,ta=r,wt=s,Wa=i,$s(o),da=c,fs=d}}function dc(t,n){let a=n.reactions;if(a!==null){var r=cl.call(a,t);if(r!==-1){var s=a.length-1;s===0?a=n.reactions=null:(a[r]=a[s],a.pop())}}if(a===null&&(n.f&Tn)!==0&&(kn===null||!kn.includes(n))){var i=n;(i.f&sa)!==0&&(i.f^=sa,i.f&=~ps),li(i),mo(i),wr(i,0)}}function wr(t,n){var a=t.deps;if(a!==null)for(var r=n;r<a.length;r++)dc(t,a[r])}function Ns(t){var n=t.f;if((n&Pa)===0){un(t,bn);var a=Ot,r=hs;Ot=t,hs=!0;try{(n&(Ha|ji))!==0?oc(t):So(t),wo(t);var s=Io(t);t.teardown=typeof s=="function"?s:null,t.wv=ko;var i;Ur&&Wl&&(t.f&Dn)!==0&&t.deps}finally{hs=r,Ot=a}}}async function hc(){await Promise.resolve(),Bl()}function e(t){var n=t.f,a=(n&Tn)!==0;if(Es?.add(t),wt!==null&&!da){var r=Ot!==null&&(Ot.f&Pa)!==0;if(!r&&!Wa?.includes(t)){var s=wt.deps;if((wt.f&Kr)!==0)t.rv<er&&(t.rv=er,kn===null&&s!==null&&s[Gn]===t?Gn++:kn===null?kn=[t]:kn.includes(t)||kn.push(t));else{(wt.deps??=[]).push(t);var i=t.reactions;i===null?t.reactions=[wt]:i.includes(wt)||i.push(wt)}}}if(Ja&&Qa.has(t))return Qa.get(t);if(a){var o=t;if(Ja){var c=o.v;return((o.f&bn)===0&&o.reactions!==null||Po(o))&&(c=ci(o)),Qa.set(o,c),c}var d=(o.f&sa)===0&&!da&&wt!==null&&(hs||(wt.f&sa)!==0),h=o.deps===null;Bs(o)&&(d&&(o.f|=sa),ho(o)),d&&!h&&$o(o)}if(ma?.has(t))return ma.get(t);if((t.f&ja)!==0)throw t.v;return t.v}function $o(t){if(t.deps!==null){t.f|=sa;for(const n of t.deps)(n.reactions??=[]).push(t),(n.f&Tn)!==0&&(n.f&sa)===0&&$o(n)}}function Po(t){if(t.v===vn)return!0;if(t.deps===null)return!1;for(const n of t.deps)if(Qa.has(n)||(n.f&Tn)!==0&&Po(n))return!0;return!1}function l(t){var n=da;try{return da=!0,t()}finally{da=n}}function Z(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Na in t)Vr(t);else if(!Array.isArray(t))for(let n in t){const a=t[n];typeof a=="object"&&a&&Na in a&&Vr(a)}}}function Vr(t,n=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!n.has(t)){n.add(t),t instanceof Date&&t.getTime();for(let r in t)try{Vr(t[r],n)}catch{}const a=ai(t);if(a!==Object.prototype&&a!==Array.prototype&&a!==Map.prototype&&a!==Set.prototype&&a!==Date.prototype){const r=Xi(a);for(let s in r){const i=r[s].get;if(i)try{i.call(t)}catch{}}}}}const fc=["touchstart","touchmove"];function yc(t){return fc.includes(t)}const pc=new Set,ki=new Set;function vc(t,n,a,r={}){function s(i){if(r.capture||Gs.call(n,i),!i.cancelBubble)return Ir(()=>a?.call(this,i))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Hs(()=>{n.addEventListener(t,s,r)}):n.addEventListener(t,s,r),s}function X(t,n,a,r,s){var i={capture:r,passive:s},o=vc(t,n,a,i);(n===document.body||n===window||n===document||n instanceof HTMLMediaElement)&&or(()=>{n.removeEventListener(t,o,i)})}let Li=null;function Gs(t){var n=this,a=n.ownerDocument,r=t.type,s=t.composedPath?.()||[],i=s[0]||t.target;Li=t;var o=0,c=Li===t&&t.__root;if(c){var d=s.indexOf(c);if(d!==-1&&(n===document||n===window)){t.__root=n;return}var h=s.indexOf(n);if(h===-1)return;d<=h&&(o=d)}if(i=s[o]||t.target,i!==n){zi(t,"currentTarget",{configurable:!0,get(){return i||a}});var m=wt,y=Ot;On(null),Sa(null);try{for(var u,p=[];i!==null;){var g=i.assignedSlot||i.parentNode||i.host||null;try{var _=i["__"+r];_!=null&&(!i.disabled||t.target===i)&&_.call(i,t)}catch(T){u?p.push(T):u=T}if(t.cancelBubble||g===n||g===null)break;i=g}if(u){for(let T of p)queueMicrotask(()=>{throw T});throw u}}finally{t.__root=n,delete t.currentTarget,On(m),Sa(y)}}}function No(t){var n=document.createElement("template");return n.innerHTML=t.replaceAll("<!>","<!---->"),n.content}function Os(t,n){var a=Ot;a.nodes===null&&(a.nodes={start:t,end:n,a:null,t:null})}function pe(t,n){var a=(n&eo)!==0,r=(n&$l)!==0,s,i=!t.startsWith("<!>");return()=>{s===void 0&&(s=No(i?t:"<!>"+t),a||(s=Da(s)));var o=r||po?document.importNode(s,!0):s.cloneNode(!0);if(a){var c=Da(o),d=o.lastChild;Os(c,d)}else Os(o,o);return o}}function gc(t,n,a="svg"){var r=!t.startsWith("<!>"),s=(n&eo)!==0,i=`<${a}>${r?t:"<!>"+t}</${a}>`,o;return()=>{if(!o){var c=No(i),d=Da(c);if(s)for(o=document.createDocumentFragment();Da(d);)o.appendChild(Da(d));else o=Da(d)}var h=o.cloneNode(!0);if(s){var m=Da(h),y=h.lastChild;Os(m,y)}else Os(h,h);return h}}function ge(t,n){return gc(t,n,"svg")}function fi(t=""){{var n=Oa(t+"");return Os(n,n),n}}function _t(){var t=document.createDocumentFragment(),n=document.createComment(""),a=Oa();return t.append(n,a),Os(n,a),t}function M(t,n){t!==null&&t.before(n)}function ke(t,n){var a=n==null?"":typeof n=="object"?n+"":n;a!==(t.__t??=t.nodeValue)&&(t.__t=a,t.nodeValue=a+"")}function bc(t,n){return Tc(t,n)}const Ss=new Map;function Tc(t,{target:n,anchor:a,props:r={},events:s,context:i,intro:o=!0}){ec();var c=new Set,d=y=>{for(var u=0;u<y.length;u++){var p=y[u];if(!c.has(p)){c.add(p);var g=yc(p);n.addEventListener(p,Gs,{passive:g});var _=Ss.get(p);_===void 0?(document.addEventListener(p,Gs,{passive:g}),Ss.set(p,1)):Ss.set(p,_+1)}}};d(Rr(pc)),ki.add(d);var h=void 0,m=rc(()=>{var y=a??n.appendChild(Oa());return Gl(y,{pending:()=>{}},u=>{if(i){Yn({});var p=zt;p.c=i}s&&(r.$$events=s),h=t(u,r)||{},i&&Hn()}),()=>{for(var u of c){n.removeEventListener(u,Gs);var p=Ss.get(u);--p===0?(document.removeEventListener(u,Gs),Ss.delete(u)):Ss.set(u,p)}ki.delete(d),y!==a&&y.parentNode?.removeChild(y)}});return xc.set(h,m),h}let xc=new WeakMap;class _c{anchor;#t=new Map;#i=new Map;#e=new Map;#s=new Set;#r=!0;constructor(n,a=!0){this.anchor=n,this.#r=a}#a=()=>{var n=kt;if(this.#t.has(n)){var a=this.#t.get(n),r=this.#i.get(a);if(r)hi(r),this.#s.delete(a);else{var s=this.#e.get(a);s&&(this.#i.set(a,s.effect),this.#e.delete(a),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),r=s.effect)}for(const[i,o]of this.#t){if(this.#t.delete(i),i===n)break;const c=this.#e.get(o);c&&(Wn(c.effect),this.#e.delete(o))}for(const[i,o]of this.#i){if(i===a||this.#s.has(i))continue;const c=()=>{if(Array.from(this.#t.values()).includes(i)){var h=document.createDocumentFragment();Mo(o,h),h.append(Oa()),this.#e.set(i,{effect:o,fragment:h})}else Wn(o);this.#s.delete(i),this.#i.delete(i)};this.#r||!r?(this.#s.add(i),ds(o,c,!1)):c()}}};#n=n=>{this.#t.delete(n);const a=Array.from(this.#t.values());for(const[r,s]of this.#e)a.includes(r)||(Wn(s.effect),this.#e.delete(r))};ensure(n,a){var r=kt,s=bo();if(a&&!this.#i.has(n)&&!this.#e.has(n))if(s){var i=document.createDocumentFragment(),o=Oa();i.append(o),this.#e.set(n,{effect:aa(()=>a(o)),fragment:i})}else this.#i.set(n,aa(()=>a(this.anchor)));if(this.#t.set(r,n),s){for(const[c,d]of this.#i)c===n?r.skipped_effects.delete(d):r.skipped_effects.add(d);for(const[c,d]of this.#e)c===n?r.skipped_effects.delete(d.effect):r.skipped_effects.add(d.effect);r.oncommit(this.#a),r.ondiscard(this.#n)}else this.#a()}}function ee(t,n,a=!1){var r=new _c(t),s=a?Is:0;function i(o,c){r.ensure(o,c)}di(()=>{var o=!1;n((c,d=!0)=>{o=!0,i(d,c)}),o||i(!1,null)},s)}function ot(t,n){return n}function wc(t,n,a){for(var r=[],s=n.length,i,o=n.length,c=0;c<s;c++){let y=n[c];ds(y,()=>{if(i){if(i.pending.delete(y),i.done.add(y),i.pending.size===0){var u=t.outrogroups;jr(Rr(i.done)),u.delete(i),u.size===0&&(t.outrogroups=null)}}else o-=1},!1)}if(o===0){var d=r.length===0&&a!==null;if(d){var h=a,m=h.parentNode;tc(m),m.append(h),t.items.clear()}jr(n,!d)}else i={pending:new Set(n),done:new Set},(t.outrogroups??=new Set).add(i)}function jr(t,n=!0){for(var a=0;a<t.length;a++)Wn(t[a],n)}var Di;function He(t,n,a,r,s,i=null){var o=t,c=new Map,d=(n&Ji)!==0;if(d){var h=t;o=h.appendChild(Oa())}var m=null,y=Ie(()=>{var E=a();return ar(E)?E:E==null?[]:Rr(E)}),u,p=!0;function g(){T.fallback=m,Sc(T,u,o,n,r),m!==null&&(u.length===0?(m.f&$a)===0?hi(m):(m.f^=$a,zs(m,null,o)):ds(m,()=>{m=null}))}var _=di(()=>{u=e(y);for(var E=u.length,k=new Set,L=kt,w=bo(),A=0;A<E;A+=1){var R=u[A],D=r(R,A),C=p?null:c.get(D);C?(C.v&&gs(C.v,R),C.i&&gs(C.i,A),w&&L.skipped_effects.delete(C.e)):(C=Ac(c,p?o:Di??=Oa(),R,D,A,s,n,a),p||(C.e.f|=$a),c.set(D,C)),k.add(D)}if(E===0&&i&&!m&&(p?m=aa(()=>i(o)):(m=aa(()=>i(Di??=Oa())),m.f|=$a)),!p)if(w){for(const[$,H]of c)k.has($)||L.skipped_effects.add(H.e);L.oncommit(g),L.ondiscard(()=>{})}else g();e(y)}),T={effect:_,items:c,outrogroups:null,fallback:m};p=!1}function Sc(t,n,a,r,s){var i=(r&El)!==0,o=n.length,c=t.items,d=t.effect.first,h,m=null,y,u=[],p=[],g,_,T,E;if(i)for(E=0;E<o;E+=1)g=n[E],_=s(g,E),T=c.get(_).e,(T.f&$a)===0&&(T.nodes?.a?.measure(),(y??=new Set).add(T));for(E=0;E<o;E+=1){if(g=n[E],_=s(g,E),T=c.get(_).e,t.outrogroups!==null)for(const H of t.outrogroups)H.pending.delete(T),H.done.delete(T);if((T.f&$a)!==0)if(T.f^=$a,T===d)zs(T,null,a);else{var k=m?m.next:d;T===t.effect.last&&(t.effect.last=T.prev),T.prev&&(T.prev.next=T.next),T.next&&(T.next.prev=T.prev),Ka(t,m,T),Ka(t,T,k),zs(T,k,a),m=T,u=[],p=[],d=m.next;continue}if((T.f&Vn)!==0&&(hi(T),i&&(T.nodes?.a?.unfix(),(y??=new Set).delete(T))),T!==d){if(h!==void 0&&h.has(T)){if(u.length<p.length){var L=p[0],w;m=L.prev;var A=u[0],R=u[u.length-1];for(w=0;w<u.length;w+=1)zs(u[w],L,a);for(w=0;w<p.length;w+=1)h.delete(p[w]);Ka(t,A.prev,R.next),Ka(t,m,A),Ka(t,R,L),d=L,m=R,E-=1,u=[],p=[]}else h.delete(T),zs(T,d,a),Ka(t,T.prev,T.next),Ka(t,T,m===null?t.effect.first:m.next),Ka(t,m,T),m=T;continue}for(u=[],p=[];d!==null&&d!==T;)(h??=new Set).add(d),p.push(d),d=d.next;if(d===null)continue}(T.f&$a)===0&&u.push(T),m=T,d=T.next}if(t.outrogroups!==null){for(const H of t.outrogroups)H.pending.size===0&&(jr(Rr(H.done)),t.outrogroups?.delete(H));t.outrogroups.size===0&&(t.outrogroups=null)}if(d!==null||h!==void 0){var D=[];if(h!==void 0)for(T of h)(T.f&Vn)===0&&D.push(T);for(;d!==null;)(d.f&Vn)===0&&d!==t.fallback&&D.push(d),d=d.next;var C=D.length;if(C>0){var $=(r&Ji)!==0&&o===0?a:null;if(i){for(E=0;E<C;E+=1)D[E].nodes?.a?.measure();for(E=0;E<C;E+=1)D[E].nodes?.a?.fix()}wc(t,D,$)}}i&&Hs(()=>{if(y!==void 0)for(T of y)T.nodes?.a?.apply()})}function Ac(t,n,a,r,s,i,o,c){var d=(o&Al)!==0?(o&Ml)===0?O(a,!1,!1):vs(a):null,h=(o&Cl)!==0?vs(s):null;return{v:d,i:h,e:aa(()=>(i(n,d??a,h??s,c),()=>{t.delete(r)}))}}function zs(t,n,a){if(t.nodes)for(var r=t.nodes.start,s=t.nodes.end,i=n&&(n.f&$a)===0?n.nodes.start:a;r!==null;){var o=ir(r);if(i.before(r),r===s)return;r=o}}function Ka(t,n,a){n===null?t.effect.first=a:n.next=a,a===null?t.effect.last=n:a.prev=n}function Oo(t,n,a,r,s){var i=n.$$slots?.[a],o=!1;i===!0&&(i=n.children,o=!0),i===void 0||i(t,o?()=>r:r)}const Ii=[...` 	
\r\fÂ \v\uFEFF`];function Cc(t,n,a){var r=t==null?"":""+t;if(a){for(var s in a)if(a[s])r=r?r+" "+s:s;else if(r.length)for(var i=s.length,o=0;(o=r.indexOf(s,o))>=0;){var c=o+i;(o===0||Ii.includes(r[o-1]))&&(c===r.length||Ii.includes(r[c]))?r=(o===0?"":r.substring(0,o))+r.substring(c+1):o=c}}return r===""?null:r}function Ec(t,n){return t==null?null:String(t)}function gn(t,n,a,r,s,i){var o=t.__className;if(o!==a||o===void 0){var c=Cc(a,r,i);c==null?t.removeAttribute("class"):n?t.className=c:t.setAttribute("class",c),t.__className=a}else if(i&&s!==i)for(var d in i){var h=!!i[d];(s==null||h!==!!s[d])&&t.classList.toggle(d,h)}return i}function Mc(t,n,a,r){var s=t.__style;if(s!==n){var i=Ec(n);i==null?t.removeAttribute("style"):t.style.cssText=i,t.__style=n}return r}function Wo(t,n,a=!1){if(t.multiple){if(n==null)return;if(!ar(n))return Nl();for(var r of t.options)r.selected=n.includes(Js(r));return}for(r of t.options){var s=Js(r);if(Jl(s,n)){r.selected=!0;return}}(!a||n!==void 0)&&(t.selectedIndex=-1)}function Rc(t){var n=new MutationObserver(()=>{Wo(t,t.__value)});n.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),or(()=>{n.disconnect()})}function Yo(t,n,a=n){var r=new WeakSet,s=!0;ui(t,"change",i=>{var o=i?"[selected]":":checked",c;if(t.multiple)c=[].map.call(t.querySelectorAll(o),Js);else{var d=t.querySelector(o)??t.querySelector("option:not([disabled])");c=d&&Js(d)}a(c),kt!==null&&r.add(kt)}),_o(()=>{var i=n();if(t===document.activeElement){var o=js??kt;if(r.has(o))return}if(Wo(t,i,s),s&&i===void 0){var c=t.querySelector(":checked");c!==null&&(i=Js(c),a(i))}t.__value=i,s=!1}),Rc(t)}function Js(t){return"__value"in t?t.__value:t.value}const kc=Symbol("is custom element"),Lc=Symbol("is html");function Ho(t,n){var a=Fo(t);a.value===(a.value=n??void 0)||t.value===n&&(n!==0||t.nodeName!=="PROGRESS")||(t.value=n??"")}function f(t,n,a,r){var s=Fo(t);s[n]!==(s[n]=a)&&(n==="loading"&&(t[fl]=a),a==null?t.removeAttribute(n):typeof a!="string"&&Dc(t).includes(n)?t[n]=a:t.setAttribute(n,a))}function Fo(t){return t.__attributes??={[kc]:t.nodeName.includes("-"),[Lc]:t.namespaceURI===Pl}}var $i=new Map;function Dc(t){var n=t.getAttribute("is")||t.nodeName,a=$i.get(n);if(a)return a;$i.set(n,a=[]);for(var r,s=t,i=Element.prototype;i!==s;){r=Xi(s);for(var o in r)r[o].set&&a.push(o);s=ai(s)}return a}function Mn(t,n,a=n){var r=new WeakSet;ui(t,"input",async s=>{var i=s?t.defaultValue:t.value;if(i=Hr(t)?Fr(i):i,a(i),kt!==null&&r.add(kt),await hc(),i!==(i=n())){var o=t.selectionStart,c=t.selectionEnd,d=t.value.length;if(t.value=i??"",c!==null){var h=t.value.length;o===c&&c===d&&h>d?(t.selectionStart=h,t.selectionEnd=h):(t.selectionStart=o,t.selectionEnd=Math.min(c,h))}}}),l(n)==null&&t.value&&(a(Hr(t)?Fr(t.value):t.value),kt!==null&&r.add(kt)),Fs(()=>{var s=n();if(t===document.activeElement){var i=js??kt;if(r.has(i))return}Hr(t)&&s===Fr(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function Sn(t,n,a=n){ui(t,"change",r=>{var s=r?t.defaultChecked:t.checked;a(s)}),l(n)==null&&a(t.checked),Fs(()=>{var r=n();t.checked=!!r})}function Hr(t){var n=t.type;return n==="number"||n==="range"}function Fr(t){return t===""?null:+t}function Xs(t,n,a){var r=ms(t,n);r&&r.set&&(t[n]=a,or(()=>{t[n]=null}))}function Pi(t,n){return t===n||t?.[Na]===n}function Sr(t={},n,a,r){return _o(()=>{var s,i;return Fs(()=>{s=i,i=[],l(()=>{t!==a(...i)&&(n(t,...i),s&&Pi(a(...s),t)&&n(null,...s))})}),()=>{Hs(()=>{i&&Pi(a(...i),t)&&n(null,...i)})}}),t}function Ni(t){return function(...n){var a=n[0];return a.stopPropagation(),t?.apply(this,n)}}function jn(t=!1){const n=zt,a=n.l.u;if(!a)return;let r=()=>Z(n.s);if(t){let s=0,i={};const o=Dr(()=>{let c=!1;const d=n.s;for(const h in d)d[h]!==i[h]&&(i[h]=d[h],c=!0);return c&&s++,s});r=()=>e(o)}a.b.length&&sc(()=>{Oi(n,r),br(a.b)}),Xr(()=>{const s=l(()=>a.m.map(dl));return()=>{for(const i of s)typeof i=="function"&&i()}}),a.a.length&&Xr(()=>{Oi(n,r),br(a.a)})}function Oi(t,n){if(t.l.s)for(const a of t.l.s)e(a);n()}function Wi(t,n){var a=t.$$events?.[n.type],r=ar(a)?a.slice():a==null?[]:[a];for(var s of r)s.call(this,n)}function yi(t,n,a){if(t==null)return n(void 0),a&&a(void 0),Va;const r=l(()=>t.subscribe(n,a));return r.unsubscribe?()=>r.unsubscribe():r}const As=[];function Ic(t,n){return{subscribe:rn(t,n).subscribe}}function rn(t,n=Va){let a=null;const r=new Set;function s(c){if(no(t,c)&&(t=c,a)){const d=!As.length;for(const h of r)h[1](),As.push(h,t);if(d){for(let h=0;h<As.length;h+=2)As[h][0](As[h+1]);As.length=0}}}function i(c){s(c(t))}function o(c,d=Va){const h=[c,d];return r.add(h),r.size===1&&(a=n(s,i)||Va),c(t),()=>{r.delete(h),r.size===0&&a&&(a(),a=null)}}return{set:s,update:i,subscribe:o}}function Ba(t,n,a){const r=!Array.isArray(t),s=r?[t]:t;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=n.length<2;return Ic(a,(o,c)=>{let d=!1;const h=[];let m=0,y=Va;const u=()=>{if(m)return;y();const g=n(r?h[0]:h,o,c);i?o(g):y=typeof g=="function"?g:Va},p=s.map((g,_)=>yi(g,T=>{h[_]=T,m&=~(1<<_),d&&u()},()=>{m|=1<<_}));return d=!0,u(),function(){br(p),y(),d=!1}})}function ha(t){let n;return yi(t,a=>n=a)(),n}let ur=!1,Qr=Symbol();function Lt(t,n,a){const r=a[n]??={store:null,source:O(void 0),unsubscribe:Va};if(r.store!==t&&!(Qr in a))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=Va;else{var s=!0;r.unsubscribe=yi(t,i=>{s?r.source.v=i:v(r.source,i)}),s=!1}return t&&Qr in a?ha(t):e(r.source)}function $c(t,n){return t.set(n),n}function qs(){const t={};function n(){or(()=>{for(var a in t)t[a].unsubscribe();zi(t,Qr,{enumerable:!1,value:!0})})}return[t,n]}function Pc(t){var n=ur;try{return ur=!1,[t(),ur]}finally{ur=n}}function Xe(t,n,a,r){var s=!Ys||(a&kl)!==0,i=(a&Dl)!==0,o=(a&Il)!==0,c=r,d=!0,h=()=>(d&&(d=!1,c=o?l(r):r),c),m;if(i){var y=Na in t||hl in t;m=ms(t,n)?.set??(y&&n in t?L=>t[n]=L:void 0)}var u,p=!1;i?[u,p]=Pc(()=>t[n]):u=t[n],u===void 0&&r!==void 0&&(u=h(),m&&(s&&Tl(),m(u)));var g;if(s?g=()=>{var L=t[n];return L===void 0?h():(d=!0,L)}:g=()=>{var L=t[n];return L!==void 0&&(c=void 0),L===void 0?c:L},s&&(a&Ll)===0)return g;if(m){var _=t.$$legacy;return(function(L,w){return arguments.length>0?((!s||!w||_||p)&&m(w?g():L),L):g()})}var T=!1,E=((a&Rl)!==0?Dr:Ie)(()=>(T=!1,g()));i&&e(E);var k=Ot;return(function(L,w){if(arguments.length>0){const A=w?e(E):s&&i?Rs(L):L;return v(E,A),T=!0,c!==void 0&&(c=A),L}return Ja&&T||(k.f&Pa)!==0?E.v:e(E)})}function xs(t){zt===null&&oi(),Ys&&zt.l!==null?Oc(zt).m.push(t):Xr(()=>{const n=l(t);if(typeof n=="function")return n})}function pi(t){zt===null&&oi(),xs(()=>()=>l(t))}function Nc(t,n,{bubbles:a=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:n,bubbles:a,cancelable:r})}function Bo(){const t=zt;return t===null&&oi(),(n,a,r)=>{const s=t.s.$$events?.[n];if(s){const i=ar(s)?s.slice():[s],o=Nc(n,a,r);for(const c of i)c.call(t.x,o);return!o.defaultPrevented}return!0}}function Oc(t){var n=t.l;return n.u??={a:[],b:[],m:[]}}const Wc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Wc);Yl();function Yc(t,n,a,r){const s=Ls(a,r,t),i=Ls(a,r,n),o=Ls(t,n,a),c=Ls(t,n,r);return!!((s>0&&i<0||s<0&&i>0)&&(o>0&&c<0||o<0&&c>0)||s===0&&mr(a,r,t)||i===0&&mr(a,r,n)||o===0&&mr(t,n,a)||c===0&&mr(t,n,r))}function Ls(t,n,a){return(a.x-t.x)*(n.y-t.y)-(n.x-t.x)*(a.y-t.y)}function mr(t,n,a){return Math.min(t.x,n.x)<=a.x&&a.x<=Math.max(t.x,n.x)&&Math.min(t.y,n.y)<=a.y&&a.y<=Math.max(t.y,n.y)}function Yi(t,n,a,r=16){const s=[];for(let i=0;i<r;i++){const o=2*Math.PI*i/r;s.push({x:t+a*Math.cos(o),y:n+a*Math.sin(o)})}return s}function Hc(t,n,a,r,s=0,i=16){const o=[],c=2*(a+r),d=s*Math.PI/180,h=Math.cos(d),m=Math.sin(d),y=i/c,u=Math.max(1,Math.round(a*y)),p=Math.max(1,Math.round(r*y)),g=a/2,_=r/2,T=[];for(let E=0;E<u;E++){const k=E/u;T.push({x:-g+a*k,y:-_})}for(let E=0;E<p;E++){const k=E/p;T.push({x:g,y:-_+r*k})}for(let E=0;E<u;E++){const k=E/u;T.push({x:g-a*k,y:_})}for(let E=0;E<p;E++){const k=E/p;T.push({x:-g,y:_-r*k})}for(const E of T)o.push({x:t+E.x*h-E.y*m,y:n+E.x*m+E.y*h});if(o.length>i){const E=[],k=o.length/i;for(let L=0;L<i;L++)E.push(o[Math.floor(L*k)]);return E}return o}function Fc(t,n,a,r,s=0,i=16){const o=[],c=s*Math.PI/180,d=Math.cos(c),h=Math.sin(c);for(let m=0;m<i;m++){const y=2*Math.PI*m/i,u=a*Math.cos(y),p=r*Math.sin(y);o.push({x:t+u*d-p*h,y:n+u*h+p*d})}return o}function Hi(t,n,a){const r=a.length;for(let s=0;s<r;s++){const i=a[s],o=a[(s+1)%r];if(Yc(t,n,i,o))return!0}return!1}function qo(t,n,a){const r=a*Math.PI/180,s=Math.cos(r),i=Math.sin(r),o=t.x-n.x,c=t.y-n.y;return{x:n.x+o*s-c*i,y:n.y+o*i+c*s}}function Uo(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function bs(t){const n=Uo(t),a=t.rotation||0;return[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}].map(s=>qo(s,n,a))}function Bc(t){const s=t.x,i=t.y+t.height;return[{x:s,y:i},{x:s,y:i-8},{x:s+.5,y:i-8},{x:s+.5,y:i-.5},{x:s+4,y:i-.5},{x:s+4,y:i}]}function qc(t){const n=Bc(t),a=Uo(t),r=t.rotation||0;return n.map(s=>qo(s,a,r))}function Ar(t,n){const a=n.length;let r=null;for(let s=0;s<a;s++){const i=n[s],o=n[(s+1)%a],c=(o.x-i.x)*(t.y-i.y)-(o.y-i.y)*(t.x-i.x);if(c!==0){const d=c>0;if(r===null)r=d;else if(r!==d)return!1}}return!0}function Uc(t,n,a,r,s=.01){const i=Math.abs(Ls(t,n,a)),o=Math.abs(Ls(t,n,r)),c=Math.sqrt((n.x-t.x)**2+(n.y-t.y)**2),d=s*c;if(i>d||o>d)return!1;const h=n.x-t.x,m=n.y-t.y,y=Math.sqrt(h*h+m*m);if(y<s)return!1;const u=h/y,p=m/y,g=0,_=y,T=(a.x-t.x)*u+(a.y-t.y)*p,E=(r.x-t.x)*u+(r.y-t.y)*p,k=Math.min(g,_),L=Math.max(g,_),w=Math.min(T,E),A=Math.max(T,E),R=Math.max(k,w);return Math.min(L,A)-R>s}function Kc(t,n,a=.1){const r=t.length,s=n.length;for(let i=0;i<r;i++){const o=t[i],c=t[(i+1)%r];for(let d=0;d<s;d++){const h=n[d],m=n[(d+1)%s];if(Uc(o,c,h,m,a))return!0}}return!1}function Gc(t){const n=t.length;if(n===0)return new Map;const a=Array.from({length:n},(c,d)=>d);function r(c){return a[c]!==c&&(a[c]=r(a[c])),a[c]}function s(c,d){const h=r(c),m=r(d);h!==m&&(a[h]=m)}for(let c=0;c<n;c++)for(let d=c+1;d<n;d++)Kc(t[c].vertices,t[d].vertices)&&s(c,d);const i=new Map;t.forEach((c,d)=>i.set(c.id,d));const o=new Map;return t.forEach((c,d)=>{o.set(c.id,r(d))}),o}function zc(t,n,a){const r=n.get(t);return r===void 0?[t]:a.filter(s=>n.get(s.id)===r).map(s=>s.id)}const dr=16;function Cr(t){return t.isRectangle&&t.width!==void 0&&t.height!==void 0?Hc(t.x,t.y,t.width,t.height,t.rotation||0,dr):t.radius!==void 0?Yi(t.x,t.y,t.radius,dr):t.rx!==void 0&&t.ry!==void 0?Fc(t.x,t.y,t.rx,t.ry,t.rotation||0,dr):Yi(t.x,t.y,.5,dr)}function Xc(t,n){const a=Cr(t);for(const r of a)if(Ar(r,n))return!0;return!!Ar({x:t.x,y:t.y},n)}function Vc(t,n){if(!Ar({x:t.x,y:t.y},n))return!1;const a=Cr(t);for(const r of a)if(!Ar(r,n))return!1;return!0}function vi(t,n,a,r){const s=Cr(t),i=Cr(n),o=Gc(a),c=new Set;for(const y of a){const u=Vc(t,y.vertices),p=Xc(n,y.vertices);if(u||p){const g=zc(y.id,o,a);for(const _ of g)c.add(_)}}const d=[];let h=!1,m=null;for(const y of s)for(const u of i){const p={from:y,to:u,blocked:!1,blockedBy:null};let g=!1;for(const T of a)if(!c.has(T.id)&&Hi(y,u,T.vertices)){p.blocked=!0,p.blockedBy="terrain",g=!0;break}if(g){d.push(p);continue}let _=!1;for(const T of r)if(Hi(y,u,T)){p.blocked=!0,p.blockedBy="wall",_=!0;break}_||(p.blocked=!1,h||(m=p),h=!0),d.push(p)}return{canSee:h,rays:d,firstClearRay:m,terrainsIgnored:Array.from(c)}}const et={width:60,height:44},Ko=rn([{id:"terrain1",x:20,y:16,width:6,height:12,rotation:0},{id:"terrain2",x:34,y:10,width:6,height:12,rotation:45},{id:"terrain3",x:44,y:20,width:6,height:12,rotation:-30}]);Ba(Ko,t=>t.map(n=>qc(n)));Ba(Ko,t=>t.map(n=>({id:n.id,vertices:bs(n)})));const Fi=rn(!1);var jc=ge('<line stroke="#3a4a3a" stroke-width="0.05"></line>'),Qc=ge('<line stroke="#3a4a3a" stroke-width="0.05"></line>'),Zc=ge('<line stroke="#5a6a5a" stroke-width="0.08"></line>'),Jc=ge('<line stroke="#5a6a5a" stroke-width="0.08"></line>'),eu=ge('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),tu=ge('<line stroke="#666"></line><!>',1),nu=ge('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),au=ge('<line stroke="#666"></line><!>',1),su=ge('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),ru=ge('<line stroke="#666"></line><!>',1),iu=ge('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),ou=ge('<line stroke="#666"></line><!>',1),lu=ge('<svg preserveAspectRatio="xMidYMid meet"><rect x="0" y="0" fill="#1a1a1a"></rect><rect fill="#4a5a4a"></rect><!><!><!><!><!><!><!><!><g><!></g></svg>');function lr(t,n){Yn(n,!1);const a=O(),r=O(),s=O(),i=O(),o=O(),c=O(),d=O();let h=O();const m=2,y=et.width+m*2,u=et.height+m*2;let p=O(1),g=O(0),_=O(0),T=O(!1),E={x:0,y:0},k=O(!1);const L=.5,w=4;function A(fe,te){if(!e(h))return{x:0,y:0};const Ke=e(h).createSVGPoint();Ke.x=fe,Ke.y=te;const Ce=Ke.matrixTransform(e(h).getScreenCTM().inverse());return{x:Ce.x-m,y:Ce.y-m}}function R(fe){fe.preventDefault();const te=e(h).getBoundingClientRect(),Ke=fe.clientX-te.left,Ce=fe.clientY-te.top,Dt=e(s)+Ke/te.width*e(a),lt=e(i)+Ce/te.height*e(r),nt=fe.deltaY>0?.9:1.1,ct=Math.max(L,Math.min(w,e(p)*nt)),it=y/ct,ht=u/ct,Rt=Dt-Ke/te.width*it,ae=lt-Ce/te.height*ht;v(p,ct),v(g,Rt),v(_,ae)}function D(fe){(fe.button===1||fe.button===0&&e(k))&&(fe.preventDefault(),v(T,!0),E={x:fe.clientX,y:fe.clientY})}function C(fe){if(!e(T))return;const te=e(h).getBoundingClientRect(),Ke=(fe.clientX-E.x)/te.width*e(a),Ce=(fe.clientY-E.y)/te.height*e(r);v(g,e(g)-Ke),v(_,e(_)-Ce),E={x:fe.clientX,y:fe.clientY}}function $(){v(T,!1)}function H(fe){fe.code==="Space"&&!fe.repeat&&fe.target.tagName!=="INPUT"&&(fe.preventDefault(),v(k,!0))}function oe(fe){fe.code==="Space"&&v(k,!1)}function N(){v(p,1),v(g,0),v(_,0)}ye(()=>e(p),()=>{v(a,y/e(p))}),ye(()=>e(p),()=>{v(r,u/e(p))}),ye(()=>e(g),()=>{v(s,e(g))}),ye(()=>e(_),()=>{v(i,e(_))}),ye(()=>(e(s),e(i),e(a),e(r)),()=>{v(o,`${e(s)} ${e(i)} ${e(a)} ${e(r)}`)}),ye(()=>et,()=>{v(c,Array.from({length:et.width+1},(fe,te)=>te))}),ye(()=>et,()=>{v(d,Array.from({length:et.height+1},(fe,te)=>te))}),Ea();var he={screenToSvg:A};jn();var we=lu();X("keydown",ks,H),X("keyup",ks,oe),X("mouseup",ks,$),X("mousemove",ks,C);let ne;var se=x(we),ce=b(se);f(ce,"x",m),f(ce,"y",m);var be=b(ce);He(be,1,()=>(Z(et),l(()=>Array(et.width+1))),ot,(fe,te,Ke)=>{var Ce=jc();f(Ce,"x1",m+Ke),f(Ce,"y1",m),f(Ce,"x2",m+Ke),q(()=>f(Ce,"y2",(Z(et),l(()=>m+et.height)))),M(fe,Ce)});var De=b(be);He(De,1,()=>(Z(et),l(()=>Array(et.height+1))),ot,(fe,te,Ke)=>{var Ce=Qc();f(Ce,"x1",m),f(Ce,"y1",m+Ke),f(Ce,"y2",m+Ke),q(()=>f(Ce,"x2",(Z(et),l(()=>m+et.width)))),M(fe,Ce)});var J=b(De);He(J,1,()=>(Z(et),l(()=>Array(Math.floor(et.width/6)+1))),ot,(fe,te,Ke)=>{var Ce=Zc();f(Ce,"x1",m+Ke*6),f(Ce,"y1",m),f(Ce,"x2",m+Ke*6),q(()=>f(Ce,"y2",(Z(et),l(()=>m+et.height)))),M(fe,Ce)});var U=b(J);He(U,1,()=>(Z(et),l(()=>Array(Math.floor(et.height/6)+1))),ot,(fe,te,Ke)=>{var Ce=Jc();f(Ce,"x1",m),f(Ce,"y1",m+Ke*6),f(Ce,"y2",m+Ke*6),q(()=>f(Ce,"x2",(Z(et),l(()=>m+et.width)))),M(fe,Ce)});var V=b(U);He(V,1,()=>e(c),ot,(fe,te)=>{var Ke=tu(),Ce=_e(Ke);f(Ce,"y2",m);var Dt=b(Ce);{var lt=nt=>{var ct=eu();f(ct,"y",1.2);var it=x(ct);q(()=>{f(ct,"x",m+e(te)),ke(it,`${e(te)??""}"`)}),M(nt,ct)};ee(Dt,nt=>{e(te)%6===0&&nt(lt)})}q(()=>{f(Ce,"x1",m+e(te)),f(Ce,"y1",e(te)%6===0?.5:m-.8),f(Ce,"x2",m+e(te)),f(Ce,"stroke-width",e(te)%6===0?.08:.04)}),M(fe,Ke)});var xe=b(V);He(xe,1,()=>e(c),ot,(fe,te)=>{var Ke=au(),Ce=_e(Ke),Dt=b(Ce);{var lt=nt=>{var ct=nu(),it=x(ct);q(()=>{f(ct,"x",m+e(te)),f(ct,"y",(Z(et),l(()=>m+et.height+1.8))),ke(it,`${e(te)??""}"`)}),M(nt,ct)};ee(Dt,nt=>{e(te)%6===0&&nt(lt)})}q(()=>{f(Ce,"x1",m+e(te)),f(Ce,"y1",(Z(et),l(()=>m+et.height))),f(Ce,"x2",m+e(te)),f(Ce,"y2",(Z(et),e(te),l(()=>m+et.height+(e(te)%6===0?1.5:.8)))),f(Ce,"stroke-width",e(te)%6===0?.08:.04)}),M(fe,Ke)});var Y=b(xe);He(Y,1,()=>e(d),ot,(fe,te)=>{var Ke=ru(),Ce=_e(Ke);f(Ce,"x2",m);var Dt=b(Ce);{var lt=nt=>{var ct=su();f(ct,"x",1);var it=x(ct);q(()=>{f(ct,"y",m+e(te)+.35),ke(it,`${e(te)??""}"`)}),M(nt,ct)};ee(Dt,nt=>{e(te)%6===0&&nt(lt)})}q(()=>{f(Ce,"x1",e(te)%6===0?.5:m-.8),f(Ce,"y1",m+e(te)),f(Ce,"y2",m+e(te)),f(Ce,"stroke-width",e(te)%6===0?.08:.04)}),M(fe,Ke)});var ve=b(Y);He(ve,1,()=>e(d),ot,(fe,te)=>{var Ke=ou(),Ce=_e(Ke),Dt=b(Ce);{var lt=nt=>{var ct=iu(),it=x(ct);q(()=>{f(ct,"x",(Z(et),l(()=>m+et.width+1))),f(ct,"y",m+e(te)+.35),ke(it,`${e(te)??""}"`)}),M(nt,ct)};ee(Dt,nt=>{e(te)%6===0&&nt(lt)})}q(()=>{f(Ce,"x1",(Z(et),l(()=>m+et.width))),f(Ce,"y1",m+e(te)),f(Ce,"x2",(Z(et),e(te),l(()=>m+et.width+(e(te)%6===0?1.5:.8)))),f(Ce,"y2",m+e(te)),f(Ce,"stroke-width",e(te)%6===0?.08:.04)}),M(fe,Ke)});var Me=b(ve);f(Me,"transform","translate(2, 2)");var dt=x(Me);return Oo(dt,n,"default",{screenToSvg:A}),Sr(we,fe=>v(h,fe),()=>e(h)),q(()=>{f(we,"viewBox",e(o)),ne=gn(we,0,"battlefield svelte-n43bnt",null,ne,{panning:e(T)||e(k)}),f(se,"width",(Z(et),l(()=>et.width+m*2))),f(se,"height",(Z(et),l(()=>et.height+m*2))),f(ce,"width",(Z(et),l(()=>et.width))),f(ce,"height",(Z(et),l(()=>et.height)))}),X("wheel",we,R),X("mousedown",we,D),X("dblclick",we,N),M(t,we),Xs(n,"screenToSvg",A),Hn(he)}var cu=ge('<line stroke="#3b82f6" stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" fill="#3b82f6" stroke="#1d4ed8" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-trljjm"></circle>',1),uu=ge('<g><g><rect role="button" tabindex="0" class="svelte-trljjm"></rect></g><!></g>');function Go(t,n){Yn(n,!1);const a=O(),r=O(),s=O(),i=O(),o=O();let c=Xe(n,"id",8),d=Xe(n,"x",8),h=Xe(n,"y",8),m=Xe(n,"width",8),y=Xe(n,"height",8),u=Xe(n,"rotation",8,0),p=Xe(n,"selected",8,!1),g=Xe(n,"screenToSvg",8),_=Xe(n,"onSelect",8,()=>{}),T=Xe(n,"onDrag",8,()=>{}),E=Xe(n,"onRotate",8,()=>{}),k=O(!1),L=!1,w={x:0,y:0};function A(be){be.stopPropagation(),_()(c())}function R(be){if(be.button!==0)return;be.preventDefault(),be.stopPropagation(),_()(c()),v(k,!0);const De=g()(be.clientX,be.clientY);w={x:De.x-d(),y:De.y-h()},window.addEventListener("mousemove",D),window.addEventListener("mouseup",C)}function D(be){if(!e(k))return;const De=g()(be.clientX,be.clientY);let J=De.x-w.x,U=De.y-w.y;be.shiftKey||(J=Math.round(J),U=Math.round(U));const V=Math.max(m(),y())/2;J=Math.max(-V,Math.min(et.width-m()+V,J)),U=Math.max(-V,Math.min(et.height-y()+V,U)),T()(c(),J,U)}function C(){v(k,!1),window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",C)}function $(be){be.preventDefault(),be.stopPropagation(),L=!0,window.addEventListener("mousemove",H),window.addEventListener("mouseup",oe)}function H(be){if(!L)return;const De=g()(be.clientX,be.clientY),J=De.x-e(a),U=De.y-e(r);let V=Math.atan2(U,J)*180/Math.PI+45;be.shiftKey||(V=Math.round(V/15)*15),E()(c(),V)}function oe(){L=!1,window.removeEventListener("mousemove",H),window.removeEventListener("mouseup",oe)}ye(()=>(Z(d()),Z(m())),()=>{v(a,d()+m()/2)}),ye(()=>(Z(h()),Z(y())),()=>{v(r,h()+y()/2)}),ye(()=>(Z(m()),Z(y())),()=>{v(s,Math.max(m(),y())/2+1.5)}),ye(()=>(e(a),e(s),Z(u())),()=>{v(i,e(a)+e(s)*Math.cos((u()-45)*Math.PI/180))}),ye(()=>(e(r),e(s),Z(u())),()=>{v(o,e(r)+e(s)*Math.sin((u()-45)*Math.PI/180))}),Ea(),jn();var N=uu();let he;var we=x(N),ne=x(we),se=b(we);{var ce=be=>{var De=cu(),J=_e(De),U=b(J);q(()=>{f(J,"x1",e(a)),f(J,"y1",e(r)),f(J,"x2",e(i)),f(J,"y2",e(o)),f(U,"cx",e(i)),f(U,"cy",e(o))}),X("mousedown",U,$),M(be,De)};ee(se,be=>{p()&&be(ce)})}q(()=>{he=gn(N,0,"terrain-rect svelte-trljjm",null,he,{selected:p(),dragging:e(k)}),f(we,"transform",`rotate(${u()??""}, ${e(a)??""}, ${e(r)??""})`),f(ne,"x",d()),f(ne,"y",h()),f(ne,"width",m()),f(ne,"height",y()),f(ne,"fill",p()?"rgba(59, 130, 246, 0.3)":"rgba(139, 90, 43, 0.3)"),f(ne,"stroke",p()?"#3b82f6":"#8b5a2b"),f(ne,"stroke-width",p()?.15:.1)}),X("click",ne,A),X("mousedown",ne,R),M(t,N),Hn()}const zo="warhammer-deployment-layouts",Xo=[{label:'6" x 12"',width:6,height:12},{label:'5" x 10"',width:5,height:10},{label:'4" x 6"',width:4,height:6}],Zr=[{label:"L 4x8",shape:"L-4x8"},{label:"L 4x8 â",shape:"L-4x8-mirror"},{label:"C 4-8-4",shape:"C-4-8-4"},{label:"L 5x6",shape:"L-5x6"},{label:"L 5x6 â",shape:"L-5x6-mirror"},{label:"L 4x6",shape:"L-4x6"},{label:"L 4x6 â",shape:"L-4x6-mirror"}],gi=[{name:"Layout 1",terrains:[{id:"a",x:28,y:0,width:4,height:6,rotation:0},{id:"b",x:28,y:38,width:4,height:6,rotation:0},{id:"c",x:6,y:5,width:6,height:12,rotation:0},{id:"d",x:48,y:27,width:6,height:12,rotation:0},{id:"e",x:16,y:28,width:6,height:12,rotation:0},{id:"f",x:7,y:19,width:6,height:12,rotation:90},{id:"g",x:38,y:4,width:6,height:12,rotation:0},{id:"h",x:47,y:13,width:6,height:12,rotation:90},{id:"i",x:32.74,y:23.59,width:5,height:10,rotation:135},{id:"j",x:35.06,y:19.5,width:4,height:6,rotation:45},{id:"k",x:22.07,y:10.17,width:5,height:10,rotation:-45},{id:"l",x:20.72,y:18.23,width:4,height:6,rotation:45}],walls:[{id:"wa",x:38,y:6,shape:"C-4-8-4",rotation:0},{id:"wb",x:18,y:30,shape:"C-4-8-4",rotation:180},{id:"wc",x:13.33,y:20.15,shape:"L-4x8-mirror",rotation:-90},{id:"wd",x:49.67,y:15.93,shape:"L-4x8-mirror",rotation:90},{id:"we",x:48.2,y:30.88,shape:"L-4x8",rotation:0},{id:"wf",x:7.84,y:5.01,shape:"L-4x8",rotation:180},{id:"wg",x:27.06,y:11.52,shape:"L-4x8-mirror",rotation:-45},{id:"wh",x:35.81,y:24.24,shape:"L-4x8-mirror",rotation:135}]},{name:"Layout 2",terrains:[{id:"a",x:31,y:7,width:4,height:6,rotation:-90},{id:"b",x:25,y:30,width:4,height:6,rotation:90},{id:"c",x:5,y:4,width:6,height:12,rotation:0},{id:"d",x:49,y:28,width:6,height:12,rotation:0},{id:"e",x:46,y:4,width:6,height:12,rotation:0},{id:"f",x:16.32,y:16.13,width:6,height:12,rotation:135},{id:"g",x:53,y:15,width:4,height:6,rotation:90},{id:"h",x:8,y:28,width:6,height:12,rotation:0},{id:"i",x:3,y:23,width:4,height:6,rotation:90},{id:"j",x:32.62,y:32.55,width:5,height:10,rotation:-90},{id:"k",x:22.48,y:.51,width:5,height:10,rotation:-90},{id:"l",x:37,y:16,width:6,height:12,rotation:135}],walls:[{id:"wa",x:49,y:32,shape:"L-4x8",rotation:0},{id:"wb",x:7,y:4,shape:"L-4x8",rotation:180},{id:"wc",x:46,y:8,shape:"L-4x8",rotation:0},{id:"wd",x:10,y:28,shape:"L-4x8",rotation:180},{id:"we",x:35.07,y:34.56,shape:"L-5x6-mirror",rotation:-90},{id:"wf",x:29.09,y:2.47,shape:"L-5x6-mirror",rotation:90},{id:"wg",x:17.86,y:17.53,shape:"C-4-8-4",rotation:135},{id:"wh",x:37.24,y:18.38,shape:"C-4-8-4",rotation:-45}]},{name:"Layout 3",terrains:[{id:"a",x:11,y:3,width:4,height:6,rotation:90},{id:"b",x:45,y:35,width:4,height:6,rotation:90},{id:"c",x:25,y:1,width:6,height:12,rotation:90},{id:"d",x:29,y:31,width:6,height:12,rotation:90},{id:"e",x:7.74,y:26.05,width:6,height:12,rotation:125.31},{id:"f",x:46.34,y:5.51,width:6,height:12,rotation:121.72},{id:"g",x:5.14,y:10.46,width:6,height:12,rotation:41.51},{id:"h",x:48.67,y:21.52,width:6,height:12,rotation:41.51},{id:"i",x:19.59,y:14.36,width:5,height:10,rotation:-38.13},{id:"j",x:20.69,y:24.37,width:4,height:6,rotation:-39.33},{id:"k",x:35.34,y:19.61,width:5,height:10,rotation:-38.13},{id:"l",x:35.31,y:13.5,width:4,height:6,rotation:-39.33}],walls:[{id:"aa",x:30,y:32,shape:"C-4-8-4",rotation:90},{id:"ab",x:26,y:4,shape:"C-4-8-4",rotation:-90},{id:"ac",x:8.19,y:11.64,shape:"L-4x8",rotation:222.46},{id:"ad",x:47.79,y:24.3,shape:"L-4x8",rotation:41.26},{id:"ae",x:38.64,y:20.09,shape:"L-5x6-mirror",rotation:141.31},{id:"af",x:25.26,y:17.9,shape:"L-5x6-mirror",rotation:-37.61},{id:"ag",x:14.37,y:28.38,shape:"L-4x8-mirror",rotation:-54.26},{id:"ah",x:48.75,y:7.3,shape:"L-4x8-mirror",rotation:122.02}]},{name:"Layout 4",terrains:[{id:"a",x:15,y:1,width:6,height:12,rotation:90},{id:"b",x:8,y:10,width:4,height:6,rotation:0},{id:"c",x:4,y:19,width:4,height:6,rotation:0},{id:"d",x:7.5,y:27.68,width:6,height:12,rotation:-48.57},{id:"e",x:46.53,y:4.24,width:6,height:12,rotation:-48.57},{id:"f",x:53,y:19,width:4,height:6,rotation:0},{id:"g",x:48,y:28,width:4,height:6,rotation:0},{id:"h",x:39,y:31,width:6,height:12,rotation:90},{id:"i",x:33.03,y:2.97,width:6,height:12,rotation:-37.25},{id:"j",x:20.96,y:28.96,width:6,height:12,rotation:-37.25},{id:"k",x:16.93,y:16.51,width:5,height:10,rotation:-41.85},{id:"l",x:37.96,y:17.43,width:5,height:10,rotation:-41.85}],walls:[{id:"aa",x:18,y:4,shape:"L-4x8",rotation:-90},{id:"ab",x:9.04,y:29.01,shape:"C-4-8-4",rotation:131.97},{id:"ac",x:47,y:7,shape:"C-4-8-4",rotation:-48.54},{id:"ad",x:38,y:32,shape:"L-4x8",rotation:90},{id:"ae",x:34.42,y:7.12,shape:"L-4x8",rotation:-37.53},{id:"af",x:21.57,y:28.8,shape:"L-4x8",rotation:142.46},{id:"ag",x:15.7,y:17.01,shape:"L-5x6",rotation:137.87},{id:"ah",x:39.17,y:20.85,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 5",terrains:[{id:"aa",x:27,y:1,width:6,height:12,rotation:90},{id:"ab",x:36.53,y:12.48,width:5,height:10,rotation:-90},{id:"ac",x:13,y:3,width:4,height:6,rotation:90},{id:"ad",x:43,y:35,width:4,height:6,rotation:90},{id:"ae",x:27,y:31,width:6,height:12,rotation:90},{id:"af",x:18.43,y:21.49,width:5,height:10,rotation:-90},{id:"ag",x:1,y:23,width:4,height:6,rotation:90},{id:"ah",x:55,y:15,width:4,height:6,rotation:90},{id:"ai",x:7.83,y:30.22,width:6,height:12,rotation:-60},{id:"aj",x:46.32,y:1.58,width:6,height:12,rotation:-60},{id:"ak",x:8.74,y:10.19,width:6,height:12,rotation:65.22},{id:"al",x:45.22,y:21.75,width:6,height:12,rotation:65.22}],walls:[{id:"a1",x:28,y:32,shape:"C-4-8-4",rotation:90},{id:"a2",x:28,y:4,shape:"C-4-8-4",rotation:-90},{id:"a3",x:11.88,y:12.29,shape:"L-4x8",rotation:-114.74},{id:"a4",x:43.97,y:23.59,shape:"L-4x8",rotation:64.22},{id:"a5",x:24.91,y:23.52,shape:"L-5x6-mirror",rotation:-90.37},{id:"a6",x:39,y:14.51,shape:"L-5x6-mirror",rotation:89.9},{id:"a7",x:7.58,y:30.57,shape:"L-4x8",rotation:120.93},{id:"a8",x:48.51,y:5.28,shape:"L-4x8",rotation:-59.06}]},{name:"Layout 6",terrains:[{id:"aa",x:13,y:1,width:6,height:12,rotation:90},{id:"ab",x:6,y:10,width:4,height:6,rotation:0},{id:"ac",x:25,y:11,width:4,height:6,rotation:90},{id:"ad",x:7.34,y:27.57,width:6,height:12,rotation:-40.32},{id:"ae",x:46.69,y:4.57,width:6,height:12,rotation:-41.9},{id:"af",x:31,y:27,width:4,height:6,rotation:-90},{id:"ag",x:50,y:28,width:4,height:6,rotation:0},{id:"ah",x:41,y:31,width:6,height:12,rotation:90},{id:"ai",x:34,y:4,width:6,height:12,rotation:0},{id:"aj",x:20,y:28,width:6,height:12,rotation:0},{id:"ak",x:15.7,y:15.03,width:5,height:10,rotation:-41.85},{id:"al",x:39.43,y:19.24,width:5,height:10,rotation:-39.95}],walls:[{id:"a1",x:16,y:4,shape:"L-4x8",rotation:-90},{id:"a2",x:9.04,y:29.01,shape:"C-4-8-4",rotation:140.05},{id:"a3",x:47,y:7.16,shape:"C-4-8-4",rotation:-41.53},{id:"a4",x:40,y:32,shape:"L-4x8",rotation:90},{id:"a5",x:34.15,y:7.88,shape:"L-4x8",rotation:0},{id:"a6",x:22,y:28,shape:"L-4x8",rotation:180},{id:"a7",x:14.47,y:15.47,shape:"L-5x6",rotation:137.87},{id:"a8",x:40.53,y:22.78,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 7",terrains:[{id:"aa",x:8,y:8,width:6,height:12,rotation:0},{id:"ab",x:6,y:28,width:6,height:12,rotation:0},{id:"ac",x:7,y:39,width:4,height:6,rotation:90},{id:"ad",x:18,y:26,width:5,height:10,rotation:0},{id:"ae",x:19,y:20,width:4,height:6,rotation:0},{id:"af",x:23,y:3,width:6,height:12,rotation:0},{id:"ag",x:31,y:29,width:6,height:12,rotation:0},{id:"ah",x:37,y:18,width:4,height:6,rotation:0},{id:"ai",x:37,y:8,width:5,height:10,rotation:0},{id:"aj",x:46,y:24,width:6,height:12,rotation:0},{id:"ak",x:48,y:4,width:6,height:12,rotation:0},{id:"al",x:49,y:-1,width:4,height:6,rotation:90}],walls:[{id:"a1",x:9,y:10,shape:"L-5x6",rotation:180},{id:"a2",x:11.44,y:31.97,shape:"L-4x8-mirror",rotation:0},{id:"a3",x:19,y:20,shape:"L-4x6",rotation:180},{id:"a4",x:22.53,y:30.02,shape:"L-5x6-mirror",rotation:0},{id:"a5",x:25,y:5,shape:"C-4-8-4",rotation:180},{id:"a6",x:31,y:31,shape:"C-4-8-4",rotation:0},{id:"a7",x:37,y:18,shape:"L-4x6",rotation:0},{id:"a8",x:41.51,y:8.09,shape:"L-5x6-mirror",rotation:180},{id:"a9",x:46,y:28,shape:"L-5x6",rotation:0},{id:"a10",x:51.51,y:4.01,shape:"L-4x8-mirror",rotation:180}]},{name:"Layout 8",terrains:[{id:"aa",x:23,y:22,width:4,height:6,rotation:0},{id:"ab",x:23,y:28,width:4,height:6,rotation:0},{id:"ac",x:33,y:16,width:4,height:6,rotation:0},{id:"ad",x:33,y:10,width:4,height:6,rotation:0},{id:"ae",x:41,y:19,width:6,height:12,rotation:0},{id:"af",x:13,y:13,width:6,height:12,rotation:0},{id:"ag",x:32,y:32,width:6,height:12,rotation:0},{id:"ah",x:22,y:0,width:6,height:12,rotation:0},{id:"ai",x:9.5,y:27.68,width:6,height:12,rotation:-48.69},{id:"aj",x:44.51,y:4.35,width:6,height:12,rotation:-48.69},{id:"ak",x:6.95,y:4,width:5,height:10,rotation:53.9},{id:"al",x:48,y:30,width:5,height:10,rotation:53.9}],walls:[{id:"a1",x:32,y:34,shape:"C-4-8-4",rotation:0},{id:"a2",x:24,y:2,shape:"C-4-8-4",rotation:180},{id:"a3",x:44.68,y:19.06,shape:"L-4x8-mirror",rotation:180},{id:"a4",x:18.43,y:16.91,shape:"L-4x8-mirror",rotation:0},{id:"a5",x:46.38,y:33.13,shape:"L-5x6",rotation:52.87},{id:"a6",x:8.55,y:4.89,shape:"L-5x6",rotation:-127.66},{id:"a7",x:16,y:30.28,shape:"L-4x8-mirror",rotation:-48.62},{id:"a8",x:46.91,y:5.85,shape:"L-4x8-mirror",rotation:132.19}]}];function mu(){return"terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Ia(){const t=localStorage.getItem(zo);if(t)try{return JSON.parse(t)}catch(n){return console.error("Failed to parse saved layouts:",n),{}}return{}}function Er(t){localStorage.setItem(zo,JSON.stringify(t))}function Vo(){const{subscribe:t,set:n,update:a}=rn([]);return{subscribe:t,set:n,update:a,add(r,s){a(i=>[...i,{id:mu(),x:30-r/2,y:22-s/2,width:r,height:s,rotation:0}])},updateTerrain(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){n([])},save(r){const s=ha({subscribe:t}),i=Ia();i[r]={terrains:s,savedAt:Date.now()},Er(i)},load(r){const s=Ia();return s[r]?(n(s[r].terrains),!0):!1},deleteLayout(r){const s=Ia();delete s[r],Er(s)},getSavedLayoutNames(){const r=Ia();return Object.keys(r).map(s=>({name:s,savedAt:r[s].savedAt,terrainCount:r[s].terrains.length})).sort((s,i)=>i.savedAt-s.savedAt)},hasSaved(){const r=Ia();return Object.keys(r).length>0}}}const Pn=Vo();function jo(){const{subscribe:t,set:n,update:a}=rn([]);return{subscribe:t,set:n,update:a,add(r){a(s=>[...s,{id:"wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),x:30,y:22,shape:r,rotation:0}])},updateWall(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){n([])}}}const Rn=jo(),hr=Vo(),fr=jo(),yr=rn(null),pr=rn(null);function Jr(t){const n=t.includes("-mirror"),a=t.replace("-mirror","");if(a.startsWith("L-")){const r=a.match(/L-(\d+)x(\d+)/);if(r)return{type:"L",segments:[parseInt(r[1]),parseInt(r[2])],mirrored:n}}else if(a.startsWith("C-")){const r=a.match(/C-(\d+)-(\d+)-(\d+)/);if(r)return{type:"C",segments:[parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],mirrored:n}}return{type:"L",segments:[4,8],mirrored:!1}}function es(t,n=null){const s=Jr(t),i=n||s.segments,o=s.mirrored;if(s.type==="L"){const[c,d]=i;return o?[{x:0,y:0},{x:.5,y:0},{x:.5,y:d},{x:-c+.5,y:d},{x:-c+.5,y:d-.5},{x:0,y:d-.5}]:[{x:0,y:0},{x:.5,y:0},{x:.5,y:d-.5},{x:c,y:d-.5},{x:c,y:d},{x:0,y:d}]}else if(s.type==="C"){const[c,d,h]=i;return[{x:0,y:0},{x:h,y:0},{x:h,y:.5},{x:.5,y:.5},{x:.5,y:d-.5},{x:c,y:d-.5},{x:c,y:d},{x:0,y:d}]}return[]}function $r(t,n,a,r){if(t.length===0)return[];const s=t.map(E=>E.x),i=t.map(E=>E.y),o=Math.min(...s),c=Math.max(...s),d=Math.min(...i),h=Math.max(...i),m=c-o,y=h-d,u=n+o+m/2,p=a+d+y/2,g=r*Math.PI/180,_=Math.cos(g),T=Math.sin(g);return t.map(E=>{const k=n+E.x,L=a+E.y,w=k-u,A=L-p;return{x:u+w*_-A*T,y:p+w*T+A*_}})}Ba(Rn,t=>t.map(n=>$r(es(n.shape,n.segments),n.x,n.y,n.rotation)));const ga=rn(null),ba=rn(null),bi=rn([]);function du(t,n=[]){const a=ha(Pn),r=ha(Rn),s=Ia();s[t]={terrains:a,walls:r,models:n,savedAt:Date.now()},Er(s)}function hu(t){const n=Ia();return n[t]?(Pn.set(n[t].terrains||[]),Rn.set(n[t].walls||[]),{terrains:n[t].terrains||[],walls:n[t].walls||[],models:n[t].models||[]}):null}function fu(t){const n=Ia();delete n[t],Er(n)}function yu(){const t=Ia();return Object.keys(t).map(n=>({name:n,savedAt:t[n].savedAt,terrainCount:(t[n].terrains||[]).length,wallCount:(t[n].walls||[]).length,modelCount:(t[n].models||[]).length})).sort((n,a)=>a.savedAt-n.savedAt)}function Vs(){bi.set(yu())}var pu=ge('<line stroke="#3b82f6" stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" fill="#3b82f6" stroke="#1d4ed8" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-1tez9jd"></circle>',1),vu=ge('<g><g><path role="button" tabindex="0" class="svelte-1tez9jd"></path></g><!></g>');function Pr(t,n){Yn(n,!1);const a=O(),r=O(),s=O(),i=O(),o=O(),c=O(),d=O(),h=O(),m=O(),y=O();let u=Xe(n,"id",8),p=Xe(n,"x",8),g=Xe(n,"y",8),_=Xe(n,"shape",8),T=Xe(n,"segments",8,null),E=Xe(n,"rotation",8,0),k=Xe(n,"selected",8,!1),L=Xe(n,"screenToSvg",8),w=Xe(n,"onSelect",8,()=>{}),A=Xe(n,"onDrag",8,()=>{}),R=Xe(n,"onRotate",8,()=>{});function D(Y){const ve=Y.map(dt=>dt.x),Me=Y.map(dt=>dt.y);return{minX:Math.min(...ve),maxX:Math.max(...ve),minY:Math.min(...Me),maxY:Math.max(...Me)}}let C=O(!1),$=!1,H={x:0,y:0};function oe(Y){Y.stopPropagation(),w()(u())}function N(Y){if(Y.button!==0)return;Y.preventDefault(),Y.stopPropagation(),w()(u()),v(C,!0);const ve=L()(Y.clientX,Y.clientY);H={x:ve.x-p(),y:ve.y-g()},window.addEventListener("mousemove",he),window.addEventListener("mouseup",we)}function he(Y){if(!e(C))return;const ve=L()(Y.clientX,Y.clientY);let Me=ve.x-H.x,dt=ve.y-H.y;Y.shiftKey||(Me=Math.round(Me),dt=Math.round(dt));const fe=Math.max(e(s),e(i));Me=Math.max(-fe,Math.min(et.width+fe-e(s),Me)),dt=Math.max(-fe,Math.min(et.height+fe-e(i),dt)),A()(u(),Me,dt)}function we(){v(C,!1),window.removeEventListener("mousemove",he),window.removeEventListener("mouseup",we)}function ne(Y){Y.preventDefault(),Y.stopPropagation(),$=!0,window.addEventListener("mousemove",se),window.addEventListener("mouseup",ce)}function se(Y){if(!$)return;const ve=L()(Y.clientX,Y.clientY),Me=ve.x-e(o),dt=ve.y-e(c);let fe=Math.atan2(dt,Me)*180/Math.PI+45;Y.shiftKey||(fe=Math.round(fe/15)*15),R()(u(),fe)}function ce(){$=!1,window.removeEventListener("mousemove",se),window.removeEventListener("mouseup",ce)}ye(()=>(Z(_()),Z(T())),()=>{v(a,es(_(),T()))}),ye(()=>e(a),()=>{v(r,D(e(a)))}),ye(()=>e(r),()=>{v(s,e(r).maxX-e(r).minX)}),ye(()=>e(r),()=>{v(i,e(r).maxY-e(r).minY)}),ye(()=>(Z(p()),e(r),e(s)),()=>{v(o,p()+e(r).minX+e(s)/2)}),ye(()=>(Z(g()),e(r),e(i)),()=>{v(c,g()+e(r).minY+e(i)/2)}),ye(()=>(e(a),Z(p()),Z(g())),()=>{v(d,e(a).length>0?`M ${e(a).map(Y=>`${p()+Y.x},${g()+Y.y}`).join(" L ")} Z`:"")}),ye(()=>(e(s),e(i)),()=>{v(h,Math.max(e(s),e(i))/2+1.5)}),ye(()=>(e(o),e(h),Z(E())),()=>{v(m,e(o)+e(h)*Math.cos((E()-45)*Math.PI/180))}),ye(()=>(e(c),e(h),Z(E())),()=>{v(y,e(c)+e(h)*Math.sin((E()-45)*Math.PI/180))}),Ea(),jn();var be=vu();let De;var J=x(be),U=x(J),V=b(J);{var xe=Y=>{var ve=pu(),Me=_e(ve),dt=b(Me);q(()=>{f(Me,"x1",e(o)),f(Me,"y1",e(c)),f(Me,"x2",e(m)),f(Me,"y2",e(y)),f(dt,"cx",e(m)),f(dt,"cy",e(y))}),X("mousedown",dt,ne),M(Y,ve)};ee(V,Y=>{k()&&Y(xe)})}q(()=>{De=gn(be,0,"wall-piece svelte-1tez9jd",null,De,{selected:k(),dragging:e(C)}),f(J,"transform",`rotate(${E()??""}, ${e(o)??""}, ${e(c)??""})`),f(U,"d",e(d)),f(U,"fill",k()?"rgba(139, 69, 19, 0.6)":"rgba(139, 69, 19, 0.8)"),f(U,"stroke",k()?"#3b82f6":"#5c3317"),f(U,"stroke-width",k()?.15:.1)}),X("click",U,oe),X("mousedown",U,N),M(t,be),Hn()}var gu=pe('<div class="section-content svelte-7o4pd4"><!></div>'),bu=pe('<section><div class="section-header svelte-7o4pd4" role="button" tabindex="0"><h3 class="svelte-7o4pd4"> </h3> <span class="toggle-icon svelte-7o4pd4"> </span></div> <!></section>');function cn(t,n){let a=Xe(n,"title",8),r=Xe(n,"defaultOpen",8,!0),s=O(r());function i(){v(s,!e(s))}var o=bu();let c;var d=x(o),h=x(d),m=x(h),y=b(h,2),u=x(y),p=b(d,2);{var g=_=>{var T=gu(),E=x(T);Oo(E,n,"default",{}),M(_,T)};ee(p,_=>{e(s)&&_(g)})}q(()=>{c=gn(o,1,"collapsible-section svelte-7o4pd4",null,c,{collapsed:!e(s)}),ke(m,a()),ke(u,e(s)?"â¼":"â¶")}),X("click",d,i),M(t,o)}var Tu=pe('<button class="svelte-10mgcx0"> </button>'),xu=pe('<div class="button-group svelte-10mgcx0"></div>'),_u=pe('<button class="svelte-10mgcx0"> </button>'),wu=pe('<div class="button-group svelte-10mgcx0"></div>'),Su=pe('<div class="field svelte-10mgcx0"><label for="edit-width" class="svelte-10mgcx0">Width (inches)</label> <input id="edit-width" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-height" class="svelte-10mgcx0">Length (inches)</label> <input id="edit-height" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-rotation" class="svelte-10mgcx0">Rotation (Â°)</label> <input id="edit-rotation" type="number" step="15" class="svelte-10mgcx0"/></div>',1),Au=pe('<div class="field svelte-10mgcx0"><label for="edit-seg1" class="svelte-10mgcx0">Horizontal (inches)</label> <input id="edit-seg1" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg2" class="svelte-10mgcx0">Vertical (inches)</label> <input id="edit-seg2" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div>',1),Cu=pe('<div class="field svelte-10mgcx0"><label for="edit-seg1" class="svelte-10mgcx0">Top Width (inches)</label> <input id="edit-seg1" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg2" class="svelte-10mgcx0">Length (inches)</label> <input id="edit-seg2" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg3" class="svelte-10mgcx0">Bottom Width (inches)</label> <input id="edit-seg3" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div>',1),Eu=pe('<div class="field svelte-10mgcx0"><span class="label-text svelte-10mgcx0">Shape</span> <span class="value svelte-10mgcx0"> </span></div> <!> <div class="field svelte-10mgcx0"><label for="edit-rotation" class="svelte-10mgcx0">Rotation (Â°)</label> <input id="edit-rotation" type="number" step="15" class="svelte-10mgcx0"/></div>',1),Mu=pe('<div class="edit-form svelte-10mgcx0"><div class="field svelte-10mgcx0"><label for="edit-x" class="svelte-10mgcx0">X (inches)</label> <input id="edit-x" type="number" step="0.1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-y" class="svelte-10mgcx0">Y (inches)</label> <input id="edit-y" type="number" step="0.1" class="svelte-10mgcx0"/></div> <!> <button class="danger svelte-10mgcx0">Remove</button></div>'),Ru=pe('<p class="hint svelte-10mgcx0">Click a piece to select it</p>'),ku=pe('<div class="button-group vertical svelte-10mgcx0"><button class="svelte-10mgcx0">Save Layout</button> <button class="svelte-10mgcx0">Load Layout</button> <div class="button-row svelte-10mgcx0"><button class="secondary small svelte-10mgcx0">Export</button> <button class="secondary small svelte-10mgcx0">Import</button></div> <button class="secondary svelte-10mgcx0">Clear All</button></div>'),Lu=pe("<!> <!>",1),Du=pe('<div class="modal-overlay svelte-10mgcx0" role="presentation"><div class="modal svelte-10mgcx0" role="dialog"><h2 class="svelte-10mgcx0">Save Layout</h2> <div class="modal-field svelte-10mgcx0"><label for="layout-name" class="svelte-10mgcx0">Layout Name</label> <input id="layout-name" type="text" placeholder="Enter a name..." class="svelte-10mgcx0"/></div> <div class="modal-actions svelte-10mgcx0"><button class="secondary svelte-10mgcx0">Cancel</button> <button class="svelte-10mgcx0">Save</button></div></div></div>'),Iu=pe('<p class="hint svelte-10mgcx0">No saved layouts yet</p>'),$u=pe('<div class="layout-item svelte-10mgcx0" role="button" tabindex="0"><div class="layout-info svelte-10mgcx0"><span class="layout-name svelte-10mgcx0"> </span> <span class="layout-meta svelte-10mgcx0"> </span></div> <button class="delete-btn svelte-10mgcx0" title="Delete">Ã</button></div>'),Pu=pe('<div class="layout-list svelte-10mgcx0"></div>'),Nu=pe('<div class="modal-overlay svelte-10mgcx0" role="presentation"><div class="modal svelte-10mgcx0" role="dialog"><h2 class="svelte-10mgcx0">Load Layout</h2> <!> <div class="modal-actions svelte-10mgcx0"><button class="secondary svelte-10mgcx0">Cancel</button></div></div></div>'),Ou=pe('<main class="svelte-10mgcx0"><div class="layout svelte-10mgcx0"><div class="sidebar svelte-10mgcx0"><!> <!> <!> <!> <input type="file" accept=".json" style="display: none;"/></div> <div class="battlefield-area svelte-10mgcx0"><div class="battlefield-container svelte-10mgcx0" role="presentation"><!></div> <div class="info svelte-10mgcx0"><p class="svelte-10mgcx0"> </p> <p class="hint svelte-10mgcx0">Scroll to zoom | Space+drag or middle-click to pan | Double-click to reset view</p></div></div></div></main> <!> <!>',1);function Wu(t,n){Yn(n,!1);const a=()=>Lt(ga,"$selectedTerrainId",c),r=()=>Lt(ba,"$selectedWallId",c),s=()=>Lt(Pn,"$layoutTerrains",c),i=()=>Lt(Rn,"$layoutWalls",c),o=()=>Lt(bi,"$savedLayoutsList",c),[c,d]=qs(),h=O(),m=O();let y=O(!1),u=O(!1),p=O(""),g=null;xs(()=>{Vs(),window.addEventListener("keydown",_)}),pi(()=>{window.removeEventListener("keydown",_)});function _(I){if(I.target.tagName==="INPUT"||e(y)||e(u))return;const me=a()||r();if((I.key==="Delete"||I.key==="Backspace")&&me){I.preventDefault(),De();return}if(me&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(I.key)){I.preventDefault();const Te=I.shiftKey?.1:1;let $e=0,Pe=0;switch(I.key){case"ArrowUp":Pe=-Te;break;case"ArrowDown":Pe=Te;break;case"ArrowLeft":$e=-Te;break;case"ArrowRight":$e=Te;break}if(a()){const st=s().find(ft=>ft.id===a());st&&Pn.updateTerrain(a(),{x:st.x+$e,y:st.y+Pe})}else if(r()){const st=i().find(ft=>ft.id===r());st&&Rn.updateWall(r(),{x:st.x+$e,y:st.y+Pe})}return}if(I.key==="c"&&(I.ctrlKey||I.metaKey)&&me){if(I.preventDefault(),a()){const Te=s().find($e=>$e.id===a());Te&&(g={type:"terrain",data:{...Te}})}else if(r()){const Te=i().find($e=>$e.id===r());Te&&(g={type:"wall",data:{...Te}})}return}if(I.key==="v"&&(I.ctrlKey||I.metaKey)&&g){if(I.preventDefault(),g.type==="terrain"){const Te="terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),$e={...g.data,id:Te,x:g.data.x+2,y:g.data.y+2};Pn.update(Pe=>[...Pe,$e]),ga.set(Te),ba.set(null),g.data.x+=2,g.data.y+=2}else if(g.type==="wall"){const Te="wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),$e={...g.data,id:Te,x:g.data.x+2,y:g.data.y+2};Rn.update(Pe=>[...Pe,$e]),ba.set(Te),ga.set(null),g.data.x+=2,g.data.y+=2}return}if(I.key==="Escape"){we();return}}let T=O(""),E=O(""),k=O(""),L=O(""),w=O(""),A=O(""),R=O(""),D=O("");function C(I){return I.segments?I.segments:Jr(I.shape).segments}function $(I){return Jr(I.shape).type}function H(I,me){Pn.add(I,me)}function oe(I){Rn.add(I)}function N(I){ga.set(I),ba.set(null)}function he(I){ba.set(I),ga.set(null)}function we(){ga.set(null),ba.set(null)}function ne(I,me,Te){Pn.updateTerrain(I,{x:me,y:Te})}function se(I,me,Te){Rn.updateWall(I,{x:me,y:Te})}function ce(I,me){Pn.updateTerrain(I,{rotation:me})}function be(I,me){Rn.updateWall(I,{rotation:me})}function De(){a()?(Pn.remove(a()),ga.set(null)):r()&&(Rn.remove(r()),ba.set(null))}function J(){const I=parseFloat(e(T)),me=parseFloat(e(E));!isNaN(I)&&!isNaN(me)&&(a()?Pn.updateTerrain(a(),{x:I,y:me}):r()&&Rn.updateWall(r(),{x:I,y:me}))}function U(){if(!a())return;const I=parseFloat(e(k)),me=parseFloat(e(L));!isNaN(I)&&!isNaN(me)&&I>0&&me>0&&Pn.updateTerrain(a(),{width:I,height:me})}function V(){const I=parseFloat(e(w));isNaN(I)||(a()?Pn.updateTerrain(a(),{rotation:I}):r()&&Rn.updateWall(r(),{rotation:I}))}function xe(){if(!r()||!e(m))return;const I=$(e(m)),me=parseFloat(e(A)),Te=parseFloat(e(R));if(isNaN(me)||isNaN(Te)||me<=0||Te<=0)return;let $e;if(I==="C"){const Pe=parseFloat(e(D));if(isNaN(Pe)||Pe<=0)return;$e=[me,Te,Pe]}else $e=[me,Te];Rn.updateWall(r(),{segments:$e})}function Y(){v(p,""),v(y,!0)}function ve(){e(p).trim()&&(du(e(p).trim()),Vs(),v(y,!1),v(p,""))}function Me(){Vs(),v(u,!0)}function dt(I){hu(I),ga.set(null),ba.set(null),v(u,!1)}function fe(I,me){me.stopPropagation(),confirm(`Delete layout "${I}"?`)&&(fu(I),Vs())}function te(){confirm("Clear all terrain and walls?")&&(Pn.clear(),Rn.clear(),ga.set(null),ba.set(null))}function Ke(I){return new Date(I).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function Ce(I){const me=Zr.find(Te=>Te.shape===I);return me?me.label:I}function Dt(){const I=prompt("Layout name (for the recipient):","Custom Layout");if(I===null)return;const me=s(),Te=i(),$e={version:1,name:I||"Custom Layout",exportedAt:new Date().toISOString(),terrainCount:me.length,wallCount:Te.length,terrains:me,walls:Te},Pe=JSON.stringify($e,null,2),st=new Blob([Pe],{type:"application/json"}),ft=URL.createObjectURL(st),Ee=document.createElement("a");Ee.href=ft;const ze=(I||"layout").toLowerCase().replace(/[^a-z0-9]+/g,"-");Ee.download=`${ze}-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(Ee),Ee.click(),document.body.removeChild(Ee),URL.revokeObjectURL(ft)}let lt=O();function nt(){e(lt).click()}function ct(I){const me=I.target.files[0];if(!me)return;const Te=new FileReader;Te.onload=$e=>{try{const Pe=JSON.parse($e.target.result);Pe.terrains&&Array.isArray(Pe.terrains)&&Pn.set(Pe.terrains),Pe.walls&&Array.isArray(Pe.walls)&&Rn.set(Pe.walls),ga.set(null),ba.set(null);const st=Pe.name||"Unknown",ft=Pe.terrains?.length||0,Ee=Pe.walls?.length||0;alert(`Imported "${st}"
${ft} terrain(s), ${Ee} wall(s)`)}catch(Pe){alert("Failed to import layout: Invalid file format"),console.error("Import error:",Pe)}},Te.readAsText(me),I.target.value=""}ye(()=>(s(),a()),()=>{v(h,s().find(I=>I.id===a()))}),ye(()=>(i(),r()),()=>{v(m,i().find(I=>I.id===r()))}),ye(()=>(e(h),e(m)),()=>{if(e(h))v(T,e(h).x.toFixed(1)),v(E,e(h).y.toFixed(1)),v(k,e(h).width.toString()),v(L,e(h).height.toString()),v(w,Math.round(e(h).rotation).toString());else if(e(m)){v(T,e(m).x.toFixed(1)),v(E,e(m).y.toFixed(1)),v(w,Math.round(e(m).rotation).toString());const I=C(e(m));v(A,I[0]?.toString()||""),v(R,I[1]?.toString()||""),v(D,I[2]?.toString()||"")}}),Ea(),jn();var it=Ou(),ht=_e(it),Rt=x(ht),ae=x(Rt),Le=x(ae);cn(Le,{title:"Add Terrain",children:(I,me)=>{var Te=xu();He(Te,5,()=>Xo,ot,($e,Pe)=>{var st=Tu(),ft=x(st);q(()=>ke(ft,(e(Pe),l(()=>e(Pe).label)))),X("click",st,()=>H(e(Pe).width,e(Pe).height)),M($e,st)}),M(I,Te)},$$slots:{default:!0}});var Ve=b(Le,2);cn(Ve,{title:"Add Wall",children:(I,me)=>{var Te=wu();He(Te,5,()=>Zr,ot,($e,Pe)=>{var st=_u(),ft=x(st);q(()=>ke(ft,(e(Pe),l(()=>e(Pe).label)))),X("click",st,()=>oe(e(Pe).shape)),M($e,st)}),M(I,Te)},$$slots:{default:!0}});var Et=b(Ve,2);{let I=Ie(()=>e(h)?"Terrain":e(m)?"Wall":"Item");cn(Et,{get title(){return`Selected ${e(I)??""}`},children:(me,Te)=>{var $e=_t(),Pe=_e($e);{var st=Ee=>{var ze=Mu(),Ft=x(ze),Fn=b(x(Ft),2),tn=b(Ft,2),ra=b(x(tn),2),ia=b(tn,2);{var Qn=hn=>{var Zn=Su(),P=_e(Zn),Q=b(x(P),2),re=b(P,2),Ne=b(x(re),2),Ye=b(re,2),Ue=b(x(Ye),2);Mn(Q,()=>e(k),Oe=>v(k,Oe)),X("change",Q,U),Mn(Ne,()=>e(L),Oe=>v(L,Oe)),X("change",Ne,U),Mn(Ue,()=>e(w),Oe=>v(w,Oe)),X("change",Ue,V),M(hn,Zn)},ns=hn=>{var Zn=_t(),P=_e(Zn);{var Q=re=>{var Ne=Eu(),Ye=_e(Ne),Ue=b(x(Ye),2),Oe=x(Ue),Qe=b(Ye,2);{var gt=Wt=>{var nn=Au(),xn=_e(nn),fn=b(x(xn),2),Zt=b(xn,2),Mt=b(x(Zt),2);Mn(fn,()=>e(A),Yt=>v(A,Yt)),X("change",fn,xe),Mn(Mt,()=>e(R),Yt=>v(R,Yt)),X("change",Mt,xe),M(Wt,nn)},Qt=Wt=>{var nn=_t(),xn=_e(nn);{var fn=Zt=>{var Mt=Cu(),Yt=_e(Mt),yn=b(x(Yt),2),pn=b(Yt,2),_n=b(x(pn),2),In=b(pn,2),En=b(x(In),2);Mn(yn,()=>e(A),We=>v(A,We)),X("change",yn,xe),Mn(_n,()=>e(R),We=>v(R,We)),X("change",_n,xe),Mn(En,()=>e(D),We=>v(D,We)),X("change",En,xe),M(Zt,Mt)};ee(xn,Zt=>{e(m),l(()=>$(e(m))==="C")&&Zt(fn)},!0)}M(Wt,nn)};ee(Qe,Wt=>{e(m),l(()=>$(e(m))==="L")?Wt(gt):Wt(Qt,!1)})}var Ut=b(Qe,2),Kt=b(x(Ut),2);q(Wt=>ke(Oe,Wt),[()=>(e(m),l(()=>Ce(e(m).shape)))]),Mn(Kt,()=>e(w),Wt=>v(w,Wt)),X("change",Kt,V),M(re,Ne)};ee(P,re=>{e(m)&&re(Q)},!0)}M(hn,Zn)};ee(ia,hn=>{e(h)?hn(Qn):hn(ns,!1)})}var as=b(ia,2);Mn(Fn,()=>e(T),hn=>v(T,hn)),X("change",Fn,J),Mn(ra,()=>e(E),hn=>v(E,hn)),X("change",ra,J),X("click",as,De),M(Ee,ze)},ft=Ee=>{var ze=Ru();M(Ee,ze)};ee(Pe,Ee=>{e(h)||e(m)?Ee(st):Ee(ft,!1)})}M(me,$e)},$$slots:{default:!0}})}var St=b(Et,2);cn(St,{title:"Layout",children:(I,me)=>{var Te=ku(),$e=x(Te),Pe=b($e,2),st=b(Pe,2),ft=x(st),Ee=b(ft,2),ze=b(st,2);q(()=>Pe.disabled=(o(),l(()=>o().length===0))),X("click",$e,Y),X("click",Pe,Me),X("click",ft,Dt),X("click",Ee,nt),X("click",ze,te),M(I,Te)},$$slots:{default:!0}});var It=b(St,2);Sr(It,I=>v(lt,I),()=>e(lt));var en=b(ae,2),dn=x(en),Xt=x(dn);lr(Xt,{children:kr,$$slots:{default:(I,me)=>{const Te=Ie(()=>me.screenToSvg);var $e=Lu(),Pe=_e($e);He(Pe,1,s,ft=>ft.id,(ft,Ee)=>{{let ze=Ie(()=>(e(Ee),a(),l(()=>e(Ee).id===a())));Go(ft,{get id(){return e(Ee),l(()=>e(Ee).id)},get x(){return e(Ee),l(()=>e(Ee).x)},get y(){return e(Ee),l(()=>e(Ee).y)},get width(){return e(Ee),l(()=>e(Ee).width)},get height(){return e(Ee),l(()=>e(Ee).height)},get rotation(){return e(Ee),l(()=>e(Ee).rotation)},get selected(){return e(ze)},get screenToSvg(){return e(Te)},onSelect:N,onDrag:ne,onRotate:ce})}});var st=b(Pe,2);He(st,1,i,ft=>ft.id,(ft,Ee)=>{{let ze=Ie(()=>(e(Ee),r(),l(()=>e(Ee).id===r())));Pr(ft,{get id(){return e(Ee),l(()=>e(Ee).id)},get x(){return e(Ee),l(()=>e(Ee).x)},get y(){return e(Ee),l(()=>e(Ee).y)},get shape(){return e(Ee),l(()=>e(Ee).shape)},get segments(){return e(Ee),l(()=>e(Ee).segments)},get rotation(){return e(Ee),l(()=>e(Ee).rotation)},get selected(){return e(ze)},get screenToSvg(){return e(Te)},onSelect:he,onDrag:se,onRotate:be})}}),M(I,$e)}}});var on=b(dn,2),Cn=x(on),qe=x(Cn),Ge=b(ht,2);{var at=I=>{var me=Du(),Te=x(me),$e=b(x(Te),2),Pe=b(x($e),2),st=b($e,2),ft=x(st),Ee=b(ft,2);q(ze=>Ee.disabled=ze,[()=>(e(p),l(()=>!e(p).trim()))]),Mn(Pe,()=>e(p),ze=>v(p,ze)),X("keydown",Pe,ze=>ze.key==="Enter"&&ve()),X("click",ft,()=>v(y,!1)),X("click",Ee,ve),X("click",Te,Ni(function(ze){Wi.call(this,n,ze)})),X("click",me,()=>v(y,!1)),M(I,me)};ee(Ge,I=>{e(y)&&I(at)})}var qt=b(Ge,2);{var je=I=>{var me=Nu(),Te=x(me),$e=b(x(Te),2);{var Pe=ze=>{var Ft=Iu();M(ze,Ft)},st=ze=>{var Ft=Pu();He(Ft,5,o,ot,(Fn,tn)=>{var ra=$u(),ia=x(ra),Qn=x(ia),ns=x(Qn),as=b(Qn,2),hn=x(as),Zn=b(ia,2);q(P=>{ke(ns,(e(tn),l(()=>e(tn).name))),ke(hn,`${e(tn),l(()=>e(tn).terrainCount)??""} terrain${e(tn),l(()=>e(tn).terrainCount!==1?"s":"")??""}, ${e(tn),l(()=>e(tn).wallCount||0)??""} wall${e(tn),l(()=>(e(tn).wallCount||0)!==1?"s":"")??""} Â· ${P??""}`)},[()=>(e(tn),l(()=>Ke(e(tn).savedAt)))]),X("click",Zn,P=>fe(e(tn).name,P)),X("click",ra,()=>dt(e(tn).name)),M(Fn,ra)}),M(ze,Ft)};ee($e,ze=>{o(),l(()=>o().length===0)?ze(Pe):ze(st,!1)})}var ft=b($e,2),Ee=x(ft);X("click",Ee,()=>v(u,!1)),X("click",Te,Ni(function(ze){Wi.call(this,n,ze)})),X("click",me,()=>v(u,!1)),M(I,me)};ee(qt,I=>{e(u)&&I(je)})}q(()=>ke(qe,`Battlefield: 60" x 44" | ${s(),l(()=>s().length)??""} terrain${s(),l(()=>s().length!==1?"s":"")??""} | ${i(),l(()=>i().length)??""} wall${i(),l(()=>i().length!==1?"s":"")??""}`)),X("change",It,ct),X("click",dn,we),M(t,it),Hn(),d()}const Qo=1/25.4,Ti=40*Qo/2,xi=3+20*Qo;function Zo(t="item"){return t+"-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Yu(){const{subscribe:t,set:n,update:a}=rn([]);return{subscribe:t,set:n,update:a,add(r){const s=Zo("zone");return a(i=>[...i,{id:s,...r}]),s},updateZone(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){n([])}}}function Hu(){const{subscribe:t,set:n,update:a}=rn([]);return{subscribe:t,set:n,update:a,add(r,s,i=!1){const o=Zo("obj"),c=Math.round(r),d=Math.round(s);return a(h=>[...h,{id:o,x:c,y:d,isPrimary:i}]),o},updateObjective(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){n([])}}}Yu();Hu();const Jo=[{name:"Dawn of War",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:32},{type:"L",x:60,y:32},{type:"L",x:60,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:0,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:12},{type:"L",x:0,y:12},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1}]},{name:"Hammer and Anvil",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:18,y:0},{type:"L",x:18,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:42,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:42,y:44},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1}]},{name:"Tipping Point",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:12,y:0},{type:"L",x:12,y:22},{type:"L",x:20,y:22},{type:"L",x:20,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:40,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:48,y:44},{type:"L",x:48,y:22},{type:"L",x:40,y:22},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:34,isPrimary:!1},{x:22,y:8,isPrimary:!1},{x:38,y:36,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Search and Destroy",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:22},{type:"L",x:21,y:22},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:0,x:30,y:31},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:30,y:0},{type:"L",x:30,y:13},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:1,x:39,y:22},{type:"L",x:60,y:22},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:10,isPrimary:!1},{x:46,y:34,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Sweeping Engagement",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:0,y:8},{type:"L",x:30,y:8},{type:"L",x:30,y:14},{type:"L",x:60,y:14},{type:"L",x:60,y:0},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:0,y:44},{type:"L",x:60,y:44},{type:"L",x:60,y:36},{type:"L",x:30,y:36},{type:"L",x:30,y:30},{type:"L",x:0,y:30},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:18,isPrimary:!1},{x:50,y:26,isPrimary:!1},{x:18,y:38,isPrimary:!1},{x:42,y:6,isPrimary:!1}]},{name:"Crucible of Battle",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:60,y:44},{type:"L",x:30,y:0},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:20,y:8,isPrimary:!1},{x:40,y:36,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]}];function tr(t){return t.map(n=>{switch(n.type){case"M":return`M ${n.x} ${n.y}`;case"L":return`L ${n.x} ${n.y}`;case"A":return`A ${n.rx} ${n.ry} ${n.rotation} ${n.largeArc} ${n.sweep} ${n.x} ${n.y}`;case"Z":return"Z";default:return""}}).join(" ")}const Xa=rn(null),ua=rn(null),Ta=rn(null),_i=Ba([ua,Ta],([t,n])=>{if(!t)return{terrains:[],walls:[]};if(n==="preset"){const a=gi.find(r=>r.name===t);return a?{terrains:a.terrains||[],walls:a.walls||[]}:{terrains:[],walls:[]}}else if(n==="saved"){const a=localStorage.getItem("warhammer-deployment-layouts");if(a)try{const r=JSON.parse(a);if(r[t])return{terrains:r[t].terrains||[],walls:r[t].walls||[]}}catch(r){console.error("Failed to load layout:",r)}}return{terrains:[],walls:[]}});var Fu=pe('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),Bu=pe('<button class="svelte-1jotvmi"> </button>'),qu=pe('<div class="button-group svelte-1jotvmi"></div>'),Uu=pe('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),Ku=pe('<button class="svelte-1jotvmi"> </button>'),Gu=pe('<button class="svelte-1jotvmi"> </button>'),zu=pe('<div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Saved</h4> <div class="button-group svelte-1jotvmi"></div></div>'),Xu=pe('<div class="layout-sections svelte-1jotvmi"><div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Presets</h4> <div class="button-group svelte-1jotvmi"></div></div> <!></div>'),Vu=pe('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Objectives:</span> <span class="value svelte-1jotvmi"> </span></div>'),ju=pe('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Pieces:</span> <span class="value svelte-1jotvmi"> </span></div>'),Qu=pe('<div class="summary svelte-1jotvmi"><div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Deployment:</span> <span class="value svelte-1jotvmi"> </span></div> <div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Terrain:</span> <span class="value svelte-1jotvmi"> </span></div> <!> <!></div>'),Zu=ge('<path stroke-width="0.10" stroke-dasharray="0.5,0.25"></path>'),Ju=ge('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15"></circle><circle stroke="#000" stroke-width="0.06"></circle><circle r="0.15" fill="#000"></circle>',1),em=ge("<!><!>",1),tm=ge('<g><rect fill="rgba(139, 90, 43, 0.6)" stroke="#8b5a2b" stroke-width="0.1"></rect></g>'),nm=ge('<g><path fill="rgba(139, 69, 19, 0.8)" stroke="#5c3317" stroke-width="0.1"></path></g>'),am=ge("<!><!><!>",1),sm=pe('<main class="svelte-1jotvmi"><div class="layout svelte-1jotvmi"><div class="sidebar svelte-1jotvmi"><!> <!> <!></div> <div class="battlefield-area svelte-1jotvmi"><div class="battlefield-container svelte-1jotvmi"><!></div> <div class="info svelte-1jotvmi"><p class="svelte-1jotvmi">Battlefield: 60" x 44"</p> <p class="hint svelte-1jotvmi">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function rm(t,n){Yn(n,!1);const a=()=>Lt(Xa,"$selectedDeployment",o),r=()=>Lt(ua,"$selectedLayoutName",o),s=()=>Lt(bi,"$savedLayoutsList",o),i=()=>Lt(_i,"$loadedTerrain",o),[o,c]=qs();xs(()=>{Vs()});function d(C){Xa.set(C)}function h(C){ua.set(C.name),Ta.set("preset")}function m(C){ua.set(C),Ta.set("saved")}function y(){ua.set(null),Ta.set(null)}function u(){Xa.set(null)}function p(C){let H=[];switch(C.shape){case"L-4x8":H=[{x:0,y:0},{x:.5,y:0},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];break;case"L-4x8-mirror":H=[{x:0,y:0},{x:.5,y:0},{x:.5,y:8},{x:-4+.5,y:8},{x:-4+.5,y:8-.5},{x:0,y:8-.5}];break;case"C-4-8-4":H=[{x:0,y:0},{x:4,y:0},{x:4,y:.5},{x:.5,y:.5},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];break;case"L-5x6":H=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:5,y:6-.5},{x:5,y:6},{x:0,y:6}];break;case"L-5x6-mirror":H=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-5+.5,y:6},{x:-5+.5,y:6-.5},{x:0,y:6-.5}];break;case"L-4x6":H=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:4,y:6-.5},{x:4,y:6},{x:0,y:6}];break;case"L-4x6-mirror":H=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-4+.5,y:6},{x:-4+.5,y:6-.5},{x:0,y:6-.5}];break;default:return""}return`M ${H.map(oe=>`${C.x+oe.x},${C.y+oe.y}`).join(" L ")} Z`}function g(C){switch(C.shape){case"L-4x8":return{x:C.x+2,y:C.y+4};case"L-4x8-mirror":return{x:C.x-2+.5,y:C.y+4};case"C-4-8-4":return{x:C.x+2,y:C.y+4};case"L-5x6":return{x:C.x+2.5,y:C.y+3};case"L-5x6-mirror":return{x:C.x-2.5+.5,y:C.y+3};case"L-4x6":return{x:C.x+2,y:C.y+3};case"L-4x6-mirror":return{x:C.x-2+.5,y:C.y+3};default:return{x:C.x,y:C.y}}}jn();var _=sm(),T=x(_),E=x(T),k=x(E);cn(k,{title:"Deployment",children:(C,$)=>{var H=_t(),oe=_e(H);{var N=we=>{var ne=Fu(),se=x(ne),ce=x(se),be=b(se,2);q(()=>ke(ce,a().name)),X("click",be,u),M(we,ne)},he=we=>{var ne=qu();He(ne,5,()=>Jo,ot,(se,ce)=>{var be=Bu(),De=x(be);q(()=>ke(De,e(ce).name)),X("click",be,()=>d(e(ce))),M(se,be)}),M(we,ne)};ee(oe,we=>{a()?we(N):we(he,!1)})}M(C,H)},$$slots:{default:!0}});var L=b(k,2);cn(L,{title:"Terrain Layout",children:(C,$)=>{var H=_t(),oe=_e(H);{var N=we=>{var ne=Uu(),se=x(ne),ce=x(se),be=b(se,2);q(()=>ke(ce,r())),X("click",be,y),M(we,ne)},he=we=>{var ne=Xu(),se=x(ne),ce=b(x(se),2);He(ce,5,()=>gi,ot,(J,U)=>{var V=Ku(),xe=x(V);q(()=>ke(xe,e(U).name)),X("click",V,()=>h(e(U))),M(J,V)});var be=b(se,2);{var De=J=>{var U=zu(),V=b(x(U),2);He(V,5,s,ot,(xe,Y)=>{var ve=Gu(),Me=x(ve);q(()=>ke(Me,e(Y).name)),X("click",ve,()=>m(e(Y).name)),M(xe,ve)}),M(J,U)};ee(be,J=>{s().length>0&&J(De)})}M(we,ne)};ee(oe,we=>{r()?we(N):we(he,!1)})}M(C,H)},$$slots:{default:!0}});var w=b(L,2);cn(w,{title:"Summary",children:(C,$)=>{var H=Qu(),oe=x(H),N=b(x(oe),2),he=x(N),we=b(oe,2),ne=b(x(we),2),se=x(ne),ce=b(we,2);{var be=U=>{var V=Vu(),xe=b(x(V),2),Y=x(xe);q(()=>ke(Y,a().objectives.length)),M(U,V)};ee(ce,U=>{a()&&U(be)})}var De=b(ce,2);{var J=U=>{var V=ju(),xe=b(x(V),2),Y=x(xe);q(()=>ke(Y,`${i().terrains.length??""} terrain, ${i().walls.length??""} walls`)),M(U,V)};ee(De,U=>{(i().terrains.length>0||i().walls.length>0)&&U(J)})}q(()=>{ke(he,a()?.name||"None"),ke(se,r()||"None")}),M(C,H)},$$slots:{default:!0}});var A=b(E,2),R=x(A),D=x(R);lr(D,{children:(C,$)=>{var H=am(),oe=_e(H);{var N=ne=>{var se=em(),ce=_e(se);He(ce,1,()=>a().zones,ot,(De,J)=>{var U=Zu();q(V=>{f(U,"d",V),f(U,"fill",e(J).color),f(U,"stroke",e(J).borderColor)},[()=>tr(e(J).path)]),M(De,U)});var be=b(ce);He(be,1,()=>a().objectives,ot,(De,J)=>{const U=Ie(()=>e(J).isPrimary?"#fbbf24":"#9ca3af"),V=Ie(()=>e(J).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)");var xe=Ju(),Y=_e(xe),ve=b(Y),Me=b(ve);q(()=>{f(Y,"cx",e(J).x),f(Y,"cy",e(J).y),f(Y,"r",xi),f(Y,"fill",e(V)),f(Y,"stroke",e(U)),f(ve,"cx",e(J).x),f(ve,"cy",e(J).y),f(ve,"r",Ti),f(ve,"fill",e(U)),f(Me,"cx",e(J).x),f(Me,"cy",e(J).y)}),M(De,xe)}),M(ne,se)};ee(oe,ne=>{a()&&ne(N)})}var he=b(oe);He(he,1,()=>i().terrains,ot,(ne,se)=>{const ce=Ie(()=>e(se).x+e(se).width/2),be=Ie(()=>e(se).y+e(se).height/2);var De=tm(),J=x(De);q(()=>{f(De,"transform",`rotate(${e(se).rotation??""}, ${e(ce)??""}, ${e(be)??""})`),f(J,"x",e(se).x),f(J,"y",e(se).y),f(J,"width",e(se).width),f(J,"height",e(se).height)}),M(ne,De)});var we=b(he);He(we,1,()=>i().walls,ot,(ne,se)=>{const ce=Ie(()=>g(e(se)));var be=nm(),De=x(be);q(J=>{f(be,"transform",`rotate(${e(se).rotation??""}, ${e(ce).x??""}, ${e(ce).y??""})`),f(De,"d",J)},[()=>p(e(se))]),M(ne,be)}),M(C,H)},$$slots:{default:!0}}),M(t,_),Hn(),c()}function el(){const{subscribe:t,set:n,update:a}=rn({past:[],future:[]});return{subscribe:t,push(r){a(s=>({past:[...s.past,r],future:[]}))},undo(){let r=null;return a(s=>{if(s.past.length===0)return s;const i=[...s.past];return r=i.pop(),{past:i,future:[r,...s.future]}}),r},redo(){let r=null;return a(s=>{if(s.future.length===0)return s;const i=[...s.future];return r=i.shift(),{past:[...s.past,r],future:i}}),r},canUndo(){return ha({subscribe:t}).past.length>0},canRedo(){return ha({subscribe:t}).future.length>0},clear(){n({past:[],future:[]})}}}const Ln=el(),ei=el(),Ht=1/25.4,Xn={circles:[{type:"25mm",radius:25*Ht/2,label:"25mm"},{type:"28.5mm",radius:28.5*Ht/2,label:"28mm.5"},{type:"32mm",radius:32*Ht/2,label:"32mm"},{type:"40mm",radius:40*Ht/2,label:"40mm"},{type:"50mm",radius:50*Ht/2,label:"50mm"},{type:"60mm",radius:60*Ht/2,label:"60mm"},{type:"80mm",radius:80*Ht/2,label:"80mm"},{type:"90mm",radius:90*Ht/2,label:"90mm"},{type:"100mm",radius:100*Ht/2,label:"100mm"},{type:"130mm",radius:130*Ht/2,label:"130mm"},{type:"160mm",radius:160*Ht/2,label:"160mm"}],ovals:[{type:"60x35.5mm",width:60*Ht,height:35.5*Ht,label:"60Ã35.5mm"},{type:"75x42mm",width:75*Ht,height:42*Ht,label:"75Ã42mm"},{type:"Small Flying Base",width:75*Ht,height:42*Ht,label:"Small Flying"},{type:"90x52.5mm",width:90*Ht,height:52.5*Ht,label:"90Ã52.5mm"},{type:"Large Flying Base",width:90*Ht,height:52.5*Ht,label:"Large Flying"},{type:"105x70mm",width:105*Ht,height:70*Ht,label:"105Ã70mm"},{type:"120x92mm",width:120*Ht,height:92*Ht,label:"120Ã92mm"},{type:"150x95mm",width:150*Ht,height:95*Ht,label:"150Ã95mm"},{type:"170x109mm",width:170*Ht,height:109*Ht,label:"170Ã109mm"}]};function Nn(t,n=null){const a=Xn.circles.find(s=>s.type===t);if(a)return a;const r=Xn.ovals.find(s=>s.type===t);return r||(_a(t)&&n?{type:t,width:n.customWidth,height:n.customHeight,label:`${n.customWidth.toFixed(1)}"Ã${n.customHeight.toFixed(1)}"`}:null)}function An(t){return Xn.ovals.some(n=>n.type===t)}function _a(t){return t&&t.startsWith("rect-")}function Bi(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function tl(t){const{subscribe:n,set:a,update:r}=rn([]);return{subscribe:n,set:a,update:r,add(s,i,o,c,d=null,h=!1){const m=Bi(),y={id:m,baseType:s,playerId:i,x:o,y:c,rotation:0};return d&&d.width&&d.height&&(y.customWidth=d.width,y.customHeight=d.height),r(u=>[...u,y]),!h&&t&&t.push({type:"add",modelId:m,model:{...y}}),m},updateModel(s,i,o=!1){let c=null,d=null;if(!o&&t){const m=ha({subscribe:n}).find(y=>y.id===s);m&&(c={...m},"x"in i||"y"in i?d="move":"rotation"in i&&(d="rotate"))}if(r(h=>h.map(m=>m.id===s?{...m,...i}:m)),!o&&t&&d&&c){const m=ha({subscribe:n}).find(y=>y.id===s);t.push({type:d,modelId:s,before:d==="move"?{x:c.x,y:c.y}:{rotation:c.rotation},after:d==="move"?{x:m.x,y:m.y}:{rotation:m.rotation}})}},remove(s,i=!1){let o=null;!i&&t&&(o=ha({subscribe:n}).find(d=>d.id===s)),r(c=>c.filter(d=>d.id!==s)),!i&&t&&o&&t.push({type:"remove",modelId:s,model:{...o}})},removeByPlayer(s){r(i=>i.filter(o=>o.playerId!==s))},addBatch(s,i=!1){const o=[];return r(c=>{const d=[...c];return s.forEach(h=>{const m=h.id||Bi(),y={...h,id:m};d.push(y),o.push(m),!i&&t&&t.push({type:"add",modelId:m,model:{...y}})}),d}),o},updateUnit(s,i,o=!1){r(c=>c.map(d=>d.unitId===s?{...d,...i}:d))},removeUnit(s,i=!1){const o=[];if(!i&&t){const c=ha({subscribe:n});o.push(...c.filter(d=>d.unitId===s))}r(c=>c.filter(d=>d.unitId!==s)),!i&&t&&o.forEach(c=>{t.push({type:"remove",modelId:c.id,model:{...c}})})},clear(){a([]),t&&t.clear()},undo(){if(!t)return;const s=t.undo();if(s)switch(s.type){case"add":this.remove(s.modelId,!0);break;case"remove":r(i=>[...i,s.model]);break;case"move":this.updateModel(s.modelId,s.before,!0);break;case"rotate":this.updateModel(s.modelId,s.before,!0);break}},redo(){if(!t)return;const s=t.redo();if(s)switch(s.type){case"add":r(i=>[...i,s.model]);break;case"remove":this.remove(s.modelId,!0);break;case"move":this.updateModel(s.modelId,s.after,!0);break;case"rotate":this.updateModel(s.modelId,s.after,!0);break}}}}const yt=tl(Ln),nl=Ba(yt,t=>t.filter(n=>n.playerId===1)),al=Ba(yt,t=>t.filter(n=>n.playerId===2)),im=rn(null);Ba([yt,im],([t,n])=>n?t.find(a=>a.id===n):null);const Ga=tl(ei),ls=rn(null);Ba([Ga,ls],([t,n])=>n?t.find(a=>a.id===n):null);var om=ge('<g><rect role="button" tabindex="0" class="svelte-hycs6b"></rect></g>'),lm=ge('<g><ellipse role="button" tabindex="0" class="svelte-hycs6b"></ellipse></g>'),cm=ge('<circle role="button" tabindex="0" class="svelte-hycs6b"></circle>'),um=ge('<text text-anchor="middle" dominant-baseline="middle" font-weight="bold" fill="white" stroke="black" stroke-width="0.02" paint-order="stroke" pointer-events="none" class="model-name"> </text>'),mm=ge('<line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="rotate-handle svelte-hycs6b"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),dm=ge('<line stroke="#fbbf24" stroke-width="0.12" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.25" fill="#fbbf24" pointer-events="none" class="svelte-hycs6b"></circle><text text-anchor="middle" dominant-baseline="middle" font-size="0.5" font-weight="bold" fill="#fbbf24" stroke="#000" stroke-width="0.05" paint-order="stroke" pointer-events="none" class="drag-ruler-label svelte-hycs6b"> </text>',1),hm=ge("<g><!><!><!><!></g>");function nr(t,n){Yn(n,!1);const a=O(),r=O(),s=O(),i=O(),o=O(),c=O(),d=O(),h=O(),m=O(),y=O(),u=O(),p=O(),g=O(),_=O(),T=O(),E=O(),k=O(),L=O(),w=O(),A=O(),R=O();let D=Xe(n,"id",8),C=Xe(n,"x",8),$=Xe(n,"y",8),H=Xe(n,"baseType",8),oe=Xe(n,"playerId",8),N=Xe(n,"rotation",8,0),he=Xe(n,"selected",8,!1),we=Xe(n,"marqueePreview",8,!1),ne=Xe(n,"inGroupSelection",8,!1),se=Xe(n,"name",8,""),ce=Xe(n,"customWidth",8,null),be=Xe(n,"customHeight",8,null),De=Xe(n,"screenToSvg",8),J=Xe(n,"onSelect",8,()=>{}),U=Xe(n,"onDrag",8,()=>{}),V=Xe(n,"onDragEnd",8,()=>{}),xe=Xe(n,"onRotate",8,()=>{}),Y=Xe(n,"onRotateEnd",8,()=>{}),ve=Xe(n,"onRename",8,()=>{}),Me=O(!1),dt=!1,fe={x:0,y:0},te=O(null),Ke=null;function Ce(qe){qe.stopPropagation()}function Dt(qe){qe.stopPropagation();const Ge=prompt("Model name:",se());Ge!==null&&ve()(D(),Ge)}function lt(qe){if(qe.button!==0)return;qe.preventDefault(),qe.stopPropagation(),J()(D(),qe),v(Me,!0),v(te,{x:C(),y:$()});const Ge=De()(qe.clientX,qe.clientY);fe={x:Ge.x-C(),y:Ge.y-$()},window.addEventListener("mousemove",nt),window.addEventListener("mouseup",ct)}function nt(qe){if(!e(Me))return;const Ge=De()(qe.clientX,qe.clientY);let at=Ge.x-fe.x,qt=Ge.y-fe.y;U()(D(),at,qt)}function ct(){e(Me)&&e(te)&&((e(te).x!==C()||e(te).y!==$())&&V()(D(),e(te).x,e(te).y,C(),$()),v(te,null)),v(Me,!1),window.removeEventListener("mousemove",nt),window.removeEventListener("mouseup",ct)}function it(qe){qe.preventDefault(),qe.stopPropagation(),dt=!0,Ke=N(),window.addEventListener("mousemove",ht),window.addEventListener("mouseup",Rt)}function ht(qe){if(!dt)return;const Ge=De()(qe.clientX,qe.clientY),at=Ge.x-C(),qt=Ge.y-$();let je=Math.atan2(qt,at)*180/Math.PI+45;qe.shiftKey||(je=Math.round(je/15)*15),xe()(D(),je)}function Rt(){dt&&Ke!==null&&(Ke!==N()&&Y()(D(),Ke,N()),Ke=null),dt=!1,window.removeEventListener("mousemove",ht),window.removeEventListener("mouseup",Rt)}ye(()=>(Z(ce()),Z(be())),()=>{v(a,{customWidth:ce(),customHeight:be()})}),ye(()=>(Z(H()),e(a)),()=>{v(r,Nn(H(),e(a)))}),ye(()=>Z(H()),()=>{v(s,An(H()))}),ye(()=>Z(H()),()=>{v(i,_a(H()))}),ye(()=>Z(oe()),()=>{v(o,oe()===1?"#3b82f6":"#ef4444")}),ye(()=>Z(oe()),()=>{v(c,oe()===1?"rgba(59, 130, 246, 0.5)":"rgba(239, 68, 68, 0.5)")}),ye(()=>Z(oe()),()=>{v(d,oe()===1?"rgba(59, 130, 246, 0.3)":"rgba(239, 68, 68, 0.3)")}),ye(()=>(Z(he()),Z(we())),()=>{v(h,he()?.15:we()?.12:.1)}),ye(()=>(Z(he()),e(o),Z(we()),e(d),e(c)),()=>{v(m,he()?e(o):we()?e(d):e(c))}),ye(()=>e(r),()=>{v(y,e(r)?.radius||.5)}),ye(()=>e(r),()=>{v(u,e(r)?.width?e(r).width/2:0)}),ye(()=>e(r),()=>{v(p,e(r)?.height?e(r).height/2:0)}),ye(()=>(e(i),Z(ce())),()=>{v(g,e(i)&&ce()||0)}),ye(()=>(e(i),Z(be())),()=>{v(_,e(i)&&be()||0)}),ye(()=>(e(s),e(u),e(p),e(i),e(g),e(_)),()=>{v(T,e(s)?Math.max(e(u),e(p))+1:e(i)?Math.max(e(g),e(_))/2+1:0)}),ye(()=>(Z(C()),e(T),Z(N())),()=>{v(E,C()+e(T)*Math.cos((N()-45)*Math.PI/180))}),ye(()=>(Z($()),e(T),Z(N())),()=>{v(k,$()+e(T)*Math.sin((N()-45)*Math.PI/180))}),ye(()=>(e(Me),e(te),Z(C()),Z($())),()=>{v(L,e(Me)&&e(te)?Math.sqrt(Math.pow(C()-e(te).x,2)+Math.pow($()-e(te).y,2)):0)}),ye(()=>(e(Me),e(te),Z(C())),()=>{v(w,e(Me)&&e(te)?(e(te).x+C())/2:0)}),ye(()=>(e(Me),e(te),Z($())),()=>{v(A,e(Me)&&e(te)?(e(te).y+$())/2:0)}),ye(()=>(e(i),e(g),e(_),e(s),e(u),e(p),e(y)),()=>{v(R,e(i)?Math.min(e(g),e(_))*.2:e(s)?Math.min(e(u),e(p))*.4:e(y)*.5)}),Ea(),jn();var ae=hm();let Le;var Ve=x(ae);{var Et=qe=>{var Ge=om(),at=x(Ge);q(()=>{f(Ge,"transform",`rotate(${N()??""}, ${C()??""}, ${$()??""})`),f(at,"x",C()-e(g)/2),f(at,"y",$()-e(_)/2),f(at,"width",e(g)),f(at,"height",e(_)),f(at,"fill",e(m)),f(at,"stroke",e(o)),f(at,"stroke-width",e(h))}),X("click",at,Ce),X("dblclick",at,Dt),X("mousedown",at,lt),M(qe,Ge)},St=qe=>{var Ge=_t(),at=_e(Ge);{var qt=I=>{var me=lm(),Te=x(me);q(()=>{f(me,"transform",`rotate(${N()??""}, ${C()??""}, ${$()??""})`),f(Te,"cx",C()),f(Te,"cy",$()),f(Te,"rx",e(u)),f(Te,"ry",e(p)),f(Te,"fill",e(m)),f(Te,"stroke",e(o)),f(Te,"stroke-width",e(h))}),X("click",Te,Ce),X("dblclick",Te,Dt),X("mousedown",Te,lt),M(I,me)},je=I=>{var me=cm();q(()=>{f(me,"cx",C()),f(me,"cy",$()),f(me,"r",e(y)),f(me,"fill",e(m)),f(me,"stroke",e(o)),f(me,"stroke-width",e(h))}),X("click",me,Ce),X("dblclick",me,Dt),X("mousedown",me,lt),M(I,me)};ee(at,I=>{e(s)?I(qt):I(je,!1)},!0)}M(qe,Ge)};ee(Ve,qe=>{e(i)?qe(Et):qe(St,!1)})}var It=b(Ve);{var en=qe=>{var Ge=um(),at=x(Ge);q(()=>{f(Ge,"x",C()),f(Ge,"y",$()),f(Ge,"font-size",e(R)),ke(at,se())}),M(qe,Ge)};ee(It,qe=>{se()&&qe(en)})}var dn=b(It);{var Xt=qe=>{var Ge=mm(),at=_e(Ge),qt=b(at),je=b(qt);q(()=>{f(at,"x1",C()),f(at,"y1",$()),f(at,"x2",e(E)),f(at,"y2",e(k)),f(qt,"cx",e(E)),f(qt,"cy",e(k)),f(je,"transform",`translate(${e(E)??""}, ${e(k)??""})`)}),X("mousedown",qt,it),M(qe,Ge)};ee(dn,qe=>{he()&&(e(s)||e(i))&&!ne()&&qe(Xt)})}var on=b(dn);{var Cn=qe=>{var Ge=dm(),at=_e(Ge),qt=b(at),je=b(qt),I=x(je);q(me=>{f(at,"x1",(e(te),l(()=>e(te).x))),f(at,"y1",(e(te),l(()=>e(te).y))),f(at,"x2",C()),f(at,"y2",$()),f(qt,"cx",(e(te),l(()=>e(te).x))),f(qt,"cy",(e(te),l(()=>e(te).y))),f(je,"x",e(w)),f(je,"y",e(A)-.5),ke(I,`${me??""}"`)},[()=>(e(L),l(()=>e(L).toFixed(2)))]),M(qe,Ge)};ee(on,qe=>{e(Me)&&e(te)&&e(L)>.1&&qe(Cn)})}q(()=>Le=gn(ae,0,"model-base svelte-hycs6b",null,Le,{selected:he(),dragging:e(Me)})),M(t,ae),Hn()}var fm=ge('<ellipse fill="none" stroke-width="2"></ellipse>'),ym=ge('<circle fill="none" stroke-width="2"></circle>'),pm=pe('<button class="palette-item svelte-1urec28"><svg class="svelte-1urec28"><!></svg> <span class="label svelte-1urec28"> </span></button>');function Mr(t,n){Yn(n,!1);const a=O(),r=O(),s=O(),i=O(),o=O(),c=O();let d=Xe(n,"baseSize",8),h=Xe(n,"playerId",8),m=Xe(n,"onDragStart",8,()=>{});const y=3;function u(w){w.button===0&&(w.preventDefault(),m()(d(),w))}ye(()=>Z(h()),()=>{v(a,h()===1?"#3b82f6":"#ef4444")}),ye(()=>Z(d()),()=>{v(r,d().width!==void 0)}),ye(()=>(e(r),Z(d())),()=>{v(s,e(r)?null:d().radius*y)}),ye(()=>(e(r),Z(d())),()=>{v(i,e(r)?d().width/2*y:null)}),ye(()=>(e(r),Z(d())),()=>{v(o,e(r)?d().height/2*y:null)}),ye(()=>(e(r),Z(d())),()=>{v(c,e(r)?Math.max(d().width,d().height)*y:d().radius*2*y)}),Ea(),jn();var p=pm(),g=x(p),_=x(g);{var T=w=>{var A=fm();q(()=>{f(A,"cx",(e(c)+8)/2),f(A,"cy",(e(c)+8)/2),f(A,"rx",e(i)),f(A,"ry",e(o)),f(A,"stroke",e(a))}),M(w,A)},E=w=>{var A=ym();q(()=>{f(A,"cx",(e(c)+8)/2),f(A,"cy",(e(c)+8)/2),f(A,"r",e(s)),f(A,"stroke",e(a))}),M(w,A)};ee(_,w=>{e(r)?w(T):w(E,!1)})}var k=b(g,2),L=x(k);q(()=>{Mc(p,`border-color: ${e(a)??""}`),f(p,"title",(Z(d()),l(()=>d().label))),f(g,"width",e(c)+8),f(g,"height",e(c)+8),f(g,"viewBox",`0 0 ${e(c)+8} ${e(c)+8}`),ke(L,(Z(d()),l(()=>d().label)))}),X("mousedown",p,u),M(t,p),Hn()}const sl="warhammer-imported-armies";function vm(){try{const t=localStorage.getItem(sl);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load army imports from storage:",t),[]}}function Br(t){try{localStorage.setItem(sl,JSON.stringify(t))}catch(n){console.error("Failed to save army imports to storage:",n)}}function gm(){return"import-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function bm(){const{subscribe:t,set:n,update:a}=rn(vm());return{subscribe:t,addImport(r,s,i,o){const c=gm(),d={id:c,name:r||"Unnamed Army",timestamp:Date.now(),rawText:s,parsedData:i,faction:i.FACTION_KEYWORD||"Unknown",totalPoints:i.TOTAL_ARMY_POINTS||"0pts",playerId:o};return a(h=>{const m=[...h,d];return Br(m),m}),c},removeImport(r){a(s=>{const i=s.filter(o=>o.id!==r);return Br(i),i})},getImport(r){return ha({subscribe:t}).find(i=>i.id===r)||null},clear(){n([]),Br([])}}}const ti=bm();var Tm=pe('<div class="error-message svelte-leqhjl"> </div>'),xm=pe('<div class="success-message svelte-leqhjl"> </div>'),_m=pe("<option> </option>"),wm=pe('<div class="army-import-panel svelte-leqhjl"><div class="form-group svelte-leqhjl"><label for="army-list-input" class="svelte-leqhjl">Paste Army List:</label> <textarea id="army-list-input" placeholder="Paste your army list here (GW App, WTC, ListForge formats supported)" rows="12" class="svelte-leqhjl"></textarea></div> <div class="button-group svelte-leqhjl"><button class="svelte-leqhjl"> </button> <button class="svelte-leqhjl">Clear</button></div> <!> <!> <div class="divider svelte-leqhjl"></div> <div class="form-group svelte-leqhjl"><label for="import-select" class="svelte-leqhjl">Load Previous Import:</label> <select id="import-select" class="svelte-leqhjl"><option>-- Select an import --</option><!></select> <button class="load-button svelte-leqhjl">Load</button></div></div>');function Sm(t,n){Yn(n,!1);const a=()=>Lt(ti,"$armyImports",r),[r,s]=qs();let i=Xe(n,"currentPlayer",8,1);const o=Bo();let c=O(""),d=O(!1),h=O(""),m=O(""),y=O("");function u(){if(!e(c).trim()){v(h,"Please paste an army list");return}v(d,!0),v(h,""),v(m,""),o("parse",{text:e(c),playerId:i()})}function p(){if(!e(y))return;const U=ti.getImport(e(y));U&&(v(c,U.rawText),v(m,`Loaded: ${U.name} (${U.faction}, ${U.totalPoints})`),v(h,""))}function g(){v(c,""),v(h,""),v(m,"")}function _(U){v(d,U)}function T(U){v(h,U),v(m,""),v(d,!1)}function E(U){v(m,U),v(h,""),v(d,!1)}function k(){v(c,"")}var L={setLoading:_,setError:T,setSuccess:E,clearText:k};jn();var w=wm(),A=x(w),R=b(x(A),2),D=b(A,2),C=x(D),$=x(C),H=b(C,2),oe=b(D,2);{var N=U=>{var V=Tm(),xe=x(V);q(()=>ke(xe,`â ï¸ ${e(h)??""}`)),M(U,V)};ee(oe,U=>{e(h)&&U(N)})}var he=b(oe,2);{var we=U=>{var V=xm(),xe=x(V);q(()=>ke(xe,`â ${e(m)??""}`)),M(U,V)};ee(he,U=>{e(m)&&U(we)})}var ne=b(he,4),se=b(x(ne),2);q(()=>{e(y),Ro(()=>{e(d),a()})});var ce=x(se);ce.value=ce.__value="";var be=b(ce);He(be,1,a,U=>U.id,(U,V)=>{var xe=_m(),Y=x(xe),ve={};q(()=>{ke(Y,`${e(V),l(()=>e(V).name)??""} (${e(V),l(()=>e(V).faction)??""}, ${e(V),l(()=>e(V).totalPoints)??""})`),ve!==(ve=(e(V),l(()=>e(V).id)))&&(xe.value=(xe.__value=(e(V),l(()=>e(V).id)))??"")}),M(U,xe)});var De=b(se,2);q(U=>{R.disabled=e(d),C.disabled=U,ke($,e(d)?"Parsing...":"Parse Army List"),H.disabled=e(d),se.disabled=e(d),De.disabled=e(d)||!e(y)},[()=>(e(d),e(c),l(()=>e(d)||!e(c).trim()))]),Mn(R,()=>e(c),U=>v(c,U)),X("click",C,u),X("click",H,g),Yo(se,()=>e(y),U=>v(y,U)),X("click",De,p),M(t,w),Xs(n,"setLoading",_),Xs(n,"setError",T),Xs(n,"setSuccess",E),Xs(n,"clearText",k);var J=Hn(L);return s(),J}var Am=pe("<option> </option>"),Cm=pe('<tr><td class="unit-name svelte-1xyf33v"> </td><td class="quantity svelte-1xyf33v"> </td><td class="svelte-1xyf33v"><select class="svelte-1xyf33v"></select></td><td class="skip-cell svelte-1xyf33v"><input type="checkbox" class="svelte-1xyf33v"/></td></tr>'),Em=pe('<div class="dialog-overlay svelte-1xyf33v"><div class="dialog svelte-1xyf33v"><div class="dialog-header svelte-1xyf33v"><h3 class="svelte-1xyf33v">Unmatched Units</h3> <button class="close-button svelte-1xyf33v">&times;</button></div> <div class="dialog-content svelte-1xyf33v"><p class="info-text svelte-1xyf33v">The following units were not found in the database. Please select base sizes or skip them:</p> <div class="units-table svelte-1xyf33v"><table class="svelte-1xyf33v"><thead class="svelte-1xyf33v"><tr><th class="svelte-1xyf33v">Unit Name</th><th class="svelte-1xyf33v">Quantity</th><th class="svelte-1xyf33v">Base Size</th><th class="svelte-1xyf33v">Skip</th></tr></thead><tbody></tbody></table></div></div> <div class="dialog-footer svelte-1xyf33v"><button class="cancel-button svelte-1xyf33v">Cancel</button> <button class="import-button svelte-1xyf33v">Import Selected</button></div></div></div>');function Mm(t,n){Yn(n,!1);let a=Xe(n,"unmatchedUnits",24,()=>[]),r=Xe(n,"show",12,!1);const s=Bo();let i=O({});const o=[...Xn.circles.map(u=>({value:u.type,label:u.label})),...Xn.ovals.map(u=>({value:u.type,label:u.label})),{value:"rect-custom",label:"Custom Rectangle (Vehicle)"}];function c(){const u=a().filter(p=>!e(i)[p.id]?.skip).map(p=>({unitName:p.unitName,quantity:p.quantity,baseType:e(i)[p.id]?.baseType||"32mm"}));s("import",{selected:u}),d()}function d(){r(!1),s("close")}ye(()=>Z(a()),()=>{v(i,{}),a().forEach(u=>{Yr(i,e(i)[u.id]={baseType:"32mm",skip:!1})})}),Ea(),jn();var h=_t(),m=_e(h);{var y=u=>{var p=Em(),g=x(p),_=x(g),T=b(x(_),2),E=b(_,2),k=b(x(E),2),L=x(k),w=b(x(L));He(w,5,a,C=>C.id,(C,$)=>{var H=Cm();let oe;var N=x(H),he=x(N),we=b(N),ne=x(we),se=b(we),ce=x(se);q(()=>{e(i),Ro(()=>{e($)})}),He(ce,5,()=>o,ot,(J,U)=>{var V=Am(),xe=x(V),Y={};q(()=>{ke(xe,(e(U),l(()=>e(U).label))),Y!==(Y=(e(U),l(()=>e(U).value)))&&(V.value=(V.__value=(e(U),l(()=>e(U).value)))??"")}),M(J,V)});var be=b(se),De=x(be);q(()=>{oe=gn(H,1,"svelte-1xyf33v",null,oe,{skipped:e(i)[e($).id]?.skip}),ke(he,(e($),l(()=>e($).unitName))),ke(ne,(e($),l(()=>e($).quantity||"1x"))),ce.disabled=(e(i),e($),l(()=>e(i)[e($).id]?.skip))}),Yo(ce,()=>e(i)[e($).id].baseType,J=>Yr(i,e(i)[e($).id].baseType=J)),Sn(De,()=>e(i)[e($).id].skip,J=>Yr(i,e(i)[e($).id].skip=J)),M(C,H)});var A=b(E,2),R=x(A),D=b(R,2);X("click",T,d),X("click",R,d),X("click",D,c),X("click",g,C=>C.stopPropagation()),X("click",p,d),M(u,p)};ee(m,u=>{r()&&u(y)})}M(t,h),Hn()}function Za(t){const n=t.match(/^\s*/);return n?n[0].length:0}function de(t){return t?t.toLowerCase().replace(/\s+/g," ").trim():""}function ts(t){const n=/^(?:(\d+)x?\s+)?(.*)/,a=t.trim().match(n);if(a){const r=a[1]?`${a[1]}x`:"1x";let s=a[2].trim();return s=s.replace(/^with\s+/i,"").trim(),{quantity:r,name:s}}return{quantity:"1x",name:t.trim()}}function fa(t){return Array.isArray(t)&&t.sort((n,a)=>{const r=parseInt(String(n&&n.quantity||"1x").replace(/x/i,""),10)||1,s=parseInt(String(a&&a.quantity||"1x").replace(/x/i,""),10)||1;if(r!==s)return s-r;const i=n&&n.name?n.name.toString().toLowerCase():"",o=a&&a.name?a.name.toString().toLowerCase():"";return i<o?-1:i>o?1:0}),t}const wa={"World Eaters":"Chaos","Chaos Space Marines":"Chaos","Emperor's Children":"Chaos","Death Guard":"Chaos","Chaos Daemons":"Chaos","Chaos Knights":"Chaos","Thousand Sons":"Chaos","Space Marines":"Imperium","Iron Hands":"Space Marines",Salamanders:"Space Marines","Space Wolves":"Space Marines",Ultramarines:"Space Marines","White Scars":"Space Marines","Adepta Sororitas":"Imperium","Astra Militarum":"Imperium","Imperial Fists":"Space Marines","Dark Angels":"Space Marines","Blood Angels":"Space Marines","Raven Guard":"Space Marines","Black Templars":"Space Marines",Deathwatch:"Space Marines","Grey Knights":"Imperium","Imperial Knights":"Imperium","Adeptus Custodes":"Imperium","Adeptus Titanicus":"Imperium","Adeptus Mechanicus":"Imperium","Agents of the Imperium":"Imperium",Aeldari:"Xenos",Drukhari:"Xenos",Ynnari:"Xenos",Harlequins:"Xenos",Necrons:"Xenos",Orks:"Xenos",Tyranids:"Xenos","T'au Empire":"Xenos",Tau:"Xenos","T'au":"Xenos","Genestealer Cults":"Xenos","Leagues of Votann":"Xenos"};function _s(t){if(!t)return t;t.SUMMARY=t.SUMMARY||{};const n=t.SUMMARY;n.LIST_TITLE=n.LIST_TITLE||"",n.FACTION_KEYWORD&&(n.FACTION_KEYWORD=String(n.FACTION_KEYWORD).trim()),n.DETACHMENT&&(n.DETACHMENT=String(n.DETACHMENT).replace(/\u00A0/g," ").trim()),n.TOTAL_ARMY_POINTS&&(n.TOTAL_ARMY_POINTS=String(n.TOTAL_ARMY_POINTS).trim());const a=s=>{if(!s)return"";try{return s.toString().normalize("NFD").replace(new RegExp("\\p{M}","gu"),"").replace(/[\u2018\u2019\u201B\u2032]/g,"'").replace(/[^\w\s'\-]/g,"").toLowerCase().trim()}catch{return s.toString().toLowerCase().trim()}},r=n.FACTION_KEYWORD||null;if(r){const s=a(r);let i;for(const o of Object.keys(wa))if(a(o)===s){i=o;break}if(i){const o=r.toString().replace(/[\u2018\u2019\u201B\u2032]/g,"'").trim();n.DISPLAY_FACTION=`${wa[i]} - ${o}`}else n.DISPLAY_FACTION=n.DISPLAY_FACTION||r+(n.DETACHMENT?` - ${n.DETACHMENT}`:"")}else n.DETACHMENT?n.DISPLAY_FACTION=n.DISPLAY_FACTION||n.DETACHMENT:n.DISPLAY_FACTION=n.DISPLAY_FACTION||"";if(!n.FACTION_KEY){if(n.FACTION_KEYWORD)try{n.FACTION_KEY=n.FACTION_KEYWORD.toString().toLowerCase()}catch{n.FACTION_KEY=String(n.FACTION_KEYWORD).toLowerCase()}else if(n.DISPLAY_FACTION){const s=(n.DISPLAY_FACTION||"").split(" - ")[0];try{n.FACTION_KEY=s.toString().toLowerCase()}catch{n.FACTION_KEY=String(s).toLowerCase()}}}return t}function os(t,n,a,r,s="",i=!1,o="wargear"){if(!t)return;t.items=t.items||[];const c=ts(String(n||"").trim()),d=c.quantity?String(c.quantity):"1x",h=c.name||"",m=de(h);if(i){const u=String(a||""),p=String(s||"");if(de(u)===de(h)||p&&de(p)===de(h))return}const y=t.items.find(u=>de(u.name||"")===m);if(y){const u=parseInt(String(y.quantity||"1x").replace(/x/i,""),10)||0,p=parseInt(String(d||"1x").replace(/x/i,""),10)||0;y.quantity=`${u+p}x`}else{const u=de(h)==="warlord"?"special":o;t.items.push({quantity:d,name:h,items:[],type:u,nameshort:""})}}function Rm(t,n){if(!t||!n)return;n.items=n.items||[];const a=t.trim(),r=a.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),o=de(i);if((n.items||[]).some(y=>y&&y.type==="special"&&de((y.name||"").replace(/^Enhancement:\s*/i,""))===o))return;const h=`E: ${i.split(/\s+/).map(y=>y[0]?y[0].toUpperCase():"").join("")}${s}`.trim(),m={quantity:"1x",name:`Enhancement: ${i}`,nameshort:h,items:[],type:"special"};n.items.push(m)}function km(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=[];let r=0;const s=y=>/^(\d+)x?\s+/i.test(String(y||"").trim()),i=(y,u)=>{const p=String(y||"").trim();if(!p)return p;if(s(p)){const g=p.match(/^(\d+)x?\s+(.*)$/i);if(g){const _=parseInt(g[1],10)||1,T=g[2].trim();return`${Math.max(1,_*(parseInt(u,10)||1))}x ${T}`}return p}return`${u}x ${p}`};for(;r<t.length;r++){const u=(t[r]||"").trim();if(u){if(u.startsWith("+")||u.startsWith("&")){a.push(u);continue}break}}for(const y of a){if(y.startsWith("&")){const _=y.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);_&&(_[1].trim(),(_[3]||"").trim());continue}const p=y.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(p){const g=p[1].trim().toUpperCase(),_=p[2].trim();if(g==="FACTION KEYWORD"){const T=_.split(" - ");n.SUMMARY.FACTION_KEYWORD=T[T.length-1].trim()}else g==="DETACHMENT"?n.SUMMARY.DETACHMENT=_.replace(/\u00A0/g," "):g==="TOTAL ARMY POINTS"&&(n.SUMMARY.TOTAL_ARMY_POINTS=_)}}if(n.SUMMARY.LIST_TITLE="",n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD){const y=n.SUMMARY.FACTION_KEYWORD,u=Object.keys(wa).find(g=>g.toLowerCase()===(y||"").toString().toLowerCase()),p=u?wa[u]:null;p?n.SUMMARY.DISPLAY_FACTION=`${p} - ${y}`:n.SUMMARY.DISPLAY_FACTION=y+(n.SUMMARY.DETACHMENT?` - ${n.SUMMARY.DETACHMENT}`:"");try{n.SUMMARY.FACTION_KEY=y.toString().toLowerCase()}catch{}}let o=null,c=null;const d=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,h=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;for(;r<t.length;r++){const y=t[r]||"",u=y.trim();if(!u)continue;if(/^Enhancement:\s*/i.test(u)){const E=u.replace(/^Enhancement:\s*/i,"").trim();c&&Rm(E,c);continue}const p=u.match(d);if(p){const E=p[1],k=p[2]?`${p[2]}x`:"1x",L=(p[3]||"").trim(),w=parseInt(p[4],10)||0,A=p[5],R={quantity:k,name:L,points:w,items:[],isComplex:!1,nameshort:""};E?(n.CHARACTER.push(R),c=R):(n["OTHER DATASHEETS"]=n["OTHER DATASHEETS"]||[],n["OTHER DATASHEETS"].push(R)),o=R,A&&A.split(",").map(D=>D.trim()).filter(Boolean).forEach(D=>os(R,D,R.name,n.SUMMARY.FACTION_KEYWORD||"",R.name,!0));continue}const g=y.match(h);if(g){const E=g[1].trim(),k=E.match(/^(\d+)\s+with\s+(.*)$/i);if(k&&o){const A=parseInt(k[1],10)||1,R=k[2],D=o.items&&o.items.length>0?o.items[o.items.length-1]:o;R.split(",").map(C=>C.trim()).filter(Boolean).forEach(C=>{const $=i(C,A);os(D,$,D.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const L=E.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(L&&o){const A=L[1],R=L[2].trim(),D=L[3]||"",C={quantity:A,name:R,items:[],type:"subunit"};if(o.items=o.items||[],o.items.push(C),D){const $=D.match(/^(\d+)\s+with\s+(.*)$/i);if($){const H=parseInt($[1],10)||1;$[2].split(",").map(N=>N.trim()).filter(Boolean).forEach(N=>{const he=i(N,H);os(C,he,C.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)})}else D.split(",").map(H=>H.trim()).filter(Boolean).forEach(H=>os(C,H,C.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0))}continue}const w=E.match(/^(\d+x?)\s+(.*)$/i);if(w&&o){const A={quantity:w[1],name:w[2].trim(),items:[],type:"subunit"};o.items=o.items||[],o.items.push(A);continue}if(o){os(o,E,o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0);continue}continue}const _=u.match(/^(\d+)\s+with\s+(.*)$/i);if(_&&o){const E=parseInt(_[1],10)||1,k=_[2],L=o.items&&o.items.length>0?o.items[o.items.length-1]:o;k.split(",").map(w=>w.trim()).filter(Boolean).forEach(w=>{const A=i(w,E);os(L,A,L.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const T=u.match(/^(.*?):\s*(.*)$/);if(T&&o){(T[2]||"").split(",").map(k=>k.trim()).filter(Boolean).forEach(k=>os(o,k,o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0));continue}}const m=[...n.CHARACTER||[],...n["OTHER DATASHEETS"]||[]];for(const y of m){y&&Array.isArray(y.items)&&y.items.length>0&&fa(y.items);const u=y&&Array.isArray(y.items)?y.items.filter(p=>p&&p.type==="subunit"):[];for(const p of u)p&&Array.isArray(p.items)&&p.items.length>0&&fa(p.items)}return _s(n),n}function ca(t,n,a,r,s="",i=!1,o="wargear"){if(!t)return;t.items=t.items||[];const c=String(n||"").trim();if(/battlesuit support system|homing beacon|marker drone/i.test(c))try{zn.push(`processing raw=${c} for target=${t&&t.name}`)}catch{}let d=c.split(",").map(w=>w.trim()).filter(Boolean);try{const w=new Set;d=d.filter(A=>{const R=de(Ds(La(A)));return w.has(R)?!1:(w.add(R),!0)})}catch{}try{/stealth shas'vre|stealth battlesuits/i.test((t&&t.name||"")+(s||"")+c)&&zn.push(`splitParts target=${t&&t.name} top=${s} parts=${JSON.stringify(d)}`)}catch{}if(d.length>1){d.forEach(w=>ca(t,w,a,r,s,i,o));return}const h=ts(c),m=h.quantity!==void 0&&h.quantity!==null;let y=m?String(h.quantity):"1x",u=h.name||"";try{u=Ds(La(u))}catch{}const p=/battlesuit support system|homing beacon|marker drone/i;try{const w=u.toLowerCase();if(w.includes("battlesuit support system")||w.includes("homing beacon")||w.includes("marker drone"))try{zn.push(`addItemToTarget target=${t&&t.name} raw=${c}`)}catch{}}catch{}const g=u.match(/^(\d+)x\s+(.*)$/i);if(g){const w=parseInt(g[1],10)||1,A=parseInt(String(y||"1x").replace(/x/i,""),10)||1;y=`${Math.max(1,A*w)}x`,u=g[2]}try{zn.push(`PARSE_QTY name=${u} parsedQtyRaw=${String(h.quantity||"")} qtyToken=${y}`)}catch{}let _=(w=>isNaN(w)?1:w)(parseInt(String(y||"1x").replace(/x/i,""),10)),T=_;try{if(t&&t.type==="subunit"){const w=parseInt(String(t.quantity||"1x").replace(/[^0-9]/g,""),10)||1;try{zn.push(`CALC_EFFECTIVE target=${t&&t.name} parentQty=${w} parsedQty=${_} hasExplicit=${m}`)}catch{}T=m?_:w;try{zn.push(`EFFECTIVE_QTY target=${t&&t.name} effectiveQty=${T}`)}catch{}}}catch{}const E=u,k=de(u);if(i){const w=String(a||""),A=String(s||"");if(de(w)===de(u)||A&&de(A)===de(u)){if(p.test(u))try{zn.push(`SKIP matched unitname name=${u} ctx=${w} top=${A}`)}catch{}return}}const L=t.items.find(w=>de(w.name||"")===k);if(L){const w=parseInt(String(L.quantity||"1x").replace(/x/i,""),10)||0,A=w+T;L.quantity=`${A}x`;try{zn.push(`UPDATED existing name=${u} existing=${w} added=${T} new=${A} target=${t&&t.name}`)}catch{}}else{const w=de(u)==="warlord"?"special":o;t.items.push({quantity:`${T}x`,name:E,items:[],type:w,nameshort:""});try{zn.push(`PUSHED new name=${u} quantity=${T} target=${t&&t.name}`)}catch{}}}function La(t){if(!t)return t;const n=t.toLowerCase();return n.includes("shield")&&n.includes("drone")?"Shield Drone":n.includes("marker")&&n.includes("drone")?"Marker Drone":n.includes("marker")&&n.includes("beacon")?"Homing Beacon":t}function Ds(t){return t&&t.split(/\s+/).map(n=>!n||/[A-Z]/.test(n.slice(1))?n:n[0].toUpperCase()+n.slice(1).toLowerCase()).join(" ")}function qi(t,n){if(!n)return`${t}x`;const a=String(n).trim(),r=a.match(/^(\d+)x\s+(.*)$/i);if(r){const s=parseInt(r[1],10)||1,i=r[2]||"";return`${Math.max(1,t*s)}x ${i}`}return`${t}x ${a}`}function Lm(t,n){if(!t||!n)return;n.items=n.items||[];const a=t.trim(),r=a.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),o=de(i);if((n.items||[]).some(y=>{if(!y||!y.name)return!1;const u=String(y.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]+\)$/,"").trim();return de(u)===o}))return;const h=`E: ${i.split(/\s+/).map(y=>y[0]?y[0].toUpperCase():"").join("")}${s}`.trim(),m={quantity:"1x",name:`Enhancement: ${i}`,nameshort:h,items:[],type:"special"};n.items.push(m)}function Dm(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=[];let r=0;for(;r<t.length;r++){const m=(t[r]||"").trim();if(m){if(m.startsWith("+")){a.push(m);continue}if(!m.startsWith("&"))break}}for(const h of a){const y=h.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(y){const u=y[1].trim().toUpperCase(),p=y[2].trim();if(u==="FACTION KEYWORD"){const g=p.split(" - ");n.SUMMARY.FACTION_KEYWORD=g[g.length-1].trim()}else u==="DETACHMENT"?n.SUMMARY.DETACHMENT=p.replace(/\u00A0/g," "):u==="TOTAL ARMY POINTS"&&(n.SUMMARY.TOTAL_ARMY_POINTS=p)}}if(n.SUMMARY.LIST_TITLE="",n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD){const h=n.SUMMARY.FACTION_KEYWORD,m=Object.keys(wa).find(u=>u.toLowerCase()===(h||"").toString().toLowerCase()),y=m?wa[m]:null;y?n.SUMMARY.DISPLAY_FACTION=`${y} - ${h}`:n.SUMMARY.DISPLAY_FACTION=h+(n.SUMMARY.DETACHMENT?` - ${n.SUMMARY.DETACHMENT}`:"");try{n.SUMMARY.FACTION_KEY=h.toString().toLowerCase()}catch{}}const s=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,i=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;let o=null,c=null;for(;r<t.length;r++){const h=t[r]||"",m=h.trim();if(!m)continue;if(/^Enhancement:\s*/i.test(m)){const _=m.replace(/^Enhancement:\s*/i,"").trim();c&&Lm(_,c);continue}const y=m.match(s);if(y){const _=y[1],T=y[2]?`${y[2]}x`:"1x",E=(y[3]||"").trim(),k=parseInt(y[4],10)||0,L=y[5],w={quantity:T,name:E,points:k,items:[],isComplex:!1,nameshort:"",charId:_||null};_?(n.CHARACTER.push(w),c=w):(n["OTHER DATASHEETS"]=n["OTHER DATASHEETS"]||[],n["OTHER DATASHEETS"].push(w)),o=w,L&&L.split(",").map(A=>A.trim()).filter(Boolean).forEach(A=>ca(w,A,w.name,n.SUMMARY.FACTION_KEYWORD||"",w.name,!0));continue}const u=h.match(i);if(u){const _=u[1].trim(),T=_.match(/^(\d+)\s+with\s+(.*)$/i);if(T&&o){const L=parseInt(T[1],10)||1,w=T[2],A=o.items&&o.items.length>0?o.items[o.items.length-1]:o;try{zn.push(`WITHMATCH unit=${o.name} target=${A&&A.name} n=${L} rest=${w}`)}catch{}w.split(",").map(R=>R.trim()).filter(Boolean).forEach(R=>{const C=Ds(La(R));if(A&&A.type==="subunit"){try{zn.push(`WITH->SUB target=${A.name} item=${C} n=${L}`)}catch{}ca(A,`${L}x ${C}`,A.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}else{try{zn.push(`WITH->UNIT unit=${o.name} item=${C} n=${L}`)}catch{}ca(A,qi(L,C),A.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}});continue}const E=_.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(E&&o){const L=E[1],w=E[2].trim(),A=E[3]||"",R={quantity:L,name:w,items:[],type:"subunit",_parent:o};if(o.items=o.items||[],o.items.push(R),A){const D=A.match(/^(\d+)\s+with\s+(.*)$/i);D?D[2].split(",").map($=>$.trim()).filter(Boolean).forEach($=>{const H=La($);ca(R,H,R.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}):A.split(",").map(C=>C.trim()).filter(Boolean).forEach(C=>{const $=La(C);ca(R,$,R.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)})}continue}const k=_.match(/^(\d+x?)\s+(.*)$/i);if(k&&o)if(o.charId){const L=k[1],w=k[2].trim();ca(o,`${L} ${w}`,o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0);continue}else{const L={quantity:k[1],name:k[2].trim(),items:[],type:"subunit",_parent:o};o.items=o.items||[],o.items.push(L);continue}if(o){let L=_.split(",").map(A=>A.trim()).filter(Boolean);try{const A=o.items&&o.items.length>0?o.items[o.items.length-1]:null;A&&A.name&&(L=L.map(R=>{const D=R.match(/^(.*)\s*\(([^)]+)\)\s*$/);if(D){const C=D[1].trim();if(de(C)===de(A.name))return C}return R}))}catch{}try{const A=new Set;L=L.filter(R=>{const D=de(Ds(La(R)));return A.has(D)?!1:(A.add(D),!0)})}catch{}let w=o;if(o.items&&o.items.length>0){const A=o.items[o.items.length-1];A&&A.type==="subunit"&&(w=A)}L.forEach(A=>{const R=Ds(La(A));ca(w,R,w.name||o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}continue}const p=m.match(/^(\d+)\s+with\s+(.*)$/i);if(p&&o){const _=parseInt(p[1],10)||1,T=p[2],E=o.items&&o.items.length>0?o.items[o.items.length-1]:o;T.split(",").map(k=>k.trim()).filter(Boolean).forEach(k=>{const w=Ds(La(k));E&&E.type==="subunit"?ca(E,`${_}x ${w}`,E.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0):ca(E,qi(_,w),E.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const g=m.match(/^(.*?):\s*(.*)$/);if(g&&o){(g[2]||"").split(",").map(T=>T.trim()).filter(Boolean).forEach(T=>{const E=La(T);ca(o,E,o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}}const d=[...n.CHARACTER||[],...n["OTHER DATASHEETS"]||[]];for(const h of d){h&&Array.isArray(h.items)&&h.items.length>0&&fa(h.items);const m=h&&Array.isArray(h.items)?h.items.filter(y=>y&&y.type==="subunit"):[];for(const y of m)y&&Array.isArray(y.items)&&y.items.length>0&&fa(y.items)}_s(n);try{n.SUMMARY._parseDebug=(zn||[]).slice(0,200)}catch{}return n}const zn=[];function vr(t){const n=Za(t);if(n>0)return n;const a=(t||"").trim();return a.startsWith("â¦")||a.startsWith("+")?2:0}function gr(t){if(!t)return"";const n=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(t).split(/\s+/).map((a,r)=>{if(!a)return"";const s=a.toLowerCase();return r>0&&n.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function Cs(t,n,a,r,s="",i=!1,o="wargear",c=1){if(!t)return;t.items=t.items||[];const d=ts(String(n||"").trim()),h=d.quantity?String(d.quantity):"1x",m=d.name||"",y=de(m);if(i){const p=String(a||""),g=String(s||"");if(de(p)===de(m)||g&&de(g)===de(m))return}const u=t.items.find(p=>de(p.name||"")===y);if(u){const p=parseInt(String(u.quantity||"1x").replace(/x/i,""),10)||0,g=parseInt(String(h||"1x").replace(/x/i,""),10)||0;u.quantity=`${p+g}x`}else{const p=de(m)==="warlord"?"special":o;t.items.push({quantity:h,name:m,items:[],type:p,nameshort:""})}}function Ui(t,n,a){if(!t||!n)return;n.items=n.items||[];const r=t.trim(),s=r.match(/\(([^)]+)\)$/),i=s?` (${s[1]})`:"",o=r.replace(/\s*\([^)]+\)$/,"").trim(),c=de(o);if((n.items||[]).some(u=>u&&u.type==="special"&&de((u.name||"").replace(/^Enhancement:\s*/i,""))===c))return;const m=`E: ${o.split(/\s+/).map(u=>u[0]?u[0].toUpperCase():"").join("")}${i}`.trim(),y={quantity:"1x",name:`Enhancement: ${o}`,nameshort:m,items:[],type:"special"};n.items.push(y)}function Im(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=t.findIndex(u=>a.test((u||"").trim().toUpperCase()));let i=(r===-1?t.slice(0,0):t.slice(0,r)).map(u=>(u||"").trim()).filter(u=>u&&!u.startsWith("Exported with"));const o=i.findIndex(u=>u&&u.trim()!=="");if(o!==-1){const u=i[o],p=u.match(/^(.*?)\s*\((\s*\d+\s*(?:pts|points)\s*)\)\s*$/i);if(p){n.SUMMARY.LIST_TITLE=p[1].trim();const R=(p[2].match(/(\d+)/)||[])[1]||"";R&&(n.SUMMARY.TOTAL_ARMY_POINTS=`${R}pts`)}else n.SUMMARY.LIST_TITLE=u;const g=[];for(let R=o+1;R<i.length;R++){const D=i[R];D&&g.push(D)}const _=["Combat Patrol","Incursion","Strike Force","Onslaught"],T=R=>{if(!R||!/\(/.test(R))return!1;for(const D of _)if(new RegExp(D,"i").test(R))return!0;return!1},E=new Set(Object.values(wa).map(R=>(R||"").toString().toLowerCase())),k=g.filter(R=>!(!R||T(R)||E.has(R.toLowerCase())));let L=null,w=null;const A=Object.keys(wa).map(R=>R.toLowerCase());for(const R of k)A.includes((R||"").toString().toLowerCase())?L=R:w||(w=R);if(!L&&k.length>0&&(L=k[0],w=k.length>1?k[1]:w),L&&(n.SUMMARY.FACTION_KEYWORD=L),w&&(n.SUMMARY.DETACHMENT=w),L){const R=Object.keys(wa).find(C=>C.toLowerCase()===L.toLowerCase()),D=R?wa[R]:null;D?n.SUMMARY.DISPLAY_FACTION=`${D} - ${L}`:n.SUMMARY.DISPLAY_FACTION=L+(w?` - ${w}`:"");try{n.SUMMARY.FACTION_KEY=L.toString().toLowerCase()}catch{}}}const c=r===-1?0:r,d=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*$/i,h=/^\s*(?:â¢|\-|\+|â¦)\s*(.*)$/;let m=null;for(let u=c;u<t.length;u++){const g=(t[u]||"").trim();if(!g||g.startsWith("Exported with"))continue;if(a.test(g.toUpperCase())){m=/^CHARACTERS?/i.test(g)?"CHARACTER":"OTHER DATASHEETS";continue}const _=g.match(d);if(_){const T=_[1].trim(),E=parseInt(String(_[2]).replace(/[\,\.\s]/g,""),10)||0;let k="1x",L=T;const w=T.match(/^([0-9]+x?)\s+(.*)$/i);w&&(k=w[1].toLowerCase(),L=w[2].trim());const A={quantity:k,name:L,points:E,items:[],isComplex:!1,nameshort:""},R=m==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[R]=n[R]||[],n[R].push(A);const D=[];let C=u+1;for(;C<t.length;){const N=t[C]||"";if(!N.trim()||a.test(N.trim().toUpperCase())||d.test(N.trim())||!/^\s+/.test(N)&&!h.test(N))break;D.push(N),C++}const $=(()=>{for(let N=0;N<D.length;N++){const he=D[N];if(!he.match(h))continue;const ne=vr(he);for(let se=N+1;se<D.length;se++){const ce=D[se];if(!ce.trim()||vr(ce)<=ne)break;if(h.test(ce))return!0}}return!1})();let H=null,oe=0;for(let N=0;N<D.length;N++){const he=D[N],we=he.trim(),ne=he.match(h),se=vr(he);if(ne){const ce=ne[1].trim(),be=ce.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(ce)){Ui(ce.replace(/^Enhancement:\s*/i,"").trim(),A,n.SUMMARY.FACTION_KEYWORD||"");continue}else if(be){Ui(ce.trim(),A,n.SUMMARY.FACTION_KEYWORD||"");continue}if($){if(H&&typeof oe=="number"&&se>oe){Cs(H,ce,H.name,n.SUMMARY.FACTION_KEYWORD||"",A.name,!1);continue}if(!(()=>{for(let Y=N+1;Y<D.length;Y++){const ve=D[Y];if(!ve.trim()||vr(ve)<=se)break;if(h.test(ve))return!0}return!1})()){H=null,Cs(A,ce,A.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}H=null;const J=ce.match(/^(\d+x?)\s+(.*)$/i),U=J?J[1]:"1x",V=J?J[2].trim():ce,xe={quantity:U,name:V,items:[],type:"subunit"};A.items=A.items||[],A.items.push(xe),H=xe,oe=se;continue}Cs(A,ce,A.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(H&&se>oe){Cs(H,we,H.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}Cs(A,we,A.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1)}u=C-1;continue}}function y(u,p){if(!(!u||typeof u!="object")){if(typeof u.name!="string"&&(u.name=""),typeof u.quantity!="string"&&(u.quantity=u.quantity?String(u.quantity):"1x"),typeof u.type!="string"&&(u.type=u.type||"wargear"),typeof u.nameshort!="string"&&(u.nameshort=u.nameshort||""),Array.isArray(u.items)||(u.items=[]),/^Enhancement:/i.test(u.name)){const g=u.name.replace(/^Enhancement:\s*/i,"").trim();u.type="special",u.nameshort=u.nameshort||(()=>{const _=g.match(/\(([^)]+)\)$/),T=_?` (${_[1]})`:"";return`E: ${g.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(L=>L[0]?L[0].toUpperCase():"").join("")}${T}`.trim()})(),u.name=`Enhancement: ${gr(g.replace(/\s*\([^)]+\)$/,"").trim())}`}else u.name=p?u.name:gr(u.name);de(u.name)==="warlord"&&(u.type="special"),u.items=(u.items||[]).map(g=>{if(!g)return null;if(typeof g=="string"){const _={quantity:"1x",name:g.trim(),items:[],type:/^Enhancement:/i.test(g)?"special":"wargear",nameshort:""};return y(_,u.name),_.name&&(_.name=gr(_.name)),_}return y(g,u.name),g&&g.name&&(g.name=gr(g.name)),g}).filter(Boolean)}}for(const u of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[u]))for(const p of n[u]){y(p);const g=(p.items||[]).filter(_=>_&&_.type==="subunit");if(g.length>0)if(g.every(T=>de(T.name||"")===de(p.name||""))){const T=new Map;let E=0;for(const k of g){const L=parseInt(String(k.quantity||"1x").replace(/x/i,""),10)||1;E+=L;for(const w of k.items||[]){const A={items:[]};Cs(A,`${w.quantity||"1x"} ${w.name}`,p.name,n.SUMMARY.FACTION_KEYWORD||"",w.type||"wargear",1);for(const R of A.items){const D=de(R.name||"");if(T.has(D)){const C=T.get(D),$=parseInt(String(C.quantity||"1x").replace(/x/i,""),10)||0,H=parseInt(String(R.quantity||"1x").replace(/x/i,""),10)||0;C.quantity=`${$+H}x`}else T.set(D,R)}}}p.items=Array.from(T.values()),E>0&&(p.quantity=`${E}x`),p.isComplex=!1}else{const T=g.reduce((E,k)=>E+(parseInt(String(k.quantity||"1x").replace(/x/i,""),10)||0),0);T>0&&(p.quantity=`${T}x`),p.isComplex=!0}else p.isComplex=!1;Array.isArray(p.items)&&p.items.length>0&&fa(p.items)}return _s(n),n}function Ki(t){if(!t)return"";const n=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(t).split(/\s+/).map((a,r)=>{if(!a)return"";const s=a.toLowerCase();return r>0&&n.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function za(t,n,a,r,s="",i=!1,o="wargear",c=1){if(!t)return;t.items=t.items||[];const d=ts(String(n||"").trim()),h=d.quantity?String(d.quantity):"1x",m=parseInt(String(h||"1x").replace(/[^0-9]/g,""),10)||1,y=`${m*(c||1)}x`;let u=d.name||"";if(!i)try{const _=u.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(_){const T=_[1].trim(),E=_[2].trim(),k=de(T),L=de(a||""),w=de(s||"");k&&(k===L||k===w||L.startsWith(k+" ")||w.startsWith(k+" ")||k.startsWith(L+" ")||k.startsWith(w+" "))&&(u=E)}}catch{}const p=de(u);if(i){const _=String(a||""),T=String(s||""),E=de(u),k=de(_),L=de(T),w=k&&E.startsWith(k+" "),A=L&&E.startsWith(L+" ");if(k&&(E===k||w)||L&&(E===L||A)){const R=u.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(R){const D=R[1].trim(),C=R[2].trim(),$=de(D);if($===k||$===L||$.startsWith(k+" ")||$.startsWith(L+" ")){if(t&&t._deferredParenthetical&&de(t._deferredParenthetical)===de(C)||t&&t._deferredParenthetical&&de(t._deferredParenthetical)===de(C)||(t.items||[]).some(oe=>de(oe.name||"")===de(C)))return;za(t,C,a,r,s,!1,o,m);return}}return}}const g=t.items.find(_=>de(_.name||"")===p);if(g){const _=parseInt(String(g.quantity||"1x").replace(/x/i,""),10)||0,T=parseInt(String(y||"1x").replace(/x/i,""),10)||0;g.quantity=`${_+T}x`}else{const _=de(u)==="warlord"?"special":o;t.items.push({quantity:y,name:u,items:[],type:_,nameshort:""})}}function ni(t,n,a){if(!t||!n)return;n.items=n.items||[];const r=t.trim(),s=r.match(/\(([^)]+)\)$/),i=s?` (${s[1]})`:"",o=r.replace(/\s*\([^)]+\)$/,"").trim(),c=de(o);if((n.items||[]).some(u=>u&&u.type==="special"&&de((u.name||"").replace(/^Enhancement:\s*/i,""))===c))return;const m=`E: ${o.split(/\s+/).map(u=>u[0]?u[0].toUpperCase():"").join("")}${i}`.trim(),y={quantity:"1x",name:`Enhancement: ${o}`,nameshort:m,items:[],type:"special"};n.items.push(y)}function Gi(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*(?::\s*(.*))?$/i,s=/^\s*(?:â¢|\-|\+|â¦)\s*(.*)$/;let i=null;for(let c=0;c<t.length;c++){const h=(t[c]||"").trim();if(!h)continue;if(a.test(h.toUpperCase())){i=/^CHARACTERS?/i.test(h)?"CHARACTER":"OTHER DATASHEETS";continue}const m=h.match(r);if(m){const y=m[1].trim(),u=parseInt(String(m[2]).replace(/[\,\.\s]/g,""),10)||0;let p="1x",g=y;const _=y.match(/^([0-9]+x?)\s+(.*)$/i);_&&(p=_[1].toLowerCase(),g=_[2].trim());const T={quantity:p,name:g,points:u,items:[],isComplex:!1,nameshort:""},E=i==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[E]=n[E]||[],n[E].push(T);const k=m[3]||"";k&&k.split(",").map(C=>C.trim()).filter(Boolean).forEach(C=>za(T,C,T.name,n.SUMMARY.FACTION_KEYWORD||"",T.name,!0));const L=[];let w=c+1;for(;w<t.length;){const C=t[w]||"";if(!C.trim()||a.test(C.trim().toUpperCase())||r.test(C.trim())||!/^\s+/.test(C)&&!s.test(C))break;L.push(C),w++}const A=(()=>{for(let C=0;C<L.length;C++){const $=L[C];if(!$.match(s))continue;const oe=Za($);for(let N=C+1;N<L.length;N++){const he=L[N];if(!he.trim()||Za(he)<=oe)break;if(s.test(he))return!0}}return!1})();let R=null,D=0;for(let C=0;C<L.length;C++){const $=L[C],H=$.trim(),oe=$.match(s),N=Za($);if(oe){const he=oe[1].trim(),we=he.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(he)){ni(he.replace(/^Enhancement:\s*/i,"").trim(),T,n.SUMMARY.FACTION_KEYWORD||"");continue}else if(we){ni(he.trim(),T,n.SUMMARY.FACTION_KEYWORD||"");continue}if(A){if(R&&typeof D=="number"&&N>D){const De=he.split(",").map(J=>J.trim()).filter(Boolean);for(let J of De){const U=J.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(U){const V=U[1].trim(),xe=U[2].trim();if(de(V)===de(R.name)){const Y=De.some(fe=>de(fe)===de(xe)),ve=(R.items||[]).some(fe=>de(fe.name||"")===de(xe));if(Y||ve)continue;const Me=ts(J),dt=parseInt(String(Me.quantity||"1x").replace(/[^0-9]/g,""),10)||1;za(R,xe,R.name,n.SUMMARY.FACTION_KEYWORD||"",T.name,!1,"wargear",dt);continue}}za(R,J,R.name,n.SUMMARY.FACTION_KEYWORD||"",T.name,!0)}continue}R=null;const ne=he.match(/^(\d+x?)\s+(.*)$/i),se=ne?ne[1]:"1x";let ce=ne?ne[2].trim():he;try{const De=ce.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(De){const J=De[1].trim(),U=De[2].trim(),V=de(J),xe=de(T.name||""),Y=de(unitTopName||T.name||"");if(V&&(V===xe||xe.startsWith(V)||V.startsWith(xe)||Y.startsWith(V)||V.startsWith(Y))){ce=J;const ve={quantity:se,name:ce,items:[],type:"subunit"};ve._deferredParenthetical=U,ve._deferredParentheticalQty=parseInt(String(se||"1x").replace(/[^0-9]/g,""),10)||1,T.items=T.items||[],T.items.push(ve),R=ve,D=N;continue}}}catch{}const be={quantity:se,name:ce,items:[],type:"subunit"};T.items=T.items||[],T.items.push(be),R=be,D=N;continue}za(T,he,T.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(R&&N>D){za(R,H,R.name,n.SUMMARY.FACTION_KEYWORD||"",T.name,!0);continue}za(T,H,T.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1)}c=w-1;continue}}function o(c,d){if(!(!c||typeof c!="object")){if(typeof c.name!="string"&&(c.name=""),typeof c.quantity!="string"&&(c.quantity=c.quantity?String(c.quantity):"1x"),typeof c.type!="string"&&(c.type=c.type||"wargear"),typeof c.nameshort!="string"&&(c.nameshort=c.nameshort||""),Array.isArray(c.items)||(c.items=[]),/^Enhancement:/i.test(c.name)){const h=c.name.replace(/^Enhancement:\s*/i,"").trim();c.type="special",c.nameshort=c.nameshort||(()=>{const m=h.match(/\(([^)]+)\)$/),y=m?` (${m[1]})`:"";return`E: ${h.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(g=>g[0]?g[0].toUpperCase():"").join("")}${y}`.trim()})(),c.name=`Enhancement: ${Ki(h.replace(/\s*\([^)]+\)$/,"").trim())}`}else c.name=d?c.name:Ki(c.name);de(c.name)==="warlord"&&(c.type="special"),c.items=(c.items||[]).map(h=>{if(!h)return null;if(typeof h=="string"){const m={quantity:"1x",name:h.trim(),items:[],type:/^Enhancement:/i.test(h)?"special":"wargear",nameshort:""};return o(m,c.name),m}return o(h,c.name),h}).filter(Boolean)}}for(const c of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[c]))for(const d of n[c]){o(d);const h=(d.items||[]).filter(y=>y&&y.type==="subunit");if(h.length>0)if(h.every(u=>de(u.name||"")===de(d.name||""))){const u=new Map;let p=0;for(const g of h){const _=parseInt(String(g.quantity||"1x").replace(/x/i,""),10)||1;p+=_;for(const T of g.items||[]){const E={items:[]};za(E,`${T.quantity||"1x"} ${T.name}`,d.name,n.SUMMARY.FACTION_KEYWORD||"",T.type||"wargear",1);for(const k of E.items){const L=de(k.name||"");if(u.has(L)){const w=u.get(L),A=parseInt(String(w.quantity||"1x").replace(/x/i,""),10)||0,R=parseInt(String(k.quantity||"1x").replace(/x/i,""),10)||0;w.quantity=`${A+R}x`}else u.set(L,k)}}}d.items=Array.from(u.values()),p>0&&(d.quantity=`${p}x`),d.isComplex=!1}else{const u=h.reduce((p,g)=>p+(parseInt(String(g.quantity||"1x").replace(/x/i,""),10)||0),0);u>0&&(d.quantity=`${u}x`),d.isComplex=!1}else d.isComplex=!1;if(Array.isArray(d.items)&&d.items.length===1&&d.items[0]&&d.items[0].type==="subunit"){const y=d.items[0];Array.isArray(y.items)&&y.items.length>0&&(d.items=y.items.slice(),d.isComplex=!1)}Array.isArray(d.items)&&d.items.length>0&&fa(d.items);const m=(d.items||[]).filter(y=>y&&y.type==="subunit");for(const y of m)Array.isArray(y.items)&&y.items.length>0&&fa(y.items)}return _s(n),n}function $m(t){if(!Array.isArray(t))return Gi(t);const n=[];let a=0;for(;a<t.length;a++){const y=String(t[a]||"").trim();if(!y){n.push(y);continue}if(y.startsWith("+")||y.startsWith("&")){n.push(y);continue}break}const r=[],s={};for(const m of n){if(!m)continue;if(m.startsWith("&")){const g=m.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);g&&r.push({enh:g[1].trim(),target:(g[3]||"").trim(),charId:g[2]||null});continue}const u=m.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(u){const p=u[1].trim().toUpperCase(),g=u[2].trim();if(p==="ENHANCEMENT"){const _=g.match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);_?r.push({enh:_[1].trim(),target:(_[3]||"").trim(),charId:_[2]||null}):r.push({enh:g,target:null,charId:null})}else if(p==="FACTION KEYWORD"){const _=g.split(" - ");s.faction=_[_.length-1].trim()}else p==="DETACHMENT"?s.detachment=g.replace(/\u00A0/g," "):p==="TOTAL ARMY POINTS"&&(s.points=g)}}const i=t.slice(a),o=[];for(const m of i){if(!m){o.push(m);continue}let y=String(m);y=y.replace(/^\s*Char\d+:\s*/i,"");const u=y.match(/^(.*\))\s*:\s*(.+)$/);u?(o.push(u[1]),o.push("  â¢ "+u[2])):o.push(y)}const c=Gi(o);c.SUMMARY=c.SUMMARY||{},s.faction&&(c.SUMMARY.FACTION_KEYWORD=s.faction),s.detachment&&(c.SUMMARY.DETACHMENT=s.detachment),s.points&&(c.SUMMARY.TOTAL_ARMY_POINTS=s.points);const d=[...c.CHARACTER||[],...c["OTHER DATASHEETS"]||[]],h=m=>{const y=de(String(m||""));for(const u of d){const p=u&&Array.isArray(u.items)?u.items:[];for(const g of p){if(!g||!g.name)continue;const _=String(g.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,"").trim();if(de(_)===y)return!0}}return!1};for(const m of r){if(!m||!m.enh||h(m.enh))continue;let y=null;const u=p=>String(p||"").toLowerCase().replace(/[^a-z0-9 ]/g,"").trim();if(m.charId){const p=parseInt(String(m.charId).replace(/[^0-9]/g,""),10);!Number.isNaN(p)&&p>0&&Array.isArray(c.CHARACTER)&&c.CHARACTER[p-1]&&(y=c.CHARACTER[p-1])}!y&&m.target&&(y=d.find(p=>u(p.name).includes(u(m.target))||u(`${p.quantity} ${p.name}`).includes(u(m.target)))),!y&&d.length===1&&(y=d[0]),y&&ni(m.enh,y,c.SUMMARY.FACTION_KEYWORD||"")}try{for(const m of["CHARACTER","OTHER DATASHEETS"]){const y=c[m];if(Array.isArray(y))for(const u of y)u&&typeof u=="object"&&Object.prototype.hasOwnProperty.call(u,"type")&&delete u.type}for(const m of["CHARACTER","OTHER DATASHEETS"]){const y=c[m];if(Array.isArray(y)){for(const u of y)if(!(!u||!Array.isArray(u.items))){for(const p of u.items.filter(g=>g&&g.type==="subunit"))if(p&&p._deferredParenthetical)try{delete p._deferredParenthetical,delete p._deferredParentheticalQty}catch{}}}}}catch{}return _s(c),c}function Pm(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=t.map(h=>String(h||"")).find(h=>h.trim()),r=t.findIndex(h=>String(h||"").trim());if(a){const h=a.split(/\s*-\s*/).map(m=>m.trim()).filter(Boolean);if(n.SUMMARY.FACTION_FAMILY=h[0]||"",n.SUMMARY.FACTION_KEYWORD=h[1]||"",h.length>=3){const y=h[h.length-1].match(/\[\s*(\d{2,5})\s*pts?\s*\]$/i);y?(n.SUMMARY.TOTAL_ARMY_POINTS=`${y[1]}pts`,h.length===3?n.SUMMARY.LIST_TITLE=h[2]:n.SUMMARY.LIST_TITLE=h.slice(2,h.length-1).join(" - ")):n.SUMMARY.LIST_TITLE=h.slice(2).join(" - ")}n.SUMMARY.DISPLAY_FACTION=a.trim()}for(let h=0;h<Math.min(t.length,40);h++){const m=String(t[h]||"").trim();if(!m)continue;const y=m.match(/^Detachment:\s*(.*)$/i);y&&(n.SUMMARY.DETACHMENT=y[1].trim());const u=m.match(/^TOTAL ARMY POINTS:\s*(.*)$/i);u&&(n.SUMMARY.TOTAL_ARMY_POINTS=u[1].trim());const p=m.match(/^FACTION KEYWORD:\s*(.*)$/i);p&&(n.SUMMARY.FACTION_KEYWORD=p[1].trim());const g=m.match(/^Battle Size:\s*(.*)$/i);g&&(n.SUMMARY.BATTLE_SIZE=g[1].trim());const _=m.match(/^#+\s*(?:\+{1,2}\s*)?(.*)\[\s*\d{2,5}\s*pts?\s*\]$/i);if(_&&!n.SUMMARY.LIST_TITLE){const T=_[1].trim();/Army\s+Roster/i.test(T)||/\+\+/.test(T)?n.SUMMARY.LIST_TITLE="":n.SUMMARY.LIST_TITLE=T}}if(!n.SUMMARY.FACTION_KEYWORD&&n.SUMMARY.DISPLAY_FACTION){const h=n.SUMMARY.DISPLAY_FACTION.split(" - ");h.length>=2?n.SUMMARY.FACTION_KEYWORD=h[1].trim():n.SUMMARY.FACTION_KEYWORD=n.SUMMARY.DISPLAY_FACTION.replace(/\s*\[.*$/,"").trim()}const s=/^(?:(\d+)x?\s+)?(.+?)\s*\[\s*(\d{1,4})\s*pts?\s*\]\s*(?::\s*(.*))?$/i,i=/^\s*(?:â¢|\-|\+)\s*(.*)$/;let o=null,c=null;for(let h=0;h<t.length;h++){const m=String(t[h]||""),y=m.trim();if(!y||h===r)continue;if(y.startsWith("#")){const g=y.match(/^#+\s*(.+?)\s*(?:\[\s*\d+\s*pts?\s*\])?$/i);if(g){const _=g[1].trim();/character|epic|hero|hq/i.test(_)?o="CHARACTER":o="OTHER DATASHEETS"}continue}const u=y.match(s);if(u){const g=u[1]?`${u[1]}x`:"1x",_=(u[2]||"").trim(),T=parseInt(u[3],10)||0,E=u[4]||"",k={quantity:g,name:_,points:T,items:[],isComplex:!1,nameshort:""};o||(o="OTHER DATASHEETS"),n[o]=n[o]||[],n[o].push(k),c=k,E&&E.split(",").map(L=>L.trim()).filter(Boolean).forEach(L=>{d(c,L,c.name,n.SUMMARY.FACTION_KEYWORD||"",c.name,!0)});continue}const p=m.match(i);if(p&&c){const g=p[1].trim(),_=g.match(/^(\d+)\s+with\s+(.*)$/i);if(_&&c){const k=parseInt(_[1],10)||1,L=_[2],w=c.items&&c.items.length>0?c.items[c.items.length-1]:c;L.split(",").map(A=>A.trim()).filter(Boolean).forEach(A=>d(w,`${k}x ${A}`,w.name,n.SUMMARY.FACTION_KEYWORD||"",c.name,!0));continue}const T=g.match(/^(\d+x?)\s+([^:]+):\s*(.*)$/i);if(T){const k=T[1];let L=T[2].trim();const w=T[3]||"";L=L.replace(/\s+w\/.*$/i,"").trim();const A={quantity:k,name:L,items:[],type:"subunit"};if(w){const R=w.match(/^(\d+)\s+with\s+(.*)$/i);if(R){const D=parseInt(R[1],10)||1;R[2].split(",").map($=>$.trim()).filter(Boolean).forEach($=>d(A,`${D}x ${$}`,A.name,n.SUMMARY.FACTION_KEYWORD||"",c.name,!0))}else w.split(",").map(D=>D.trim()).filter(Boolean).forEach(D=>d(A,D,A.name,n.SUMMARY.FACTION_KEYWORD||"",c.name,!0))}c.items=c.items||[],c.items.push(A);continue}const E=g.match(/^(\d+x?)\s+(.*)$/i);if(E&&c){let k=E[2].trim();k=k.replace(/\s+w\/.*$/i,"").trim();const L={quantity:E[1],name:k,items:[],type:"subunit"};c.items=c.items||[],c.items.push(L);continue}d(c,g,c.name,n.SUMMARY.FACTION_KEYWORD||"",c.name,!0);continue}}function d(h,m,y,u,p="",g=!1,_="wargear"){if(!h)return;h.items=h.items||[];const T=String(m||"").trim(),E=ts(T),k=E.quantity?String(E.quantity):"1x",L=/^\s*\d+x?\s+/i.test(T);let w=E.name||"";const A=w.match(/^(.*?)\s*\(([^)]+)\)$/);if(A){const H=(A[1]||"").trim(),oe=(A[2]||"").trim();(/\bDrone\b/i.test(H)||/\bDrone\b/i.test(w))&&(w=oe)}const R=de(w);if(g){const H=String(y||""),oe=String(p||"");if(de(H)===de(w)||oe&&de(oe)===de(w))return}const D=parseInt(String(k||"1x").replace(/x/i,""),10)||1;let C=D;if(h&&h.type==="subunit"){const H=parseInt(String(h.quantity||"1x").replace(/[^0-9]/g,""),10)||1;C=L?D:H}const $=h.items.find(H=>de(H.name||"")===R);if($){const H=parseInt(String($.quantity||"1x").replace(/x/i,""),10)||0;$.quantity=`${H+C}x`}else{const H=de(w)==="warlord"?"special":_;h.items.push({quantity:`${C}x`,name:w,items:[],type:H,nameshort:""})}}for(const h of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[h]))for(const m of n[h]){if(!m||!Array.isArray(m.items)||m.items.length===0)continue;if(m.items.filter(p=>p&&p.type==="subunit").length>1){const p=new Map,g=[];for(const _ of m.items){if(!_||_.type!=="subunit"){g.push(_);continue}const T=de(_.name||"");if(!p.has(T))p.set(T,{quantity:_.quantity||"1x",name:_.name,items:Array.isArray(_.items)?_.items.slice():[],type:"subunit"});else{const E=p.get(T),k=parseInt(String(E.quantity||"1x").replace(/[^0-9]/g,""),10)||0,L=parseInt(String(_.quantity||"1x").replace(/[^0-9]/g,""),10)||0;E.quantity=`${k+L}x`;const w=new Map;for(const A of E.items||[]){const R=de(A&&A.name||"");R&&w.set(R,{quantity:A.quantity||"1x",name:A.name,items:[],type:A.type||"wargear",nameshort:A.nameshort||""})}for(const A of _.items||[]){const R=de(A&&A.name||"");if(R)if(w.has(R)){const D=w.get(R),C=parseInt(String(D.quantity||"1x").replace(/[^0-9]/g,""),10)||0,$=parseInt(String(A.quantity||"1x").replace(/[^0-9]/g,""),10)||0;D.quantity=`${C+$}x`}else w.set(R,{quantity:A.quantity||"1x",name:A.name,items:[],type:A.type||"wargear",nameshort:A.nameshort||""})}E.items=Array.from(w.values())}}m.items=[...g,...Array.from(p.values())]}m&&Array.isArray(m.items)&&m.items.length>0&&fa(m.items);const u=m&&Array.isArray(m.items)?m.items.filter(p=>p&&p.type==="subunit"):[];for(const p of u)p&&Array.isArray(p.items)&&p.items.length>0&&fa(p.items)}return _s(n),n}function Nm(t,n=40){return(Array.isArray(t)?t:String(t||"").split(/\r?\n/)).slice(0,n)}function Om(t){const n=Array.isArray(t)?t:String(t||"").split(/\r?\n/),a=Nm(n,40),r=n.join(`
`),s={NRNR:{score:0,breakdown:{},maxScore:8},"WTC-Compact":{score:0,breakdown:{},maxScore:8},WTC:{score:0,breakdown:{},maxScore:8},GWAPP:{score:0,breakdown:{},maxScore:7},"NR-GW":{score:0,breakdown:{},maxScore:7},LF:{score:0,breakdown:{},maxScore:7}},i=a.some(ne=>/-\s*\[\s*\d{2,5}\s*pts?\s*\]$/i.test(ne)),o=a.some(ne=>/^#{1,3}\s+/.test(ne)),c=a.some(ne=>/^\s*#?\s*\+\+\s*Army Roster\s*\+\+/i.test(ne)),d=a.some(ne=>/^\s*##\s+/.test(ne)),h=/(.+?)\s*[\(\[]\s*([0-9]{1,4})\s*(?:pts|points)\s*[\)\]]/i,m=r.match(new RegExp(h.source,"g"))||[],y=r.match(/^[ \t]*(?:â¢|\-|\+)\s*(?:\d+x?)\s+[^:]+:/gmi)||[],u=r.match(/\b[A-Za-z0-9\-\'â ]+\s*\([^\)]+\)/g)||[],p=/(^|\n)\s*Char\d+:.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)\s*:\s*/i,g=(r.match(new RegExp(p.source,"gi"))||[]).length,_=a.some(ne=>/^(List Name|Factions Used|Army Points|Detachment Rule):/i.test(ne.trim())),T=a.some(ne=>/-\s*\(\s*\d+\s*Points?\s*\)\s*$/i.test(ne)),E=r.match(/^(Epic Hero|Epic Heroes|Character|Characters|Battleline|Infantry|Beast|Vehicle|Dedicated Transport|Other Datasheets):\s*$/gmi)||[],k=(r.match(/^\s*â¢\s*(?:E:|Enhancement:)/gmi)||[]).length,L=(r.match(/^\s*â¢\s+/gmi)||[]).length;_&&(s.LF.score+=4,s.LF.breakdown.headerKeys=4),T&&(s.LF.score+=4,s.LF.breakdown.titleLine=4),E.length>=2&&(s.LF.score+=3,s.LF.breakdown.sectionColons=E.length),L>5&&(s.LF.score+=1,s.LF.breakdown.bullets=L),k>0&&(s.LF.score+=1,s.LF.breakdown.enhancementLines=k),(_||T||E.length>=2)&&(s.NRNR.score-=1,s.WTC.score-=1,s["WTC-Compact"].score-=1,s.GWAPP.score-=1,s["NR-GW"].score-=3),i&&(s.NRNR.score+=2,s.NRNR.breakdown.titleWithBracketedPts=2),o&&(s.NRNR.score+=3,s.NRNR.breakdown.markdownHeading=3),c&&(s.NRNR.score+=2,s.NRNR.breakdown.armyRoster=2),d&&(s.NRNR.score+=1,s.NRNR.breakdown.doubleHashSections=1),m.length>=3&&(s.NRNR.score+=1,s.NRNR.breakdown.unitLines=1),y.length>0&&(s.NRNR.score+=1,s.NRNR.breakdown.bulletWithQty=y.length),u.length>0&&(s.NRNR.score+=.5,s.NRNR.breakdown.parenItem=u.length);const w=a.join(`
`);/^[ \t]*[+&]/m.test(w)&&(s["WTC-Compact"].score+=3,s["WTC-Compact"].breakdown.headerPlusAmp=3),/(FACTION KEYWORD|DETACHMENT|TOTAL ARMY POINTS)/i.test(w)&&(s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.headerKeys=2),m.length>=2&&(s["WTC-Compact"].score+=1,s["WTC-Compact"].breakdown.unitLines=1),g>0&&(s["WTC-Compact"].score+=5,s["WTC-Compact"].breakdown.inlineCharList=g),/^\s*[+&]/m.test(w)&&(s.WTC.score+=1,s.WTC.breakdown.headerPlusAmp=1),/NUMBER OF UNITS:/i.test(w)&&(s.WTC.score+=2,s.WTC.breakdown.numberOfUnits=2);const A=(r.match(/(^|\n)\s*Char\d+:/gi)||[]).length>0;A&&(s.WTC.score+=3,s.WTC.breakdown.charMarkers=3),(o||c||d)&&(s.WTC.score-=2,s.WTC.breakdown.nrnrPenalty=-2,s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.nrnrPenalty=-1);const R=(r.match(/^\s*\d+\s+with\s+/gmi)||[]).length;R>0&&(s.WTC.score+=2,s.WTC.breakdown.withLines=R,s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.withLines=R),a.some(ne=>/^(?:CHARACTER|OTHER DATASHEETS|CHARACTERS)\s*$/.test((ne||"").trim()))&&(s.WTC.score+=1,s.WTC.breakdown.sectionHeaders=1),A&&(s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.charMarkerPenalty=-1),g>0&&(s.WTC.score-=2,s.WTC.breakdown.compactInlinePenalty=-2);const D=/Exported with/i.test(r);(/Exported with/i.test(w)||D)&&(s.GWAPP.score+=6,s.GWAPP.breakdown.exportedWith=6),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS)\b/i.test(r)&&(s.GWAPP.score+=2,s.GWAPP.breakdown.sectionHeaders=2),/\(\s*\d+\s*(?:pts|points)\s*\)/i.test(w)&&(s.GWAPP.score+=1,s.GWAPP.breakdown.titleParenPts=1),D&&(s["NR-GW"].score-=4,s["NR-GW"].breakdown.gwappPenalty=-4),/^\s*Strike Force\s*\(\s*\d{2,5}\s*points\s*\)/mi.test(r)&&(s.GWAPP.score+=3,s.GWAPP.breakdown.strikeForce=3),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|DEDICATED TRANSPORTS)\b/i.test(r)&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.sectionHeaders=2);const C=(r.match(/^[ \t]*(?:â¢|\u2022|â¦|\-|\+)\s+/gmi)||[]).length;C>0&&!D&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.bulletCount=C),u.length>0&&!D&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.parenItem=u.length);const $=(r.match(/^[ \t]*(?:â¢|\u2022|â¦|\-|\+)\s*\d+x?\s+[A-Za-z0-9\-\'â]+/gmi)||[]).length;$>=3&&!A&&!D&&(s["NR-GW"].score+=3,s["NR-GW"].breakdown.bulletQty=$);const H=/^(?:\s*)\d+x?\s+.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)/i,oe=n.filter(ne=>H.test(ne)).length;if(oe>=2&&!A&&!D&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.unitLinesNoChar=oe),!A&&!D&&($>=3||oe>=2)&&(s.WTC.score-=2,s.WTC.breakdown.nrGwPenalty=-2,s["WTC-Compact"].score-=2,s["WTC-Compact"].breakdown.nrGwPenalty=-2),(o||c)&&(s["NR-GW"].score-=1,s["NR-GW"].breakdown.nrnrPenalty2=-1),r.indexOf("â")!==-1)for(const ne of Object.keys(s))s[ne].score+=.5,s[ne].breakdown=s[ne].breakdown||{},s[ne].breakdown.unicodeApostrophe=.5;const N={};for(const ne of Object.keys(s)){const se=s[ne],ce=Math.max(0,Math.min(1,se.score/(se.maxScore||8)));N[ne]={score:se.score,confidence:ce,scoreBreakdown:se.breakdown}}const he=Object.keys(N).sort((ne,se)=>N[se].score-N[ne].score)[0],we=N[he]||{score:0,confidence:0};return{format:he,confidence:we.confidence,score:we.score,scoreBreakdown:we.scoreBreakdown,all:N}}function rl(t){const n=String(t||"").trim().match(/^(\d+)\s+(.*)$/);return n&&!/^\d+x\b/i.test(String(t||""))?`${n[1]}x ${n[2]}`:t}function il(t){const n=String(t||"").trim().replace(/^E:\s*/i,"").replace(/^Enhancement:\s*/i,"").trim(),a=n.match(/\(([^)]*pts?[^)]*)\)\s*$/i),r=n.replace(/\s*\([^)]*\)\s*$/,"").trim(),i=`E: ${r.split(/\s+/).map(o=>o[0]?o[0].toUpperCase():"").join("")}${a?` (${a[1].trim()})`:""}`.trim();return{quantity:"1x",name:`Enhancement: ${r}`,nameshort:i,items:[],type:"special"}}function Wm(t,n){if(!t)return;t.items=t.items||[];const a=rl(String(n||"").trim());if(/^(E:|Enhancement:)/i.test(a)){const s=il(a),i=de(s.name.replace(/^Enhancement:\s*/i,""));(t.items||[]).some(c=>/^Enhancement:/i.test(c.name||"")&&de(String(c.name).replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,""))===i)||t.items.push(s);return}const r=a.split(",").map(s=>s.trim()).filter(Boolean);for(const s of r){const i=ts(s.replace(/^with\s+/i,"")),o=i.quantity||"1x",c=i.name||"";if(!c)continue;const d=de(c),h=t.items.find(m=>de(m.name||"")===d);if(h){const m=parseInt(String(h.quantity||"1x").replace(/[^0-9]/g,""),10)||0,y=parseInt(String(o).replace(/[^0-9]/g,""),10)||0;h.quantity=`${m+y}x`}else t.items.push({quantity:o,name:c,items:[],type:"wargear",nameshort:""})}}function Ym(t,n){const a=t[n]||"",r=Za(a);for(let s=n+1;s<t.length;s++){const i=t[s]||"";if(!i.trim())continue;const o=Za(i),c=/^\s*â¢\s*/.test(i);return o>r&&c}return!1}function Hm(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=t.slice(0,30).map(u=>String(u||""));let r=!1;for(const u of a){const p=u.match(/^\s*([A-Za-z ][A-Za-z ]*):\s*(.*)$/);if(!p)continue;const g=p[1].trim().toLowerCase(),_=p[2].trim();if(g==="list name"&&(n.SUMMARY.LIST_TITLE=_,r=!0),g==="factions used"&&(n.SUMMARY.FACTION_KEYWORD=_,r=!0),g==="army points"){const T=parseInt(_.replace(/[^0-9]/g,""),10);T&&(n.SUMMARY.TOTAL_ARMY_POINTS=`${T}pts`,r=!0)}g==="detachment rule"&&(n.SUMMARY.DETACHMENT=_,r=!0)}if(!r){const u=t.find(p=>String(p||"").trim());if(u){const p=String(u).match(/^(.*?)\s*-\s*(.*?)\s*-\s*(.*?)\s*\((\d+)\s*Points?\)/i);p&&(n.SUMMARY.LIST_TITLE=p[1].trim(),n.SUMMARY.FACTION_KEYWORD=p[2].trim(),n.SUMMARY.DETACHMENT=p[3].trim(),n.SUMMARY.TOTAL_ARMY_POINTS=`${parseInt(p[4],10)}pts`)}}const s=/^\s*([A-Za-z ]+):\s*$/,i=/^\s*(.*?)\s*\((\d+)\s*pts?\)\s*$/i,o=/^\s*â¢\s*(.*)$/;let c=null;const d=[];for(let u=0;u<t.length;u++){const p=String(t[u]||"");if(!p.trim())continue;const _=p.match(s);if(_){const R=_[1].trim().toLowerCase();c=/hero|character/.test(R)?"CHARACTER":"OTHER DATASHEETS",d.length=0;continue}const T=p.match(i);if(T&&Za(p)===0){const R=T[1].trim(),D=parseInt(T[2],10)||0,C={quantity:"1x",name:R,points:D,items:[],isComplex:!1,nameshort:""},$=c==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[$]=n[$]||[],n[$].push(C),d.length=0,d.push({indent:0,node:C});continue}const E=p.match(o);if(!E)continue;const k=E[1].trim(),L=Za(p);for(;d.length>0&&L<=d[d.length-1].indent;)d.pop();const w=d.length>0?d[d.length-1].node:null;if(!w||/^B:\s*/i.test(k))continue;if(/^(E:|Enhancement:)/i.test(k)){const R=il(k),D=d[0]?d[0].node:w;D.items=D.items||[],(D.items||[]).some($=>/^Enhancement:/i.test($.name||"")&&de($.name)===de(R.name))||D.items.push(R);continue}if(Ym(t,u)){const R=ts(rl(k));let D=R.name||"";D=D.replace(/\s+w\/.*$/i,"").trim();const C={quantity:R.quantity||"1x",name:D,items:[],type:"subunit"};w.items=w.items||[],w.items.push(C),d.push({indent:L,node:C});continue}Wm(w,k)}function h(u){const p=parseInt(String(u||"1x").replace(/[^0-9]/g,""),10);return Number.isFinite(p)&&p>0?p:1}for(const u of["CHARACTER","OTHER DATASHEETS"]){const p=n[u]||[];for(const g of p){const _=Array.isArray(g.items)?g.items:[],T=_.filter(w=>w&&w.type==="subunit");if(T.length<=1)continue;const E=new Map;for(const w of T){const A=de((w.name||"").replace(/\s+w\/.*/i,"").trim());E.has(A)||E.set(A,{name:w.name,qty:0,wargear:new Map});const R=E.get(A);R.qty+=h(w.quantity);const D=Array.isArray(w.items)?w.items:[];for(const C of D){const $=de(C.name||""),H=R.wargear.get($)||{name:C.name,qty:0,type:C.type||"wargear"};H.qty+=h(C.quantity),R.wargear.has($),R.wargear.set($,H)}}const k=_.filter(w=>!(w&&w.type==="subunit")),L=[];for(const[,w]of E){const A={quantity:`${w.qty}x`,name:w.name,items:[],type:"subunit"};for(const[,R]of w.wargear)A.items.push({quantity:`${R.qty}x`,name:R.name,items:[],type:R.type||"wargear",nameshort:""});L.push(A)}g.items=[...k,...L]}}const m=n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD?String(n.SUMMARY.FACTION_KEYWORD).trim():"";function y(u){if(!u||!m)return u;const p=new RegExp("^"+m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\s+","i");return String(u).replace(p,"").trim()}if(m)for(const u of["CHARACTER","OTHER DATASHEETS"]){const p=n[u]||[];for(const g of p){g.name=y(g.name);const _=(g.items||[]).filter(T=>T&&T.type==="subunit");for(const T of _)T.name=y(T.name)}}for(const u of["CHARACTER","OTHER DATASHEETS"]){const p=n[u]||[];for(const g of p){Array.isArray(g.items)&&g.items.length>0&&fa(g.items);const _=(g.items||[]).filter(T=>T&&T.type==="subunit");for(const T of _)Array.isArray(T.items)&&T.items.length>0&&fa(T.items)}}return _s(n),n}function Fm(t){try{const n=Om(t).format;return n==="NRNR"?"NRNR":n==="WTC-Compact"?"WTC_COMPACT":n==="WTC"?"WTC":n==="GWAPP"?"GW_APP":n==="NR-GW"?"NR_GW":n==="LF"?"LF":"UNKNOWN"}catch{const a=Array.isArray(t)?t.slice(0,25):[],r=a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i)||/^\s*\+\s*DETACHMENT:/i.test(i)),s=a.some(i=>/^(?:CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i.test((i||"").trim().toUpperCase()));return r&&s?"NR_GW":a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i))?"WTC_COMPACT":s?"GW_APP":"UNKNOWN"}}async function Bm(t){if(!t||typeof t!="string")throw new Error("Invalid army list text");const n=t.split(`
`),a=Fm(n);if(a==="UNKNOWN")throw new Error("Unable to detect army list format. Supported formats: GW App, WTC, WTC Compact, NR-GW, NR-NR, ListForge");let r;try{switch(a){case"GW_APP":r=Im(n);break;case"WTC":r=Dm(n);break;case"WTC_COMPACT":r=km(n);break;case"NR_GW":r=$m(n);break;case"NRNR":r=Pm(n);break;case"LF":r=Hm(n);break;default:throw new Error(`Unsupported format: ${a}`)}}catch(i){throw console.error("Parse error:",i),new Error(`Failed to parse ${a} format: ${i.message}`)}const s=qm(r);return{format:a,data:s}}function qm(t,n){const a=t.SUMMARY||{},r=[],s=["CHARACTER","CHARACTERS","BATTLELINE","OTHER DATASHEETS","ALLIED UNITS","DEDICATED TRANSPORTS"];for(const i of s)t[i]&&Array.isArray(t[i])&&r.push(...t[i].map(o=>({...o,section:i})));return{FACTION_KEYWORD:a.FACTION_KEYWORD||a.FACTION_KEY||"Unknown",DETACHMENT:a.DETACHMENT||"",TOTAL_ARMY_POINTS:a.TOTAL_ARMY_POINTS||"0pts",LIST_TITLE:a.LIST_TITLE||"",UNITS:r}}function Um(t){if(!t)return 1;const n=String(t).match(/(\d+)/);return n?parseInt(n[1],10):1}const Km={Asurmen:{baseType:"40mm"},Autarch:{baseType:"32mm"},"Autarch wayleaper":{baseType:"32mm"},"Avatar of Khaine":{baseType:"80mm"},Baharroth:{baseType:"40mm"},"Corsair Voidreavers":{baseType:"28.5mm"},"Corsair Voidscarred":{baseType:"28.5mm"},"Crimson Hunter":{baseType:"120x92mm"},"D-cannon Platform":{baseType:"40mm"},"Dark Reapers":{baseType:"28.5mm"},"Death Jester":{baseType:"25mm"},"Dire Avengers":{baseType:"28.5mm"},"Eldrad Ulthran":{baseType:"32mm"},Falcon:{baseType:"Large Flying Base"},Farseer:{baseType:"25mm"},"Farseer Skyrunner":{baseType:"Small Flying Base"},"Fire Dragons":{baseType:"28.5mm"},"Fire Prism":{baseType:"Large Flying Base"},Fuegan:{baseType:"40mm"},"Guardian Defenders":{baseType:"28.5mm"},"Guardian Defenders: Heavy Weapon Platform":{baseType:"40mm"},"Hemlock Wraithfighter":{baseType:"120x92mm"},"Howling Banshees":{baseType:"28.5mm"},"Jain Zar":{baseType:"40mm"},Lhykhis:{baseType:"40mm"},"Maugan Ra":{baseType:"40mm"},"Night Spinner":{baseType:"Large Flying Base"},Rangers:{baseType:"28.5mm"},"Shadow Weaver Platform":{baseType:"40mm"},Shadowseer:{baseType:"25mm"},"Shining Spears":{baseType:"Large Flying Base"},"Shroud Runners":{baseType:"Large Flying Base"},Skyweavers:{baseType:"Large Flying Base"},Solitaire:{baseType:"25mm"},Spiritseer:{baseType:"25mm"},Starweaver:{baseType:"Large Flying Base"},"Storm Guardians":{baseType:"28.5mm"},"Storm Guardians: Serpentâs Scale Platform":{baseType:"40mm"},"Striking Scorpions":{baseType:"28.5mm"},"Swooping Hawks":{baseType:"28.5mm"},"The Visarch":{baseType:"32mm"}},Gm={"Corvus Blackstar":{baseType:"120x92mm"},"Deathwatch Terminator Squad":{baseType:"40mm"},"Deathwatch Veterans":{baseType:"32mm"},"Fortis Kill Team":{baseType:"32mm"},"Indomitor Kill Team":{baseType:"40mm"},"Spectrus Kill Team":{baseType:"32mm"},"Spectrus Kill Team: Kill Team Infiltrators with bolt sniper rifles":{baseType:"40mm"},"Talonstrike Kill Team":{baseType:"32mm"},"Talonstrike Kill Team: Kill Team Heavy Intercessors with Jump Packs":{baseType:"40mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},zm={Archon:{baseType:"25mm"},Beastmaster:{baseType:"Small Flying Base"},"Beastmaster: Clawed Fiends, Khymerae, Razorwing Flocks":{baseType:"40mm"},"Court of the Archon: Sslyth":{baseType:"40mm"},"Court of the Archon: Ur-Ghul, Lhamaean, Medusae":{baseType:"25mm"},Cronos:{baseType:"Large Flying Base"},Drazhar:{baseType:"40mm"},Grotesques:{baseType:"40mm"},Haemonculus:{baseType:"25mm"},Hellions:{baseType:"Small Flying Base"},Incubi:{baseType:"28.5mm"},"Kabalite Warriors":{baseType:"25mm"},"Lelith Hesperax":{baseType:"32mm"},Mandrakes:{baseType:"28.5mm"},Raider:{baseType:"Large Flying Base"},Ravager:{baseType:"Large Flying Base"},"Razorwing Jetfighter":{baseType:"120x92mm"},Reavers:{baseType:"Small Flying Base"},Scourges:{baseType:"32mm"},Succubus:{baseType:"25mm"},Talos:{baseType:"Large Flying Base"},"Urien Rakarth":{baseType:"25mm"},Venom:{baseType:"Large Flying Base"},"Voidraven Bomber":{baseType:"120x92mm"},Wracks:{baseType:"25mm"},Wyches:{baseType:"25mm"}},Xm={"Annihilation Barge":{baseType:"Large Flying Base"},"Câtan Shard of the Deceiver":{baseType:"40mm"},"Câtan Shard of the Nightbringer":{baseType:"40mm"},"Câtan Shard of the Void Dragon":{baseType:"80mm"},"Canoptek Doomstalker":{baseType:"90mm"},"Canoptek Reanimator":{baseType:"60mm"},"Canoptek Scarab Swarms":{baseType:"40mm"},"Canoptek Spyders":{baseType:"60mm"},"Canoptek Wraiths":{baseType:"50mm"},"Catacomb Command Barge":{baseType:"Large Flying Base"},Chronomancer:{baseType:"40mm"},"Convergence of Dominion":{baseType:"hull",hullDimensions:{width:0,height:0}},Cryptothralls:{baseType:"32mm"},Deathmarks:{baseType:"32mm"},"Doom Scythe":{baseType:"120x92mm"},"Doomsday Ark":{baseType:"Large Flying Base"},"Flayed Ones":{baseType:"28.5mm"},"Ghost Ark":{baseType:"Large Flying Base"},"Hexmark Destroyer":{baseType:"50mm"},"Illuminor Szeras":{baseType:"80mm"},Immortals:{baseType:"32mm"},"Imotekh the Stormlord":{baseType:"40mm"},"Lokhust Destroyers":{baseType:"Large Flying Base"},"Lokhust Heavy Destroyers":{baseType:"60mm"},"Lokhust Lord":{baseType:"Large Flying Base"},Lychguard:{baseType:"32mm"},Monolith:{baseType:"160mm"},"Necron Warriors":{baseType:"32mm"},"Night Scythe":{baseType:"120x92mm"},Obelisk:{baseType:"120x92mm"},"Ophydian Destroyers":{baseType:"50mm"},"Orikan the Diviner":{baseType:"40mm"},Overlord:{baseType:"40mm"},"Overlord with Translocation Shroud":{baseType:"40mm"},Plasmancer:{baseType:"32mm"},Psychomancer:{baseType:"40mm"},"Royal Warden":{baseType:"32mm"},"Skorpekh Destroyers":{baseType:"50mm"},"Skorpekh Lord":{baseType:"60mm"},Technomancer:{baseType:"50mm"},"Tesseract Vault":{baseType:"120x92mm"},"The Silent King: Szarekh":{baseType:"100mm"},"The Silent King: Triarchal Menhir":{baseType:"50mm"},"Tomb Blades":{baseType:"Small Flying Base"},"Transcendent Câtan":{baseType:"60mm"},"Trazyn the Infinite":{baseType:"40mm"},"Triarch Praetorians":{baseType:"32mm"},"Triarch Stalker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Seraptek Heavy Construct":{baseType:"hull",hullDimensions:{width:0,height:0}}},Vm={Battlewagon:{baseType:"hull",hullDimensions:{width:0,height:0}},"Beast Snagga Boyz":{baseType:"32mm"},Beastboss:{baseType:"50mm"},"Beastboss on Squigosaur":{baseType:"80mm"},"Big Mek":{baseType:"50mm"},"Big Mek in Mega Armour":{baseType:"40mm"},"Big Mek with Shokk Attack Gun":{baseType:"40mm"},"Bigâed Bossbunka":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blitza-bommer":{baseType:"120x92mm"},"Boomdakka Snazzwagon":{baseType:"150x95mm"},"Boss Snikrot":{baseType:"40mm"},Boyz:{baseType:"32mm"},"Breaka Boyz":{baseType:"32mm"},"Breaka Boyz: Boss Nob":{baseType:"40mm"},"Burna Boyz":{baseType:"32mm"},"Burna-bommer":{baseType:"120x92mm"},Dakkajet:{baseType:"120x92mm"},"Deff Dread":{baseType:"60mm"},"Deffkilla Wartrike":{baseType:"150x95mm"},Deffkoptas:{baseType:"75x42mm"},"Flash Gitz":{baseType:"40mm"},"Ghazghkull Thraka":{baseType:"80mm"},"Ghazghkull Thraka: Makari":{baseType:"25mm"},Gorkanaut:{baseType:"170x109mm"},Gretchin:{baseType:"25mm"},"Gretchin: Runtherd":{baseType:"32mm"},"Hunta Rig":{baseType:"170x109mm"},"Kill Rig":{baseType:"170x109mm"},"Killa Kans":{baseType:"60mm"},Kommandos:{baseType:"32mm"},"Kustom Boosta-blasta":{baseType:"150x95mm"},Lootas:{baseType:"32mm"},Meganobz:{baseType:"40mm"},"Megatrakk Scrapjet":{baseType:"150x95mm"},Mek:{baseType:"32mm"},"Mek Gunz":{baseType:"hull",hullDimensions:{width:0,height:0}},Morkanaut:{baseType:"170x109mm"},"Mozrog Skragbad":{baseType:"80mm"},Nobz:{baseType:"32mm"},Painboss:{baseType:"40mm"},Painboy:{baseType:"32mm"},"Rukkatrukk Squigbuggy":{baseType:"150x95mm"},"Shokkjump Dragsta":{baseType:"150x95mm"},"Squighog Boyz":{baseType:"75x42mm"},"Squighog Boyz: Nob on Smasha Squig":{baseType:"90x52.5mm"},Stompa:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormboyz:{baseType:"32mm"},Tankbustas:{baseType:"32mm"},"Tankbustas: Boss Nob":{baseType:"40mm"},Trukk:{baseType:"hull",hullDimensions:{width:0,height:0}},Warbikers:{baseType:"75x42mm"},Warboss:{baseType:"40mm"},"Warboss in Mega Armour":{baseType:"50mm"},"Wazbom Blastajet":{baseType:"150x95mm"},Weirdboy:{baseType:"40mm"},Wurrboy:{baseType:"32mm"},"Zodgrod Wortsnagga":{baseType:"50mm"},"Gargantuan Squiggoth":{baseType:"hull",hullDimensions:{width:0,height:0}}},jm={Barbgaunts:{baseType:"40mm"},Biovores:{baseType:"80mm"},Broodlord:{baseType:"75x42mm"},Carnifexes:{baseType:"105x70mm"},Deathleaper:{baseType:"60mm"},Exocrine:{baseType:"120x92mm"},Gargoyles:{baseType:"Small Flying Base"},Genestealers:{baseType:"32mm"},Harpy:{baseType:"120x92mm"},Haruspex:{baseType:"120x92mm"},"Hive Crone":{baseType:"120x92mm"},"Hive Guard":{baseType:"50mm"},"Hive Tyrant":{baseType:"50mm"},Hormagaunts:{baseType:"28.5mm"},Lictor:{baseType:"50mm"},Maleceptor:{baseType:"120x92mm"},Mawloc:{baseType:"120x92mm"},"Mucolid Spores":{baseType:"40mm"},Neurogaunts:{baseType:"25mm"},"Neurogaunts: Nodebeasts":{baseType:"28.5mm"},Neurolictor:{baseType:"50mm"},Neurotyrant:{baseType:"50mm"},"Norn Assimilator":{baseType:"100mm"},"Norn Emissary":{baseType:"100mm"},"Old One Eye":{baseType:"105x70mm"},"Parasite of Mortrex":{baseType:"40mm"},Psychophage:{baseType:"120x92mm"},Pyrovores:{baseType:"80mm"},Raveners:{baseType:"40mm"},"Ripper Swarms":{baseType:"40mm"},"Screamer-killer":{baseType:"90mm"},"Spore MInes":{baseType:"25mm"},Sporocyst:{baseType:"hull",hullDimensions:{width:0,height:0}},Termagants:{baseType:"28.5mm"},Tervigon:{baseType:"120x92mm"},"The Swarmlord":{baseType:"60mm"},Toxicrene:{baseType:"120x92mm"},Trygon:{baseType:"120x92mm"},"Tyranid Warriors with Melee Bio-weapons":{baseType:"50mm"},"Tyranid Warriors with Ranged Bio-weapons":{baseType:"50mm"},Tyrannocyte:{baseType:"100mm"},Tyrannofex:{baseType:"120x92mm"},"Tyrant Guard":{baseType:"50mm"},Venomthropes:{baseType:"40mm"},"Von Ryanâs Leapers":{baseType:"40mm"},"Winged Hive Tyrant":{baseType:"60mm"},"Winged Tyranid Prime":{baseType:"50mm"},Zoanthropes:{baseType:"40mm"},Harridan:{baseType:"hull",hullDimensions:{width:4,height:6}},Hierophant:{baseType:"hull",hullDimensions:{width:0,height:0}}},ys={"ADEPTA SORORITAS":{"Aestred Thurga and Agathae Dolan: Aestred Thurga":{baseType:"32mm"},"Aestred Thurga and Agathae Dolan: Agathae Dolan":{baseType:"25mm"},"Arco-flagellants":{baseType:"25mm"},"Battle Sisters Squad":{baseType:"32mm"},Canoness:{baseType:"32mm"},"Canoness with Jump Pack":{baseType:"32mm"},Castigator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Celestian Sacresants":{baseType:"32mm"},Daemonifuge:{baseType:"32mm"},Dialogus:{baseType:"40mm"},Dogmata:{baseType:"32mm"},"Dominion Squad":{baseType:"32mm"},Exorcist:{baseType:"hull",hullDimensions:{width:0,height:0}},Hospitaller:{baseType:"50mm"},Imagifier:{baseType:"32mm"},Immolator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Junith Eruita":{baseType:"50mm"},"Ministorum Priest":{baseType:"32mm"},Mortifiers:{baseType:"50mm"},"Morvenn Vahl":{baseType:"60mm"},Palatine:{baseType:"32mm"},"Paragon Warsuits":{baseType:"50mm"},"Penitent Engines":{baseType:"50mm"},"Repentia Squad: Repentia Superior":{baseType:"32mm"},"Repentia Squad: Sister Repentia":{baseType:"28.5mm"},"Retributor Squad":{baseType:"32mm"},"Saint Celestine":{baseType:"40mm"},"Saint Celestine: Geminae Superia":{baseType:"32mm"},Sanctifiers:{baseType:"25mm"},"Seraphim Squad":{baseType:"32mm"},"Sisters Novitiate Squad: Novitiate Superior":{baseType:"32mm"},"Sisters Novitiate Squad: Sister Novitiate":{baseType:"28.5mm"},"Sororitas Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Triumph of Saint Katherine":{baseType:"120x92mm"},"Zephyrim Squad":{baseType:"32mm"}},"ADEPTUS CUSTODES":{Aleya:{baseType:"32mm"},"Allarus Custodians":{baseType:"40mm"},"Anathema Psykana Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blade Champion":{baseType:"40mm"},"Custodian Guard":{baseType:"40mm"},"Custodian Wardens":{baseType:"40mm"},"Knight-Centura":{baseType:"32mm"},Prosecutors:{baseType:"32mm"},"Shield-Captain":{baseType:"40mm"},"Shield-Captain in Allarus Terminator Armour":{baseType:"40mm"},"Shield-Captain on Dawneagle Jetbike":{baseType:"75x42mm"},"Trajann Valoris":{baseType:"40mm"},Valerian:{baseType:"40mm"},"Venerable Contemptor Dreadnought":{baseType:"60mm"},"Venerable Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vertus Praetors":{baseType:"75x42mm"},Vigilators:{baseType:"32mm"},Witchseekers:{baseType:"32mm"},"Agamatus Custodians":{baseType:"75x42mm"},"Aquilon Custodians":{baseType:"50mm"},"Ares Gunship":{baseType:"160mm"},"Caladius Grav-tank":{baseType:"170x109mm"},"Contemptor-Achillus Dreadnought":{baseType:"60mm"},"Contemptor-Galatus Dreadnought":{baseType:"60mm"},"Coronus Grav-carrier":{baseType:"170x109mm"},"Custodian Guard with Adrasite and Pyrithite Spears":{baseType:"40mm"},"Orion Assault Dropship":{baseType:"160mm"},"Pallas Grav-attack":{baseType:"105x70mm"},"Sagittarum Custodians":{baseType:"40mm"},"Telemon Heavy Dreadnought":{baseType:"100mm"},"Venatari Custodians":{baseType:"40mm"}},"ADEPTUS MECHANICUS":{"Archaeopter Fusilave":{baseType:"170x109mm"},"Archaeopter Stratoraptor":{baseType:"170x109mm"},"Archaeopter Transvector":{baseType:"170x109mm"},"Belisarius Cawl":{baseType:"105x70mm"},"Corpuscarii Electro-Priests":{baseType:"32mm"},"Cybernetica Datasmith":{baseType:"32mm"},"Fulgurite Electro-Priests":{baseType:"32mm"},"Ironstrider Ballistarii":{baseType:"105x70mm"},"Kastelan Robots":{baseType:"60mm"},"Kataphron Breachers":{baseType:"60mm"},"Kataphron Destroyers":{baseType:"60mm"},"Onager Dunecrawler":{baseType:"130mm"},"Pteraxii Skystalkers":{baseType:"40mm"},"Pteraxii Sterylizors":{baseType:"40mm"},"Serberys Raiders":{baseType:"60x35.5mm"},"Serberys Sulphurhounds":{baseType:"60x35.5mm"},"Sicarian Infiltrators":{baseType:"40mm"},"Sicarian Ruststalkers":{baseType:"40mm"},"Skitarii Marshal":{baseType:"32mm"},"Skitarii Rangers":{baseType:"25mm"},"Skitarii Rangers/Skitarii Vanguard: Transuranic Arquebus":{baseType:"60x35.5mm"},"Skitarii Vanguard":{baseType:"25mm"},"Skorpius Disintegrator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skorpius Dunerider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sydonian Dragoons with Radium Jezzails":{baseType:"105x70mm"},"Sydonian Dragoons with Taser Lances":{baseType:"105x70mm"},"Sydonian Skatros":{baseType:"40mm"},"Tech-Priest Dominus":{baseType:"50mm"},"Tech-Priest Enginseer":{baseType:"32mm"},"Tech-Priest Manipulus":{baseType:"50mm"},Technoarcheologist:{baseType:"32mm"}},"ADEPTUS TITANICUS":{"Reaver Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warbringer Nemesis Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warhound Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warlord Titan":{baseType:"hull",hullDimensions:{width:0,height:0}}},AELDARI:Km,"ASTRA MILITARUM":{"Aegis Defence Line":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armoured Sentinels":{baseType:"80mm"},"Artillery Team":{baseType:"130mm"},"Attilan Rough Riders":{baseType:"60x35.5mm"},Baneblade:{baseType:"hull",hullDimensions:{width:0,height:0}},Banehammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Banesword:{baseType:"hull",hullDimensions:{width:0,height:0}},Basilisk:{baseType:"hull",hullDimensions:{width:0,height:0}},"Bullgryn squad":{baseType:"40mm"},"Cadian Castellan":{baseType:"28.5mm"},"Cadian Command Squad":{baseType:"28.5mm"},"Cadian Heavy Weapons Squad":{baseType:"50mm"},"Cadian Shock Troops":{baseType:"25mm"},"Catachan Command Squad":{baseType:"25mm"},"Catachan Heavy Weapons Squad":{baseType:"60mm"},"Catachan Jungle Fighters":{baseType:"25mm"},Chimera:{baseType:"hull",hullDimensions:{width:0,height:0}},Commissar:{baseType:"28.5mm"},"Death Korps of Krieg":{baseType:"25mm"},"Death Riders":{baseType:"60x35.5mm"},Deathstrike:{baseType:"hull",hullDimensions:{width:0,height:0}},Doomhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},"Field Ordnance Battery":{baseType:"100mm"},"Gauntâs Ghosts":{baseType:"28.5mm"},Hellhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Hellhound:{baseType:"hull",hullDimensions:{width:0,height:0}},Hydra:{baseType:"hull",hullDimensions:{width:0,height:0}},Kasrkin:{baseType:"28.5mm"},"Krieg Combat Engineers":{baseType:"25mm"},"Krieg Command Squad":{baseType:"25mm"},"Krieg Command Squad: Lord Commissar":{baseType:"32mm"},"Krieg Heavy Weapons Squad":{baseType:"50mm"},"Krieg Heavy Weapons Squad: Fire Coordinator":{baseType:"25mm"},"Leman Russ Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Demolisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Eradicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Executioner":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Exterminator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Punisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Vanquisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Marshal Dreir":{baseType:"75x42mm"},"Lord Solar Leontus":{baseType:"80mm"},Manticore:{baseType:"hull",hullDimensions:{width:0,height:0}},"Militarum Tempestus Command Squad":{baseType:"25mm"},"Ministorum Priest":{baseType:"32mm"},"Nork Deddog":{baseType:"40mm"},"Ogryn Bodyguard":{baseType:"40mm"},"Ogryn squad":{baseType:"40mm"},"Primaris Psyker":{baseType:"32mm"},Ratlings:{baseType:"25mm"},"Rogal Dorn Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Rogal Dorn Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Scout Sentinels":{baseType:"80mm"},Shadowsword:{baseType:"hull",hullDimensions:{width:0,height:0}},"Sly Marbo":{baseType:"32mm"},Stormlord:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormsword:{baseType:"hull",hullDimensions:{width:0,height:0}},Taurox:{baseType:"hull",hullDimensions:{width:0,height:0}},"Taurox Prime":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tech-Priest Enginseer":{baseType:"32mm"},"Tempestus Aquilons":{baseType:"28.5mm"},"Tempestus Scions":{baseType:"25mm"},"Ursula Creed":{baseType:"32mm"},Valkyrie:{baseType:"120x92mm"},Wyvern:{baseType:"hull",hullDimensions:{width:0,height:0}},"Avenger Strike Fighter":{baseType:"120x92mm"},"Cyclops Demolition Vehicle":{baseType:"hull",hullDimensions:{width:0,height:0}}},"BLACK TEMPLARS":{"Black Templars Gladiator Lancer":{baseType:"100mm"},"Black Templars Gladiator Reaper":{baseType:"100mm"},"Black Templars Gladiator Valiant":{baseType:"100mm"},"Black Templars Impulsor":{baseType:"100mm"},"Black Templars Repulsor":{baseType:"100mm"},"Black Templars Repulsor Executioner":{baseType:"100mm"},Castellan:{baseType:"40mm"},"Chaplain Grimaldus":{baseType:"40mm"},"Chaplain Grimaldus: Cenobyte Servitors":{baseType:"28.5mm"},"Crusader Squad: Neophytes":{baseType:"28.5mm"},"Crusader Squad: Sword Brother/Initiates":{baseType:"32mm"},"High Marshal Helbrecht":{baseType:"60mm"},Marshal:{baseType:"40mm"},"Primaris Crusader Squad: Initiates":{baseType:"32mm"},"Primaris Crusader Squad: Neophytes":{baseType:"28.5mm"},"Primaris Crusader Squad: Sword Brother":{baseType:"40mm"},"Primaris Sword Brethren":{baseType:"40mm"},"The Emperorâs Champion":{baseType:"40mm"}},"BLOOD ANGELS":{Astorath:{baseType:"40mm"},"Baal Predator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blood Angels Captain":{baseType:"40mm"},"Chief Librarian Mephiston":{baseType:"40mm"},"Commander Dante":{baseType:"50mm"},"Death Company Captain":{baseType:"40mm"},"Death Company Captain with Jump Pack":{baseType:"40mm"},"Death Company Dreadnought":{baseType:"90mm"},"Death Company Marines":{baseType:"32mm"},"Death Company Marines with Bolt Rifles":{baseType:"32mm"},"Death Company Marines with Jump Packs":{baseType:"32mm"},Lemartes:{baseType:"40mm"},"Sanguinary Guard":{baseType:"40mm"},"Sanguinary Priest":{baseType:"40mm"},"The Sanguinor":{baseType:"40mm"}},"CHAOS DAEMONS":{"Beâlakor":{baseType:"100mm"},"Beasts of Nurgle":{baseType:"60mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodmaster:{baseType:"40mm"},Bloodthirster:{baseType:"120x92mm"},"Blue Horrors":{baseType:"25mm"},"Burning Chariot":{baseType:"120x92mm"},Changecaster:{baseType:"32mm"},"Contorted Epitome":{baseType:"75x42mm"},"Daemon Prince of Chaos":{baseType:"60mm"},"Daemon Prince of Chaos with Wings":{baseType:"60mm"},Daemonettes:{baseType:"25mm"},Epidemius:{baseType:"60mm"},"Exalted Flamer":{baseType:"75x42mm"},Fateskimmer:{baseType:"120x92mm"},"Feculent Gnarlmaw":{baseType:"hull",hullDimensions:{width:0,height:0}},Fiends:{baseType:"75x42mm"},Flamers:{baseType:"32mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Fluxmaster:{baseType:"Large Flying Base"},"Great Unclean One":{baseType:"130mm"},Hellflayers:{baseType:"120x92mm"},"Horticulous Slimux":{baseType:"105x70mm"},"Infernal Enrapturess":{baseType:"60x35.5mm"},"Kairos Fateweaver":{baseType:"100mm"},Karanak:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},Nurglings:{baseType:"40mm"},"Pink Horrors":{baseType:"32mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Poxbringer:{baseType:"32mm"},"Rendmaster on Blood Throne":{baseType:"120x92mm"},Rotigus:{baseType:"130mm"},Screamers:{baseType:"Small Flying Base"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"},Skarbrand:{baseType:"100mm"},"Skull Altar":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skull Cannon":{baseType:"120x92mm"},Skullmaster:{baseType:"90x52.5mm"},Skulltaker:{baseType:"40mm"},"Sloppity Bilepiper":{baseType:"32mm"},"Soul Grinder":{baseType:"160mm"},"Spoilpox Scrivener":{baseType:"40mm"},"Syllâesske":{baseType:"50mm"},"The Blue Scribes":{baseType:"Large Flying Base"},"The Changeling":{baseType:"40mm"},"The Masque of Slaanesh":{baseType:"32mm"},Tormentbringer:{baseType:"120x92mm"},Tranceweaver:{baseType:"32mm"}},"CHAOS KNIGHTS":{"Knight Abominant":{baseType:"170x109mm"},"Knight Desecrator":{baseType:"170x109mm"},"Knight Despoiler":{baseType:"170x109mm"},"Knight Rampager":{baseType:"170x109mm"},"Knight Tyrant":{baseType:"170x109mm"},"War Dog Brigand":{baseType:"100mm"},"War Dog Executioner":{baseType:"100mm"},"War Dog Huntsman":{baseType:"100mm"},"War Dog Karnivore":{baseType:"100mm"},"War Dog Stalker":{baseType:"100mm"},"Chaos Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Cerastus Knight Acheron":{baseType:"170x109mm"},"Chaos Cerastus Knight Atrapos":{baseType:"170x109mm"},"Chaos Cerastus Knight Castigator":{baseType:"170x109mm"},"Chaos Cerastus Knight Lancer":{baseType:"170x109mm"},"Chaos Questoris Knight Magaera":{baseType:"170x109mm"},"Chaos Questoris Knight Styrix":{baseType:"170x109mm"},"War Dog Moirax":{baseType:"100mm"}},"CHAOS SPACE MARINES":{"Abaddon the Despoiler":{baseType:"60mm"},"Accursed Cultists: Mutant":{baseType:"25mm"},"Accursed Cultists: Torment":{baseType:"40mm"},"Chaos Bikers":{baseType:"75x42mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Lord":{baseType:"40mm"},"Chaos Lord in Terminator Armour":{baseType:"40mm"},"Chaos Lord with Jump Pack":{baseType:"40mm"},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminator Squad":{baseType:"40mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},Chosen:{baseType:"32mm"},"Cultist Firebrand":{baseType:"32mm"},"Cultist Mob":{baseType:"25mm"},Cypher:{baseType:"32mm"},"Dark Apostle":{baseType:"40mm"},"Dark Apostle: Dark Disciple":{baseType:"25mm"},"Dark Commune: Blessed Blade":{baseType:"28.5mm"},"Dark Commune: Cult Demagogue, Mindwitch, Iconarch":{baseType:"32mm"},Defiler:{baseType:"160mm"},"Fabius Bile":{baseType:"40mm"},"Fabius Bile: Surgeon Acolyte":{baseType:"32mm"},"Fellgor beastmen":{baseType:"32mm"},Forgefiend:{baseType:"120x92mm"},"Haarken Worldclaimer":{baseType:"40mm"},Havocs:{baseType:"40mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Heretic Astartes Daemon Prince":{baseType:"60mm"},"Heretic Astartes Daemon Prince with Wings":{baseType:"60mm"},"Huron Blackheart":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},Legionaries:{baseType:"32mm"},"Lord Discordant on Helstalker":{baseType:"120x92mm"},"Master of Executions":{baseType:"40mm"},"Master of Possession":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},"Nemesis Claw":{baseType:"32mm"},"Noctilith Crown":{baseType:"hull",hullDimensions:{width:0,height:0}},Obliterators:{baseType:"50mm"},Possessed:{baseType:"40mm"},Raptors:{baseType:"32mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Traitor Enforcer":{baseType:"32mm"},"Traitor Enforcer: Traitor Ogryn":{baseType:"40mm"},"Traitor Guardsmen Squad":{baseType:"25mm"},"Vashtorr the Arkifane":{baseType:"80mm"},Venomcrawler:{baseType:"100mm"},"Warp Talons":{baseType:"32mm"},Warpsmith:{baseType:"60x35.5mm"}},"DARK ANGELS":{Asmodai:{baseType:"50mm"},Azrael:{baseType:"50mm"},Belial:{baseType:"50mm"},"Deathwing Knights":{baseType:"40mm"},"Deathwing Terminator Squad":{baseType:"40mm"},Ezekiel:{baseType:"25mm"},"Inner Circle Companions":{baseType:"40mm"},"Land Speeder Vengeance":{baseType:"Large Flying Base"},Lazarus:{baseType:"40mm"},"Lion ElâJonson":{baseType:"60mm"},"Nephilim Jetfighter":{baseType:"120x92mm"},"Ravenwing Black Knights":{baseType:"75x42mm"},"Ravenwing Command Squad":{baseType:"75x42mm"},"Ravenwing Dark Talon":{baseType:"120x92mm"},"Ravenwing Darkshroud":{baseType:"Large Flying Base"},Sammael:{baseType:"Large Flying Base"}},"DEATH GUARD":{"Biologus Putrifier":{baseType:"40mm"},"Blightlord Terminators":{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Nurgle":{baseType:"60mm"},"Daemon Prince of Nurgle with Wings":{baseType:"60mm"},"Deathshroud Terminators":{baseType:"40mm"},Defiler:{baseType:"160mm"},"Foetid Bloat-Drone":{baseType:"60mm"},"Foetid Bloat-drone with Heavy Blight Launcher":{baseType:"60mm"},"Foul Blightspawn":{baseType:"40mm"},Helbrute:{baseType:"60mm"},"Icon Bearer":{baseType:"32mm"},"Lord of Contagion":{baseType:"50mm"},"Lord of Poxes":{baseType:"40mm"},"Lord of Virulence":{baseType:"50mm"},"Malignant Plaguecaster":{baseType:"32mm"},"Miasmic Malignifier":{baseType:"hull",hullDimensions:{width:0,height:0}},Mortarion:{baseType:"100mm"},"Myphitic Blight-Haulers":{baseType:"80mm"},"Noxious Blightbringer":{baseType:"40mm"},"Plague Marines":{baseType:"32mm"},"Plague Surgeon":{baseType:"40mm"},"Plagueburst Crawler":{baseType:"hull",hullDimensions:{width:0,height:0}},Poxwalkers:{baseType:"25mm"},Tallyman:{baseType:"40mm"},Typhus:{baseType:"50mm"},"Beasts of Nurgle":{baseType:"60mm"},"Great Unclean One":{baseType:"130mm"},Nurglings:{baseType:"40mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Rotigus:{baseType:"130mm"}},DEATHWATCH:Gm,DRUKHARI:zm,"EMPERORâS CHILDREN":{"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminators":{baseType:"40mm"},"Daemon Prince of Slaanesh":{baseType:"60mm"},"Daemon Prince of Slaanesh with Wings":{baseType:"60mm"},"Flawless Blades":{baseType:"40mm"},Fulgrim:{baseType:"130mm"},Heldrake:{baseType:"120x92mm"},Infractors:{baseType:"32mm"},"Lord Exultant":{baseType:"40mm"},"Lord Kakophonist":{baseType:"40mm"},"Lucius the Eternal":{baseType:"50mm"},Maulerfiend:{baseType:"120x92mm"},"Noise Marines":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},Tormentors:{baseType:"32mm"},Daemonettes:{baseType:"25mm"},Fiends:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"}},"GENESTEALER CULTS":{Aberrants:{baseType:"32mm"},Abominant:{baseType:"40mm"},"Achilles Ridgerunners":{baseType:"120x92mm"},"Acolyte Hybrids with Autopistols":{baseType:"32mm"},"Acolyte Hybrids with Hand Flamers":{baseType:"32mm"},"Acolyte Iconward":{baseType:"32mm"},"Atalan Jackals":{baseType:"60x35.5mm"},"Atalan Jackals: Wolfquad":{baseType:"60mm"},Benefictus:{baseType:"32mm"},Biophagus:{baseType:"25mm"},Clamavus:{baseType:"32mm"},"Goliath Rockgrinder":{baseType:"hull",hullDimensions:{width:0,height:0}},"Goliath Truck":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hybrid Metamorphs":{baseType:"32mm"},"Jackal Alphus":{baseType:"60x35.5mm"},Kelermorph:{baseType:"32mm"},Locus:{baseType:"32mm"},Magus:{baseType:"32mm"},"Neophyte Hybrids":{baseType:"25mm"},"Neophyte Hybrids: Heavy stubber, Mining laser, Seismic cannon":{baseType:"32mm"},Nexos:{baseType:"40mm"},Patriarch:{baseType:"50mm"},Primus:{baseType:"32mm"},"Purestrain Genestealers":{baseType:"32mm"},"Reductus Saboteur":{baseType:"32mm"},Sanctus:{baseType:"32mm"}},"GREY KNIGHTS":{"Brother-Captain":{baseType:"40mm"},"Brother-Captain Stern":{baseType:"40mm"},"Brotherhood Champion":{baseType:"32mm"},"Brotherhood Chaplain":{baseType:"40mm"},"Brotherhood Librarian":{baseType:"40mm"},"Brotherhood Techmarine":{baseType:"32mm"},"Brotherhood Terminator Squad":{baseType:"40mm"},"Castellan Crowe":{baseType:"40mm"},"Grand Master":{baseType:"40mm"},"Grand Master in Nemesis Dreadknight":{baseType:"120x92mm"},"Grand Master Voldus":{baseType:"40mm"},"Grey Knights Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Razorback":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Stormhawk Interceptor":{baseType:"120x92mm"},"Grey knights Stormraven Gunship":{baseType:"120x92mm"},"Grey knights Stormtalon Gunship":{baseType:"120x92mm"},"Grey Knights Venerable Dreadnought":{baseType:"60mm"},"Interceptor Squad":{baseType:"32mm"},"Kaldor Draigo":{baseType:"40mm"},"Nemesis Dreadknight":{baseType:"120x92mm"},"Paladin Squad":{baseType:"40mm"},"Purgation Squad":{baseType:"32mm"},"Purifier Squad":{baseType:"32mm"},Servitors:{baseType:"25mm"},"Strike Squad":{baseType:"32mm"},"Grey Knights Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}},"Land Raider Banisher":{baseType:"hull",hullDimensions:{width:0,height:0}}},"IMPERIAL AGENTS":{"Callidus Assassin":{baseType:"32mm"},"Corvus Blackstar":{baseType:"120x92mm"},"Culexus Assassin":{baseType:"32mm"},"Deathwatch Kill Team":{baseType:"32mm"},"Eversor Assassin":{baseType:"32mm"},"Exaction Squad":{baseType:"28.5mm"},"Exaction Squad: Cyber-mastiff":{baseType:"25mm"},"Grey Knights Terminator Squad":{baseType:"40mm"},"Imperial Navy Breachers":{baseType:"25mm"},"Imperial Navy Breachers: Navis las-volley, endurant shield":{baseType:"28.5mm"},"Imperial Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},Inquisitor:{baseType:"32mm"},"Inquisitor Coteaz":{baseType:"40mm"},"Inquisitor Draxus":{baseType:"32mm"},"Inquisitor Greyfax":{baseType:"32mm"},"Inquisitorial Agents":{baseType:"25mm"},"Inquisitorial Agents: Gun Servitors":{baseType:"32mm"},"Inquisitorial Chimera":{baseType:"hull",hullDimensions:{width:0,height:0}},"Ministorum Priest":{baseType:"32mm"},Navigator:{baseType:"32mm"},"Rogue Trader entourage":{baseType:"25mm"},Sanctifiers:{baseType:"25mm"},"Sisters of Battle Immolator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sisters of Battle Squad":{baseType:"32mm"},"Subductor Squad":{baseType:"28.5mm"},"Subductor Squad: Cyber-mastiff":{baseType:"25mm"},"Vigilant Squad":{baseType:"28.5mm"},"Vigilant Squad: Cyber-mastiff":{baseType:"25mm"},"Vindicare Assassin":{baseType:"32mm"},"Voidsmen-at-Arms":{baseType:"32mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},"IMPERIAL KNIGHTS":{"Armiger Helverin":{baseType:"100mm"},"Armiger Warglaive":{baseType:"100mm"},"Canis Rex":{baseType:"170x109mm"},"Knight Castellan":{baseType:"170x109mm"},"Knight Crusader":{baseType:"170x109mm"},"Knight Errant":{baseType:"170x109mm"},"Knight Gallant":{baseType:"170x109mm"},"Knight Paladin":{baseType:"170x109mm"},"Knight Preceptor":{baseType:"170x109mm"},"Knight Valiant":{baseType:"170x109mm"},"Knight Warden":{baseType:"170x109mm"},"Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armiger Moirax":{baseType:"100mm"},"Cerastus Knight Acheron":{baseType:"170x109mm"},"Cerastus Knight Atrapos":{baseType:"170x109mm"},"Cerastus Knight Castigator":{baseType:"170x109mm"},"Cerastus Knight Lancer":{baseType:"170x109mm"},"Questoris Knight Magaera":{baseType:"170x109mm"},"Questoris Knight Styrix":{baseType:"170x109mm"}},"LEAGUES OF VOTANN":{"BrÃ´khyr Iron-master":{baseType:"32mm"},"BrÃ´khyr Iron-master: E-COG":{baseType:"25mm"},"BrÃ´khyr Iron-master: Ironkin Assistant":{baseType:"28.5mm"},"BrÃ´khyr Thunderkyn":{baseType:"40mm"},"Cthonian Beserks":{baseType:"28.5mm"},"Cthonian Beserks: Mole grenade launcher":{baseType:"50mm"},"Einhyr Champion":{baseType:"40mm"},"Einhyr Hearthguard":{baseType:"32mm"},Grimnyr:{baseType:"40mm"},"Grimnyr: CORV":{baseType:"25mm"},"Hearthkyn Warriors":{baseType:"28.5mm"},"Hekaton Land Fortress":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hernkyn Pioneers":{baseType:"90x52.5mm"},"Hernkyn Yaegirs":{baseType:"28.5mm"},KÃ¢hl:{baseType:"40mm"},Sagitaur:{baseType:"hull",hullDimensions:{width:0,height:0}},"Ãthar the Destined":{baseType:"40mm"}},NECRONS:Xm,ORKS:Vm,"SPACE MARINES":{"Adrax Agatone":{baseType:"40mm"},"Aggressor Squad":{baseType:"40mm"},Ancient:{baseType:"40mm"},"Ancient in Terminator Armour":{baseType:"40mm"},Apothecary:{baseType:"40mm"},"Apothecary Biologis":{baseType:"40mm"},"Assault Intercessor Squad":{baseType:"32mm"},"Assault Intercessors with Jump Packs":{baseType:"32mm"},"Ballistus Dreadnought":{baseType:"90mm"},"Bladeguard Ancient":{baseType:"40mm"},"Bladeguard Veteran Squad":{baseType:"40mm"},"Brutalis Dreadnought":{baseType:"90mm"},Captain:{baseType:"40mm"},"Captain in Gravis Armour":{baseType:"40mm"},"Captain in Phobos Armour":{baseType:"40mm"},"Captain in Terminator Armour":{baseType:"50mm"},"Captain Sicarius":{baseType:"32mm"},"Captain with Jump Pack":{baseType:"40mm"},"Centurion Assault Squad":{baseType:"50mm"},"Centurion Devastator Squad":{baseType:"50mm"},Chaplain:{baseType:"40mm"},"Chaplain in Terminator Armour":{baseType:"40mm"},"Chaplain on Bike":{baseType:"90x52.5mm"},"Chaplain with Jump Pack":{baseType:"32mm"},"Chief Librarian Tigurius":{baseType:"40mm"},"Company Heroes":{baseType:"40mm"},"Darnath Lysander":{baseType:"50mm"},"Desolation Squad":{baseType:"32mm"},"Devastator Squad":{baseType:"32mm"},Dreadnought:{baseType:"60mm"},"Drop Pod":{baseType:"hull",hullDimensions:{width:0,height:0}},"Eliminator Squad":{baseType:"40mm"},"Eradicator Squad":{baseType:"40mm"},"Firestrike Servo-turrets":{baseType:"80mm"},"Gladiator Lancer":{baseType:"100mm"},"Gladiator Reaper":{baseType:"100mm"},"Gladiator Valiant":{baseType:"100mm"},"Hammerfall Bunker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Heavy Intercessor Squad":{baseType:"40mm"},"Hellblaster Squad":{baseType:"32mm"},Impulsor:{baseType:"100mm"},"Inceptor Squad":{baseType:"40mm"},"Incursor Squad":{baseType:"32mm"},"Infernus Squad":{baseType:"32mm"},"Infiltrator Squad":{baseType:"32mm"},"Intercessor Squad":{baseType:"32mm"},"Invader ATV":{baseType:"hull",hullDimensions:{width:0,height:0}},"Invictor Tactical Warsuit":{baseType:"90mm"},"Iron Father Feirros":{baseType:"40mm"},Judiciar:{baseType:"40mm"},"Kayvaan Shrike":{baseType:"40mm"},"Korâsarro Khan":{baseType:"40mm"},"Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},Librarian:{baseType:"40mm"},"Librarian in Phobos Armour":{baseType:"40mm"},"Librarian in Terminator Armour":{baseType:"40mm"},Lieutenant:{baseType:"40mm"},"Lieutenant in Phobos Armour":{baseType:"40mm"},"Lieutenant in Reiver Armour":{baseType:"40mm"},"Lieutenant Titus":{baseType:"40mm"},"Lieutenant with Combi-weapon":{baseType:"40mm"},"Marneus Calgar":{baseType:"50mm"},"Marneus Calgar: Victrix Honour Guard":{baseType:"40mm"},"Outrider Squad":{baseType:"90x52.5mm"},"Pedro Kantor":{baseType:"32mm"},"Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},Razorback:{baseType:"hull",hullDimensions:{width:0,height:0}},"Redemptor Dreadnought":{baseType:"90mm"},"Reiver Squad":{baseType:"32mm"},Repulsor:{baseType:"100mm"},"Repulsor Executioner":{baseType:"100mm"},Rhino:{baseType:"hull",hullDimensions:{width:0,height:0}},"Roboute Guilliman":{baseType:"60mm"},"Scout Squad":{baseType:"28.5mm"},"Sternguard Veteran Squad":{baseType:"32mm"},"Storm Speeder Hailstrike":{baseType:"90mm"},"Storm Speeder Hammerstrike":{baseType:"90mm"},"Storm Speeder Thunderstrike":{baseType:"90mm"},"Stormhawk Interceptor":{baseType:"120x92mm"},"Stormraven Gunship":{baseType:"120x92mm"},"Stormtalon Gunship":{baseType:"120x92mm"},"Suppressor Squad":{baseType:"40mm"},"Tactical Squad":{baseType:"32mm"},Techmarine:{baseType:"40mm"},"Terminator Assault Squad":{baseType:"40mm"},"Terminator Squad":{baseType:"40mm"},"Tor Garadon":{baseType:"40mm"},"Uriel Ventris":{baseType:"40mm"},"Vanguard Veteran Squad with Jump Packs":{baseType:"32mm"},Vindicator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Vulkan Heâstan":{baseType:"32mm"},Whirlwind:{baseType:"hull",hullDimensions:{width:0,height:0}},Astraeus:{baseType:"hull",hullDimensions:{width:0,height:0}},"Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}}},"SPACE WOLVES":{"Arjac Rockfist":{baseType:"50mm"},"Bjorn the Fell-handed":{baseType:"60mm"},"Blood Claws":{baseType:"32mm"},"Fenrisian Wolves":{baseType:"40mm"},"Grey Hunters":{baseType:"32mm"},"Iron Priest":{baseType:"32mm"},"Logan Grimnar":{baseType:"80mm"},Murderfang:{baseType:"60mm"},"Njal Stormcaller":{baseType:"40mm"},"Ragnar Blackmane":{baseType:"40mm"},"Thunderwolf Cavalry":{baseType:"60mm"},"Ulrik the Slayer":{baseType:"32mm"},"Venerable Dreadnought":{baseType:"60mm"},"Wolf Guard Battle Leader":{baseType:"40mm"},"Wolf Guard Headtakers":{baseType:"40mm"},"Wolf Guard Headtakers: Hunting Wolves":{baseType:"60x35.5mm"},"Wolf Guard Terminators":{baseType:"40mm"},"Wolf Priest":{baseType:"40mm"},Wulfen:{baseType:"40mm"},"Wulfen Dreadnought":{baseType:"60mm"},"Wulfen with Storm Shields":{baseType:"40mm"}},"TâAU EMPIRE":{"Breacher Team":{baseType:"25mm"},"Broadside Battlesuits":{baseType:"60mm"},"Cadre Fireblade":{baseType:"25mm"},"Commander Farsight":{baseType:"60mm"},"Commander in Coldstar Battlesuit":{baseType:"60mm"},"Commander in Enforcer Battlesuit":{baseType:"60mm"},"Commander Shadowsun":{baseType:"50mm"},"Crisis Fireknife Battlesuits":{baseType:"50mm"},"Crisis Starscythe Battlesuits":{baseType:"50mm"},"Crisis Sunforge Battlesuits":{baseType:"50mm"},Darkstrider:{baseType:"32mm"},Devilfish:{baseType:"Large Flying Base"},Ethereal:{baseType:"40mm"},"Firesight Team":{baseType:"40mm"},"Ghostkeel Battlesuit":{baseType:"105x70mm"},"Hammerhead Gunship":{baseType:"Large Flying Base"},"Kroot Carnivores":{baseType:"28.5mm"},"Kroot Farstalkers":{baseType:"28.5mm"},"Kroot Farstalkers: Kroot Kill-broker":{baseType:"32mm"},"Kroot Flesh Shaper":{baseType:"32mm"},"Kroot Hounds":{baseType:"28.5mm"},"Kroot Lone-spear":{baseType:"90x52.5mm"},"Kroot Trail Shaper":{baseType:"32mm"},"Kroot War Shaper":{baseType:"32mm"},"Krootox Rampagers":{baseType:"50mm"},"Krootox Riders":{baseType:"50mm"},"Pathfinder Team":{baseType:"25mm"},Piranhas:{baseType:"Large Flying Base"},"Razorshark Strike Fighter":{baseType:"120x92mm"},"Riptide Battlesuit":{baseType:"120x92mm"},"Sky Ray Gunship":{baseType:"Large Flying Base"},"Stealth Battlesuits":{baseType:"32mm"},Stormsurge:{baseType:"170x109mm"},"Strike Team":{baseType:"25mm"},"Sun Shark Bomber":{baseType:"120x92mm"},"Tidewall Defence Platform":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Droneport":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Gunrig":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Shieldline":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vespid Stingwings":{baseType:"28.5mm"},"AX-1-0 Tiger Shark":{baseType:"160mm"},Manta:{baseType:"hull",hullDimensions:{width:4,height:6}},"Taâunar Supremacy Armour":{baseType:"160mm"},"Tiger Shark":{baseType:"160mm"}},"THOUSAND SONS":{Ahriman:{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Daemon Prince of Tzeentch":{baseType:"60mm"},"Daemon Prince of Tzeentch with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},"Exalted Sorcerer":{baseType:"32mm"},"Exalted Sorcerer on Disc of Tzeentch":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Infernal Master":{baseType:"40mm"},"Magnus the Red":{baseType:"100mm"},Maulerfiend:{baseType:"120x92mm"},"Mutalith Vortex Beast":{baseType:"120x92mm"},"Rubric Marines":{baseType:"32mm"},"Scarab Occult Terminators":{baseType:"40mm"},"Sekhetar Robots":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Tzaangor Enlightened":{baseType:"40mm"},"Tzaangor Enlightened with Fatecaster Greatbows":{baseType:"40mm"},"Tzaangor Shaman":{baseType:"40mm"},Tzaangors:{baseType:"32mm"},"Blue Horrors":{baseType:"25mm"},Flamers:{baseType:"32mm"},"Kairos Fateweaver":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},"Pink Horrors":{baseType:"32mm"},Screamers:{baseType:"Small Flying Base"}},TYRANIDS:jm,"WORLD EATERS":{Angron:{baseType:"100mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Khorne":{baseType:"60mm"},"Daemon Prince of Khorne with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},Eightbound:{baseType:"40mm"},"Exalted Eightbound":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Goremongers:{baseType:"32mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},Jakhals:{baseType:"28.5mm"},"Jakhals: Dishonoured":{baseType:"40mm"},"KhÃ¢rn the Betrayer":{baseType:"40mm"},"Khorne Berzerkers":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Invocatus":{baseType:"90x52.5mm"},"Lord on Juggernaut":{baseType:"90x52.5mm"},"Master of Executions":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},Slaughterbound:{baseType:"50mm"},"Terminator Squad":{baseType:"40mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodthirster:{baseType:"120x92mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Skarbrand:{baseType:"100mm"}}},Qm=rn(ys);function Zm(){return Object.keys(ys)}function ol(t){return ys[t]?Object.keys(ys[t]):[]}function qr(t,n){return!ys[t]||!ys[t][n]?null:ys[t][n]}Ba(Qm,t=>Object.keys(t));function Jm(t,n){const a=t.FACTION_KEYWORD,r=t.UNITS||[],s=[],i=[],o={};for(const d of r){const h=d.name||"",m=Um(d.quantity);let y=qr(a,h);if(!y){const u=ll(h,a);u&&(y=qr(a,u))}if(!y){const{faction:u,unitName:p}=nd(h);u&&p&&(y=qr(u,p))}if(y){o[h]||(o[h]=0),o[h]++;const u=o[h]>1?` #${o[h]}`:"",p=`${h}${u}`,g=ed(y,m,n,p);s.push(...g)}else i.push({id:"unmatched-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),unitName:h,quantity:m,points:d.points,section:d.section})}return{matched:td(s),unmatched:i}}function ed(t,n,a,r,s){const i=[],o=ad(),c=t.baseType,d=sd(r,c);for(let h=0;h<n;h++){const y={id:id(),baseType:c,playerId:a,x:0,y:0,rotation:0,unitId:o,unitName:r,name:d,imported:!0,inStaging:!0};c==="hull"&&(y.baseType="rect-custom",y.customWidth=t.hullDimensions?.width||5.5,y.customHeight=t.hullDimensions?.height||3),i.push(y)}return i}function td(t){const i={};t.forEach(h=>{const m=h.unitId||"ungrouped";i[m]||(i[m]=[]),i[m].push(h)});let o=2,c=2,d=0;for(const h in i){const m=i[h];for(const y of m)y.x=o,y.y=c,o+=2,d++,d>=6&&(o=2,c+=2,d=0);d>0&&(o=2,c+=2,d=0)}return t}function ll(t,n){const a=ol(n);if(!a||a.length===0)return null;const r=cs(t);for(const c of a)if(cs(c)===r)return c;const s=r.replace(/s$/,""),i=r+"s";for(const c of a){const d=cs(c);if(d===s||d===i)return c}for(const c of a){const d=cs(c);if(r.includes(d)||d.includes(r))return c}const o=r.split(/\s+/).filter(c=>c.length>2);if(o.length>0)for(const c of a){const d=cs(c);if(o.every(h=>d.includes(h)))return c}return null}function nd(t){const n=Zm(),a=cs(t);for(const r of n){const s=ol(r);if(s){for(const i of s)if(cs(i)===a)return{faction:r,unitName:i}}}for(const r of n){const s=ll(t,r);if(s)return{faction:r,unitName:s}}return{faction:null,unitName:null}}function cs(t){return String(t||"").toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim()}function ad(){return"unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function sd(t,n){if(!t)return"";const a=n.match(/(\d+)mm/),r=a?parseInt(a[1],10):null;return r&&r<50?rd(t):t}function rd(t){return t?t.replace(/\s*#\d+$/,"").split(/\s+/).filter(s=>s.length>0).slice(0,3).map(s=>s[0].toUpperCase()).join(""):""}function id(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}var od=pe('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),ld=pe('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div> <!>',1),cd=pe('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Selected</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <button class="danger svelte-1g40uyy"> </button></div>'),ud=pe('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Rotation</span> <span class="value svelte-1g40uyy"> </span></div>'),md=pe('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div>'),dd=pe('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),hd=pe('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Base Type</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Player</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Position</span> <span class="value svelte-1g40uyy"> </span></div> <!> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-1g40uyy">Remove</button></div>'),fd=pe('<p class="hint svelte-1g40uyy">Click a model to select it</p>'),yd=pe('<p class="hint svelte-1g40uyy">Click and drag on battlefield to draw a measurement line</p>'),pd=pe('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Length</span> <span class="value svelte-1g40uyy"> </span></div> <button class="danger svelte-1g40uyy">Remove Line</button>',1),vd=pe('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Lines</span> <span class="value svelte-1g40uyy"> </span></div> <button class="secondary svelte-1g40uyy">Clear All Lines</button>',1),gd=pe('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Line Tool Active (M)</label></div> <!> <!> <!> <div class="field svelte-1g40uyy" style="margin-top: 0.5rem; border-top: 1px solid #333; padding-top: 0.5rem;"><span class="label-text svelte-1g40uyy">Range Zones</span> <label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show 6" zones</label> <label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show 9" zones</label></div></div>'),bd=pe('<div class="button-group vertical svelte-1g40uyy"><div class="button-row svelte-1g40uyy"><button title="Undo (Ctrl+Z)" class="svelte-1g40uyy">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-1g40uyy">Redo</button></div> <div class="button-row svelte-1g40uyy"><button title="Export deployment to share with others" class="svelte-1g40uyy">Export</button> <button title="Import deployment from JSON file" class="svelte-1g40uyy">Import</button></div> <input type="file" accept=".json" style="display: none;"/> <button class="svelte-1g40uyy">Save to Browser</button> <button class="svelte-1g40uyy">Restore from Browser</button> <button class="secondary svelte-1g40uyy">Clear All Models</button> <button class="secondary svelte-1g40uyy">Clear Saved State</button></div>'),Td=pe('<div class="player-toggle svelte-1g40uyy"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-1g40uyy"><div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Circles</h4> <div class="palette-grid svelte-1g40uyy"></div></div> <div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Ovals</h4> <div class="palette-grid svelte-1g40uyy"></div></div></div>',1),xd=pe('<div class="rect-hull-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="rect-width" class="svelte-1g40uyy">Width (inches)</label> <input id="rect-width" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <div class="field svelte-1g40uyy"><label for="rect-height" class="svelte-1g40uyy">Height (inches)</label> <input id="rect-height" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <button class="svelte-1g40uyy"> </button></div>'),_d=ge('<path stroke-width="0.10" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),wd=ge('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),Sd=ge("<!><!>",1),Ad=ge('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),Cd=ge('<g opacity="0.5" pointer-events="none"><!></g>'),Ed=ge('<g><rect rx="9" ry="9" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></rect></g>'),Md=ge('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></ellipse></g>'),Rd=ge('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></circle>'),kd=ge('<g><rect rx="6" ry="6" fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></rect></g>'),Ld=ge('<g><ellipse fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></ellipse></g>'),Dd=ge('<circle fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></circle>'),Id=ge("<!><!>",1),$d=ge('<circle r="0.4" fill="rgba(147, 51, 234, 0.5)" stroke="#9333ea" stroke-width="0.1" pointer-events="none"></circle><line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="group-rotate-handle"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),Pd=ge('<circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle><circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle>',1),Nd=ge('<g><line stroke-linecap="round"></line><!><g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g></g>'),Od=ge('<g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" fill="#f59e0b" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g>'),Wd=ge('<g class="measurement-line drawing"><line stroke="#f59e0b" stroke-width="0.15" stroke-dasharray="0.3,0.15" stroke-linecap="round" pointer-events="none"></line><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><!></g>'),Yd=ge('<line stroke-width="0.05" pointer-events="none"></line>'),Hd=ge('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),Fd=ge('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),Bd=ge('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),qd=ge("<!><!><!><!><!><!><!><!><!><!><!><!><!><!><!>",1),Ud=pe('<main class="svelte-1g40uyy"><div class="layout svelte-1g40uyy"><div class="sidebar svelte-1g40uyy"><!> <!> <!> <!> <!> <!></div> <div class="main-content svelte-1g40uyy"><div class="battlefield-area svelte-1g40uyy"><div class="battlefield-container svelte-1g40uyy" role="presentation"><!></div> <div class="info svelte-1g40uyy"><p class="svelte-1g40uyy"> </p> <p class="hint svelte-1g40uyy">Drag to select | Ctrl+Click multi-select | Del remove | 1/2 player | L LoS | M measure</p></div></div></div></div></main> <!>',1);function Kd(t,n){Yn(n,!1);const a=()=>Lt(Xa,"$selectedDeployment",m),r=()=>Lt(ua,"$selectedLayoutName",m),s=()=>Lt(Ta,"$selectedLayoutType",m),i=()=>Lt(yt,"$models",m),o=()=>Lt(_i,"$loadedTerrain",m),c=()=>Lt(Ln,"$history",m),d=()=>Lt(nl,"$player1Models",m),h=()=>Lt(al,"$player2Models",m),[m,y]=qs(),u=O(),p=O(),g=O(),_=O(),T=O(),E=O(),k=O(),L=O(),w=O(),A=O(),R=O(),D=O();let C=O(1),$=O(null),H=!1,oe=null,N=O(null),he=O(!1),we=O(!1),ne=O(5.5),se=O(3),ce=O(!1),be=O([]),De=[],J=O(null),U=O(!1),V=O(null),xe=O(null),Y=O([]),ve=O(new Set),Me=!1,dt=!1,fe=null,te=!1,Ke=null,Ce=0,Dt=null,lt=O([]),nt=O(null),ct=O(!1),it=O(null),ht=O(null),Rt=O(!1),ae=O(!1),Le=O(!1);const Ve=5,Et="warhammer-deployment-state";function St(){const S={deployment:a()?.name||null,layout:r()||null,layoutType:s()||null,models:i()};localStorage.setItem(Et,JSON.stringify(S))}function It(){const S=localStorage.getItem(Et);if(S)try{const W=JSON.parse(S);W.models&&Array.isArray(W.models)&&(yt.set(W.models),Ln.clear())}catch(W){console.error("Failed to restore deployment state:",W)}}function en(){localStorage.removeItem(Et),yt.clear()}function dn(){const S={version:1,exportedAt:new Date().toISOString(),deployment:a()?{name:a().name,zones:a().zones,objectives:a().objectives}:null,terrain:{layoutName:r(),layoutType:s(),terrains:o().terrains,walls:o().walls},models:i()},W=JSON.stringify(S,null,2),F=new Blob([W],{type:"application/json"}),j=URL.createObjectURL(F),ie=document.createElement("a");ie.href=j,ie.download=`deployment-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(ie),ie.click(),document.body.removeChild(ie),URL.revokeObjectURL(j)}let Xt=O(null);function on(){e(Xt)?.click()}function Cn(S){const W=S.target.files?.[0];if(!W)return;const F=new FileReader;F.onload=j=>{try{const ie=JSON.parse(j.target.result);qe(ie)}catch(ie){console.error("Failed to parse import file:",ie),alert("Failed to import: Invalid JSON file")}},F.readAsText(W),S.target.value=""}function qe(S){if(!S.version){alert("Invalid import file: missing version");return}if(S.deployment){const W=Jo.find(F=>F.name===S.deployment.name);W?Xa.set(W):S.deployment.zones&&S.deployment.objectives&&Xa.set({name:S.deployment.name||"Imported",zones:S.deployment.zones,objectives:S.deployment.objectives})}else Xa.set(null);if(S.terrain){const{layoutName:W,layoutType:F,terrains:j,walls:ie}=S.terrain;if(F==="preset"&&W){if(gi.find(ue=>ue.name===W))ua.set(W),Ta.set("preset");else if(j||ie){const ue=`imported-${Date.now()}`,Ae=localStorage.getItem("warhammer-deployment-layouts"),Fe=Ae?JSON.parse(Ae):{};Fe[ue]={terrains:j||[],walls:ie||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(Fe)),ua.set(ue),Ta.set("saved")}}else if(F==="saved"&&W){const le=localStorage.getItem("warhammer-deployment-layouts"),ue=le?JSON.parse(le):{};ue[W]?(ua.set(W),Ta.set("saved")):(j||ie)&&(ue[W]={terrains:j||[],walls:ie||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(ue)),ua.set(W),Ta.set("saved"))}else if(j||ie){const le=`imported-${Date.now()}`,ue=localStorage.getItem("warhammer-deployment-layouts"),Ae=ue?JSON.parse(ue):{};Ae[le]={terrains:j||[],walls:ie||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(Ae)),ua.set(le),Ta.set("saved")}}S.models&&Array.isArray(S.models)&&(yt.set(S.models),Ln.clear()),v(Y,[])}function Ge(S,W){const ie=W===1?-4:64,le=2;let ue=ie,Ae=le,Fe=0;return S.map(Je=>{const tt={...Je,x:ue,y:Ae,inStaging:!1};return Ae+=2,Fe++,Fe>=20&&(Ae=le,ue+=W===1?-2:2,Fe=0),tt})}async function at(S){const{text:W,playerId:F}=S.detail;try{e(J)&&e(J).setLoading(!0);const{format:j,data:ie}=await Bm(W),{matched:le,unmatched:ue}=Jm(ie,F),Ae=ie.LIST_TITLE||`${ie.FACTION_KEYWORD} Army`;ti.addImport(Ae,W,ie,F),ue.length>0?(v(be,ue),De=le,v(ce,!0),e(J)&&e(J).setLoading(!1)):(Ge(le,F).forEach(Je=>{yt.update(tt=>[...tt,Je])}),e(J)&&(e(J).setSuccess(`Imported ${le.length} models from ${ie.FACTION_KEYWORD} (${j})`),e(J).clearText()))}catch(j){console.error("Failed to parse army list:",j),e(J)&&e(J).setError(j.message||"Failed to parse army list")}}function qt(S){const{selected:W}=S.detail,F=[];for(const le of W){const ue=typeof le.quantity=="string"?parseInt(le.quantity.replace(/x/i,""),10)||1:le.quantity||1,Ae="unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);for(let Fe=0;Fe<ue;Fe++)F.push({id:"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),baseType:le.baseType,playerId:e(C),x:0,y:0,rotation:0,unitId:Ae,unitName:le.unitName,name:le.unitName,imported:!0})}const j=[...De,...F];Ge(j,e(C)).forEach(le=>{yt.update(ue=>[...ue,le])}),e(J)&&(e(J).setSuccess(`Imported ${j.length} models`),e(J).clearText()),v(be,[]),De=[]}xs(()=>{window.addEventListener("keydown",je)}),pi(()=>{window.removeEventListener("keydown",je)});function je(S){if(S.target.tagName==="INPUT")return;const W=e(Y).length>0;if((S.ctrlKey||S.metaKey)&&S.key==="z"&&!S.shiftKey){S.preventDefault(),yt.undo();return}if((S.ctrlKey||S.metaKey)&&(S.key==="y"||S.shiftKey&&S.key==="z")){S.preventDefault(),yt.redo();return}if(S.key==="1"){S.preventDefault(),v(C,1);return}if(S.key==="2"){S.preventDefault(),v(C,2);return}if(S.key==="l"||S.key==="L"){S.preventDefault(),v(he,!e(he));return}if(S.key==="m"||S.key==="M"){S.preventDefault(),v(Rt,!e(Rt)),e(Rt)||(v(ct,!1),v(it,null),v(ht,null));return}if(S.key==="Delete"||S.key==="Backspace"){if(S.preventDefault(),e(nt)){v(lt,e(lt).filter(F=>F.id!==e(nt))),v(nt,null);return}e(Y).length>0&&(e(Y).forEach(F=>{yt.remove(F)}),v(Y,[]));return}if(W&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(S.key)){S.preventDefault();const F=S.shiftKey?.1:1;let j=0,ie=0;switch(S.key){case"ArrowUp":ie=-F;break;case"ArrowDown":ie=F;break;case"ArrowLeft":j=-F;break;case"ArrowRight":j=F;break}e(Y).forEach(le=>{const ue=i().find(Ae=>Ae.id===le);ue&&yt.updateModel(le,{x:ue.x+j,y:ue.y+ie},!1)});return}if(S.key==="Escape"){I();return}}function I(S){if(Me){Me=!1;return}v(Y,[]),v(nt,null)}function me(){return"line-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Te(S,W,F,j){return Math.sqrt((F-S)**2+(j-W)**2)}function $e(S){if(!e(N))return;S.preventDefault();const W=e(N)(S.clientX,S.clientY);v(ct,!0),v(it,{x:W.x,y:W.y}),v(ht,{x:W.x,y:W.y}),window.addEventListener("mousemove",Pe),window.addEventListener("mouseup",st)}function Pe(S){if(!e(ct)||!e(N))return;const W=e(N)(S.clientX,S.clientY);v(ht,{x:W.x,y:W.y})}function st(S){if(!e(ct))return;if(Te(e(it).x,e(it).y,e(ht).x,e(ht).y)>.5){const F={id:me(),x1:e(it).x,y1:e(it).y,x2:e(ht).x,y2:e(ht).y};v(lt,[...e(lt),F]),v(nt,F.id),v(Y,[])}v(ct,!1),v(it,null),v(ht,null),window.removeEventListener("mousemove",Pe),window.removeEventListener("mouseup",st)}function ft(S,W){W?.stopPropagation(),v(nt,S),v(Y,[])}let Ee=!1,ze={x:0,y:0},Ft=null,Fn=null;function tn(S,W){if(!e(Rt)||!e(N))return;W.stopPropagation(),W.preventDefault();const F=e(lt).find(ue=>ue.id===S);if(!F)return;Ee=!0,Ft=S,Fn=null,v(nt,S),v(Y,[]);const j=e(N)(W.clientX,W.clientY),ie=(F.x1+F.x2)/2,le=(F.y1+F.y2)/2;ze={x:j.x-ie,y:j.y-le},window.addEventListener("mousemove",ia),window.addEventListener("mouseup",Qn)}function ra(S,W,F){!e(Rt)||!e(N)||(F.stopPropagation(),F.preventDefault(),Ee=!0,Ft=S,Fn=W,v(nt,S),v(Y,[]),window.addEventListener("mousemove",ia),window.addEventListener("mouseup",Qn))}function ia(S){if(!Ee||!e(N)||!Ft)return;const W=e(N)(S.clientX,S.clientY);v(lt,e(lt).map(F=>{if(F.id!==Ft)return F;if(Fn===1)return{...F,x1:W.x,y1:W.y};if(Fn===2)return{...F,x2:W.x,y2:W.y};{const j=W.x-ze.x,ie=W.y-ze.y,le=(F.x1+F.x2)/2,ue=(F.y1+F.y2)/2,Ae=j-le,Fe=ie-ue;return{...F,x1:F.x1+Ae,y1:F.y1+Fe,x2:F.x2+Ae,y2:F.y2+Fe}}}))}function Qn(){Ee=!1,Ft=null,Fn=null,window.removeEventListener("mousemove",ia),window.removeEventListener("mouseup",Qn)}function ns(){v(lt,[]),v(nt,null)}function as(S){const W=S.target,F=W.closest(".model-base"),j=W.closest(".measurement-line");if(F||j||!e(N))return;if(S.preventDefault(),e(Rt)){$e(S);return}const ie=e(N)(S.clientX,S.clientY);v(V,{x:ie.x,y:ie.y}),v(xe,{x:ie.x,y:ie.y}),v(U,!0),window.addEventListener("mousemove",hn),window.addEventListener("mouseup",Zn)}function hn(S){if(!e(U)||!e(N))return;const W=e(N)(S.clientX,S.clientY);v(xe,{x:W.x,y:W.y});const F=Math.min(e(V).x,e(xe).x),j=Math.max(e(V).x,e(xe).x),ie=Math.min(e(V).y,e(xe).y),le=Math.max(e(V).y,e(xe).y),ue=new Set;i().forEach(Ae=>{Ae.x>=F&&Ae.x<=j&&Ae.y>=ie&&Ae.y<=le&&ue.add(Ae.id)}),v(ve,ue)}function Zn(S){if(!e(U))return;const W=Math.min(e(V).x,e(xe).x),F=Math.max(e(V).x,e(xe).x),j=Math.min(e(V).y,e(xe).y),ie=Math.max(e(V).y,e(xe).y),le=F-W,ue=ie-j;if(le<.5&&ue<.5)v(Y,[]);else{const Ae=[];i().forEach(Fe=>{Fe.x>=W&&Fe.x<=F&&Fe.y>=j&&Fe.y<=ie&&Ae.push(Fe.id)}),v(Y,Ae),Me=!0}v(U,!1),v(V,null),v(xe,null),e(ve).clear(),v(ve,e(ve)),window.removeEventListener("mousemove",hn),window.removeEventListener("mouseup",Zn)}function P(S,W){if(!e(N))return;H=!0,oe={x:W.clientX,y:W.clientY};const F=e(N)(W.clientX,W.clientY);v($,{baseType:S.type,x:F.x,y:F.y}),window.addEventListener("mousemove",Q),window.addEventListener("mouseup",re)}function Q(S){if(!H||!e($)||!e(N))return;const W=e(N)(S.clientX,S.clientY);v($,{...e($),x:W.x,y:W.y})}function re(S){if(!H||!e($)){H=!1,v($,null),oe=null,window.removeEventListener("mousemove",Q),window.removeEventListener("mouseup",re);return}const W=S.clientX-oe.x,F=S.clientY-oe.y,j=Math.sqrt(W*W+F*F);let ie,le;j<Ve?(ie=30,le=22):(ie=e($).x,le=e($).y);const ue=e($).customWidth&&e($).customHeight?{width:e($).customWidth,height:e($).customHeight}:null,Ae=yt.add(e($).baseType,e(C),ie,le,ue);v(Y,[Ae]),v($,null),H=!1,oe=null,window.removeEventListener("mousemove",Q),window.removeEventListener("mouseup",re)}function Ne(){const F={width:e(ne),height:e(se)},j=yt.add("rect-custom",e(C),30,22,F);v(Y,[j])}function Ye(S,W){W&&(W.ctrlKey||W.metaKey||W.shiftKey)?e(Y).includes(S)?v(Y,e(Y).filter(F=>F!==S)):v(Y,[...e(Y),S]):e(Y).includes(S)&&e(Y).length>1||v(Y,[S])}function Ue(S,W,F){if(e(Y).length>1&&e(Y).includes(S)){dt||(dt=!0,fe={},e(Y).forEach(ie=>{const le=i().find(ue=>ue.id===ie);le&&(fe[ie]={x:le.x,y:le.y})}));const j=fe[S];if(j){const ie=W-j.x,le=F-j.y;e(Y).forEach(ue=>{const Ae=fe[ue];Ae&&yt.updateModel(ue,{x:Ae.x+ie,y:Ae.y+le},!0)})}}else yt.updateModel(S,{x:W,y:F},!0)}function Oe(S,W,F,j,ie){dt?(e(Y).forEach(le=>{const ue=fe[le],Ae=i().find(Fe=>Fe.id===le);ue&&Ae&&Ln.push({type:"move",modelId:le,before:{x:ue.x,y:ue.y},after:{x:Ae.x,y:Ae.y}})}),dt=!1,fe=null):Ln.push({type:"move",modelId:S,before:{x:W,y:F},after:{x:j,y:ie}})}function Qe(S,W){if(e(Y).length>1&&e(Y).includes(S)){if(!te){te=!0;let le=0,ue=0,Ae=0;const Fe={};e(Y).forEach(Je=>{const tt=i().find(rt=>rt.id===Je);tt&&(le+=tt.x,ue+=tt.y,Ae++,Fe[Je]={x:tt.x,y:tt.y,rotation:tt.rotation||0})}),Ke={x:le/Ae,y:ue/Ae},fe=Fe}const F=i().find(le=>le.id===S),j=fe[S];if(!F||!j)return;const ie=W-j.rotation;e(Y).forEach(le=>{const ue=fe[le];if(ue){const Ae=ue.x-Ke.x,Fe=ue.y-Ke.y,Je=ie*Math.PI/180,tt=Math.cos(Je),rt=Math.sin(Je),Vt=Ae*tt-Fe*rt,an=Ae*rt+Fe*tt;yt.updateModel(le,{x:Ke.x+Vt,y:Ke.y+an,rotation:ue.rotation+ie},!0)}})}else yt.updateModel(S,{rotation:W},!0)}function gt(S,W,F){te?(e(Y).forEach(j=>{const ie=fe[j],le=i().find(ue=>ue.id===j);ie&&le&&Ln.push({type:"rotate",modelId:j,before:{x:ie.x,y:ie.y,rotation:ie.rotation},after:{x:le.x,y:le.y,rotation:le.rotation||0}})}),te=!1,Ke=null,fe=null):Ln.push({type:"rotate",modelId:S,before:{rotation:W},after:{rotation:F}})}function Qt(S,W){yt.updateModel(S,{name:W})}function Ut(S){if(!e(N)||e(u).length<2)return;S.preventDefault(),S.stopPropagation(),te=!0,Dt={},e(u).forEach(F=>{Dt[F.id]={x:F.x,y:F.y,rotation:F.rotation||0}});const W=e(N)(S.clientX,S.clientY);Ce=Math.atan2(W.y-e(g).y,W.x-e(g).x)*180/Math.PI,window.addEventListener("mousemove",Kt),window.addEventListener("mouseup",Wt)}function Kt(S){if(!te||!e(N)||!e(g))return;const W=e(N)(S.clientX,S.clientY);let j=Math.atan2(W.y-e(g).y,W.x-e(g).x)*180/Math.PI-Ce;S.shiftKey||(j=Math.round(j/15)*15),v(Zt,-45+j);const ie=j*Math.PI/180,le=Math.cos(ie),ue=Math.sin(ie);e(u).forEach(Ae=>{const Fe=Dt[Ae.id];if(Fe){const Je=Fe.x-e(g).x,tt=Fe.y-e(g).y,rt=Je*le-tt*ue,Vt=Je*ue+tt*le;yt.updateModel(Ae.id,{x:e(g).x+rt,y:e(g).y+Vt,rotation:Fe.rotation+j},!0)}})}function Wt(){te&&Dt&&e(u).forEach(S=>{const W=Dt[S.id];W&&Ln.push({type:"rotate",modelId:S.id,before:{x:W.x,y:W.y,rotation:W.rotation},after:{x:S.x,y:S.y,rotation:S.rotation||0}})}),te=!1,Dt=null,v(Zt,-45),window.removeEventListener("mousemove",Kt),window.removeEventListener("mouseup",Wt)}function nn(){e(Y).length>0&&(e(Y).forEach(S=>{yt.remove(S)}),v(Y,[]))}function xn(){confirm("Clear all models?")&&(yt.clear(),v(Y,[]))}function fn(S){if(_a(S.baseType))return{x:S.x,y:S.y,width:S.customWidth,height:S.customHeight,rotation:S.rotation||0,isRectangle:!0};const W=Nn(S.baseType,S);return An(S.baseType)?{x:S.x,y:S.y,rx:W.width/2,ry:W.height/2,rotation:S.rotation||0}:{x:S.x,y:S.y,radius:W.radius}}let Zt=O(-45);ye(()=>(e(Y),i()),()=>{v(u,e(Y).map(S=>i().find(W=>W.id===S)).filter(Boolean))}),ye(()=>e(u),()=>{v(p,e(u).length===1?e(u)[0]:null)}),ye(()=>e(u),()=>{v(g,e(u).length>1?(()=>{let S=0,W=0;return e(u).forEach(F=>{S+=F.x,W+=F.y}),{x:S/e(u).length,y:W/e(u).length}})():null)}),ye(()=>(e(u),e(g),An),()=>{v(_,e(u).length>1?(()=>{let S=0;return e(u).forEach(W=>{const F=Math.sqrt(Math.pow(W.x-e(g).x,2)+Math.pow(W.y-e(g).y,2)),j=Nn(W.baseType,W),ie=_a(W.baseType)?Math.max(W.customWidth,W.customHeight)/2:An(W.baseType)?Math.max(j.width,j.height)/2:j.radius;S=Math.max(S,F+ie)}),S+2})():0)}),ye(()=>(e(g),e(_),e(Zt)),()=>{v(T,e(g)?e(g).x+e(_)*Math.cos(e(Zt)*Math.PI/180):0)}),ye(()=>(e(g),e(_),e(Zt)),()=>{v(E,e(g)?e(g).y+e(_)*Math.sin(e(Zt)*Math.PI/180):0)}),ye(()=>(e(nt),e(lt)),()=>{v(k,e(nt)?e(lt).find(S=>S.id===e(nt)):null)}),ye(()=>e(u),()=>{v(L,[...new Set(e(u).map(S=>S.playerId))])}),ye(()=>(e(u),i(),e(L)),()=>{v(w,e(u).length>0?i().filter(S=>!e(L).includes(S.playerId)):[])}),ye(()=>(o(),bs),()=>{v(A,o().terrains.map(S=>({id:S.id,vertices:bs(S)})))}),ye(()=>(o(),es),()=>{v(R,o().walls.map(S=>$r(es(S.shape,S.segments),S.x,S.y,S.rotation)))}),ye(()=>(e(u),e(he),e(w),e(A),e(R)),()=>{v(D,e(u).length>0&&e(he)&&e(w).length>0?e(u).flatMap(S=>e(w).map(W=>{const F=vi(fn(W),fn(S),e(A),e(R));return{sourceId:W.id,source:W,targetId:S.id,target:S,canSee:F.canSee,firstClearRay:F.firstClearRay,rays:F.rays}})):[])}),Ea(),jn();var Mt=Ud(),Yt=_e(Mt),yn=x(Yt),pn=x(yn),_n=x(pn);cn(_n,{title:"Selected Model",children:(S,W)=>{var F=_t(),j=_e(F);{var ie=ue=>{var Ae=cd(),Fe=x(Ae),Je=b(x(Fe),2),tt=x(Je),rt=b(Fe,2),Vt=x(rt),an=x(Vt),$t=b(rt,2);{var Pt=mn=>{var Bn=ld(),oa=_e(Bn),ya=x(oa),pa=x(ya),Ma=b(oa,2);{var ss=Ra=>{var rs=od(),Us=b(x(rs),2),Be=x(Us);q(K=>ke(Be,`${K??""}/${e(D),l(()=>e(D).length)??""} rays visible`),[()=>(e(D),l(()=>e(D).filter(K=>K.canSee).length))]),M(Ra,rs)};ee(Ma,Ra=>{e(D),l(()=>e(D).length>0)&&Ra(ss)})}Sn(pa,()=>e(we),Ra=>v(we,Ra)),M(mn,Bn)};ee($t,mn=>{e(he)&&mn(Pt)})}var sn=b($t,2),jt=x(sn);q(()=>{ke(tt,`${e(Y),l(()=>e(Y).length)??""} models`),ke(jt,`Remove All (${e(Y),l(()=>e(Y).length)??""})`)}),Sn(an,()=>e(he),mn=>v(he,mn)),X("click",sn,nn),M(ue,Ae)},le=ue=>{var Ae=_t(),Fe=_e(Ae);{var Je=rt=>{var Vt=hd(),an=x(Vt),$t=b(x(an),2),Pt=b(an,2),sn=b(x(Pt),2),jt=x(sn),mn=b(Pt,2),Bn=b(x(mn),2),oa=x(Bn),ya=b(mn,2),pa=b(x(ya),2),Ma=x(pa),ss=b(ya,2);{var Ra=mt=>{var Bt=ud(),ut=b(x(Bt),2),pt=x(ut);q(At=>ke(pt,`${At??""}Â°`),[()=>(e(p),l(()=>Math.round(e(p).rotation||0)))]),M(mt,Bt)};ee(ss,mt=>{Z(An),e(p),l(()=>An(e(p).baseType))&&mt(Ra)})}var rs=b(ss,2),Us=x(rs),Be=x(Us),K=b(rs,2);{var Nt=mt=>{var Bt=md(),ut=x(Bt),pt=x(ut);Sn(pt,()=>e(we),At=>v(we,At)),M(mt,Bt)};ee(K,mt=>{e(he)&&mt(Nt)})}var Ct=b(K,2);{var z=mt=>{var Bt=dd(),ut=b(x(Bt),2),pt=x(ut);q(At=>ke(pt,`${At??""}/${e(D),l(()=>e(D).length)??""} visible`),[()=>(e(D),l(()=>e(D).filter(At=>At.canSee).length))]),M(mt,Bt)};ee(Ct,mt=>{e(he),e(D),l(()=>e(he)&&e(D).length>0)&&mt(z)})}var Re=b(Ct,2);q((mt,Bt,ut)=>{Ho($t,(e(p),l(()=>e(p).name||""))),ke(jt,mt),ke(oa,`Player ${e(p),l(()=>e(p).playerId)??""}`),ke(Ma,`${Bt??""}", ${ut??""}"`)},[()=>(Z(Nn),e(p),l(()=>Nn(e(p).baseType,e(p))?.label||"Unknown")),()=>(e(p),l(()=>e(p).x.toFixed(1))),()=>(e(p),l(()=>e(p).y.toFixed(1)))]),X("change",$t,mt=>Qt(e(p).id,mt.target.value)),Sn(Be,()=>e(he),mt=>v(he,mt)),X("click",Re,nn),M(rt,Vt)},tt=rt=>{var Vt=fd();M(rt,Vt)};ee(Fe,rt=>{e(p)?rt(Je):rt(tt,!1)},!0)}M(ue,Ae)};ee(j,ue=>{e(Y),l(()=>e(Y).length>1)?ue(ie):ue(le,!1)})}M(S,F)},$$slots:{default:!0}});var In=b(_n,2);cn(In,{title:"Measure Tool",children:(S,W)=>{var F=gd(),j=x(F),ie=x(j),le=x(ie),ue=b(j,2);{var Ae=jt=>{var mn=yd();M(jt,mn)};ee(ue,jt=>{e(Rt)&&jt(Ae)})}var Fe=b(ue,2);{var Je=jt=>{var mn=pd(),Bn=_e(mn),oa=b(x(Bn),2),ya=x(oa),pa=b(Bn,2);q(Ma=>ke(ya,`${Ma??""}"`),[()=>(e(k),l(()=>Te(e(k).x1,e(k).y1,e(k).x2,e(k).y2).toFixed(2)))]),X("click",pa,()=>{v(lt,e(lt).filter(Ma=>Ma.id!==e(nt))),v(nt,null)}),M(jt,mn)};ee(Fe,jt=>{e(k)&&jt(Je)})}var tt=b(Fe,2);{var rt=jt=>{var mn=vd(),Bn=_e(mn),oa=b(x(Bn),2),ya=x(oa),pa=b(Bn,2);q(()=>ke(ya,`${e(lt),l(()=>e(lt).length)??""} line${e(lt),l(()=>e(lt).length!==1?"s":"")??""}`)),X("click",pa,ns),M(jt,mn)};ee(tt,jt=>{e(lt),l(()=>e(lt).length>0)&&jt(rt)})}var Vt=b(tt,2),an=b(x(Vt),2),$t=x(an),Pt=b(an,2),sn=x(Pt);Sn(le,()=>e(Rt),jt=>v(Rt,jt)),Sn($t,()=>e(ae),jt=>v(ae,jt)),Sn(sn,()=>e(Le),jt=>v(Le,jt)),M(S,F)},$$slots:{default:!0}});var En=b(In,2);cn(En,{title:"Actions",children:(S,W)=>{var F=bd(),j=x(F),ie=x(j),le=b(ie,2),ue=b(j,2),Ae=x(ue),Fe=b(Ae,2),Je=b(ue,2);Sr(Je,$t=>v(Xt,$t),()=>e(Xt));var tt=b(Je,2),rt=b(tt,2),Vt=b(rt,2),an=b(Vt,2);q(()=>{ie.disabled=(c(),l(()=>!c().past.length)),le.disabled=(c(),l(()=>!c().future.length))}),X("click",ie,()=>yt.undo()),X("click",le,()=>yt.redo()),X("click",Ae,dn),X("click",Fe,on),X("change",Je,Cn),X("click",tt,St),X("click",rt,It),X("click",Vt,xn),X("click",an,en),M(S,F)},$$slots:{default:!0}});var We=b(En,2);cn(We,{title:"Import Army List",startOpen:!1,children:(S,W)=>{Sr(Sm(S,{get currentPlayer(){return e(C)},$$events:{parse:at},$$legacy:!0}),F=>v(J,F),()=>e(J))},$$slots:{default:!0}});var B=b(We,2);cn(B,{title:"Add Models",children:(S,W)=>{var F=Td(),j=_e(F),ie=x(j);let le;var ue=b(ie,2);let Ae;var Fe=b(j,2),Je=x(Fe),tt=b(x(Je),2);He(tt,5,()=>(Z(Xn),l(()=>Xn.circles)),ot,(an,$t)=>{Mr(an,{get baseSize(){return e($t)},get playerId(){return e(C)},onDragStart:P})});var rt=b(Je,2),Vt=b(x(rt),2);He(Vt,5,()=>(Z(Xn),l(()=>Xn.ovals)),ot,(an,$t)=>{Mr(an,{get baseSize(){return e($t)},get playerId(){return e(C)},onDragStart:P})}),q(()=>{le=gn(ie,1,"toggle-btn svelte-1g40uyy",null,le,{active:e(C)===1}),Ae=gn(ue,1,"toggle-btn svelte-1g40uyy",null,Ae,{active:e(C)===2})}),X("click",ie,()=>v(C,1)),X("click",ue,()=>v(C,2)),M(S,F)},$$slots:{default:!0}});var bt=b(B,2);cn(bt,{title:"Add Hull (Vehicle)",children:(S,W)=>{var F=xd(),j=x(F),ie=b(x(j),2),le=b(j,2),ue=b(x(le),2),Ae=b(le,2),Fe=x(Ae);q(()=>ke(Fe,`Add ${e(ne)??""}" Ã ${e(se)??""}" Hull`)),Mn(ie,()=>e(ne),Je=>v(ne,Je)),Mn(ue,()=>e(se),Je=>v(se,Je)),X("click",Ae,Ne),M(S,F)},$$slots:{default:!0}});var Tt=b(pn,2),G=x(Tt),Se=x(G),Gt=x(Se);lr(Gt,{children:kr,$$slots:{default:(S,W)=>{const F=Ie(()=>W.screenToSvg);var j=qd(),ie=_e(j);{var le=Be=>{var K=fi();q(()=>ke(K,(e(N),Z(e(F)),l(()=>(v(N,e(F)),""))))),M(Be,K)};ee(ie,Be=>{e(F)&&!e(N)&&Be(le)})}var ue=b(ie);{var Ae=Be=>{var K=Sd(),Nt=_e(K);He(Nt,1,()=>(a(),l(()=>a().zones)),ot,(z,Re)=>{var mt=_d();q(Bt=>{f(mt,"d",Bt),f(mt,"fill",(e(Re),l(()=>e(Re).color))),f(mt,"stroke",(e(Re),l(()=>e(Re).borderColor)))},[()=>(Z(tr),e(Re),l(()=>tr(e(Re).path)))]),M(z,mt)});var Ct=b(Nt);He(Ct,1,()=>(a(),l(()=>a().objectives)),ot,(z,Re)=>{const mt=Ie(()=>(e(Re),l(()=>e(Re).isPrimary?"#fbbf24":"#9ca3af"))),Bt=Ie(()=>(e(Re),l(()=>e(Re).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var ut=wd(),pt=_e(ut),At=b(pt),Jn=b(At);q(()=>{f(pt,"cx",(e(Re),l(()=>e(Re).x))),f(pt,"cy",(e(Re),l(()=>e(Re).y))),f(pt,"r",xi),f(pt,"fill",e(Bt)),f(pt,"stroke",e(mt)),f(At,"cx",(e(Re),l(()=>e(Re).x))),f(At,"cy",(e(Re),l(()=>e(Re).y))),f(At,"r",Ti),f(At,"fill",e(mt)),f(Jn,"cx",(e(Re),l(()=>e(Re).x))),f(Jn,"cy",(e(Re),l(()=>e(Re).y)))}),M(z,ut)}),M(Be,K)};ee(ue,Be=>{a()&&Be(Ae)})}var Fe=b(ue);ee(Fe,Be=>{});var Je=b(Fe);ee(Je,Be=>{});var tt=b(Je);He(tt,1,()=>(o(),l(()=>o().terrains)),ot,(Be,K)=>{var Nt=Ad(),Ct=x(Nt);q(()=>{f(Nt,"transform",`rotate(${e(K),l(()=>e(K).rotation)??""}, ${e(K),l(()=>e(K).x+e(K).width/2)??""}, ${e(K),l(()=>e(K).y+e(K).height/2)??""})`),f(Ct,"x",(e(K),l(()=>e(K).x))),f(Ct,"y",(e(K),l(()=>e(K).y))),f(Ct,"width",(e(K),l(()=>e(K).width))),f(Ct,"height",(e(K),l(()=>e(K).height)))}),M(Be,Nt)});var rt=b(tt);He(rt,1,()=>(o(),l(()=>o().walls)),ot,(Be,K)=>{var Nt=Cd(),Ct=x(Nt);Pr(Ct,{get id(){return e(K),l(()=>e(K).id)},get x(){return e(K),l(()=>e(K).x)},get y(){return e(K),l(()=>e(K).y)},get shape(){return e(K),l(()=>e(K).shape)},get segments(){return e(K),l(()=>e(K).segments)},get rotation(){return e(K),l(()=>e(K).rotation)},selected:!1,get screenToSvg(){return e(F)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),M(Be,Nt)});var Vt=b(rt);{var an=Be=>{var K=_t(),Nt=_e(K);He(Nt,1,i,Ct=>Ct.id,(Ct,z)=>{const Re=Ie(()=>(Z(Nn),e(z),l(()=>Nn(e(z).baseType,e(z))))),mt=Ie(()=>(Z(An),e(z),l(()=>An(e(z).baseType)))),Bt=Ie(()=>(Z(_a),e(z),l(()=>_a(e(z).baseType)))),ut=Ie(()=>(e(z),l(()=>e(z).playerId===1?"rgba(59, 130, 246, 0.15)":"rgba(239, 68, 68, 0.15)"))),pt=Ie(()=>(e(z),l(()=>e(z).playerId===1?"#3b82f6":"#ef4444")));var At=Id(),Jn=_e(At);{var ws=va=>{var la=_t(),qa=_e(la);{var is=qn=>{var Un=Ed(),wn=x(Un);q(()=>{f(Un,"transform",`rotate(${e(z),l(()=>e(z).rotation||0)??""}, ${e(z),l(()=>e(z).x)??""}, ${e(z),l(()=>e(z).y)??""})`),f(wn,"x",(e(z),l(()=>e(z).x-e(z).customWidth/2-9))),f(wn,"y",(e(z),l(()=>e(z).y-e(z).customHeight/2-9))),f(wn,"width",(e(z),l(()=>e(z).customWidth+18))),f(wn,"height",(e(z),l(()=>e(z).customHeight+18))),f(wn,"fill",e(ut)),f(wn,"stroke",e(pt))}),M(qn,Un)},Nr=qn=>{var Un=_t(),wn=_e(Un);{var Or=Kn=>{var ln=Md(),ea=x(ln);q(()=>{f(ln,"transform",`rotate(${e(z),l(()=>e(z).rotation||0)??""}, ${e(z),l(()=>e(z).x)??""}, ${e(z),l(()=>e(z).y)??""})`),f(ea,"cx",(e(z),l(()=>e(z).x))),f(ea,"cy",(e(z),l(()=>e(z).y))),f(ea,"rx",(Z(e(Re)),l(()=>e(Re).width/2+9))),f(ea,"ry",(Z(e(Re)),l(()=>e(Re).height/2+9))),f(ea,"fill",e(ut)),f(ea,"stroke",e(pt))}),M(Kn,ln)},Wr=Kn=>{var ln=Rd();q(()=>{f(ln,"cx",(e(z),l(()=>e(z).x))),f(ln,"cy",(e(z),l(()=>e(z).y))),f(ln,"r",(Z(e(Re)),l(()=>e(Re).radius+9))),f(ln,"fill",e(ut)),f(ln,"stroke",e(pt))}),M(Kn,ln)};ee(wn,Kn=>{e(mt)?Kn(Or):Kn(Wr,!1)},!0)}M(qn,Un)};ee(qa,qn=>{e(Bt)?qn(is):qn(Nr,!1)})}M(va,la)};ee(Jn,va=>{e(Le)&&va(ws)})}var Ks=b(Jn);{var $n=va=>{var la=_t(),qa=_e(la);{var is=qn=>{var Un=kd(),wn=x(Un);q(()=>{f(Un,"transform",`rotate(${e(z),l(()=>e(z).rotation||0)??""}, ${e(z),l(()=>e(z).x)??""}, ${e(z),l(()=>e(z).y)??""})`),f(wn,"x",(e(z),l(()=>e(z).x-e(z).customWidth/2-6))),f(wn,"y",(e(z),l(()=>e(z).y-e(z).customHeight/2-6))),f(wn,"width",(e(z),l(()=>e(z).customWidth+12))),f(wn,"height",(e(z),l(()=>e(z).customHeight+12))),f(wn,"stroke",e(pt))}),M(qn,Un)},Nr=qn=>{var Un=_t(),wn=_e(Un);{var Or=Kn=>{var ln=Ld(),ea=x(ln);q(()=>{f(ln,"transform",`rotate(${e(z),l(()=>e(z).rotation||0)??""}, ${e(z),l(()=>e(z).x)??""}, ${e(z),l(()=>e(z).y)??""})`),f(ea,"cx",(e(z),l(()=>e(z).x))),f(ea,"cy",(e(z),l(()=>e(z).y))),f(ea,"rx",(Z(e(Re)),l(()=>e(Re).width/2+6))),f(ea,"ry",(Z(e(Re)),l(()=>e(Re).height/2+6))),f(ea,"stroke",e(pt))}),M(Kn,ln)},Wr=Kn=>{var ln=Dd();q(()=>{f(ln,"cx",(e(z),l(()=>e(z).x))),f(ln,"cy",(e(z),l(()=>e(z).y))),f(ln,"r",(Z(e(Re)),l(()=>e(Re).radius+6))),f(ln,"stroke",e(pt))}),M(Kn,ln)};ee(wn,Kn=>{e(mt)?Kn(Or):Kn(Wr,!1)},!0)}M(qn,Un)};ee(qa,qn=>{e(Bt)?qn(is):qn(Nr,!1)})}M(va,la)};ee(Ks,va=>{e(ae)&&va($n)})}M(Ct,At)}),M(Be,K)};ee(Vt,Be=>{(e(ae)||e(Le))&&Be(an)})}var $t=b(Vt);He($t,1,i,Be=>Be.id,(Be,K)=>{{let Nt=Ie(()=>(e(K),l(()=>e(K).name||""))),Ct=Ie(()=>(e(Y),e(K),l(()=>e(Y).includes(e(K).id)))),z=Ie(()=>(e(Y),e(K),l(()=>e(Y).length>1&&e(Y).includes(e(K).id)))),Re=Ie(()=>(e(Y),e(K),e(ve),l(()=>!e(Y).includes(e(K).id)&&e(ve).has(e(K).id))));nr(Be,{get id(){return e(K),l(()=>e(K).id)},get x(){return e(K),l(()=>e(K).x)},get y(){return e(K),l(()=>e(K).y)},get baseType(){return e(K),l(()=>e(K).baseType)},get playerId(){return e(K),l(()=>e(K).playerId)},get rotation(){return e(K),l(()=>e(K).rotation)},get name(){return e(Nt)},get customWidth(){return e(K),l(()=>e(K).customWidth)},get customHeight(){return e(K),l(()=>e(K).customHeight)},get selected(){return e(Ct)},get inGroupSelection(){return e(z)},get marqueePreview(){return e(Re)},get screenToSvg(){return e(F)},onSelect:Ye,onDrag:Ue,onDragEnd:Oe,onRotate:Qe,onRotateEnd:gt,onRename:Qt})}});var Pt=b($t);{var sn=Be=>{nr(Be,{id:"phantom",get x(){return e($),l(()=>e($).x)},get y(){return e($),l(()=>e($).y)},get baseType(){return e($),l(()=>e($).baseType)},get playerId(){return e(C)},rotation:0,get customWidth(){return e($),l(()=>e($).customWidth)},get customHeight(){return e($),l(()=>e($).customHeight)},selected:!1,get screenToSvg(){return e(F)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};ee(Pt,Be=>{e($)&&Be(sn)})}var jt=b(Pt);{var mn=Be=>{var K=$d(),Nt=_e(K),Ct=b(Nt),z=b(Ct),Re=b(z);q(()=>{f(Nt,"cx",(e(g),l(()=>e(g).x))),f(Nt,"cy",(e(g),l(()=>e(g).y))),f(Ct,"x1",(e(g),l(()=>e(g).x))),f(Ct,"y1",(e(g),l(()=>e(g).y))),f(Ct,"x2",e(T)),f(Ct,"y2",e(E)),f(z,"cx",e(T)),f(z,"cy",e(E)),f(Re,"transform",`translate(${e(T)??""}, ${e(E)??""})`)}),X("mousedown",z,Ut),M(Be,K)};ee(jt,Be=>{e(g),e(u),l(()=>e(g)&&e(u).length>1)&&Be(mn)})}var Bn=b(jt);He(Bn,1,()=>e(lt),Be=>Be.id,(Be,K)=>{const Nt=Ie(()=>(e(K),l(()=>Te(e(K).x1,e(K).y1,e(K).x2,e(K).y2)))),Ct=Ie(()=>(e(K),l(()=>(e(K).x1+e(K).x2)/2))),z=Ie(()=>(e(K),l(()=>(e(K).y1+e(K).y2)/2))),Re=Ie(()=>(e(K),e(nt),l(()=>e(K).id===e(nt))));var mt=Nd();let Bt;var ut=x(mt),pt=b(ut);{var At=$n=>{var va=Pd(),la=_e(va),qa=b(la);q(()=>{f(la,"cx",(e(K),l(()=>e(K).x1))),f(la,"cy",(e(K),l(()=>e(K).y1))),f(la,"fill",e(Re)?"#3b82f6":"#f59e0b"),f(qa,"cx",(e(K),l(()=>e(K).x2))),f(qa,"cy",(e(K),l(()=>e(K).y2))),f(qa,"fill",e(Re)?"#3b82f6":"#f59e0b")}),X("mousedown",la,is=>ra(e(K).id,1,is)),X("mousedown",qa,is=>ra(e(K).id,2,is)),M($n,va)};ee(pt,$n=>{e(Rt)&&$n(At)})}var Jn=b(pt),ws=b(x(Jn)),Ks=x(ws);q($n=>{Bt=gn(mt,0,"measurement-line",null,Bt,{selected:e(Re),"tool-active":e(Rt)}),f(ut,"x1",(e(K),l(()=>e(K).x1))),f(ut,"y1",(e(K),l(()=>e(K).y1))),f(ut,"x2",(e(K),l(()=>e(K).x2))),f(ut,"y2",(e(K),l(()=>e(K).y2))),f(ut,"stroke",e(Re)&&e(Rt)?"#3b82f6":"#f59e0b"),f(ut,"stroke-width",e(Re)&&e(Rt)?.2:.15),f(ut,"role",e(Rt)?"button":"presentation"),f(ut,"tabindex",e(Rt)?0:-1),f(Jn,"transform",`translate(${e(Ct)??""}, ${e(z)??""})`),f(ws,"fill",e(Re)&&e(Rt)?"#3b82f6":"#f59e0b"),ke(Ks,`${$n??""}"`)},[()=>(Z(e(Nt)),l(()=>e(Nt).toFixed(1)))]),X("click",ut,$n=>e(Rt)&&ft(e(K).id,$n)),X("mousedown",ut,$n=>e(Rt)?tn(e(K).id,$n):$n.stopPropagation()),M(Be,mt)});var oa=b(Bn);{var ya=Be=>{const K=Ie(()=>(e(it),e(ht),l(()=>Te(e(it).x,e(it).y,e(ht).x,e(ht).y)))),Nt=Ie(()=>(e(it),e(ht),l(()=>(e(it).x+e(ht).x)/2))),Ct=Ie(()=>(e(it),e(ht),l(()=>(e(it).y+e(ht).y)/2)));var z=Wd(),Re=x(z),mt=b(Re),Bt=b(mt),ut=b(Bt);{var pt=At=>{var Jn=Od(),ws=b(x(Jn)),Ks=x(ws);q($n=>{f(Jn,"transform",`translate(${e(Nt)??""}, ${e(Ct)??""})`),ke(Ks,`${$n??""}"`)},[()=>(Z(e(K)),l(()=>e(K).toFixed(1)))]),M(At,Jn)};ee(ut,At=>{e(K)>.5&&At(pt)})}q(()=>{f(Re,"x1",(e(it),l(()=>e(it).x))),f(Re,"y1",(e(it),l(()=>e(it).y))),f(Re,"x2",(e(ht),l(()=>e(ht).x))),f(Re,"y2",(e(ht),l(()=>e(ht).y))),f(mt,"cx",(e(it),l(()=>e(it).x))),f(mt,"cy",(e(it),l(()=>e(it).y))),f(Bt,"cx",(e(ht),l(()=>e(ht).x))),f(Bt,"cy",(e(ht),l(()=>e(ht).y)))}),M(Be,z)};ee(oa,Be=>{e(ct)&&e(it)&&e(ht)&&Be(ya)})}var pa=b(oa);{var Ma=Be=>{var K=_t(),Nt=_e(K);He(Nt,1,()=>e(D),ot,(Ct,z)=>{var Re=_t(),mt=_e(Re);He(mt,1,()=>(e(z),l(()=>e(z).rays)),ot,(Bt,ut)=>{var pt=Yd();q(()=>{f(pt,"x1",(e(ut),l(()=>e(ut).from.x))),f(pt,"y1",(e(ut),l(()=>e(ut).from.y))),f(pt,"x2",(e(ut),l(()=>e(ut).to.x))),f(pt,"y2",(e(ut),l(()=>e(ut).to.y))),f(pt,"stroke",(e(ut),l(()=>e(ut).blocked?"#ff000033":"#00ff0033")))}),M(Bt,pt)}),M(Ct,Re)}),M(Be,K)};ee(pa,Be=>{e(we),e(he),e(u),e(D),l(()=>e(we)&&e(he)&&e(u).length>0&&e(D).length>0)&&Be(Ma)})}var ss=b(pa);{var Ra=Be=>{var K=_t(),Nt=_e(K);He(Nt,1,()=>e(D),ot,(Ct,z)=>{var Re=_t(),mt=_e(Re);{var Bt=pt=>{var At=Hd();q(()=>{f(At,"x1",(e(z),l(()=>e(z).firstClearRay.from.x))),f(At,"y1",(e(z),l(()=>e(z).firstClearRay.from.y))),f(At,"x2",(e(z),l(()=>e(z).firstClearRay.to.x))),f(At,"y2",(e(z),l(()=>e(z).firstClearRay.to.y)))}),M(pt,At)},ut=pt=>{var At=Fd();q(()=>{f(At,"x1",(e(z),l(()=>e(z).source.x))),f(At,"y1",(e(z),l(()=>e(z).source.y))),f(At,"x2",(e(z),l(()=>e(z).target.x))),f(At,"y2",(e(z),l(()=>e(z).target.y)))}),M(pt,At)};ee(mt,pt=>{e(z),l(()=>e(z).firstClearRay)?pt(Bt):pt(ut,!1)})}M(Ct,Re)}),M(Be,K)};ee(ss,Be=>{e(he),e(u),e(D),l(()=>e(he)&&e(u).length>0&&e(D).length>0)&&Be(Ra)})}var rs=b(ss);{var Us=Be=>{const K=Ie(()=>(e(V),e(xe),l(()=>Math.min(e(V).x,e(xe).x)))),Nt=Ie(()=>(e(V),e(xe),l(()=>Math.min(e(V).y,e(xe).y)))),Ct=Ie(()=>(e(xe),e(V),l(()=>Math.abs(e(xe).x-e(V).x)))),z=Ie(()=>(e(xe),e(V),l(()=>Math.abs(e(xe).y-e(V).y))));var Re=Bd();q(()=>{f(Re,"x",e(K)),f(Re,"y",e(Nt)),f(Re,"width",e(Ct)),f(Re,"height",e(z))}),M(Be,Re)};ee(rs,Be=>{e(U)&&e(V)&&e(xe)&&Be(Us)})}M(S,j)}}});var Jt=b(Se,2),vt=x(Jt),xt=x(vt),Ze=b(Yt,2);Mm(Ze,{get unmatchedUnits(){return e(be)},get show(){return e(ce)},set show(S){v(ce,S)},$$events:{import:qt,close:()=>{v(ce,!1)}},$$legacy:!0}),q(()=>ke(xt,`Battlefield: 60" x 44" | ${d(),l(()=>d().length)??""} P1 models | ${h(),l(()=>h().length)??""} P2 models`)),X("mousedown",Se,as),M(t,Mt),Hn(),y()}var Gd=pe('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">LoS Status</span> <span class="value svelte-hpuhtb"> </span></div>'),zd=pe('<div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Debug Rays</label></div> <!>',1),Xd=pe('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Selected</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Line of Sight</label></div> <!> <button class="danger svelte-hpuhtb"> </button></div>'),Vd=pe('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Rotation</span> <span class="value svelte-hpuhtb"> </span></div>'),jd=pe('<div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Debug Rays</label></div>'),Qd=pe('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">LoS Status</span> <span class="value svelte-hpuhtb"> </span></div>'),Zd=pe('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Base Type</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Player</span> <span class="value svelte-hpuhtb"> </span></div> <div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Position</span> <span class="value svelte-hpuhtb"> </span></div> <!> <div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-hpuhtb">Remove</button></div>'),Jd=pe('<p class="hint svelte-hpuhtb">Click a model to select it</p>'),eh=pe('<p class="hint svelte-hpuhtb">Click and drag on battlefield to draw a measurement line</p>'),th=pe('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Length</span> <span class="value svelte-hpuhtb"> </span></div> <button class="danger svelte-hpuhtb">Remove Line</button>',1),nh=pe('<div class="field svelte-hpuhtb"><span class="label-text svelte-hpuhtb">Lines</span> <span class="value svelte-hpuhtb"> </span></div> <button class="secondary svelte-hpuhtb">Clear All Lines</button>',1),ah=pe('<div class="edit-form svelte-hpuhtb"><div class="field svelte-hpuhtb"><label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Line Tool Active (M)</label></div> <!> <!> <!> <div class="field svelte-hpuhtb" style="margin-top: 0.5rem; border-top: 1px solid #333; padding-top: 0.5rem;"><span class="label-text svelte-hpuhtb">Range Zones</span> <label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show 6" zones</label> <label class="checkbox-label svelte-hpuhtb"><input type="checkbox" class="svelte-hpuhtb"/> Show 9" zones</label></div></div>'),sh=pe('<div class="button-group vertical svelte-hpuhtb"><div class="button-row svelte-hpuhtb"><button title="Undo (Ctrl+Z)" class="svelte-hpuhtb">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-hpuhtb">Redo</button></div></div>'),rh=ge('<path fill="none" stroke-width="0.15" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),ih=ge('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),oh=ge("<!><!>",1),lh=ge('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),ch=ge('<g opacity="0.5" pointer-events="none"><!></g>'),uh=ge('<g><rect rx="9" ry="9" stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></rect></g>'),mh=ge('<g><ellipse stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></ellipse></g>'),dh=ge('<circle stroke-width="0.05" stroke-dasharray="0.5,0.25" pointer-events="none" opacity="0.5"></circle>'),hh=ge('<g><rect rx="6" ry="6" fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></rect></g>'),fh=ge('<g><ellipse fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></ellipse></g>'),yh=ge('<circle fill="none" stroke-width="0.08" stroke-dasharray="0.3,0.15" pointer-events="none" opacity="0.7"></circle>'),ph=ge("<!><!>",1),vh=ge('<circle r="0.4" fill="rgba(147, 51, 234, 0.5)" stroke="#9333ea" stroke-width="0.1" pointer-events="none"></circle><line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="group-rotate-handle"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),gh=ge('<circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle><circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle>',1),bh=ge('<g><line stroke-linecap="round"></line><!><g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g></g>'),Th=ge('<g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" fill="#f59e0b" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g>'),xh=ge('<g class="measurement-line drawing"><line stroke="#f59e0b" stroke-width="0.15" stroke-dasharray="0.3,0.15" stroke-linecap="round" pointer-events="none"></line><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><!></g>'),_h=ge('<line stroke-width="0.05" pointer-events="none"></line>'),wh=ge('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),Sh=ge('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),Ah=ge('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),Ch=ge("<!><!><!><!><!><!><!><!><!><!><!><!>",1),Eh=pe('<main class="svelte-hpuhtb"><div class="layout svelte-hpuhtb"><div class="sidebar svelte-hpuhtb"><!> <!> <!></div> <div class="main-content svelte-hpuhtb"><div class="battlefield-area svelte-hpuhtb"><div class="battlefield-container svelte-hpuhtb" role="presentation"><!></div> <div class="info svelte-hpuhtb"><p class="svelte-hpuhtb"> </p> <p class="hint svelte-hpuhtb">Drag to select | Ctrl+Click multi-select | Del remove | L LoS | M measure</p></div></div></div></div></main>');function Mh(t,n){Yn(n,!1);const a=()=>Lt(yt,"$models",d),r=()=>Lt(_i,"$loadedTerrain",d),s=()=>Lt(Ln,"$history",d),i=()=>Lt(Xa,"$selectedDeployment",d),o=()=>Lt(nl,"$player1Models",d),c=()=>Lt(al,"$player2Models",d),[d,h]=qs(),m=O(),y=O(),u=O(),p=O(),g=O(),_=O(),T=O(),E=O(),k=O(),L=O(),w=O(),A=O();let R=O(null),D=O(!1),C=O(!1),$=O(!1),H=O(null),oe=O(null),N=O([]),he=O(new Set),we=!1,ne=!1,se=null,ce=!1,be=null,De=0,J=null,U=O([]),V=O(null),xe=O(!1),Y=O(null),ve=O(null),Me=O(!1),dt=O(!1),fe=O(!1);xs(()=>{window.addEventListener("keydown",te)}),pi(()=>{window.removeEventListener("keydown",te)});function te(P){if(P.target.tagName==="INPUT")return;const Q=e(N).length>0;if((P.ctrlKey||P.metaKey)&&P.key==="z"&&!P.shiftKey){P.preventDefault(),yt.undo();return}if((P.ctrlKey||P.metaKey)&&(P.key==="y"||P.shiftKey&&P.key==="z")){P.preventDefault(),yt.redo();return}if(P.key==="l"||P.key==="L"){P.preventDefault(),v(D,!e(D));return}if(P.key==="m"||P.key==="M"){P.preventDefault(),v(Me,!e(Me)),e(Me)||(v(xe,!1),v(Y,null),v(ve,null));return}if(P.key==="Delete"||P.key==="Backspace"){if(P.preventDefault(),e(V)){v(U,e(U).filter(re=>re.id!==e(V))),v(V,null);return}e(N).length>0&&(e(N).forEach(re=>{yt.remove(re)}),v(N,[]));return}if(Q&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(P.key)){P.preventDefault();const re=P.shiftKey?.1:1;let Ne=0,Ye=0;switch(P.key){case"ArrowUp":Ye=-re;break;case"ArrowDown":Ye=re;break;case"ArrowLeft":Ne=-re;break;case"ArrowRight":Ne=re;break}e(N).forEach(Ue=>{const Oe=a().find(Qe=>Qe.id===Ue);Oe&&yt.updateModel(Ue,{x:Oe.x+Ne,y:Oe.y+Ye},!1)});return}if(P.key==="Escape"){Ke();return}}function Ke(P){if(we){we=!1;return}v(N,[]),v(V,null)}function Ce(){return"line-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Dt(P,Q,re,Ne){return Math.sqrt((re-P)**2+(Ne-Q)**2)}function lt(P){if(!e(R))return;P.preventDefault();const Q=e(R)(P.clientX,P.clientY);v(xe,!0),v(Y,{x:Q.x,y:Q.y}),v(ve,{x:Q.x,y:Q.y}),window.addEventListener("mousemove",nt),window.addEventListener("mouseup",ct)}function nt(P){if(!e(xe)||!e(R))return;const Q=e(R)(P.clientX,P.clientY);v(ve,{x:Q.x,y:Q.y})}function ct(P){if(!e(xe))return;if(Dt(e(Y).x,e(Y).y,e(ve).x,e(ve).y)>.5){const re={id:Ce(),x1:e(Y).x,y1:e(Y).y,x2:e(ve).x,y2:e(ve).y};v(U,[...e(U),re]),v(V,re.id),v(N,[])}v(xe,!1),v(Y,null),v(ve,null),window.removeEventListener("mousemove",nt),window.removeEventListener("mouseup",ct)}function it(P,Q){Q?.stopPropagation(),v(V,P),v(N,[])}let ht=!1,Rt={x:0,y:0},ae=null,Le=null;function Ve(P,Q){if(!e(Me)||!e(R))return;Q.stopPropagation(),Q.preventDefault();const re=e(U).find(Oe=>Oe.id===P);if(!re)return;ht=!0,ae=P,Le=null,v(V,P),v(N,[]);const Ne=e(R)(Q.clientX,Q.clientY),Ye=(re.x1+re.x2)/2,Ue=(re.y1+re.y2)/2;Rt={x:Ne.x-Ye,y:Ne.y-Ue},window.addEventListener("mousemove",St),window.addEventListener("mouseup",It)}function Et(P,Q,re){!e(Me)||!e(R)||(re.stopPropagation(),re.preventDefault(),ht=!0,ae=P,Le=Q,v(V,P),v(N,[]),window.addEventListener("mousemove",St),window.addEventListener("mouseup",It))}function St(P){if(!ht||!e(R)||!ae)return;const Q=e(R)(P.clientX,P.clientY);v(U,e(U).map(re=>{if(re.id!==ae)return re;if(Le===1)return{...re,x1:Q.x,y1:Q.y};if(Le===2)return{...re,x2:Q.x,y2:Q.y};{const Ne=Q.x-Rt.x,Ye=Q.y-Rt.y,Ue=(re.x1+re.x2)/2,Oe=(re.y1+re.y2)/2,Qe=Ne-Ue,gt=Ye-Oe;return{...re,x1:re.x1+Qe,y1:re.y1+gt,x2:re.x2+Qe,y2:re.y2+gt}}}))}function It(){ht=!1,ae=null,Le=null,window.removeEventListener("mousemove",St),window.removeEventListener("mouseup",It)}function en(){v(U,[]),v(V,null)}function dn(P){const Q=P.target,re=Q.closest(".model-base"),Ne=Q.closest(".measurement-line");if(re||Ne||!e(R))return;if(P.preventDefault(),e(Me)){lt(P);return}const Ye=e(R)(P.clientX,P.clientY);v(H,{x:Ye.x,y:Ye.y}),v(oe,{x:Ye.x,y:Ye.y}),v($,!0),window.addEventListener("mousemove",Xt),window.addEventListener("mouseup",on)}function Xt(P){if(!e($)||!e(R))return;const Q=e(R)(P.clientX,P.clientY);v(oe,{x:Q.x,y:Q.y});const re=Math.min(e(H).x,e(oe).x),Ne=Math.max(e(H).x,e(oe).x),Ye=Math.min(e(H).y,e(oe).y),Ue=Math.max(e(H).y,e(oe).y),Oe=new Set;a().forEach(Qe=>{Qe.x>=re&&Qe.x<=Ne&&Qe.y>=Ye&&Qe.y<=Ue&&Oe.add(Qe.id)}),v(he,Oe)}function on(P){if(!e($))return;const Q=Math.min(e(H).x,e(oe).x),re=Math.max(e(H).x,e(oe).x),Ne=Math.min(e(H).y,e(oe).y),Ye=Math.max(e(H).y,e(oe).y),Ue=re-Q,Oe=Ye-Ne;if(Ue<.5&&Oe<.5)v(N,[]);else{const Qe=[];a().forEach(gt=>{gt.x>=Q&&gt.x<=re&&gt.y>=Ne&&gt.y<=Ye&&Qe.push(gt.id)}),v(N,Qe),we=!0}v($,!1),v(H,null),v(oe,null),e(he).clear(),v(he,e(he)),window.removeEventListener("mousemove",Xt),window.removeEventListener("mouseup",on)}function Cn(P,Q){Q&&(Q.ctrlKey||Q.metaKey||Q.shiftKey)?e(N).includes(P)?v(N,e(N).filter(re=>re!==P)):v(N,[...e(N),P]):e(N).includes(P)&&e(N).length>1||v(N,[P])}function qe(P,Q,re){if(e(N).length>1&&e(N).includes(P)){ne||(ne=!0,se={},e(N).forEach(Ye=>{const Ue=a().find(Oe=>Oe.id===Ye);Ue&&(se[Ye]={x:Ue.x,y:Ue.y})}));const Ne=se[P];if(Ne){const Ye=Q-Ne.x,Ue=re-Ne.y;e(N).forEach(Oe=>{const Qe=se[Oe];Qe&&yt.updateModel(Oe,{x:Qe.x+Ye,y:Qe.y+Ue},!0)})}}else yt.updateModel(P,{x:Q,y:re},!0)}function Ge(P,Q,re,Ne,Ye){ne?(e(N).forEach(Ue=>{const Oe=se[Ue],Qe=a().find(gt=>gt.id===Ue);Oe&&Qe&&Ln.push({type:"move",modelId:Ue,before:{x:Oe.x,y:Oe.y},after:{x:Qe.x,y:Qe.y}})}),ne=!1,se=null):Ln.push({type:"move",modelId:P,before:{x:Q,y:re},after:{x:Ne,y:Ye}})}function at(P,Q){if(e(N).length>1&&e(N).includes(P)){if(!ce){ce=!0;let Ue=0,Oe=0,Qe=0;const gt={};e(N).forEach(Qt=>{const Ut=a().find(Kt=>Kt.id===Qt);Ut&&(Ue+=Ut.x,Oe+=Ut.y,Qe++,gt[Qt]={x:Ut.x,y:Ut.y,rotation:Ut.rotation||0})}),be={x:Ue/Qe,y:Oe/Qe},se=gt}const re=a().find(Ue=>Ue.id===P),Ne=se[P];if(!re||!Ne)return;const Ye=Q-Ne.rotation;e(N).forEach(Ue=>{const Oe=se[Ue];if(Oe){const Qe=Oe.x-be.x,gt=Oe.y-be.y,Qt=Ye*Math.PI/180,Ut=Math.cos(Qt),Kt=Math.sin(Qt),Wt=Qe*Ut-gt*Kt,nn=Qe*Kt+gt*Ut;yt.updateModel(Ue,{x:be.x+Wt,y:be.y+nn,rotation:Oe.rotation+Ye},!0)}})}else yt.updateModel(P,{rotation:Q},!0)}function qt(P,Q,re){ce?(e(N).forEach(Ne=>{const Ye=se[Ne],Ue=a().find(Oe=>Oe.id===Ne);Ye&&Ue&&Ln.push({type:"rotate",modelId:Ne,before:{x:Ye.x,y:Ye.y,rotation:Ye.rotation},after:{x:Ue.x,y:Ue.y,rotation:Ue.rotation||0}})}),ce=!1,be=null,se=null):Ln.push({type:"rotate",modelId:P,before:{rotation:Q},after:{rotation:re}})}function je(P,Q){yt.updateModel(P,{name:Q})}function I(P){if(!e(R)||e(m).length<2)return;P.preventDefault(),P.stopPropagation(),ce=!0,J={},e(m).forEach(re=>{J[re.id]={x:re.x,y:re.y,rotation:re.rotation||0}});const Q=e(R)(P.clientX,P.clientY);De=Math.atan2(Q.y-e(u).y,Q.x-e(u).x)*180/Math.PI,window.addEventListener("mousemove",me),window.addEventListener("mouseup",Te)}function me(P){if(!ce||!e(R)||!e(u))return;const Q=e(R)(P.clientX,P.clientY);let Ne=Math.atan2(Q.y-e(u).y,Q.x-e(u).x)*180/Math.PI-De;P.shiftKey||(Ne=Math.round(Ne/15)*15),v(st,-45+Ne);const Ye=Ne*Math.PI/180,Ue=Math.cos(Ye),Oe=Math.sin(Ye);e(m).forEach(Qe=>{const gt=J[Qe.id];if(gt){const Qt=gt.x-e(u).x,Ut=gt.y-e(u).y,Kt=Qt*Ue-Ut*Oe,Wt=Qt*Oe+Ut*Ue;yt.updateModel(Qe.id,{x:e(u).x+Kt,y:e(u).y+Wt,rotation:gt.rotation+Ne},!0)}})}function Te(){ce&&J&&e(m).forEach(P=>{const Q=J[P.id];Q&&Ln.push({type:"rotate",modelId:P.id,before:{x:Q.x,y:Q.y,rotation:Q.rotation},after:{x:P.x,y:P.y,rotation:P.rotation||0}})}),ce=!1,J=null,v(st,-45),window.removeEventListener("mousemove",me),window.removeEventListener("mouseup",Te)}function $e(){e(N).length>0&&(e(N).forEach(P=>{yt.remove(P)}),v(N,[]))}function Pe(P){if(_a(P.baseType))return{x:P.x,y:P.y,width:P.customWidth,height:P.customHeight,rotation:P.rotation||0,isRectangle:!0};const Q=Nn(P.baseType,P);return An(P.baseType)?{x:P.x,y:P.y,rx:Q.width/2,ry:Q.height/2,rotation:P.rotation||0}:{x:P.x,y:P.y,radius:Q.radius}}let st=O(-45);ye(()=>(e(N),a()),()=>{v(m,e(N).map(P=>a().find(Q=>Q.id===P)).filter(Boolean))}),ye(()=>e(m),()=>{v(y,e(m).length===1?e(m)[0]:null)}),ye(()=>e(m),()=>{v(u,e(m).length>1?(()=>{let P=0,Q=0;return e(m).forEach(re=>{P+=re.x,Q+=re.y}),{x:P/e(m).length,y:Q/e(m).length}})():null)}),ye(()=>(e(m),e(u),An),()=>{v(p,e(m).length>1?(()=>{let P=0;return e(m).forEach(Q=>{const re=Math.sqrt(Math.pow(Q.x-e(u).x,2)+Math.pow(Q.y-e(u).y,2)),Ne=Nn(Q.baseType,Q),Ye=_a(Q.baseType)?Math.max(Q.customWidth,Q.customHeight)/2:An(Q.baseType)?Math.max(Ne.width,Ne.height)/2:Ne.radius;P=Math.max(P,re+Ye)}),P+2})():0)}),ye(()=>(e(u),e(p),e(st)),()=>{v(g,e(u)?e(u).x+e(p)*Math.cos(e(st)*Math.PI/180):0)}),ye(()=>(e(u),e(p),e(st)),()=>{v(_,e(u)?e(u).y+e(p)*Math.sin(e(st)*Math.PI/180):0)}),ye(()=>(e(V),e(U)),()=>{v(T,e(V)?e(U).find(P=>P.id===e(V)):null)}),ye(()=>e(m),()=>{v(E,[...new Set(e(m).map(P=>P.playerId))])}),ye(()=>(e(m),a(),e(E)),()=>{v(k,e(m).length>0?a().filter(P=>!e(E).includes(P.playerId)):[])}),ye(()=>(r(),bs),()=>{v(L,r().terrains.map(P=>({id:P.id,vertices:bs(P)})))}),ye(()=>(r(),es),()=>{v(w,r().walls.map(P=>$r(es(P.shape,P.segments),P.x,P.y,P.rotation)))}),ye(()=>(e(m),e(D),e(k),e(L),e(w)),()=>{v(A,e(m).length>0&&e(D)&&e(k).length>0?e(m).flatMap(P=>e(k).map(Q=>{const re=vi(Pe(Q),Pe(P),e(L),e(w));return{sourceId:Q.id,source:Q,targetId:P.id,target:P,canSee:re.canSee,firstClearRay:re.firstClearRay,rays:re.rays}})):[])}),Ea(),jn();var ft=Eh(),Ee=x(ft),ze=x(Ee),Ft=x(ze);cn(Ft,{title:"Selected Model",children:(P,Q)=>{var re=_t(),Ne=_e(re);{var Ye=Oe=>{var Qe=Xd(),gt=x(Qe),Qt=b(x(gt),2),Ut=x(Qt),Kt=b(gt,2),Wt=x(Kt),nn=x(Wt),xn=b(Kt,2);{var fn=Yt=>{var yn=zd(),pn=_e(yn),_n=x(pn),In=x(_n),En=b(pn,2);{var We=B=>{var bt=Gd(),Tt=b(x(bt),2),G=x(Tt);q(Se=>ke(G,`${Se??""}/${e(A),l(()=>e(A).length)??""} visible`),[()=>(e(A),l(()=>e(A).filter(Se=>Se.canSee).length))]),M(B,bt)};ee(En,B=>{e(A),l(()=>e(A).length>0)&&B(We)})}Sn(In,()=>e(C),B=>v(C,B)),M(Yt,yn)};ee(xn,Yt=>{e(D)&&Yt(fn)})}var Zt=b(xn,2),Mt=x(Zt);q(()=>{ke(Ut,`${e(N),l(()=>e(N).length)??""} models`),ke(Mt,`Remove All (${e(N),l(()=>e(N).length)??""})`)}),Sn(nn,()=>e(D),Yt=>v(D,Yt)),X("click",Zt,$e),M(Oe,Qe)},Ue=Oe=>{var Qe=_t(),gt=_e(Qe);{var Qt=Kt=>{var Wt=Zd(),nn=x(Wt),xn=b(x(nn),2),fn=b(nn,2),Zt=b(x(fn),2),Mt=x(Zt),Yt=b(fn,2),yn=b(x(Yt),2),pn=x(yn),_n=b(Yt,2),In=b(x(_n),2),En=x(In),We=b(_n,2);{var B=Ze=>{var S=Vd(),W=b(x(S),2),F=x(W);q(j=>ke(F,`${j??""}Â°`),[()=>(e(y),l(()=>Math.round(e(y).rotation||0)))]),M(Ze,S)};ee(We,Ze=>{Z(An),e(y),l(()=>An(e(y).baseType))&&Ze(B)})}var bt=b(We,2),Tt=x(bt),G=x(Tt),Se=b(bt,2);{var Gt=Ze=>{var S=jd(),W=x(S),F=x(W);Sn(F,()=>e(C),j=>v(C,j)),M(Ze,S)};ee(Se,Ze=>{e(D)&&Ze(Gt)})}var Jt=b(Se,2);{var vt=Ze=>{var S=Qd(),W=b(x(S),2),F=x(W);q(j=>ke(F,`${j??""}/${e(A),l(()=>e(A).length)??""} visible`),[()=>(e(A),l(()=>e(A).filter(j=>j.canSee).length))]),M(Ze,S)};ee(Jt,Ze=>{e(D),e(A),l(()=>e(D)&&e(A).length>0)&&Ze(vt)})}var xt=b(Jt,2);q((Ze,S,W)=>{Ho(xn,(e(y),l(()=>e(y).name||""))),ke(Mt,Ze),ke(pn,`Player ${e(y),l(()=>e(y).playerId)??""}`),ke(En,`${S??""}", ${W??""}"`)},[()=>(Z(Nn),e(y),l(()=>Nn(e(y).baseType,e(y))?.label||"Unknown")),()=>(e(y),l(()=>e(y).x.toFixed(1))),()=>(e(y),l(()=>e(y).y.toFixed(1)))]),X("change",xn,Ze=>je(e(y).id,Ze.target.value)),Sn(G,()=>e(D),Ze=>v(D,Ze)),X("click",xt,$e),M(Kt,Wt)},Ut=Kt=>{var Wt=Jd();M(Kt,Wt)};ee(gt,Kt=>{e(y)?Kt(Qt):Kt(Ut,!1)},!0)}M(Oe,Qe)};ee(Ne,Oe=>{e(N),l(()=>e(N).length>1)?Oe(Ye):Oe(Ue,!1)})}M(P,re)},$$slots:{default:!0}});var Fn=b(Ft,2);cn(Fn,{title:"Measure Tool",children:(P,Q)=>{var re=ah(),Ne=x(re),Ye=x(Ne),Ue=x(Ye),Oe=b(Ne,2);{var Qe=Mt=>{var Yt=eh();M(Mt,Yt)};ee(Oe,Mt=>{e(Me)&&Mt(Qe)})}var gt=b(Oe,2);{var Qt=Mt=>{var Yt=th(),yn=_e(Yt),pn=b(x(yn),2),_n=x(pn),In=b(yn,2);q(En=>ke(_n,`${En??""}"`),[()=>(e(T),l(()=>Dt(e(T).x1,e(T).y1,e(T).x2,e(T).y2).toFixed(2)))]),X("click",In,()=>{v(U,e(U).filter(En=>En.id!==e(V))),v(V,null)}),M(Mt,Yt)};ee(gt,Mt=>{e(T)&&Mt(Qt)})}var Ut=b(gt,2);{var Kt=Mt=>{var Yt=nh(),yn=_e(Yt),pn=b(x(yn),2),_n=x(pn),In=b(yn,2);q(()=>ke(_n,`${e(U),l(()=>e(U).length)??""} line${e(U),l(()=>e(U).length!==1?"s":"")??""}`)),X("click",In,en),M(Mt,Yt)};ee(Ut,Mt=>{e(U),l(()=>e(U).length>0)&&Mt(Kt)})}var Wt=b(Ut,2),nn=b(x(Wt),2),xn=x(nn),fn=b(nn,2),Zt=x(fn);Sn(Ue,()=>e(Me),Mt=>v(Me,Mt)),Sn(xn,()=>e(dt),Mt=>v(dt,Mt)),Sn(Zt,()=>e(fe),Mt=>v(fe,Mt)),M(P,re)},$$slots:{default:!0}});var tn=b(Fn,2);cn(tn,{title:"Actions",children:(P,Q)=>{var re=sh(),Ne=x(re),Ye=x(Ne),Ue=b(Ye,2);q(()=>{Ye.disabled=(s(),l(()=>!s().past.length)),Ue.disabled=(s(),l(()=>!s().future.length))}),X("click",Ye,()=>yt.undo()),X("click",Ue,()=>yt.redo()),M(P,re)},$$slots:{default:!0}});var ra=b(ze,2),ia=x(ra),Qn=x(ia),ns=x(Qn);lr(ns,{children:kr,$$slots:{default:(P,Q)=>{const re=Ie(()=>Q.screenToSvg);var Ne=Ch(),Ye=_e(Ne);{var Ue=We=>{var B=fi();q(()=>ke(B,(e(R),Z(e(re)),l(()=>(v(R,e(re)),""))))),M(We,B)};ee(Ye,We=>{e(re)&&!e(R)&&We(Ue)})}var Oe=b(Ye);{var Qe=We=>{var B=oh(),bt=_e(B);He(bt,1,()=>(i(),l(()=>i().zones)),ot,(G,Se)=>{var Gt=rh();q(Jt=>{f(Gt,"d",Jt),f(Gt,"stroke",(e(Se),l(()=>e(Se).borderColor)))},[()=>(Z(tr),e(Se),l(()=>tr(e(Se).path)))]),M(G,Gt)});var Tt=b(bt);He(Tt,1,()=>(i(),l(()=>i().objectives)),ot,(G,Se)=>{const Gt=Ie(()=>(e(Se),l(()=>e(Se).isPrimary?"#fbbf24":"#9ca3af"))),Jt=Ie(()=>(e(Se),l(()=>e(Se).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var vt=ih(),xt=_e(vt),Ze=b(xt),S=b(Ze);q(()=>{f(xt,"cx",(e(Se),l(()=>e(Se).x))),f(xt,"cy",(e(Se),l(()=>e(Se).y))),f(xt,"r",xi),f(xt,"fill",e(Jt)),f(xt,"stroke",e(Gt)),f(Ze,"cx",(e(Se),l(()=>e(Se).x))),f(Ze,"cy",(e(Se),l(()=>e(Se).y))),f(Ze,"r",Ti),f(Ze,"fill",e(Gt)),f(S,"cx",(e(Se),l(()=>e(Se).x))),f(S,"cy",(e(Se),l(()=>e(Se).y)))}),M(G,vt)}),M(We,B)};ee(Oe,We=>{i()&&We(Qe)})}var gt=b(Oe);He(gt,1,()=>(r(),l(()=>r().terrains)),ot,(We,B)=>{var bt=lh(),Tt=x(bt);q(()=>{f(bt,"transform",`rotate(${e(B),l(()=>e(B).rotation)??""}, ${e(B),l(()=>e(B).x+e(B).width/2)??""}, ${e(B),l(()=>e(B).y+e(B).height/2)??""})`),f(Tt,"x",(e(B),l(()=>e(B).x))),f(Tt,"y",(e(B),l(()=>e(B).y))),f(Tt,"width",(e(B),l(()=>e(B).width))),f(Tt,"height",(e(B),l(()=>e(B).height)))}),M(We,bt)});var Qt=b(gt);He(Qt,1,()=>(r(),l(()=>r().walls)),ot,(We,B)=>{var bt=ch(),Tt=x(bt);Pr(Tt,{get id(){return e(B),l(()=>e(B).id)},get x(){return e(B),l(()=>e(B).x)},get y(){return e(B),l(()=>e(B).y)},get shape(){return e(B),l(()=>e(B).shape)},get segments(){return e(B),l(()=>e(B).segments)},get rotation(){return e(B),l(()=>e(B).rotation)},selected:!1,get screenToSvg(){return e(re)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),M(We,bt)});var Ut=b(Qt);{var Kt=We=>{var B=_t(),bt=_e(B);He(bt,1,a,Tt=>Tt.id,(Tt,G)=>{const Se=Ie(()=>(Z(Nn),e(G),l(()=>Nn(e(G).baseType,e(G))))),Gt=Ie(()=>(Z(An),e(G),l(()=>An(e(G).baseType)))),Jt=Ie(()=>(Z(_a),e(G),l(()=>_a(e(G).baseType)))),vt=Ie(()=>(e(G),l(()=>e(G).playerId===1?"rgba(59, 130, 246, 0.15)":"rgba(239, 68, 68, 0.15)"))),xt=Ie(()=>(e(G),l(()=>e(G).playerId===1?"#3b82f6":"#ef4444")));var Ze=ph(),S=_e(Ze);{var W=ie=>{var le=_t(),ue=_e(le);{var Ae=Je=>{var tt=uh(),rt=x(tt);q(()=>{f(tt,"transform",`rotate(${e(G),l(()=>e(G).rotation||0)??""}, ${e(G),l(()=>e(G).x)??""}, ${e(G),l(()=>e(G).y)??""})`),f(rt,"x",(e(G),l(()=>e(G).x-e(G).customWidth/2-9))),f(rt,"y",(e(G),l(()=>e(G).y-e(G).customHeight/2-9))),f(rt,"width",(e(G),l(()=>e(G).customWidth+18))),f(rt,"height",(e(G),l(()=>e(G).customHeight+18))),f(rt,"fill",e(vt)),f(rt,"stroke",e(xt))}),M(Je,tt)},Fe=Je=>{var tt=_t(),rt=_e(tt);{var Vt=$t=>{var Pt=mh(),sn=x(Pt);q(()=>{f(Pt,"transform",`rotate(${e(G),l(()=>e(G).rotation||0)??""}, ${e(G),l(()=>e(G).x)??""}, ${e(G),l(()=>e(G).y)??""})`),f(sn,"cx",(e(G),l(()=>e(G).x))),f(sn,"cy",(e(G),l(()=>e(G).y))),f(sn,"rx",(Z(e(Se)),l(()=>e(Se).width/2+9))),f(sn,"ry",(Z(e(Se)),l(()=>e(Se).height/2+9))),f(sn,"fill",e(vt)),f(sn,"stroke",e(xt))}),M($t,Pt)},an=$t=>{var Pt=dh();q(()=>{f(Pt,"cx",(e(G),l(()=>e(G).x))),f(Pt,"cy",(e(G),l(()=>e(G).y))),f(Pt,"r",(Z(e(Se)),l(()=>e(Se).radius+9))),f(Pt,"fill",e(vt)),f(Pt,"stroke",e(xt))}),M($t,Pt)};ee(rt,$t=>{e(Gt)?$t(Vt):$t(an,!1)},!0)}M(Je,tt)};ee(ue,Je=>{e(Jt)?Je(Ae):Je(Fe,!1)})}M(ie,le)};ee(S,ie=>{e(fe)&&ie(W)})}var F=b(S);{var j=ie=>{var le=_t(),ue=_e(le);{var Ae=Je=>{var tt=hh(),rt=x(tt);q(()=>{f(tt,"transform",`rotate(${e(G),l(()=>e(G).rotation||0)??""}, ${e(G),l(()=>e(G).x)??""}, ${e(G),l(()=>e(G).y)??""})`),f(rt,"x",(e(G),l(()=>e(G).x-e(G).customWidth/2-6))),f(rt,"y",(e(G),l(()=>e(G).y-e(G).customHeight/2-6))),f(rt,"width",(e(G),l(()=>e(G).customWidth+12))),f(rt,"height",(e(G),l(()=>e(G).customHeight+12))),f(rt,"stroke",e(xt))}),M(Je,tt)},Fe=Je=>{var tt=_t(),rt=_e(tt);{var Vt=$t=>{var Pt=fh(),sn=x(Pt);q(()=>{f(Pt,"transform",`rotate(${e(G),l(()=>e(G).rotation||0)??""}, ${e(G),l(()=>e(G).x)??""}, ${e(G),l(()=>e(G).y)??""})`),f(sn,"cx",(e(G),l(()=>e(G).x))),f(sn,"cy",(e(G),l(()=>e(G).y))),f(sn,"rx",(Z(e(Se)),l(()=>e(Se).width/2+6))),f(sn,"ry",(Z(e(Se)),l(()=>e(Se).height/2+6))),f(sn,"stroke",e(xt))}),M($t,Pt)},an=$t=>{var Pt=yh();q(()=>{f(Pt,"cx",(e(G),l(()=>e(G).x))),f(Pt,"cy",(e(G),l(()=>e(G).y))),f(Pt,"r",(Z(e(Se)),l(()=>e(Se).radius+6))),f(Pt,"stroke",e(xt))}),M($t,Pt)};ee(rt,$t=>{e(Gt)?$t(Vt):$t(an,!1)},!0)}M(Je,tt)};ee(ue,Je=>{e(Jt)?Je(Ae):Je(Fe,!1)})}M(ie,le)};ee(F,ie=>{e(dt)&&ie(j)})}M(Tt,Ze)}),M(We,B)};ee(Ut,We=>{(e(dt)||e(fe))&&We(Kt)})}var Wt=b(Ut);He(Wt,1,a,We=>We.id,(We,B)=>{{let bt=Ie(()=>(e(B),l(()=>e(B).name||""))),Tt=Ie(()=>(e(N),e(B),l(()=>e(N).includes(e(B).id)))),G=Ie(()=>(e(N),e(B),l(()=>e(N).length>1&&e(N).includes(e(B).id)))),Se=Ie(()=>(e(N),e(B),e(he),l(()=>!e(N).includes(e(B).id)&&e(he).has(e(B).id))));nr(We,{get id(){return e(B),l(()=>e(B).id)},get x(){return e(B),l(()=>e(B).x)},get y(){return e(B),l(()=>e(B).y)},get baseType(){return e(B),l(()=>e(B).baseType)},get playerId(){return e(B),l(()=>e(B).playerId)},get rotation(){return e(B),l(()=>e(B).rotation)},get name(){return e(bt)},get customWidth(){return e(B),l(()=>e(B).customWidth)},get customHeight(){return e(B),l(()=>e(B).customHeight)},get selected(){return e(Tt)},get inGroupSelection(){return e(G)},get marqueePreview(){return e(Se)},get screenToSvg(){return e(re)},onSelect:Cn,onDrag:qe,onDragEnd:Ge,onRotate:at,onRotateEnd:qt,onRename:je})}});var nn=b(Wt);{var xn=We=>{var B=vh(),bt=_e(B),Tt=b(bt),G=b(Tt),Se=b(G);q(()=>{f(bt,"cx",(e(u),l(()=>e(u).x))),f(bt,"cy",(e(u),l(()=>e(u).y))),f(Tt,"x1",(e(u),l(()=>e(u).x))),f(Tt,"y1",(e(u),l(()=>e(u).y))),f(Tt,"x2",e(g)),f(Tt,"y2",e(_)),f(G,"cx",e(g)),f(G,"cy",e(_)),f(Se,"transform",`translate(${e(g)??""}, ${e(_)??""})`)}),X("mousedown",G,I),M(We,B)};ee(nn,We=>{e(u),e(m),l(()=>e(u)&&e(m).length>1)&&We(xn)})}var fn=b(nn);He(fn,1,()=>e(U),We=>We.id,(We,B)=>{const bt=Ie(()=>(e(B),l(()=>Dt(e(B).x1,e(B).y1,e(B).x2,e(B).y2)))),Tt=Ie(()=>(e(B),l(()=>(e(B).x1+e(B).x2)/2))),G=Ie(()=>(e(B),l(()=>(e(B).y1+e(B).y2)/2))),Se=Ie(()=>(e(B),e(V),l(()=>e(B).id===e(V))));var Gt=bh();let Jt;var vt=x(Gt),xt=b(vt);{var Ze=j=>{var ie=gh(),le=_e(ie),ue=b(le);q(()=>{f(le,"cx",(e(B),l(()=>e(B).x1))),f(le,"cy",(e(B),l(()=>e(B).y1))),f(le,"fill",e(Se)?"#3b82f6":"#f59e0b"),f(ue,"cx",(e(B),l(()=>e(B).x2))),f(ue,"cy",(e(B),l(()=>e(B).y2))),f(ue,"fill",e(Se)?"#3b82f6":"#f59e0b")}),X("mousedown",le,Ae=>Et(e(B).id,1,Ae)),X("mousedown",ue,Ae=>Et(e(B).id,2,Ae)),M(j,ie)};ee(xt,j=>{e(Me)&&j(Ze)})}var S=b(xt),W=b(x(S)),F=x(W);q(j=>{Jt=gn(Gt,0,"measurement-line",null,Jt,{selected:e(Se),"tool-active":e(Me)}),f(vt,"x1",(e(B),l(()=>e(B).x1))),f(vt,"y1",(e(B),l(()=>e(B).y1))),f(vt,"x2",(e(B),l(()=>e(B).x2))),f(vt,"y2",(e(B),l(()=>e(B).y2))),f(vt,"stroke",e(Se)&&e(Me)?"#3b82f6":"#f59e0b"),f(vt,"stroke-width",e(Se)&&e(Me)?.2:.15),f(vt,"role",e(Me)?"button":"presentation"),f(vt,"tabindex",e(Me)?0:-1),f(S,"transform",`translate(${e(Tt)??""}, ${e(G)??""})`),f(W,"fill",e(Se)&&e(Me)?"#3b82f6":"#f59e0b"),ke(F,`${j??""}"`)},[()=>(Z(e(bt)),l(()=>e(bt).toFixed(1)))]),X("click",vt,j=>e(Me)&&it(e(B).id,j)),X("mousedown",vt,j=>e(Me)?Ve(e(B).id,j):j.stopPropagation()),M(We,Gt)});var Zt=b(fn);{var Mt=We=>{const B=Ie(()=>(e(Y),e(ve),l(()=>Dt(e(Y).x,e(Y).y,e(ve).x,e(ve).y)))),bt=Ie(()=>(e(Y),e(ve),l(()=>(e(Y).x+e(ve).x)/2))),Tt=Ie(()=>(e(Y),e(ve),l(()=>(e(Y).y+e(ve).y)/2)));var G=xh(),Se=x(G),Gt=b(Se),Jt=b(Gt),vt=b(Jt);{var xt=Ze=>{var S=Th(),W=b(x(S)),F=x(W);q(j=>{f(S,"transform",`translate(${e(bt)??""}, ${e(Tt)??""})`),ke(F,`${j??""}"`)},[()=>(Z(e(B)),l(()=>e(B).toFixed(1)))]),M(Ze,S)};ee(vt,Ze=>{e(B)>.5&&Ze(xt)})}q(()=>{f(Se,"x1",(e(Y),l(()=>e(Y).x))),f(Se,"y1",(e(Y),l(()=>e(Y).y))),f(Se,"x2",(e(ve),l(()=>e(ve).x))),f(Se,"y2",(e(ve),l(()=>e(ve).y))),f(Gt,"cx",(e(Y),l(()=>e(Y).x))),f(Gt,"cy",(e(Y),l(()=>e(Y).y))),f(Jt,"cx",(e(ve),l(()=>e(ve).x))),f(Jt,"cy",(e(ve),l(()=>e(ve).y)))}),M(We,G)};ee(Zt,We=>{e(xe)&&e(Y)&&e(ve)&&We(Mt)})}var Yt=b(Zt);{var yn=We=>{var B=_t(),bt=_e(B);He(bt,1,()=>e(A),ot,(Tt,G)=>{var Se=_t(),Gt=_e(Se);He(Gt,1,()=>(e(G),l(()=>e(G).rays)),ot,(Jt,vt)=>{var xt=_h();q(()=>{f(xt,"x1",(e(vt),l(()=>e(vt).from.x))),f(xt,"y1",(e(vt),l(()=>e(vt).from.y))),f(xt,"x2",(e(vt),l(()=>e(vt).to.x))),f(xt,"y2",(e(vt),l(()=>e(vt).to.y))),f(xt,"stroke",(e(vt),l(()=>e(vt).blocked?"#ff000033":"#00ff0033")))}),M(Jt,xt)}),M(Tt,Se)}),M(We,B)};ee(Yt,We=>{e(C),e(D),e(m),e(A),l(()=>e(C)&&e(D)&&e(m).length>0&&e(A).length>0)&&We(yn)})}var pn=b(Yt);{var _n=We=>{var B=_t(),bt=_e(B);He(bt,1,()=>e(A),ot,(Tt,G)=>{var Se=_t(),Gt=_e(Se);{var Jt=xt=>{var Ze=wh();q(()=>{f(Ze,"x1",(e(G),l(()=>e(G).firstClearRay.from.x))),f(Ze,"y1",(e(G),l(()=>e(G).firstClearRay.from.y))),f(Ze,"x2",(e(G),l(()=>e(G).firstClearRay.to.x))),f(Ze,"y2",(e(G),l(()=>e(G).firstClearRay.to.y)))}),M(xt,Ze)},vt=xt=>{var Ze=Sh();q(()=>{f(Ze,"x1",(e(G),l(()=>e(G).source.x))),f(Ze,"y1",(e(G),l(()=>e(G).source.y))),f(Ze,"x2",(e(G),l(()=>e(G).target.x))),f(Ze,"y2",(e(G),l(()=>e(G).target.y)))}),M(xt,Ze)};ee(Gt,xt=>{e(G),l(()=>e(G).firstClearRay)?xt(Jt):xt(vt,!1)})}M(Tt,Se)}),M(We,B)};ee(pn,We=>{e(D),e(m),e(A),l(()=>e(D)&&e(m).length>0&&e(A).length>0)&&We(_n)})}var In=b(pn);{var En=We=>{const B=Ie(()=>(e(H),e(oe),l(()=>Math.min(e(H).x,e(oe).x)))),bt=Ie(()=>(e(H),e(oe),l(()=>Math.min(e(H).y,e(oe).y)))),Tt=Ie(()=>(e(oe),e(H),l(()=>Math.abs(e(oe).x-e(H).x)))),G=Ie(()=>(e(oe),e(H),l(()=>Math.abs(e(oe).y-e(H).y))));var Se=Ah();q(()=>{f(Se,"x",e(B)),f(Se,"y",e(bt)),f(Se,"width",e(Tt)),f(Se,"height",e(G))}),M(We,Se)};ee(In,We=>{e($)&&e(H)&&e(oe)&&We(En)})}M(P,Ne)}}});var as=b(Qn,2),hn=x(as),Zn=x(hn);q(()=>ke(Zn,`Battlefield: 60" x 44" | ${o(),l(()=>o().length)??""} P1 models | ${c(),l(()=>c().length)??""} P2 models`)),X("mousedown",Qn,dn),M(t,ft),Hn(),h()}var Rh=pe("<span> </span>"),kh=pe('<span class="los-status svelte-12aohay">No enemies</span>'),Lh=pe('<div class="controls svelte-12aohay"><label class="svelte-12aohay"><input type="checkbox" class="svelte-12aohay"/> Show debug rays</label> <!></div>'),Dh=pe('<button class="svelte-12aohay"> </button>'),Ih=pe('<div class="button-group svelte-12aohay"></div>'),$h=pe('<button class="svelte-12aohay"> </button>'),Ph=pe('<div class="button-group svelte-12aohay"></div>'),Nh=pe('<div class="player-toggle svelte-12aohay"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-12aohay"><div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Circles</h4> <div class="palette-grid svelte-12aohay"></div></div> <div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Ovals</h4> <div class="palette-grid svelte-12aohay"></div></div></div>',1),Oh=ge('<line stroke-width="0.05"></line>'),Wh=ge('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),Yh=ge('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),Hh=ge("<!><!><!><!><!><!><!>",1),Fh=pe('<p class="svelte-12aohay"> </p>'),Bh=pe('<main class="svelte-12aohay"><div class="layout svelte-12aohay"><div class="sidebar svelte-12aohay"><!> <!> <!> <!></div> <div class="battlefield-area svelte-12aohay"><div class="battlefield-container svelte-12aohay"><!></div> <div class="info svelte-12aohay"><p class="svelte-12aohay"> </p> <!> <p class="hint svelte-12aohay">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function qh(t,n){Yn(n,!1);const a=()=>Lt(Ga,"$debugModels",h),r=()=>Lt(ls,"$debugSelectedModelId",h),s=()=>Lt(hr,"$debugTerrains",h),i=()=>Lt(fr,"$debugWalls",h),o=()=>Lt(Fi,"$debugMode",h),c=()=>Lt(yr,"$debugSelectedTerrainId",h),d=()=>Lt(pr,"$debugSelectedWallId",h),[h,m]=qs(),y=O(),u=O(),p=O(),g=O(),_=O();function T(ae,Le){hr.add(ae,Le)}function E(ae){fr.add(ae)}function k(ae){yr.set(ae),pr.set(null),ls.set(null)}function L(ae){pr.set(ae),yr.set(null),ls.set(null)}function w(ae,Le,Ve){hr.updateTerrain(ae,{x:Le,y:Ve})}function A(ae,Le,Ve){fr.updateWall(ae,{x:Le,y:Ve})}function R(ae,Le){hr.updateTerrain(ae,{rotation:Le})}function D(ae,Le){fr.updateWall(ae,{rotation:Le})}let C=O(1),$=O(null),H=!1,oe=null,N=O(null);const he=5;xs(()=>{if(a().length===0){const ae=Ga.add("32mm",1,10,22);Ga.add("32mm",2,50,22),ls.set(ae)}});function we(ae,Le){if(!e(N))return;H=!0,oe={x:Le.clientX,y:Le.clientY};const Ve=e(N)(Le.clientX,Le.clientY);v($,{baseType:ae.type,x:Ve.x,y:Ve.y}),window.addEventListener("mousemove",ne),window.addEventListener("mouseup",se)}function ne(ae){if(!H||!e($)||!e(N))return;const Le=e(N)(ae.clientX,ae.clientY);v($,{...e($),x:Le.x,y:Le.y})}function se(ae){if(!H||!e($)){H=!1,v($,null),oe=null,window.removeEventListener("mousemove",ne),window.removeEventListener("mouseup",se);return}const Le=ae.clientX-oe.x,Ve=ae.clientY-oe.y,Et=Math.sqrt(Le*Le+Ve*Ve);let St,It;Et<he?(St=30,It=22):(St=e($).x,It=e($).y);const en=Ga.add(e($).baseType,e(C),St,It);ls.set(en),v($,null),H=!1,oe=null,window.removeEventListener("mousemove",ne),window.removeEventListener("mouseup",se)}function ce(ae){ls.set(ae),yr.set(null),pr.set(null)}function be(ae,Le,Ve){Ga.updateModel(ae,{x:Le,y:Ve},!0)}function De(ae,Le,Ve,Et,St){ei.push({type:"move",modelId:ae,before:{x:Le,y:Ve},after:{x:Et,y:St}})}function J(ae,Le){Ga.updateModel(ae,{rotation:Le},!0)}function U(ae,Le,Ve){ei.push({type:"rotate",modelId:ae,before:{rotation:Le},after:{rotation:Ve}})}function V(ae,Le){Ga.updateModel(ae,{name:Le})}function xe(ae){const Le=Nn(ae.baseType);return An(ae.baseType)?{x:ae.x,y:ae.y,rx:Le.width/2,ry:Le.height/2,rotation:ae.rotation||0}:{x:ae.x,y:ae.y,radius:Le.radius}}ye(()=>(a(),r()),()=>{v(y,a().find(ae=>ae.id===r()))}),ye(()=>(e(y),a()),()=>{v(u,e(y)?a().filter(ae=>ae.playerId!==e(y).playerId):[])}),ye(()=>(s(),bs),()=>{v(p,s().map(ae=>({id:ae.id,vertices:bs(ae)})))}),ye(()=>(i(),es),()=>{v(g,i().map(ae=>$r(es(ae.shape,ae.segments),ae.x,ae.y,ae.rotation)))}),ye(()=>(e(y),e(u),e(p),e(g)),()=>{v(_,e(y)&&e(u).length>0?e(u).map(ae=>{const Le=vi(xe(ae),xe(e(y)),e(p),e(g));return{viewerId:ae.id,viewer:ae,canSee:Le.canSee,firstClearRay:Le.firstClearRay,rays:Le.rays}}):[])}),Ea(),jn();var Y=Bh(),ve=x(Y),Me=x(ve),dt=x(Me);cn(dt,{title:"LOS Debug",children:(ae,Le)=>{var Ve=Lh(),Et=x(Ve),St=x(Et),It=b(Et,2);{var en=Xt=>{var on=Rh();let Cn;var qe=x(on);q((Ge,at)=>{Cn=gn(on,1,"los-status svelte-12aohay",null,Cn,Ge),ke(qe,`${at??""}/${e(_),l(()=>e(_).length)??""} visible`)},[()=>({"can-see":e(_).some(Ge=>Ge.canSee),blocked:!e(_).some(Ge=>Ge.canSee)}),()=>(e(_),l(()=>e(_).filter(Ge=>Ge.canSee).length))]),M(Xt,on)},dn=Xt=>{var on=kh();M(Xt,on)};ee(It,Xt=>{e(y),e(_),l(()=>e(y)&&e(_).length>0)?Xt(en):Xt(dn,!1)})}Sn(St,o,Xt=>$c(Fi,Xt)),M(ae,Ve)},$$slots:{default:!0}});var fe=b(dt,2);cn(fe,{title:"Add Terrain",defaultOpen:!1,children:(ae,Le)=>{var Ve=Ih();He(Ve,5,()=>Xo,ot,(Et,St)=>{var It=Dh(),en=x(It);q(()=>ke(en,(e(St),l(()=>e(St).label)))),X("click",It,()=>T(e(St).width,e(St).height)),M(Et,It)}),M(ae,Ve)},$$slots:{default:!0}});var te=b(fe,2);cn(te,{title:"Add Wall",defaultOpen:!1,children:(ae,Le)=>{var Ve=Ph();He(Ve,5,()=>Zr,ot,(Et,St)=>{var It=$h(),en=x(It);q(()=>ke(en,(e(St),l(()=>e(St).label)))),X("click",It,()=>E(e(St).shape)),M(Et,It)}),M(ae,Ve)},$$slots:{default:!0}});var Ke=b(te,2);cn(Ke,{title:"Add Models",defaultOpen:!1,children:(ae,Le)=>{var Ve=Nh(),Et=_e(Ve),St=x(Et);let It;var en=b(St,2);let dn;var Xt=b(Et,2),on=x(Xt),Cn=b(x(on),2);He(Cn,5,()=>(Z(Xn),l(()=>Xn.circles)),ot,(at,qt)=>{Mr(at,{get baseSize(){return e(qt)},get playerId(){return e(C)},onDragStart:we})});var qe=b(on,2),Ge=b(x(qe),2);He(Ge,5,()=>(Z(Xn),l(()=>Xn.ovals)),ot,(at,qt)=>{Mr(at,{get baseSize(){return e(qt)},get playerId(){return e(C)},onDragStart:we})}),q(()=>{It=gn(St,1,"toggle-btn svelte-12aohay",null,It,{active:e(C)===1}),dn=gn(en,1,"toggle-btn svelte-12aohay",null,dn,{active:e(C)===2})}),X("click",St,()=>v(C,1)),X("click",en,()=>v(C,2)),M(ae,Ve)},$$slots:{default:!0}});var Ce=b(Me,2),Dt=x(Ce),lt=x(Dt);lr(lt,{children:kr,$$slots:{default:(ae,Le)=>{const Ve=Ie(()=>Le.screenToSvg);var Et=Hh(),St=_e(Et);{var It=je=>{var I=fi();q(()=>ke(I,(e(N),Z(e(Ve)),l(()=>(v(N,e(Ve)),""))))),M(je,I)};ee(St,je=>{e(Ve)&&!e(N)&&je(It)})}var en=b(St);{var dn=je=>{var I=_t(),me=_e(I);He(me,1,()=>e(_),ot,(Te,$e)=>{var Pe=_t(),st=_e(Pe);He(st,1,()=>(e($e),l(()=>e($e).rays)),ot,(ft,Ee)=>{var ze=Oh();q(()=>{f(ze,"x1",(e(Ee),l(()=>e(Ee).from.x))),f(ze,"y1",(e(Ee),l(()=>e(Ee).from.y))),f(ze,"x2",(e(Ee),l(()=>e(Ee).to.x))),f(ze,"y2",(e(Ee),l(()=>e(Ee).to.y))),f(ze,"stroke",(e(Ee),l(()=>e(Ee).blocked?"#ff000033":"#00ff0033")))}),M(ft,ze)}),M(Te,Pe)}),M(je,I)};ee(en,je=>{o(),e(y),e(_),l(()=>o()&&e(y)&&e(_).length>0)&&je(dn)})}var Xt=b(en);He(Xt,1,s,je=>je.id,(je,I)=>{{let me=Ie(()=>(e(I),c(),l(()=>e(I).id===c())));Go(je,{get id(){return e(I),l(()=>e(I).id)},get x(){return e(I),l(()=>e(I).x)},get y(){return e(I),l(()=>e(I).y)},get width(){return e(I),l(()=>e(I).width)},get height(){return e(I),l(()=>e(I).height)},get rotation(){return e(I),l(()=>e(I).rotation)},get selected(){return e(me)},get screenToSvg(){return e(Ve)},onSelect:k,onDrag:w,onRotate:R})}});var on=b(Xt);He(on,1,i,je=>je.id,(je,I)=>{{let me=Ie(()=>(e(I),d(),l(()=>e(I).id===d())));Pr(je,{get id(){return e(I),l(()=>e(I).id)},get x(){return e(I),l(()=>e(I).x)},get y(){return e(I),l(()=>e(I).y)},get shape(){return e(I),l(()=>e(I).shape)},get segments(){return e(I),l(()=>e(I).segments)},get rotation(){return e(I),l(()=>e(I).rotation)},get selected(){return e(me)},get screenToSvg(){return e(Ve)},onSelect:L,onDrag:A,onRotate:D})}});var Cn=b(on);He(Cn,1,a,je=>je.id,(je,I)=>{{let me=Ie(()=>(e(I),l(()=>e(I).name||""))),Te=Ie(()=>(e(I),r(),l(()=>e(I).id===r())));nr(je,{get id(){return e(I),l(()=>e(I).id)},get x(){return e(I),l(()=>e(I).x)},get y(){return e(I),l(()=>e(I).y)},get baseType(){return e(I),l(()=>e(I).baseType)},get playerId(){return e(I),l(()=>e(I).playerId)},get rotation(){return e(I),l(()=>e(I).rotation)},get name(){return e(me)},get selected(){return e(Te)},get screenToSvg(){return e(Ve)},onSelect:ce,onDrag:be,onDragEnd:De,onRotate:J,onRotateEnd:U,onRename:V})}});var qe=b(Cn);{var Ge=je=>{var I=_t(),me=_e(I);He(me,1,()=>e(_),ot,(Te,$e)=>{var Pe=_t(),st=_e(Pe);{var ft=ze=>{var Ft=Wh();q(()=>{f(Ft,"x1",(e($e),l(()=>e($e).firstClearRay.from.x))),f(Ft,"y1",(e($e),l(()=>e($e).firstClearRay.from.y))),f(Ft,"x2",(e($e),l(()=>e($e).firstClearRay.to.x))),f(Ft,"y2",(e($e),l(()=>e($e).firstClearRay.to.y)))}),M(ze,Ft)},Ee=ze=>{var Ft=Yh();q(()=>{f(Ft,"x1",(e(y),l(()=>e(y).x))),f(Ft,"y1",(e(y),l(()=>e(y).y))),f(Ft,"x2",(e($e),l(()=>e($e).target.x))),f(Ft,"y2",(e($e),l(()=>e($e).target.y)))}),M(ze,Ft)};ee(st,ze=>{e($e),l(()=>e($e).firstClearRay)?ze(ft):ze(Ee,!1)})}M(Te,Pe)}),M(je,I)};ee(qe,je=>{o(),e(y),e(_),l(()=>o()&&e(y)&&e(_).length>0)&&je(Ge)})}var at=b(qe);{var qt=je=>{nr(je,{id:"phantom",get x(){return e($),l(()=>e($).x)},get y(){return e($),l(()=>e($).y)},get baseType(){return e($),l(()=>e($).baseType)},get playerId(){return e(C)},rotation:0,selected:!1,get screenToSvg(){return e(Ve)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};ee(at,je=>{e($)&&je(qt)})}M(ae,Et)}}});var nt=b(Dt,2),ct=x(nt),it=x(ct),ht=b(ct,2);{var Rt=ae=>{var Le=Fh(),Ve=x(Le);q(Et=>ke(Ve,`Selected model LOS: ${Et??""}/${e(_),l(()=>e(_).length)??""} visible`),[()=>(e(_),l(()=>e(_).filter(Et=>Et.canSee).length))]),M(ae,Le)};ee(ht,ae=>{o(),e(y),e(_),l(()=>o()&&e(y)&&e(_).length>0)&&ae(Rt)})}q(()=>ke(it,`Battlefield: 60" x 44" | ${s(),l(()=>s().length)??""} terrain | ${i(),l(()=>i().length)??""} walls | ${a(),l(()=>a().length)??""} models`)),M(t,Y),Hn(),m()}var Uh=pe(`<div class="app-header svelte-1n46o8q"><h1 class="app-title svelte-1n46o8q">Fu'llasso</h1> <nav class="nav-links svelte-1n46o8q"><a href="#/setup">Battlefield Setup</a> <a href="#/deployment">Deployment</a> <a href="#/battle">Battle</a> <a href="#/">Layout Builder</a></nav></div> <!> <footer class="app-footer svelte-1n46o8q"><span>Built with love by <a href="https://github.com/barkin-aygun/wh40k-deploy" target="_blank" rel="noopener noreferrer" class="svelte-1n46o8q">@Volfied</a></span> <span class="separator svelte-1n46o8q">|</span> <span class="disclaimer svelte-1n46o8q">Warhammer 40,000 and all associated marks, logos, and images are trademarks and/or copyrights of Games Workshop Ltd. This is an unofficial fan project and is not affiliated with or endorsed by Games Workshop.</span></footer>`,1);function Kh(t,n){Yn(n,!1);let a=O("main");function r(){const k=window.location.hash;k==="#/debug"?v(a,"debug"):k==="#/setup"?v(a,"setup"):k==="#/deployment"?v(a,"deployment"):k==="#/battle"?v(a,"battle"):k==="#/"||k==="#/layout"?v(a,"main"):v(a,"setup")}xs(()=>(r(),window.addEventListener("hashchange",r),()=>window.removeEventListener("hashchange",r))),jn();var s=Uh(),i=_e(s),o=b(x(i),2),c=x(o);let d;var h=b(c,2);let m;var y=b(h,2);let u;var p=b(y,2);let g;var _=b(i,2);{var T=k=>{qh(k,{})},E=k=>{var L=_t(),w=_e(L);{var A=D=>{rm(D,{})},R=D=>{var C=_t(),$=_e(C);{var H=N=>{Kd(N,{})},oe=N=>{var he=_t(),we=_e(he);{var ne=ce=>{Mh(ce,{})},se=ce=>{Wu(ce,{})};ee(we,ce=>{e(a)==="battle"?ce(ne):ce(se,!1)},!0)}M(N,he)};ee($,N=>{e(a)==="deployment"?N(H):N(oe,!1)},!0)}M(D,C)};ee(w,D=>{e(a)==="setup"?D(A):D(R,!1)},!0)}M(k,L)};ee(_,k=>{e(a)==="debug"?k(T):k(E,!1)})}q(()=>{d=gn(c,1,"svelte-1n46o8q",null,d,{active:e(a)==="setup"}),m=gn(h,1,"svelte-1n46o8q",null,m,{active:e(a)==="deployment"}),u=gn(y,1,"svelte-1n46o8q",null,u,{active:e(a)==="battle"}),g=gn(p,1,"svelte-1n46o8q",null,g,{active:e(a)==="main"})}),M(t,s),Hn()}bc(Kh,{target:document.getElementById("app")});
//# sourceMappingURL=index-BX9gMawH.js.map
