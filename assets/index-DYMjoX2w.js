(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=a(s);fetch(s.href,i)}})();const Ys=!1;var Va=Array.isArray,co=Array.prototype.indexOf,Ss=Array.from,Ur=Object.defineProperty,Vn=Object.getOwnPropertyDescriptor,Kr=Object.getOwnPropertyDescriptors,uo=Object.prototype,mo=Array.prototype,Js=Object.getPrototypeOf,vr=Object.isExtensible;const Nn=()=>{};function ho(e){return e()}function ys(e){for(var t=0;t<e.length;t++)e[t]()}function Gr(){var e,t,a=new Promise((r,s)=>{e=r,t=s});return{promise:a,resolve:e,reject:t}}const At=2,ps=4,Qa=8,zr=1<<24,Rn=16,Mn=32,sa=64,er=128,Zt=512,wt=1024,Rt=2048,fn=4096,qt=8192,Sn=16384,tr=32768,ba=65536,gr=1<<17,jr=1<<18,Aa=1<<19,Xr=1<<20,_n=1<<25,ta=32768,Hs=1<<21,nr=1<<22,$n=1<<23,wn=Symbol("$state"),fo=Symbol("legacy props"),yo=Symbol(""),da=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function ar(){throw new Error("https://svelte.dev/e/invalid_default_snippet")}function sr(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function po(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function vo(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function go(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function bo(e){throw new Error("https://svelte.dev/e/effect_orphan")}function To(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function xo(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function _o(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function So(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function wo(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Ao(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Co=1,Eo=2,Vr=4,Ro=8,Mo=16,ko=1,Do=2,Lo=4,Io=8,Po=16,Qr=1,No=2,St=Symbol(),$o="http://www.w3.org/1999/xhtml";function Oo(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Wo(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Zr(e){return e===this.v}function Jr(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function ei(e){return!Jr(e,this.v)}let Ca=!1,Yo=!1;function Ho(){Ca=!0}let at=null;function Ta(e){at=e}function Mt(e,t=!1,a){at={p:at,i:!1,c:null,e:null,s:e,x:null,l:Ca&&!t?{s:null,u:null,$:[]}:null}}function kt(e){var t=at,a=t.e;if(a!==null){t.e=null;for(var r of a)vi(r)}return e!==void 0&&(t.x=e),t.i=!0,at=t.p,e??{}}function Za(){return!Ca||at!==null&&at.l===null}let Xn=[];function ti(){var e=Xn;Xn=[],ys(e)}function Ea(e){if(Xn.length===0&&!Ba){var t=Xn;queueMicrotask(()=>{t===Xn&&ti()})}Xn.push(e)}function Bo(){for(;Xn.length>0;)ti()}function ni(e){var t=je;if(t===null)return Be.f|=$n,e;if((t.f&tr)===0){if((t.f&er)===0)throw e;t.b.error(e)}else xa(e,t)}function xa(e,t){for(;t!==null;){if((t.f&er)!==0)try{t.b.error(e);return}catch(a){e=a}t=t.parent}throw e}const Fo=-7169;function gt(e,t){e.f=e.f&Fo|t}function rr(e){(e.f&Zt)!==0||e.deps===null?gt(e,wt):gt(e,fn)}function ai(e){if(e!==null)for(const t of e)(t.f&At)===0||(t.f&ta)===0||(t.f^=ta,ai(t.deps))}function si(e,t,a){(e.f&Rt)!==0?t.add(e):(e.f&fn)!==0&&a.add(e),ai(e.deps),gt(e,wt)}const ss=new Set;let Ue=null,Ha=null,tn=null,Xt=[],ws=null,Bs=!1,Ba=!1;class mn{committed=!1;current=new Map;previous=new Map;#t=new Set;#i=new Set;#e=0;#s=0;#r=null;#a=new Set;#n=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#s>0}process(t){Xt=[],Ha=null,this.apply();var a=[],r=[];for(const s of t)this.#o(s,a,r);this.is_fork||this.#c(),this.is_deferred()?(this.#l(r),this.#l(a)):(Ha=this,Ue=null,br(r),br(a),Ha=null,this.#r?.resolve()),tn=null}#o(t,a,r){t.f^=wt;for(var s=t.first,i=null;s!==null;){var o=s.f,l=(o&(Mn|sa))!==0,c=l&&(o&wt)!==0,m=c||(o&qt)!==0||this.skipped_effects.has(s);if(!m&&s.fn!==null){l?s.f^=wt:i!==null&&(o&(ps|Qa|zr))!==0?i.b.defer_effect(s):(o&ps)!==0?a.push(s):Ma(s)&&((o&Rn)!==0&&this.#a.add(s),_a(s));var d=s.first;if(d!==null){s=d;continue}}var h=s.parent;for(s=s.next;s===null&&h!==null;)h===i&&(i=null),s=h.next,h=h.parent}}#l(t){for(var a=0;a<t.length;a+=1)si(t[a],this.#a,this.#n)}capture(t,a){a!==St&&!this.previous.has(t)&&this.previous.set(t,a),(t.f&$n)===0&&(this.current.set(t,t.v),tn?.set(t,t.v))}activate(){Ue=this,this.apply()}deactivate(){Ue===this&&(Ue=null,tn=null)}flush(){if(this.activate(),Xt.length>0){if(ri(),Ue!==null&&Ue!==this)return}else this.#e===0&&this.process([]);this.deactivate()}discard(){for(const t of this.#i)t(this);this.#i.clear()}#c(){if(this.#s===0){for(const t of this.#t)t();this.#t.clear()}this.#e===0&&this.#u()}#u(){if(ss.size>1){this.previous.clear();var t=tn,a=!0;for(const s of ss){if(s===this){a=!1;continue}const i=[];for(const[l,c]of this.current){if(s.current.has(l))if(a&&c!==s.current.get(l))s.current.set(l,c);else continue;i.push(l)}if(i.length===0)continue;const o=[...s.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var r=Xt;Xt=[];const l=new Set,c=new Map;for(const m of i)ii(m,o,l,c);if(Xt.length>0){Ue=s,s.apply();for(const m of Xt)s.#o(m,[],[]);s.deactivate()}Xt=r}}Ue=null,tn=t}this.committed=!0,ss.delete(this)}increment(t){this.#e+=1,t&&(this.#s+=1)}decrement(t){this.#e-=1,t&&(this.#s-=1),this.revive()}revive(){for(const t of this.#a)this.#n.delete(t),gt(t,Rt),En(t);for(const t of this.#n)gt(t,fn),En(t);this.flush()}oncommit(t){this.#t.add(t)}ondiscard(t){this.#i.add(t)}settled(){return(this.#r??=Gr()).promise}static ensure(){if(Ue===null){const t=Ue=new mn;ss.add(Ue),Ba||mn.enqueue(()=>{Ue===t&&t.flush()})}return Ue}static enqueue(t){Ea(t)}apply(){}}function qo(e){var t=Ba;Ba=!0;try{for(var a;;){if(Bo(),Xt.length===0&&(Ue?.flush(),Xt.length===0))return ws=null,a;ri()}}finally{Ba=t}}function ri(){var e=Zn;Bs=!0;var t=null;try{var a=0;for(gs(!0);Xt.length>0;){var r=mn.ensure();if(a++>1e3){var s,i;Uo()}r.process(Xt),On.clear()}}finally{Bs=!1,gs(e),ws=null}}function Uo(){try{To()}catch(e){xa(e,ws)}}let gn=null;function br(e){var t=e.length;if(t!==0){for(var a=0;a<t;){var r=e[a++];if((r.f&(Sn|qt))===0&&Ma(r)&&(gn=new Set,_a(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?xi(r):r.fn=null),gn?.size>0)){On.clear();for(const s of gn){if((s.f&(Sn|qt))!==0)continue;const i=[s];let o=s.parent;for(;o!==null;)gn.has(o)&&(gn.delete(o),i.push(o)),o=o.parent;for(let l=i.length-1;l>=0;l--){const c=i[l];(c.f&(Sn|qt))===0&&_a(c)}}gn.clear()}}gn=null}}function ii(e,t,a,r){if(!a.has(e)&&(a.add(e),e.reactions!==null))for(const s of e.reactions){const i=s.f;(i&At)!==0?ii(s,t,a,r):(i&(nr|Rn))!==0&&(i&Rt)===0&&oi(s,t,r)&&(gt(s,Rt),En(s))}}function oi(e,t,a){const r=a.get(e);if(r!==void 0)return r;if(e.deps!==null)for(const s of e.deps){if(t.includes(s))return!0;if((s.f&At)!==0&&oi(s,t,a))return a.set(s,!0),!0}return a.set(e,!1),!1}function En(e){for(var t=ws=e;t.parent!==null;){t=t.parent;var a=t.f;if(Bs&&t===je&&(a&Rn)!==0&&(a&jr)===0)return;if((a&(sa|Mn))!==0){if((a&wt)===0)return;t.f^=wt}}Xt.push(t)}function Ko(e){let t=0,a=na(0),r;return()=>{lr()&&(n(a),Ra(()=>(t===0&&(r=b(()=>e(()=>Fa(a)))),t+=1,()=>{Ea(()=>{t-=1,t===0&&(r?.(),r=void 0,Fa(a))})})))}}var Go=ba|Aa|er;function zo(e,t,a){new jo(e,t,a)}class jo{parent;is_pending=!1;#t;#i=null;#e;#s;#r;#a=null;#n=null;#o=null;#l=null;#c=null;#u=0;#m=0;#h=!1;#f=new Set;#y=new Set;#d=null;#T=Ko(()=>(this.#d=na(this.#u),()=>{this.#d=null}));constructor(t,a,r){this.#t=t,this.#e=a,this.#s=r,this.parent=je.b,this.is_pending=!!this.#e.pending,this.#r=cr(()=>{je.b=this;{var s=this.#g();try{this.#a=Vt(()=>r(s))}catch(i){this.error(i)}this.#m>0?this.#v():this.is_pending=!1}return()=>{this.#c?.remove()}},Go)}#x(){try{this.#a=Vt(()=>this.#s(this.#t))}catch(t){this.error(t)}}#_(){const t=this.#e.pending;t&&(this.#n=Vt(()=>t(this.#t)),mn.enqueue(()=>{var a=this.#g();this.#a=this.#p(()=>(mn.ensure(),Vt(()=>this.#s(a)))),this.#m>0?this.#v():(Qn(this.#n,()=>{this.#n=null}),this.is_pending=!1)}))}#g(){var t=this.#t;return this.is_pending&&(this.#c=An(),this.#t.before(this.#c),t=this.#c),t}defer_effect(t){si(t,this.#f,this.#y)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#e.pending}#p(t){var a=je,r=Be,s=at;hn(this.#r),Lt(this.#r),Ta(this.#r.ctx);try{return t()}catch(i){return ni(i),null}finally{hn(a),Lt(r),Ta(s)}}#v(){const t=this.#e.pending;this.#a!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#c),wi(this.#a,this.#l)),this.#n===null&&(this.#n=Vt(()=>t(this.#t)))}#b(t){if(!this.has_pending_snippet()){this.parent&&this.parent.#b(t);return}if(this.#m+=t,this.#m===0){this.is_pending=!1;for(const a of this.#f)gt(a,Rt),En(a);for(const a of this.#y)gt(a,fn),En(a);this.#f.clear(),this.#y.clear(),this.#n&&Qn(this.#n,()=>{this.#n=null}),this.#l&&(this.#t.before(this.#l),this.#l=null)}}update_pending_count(t){this.#b(t),this.#u+=t,this.#d&&aa(this.#d,this.#u)}get_effect_pending(){return this.#T(),n(this.#d)}error(t){var a=this.#e.onerror;let r=this.#e.failed;if(this.#h||!a&&!r)throw t;this.#a&&(It(this.#a),this.#a=null),this.#n&&(It(this.#n),this.#n=null),this.#o&&(It(this.#o),this.#o=null);var s=!1,i=!1;const o=()=>{if(s){Wo();return}s=!0,i&&Ao(),mn.ensure(),this.#u=0,this.#o!==null&&Qn(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#a=this.#p(()=>(this.#h=!1,Vt(()=>this.#s(this.#t)))),this.#m>0?this.#v():this.is_pending=!1};var l=Be;try{Lt(null),i=!0,a?.(t,o),i=!1}catch(c){xa(c,this.#r&&this.#r.parent)}finally{Lt(l)}r&&Ea(()=>{this.#o=this.#p(()=>{mn.ensure(),this.#h=!0;try{return Vt(()=>{r(this.#t,()=>t,()=>o)})}catch(c){return xa(c,this.#r.parent),null}finally{this.#h=!1}})})}}function Xo(e,t,a,r){const s=Za()?As:ze;if(a.length===0&&e.length===0){r(t.map(s));return}var i=Ue,o=je,l=Vo();function c(){Promise.all(a.map(m=>Qo(m))).then(m=>{l();try{r([...t.map(s),...m])}catch(d){(o.f&Sn)===0&&xa(d,o)}i?.deactivate(),vs()}).catch(m=>{xa(m,o)})}e.length>0?Promise.all(e).then(()=>{l();try{return c()}finally{i?.deactivate(),vs()}}):c()}function Vo(){var e=je,t=Be,a=at,r=Ue;return function(i=!0){hn(e),Lt(t),Ta(a),i&&r?.activate()}}function vs(){hn(null),Lt(null),Ta(null)}function As(e){var t=At|Rt,a=Be!==null&&(Be.f&At)!==0?Be:null;return je!==null&&(je.f|=Aa),{ctx:at,deps:null,effects:null,equals:Zr,f:t,fn:e,reactions:null,rv:0,v:St,wv:0,parent:a??je,ac:null}}function Qo(e,t,a){let r=je;r===null&&po();var s=r.b,i=void 0,o=na(St),l=!Be,c=new Map;return ol(()=>{var m=Gr();i=m.promise;try{Promise.resolve(e()).then(m.resolve,m.reject).then(()=>{d===Ue&&d.committed&&d.deactivate(),vs()})}catch(f){m.reject(f),vs()}var d=Ue;if(l){var h=s.is_rendered();s.update_pending_count(1),d.increment(h),c.get(d)?.reject(da),c.delete(d),c.set(d,m)}const u=(f,y=void 0)=>{if(d.activate(),y)y!==da&&(o.f|=$n,aa(o,y));else{(o.f&$n)!==0&&(o.f^=$n),aa(o,f);for(const[v,p]of c){if(c.delete(v),v===d)break;p.reject(da)}}l&&(s.update_pending_count(-1),d.decrement(h))};m.promise.then(u,f=>u(null,f||"unknown"))}),es(()=>{for(const m of c.values())m.reject(da)}),new Promise(m=>{function d(h){function u(){h===i?m(o):d(i)}h.then(u,u)}d(i)})}function ze(e){const t=As(e);return t.equals=ei,t}function li(e){var t=e.effects;if(t!==null){e.effects=null;for(var a=0;a<t.length;a+=1)It(t[a])}}function Zo(e){for(var t=e.parent;t!==null;){if((t.f&At)===0)return(t.f&Sn)===0?t:null;t=t.parent}return null}function ir(e){var t,a=je;hn(Zo(e));try{e.f&=~ta,li(e),t=Mi(e)}finally{hn(a)}return t}function ci(e){var t=ir(e);if(!e.equals(t)&&(e.wv=Ei(),(!Ue?.is_fork||e.deps===null)&&(e.v=t,e.deps===null))){gt(e,wt);return}Yn||(tn!==null?(lr()||Ue?.is_fork)&&tn.set(e,t):rr(e))}let Fs=new Set;const On=new Map;let ui=!1;function na(e,t){var a={f:0,v:e,reactions:null,equals:Zr,rv:0,wv:0};return a}function Dn(e,t){const a=na(e);return ml(a),a}function $(e,t=!1,a=!0){const r=na(e);return t||(r.equals=ei),Ca&&a&&at!==null&&at.l!==null&&(at.l.s??=[]).push(r),r}function Ps(e,t){return w(e,b(()=>n(e))),t}function w(e,t,a=!1){Be!==null&&(!nn||(Be.f&gr)!==0)&&Za()&&(Be.f&(At|Rn|nr|gr))!==0&&!Cn?.includes(e)&&wo();let r=a?ha(t):t;return aa(e,r)}function aa(e,t){if(!e.equals(t)){var a=e.v;Yn?On.set(e,t):On.set(e,a),e.v=t;var r=mn.ensure();if(r.capture(e,a),(e.f&At)!==0){const s=e;(e.f&Rt)!==0&&ir(s),rr(s)}e.wv=Ei(),mi(e,Rt),Za()&&je!==null&&(je.f&wt)!==0&&(je.f&(Mn|sa))===0&&(jt===null?dl([e]):jt.push(e)),!r.is_fork&&Fs.size>0&&!ui&&Jo()}return t}function Jo(){ui=!1;var e=Zn;gs(!0);const t=Array.from(Fs);try{for(const a of t)(a.f&wt)!==0&&gt(a,fn),Ma(a)&&_a(a)}finally{gs(e)}Fs.clear()}function Fa(e){w(e,e.v+1)}function mi(e,t){var a=e.reactions;if(a!==null)for(var r=Za(),s=a.length,i=0;i<s;i++){var o=a[i],l=o.f;if(!(!r&&o===je)){var c=(l&Rt)===0;if(c&&gt(o,t),(l&At)!==0){var m=o;tn?.delete(m),(l&ta)===0&&(l&Zt&&(o.f|=ta),mi(m,fn))}else c&&((l&Rn)!==0&&gn!==null&&gn.add(o),En(o))}}}function ha(e){if(typeof e!="object"||e===null||wn in e)return e;const t=Js(e);if(t!==uo&&t!==mo)return e;var a=new Map,r=Va(e),s=Dn(0),i=Jn,o=l=>{if(Jn===i)return l();var c=Be,m=Jn;Lt(null),Sr(i);var d=l();return Lt(c),Sr(m),d};return r&&a.set("length",Dn(e.length)),new Proxy(e,{defineProperty(l,c,m){(!("value"in m)||m.configurable===!1||m.enumerable===!1||m.writable===!1)&&_o();var d=a.get(c);return d===void 0?d=o(()=>{var h=Dn(m.value);return a.set(c,h),h}):w(d,m.value,!0),!0},deleteProperty(l,c){var m=a.get(c);if(m===void 0){if(c in l){const d=o(()=>Dn(St));a.set(c,d),Fa(s)}}else w(m,St),Fa(s);return!0},get(l,c,m){if(c===wn)return e;var d=a.get(c),h=c in l;if(d===void 0&&(!h||Vn(l,c)?.writable)&&(d=o(()=>{var f=ha(h?l[c]:St),y=Dn(f);return y}),a.set(c,d)),d!==void 0){var u=n(d);return u===St?void 0:u}return Reflect.get(l,c,m)},getOwnPropertyDescriptor(l,c){var m=Reflect.getOwnPropertyDescriptor(l,c);if(m&&"value"in m){var d=a.get(c);d&&(m.value=n(d))}else if(m===void 0){var h=a.get(c),u=h?.v;if(h!==void 0&&u!==St)return{enumerable:!0,configurable:!0,value:u,writable:!0}}return m},has(l,c){if(c===wn)return!0;var m=a.get(c),d=m!==void 0&&m.v!==St||Reflect.has(l,c);if(m!==void 0||je!==null&&(!d||Vn(l,c)?.writable)){m===void 0&&(m=o(()=>{var u=d?ha(l[c]):St,f=Dn(u);return f}),a.set(c,m));var h=n(m);if(h===St)return!1}return d},set(l,c,m,d){var h=a.get(c),u=c in l;if(r&&c==="length")for(var f=m;f<h.v;f+=1){var y=a.get(f+"");y!==void 0?w(y,St):f in l&&(y=o(()=>Dn(St)),a.set(f+"",y))}if(h===void 0)(!u||Vn(l,c)?.writable)&&(h=o(()=>Dn(void 0)),w(h,ha(m)),a.set(c,h));else{u=h.v!==St;var v=o(()=>ha(m));w(h,v)}var p=Reflect.getOwnPropertyDescriptor(l,c);if(p?.set&&p.set.call(d,m),!u){if(r&&typeof c=="string"){var x=a.get("length"),E=Number(c);Number.isInteger(E)&&E>=x.v&&w(x,E+1)}Fa(s)}return!0},ownKeys(l){n(s);var c=Reflect.ownKeys(l).filter(h=>{var u=a.get(h);return u===void 0||u.v!==St});for(var[m,d]of a)d.v!==St&&!(m in l)&&c.push(m);return c},setPrototypeOf(){So()}})}function Tr(e){try{if(e!==null&&typeof e=="object"&&wn in e)return e[wn]}catch{}return e}function el(e,t){return Object.is(Tr(e),Tr(t))}var fa,di,hi,fi;function tl(){if(fa===void 0){fa=window,di=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,a=Text.prototype;hi=Vn(t,"firstChild").get,fi=Vn(t,"nextSibling").get,vr(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),vr(a)&&(a.__t=void 0)}}function An(e=""){return document.createTextNode(e)}function Tn(e){return hi.call(e)}function Ja(e){return fi.call(e)}function M(e,t){return Tn(e)}function Ne(e,t=!1){{var a=Tn(e);return a instanceof Comment&&a.data===""?Ja(a):a}}function C(e,t=1,a=!1){let r=e;for(;t--;)r=Ja(r);return r}function nl(e){e.textContent=""}function yi(){return!1}let xr=!1;function al(){xr||(xr=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{if(!e.defaultPrevented)for(const t of e.target.elements)t.__on_r?.()})},{capture:!0}))}function Cs(e){var t=Be,a=je;Lt(null),hn(null);try{return e()}finally{Lt(t),hn(a)}}function or(e,t,a,r=a){e.addEventListener(t,()=>Cs(a));const s=e.__on_r;s?e.__on_r=()=>{s(),r(!0)}:e.__on_r=()=>r(!0),al()}function pi(e){je===null&&(Be===null&&bo(),go()),Yn&&vo()}function sl(e,t){var a=t.last;a===null?t.last=t.first=e:(a.next=e,e.prev=a,t.last=e)}function yn(e,t,a){var r=je;r!==null&&(r.f&qt)!==0&&(e|=qt);var s={ctx:at,deps:null,nodes:null,f:e|Rt|Zt,first:null,fn:t,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(a)try{_a(s),s.f|=tr}catch(l){throw It(s),l}else t!==null&&En(s);var i=s;if(a&&i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&Aa)===0&&(i=i.first,(e&Rn)!==0&&(e&ba)!==0&&i!==null&&(i.f|=ba)),i!==null&&(i.parent=r,r!==null&&sl(i,r),Be!==null&&(Be.f&At)!==0&&(e&sa)===0)){var o=Be;(o.effects??=[]).push(i)}return s}function lr(){return Be!==null&&!nn}function es(e){const t=yn(Qa,null,!1);return gt(t,wt),t.teardown=e,t}function qs(e){pi();var t=je.f,a=!Be&&(t&Mn)!==0&&(t&tr)===0;if(a){var r=at;(r.e??=[]).push(e)}else return vi(e)}function vi(e){return yn(ps|Xr,e,!1)}function rl(e){return pi(),yn(Qa|Xr,e,!0)}function il(e){mn.ensure();const t=yn(sa|Aa,e,!0);return(a={})=>new Promise(r=>{a.outro?Qn(t,()=>{It(t),r(void 0)}):(It(t),r(void 0))})}function gi(e){return yn(ps,e,!1)}function me(e,t){var a=at,r={effect:null,ran:!1,deps:e};a.l.$.push(r),r.effect=Ra(()=>{e(),!r.ran&&(r.ran=!0,b(t))})}function pn(){var e=at;Ra(()=>{for(var t of e.l.$){t.deps();var a=t.effect;(a.f&wt)!==0&&a.deps!==null&&gt(a,fn),Ma(a)&&_a(a),t.ran=!1}})}function ol(e){return yn(nr|Aa,e,!0)}function Ra(e,t=0){return yn(Qa|t,e,!0)}function Z(e,t=[],a=[],r=[]){Xo(r,t,a,s=>{yn(Qa,()=>e(...s.map(n)),!0)})}function cr(e,t=0){var a=yn(Rn|t,e,!0);return a}function Vt(e){return yn(Mn|Aa,e,!0)}function bi(e){var t=e.teardown;if(t!==null){const a=Yn,r=Be;_r(!0),Lt(null);try{t.call(null)}finally{_r(a),Lt(r)}}}function Ti(e,t=!1){var a=e.first;for(e.first=e.last=null;a!==null;){const s=a.ac;s!==null&&Cs(()=>{s.abort(da)});var r=a.next;(a.f&sa)!==0?a.parent=null:It(a,t),a=r}}function ll(e){for(var t=e.first;t!==null;){var a=t.next;(t.f&Mn)===0&&It(t),t=a}}function It(e,t=!0){var a=!1;(t||(e.f&jr)!==0)&&e.nodes!==null&&e.nodes.end!==null&&(cl(e.nodes.start,e.nodes.end),a=!0),Ti(e,t&&!a),bs(e,0),gt(e,Sn);var r=e.nodes&&e.nodes.t;if(r!==null)for(const i of r)i.stop();bi(e);var s=e.parent;s!==null&&s.first!==null&&xi(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes=e.ac=null}function cl(e,t){for(;e!==null;){var a=e===t?null:Ja(e);e.remove(),e=a}}function xi(e){var t=e.parent,a=e.prev,r=e.next;a!==null&&(a.next=r),r!==null&&(r.prev=a),t!==null&&(t.first===e&&(t.first=r),t.last===e&&(t.last=a))}function Qn(e,t,a=!0){var r=[];_i(e,r,!0);var s=()=>{a&&It(e),t&&t()},i=r.length;if(i>0){var o=()=>--i||s();for(var l of r)l.out(o)}else s()}function _i(e,t,a){if((e.f&qt)===0){e.f^=qt;var r=e.nodes&&e.nodes.t;if(r!==null)for(const l of r)(l.is_global||a)&&t.push(l);for(var s=e.first;s!==null;){var i=s.next,o=(s.f&ba)!==0||(s.f&Mn)!==0&&(e.f&Rn)!==0;_i(s,t,o?a:!1),s=i}}}function ur(e){Si(e,!0)}function Si(e,t){if((e.f&qt)!==0){e.f^=qt,(e.f&wt)===0&&(gt(e,Rt),En(e));for(var a=e.first;a!==null;){var r=a.next,s=(a.f&ba)!==0||(a.f&Mn)!==0;Si(a,s?t:!1),a=r}var i=e.nodes&&e.nodes.t;if(i!==null)for(const o of i)(o.is_global||t)&&o.in()}}function wi(e,t){if(e.nodes)for(var a=e.nodes.start,r=e.nodes.end;a!==null;){var s=a===r?null:Ja(a);t.append(a),a=s}}let ma=null;function ul(e){var t=ma;try{if(ma=new Set,b(e),t!==null)for(var a of ma)t.add(a);return ma}finally{ma=t}}function Ai(e){for(var t of ul(e))aa(t,t.v)}let Zn=!1;function gs(e){Zn=e}let Yn=!1;function _r(e){Yn=e}let Be=null,nn=!1;function Lt(e){Be=e}let je=null;function hn(e){je=e}let Cn=null;function ml(e){Be!==null&&(Cn===null?Cn=[e]:Cn.push(e))}let Et=null,Wt=0,jt=null;function dl(e){jt=e}let Ci=1,za=0,Jn=za;function Sr(e){Jn=e}function Ei(){return++Ci}function Ma(e){var t=e.f;if((t&Rt)!==0)return!0;if(t&At&&(e.f&=~ta),(t&fn)!==0){for(var a=e.deps,r=a.length,s=0;s<r;s++){var i=a[s];if(Ma(i)&&ci(i),i.wv>e.wv)return!0}(t&Zt)!==0&&tn===null&&gt(e,wt)}return!1}function Ri(e,t,a=!0){var r=e.reactions;if(r!==null&&!Cn?.includes(e))for(var s=0;s<r.length;s++){var i=r[s];(i.f&At)!==0?Ri(i,t,!1):t===i&&(a?gt(i,Rt):(i.f&wt)!==0&&gt(i,fn),En(i))}}function Mi(e){var t=Et,a=Wt,r=jt,s=Be,i=Cn,o=at,l=nn,c=Jn,m=e.f;Et=null,Wt=0,jt=null,Be=(m&(Mn|sa))===0?e:null,Cn=null,Ta(e.ctx),nn=!1,Jn=++za,e.ac!==null&&(Cs(()=>{e.ac.abort(da)}),e.ac=null);try{e.f|=Hs;var d=e.fn,h=d(),u=e.deps;if(Et!==null){var f;if(bs(e,Wt),u!==null&&Wt>0)for(u.length=Wt+Et.length,f=0;f<Et.length;f++)u[Wt+f]=Et[f];else e.deps=u=Et;if(lr()&&(e.f&Zt)!==0)for(f=Wt;f<u.length;f++)(u[f].reactions??=[]).push(e)}else u!==null&&Wt<u.length&&(bs(e,Wt),u.length=Wt);if(Za()&&jt!==null&&!nn&&u!==null&&(e.f&(At|fn|Rt))===0)for(f=0;f<jt.length;f++)Ri(jt[f],e);return s!==null&&s!==e&&(za++,jt!==null&&(r===null?r=jt:r.push(...jt))),(e.f&$n)!==0&&(e.f^=$n),h}catch(y){return ni(y)}finally{e.f^=Hs,Et=t,Wt=a,jt=r,Be=s,Cn=i,Ta(o),nn=l,Jn=c}}function hl(e,t){let a=t.reactions;if(a!==null){var r=co.call(a,e);if(r!==-1){var s=a.length-1;s===0?a=t.reactions=null:(a[r]=a[s],a.pop())}}if(a===null&&(t.f&At)!==0&&(Et===null||!Et.includes(t))){var i=t;(i.f&Zt)!==0&&(i.f^=Zt,i.f&=~ta),rr(i),li(i),bs(i,0)}}function bs(e,t){var a=e.deps;if(a!==null)for(var r=t;r<a.length;r++)hl(e,a[r])}function _a(e){var t=e.f;if((t&Sn)===0){gt(e,wt);var a=je,r=Zn;je=e,Zn=!0;try{(t&(Rn|zr))!==0?ll(e):Ti(e),bi(e);var s=Mi(e);e.teardown=typeof s=="function"?s:null,e.wv=Ci;var i;Ys&&Yo&&(e.f&Rt)!==0&&e.deps}finally{Zn=r,je=a}}}async function fl(){await Promise.resolve(),qo()}function n(e){var t=e.f,a=(t&At)!==0;if(ma?.add(e),Be!==null&&!nn){var r=je!==null&&(je.f&Sn)!==0;if(!r&&!Cn?.includes(e)){var s=Be.deps;if((Be.f&Hs)!==0)e.rv<za&&(e.rv=za,Et===null&&s!==null&&s[Wt]===e?Wt++:Et===null?Et=[e]:Et.includes(e)||Et.push(e));else{(Be.deps??=[]).push(e);var i=e.reactions;i===null?e.reactions=[Be]:i.includes(Be)||i.push(Be)}}}if(Yn&&On.has(e))return On.get(e);if(a){var o=e;if(Yn){var l=o.v;return((o.f&wt)===0&&o.reactions!==null||Di(o))&&(l=ir(o)),On.set(o,l),l}var c=(o.f&Zt)===0&&!nn&&Be!==null&&(Zn||(Be.f&Zt)!==0),m=o.deps===null;Ma(o)&&(c&&(o.f|=Zt),ci(o)),c&&!m&&ki(o)}if(tn?.has(e))return tn.get(e);if((e.f&$n)!==0)throw e.v;return e.v}function ki(e){if(e.deps!==null){e.f|=Zt;for(const t of e.deps)(t.reactions??=[]).push(e),(t.f&At)!==0&&(t.f&Zt)===0&&ki(t)}}function Di(e){if(e.v===St)return!0;if(e.deps===null)return!1;for(const t of e.deps)if(On.has(t)||(t.f&At)!==0&&Di(t))return!0;return!1}function b(e){var t=nn;try{return nn=!0,e()}finally{nn=t}}function ne(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(wn in e)Us(e);else if(!Array.isArray(e))for(let t in e){const a=e[t];typeof a=="object"&&a&&wn in a&&Us(a)}}}function Us(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let r in e)try{Us(e[r],t)}catch{}const a=Js(e);if(a!==Object.prototype&&a!==Array.prototype&&a!==Map.prototype&&a!==Set.prototype&&a!==Date.prototype){const r=Kr(a);for(let s in r){const i=r[s].get;if(i)try{i.call(e)}catch{}}}}}const yl=["touchstart","touchmove"];function pl(e){return yl.includes(e)}const vl=new Set,wr=new Set;function gl(e,t,a,r={}){function s(i){if(r.capture||$a.call(t,i),!i.cancelBubble)return Cs(()=>a?.call(this,i))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?Ea(()=>{t.addEventListener(e,s,r)}):t.addEventListener(e,s,r),s}function ee(e,t,a,r,s){var i={capture:r,passive:s},o=gl(e,t,a,i);(t===document.body||t===window||t===document||t instanceof HTMLMediaElement)&&es(()=>{t.removeEventListener(e,o,i)})}let Ar=null;function $a(e){var t=this,a=t.ownerDocument,r=e.type,s=e.composedPath?.()||[],i=s[0]||e.target;Ar=e;var o=0,l=Ar===e&&e.__root;if(l){var c=s.indexOf(l);if(c!==-1&&(t===document||t===window)){e.__root=t;return}var m=s.indexOf(t);if(m===-1)return;c<=m&&(o=c)}if(i=s[o]||e.target,i!==t){Ur(e,"currentTarget",{configurable:!0,get(){return i||a}});var d=Be,h=je;Lt(null),hn(null);try{for(var u,f=[];i!==null;){var y=i.assignedSlot||i.parentNode||i.host||null;try{var v=i["__"+r];v!=null&&(!i.disabled||e.target===i)&&v.call(i,e)}catch(p){u?f.push(p):u=p}if(e.cancelBubble||y===t||y===null)break;i=y}if(u){for(let p of f)queueMicrotask(()=>{throw p});throw u}}finally{e.__root=t,delete e.currentTarget,Lt(d),hn(h)}}}function Li(e){var t=document.createElement("template");return t.innerHTML=e.replaceAll("<!>","<!---->"),t.content}function Sa(e,t){var a=je;a.nodes===null&&(a.nodes={start:e,end:t,a:null,t:null})}function ye(e,t){var a=(t&Qr)!==0,r=(t&No)!==0,s,i=!e.startsWith("<!>");return()=>{s===void 0&&(s=Li(i?e:"<!>"+e),a||(s=Tn(s)));var o=r||di?document.importNode(s,!0):s.cloneNode(!0);if(a){var l=Tn(o),c=o.lastChild;Sa(l,c)}else Sa(o,o);return o}}function bl(e,t,a="svg"){var r=!e.startsWith("<!>"),s=(t&Qr)!==0,i=`<${a}>${r?e:"<!>"+e}</${a}>`,o;return()=>{if(!o){var l=Li(i),c=Tn(l);if(s)for(o=document.createDocumentFragment();Tn(c);)o.appendChild(Tn(c));else o=Tn(c)}var m=o.cloneNode(!0);if(s){var d=Tn(m),h=m.lastChild;Sa(d,h)}else Sa(m,m);return m}}function Ce(e,t){return bl(e,t,"svg")}function Ii(e=""){{var t=An(e+"");return Sa(t,t),t}}function dt(){var e=document.createDocumentFragment(),t=document.createComment(""),a=An();return e.append(t,a),Sa(t,a),e}function I(e,t){e!==null&&e.before(t)}function Se(e,t){var a=t==null?"":typeof t=="object"?t+"":t;a!==(e.__t??=e.nodeValue)&&(e.__t=a,e.nodeValue=a+"")}function Tl(e,t){return xl(e,t)}const la=new Map;function xl(e,{target:t,anchor:a,props:r={},events:s,context:i,intro:o=!0}){tl();var l=new Set,c=h=>{for(var u=0;u<h.length;u++){var f=h[u];if(!l.has(f)){l.add(f);var y=pl(f);t.addEventListener(f,$a,{passive:y});var v=la.get(f);v===void 0?(document.addEventListener(f,$a,{passive:y}),la.set(f,1)):la.set(f,v+1)}}};c(Ss(vl)),wr.add(c);var m=void 0,d=il(()=>{var h=a??t.appendChild(An());return zo(h,{pending:()=>{}},u=>{if(i){Mt({});var f=at;f.c=i}s&&(r.$$events=s),m=e(u,r)||{},i&&kt()}),()=>{for(var u of l){t.removeEventListener(u,$a);var f=la.get(u);--f===0?(document.removeEventListener(u,$a),la.delete(u)):la.set(u,f)}wr.delete(c),h!==a&&h.parentNode?.removeChild(h)}});return _l.set(m,d),m}let _l=new WeakMap;class Sl{anchor;#t=new Map;#i=new Map;#e=new Map;#s=new Set;#r=!0;constructor(t,a=!0){this.anchor=t,this.#r=a}#a=()=>{var t=Ue;if(this.#t.has(t)){var a=this.#t.get(t),r=this.#i.get(a);if(r)ur(r),this.#s.delete(a);else{var s=this.#e.get(a);s&&(this.#i.set(a,s.effect),this.#e.delete(a),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),r=s.effect)}for(const[i,o]of this.#t){if(this.#t.delete(i),i===t)break;const l=this.#e.get(o);l&&(It(l.effect),this.#e.delete(o))}for(const[i,o]of this.#i){if(i===a||this.#s.has(i))continue;const l=()=>{if(Array.from(this.#t.values()).includes(i)){var m=document.createDocumentFragment();wi(o,m),m.append(An()),this.#e.set(i,{effect:o,fragment:m})}else It(o);this.#s.delete(i),this.#i.delete(i)};this.#r||!r?(this.#s.add(i),Qn(o,l,!1)):l()}}};#n=t=>{this.#t.delete(t);const a=Array.from(this.#t.values());for(const[r,s]of this.#e)a.includes(r)||(It(s.effect),this.#e.delete(r))};ensure(t,a){var r=Ue,s=yi();if(a&&!this.#i.has(t)&&!this.#e.has(t))if(s){var i=document.createDocumentFragment(),o=An();i.append(o),this.#e.set(t,{effect:Vt(()=>a(o)),fragment:i})}else this.#i.set(t,Vt(()=>a(this.anchor)));if(this.#t.set(r,t),s){for(const[l,c]of this.#i)l===t?r.skipped_effects.delete(c):r.skipped_effects.add(c);for(const[l,c]of this.#e)l===t?r.skipped_effects.delete(c.effect):r.skipped_effects.add(c.effect);r.oncommit(this.#a),r.ondiscard(this.#n)}else this.#a()}}function Te(e,t,a=!1){var r=new Sl(e),s=a?ba:0;function i(o,l){r.ensure(o,l)}cr(()=>{var o=!1;t((l,c=!0)=>{o=!0,i(c,l)}),o||i(!1,null)},s)}function We(e,t){return t}function wl(e,t,a){for(var r=[],s=t.length,i,o=t.length,l=0;l<s;l++){let h=t[l];Qn(h,()=>{if(i){if(i.pending.delete(h),i.done.add(h),i.pending.size===0){var u=e.outrogroups;Ks(Ss(i.done)),u.delete(i),u.size===0&&(e.outrogroups=null)}}else o-=1},!1)}if(o===0){var c=r.length===0&&a!==null;if(c){var m=a,d=m.parentNode;nl(d),d.append(m),e.items.clear()}Ks(t,!c)}else i={pending:new Set(t),done:new Set},(e.outrogroups??=new Set).add(i)}function Ks(e,t=!0){for(var a=0;a<e.length;a++)It(e[a],t)}var Cr;function Me(e,t,a,r,s,i=null){var o=e,l=new Map,c=(t&Vr)!==0;if(c){var m=e;o=m.appendChild(An())}var d=null,h=ze(()=>{var x=a();return Va(x)?x:x==null?[]:Ss(x)}),u,f=!0;function y(){p.fallback=d,Al(p,u,o,t,r),d!==null&&(u.length===0?(d.f&_n)===0?ur(d):(d.f^=_n,Oa(d,null,o)):Qn(d,()=>{d=null}))}var v=cr(()=>{u=n(h);for(var x=u.length,E=new Set,A=Ue,g=yi(),_=0;_<x;_+=1){var R=u[_],k=r(R,_),S=f?null:l.get(k);S?(S.v&&aa(S.v,R),S.i&&aa(S.i,_),g&&A.skipped_effects.delete(S.e)):(S=Cl(l,f?o:Cr??=An(),R,k,_,s,t,a),f||(S.e.f|=_n),l.set(k,S)),E.add(k)}if(x===0&&i&&!d&&(f?d=Vt(()=>i(o)):(d=Vt(()=>i(Cr??=An())),d.f|=_n)),!f)if(g){for(const[D,N]of l)E.has(D)||A.skipped_effects.add(N.e);A.oncommit(y),A.ondiscard(()=>{})}else y();n(h)}),p={effect:v,items:l,outrogroups:null,fallback:d};f=!1}function Al(e,t,a,r,s){var i=(r&Ro)!==0,o=t.length,l=e.items,c=e.effect.first,m,d=null,h,u=[],f=[],y,v,p,x;if(i)for(x=0;x<o;x+=1)y=t[x],v=s(y,x),p=l.get(v).e,(p.f&_n)===0&&(p.nodes?.a?.measure(),(h??=new Set).add(p));for(x=0;x<o;x+=1){if(y=t[x],v=s(y,x),p=l.get(v).e,e.outrogroups!==null)for(const N of e.outrogroups)N.pending.delete(p),N.done.delete(p);if((p.f&_n)!==0)if(p.f^=_n,p===c)Oa(p,null,a);else{var E=d?d.next:c;p===e.effect.last&&(e.effect.last=p.prev),p.prev&&(p.prev.next=p.next),p.next&&(p.next.prev=p.prev),Ln(e,d,p),Ln(e,p,E),Oa(p,E,a),d=p,u=[],f=[],c=d.next;continue}if((p.f&qt)!==0&&(ur(p),i&&(p.nodes?.a?.unfix(),(h??=new Set).delete(p))),p!==c){if(m!==void 0&&m.has(p)){if(u.length<f.length){var A=f[0],g;d=A.prev;var _=u[0],R=u[u.length-1];for(g=0;g<u.length;g+=1)Oa(u[g],A,a);for(g=0;g<f.length;g+=1)m.delete(f[g]);Ln(e,_.prev,R.next),Ln(e,d,_),Ln(e,R,A),c=A,d=R,x-=1,u=[],f=[]}else m.delete(p),Oa(p,c,a),Ln(e,p.prev,p.next),Ln(e,p,d===null?e.effect.first:d.next),Ln(e,d,p),d=p;continue}for(u=[],f=[];c!==null&&c!==p;)(m??=new Set).add(c),f.push(c),c=c.next;if(c===null)continue}(p.f&_n)===0&&u.push(p),d=p,c=p.next}if(e.outrogroups!==null){for(const N of e.outrogroups)N.pending.size===0&&(Ks(Ss(N.done)),e.outrogroups?.delete(N));e.outrogroups.size===0&&(e.outrogroups=null)}if(c!==null||m!==void 0){var k=[];if(m!==void 0)for(p of m)(p.f&qt)===0&&k.push(p);for(;c!==null;)(c.f&qt)===0&&c!==e.fallback&&k.push(c),c=c.next;var S=k.length;if(S>0){var D=(r&Vr)!==0&&o===0?a:null;if(i){for(x=0;x<S;x+=1)k[x].nodes?.a?.measure();for(x=0;x<S;x+=1)k[x].nodes?.a?.fix()}wl(e,k,D)}}i&&Ea(()=>{if(h!==void 0)for(p of h)p.nodes?.a?.apply()})}function Cl(e,t,a,r,s,i,o,l){var c=(o&Co)!==0?(o&Mo)===0?$(a,!1,!1):na(a):null,m=(o&Eo)!==0?na(s):null;return{v:c,i:m,e:Vt(()=>(i(t,c??a,m??s,l),()=>{e.delete(r)}))}}function Oa(e,t,a){if(e.nodes)for(var r=e.nodes.start,s=e.nodes.end,i=t&&(t.f&_n)===0?t.nodes.start:a;r!==null;){var o=Ja(r);if(i.before(r),r===s)return;r=o}}function Ln(e,t,a){t===null?e.effect.first=a:t.next=a,a===null?e.effect.last=t:a.prev=t}function Pi(e,t,a,r,s){var i=t.$$slots?.[a],o=!1;i===!0&&(i=t.children,o=!0),i===void 0||i(e,o?()=>r:r)}const Er=[...` 	
\r\fÂ \v\uFEFF`];function El(e,t,a){var r=e==null?"":""+e;if(a){for(var s in a)if(a[s])r=r?r+" "+s:s;else if(r.length)for(var i=s.length,o=0;(o=r.indexOf(s,o))>=0;){var l=o+i;(o===0||Er.includes(r[o-1]))&&(l===r.length||Er.includes(r[l]))?r=(o===0?"":r.substring(0,o))+r.substring(l+1):o=l}}return r===""?null:r}function Rl(e,t){return e==null?null:String(e)}function an(e,t,a,r,s,i){var o=e.__className;if(o!==a||o===void 0){var l=El(a,r,i);l==null?e.removeAttribute("class"):t?e.className=l:e.setAttribute("class",l),e.__className=a}else if(i&&s!==i)for(var c in i){var m=!!i[c];(s==null||m!==!!s[c])&&e.classList.toggle(c,m)}return i}function Ml(e,t,a,r){var s=e.__style;if(s!==t){var i=Rl(t);i==null?e.removeAttribute("style"):e.style.cssText=i,e.__style=t}return r}function Ni(e,t,a=!1){if(e.multiple){if(t==null)return;if(!Va(t))return Oo();for(var r of e.options)r.selected=t.includes(qa(r));return}for(r of e.options){var s=qa(r);if(el(s,t)){r.selected=!0;return}}(!a||t!==void 0)&&(e.selectedIndex=-1)}function kl(e){var t=new MutationObserver(()=>{Ni(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),es(()=>{t.disconnect()})}function $i(e,t,a=t){var r=new WeakSet,s=!0;or(e,"change",i=>{var o=i?"[selected]":":checked",l;if(e.multiple)l=[].map.call(e.querySelectorAll(o),qa);else{var c=e.querySelector(o)??e.querySelector("option:not([disabled])");l=c&&qa(c)}a(l),Ue!==null&&r.add(Ue)}),gi(()=>{var i=t();if(e===document.activeElement){var o=Ha??Ue;if(r.has(o))return}if(Ni(e,i,s),s&&i===void 0){var l=e.querySelector(":checked");l!==null&&(i=qa(l),a(i))}e.__value=i,s=!1}),kl(e)}function qa(e){return"__value"in e?e.__value:e.value}const Dl=Symbol("is custom element"),Ll=Symbol("is html");function Il(e,t){var a=Oi(e);a.value===(a.value=t??void 0)||e.value===t&&(t!==0||e.nodeName!=="PROGRESS")||(e.value=t??"")}function T(e,t,a,r){var s=Oi(e);s[t]!==(s[t]=a)&&(t==="loading"&&(e[yo]=a),a==null?e.removeAttribute(t):typeof a!="string"&&Pl(e).includes(t)?e[t]=a:e.setAttribute(t,a))}function Oi(e){return e.__attributes??={[Dl]:e.nodeName.includes("-"),[Ll]:e.namespaceURI===$o}}var Rr=new Map;function Pl(e){var t=e.getAttribute("is")||e.nodeName,a=Rr.get(t);if(a)return a;Rr.set(t,a=[]);for(var r,s=e,i=Element.prototype;i!==s;){r=Kr(s);for(var o in r)r[o].set&&a.push(o);s=Js(s)}return a}function ga(e,t,a=t){var r=new WeakSet;or(e,"input",async s=>{var i=s?e.defaultValue:e.value;if(i=Ns(e)?$s(i):i,a(i),Ue!==null&&r.add(Ue),await fl(),i!==(i=t())){var o=e.selectionStart,l=e.selectionEnd,c=e.value.length;if(e.value=i??"",l!==null){var m=e.value.length;o===l&&l===c&&m>c?(e.selectionStart=m,e.selectionEnd=m):(e.selectionStart=o,e.selectionEnd=Math.min(l,m))}}}),b(t)==null&&e.value&&(a(Ns(e)?$s(e.value):e.value),Ue!==null&&r.add(Ue)),Ra(()=>{var s=t();if(e===document.activeElement){var i=Ha??Ue;if(r.has(i))return}Ns(e)&&s===$s(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function Ts(e,t,a=t){or(e,"change",r=>{var s=r?e.defaultChecked:e.checked;a(s)}),b(t)==null&&a(e.checked),Ra(()=>{var r=t();e.checked=!!r})}function Ns(e){var t=e.type;return t==="number"||t==="range"}function $s(e){return e===""?null:+e}function Wa(e,t,a){var r=Vn(e,t);r&&r.set&&(e[t]=a,es(()=>{e[t]=null}))}function Mr(e,t){return e===t||e?.[wn]===t}function Es(e={},t,a,r){return gi(()=>{var s,i;return Ra(()=>{s=i,i=[],b(()=>{e!==a(...i)&&(t(e,...i),s&&Mr(a(...s),e)&&t(null,...s))})}),()=>{Ea(()=>{i&&Mr(a(...i),e)&&t(null,...i)})}}),e}function kr(e){return function(...t){var a=t[0];return a.stopPropagation(),e?.apply(this,t)}}function Pt(e=!1){const t=at,a=t.l.u;if(!a)return;let r=()=>ne(t.s);if(e){let s=0,i={};const o=As(()=>{let l=!1;const c=t.s;for(const m in c)c[m]!==i[m]&&(i[m]=c[m],l=!0);return l&&s++,s});r=()=>n(o)}a.b.length&&rl(()=>{Dr(t,r),ys(a.b)}),qs(()=>{const s=b(()=>a.m.map(ho));return()=>{for(const i of s)typeof i=="function"&&i()}}),a.a.length&&qs(()=>{Dr(t,r),ys(a.a)})}function Dr(e,t){if(e.l.s)for(const a of e.l.s)n(a);t()}function Lr(e,t){var a=e.$$events?.[t.type],r=Va(a)?a.slice():a==null?[]:[a];for(var s of r)s.call(this,t)}function mr(e,t,a){if(e==null)return t(void 0),a&&a(void 0),Nn;const r=b(()=>e.subscribe(t,a));return r.unsubscribe?()=>r.unsubscribe():r}const ca=[];function Nl(e,t){return{subscribe:rt(e,t).subscribe}}function rt(e,t=Nn){let a=null;const r=new Set;function s(l){if(Jr(e,l)&&(e=l,a)){const c=!ca.length;for(const m of r)m[1](),ca.push(m,e);if(c){for(let m=0;m<ca.length;m+=2)ca[m][0](ca[m+1]);ca.length=0}}}function i(l){s(l(e))}function o(l,c=Nn){const m=[l,c];return r.add(m),r.size===1&&(a=t(s,i)||Nn),l(e),()=>{r.delete(m),r.size===0&&a&&(a(),a=null)}}return{set:s,update:i,subscribe:o}}function Ut(e,t,a){const r=!Array.isArray(e),s=r?[e]:e;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=t.length<2;return Nl(a,(o,l)=>{let c=!1;const m=[];let d=0,h=Nn;const u=()=>{if(d)return;h();const y=t(r?m[0]:m,o,l);i?o(y):h=typeof y=="function"?y:Nn},f=s.map((y,v)=>mr(y,p=>{m[v]=p,d&=~(1<<v),c&&u()},()=>{d|=1<<v}));return c=!0,u(),function(){ys(f),h(),c=!1}})}function Bt(e){let t;return mr(e,a=>t=a)(),t}let rs=!1,Gs=Symbol();function Ve(e,t,a){const r=a[t]??={store:null,source:$(void 0),unsubscribe:Nn};if(r.store!==e&&!(Gs in a))if(r.unsubscribe(),r.store=e??null,e==null)r.source.v=void 0,r.unsubscribe=Nn;else{var s=!0;r.unsubscribe=mr(e,i=>{s?r.source.v=i:w(r.source,i)}),s=!1}return e&&Gs in a?Bt(e):n(r.source)}function $l(e,t){return e.set(t),t}function ka(){const e={};function t(){es(()=>{for(var a in e)e[a].unsubscribe();Ur(e,Gs,{enumerable:!1,value:!0})})}return[e,t]}function Ol(e){var t=rs;try{return rs=!1,[e(),rs]}finally{rs=t}}function Ae(e,t,a,r){var s=!Ca||(a&Do)!==0,i=(a&Io)!==0,o=(a&Po)!==0,l=r,c=!0,m=()=>(c&&(c=!1,l=o?b(r):r),l),d;if(i){var h=wn in e||fo in e;d=Vn(e,t)?.set??(h&&t in e?A=>e[t]=A:void 0)}var u,f=!1;i?[u,f]=Ol(()=>e[t]):u=e[t],u===void 0&&r!==void 0&&(u=m(),d&&(s&&xo(),d(u)));var y;if(s?y=()=>{var A=e[t];return A===void 0?m():(c=!0,A)}:y=()=>{var A=e[t];return A!==void 0&&(l=void 0),A===void 0?l:A},s&&(a&Lo)===0)return y;if(d){var v=e.$$legacy;return(function(A,g){return arguments.length>0?((!s||!g||v||f)&&d(g?y():A),A):y()})}var p=!1,x=((a&ko)!==0?As:ze)(()=>(p=!1,y()));i&&n(x);var E=je;return(function(A,g){if(arguments.length>0){const _=g?n(x):s&&i?ha(A):A;return w(x,_),p=!0,l!==void 0&&(l=_),A}return Yn&&p||(E.f&Sn)!==0?x.v:n(x)})}function Da(e){at===null&&sr(),Ca&&at.l!==null?Yl(at).m.push(e):qs(()=>{const t=b(e);if(typeof t=="function")return t})}function Wi(e){at===null&&sr(),Da(()=>()=>b(e))}function Wl(e,t,{bubbles:a=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:a,cancelable:r})}function dr(){const e=at;return e===null&&sr(),(t,a,r)=>{const s=e.s.$$events?.[t];if(s){const i=Va(s)?s.slice():[s],o=Wl(t,a,r);for(const l of i)l.call(e.x,o);return!o.defaultPrevented}return!0}}function Yl(e){var t=e.l;return t.u??={a:[],b:[],m:[]}}const Hl="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Hl);Ho();function Bl(e,t,a,r){const s=ya(a,r,e),i=ya(a,r,t),o=ya(e,t,a),l=ya(e,t,r);return!!((s>0&&i<0||s<0&&i>0)&&(o>0&&l<0||o<0&&l>0)||s===0&&is(a,r,e)||i===0&&is(a,r,t)||o===0&&is(e,t,a)||l===0&&is(e,t,r))}function ya(e,t,a){return(a.x-e.x)*(t.y-e.y)-(t.x-e.x)*(a.y-e.y)}function is(e,t,a){return Math.min(e.x,t.x)<=a.x&&a.x<=Math.max(e.x,t.x)&&Math.min(e.y,t.y)<=a.y&&a.y<=Math.max(e.y,t.y)}function Ir(e,t,a,r=16){const s=[];for(let i=0;i<r;i++){const o=2*Math.PI*i/r;s.push({x:e+a*Math.cos(o),y:t+a*Math.sin(o)})}return s}function Fl(e,t,a,r,s=0,i=16){const o=[],l=2*(a+r),c=s*Math.PI/180,m=Math.cos(c),d=Math.sin(c),h=i/l,u=Math.max(1,Math.round(a*h)),f=Math.max(1,Math.round(r*h)),y=a/2,v=r/2,p=[];for(let x=0;x<u;x++){const E=x/u;p.push({x:-y+a*E,y:-v})}for(let x=0;x<f;x++){const E=x/f;p.push({x:y,y:-v+r*E})}for(let x=0;x<u;x++){const E=x/u;p.push({x:y-a*E,y:v})}for(let x=0;x<f;x++){const E=x/f;p.push({x:-y,y:v-r*E})}for(const x of p)o.push({x:e+x.x*m-x.y*d,y:t+x.x*d+x.y*m});if(o.length>i){const x=[],E=o.length/i;for(let A=0;A<i;A++)x.push(o[Math.floor(A*E)]);return x}return o}function ql(e,t,a,r,s=0,i=16){const o=[],l=s*Math.PI/180,c=Math.cos(l),m=Math.sin(l);for(let d=0;d<i;d++){const h=2*Math.PI*d/i,u=a*Math.cos(h),f=r*Math.sin(h);o.push({x:e+u*c-f*m,y:t+u*m+f*c})}return o}function Pr(e,t,a){const r=a.length;for(let s=0;s<r;s++){const i=a[s],o=a[(s+1)%r];if(Bl(e,t,i,o))return!0}return!1}function Yi(e,t,a){const r=a*Math.PI/180,s=Math.cos(r),i=Math.sin(r),o=e.x-t.x,l=e.y-t.y;return{x:t.x+o*s-l*i,y:t.y+o*i+l*s}}function Hi(e){return{x:e.x+e.width/2,y:e.y+e.height/2}}function ja(e){const t=Hi(e),a=e.rotation||0;return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}].map(s=>Yi(s,t,a))}function Ul(e){const s=e.x,i=e.y+e.height;return[{x:s,y:i},{x:s,y:i-8},{x:s+.5,y:i-8},{x:s+.5,y:i-.5},{x:s+4,y:i-.5},{x:s+4,y:i}]}function Kl(e){const t=Ul(e),a=Hi(e),r=e.rotation||0;return t.map(s=>Yi(s,a,r))}function Gl(e,t,a,r,s=.01){const i=Math.abs(ya(e,t,a)),o=Math.abs(ya(e,t,r)),l=Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),c=s*l;if(i>c||o>c)return!1;const m=t.x-e.x,d=t.y-e.y,h=Math.sqrt(m*m+d*d);if(h<s)return!1;const u=m/h,f=d/h,y=0,v=h,p=(a.x-e.x)*u+(a.y-e.y)*f,x=(r.x-e.x)*u+(r.y-e.y)*f,E=Math.min(y,v),A=Math.max(y,v),g=Math.min(p,x),_=Math.max(p,x),R=Math.max(E,g);return Math.min(A,_)-R>s}function zl(e,t,a=.1){const r=e.length,s=t.length;for(let i=0;i<r;i++){const o=e[i],l=e[(i+1)%r];for(let c=0;c<s;c++){const m=t[c],d=t[(c+1)%s];if(Gl(o,l,m,d,a))return!0}}return!1}function jl(e){const t=e.length;if(t===0)return new Map;const a=Array.from({length:t},(l,c)=>c);function r(l){return a[l]!==l&&(a[l]=r(a[l])),a[l]}function s(l,c){const m=r(l),d=r(c);m!==d&&(a[m]=d)}for(let l=0;l<t;l++)for(let c=l+1;c<t;c++)zl(e[l].vertices,e[c].vertices)&&s(l,c);const i=new Map;e.forEach((l,c)=>i.set(l.id,c));const o=new Map;return e.forEach((l,c)=>{o.set(l.id,r(c))}),o}function Xl(e,t,a){const r=t.get(e);return r===void 0?[e]:a.filter(s=>t.get(s.id)===r).map(s=>s.id)}const os=16;function zs(e){return e.isRectangle&&e.width!==void 0&&e.height!==void 0?Fl(e.x,e.y,e.width,e.height,e.rotation||0,os):e.radius!==void 0?Ir(e.x,e.y,e.radius,os):e.rx!==void 0&&e.ry!==void 0?ql(e.x,e.y,e.rx,e.ry,e.rotation||0,os):Ir(e.x,e.y,.5,os)}function Nr(e,t){const a=zs(e);for(const r of a)if($r(r,t))return!0;return!!$r({x:e.x,y:e.y},t)}function $r(e,t){const a=t.length;let r=null;for(let s=0;s<a;s++){const i=t[s],o=t[(s+1)%a],l=(o.x-i.x)*(e.y-i.y)-(o.y-i.y)*(e.x-i.x);if(l!==0){const c=l>0;if(r===null)r=c;else if(r!==c)return!1}}return!0}function Bi(e,t,a,r){const s=zs(e),i=zs(t),o=jl(a),l=new Set;for(const h of a){const u=Nr(e,h.vertices),f=Nr(t,h.vertices);if(u||f){const y=Xl(h.id,o,a);for(const v of y)l.add(v)}}const c=[];let m=!1,d=null;for(const h of s)for(const u of i){const f={from:h,to:u,blocked:!1,blockedBy:null};let y=!1;for(const p of a)if(!l.has(p.id)&&Pr(h,u,p.vertices)){f.blocked=!0,f.blockedBy="terrain",y=!0;break}if(y){c.push(f);continue}let v=!1;for(const p of r)if(Pr(h,u,p)){f.blocked=!0,f.blockedBy="wall",v=!0;break}v||(f.blocked=!1,m||(d=f),m=!0),c.push(f)}return{canSee:m,rays:c,firstClearRay:d,terrainsIgnored:Array.from(l)}}const De={width:60,height:44},Fi=rt([{id:"terrain1",x:20,y:16,width:6,height:12,rotation:0},{id:"terrain2",x:34,y:10,width:6,height:12,rotation:45},{id:"terrain3",x:44,y:20,width:6,height:12,rotation:-30}]);Ut(Fi,e=>e.map(t=>Kl(t)));Ut(Fi,e=>e.map(t=>({id:t.id,vertices:ja(t)})));const Or=rt(!1);var Vl=Ce('<line stroke="#3a4a3a" stroke-width="0.05"></line>'),Ql=Ce('<line stroke="#3a4a3a" stroke-width="0.05"></line>'),Zl=Ce('<line stroke="#5a6a5a" stroke-width="0.08"></line>'),Jl=Ce('<line stroke="#5a6a5a" stroke-width="0.08"></line>'),ec=Ce('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),tc=Ce('<line stroke="#666"></line><!>',1),nc=Ce('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),ac=Ce('<line stroke="#666"></line><!>',1),sc=Ce('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),rc=Ce('<line stroke="#666"></line><!>',1),ic=Ce('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),oc=Ce('<line stroke="#666"></line><!>',1),lc=Ce('<svg preserveAspectRatio="xMidYMid meet"><rect x="0" y="0" fill="#1a1a1a"></rect><rect fill="#4a5a4a"></rect><!><!><!><!><!><!><!><!><g><!></g></svg>');function Rs(e,t){Mt(t,!1);const a=$(),r=$(),s=$(),i=$(),o=$(),l=$(),c=$();let m=$();const d=2,h=De.width+d*2,u=De.height+d*2;let f=$(1),y=$(0),v=$(0),p=$(!1),x={x:0,y:0},E=$(!1);const A=.5,g=4;function _(K,ue){if(!n(m))return{x:0,y:0};const Pe=n(m).createSVGPoint();Pe.x=K,Pe.y=ue;const oe=Pe.matrixTransform(n(m).getScreenCTM().inverse());return{x:oe.x-d,y:oe.y-d}}function R(K){K.preventDefault();const ue=n(m).getBoundingClientRect(),Pe=K.clientX-ue.left,oe=K.clientY-ue.top,lt=n(s)+Pe/ue.width*n(a),ht=n(i)+oe/ue.height*n(r),Je=K.deltaY>0?.9:1.1,He=Math.max(A,Math.min(g,n(f)*Je)),ft=h/He,rn=u/He,Kt=lt-Pe/ue.width*ft,Q=ht-oe/ue.height*rn;w(f,He),w(y,Kt),w(v,Q)}function k(K){(K.button===1||K.button===0&&n(E))&&(K.preventDefault(),w(p,!0),x={x:K.clientX,y:K.clientY})}function S(K){if(!n(p))return;const ue=n(m).getBoundingClientRect(),Pe=(K.clientX-x.x)/ue.width*n(a),oe=(K.clientY-x.y)/ue.height*n(r);w(y,n(y)-Pe),w(v,n(v)-oe),x={x:K.clientX,y:K.clientY}}function D(){w(p,!1)}function N(K){K.code==="Space"&&!K.repeat&&K.target.tagName!=="INPUT"&&(K.preventDefault(),w(E,!0))}function re(K){K.code==="Space"&&w(E,!1)}function z(){w(f,1),w(y,0),w(v,0)}me(()=>n(f),()=>{w(a,h/n(f))}),me(()=>n(f),()=>{w(r,u/n(f))}),me(()=>n(y),()=>{w(s,n(y))}),me(()=>n(v),()=>{w(i,n(v))}),me(()=>(n(s),n(i),n(a),n(r)),()=>{w(o,`${n(s)} ${n(i)} ${n(a)} ${n(r)}`)}),me(()=>De,()=>{w(l,Array.from({length:De.width+1},(K,ue)=>ue))}),me(()=>De,()=>{w(c,Array.from({length:De.height+1},(K,ue)=>ue))}),pn();var de={screenToSvg:_};Pt();var ce=lc();ee("keydown",fa,N),ee("keyup",fa,re),ee("mouseup",fa,D),ee("mousemove",fa,S);let Y;var X=M(ce),F=C(X);T(F,"x",d),T(F,"y",d);var q=C(F);Me(q,1,()=>(ne(De),b(()=>Array(De.width+1))),We,(K,ue,Pe)=>{var oe=Vl();T(oe,"x1",d+Pe),T(oe,"y1",d),T(oe,"x2",d+Pe),Z(()=>T(oe,"y2",(ne(De),b(()=>d+De.height)))),I(K,oe)});var H=C(q);Me(H,1,()=>(ne(De),b(()=>Array(De.height+1))),We,(K,ue,Pe)=>{var oe=Ql();T(oe,"x1",d),T(oe,"y1",d+Pe),T(oe,"y2",d+Pe),Z(()=>T(oe,"x2",(ne(De),b(()=>d+De.width)))),I(K,oe)});var G=C(H);Me(G,1,()=>(ne(De),b(()=>Array(Math.floor(De.width/6)+1))),We,(K,ue,Pe)=>{var oe=Zl();T(oe,"x1",d+Pe*6),T(oe,"y1",d),T(oe,"x2",d+Pe*6),Z(()=>T(oe,"y2",(ne(De),b(()=>d+De.height)))),I(K,oe)});var P=C(G);Me(P,1,()=>(ne(De),b(()=>Array(Math.floor(De.height/6)+1))),We,(K,ue,Pe)=>{var oe=Jl();T(oe,"x1",d),T(oe,"y1",d+Pe*6),T(oe,"y2",d+Pe*6),Z(()=>T(oe,"x2",(ne(De),b(()=>d+De.width)))),I(K,oe)});var O=C(P);Me(O,1,()=>n(l),We,(K,ue)=>{var Pe=tc(),oe=Ne(Pe);T(oe,"y2",d);var lt=C(oe);{var ht=Je=>{var He=ec();T(He,"y",1.2);var ft=M(He);Z(()=>{T(He,"x",d+n(ue)),Se(ft,`${n(ue)??""}"`)}),I(Je,He)};Te(lt,Je=>{n(ue)%6===0&&Je(ht)})}Z(()=>{T(oe,"x1",d+n(ue)),T(oe,"y1",n(ue)%6===0?.5:d-.8),T(oe,"x2",d+n(ue)),T(oe,"stroke-width",n(ue)%6===0?.08:.04)}),I(K,Pe)});var W=C(O);Me(W,1,()=>n(l),We,(K,ue)=>{var Pe=ac(),oe=Ne(Pe),lt=C(oe);{var ht=Je=>{var He=nc(),ft=M(He);Z(()=>{T(He,"x",d+n(ue)),T(He,"y",(ne(De),b(()=>d+De.height+1.8))),Se(ft,`${n(ue)??""}"`)}),I(Je,He)};Te(lt,Je=>{n(ue)%6===0&&Je(ht)})}Z(()=>{T(oe,"x1",d+n(ue)),T(oe,"y1",(ne(De),b(()=>d+De.height))),T(oe,"x2",d+n(ue)),T(oe,"y2",(ne(De),n(ue),b(()=>d+De.height+(n(ue)%6===0?1.5:.8)))),T(oe,"stroke-width",n(ue)%6===0?.08:.04)}),I(K,Pe)});var J=C(W);Me(J,1,()=>n(c),We,(K,ue)=>{var Pe=rc(),oe=Ne(Pe);T(oe,"x2",d);var lt=C(oe);{var ht=Je=>{var He=sc();T(He,"x",1);var ft=M(He);Z(()=>{T(He,"y",d+n(ue)+.35),Se(ft,`${n(ue)??""}"`)}),I(Je,He)};Te(lt,Je=>{n(ue)%6===0&&Je(ht)})}Z(()=>{T(oe,"x1",n(ue)%6===0?.5:d-.8),T(oe,"y1",d+n(ue)),T(oe,"y2",d+n(ue)),T(oe,"stroke-width",n(ue)%6===0?.08:.04)}),I(K,Pe)});var ae=C(J);Me(ae,1,()=>n(c),We,(K,ue)=>{var Pe=oc(),oe=Ne(Pe),lt=C(oe);{var ht=Je=>{var He=ic(),ft=M(He);Z(()=>{T(He,"x",(ne(De),b(()=>d+De.width+1))),T(He,"y",d+n(ue)+.35),Se(ft,`${n(ue)??""}"`)}),I(Je,He)};Te(lt,Je=>{n(ue)%6===0&&Je(ht)})}Z(()=>{T(oe,"x1",(ne(De),b(()=>d+De.width))),T(oe,"y1",d+n(ue)),T(oe,"x2",(ne(De),n(ue),b(()=>d+De.width+(n(ue)%6===0?1.5:.8)))),T(oe,"y2",d+n(ue)),T(oe,"stroke-width",n(ue)%6===0?.08:.04)}),I(K,Pe)});var $e=C(ae);T($e,"transform","translate(2, 2)");var Fe=M($e);return Pi(Fe,t,"default",{screenToSvg:_}),Es(ce,K=>w(m,K),()=>n(m)),Z(()=>{T(ce,"viewBox",n(o)),Y=an(ce,0,"battlefield svelte-n43bnt",null,Y,{panning:n(p)||n(E)}),T(X,"width",(ne(De),b(()=>De.width+d*2))),T(X,"height",(ne(De),b(()=>De.height+d*2))),T(F,"width",(ne(De),b(()=>De.width))),T(F,"height",(ne(De),b(()=>De.height)))}),ee("wheel",ce,R),ee("mousedown",ce,k),ee("dblclick",ce,z),I(e,ce),Wa(t,"screenToSvg",_),kt(de)}var cc=Ce('<line stroke="#3b82f6" stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" fill="#3b82f6" stroke="#1d4ed8" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-trljjm"></circle>',1),uc=Ce('<g><g><rect role="button" tabindex="0" class="svelte-trljjm"></rect></g><!></g>');function qi(e,t){Mt(t,!1);const a=$(),r=$(),s=$(),i=$(),o=$();let l=Ae(t,"id",8),c=Ae(t,"x",8),m=Ae(t,"y",8),d=Ae(t,"width",8),h=Ae(t,"height",8),u=Ae(t,"rotation",8,0),f=Ae(t,"selected",8,!1),y=Ae(t,"screenToSvg",8),v=Ae(t,"onSelect",8,()=>{}),p=Ae(t,"onDrag",8,()=>{}),x=Ae(t,"onRotate",8,()=>{}),E=$(!1),A=!1,g={x:0,y:0};function _(q){q.stopPropagation(),v()(l())}function R(q){if(q.button!==0)return;q.preventDefault(),q.stopPropagation(),v()(l()),w(E,!0);const H=y()(q.clientX,q.clientY);g={x:H.x-c(),y:H.y-m()},window.addEventListener("mousemove",k),window.addEventListener("mouseup",S)}function k(q){if(!n(E))return;const H=y()(q.clientX,q.clientY);let G=H.x-g.x,P=H.y-g.y;q.shiftKey||(G=Math.round(G),P=Math.round(P));const O=Math.max(d(),h())/2;G=Math.max(-O,Math.min(De.width-d()+O,G)),P=Math.max(-O,Math.min(De.height-h()+O,P)),p()(l(),G,P)}function S(){w(E,!1),window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",S)}function D(q){q.preventDefault(),q.stopPropagation(),A=!0,window.addEventListener("mousemove",N),window.addEventListener("mouseup",re)}function N(q){if(!A)return;const H=y()(q.clientX,q.clientY),G=H.x-n(a),P=H.y-n(r);let O=Math.atan2(P,G)*180/Math.PI+45;q.shiftKey||(O=Math.round(O/15)*15),x()(l(),O)}function re(){A=!1,window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",re)}me(()=>(ne(c()),ne(d())),()=>{w(a,c()+d()/2)}),me(()=>(ne(m()),ne(h())),()=>{w(r,m()+h()/2)}),me(()=>(ne(d()),ne(h())),()=>{w(s,Math.max(d(),h())/2+1.5)}),me(()=>(n(a),n(s),ne(u())),()=>{w(i,n(a)+n(s)*Math.cos((u()-45)*Math.PI/180))}),me(()=>(n(r),n(s),ne(u())),()=>{w(o,n(r)+n(s)*Math.sin((u()-45)*Math.PI/180))}),pn(),Pt();var z=uc();let de;var ce=M(z),Y=M(ce),X=C(ce);{var F=q=>{var H=cc(),G=Ne(H),P=C(G);Z(()=>{T(G,"x1",n(a)),T(G,"y1",n(r)),T(G,"x2",n(i)),T(G,"y2",n(o)),T(P,"cx",n(i)),T(P,"cy",n(o))}),ee("mousedown",P,D),I(q,H)};Te(X,q=>{f()&&q(F)})}Z(()=>{de=an(z,0,"terrain-rect svelte-trljjm",null,de,{selected:f(),dragging:n(E)}),T(ce,"transform",`rotate(${u()??""}, ${n(a)??""}, ${n(r)??""})`),T(Y,"x",c()),T(Y,"y",m()),T(Y,"width",d()),T(Y,"height",h()),T(Y,"fill",f()?"rgba(59, 130, 246, 0.3)":"rgba(139, 90, 43, 0.3)"),T(Y,"stroke",f()?"#3b82f6":"#8b5a2b"),T(Y,"stroke-width",f()?.15:.1)}),ee("click",Y,_),ee("mousedown",Y,R),I(e,z),kt()}const Ui="warhammer-deployment-layouts",Ki=[{label:'6" x 12"',width:6,height:12},{label:'5" x 10"',width:5,height:10},{label:'4" x 6"',width:4,height:6}],js=[{label:"L 4x8",shape:"L-4x8"},{label:"L 4x8 â",shape:"L-4x8-mirror"},{label:"C 4-8-4",shape:"C-4-8-4"},{label:"L 5x6",shape:"L-5x6"},{label:"L 5x6 â",shape:"L-5x6-mirror"},{label:"L 4x6",shape:"L-4x6"},{label:"L 4x6 â",shape:"L-4x6-mirror"}],Gi=[{name:"Layout 1",terrains:[{id:"a",x:28,y:0,width:4,height:6,rotation:0},{id:"b",x:28,y:38,width:4,height:6,rotation:0},{id:"c",x:6,y:5,width:6,height:12,rotation:0},{id:"d",x:48,y:27,width:6,height:12,rotation:0},{id:"e",x:16,y:28,width:6,height:12,rotation:0},{id:"f",x:7,y:19,width:6,height:12,rotation:90},{id:"g",x:38,y:4,width:6,height:12,rotation:0},{id:"h",x:47,y:13,width:6,height:12,rotation:90},{id:"i",x:32.74,y:23.59,width:5,height:10,rotation:135},{id:"j",x:35.06,y:19.5,width:4,height:6,rotation:45},{id:"k",x:22.07,y:10.17,width:5,height:10,rotation:-45},{id:"l",x:20.72,y:18.23,width:4,height:6,rotation:45}],walls:[{id:"wa",x:38,y:6,shape:"C-4-8-4",rotation:0},{id:"wb",x:18,y:30,shape:"C-4-8-4",rotation:180},{id:"wc",x:13.33,y:20.15,shape:"L-4x8-mirror",rotation:-90},{id:"wd",x:49.67,y:15.93,shape:"L-4x8-mirror",rotation:90},{id:"we",x:48.2,y:30.88,shape:"L-4x8",rotation:0},{id:"wf",x:7.84,y:5.01,shape:"L-4x8",rotation:180},{id:"wg",x:27.06,y:11.52,shape:"L-4x8-mirror",rotation:-45},{id:"wh",x:35.81,y:24.24,shape:"L-4x8-mirror",rotation:135}]},{name:"Layout 2",terrains:[{id:"a",x:31,y:7,width:4,height:6,rotation:-90},{id:"b",x:25,y:30,width:4,height:6,rotation:90},{id:"c",x:5,y:4,width:6,height:12,rotation:0},{id:"d",x:49,y:28,width:6,height:12,rotation:0},{id:"e",x:46,y:4,width:6,height:12,rotation:0},{id:"f",x:16.32,y:16.13,width:6,height:12,rotation:135},{id:"g",x:53,y:15,width:4,height:6,rotation:90},{id:"h",x:8,y:28,width:6,height:12,rotation:0},{id:"i",x:3,y:23,width:4,height:6,rotation:90},{id:"j",x:32.62,y:32.55,width:5,height:10,rotation:-90},{id:"k",x:22.48,y:.51,width:5,height:10,rotation:-90},{id:"l",x:37,y:16,width:6,height:12,rotation:135}],walls:[{id:"wa",x:49,y:32,shape:"L-4x8",rotation:0},{id:"wb",x:7,y:4,shape:"L-4x8",rotation:180},{id:"wc",x:46,y:8,shape:"L-4x8",rotation:0},{id:"wd",x:10,y:28,shape:"L-4x8",rotation:180},{id:"we",x:35.07,y:34.56,shape:"L-5x6-mirror",rotation:-90},{id:"wf",x:29.09,y:2.47,shape:"L-5x6-mirror",rotation:90},{id:"wg",x:17.86,y:17.53,shape:"C-4-8-4",rotation:135},{id:"wh",x:37.24,y:18.38,shape:"C-4-8-4",rotation:-45}]},{name:"Layout 3",terrains:[{id:"a",x:11,y:3,width:4,height:6,rotation:90},{id:"b",x:45,y:35,width:4,height:6,rotation:90},{id:"c",x:25,y:1,width:6,height:12,rotation:90},{id:"d",x:29,y:31,width:6,height:12,rotation:90},{id:"e",x:7.74,y:26.05,width:6,height:12,rotation:125.31},{id:"f",x:46.34,y:5.51,width:6,height:12,rotation:121.72},{id:"g",x:5.14,y:10.46,width:6,height:12,rotation:41.51},{id:"h",x:48.67,y:21.52,width:6,height:12,rotation:41.51},{id:"i",x:19.59,y:14.36,width:5,height:10,rotation:-38.13},{id:"j",x:20.69,y:24.37,width:4,height:6,rotation:-39.33},{id:"k",x:35.34,y:19.61,width:5,height:10,rotation:-38.13},{id:"l",x:35.31,y:13.5,width:4,height:6,rotation:-39.33}],walls:[{id:"aa",x:30,y:32,shape:"C-4-8-4",rotation:90},{id:"ab",x:26,y:4,shape:"C-4-8-4",rotation:-90},{id:"ac",x:8.19,y:11.64,shape:"L-4x8",rotation:222.46},{id:"ad",x:47.79,y:24.3,shape:"L-4x8",rotation:41.26},{id:"ae",x:38.64,y:20.09,shape:"L-5x6-mirror",rotation:141.31},{id:"af",x:25.26,y:17.9,shape:"L-5x6-mirror",rotation:-37.61},{id:"ag",x:14.37,y:28.38,shape:"L-4x8-mirror",rotation:-54.26},{id:"ah",x:48.75,y:7.3,shape:"L-4x8-mirror",rotation:122.02}]},{name:"Layout 4",terrains:[{id:"a",x:15,y:1,width:6,height:12,rotation:90},{id:"b",x:8,y:10,width:4,height:6,rotation:0},{id:"c",x:4,y:19,width:4,height:6,rotation:0},{id:"d",x:7.5,y:27.68,width:6,height:12,rotation:-48.57},{id:"e",x:46.53,y:4.24,width:6,height:12,rotation:-48.57},{id:"f",x:53,y:19,width:4,height:6,rotation:0},{id:"g",x:48,y:28,width:4,height:6,rotation:0},{id:"h",x:39,y:31,width:6,height:12,rotation:90},{id:"i",x:33.03,y:2.97,width:6,height:12,rotation:-37.25},{id:"j",x:20.96,y:28.96,width:6,height:12,rotation:-37.25},{id:"k",x:16.93,y:16.51,width:5,height:10,rotation:-41.85},{id:"l",x:37.96,y:17.43,width:5,height:10,rotation:-41.85}],walls:[{id:"aa",x:18,y:4,shape:"L-4x8",rotation:-90},{id:"ab",x:9.04,y:29.01,shape:"C-4-8-4",rotation:131.97},{id:"ac",x:47,y:7,shape:"C-4-8-4",rotation:-48.54},{id:"ad",x:38,y:32,shape:"L-4x8",rotation:90},{id:"ae",x:34.42,y:7.12,shape:"L-4x8",rotation:-37.53},{id:"af",x:21.57,y:28.8,shape:"L-4x8",rotation:142.46},{id:"ag",x:15.7,y:17.01,shape:"L-5x6",rotation:137.87},{id:"ah",x:39.17,y:20.85,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 5",terrains:[{id:"aa",x:27,y:1,width:6,height:12,rotation:90},{id:"ab",x:36.53,y:12.48,width:5,height:10,rotation:-90},{id:"ac",x:13,y:3,width:4,height:6,rotation:90},{id:"ad",x:43,y:35,width:4,height:6,rotation:90},{id:"ae",x:27,y:31,width:6,height:12,rotation:90},{id:"af",x:18.43,y:21.49,width:5,height:10,rotation:-90},{id:"ag",x:1,y:23,width:4,height:6,rotation:90},{id:"ah",x:55,y:15,width:4,height:6,rotation:90},{id:"ai",x:7.83,y:30.22,width:6,height:12,rotation:-60},{id:"aj",x:46.32,y:1.58,width:6,height:12,rotation:-60},{id:"ak",x:8.74,y:10.19,width:6,height:12,rotation:65.22},{id:"al",x:45.22,y:21.75,width:6,height:12,rotation:65.22}],walls:[{id:"a1",x:28,y:32,shape:"C-4-8-4",rotation:90},{id:"a2",x:28,y:4,shape:"C-4-8-4",rotation:-90},{id:"a3",x:11.88,y:12.29,shape:"L-4x8",rotation:-114.74},{id:"a4",x:43.97,y:23.59,shape:"L-4x8",rotation:64.22},{id:"a5",x:24.91,y:23.52,shape:"L-5x6-mirror",rotation:-90.37},{id:"a6",x:39,y:14.51,shape:"L-5x6-mirror",rotation:89.9},{id:"a7",x:7.58,y:30.57,shape:"L-4x8",rotation:120.93},{id:"a8",x:48.51,y:5.28,shape:"L-4x8",rotation:-59.06}]},{name:"Layout 6",terrains:[{id:"aa",x:13,y:1,width:6,height:12,rotation:90},{id:"ab",x:6,y:10,width:4,height:6,rotation:0},{id:"ac",x:25,y:11,width:4,height:6,rotation:90},{id:"ad",x:7.34,y:27.57,width:6,height:12,rotation:-40.32},{id:"ae",x:46.69,y:4.57,width:6,height:12,rotation:-41.9},{id:"af",x:31,y:27,width:4,height:6,rotation:-90},{id:"ag",x:50,y:28,width:4,height:6,rotation:0},{id:"ah",x:41,y:31,width:6,height:12,rotation:90},{id:"ai",x:34,y:4,width:6,height:12,rotation:0},{id:"aj",x:20,y:28,width:6,height:12,rotation:0},{id:"ak",x:15.7,y:15.03,width:5,height:10,rotation:-41.85},{id:"al",x:39.43,y:19.24,width:5,height:10,rotation:-39.95}],walls:[{id:"a1",x:16,y:4,shape:"L-4x8",rotation:-90},{id:"a2",x:9.04,y:29.01,shape:"C-4-8-4",rotation:140.05},{id:"a3",x:47,y:7.16,shape:"C-4-8-4",rotation:-41.53},{id:"a4",x:40,y:32,shape:"L-4x8",rotation:90},{id:"a5",x:34.15,y:7.88,shape:"L-4x8",rotation:0},{id:"a6",x:22,y:28,shape:"L-4x8",rotation:180},{id:"a7",x:14.47,y:15.47,shape:"L-5x6",rotation:137.87},{id:"a8",x:40.53,y:22.78,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 7",terrains:[{id:"aa",x:8,y:8,width:6,height:12,rotation:0},{id:"ab",x:6,y:28,width:6,height:12,rotation:0},{id:"ac",x:7,y:39,width:4,height:6,rotation:90},{id:"ad",x:18,y:26,width:5,height:10,rotation:0},{id:"ae",x:19,y:20,width:4,height:6,rotation:0},{id:"af",x:23,y:3,width:6,height:12,rotation:0},{id:"ag",x:31,y:29,width:6,height:12,rotation:0},{id:"ah",x:37,y:18,width:4,height:6,rotation:0},{id:"ai",x:37,y:8,width:5,height:10,rotation:0},{id:"aj",x:46,y:24,width:6,height:12,rotation:0},{id:"ak",x:48,y:4,width:6,height:12,rotation:0},{id:"al",x:49,y:-1,width:4,height:6,rotation:90}],walls:[{id:"a1",x:9,y:10,shape:"L-5x6",rotation:180},{id:"a2",x:11.44,y:31.97,shape:"L-4x8-mirror",rotation:0},{id:"a3",x:19,y:20,shape:"L-4x6",rotation:180},{id:"a4",x:22.53,y:30.02,shape:"L-5x6-mirror",rotation:0},{id:"a5",x:25,y:5,shape:"C-4-8-4",rotation:180},{id:"a6",x:31,y:31,shape:"C-4-8-4",rotation:0},{id:"a7",x:37,y:18,shape:"L-4x6",rotation:0},{id:"a8",x:41.51,y:8.09,shape:"L-5x6-mirror",rotation:180},{id:"a9",x:46,y:28,shape:"L-5x6",rotation:0},{id:"a10",x:51.51,y:4.01,shape:"L-4x8-mirror",rotation:180}]},{name:"Layout 8",terrains:[{id:"aa",x:23,y:22,width:4,height:6,rotation:0},{id:"ab",x:23,y:28,width:4,height:6,rotation:0},{id:"ac",x:33,y:16,width:4,height:6,rotation:0},{id:"ad",x:33,y:10,width:4,height:6,rotation:0},{id:"ae",x:41,y:19,width:6,height:12,rotation:0},{id:"af",x:13,y:13,width:6,height:12,rotation:0},{id:"ag",x:32,y:32,width:6,height:12,rotation:0},{id:"ah",x:22,y:0,width:6,height:12,rotation:0},{id:"ai",x:9.5,y:27.68,width:6,height:12,rotation:-48.69},{id:"aj",x:44.51,y:4.35,width:6,height:12,rotation:-48.69},{id:"ak",x:6.95,y:4,width:5,height:10,rotation:53.9},{id:"al",x:48,y:30,width:5,height:10,rotation:53.9}],walls:[{id:"a1",x:32,y:34,shape:"C-4-8-4",rotation:0},{id:"a2",x:24,y:2,shape:"C-4-8-4",rotation:180},{id:"a3",x:44.68,y:19.06,shape:"L-4x8-mirror",rotation:180},{id:"a4",x:18.43,y:16.91,shape:"L-4x8-mirror",rotation:0},{id:"a5",x:46.38,y:33.13,shape:"L-5x6",rotation:52.87},{id:"a6",x:8.55,y:4.89,shape:"L-5x6",rotation:-127.66},{id:"a7",x:16,y:30.28,shape:"L-4x8-mirror",rotation:-48.62},{id:"a8",x:46.91,y:5.85,shape:"L-4x8-mirror",rotation:132.19}]}];function mc(){return"terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function xn(){const e=localStorage.getItem(Ui);if(e)try{return JSON.parse(e)}catch(t){return console.error("Failed to parse saved layouts:",t),{}}return{}}function xs(e){localStorage.setItem(Ui,JSON.stringify(e))}function zi(){const{subscribe:e,set:t,update:a}=rt([]);return{subscribe:e,set:t,update:a,add(r,s){a(i=>[...i,{id:mc(),x:30-r/2,y:22-s/2,width:r,height:s,rotation:0}])},updateTerrain(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){t([])},save(r){const s=Bt({subscribe:e}),i=xn();i[r]={terrains:s,savedAt:Date.now()},xs(i)},load(r){const s=xn();return s[r]?(t(s[r].terrains),!0):!1},deleteLayout(r){const s=xn();delete s[r],xs(s)},getSavedLayoutNames(){const r=xn();return Object.keys(r).map(s=>({name:s,savedAt:r[s].savedAt,terrainCount:r[s].terrains.length})).sort((s,i)=>i.savedAt-s.savedAt)},hasSaved(){const r=xn();return Object.keys(r).length>0}}}const zt=zi();function ji(){const{subscribe:e,set:t,update:a}=rt([]);return{subscribe:e,set:t,update:a,add(r){a(s=>[...s,{id:"wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),x:30,y:22,shape:r,rotation:0}])},updateWall(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){t([])}}}const Yt=ji(),ls=zi(),cs=ji(),us=rt(null),ms=rt(null);function wa(e){switch(e){case"L-4x8":return[{x:0,y:0},{x:.5,y:0},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];case"L-4x8-mirror":return[{x:0,y:0},{x:.5,y:0},{x:.5,y:8},{x:-4+.5,y:8},{x:-4+.5,y:8-.5},{x:0,y:8-.5}];case"C-4-8-4":return[{x:0,y:0},{x:4,y:0},{x:4,y:.5},{x:.5,y:.5},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];case"L-5x6":return[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:5,y:6-.5},{x:5,y:6},{x:0,y:6}];case"L-5x6-mirror":return[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-5+.5,y:6},{x:-5+.5,y:6-.5},{x:0,y:6-.5}];case"L-4x6":return[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:4,y:6-.5},{x:4,y:6},{x:0,y:6}];case"L-4x6-mirror":return[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-4+.5,y:6},{x:-4+.5,y:6-.5},{x:0,y:6-.5}];default:return[]}}function hr(e,t,a,r){if(e.length===0)return[];const s=e.map(x=>x.x),i=e.map(x=>x.y),o=Math.min(...s),l=Math.max(...s),c=Math.min(...i),m=Math.max(...i),d=l-o,h=m-c,u=t+o+d/2,f=a+c+h/2,y=r*Math.PI/180,v=Math.cos(y),p=Math.sin(y);return e.map(x=>{const E=t+x.x,A=a+x.y,g=E-u,_=A-f;return{x:u+g*v-_*p,y:f+g*p+_*v}})}Ut(Yt,e=>e.map(t=>hr(wa(t.shape),t.x,t.y,t.rotation)));const cn=rt(null),un=rt(null),fr=rt([]);function dc(e,t=[]){const a=Bt(zt),r=Bt(Yt),s=xn();s[e]={terrains:a,walls:r,models:t,savedAt:Date.now()},xs(s)}function hc(e){const t=xn();return t[e]?(zt.set(t[e].terrains||[]),Yt.set(t[e].walls||[]),{terrains:t[e].terrains||[],walls:t[e].walls||[],models:t[e].models||[]}):null}function fc(e){const t=xn();delete t[e],xs(t)}function yc(){const e=xn();return Object.keys(e).map(t=>({name:t,savedAt:e[t].savedAt,terrainCount:(e[t].terrains||[]).length,wallCount:(e[t].walls||[]).length,modelCount:(e[t].models||[]).length})).sort((t,a)=>a.savedAt-t.savedAt)}function Ya(){fr.set(yc())}var pc=Ce('<line stroke="#3b82f6" stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" fill="#3b82f6" stroke="#1d4ed8" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-1tez9jd"></circle>',1),vc=Ce('<g><g><path role="button" tabindex="0" class="svelte-1tez9jd"></path></g><!></g>');function yr(e,t){Mt(t,!1);const a=$(),r=$(),s=$(),i=$(),o=$(),l=$(),c=$(),m=$(),d=$(),h=$();let u=Ae(t,"id",8),f=Ae(t,"x",8),y=Ae(t,"y",8),v=Ae(t,"shape",8),p=Ae(t,"rotation",8,0),x=Ae(t,"selected",8,!1),E=Ae(t,"screenToSvg",8),A=Ae(t,"onSelect",8,()=>{}),g=Ae(t,"onDrag",8,()=>{}),_=Ae(t,"onRotate",8,()=>{});function R(W){const J=W.map($e=>$e.x),ae=W.map($e=>$e.y);return{minX:Math.min(...J),maxX:Math.max(...J),minY:Math.min(...ae),maxY:Math.max(...ae)}}let k=$(!1),S=!1,D={x:0,y:0};function N(W){W.stopPropagation(),A()(u())}function re(W){if(W.button!==0)return;W.preventDefault(),W.stopPropagation(),A()(u()),w(k,!0);const J=E()(W.clientX,W.clientY);D={x:J.x-f(),y:J.y-y()},window.addEventListener("mousemove",z),window.addEventListener("mouseup",de)}function z(W){if(!n(k))return;const J=E()(W.clientX,W.clientY);let ae=J.x-D.x,$e=J.y-D.y;W.shiftKey||(ae=Math.round(ae),$e=Math.round($e));const Fe=Math.max(n(s),n(i));ae=Math.max(-Fe,Math.min(De.width+Fe-n(s),ae)),$e=Math.max(-Fe,Math.min(De.height+Fe-n(i),$e)),g()(u(),ae,$e)}function de(){w(k,!1),window.removeEventListener("mousemove",z),window.removeEventListener("mouseup",de)}function ce(W){W.preventDefault(),W.stopPropagation(),S=!0,window.addEventListener("mousemove",Y),window.addEventListener("mouseup",X)}function Y(W){if(!S)return;const J=E()(W.clientX,W.clientY),ae=J.x-n(o),$e=J.y-n(l);let Fe=Math.atan2($e,ae)*180/Math.PI+45;W.shiftKey||(Fe=Math.round(Fe/15)*15),_()(u(),Fe)}function X(){S=!1,window.removeEventListener("mousemove",Y),window.removeEventListener("mouseup",X)}me(()=>ne(v()),()=>{w(a,wa(v()))}),me(()=>n(a),()=>{w(r,R(n(a)))}),me(()=>n(r),()=>{w(s,n(r).maxX-n(r).minX)}),me(()=>n(r),()=>{w(i,n(r).maxY-n(r).minY)}),me(()=>(ne(f()),n(r),n(s)),()=>{w(o,f()+n(r).minX+n(s)/2)}),me(()=>(ne(y()),n(r),n(i)),()=>{w(l,y()+n(r).minY+n(i)/2)}),me(()=>(n(a),ne(f()),ne(y())),()=>{w(c,n(a).length>0?`M ${n(a).map(W=>`${f()+W.x},${y()+W.y}`).join(" L ")} Z`:"")}),me(()=>(n(s),n(i)),()=>{w(m,Math.max(n(s),n(i))/2+1.5)}),me(()=>(n(o),n(m),ne(p())),()=>{w(d,n(o)+n(m)*Math.cos((p()-45)*Math.PI/180))}),me(()=>(n(l),n(m),ne(p())),()=>{w(h,n(l)+n(m)*Math.sin((p()-45)*Math.PI/180))}),pn(),Pt();var F=vc();let q;var H=M(F),G=M(H),P=C(H);{var O=W=>{var J=pc(),ae=Ne(J),$e=C(ae);Z(()=>{T(ae,"x1",n(o)),T(ae,"y1",n(l)),T(ae,"x2",n(d)),T(ae,"y2",n(h)),T($e,"cx",n(d)),T($e,"cy",n(h))}),ee("mousedown",$e,ce),I(W,J)};Te(P,W=>{x()&&W(O)})}Z(()=>{q=an(F,0,"wall-piece svelte-1tez9jd",null,q,{selected:x(),dragging:n(k)}),T(H,"transform",`rotate(${p()??""}, ${n(o)??""}, ${n(l)??""})`),T(G,"d",n(c)),T(G,"fill",x()?"rgba(139, 69, 19, 0.6)":"rgba(139, 69, 19, 0.8)"),T(G,"stroke",x()?"#3b82f6":"#5c3317"),T(G,"stroke-width",x()?.15:.1)}),ee("click",G,N),ee("mousedown",G,re),I(e,F),kt()}var gc=ye('<div class="section-content svelte-7o4pd4"><!></div>'),bc=ye('<section><div class="section-header svelte-7o4pd4" role="button" tabindex="0"><h3 class="svelte-7o4pd4"> </h3> <span class="toggle-icon svelte-7o4pd4"> </span></div> <!></section>');function Ct(e,t){let a=Ae(t,"title",8),r=Ae(t,"defaultOpen",8,!0),s=$(r());function i(){w(s,!n(s))}var o=bc();let l;var c=M(o),m=M(c),d=M(m),h=C(m,2),u=M(h),f=C(c,2);{var y=v=>{var p=gc(),x=M(p);Pi(x,t,"default",{}),I(v,p)};Te(f,v=>{n(s)&&v(y)})}Z(()=>{l=an(o,1,"collapsible-section svelte-7o4pd4",null,l,{collapsed:!n(s)}),Se(d,a()),Se(u,n(s)?"â¼":"â¶")}),ee("click",c,i),I(e,o)}var Tc=ye('<button class="svelte-10mgcx0"> </button>'),xc=ye('<div class="button-group svelte-10mgcx0"></div>'),_c=ye('<button class="svelte-10mgcx0"> </button>'),Sc=ye('<div class="button-group svelte-10mgcx0"></div>'),wc=ye('<div class="field svelte-10mgcx0"><span class="label-text svelte-10mgcx0">Size</span> <span class="value svelte-10mgcx0"> </span></div> <div class="field svelte-10mgcx0"><span class="label-text svelte-10mgcx0">Rotation</span> <span class="value svelte-10mgcx0"> </span></div>',1),Ac=ye('<div class="field svelte-10mgcx0"><span class="label-text svelte-10mgcx0">Shape</span> <span class="value svelte-10mgcx0"> </span></div> <div class="field svelte-10mgcx0"><span class="label-text svelte-10mgcx0">Rotation</span> <span class="value svelte-10mgcx0"> </span></div>',1),Cc=ye('<div class="edit-form svelte-10mgcx0"><div class="field svelte-10mgcx0"><label for="edit-x" class="svelte-10mgcx0">X (inches)</label> <input id="edit-x" type="number" step="0.1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-y" class="svelte-10mgcx0">Y (inches)</label> <input id="edit-y" type="number" step="0.1" class="svelte-10mgcx0"/></div> <!> <button class="danger svelte-10mgcx0">Remove</button></div>'),Ec=ye('<p class="hint svelte-10mgcx0">Click a piece to select it</p>'),Rc=ye('<div class="button-group vertical svelte-10mgcx0"><button class="svelte-10mgcx0">Save Layout</button> <button class="svelte-10mgcx0">Load Layout</button> <div class="button-row svelte-10mgcx0"><button class="secondary small svelte-10mgcx0">Export</button> <button class="secondary small svelte-10mgcx0">Import</button></div> <button class="secondary svelte-10mgcx0">Clear All</button></div>'),Mc=ye("<!> <!>",1),kc=ye('<div class="modal-overlay svelte-10mgcx0" role="presentation"><div class="modal svelte-10mgcx0" role="dialog"><h2 class="svelte-10mgcx0">Save Layout</h2> <div class="modal-field svelte-10mgcx0"><label for="layout-name" class="svelte-10mgcx0">Layout Name</label> <input id="layout-name" type="text" placeholder="Enter a name..." class="svelte-10mgcx0"/></div> <div class="modal-actions svelte-10mgcx0"><button class="secondary svelte-10mgcx0">Cancel</button> <button class="svelte-10mgcx0">Save</button></div></div></div>'),Dc=ye('<p class="hint svelte-10mgcx0">No saved layouts yet</p>'),Lc=ye('<div class="layout-item svelte-10mgcx0" role="button" tabindex="0"><div class="layout-info svelte-10mgcx0"><span class="layout-name svelte-10mgcx0"> </span> <span class="layout-meta svelte-10mgcx0"> </span></div> <button class="delete-btn svelte-10mgcx0" title="Delete">Ã</button></div>'),Ic=ye('<div class="layout-list svelte-10mgcx0"></div>'),Pc=ye('<div class="modal-overlay svelte-10mgcx0" role="presentation"><div class="modal svelte-10mgcx0" role="dialog"><h2 class="svelte-10mgcx0">Load Layout</h2> <!> <div class="modal-actions svelte-10mgcx0"><button class="secondary svelte-10mgcx0">Cancel</button></div></div></div>'),Nc=ye('<main class="svelte-10mgcx0"><div class="header svelte-10mgcx0"><h1 class="svelte-10mgcx0">Layout Builder</h1> <nav class="nav-links svelte-10mgcx0"><a href="#/setup" class="svelte-10mgcx0">Battlefield Setup</a> <a href="#/deployment" class="svelte-10mgcx0">Deployment</a> <a href="#/" class="active svelte-10mgcx0">Layout Builder</a> <a href="#/debug" class="svelte-10mgcx0">Debug Mode</a></nav></div> <div class="layout svelte-10mgcx0"><div class="sidebar svelte-10mgcx0"><!> <!> <!> <!> <input type="file" accept=".json" style="display: none;"/></div> <div class="battlefield-area svelte-10mgcx0"><div class="battlefield-container svelte-10mgcx0" role="presentation"><!></div> <div class="info svelte-10mgcx0"><p class="svelte-10mgcx0"> </p> <p class="hint svelte-10mgcx0">Scroll to zoom | Space+drag or middle-click to pan | Double-click to reset view</p></div></div></div></main> <!> <!>',1);function $c(e,t){Mt(t,!1);const a=()=>Ve(cn,"$selectedTerrainId",l),r=()=>Ve(un,"$selectedWallId",l),s=()=>Ve(zt,"$layoutTerrains",l),i=()=>Ve(Yt,"$layoutWalls",l),o=()=>Ve(fr,"$savedLayoutsList",l),[l,c]=ka(),m=$(),d=$();let h=$(!1),u=$(!1),f=$(""),y=null;Da(()=>{Ya(),window.addEventListener("keydown",v)}),Wi(()=>{window.removeEventListener("keydown",v)});function v(B){if(B.target.tagName==="INPUT"||n(h)||n(u))return;const he=a()||r();if((B.key==="Delete"||B.key==="Backspace")&&he){B.preventDefault(),re();return}if(he&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(B.key)){B.preventDefault();const ve=B.shiftKey?.1:1;let _e=0,pe=0;switch(B.key){case"ArrowUp":pe=-ve;break;case"ArrowDown":pe=ve;break;case"ArrowLeft":_e=-ve;break;case"ArrowRight":_e=ve;break}if(a()){const te=s().find(se=>se.id===a());te&&zt.updateTerrain(a(),{x:te.x+_e,y:te.y+pe})}else if(r()){const te=i().find(se=>se.id===r());te&&Yt.updateWall(r(),{x:te.x+_e,y:te.y+pe})}return}if(B.key==="c"&&(B.ctrlKey||B.metaKey)&&he){if(B.preventDefault(),a()){const ve=s().find(_e=>_e.id===a());ve&&(y={type:"terrain",data:{...ve}})}else if(r()){const ve=i().find(_e=>_e.id===r());ve&&(y={type:"wall",data:{...ve}})}return}if(B.key==="v"&&(B.ctrlKey||B.metaKey)&&y){if(B.preventDefault(),y.type==="terrain"){const ve="terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),_e={...y.data,id:ve,x:y.data.x+2,y:y.data.y+2};zt.update(pe=>[...pe,_e]),cn.set(ve),un.set(null),y.data.x+=2,y.data.y+=2}else if(y.type==="wall"){const ve="wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),_e={...y.data,id:ve,x:y.data.x+2,y:y.data.y+2};Yt.update(pe=>[...pe,_e]),un.set(ve),cn.set(null),y.data.x+=2,y.data.y+=2}return}if(B.key==="Escape"){R();return}}let p=$(""),x=$("");function E(B,he){zt.add(B,he)}function A(B){Yt.add(B)}function g(B){cn.set(B),un.set(null)}function _(B){un.set(B),cn.set(null)}function R(){cn.set(null),un.set(null)}function k(B,he,ve){zt.updateTerrain(B,{x:he,y:ve})}function S(B,he,ve){Yt.updateWall(B,{x:he,y:ve})}function D(B,he){zt.updateTerrain(B,{rotation:he})}function N(B,he){Yt.updateWall(B,{rotation:he})}function re(){a()?(zt.remove(a()),cn.set(null)):r()&&(Yt.remove(r()),un.set(null))}function z(){const B=parseFloat(n(p)),he=parseFloat(n(x));!isNaN(B)&&!isNaN(he)&&(a()?zt.updateTerrain(a(),{x:B,y:he}):r()&&Yt.updateWall(r(),{x:B,y:he}))}function de(){w(f,""),w(h,!0)}function ce(){n(f).trim()&&(dc(n(f).trim()),Ya(),w(h,!1),w(f,""))}function Y(){Ya(),w(u,!0)}function X(B){hc(B),cn.set(null),un.set(null),w(u,!1)}function F(B,he){he.stopPropagation(),confirm(`Delete layout "${B}"?`)&&(fc(B),Ya())}function q(){confirm("Clear all terrain and walls?")&&(zt.clear(),Yt.clear(),cn.set(null),un.set(null))}function H(B){return new Date(B).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function G(B){const he=js.find(ve=>ve.shape===B);return he?he.label:B}function P(){const B=s(),he=i(),ve={version:1,exportedAt:Date.now(),terrains:B,walls:he},_e=JSON.stringify(ve,null,2),pe=new Blob([_e],{type:"application/json"}),te=URL.createObjectURL(pe),se=document.createElement("a");se.href=te,se.download=`layout-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(se),se.click(),document.body.removeChild(se),URL.revokeObjectURL(te)}let O=$();function W(){n(O).click()}function J(B){const he=B.target.files[0];if(!he)return;const ve=new FileReader;ve.onload=_e=>{try{const pe=JSON.parse(_e.target.result);pe.terrains&&Array.isArray(pe.terrains)&&zt.set(pe.terrains),pe.walls&&Array.isArray(pe.walls)&&Yt.set(pe.walls),cn.set(null),un.set(null)}catch(pe){alert("Failed to import layout: Invalid file format"),console.error("Import error:",pe)}},ve.readAsText(he),B.target.value=""}me(()=>(s(),a()),()=>{w(m,s().find(B=>B.id===a()))}),me(()=>(i(),r()),()=>{w(d,i().find(B=>B.id===r()))}),me(()=>(n(m),n(d)),()=>{n(m)?(w(p,n(m).x.toFixed(1)),w(x,n(m).y.toFixed(1))):n(d)&&(w(p,n(d).x.toFixed(1)),w(x,n(d).y.toFixed(1)))}),pn(),Pt();var ae=Nc(),$e=Ne(ae),Fe=C(M($e),2),K=M(Fe),ue=M(K);Ct(ue,{title:"Add Terrain",children:(B,he)=>{var ve=xc();Me(ve,5,()=>Ki,We,(_e,pe)=>{var te=Tc(),se=M(te);Z(()=>Se(se,(n(pe),b(()=>n(pe).label)))),ee("click",te,()=>E(n(pe).width,n(pe).height)),I(_e,te)}),I(B,ve)},$$slots:{default:!0}});var Pe=C(ue,2);Ct(Pe,{title:"Add Wall",children:(B,he)=>{var ve=Sc();Me(ve,5,()=>js,We,(_e,pe)=>{var te=_c(),se=M(te);Z(()=>Se(se,(n(pe),b(()=>n(pe).label)))),ee("click",te,()=>A(n(pe).shape)),I(_e,te)}),I(B,ve)},$$slots:{default:!0}});var oe=C(Pe,2);{let B=ze(()=>n(m)?"Terrain":n(d)?"Wall":"Item");Ct(oe,{get title(){return`Selected ${n(B)??""}`},children:(he,ve)=>{var _e=dt(),pe=Ne(_e);{var te=j=>{var xe=Cc(),et=M(xe),Ie=C(M(et),2),U=C(et,2),Ge=C(M(U),2),Dt=C(U,2);{var tt=bt=>{var it=wc(),nt=Ne(it),ut=C(M(nt),2),Fn=M(ut),ia=C(nt,2),oa=C(M(ia),2),La=M(oa);Z(Ia=>{Se(Fn,`${n(m),b(()=>n(m).width)??""}" x ${n(m),b(()=>n(m).height)??""}"`),Se(La,`${Ia??""}Â°`)},[()=>(n(m),b(()=>Math.round(n(m).rotation)))]),I(bt,it)},Gt=bt=>{var it=dt(),nt=Ne(it);{var ut=Fn=>{var ia=Ac(),oa=Ne(ia),La=C(M(oa),2),Ia=M(La),Ms=C(oa,2),ks=C(M(Ms),2),L=M(ks);Z((ie,fe)=>{Se(Ia,ie),Se(L,`${fe??""}Â°`)},[()=>(n(d),b(()=>G(n(d).shape))),()=>(n(d),b(()=>Math.round(n(d).rotation)))]),I(Fn,ia)};Te(nt,Fn=>{n(d)&&Fn(ut)},!0)}I(bt,it)};Te(Dt,bt=>{n(m)?bt(tt):bt(Gt,!1)})}var on=C(Dt,2);ga(Ie,()=>n(p),bt=>w(p,bt)),ee("change",Ie,z),ga(Ge,()=>n(x),bt=>w(x,bt)),ee("change",Ge,z),ee("click",on,re),I(j,xe)},se=j=>{var xe=Ec();I(j,xe)};Te(pe,j=>{n(m)||n(d)?j(te):j(se,!1)})}I(he,_e)},$$slots:{default:!0}})}var lt=C(oe,2);Ct(lt,{title:"Layout",children:(B,he)=>{var ve=Rc(),_e=M(ve),pe=C(_e,2),te=C(pe,2),se=M(te),j=C(se,2),xe=C(te,2);Z(()=>pe.disabled=(o(),b(()=>o().length===0))),ee("click",_e,de),ee("click",pe,Y),ee("click",se,P),ee("click",j,W),ee("click",xe,q),I(B,ve)},$$slots:{default:!0}});var ht=C(lt,2);Es(ht,B=>w(O,B),()=>n(O));var Je=C(K,2),He=M(Je),ft=M(He);Rs(ft,{children:ar,$$slots:{default:(B,he)=>{const ve=ze(()=>he.screenToSvg);var _e=Mc(),pe=Ne(_e);Me(pe,1,s,se=>se.id,(se,j)=>{{let xe=ze(()=>(n(j),a(),b(()=>n(j).id===a())));qi(se,{get id(){return n(j),b(()=>n(j).id)},get x(){return n(j),b(()=>n(j).x)},get y(){return n(j),b(()=>n(j).y)},get width(){return n(j),b(()=>n(j).width)},get height(){return n(j),b(()=>n(j).height)},get rotation(){return n(j),b(()=>n(j).rotation)},get selected(){return n(xe)},get screenToSvg(){return n(ve)},onSelect:g,onDrag:k,onRotate:D})}});var te=C(pe,2);Me(te,1,i,se=>se.id,(se,j)=>{{let xe=ze(()=>(n(j),r(),b(()=>n(j).id===r())));yr(se,{get id(){return n(j),b(()=>n(j).id)},get x(){return n(j),b(()=>n(j).x)},get y(){return n(j),b(()=>n(j).y)},get shape(){return n(j),b(()=>n(j).shape)},get rotation(){return n(j),b(()=>n(j).rotation)},get selected(){return n(xe)},get screenToSvg(){return n(ve)},onSelect:_,onDrag:S,onRotate:N})}}),I(B,_e)}}});var rn=C(He,2),Kt=M(rn),Q=M(Kt),be=C($e,2);{var Le=B=>{var he=kc(),ve=M(he),_e=C(M(ve),2),pe=C(M(_e),2),te=C(_e,2),se=M(te),j=C(se,2);Z(xe=>j.disabled=xe,[()=>(n(f),b(()=>!n(f).trim()))]),ga(pe,()=>n(f),xe=>w(f,xe)),ee("keydown",pe,xe=>xe.key==="Enter"&&ce()),ee("click",se,()=>w(h,!1)),ee("click",j,ce),ee("click",ve,kr(function(xe){Lr.call(this,t,xe)})),ee("click",he,()=>w(h,!1)),I(B,he)};Te(be,B=>{n(h)&&B(Le)})}var Qe=C(be,2);{var Ke=B=>{var he=Pc(),ve=M(he),_e=C(M(ve),2);{var pe=xe=>{var et=Dc();I(xe,et)},te=xe=>{var et=Ic();Me(et,5,o,We,(Ie,U)=>{var Ge=Lc(),Dt=M(Ge),tt=M(Dt),Gt=M(tt),on=C(tt,2),bt=M(on),it=C(Dt,2);Z(nt=>{Se(Gt,(n(U),b(()=>n(U).name))),Se(bt,`${n(U),b(()=>n(U).terrainCount)??""} terrain${n(U),b(()=>n(U).terrainCount!==1?"s":"")??""}, ${n(U),b(()=>n(U).wallCount||0)??""} wall${n(U),b(()=>(n(U).wallCount||0)!==1?"s":"")??""} Â· ${nt??""}`)},[()=>(n(U),b(()=>H(n(U).savedAt)))]),ee("click",it,nt=>F(n(U).name,nt)),ee("click",Ge,()=>X(n(U).name)),I(Ie,Ge)}),I(xe,et)};Te(_e,xe=>{o(),b(()=>o().length===0)?xe(pe):xe(te,!1)})}var se=C(_e,2),j=M(se);ee("click",j,()=>w(u,!1)),ee("click",ve,kr(function(xe){Lr.call(this,t,xe)})),ee("click",he,()=>w(u,!1)),I(B,he)};Te(Qe,B=>{n(u)&&B(Ke)})}Z(()=>Se(Q,`Battlefield: 60" x 44" | ${s(),b(()=>s().length)??""} terrain${s(),b(()=>s().length!==1?"s":"")??""} | ${i(),b(()=>i().length)??""} wall${i(),b(()=>i().length!==1?"s":"")??""}`)),ee("change",ht,J),ee("click",He,R),I(e,ae),kt(),c()}const Xi=1/25.4,Vi=40*Xi/2,Qi=3+20*Xi;function Zi(e="item"){return e+"-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Oc(){const{subscribe:e,set:t,update:a}=rt([]);return{subscribe:e,set:t,update:a,add(r){const s=Zi("zone");return a(i=>[...i,{id:s,...r}]),s},updateZone(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){t([])}}}function Wc(){const{subscribe:e,set:t,update:a}=rt([]);return{subscribe:e,set:t,update:a,add(r,s,i=!1){const o=Zi("obj"),l=Math.round(r),c=Math.round(s);return a(m=>[...m,{id:o,x:l,y:c,isPrimary:i}]),o},updateObjective(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){t([])}}}Oc();Wc();const Yc=[{name:"Dawn of War",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:32},{type:"L",x:60,y:32},{type:"L",x:60,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:0,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:12},{type:"L",x:0,y:12},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1}]},{name:"Hammer and Anvil",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:18,y:0},{type:"L",x:18,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:42,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:42,y:44},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1}]},{name:"Tipping Point",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:12,y:0},{type:"L",x:12,y:22},{type:"L",x:20,y:22},{type:"L",x:20,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:40,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:48,y:44},{type:"L",x:48,y:22},{type:"L",x:40,y:22},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:34,isPrimary:!1},{x:22,y:8,isPrimary:!1},{x:38,y:36,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Search and Destroy",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:22},{type:"L",x:21,y:22},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:0,x:30,y:31},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:30,y:0},{type:"L",x:30,y:13},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:1,x:39,y:22},{type:"L",x:60,y:22},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:10,isPrimary:!1},{x:46,y:34,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Sweeping Engagement",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:0,y:8},{type:"L",x:30,y:8},{type:"L",x:30,y:14},{type:"L",x:60,y:14},{type:"L",x:60,y:0},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:0,y:44},{type:"L",x:60,y:44},{type:"L",x:60,y:36},{type:"L",x:30,y:36},{type:"L",x:30,y:30},{type:"L",x:0,y:30},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:18,isPrimary:!1},{x:50,y:26,isPrimary:!1},{x:18,y:38,isPrimary:!1},{x:42,y:6,isPrimary:!1}]},{name:"Crucible of Battle",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:60,y:44},{type:"L",x:30,y:0},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:20,y:8,isPrimary:!1},{x:40,y:36,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]}];function Xs(e){return e.map(t=>{switch(t.type){case"M":return`M ${t.x} ${t.y}`;case"L":return`L ${t.x} ${t.y}`;case"A":return`A ${t.rx} ${t.ry} ${t.rotation} ${t.largeArc} ${t.sweep} ${t.x} ${t.y}`;case"Z":return"Z";default:return""}}).join(" ")}const fs=rt(null),pa=rt(null),Ua=rt(null),Ji=Ut([pa,Ua],([e,t])=>{if(!e)return{terrains:[],walls:[]};if(t==="preset"){const a=Gi.find(r=>r.name===e);return a?{terrains:a.terrains||[],walls:a.walls||[]}:{terrains:[],walls:[]}}else if(t==="saved"){const a=localStorage.getItem("warhammer-deployment-layouts");if(a)try{const r=JSON.parse(a);if(r[e])return{terrains:r[e].terrains||[],walls:r[e].walls||[]}}catch(r){console.error("Failed to load layout:",r)}}return{terrains:[],walls:[]}});var Hc=ye('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),Bc=ye('<button class="svelte-1jotvmi"> </button>'),Fc=ye('<div class="button-group svelte-1jotvmi"></div>'),qc=ye('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),Uc=ye('<button class="svelte-1jotvmi"> </button>'),Kc=ye('<button class="svelte-1jotvmi"> </button>'),Gc=ye('<div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Saved</h4> <div class="button-group svelte-1jotvmi"></div></div>'),zc=ye('<div class="layout-sections svelte-1jotvmi"><div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Presets</h4> <div class="button-group svelte-1jotvmi"></div></div> <!></div>'),jc=ye('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Objectives:</span> <span class="value svelte-1jotvmi"> </span></div>'),Xc=ye('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Pieces:</span> <span class="value svelte-1jotvmi"> </span></div>'),Vc=ye('<div class="summary svelte-1jotvmi"><div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Deployment:</span> <span class="value svelte-1jotvmi"> </span></div> <div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Terrain:</span> <span class="value svelte-1jotvmi"> </span></div> <!> <!></div>'),Qc=Ce('<path stroke-width="0.10" stroke-dasharray="0.5,0.25"></path>'),Zc=Ce('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15"></circle><circle stroke="#000" stroke-width="0.06"></circle><circle r="0.15" fill="#000"></circle>',1),Jc=Ce("<!><!>",1),eu=Ce('<g><rect fill="rgba(139, 90, 43, 0.6)" stroke="#8b5a2b" stroke-width="0.1"></rect></g>'),tu=Ce('<g><path fill="rgba(139, 69, 19, 0.8)" stroke="#5c3317" stroke-width="0.1"></path></g>'),nu=Ce("<!><!><!>",1),au=ye('<main class="svelte-1jotvmi"><div class="header svelte-1jotvmi"><h1 class="svelte-1jotvmi">Battlefield Setup</h1> <nav class="nav-links svelte-1jotvmi"><a href="#/setup" class="active svelte-1jotvmi">Battlefield Setup</a> <a href="#/deployment" class="svelte-1jotvmi">Deployment</a> <a href="#/" class="svelte-1jotvmi">Layout Builder</a> <a href="#/debug" class="svelte-1jotvmi">Debug Mode</a></nav></div> <div class="layout svelte-1jotvmi"><div class="sidebar svelte-1jotvmi"><!> <!> <!></div> <div class="battlefield-area svelte-1jotvmi"><div class="battlefield-container svelte-1jotvmi"><!></div> <div class="info svelte-1jotvmi"><p class="svelte-1jotvmi">Battlefield: 60" x 44"</p> <p class="hint svelte-1jotvmi">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function su(e,t){Mt(t,!1);const a=()=>Ve(fs,"$selectedDeployment",o),r=()=>Ve(pa,"$selectedLayoutName",o),s=()=>Ve(fr,"$savedLayoutsList",o),i=()=>Ve(Ji,"$loadedTerrain",o),[o,l]=ka();Da(()=>{Ya()});function c(S){fs.set(S)}function m(S){pa.set(S.name),Ua.set("preset")}function d(S){pa.set(S),Ua.set("saved")}function h(){pa.set(null),Ua.set(null)}function u(){fs.set(null)}function f(S){let N=[];switch(S.shape){case"L-4x8":N=[{x:0,y:0},{x:.5,y:0},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];break;case"L-4x8-mirror":N=[{x:0,y:0},{x:.5,y:0},{x:.5,y:8},{x:-4+.5,y:8},{x:-4+.5,y:8-.5},{x:0,y:8-.5}];break;case"C-4-8-4":N=[{x:0,y:0},{x:4,y:0},{x:4,y:.5},{x:.5,y:.5},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];break;case"L-5x6":N=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:5,y:6-.5},{x:5,y:6},{x:0,y:6}];break;case"L-5x6-mirror":N=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-5+.5,y:6},{x:-5+.5,y:6-.5},{x:0,y:6-.5}];break;case"L-4x6":N=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:4,y:6-.5},{x:4,y:6},{x:0,y:6}];break;case"L-4x6-mirror":N=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-4+.5,y:6},{x:-4+.5,y:6-.5},{x:0,y:6-.5}];break;default:return""}return`M ${N.map(re=>`${S.x+re.x},${S.y+re.y}`).join(" L ")} Z`}function y(S){switch(S.shape){case"L-4x8":return{x:S.x+2,y:S.y+4};case"L-4x8-mirror":return{x:S.x-2+.5,y:S.y+4};case"C-4-8-4":return{x:S.x+2,y:S.y+4};case"L-5x6":return{x:S.x+2.5,y:S.y+3};case"L-5x6-mirror":return{x:S.x-2.5+.5,y:S.y+3};case"L-4x6":return{x:S.x+2,y:S.y+3};case"L-4x6-mirror":return{x:S.x-2+.5,y:S.y+3};default:return{x:S.x,y:S.y}}}Pt();var v=au(),p=C(M(v),2),x=M(p),E=M(x);Ct(E,{title:"Deployment",children:(S,D)=>{var N=dt(),re=Ne(N);{var z=ce=>{var Y=Hc(),X=M(Y),F=M(X),q=C(X,2);Z(()=>Se(F,a().name)),ee("click",q,u),I(ce,Y)},de=ce=>{var Y=Fc();Me(Y,5,()=>Yc,We,(X,F)=>{var q=Bc(),H=M(q);Z(()=>Se(H,n(F).name)),ee("click",q,()=>c(n(F))),I(X,q)}),I(ce,Y)};Te(re,ce=>{a()?ce(z):ce(de,!1)})}I(S,N)},$$slots:{default:!0}});var A=C(E,2);Ct(A,{title:"Terrain Layout",children:(S,D)=>{var N=dt(),re=Ne(N);{var z=ce=>{var Y=qc(),X=M(Y),F=M(X),q=C(X,2);Z(()=>Se(F,r())),ee("click",q,h),I(ce,Y)},de=ce=>{var Y=zc(),X=M(Y),F=C(M(X),2);Me(F,5,()=>Gi,We,(G,P)=>{var O=Uc(),W=M(O);Z(()=>Se(W,n(P).name)),ee("click",O,()=>m(n(P))),I(G,O)});var q=C(X,2);{var H=G=>{var P=Gc(),O=C(M(P),2);Me(O,5,s,We,(W,J)=>{var ae=Kc(),$e=M(ae);Z(()=>Se($e,n(J).name)),ee("click",ae,()=>d(n(J).name)),I(W,ae)}),I(G,P)};Te(q,G=>{s().length>0&&G(H)})}I(ce,Y)};Te(re,ce=>{r()?ce(z):ce(de,!1)})}I(S,N)},$$slots:{default:!0}});var g=C(A,2);Ct(g,{title:"Summary",children:(S,D)=>{var N=Vc(),re=M(N),z=C(M(re),2),de=M(z),ce=C(re,2),Y=C(M(ce),2),X=M(Y),F=C(ce,2);{var q=P=>{var O=jc(),W=C(M(O),2),J=M(W);Z(()=>Se(J,a().objectives.length)),I(P,O)};Te(F,P=>{a()&&P(q)})}var H=C(F,2);{var G=P=>{var O=Xc(),W=C(M(O),2),J=M(W);Z(()=>Se(J,`${i().terrains.length??""} terrain, ${i().walls.length??""} walls`)),I(P,O)};Te(H,P=>{(i().terrains.length>0||i().walls.length>0)&&P(G)})}Z(()=>{Se(de,a()?.name||"None"),Se(X,r()||"None")}),I(S,N)},$$slots:{default:!0}});var _=C(x,2),R=M(_),k=M(R);Rs(k,{children:(S,D)=>{var N=nu(),re=Ne(N);{var z=Y=>{var X=Jc(),F=Ne(X);Me(F,1,()=>a().zones,We,(H,G)=>{var P=Qc();Z(O=>{T(P,"d",O),T(P,"fill",n(G).color),T(P,"stroke",n(G).borderColor)},[()=>Xs(n(G).path)]),I(H,P)});var q=C(F);Me(q,1,()=>a().objectives,We,(H,G)=>{const P=ze(()=>n(G).isPrimary?"#fbbf24":"#9ca3af"),O=ze(()=>n(G).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)");var W=Zc(),J=Ne(W),ae=C(J),$e=C(ae);Z(()=>{T(J,"cx",n(G).x),T(J,"cy",n(G).y),T(J,"r",Qi),T(J,"fill",n(O)),T(J,"stroke",n(P)),T(ae,"cx",n(G).x),T(ae,"cy",n(G).y),T(ae,"r",Vi),T(ae,"fill",n(P)),T($e,"cx",n(G).x),T($e,"cy",n(G).y)}),I(H,W)}),I(Y,X)};Te(re,Y=>{a()&&Y(z)})}var de=C(re);Me(de,1,()=>i().terrains,We,(Y,X)=>{const F=ze(()=>n(X).x+n(X).width/2),q=ze(()=>n(X).y+n(X).height/2);var H=eu(),G=M(H);Z(()=>{T(H,"transform",`rotate(${n(X).rotation??""}, ${n(F)??""}, ${n(q)??""})`),T(G,"x",n(X).x),T(G,"y",n(X).y),T(G,"width",n(X).width),T(G,"height",n(X).height)}),I(Y,H)});var ce=C(de);Me(ce,1,()=>i().walls,We,(Y,X)=>{const F=ze(()=>y(n(X)));var q=tu(),H=M(q);Z(G=>{T(q,"transform",`rotate(${n(X).rotation??""}, ${n(F).x??""}, ${n(F).y??""})`),T(H,"d",G)},[()=>f(n(X))]),I(Y,q)}),I(S,N)},$$slots:{default:!0}}),I(e,v),kt(),l()}function eo(){const{subscribe:e,set:t,update:a}=rt({past:[],future:[]});return{subscribe:e,push(r){a(s=>({past:[...s.past,r],future:[]}))},undo(){let r=null;return a(s=>{if(s.past.length===0)return s;const i=[...s.past];return r=i.pop(),{past:i,future:[r,...s.future]}}),r},redo(){let r=null;return a(s=>{if(s.future.length===0)return s;const i=[...s.future];return r=i.shift(),{past:[...s.past,r],future:i}}),r},canUndo(){return Bt({subscribe:e}).past.length>0},canRedo(){return Bt({subscribe:e}).future.length>0},clear(){t({past:[],future:[]})}}}const Gn=eo(),Vs=eo(),Xe=1/25.4,Ft={circles:[{type:"25mm",radius:25*Xe/2,label:"25mm"},{type:"28.5mm",radius:28.5*Xe/2,label:"28mm.5"},{type:"32mm",radius:32*Xe/2,label:"32mm"},{type:"40mm",radius:40*Xe/2,label:"40mm"},{type:"50mm",radius:50*Xe/2,label:"50mm"},{type:"60mm",radius:60*Xe/2,label:"60mm"},{type:"80mm",radius:80*Xe/2,label:"80mm"},{type:"90mm",radius:90*Xe/2,label:"90mm"},{type:"100mm",radius:100*Xe/2,label:"100mm"},{type:"130mm",radius:130*Xe/2,label:"130mm"},{type:"160mm",radius:160*Xe/2,label:"160mm"}],ovals:[{type:"60x35.5mm",width:60*Xe,height:35.5*Xe,label:"60Ã35.5mm"},{type:"75x42mm",width:75*Xe,height:42*Xe,label:"75Ã42mm"},{type:"Small Flying Base",width:75*Xe,height:42*Xe,label:"Small Flying"},{type:"90x52.5mm",width:90*Xe,height:52.5*Xe,label:"90Ã52.5mm"},{type:"Large Flying Base",width:90*Xe,height:52.5*Xe,label:"Large Flying"},{type:"105x70mm",width:105*Xe,height:70*Xe,label:"105Ã70mm"},{type:"120x92mm",width:120*Xe,height:92*Xe,label:"120Ã92mm"},{type:"150x95mm",width:150*Xe,height:95*Xe,label:"150Ã95mm"},{type:"170x109mm",width:170*Xe,height:109*Xe,label:"170Ã109mm"}]};function Ka(e,t=null){const a=Ft.circles.find(s=>s.type===e);if(a)return a;const r=Ft.ovals.find(s=>s.type===e);return r||(pr(e)&&t?{type:e,width:t.customWidth,height:t.customHeight,label:`${t.customWidth.toFixed(1)}"Ã${t.customHeight.toFixed(1)}"`}:null)}function Ga(e){return Ft.ovals.some(t=>t.type===e)}function pr(e){return e&&e.startsWith("rect-")}function Wr(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function to(e){const{subscribe:t,set:a,update:r}=rt([]);return{subscribe:t,set:a,update:r,add(s,i,o,l,c=null,m=!1){const d=Wr(),h={id:d,baseType:s,playerId:i,x:o,y:l,rotation:0};return c&&c.width&&c.height&&(h.customWidth=c.width,h.customHeight=c.height),r(u=>[...u,h]),!m&&e&&e.push({type:"add",modelId:d,model:{...h}}),d},updateModel(s,i,o=!1){let l=null,c=null;if(!o&&e){const d=Bt({subscribe:t}).find(h=>h.id===s);d&&(l={...d},"x"in i||"y"in i?c="move":"rotation"in i&&(c="rotate"))}if(r(m=>m.map(d=>d.id===s?{...d,...i}:d)),!o&&e&&c&&l){const d=Bt({subscribe:t}).find(h=>h.id===s);e.push({type:c,modelId:s,before:c==="move"?{x:l.x,y:l.y}:{rotation:l.rotation},after:c==="move"?{x:d.x,y:d.y}:{rotation:d.rotation}})}},remove(s,i=!1){let o=null;!i&&e&&(o=Bt({subscribe:t}).find(c=>c.id===s)),r(l=>l.filter(c=>c.id!==s)),!i&&e&&o&&e.push({type:"remove",modelId:s,model:{...o}})},removeByPlayer(s){r(i=>i.filter(o=>o.playerId!==s))},addBatch(s,i=!1){const o=[];return r(l=>{const c=[...l];return s.forEach(m=>{const d=m.id||Wr(),h={...m,id:d};c.push(h),o.push(d),!i&&e&&e.push({type:"add",modelId:d,model:{...h}})}),c}),o},updateUnit(s,i,o=!1){r(l=>l.map(c=>c.unitId===s?{...c,...i}:c))},removeUnit(s,i=!1){const o=[];if(!i&&e){const l=Bt({subscribe:t});o.push(...l.filter(c=>c.unitId===s))}r(l=>l.filter(c=>c.unitId!==s)),!i&&e&&o.forEach(l=>{e.push({type:"remove",modelId:l.id,model:{...l}})})},clear(){a([]),e&&e.clear()},undo(){if(!e)return;const s=e.undo();if(s)switch(s.type){case"add":this.remove(s.modelId,!0);break;case"remove":r(i=>[...i,s.model]);break;case"move":this.updateModel(s.modelId,s.before,!0);break;case"rotate":this.updateModel(s.modelId,s.before,!0);break}},redo(){if(!e)return;const s=e.redo();if(s)switch(s.type){case"add":r(i=>[...i,s.model]);break;case"remove":this.remove(s.modelId,!0);break;case"move":this.updateModel(s.modelId,s.after,!0);break;case"rotate":this.updateModel(s.modelId,s.after,!0);break}}}}const st=to(Gn),ru=Ut(st,e=>e.filter(t=>t.playerId===1)),iu=Ut(st,e=>e.filter(t=>t.playerId===2)),Ot=rt(null);Ut([st,Ot],([e,t])=>t?e.find(a=>a.id===t):null);const In=to(Vs),zn=rt(null);Ut([In,zn],([e,t])=>t?e.find(a=>a.id===t):null);var ou=Ce('<g><rect role="button" tabindex="0" class="svelte-hycs6b"></rect></g>'),lu=Ce('<g><ellipse role="button" tabindex="0" class="svelte-hycs6b"></ellipse></g>'),cu=Ce('<circle role="button" tabindex="0" class="svelte-hycs6b"></circle>'),uu=Ce('<text text-anchor="middle" dominant-baseline="middle" font-weight="bold" fill="white" stroke="black" stroke-width="0.02" paint-order="stroke" pointer-events="none" class="model-name"> </text>'),mu=Ce('<line stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-hycs6b"></circle>',1),du=Ce('<line stroke="#fbbf24" stroke-width="0.12" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.25" fill="#fbbf24" pointer-events="none" class="svelte-hycs6b"></circle><text text-anchor="middle" dominant-baseline="middle" font-size="0.5" font-weight="bold" fill="#fbbf24" stroke="#000" stroke-width="0.05" paint-order="stroke" pointer-events="none" class="drag-ruler-label svelte-hycs6b"> </text>',1),hu=Ce("<g><!><!><!><!></g>");function Xa(e,t){Mt(t,!1);const a=$(),r=$(),s=$(),i=$(),o=$(),l=$(),c=$(),m=$(),d=$(),h=$(),u=$(),f=$(),y=$(),v=$(),p=$(),x=$(),E=$(),A=$(),g=$(),_=$(),R=$();let k=Ae(t,"id",8),S=Ae(t,"x",8),D=Ae(t,"y",8),N=Ae(t,"baseType",8),re=Ae(t,"playerId",8),z=Ae(t,"rotation",8,0),de=Ae(t,"selected",8,!1),ce=Ae(t,"marqueePreview",8,!1),Y=Ae(t,"name",8,""),X=Ae(t,"customWidth",8,null),F=Ae(t,"customHeight",8,null),q=Ae(t,"screenToSvg",8),H=Ae(t,"onSelect",8,()=>{}),G=Ae(t,"onDrag",8,()=>{}),P=Ae(t,"onDragEnd",8,()=>{}),O=Ae(t,"onRotate",8,()=>{}),W=Ae(t,"onRotateEnd",8,()=>{}),J=Ae(t,"onRename",8,()=>{}),ae=$(!1),$e=!1,Fe={x:0,y:0},K=$(null),ue=null;function Pe(te){te.stopPropagation(),H()(k(),te)}function oe(te){te.stopPropagation();const se=prompt("Model name:",Y());se!==null&&J()(k(),se)}function lt(te){if(te.button!==0)return;te.preventDefault(),te.stopPropagation(),H()(k(),te),w(ae,!0),w(K,{x:S(),y:D()});const se=q()(te.clientX,te.clientY);Fe={x:se.x-S(),y:se.y-D()},window.addEventListener("mousemove",ht),window.addEventListener("mouseup",Je)}function ht(te){if(!n(ae))return;const se=q()(te.clientX,te.clientY);let j=se.x-Fe.x,xe=se.y-Fe.y;G()(k(),j,xe)}function Je(){n(ae)&&n(K)&&((n(K).x!==S()||n(K).y!==D())&&P()(k(),n(K).x,n(K).y,S(),D()),w(K,null)),w(ae,!1),window.removeEventListener("mousemove",ht),window.removeEventListener("mouseup",Je)}function He(te){te.preventDefault(),te.stopPropagation(),$e=!0,ue=z(),window.addEventListener("mousemove",ft),window.addEventListener("mouseup",rn)}function ft(te){if(!$e)return;const se=q()(te.clientX,te.clientY),j=se.x-S(),xe=se.y-D();let et=Math.atan2(xe,j)*180/Math.PI+45;te.shiftKey||(et=Math.round(et/15)*15),O()(k(),et)}function rn(){$e&&ue!==null&&(ue!==z()&&W()(k(),ue,z()),ue=null),$e=!1,window.removeEventListener("mousemove",ft),window.removeEventListener("mouseup",rn)}me(()=>(ne(X()),ne(F())),()=>{w(a,{customWidth:X(),customHeight:F()})}),me(()=>(ne(N()),n(a)),()=>{w(r,Ka(N(),n(a)))}),me(()=>ne(N()),()=>{w(s,Ga(N()))}),me(()=>ne(N()),()=>{w(i,pr(N()))}),me(()=>ne(re()),()=>{w(o,re()===1?"#3b82f6":"#ef4444")}),me(()=>ne(re()),()=>{w(l,re()===1?"rgba(59, 130, 246, 0.5)":"rgba(239, 68, 68, 0.5)")}),me(()=>ne(re()),()=>{w(c,re()===1?"rgba(59, 130, 246, 0.3)":"rgba(239, 68, 68, 0.3)")}),me(()=>(ne(de()),ne(ce())),()=>{w(m,de()?.15:ce()?.12:.1)}),me(()=>(ne(de()),n(o),ne(ce()),n(c),n(l)),()=>{w(d,de()?n(o):ce()?n(c):n(l))}),me(()=>n(r),()=>{w(h,n(r)?.radius||.5)}),me(()=>n(r),()=>{w(u,n(r)?.width?n(r).width/2:0)}),me(()=>n(r),()=>{w(f,n(r)?.height?n(r).height/2:0)}),me(()=>(n(i),ne(X())),()=>{w(y,n(i)&&X()||0)}),me(()=>(n(i),ne(F())),()=>{w(v,n(i)&&F()||0)}),me(()=>(n(s),n(u),n(f),n(i),n(y),n(v)),()=>{w(p,n(s)?Math.max(n(u),n(f))+1:n(i)?Math.max(n(y),n(v))/2+1:0)}),me(()=>(ne(S()),n(p),ne(z())),()=>{w(x,S()+n(p)*Math.cos((z()-45)*Math.PI/180))}),me(()=>(ne(D()),n(p),ne(z())),()=>{w(E,D()+n(p)*Math.sin((z()-45)*Math.PI/180))}),me(()=>(n(ae),n(K),ne(S()),ne(D())),()=>{w(A,n(ae)&&n(K)?Math.sqrt(Math.pow(S()-n(K).x,2)+Math.pow(D()-n(K).y,2)):0)}),me(()=>(n(ae),n(K),ne(S())),()=>{w(g,n(ae)&&n(K)?(n(K).x+S())/2:0)}),me(()=>(n(ae),n(K),ne(D())),()=>{w(_,n(ae)&&n(K)?(n(K).y+D())/2:0)}),me(()=>(n(i),n(y),n(v),n(s),n(u),n(f),n(h)),()=>{w(R,n(i)?Math.min(n(y),n(v))*.2:n(s)?Math.min(n(u),n(f))*.4:n(h)*.5)}),pn(),Pt();var Kt=hu();let Q;var be=M(Kt);{var Le=te=>{var se=ou(),j=M(se);Z(()=>{T(se,"transform",`rotate(${z()??""}, ${S()??""}, ${D()??""})`),T(j,"x",S()-n(y)/2),T(j,"y",D()-n(v)/2),T(j,"width",n(y)),T(j,"height",n(v)),T(j,"fill",n(d)),T(j,"stroke",n(o)),T(j,"stroke-width",n(m))}),ee("click",j,Pe),ee("dblclick",j,oe),ee("mousedown",j,lt),I(te,se)},Qe=te=>{var se=dt(),j=Ne(se);{var xe=Ie=>{var U=lu(),Ge=M(U);Z(()=>{T(U,"transform",`rotate(${z()??""}, ${S()??""}, ${D()??""})`),T(Ge,"cx",S()),T(Ge,"cy",D()),T(Ge,"rx",n(u)),T(Ge,"ry",n(f)),T(Ge,"fill",n(d)),T(Ge,"stroke",n(o)),T(Ge,"stroke-width",n(m))}),ee("click",Ge,Pe),ee("dblclick",Ge,oe),ee("mousedown",Ge,lt),I(Ie,U)},et=Ie=>{var U=cu();Z(()=>{T(U,"cx",S()),T(U,"cy",D()),T(U,"r",n(h)),T(U,"fill",n(d)),T(U,"stroke",n(o)),T(U,"stroke-width",n(m))}),ee("click",U,Pe),ee("dblclick",U,oe),ee("mousedown",U,lt),I(Ie,U)};Te(j,Ie=>{n(s)?Ie(xe):Ie(et,!1)},!0)}I(te,se)};Te(be,te=>{n(i)?te(Le):te(Qe,!1)})}var Ke=C(be);{var B=te=>{var se=uu(),j=M(se);Z(()=>{T(se,"x",S()),T(se,"y",D()),T(se,"font-size",n(R)),Se(j,Y())}),I(te,se)};Te(Ke,te=>{Y()&&te(B)})}var he=C(Ke);{var ve=te=>{var se=mu(),j=Ne(se),xe=C(j);Z(()=>{T(j,"x1",S()),T(j,"y1",D()),T(j,"x2",n(x)),T(j,"y2",n(E)),T(j,"stroke",n(o)),T(xe,"cx",n(x)),T(xe,"cy",n(E)),T(xe,"fill",n(o)),T(xe,"stroke",re()===1?"#1d4ed8":"#b91c1c")}),ee("mousedown",xe,He),I(te,se)};Te(he,te=>{de()&&(n(s)||n(i))&&te(ve)})}var _e=C(he);{var pe=te=>{var se=du(),j=Ne(se),xe=C(j),et=C(xe),Ie=M(et);Z(U=>{T(j,"x1",(n(K),b(()=>n(K).x))),T(j,"y1",(n(K),b(()=>n(K).y))),T(j,"x2",S()),T(j,"y2",D()),T(xe,"cx",(n(K),b(()=>n(K).x))),T(xe,"cy",(n(K),b(()=>n(K).y))),T(et,"x",n(g)),T(et,"y",n(_)-.5),Se(Ie,`${U??""}"`)},[()=>(n(A),b(()=>n(A).toFixed(2)))]),I(te,se)};Te(_e,te=>{n(ae)&&n(K)&&n(A)>.1&&te(pe)})}Z(()=>Q=an(Kt,0,"model-base svelte-hycs6b",null,Q,{selected:de(),dragging:n(ae)})),I(e,Kt),kt()}var fu=Ce('<ellipse fill="none" stroke-width="2"></ellipse>'),yu=Ce('<circle fill="none" stroke-width="2"></circle>'),pu=ye('<button class="palette-item svelte-1urec28"><svg class="svelte-1urec28"><!></svg> <span class="label svelte-1urec28"> </span></button>');function _s(e,t){Mt(t,!1);const a=$(),r=$(),s=$(),i=$(),o=$(),l=$();let c=Ae(t,"baseSize",8),m=Ae(t,"playerId",8),d=Ae(t,"onDragStart",8,()=>{});const h=3;function u(g){g.button===0&&(g.preventDefault(),d()(c(),g))}me(()=>ne(m()),()=>{w(a,m()===1?"#3b82f6":"#ef4444")}),me(()=>ne(c()),()=>{w(r,c().width!==void 0)}),me(()=>(n(r),ne(c())),()=>{w(s,n(r)?null:c().radius*h)}),me(()=>(n(r),ne(c())),()=>{w(i,n(r)?c().width/2*h:null)}),me(()=>(n(r),ne(c())),()=>{w(o,n(r)?c().height/2*h:null)}),me(()=>(n(r),ne(c())),()=>{w(l,n(r)?Math.max(c().width,c().height)*h:c().radius*2*h)}),pn(),Pt();var f=pu(),y=M(f),v=M(y);{var p=g=>{var _=fu();Z(()=>{T(_,"cx",(n(l)+8)/2),T(_,"cy",(n(l)+8)/2),T(_,"rx",n(i)),T(_,"ry",n(o)),T(_,"stroke",n(a))}),I(g,_)},x=g=>{var _=yu();Z(()=>{T(_,"cx",(n(l)+8)/2),T(_,"cy",(n(l)+8)/2),T(_,"r",n(s)),T(_,"stroke",n(a))}),I(g,_)};Te(v,g=>{n(r)?g(p):g(x,!1)})}var E=C(y,2),A=M(E);Z(()=>{Ml(f,`border-color: ${n(a)??""}`),T(f,"title",(ne(c()),b(()=>c().label))),T(y,"width",n(l)+8),T(y,"height",n(l)+8),T(y,"viewBox",`0 0 ${n(l)+8} ${n(l)+8}`),Se(A,(ne(c()),b(()=>c().label)))}),ee("mousedown",f,u),I(e,f),kt()}const no="warhammer-imported-armies";function vu(){try{const e=localStorage.getItem(no);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load army imports from storage:",e),[]}}function Os(e){try{localStorage.setItem(no,JSON.stringify(e))}catch(t){console.error("Failed to save army imports to storage:",t)}}function gu(){return"import-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function bu(){const{subscribe:e,set:t,update:a}=rt(vu());return{subscribe:e,addImport(r,s,i,o){const l=gu(),c={id:l,name:r||"Unnamed Army",timestamp:Date.now(),rawText:s,parsedData:i,faction:i.FACTION_KEYWORD||"Unknown",totalPoints:i.TOTAL_ARMY_POINTS||"0pts",playerId:o};return a(m=>{const d=[...m,c];return Os(d),d}),l},removeImport(r){a(s=>{const i=s.filter(o=>o.id!==r);return Os(i),i})},getImport(r){return Bt({subscribe:e}).find(i=>i.id===r)||null},clear(){t([]),Os([])}}}const Qs=bu();var Tu=ye('<div class="error-message svelte-leqhjl"> </div>'),xu=ye('<div class="success-message svelte-leqhjl"> </div>'),_u=ye("<option> </option>"),Su=ye('<div class="army-import-panel svelte-leqhjl"><div class="form-group svelte-leqhjl"><label for="army-list-input" class="svelte-leqhjl">Paste Army List:</label> <textarea id="army-list-input" placeholder="Paste your army list here (GW App, WTC, ListForge formats supported)" rows="12" class="svelte-leqhjl"></textarea></div> <div class="button-group svelte-leqhjl"><button class="svelte-leqhjl"> </button> <button class="svelte-leqhjl">Clear</button></div> <!> <!> <div class="divider svelte-leqhjl"></div> <div class="form-group svelte-leqhjl"><label for="import-select" class="svelte-leqhjl">Load Previous Import:</label> <select id="import-select" class="svelte-leqhjl"><option>-- Select an import --</option><!></select> <button class="load-button svelte-leqhjl">Load</button></div></div>');function wu(e,t){Mt(t,!1);const a=()=>Ve(Qs,"$armyImports",r),[r,s]=ka();let i=Ae(t,"currentPlayer",8,1);const o=dr();let l=$(""),c=$(!1),m=$(""),d=$(""),h=$("");function u(){if(!n(l).trim()){w(m,"Please paste an army list");return}w(c,!0),w(m,""),w(d,""),o("parse",{text:n(l),playerId:i()})}function f(){if(!n(h))return;const P=Qs.getImport(n(h));P&&(w(l,P.rawText),w(d,`Loaded: ${P.name} (${P.faction}, ${P.totalPoints})`),w(m,""))}function y(){w(l,""),w(m,""),w(d,"")}function v(P){w(c,P)}function p(P){w(m,P),w(d,""),w(c,!1)}function x(P){w(d,P),w(m,""),w(c,!1)}function E(){w(l,"")}var A={setLoading:v,setError:p,setSuccess:x,clearText:E};Pt();var g=Su(),_=M(g),R=C(M(_),2),k=C(_,2),S=M(k),D=M(S),N=C(S,2),re=C(k,2);{var z=P=>{var O=Tu(),W=M(O);Z(()=>Se(W,`â ï¸ ${n(m)??""}`)),I(P,O)};Te(re,P=>{n(m)&&P(z)})}var de=C(re,2);{var ce=P=>{var O=xu(),W=M(O);Z(()=>Se(W,`â ${n(d)??""}`)),I(P,O)};Te(de,P=>{n(d)&&P(ce)})}var Y=C(de,4),X=C(M(Y),2);Z(()=>{n(h),Ai(()=>{n(c),a()})});var F=M(X);F.value=F.__value="";var q=C(F);Me(q,1,a,P=>P.id,(P,O)=>{var W=_u(),J=M(W),ae={};Z(()=>{Se(J,`${n(O),b(()=>n(O).name)??""} (${n(O),b(()=>n(O).faction)??""}, ${n(O),b(()=>n(O).totalPoints)??""})`),ae!==(ae=(n(O),b(()=>n(O).id)))&&(W.value=(W.__value=(n(O),b(()=>n(O).id)))??"")}),I(P,W)});var H=C(X,2);Z(P=>{R.disabled=n(c),S.disabled=P,Se(D,n(c)?"Parsing...":"Parse Army List"),N.disabled=n(c),X.disabled=n(c),H.disabled=n(c)||!n(h)},[()=>(n(c),n(l),b(()=>n(c)||!n(l).trim()))]),ga(R,()=>n(l),P=>w(l,P)),ee("click",S,u),ee("click",N,y),$i(X,()=>n(h),P=>w(h,P)),ee("click",H,f),I(e,g),Wa(t,"setLoading",v),Wa(t,"setError",p),Wa(t,"setSuccess",x),Wa(t,"clearText",E);var G=kt(A);return s(),G}var Au=ye("<option> </option>"),Cu=ye('<tr><td class="unit-name svelte-1xyf33v"> </td><td class="quantity svelte-1xyf33v"> </td><td class="svelte-1xyf33v"><select class="svelte-1xyf33v"></select></td><td class="skip-cell svelte-1xyf33v"><input type="checkbox" class="svelte-1xyf33v"/></td></tr>'),Eu=ye('<div class="dialog-overlay svelte-1xyf33v"><div class="dialog svelte-1xyf33v"><div class="dialog-header svelte-1xyf33v"><h3 class="svelte-1xyf33v">Unmatched Units</h3> <button class="close-button svelte-1xyf33v">&times;</button></div> <div class="dialog-content svelte-1xyf33v"><p class="info-text svelte-1xyf33v">The following units were not found in the database. Please select base sizes or skip them:</p> <div class="units-table svelte-1xyf33v"><table class="svelte-1xyf33v"><thead class="svelte-1xyf33v"><tr><th class="svelte-1xyf33v">Unit Name</th><th class="svelte-1xyf33v">Quantity</th><th class="svelte-1xyf33v">Base Size</th><th class="svelte-1xyf33v">Skip</th></tr></thead><tbody></tbody></table></div></div> <div class="dialog-footer svelte-1xyf33v"><button class="cancel-button svelte-1xyf33v">Cancel</button> <button class="import-button svelte-1xyf33v">Import Selected</button></div></div></div>');function Ru(e,t){Mt(t,!1);let a=Ae(t,"unmatchedUnits",24,()=>[]),r=Ae(t,"show",12,!1);const s=dr();let i=$({});const o=[...Ft.circles.map(u=>({value:u.type,label:u.label})),...Ft.ovals.map(u=>({value:u.type,label:u.label})),{value:"rect-custom",label:"Custom Rectangle (Vehicle)"}];function l(){const u=a().filter(f=>!n(i)[f.id]?.skip).map(f=>({unitName:f.unitName,quantity:f.quantity,baseType:n(i)[f.id]?.baseType||"32mm"}));s("import",{selected:u}),c()}function c(){r(!1),s("close")}me(()=>ne(a()),()=>{w(i,{}),a().forEach(u=>{Ps(i,n(i)[u.id]={baseType:"32mm",skip:!1})})}),pn(),Pt();var m=dt(),d=Ne(m);{var h=u=>{var f=Eu(),y=M(f),v=M(y),p=C(M(v),2),x=C(v,2),E=C(M(x),2),A=M(E),g=C(M(A));Me(g,5,a,S=>S.id,(S,D)=>{var N=Cu();let re;var z=M(N),de=M(z),ce=C(z),Y=M(ce),X=C(ce),F=M(X);Z(()=>{n(i),Ai(()=>{n(D)})}),Me(F,5,()=>o,We,(G,P)=>{var O=Au(),W=M(O),J={};Z(()=>{Se(W,(n(P),b(()=>n(P).label))),J!==(J=(n(P),b(()=>n(P).value)))&&(O.value=(O.__value=(n(P),b(()=>n(P).value)))??"")}),I(G,O)});var q=C(X),H=M(q);Z(()=>{re=an(N,1,"svelte-1xyf33v",null,re,{skipped:n(i)[n(D).id]?.skip}),Se(de,(n(D),b(()=>n(D).unitName))),Se(Y,(n(D),b(()=>n(D).quantity||"1x"))),F.disabled=(n(i),n(D),b(()=>n(i)[n(D).id]?.skip))}),$i(F,()=>n(i)[n(D).id].baseType,G=>Ps(i,n(i)[n(D).id].baseType=G)),Ts(H,()=>n(i)[n(D).id].skip,G=>Ps(i,n(i)[n(D).id].skip=G)),I(S,N)});var _=C(x,2),R=M(_),k=C(R,2);ee("click",p,c),ee("click",R,c),ee("click",k,l),ee("click",y,S=>S.stopPropagation()),ee("click",f,c),I(u,f)};Te(d,u=>{r()&&u(h)})}I(e,m),kt()}const Qt=rt([]),Hn=rt([]);function Yr(e,t){const a={};e.forEach(s=>{const i=s.unitId||"ungrouped";a[i]||(a[i]=[]),a[i].push(s)});const r=[];for(const s in a){const i=a[s],o=i[0];r.push({id:s,name:o.unitName||"Unknown Unit",playerId:o.playerId,modelIds:i.map(l=>l.id),importId:t})}Qt.update(s=>[...s,...e]),Hn.update(s=>[...s,...r])}function Mu(e){const a=Bt(Hn).find(r=>r.id===e);a&&(Qt.update(r=>r.filter(s=>!a.modelIds.includes(s.id))),Hn.update(r=>r.filter(s=>s.id!==e)))}function ku(e,t=30,a=22){const s=Bt(Qt).filter(c=>e.includes(c.id));if(s.length===0)return;const i=2;let o=0,l=0;s.forEach((c,m)=>{const d={...c,x:t+o,y:a+l,inStaging:!1};st.update(h=>[...h,d]),o+=i,(m+1)%5===0&&(o=0,l+=i)}),Qt.update(c=>c.filter(m=>!e.includes(m.id))),Hn.update(c=>c.map(m=>({...m,modelIds:m.modelIds.filter(d=>!e.includes(d))})).filter(m=>m.modelIds.length>0))}function Du(){Qt.set([]),Hn.set([])}Ut(Qt,e=>e.filter(t=>t.playerId===1));Ut(Qt,e=>e.filter(t=>t.playerId===2));Ut(Hn,e=>e.filter(t=>t.playerId===1));Ut(Hn,e=>e.filter(t=>t.playerId===2));var Lu=Ce('<g class="unit-group"><rect fill="none" stroke-dasharray="0.3 0.2" opacity="0.6" cursor="pointer"></rect><text text-anchor="middle" font-size="0.5" font-weight="600" pointer-events="none"> </text><g class="remove-button svelte-1lpiqbg" cursor="pointer"><circle r="0.25" fill="#dc3545" opacity="0.8" class="svelte-1lpiqbg"></circle><line stroke="white" stroke-width="0.08"></line><line stroke="white" stroke-width="0.08"></line></g></g>');function Iu(e,t){Mt(t,!1);const a=$(),r=$(),s=$(),i=$();let o=Ae(t,"unit",8),l=Ae(t,"models",24,()=>[]),c=Ae(t,"selected",8,!1),m=Ae(t,"onclick",8,()=>{}),d=Ae(t,"onremove",8,()=>{});function h(v){if(v.length===0)return{minX:0,minY:0,maxX:0,maxY:0,width:0,height:0};const p=v.map(_=>({x:_.x,y:_.y})),x=Math.min(...p.map(_=>_.x))-.5,E=Math.min(...p.map(_=>_.y))-.5,A=Math.max(...p.map(_=>_.x))+.5,g=Math.max(...p.map(_=>_.y))+.5;return{minX:x,minY:E,maxX:A,maxY:g,width:A-x,height:g-E}}me(()=>(ne(l()),ne(o())),()=>{w(a,l().filter(v=>o().modelIds.includes(v.id)))}),me(()=>n(a),()=>{w(r,h(n(a)))}),me(()=>n(r),()=>{w(s,n(r).minX+n(r).width/2)}),me(()=>n(r),()=>{w(i,n(r).minY-.3)}),pn(),Pt();var u=dt(),f=Ne(u);{var y=v=>{var p=Lu(),x=M(p),E=C(x),A=M(E),g=C(E),_=M(g),R=C(_),k=C(R);Z(()=>{T(x,"x",(n(r),b(()=>n(r).minX))),T(x,"y",(n(r),b(()=>n(r).minY))),T(x,"width",(n(r),b(()=>n(r).width))),T(x,"height",(n(r),b(()=>n(r).height))),T(x,"stroke",c()?"#ffc107":"#adb5bd"),T(x,"stroke-width",c()?"0.15":"0.08"),T(E,"x",n(s)),T(E,"y",n(i)),T(E,"fill",c()?"#333":"#6c757d"),Se(A,`${ne(o()),b(()=>o().name)??""} (${n(a),b(()=>n(a).length)??""})`),T(_,"cx",(n(r),b(()=>n(r).maxX-.3))),T(_,"cy",(n(r),b(()=>n(r).minY+.3))),T(R,"x1",(n(r),b(()=>n(r).maxX-.4))),T(R,"y1",(n(r),b(()=>n(r).minY+.2))),T(R,"x2",(n(r),b(()=>n(r).maxX-.2))),T(R,"y2",(n(r),b(()=>n(r).minY+.4))),T(k,"x1",(n(r),b(()=>n(r).maxX-.2))),T(k,"y1",(n(r),b(()=>n(r).minY+.2))),T(k,"x2",(n(r),b(()=>n(r).maxX-.4))),T(k,"y2",(n(r),b(()=>n(r).minY+.4)))}),ee("click",x,function(...S){m()?.apply(this,S)}),ee("click",g,S=>{S.stopPropagation(),d()()}),I(v,p)};Te(f,v=>{n(a),b(()=>n(a).length>0)&&v(y)})}I(e,u),kt()}var Pu=Ce('<line y1="0" y2="60" stroke="#2a2a2a" stroke-width="0.05"></line>'),Nu=Ce('<line x1="0" x2="30" stroke="#2a2a2a" stroke-width="0.05"></line>'),$u=Ce('<text text-anchor="middle" font-size="0.4" fill="#6c757d" font-weight="600" pointer-events="none">STAGING</text>'),Ou=Ce("<!><!>",1),Wu=Ce('<text x="15" y="30" text-anchor="middle" font-size="0.8" fill="#666">No models in staging</text>'),Yu=ye('<div class="staging-area svelte-cjtwzf"><div class="staging-header svelte-cjtwzf"><h3 class="svelte-cjtwzf">Staging Area</h3> <div class="button-group svelte-cjtwzf"><button class="svelte-cjtwzf"> </button> <button class="svelte-cjtwzf"> </button> <button class="clear-button svelte-cjtwzf">Clear</button></div></div> <div class="staging-canvas svelte-cjtwzf"><svg viewBox="0 0 30 60" class="staging-svg svelte-cjtwzf"><rect x="0" y="0" width="30" height="60" fill="#1a1a1a" stroke="#444" stroke-width="0.1"></rect><!><!><!><!><!></svg></div></div>');function Hu(e,t){Mt(t,!1);const a=()=>Ve(Qt,"$stagingModels",s),r=()=>Ve(Hn,"$stagingUnits",s),[s,i]=ka(),o=dr();let l=$(new Set),c=$();function m(P,O){if(!n(c))return{x:0,y:0};const W=n(c).createSVGPoint();W.x=P,W.y=O;const J=W.matrixTransform(n(c).getScreenCTM().inverse());return{x:J.x,y:J.y}}function d(P){w(l,new Set([P]))}function h(P,O,W){Qt.update(J=>J.map(ae=>ae.id===P?{...ae,x:O,y:W}:ae))}function u(P){}function f(P,O){Qt.update(W=>W.map(J=>J.id===P?{...J,rotation:O}:J))}function y(P){}function v(P,O){Qt.update(W=>W.map(J=>J.id===P?{...J,unitName:O}:J))}function p(){o("deploy",{modelIds:a().map(P=>P.id)})}function x(){o("deploy",{modelIds:Array.from(n(l))})}function E(){confirm("Clear all models from staging area?")&&(Du(),o("clear"))}function A(P){confirm("Remove this unit from staging?")&&Mu(P)}function g(P){const O=r().find(W=>W.id===P);O&&w(l,new Set(O.modelIds))}Pt();var _=Yu(),R=M(_),k=C(M(R),2),S=M(k),D=M(S),N=C(S,2),re=M(N),z=C(N,2),de=C(R,2),ce=M(de),Y=C(M(ce));Me(Y,0,()=>Array(16),We,(P,O,W)=>{var J=Pu();T(J,"x1",W*2),T(J,"x2",W*2),I(P,J)});var X=C(Y);Me(X,0,()=>Array(31),We,(P,O,W)=>{var J=Nu();T(J,"y1",W*2),T(J,"y2",W*2),I(P,J)});var F=C(X);Me(F,1,r,P=>P.id,(P,O)=>{{let W=ze(()=>n(O).modelIds.every(J=>n(l).has(J)));Iu(P,{get unit(){return n(O)},get models(){return a()},get selected(){return n(W)},onclick:()=>g(n(O).id),onremove:()=>A(n(O).id)})}});var q=C(F);Me(q,1,a,P=>P.id,(P,O)=>{var W=Ou(),J=Ne(W);{let Fe=ze(()=>n(O).name||n(O).unitName),K=ze(()=>n(l).has(n(O).id));Xa(J,{get id(){return n(O).id},get x(){return n(O).x},get y(){return n(O).y},get baseType(){return n(O).baseType},get playerId(){return n(O).playerId},get rotation(){return n(O).rotation},get name(){return n(Fe)},get customWidth(){return n(O).customWidth},get customHeight(){return n(O).customHeight},get selected(){return n(K)},screenToSvg:m,onSelect:d,onDrag:h,onDragEnd:u,onRotate:f,onRotateEnd:y,onRename:v})}var ae=C(J);{var $e=Fe=>{var K=$u();Z(()=>{T(K,"x",n(O).x),T(K,"y",n(O).y-1)}),I(Fe,K)};Te(ae,Fe=>{n(O).inStaging&&Fe($e)})}I(P,W)});var H=C(q);{var G=P=>{var O=Wu();I(P,O)};Te(H,P=>{a().length===0&&P(G)})}Es(ce,P=>w(c,P),()=>n(c)),Z(()=>{S.disabled=n(l).size===0,Se(D,`Deploy Selected (${n(l).size??""})`),N.disabled=a().length===0,Se(re,`Deploy All (${a().length??""})`),z.disabled=a().length===0}),ee("click",S,x),ee("click",N,p),ee("click",z,E),I(e,_),kt(),i()}function Wn(e){const t=e.match(/^\s*/);return t?t[0].length:0}function V(e){return e?e.toLowerCase().replace(/\s+/g," ").trim():""}function Bn(e){const t=/^(?:(\d+)x?\s+)?(.*)/,a=e.trim().match(t);if(a){const r=a[1]?`${a[1]}x`:"1x";let s=a[2].trim();return s=s.replace(/^with\s+/i,"").trim(),{quantity:r,name:s}}return{quantity:"1x",name:e.trim()}}function sn(e){return Array.isArray(e)&&e.sort((t,a)=>{const r=parseInt(String(t&&t.quantity||"1x").replace(/x/i,""),10)||1,s=parseInt(String(a&&a.quantity||"1x").replace(/x/i,""),10)||1;if(r!==s)return s-r;const i=t&&t.name?t.name.toString().toLowerCase():"",o=a&&a.name?a.name.toString().toLowerCase():"";return i<o?-1:i>o?1:0}),e}const dn={"World Eaters":"Chaos","Chaos Space Marines":"Chaos","Emperor's Children":"Chaos","Death Guard":"Chaos","Chaos Daemons":"Chaos","Chaos Knights":"Chaos","Thousand Sons":"Chaos","Space Marines":"Imperium","Iron Hands":"Space Marines",Salamanders:"Space Marines","Space Wolves":"Space Marines",Ultramarines:"Space Marines","White Scars":"Space Marines","Adepta Sororitas":"Imperium","Astra Militarum":"Imperium","Imperial Fists":"Space Marines","Dark Angels":"Space Marines","Blood Angels":"Space Marines","Raven Guard":"Space Marines","Black Templars":"Space Marines",Deathwatch:"Space Marines","Grey Knights":"Imperium","Imperial Knights":"Imperium","Adeptus Custodes":"Imperium","Adeptus Titanicus":"Imperium","Adeptus Mechanicus":"Imperium","Agents of the Imperium":"Imperium",Aeldari:"Xenos",Drukhari:"Xenos",Ynnari:"Xenos",Harlequins:"Xenos",Necrons:"Xenos",Orks:"Xenos",Tyranids:"Xenos","T'au Empire":"Xenos",Tau:"Xenos","T'au":"Xenos","Genestealer Cults":"Xenos","Leagues of Votann":"Xenos"};function ra(e){if(!e)return e;e.SUMMARY=e.SUMMARY||{};const t=e.SUMMARY;t.LIST_TITLE=t.LIST_TITLE||"",t.FACTION_KEYWORD&&(t.FACTION_KEYWORD=String(t.FACTION_KEYWORD).trim()),t.DETACHMENT&&(t.DETACHMENT=String(t.DETACHMENT).replace(/\u00A0/g," ").trim()),t.TOTAL_ARMY_POINTS&&(t.TOTAL_ARMY_POINTS=String(t.TOTAL_ARMY_POINTS).trim());const a=s=>{if(!s)return"";try{return s.toString().normalize("NFD").replace(new RegExp("\\p{M}","gu"),"").replace(/[\u2018\u2019\u201B\u2032]/g,"'").replace(/[^\w\s'\-]/g,"").toLowerCase().trim()}catch{return s.toString().toLowerCase().trim()}},r=t.FACTION_KEYWORD||null;if(r){const s=a(r);let i;for(const o of Object.keys(dn))if(a(o)===s){i=o;break}if(i){const o=r.toString().replace(/[\u2018\u2019\u201B\u2032]/g,"'").trim();t.DISPLAY_FACTION=`${dn[i]} - ${o}`}else t.DISPLAY_FACTION=t.DISPLAY_FACTION||r+(t.DETACHMENT?` - ${t.DETACHMENT}`:"")}else t.DETACHMENT?t.DISPLAY_FACTION=t.DISPLAY_FACTION||t.DETACHMENT:t.DISPLAY_FACTION=t.DISPLAY_FACTION||"";if(!t.FACTION_KEY){if(t.FACTION_KEYWORD)try{t.FACTION_KEY=t.FACTION_KEYWORD.toString().toLowerCase()}catch{t.FACTION_KEY=String(t.FACTION_KEYWORD).toLowerCase()}else if(t.DISPLAY_FACTION){const s=(t.DISPLAY_FACTION||"").split(" - ")[0];try{t.FACTION_KEY=s.toString().toLowerCase()}catch{t.FACTION_KEY=String(s).toLowerCase()}}}return e}function Kn(e,t,a,r,s="",i=!1,o="wargear"){if(!e)return;e.items=e.items||[];const l=Bn(String(t||"").trim()),c=l.quantity?String(l.quantity):"1x",m=l.name||"",d=V(m);if(i){const u=String(a||""),f=String(s||"");if(V(u)===V(m)||f&&V(f)===V(m))return}const h=e.items.find(u=>V(u.name||"")===d);if(h){const u=parseInt(String(h.quantity||"1x").replace(/x/i,""),10)||0,f=parseInt(String(c||"1x").replace(/x/i,""),10)||0;h.quantity=`${u+f}x`}else{const u=V(m)==="warlord"?"special":o;e.items.push({quantity:c,name:m,items:[],type:u,nameshort:""})}}function Bu(e,t){if(!e||!t)return;t.items=t.items||[];const a=e.trim(),r=a.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),o=V(i);if((t.items||[]).some(h=>h&&h.type==="special"&&V((h.name||"").replace(/^Enhancement:\s*/i,""))===o))return;const m=`E: ${i.split(/\s+/).map(h=>h[0]?h[0].toUpperCase():"").join("")}${s}`.trim(),d={quantity:"1x",name:`Enhancement: ${i}`,nameshort:m,items:[],type:"special"};t.items.push(d)}function Fu(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(e))return t;const a=[];let r=0;const s=h=>/^(\d+)x?\s+/i.test(String(h||"").trim()),i=(h,u)=>{const f=String(h||"").trim();if(!f)return f;if(s(f)){const y=f.match(/^(\d+)x?\s+(.*)$/i);if(y){const v=parseInt(y[1],10)||1,p=y[2].trim();return`${Math.max(1,v*(parseInt(u,10)||1))}x ${p}`}return f}return`${u}x ${f}`};for(;r<e.length;r++){const u=(e[r]||"").trim();if(u){if(u.startsWith("+")||u.startsWith("&")){a.push(u);continue}break}}for(const h of a){if(h.startsWith("&")){const v=h.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);v&&(v[1].trim(),(v[3]||"").trim());continue}const f=h.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(f){const y=f[1].trim().toUpperCase(),v=f[2].trim();if(y==="FACTION KEYWORD"){const p=v.split(" - ");t.SUMMARY.FACTION_KEYWORD=p[p.length-1].trim()}else y==="DETACHMENT"?t.SUMMARY.DETACHMENT=v.replace(/\u00A0/g," "):y==="TOTAL ARMY POINTS"&&(t.SUMMARY.TOTAL_ARMY_POINTS=v)}}if(t.SUMMARY.LIST_TITLE="",t.SUMMARY&&t.SUMMARY.FACTION_KEYWORD){const h=t.SUMMARY.FACTION_KEYWORD,u=Object.keys(dn).find(y=>y.toLowerCase()===(h||"").toString().toLowerCase()),f=u?dn[u]:null;f?t.SUMMARY.DISPLAY_FACTION=`${f} - ${h}`:t.SUMMARY.DISPLAY_FACTION=h+(t.SUMMARY.DETACHMENT?` - ${t.SUMMARY.DETACHMENT}`:"");try{t.SUMMARY.FACTION_KEY=h.toString().toLowerCase()}catch{}}let o=null,l=null;const c=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,m=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;for(;r<e.length;r++){const h=e[r]||"",u=h.trim();if(!u)continue;if(/^Enhancement:\s*/i.test(u)){const x=u.replace(/^Enhancement:\s*/i,"").trim();l&&Bu(x,l);continue}const f=u.match(c);if(f){const x=f[1],E=f[2]?`${f[2]}x`:"1x",A=(f[3]||"").trim(),g=parseInt(f[4],10)||0,_=f[5],R={quantity:E,name:A,points:g,items:[],isComplex:!1,nameshort:""};x?(t.CHARACTER.push(R),l=R):(t["OTHER DATASHEETS"]=t["OTHER DATASHEETS"]||[],t["OTHER DATASHEETS"].push(R)),o=R,_&&_.split(",").map(k=>k.trim()).filter(Boolean).forEach(k=>Kn(R,k,R.name,t.SUMMARY.FACTION_KEYWORD||"",R.name,!0));continue}const y=h.match(m);if(y){const x=y[1].trim(),E=x.match(/^(\d+)\s+with\s+(.*)$/i);if(E&&o){const _=parseInt(E[1],10)||1,R=E[2],k=o.items&&o.items.length>0?o.items[o.items.length-1]:o;R.split(",").map(S=>S.trim()).filter(Boolean).forEach(S=>{const D=i(S,_);Kn(k,D,k.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const A=x.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(A&&o){const _=A[1],R=A[2].trim(),k=A[3]||"",S={quantity:_,name:R,items:[],type:"subunit"};if(o.items=o.items||[],o.items.push(S),k){const D=k.match(/^(\d+)\s+with\s+(.*)$/i);if(D){const N=parseInt(D[1],10)||1;D[2].split(",").map(z=>z.trim()).filter(Boolean).forEach(z=>{const de=i(z,N);Kn(S,de,S.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)})}else k.split(",").map(N=>N.trim()).filter(Boolean).forEach(N=>Kn(S,N,S.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0))}continue}const g=x.match(/^(\d+x?)\s+(.*)$/i);if(g&&o){const _={quantity:g[1],name:g[2].trim(),items:[],type:"subunit"};o.items=o.items||[],o.items.push(_);continue}if(o){Kn(o,x,o.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0);continue}continue}const v=u.match(/^(\d+)\s+with\s+(.*)$/i);if(v&&o){const x=parseInt(v[1],10)||1,E=v[2],A=o.items&&o.items.length>0?o.items[o.items.length-1]:o;E.split(",").map(g=>g.trim()).filter(Boolean).forEach(g=>{const _=i(g,x);Kn(A,_,A.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const p=u.match(/^(.*?):\s*(.*)$/);if(p&&o){(p[2]||"").split(",").map(E=>E.trim()).filter(Boolean).forEach(E=>Kn(o,E,o.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0));continue}}const d=[...t.CHARACTER||[],...t["OTHER DATASHEETS"]||[]];for(const h of d){h&&Array.isArray(h.items)&&h.items.length>0&&sn(h.items);const u=h&&Array.isArray(h.items)?h.items.filter(f=>f&&f.type==="subunit"):[];for(const f of u)f&&Array.isArray(f.items)&&f.items.length>0&&sn(f.items)}return ra(t),t}function en(e,t,a,r,s="",i=!1,o="wargear"){if(!e)return;e.items=e.items||[];const l=String(t||"").trim();if(/battlesuit support system|homing beacon|marker drone/i.test(l))try{Ht.push(`processing raw=${l} for target=${e&&e.name}`)}catch{}let c=l.split(",").map(g=>g.trim()).filter(Boolean);try{const g=new Set;c=c.filter(_=>{const R=V(va(bn(_)));return g.has(R)?!1:(g.add(R),!0)})}catch{}try{/stealth shas'vre|stealth battlesuits/i.test((e&&e.name||"")+(s||"")+l)&&Ht.push(`splitParts target=${e&&e.name} top=${s} parts=${JSON.stringify(c)}`)}catch{}if(c.length>1){c.forEach(g=>en(e,g,a,r,s,i,o));return}const m=Bn(l),d=m.quantity!==void 0&&m.quantity!==null;let h=d?String(m.quantity):"1x",u=m.name||"";try{u=va(bn(u))}catch{}const f=/battlesuit support system|homing beacon|marker drone/i;try{const g=u.toLowerCase();if(g.includes("battlesuit support system")||g.includes("homing beacon")||g.includes("marker drone"))try{Ht.push(`addItemToTarget target=${e&&e.name} raw=${l}`)}catch{}}catch{}const y=u.match(/^(\d+)x\s+(.*)$/i);if(y){const g=parseInt(y[1],10)||1,_=parseInt(String(h||"1x").replace(/x/i,""),10)||1;h=`${Math.max(1,_*g)}x`,u=y[2]}try{Ht.push(`PARSE_QTY name=${u} parsedQtyRaw=${String(m.quantity||"")} qtyToken=${h}`)}catch{}let v=(g=>isNaN(g)?1:g)(parseInt(String(h||"1x").replace(/x/i,""),10)),p=v;try{if(e&&e.type==="subunit"){const g=parseInt(String(e.quantity||"1x").replace(/[^0-9]/g,""),10)||1;try{Ht.push(`CALC_EFFECTIVE target=${e&&e.name} parentQty=${g} parsedQty=${v} hasExplicit=${d}`)}catch{}p=d?v:g;try{Ht.push(`EFFECTIVE_QTY target=${e&&e.name} effectiveQty=${p}`)}catch{}}}catch{}const x=u,E=V(u);if(i){const g=String(a||""),_=String(s||"");if(V(g)===V(u)||_&&V(_)===V(u)){if(f.test(u))try{Ht.push(`SKIP matched unitname name=${u} ctx=${g} top=${_}`)}catch{}return}}const A=e.items.find(g=>V(g.name||"")===E);if(A){const g=parseInt(String(A.quantity||"1x").replace(/x/i,""),10)||0,_=g+p;A.quantity=`${_}x`;try{Ht.push(`UPDATED existing name=${u} existing=${g} added=${p} new=${_} target=${e&&e.name}`)}catch{}}else{const g=V(u)==="warlord"?"special":o;e.items.push({quantity:`${p}x`,name:x,items:[],type:g,nameshort:""});try{Ht.push(`PUSHED new name=${u} quantity=${p} target=${e&&e.name}`)}catch{}}}function bn(e){if(!e)return e;const t=e.toLowerCase();return t.includes("shield")&&t.includes("drone")?"Shield Drone":t.includes("marker")&&t.includes("drone")?"Marker Drone":t.includes("marker")&&t.includes("beacon")?"Homing Beacon":e}function va(e){return e&&e.split(/\s+/).map(t=>!t||/[A-Z]/.test(t.slice(1))?t:t[0].toUpperCase()+t.slice(1).toLowerCase()).join(" ")}function Hr(e,t){if(!t)return`${e}x`;const a=String(t).trim(),r=a.match(/^(\d+)x\s+(.*)$/i);if(r){const s=parseInt(r[1],10)||1,i=r[2]||"";return`${Math.max(1,e*s)}x ${i}`}return`${e}x ${a}`}function qu(e,t){if(!e||!t)return;t.items=t.items||[];const a=e.trim(),r=a.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),o=V(i);if((t.items||[]).some(h=>{if(!h||!h.name)return!1;const u=String(h.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]+\)$/,"").trim();return V(u)===o}))return;const m=`E: ${i.split(/\s+/).map(h=>h[0]?h[0].toUpperCase():"").join("")}${s}`.trim(),d={quantity:"1x",name:`Enhancement: ${i}`,nameshort:m,items:[],type:"special"};t.items.push(d)}function Uu(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(e))return t;const a=[];let r=0;for(;r<e.length;r++){const d=(e[r]||"").trim();if(d){if(d.startsWith("+")){a.push(d);continue}if(!d.startsWith("&"))break}}for(const m of a){const h=m.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(h){const u=h[1].trim().toUpperCase(),f=h[2].trim();if(u==="FACTION KEYWORD"){const y=f.split(" - ");t.SUMMARY.FACTION_KEYWORD=y[y.length-1].trim()}else u==="DETACHMENT"?t.SUMMARY.DETACHMENT=f.replace(/\u00A0/g," "):u==="TOTAL ARMY POINTS"&&(t.SUMMARY.TOTAL_ARMY_POINTS=f)}}if(t.SUMMARY.LIST_TITLE="",t.SUMMARY&&t.SUMMARY.FACTION_KEYWORD){const m=t.SUMMARY.FACTION_KEYWORD,d=Object.keys(dn).find(u=>u.toLowerCase()===(m||"").toString().toLowerCase()),h=d?dn[d]:null;h?t.SUMMARY.DISPLAY_FACTION=`${h} - ${m}`:t.SUMMARY.DISPLAY_FACTION=m+(t.SUMMARY.DETACHMENT?` - ${t.SUMMARY.DETACHMENT}`:"");try{t.SUMMARY.FACTION_KEY=m.toString().toLowerCase()}catch{}}const s=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,i=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;let o=null,l=null;for(;r<e.length;r++){const m=e[r]||"",d=m.trim();if(!d)continue;if(/^Enhancement:\s*/i.test(d)){const v=d.replace(/^Enhancement:\s*/i,"").trim();l&&qu(v,l);continue}const h=d.match(s);if(h){const v=h[1],p=h[2]?`${h[2]}x`:"1x",x=(h[3]||"").trim(),E=parseInt(h[4],10)||0,A=h[5],g={quantity:p,name:x,points:E,items:[],isComplex:!1,nameshort:"",charId:v||null};v?(t.CHARACTER.push(g),l=g):(t["OTHER DATASHEETS"]=t["OTHER DATASHEETS"]||[],t["OTHER DATASHEETS"].push(g)),o=g,A&&A.split(",").map(_=>_.trim()).filter(Boolean).forEach(_=>en(g,_,g.name,t.SUMMARY.FACTION_KEYWORD||"",g.name,!0));continue}const u=m.match(i);if(u){const v=u[1].trim(),p=v.match(/^(\d+)\s+with\s+(.*)$/i);if(p&&o){const A=parseInt(p[1],10)||1,g=p[2],_=o.items&&o.items.length>0?o.items[o.items.length-1]:o;try{Ht.push(`WITHMATCH unit=${o.name} target=${_&&_.name} n=${A} rest=${g}`)}catch{}g.split(",").map(R=>R.trim()).filter(Boolean).forEach(R=>{const S=va(bn(R));if(_&&_.type==="subunit"){try{Ht.push(`WITH->SUB target=${_.name} item=${S} n=${A}`)}catch{}en(_,`${A}x ${S}`,_.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}else{try{Ht.push(`WITH->UNIT unit=${o.name} item=${S} n=${A}`)}catch{}en(_,Hr(A,S),_.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}});continue}const x=v.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(x&&o){const A=x[1],g=x[2].trim(),_=x[3]||"",R={quantity:A,name:g,items:[],type:"subunit",_parent:o};if(o.items=o.items||[],o.items.push(R),_){const k=_.match(/^(\d+)\s+with\s+(.*)$/i);k?k[2].split(",").map(D=>D.trim()).filter(Boolean).forEach(D=>{const N=bn(D);en(R,N,R.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}):_.split(",").map(S=>S.trim()).filter(Boolean).forEach(S=>{const D=bn(S);en(R,D,R.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)})}continue}const E=v.match(/^(\d+x?)\s+(.*)$/i);if(E&&o)if(o.charId){const A=E[1],g=E[2].trim();en(o,`${A} ${g}`,o.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0);continue}else{const A={quantity:E[1],name:E[2].trim(),items:[],type:"subunit",_parent:o};o.items=o.items||[],o.items.push(A);continue}if(o){let A=v.split(",").map(_=>_.trim()).filter(Boolean);try{const _=o.items&&o.items.length>0?o.items[o.items.length-1]:null;_&&_.name&&(A=A.map(R=>{const k=R.match(/^(.*)\s*\(([^)]+)\)\s*$/);if(k){const S=k[1].trim();if(V(S)===V(_.name))return S}return R}))}catch{}try{const _=new Set;A=A.filter(R=>{const k=V(va(bn(R)));return _.has(k)?!1:(_.add(k),!0)})}catch{}let g=o;if(o.items&&o.items.length>0){const _=o.items[o.items.length-1];_&&_.type==="subunit"&&(g=_)}A.forEach(_=>{const R=va(bn(_));en(g,R,g.name||o.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}continue}const f=d.match(/^(\d+)\s+with\s+(.*)$/i);if(f&&o){const v=parseInt(f[1],10)||1,p=f[2],x=o.items&&o.items.length>0?o.items[o.items.length-1]:o;p.split(",").map(E=>E.trim()).filter(Boolean).forEach(E=>{const g=va(bn(E));x&&x.type==="subunit"?en(x,`${v}x ${g}`,x.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0):en(x,Hr(v,g),x.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const y=d.match(/^(.*?):\s*(.*)$/);if(y&&o){(y[2]||"").split(",").map(p=>p.trim()).filter(Boolean).forEach(p=>{const x=bn(p);en(o,x,o.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}}const c=[...t.CHARACTER||[],...t["OTHER DATASHEETS"]||[]];for(const m of c){m&&Array.isArray(m.items)&&m.items.length>0&&sn(m.items);const d=m&&Array.isArray(m.items)?m.items.filter(h=>h&&h.type==="subunit"):[];for(const h of d)h&&Array.isArray(h.items)&&h.items.length>0&&sn(h.items)}ra(t);try{t.SUMMARY._parseDebug=(Ht||[]).slice(0,200)}catch{}return t}const Ht=[];function ds(e){const t=Wn(e);if(t>0)return t;const a=(e||"").trim();return a.startsWith("â¦")||a.startsWith("+")?2:0}function hs(e){if(!e)return"";const t=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(e).split(/\s+/).map((a,r)=>{if(!a)return"";const s=a.toLowerCase();return r>0&&t.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function ua(e,t,a,r,s="",i=!1,o="wargear",l=1){if(!e)return;e.items=e.items||[];const c=Bn(String(t||"").trim()),m=c.quantity?String(c.quantity):"1x",d=c.name||"",h=V(d);if(i){const f=String(a||""),y=String(s||"");if(V(f)===V(d)||y&&V(y)===V(d))return}const u=e.items.find(f=>V(f.name||"")===h);if(u){const f=parseInt(String(u.quantity||"1x").replace(/x/i,""),10)||0,y=parseInt(String(m||"1x").replace(/x/i,""),10)||0;u.quantity=`${f+y}x`}else{const f=V(d)==="warlord"?"special":o;e.items.push({quantity:m,name:d,items:[],type:f,nameshort:""})}}function Br(e,t,a){if(!e||!t)return;t.items=t.items||[];const r=e.trim(),s=r.match(/\(([^)]+)\)$/),i=s?` (${s[1]})`:"",o=r.replace(/\s*\([^)]+\)$/,"").trim(),l=V(o);if((t.items||[]).some(u=>u&&u.type==="special"&&V((u.name||"").replace(/^Enhancement:\s*/i,""))===l))return;const d=`E: ${o.split(/\s+/).map(u=>u[0]?u[0].toUpperCase():"").join("")}${i}`.trim(),h={quantity:"1x",name:`Enhancement: ${o}`,nameshort:d,items:[],type:"special"};t.items.push(h)}function Ku(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=e.findIndex(u=>a.test((u||"").trim().toUpperCase()));let i=(r===-1?e.slice(0,0):e.slice(0,r)).map(u=>(u||"").trim()).filter(u=>u&&!u.startsWith("Exported with"));const o=i.findIndex(u=>u&&u.trim()!=="");if(o!==-1){const u=i[o],f=u.match(/^(.*?)\s*\((\s*\d+\s*(?:pts|points)\s*)\)\s*$/i);if(f){t.SUMMARY.LIST_TITLE=f[1].trim();const R=(f[2].match(/(\d+)/)||[])[1]||"";R&&(t.SUMMARY.TOTAL_ARMY_POINTS=`${R}pts`)}else t.SUMMARY.LIST_TITLE=u;const y=[];for(let R=o+1;R<i.length;R++){const k=i[R];k&&y.push(k)}const v=["Combat Patrol","Incursion","Strike Force","Onslaught"],p=R=>{if(!R||!/\(/.test(R))return!1;for(const k of v)if(new RegExp(k,"i").test(R))return!0;return!1},x=new Set(Object.values(dn).map(R=>(R||"").toString().toLowerCase())),E=y.filter(R=>!(!R||p(R)||x.has(R.toLowerCase())));let A=null,g=null;const _=Object.keys(dn).map(R=>R.toLowerCase());for(const R of E)_.includes((R||"").toString().toLowerCase())?A=R:g||(g=R);if(!A&&E.length>0&&(A=E[0],g=E.length>1?E[1]:g),A&&(t.SUMMARY.FACTION_KEYWORD=A),g&&(t.SUMMARY.DETACHMENT=g),A){const R=Object.keys(dn).find(S=>S.toLowerCase()===A.toLowerCase()),k=R?dn[R]:null;k?t.SUMMARY.DISPLAY_FACTION=`${k} - ${A}`:t.SUMMARY.DISPLAY_FACTION=A+(g?` - ${g}`:"");try{t.SUMMARY.FACTION_KEY=A.toString().toLowerCase()}catch{}}}const l=r===-1?0:r,c=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*$/i,m=/^\s*(?:â¢|\-|\+|â¦)\s*(.*)$/;let d=null;for(let u=l;u<e.length;u++){const y=(e[u]||"").trim();if(!y||y.startsWith("Exported with"))continue;if(a.test(y.toUpperCase())){d=/^CHARACTERS?/i.test(y)?"CHARACTER":"OTHER DATASHEETS";continue}const v=y.match(c);if(v){const p=v[1].trim(),x=parseInt(String(v[2]).replace(/[\,\.\s]/g,""),10)||0;let E="1x",A=p;const g=p.match(/^([0-9]+x?)\s+(.*)$/i);g&&(E=g[1].toLowerCase(),A=g[2].trim());const _={quantity:E,name:A,points:x,items:[],isComplex:!1,nameshort:""},R=d==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";t[R]=t[R]||[],t[R].push(_);const k=[];let S=u+1;for(;S<e.length;){const z=e[S]||"";if(!z.trim()||a.test(z.trim().toUpperCase())||c.test(z.trim())||!/^\s+/.test(z)&&!m.test(z))break;k.push(z),S++}const D=(()=>{for(let z=0;z<k.length;z++){const de=k[z];if(!de.match(m))continue;const Y=ds(de);for(let X=z+1;X<k.length;X++){const F=k[X];if(!F.trim()||ds(F)<=Y)break;if(m.test(F))return!0}}return!1})();let N=null,re=0;for(let z=0;z<k.length;z++){const de=k[z],ce=de.trim(),Y=de.match(m),X=ds(de);if(Y){const F=Y[1].trim(),q=F.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(F)){Br(F.replace(/^Enhancement:\s*/i,"").trim(),_,t.SUMMARY.FACTION_KEYWORD||"");continue}else if(q){Br(F.trim(),_,t.SUMMARY.FACTION_KEYWORD||"");continue}if(D){if(N&&typeof re=="number"&&X>re){ua(N,F,N.name,t.SUMMARY.FACTION_KEYWORD||"",_.name,!1);continue}if(!(()=>{for(let J=z+1;J<k.length;J++){const ae=k[J];if(!ae.trim()||ds(ae)<=X)break;if(m.test(ae))return!0}return!1})()){N=null,ua(_,F,_.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}N=null;const G=F.match(/^(\d+x?)\s+(.*)$/i),P=G?G[1]:"1x",O=G?G[2].trim():F,W={quantity:P,name:O,items:[],type:"subunit"};_.items=_.items||[],_.items.push(W),N=W,re=X;continue}ua(_,F,_.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(N&&X>re){ua(N,ce,N.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}ua(_,ce,_.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1)}u=S-1;continue}}function h(u,f){if(!(!u||typeof u!="object")){if(typeof u.name!="string"&&(u.name=""),typeof u.quantity!="string"&&(u.quantity=u.quantity?String(u.quantity):"1x"),typeof u.type!="string"&&(u.type=u.type||"wargear"),typeof u.nameshort!="string"&&(u.nameshort=u.nameshort||""),Array.isArray(u.items)||(u.items=[]),/^Enhancement:/i.test(u.name)){const y=u.name.replace(/^Enhancement:\s*/i,"").trim();u.type="special",u.nameshort=u.nameshort||(()=>{const v=y.match(/\(([^)]+)\)$/),p=v?` (${v[1]})`:"";return`E: ${y.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(A=>A[0]?A[0].toUpperCase():"").join("")}${p}`.trim()})(),u.name=`Enhancement: ${hs(y.replace(/\s*\([^)]+\)$/,"").trim())}`}else u.name=f?u.name:hs(u.name);V(u.name)==="warlord"&&(u.type="special"),u.items=(u.items||[]).map(y=>{if(!y)return null;if(typeof y=="string"){const v={quantity:"1x",name:y.trim(),items:[],type:/^Enhancement:/i.test(y)?"special":"wargear",nameshort:""};return h(v,u.name),v.name&&(v.name=hs(v.name)),v}return h(y,u.name),y&&y.name&&(y.name=hs(y.name)),y}).filter(Boolean)}}for(const u of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(t[u]))for(const f of t[u]){h(f);const y=(f.items||[]).filter(v=>v&&v.type==="subunit");if(y.length>0)if(y.every(p=>V(p.name||"")===V(f.name||""))){const p=new Map;let x=0;for(const E of y){const A=parseInt(String(E.quantity||"1x").replace(/x/i,""),10)||1;x+=A;for(const g of E.items||[]){const _={items:[]};ua(_,`${g.quantity||"1x"} ${g.name}`,f.name,t.SUMMARY.FACTION_KEYWORD||"",g.type||"wargear",1);for(const R of _.items){const k=V(R.name||"");if(p.has(k)){const S=p.get(k),D=parseInt(String(S.quantity||"1x").replace(/x/i,""),10)||0,N=parseInt(String(R.quantity||"1x").replace(/x/i,""),10)||0;S.quantity=`${D+N}x`}else p.set(k,R)}}}f.items=Array.from(p.values()),x>0&&(f.quantity=`${x}x`),f.isComplex=!1}else{const p=y.reduce((x,E)=>x+(parseInt(String(E.quantity||"1x").replace(/x/i,""),10)||0),0);p>0&&(f.quantity=`${p}x`),f.isComplex=!0}else f.isComplex=!1;Array.isArray(f.items)&&f.items.length>0&&sn(f.items)}return ra(t),t}function Fr(e){if(!e)return"";const t=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(e).split(/\s+/).map((a,r)=>{if(!a)return"";const s=a.toLowerCase();return r>0&&t.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function Pn(e,t,a,r,s="",i=!1,o="wargear",l=1){if(!e)return;e.items=e.items||[];const c=Bn(String(t||"").trim()),m=c.quantity?String(c.quantity):"1x",d=parseInt(String(m||"1x").replace(/[^0-9]/g,""),10)||1,h=`${d*(l||1)}x`;let u=c.name||"";if(!i)try{const v=u.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(v){const p=v[1].trim(),x=v[2].trim(),E=V(p),A=V(a||""),g=V(s||"");E&&(E===A||E===g||A.startsWith(E+" ")||g.startsWith(E+" ")||E.startsWith(A+" ")||E.startsWith(g+" "))&&(u=x)}}catch{}const f=V(u);if(i){const v=String(a||""),p=String(s||""),x=V(u),E=V(v),A=V(p),g=E&&x.startsWith(E+" "),_=A&&x.startsWith(A+" ");if(E&&(x===E||g)||A&&(x===A||_)){const R=u.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(R){const k=R[1].trim(),S=R[2].trim(),D=V(k);if(D===E||D===A||D.startsWith(E+" ")||D.startsWith(A+" ")){if(e&&e._deferredParenthetical&&V(e._deferredParenthetical)===V(S)||e&&e._deferredParenthetical&&V(e._deferredParenthetical)===V(S)||(e.items||[]).some(re=>V(re.name||"")===V(S)))return;Pn(e,S,a,r,s,!1,o,d);return}}return}}const y=e.items.find(v=>V(v.name||"")===f);if(y){const v=parseInt(String(y.quantity||"1x").replace(/x/i,""),10)||0,p=parseInt(String(h||"1x").replace(/x/i,""),10)||0;y.quantity=`${v+p}x`}else{const v=V(u)==="warlord"?"special":o;e.items.push({quantity:h,name:u,items:[],type:v,nameshort:""})}}function Zs(e,t,a){if(!e||!t)return;t.items=t.items||[];const r=e.trim(),s=r.match(/\(([^)]+)\)$/),i=s?` (${s[1]})`:"",o=r.replace(/\s*\([^)]+\)$/,"").trim(),l=V(o);if((t.items||[]).some(u=>u&&u.type==="special"&&V((u.name||"").replace(/^Enhancement:\s*/i,""))===l))return;const d=`E: ${o.split(/\s+/).map(u=>u[0]?u[0].toUpperCase():"").join("")}${i}`.trim(),h={quantity:"1x",name:`Enhancement: ${o}`,nameshort:d,items:[],type:"special"};t.items.push(h)}function qr(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*(?::\s*(.*))?$/i,s=/^\s*(?:â¢|\-|\+|â¦)\s*(.*)$/;let i=null;for(let l=0;l<e.length;l++){const m=(e[l]||"").trim();if(!m)continue;if(a.test(m.toUpperCase())){i=/^CHARACTERS?/i.test(m)?"CHARACTER":"OTHER DATASHEETS";continue}const d=m.match(r);if(d){const h=d[1].trim(),u=parseInt(String(d[2]).replace(/[\,\.\s]/g,""),10)||0;let f="1x",y=h;const v=h.match(/^([0-9]+x?)\s+(.*)$/i);v&&(f=v[1].toLowerCase(),y=v[2].trim());const p={quantity:f,name:y,points:u,items:[],isComplex:!1,nameshort:""},x=i==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";t[x]=t[x]||[],t[x].push(p);const E=d[3]||"";E&&E.split(",").map(S=>S.trim()).filter(Boolean).forEach(S=>Pn(p,S,p.name,t.SUMMARY.FACTION_KEYWORD||"",p.name,!0));const A=[];let g=l+1;for(;g<e.length;){const S=e[g]||"";if(!S.trim()||a.test(S.trim().toUpperCase())||r.test(S.trim())||!/^\s+/.test(S)&&!s.test(S))break;A.push(S),g++}const _=(()=>{for(let S=0;S<A.length;S++){const D=A[S];if(!D.match(s))continue;const re=Wn(D);for(let z=S+1;z<A.length;z++){const de=A[z];if(!de.trim()||Wn(de)<=re)break;if(s.test(de))return!0}}return!1})();let R=null,k=0;for(let S=0;S<A.length;S++){const D=A[S],N=D.trim(),re=D.match(s),z=Wn(D);if(re){const de=re[1].trim(),ce=de.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(de)){Zs(de.replace(/^Enhancement:\s*/i,"").trim(),p,t.SUMMARY.FACTION_KEYWORD||"");continue}else if(ce){Zs(de.trim(),p,t.SUMMARY.FACTION_KEYWORD||"");continue}if(_){if(R&&typeof k=="number"&&z>k){const H=de.split(",").map(G=>G.trim()).filter(Boolean);for(let G of H){const P=G.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(P){const O=P[1].trim(),W=P[2].trim();if(V(O)===V(R.name)){const J=H.some(K=>V(K)===V(W)),ae=(R.items||[]).some(K=>V(K.name||"")===V(W));if(J||ae)continue;const $e=Bn(G),Fe=parseInt(String($e.quantity||"1x").replace(/[^0-9]/g,""),10)||1;Pn(R,W,R.name,t.SUMMARY.FACTION_KEYWORD||"",p.name,!1,"wargear",Fe);continue}}Pn(R,G,R.name,t.SUMMARY.FACTION_KEYWORD||"",p.name,!0)}continue}R=null;const Y=de.match(/^(\d+x?)\s+(.*)$/i),X=Y?Y[1]:"1x";let F=Y?Y[2].trim():de;try{const H=F.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(H){const G=H[1].trim(),P=H[2].trim(),O=V(G),W=V(p.name||""),J=V(unitTopName||p.name||"");if(O&&(O===W||W.startsWith(O)||O.startsWith(W)||J.startsWith(O)||O.startsWith(J))){F=G;const ae={quantity:X,name:F,items:[],type:"subunit"};ae._deferredParenthetical=P,ae._deferredParentheticalQty=parseInt(String(X||"1x").replace(/[^0-9]/g,""),10)||1,p.items=p.items||[],p.items.push(ae),R=ae,k=z;continue}}}catch{}const q={quantity:X,name:F,items:[],type:"subunit"};p.items=p.items||[],p.items.push(q),R=q,k=z;continue}Pn(p,de,p.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(R&&z>k){Pn(R,N,R.name,t.SUMMARY.FACTION_KEYWORD||"",p.name,!0);continue}Pn(p,N,p.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1)}l=g-1;continue}}function o(l,c){if(!(!l||typeof l!="object")){if(typeof l.name!="string"&&(l.name=""),typeof l.quantity!="string"&&(l.quantity=l.quantity?String(l.quantity):"1x"),typeof l.type!="string"&&(l.type=l.type||"wargear"),typeof l.nameshort!="string"&&(l.nameshort=l.nameshort||""),Array.isArray(l.items)||(l.items=[]),/^Enhancement:/i.test(l.name)){const m=l.name.replace(/^Enhancement:\s*/i,"").trim();l.type="special",l.nameshort=l.nameshort||(()=>{const d=m.match(/\(([^)]+)\)$/),h=d?` (${d[1]})`:"";return`E: ${m.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(y=>y[0]?y[0].toUpperCase():"").join("")}${h}`.trim()})(),l.name=`Enhancement: ${Fr(m.replace(/\s*\([^)]+\)$/,"").trim())}`}else l.name=c?l.name:Fr(l.name);V(l.name)==="warlord"&&(l.type="special"),l.items=(l.items||[]).map(m=>{if(!m)return null;if(typeof m=="string"){const d={quantity:"1x",name:m.trim(),items:[],type:/^Enhancement:/i.test(m)?"special":"wargear",nameshort:""};return o(d,l.name),d}return o(m,l.name),m}).filter(Boolean)}}for(const l of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(t[l]))for(const c of t[l]){o(c);const m=(c.items||[]).filter(h=>h&&h.type==="subunit");if(m.length>0)if(m.every(u=>V(u.name||"")===V(c.name||""))){const u=new Map;let f=0;for(const y of m){const v=parseInt(String(y.quantity||"1x").replace(/x/i,""),10)||1;f+=v;for(const p of y.items||[]){const x={items:[]};Pn(x,`${p.quantity||"1x"} ${p.name}`,c.name,t.SUMMARY.FACTION_KEYWORD||"",p.type||"wargear",1);for(const E of x.items){const A=V(E.name||"");if(u.has(A)){const g=u.get(A),_=parseInt(String(g.quantity||"1x").replace(/x/i,""),10)||0,R=parseInt(String(E.quantity||"1x").replace(/x/i,""),10)||0;g.quantity=`${_+R}x`}else u.set(A,E)}}}c.items=Array.from(u.values()),f>0&&(c.quantity=`${f}x`),c.isComplex=!1}else{const u=m.reduce((f,y)=>f+(parseInt(String(y.quantity||"1x").replace(/x/i,""),10)||0),0);u>0&&(c.quantity=`${u}x`),c.isComplex=!1}else c.isComplex=!1;if(Array.isArray(c.items)&&c.items.length===1&&c.items[0]&&c.items[0].type==="subunit"){const h=c.items[0];Array.isArray(h.items)&&h.items.length>0&&(c.items=h.items.slice(),c.isComplex=!1)}Array.isArray(c.items)&&c.items.length>0&&sn(c.items);const d=(c.items||[]).filter(h=>h&&h.type==="subunit");for(const h of d)Array.isArray(h.items)&&h.items.length>0&&sn(h.items)}return ra(t),t}function Gu(e){if(!Array.isArray(e))return qr(e);const t=[];let a=0;for(;a<e.length;a++){const h=String(e[a]||"").trim();if(!h){t.push(h);continue}if(h.startsWith("+")||h.startsWith("&")){t.push(h);continue}break}const r=[],s={};for(const d of t){if(!d)continue;if(d.startsWith("&")){const y=d.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);y&&r.push({enh:y[1].trim(),target:(y[3]||"").trim(),charId:y[2]||null});continue}const u=d.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(u){const f=u[1].trim().toUpperCase(),y=u[2].trim();if(f==="ENHANCEMENT"){const v=y.match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);v?r.push({enh:v[1].trim(),target:(v[3]||"").trim(),charId:v[2]||null}):r.push({enh:y,target:null,charId:null})}else if(f==="FACTION KEYWORD"){const v=y.split(" - ");s.faction=v[v.length-1].trim()}else f==="DETACHMENT"?s.detachment=y.replace(/\u00A0/g," "):f==="TOTAL ARMY POINTS"&&(s.points=y)}}const i=e.slice(a),o=[];for(const d of i){if(!d){o.push(d);continue}let h=String(d);h=h.replace(/^\s*Char\d+:\s*/i,"");const u=h.match(/^(.*\))\s*:\s*(.+)$/);u?(o.push(u[1]),o.push("  â¢ "+u[2])):o.push(h)}const l=qr(o);l.SUMMARY=l.SUMMARY||{},s.faction&&(l.SUMMARY.FACTION_KEYWORD=s.faction),s.detachment&&(l.SUMMARY.DETACHMENT=s.detachment),s.points&&(l.SUMMARY.TOTAL_ARMY_POINTS=s.points);const c=[...l.CHARACTER||[],...l["OTHER DATASHEETS"]||[]],m=d=>{const h=V(String(d||""));for(const u of c){const f=u&&Array.isArray(u.items)?u.items:[];for(const y of f){if(!y||!y.name)continue;const v=String(y.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,"").trim();if(V(v)===h)return!0}}return!1};for(const d of r){if(!d||!d.enh||m(d.enh))continue;let h=null;const u=f=>String(f||"").toLowerCase().replace(/[^a-z0-9 ]/g,"").trim();if(d.charId){const f=parseInt(String(d.charId).replace(/[^0-9]/g,""),10);!Number.isNaN(f)&&f>0&&Array.isArray(l.CHARACTER)&&l.CHARACTER[f-1]&&(h=l.CHARACTER[f-1])}!h&&d.target&&(h=c.find(f=>u(f.name).includes(u(d.target))||u(`${f.quantity} ${f.name}`).includes(u(d.target)))),!h&&c.length===1&&(h=c[0]),h&&Zs(d.enh,h,l.SUMMARY.FACTION_KEYWORD||"")}try{for(const d of["CHARACTER","OTHER DATASHEETS"]){const h=l[d];if(Array.isArray(h))for(const u of h)u&&typeof u=="object"&&Object.prototype.hasOwnProperty.call(u,"type")&&delete u.type}for(const d of["CHARACTER","OTHER DATASHEETS"]){const h=l[d];if(Array.isArray(h)){for(const u of h)if(!(!u||!Array.isArray(u.items))){for(const f of u.items.filter(y=>y&&y.type==="subunit"))if(f&&f._deferredParenthetical)try{delete f._deferredParenthetical,delete f._deferredParentheticalQty}catch{}}}}}catch{}return ra(l),l}function zu(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(e))return t;const a=e.map(m=>String(m||"")).find(m=>m.trim()),r=e.findIndex(m=>String(m||"").trim());if(a){const m=a.split(/\s*-\s*/).map(d=>d.trim()).filter(Boolean);if(t.SUMMARY.FACTION_FAMILY=m[0]||"",t.SUMMARY.FACTION_KEYWORD=m[1]||"",m.length>=3){const h=m[m.length-1].match(/\[\s*(\d{2,5})\s*pts?\s*\]$/i);h?(t.SUMMARY.TOTAL_ARMY_POINTS=`${h[1]}pts`,m.length===3?t.SUMMARY.LIST_TITLE=m[2]:t.SUMMARY.LIST_TITLE=m.slice(2,m.length-1).join(" - ")):t.SUMMARY.LIST_TITLE=m.slice(2).join(" - ")}t.SUMMARY.DISPLAY_FACTION=a.trim()}for(let m=0;m<Math.min(e.length,40);m++){const d=String(e[m]||"").trim();if(!d)continue;const h=d.match(/^Detachment:\s*(.*)$/i);h&&(t.SUMMARY.DETACHMENT=h[1].trim());const u=d.match(/^TOTAL ARMY POINTS:\s*(.*)$/i);u&&(t.SUMMARY.TOTAL_ARMY_POINTS=u[1].trim());const f=d.match(/^FACTION KEYWORD:\s*(.*)$/i);f&&(t.SUMMARY.FACTION_KEYWORD=f[1].trim());const y=d.match(/^Battle Size:\s*(.*)$/i);y&&(t.SUMMARY.BATTLE_SIZE=y[1].trim());const v=d.match(/^#+\s*(?:\+{1,2}\s*)?(.*)\[\s*\d{2,5}\s*pts?\s*\]$/i);if(v&&!t.SUMMARY.LIST_TITLE){const p=v[1].trim();/Army\s+Roster/i.test(p)||/\+\+/.test(p)?t.SUMMARY.LIST_TITLE="":t.SUMMARY.LIST_TITLE=p}}if(!t.SUMMARY.FACTION_KEYWORD&&t.SUMMARY.DISPLAY_FACTION){const m=t.SUMMARY.DISPLAY_FACTION.split(" - ");m.length>=2?t.SUMMARY.FACTION_KEYWORD=m[1].trim():t.SUMMARY.FACTION_KEYWORD=t.SUMMARY.DISPLAY_FACTION.replace(/\s*\[.*$/,"").trim()}const s=/^(?:(\d+)x?\s+)?(.+?)\s*\[\s*(\d{1,4})\s*pts?\s*\]\s*(?::\s*(.*))?$/i,i=/^\s*(?:â¢|\-|\+)\s*(.*)$/;let o=null,l=null;for(let m=0;m<e.length;m++){const d=String(e[m]||""),h=d.trim();if(!h||m===r)continue;if(h.startsWith("#")){const y=h.match(/^#+\s*(.+?)\s*(?:\[\s*\d+\s*pts?\s*\])?$/i);if(y){const v=y[1].trim();/character|epic|hero|hq/i.test(v)?o="CHARACTER":o="OTHER DATASHEETS"}continue}const u=h.match(s);if(u){const y=u[1]?`${u[1]}x`:"1x",v=(u[2]||"").trim(),p=parseInt(u[3],10)||0,x=u[4]||"",E={quantity:y,name:v,points:p,items:[],isComplex:!1,nameshort:""};o||(o="OTHER DATASHEETS"),t[o]=t[o]||[],t[o].push(E),l=E,x&&x.split(",").map(A=>A.trim()).filter(Boolean).forEach(A=>{c(l,A,l.name,t.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}const f=d.match(i);if(f&&l){const y=f[1].trim(),v=y.match(/^(\d+)\s+with\s+(.*)$/i);if(v&&l){const E=parseInt(v[1],10)||1,A=v[2],g=l.items&&l.items.length>0?l.items[l.items.length-1]:l;A.split(",").map(_=>_.trim()).filter(Boolean).forEach(_=>c(g,`${E}x ${_}`,g.name,t.SUMMARY.FACTION_KEYWORD||"",l.name,!0));continue}const p=y.match(/^(\d+x?)\s+([^:]+):\s*(.*)$/i);if(p){const E=p[1];let A=p[2].trim();const g=p[3]||"";A=A.replace(/\s+w\/.*$/i,"").trim();const _={quantity:E,name:A,items:[],type:"subunit"};if(g){const R=g.match(/^(\d+)\s+with\s+(.*)$/i);if(R){const k=parseInt(R[1],10)||1;R[2].split(",").map(D=>D.trim()).filter(Boolean).forEach(D=>c(_,`${k}x ${D}`,_.name,t.SUMMARY.FACTION_KEYWORD||"",l.name,!0))}else g.split(",").map(k=>k.trim()).filter(Boolean).forEach(k=>c(_,k,_.name,t.SUMMARY.FACTION_KEYWORD||"",l.name,!0))}l.items=l.items||[],l.items.push(_);continue}const x=y.match(/^(\d+x?)\s+(.*)$/i);if(x&&l){let E=x[2].trim();E=E.replace(/\s+w\/.*$/i,"").trim();const A={quantity:x[1],name:E,items:[],type:"subunit"};l.items=l.items||[],l.items.push(A);continue}c(l,y,l.name,t.SUMMARY.FACTION_KEYWORD||"",l.name,!0);continue}}function c(m,d,h,u,f="",y=!1,v="wargear"){if(!m)return;m.items=m.items||[];const p=String(d||"").trim(),x=Bn(p),E=x.quantity?String(x.quantity):"1x",A=/^\s*\d+x?\s+/i.test(p);let g=x.name||"";const _=g.match(/^(.*?)\s*\(([^)]+)\)$/);if(_){const N=(_[1]||"").trim(),re=(_[2]||"").trim();(/\bDrone\b/i.test(N)||/\bDrone\b/i.test(g))&&(g=re)}const R=V(g);if(y){const N=String(h||""),re=String(f||"");if(V(N)===V(g)||re&&V(re)===V(g))return}const k=parseInt(String(E||"1x").replace(/x/i,""),10)||1;let S=k;if(m&&m.type==="subunit"){const N=parseInt(String(m.quantity||"1x").replace(/[^0-9]/g,""),10)||1;S=A?k:N}const D=m.items.find(N=>V(N.name||"")===R);if(D){const N=parseInt(String(D.quantity||"1x").replace(/x/i,""),10)||0;D.quantity=`${N+S}x`}else{const N=V(g)==="warlord"?"special":v;m.items.push({quantity:`${S}x`,name:g,items:[],type:N,nameshort:""})}}for(const m of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(t[m]))for(const d of t[m]){if(!d||!Array.isArray(d.items)||d.items.length===0)continue;if(d.items.filter(f=>f&&f.type==="subunit").length>1){const f=new Map,y=[];for(const v of d.items){if(!v||v.type!=="subunit"){y.push(v);continue}const p=V(v.name||"");if(!f.has(p))f.set(p,{quantity:v.quantity||"1x",name:v.name,items:Array.isArray(v.items)?v.items.slice():[],type:"subunit"});else{const x=f.get(p),E=parseInt(String(x.quantity||"1x").replace(/[^0-9]/g,""),10)||0,A=parseInt(String(v.quantity||"1x").replace(/[^0-9]/g,""),10)||0;x.quantity=`${E+A}x`;const g=new Map;for(const _ of x.items||[]){const R=V(_&&_.name||"");R&&g.set(R,{quantity:_.quantity||"1x",name:_.name,items:[],type:_.type||"wargear",nameshort:_.nameshort||""})}for(const _ of v.items||[]){const R=V(_&&_.name||"");if(R)if(g.has(R)){const k=g.get(R),S=parseInt(String(k.quantity||"1x").replace(/[^0-9]/g,""),10)||0,D=parseInt(String(_.quantity||"1x").replace(/[^0-9]/g,""),10)||0;k.quantity=`${S+D}x`}else g.set(R,{quantity:_.quantity||"1x",name:_.name,items:[],type:_.type||"wargear",nameshort:_.nameshort||""})}x.items=Array.from(g.values())}}d.items=[...y,...Array.from(f.values())]}d&&Array.isArray(d.items)&&d.items.length>0&&sn(d.items);const u=d&&Array.isArray(d.items)?d.items.filter(f=>f&&f.type==="subunit"):[];for(const f of u)f&&Array.isArray(f.items)&&f.items.length>0&&sn(f.items)}return ra(t),t}function ju(e,t=40){return(Array.isArray(e)?e:String(e||"").split(/\r?\n/)).slice(0,t)}function Xu(e){const t=Array.isArray(e)?e:String(e||"").split(/\r?\n/),a=ju(t,40),r=t.join(`
`),s={NRNR:{score:0,breakdown:{},maxScore:8},"WTC-Compact":{score:0,breakdown:{},maxScore:8},WTC:{score:0,breakdown:{},maxScore:8},GWAPP:{score:0,breakdown:{},maxScore:7},"NR-GW":{score:0,breakdown:{},maxScore:7},LF:{score:0,breakdown:{},maxScore:7}},i=a.some(Y=>/-\s*\[\s*\d{2,5}\s*pts?\s*\]$/i.test(Y)),o=a.some(Y=>/^#{1,3}\s+/.test(Y)),l=a.some(Y=>/^\s*#?\s*\+\+\s*Army Roster\s*\+\+/i.test(Y)),c=a.some(Y=>/^\s*##\s+/.test(Y)),m=/(.+?)\s*[\(\[]\s*([0-9]{1,4})\s*(?:pts|points)\s*[\)\]]/i,d=r.match(new RegExp(m.source,"g"))||[],h=r.match(/^[ \t]*(?:â¢|\-|\+)\s*(?:\d+x?)\s+[^:]+:/gmi)||[],u=r.match(/\b[A-Za-z0-9\-\'â ]+\s*\([^\)]+\)/g)||[],f=/(^|\n)\s*Char\d+:.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)\s*:\s*/i,y=(r.match(new RegExp(f.source,"gi"))||[]).length,v=a.some(Y=>/^(List Name|Factions Used|Army Points|Detachment Rule):/i.test(Y.trim())),p=a.some(Y=>/-\s*\(\s*\d+\s*Points?\s*\)\s*$/i.test(Y)),x=r.match(/^(Epic Hero|Epic Heroes|Character|Characters|Battleline|Infantry|Beast|Vehicle|Dedicated Transport|Other Datasheets):\s*$/gmi)||[],E=(r.match(/^\s*â¢\s*(?:E:|Enhancement:)/gmi)||[]).length,A=(r.match(/^\s*â¢\s+/gmi)||[]).length;v&&(s.LF.score+=4,s.LF.breakdown.headerKeys=4),p&&(s.LF.score+=4,s.LF.breakdown.titleLine=4),x.length>=2&&(s.LF.score+=3,s.LF.breakdown.sectionColons=x.length),A>5&&(s.LF.score+=1,s.LF.breakdown.bullets=A),E>0&&(s.LF.score+=1,s.LF.breakdown.enhancementLines=E),(v||p||x.length>=2)&&(s.NRNR.score-=1,s.WTC.score-=1,s["WTC-Compact"].score-=1,s.GWAPP.score-=1,s["NR-GW"].score-=3),i&&(s.NRNR.score+=2,s.NRNR.breakdown.titleWithBracketedPts=2),o&&(s.NRNR.score+=3,s.NRNR.breakdown.markdownHeading=3),l&&(s.NRNR.score+=2,s.NRNR.breakdown.armyRoster=2),c&&(s.NRNR.score+=1,s.NRNR.breakdown.doubleHashSections=1),d.length>=3&&(s.NRNR.score+=1,s.NRNR.breakdown.unitLines=1),h.length>0&&(s.NRNR.score+=1,s.NRNR.breakdown.bulletWithQty=h.length),u.length>0&&(s.NRNR.score+=.5,s.NRNR.breakdown.parenItem=u.length);const g=a.join(`
`);/^[ \t]*[+&]/m.test(g)&&(s["WTC-Compact"].score+=3,s["WTC-Compact"].breakdown.headerPlusAmp=3),/(FACTION KEYWORD|DETACHMENT|TOTAL ARMY POINTS)/i.test(g)&&(s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.headerKeys=2),d.length>=2&&(s["WTC-Compact"].score+=1,s["WTC-Compact"].breakdown.unitLines=1),y>0&&(s["WTC-Compact"].score+=5,s["WTC-Compact"].breakdown.inlineCharList=y),/^\s*[+&]/m.test(g)&&(s.WTC.score+=1,s.WTC.breakdown.headerPlusAmp=1),/NUMBER OF UNITS:/i.test(g)&&(s.WTC.score+=2,s.WTC.breakdown.numberOfUnits=2);const _=(r.match(/(^|\n)\s*Char\d+:/gi)||[]).length>0;_&&(s.WTC.score+=3,s.WTC.breakdown.charMarkers=3),(o||l||c)&&(s.WTC.score-=2,s.WTC.breakdown.nrnrPenalty=-2,s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.nrnrPenalty=-1);const R=(r.match(/^\s*\d+\s+with\s+/gmi)||[]).length;R>0&&(s.WTC.score+=2,s.WTC.breakdown.withLines=R,s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.withLines=R),a.some(Y=>/^(?:CHARACTER|OTHER DATASHEETS|CHARACTERS)\s*$/.test((Y||"").trim()))&&(s.WTC.score+=1,s.WTC.breakdown.sectionHeaders=1),_&&(s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.charMarkerPenalty=-1),y>0&&(s.WTC.score-=2,s.WTC.breakdown.compactInlinePenalty=-2);const k=/Exported with/i.test(r);(/Exported with/i.test(g)||k)&&(s.GWAPP.score+=6,s.GWAPP.breakdown.exportedWith=6),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS)\b/i.test(r)&&(s.GWAPP.score+=2,s.GWAPP.breakdown.sectionHeaders=2),/\(\s*\d+\s*(?:pts|points)\s*\)/i.test(g)&&(s.GWAPP.score+=1,s.GWAPP.breakdown.titleParenPts=1),k&&(s["NR-GW"].score-=4,s["NR-GW"].breakdown.gwappPenalty=-4),/^\s*Strike Force\s*\(\s*\d{2,5}\s*points\s*\)/mi.test(r)&&(s.GWAPP.score+=3,s.GWAPP.breakdown.strikeForce=3),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|DEDICATED TRANSPORTS)\b/i.test(r)&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.sectionHeaders=2);const S=(r.match(/^[ \t]*(?:â¢|\u2022|â¦|\-|\+)\s+/gmi)||[]).length;S>0&&!k&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.bulletCount=S),u.length>0&&!k&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.parenItem=u.length);const D=(r.match(/^[ \t]*(?:â¢|\u2022|â¦|\-|\+)\s*\d+x?\s+[A-Za-z0-9\-\'â]+/gmi)||[]).length;D>=3&&!_&&!k&&(s["NR-GW"].score+=3,s["NR-GW"].breakdown.bulletQty=D);const N=/^(?:\s*)\d+x?\s+.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)/i,re=t.filter(Y=>N.test(Y)).length;if(re>=2&&!_&&!k&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.unitLinesNoChar=re),!_&&!k&&(D>=3||re>=2)&&(s.WTC.score-=2,s.WTC.breakdown.nrGwPenalty=-2,s["WTC-Compact"].score-=2,s["WTC-Compact"].breakdown.nrGwPenalty=-2),(o||l)&&(s["NR-GW"].score-=1,s["NR-GW"].breakdown.nrnrPenalty2=-1),r.indexOf("â")!==-1)for(const Y of Object.keys(s))s[Y].score+=.5,s[Y].breakdown=s[Y].breakdown||{},s[Y].breakdown.unicodeApostrophe=.5;const z={};for(const Y of Object.keys(s)){const X=s[Y],F=Math.max(0,Math.min(1,X.score/(X.maxScore||8)));z[Y]={score:X.score,confidence:F,scoreBreakdown:X.breakdown}}const de=Object.keys(z).sort((Y,X)=>z[X].score-z[Y].score)[0],ce=z[de]||{score:0,confidence:0};return{format:de,confidence:ce.confidence,score:ce.score,scoreBreakdown:ce.scoreBreakdown,all:z}}function ao(e){const t=String(e||"").trim().match(/^(\d+)\s+(.*)$/);return t&&!/^\d+x\b/i.test(String(e||""))?`${t[1]}x ${t[2]}`:e}function so(e){const t=String(e||"").trim().replace(/^E:\s*/i,"").replace(/^Enhancement:\s*/i,"").trim(),a=t.match(/\(([^)]*pts?[^)]*)\)\s*$/i),r=t.replace(/\s*\([^)]*\)\s*$/,"").trim(),i=`E: ${r.split(/\s+/).map(o=>o[0]?o[0].toUpperCase():"").join("")}${a?` (${a[1].trim()})`:""}`.trim();return{quantity:"1x",name:`Enhancement: ${r}`,nameshort:i,items:[],type:"special"}}function Vu(e,t){if(!e)return;e.items=e.items||[];const a=ao(String(t||"").trim());if(/^(E:|Enhancement:)/i.test(a)){const s=so(a),i=V(s.name.replace(/^Enhancement:\s*/i,""));(e.items||[]).some(l=>/^Enhancement:/i.test(l.name||"")&&V(String(l.name).replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,""))===i)||e.items.push(s);return}const r=a.split(",").map(s=>s.trim()).filter(Boolean);for(const s of r){const i=Bn(s.replace(/^with\s+/i,"")),o=i.quantity||"1x",l=i.name||"";if(!l)continue;const c=V(l),m=e.items.find(d=>V(d.name||"")===c);if(m){const d=parseInt(String(m.quantity||"1x").replace(/[^0-9]/g,""),10)||0,h=parseInt(String(o).replace(/[^0-9]/g,""),10)||0;m.quantity=`${d+h}x`}else e.items.push({quantity:o,name:l,items:[],type:"wargear",nameshort:""})}}function Qu(e,t){const a=e[t]||"",r=Wn(a);for(let s=t+1;s<e.length;s++){const i=e[s]||"";if(!i.trim())continue;const o=Wn(i),l=/^\s*â¢\s*/.test(i);return o>r&&l}return!1}function Zu(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(e))return t;const a=e.slice(0,30).map(u=>String(u||""));let r=!1;for(const u of a){const f=u.match(/^\s*([A-Za-z ][A-Za-z ]*):\s*(.*)$/);if(!f)continue;const y=f[1].trim().toLowerCase(),v=f[2].trim();if(y==="list name"&&(t.SUMMARY.LIST_TITLE=v,r=!0),y==="factions used"&&(t.SUMMARY.FACTION_KEYWORD=v,r=!0),y==="army points"){const p=parseInt(v.replace(/[^0-9]/g,""),10);p&&(t.SUMMARY.TOTAL_ARMY_POINTS=`${p}pts`,r=!0)}y==="detachment rule"&&(t.SUMMARY.DETACHMENT=v,r=!0)}if(!r){const u=e.find(f=>String(f||"").trim());if(u){const f=String(u).match(/^(.*?)\s*-\s*(.*?)\s*-\s*(.*?)\s*\((\d+)\s*Points?\)/i);f&&(t.SUMMARY.LIST_TITLE=f[1].trim(),t.SUMMARY.FACTION_KEYWORD=f[2].trim(),t.SUMMARY.DETACHMENT=f[3].trim(),t.SUMMARY.TOTAL_ARMY_POINTS=`${parseInt(f[4],10)}pts`)}}const s=/^\s*([A-Za-z ]+):\s*$/,i=/^\s*(.*?)\s*\((\d+)\s*pts?\)\s*$/i,o=/^\s*â¢\s*(.*)$/;let l=null;const c=[];for(let u=0;u<e.length;u++){const f=String(e[u]||"");if(!f.trim())continue;const v=f.match(s);if(v){const R=v[1].trim().toLowerCase();l=/hero|character/.test(R)?"CHARACTER":"OTHER DATASHEETS",c.length=0;continue}const p=f.match(i);if(p&&Wn(f)===0){const R=p[1].trim(),k=parseInt(p[2],10)||0,S={quantity:"1x",name:R,points:k,items:[],isComplex:!1,nameshort:""},D=l==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";t[D]=t[D]||[],t[D].push(S),c.length=0,c.push({indent:0,node:S});continue}const x=f.match(o);if(!x)continue;const E=x[1].trim(),A=Wn(f);for(;c.length>0&&A<=c[c.length-1].indent;)c.pop();const g=c.length>0?c[c.length-1].node:null;if(!g||/^B:\s*/i.test(E))continue;if(/^(E:|Enhancement:)/i.test(E)){const R=so(E),k=c[0]?c[0].node:g;k.items=k.items||[],(k.items||[]).some(D=>/^Enhancement:/i.test(D.name||"")&&V(D.name)===V(R.name))||k.items.push(R);continue}if(Qu(e,u)){const R=Bn(ao(E));let k=R.name||"";k=k.replace(/\s+w\/.*$/i,"").trim();const S={quantity:R.quantity||"1x",name:k,items:[],type:"subunit"};g.items=g.items||[],g.items.push(S),c.push({indent:A,node:S});continue}Vu(g,E)}function m(u){const f=parseInt(String(u||"1x").replace(/[^0-9]/g,""),10);return Number.isFinite(f)&&f>0?f:1}for(const u of["CHARACTER","OTHER DATASHEETS"]){const f=t[u]||[];for(const y of f){const v=Array.isArray(y.items)?y.items:[],p=v.filter(g=>g&&g.type==="subunit");if(p.length<=1)continue;const x=new Map;for(const g of p){const _=V((g.name||"").replace(/\s+w\/.*/i,"").trim());x.has(_)||x.set(_,{name:g.name,qty:0,wargear:new Map});const R=x.get(_);R.qty+=m(g.quantity);const k=Array.isArray(g.items)?g.items:[];for(const S of k){const D=V(S.name||""),N=R.wargear.get(D)||{name:S.name,qty:0,type:S.type||"wargear"};N.qty+=m(S.quantity),R.wargear.has(D),R.wargear.set(D,N)}}const E=v.filter(g=>!(g&&g.type==="subunit")),A=[];for(const[,g]of x){const _={quantity:`${g.qty}x`,name:g.name,items:[],type:"subunit"};for(const[,R]of g.wargear)_.items.push({quantity:`${R.qty}x`,name:R.name,items:[],type:R.type||"wargear",nameshort:""});A.push(_)}y.items=[...E,...A]}}const d=t.SUMMARY&&t.SUMMARY.FACTION_KEYWORD?String(t.SUMMARY.FACTION_KEYWORD).trim():"";function h(u){if(!u||!d)return u;const f=new RegExp("^"+d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\s+","i");return String(u).replace(f,"").trim()}if(d)for(const u of["CHARACTER","OTHER DATASHEETS"]){const f=t[u]||[];for(const y of f){y.name=h(y.name);const v=(y.items||[]).filter(p=>p&&p.type==="subunit");for(const p of v)p.name=h(p.name)}}for(const u of["CHARACTER","OTHER DATASHEETS"]){const f=t[u]||[];for(const y of f){Array.isArray(y.items)&&y.items.length>0&&sn(y.items);const v=(y.items||[]).filter(p=>p&&p.type==="subunit");for(const p of v)Array.isArray(p.items)&&p.items.length>0&&sn(p.items)}}return ra(t),t}function Ju(e){try{const t=Xu(e).format;return t==="NRNR"?"NRNR":t==="WTC-Compact"?"WTC_COMPACT":t==="WTC"?"WTC":t==="GWAPP"?"GW_APP":t==="NR-GW"?"NR_GW":t==="LF"?"LF":"UNKNOWN"}catch{const a=Array.isArray(e)?e.slice(0,25):[],r=a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i)||/^\s*\+\s*DETACHMENT:/i.test(i)),s=a.some(i=>/^(?:CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i.test((i||"").trim().toUpperCase()));return r&&s?"NR_GW":a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i))?"WTC_COMPACT":s?"GW_APP":"UNKNOWN"}}async function em(e){if(!e||typeof e!="string")throw new Error("Invalid army list text");const t=e.split(`
`),a=Ju(t);if(a==="UNKNOWN")throw new Error("Unable to detect army list format. Supported formats: GW App, WTC, WTC Compact, NR-GW, NR-NR, ListForge");let r;try{switch(a){case"GW_APP":r=Ku(t);break;case"WTC":r=Uu(t);break;case"WTC_COMPACT":r=Fu(t);break;case"NR_GW":r=Gu(t);break;case"NRNR":r=zu(t);break;case"LF":r=Zu(t);break;default:throw new Error(`Unsupported format: ${a}`)}}catch(i){throw console.error("Parse error:",i),new Error(`Failed to parse ${a} format: ${i.message}`)}const s=tm(r);return{format:a,data:s}}function tm(e,t){const a=e.SUMMARY||{},r=[],s=["CHARACTER","CHARACTERS","BATTLELINE","OTHER DATASHEETS","ALLIED UNITS","DEDICATED TRANSPORTS"];for(const i of s)e[i]&&Array.isArray(e[i])&&r.push(...e[i].map(o=>({...o,section:i})));return{FACTION_KEYWORD:a.FACTION_KEYWORD||a.FACTION_KEY||"Unknown",DETACHMENT:a.DETACHMENT||"",TOTAL_ARMY_POINTS:a.TOTAL_ARMY_POINTS||"0pts",LIST_TITLE:a.LIST_TITLE||"",UNITS:r}}function nm(e){if(!e)return 1;const t=String(e).match(/(\d+)/);return t?parseInt(t[1],10):1}const am={Asurmen:{baseType:"40mm"},Autarch:{baseType:"32mm"},"Autarch wayleaper":{baseType:"32mm"},"Avatar of Khaine":{baseType:"80mm"},Baharroth:{baseType:"40mm"},"Corsair Voidreavers":{baseType:"28.5mm"},"Corsair Voidscarred":{baseType:"28.5mm"},"Crimson Hunter":{baseType:"120x92mm"},"D-cannon Platform":{baseType:"40mm"},"Dark Reapers":{baseType:"28.5mm"},"Death Jester":{baseType:"25mm"},"Dire Avengers":{baseType:"28.5mm"},"Eldrad Ulthran":{baseType:"32mm"},Falcon:{baseType:"Large Flying Base"},Farseer:{baseType:"25mm"},"Farseer Skyrunner":{baseType:"Small Flying Base"},"Fire Dragons":{baseType:"28.5mm"},"Fire Prism":{baseType:"Large Flying Base"},Fuegan:{baseType:"40mm"},"Guardian Defenders":{baseType:"28.5mm"},"Guardian Defenders: Heavy Weapon Platform":{baseType:"40mm"},"Hemlock Wraithfighter":{baseType:"120x92mm"},"Howling Banshees":{baseType:"28.5mm"},"Jain Zar":{baseType:"40mm"},Lhykhis:{baseType:"40mm"},"Maugan Ra":{baseType:"40mm"},"Night Spinner":{baseType:"Large Flying Base"},Rangers:{baseType:"28.5mm"},"Shadow Weaver Platform":{baseType:"40mm"},Shadowseer:{baseType:"25mm"},"Shining Spears":{baseType:"Large Flying Base"},"Shroud Runners":{baseType:"Large Flying Base"},Skyweavers:{baseType:"Large Flying Base"},Solitaire:{baseType:"25mm"},Spiritseer:{baseType:"25mm"},Starweaver:{baseType:"Large Flying Base"},"Storm Guardians":{baseType:"28.5mm"},"Storm Guardians: Serpentâs Scale Platform":{baseType:"40mm"},"Striking Scorpions":{baseType:"28.5mm"},"Swooping Hawks":{baseType:"28.5mm"},"The Visarch":{baseType:"32mm"}},sm={"Corvus Blackstar":{baseType:"120x92mm"},"Deathwatch Terminator Squad":{baseType:"40mm"},"Deathwatch Veterans":{baseType:"32mm"},"Fortis Kill Team":{baseType:"32mm"},"Indomitor Kill Team":{baseType:"40mm"},"Spectrus Kill Team":{baseType:"32mm"},"Spectrus Kill Team: Kill Team Infiltrators with bolt sniper rifles":{baseType:"40mm"},"Talonstrike Kill Team":{baseType:"32mm"},"Talonstrike Kill Team: Kill Team Heavy Intercessors with Jump Packs":{baseType:"40mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},rm={Archon:{baseType:"25mm"},Beastmaster:{baseType:"Small Flying Base"},"Beastmaster: Clawed Fiends, Khymerae, Razorwing Flocks":{baseType:"40mm"},"Court of the Archon: Sslyth":{baseType:"40mm"},"Court of the Archon: Ur-Ghul, Lhamaean, Medusae":{baseType:"25mm"},Cronos:{baseType:"Large Flying Base"},Drazhar:{baseType:"40mm"},Grotesques:{baseType:"40mm"},Haemonculus:{baseType:"25mm"},Hellions:{baseType:"Small Flying Base"},Incubi:{baseType:"28.5mm"},"Kabalite Warriors":{baseType:"25mm"},"Lelith Hesperax":{baseType:"32mm"},Mandrakes:{baseType:"28.5mm"},Raider:{baseType:"Large Flying Base"},Ravager:{baseType:"Large Flying Base"},"Razorwing Jetfighter":{baseType:"120x92mm"},Reavers:{baseType:"Small Flying Base"},Scourges:{baseType:"32mm"},Succubus:{baseType:"25mm"},Talos:{baseType:"Large Flying Base"},"Urien Rakarth":{baseType:"25mm"},Venom:{baseType:"Large Flying Base"},"Voidraven Bomber":{baseType:"120x92mm"},Wracks:{baseType:"25mm"},Wyches:{baseType:"25mm"}},im={"Annihilation Barge":{baseType:"Large Flying Base"},"Câtan Shard of the Deceiver":{baseType:"40mm"},"Câtan Shard of the Nightbringer":{baseType:"40mm"},"Câtan Shard of the Void Dragon":{baseType:"80mm"},"Canoptek Doomstalker":{baseType:"90mm"},"Canoptek Reanimator":{baseType:"60mm"},"Canoptek Scarab Swarms":{baseType:"40mm"},"Canoptek Spyders":{baseType:"60mm"},"Canoptek Wraiths":{baseType:"50mm"},"Catacomb Command Barge":{baseType:"Large Flying Base"},Chronomancer:{baseType:"40mm"},"Convergence of Dominion":{baseType:"hull",hullDimensions:{width:0,height:0}},Cryptothralls:{baseType:"32mm"},Deathmarks:{baseType:"32mm"},"Doom Scythe":{baseType:"120x92mm"},"Doomsday Ark":{baseType:"Large Flying Base"},"Flayed Ones":{baseType:"28.5mm"},"Ghost Ark":{baseType:"Large Flying Base"},"Hexmark Destroyer":{baseType:"50mm"},"Illuminor Szeras":{baseType:"80mm"},Immortals:{baseType:"32mm"},"Imotekh the Stormlord":{baseType:"40mm"},"Lokhust Destroyers":{baseType:"Large Flying Base"},"Lokhust Heavy Destroyers":{baseType:"60mm"},"Lokhust Lord":{baseType:"Large Flying Base"},Lychguard:{baseType:"32mm"},Monolith:{baseType:"160mm"},"Necron Warriors":{baseType:"32mm"},"Night Scythe":{baseType:"120x92mm"},Obelisk:{baseType:"120x92mm"},"Ophydian Destroyers":{baseType:"50mm"},"Orikan the Diviner":{baseType:"40mm"},Overlord:{baseType:"40mm"},"Overlord with Translocation Shroud":{baseType:"40mm"},Plasmancer:{baseType:"32mm"},Psychomancer:{baseType:"40mm"},"Royal Warden":{baseType:"32mm"},"Skorpekh Destroyers":{baseType:"50mm"},"Skorpekh Lord":{baseType:"60mm"},Technomancer:{baseType:"50mm"},"Tesseract Vault":{baseType:"120x92mm"},"The Silent King: Szarekh":{baseType:"100mm"},"The Silent King: Triarchal Menhir":{baseType:"50mm"},"Tomb Blades":{baseType:"Small Flying Base"},"Transcendent Câtan":{baseType:"60mm"},"Trazyn the Infinite":{baseType:"40mm"},"Triarch Praetorians":{baseType:"32mm"},"Triarch Stalker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Seraptek Heavy Construct":{baseType:"hull",hullDimensions:{width:0,height:0}}},om={Battlewagon:{baseType:"hull",hullDimensions:{width:0,height:0}},"Beast Snagga Boyz":{baseType:"32mm"},Beastboss:{baseType:"50mm"},"Beastboss on Squigosaur":{baseType:"80mm"},"Big Mek":{baseType:"50mm"},"Big Mek in Mega Armour":{baseType:"40mm"},"Big Mek with Shokk Attack Gun":{baseType:"40mm"},"Bigâed Bossbunka":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blitza-bommer":{baseType:"120x92mm"},"Boomdakka Snazzwagon":{baseType:"150x95mm"},"Boss Snikrot":{baseType:"40mm"},Boyz:{baseType:"32mm"},"Breaka Boyz":{baseType:"32mm"},"Breaka Boyz: Boss Nob":{baseType:"40mm"},"Burna Boyz":{baseType:"32mm"},"Burna-bommer":{baseType:"120x92mm"},Dakkajet:{baseType:"120x92mm"},"Deff Dread":{baseType:"60mm"},"Deffkilla Wartrike":{baseType:"150x95mm"},Deffkoptas:{baseType:"75x42mm"},"Flash Gitz":{baseType:"40mm"},"Ghazghkull Thraka":{baseType:"80mm"},"Ghazghkull Thraka: Makari":{baseType:"25mm"},Gorkanaut:{baseType:"170x109mm"},Gretchin:{baseType:"25mm"},"Gretchin: Runtherd":{baseType:"32mm"},"Hunta Rig":{baseType:"170x109mm"},"Kill Rig":{baseType:"170x109mm"},"Killa Kans":{baseType:"60mm"},Kommandos:{baseType:"32mm"},"Kustom Boosta-blasta":{baseType:"150x95mm"},Lootas:{baseType:"32mm"},Meganobz:{baseType:"40mm"},"Megatrakk Scrapjet":{baseType:"150x95mm"},Mek:{baseType:"32mm"},"Mek Gunz":{baseType:"hull",hullDimensions:{width:0,height:0}},Morkanaut:{baseType:"170x109mm"},"Mozrog Skragbad":{baseType:"80mm"},Nobz:{baseType:"32mm"},Painboss:{baseType:"40mm"},Painboy:{baseType:"32mm"},"Rukkatrukk Squigbuggy":{baseType:"150x95mm"},"Shokkjump Dragsta":{baseType:"150x95mm"},"Squighog Boyz":{baseType:"75x42mm"},"Squighog Boyz: Nob on Smasha Squig":{baseType:"90x52.5mm"},Stompa:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormboyz:{baseType:"32mm"},Tankbustas:{baseType:"32mm"},"Tankbustas: Boss Nob":{baseType:"40mm"},Trukk:{baseType:"hull",hullDimensions:{width:0,height:0}},Warbikers:{baseType:"75x42mm"},Warboss:{baseType:"40mm"},"Warboss in Mega Armour":{baseType:"50mm"},"Wazbom Blastajet":{baseType:"150x95mm"},Weirdboy:{baseType:"40mm"},Wurrboy:{baseType:"32mm"},"Zodgrod Wortsnagga":{baseType:"50mm"},"Gargantuan Squiggoth":{baseType:"hull",hullDimensions:{width:0,height:0}}},lm={Barbgaunts:{baseType:"40mm"},Biovores:{baseType:"80mm"},Broodlord:{baseType:"75x42mm"},Carnifexes:{baseType:"105x70mm"},Deathleaper:{baseType:"60mm"},Exocrine:{baseType:"120x92mm"},Gargoyles:{baseType:"Small Flying Base"},Genestealers:{baseType:"32mm"},Harpy:{baseType:"120x92mm"},Haruspex:{baseType:"120x92mm"},"Hive Crone":{baseType:"120x92mm"},"Hive Guard":{baseType:"50mm"},"Hive Tyrant":{baseType:"50mm"},Hormagaunts:{baseType:"28.5mm"},Lictor:{baseType:"50mm"},Maleceptor:{baseType:"120x92mm"},Mawloc:{baseType:"120x92mm"},"Mucolid Spores":{baseType:"40mm"},Neurogaunts:{baseType:"25mm"},"Neurogaunts: Nodebeasts":{baseType:"28.5mm"},Neurolictor:{baseType:"50mm"},Neurotyrant:{baseType:"50mm"},"Norn Assimilator":{baseType:"100mm"},"Norn Emissary":{baseType:"100mm"},"Old One Eye":{baseType:"105x70mm"},"Parasite of Mortrex":{baseType:"40mm"},Psychophage:{baseType:"120x92mm"},Pyrovores:{baseType:"80mm"},Raveners:{baseType:"40mm"},"Ripper Swarms":{baseType:"40mm"},"Screamer-killer":{baseType:"90mm"},"Spore MInes":{baseType:"25mm"},Sporocyst:{baseType:"hull",hullDimensions:{width:0,height:0}},Termagants:{baseType:"28.5mm"},Tervigon:{baseType:"120x92mm"},"The Swarmlord":{baseType:"60mm"},Toxicrene:{baseType:"120x92mm"},Trygon:{baseType:"120x92mm"},"Tyranid Warriors with Melee Bio-weapons":{baseType:"50mm"},"Tyranid Warriors with Ranged Bio-weapons":{baseType:"50mm"},Tyrannocyte:{baseType:"100mm"},Tyrannofex:{baseType:"120x92mm"},"Tyrant Guard":{baseType:"50mm"},Venomthropes:{baseType:"40mm"},"Von Ryanâs Leapers":{baseType:"40mm"},"Winged Hive Tyrant":{baseType:"60mm"},"Winged Tyranid Prime":{baseType:"50mm"},Zoanthropes:{baseType:"40mm"},Harridan:{baseType:"hull",hullDimensions:{width:4,height:6}},Hierophant:{baseType:"hull",hullDimensions:{width:0,height:0}}},ea={"ADEPTA SORORITAS":{"Aestred Thurga and Agathae Dolan: Aestred Thurga":{baseType:"32mm"},"Aestred Thurga and Agathae Dolan: Agathae Dolan":{baseType:"25mm"},"Arco-flagellants":{baseType:"25mm"},"Battle Sisters Squad":{baseType:"32mm"},Canoness:{baseType:"32mm"},"Canoness with Jump Pack":{baseType:"32mm"},Castigator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Celestian Sacresants":{baseType:"32mm"},Daemonifuge:{baseType:"32mm"},Dialogus:{baseType:"40mm"},Dogmata:{baseType:"32mm"},"Dominion Squad":{baseType:"32mm"},Exorcist:{baseType:"hull",hullDimensions:{width:0,height:0}},Hospitaller:{baseType:"50mm"},Imagifier:{baseType:"32mm"},Immolator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Junith Eruita":{baseType:"50mm"},"Ministorum Priest":{baseType:"32mm"},Mortifiers:{baseType:"50mm"},"Morvenn Vahl":{baseType:"60mm"},Palatine:{baseType:"32mm"},"Paragon Warsuits":{baseType:"50mm"},"Penitent Engines":{baseType:"50mm"},"Repentia Squad: Repentia Superior":{baseType:"32mm"},"Repentia Squad: Sister Repentia":{baseType:"28.5mm"},"Retributor Squad":{baseType:"32mm"},"Saint Celestine":{baseType:"40mm"},"Saint Celestine: Geminae Superia":{baseType:"32mm"},Sanctifiers:{baseType:"25mm"},"Seraphim Squad":{baseType:"32mm"},"Sisters Novitiate Squad: Novitiate Superior":{baseType:"32mm"},"Sisters Novitiate Squad: Sister Novitiate":{baseType:"28.5mm"},"Sororitas Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Triumph of Saint Katherine":{baseType:"120x92mm"},"Zephyrim Squad":{baseType:"32mm"}},"ADEPTUS CUSTODES":{Aleya:{baseType:"32mm"},"Allarus Custodians":{baseType:"40mm"},"Anathema Psykana Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blade Champion":{baseType:"40mm"},"Custodian Guard":{baseType:"40mm"},"Custodian Wardens":{baseType:"40mm"},"Knight-Centura":{baseType:"32mm"},Prosecutors:{baseType:"32mm"},"Shield-Captain":{baseType:"40mm"},"Shield-Captain in Allarus Terminator Armour":{baseType:"40mm"},"Shield-Captain on Dawneagle Jetbike":{baseType:"75x42mm"},"Trajann Valoris":{baseType:"40mm"},Valerian:{baseType:"40mm"},"Venerable Contemptor Dreadnought":{baseType:"60mm"},"Venerable Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vertus Praetors":{baseType:"75x42mm"},Vigilators:{baseType:"32mm"},Witchseekers:{baseType:"32mm"},"Agamatus Custodians":{baseType:"75x42mm"},"Aquilon Custodians":{baseType:"50mm"},"Ares Gunship":{baseType:"160mm"},"Caladius Grav-tank":{baseType:"170x109mm"},"Contemptor-Achillus Dreadnought":{baseType:"60mm"},"Contemptor-Galatus Dreadnought":{baseType:"60mm"},"Coronus Grav-carrier":{baseType:"170x109mm"},"Custodian Guard with Adrasite and Pyrithite Spears":{baseType:"40mm"},"Orion Assault Dropship":{baseType:"160mm"},"Pallas Grav-attack":{baseType:"105x70mm"},"Sagittarum Custodians":{baseType:"40mm"},"Telemon Heavy Dreadnought":{baseType:"100mm"},"Venatari Custodians":{baseType:"40mm"}},"ADEPTUS MECHANICUS":{"Archaeopter Fusilave":{baseType:"170x109mm"},"Archaeopter Stratoraptor":{baseType:"170x109mm"},"Archaeopter Transvector":{baseType:"170x109mm"},"Belisarius Cawl":{baseType:"105x70mm"},"Corpuscarii Electro-Priests":{baseType:"32mm"},"Cybernetica Datasmith":{baseType:"32mm"},"Fulgurite Electro-Priests":{baseType:"32mm"},"Ironstrider Ballistarii":{baseType:"105x70mm"},"Kastelan Robots":{baseType:"60mm"},"Kataphron Breachers":{baseType:"60mm"},"Kataphron Destroyers":{baseType:"60mm"},"Onager Dunecrawler":{baseType:"130mm"},"Pteraxii Skystalkers":{baseType:"40mm"},"Pteraxii Sterylizors":{baseType:"40mm"},"Serberys Raiders":{baseType:"60x35.5mm"},"Serberys Sulphurhounds":{baseType:"60x35.5mm"},"Sicarian Infiltrators":{baseType:"40mm"},"Sicarian Ruststalkers":{baseType:"40mm"},"Skitarii Marshal":{baseType:"32mm"},"Skitarii Rangers":{baseType:"25mm"},"Skitarii Rangers/Skitarii Vanguard: Transuranic Arquebus":{baseType:"60x35.5mm"},"Skitarii Vanguard":{baseType:"25mm"},"Skorpius Disintegrator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skorpius Dunerider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sydonian Dragoons with Radium Jezzails":{baseType:"105x70mm"},"Sydonian Dragoons with Taser Lances":{baseType:"105x70mm"},"Sydonian Skatros":{baseType:"40mm"},"Tech-Priest Dominus":{baseType:"50mm"},"Tech-Priest Enginseer":{baseType:"32mm"},"Tech-Priest Manipulus":{baseType:"50mm"},Technoarcheologist:{baseType:"32mm"}},"ADEPTUS TITANICUS":{"Reaver Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warbringer Nemesis Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warhound Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warlord Titan":{baseType:"hull",hullDimensions:{width:0,height:0}}},AELDARI:am,"ASTRA MILITARUM":{"Aegis Defence Line":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armoured Sentinels":{baseType:"80mm"},"Artillery Team":{baseType:"130mm"},"Attilan Rough Riders":{baseType:"60x35.5mm"},Baneblade:{baseType:"hull",hullDimensions:{width:0,height:0}},Banehammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Banesword:{baseType:"hull",hullDimensions:{width:0,height:0}},Basilisk:{baseType:"hull",hullDimensions:{width:0,height:0}},"Bullgryn squad":{baseType:"40mm"},"Cadian Castellan":{baseType:"28.5mm"},"Cadian Command Squad":{baseType:"28.5mm"},"Cadian Heavy Weapons Squad":{baseType:"50mm"},"Cadian Shock Troops":{baseType:"25mm"},"Catachan Command Squad":{baseType:"25mm"},"Catachan Heavy Weapons Squad":{baseType:"60mm"},"Catachan Jungle Fighters":{baseType:"25mm"},Chimera:{baseType:"hull",hullDimensions:{width:0,height:0}},Commissar:{baseType:"28.5mm"},"Death Korps of Krieg":{baseType:"25mm"},"Death Riders":{baseType:"60x35.5mm"},Deathstrike:{baseType:"hull",hullDimensions:{width:0,height:0}},Doomhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},"Field Ordnance Battery":{baseType:"100mm"},"Gauntâs Ghosts":{baseType:"28.5mm"},Hellhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Hellhound:{baseType:"hull",hullDimensions:{width:0,height:0}},Hydra:{baseType:"hull",hullDimensions:{width:0,height:0}},Kasrkin:{baseType:"28.5mm"},"Krieg Combat Engineers":{baseType:"25mm"},"Krieg Command Squad":{baseType:"25mm"},"Krieg Command Squad: Lord Commissar":{baseType:"32mm"},"Krieg Heavy Weapons Squad":{baseType:"50mm"},"Krieg Heavy Weapons Squad: Fire Coordinator":{baseType:"25mm"},"Leman Russ Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Demolisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Eradicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Executioner":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Exterminator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Punisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Vanquisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Marshal Dreir":{baseType:"75x42mm"},"Lord Solar Leontus":{baseType:"80mm"},Manticore:{baseType:"hull",hullDimensions:{width:0,height:0}},"Militarum Tempestus Command Squad":{baseType:"25mm"},"Ministorum Priest":{baseType:"32mm"},"Nork Deddog":{baseType:"40mm"},"Ogryn Bodyguard":{baseType:"40mm"},"Ogryn squad":{baseType:"40mm"},"Primaris Psyker":{baseType:"32mm"},Ratlings:{baseType:"25mm"},"Rogal Dorn Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Rogal Dorn Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Scout Sentinels":{baseType:"80mm"},Shadowsword:{baseType:"hull",hullDimensions:{width:0,height:0}},"Sly Marbo":{baseType:"32mm"},Stormlord:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormsword:{baseType:"hull",hullDimensions:{width:0,height:0}},Taurox:{baseType:"hull",hullDimensions:{width:0,height:0}},"Taurox Prime":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tech-Priest Enginseer":{baseType:"32mm"},"Tempestus Aquilons":{baseType:"28.5mm"},"Tempestus Scions":{baseType:"25mm"},"Ursula Creed":{baseType:"32mm"},Valkyrie:{baseType:"120x92mm"},Wyvern:{baseType:"hull",hullDimensions:{width:0,height:0}},"Avenger Strike Fighter":{baseType:"120x92mm"},"Cyclops Demolition Vehicle":{baseType:"hull",hullDimensions:{width:0,height:0}}},"BLACK TEMPLARS":{"Black Templars Gladiator Lancer":{baseType:"100mm"},"Black Templars Gladiator Reaper":{baseType:"100mm"},"Black Templars Gladiator Valiant":{baseType:"100mm"},"Black Templars Impulsor":{baseType:"100mm"},"Black Templars Repulsor":{baseType:"100mm"},"Black Templars Repulsor Executioner":{baseType:"100mm"},Castellan:{baseType:"40mm"},"Chaplain Grimaldus":{baseType:"40mm"},"Chaplain Grimaldus: Cenobyte Servitors":{baseType:"28.5mm"},"Crusader Squad: Neophytes":{baseType:"28.5mm"},"Crusader Squad: Sword Brother/Initiates":{baseType:"32mm"},"High Marshal Helbrecht":{baseType:"60mm"},Marshal:{baseType:"40mm"},"Primaris Crusader Squad: Initiates":{baseType:"32mm"},"Primaris Crusader Squad: Neophytes":{baseType:"28.5mm"},"Primaris Crusader Squad: Sword Brother":{baseType:"40mm"},"Primaris Sword Brethren":{baseType:"40mm"},"The Emperorâs Champion":{baseType:"40mm"}},"BLOOD ANGELS":{Astorath:{baseType:"40mm"},"Baal Predator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blood Angels Captain":{baseType:"40mm"},"Chief Librarian Mephiston":{baseType:"40mm"},"Commander Dante":{baseType:"50mm"},"Death Company Captain":{baseType:"40mm"},"Death Company Captain with Jump Pack":{baseType:"40mm"},"Death Company Dreadnought":{baseType:"90mm"},"Death Company Marines":{baseType:"32mm"},"Death Company Marines with Bolt Rifles":{baseType:"32mm"},"Death Company Marines with Jump Packs":{baseType:"32mm"},Lemartes:{baseType:"40mm"},"Sanguinary Guard":{baseType:"40mm"},"Sanguinary Priest":{baseType:"40mm"},"The Sanguinor":{baseType:"40mm"}},"CHAOS DAEMONS":{"Beâlakor":{baseType:"100mm"},"Beasts of Nurgle":{baseType:"60mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodmaster:{baseType:"40mm"},Bloodthirster:{baseType:"120x92mm"},"Blue Horrors":{baseType:"25mm"},"Burning Chariot":{baseType:"120x92mm"},Changecaster:{baseType:"32mm"},"Contorted Epitome":{baseType:"75x42mm"},"Daemon Prince of Chaos":{baseType:"60mm"},"Daemon Prince of Chaos with Wings":{baseType:"60mm"},Daemonettes:{baseType:"25mm"},Epidemius:{baseType:"60mm"},"Exalted Flamer":{baseType:"75x42mm"},Fateskimmer:{baseType:"120x92mm"},"Feculent Gnarlmaw":{baseType:"hull",hullDimensions:{width:0,height:0}},Fiends:{baseType:"75x42mm"},Flamers:{baseType:"32mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Fluxmaster:{baseType:"Large Flying Base"},"Great Unclean One":{baseType:"130mm"},Hellflayers:{baseType:"120x92mm"},"Horticulous Slimux":{baseType:"105x70mm"},"Infernal Enrapturess":{baseType:"60x35.5mm"},"Kairos Fateweaver":{baseType:"100mm"},Karanak:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},Nurglings:{baseType:"40mm"},"Pink Horrors":{baseType:"32mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Poxbringer:{baseType:"32mm"},"Rendmaster on Blood Throne":{baseType:"120x92mm"},Rotigus:{baseType:"130mm"},Screamers:{baseType:"Small Flying Base"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"},Skarbrand:{baseType:"100mm"},"Skull Altar":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skull Cannon":{baseType:"120x92mm"},Skullmaster:{baseType:"90x52.5mm"},Skulltaker:{baseType:"40mm"},"Sloppity Bilepiper":{baseType:"32mm"},"Soul Grinder":{baseType:"160mm"},"Spoilpox Scrivener":{baseType:"40mm"},"Syllâesske":{baseType:"50mm"},"The Blue Scribes":{baseType:"Large Flying Base"},"The Changeling":{baseType:"40mm"},"The Masque of Slaanesh":{baseType:"32mm"},Tormentbringer:{baseType:"120x92mm"},Tranceweaver:{baseType:"32mm"}},"CHAOS KNIGHTS":{"Knight Abominant":{baseType:"170x109mm"},"Knight Desecrator":{baseType:"170x109mm"},"Knight Despoiler":{baseType:"170x109mm"},"Knight Rampager":{baseType:"170x109mm"},"Knight Tyrant":{baseType:"170x109mm"},"War Dog Brigand":{baseType:"100mm"},"War Dog Executioner":{baseType:"100mm"},"War Dog Huntsman":{baseType:"100mm"},"War Dog Karnivore":{baseType:"100mm"},"War Dog Stalker":{baseType:"100mm"},"Chaos Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Cerastus Knight Acheron":{baseType:"170x109mm"},"Chaos Cerastus Knight Atrapos":{baseType:"170x109mm"},"Chaos Cerastus Knight Castigator":{baseType:"170x109mm"},"Chaos Cerastus Knight Lancer":{baseType:"170x109mm"},"Chaos Questoris Knight Magaera":{baseType:"170x109mm"},"Chaos Questoris Knight Styrix":{baseType:"170x109mm"},"War Dog Moirax":{baseType:"100mm"}},"CHAOS SPACE MARINES":{"Abaddon the Despoiler":{baseType:"60mm"},"Accursed Cultists: Mutant":{baseType:"25mm"},"Accursed Cultists: Torment":{baseType:"40mm"},"Chaos Bikers":{baseType:"75x42mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Lord":{baseType:"40mm"},"Chaos Lord in Terminator Armour":{baseType:"40mm"},"Chaos Lord with Jump Pack":{baseType:"40mm"},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminator Squad":{baseType:"40mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},Chosen:{baseType:"32mm"},"Cultist Firebrand":{baseType:"32mm"},"Cultist Mob":{baseType:"25mm"},Cypher:{baseType:"32mm"},"Dark Apostle":{baseType:"40mm"},"Dark Apostle: Dark Disciple":{baseType:"25mm"},"Dark Commune: Blessed Blade":{baseType:"28.5mm"},"Dark Commune: Cult Demagogue, Mindwitch, Iconarch":{baseType:"32mm"},Defiler:{baseType:"160mm"},"Fabius Bile":{baseType:"40mm"},"Fabius Bile: Surgeon Acolyte":{baseType:"32mm"},"Fellgor beastmen":{baseType:"32mm"},Forgefiend:{baseType:"120x92mm"},"Haarken Worldclaimer":{baseType:"40mm"},Havocs:{baseType:"40mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Heretic Astartes Daemon Prince":{baseType:"60mm"},"Heretic Astartes Daemon Prince with Wings":{baseType:"60mm"},"Huron Blackheart":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},Legionaries:{baseType:"32mm"},"Lord Discordant on Helstalker":{baseType:"120x92mm"},"Master of Executions":{baseType:"40mm"},"Master of Possession":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},"Nemesis Claw":{baseType:"32mm"},"Noctilith Crown":{baseType:"hull",hullDimensions:{width:0,height:0}},Obliterators:{baseType:"50mm"},Possessed:{baseType:"40mm"},Raptors:{baseType:"32mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Traitor Enforcer":{baseType:"32mm"},"Traitor Enforcer: Traitor Ogryn":{baseType:"40mm"},"Traitor Guardsmen Squad":{baseType:"25mm"},"Vashtorr the Arkifane":{baseType:"80mm"},Venomcrawler:{baseType:"100mm"},"Warp Talons":{baseType:"32mm"},Warpsmith:{baseType:"60x35.5mm"}},"DARK ANGELS":{Asmodai:{baseType:"50mm"},Azrael:{baseType:"50mm"},Belial:{baseType:"50mm"},"Deathwing Knights":{baseType:"40mm"},"Deathwing Terminator Squad":{baseType:"40mm"},Ezekiel:{baseType:"25mm"},"Inner Circle Companions":{baseType:"40mm"},"Land Speeder Vengeance":{baseType:"Large Flying Base"},Lazarus:{baseType:"40mm"},"Lion ElâJonson":{baseType:"60mm"},"Nephilim Jetfighter":{baseType:"120x92mm"},"Ravenwing Black Knights":{baseType:"75x42mm"},"Ravenwing Command Squad":{baseType:"75x42mm"},"Ravenwing Dark Talon":{baseType:"120x92mm"},"Ravenwing Darkshroud":{baseType:"Large Flying Base"},Sammael:{baseType:"Large Flying Base"}},"DEATH GUARD":{"Biologus Putrifier":{baseType:"40mm"},"Blightlord Terminators":{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Nurgle":{baseType:"60mm"},"Daemon Prince of Nurgle with Wings":{baseType:"60mm"},"Deathshroud Terminators":{baseType:"40mm"},Defiler:{baseType:"160mm"},"Foetid Bloat-Drone":{baseType:"60mm"},"Foetid Bloat-drone with Heavy Blight Launcher":{baseType:"60mm"},"Foul Blightspawn":{baseType:"40mm"},Helbrute:{baseType:"60mm"},"Icon Bearer":{baseType:"32mm"},"Lord of Contagion":{baseType:"50mm"},"Lord of Poxes":{baseType:"40mm"},"Lord of Virulence":{baseType:"50mm"},"Malignant Plaguecaster":{baseType:"32mm"},"Miasmic Malignifier":{baseType:"hull",hullDimensions:{width:0,height:0}},Mortarion:{baseType:"100mm"},"Myphitic Blight-Haulers":{baseType:"80mm"},"Noxious Blightbringer":{baseType:"40mm"},"Plague Marines":{baseType:"32mm"},"Plague Surgeon":{baseType:"40mm"},"Plagueburst Crawler":{baseType:"hull",hullDimensions:{width:0,height:0}},Poxwalkers:{baseType:"25mm"},Tallyman:{baseType:"40mm"},Typhus:{baseType:"50mm"},"Beasts of Nurgle":{baseType:"60mm"},"Great Unclean One":{baseType:"130mm"},Nurglings:{baseType:"40mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Rotigus:{baseType:"130mm"}},DEATHWATCH:sm,DRUKHARI:rm,"EMPERORâS CHILDREN":{"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminators":{baseType:"40mm"},"Daemon Prince of Slaanesh":{baseType:"60mm"},"Daemon Prince of Slaanesh with Wings":{baseType:"60mm"},"Flawless Blades":{baseType:"40mm"},Fulgrim:{baseType:"130mm"},Heldrake:{baseType:"120x92mm"},Infractors:{baseType:"32mm"},"Lord Exultant":{baseType:"40mm"},"Lord Kakophonist":{baseType:"40mm"},"Lucius the Eternal":{baseType:"50mm"},Maulerfiend:{baseType:"120x92mm"},"Noise Marines":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},Tormentors:{baseType:"32mm"},Daemonettes:{baseType:"25mm"},Fiends:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"}},"GENESTEALER CULTS":{Aberrants:{baseType:"32mm"},Abominant:{baseType:"40mm"},"Achilles Ridgerunners":{baseType:"120x92mm"},"Acolyte Hybrids with Autopistols":{baseType:"32mm"},"Acolyte Hybrids with Hand Flamers":{baseType:"32mm"},"Acolyte Iconward":{baseType:"32mm"},"Atalan Jackals":{baseType:"60x35.5mm"},"Atalan Jackals: Wolfquad":{baseType:"60mm"},Benefictus:{baseType:"32mm"},Biophagus:{baseType:"25mm"},Clamavus:{baseType:"32mm"},"Goliath Rockgrinder":{baseType:"hull",hullDimensions:{width:0,height:0}},"Goliath Truck":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hybrid Metamorphs":{baseType:"32mm"},"Jackal Alphus":{baseType:"60x35.5mm"},Kelermorph:{baseType:"32mm"},Locus:{baseType:"32mm"},Magus:{baseType:"32mm"},"Neophyte Hybrids":{baseType:"25mm"},"Neophyte Hybrids: Heavy stubber, Mining laser, Seismic cannon":{baseType:"32mm"},Nexos:{baseType:"40mm"},Patriarch:{baseType:"50mm"},Primus:{baseType:"32mm"},"Purestrain Genestealers":{baseType:"32mm"},"Reductus Saboteur":{baseType:"32mm"},Sanctus:{baseType:"32mm"}},"GREY KNIGHTS":{"Brother-Captain":{baseType:"40mm"},"Brother-Captain Stern":{baseType:"40mm"},"Brotherhood Champion":{baseType:"32mm"},"Brotherhood Chaplain":{baseType:"40mm"},"Brotherhood Librarian":{baseType:"40mm"},"Brotherhood Techmarine":{baseType:"32mm"},"Brotherhood Terminator Squad":{baseType:"40mm"},"Castellan Crowe":{baseType:"40mm"},"Grand Master":{baseType:"40mm"},"Grand Master in Nemesis Dreadknight":{baseType:"120x92mm"},"Grand Master Voldus":{baseType:"40mm"},"Grey Knights Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Razorback":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Stormhawk Interceptor":{baseType:"120x92mm"},"Grey knights Stormraven Gunship":{baseType:"120x92mm"},"Grey knights Stormtalon Gunship":{baseType:"120x92mm"},"Grey Knights Venerable Dreadnought":{baseType:"60mm"},"Interceptor Squad":{baseType:"32mm"},"Kaldor Draigo":{baseType:"40mm"},"Nemesis Dreadknight":{baseType:"120x92mm"},"Paladin Squad":{baseType:"40mm"},"Purgation Squad":{baseType:"32mm"},"Purifier Squad":{baseType:"32mm"},Servitors:{baseType:"25mm"},"Strike Squad":{baseType:"32mm"},"Grey Knights Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}},"Land Raider Banisher":{baseType:"hull",hullDimensions:{width:0,height:0}}},"IMPERIAL AGENTS":{"Callidus Assassin":{baseType:"32mm"},"Corvus Blackstar":{baseType:"120x92mm"},"Culexus Assassin":{baseType:"32mm"},"Deathwatch Kill Team":{baseType:"32mm"},"Eversor Assassin":{baseType:"32mm"},"Exaction Squad":{baseType:"28.5mm"},"Exaction Squad: Cyber-mastiff":{baseType:"25mm"},"Grey Knights Terminator Squad":{baseType:"40mm"},"Imperial Navy Breachers":{baseType:"25mm"},"Imperial Navy Breachers: Navis las-volley, endurant shield":{baseType:"28.5mm"},"Imperial Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},Inquisitor:{baseType:"32mm"},"Inquisitor Coteaz":{baseType:"40mm"},"Inquisitor Draxus":{baseType:"32mm"},"Inquisitor Greyfax":{baseType:"32mm"},"Inquisitorial Agents":{baseType:"25mm"},"Inquisitorial Agents: Gun Servitors":{baseType:"32mm"},"Inquisitorial Chimera":{baseType:"hull",hullDimensions:{width:0,height:0}},"Ministorum Priest":{baseType:"32mm"},Navigator:{baseType:"32mm"},"Rogue Trader entourage":{baseType:"25mm"},Sanctifiers:{baseType:"25mm"},"Sisters of Battle Immolator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sisters of Battle Squad":{baseType:"32mm"},"Subductor Squad":{baseType:"28.5mm"},"Subductor Squad: Cyber-mastiff":{baseType:"25mm"},"Vigilant Squad":{baseType:"28.5mm"},"Vigilant Squad: Cyber-mastiff":{baseType:"25mm"},"Vindicare Assassin":{baseType:"32mm"},"Voidsmen-at-Arms":{baseType:"32mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},"IMPERIAL KNIGHTS":{"Armiger Helverin":{baseType:"100mm"},"Armiger Warglaive":{baseType:"100mm"},"Canis Rex":{baseType:"170x109mm"},"Knight Castellan":{baseType:"170x109mm"},"Knight Crusader":{baseType:"170x109mm"},"Knight Errant":{baseType:"170x109mm"},"Knight Gallant":{baseType:"170x109mm"},"Knight Paladin":{baseType:"170x109mm"},"Knight Preceptor":{baseType:"170x109mm"},"Knight Valiant":{baseType:"170x109mm"},"Knight Warden":{baseType:"170x109mm"},"Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armiger Moirax":{baseType:"100mm"},"Cerastus Knight Acheron":{baseType:"170x109mm"},"Cerastus Knight Atrapos":{baseType:"170x109mm"},"Cerastus Knight Castigator":{baseType:"170x109mm"},"Cerastus Knight Lancer":{baseType:"170x109mm"},"Questoris Knight Magaera":{baseType:"170x109mm"},"Questoris Knight Styrix":{baseType:"170x109mm"}},"LEAGUES OF VOTANN":{"BrÃ´khyr Iron-master":{baseType:"32mm"},"BrÃ´khyr Iron-master: E-COG":{baseType:"25mm"},"BrÃ´khyr Iron-master: Ironkin Assistant":{baseType:"28.5mm"},"BrÃ´khyr Thunderkyn":{baseType:"40mm"},"Cthonian Beserks":{baseType:"28.5mm"},"Cthonian Beserks: Mole grenade launcher":{baseType:"50mm"},"Einhyr Champion":{baseType:"40mm"},"Einhyr Hearthguard":{baseType:"32mm"},Grimnyr:{baseType:"40mm"},"Grimnyr: CORV":{baseType:"25mm"},"Hearthkyn Warriors":{baseType:"28.5mm"},"Hekaton Land Fortress":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hernkyn Pioneers":{baseType:"90x52.5mm"},"Hernkyn Yaegirs":{baseType:"28.5mm"},KÃ¢hl:{baseType:"40mm"},Sagitaur:{baseType:"hull",hullDimensions:{width:0,height:0}},"Ãthar the Destined":{baseType:"40mm"}},NECRONS:im,ORKS:om,"SPACE MARINES":{"Adrax Agatone":{baseType:"40mm"},"Aggressor Squad":{baseType:"40mm"},Ancient:{baseType:"40mm"},"Ancient in Terminator Armour":{baseType:"40mm"},Apothecary:{baseType:"40mm"},"Apothecary Biologis":{baseType:"40mm"},"Assault Intercessor Squad":{baseType:"32mm"},"Assault Intercessors with Jump Packs":{baseType:"32mm"},"Ballistus Dreadnought":{baseType:"90mm"},"Bladeguard Ancient":{baseType:"40mm"},"Bladeguard Veteran Squad":{baseType:"40mm"},"Brutalis Dreadnought":{baseType:"90mm"},Captain:{baseType:"40mm"},"Captain in Gravis Armour":{baseType:"40mm"},"Captain in Phobos Armour":{baseType:"40mm"},"Captain in Terminator Armour":{baseType:"50mm"},"Captain Sicarius":{baseType:"32mm"},"Captain with Jump Pack":{baseType:"40mm"},"Centurion Assault Squad":{baseType:"50mm"},"Centurion Devastator Squad":{baseType:"50mm"},Chaplain:{baseType:"40mm"},"Chaplain in Terminator Armour":{baseType:"40mm"},"Chaplain on Bike":{baseType:"90x52.5mm"},"Chaplain with Jump Pack":{baseType:"32mm"},"Chief Librarian Tigurius":{baseType:"40mm"},"Company Heroes":{baseType:"40mm"},"Darnath Lysander":{baseType:"40mm"},"Desolation Squad":{baseType:"32mm"},"Devastator Squad":{baseType:"32mm"},Dreadnought:{baseType:"60mm"},"Drop Pod":{baseType:"hull",hullDimensions:{width:0,height:0}},"Eliminator Squad":{baseType:"40mm"},"Eradicator Squad":{baseType:"40mm"},"Firestrike Servo-turrets":{baseType:"80mm"},"Gladiator Lancer":{baseType:"100mm"},"Gladiator Reaper":{baseType:"100mm"},"Gladiator Valiant":{baseType:"100mm"},"Hammerfall Bunker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Heavy Intercessor Squad":{baseType:"40mm"},"Hellblaster Squad":{baseType:"32mm"},Impulsor:{baseType:"100mm"},"Inceptor Squad":{baseType:"40mm"},"Incursor Squad":{baseType:"32mm"},"Infernus Squad":{baseType:"32mm"},"Infiltrator Squad":{baseType:"32mm"},"Intercessor Squad":{baseType:"32mm"},"Invader ATV":{baseType:"hull",hullDimensions:{width:0,height:0}},"Invictor Tactical Warsuit":{baseType:"90mm"},"Iron Father Feirros":{baseType:"40mm"},Judiciar:{baseType:"40mm"},"Kayvaan Shrike":{baseType:"40mm"},"Korâsarro Khan":{baseType:"40mm"},"Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},Librarian:{baseType:"40mm"},"Librarian in Phobos Armour":{baseType:"40mm"},"Librarian in Terminator Armour":{baseType:"40mm"},Lieutenant:{baseType:"40mm"},"Lieutenant in Phobos Armour":{baseType:"40mm"},"Lieutenant in Reiver Armour":{baseType:"40mm"},"Lieutenant Titus":{baseType:"40mm"},"Lieutenant with Combi-weapon":{baseType:"40mm"},"Marneus Calgar":{baseType:"50mm"},"Marneus Calgar: Victrix Honour Guard":{baseType:"40mm"},"Outrider Squad":{baseType:"90x52.5mm"},"Pedro Kantor":{baseType:"32mm"},"Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},Razorback:{baseType:"hull",hullDimensions:{width:0,height:0}},"Redemptor Dreadnought":{baseType:"90mm"},"Reiver Squad":{baseType:"32mm"},Repulsor:{baseType:"100mm"},"Repulsor Executioner":{baseType:"100mm"},Rhino:{baseType:"hull",hullDimensions:{width:0,height:0}},"Roboute Guilliman":{baseType:"60mm"},"Scout Squad":{baseType:"28.5mm"},"Sternguard Veteran Squad":{baseType:"32mm"},"Storm Speeder Hailstrike":{baseType:"90mm"},"Storm Speeder Hammerstrike":{baseType:"90mm"},"Storm Speeder Thunderstrike":{baseType:"90mm"},"Stormhawk Interceptor":{baseType:"120x92mm"},"Stormraven Gunship":{baseType:"120x92mm"},"Stormtalon Gunship":{baseType:"120x92mm"},"Suppressor Squad":{baseType:"40mm"},"Tactical Squad":{baseType:"32mm"},Techmarine:{baseType:"40mm"},"Terminator Assault Squad":{baseType:"40mm"},"Terminator Squad":{baseType:"40mm"},"Tor Garadon":{baseType:"40mm"},"Uriel Ventris":{baseType:"40mm"},"Vanguard Veteran Squad with Jump Packs":{baseType:"32mm"},Vindicator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Vulkan Heâstan":{baseType:"32mm"},Whirlwind:{baseType:"hull",hullDimensions:{width:0,height:0}},Astraeus:{baseType:"hull",hullDimensions:{width:0,height:0}},"Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}}},"SPACE WOLVES":{"Arjac Rockfist":{baseType:"50mm"},"Bjorn the Fell-handed":{baseType:"60mm"},"Blood Claws":{baseType:"32mm"},"Fenrisian Wolves":{baseType:"40mm"},"Grey Hunters":{baseType:"32mm"},"Iron Priest":{baseType:"32mm"},"Logan Grimnar":{baseType:"80mm"},Murderfang:{baseType:"60mm"},"Njal Stormcaller":{baseType:"40mm"},"Ragnar Blackmane":{baseType:"40mm"},"Thunderwolf Cavalry":{baseType:"60mm"},"Ulrik the Slayer":{baseType:"32mm"},"Venerable Dreadnought":{baseType:"60mm"},"Wolf Guard Battle Leader":{baseType:"40mm"},"Wolf Guard Headtakers":{baseType:"40mm"},"Wolf Guard Headtakers: Hunting Wolves":{baseType:"60x35.5mm"},"Wolf Guard Terminators":{baseType:"40mm"},"Wolf Priest":{baseType:"40mm"},Wulfen:{baseType:"40mm"},"Wulfen Dreadnought":{baseType:"60mm"},"Wulfen with Storm Shields":{baseType:"40mm"}},"TâAU EMPIRE":{"Breacher Team":{baseType:"25mm"},"Broadside Battlesuits":{baseType:"60mm"},"Cadre Fireblade":{baseType:"25mm"},"Commander Farsight":{baseType:"60mm"},"Commander in Coldstar Battlesuit":{baseType:"60mm"},"Commander in Enforcer Battlesuit":{baseType:"60mm"},"Commander Shadowsun":{baseType:"50mm"},"Crisis Fireknife Battlesuits":{baseType:"50mm"},"Crisis Starscythe Battlesuits":{baseType:"50mm"},"Crisis Sunforge Battlesuits":{baseType:"50mm"},Darkstrider:{baseType:"32mm"},Devilfish:{baseType:"Large Flying Base"},Ethereal:{baseType:"40mm"},"Firesight Team":{baseType:"40mm"},"Ghostkeel Battlesuit":{baseType:"105x70mm"},"Hammerhead Gunship":{baseType:"Large Flying Base"},"Kroot Carnivores":{baseType:"28.5mm"},"Kroot Farstalkers":{baseType:"28.5mm"},"Kroot Farstalkers: Kroot Kill-broker":{baseType:"32mm"},"Kroot Flesh Shaper":{baseType:"32mm"},"Kroot Hounds":{baseType:"28.5mm"},"Kroot Lone-spear":{baseType:"90x52.5mm"},"Kroot Trail Shaper":{baseType:"32mm"},"Kroot War Shaper":{baseType:"32mm"},"Krootox Rampagers":{baseType:"50mm"},"Krootox Riders":{baseType:"50mm"},"Pathfinder Team":{baseType:"25mm"},Piranhas:{baseType:"Large Flying Base"},"Razorshark Strike Fighter":{baseType:"120x92mm"},"Riptide Battlesuit":{baseType:"120x92mm"},"Sky Ray Gunship":{baseType:"Large Flying Base"},"Stealth Battlesuits":{baseType:"32mm"},Stormsurge:{baseType:"170x109mm"},"Strike Team":{baseType:"25mm"},"Sun Shark Bomber":{baseType:"120x92mm"},"Tidewall Defence Platform":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Droneport":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Gunrig":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Shieldline":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vespid Stingwings":{baseType:"28.5mm"},"AX-1-0 Tiger Shark":{baseType:"160mm"},Manta:{baseType:"hull",hullDimensions:{width:4,height:6}},"Taâunar Supremacy Armour":{baseType:"160mm"},"Tiger Shark":{baseType:"160mm"}},"THOUSAND SONS":{Ahriman:{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Daemon Prince of Tzeentch":{baseType:"60mm"},"Daemon Prince of Tzeentch with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},"Exalted Sorcerer":{baseType:"32mm"},"Exalted Sorcerer on Disc of Tzeentch":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Infernal Master":{baseType:"40mm"},"Magnus the Red":{baseType:"100mm"},Maulerfiend:{baseType:"120x92mm"},"Mutalith Vortex Beast":{baseType:"120x92mm"},"Rubric Marines":{baseType:"32mm"},"Scarab Occult Terminators":{baseType:"40mm"},"Sekhetar Robots":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Tzaangor Enlightened":{baseType:"40mm"},"Tzaangor Enlightened with Fatecaster Greatbows":{baseType:"40mm"},"Tzaangor Shaman":{baseType:"40mm"},Tzaangors:{baseType:"32mm"},"Blue Horrors":{baseType:"25mm"},Flamers:{baseType:"32mm"},"Kairos Fateweaver":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},"Pink Horrors":{baseType:"32mm"},Screamers:{baseType:"Small Flying Base"}},TYRANIDS:lm,"WORLD EATERS":{Angron:{baseType:"100mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Khorne":{baseType:"60mm"},"Daemon Prince of Khorne with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},Eightbound:{baseType:"40mm"},"Exalted Eightbound":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Goremongers:{baseType:"32mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},Jakhals:{baseType:"28.5mm"},"Jakhals: Dishonoured":{baseType:"40mm"},"KhÃ¢rn the Betrayer":{baseType:"40mm"},"Khorne Berzerkers":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Invocatus":{baseType:"90x52.5mm"},"Lord on Juggernaut":{baseType:"90x52.5mm"},"Master of Executions":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},Slaughterbound:{baseType:"50mm"},"Terminator Squad":{baseType:"40mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodthirster:{baseType:"120x92mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Skarbrand:{baseType:"100mm"}}},cm=rt(ea);function um(){return Object.keys(ea)}function ro(e){return ea[e]?Object.keys(ea[e]):[]}function Ws(e,t){return!ea[e]||!ea[e][t]?null:ea[e][t]}Ut(cm,e=>Object.keys(e));function mm(e,t){const a=e.FACTION_KEYWORD,r=e.UNITS||[],s=[],i=[],o={};for(const c of r){const m=c.name||"",d=nm(c.quantity);let h=Ws(a,m);if(!h){const u=oo(m,a);u&&(h=Ws(a,u))}if(!h){const{faction:u,unitName:f}=hm(m);u&&f&&(h=Ws(u,f))}if(h){o[m]||(o[m]=0),o[m]++;const u=o[m]>1?` #${o[m]}`:"",f=`${m}${u}`,y=dm(h,d,t,f);s.push(...y)}else i.push({id:"unmatched-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),unitName:m,quantity:d,points:c.points,section:c.section})}return{matched:io(s),unmatched:i}}function dm(e,t,a,r,s){const i=[],o=fm(),l=e.baseType,c=ym(r,l);for(let m=0;m<t;m++){const h={id:vm(),baseType:l,playerId:a,x:0,y:0,rotation:0,unitId:o,unitName:r,name:c,imported:!0,inStaging:!0};l==="hull"&&(h.baseType="rect-custom",h.customWidth=e.hullDimensions?.width||5.5,h.customHeight=e.hullDimensions?.height||3),i.push(h)}return i}function io(e){const i={};e.forEach(m=>{const d=m.unitId||"ungrouped";i[d]||(i[d]=[]),i[d].push(m)});let o=2,l=2,c=0;for(const m in i){const d=i[m];for(const h of d)h.x=o,h.y=l,o+=2,c++,c>=6&&(o=2,l+=2,c=0);c>0&&(o=2,l+=2,c=0)}return e}function oo(e,t){const a=ro(t);if(!a||a.length===0)return null;const r=jn(e);for(const l of a)if(jn(l)===r)return l;const s=r.replace(/s$/,""),i=r+"s";for(const l of a){const c=jn(l);if(c===s||c===i)return l}for(const l of a){const c=jn(l);if(r.includes(c)||c.includes(r))return l}const o=r.split(/\s+/).filter(l=>l.length>2);if(o.length>0)for(const l of a){const c=jn(l);if(o.every(m=>c.includes(m)))return l}return null}function hm(e){const t=um(),a=jn(e);for(const r of t){const s=ro(r);if(s){for(const i of s)if(jn(i)===a)return{faction:r,unitName:i}}}for(const r of t){const s=oo(e,r);if(s)return{faction:r,unitName:s}}return{faction:null,unitName:null}}function jn(e){return String(e||"").toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim()}function fm(){return"unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function ym(e,t){if(!e)return"";const a=t.match(/(\d+)mm/),r=a?parseInt(a[1],10):null;return r&&r<50?pm(e):e}function pm(e){return e?e.replace(/\s*#\d+$/,"").split(/\s+/).filter(s=>s.length>0).slice(0,3).map(s=>s[0].toUpperCase()).join(""):""}function vm(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}var gm=ye('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Selected</span> <span class="value svelte-1g40uyy"> </span></div> <button class="danger svelte-1g40uyy"> </button></div>'),bm=ye('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Rotation</span> <span class="value svelte-1g40uyy"> </span></div>'),Tm=ye('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div>'),xm=ye('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),_m=ye('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Base Type</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Player</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Position</span> <span class="value svelte-1g40uyy"> </span></div> <!> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-1g40uyy">Remove</button></div>'),Sm=ye('<p class="hint svelte-1g40uyy">Click a model to select it</p>'),wm=ye('<div class="button-group vertical svelte-1g40uyy"><div class="button-row svelte-1g40uyy"><button title="Undo (Ctrl+Z)" class="svelte-1g40uyy">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-1g40uyy">Redo</button></div> <button class="svelte-1g40uyy">Save State</button> <button class="svelte-1g40uyy">Restore State</button> <button class="secondary svelte-1g40uyy">Clear All Models</button> <button class="secondary svelte-1g40uyy">Clear Saved State</button></div>'),Am=ye('<div class="player-toggle svelte-1g40uyy"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-1g40uyy"><div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Circles</h4> <div class="palette-grid svelte-1g40uyy"></div></div> <div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Ovals</h4> <div class="palette-grid svelte-1g40uyy"></div></div></div>',1),Cm=ye('<div class="rect-hull-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="rect-width" class="svelte-1g40uyy">Width (inches)</label> <input id="rect-width" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <div class="field svelte-1g40uyy"><label for="rect-height" class="svelte-1g40uyy">Height (inches)</label> <input id="rect-height" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <button class="svelte-1g40uyy"> </button></div>'),Em=Ce('<path stroke-width="0.10" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),Rm=Ce('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),Mm=Ce("<!><!>",1),km=Ce('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),Dm=Ce('<g opacity="0.5" pointer-events="none"><!></g>'),Lm=Ce('<line stroke-width="0.05" pointer-events="none"></line>'),Im=Ce('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),Pm=Ce('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),Nm=Ce('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),$m=Ce("<!><!><!><!><!><!><!><!><!><!><!>",1),Om=ye('<div class="staging-wrapper svelte-1g40uyy"><!></div>'),Wm=ye('<main class="svelte-1g40uyy"><div class="header svelte-1g40uyy"><h1 class="svelte-1g40uyy">Deployment Practice</h1> <nav class="nav-links svelte-1g40uyy"><a href="#/setup" class="svelte-1g40uyy">Battlefield Setup</a> <a href="#/deployment" class="active svelte-1g40uyy">Deployment</a> <a href="#/" class="svelte-1g40uyy">Layout Builder</a> <a href="#/debug" class="svelte-1g40uyy">Debug Mode</a></nav></div> <div class="layout svelte-1g40uyy"><div class="sidebar svelte-1g40uyy"><!> <!> <!> <!> <!></div> <div class="main-content svelte-1g40uyy"><div class="battlefield-area svelte-1g40uyy"><div class="battlefield-container svelte-1g40uyy" role="presentation"><!></div> <div class="info svelte-1g40uyy"><p class="svelte-1g40uyy"> </p> <p class="hint svelte-1g40uyy">Drag to select multiple | Ctrl+Click for multi-select | Delete to remove | 1/2 to switch player | L for LoS</p></div></div> <!></div></div></main> <!>',1);function Ym(e,t){Mt(t,!1);const a=()=>Ve(fs,"$selectedDeployment",u),r=()=>Ve(pa,"$selectedLayoutName",u),s=()=>Ve(Ua,"$selectedLayoutType",u),i=()=>Ve(st,"$models",u),o=()=>Ve(Ot,"$selectedModelId",u),l=()=>Ve(Ji,"$loadedTerrain",u),c=()=>Ve(Gn,"$history",u),m=()=>Ve(ru,"$player1Models",u),d=()=>Ve(iu,"$player2Models",u),h=()=>Ve(Qt,"$stagingModels",u),[u,f]=ka(),y=$(),v=$(),p=$(),x=$(),E=$();let A=$(1),g=$(null),_=!1,R=null,k=$(null),S=$(!1),D=$(!1),N=$(5.5),re=$(3),z=$(!1),de=$([]),ce=[],Y=$(null),X=$(!1),F=$(null),q=$(null),H=$(new Set),G=$(new Set),P=!1,O=!1,W=null,J=!1,ae=null;const $e=5,Fe="warhammer-deployment-state";function K(){const L={deployment:a()?.name||null,layout:r()||null,layoutType:s()||null,models:i()};localStorage.setItem(Fe,JSON.stringify(L))}function ue(){const L=localStorage.getItem(Fe);if(L)try{const ie=JSON.parse(L);ie.models&&Array.isArray(ie.models)&&(st.set(ie.models),Gn.clear())}catch(ie){console.error("Failed to restore deployment state:",ie)}}function Pe(){localStorage.removeItem(Fe),st.clear()}async function oe(L){const{text:ie,playerId:fe}=L.detail;try{n(Y)&&n(Y).setLoading(!0);const{format:we,data:Ee}=await em(ie),{matched:ge,unmatched:Re}=mm(Ee,fe),ke=Ee.LIST_TITLE||`${Ee.FACTION_KEYWORD} Army`;Qs.addImport(ke,ie,Ee,fe),Re.length>0?(w(de,Re),ce=ge,w(z,!0),n(Y)&&n(Y).setLoading(!1)):(Yr(ge,Ee.FACTION_KEYWORD),n(Y)&&(n(Y).setSuccess(`Imported ${ge.length} models from ${Ee.FACTION_KEYWORD} (${we})`),n(Y).clearText()))}catch(we){console.error("Failed to parse army list:",we),n(Y)&&n(Y).setError(we.message||"Failed to parse army list")}}function lt(L){const{selected:ie}=L.detail,fe=[];for(const ge of ie){const Re=typeof ge.quantity=="string"?parseInt(ge.quantity.replace(/x/i,""),10)||1:ge.quantity||1,ke="unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);for(let qe=0;qe<Re;qe++)fe.push({id:"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),baseType:ge.baseType,playerId:n(A),x:0,y:0,rotation:0,unitId:ke,unitName:ge.unitName,imported:!0,inStaging:!0})}const we=[...ce,...fe],Ee=io(we);Yr(Ee,"imported"),n(Y)&&(n(Y).setSuccess(`Imported ${we.length} models to staging area`),n(Y).clearText()),w(de,[]),ce=[]}function ht(L){const{modelIds:ie}=L.detail;ku(ie,30,22)}function Je(){}Da(()=>{window.addEventListener("keydown",He)}),Wi(()=>{window.removeEventListener("keydown",He)});function He(L){if(L.target.tagName==="INPUT")return;const ie=o();if((L.ctrlKey||L.metaKey)&&L.key==="z"&&!L.shiftKey){L.preventDefault(),st.undo();return}if((L.ctrlKey||L.metaKey)&&(L.key==="y"||L.shiftKey&&L.key==="z")){L.preventDefault(),st.redo();return}if(L.key==="1"){L.preventDefault(),w(A,1);return}if(L.key==="2"){L.preventDefault(),w(A,2);return}if(L.key==="l"||L.key==="L"){L.preventDefault(),w(S,!n(S));return}if(L.key==="Delete"||L.key==="Backspace"){L.preventDefault(),n(H).size>0?(n(H).forEach(fe=>{st.remove(fe)}),n(H).clear(),w(H,n(H))):o()&&(st.remove(o()),Ot.set(null));return}if((L.key==="Delete"||L.key==="Backspace")&&ie){L.preventDefault(),se();return}if(ie&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(L.key)){L.preventDefault();const fe=L.shiftKey?.1:1;let we=0,Ee=0;switch(L.key){case"ArrowUp":Ee=-fe;break;case"ArrowDown":Ee=fe;break;case"ArrowLeft":we=-fe;break;case"ArrowRight":we=fe;break}if(o()){const ge=i().find(Re=>Re.id===o());ge&&st.updateModel(o(),{x:ge.x+we,y:ge.y+Ee},!1)}return}if(L.key==="Escape"){ft();return}}function ft(L){if(P){P=!1;return}Ot.set(null),n(H).clear(),w(H,n(H))}function rn(L){if(L.target.closest(".model-base")||!n(k))return;L.preventDefault();const we=n(k)(L.clientX,L.clientY);w(F,{x:we.x,y:we.y}),w(q,{x:we.x,y:we.y}),w(X,!0),window.addEventListener("mousemove",Kt),window.addEventListener("mouseup",Q)}function Kt(L){if(!n(X)||!n(k))return;const ie=n(k)(L.clientX,L.clientY);w(q,{x:ie.x,y:ie.y});const fe=Math.min(n(F).x,n(q).x),we=Math.max(n(F).x,n(q).x),Ee=Math.min(n(F).y,n(q).y),ge=Math.max(n(F).y,n(q).y),Re=new Set;i().forEach(ke=>{ke.x>=fe&&ke.x<=we&&ke.y>=Ee&&ke.y<=ge&&Re.add(ke.id)}),w(G,Re)}function Q(L){if(!n(X))return;const ie=Math.min(n(F).x,n(q).x),fe=Math.max(n(F).x,n(q).x),we=Math.min(n(F).y,n(q).y),Ee=Math.max(n(F).y,n(q).y),ge=fe-ie,Re=Ee-we;if(ge<.5&&Re<.5)n(H).clear(),Ot.set(null);else{const ke=new Set;i().forEach(qe=>{qe.x>=ie&&qe.x<=fe&&qe.y>=we&&qe.y<=Ee&&ke.add(qe.id)}),w(H,ke),n(H).size>0&&Ot.set(null),P=!0}w(X,!1),w(F,null),w(q,null),n(G).clear(),w(G,n(G)),window.removeEventListener("mousemove",Kt),window.removeEventListener("mouseup",Q)}function be(L,ie){if(!n(k))return;_=!0,R={x:ie.clientX,y:ie.clientY};const fe=n(k)(ie.clientX,ie.clientY);w(g,{baseType:L.type,x:fe.x,y:fe.y}),window.addEventListener("mousemove",Le),window.addEventListener("mouseup",Qe)}function Le(L){if(!_||!n(g)||!n(k))return;const ie=n(k)(L.clientX,L.clientY);w(g,{...n(g),x:ie.x,y:ie.y})}function Qe(L){if(!_||!n(g)){_=!1,w(g,null),R=null,window.removeEventListener("mousemove",Le),window.removeEventListener("mouseup",Qe);return}const ie=L.clientX-R.x,fe=L.clientY-R.y,we=Math.sqrt(ie*ie+fe*fe);let Ee,ge;we<$e?(Ee=30,ge=22):(Ee=n(g).x,ge=n(g).y);const Re=n(g).customWidth&&n(g).customHeight?{width:n(g).customWidth,height:n(g).customHeight}:null,ke=st.add(n(g).baseType,n(A),Ee,ge,Re);Ot.set(ke),w(g,null),_=!1,R=null,window.removeEventListener("mousemove",Le),window.removeEventListener("mouseup",Qe)}function Ke(){const fe={width:n(N),height:n(re)},we=st.add("rect-custom",n(A),30,22,fe);Ot.set(we)}function B(L,ie){ie&&(ie.ctrlKey||ie.metaKey||ie.shiftKey)?(n(H).has(L)?n(H).delete(L):n(H).add(L),w(H,n(H)),Ot.set(null)):(n(H).has(L)&&n(H).size>1||(n(H).clear(),n(H).add(L),w(H,n(H))),Ot.set(null))}function he(L,ie,fe){if(n(H).size>1&&n(H).has(L)){O||(O=!0,W={},n(H).forEach(Ee=>{const ge=i().find(Re=>Re.id===Ee);ge&&(W[Ee]={x:ge.x,y:ge.y})}));const we=W[L];if(we){const Ee=ie-we.x,ge=fe-we.y;n(H).forEach(Re=>{const ke=W[Re];ke&&st.updateModel(Re,{x:ke.x+Ee,y:ke.y+ge},!0)})}}else st.updateModel(L,{x:ie,y:fe},!0)}function ve(L,ie,fe,we,Ee){O?(n(H).forEach(ge=>{const Re=W[ge],ke=i().find(qe=>qe.id===ge);Re&&ke&&Gn.push({type:"move",modelId:ge,before:{x:Re.x,y:Re.y},after:{x:ke.x,y:ke.y}})}),O=!1,W=null):Gn.push({type:"move",modelId:L,before:{x:ie,y:fe},after:{x:we,y:Ee}})}function _e(L,ie){if(n(H).size>1&&n(H).has(L)){if(!J){J=!0;let ge=0,Re=0,ke=0;const qe={};n(H).forEach(ct=>{const Tt=i().find(yt=>yt.id===ct);Tt&&(ge+=Tt.x,Re+=Tt.y,ke++,qe[ct]={x:Tt.x,y:Tt.y,rotation:Tt.rotation||0})}),ae={x:ge/ke,y:Re/ke},W=qe}const fe=i().find(ge=>ge.id===L),we=W[L];if(!fe||!we)return;const Ee=ie-we.rotation;n(H).forEach(ge=>{const Re=W[ge];if(Re){const ke=Re.x-ae.x,qe=Re.y-ae.y,ct=Ee*Math.PI/180,Tt=Math.cos(ct),yt=Math.sin(ct),Nt=ke*Tt-qe*yt,Jt=ke*yt+qe*Tt;st.updateModel(ge,{x:ae.x+Nt,y:ae.y+Jt,rotation:Re.rotation+Ee},!0)}})}else st.updateModel(L,{rotation:ie},!0)}function pe(L,ie,fe){J?(n(H).forEach(we=>{const Ee=W[we],ge=i().find(Re=>Re.id===we);Ee&&ge&&Gn.push({type:"rotate",modelId:we,before:{x:Ee.x,y:Ee.y,rotation:Ee.rotation},after:{x:ge.x,y:ge.y,rotation:ge.rotation||0}})}),J=!1,ae=null,W=null):Gn.push({type:"rotate",modelId:L,before:{rotation:ie},after:{rotation:fe}})}function te(L,ie){st.updateModel(L,{name:ie})}function se(){n(H).size>0?(n(H).forEach(L=>{st.remove(L)}),n(H).clear(),w(H,n(H))):o()&&(st.remove(o()),Ot.set(null))}function j(){confirm("Clear all models?")&&(st.clear(),Ot.set(null))}function xe(L){if(pr(L.baseType))return{x:L.x,y:L.y,width:L.customWidth,height:L.customHeight,rotation:L.rotation||0,isRectangle:!0};const ie=Ka(L.baseType,L);return Ga(L.baseType)?{x:L.x,y:L.y,rx:ie.width/2,ry:ie.height/2,rotation:L.rotation||0}:{x:L.x,y:L.y,radius:ie.radius}}me(()=>(i(),o()),()=>{w(y,i().find(L=>L.id===o()))}),me(()=>(n(y),i()),()=>{w(v,n(y)?i().filter(L=>L.playerId!==n(y).playerId):[])}),me(()=>(l(),ja),()=>{w(p,l().terrains.map(L=>({id:L.id,vertices:ja(L)})))}),me(()=>(l(),wa),()=>{w(x,l().walls.map(L=>hr(wa(L.shape),L.x,L.y,L.rotation)))}),me(()=>(n(y),n(S),n(v),n(p),n(x)),()=>{w(E,n(y)&&n(S)&&n(v).length>0?n(v).map(L=>{const ie=Bi(xe(n(y)),xe(L),n(p),n(x));return{targetId:L.id,target:L,canSee:ie.canSee,firstClearRay:ie.firstClearRay,rays:ie.rays}}):[])}),pn(),Pt();var et=Wm(),Ie=Ne(et),U=C(M(Ie),2),Ge=M(U),Dt=M(Ge);Ct(Dt,{title:"Selected Model",children:(L,ie)=>{var fe=dt(),we=Ne(fe);{var Ee=Re=>{var ke=gm(),qe=M(ke),ct=C(M(qe),2),Tt=M(ct),yt=C(qe,2),Nt=M(yt);Z(()=>{Se(Tt,`${n(H),b(()=>n(H).size)??""} models`),Se(Nt,`Remove All (${n(H),b(()=>n(H).size)??""})`)}),ee("click",yt,se),I(Re,ke)},ge=Re=>{var ke=dt(),qe=Ne(ke);{var ct=yt=>{var Nt=_m(),Jt=M(Nt),kn=C(M(Jt),2),Pa=C(Jt,2),Ds=C(M(Pa),2),ts=M(Ds),ns=C(Pa,2),Ls=C(M(ns),2),Is=M(Ls),Ye=C(ns,2),le=C(M(Ye),2),pt=M(le),vt=C(Ye,2);{var Ze=_t=>{var ln=bm(),qn=C(M(ln),2),Na=M(qn);Z(Un=>Se(Na,`${Un??""}Â°`),[()=>(n(y),b(()=>Math.round(n(y).rotation||0)))]),I(_t,ln)};Te(vt,_t=>{ne(Ga),n(y),b(()=>Ga(n(y).baseType))&&_t(Ze)})}var Oe=C(vt,2),$t=M(Oe),vn=M($t),xt=C(Oe,2);{var ot=_t=>{var ln=Tm(),qn=M(ln),Na=M(qn);Ts(Na,()=>n(D),Un=>w(D,Un)),I(_t,ln)};Te(xt,_t=>{n(S)&&_t(ot)})}var mt=C(xt,2);{var as=_t=>{var ln=xm(),qn=C(M(ln),2),Na=M(qn);Z(Un=>Se(Na,`${Un??""}/${n(E),b(()=>n(E).length)??""} visible`),[()=>(n(E),b(()=>n(E).filter(Un=>Un.canSee).length))]),I(_t,ln)};Te(mt,_t=>{n(S),n(E),b(()=>n(S)&&n(E).length>0)&&_t(as)})}var lo=C(mt,2);Z((_t,ln,qn)=>{Il(kn,(n(y),b(()=>n(y).name||""))),Se(ts,_t),Se(Is,`Player ${n(y),b(()=>n(y).playerId)??""}`),Se(pt,`${ln??""}", ${qn??""}"`)},[()=>(ne(Ka),n(y),b(()=>Ka(n(y).baseType,n(y))?.label||"Unknown")),()=>(n(y),b(()=>n(y).x.toFixed(1))),()=>(n(y),b(()=>n(y).y.toFixed(1)))]),ee("change",kn,_t=>te(n(y).id,_t.target.value)),Ts(vn,()=>n(S),_t=>w(S,_t)),ee("click",lo,se),I(yt,Nt)},Tt=yt=>{var Nt=Sm();I(yt,Nt)};Te(qe,yt=>{n(y)?yt(ct):yt(Tt,!1)},!0)}I(Re,ke)};Te(we,Re=>{n(H),b(()=>n(H).size>1)?Re(Ee):Re(ge,!1)})}I(L,fe)},$$slots:{default:!0}});var tt=C(Dt,2);Ct(tt,{title:"Import Army List",startOpen:!1,children:(L,ie)=>{Es(wu(L,{get currentPlayer(){return n(A)},$$events:{parse:oe},$$legacy:!0}),fe=>w(Y,fe),()=>n(Y))},$$slots:{default:!0}});var Gt=C(tt,2);Ct(Gt,{title:"Actions",children:(L,ie)=>{var fe=wm(),we=M(fe),Ee=M(we),ge=C(Ee,2),Re=C(we,2),ke=C(Re,2),qe=C(ke,2),ct=C(qe,2);Z(()=>{Ee.disabled=(c(),b(()=>!c().past.length)),ge.disabled=(c(),b(()=>!c().future.length))}),ee("click",Ee,()=>st.undo()),ee("click",ge,()=>st.redo()),ee("click",Re,K),ee("click",ke,ue),ee("click",qe,j),ee("click",ct,Pe),I(L,fe)},$$slots:{default:!0}});var on=C(Gt,2);Ct(on,{title:"Add Models",children:(L,ie)=>{var fe=Am(),we=Ne(fe),Ee=M(we);let ge;var Re=C(Ee,2);let ke;var qe=C(we,2),ct=M(qe),Tt=C(M(ct),2);Me(Tt,5,()=>(ne(Ft),b(()=>Ft.circles)),We,(Jt,kn)=>{_s(Jt,{get baseSize(){return n(kn)},get playerId(){return n(A)},onDragStart:be})});var yt=C(ct,2),Nt=C(M(yt),2);Me(Nt,5,()=>(ne(Ft),b(()=>Ft.ovals)),We,(Jt,kn)=>{_s(Jt,{get baseSize(){return n(kn)},get playerId(){return n(A)},onDragStart:be})}),Z(()=>{ge=an(Ee,1,"toggle-btn svelte-1g40uyy",null,ge,{active:n(A)===1}),ke=an(Re,1,"toggle-btn svelte-1g40uyy",null,ke,{active:n(A)===2})}),ee("click",Ee,()=>w(A,1)),ee("click",Re,()=>w(A,2)),I(L,fe)},$$slots:{default:!0}});var bt=C(on,2);Ct(bt,{title:"Add Hull (Vehicle)",children:(L,ie)=>{var fe=Cm(),we=M(fe),Ee=C(M(we),2),ge=C(we,2),Re=C(M(ge),2),ke=C(ge,2),qe=M(ke);Z(()=>Se(qe,`Add ${n(N)??""}" Ã ${n(re)??""}" Hull`)),ga(Ee,()=>n(N),ct=>w(N,ct)),ga(Re,()=>n(re),ct=>w(re,ct)),ee("click",ke,Ke),I(L,fe)},$$slots:{default:!0}});var it=C(Ge,2),nt=M(it),ut=M(nt),Fn=M(ut);Rs(Fn,{children:ar,$$slots:{default:(L,ie)=>{const fe=ze(()=>ie.screenToSvg);var we=$m(),Ee=Ne(we);{var ge=Ye=>{var le=Ii();Z(()=>Se(le,(n(k),ne(n(fe)),b(()=>(w(k,n(fe)),""))))),I(Ye,le)};Te(Ee,Ye=>{n(fe)&&!n(k)&&Ye(ge)})}var Re=C(Ee);{var ke=Ye=>{var le=Mm(),pt=Ne(le);Me(pt,1,()=>(a(),b(()=>a().zones)),We,(Ze,Oe)=>{var $t=Em();Z(vn=>{T($t,"d",vn),T($t,"fill",(n(Oe),b(()=>n(Oe).color))),T($t,"stroke",(n(Oe),b(()=>n(Oe).borderColor)))},[()=>(ne(Xs),n(Oe),b(()=>Xs(n(Oe).path)))]),I(Ze,$t)});var vt=C(pt);Me(vt,1,()=>(a(),b(()=>a().objectives)),We,(Ze,Oe)=>{const $t=ze(()=>(n(Oe),b(()=>n(Oe).isPrimary?"#fbbf24":"#9ca3af"))),vn=ze(()=>(n(Oe),b(()=>n(Oe).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var xt=Rm(),ot=Ne(xt),mt=C(ot),as=C(mt);Z(()=>{T(ot,"cx",(n(Oe),b(()=>n(Oe).x))),T(ot,"cy",(n(Oe),b(()=>n(Oe).y))),T(ot,"r",Qi),T(ot,"fill",n(vn)),T(ot,"stroke",n($t)),T(mt,"cx",(n(Oe),b(()=>n(Oe).x))),T(mt,"cy",(n(Oe),b(()=>n(Oe).y))),T(mt,"r",Vi),T(mt,"fill",n($t)),T(as,"cx",(n(Oe),b(()=>n(Oe).x))),T(as,"cy",(n(Oe),b(()=>n(Oe).y)))}),I(Ze,xt)}),I(Ye,le)};Te(Re,Ye=>{a()&&Ye(ke)})}var qe=C(Re);Te(qe,Ye=>{});var ct=C(qe);Te(ct,Ye=>{});var Tt=C(ct);Me(Tt,1,()=>(l(),b(()=>l().terrains)),We,(Ye,le)=>{var pt=km(),vt=M(pt);Z(()=>{T(pt,"transform",`rotate(${n(le),b(()=>n(le).rotation)??""}, ${n(le),b(()=>n(le).x+n(le).width/2)??""}, ${n(le),b(()=>n(le).y+n(le).height/2)??""})`),T(vt,"x",(n(le),b(()=>n(le).x))),T(vt,"y",(n(le),b(()=>n(le).y))),T(vt,"width",(n(le),b(()=>n(le).width))),T(vt,"height",(n(le),b(()=>n(le).height)))}),I(Ye,pt)});var yt=C(Tt);Me(yt,1,()=>(l(),b(()=>l().walls)),We,(Ye,le)=>{var pt=Dm(),vt=M(pt);yr(vt,{get id(){return n(le),b(()=>n(le).id)},get x(){return n(le),b(()=>n(le).x)},get y(){return n(le),b(()=>n(le).y)},get shape(){return n(le),b(()=>n(le).shape)},get rotation(){return n(le),b(()=>n(le).rotation)},selected:!1,get screenToSvg(){return n(fe)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),I(Ye,pt)});var Nt=C(yt);Me(Nt,1,i,Ye=>Ye.id,(Ye,le)=>{{let pt=ze(()=>(n(le),b(()=>n(le).name||""))),vt=ze(()=>(n(le),o(),n(H),b(()=>n(le).id===o()||n(H).has(n(le).id)))),Ze=ze(()=>(n(H),n(le),n(G),b(()=>!n(H).has(n(le).id)&&n(G).has(n(le).id))));Xa(Ye,{get id(){return n(le),b(()=>n(le).id)},get x(){return n(le),b(()=>n(le).x)},get y(){return n(le),b(()=>n(le).y)},get baseType(){return n(le),b(()=>n(le).baseType)},get playerId(){return n(le),b(()=>n(le).playerId)},get rotation(){return n(le),b(()=>n(le).rotation)},get name(){return n(pt)},get customWidth(){return n(le),b(()=>n(le).customWidth)},get customHeight(){return n(le),b(()=>n(le).customHeight)},get selected(){return n(vt)},get marqueePreview(){return n(Ze)},get screenToSvg(){return n(fe)},onSelect:B,onDrag:he,onDragEnd:ve,onRotate:_e,onRotateEnd:pe,onRename:te})}});var Jt=C(Nt);{var kn=Ye=>{Xa(Ye,{id:"phantom",get x(){return n(g),b(()=>n(g).x)},get y(){return n(g),b(()=>n(g).y)},get baseType(){return n(g),b(()=>n(g).baseType)},get playerId(){return n(A)},rotation:0,get customWidth(){return n(g),b(()=>n(g).customWidth)},get customHeight(){return n(g),b(()=>n(g).customHeight)},selected:!1,get screenToSvg(){return n(fe)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};Te(Jt,Ye=>{n(g)&&Ye(kn)})}var Pa=C(Jt);{var Ds=Ye=>{var le=dt(),pt=Ne(le);Me(pt,1,()=>n(E),We,(vt,Ze)=>{var Oe=dt(),$t=Ne(Oe);Me($t,1,()=>(n(Ze),b(()=>n(Ze).rays)),We,(vn,xt)=>{var ot=Lm();Z(()=>{T(ot,"x1",(n(xt),b(()=>n(xt).from.x))),T(ot,"y1",(n(xt),b(()=>n(xt).from.y))),T(ot,"x2",(n(xt),b(()=>n(xt).to.x))),T(ot,"y2",(n(xt),b(()=>n(xt).to.y))),T(ot,"stroke",(n(xt),b(()=>n(xt).blocked?"#ff000033":"#00ff0033")))}),I(vn,ot)}),I(vt,Oe)}),I(Ye,le)};Te(Pa,Ye=>{n(D),n(S),n(y),n(E),b(()=>n(D)&&n(S)&&n(y)&&n(E).length>0)&&Ye(Ds)})}var ts=C(Pa);{var ns=Ye=>{var le=dt(),pt=Ne(le);Me(pt,1,()=>n(E),We,(vt,Ze)=>{var Oe=dt(),$t=Ne(Oe);{var vn=ot=>{var mt=Im();Z(()=>{T(mt,"x1",(n(Ze),b(()=>n(Ze).firstClearRay.from.x))),T(mt,"y1",(n(Ze),b(()=>n(Ze).firstClearRay.from.y))),T(mt,"x2",(n(Ze),b(()=>n(Ze).firstClearRay.to.x))),T(mt,"y2",(n(Ze),b(()=>n(Ze).firstClearRay.to.y)))}),I(ot,mt)},xt=ot=>{var mt=Pm();Z(()=>{T(mt,"x1",(n(y),b(()=>n(y).x))),T(mt,"y1",(n(y),b(()=>n(y).y))),T(mt,"x2",(n(Ze),b(()=>n(Ze).target.x))),T(mt,"y2",(n(Ze),b(()=>n(Ze).target.y)))}),I(ot,mt)};Te($t,ot=>{n(Ze),b(()=>n(Ze).firstClearRay)?ot(vn):ot(xt,!1)})}I(vt,Oe)}),I(Ye,le)};Te(ts,Ye=>{n(S),n(y),n(E),b(()=>n(S)&&n(y)&&n(E).length>0)&&Ye(ns)})}var Ls=C(ts);{var Is=Ye=>{const le=ze(()=>(n(F),n(q),b(()=>Math.min(n(F).x,n(q).x)))),pt=ze(()=>(n(F),n(q),b(()=>Math.min(n(F).y,n(q).y)))),vt=ze(()=>(n(q),n(F),b(()=>Math.abs(n(q).x-n(F).x)))),Ze=ze(()=>(n(q),n(F),b(()=>Math.abs(n(q).y-n(F).y))));var Oe=Nm();Z(()=>{T(Oe,"x",n(le)),T(Oe,"y",n(pt)),T(Oe,"width",n(vt)),T(Oe,"height",n(Ze))}),I(Ye,Oe)};Te(Ls,Ye=>{n(X)&&n(F)&&n(q)&&Ye(Is)})}I(L,we)}}});var ia=C(ut,2),oa=M(ia),La=M(oa),Ia=C(nt,2);{var Ms=L=>{var ie=Om(),fe=M(ie);Hu(fe,{$$events:{deploy:ht,clear:Je}}),I(L,ie)};Te(Ia,L=>{h(),b(()=>h().length>0)&&L(Ms)})}var ks=C(Ie,2);Ru(ks,{get unmatchedUnits(){return n(de)},get show(){return n(z)},set show(L){w(z,L)},$$events:{import:lt,close:()=>{w(z,!1)}},$$legacy:!0}),Z(()=>Se(La,`Battlefield: 60" x 44" | ${m(),b(()=>m().length)??""} P1 models | ${d(),b(()=>d().length)??""} P2 models`)),ee("click",ut,ft),ee("mousedown",ut,rn),I(e,et),kt(),f()}var Hm=ye("<span> </span>"),Bm=ye('<span class="los-status svelte-12aohay">No enemies</span>'),Fm=ye('<div class="controls svelte-12aohay"><label class="svelte-12aohay"><input type="checkbox" class="svelte-12aohay"/> Show debug rays</label> <!></div>'),qm=ye('<button class="svelte-12aohay"> </button>'),Um=ye('<div class="button-group svelte-12aohay"></div>'),Km=ye('<button class="svelte-12aohay"> </button>'),Gm=ye('<div class="button-group svelte-12aohay"></div>'),zm=ye('<div class="player-toggle svelte-12aohay"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-12aohay"><div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Circles</h4> <div class="palette-grid svelte-12aohay"></div></div> <div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Ovals</h4> <div class="palette-grid svelte-12aohay"></div></div></div>',1),jm=Ce('<line stroke-width="0.05"></line>'),Xm=Ce('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),Vm=Ce('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),Qm=Ce("<!><!><!><!><!><!><!>",1),Zm=ye('<p class="svelte-12aohay"> </p>'),Jm=ye('<main class="svelte-12aohay"><div class="header svelte-12aohay"><h1 class="svelte-12aohay">Debug Mode</h1> <nav class="nav-links svelte-12aohay"><a href="#/setup" class="svelte-12aohay">Battlefield Setup</a> <a href="#/deployment" class="svelte-12aohay">Deployment</a> <a href="#/" class="svelte-12aohay">Layout Builder</a> <a href="#/debug" class="active svelte-12aohay">Debug Mode</a></nav></div> <div class="layout svelte-12aohay"><div class="sidebar svelte-12aohay"><!> <!> <!> <!></div> <div class="battlefield-area svelte-12aohay"><div class="battlefield-container svelte-12aohay"><!></div> <div class="info svelte-12aohay"><p class="svelte-12aohay"> </p> <!> <p class="hint svelte-12aohay">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function ed(e,t){Mt(t,!1);const a=()=>Ve(In,"$debugModels",m),r=()=>Ve(zn,"$debugSelectedModelId",m),s=()=>Ve(ls,"$debugTerrains",m),i=()=>Ve(cs,"$debugWalls",m),o=()=>Ve(Or,"$debugMode",m),l=()=>Ve(us,"$debugSelectedTerrainId",m),c=()=>Ve(ms,"$debugSelectedWallId",m),[m,d]=ka(),h=$(),u=$(),f=$(),y=$(),v=$();function p(Q,be){ls.add(Q,be)}function x(Q){cs.add(Q)}function E(Q){us.set(Q),ms.set(null),zn.set(null)}function A(Q){ms.set(Q),us.set(null),zn.set(null)}function g(Q,be,Le){ls.updateTerrain(Q,{x:be,y:Le})}function _(Q,be,Le){cs.updateWall(Q,{x:be,y:Le})}function R(Q,be){ls.updateTerrain(Q,{rotation:be})}function k(Q,be){cs.updateWall(Q,{rotation:be})}let S=$(1),D=$(null),N=!1,re=null,z=$(null);const de=5;Da(()=>{if(a().length===0){const Q=In.add("32mm",1,10,22);In.add("32mm",2,50,22),zn.set(Q)}});function ce(Q,be){if(!n(z))return;N=!0,re={x:be.clientX,y:be.clientY};const Le=n(z)(be.clientX,be.clientY);w(D,{baseType:Q.type,x:Le.x,y:Le.y}),window.addEventListener("mousemove",Y),window.addEventListener("mouseup",X)}function Y(Q){if(!N||!n(D)||!n(z))return;const be=n(z)(Q.clientX,Q.clientY);w(D,{...n(D),x:be.x,y:be.y})}function X(Q){if(!N||!n(D)){N=!1,w(D,null),re=null,window.removeEventListener("mousemove",Y),window.removeEventListener("mouseup",X);return}const be=Q.clientX-re.x,Le=Q.clientY-re.y,Qe=Math.sqrt(be*be+Le*Le);let Ke,B;Qe<de?(Ke=30,B=22):(Ke=n(D).x,B=n(D).y);const he=In.add(n(D).baseType,n(S),Ke,B);zn.set(he),w(D,null),N=!1,re=null,window.removeEventListener("mousemove",Y),window.removeEventListener("mouseup",X)}function F(Q){zn.set(Q),us.set(null),ms.set(null)}function q(Q,be,Le){In.updateModel(Q,{x:be,y:Le},!0)}function H(Q,be,Le,Qe,Ke){Vs.push({type:"move",modelId:Q,before:{x:be,y:Le},after:{x:Qe,y:Ke}})}function G(Q,be){In.updateModel(Q,{rotation:be},!0)}function P(Q,be,Le){Vs.push({type:"rotate",modelId:Q,before:{rotation:be},after:{rotation:Le}})}function O(Q,be){In.updateModel(Q,{name:be})}function W(Q){const be=Ka(Q.baseType);return Ga(Q.baseType)?{x:Q.x,y:Q.y,rx:be.width/2,ry:be.height/2,rotation:Q.rotation||0}:{x:Q.x,y:Q.y,radius:be.radius}}me(()=>(a(),r()),()=>{w(h,a().find(Q=>Q.id===r()))}),me(()=>(n(h),a()),()=>{w(u,n(h)?a().filter(Q=>Q.playerId!==n(h).playerId):[])}),me(()=>(s(),ja),()=>{w(f,s().map(Q=>({id:Q.id,vertices:ja(Q)})))}),me(()=>(i(),wa),()=>{w(y,i().map(Q=>hr(wa(Q.shape),Q.x,Q.y,Q.rotation)))}),me(()=>(n(h),n(u),n(f),n(y)),()=>{w(v,n(h)&&n(u).length>0?n(u).map(Q=>{const be=Bi(W(n(h)),W(Q),n(f),n(y));return{targetId:Q.id,target:Q,canSee:be.canSee,firstClearRay:be.firstClearRay,rays:be.rays}}):[])}),pn(),Pt();var J=Jm(),ae=C(M(J),2),$e=M(ae),Fe=M($e);Ct(Fe,{title:"LOS Debug",children:(Q,be)=>{var Le=Fm(),Qe=M(Le),Ke=M(Qe),B=C(Qe,2);{var he=_e=>{var pe=Hm();let te;var se=M(pe);Z((j,xe)=>{te=an(pe,1,"los-status svelte-12aohay",null,te,j),Se(se,`${xe??""}/${n(v),b(()=>n(v).length)??""} visible`)},[()=>({"can-see":n(v).some(j=>j.canSee),blocked:!n(v).some(j=>j.canSee)}),()=>(n(v),b(()=>n(v).filter(j=>j.canSee).length))]),I(_e,pe)},ve=_e=>{var pe=Bm();I(_e,pe)};Te(B,_e=>{n(h),n(v),b(()=>n(h)&&n(v).length>0)?_e(he):_e(ve,!1)})}Ts(Ke,o,_e=>$l(Or,_e)),I(Q,Le)},$$slots:{default:!0}});var K=C(Fe,2);Ct(K,{title:"Add Terrain",defaultOpen:!1,children:(Q,be)=>{var Le=Um();Me(Le,5,()=>Ki,We,(Qe,Ke)=>{var B=qm(),he=M(B);Z(()=>Se(he,(n(Ke),b(()=>n(Ke).label)))),ee("click",B,()=>p(n(Ke).width,n(Ke).height)),I(Qe,B)}),I(Q,Le)},$$slots:{default:!0}});var ue=C(K,2);Ct(ue,{title:"Add Wall",defaultOpen:!1,children:(Q,be)=>{var Le=Gm();Me(Le,5,()=>js,We,(Qe,Ke)=>{var B=Km(),he=M(B);Z(()=>Se(he,(n(Ke),b(()=>n(Ke).label)))),ee("click",B,()=>x(n(Ke).shape)),I(Qe,B)}),I(Q,Le)},$$slots:{default:!0}});var Pe=C(ue,2);Ct(Pe,{title:"Add Models",defaultOpen:!1,children:(Q,be)=>{var Le=zm(),Qe=Ne(Le),Ke=M(Qe);let B;var he=C(Ke,2);let ve;var _e=C(Qe,2),pe=M(_e),te=C(M(pe),2);Me(te,5,()=>(ne(Ft),b(()=>Ft.circles)),We,(xe,et)=>{_s(xe,{get baseSize(){return n(et)},get playerId(){return n(S)},onDragStart:ce})});var se=C(pe,2),j=C(M(se),2);Me(j,5,()=>(ne(Ft),b(()=>Ft.ovals)),We,(xe,et)=>{_s(xe,{get baseSize(){return n(et)},get playerId(){return n(S)},onDragStart:ce})}),Z(()=>{B=an(Ke,1,"toggle-btn svelte-12aohay",null,B,{active:n(S)===1}),ve=an(he,1,"toggle-btn svelte-12aohay",null,ve,{active:n(S)===2})}),ee("click",Ke,()=>w(S,1)),ee("click",he,()=>w(S,2)),I(Q,Le)},$$slots:{default:!0}});var oe=C($e,2),lt=M(oe),ht=M(lt);Rs(ht,{children:ar,$$slots:{default:(Q,be)=>{const Le=ze(()=>be.screenToSvg);var Qe=Qm(),Ke=Ne(Qe);{var B=Ie=>{var U=Ii();Z(()=>Se(U,(n(z),ne(n(Le)),b(()=>(w(z,n(Le)),""))))),I(Ie,U)};Te(Ke,Ie=>{n(Le)&&!n(z)&&Ie(B)})}var he=C(Ke);{var ve=Ie=>{var U=dt(),Ge=Ne(U);Me(Ge,1,()=>n(v),We,(Dt,tt)=>{var Gt=dt(),on=Ne(Gt);Me(on,1,()=>(n(tt),b(()=>n(tt).rays)),We,(bt,it)=>{var nt=jm();Z(()=>{T(nt,"x1",(n(it),b(()=>n(it).from.x))),T(nt,"y1",(n(it),b(()=>n(it).from.y))),T(nt,"x2",(n(it),b(()=>n(it).to.x))),T(nt,"y2",(n(it),b(()=>n(it).to.y))),T(nt,"stroke",(n(it),b(()=>n(it).blocked?"#ff000033":"#00ff0033")))}),I(bt,nt)}),I(Dt,Gt)}),I(Ie,U)};Te(he,Ie=>{o(),n(h),n(v),b(()=>o()&&n(h)&&n(v).length>0)&&Ie(ve)})}var _e=C(he);Me(_e,1,s,Ie=>Ie.id,(Ie,U)=>{{let Ge=ze(()=>(n(U),l(),b(()=>n(U).id===l())));qi(Ie,{get id(){return n(U),b(()=>n(U).id)},get x(){return n(U),b(()=>n(U).x)},get y(){return n(U),b(()=>n(U).y)},get width(){return n(U),b(()=>n(U).width)},get height(){return n(U),b(()=>n(U).height)},get rotation(){return n(U),b(()=>n(U).rotation)},get selected(){return n(Ge)},get screenToSvg(){return n(Le)},onSelect:E,onDrag:g,onRotate:R})}});var pe=C(_e);Me(pe,1,i,Ie=>Ie.id,(Ie,U)=>{{let Ge=ze(()=>(n(U),c(),b(()=>n(U).id===c())));yr(Ie,{get id(){return n(U),b(()=>n(U).id)},get x(){return n(U),b(()=>n(U).x)},get y(){return n(U),b(()=>n(U).y)},get shape(){return n(U),b(()=>n(U).shape)},get rotation(){return n(U),b(()=>n(U).rotation)},get selected(){return n(Ge)},get screenToSvg(){return n(Le)},onSelect:A,onDrag:_,onRotate:k})}});var te=C(pe);Me(te,1,a,Ie=>Ie.id,(Ie,U)=>{{let Ge=ze(()=>(n(U),b(()=>n(U).name||""))),Dt=ze(()=>(n(U),r(),b(()=>n(U).id===r())));Xa(Ie,{get id(){return n(U),b(()=>n(U).id)},get x(){return n(U),b(()=>n(U).x)},get y(){return n(U),b(()=>n(U).y)},get baseType(){return n(U),b(()=>n(U).baseType)},get playerId(){return n(U),b(()=>n(U).playerId)},get rotation(){return n(U),b(()=>n(U).rotation)},get name(){return n(Ge)},get selected(){return n(Dt)},get screenToSvg(){return n(Le)},onSelect:F,onDrag:q,onDragEnd:H,onRotate:G,onRotateEnd:P,onRename:O})}});var se=C(te);{var j=Ie=>{var U=dt(),Ge=Ne(U);Me(Ge,1,()=>n(v),We,(Dt,tt)=>{var Gt=dt(),on=Ne(Gt);{var bt=nt=>{var ut=Xm();Z(()=>{T(ut,"x1",(n(tt),b(()=>n(tt).firstClearRay.from.x))),T(ut,"y1",(n(tt),b(()=>n(tt).firstClearRay.from.y))),T(ut,"x2",(n(tt),b(()=>n(tt).firstClearRay.to.x))),T(ut,"y2",(n(tt),b(()=>n(tt).firstClearRay.to.y)))}),I(nt,ut)},it=nt=>{var ut=Vm();Z(()=>{T(ut,"x1",(n(h),b(()=>n(h).x))),T(ut,"y1",(n(h),b(()=>n(h).y))),T(ut,"x2",(n(tt),b(()=>n(tt).target.x))),T(ut,"y2",(n(tt),b(()=>n(tt).target.y)))}),I(nt,ut)};Te(on,nt=>{n(tt),b(()=>n(tt).firstClearRay)?nt(bt):nt(it,!1)})}I(Dt,Gt)}),I(Ie,U)};Te(se,Ie=>{o(),n(h),n(v),b(()=>o()&&n(h)&&n(v).length>0)&&Ie(j)})}var xe=C(se);{var et=Ie=>{Xa(Ie,{id:"phantom",get x(){return n(D),b(()=>n(D).x)},get y(){return n(D),b(()=>n(D).y)},get baseType(){return n(D),b(()=>n(D).baseType)},get playerId(){return n(S)},rotation:0,selected:!1,get screenToSvg(){return n(Le)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};Te(xe,Ie=>{n(D)&&Ie(et)})}I(Q,Qe)}}});var Je=C(lt,2),He=M(Je),ft=M(He),rn=C(He,2);{var Kt=Q=>{var be=Zm(),Le=M(be);Z(Qe=>Se(Le,`Selected model LOS: ${Qe??""}/${n(v),b(()=>n(v).length)??""} visible`),[()=>(n(v),b(()=>n(v).filter(Qe=>Qe.canSee).length))]),I(Q,be)};Te(rn,Q=>{o(),n(h),n(v),b(()=>o()&&n(h)&&n(v).length>0)&&Q(Kt)})}Z(()=>Se(ft,`Battlefield: 60" x 44" | ${s(),b(()=>s().length)??""} terrain | ${i(),b(()=>i().length)??""} walls | ${a(),b(()=>a().length)??""} models`)),I(e,J),kt(),d()}function td(e,t){Mt(t,!1);let a=$("main");function r(){const c=window.location.hash;c==="#/debug"?w(a,"debug"):c==="#/setup"?w(a,"setup"):c==="#/deployment"?w(a,"deployment"):w(a,"setup")}Da(()=>(r(),window.addEventListener("hashchange",r),()=>window.removeEventListener("hashchange",r))),Pt();var s=dt(),i=Ne(s);{var o=c=>{ed(c,{})},l=c=>{var m=dt(),d=Ne(m);{var h=f=>{su(f,{})},u=f=>{var y=dt(),v=Ne(y);{var p=E=>{Ym(E,{})},x=E=>{$c(E,{})};Te(v,E=>{n(a)==="deployment"?E(p):E(x,!1)},!0)}I(f,y)};Te(d,f=>{n(a)==="setup"?f(h):f(u,!1)},!0)}I(c,m)};Te(i,c=>{n(a)==="debug"?c(o):c(l,!1)})}I(e,s),kt()}Tl(td,{target:document.getElementById("app")});
//# sourceMappingURL=index-DYMjoX2w.js.map
