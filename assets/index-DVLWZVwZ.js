(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=a(s);fetch(s.href,i)}})();const Bs=!1;var ss=Array.isArray,po=Array.prototype.indexOf,Es=Array.from,zr=Object.defineProperty,ta=Object.getOwnPropertyDescriptor,jr=Object.getOwnPropertyDescriptors,vo=Object.prototype,go=Array.prototype,tr=Object.getPrototypeOf,Tr=Object.isExtensible;const Yn=()=>{};function bo(e){return e()}function Ts(e){for(var t=0;t<e.length;t++)e[t]()}function Xr(){var e,t,a=new Promise((r,s)=>{e=r,t=s});return{promise:a,resolve:e,reject:t}}const At=2,xs=4,rs=8,Vr=1<<24,Dn=16,In=32,ca=64,nr=128,Jt=512,wt=1024,Dt=2048,gn=4096,Ut=8192,Cn=16384,ar=32768,Ra=65536,xr=1<<17,Qr=1<<18,Na=1<<19,Jr=1<<20,An=1<<25,ia=32768,Fs=1<<21,sr=1<<22,Hn=1<<23,En=Symbol("$state"),To=Symbol("legacy props"),xo=Symbol(""),xa=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function rr(){throw new Error("https://svelte.dev/e/invalid_default_snippet")}function ir(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function _o(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function So(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function wo(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Ao(e){throw new Error("https://svelte.dev/e/effect_orphan")}function Co(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Eo(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function Ro(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Mo(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function ko(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Do(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Io=1,Lo=2,Zr=4,No=8,Po=16,$o=1,Oo=2,Wo=4,Yo=8,Ho=16,ei=1,Bo=2,St=Symbol(),Fo="http://www.w3.org/1999/xhtml";function qo(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Uo(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function ti(e){return e===this.v}function ni(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function ai(e){return!ni(e,this.v)}let Pa=!1,Ko=!1;function Go(){Pa=!0}let at=null;function Ma(e){at=e}function It(e,t=!1,a){at={p:at,i:!1,c:null,e:null,s:e,x:null,l:Pa&&!t?{s:null,u:null,$:[]}:null}}function Lt(e){var t=at,a=t.e;if(a!==null){t.e=null;for(var r of a)Ti(r)}return e!==void 0&&(t.x=e),t.i=!0,at=t.p,e??{}}function is(){return!Pa||at!==null&&at.l===null}let Zn=[];function si(){var e=Zn;Zn=[],Ts(e)}function $a(e){if(Zn.length===0&&!Xa){var t=Zn;queueMicrotask(()=>{t===Zn&&si()})}Zn.push(e)}function zo(){for(;Zn.length>0;)si()}function ri(e){var t=je;if(t===null)return Be.f|=Hn,e;if((t.f&ar)===0){if((t.f&nr)===0)throw e;t.b.error(e)}else ka(e,t)}function ka(e,t){for(;t!==null;){if((t.f&nr)!==0)try{t.b.error(e);return}catch(a){e=a}t=t.parent}throw e}const jo=-7169;function gt(e,t){e.f=e.f&jo|t}function or(e){(e.f&Jt)!==0||e.deps===null?gt(e,wt):gt(e,gn)}function ii(e){if(e!==null)for(const t of e)(t.f&At)===0||(t.f&ia)===0||(t.f^=ia,ii(t.deps))}function oi(e,t,a){(e.f&Dt)!==0?t.add(e):(e.f&gn)!==0&&a.add(e),ii(e.deps),gt(e,wt)}const us=new Set;let Ue=null,ja=null,an=null,Xt=[],Rs=null,qs=!1,Xa=!1;class yn{committed=!1;current=new Map;previous=new Map;#t=new Set;#i=new Set;#e=0;#s=0;#r=null;#a=new Set;#n=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#s>0}process(t){Xt=[],ja=null,this.apply();var a=[],r=[];for(const s of t)this.#o(s,a,r);this.is_fork||this.#c(),this.is_deferred()?(this.#l(r),this.#l(a)):(ja=this,Ue=null,_r(r),_r(a),ja=null,this.#r?.resolve()),an=null}#o(t,a,r){t.f^=wt;for(var s=t.first,i=null;s!==null;){var o=s.f,l=(o&(In|ca))!==0,c=l&&(o&wt)!==0,u=c||(o&Ut)!==0||this.skipped_effects.has(s);if(!u&&s.fn!==null){l?s.f^=wt:i!==null&&(o&(xs|rs|Vr))!==0?i.b.defer_effect(s):(o&xs)!==0?a.push(s):Wa(s)&&((o&Dn)!==0&&this.#a.add(s),Da(s));var d=s.first;if(d!==null){s=d;continue}}var f=s.parent;for(s=s.next;s===null&&f!==null;)f===i&&(i=null),s=f.next,f=f.parent}}#l(t){for(var a=0;a<t.length;a+=1)oi(t[a],this.#a,this.#n)}capture(t,a){a!==St&&!this.previous.has(t)&&this.previous.set(t,a),(t.f&Hn)===0&&(this.current.set(t,t.v),an?.set(t,t.v))}activate(){Ue=this,this.apply()}deactivate(){Ue===this&&(Ue=null,an=null)}flush(){if(this.activate(),Xt.length>0){if(li(),Ue!==null&&Ue!==this)return}else this.#e===0&&this.process([]);this.deactivate()}discard(){for(const t of this.#i)t(this);this.#i.clear()}#c(){if(this.#s===0){for(const t of this.#t)t();this.#t.clear()}this.#e===0&&this.#u()}#u(){if(us.size>1){this.previous.clear();var t=an,a=!0;for(const s of us){if(s===this){a=!1;continue}const i=[];for(const[l,c]of this.current){if(s.current.has(l))if(a&&c!==s.current.get(l))s.current.set(l,c);else continue;i.push(l)}if(i.length===0)continue;const o=[...s.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var r=Xt;Xt=[];const l=new Set,c=new Map;for(const u of i)ci(u,o,l,c);if(Xt.length>0){Ue=s,s.apply();for(const u of Xt)s.#o(u,[],[]);s.deactivate()}Xt=r}}Ue=null,an=t}this.committed=!0,us.delete(this)}increment(t){this.#e+=1,t&&(this.#s+=1)}decrement(t){this.#e-=1,t&&(this.#s-=1),this.revive()}revive(){for(const t of this.#a)this.#n.delete(t),gt(t,Dt),kn(t);for(const t of this.#n)gt(t,gn),kn(t);this.flush()}oncommit(t){this.#t.add(t)}ondiscard(t){this.#i.add(t)}settled(){return(this.#r??=Xr()).promise}static ensure(){if(Ue===null){const t=Ue=new yn;us.add(Ue),Xa||yn.enqueue(()=>{Ue===t&&t.flush()})}return Ue}static enqueue(t){$a(t)}apply(){}}function Xo(e){var t=Xa;Xa=!0;try{for(var a;;){if(zo(),Xt.length===0&&(Ue?.flush(),Xt.length===0))return Rs=null,a;li()}}finally{Xa=t}}function li(){var e=aa;qs=!0;var t=null;try{var a=0;for(Ss(!0);Xt.length>0;){var r=yn.ensure();if(a++>1e3){var s,i;Vo()}r.process(Xt),Bn.clear()}}finally{qs=!1,Ss(e),Rs=null}}function Vo(){try{Co()}catch(e){ka(e,Rs)}}let xn=null;function _r(e){var t=e.length;if(t!==0){for(var a=0;a<t;){var r=e[a++];if((r.f&(Cn|Ut))===0&&Wa(r)&&(xn=new Set,Da(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?wi(r):r.fn=null),xn?.size>0)){Bn.clear();for(const s of xn){if((s.f&(Cn|Ut))!==0)continue;const i=[s];let o=s.parent;for(;o!==null;)xn.has(o)&&(xn.delete(o),i.push(o)),o=o.parent;for(let l=i.length-1;l>=0;l--){const c=i[l];(c.f&(Cn|Ut))===0&&Da(c)}}xn.clear()}}xn=null}}function ci(e,t,a,r){if(!a.has(e)&&(a.add(e),e.reactions!==null))for(const s of e.reactions){const i=s.f;(i&At)!==0?ci(s,t,a,r):(i&(sr|Dn))!==0&&(i&Dt)===0&&ui(s,t,r)&&(gt(s,Dt),kn(s))}}function ui(e,t,a){const r=a.get(e);if(r!==void 0)return r;if(e.deps!==null)for(const s of e.deps){if(t.includes(s))return!0;if((s.f&At)!==0&&ui(s,t,a))return a.set(s,!0),!0}return a.set(e,!1),!1}function kn(e){for(var t=Rs=e;t.parent!==null;){t=t.parent;var a=t.f;if(qs&&t===je&&(a&Dn)!==0&&(a&Qr)===0)return;if((a&(ca|In))!==0){if((a&wt)===0)return;t.f^=wt}}Xt.push(t)}function Qo(e){let t=0,a=oa(0),r;return()=>{ur()&&(n(a),Oa(()=>(t===0&&(r=v(()=>e(()=>Va(a)))),t+=1,()=>{$a(()=>{t-=1,t===0&&(r?.(),r=void 0,Va(a))})})))}}var Jo=Ra|Na|nr;function Zo(e,t,a){new el(e,t,a)}class el{parent;is_pending=!1;#t;#i=null;#e;#s;#r;#a=null;#n=null;#o=null;#l=null;#c=null;#u=0;#m=0;#h=!1;#f=new Set;#y=new Set;#d=null;#T=Qo(()=>(this.#d=oa(this.#u),()=>{this.#d=null}));constructor(t,a,r){this.#t=t,this.#e=a,this.#s=r,this.parent=je.b,this.is_pending=!!this.#e.pending,this.#r=mr(()=>{je.b=this;{var s=this.#g();try{this.#a=Vt(()=>r(s))}catch(i){this.error(i)}this.#m>0?this.#v():this.is_pending=!1}return()=>{this.#c?.remove()}},Jo)}#x(){try{this.#a=Vt(()=>this.#s(this.#t))}catch(t){this.error(t)}}#_(){const t=this.#e.pending;t&&(this.#n=Vt(()=>t(this.#t)),yn.enqueue(()=>{var a=this.#g();this.#a=this.#p(()=>(yn.ensure(),Vt(()=>this.#s(a)))),this.#m>0?this.#v():(na(this.#n,()=>{this.#n=null}),this.is_pending=!1)}))}#g(){var t=this.#t;return this.is_pending&&(this.#c=Rn(),this.#t.before(this.#c),t=this.#c),t}defer_effect(t){oi(t,this.#f,this.#y)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#e.pending}#p(t){var a=je,r=Be,s=at;vn(this.#r),Nt(this.#r),Ma(this.#r.ctx);try{return t()}catch(i){return ri(i),null}finally{vn(a),Nt(r),Ma(s)}}#v(){const t=this.#e.pending;this.#a!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#c),Ei(this.#a,this.#l)),this.#n===null&&(this.#n=Vt(()=>t(this.#t)))}#b(t){if(!this.has_pending_snippet()){this.parent&&this.parent.#b(t);return}if(this.#m+=t,this.#m===0){this.is_pending=!1;for(const a of this.#f)gt(a,Dt),kn(a);for(const a of this.#y)gt(a,gn),kn(a);this.#f.clear(),this.#y.clear(),this.#n&&na(this.#n,()=>{this.#n=null}),this.#l&&(this.#t.before(this.#l),this.#l=null)}}update_pending_count(t){this.#b(t),this.#u+=t,this.#d&&la(this.#d,this.#u)}get_effect_pending(){return this.#T(),n(this.#d)}error(t){var a=this.#e.onerror;let r=this.#e.failed;if(this.#h||!a&&!r)throw t;this.#a&&(Pt(this.#a),this.#a=null),this.#n&&(Pt(this.#n),this.#n=null),this.#o&&(Pt(this.#o),this.#o=null);var s=!1,i=!1;const o=()=>{if(s){Uo();return}s=!0,i&&Do(),yn.ensure(),this.#u=0,this.#o!==null&&na(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#a=this.#p(()=>(this.#h=!1,Vt(()=>this.#s(this.#t)))),this.#m>0?this.#v():this.is_pending=!1};var l=Be;try{Nt(null),i=!0,a?.(t,o),i=!1}catch(c){ka(c,this.#r&&this.#r.parent)}finally{Nt(l)}r&&$a(()=>{this.#o=this.#p(()=>{yn.ensure(),this.#h=!0;try{return Vt(()=>{r(this.#t,()=>t,()=>o)})}catch(c){return ka(c,this.#r.parent),null}finally{this.#h=!1}})})}}function tl(e,t,a,r){const s=is()?Ms:ze;if(a.length===0&&e.length===0){r(t.map(s));return}var i=Ue,o=je,l=nl();function c(){Promise.all(a.map(u=>al(u))).then(u=>{l();try{r([...t.map(s),...u])}catch(d){(o.f&Cn)===0&&ka(d,o)}i?.deactivate(),_s()}).catch(u=>{ka(u,o)})}e.length>0?Promise.all(e).then(()=>{l();try{return c()}finally{i?.deactivate(),_s()}}):c()}function nl(){var e=je,t=Be,a=at,r=Ue;return function(i=!0){vn(e),Nt(t),Ma(a),i&&r?.activate()}}function _s(){vn(null),Nt(null),Ma(null)}function Ms(e){var t=At|Dt,a=Be!==null&&(Be.f&At)!==0?Be:null;return je!==null&&(je.f|=Na),{ctx:at,deps:null,effects:null,equals:ti,f:t,fn:e,reactions:null,rv:0,v:St,wv:0,parent:a??je,ac:null}}function al(e,t,a){let r=je;r===null&&_o();var s=r.b,i=void 0,o=oa(St),l=!Be,c=new Map;return hl(()=>{var u=Xr();i=u.promise;try{Promise.resolve(e()).then(u.resolve,u.reject).then(()=>{d===Ue&&d.committed&&d.deactivate(),_s()})}catch(h){u.reject(h),_s()}var d=Ue;if(l){var f=s.is_rendered();s.update_pending_count(1),d.increment(f),c.get(d)?.reject(xa),c.delete(d),c.set(d,u)}const m=(h,y=void 0)=>{if(d.activate(),y)y!==xa&&(o.f|=Hn,la(o,y));else{(o.f&Hn)!==0&&(o.f^=Hn),la(o,h);for(const[g,p]of c){if(c.delete(g),g===d)break;p.reject(xa)}}l&&(s.update_pending_count(-1),d.decrement(f))};u.promise.then(m,h=>m(null,h||"unknown"))}),ls(()=>{for(const u of c.values())u.reject(xa)}),new Promise(u=>{function d(f){function m(){f===i?u(o):d(i)}f.then(m,m)}d(i)})}function ze(e){const t=Ms(e);return t.equals=ai,t}function mi(e){var t=e.effects;if(t!==null){e.effects=null;for(var a=0;a<t.length;a+=1)Pt(t[a])}}function sl(e){for(var t=e.parent;t!==null;){if((t.f&At)===0)return(t.f&Cn)===0?t:null;t=t.parent}return null}function lr(e){var t,a=je;vn(sl(e));try{e.f&=~ia,mi(e),t=Ii(e)}finally{vn(a)}return t}function di(e){var t=lr(e);if(!e.equals(t)&&(e.wv=ki(),(!Ue?.is_fork||e.deps===null)&&(e.v=t,e.deps===null))){gt(e,wt);return}qn||(an!==null?(ur()||Ue?.is_fork)&&an.set(e,t):or(e))}let Us=new Set;const Bn=new Map;let hi=!1;function oa(e,t){var a={f:0,v:e,reactions:null,equals:ti,rv:0,wv:0};return a}function Nn(e,t){const a=oa(e);return vl(a),a}function $(e,t=!1,a=!0){const r=oa(e);return t||(r.equals=ai),Pa&&a&&at!==null&&at.l!==null&&(at.l.s??=[]).push(r),r}function $s(e,t){return w(e,v(()=>n(e))),t}function w(e,t,a=!1){Be!==null&&(!sn||(Be.f&xr)!==0)&&is()&&(Be.f&(At|Dn|sr|xr))!==0&&!Mn?.includes(e)&&ko();let r=a?_a(t):t;return la(e,r)}function la(e,t){if(!e.equals(t)){var a=e.v;qn?Bn.set(e,t):Bn.set(e,a),e.v=t;var r=yn.ensure();if(r.capture(e,a),(e.f&At)!==0){const s=e;(e.f&Dt)!==0&&lr(s),or(s)}e.wv=ki(),fi(e,Dt),is()&&je!==null&&(je.f&wt)!==0&&(je.f&(In|ca))===0&&(jt===null?gl([e]):jt.push(e)),!r.is_fork&&Us.size>0&&!hi&&rl()}return t}function rl(){hi=!1;var e=aa;Ss(!0);const t=Array.from(Us);try{for(const a of t)(a.f&wt)!==0&&gt(a,gn),Wa(a)&&Da(a)}finally{Ss(e)}Us.clear()}function Va(e){w(e,e.v+1)}function fi(e,t){var a=e.reactions;if(a!==null)for(var r=is(),s=a.length,i=0;i<s;i++){var o=a[i],l=o.f;if(!(!r&&o===je)){var c=(l&Dt)===0;if(c&&gt(o,t),(l&At)!==0){var u=o;an?.delete(u),(l&ia)===0&&(l&Jt&&(o.f|=ia),fi(u,gn))}else c&&((l&Dn)!==0&&xn!==null&&xn.add(o),kn(o))}}}function _a(e){if(typeof e!="object"||e===null||En in e)return e;const t=tr(e);if(t!==vo&&t!==go)return e;var a=new Map,r=ss(e),s=Nn(0),i=sa,o=l=>{if(sa===i)return l();var c=Be,u=sa;Nt(null),Cr(i);var d=l();return Nt(c),Cr(u),d};return r&&a.set("length",Nn(e.length)),new Proxy(e,{defineProperty(l,c,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&Ro();var d=a.get(c);return d===void 0?d=o(()=>{var f=Nn(u.value);return a.set(c,f),f}):w(d,u.value,!0),!0},deleteProperty(l,c){var u=a.get(c);if(u===void 0){if(c in l){const d=o(()=>Nn(St));a.set(c,d),Va(s)}}else w(u,St),Va(s);return!0},get(l,c,u){if(c===En)return e;var d=a.get(c),f=c in l;if(d===void 0&&(!f||ta(l,c)?.writable)&&(d=o(()=>{var h=_a(f?l[c]:St),y=Nn(h);return y}),a.set(c,d)),d!==void 0){var m=n(d);return m===St?void 0:m}return Reflect.get(l,c,u)},getOwnPropertyDescriptor(l,c){var u=Reflect.getOwnPropertyDescriptor(l,c);if(u&&"value"in u){var d=a.get(c);d&&(u.value=n(d))}else if(u===void 0){var f=a.get(c),m=f?.v;if(f!==void 0&&m!==St)return{enumerable:!0,configurable:!0,value:m,writable:!0}}return u},has(l,c){if(c===En)return!0;var u=a.get(c),d=u!==void 0&&u.v!==St||Reflect.has(l,c);if(u!==void 0||je!==null&&(!d||ta(l,c)?.writable)){u===void 0&&(u=o(()=>{var m=d?_a(l[c]):St,h=Nn(m);return h}),a.set(c,u));var f=n(u);if(f===St)return!1}return d},set(l,c,u,d){var f=a.get(c),m=c in l;if(r&&c==="length")for(var h=u;h<f.v;h+=1){var y=a.get(h+"");y!==void 0?w(y,St):h in l&&(y=o(()=>Nn(St)),a.set(h+"",y))}if(f===void 0)(!m||ta(l,c)?.writable)&&(f=o(()=>Nn(void 0)),w(f,_a(u)),a.set(c,f));else{m=f.v!==St;var g=o(()=>_a(u));w(f,g)}var p=Reflect.getOwnPropertyDescriptor(l,c);if(p?.set&&p.set.call(d,u),!m){if(r&&typeof c=="string"){var _=a.get("length"),M=Number(c);Number.isInteger(M)&&M>=_.v&&w(_,M+1)}Va(s)}return!0},ownKeys(l){n(s);var c=Reflect.ownKeys(l).filter(f=>{var m=a.get(f);return m===void 0||m.v!==St});for(var[u,d]of a)d.v!==St&&!(u in l)&&c.push(u);return c},setPrototypeOf(){Mo()}})}function Sr(e){try{if(e!==null&&typeof e=="object"&&En in e)return e[En]}catch{}return e}function il(e,t){return Object.is(Sr(e),Sr(t))}var Sa,yi,pi,vi;function ol(){if(Sa===void 0){Sa=window,yi=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,a=Text.prototype;pi=ta(t,"firstChild").get,vi=ta(t,"nextSibling").get,Tr(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),Tr(a)&&(a.__t=void 0)}}function Rn(e=""){return document.createTextNode(e)}function Sn(e){return pi.call(e)}function os(e){return vi.call(e)}function E(e,t){return Sn(e)}function Ne(e,t=!1){{var a=Sn(e);return a instanceof Comment&&a.data===""?os(a):a}}function A(e,t=1,a=!1){let r=e;for(;t--;)r=os(r);return r}function ll(e){e.textContent=""}function gi(){return!1}let wr=!1;function cl(){wr||(wr=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{if(!e.defaultPrevented)for(const t of e.target.elements)t.__on_r?.()})},{capture:!0}))}function ks(e){var t=Be,a=je;Nt(null),vn(null);try{return e()}finally{Nt(t),vn(a)}}function cr(e,t,a,r=a){e.addEventListener(t,()=>ks(a));const s=e.__on_r;s?e.__on_r=()=>{s(),r(!0)}:e.__on_r=()=>r(!0),cl()}function bi(e){je===null&&(Be===null&&Ao(),wo()),qn&&So()}function ul(e,t){var a=t.last;a===null?t.last=t.first=e:(a.next=e,e.prev=a,t.last=e)}function bn(e,t,a){var r=je;r!==null&&(r.f&Ut)!==0&&(e|=Ut);var s={ctx:at,deps:null,nodes:null,f:e|Dt|Jt,first:null,fn:t,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(a)try{Da(s),s.f|=ar}catch(l){throw Pt(s),l}else t!==null&&kn(s);var i=s;if(a&&i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&Na)===0&&(i=i.first,(e&Dn)!==0&&(e&Ra)!==0&&i!==null&&(i.f|=Ra)),i!==null&&(i.parent=r,r!==null&&ul(i,r),Be!==null&&(Be.f&At)!==0&&(e&ca)===0)){var o=Be;(o.effects??=[]).push(i)}return s}function ur(){return Be!==null&&!sn}function ls(e){const t=bn(rs,null,!1);return gt(t,wt),t.teardown=e,t}function Ks(e){bi();var t=je.f,a=!Be&&(t&In)!==0&&(t&ar)===0;if(a){var r=at;(r.e??=[]).push(e)}else return Ti(e)}function Ti(e){return bn(xs|Jr,e,!1)}function ml(e){return bi(),bn(rs|Jr,e,!0)}function dl(e){yn.ensure();const t=bn(ca|Na,e,!0);return(a={})=>new Promise(r=>{a.outro?na(t,()=>{Pt(t),r(void 0)}):(Pt(t),r(void 0))})}function xi(e){return bn(xs,e,!1)}function ue(e,t){var a=at,r={effect:null,ran:!1,deps:e};a.l.$.push(r),r.effect=Oa(()=>{e(),!r.ran&&(r.ran=!0,v(t))})}function Tn(){var e=at;Oa(()=>{for(var t of e.l.$){t.deps();var a=t.effect;(a.f&wt)!==0&&a.deps!==null&&gt(a,gn),Wa(a)&&Da(a),t.ran=!1}})}function hl(e){return bn(sr|Na,e,!0)}function Oa(e,t=0){return bn(rs|t,e,!0)}function V(e,t=[],a=[],r=[]){tl(r,t,a,s=>{bn(rs,()=>e(...s.map(n)),!0)})}function mr(e,t=0){var a=bn(Dn|t,e,!0);return a}function Vt(e){return bn(In|Na,e,!0)}function _i(e){var t=e.teardown;if(t!==null){const a=qn,r=Be;Ar(!0),Nt(null);try{t.call(null)}finally{Ar(a),Nt(r)}}}function Si(e,t=!1){var a=e.first;for(e.first=e.last=null;a!==null;){const s=a.ac;s!==null&&ks(()=>{s.abort(xa)});var r=a.next;(a.f&ca)!==0?a.parent=null:Pt(a,t),a=r}}function fl(e){for(var t=e.first;t!==null;){var a=t.next;(t.f&In)===0&&Pt(t),t=a}}function Pt(e,t=!0){var a=!1;(t||(e.f&Qr)!==0)&&e.nodes!==null&&e.nodes.end!==null&&(yl(e.nodes.start,e.nodes.end),a=!0),Si(e,t&&!a),ws(e,0),gt(e,Cn);var r=e.nodes&&e.nodes.t;if(r!==null)for(const i of r)i.stop();_i(e);var s=e.parent;s!==null&&s.first!==null&&wi(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes=e.ac=null}function yl(e,t){for(;e!==null;){var a=e===t?null:os(e);e.remove(),e=a}}function wi(e){var t=e.parent,a=e.prev,r=e.next;a!==null&&(a.next=r),r!==null&&(r.prev=a),t!==null&&(t.first===e&&(t.first=r),t.last===e&&(t.last=a))}function na(e,t,a=!0){var r=[];Ai(e,r,!0);var s=()=>{a&&Pt(e),t&&t()},i=r.length;if(i>0){var o=()=>--i||s();for(var l of r)l.out(o)}else s()}function Ai(e,t,a){if((e.f&Ut)===0){e.f^=Ut;var r=e.nodes&&e.nodes.t;if(r!==null)for(const l of r)(l.is_global||a)&&t.push(l);for(var s=e.first;s!==null;){var i=s.next,o=(s.f&Ra)!==0||(s.f&In)!==0&&(e.f&Dn)!==0;Ai(s,t,o?a:!1),s=i}}}function dr(e){Ci(e,!0)}function Ci(e,t){if((e.f&Ut)!==0){e.f^=Ut,(e.f&wt)===0&&(gt(e,Dt),kn(e));for(var a=e.first;a!==null;){var r=a.next,s=(a.f&Ra)!==0||(a.f&In)!==0;Ci(a,s?t:!1),a=r}var i=e.nodes&&e.nodes.t;if(i!==null)for(const o of i)(o.is_global||t)&&o.in()}}function Ei(e,t){if(e.nodes)for(var a=e.nodes.start,r=e.nodes.end;a!==null;){var s=a===r?null:os(a);t.append(a),a=s}}let Ta=null;function pl(e){var t=Ta;try{if(Ta=new Set,v(e),t!==null)for(var a of Ta)t.add(a);return Ta}finally{Ta=t}}function Ri(e){for(var t of pl(e))la(t,t.v)}let aa=!1;function Ss(e){aa=e}let qn=!1;function Ar(e){qn=e}let Be=null,sn=!1;function Nt(e){Be=e}let je=null;function vn(e){je=e}let Mn=null;function vl(e){Be!==null&&(Mn===null?Mn=[e]:Mn.push(e))}let kt=null,Yt=0,jt=null;function gl(e){jt=e}let Mi=1,es=0,sa=es;function Cr(e){sa=e}function ki(){return++Mi}function Wa(e){var t=e.f;if((t&Dt)!==0)return!0;if(t&At&&(e.f&=~ia),(t&gn)!==0){for(var a=e.deps,r=a.length,s=0;s<r;s++){var i=a[s];if(Wa(i)&&di(i),i.wv>e.wv)return!0}(t&Jt)!==0&&an===null&&gt(e,wt)}return!1}function Di(e,t,a=!0){var r=e.reactions;if(r!==null&&!Mn?.includes(e))for(var s=0;s<r.length;s++){var i=r[s];(i.f&At)!==0?Di(i,t,!1):t===i&&(a?gt(i,Dt):(i.f&wt)!==0&&gt(i,gn),kn(i))}}function Ii(e){var t=kt,a=Yt,r=jt,s=Be,i=Mn,o=at,l=sn,c=sa,u=e.f;kt=null,Yt=0,jt=null,Be=(u&(In|ca))===0?e:null,Mn=null,Ma(e.ctx),sn=!1,sa=++es,e.ac!==null&&(ks(()=>{e.ac.abort(xa)}),e.ac=null);try{e.f|=Fs;var d=e.fn,f=d(),m=e.deps;if(kt!==null){var h;if(ws(e,Yt),m!==null&&Yt>0)for(m.length=Yt+kt.length,h=0;h<kt.length;h++)m[Yt+h]=kt[h];else e.deps=m=kt;if(ur()&&(e.f&Jt)!==0)for(h=Yt;h<m.length;h++)(m[h].reactions??=[]).push(e)}else m!==null&&Yt<m.length&&(ws(e,Yt),m.length=Yt);if(is()&&jt!==null&&!sn&&m!==null&&(e.f&(At|gn|Dt))===0)for(h=0;h<jt.length;h++)Di(jt[h],e);return s!==null&&s!==e&&(es++,jt!==null&&(r===null?r=jt:r.push(...jt))),(e.f&Hn)!==0&&(e.f^=Hn),f}catch(y){return ri(y)}finally{e.f^=Fs,kt=t,Yt=a,jt=r,Be=s,Mn=i,Ma(o),sn=l,sa=c}}function bl(e,t){let a=t.reactions;if(a!==null){var r=po.call(a,e);if(r!==-1){var s=a.length-1;s===0?a=t.reactions=null:(a[r]=a[s],a.pop())}}if(a===null&&(t.f&At)!==0&&(kt===null||!kt.includes(t))){var i=t;(i.f&Jt)!==0&&(i.f^=Jt,i.f&=~ia),or(i),mi(i),ws(i,0)}}function ws(e,t){var a=e.deps;if(a!==null)for(var r=t;r<a.length;r++)bl(e,a[r])}function Da(e){var t=e.f;if((t&Cn)===0){gt(e,wt);var a=je,r=aa;je=e,aa=!0;try{(t&(Dn|Vr))!==0?fl(e):Si(e),_i(e);var s=Ii(e);e.teardown=typeof s=="function"?s:null,e.wv=Mi;var i;Bs&&Ko&&(e.f&Dt)!==0&&e.deps}finally{aa=r,je=a}}}async function Tl(){await Promise.resolve(),Xo()}function n(e){var t=e.f,a=(t&At)!==0;if(Ta?.add(e),Be!==null&&!sn){var r=je!==null&&(je.f&Cn)!==0;if(!r&&!Mn?.includes(e)){var s=Be.deps;if((Be.f&Fs)!==0)e.rv<es&&(e.rv=es,kt===null&&s!==null&&s[Yt]===e?Yt++:kt===null?kt=[e]:kt.includes(e)||kt.push(e));else{(Be.deps??=[]).push(e);var i=e.reactions;i===null?e.reactions=[Be]:i.includes(Be)||i.push(Be)}}}if(qn&&Bn.has(e))return Bn.get(e);if(a){var o=e;if(qn){var l=o.v;return((o.f&wt)===0&&o.reactions!==null||Ni(o))&&(l=lr(o)),Bn.set(o,l),l}var c=(o.f&Jt)===0&&!sn&&Be!==null&&(aa||(Be.f&Jt)!==0),u=o.deps===null;Wa(o)&&(c&&(o.f|=Jt),di(o)),c&&!u&&Li(o)}if(an?.has(e))return an.get(e);if((e.f&Hn)!==0)throw e.v;return e.v}function Li(e){if(e.deps!==null){e.f|=Jt;for(const t of e.deps)(t.reactions??=[]).push(e),(t.f&At)!==0&&(t.f&Jt)===0&&Li(t)}}function Ni(e){if(e.v===St)return!0;if(e.deps===null)return!1;for(const t of e.deps)if(Bn.has(t)||(t.f&At)!==0&&Ni(t))return!0;return!1}function v(e){var t=sn;try{return sn=!0,e()}finally{sn=t}}function ae(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(En in e)Gs(e);else if(!Array.isArray(e))for(let t in e){const a=e[t];typeof a=="object"&&a&&En in a&&Gs(a)}}}function Gs(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let r in e)try{Gs(e[r],t)}catch{}const a=tr(e);if(a!==Object.prototype&&a!==Array.prototype&&a!==Map.prototype&&a!==Set.prototype&&a!==Date.prototype){const r=jr(a);for(let s in r){const i=r[s].get;if(i)try{i.call(e)}catch{}}}}}const xl=["touchstart","touchmove"];function _l(e){return xl.includes(e)}const Sl=new Set,Er=new Set;function wl(e,t,a,r={}){function s(i){if(r.capture||Ua.call(t,i),!i.cancelBubble)return ks(()=>a?.call(this,i))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?$a(()=>{t.addEventListener(e,s,r)}):t.addEventListener(e,s,r),s}function J(e,t,a,r,s){var i={capture:r,passive:s},o=wl(e,t,a,i);(t===document.body||t===window||t===document||t instanceof HTMLMediaElement)&&ls(()=>{t.removeEventListener(e,o,i)})}let Rr=null;function Ua(e){var t=this,a=t.ownerDocument,r=e.type,s=e.composedPath?.()||[],i=s[0]||e.target;Rr=e;var o=0,l=Rr===e&&e.__root;if(l){var c=s.indexOf(l);if(c!==-1&&(t===document||t===window)){e.__root=t;return}var u=s.indexOf(t);if(u===-1)return;c<=u&&(o=c)}if(i=s[o]||e.target,i!==t){zr(e,"currentTarget",{configurable:!0,get(){return i||a}});var d=Be,f=je;Nt(null),vn(null);try{for(var m,h=[];i!==null;){var y=i.assignedSlot||i.parentNode||i.host||null;try{var g=i["__"+r];g!=null&&(!i.disabled||e.target===i)&&g.call(i,e)}catch(p){m?h.push(p):m=p}if(e.cancelBubble||y===t||y===null)break;i=y}if(m){for(let p of h)queueMicrotask(()=>{throw p});throw m}}finally{e.__root=t,delete e.currentTarget,Nt(d),vn(f)}}}function Pi(e){var t=document.createElement("template");return t.innerHTML=e.replaceAll("<!>","<!---->"),t.content}function Ia(e,t){var a=je;a.nodes===null&&(a.nodes={start:e,end:t,a:null,t:null})}function be(e,t){var a=(t&ei)!==0,r=(t&Bo)!==0,s,i=!e.startsWith("<!>");return()=>{s===void 0&&(s=Pi(i?e:"<!>"+e),a||(s=Sn(s)));var o=r||yi?document.importNode(s,!0):s.cloneNode(!0);if(a){var l=Sn(o),c=o.lastChild;Ia(l,c)}else Ia(o,o);return o}}function Al(e,t,a="svg"){var r=!e.startsWith("<!>"),s=(t&ei)!==0,i=`<${a}>${r?e:"<!>"+e}</${a}>`,o;return()=>{if(!o){var l=Pi(i),c=Sn(l);if(s)for(o=document.createDocumentFragment();Sn(c);)o.appendChild(Sn(c));else o=Sn(c)}var u=o.cloneNode(!0);if(s){var d=Sn(u),f=u.lastChild;Ia(d,f)}else Ia(u,u);return u}}function Me(e,t){return Al(e,t,"svg")}function $i(e=""){{var t=Rn(e+"");return Ia(t,t),t}}function vt(){var e=document.createDocumentFragment(),t=document.createComment(""),a=Rn();return e.append(t,a),Ia(t,a),e}function L(e,t){e!==null&&e.before(t)}function Ce(e,t){var a=t==null?"":typeof t=="object"?t+"":t;a!==(e.__t??=e.nodeValue)&&(e.__t=a,e.nodeValue=a+"")}function Cl(e,t){return El(e,t)}const va=new Map;function El(e,{target:t,anchor:a,props:r={},events:s,context:i,intro:o=!0}){ol();var l=new Set,c=f=>{for(var m=0;m<f.length;m++){var h=f[m];if(!l.has(h)){l.add(h);var y=_l(h);t.addEventListener(h,Ua,{passive:y});var g=va.get(h);g===void 0?(document.addEventListener(h,Ua,{passive:y}),va.set(h,1)):va.set(h,g+1)}}};c(Es(Sl)),Er.add(c);var u=void 0,d=dl(()=>{var f=a??t.appendChild(Rn());return Zo(f,{pending:()=>{}},m=>{if(i){It({});var h=at;h.c=i}s&&(r.$$events=s),u=e(m,r)||{},i&&Lt()}),()=>{for(var m of l){t.removeEventListener(m,Ua);var h=va.get(m);--h===0?(document.removeEventListener(m,Ua),va.delete(m)):va.set(m,h)}Er.delete(c),f!==a&&f.parentNode?.removeChild(f)}});return Rl.set(u,d),u}let Rl=new WeakMap;class Ml{anchor;#t=new Map;#i=new Map;#e=new Map;#s=new Set;#r=!0;constructor(t,a=!0){this.anchor=t,this.#r=a}#a=()=>{var t=Ue;if(this.#t.has(t)){var a=this.#t.get(t),r=this.#i.get(a);if(r)dr(r),this.#s.delete(a);else{var s=this.#e.get(a);s&&(this.#i.set(a,s.effect),this.#e.delete(a),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),r=s.effect)}for(const[i,o]of this.#t){if(this.#t.delete(i),i===t)break;const l=this.#e.get(o);l&&(Pt(l.effect),this.#e.delete(o))}for(const[i,o]of this.#i){if(i===a||this.#s.has(i))continue;const l=()=>{if(Array.from(this.#t.values()).includes(i)){var u=document.createDocumentFragment();Ei(o,u),u.append(Rn()),this.#e.set(i,{effect:o,fragment:u})}else Pt(o);this.#s.delete(i),this.#i.delete(i)};this.#r||!r?(this.#s.add(i),na(o,l,!1)):l()}}};#n=t=>{this.#t.delete(t);const a=Array.from(this.#t.values());for(const[r,s]of this.#e)a.includes(r)||(Pt(s.effect),this.#e.delete(r))};ensure(t,a){var r=Ue,s=gi();if(a&&!this.#i.has(t)&&!this.#e.has(t))if(s){var i=document.createDocumentFragment(),o=Rn();i.append(o),this.#e.set(t,{effect:Vt(()=>a(o)),fragment:i})}else this.#i.set(t,Vt(()=>a(this.anchor)));if(this.#t.set(r,t),s){for(const[l,c]of this.#i)l===t?r.skipped_effects.delete(c):r.skipped_effects.add(c);for(const[l,c]of this.#e)l===t?r.skipped_effects.delete(c.effect):r.skipped_effects.add(c.effect);r.oncommit(this.#a),r.ondiscard(this.#n)}else this.#a()}}function _e(e,t,a=!1){var r=new Ml(e),s=a?Ra:0;function i(o,l){r.ensure(o,l)}mr(()=>{var o=!1;t((l,c=!0)=>{o=!0,i(c,l)}),o||i(!1,null)},s)}function He(e,t){return t}function kl(e,t,a){for(var r=[],s=t.length,i,o=t.length,l=0;l<s;l++){let f=t[l];na(f,()=>{if(i){if(i.pending.delete(f),i.done.add(f),i.pending.size===0){var m=e.outrogroups;zs(Es(i.done)),m.delete(i),m.size===0&&(e.outrogroups=null)}}else o-=1},!1)}if(o===0){var c=r.length===0&&a!==null;if(c){var u=a,d=u.parentNode;ll(d),d.append(u),e.items.clear()}zs(t,!c)}else i={pending:new Set(t),done:new Set},(e.outrogroups??=new Set).add(i)}function zs(e,t=!0){for(var a=0;a<e.length;a++)Pt(e[a],t)}var Mr;function ke(e,t,a,r,s,i=null){var o=e,l=new Map,c=(t&Zr)!==0;if(c){var u=e;o=u.appendChild(Rn())}var d=null,f=ze(()=>{var _=a();return ss(_)?_:_==null?[]:Es(_)}),m,h=!0;function y(){p.fallback=d,Dl(p,m,o,t,r),d!==null&&(m.length===0?(d.f&An)===0?dr(d):(d.f^=An,Ka(d,null,o)):na(d,()=>{d=null}))}var g=mr(()=>{m=n(f);for(var _=m.length,M=new Set,C=Ue,b=gi(),x=0;x<_;x+=1){var R=m[x],I=r(R,x),S=h?null:l.get(I);S?(S.v&&la(S.v,R),S.i&&la(S.i,x),b&&C.skipped_effects.delete(S.e)):(S=Il(l,h?o:Mr??=Rn(),R,I,x,s,t,a),h||(S.e.f|=An),l.set(I,S)),M.add(I)}if(_===0&&i&&!d&&(h?d=Vt(()=>i(o)):(d=Vt(()=>i(Mr??=Rn())),d.f|=An)),!h)if(b){for(const[D,O]of l)M.has(D)||C.skipped_effects.add(O.e);C.oncommit(y),C.ondiscard(()=>{})}else y();n(f)}),p={effect:g,items:l,outrogroups:null,fallback:d};h=!1}function Dl(e,t,a,r,s){var i=(r&No)!==0,o=t.length,l=e.items,c=e.effect.first,u,d=null,f,m=[],h=[],y,g,p,_;if(i)for(_=0;_<o;_+=1)y=t[_],g=s(y,_),p=l.get(g).e,(p.f&An)===0&&(p.nodes?.a?.measure(),(f??=new Set).add(p));for(_=0;_<o;_+=1){if(y=t[_],g=s(y,_),p=l.get(g).e,e.outrogroups!==null)for(const O of e.outrogroups)O.pending.delete(p),O.done.delete(p);if((p.f&An)!==0)if(p.f^=An,p===c)Ka(p,null,a);else{var M=d?d.next:c;p===e.effect.last&&(e.effect.last=p.prev),p.prev&&(p.prev.next=p.next),p.next&&(p.next.prev=p.prev),Pn(e,d,p),Pn(e,p,M),Ka(p,M,a),d=p,m=[],h=[],c=d.next;continue}if((p.f&Ut)!==0&&(dr(p),i&&(p.nodes?.a?.unfix(),(f??=new Set).delete(p))),p!==c){if(u!==void 0&&u.has(p)){if(m.length<h.length){var C=h[0],b;d=C.prev;var x=m[0],R=m[m.length-1];for(b=0;b<m.length;b+=1)Ka(m[b],C,a);for(b=0;b<h.length;b+=1)u.delete(h[b]);Pn(e,x.prev,R.next),Pn(e,d,x),Pn(e,R,C),c=C,d=R,_-=1,m=[],h=[]}else u.delete(p),Ka(p,c,a),Pn(e,p.prev,p.next),Pn(e,p,d===null?e.effect.first:d.next),Pn(e,d,p),d=p;continue}for(m=[],h=[];c!==null&&c!==p;)(u??=new Set).add(c),h.push(c),c=c.next;if(c===null)continue}(p.f&An)===0&&m.push(p),d=p,c=p.next}if(e.outrogroups!==null){for(const O of e.outrogroups)O.pending.size===0&&(zs(Es(O.done)),e.outrogroups?.delete(O));e.outrogroups.size===0&&(e.outrogroups=null)}if(c!==null||u!==void 0){var I=[];if(u!==void 0)for(p of u)(p.f&Ut)===0&&I.push(p);for(;c!==null;)(c.f&Ut)===0&&c!==e.fallback&&I.push(c),c=c.next;var S=I.length;if(S>0){var D=(r&Zr)!==0&&o===0?a:null;if(i){for(_=0;_<S;_+=1)I[_].nodes?.a?.measure();for(_=0;_<S;_+=1)I[_].nodes?.a?.fix()}kl(e,I,D)}}i&&$a(()=>{if(f!==void 0)for(p of f)p.nodes?.a?.apply()})}function Il(e,t,a,r,s,i,o,l){var c=(o&Io)!==0?(o&Po)===0?$(a,!1,!1):oa(a):null,u=(o&Lo)!==0?oa(s):null;return{v:c,i:u,e:Vt(()=>(i(t,c??a,u??s,l),()=>{e.delete(r)}))}}function Ka(e,t,a){if(e.nodes)for(var r=e.nodes.start,s=e.nodes.end,i=t&&(t.f&An)===0?t.nodes.start:a;r!==null;){var o=os(r);if(i.before(r),r===s)return;r=o}}function Pn(e,t,a){t===null?e.effect.first=a:t.next=a,a===null?e.effect.last=t:a.prev=t}function Oi(e,t,a,r,s){var i=t.$$slots?.[a],o=!1;i===!0&&(i=t.children,o=!0),i===void 0||i(e,o?()=>r:r)}const kr=[...` 	
\r\fÂ \v\uFEFF`];function Ll(e,t,a){var r=e==null?"":""+e;if(a){for(var s in a)if(a[s])r=r?r+" "+s:s;else if(r.length)for(var i=s.length,o=0;(o=r.indexOf(s,o))>=0;){var l=o+i;(o===0||kr.includes(r[o-1]))&&(l===r.length||kr.includes(r[l]))?r=(o===0?"":r.substring(0,o))+r.substring(l+1):o=l}}return r===""?null:r}function Nl(e,t){return e==null?null:String(e)}function rn(e,t,a,r,s,i){var o=e.__className;if(o!==a||o===void 0){var l=Ll(a,r,i);l==null?e.removeAttribute("class"):t?e.className=l:e.setAttribute("class",l),e.__className=a}else if(i&&s!==i)for(var c in i){var u=!!i[c];(s==null||u!==!!s[c])&&e.classList.toggle(c,u)}return i}function Pl(e,t,a,r){var s=e.__style;if(s!==t){var i=Nl(t);i==null?e.removeAttribute("style"):e.style.cssText=i,e.__style=t}return r}function Wi(e,t,a=!1){if(e.multiple){if(t==null)return;if(!ss(t))return qo();for(var r of e.options)r.selected=t.includes(Qa(r));return}for(r of e.options){var s=Qa(r);if(il(s,t)){r.selected=!0;return}}(!a||t!==void 0)&&(e.selectedIndex=-1)}function $l(e){var t=new MutationObserver(()=>{Wi(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ls(()=>{t.disconnect()})}function Yi(e,t,a=t){var r=new WeakSet,s=!0;cr(e,"change",i=>{var o=i?"[selected]":":checked",l;if(e.multiple)l=[].map.call(e.querySelectorAll(o),Qa);else{var c=e.querySelector(o)??e.querySelector("option:not([disabled])");l=c&&Qa(c)}a(l),Ue!==null&&r.add(Ue)}),xi(()=>{var i=t();if(e===document.activeElement){var o=ja??Ue;if(r.has(o))return}if(Wi(e,i,s),s&&i===void 0){var l=e.querySelector(":checked");l!==null&&(i=Qa(l),a(i))}e.__value=i,s=!1}),$l(e)}function Qa(e){return"__value"in e?e.__value:e.value}const Ol=Symbol("is custom element"),Wl=Symbol("is html");function Yl(e,t){var a=Hi(e);a.value===(a.value=t??void 0)||e.value===t&&(t!==0||e.nodeName!=="PROGRESS")||(e.value=t??"")}function T(e,t,a,r){var s=Hi(e);s[t]!==(s[t]=a)&&(t==="loading"&&(e[xo]=a),a==null?e.removeAttribute(t):typeof a!="string"&&Hl(e).includes(t)?e[t]=a:e.setAttribute(t,a))}function Hi(e){return e.__attributes??={[Ol]:e.nodeName.includes("-"),[Wl]:e.namespaceURI===Fo}}var Dr=new Map;function Hl(e){var t=e.getAttribute("is")||e.nodeName,a=Dr.get(t);if(a)return a;Dr.set(t,a=[]);for(var r,s=e,i=Element.prototype;i!==s;){r=jr(s);for(var o in r)r[o].set&&a.push(o);s=tr(s)}return a}function Ea(e,t,a=t){var r=new WeakSet;cr(e,"input",async s=>{var i=s?e.defaultValue:e.value;if(i=Os(e)?Ws(i):i,a(i),Ue!==null&&r.add(Ue),await Tl(),i!==(i=t())){var o=e.selectionStart,l=e.selectionEnd,c=e.value.length;if(e.value=i??"",l!==null){var u=e.value.length;o===l&&l===c&&u>c?(e.selectionStart=u,e.selectionEnd=u):(e.selectionStart=o,e.selectionEnd=Math.min(l,u))}}}),v(t)==null&&e.value&&(a(Os(e)?Ws(e.value):e.value),Ue!==null&&r.add(Ue)),Oa(()=>{var s=t();if(e===document.activeElement){var i=ja??Ue;if(r.has(i))return}Os(e)&&s===Ws(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function wa(e,t,a=t){cr(e,"change",r=>{var s=r?e.defaultChecked:e.checked;a(s)}),v(t)==null&&a(e.checked),Oa(()=>{var r=t();e.checked=!!r})}function Os(e){var t=e.type;return t==="number"||t==="range"}function Ws(e){return e===""?null:+e}function Ga(e,t,a){var r=ta(e,t);r&&r.set&&(e[t]=a,ls(()=>{e[t]=null}))}function Ir(e,t){return e===t||e?.[En]===t}function ts(e={},t,a,r){return xi(()=>{var s,i;return Oa(()=>{s=i,i=[],v(()=>{e!==a(...i)&&(t(e,...i),s&&Ir(a(...s),e)&&t(null,...s))})}),()=>{$a(()=>{i&&Ir(a(...i),e)&&t(null,...i)})}}),e}function Lr(e){return function(...t){var a=t[0];return a.stopPropagation(),e?.apply(this,t)}}function $t(e=!1){const t=at,a=t.l.u;if(!a)return;let r=()=>ae(t.s);if(e){let s=0,i={};const o=Ms(()=>{let l=!1;const c=t.s;for(const u in c)c[u]!==i[u]&&(i[u]=c[u],l=!0);return l&&s++,s});r=()=>n(o)}a.b.length&&ml(()=>{Nr(t,r),Ts(a.b)}),Ks(()=>{const s=v(()=>a.m.map(bo));return()=>{for(const i of s)typeof i=="function"&&i()}}),a.a.length&&Ks(()=>{Nr(t,r),Ts(a.a)})}function Nr(e,t){if(e.l.s)for(const a of e.l.s)n(a);t()}function Pr(e,t){var a=e.$$events?.[t.type],r=ss(a)?a.slice():a==null?[]:[a];for(var s of r)s.call(this,t)}function hr(e,t,a){if(e==null)return t(void 0),a&&a(void 0),Yn;const r=v(()=>e.subscribe(t,a));return r.unsubscribe?()=>r.unsubscribe():r}const ga=[];function Bl(e,t){return{subscribe:ot(e,t).subscribe}}function ot(e,t=Yn){let a=null;const r=new Set;function s(l){if(ni(e,l)&&(e=l,a)){const c=!ga.length;for(const u of r)u[1](),ga.push(u,e);if(c){for(let u=0;u<ga.length;u+=2)ga[u][0](ga[u+1]);ga.length=0}}}function i(l){s(l(e))}function o(l,c=Yn){const u=[l,c];return r.add(u),r.size===1&&(a=t(s,i)||Yn),l(e),()=>{r.delete(u),r.size===0&&a&&(a(),a=null)}}return{set:s,update:i,subscribe:o}}function Kt(e,t,a){const r=!Array.isArray(e),s=r?[e]:e;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=t.length<2;return Bl(a,(o,l)=>{let c=!1;const u=[];let d=0,f=Yn;const m=()=>{if(d)return;f();const y=t(r?u[0]:u,o,l);i?o(y):f=typeof y=="function"?y:Yn},h=s.map((y,g)=>hr(y,p=>{u[g]=p,d&=~(1<<g),c&&m()},()=>{d|=1<<g}));return c=!0,m(),function(){Ts(h),f(),c=!1}})}function Ft(e){let t;return hr(e,a=>t=a)(),t}let ms=!1,js=Symbol();function Qe(e,t,a){const r=a[t]??={store:null,source:$(void 0),unsubscribe:Yn};if(r.store!==e&&!(js in a))if(r.unsubscribe(),r.store=e??null,e==null)r.source.v=void 0,r.unsubscribe=Yn;else{var s=!0;r.unsubscribe=hr(e,i=>{s?r.source.v=i:w(r.source,i)}),s=!1}return e&&js in a?Ft(e):n(r.source)}function Fl(e,t){return e.set(t),t}function Ya(){const e={};function t(){ls(()=>{for(var a in e)e[a].unsubscribe();zr(e,js,{enumerable:!1,value:!0})})}return[e,t]}function ql(e){var t=ms;try{return ms=!1,[e(),ms]}finally{ms=t}}function Re(e,t,a,r){var s=!Pa||(a&Oo)!==0,i=(a&Yo)!==0,o=(a&Ho)!==0,l=r,c=!0,u=()=>(c&&(c=!1,l=o?v(r):r),l),d;if(i){var f=En in e||To in e;d=ta(e,t)?.set??(f&&t in e?C=>e[t]=C:void 0)}var m,h=!1;i?[m,h]=ql(()=>e[t]):m=e[t],m===void 0&&r!==void 0&&(m=u(),d&&(s&&Eo(),d(m)));var y;if(s?y=()=>{var C=e[t];return C===void 0?u():(c=!0,C)}:y=()=>{var C=e[t];return C!==void 0&&(l=void 0),C===void 0?l:C},s&&(a&Wo)===0)return y;if(d){var g=e.$$legacy;return(function(C,b){return arguments.length>0?((!s||!b||g||h)&&d(b?y():C),C):y()})}var p=!1,_=((a&$o)!==0?Ms:ze)(()=>(p=!1,y()));i&&n(_);var M=je;return(function(C,b){if(arguments.length>0){const x=b?n(_):s&&i?_a(C):C;return w(_,x),p=!0,l!==void 0&&(l=x),C}return qn&&p||(M.f&Cn)!==0?_.v:n(_)})}function Ha(e){at===null&&ir(),Pa&&at.l!==null?Kl(at).m.push(e):Ks(()=>{const t=v(e);if(typeof t=="function")return t})}function Bi(e){at===null&&ir(),Ha(()=>()=>v(e))}function Ul(e,t,{bubbles:a=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:a,cancelable:r})}function fr(){const e=at;return e===null&&ir(),(t,a,r)=>{const s=e.s.$$events?.[t];if(s){const i=ss(s)?s.slice():[s],o=Ul(t,a,r);for(const l of i)l.call(e.x,o);return!o.defaultPrevented}return!0}}function Kl(e){var t=e.l;return t.u??={a:[],b:[],m:[]}}const Gl="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Gl);Go();function zl(e,t,a,r){const s=Aa(a,r,e),i=Aa(a,r,t),o=Aa(e,t,a),l=Aa(e,t,r);return!!((s>0&&i<0||s<0&&i>0)&&(o>0&&l<0||o<0&&l>0)||s===0&&ds(a,r,e)||i===0&&ds(a,r,t)||o===0&&ds(e,t,a)||l===0&&ds(e,t,r))}function Aa(e,t,a){return(a.x-e.x)*(t.y-e.y)-(t.x-e.x)*(a.y-e.y)}function ds(e,t,a){return Math.min(e.x,t.x)<=a.x&&a.x<=Math.max(e.x,t.x)&&Math.min(e.y,t.y)<=a.y&&a.y<=Math.max(e.y,t.y)}function $r(e,t,a,r=16){const s=[];for(let i=0;i<r;i++){const o=2*Math.PI*i/r;s.push({x:e+a*Math.cos(o),y:t+a*Math.sin(o)})}return s}function jl(e,t,a,r,s=0,i=16){const o=[],l=2*(a+r),c=s*Math.PI/180,u=Math.cos(c),d=Math.sin(c),f=i/l,m=Math.max(1,Math.round(a*f)),h=Math.max(1,Math.round(r*f)),y=a/2,g=r/2,p=[];for(let _=0;_<m;_++){const M=_/m;p.push({x:-y+a*M,y:-g})}for(let _=0;_<h;_++){const M=_/h;p.push({x:y,y:-g+r*M})}for(let _=0;_<m;_++){const M=_/m;p.push({x:y-a*M,y:g})}for(let _=0;_<h;_++){const M=_/h;p.push({x:-y,y:g-r*M})}for(const _ of p)o.push({x:e+_.x*u-_.y*d,y:t+_.x*d+_.y*u});if(o.length>i){const _=[],M=o.length/i;for(let C=0;C<i;C++)_.push(o[Math.floor(C*M)]);return _}return o}function Xl(e,t,a,r,s=0,i=16){const o=[],l=s*Math.PI/180,c=Math.cos(l),u=Math.sin(l);for(let d=0;d<i;d++){const f=2*Math.PI*d/i,m=a*Math.cos(f),h=r*Math.sin(f);o.push({x:e+m*c-h*u,y:t+m*u+h*c})}return o}function Or(e,t,a){const r=a.length;for(let s=0;s<r;s++){const i=a[s],o=a[(s+1)%r];if(zl(e,t,i,o))return!0}return!1}function Fi(e,t,a){const r=a*Math.PI/180,s=Math.cos(r),i=Math.sin(r),o=e.x-t.x,l=e.y-t.y;return{x:t.x+o*s-l*i,y:t.y+o*i+l*s}}function qi(e){return{x:e.x+e.width/2,y:e.y+e.height/2}}function ns(e){const t=qi(e),a=e.rotation||0;return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}].map(s=>Fi(s,t,a))}function Vl(e){const s=e.x,i=e.y+e.height;return[{x:s,y:i},{x:s,y:i-8},{x:s+.5,y:i-8},{x:s+.5,y:i-.5},{x:s+4,y:i-.5},{x:s+4,y:i}]}function Ql(e){const t=Vl(e),a=qi(e),r=e.rotation||0;return t.map(s=>Fi(s,a,r))}function Jl(e,t,a,r,s=.01){const i=Math.abs(Aa(e,t,a)),o=Math.abs(Aa(e,t,r)),l=Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),c=s*l;if(i>c||o>c)return!1;const u=t.x-e.x,d=t.y-e.y,f=Math.sqrt(u*u+d*d);if(f<s)return!1;const m=u/f,h=d/f,y=0,g=f,p=(a.x-e.x)*m+(a.y-e.y)*h,_=(r.x-e.x)*m+(r.y-e.y)*h,M=Math.min(y,g),C=Math.max(y,g),b=Math.min(p,_),x=Math.max(p,_),R=Math.max(M,b);return Math.min(C,x)-R>s}function Zl(e,t,a=.1){const r=e.length,s=t.length;for(let i=0;i<r;i++){const o=e[i],l=e[(i+1)%r];for(let c=0;c<s;c++){const u=t[c],d=t[(c+1)%s];if(Jl(o,l,u,d,a))return!0}}return!1}function ec(e){const t=e.length;if(t===0)return new Map;const a=Array.from({length:t},(l,c)=>c);function r(l){return a[l]!==l&&(a[l]=r(a[l])),a[l]}function s(l,c){const u=r(l),d=r(c);u!==d&&(a[u]=d)}for(let l=0;l<t;l++)for(let c=l+1;c<t;c++)Zl(e[l].vertices,e[c].vertices)&&s(l,c);const i=new Map;e.forEach((l,c)=>i.set(l.id,c));const o=new Map;return e.forEach((l,c)=>{o.set(l.id,r(c))}),o}function tc(e,t,a){const r=t.get(e);return r===void 0?[e]:a.filter(s=>t.get(s.id)===r).map(s=>s.id)}const hs=16;function Xs(e){return e.isRectangle&&e.width!==void 0&&e.height!==void 0?jl(e.x,e.y,e.width,e.height,e.rotation||0,hs):e.radius!==void 0?$r(e.x,e.y,e.radius,hs):e.rx!==void 0&&e.ry!==void 0?Xl(e.x,e.y,e.rx,e.ry,e.rotation||0,hs):$r(e.x,e.y,.5,hs)}function Wr(e,t){const a=Xs(e);for(const r of a)if(Yr(r,t))return!0;return!!Yr({x:e.x,y:e.y},t)}function Yr(e,t){const a=t.length;let r=null;for(let s=0;s<a;s++){const i=t[s],o=t[(s+1)%a],l=(o.x-i.x)*(e.y-i.y)-(o.y-i.y)*(e.x-i.x);if(l!==0){const c=l>0;if(r===null)r=c;else if(r!==c)return!1}}return!0}function Ui(e,t,a,r){const s=Xs(e),i=Xs(t),o=ec(a),l=new Set;for(const f of a){const m=Wr(e,f.vertices),h=Wr(t,f.vertices);if(m||h){const y=tc(f.id,o,a);for(const g of y)l.add(g)}}const c=[];let u=!1,d=null;for(const f of s)for(const m of i){const h={from:f,to:m,blocked:!1,blockedBy:null};let y=!1;for(const p of a)if(!l.has(p.id)&&Or(f,m,p.vertices)){h.blocked=!0,h.blockedBy="terrain",y=!0;break}if(y){c.push(h);continue}let g=!1;for(const p of r)if(Or(f,m,p)){h.blocked=!0,h.blockedBy="wall",g=!0;break}g||(h.blocked=!1,u||(d=h),u=!0),c.push(h)}return{canSee:u,rays:c,firstClearRay:d,terrainsIgnored:Array.from(l)}}const Ie={width:60,height:44},Ki=ot([{id:"terrain1",x:20,y:16,width:6,height:12,rotation:0},{id:"terrain2",x:34,y:10,width:6,height:12,rotation:45},{id:"terrain3",x:44,y:20,width:6,height:12,rotation:-30}]);Kt(Ki,e=>e.map(t=>Ql(t)));Kt(Ki,e=>e.map(t=>({id:t.id,vertices:ns(t)})));const Hr=ot(!1);var nc=Me('<line stroke="#3a4a3a" stroke-width="0.05"></line>'),ac=Me('<line stroke="#3a4a3a" stroke-width="0.05"></line>'),sc=Me('<line stroke="#5a6a5a" stroke-width="0.08"></line>'),rc=Me('<line stroke="#5a6a5a" stroke-width="0.08"></line>'),ic=Me('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),oc=Me('<line stroke="#666"></line><!>',1),lc=Me('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),cc=Me('<line stroke="#666"></line><!>',1),uc=Me('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),mc=Me('<line stroke="#666"></line><!>',1),dc=Me('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),hc=Me('<line stroke="#666"></line><!>',1),fc=Me('<svg preserveAspectRatio="xMidYMid meet"><rect x="0" y="0" fill="#1a1a1a"></rect><rect fill="#4a5a4a"></rect><!><!><!><!><!><!><!><!><g><!></g></svg>');function Ds(e,t){It(t,!1);const a=$(),r=$(),s=$(),i=$(),o=$(),l=$(),c=$();let u=$();const d=2,f=Ie.width+d*2,m=Ie.height+d*2;let h=$(1),y=$(0),g=$(0),p=$(!1),_={x:0,y:0},M=$(!1);const C=.5,b=4;function x(q,he){if(!n(u))return{x:0,y:0};const Pe=n(u).createSVGPoint();Pe.x=q,Pe.y=he;const le=Pe.matrixTransform(n(u).getScreenCTM().inverse());return{x:le.x-d,y:le.y-d}}function R(q){q.preventDefault();const he=n(u).getBoundingClientRect(),Pe=q.clientX-he.left,le=q.clientY-he.top,mt=n(s)+Pe/he.width*n(a),dt=n(i)+le/he.height*n(r),Je=q.deltaY>0?.9:1.1,Fe=Math.max(C,Math.min(b,n(h)*Je)),bt=f/Fe,ln=m/Fe,Zt=mt-Pe/he.width*bt,Z=dt-le/he.height*ln;w(h,Fe),w(y,Zt),w(g,Z)}function I(q){(q.button===1||q.button===0&&n(M))&&(q.preventDefault(),w(p,!0),_={x:q.clientX,y:q.clientY})}function S(q){if(!n(p))return;const he=n(u).getBoundingClientRect(),Pe=(q.clientX-_.x)/he.width*n(a),le=(q.clientY-_.y)/he.height*n(r);w(y,n(y)-Pe),w(g,n(g)-le),_={x:q.clientX,y:q.clientY}}function D(){w(p,!1)}function O(q){q.code==="Space"&&!q.repeat&&q.target.tagName!=="INPUT"&&(q.preventDefault(),w(M,!0))}function ie(q){q.code==="Space"&&w(M,!1)}function z(){w(h,1),w(y,0),w(g,0)}ue(()=>n(h),()=>{w(a,f/n(h))}),ue(()=>n(h),()=>{w(r,m/n(h))}),ue(()=>n(y),()=>{w(s,n(y))}),ue(()=>n(g),()=>{w(i,n(g))}),ue(()=>(n(s),n(i),n(a),n(r)),()=>{w(o,`${n(s)} ${n(i)} ${n(a)} ${n(r)}`)}),ue(()=>Ie,()=>{w(l,Array.from({length:Ie.width+1},(q,he)=>he))}),ue(()=>Ie,()=>{w(c,Array.from({length:Ie.height+1},(q,he)=>he))}),Tn();var fe={screenToSvg:x};$t();var de=fc();J("keydown",Sa,O),J("keyup",Sa,ie),J("mouseup",Sa,D),J("mousemove",Sa,S);let F;var B=E(de),te=A(B);T(te,"x",d),T(te,"y",d);var G=A(te);ke(G,1,()=>(ae(Ie),v(()=>Array(Ie.width+1))),He,(q,he,Pe)=>{var le=nc();T(le,"x1",d+Pe),T(le,"y1",d),T(le,"x2",d+Pe),V(()=>T(le,"y2",(ae(Ie),v(()=>d+Ie.height)))),L(q,le)});var ne=A(G);ke(ne,1,()=>(ae(Ie),v(()=>Array(Ie.height+1))),He,(q,he,Pe)=>{var le=ac();T(le,"x1",d),T(le,"y1",d+Pe),T(le,"y2",d+Pe),V(()=>T(le,"x2",(ae(Ie),v(()=>d+Ie.width)))),L(q,le)});var P=A(ne);ke(P,1,()=>(ae(Ie),v(()=>Array(Math.floor(Ie.width/6)+1))),He,(q,he,Pe)=>{var le=sc();T(le,"x1",d+Pe*6),T(le,"y1",d),T(le,"x2",d+Pe*6),V(()=>T(le,"y2",(ae(Ie),v(()=>d+Ie.height)))),L(q,le)});var N=A(P);ke(N,1,()=>(ae(Ie),v(()=>Array(Math.floor(Ie.height/6)+1))),He,(q,he,Pe)=>{var le=rc();T(le,"x1",d),T(le,"y1",d+Pe*6),T(le,"y2",d+Pe*6),V(()=>T(le,"x2",(ae(Ie),v(()=>d+Ie.width)))),L(q,le)});var W=A(N);ke(W,1,()=>n(l),He,(q,he)=>{var Pe=oc(),le=Ne(Pe);T(le,"y2",d);var mt=A(le);{var dt=Je=>{var Fe=ic();T(Fe,"y",1.2);var bt=E(Fe);V(()=>{T(Fe,"x",d+n(he)),Ce(bt,`${n(he)??""}"`)}),L(Je,Fe)};_e(mt,Je=>{n(he)%6===0&&Je(dt)})}V(()=>{T(le,"x1",d+n(he)),T(le,"y1",n(he)%6===0?.5:d-.8),T(le,"x2",d+n(he)),T(le,"stroke-width",n(he)%6===0?.08:.04)}),L(q,Pe)});var H=A(W);ke(H,1,()=>n(l),He,(q,he)=>{var Pe=cc(),le=Ne(Pe),mt=A(le);{var dt=Je=>{var Fe=lc(),bt=E(Fe);V(()=>{T(Fe,"x",d+n(he)),T(Fe,"y",(ae(Ie),v(()=>d+Ie.height+1.8))),Ce(bt,`${n(he)??""}"`)}),L(Je,Fe)};_e(mt,Je=>{n(he)%6===0&&Je(dt)})}V(()=>{T(le,"x1",d+n(he)),T(le,"y1",(ae(Ie),v(()=>d+Ie.height))),T(le,"x2",d+n(he)),T(le,"y2",(ae(Ie),n(he),v(()=>d+Ie.height+(n(he)%6===0?1.5:.8)))),T(le,"stroke-width",n(he)%6===0?.08:.04)}),L(q,Pe)});var K=A(H);ke(K,1,()=>n(c),He,(q,he)=>{var Pe=mc(),le=Ne(Pe);T(le,"x2",d);var mt=A(le);{var dt=Je=>{var Fe=uc();T(Fe,"x",1);var bt=E(Fe);V(()=>{T(Fe,"y",d+n(he)+.35),Ce(bt,`${n(he)??""}"`)}),L(Je,Fe)};_e(mt,Je=>{n(he)%6===0&&Je(dt)})}V(()=>{T(le,"x1",n(he)%6===0?.5:d-.8),T(le,"y1",d+n(he)),T(le,"y2",d+n(he)),T(le,"stroke-width",n(he)%6===0?.08:.04)}),L(q,Pe)});var re=A(K);ke(re,1,()=>n(c),He,(q,he)=>{var Pe=hc(),le=Ne(Pe),mt=A(le);{var dt=Je=>{var Fe=dc(),bt=E(Fe);V(()=>{T(Fe,"x",(ae(Ie),v(()=>d+Ie.width+1))),T(Fe,"y",d+n(he)+.35),Ce(bt,`${n(he)??""}"`)}),L(Je,Fe)};_e(mt,Je=>{n(he)%6===0&&Je(dt)})}V(()=>{T(le,"x1",(ae(Ie),v(()=>d+Ie.width))),T(le,"y1",d+n(he)),T(le,"x2",(ae(Ie),n(he),v(()=>d+Ie.width+(n(he)%6===0?1.5:.8)))),T(le,"y2",d+n(he)),T(le,"stroke-width",n(he)%6===0?.08:.04)}),L(q,Pe)});var De=A(re);T(De,"transform","translate(2, 2)");var Xe=E(De);return Oi(Xe,t,"default",{screenToSvg:x}),ts(de,q=>w(u,q),()=>n(u)),V(()=>{T(de,"viewBox",n(o)),F=rn(de,0,"battlefield svelte-n43bnt",null,F,{panning:n(p)||n(M)}),T(B,"width",(ae(Ie),v(()=>Ie.width+d*2))),T(B,"height",(ae(Ie),v(()=>Ie.height+d*2))),T(te,"width",(ae(Ie),v(()=>Ie.width))),T(te,"height",(ae(Ie),v(()=>Ie.height)))}),J("wheel",de,R),J("mousedown",de,I),J("dblclick",de,z),L(e,de),Ga(t,"screenToSvg",x),Lt(fe)}var yc=Me('<line stroke="#3b82f6" stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" fill="#3b82f6" stroke="#1d4ed8" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-trljjm"></circle>',1),pc=Me('<g><g><rect role="button" tabindex="0" class="svelte-trljjm"></rect></g><!></g>');function Gi(e,t){It(t,!1);const a=$(),r=$(),s=$(),i=$(),o=$();let l=Re(t,"id",8),c=Re(t,"x",8),u=Re(t,"y",8),d=Re(t,"width",8),f=Re(t,"height",8),m=Re(t,"rotation",8,0),h=Re(t,"selected",8,!1),y=Re(t,"screenToSvg",8),g=Re(t,"onSelect",8,()=>{}),p=Re(t,"onDrag",8,()=>{}),_=Re(t,"onRotate",8,()=>{}),M=$(!1),C=!1,b={x:0,y:0};function x(G){G.stopPropagation(),g()(l())}function R(G){if(G.button!==0)return;G.preventDefault(),G.stopPropagation(),g()(l()),w(M,!0);const ne=y()(G.clientX,G.clientY);b={x:ne.x-c(),y:ne.y-u()},window.addEventListener("mousemove",I),window.addEventListener("mouseup",S)}function I(G){if(!n(M))return;const ne=y()(G.clientX,G.clientY);let P=ne.x-b.x,N=ne.y-b.y;G.shiftKey||(P=Math.round(P),N=Math.round(N));const W=Math.max(d(),f())/2;P=Math.max(-W,Math.min(Ie.width-d()+W,P)),N=Math.max(-W,Math.min(Ie.height-f()+W,N)),p()(l(),P,N)}function S(){w(M,!1),window.removeEventListener("mousemove",I),window.removeEventListener("mouseup",S)}function D(G){G.preventDefault(),G.stopPropagation(),C=!0,window.addEventListener("mousemove",O),window.addEventListener("mouseup",ie)}function O(G){if(!C)return;const ne=y()(G.clientX,G.clientY),P=ne.x-n(a),N=ne.y-n(r);let W=Math.atan2(N,P)*180/Math.PI+45;G.shiftKey||(W=Math.round(W/15)*15),_()(l(),W)}function ie(){C=!1,window.removeEventListener("mousemove",O),window.removeEventListener("mouseup",ie)}ue(()=>(ae(c()),ae(d())),()=>{w(a,c()+d()/2)}),ue(()=>(ae(u()),ae(f())),()=>{w(r,u()+f()/2)}),ue(()=>(ae(d()),ae(f())),()=>{w(s,Math.max(d(),f())/2+1.5)}),ue(()=>(n(a),n(s),ae(m())),()=>{w(i,n(a)+n(s)*Math.cos((m()-45)*Math.PI/180))}),ue(()=>(n(r),n(s),ae(m())),()=>{w(o,n(r)+n(s)*Math.sin((m()-45)*Math.PI/180))}),Tn(),$t();var z=pc();let fe;var de=E(z),F=E(de),B=A(de);{var te=G=>{var ne=yc(),P=Ne(ne),N=A(P);V(()=>{T(P,"x1",n(a)),T(P,"y1",n(r)),T(P,"x2",n(i)),T(P,"y2",n(o)),T(N,"cx",n(i)),T(N,"cy",n(o))}),J("mousedown",N,D),L(G,ne)};_e(B,G=>{h()&&G(te)})}V(()=>{fe=rn(z,0,"terrain-rect svelte-trljjm",null,fe,{selected:h(),dragging:n(M)}),T(de,"transform",`rotate(${m()??""}, ${n(a)??""}, ${n(r)??""})`),T(F,"x",c()),T(F,"y",u()),T(F,"width",d()),T(F,"height",f()),T(F,"fill",h()?"rgba(59, 130, 246, 0.3)":"rgba(139, 90, 43, 0.3)"),T(F,"stroke",h()?"#3b82f6":"#8b5a2b"),T(F,"stroke-width",h()?.15:.1)}),J("click",F,x),J("mousedown",F,R),L(e,z),Lt()}const zi="warhammer-deployment-layouts",ji=[{label:'6" x 12"',width:6,height:12},{label:'5" x 10"',width:5,height:10},{label:'4" x 6"',width:4,height:6}],Vs=[{label:"L 4x8",shape:"L-4x8"},{label:"L 4x8 â",shape:"L-4x8-mirror"},{label:"C 4-8-4",shape:"C-4-8-4"},{label:"L 5x6",shape:"L-5x6"},{label:"L 5x6 â",shape:"L-5x6-mirror"},{label:"L 4x6",shape:"L-4x6"},{label:"L 4x6 â",shape:"L-4x6-mirror"}],yr=[{name:"Layout 1",terrains:[{id:"a",x:28,y:0,width:4,height:6,rotation:0},{id:"b",x:28,y:38,width:4,height:6,rotation:0},{id:"c",x:6,y:5,width:6,height:12,rotation:0},{id:"d",x:48,y:27,width:6,height:12,rotation:0},{id:"e",x:16,y:28,width:6,height:12,rotation:0},{id:"f",x:7,y:19,width:6,height:12,rotation:90},{id:"g",x:38,y:4,width:6,height:12,rotation:0},{id:"h",x:47,y:13,width:6,height:12,rotation:90},{id:"i",x:32.74,y:23.59,width:5,height:10,rotation:135},{id:"j",x:35.06,y:19.5,width:4,height:6,rotation:45},{id:"k",x:22.07,y:10.17,width:5,height:10,rotation:-45},{id:"l",x:20.72,y:18.23,width:4,height:6,rotation:45}],walls:[{id:"wa",x:38,y:6,shape:"C-4-8-4",rotation:0},{id:"wb",x:18,y:30,shape:"C-4-8-4",rotation:180},{id:"wc",x:13.33,y:20.15,shape:"L-4x8-mirror",rotation:-90},{id:"wd",x:49.67,y:15.93,shape:"L-4x8-mirror",rotation:90},{id:"we",x:48.2,y:30.88,shape:"L-4x8",rotation:0},{id:"wf",x:7.84,y:5.01,shape:"L-4x8",rotation:180},{id:"wg",x:27.06,y:11.52,shape:"L-4x8-mirror",rotation:-45},{id:"wh",x:35.81,y:24.24,shape:"L-4x8-mirror",rotation:135}]},{name:"Layout 2",terrains:[{id:"a",x:31,y:7,width:4,height:6,rotation:-90},{id:"b",x:25,y:30,width:4,height:6,rotation:90},{id:"c",x:5,y:4,width:6,height:12,rotation:0},{id:"d",x:49,y:28,width:6,height:12,rotation:0},{id:"e",x:46,y:4,width:6,height:12,rotation:0},{id:"f",x:16.32,y:16.13,width:6,height:12,rotation:135},{id:"g",x:53,y:15,width:4,height:6,rotation:90},{id:"h",x:8,y:28,width:6,height:12,rotation:0},{id:"i",x:3,y:23,width:4,height:6,rotation:90},{id:"j",x:32.62,y:32.55,width:5,height:10,rotation:-90},{id:"k",x:22.48,y:.51,width:5,height:10,rotation:-90},{id:"l",x:37,y:16,width:6,height:12,rotation:135}],walls:[{id:"wa",x:49,y:32,shape:"L-4x8",rotation:0},{id:"wb",x:7,y:4,shape:"L-4x8",rotation:180},{id:"wc",x:46,y:8,shape:"L-4x8",rotation:0},{id:"wd",x:10,y:28,shape:"L-4x8",rotation:180},{id:"we",x:35.07,y:34.56,shape:"L-5x6-mirror",rotation:-90},{id:"wf",x:29.09,y:2.47,shape:"L-5x6-mirror",rotation:90},{id:"wg",x:17.86,y:17.53,shape:"C-4-8-4",rotation:135},{id:"wh",x:37.24,y:18.38,shape:"C-4-8-4",rotation:-45}]},{name:"Layout 3",terrains:[{id:"a",x:11,y:3,width:4,height:6,rotation:90},{id:"b",x:45,y:35,width:4,height:6,rotation:90},{id:"c",x:25,y:1,width:6,height:12,rotation:90},{id:"d",x:29,y:31,width:6,height:12,rotation:90},{id:"e",x:7.74,y:26.05,width:6,height:12,rotation:125.31},{id:"f",x:46.34,y:5.51,width:6,height:12,rotation:121.72},{id:"g",x:5.14,y:10.46,width:6,height:12,rotation:41.51},{id:"h",x:48.67,y:21.52,width:6,height:12,rotation:41.51},{id:"i",x:19.59,y:14.36,width:5,height:10,rotation:-38.13},{id:"j",x:20.69,y:24.37,width:4,height:6,rotation:-39.33},{id:"k",x:35.34,y:19.61,width:5,height:10,rotation:-38.13},{id:"l",x:35.31,y:13.5,width:4,height:6,rotation:-39.33}],walls:[{id:"aa",x:30,y:32,shape:"C-4-8-4",rotation:90},{id:"ab",x:26,y:4,shape:"C-4-8-4",rotation:-90},{id:"ac",x:8.19,y:11.64,shape:"L-4x8",rotation:222.46},{id:"ad",x:47.79,y:24.3,shape:"L-4x8",rotation:41.26},{id:"ae",x:38.64,y:20.09,shape:"L-5x6-mirror",rotation:141.31},{id:"af",x:25.26,y:17.9,shape:"L-5x6-mirror",rotation:-37.61},{id:"ag",x:14.37,y:28.38,shape:"L-4x8-mirror",rotation:-54.26},{id:"ah",x:48.75,y:7.3,shape:"L-4x8-mirror",rotation:122.02}]},{name:"Layout 4",terrains:[{id:"a",x:15,y:1,width:6,height:12,rotation:90},{id:"b",x:8,y:10,width:4,height:6,rotation:0},{id:"c",x:4,y:19,width:4,height:6,rotation:0},{id:"d",x:7.5,y:27.68,width:6,height:12,rotation:-48.57},{id:"e",x:46.53,y:4.24,width:6,height:12,rotation:-48.57},{id:"f",x:53,y:19,width:4,height:6,rotation:0},{id:"g",x:48,y:28,width:4,height:6,rotation:0},{id:"h",x:39,y:31,width:6,height:12,rotation:90},{id:"i",x:33.03,y:2.97,width:6,height:12,rotation:-37.25},{id:"j",x:20.96,y:28.96,width:6,height:12,rotation:-37.25},{id:"k",x:16.93,y:16.51,width:5,height:10,rotation:-41.85},{id:"l",x:37.96,y:17.43,width:5,height:10,rotation:-41.85}],walls:[{id:"aa",x:18,y:4,shape:"L-4x8",rotation:-90},{id:"ab",x:9.04,y:29.01,shape:"C-4-8-4",rotation:131.97},{id:"ac",x:47,y:7,shape:"C-4-8-4",rotation:-48.54},{id:"ad",x:38,y:32,shape:"L-4x8",rotation:90},{id:"ae",x:34.42,y:7.12,shape:"L-4x8",rotation:-37.53},{id:"af",x:21.57,y:28.8,shape:"L-4x8",rotation:142.46},{id:"ag",x:15.7,y:17.01,shape:"L-5x6",rotation:137.87},{id:"ah",x:39.17,y:20.85,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 5",terrains:[{id:"aa",x:27,y:1,width:6,height:12,rotation:90},{id:"ab",x:36.53,y:12.48,width:5,height:10,rotation:-90},{id:"ac",x:13,y:3,width:4,height:6,rotation:90},{id:"ad",x:43,y:35,width:4,height:6,rotation:90},{id:"ae",x:27,y:31,width:6,height:12,rotation:90},{id:"af",x:18.43,y:21.49,width:5,height:10,rotation:-90},{id:"ag",x:1,y:23,width:4,height:6,rotation:90},{id:"ah",x:55,y:15,width:4,height:6,rotation:90},{id:"ai",x:7.83,y:30.22,width:6,height:12,rotation:-60},{id:"aj",x:46.32,y:1.58,width:6,height:12,rotation:-60},{id:"ak",x:8.74,y:10.19,width:6,height:12,rotation:65.22},{id:"al",x:45.22,y:21.75,width:6,height:12,rotation:65.22}],walls:[{id:"a1",x:28,y:32,shape:"C-4-8-4",rotation:90},{id:"a2",x:28,y:4,shape:"C-4-8-4",rotation:-90},{id:"a3",x:11.88,y:12.29,shape:"L-4x8",rotation:-114.74},{id:"a4",x:43.97,y:23.59,shape:"L-4x8",rotation:64.22},{id:"a5",x:24.91,y:23.52,shape:"L-5x6-mirror",rotation:-90.37},{id:"a6",x:39,y:14.51,shape:"L-5x6-mirror",rotation:89.9},{id:"a7",x:7.58,y:30.57,shape:"L-4x8",rotation:120.93},{id:"a8",x:48.51,y:5.28,shape:"L-4x8",rotation:-59.06}]},{name:"Layout 6",terrains:[{id:"aa",x:13,y:1,width:6,height:12,rotation:90},{id:"ab",x:6,y:10,width:4,height:6,rotation:0},{id:"ac",x:25,y:11,width:4,height:6,rotation:90},{id:"ad",x:7.34,y:27.57,width:6,height:12,rotation:-40.32},{id:"ae",x:46.69,y:4.57,width:6,height:12,rotation:-41.9},{id:"af",x:31,y:27,width:4,height:6,rotation:-90},{id:"ag",x:50,y:28,width:4,height:6,rotation:0},{id:"ah",x:41,y:31,width:6,height:12,rotation:90},{id:"ai",x:34,y:4,width:6,height:12,rotation:0},{id:"aj",x:20,y:28,width:6,height:12,rotation:0},{id:"ak",x:15.7,y:15.03,width:5,height:10,rotation:-41.85},{id:"al",x:39.43,y:19.24,width:5,height:10,rotation:-39.95}],walls:[{id:"a1",x:16,y:4,shape:"L-4x8",rotation:-90},{id:"a2",x:9.04,y:29.01,shape:"C-4-8-4",rotation:140.05},{id:"a3",x:47,y:7.16,shape:"C-4-8-4",rotation:-41.53},{id:"a4",x:40,y:32,shape:"L-4x8",rotation:90},{id:"a5",x:34.15,y:7.88,shape:"L-4x8",rotation:0},{id:"a6",x:22,y:28,shape:"L-4x8",rotation:180},{id:"a7",x:14.47,y:15.47,shape:"L-5x6",rotation:137.87},{id:"a8",x:40.53,y:22.78,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 7",terrains:[{id:"aa",x:8,y:8,width:6,height:12,rotation:0},{id:"ab",x:6,y:28,width:6,height:12,rotation:0},{id:"ac",x:7,y:39,width:4,height:6,rotation:90},{id:"ad",x:18,y:26,width:5,height:10,rotation:0},{id:"ae",x:19,y:20,width:4,height:6,rotation:0},{id:"af",x:23,y:3,width:6,height:12,rotation:0},{id:"ag",x:31,y:29,width:6,height:12,rotation:0},{id:"ah",x:37,y:18,width:4,height:6,rotation:0},{id:"ai",x:37,y:8,width:5,height:10,rotation:0},{id:"aj",x:46,y:24,width:6,height:12,rotation:0},{id:"ak",x:48,y:4,width:6,height:12,rotation:0},{id:"al",x:49,y:-1,width:4,height:6,rotation:90}],walls:[{id:"a1",x:9,y:10,shape:"L-5x6",rotation:180},{id:"a2",x:11.44,y:31.97,shape:"L-4x8-mirror",rotation:0},{id:"a3",x:19,y:20,shape:"L-4x6",rotation:180},{id:"a4",x:22.53,y:30.02,shape:"L-5x6-mirror",rotation:0},{id:"a5",x:25,y:5,shape:"C-4-8-4",rotation:180},{id:"a6",x:31,y:31,shape:"C-4-8-4",rotation:0},{id:"a7",x:37,y:18,shape:"L-4x6",rotation:0},{id:"a8",x:41.51,y:8.09,shape:"L-5x6-mirror",rotation:180},{id:"a9",x:46,y:28,shape:"L-5x6",rotation:0},{id:"a10",x:51.51,y:4.01,shape:"L-4x8-mirror",rotation:180}]},{name:"Layout 8",terrains:[{id:"aa",x:23,y:22,width:4,height:6,rotation:0},{id:"ab",x:23,y:28,width:4,height:6,rotation:0},{id:"ac",x:33,y:16,width:4,height:6,rotation:0},{id:"ad",x:33,y:10,width:4,height:6,rotation:0},{id:"ae",x:41,y:19,width:6,height:12,rotation:0},{id:"af",x:13,y:13,width:6,height:12,rotation:0},{id:"ag",x:32,y:32,width:6,height:12,rotation:0},{id:"ah",x:22,y:0,width:6,height:12,rotation:0},{id:"ai",x:9.5,y:27.68,width:6,height:12,rotation:-48.69},{id:"aj",x:44.51,y:4.35,width:6,height:12,rotation:-48.69},{id:"ak",x:6.95,y:4,width:5,height:10,rotation:53.9},{id:"al",x:48,y:30,width:5,height:10,rotation:53.9}],walls:[{id:"a1",x:32,y:34,shape:"C-4-8-4",rotation:0},{id:"a2",x:24,y:2,shape:"C-4-8-4",rotation:180},{id:"a3",x:44.68,y:19.06,shape:"L-4x8-mirror",rotation:180},{id:"a4",x:18.43,y:16.91,shape:"L-4x8-mirror",rotation:0},{id:"a5",x:46.38,y:33.13,shape:"L-5x6",rotation:52.87},{id:"a6",x:8.55,y:4.89,shape:"L-5x6",rotation:-127.66},{id:"a7",x:16,y:30.28,shape:"L-4x8-mirror",rotation:-48.62},{id:"a8",x:46.91,y:5.85,shape:"L-4x8-mirror",rotation:132.19}]}];function vc(){return"terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function wn(){const e=localStorage.getItem(zi);if(e)try{return JSON.parse(e)}catch(t){return console.error("Failed to parse saved layouts:",t),{}}return{}}function As(e){localStorage.setItem(zi,JSON.stringify(e))}function Xi(){const{subscribe:e,set:t,update:a}=ot([]);return{subscribe:e,set:t,update:a,add(r,s){a(i=>[...i,{id:vc(),x:30-r/2,y:22-s/2,width:r,height:s,rotation:0}])},updateTerrain(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){t([])},save(r){const s=Ft({subscribe:e}),i=wn();i[r]={terrains:s,savedAt:Date.now()},As(i)},load(r){const s=wn();return s[r]?(t(s[r].terrains),!0):!1},deleteLayout(r){const s=wn();delete s[r],As(s)},getSavedLayoutNames(){const r=wn();return Object.keys(r).map(s=>({name:s,savedAt:r[s].savedAt,terrainCount:r[s].terrains.length})).sort((s,i)=>i.savedAt-s.savedAt)},hasSaved(){const r=wn();return Object.keys(r).length>0}}}const zt=Xi();function Vi(){const{subscribe:e,set:t,update:a}=ot([]);return{subscribe:e,set:t,update:a,add(r){a(s=>[...s,{id:"wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),x:30,y:22,shape:r,rotation:0}])},updateWall(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){t([])}}}const Ht=Vi(),fs=Xi(),ys=Vi(),ps=ot(null),vs=ot(null);function La(e){switch(e){case"L-4x8":return[{x:0,y:0},{x:.5,y:0},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];case"L-4x8-mirror":return[{x:0,y:0},{x:.5,y:0},{x:.5,y:8},{x:-4+.5,y:8},{x:-4+.5,y:8-.5},{x:0,y:8-.5}];case"C-4-8-4":return[{x:0,y:0},{x:4,y:0},{x:4,y:.5},{x:.5,y:.5},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];case"L-5x6":return[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:5,y:6-.5},{x:5,y:6},{x:0,y:6}];case"L-5x6-mirror":return[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-5+.5,y:6},{x:-5+.5,y:6-.5},{x:0,y:6-.5}];case"L-4x6":return[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:4,y:6-.5},{x:4,y:6},{x:0,y:6}];case"L-4x6-mirror":return[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-4+.5,y:6},{x:-4+.5,y:6-.5},{x:0,y:6-.5}];default:return[]}}function pr(e,t,a,r){if(e.length===0)return[];const s=e.map(_=>_.x),i=e.map(_=>_.y),o=Math.min(...s),l=Math.max(...s),c=Math.min(...i),u=Math.max(...i),d=l-o,f=u-c,m=t+o+d/2,h=a+c+f/2,y=r*Math.PI/180,g=Math.cos(y),p=Math.sin(y);return e.map(_=>{const M=t+_.x,C=a+_.y,b=M-m,x=C-h;return{x:m+b*g-x*p,y:h+b*p+x*g}})}Kt(Ht,e=>e.map(t=>pr(La(t.shape),t.x,t.y,t.rotation)));const dn=ot(null),hn=ot(null),vr=ot([]);function gc(e,t=[]){const a=Ft(zt),r=Ft(Ht),s=wn();s[e]={terrains:a,walls:r,models:t,savedAt:Date.now()},As(s)}function bc(e){const t=wn();return t[e]?(zt.set(t[e].terrains||[]),Ht.set(t[e].walls||[]),{terrains:t[e].terrains||[],walls:t[e].walls||[],models:t[e].models||[]}):null}function Tc(e){const t=wn();delete t[e],As(t)}function xc(){const e=wn();return Object.keys(e).map(t=>({name:t,savedAt:e[t].savedAt,terrainCount:(e[t].terrains||[]).length,wallCount:(e[t].walls||[]).length,modelCount:(e[t].models||[]).length})).sort((t,a)=>a.savedAt-t.savedAt)}function za(){vr.set(xc())}var _c=Me('<line stroke="#3b82f6" stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" fill="#3b82f6" stroke="#1d4ed8" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-1tez9jd"></circle>',1),Sc=Me('<g><g><path role="button" tabindex="0" class="svelte-1tez9jd"></path></g><!></g>');function gr(e,t){It(t,!1);const a=$(),r=$(),s=$(),i=$(),o=$(),l=$(),c=$(),u=$(),d=$(),f=$();let m=Re(t,"id",8),h=Re(t,"x",8),y=Re(t,"y",8),g=Re(t,"shape",8),p=Re(t,"rotation",8,0),_=Re(t,"selected",8,!1),M=Re(t,"screenToSvg",8),C=Re(t,"onSelect",8,()=>{}),b=Re(t,"onDrag",8,()=>{}),x=Re(t,"onRotate",8,()=>{});function R(H){const K=H.map(De=>De.x),re=H.map(De=>De.y);return{minX:Math.min(...K),maxX:Math.max(...K),minY:Math.min(...re),maxY:Math.max(...re)}}let I=$(!1),S=!1,D={x:0,y:0};function O(H){H.stopPropagation(),C()(m())}function ie(H){if(H.button!==0)return;H.preventDefault(),H.stopPropagation(),C()(m()),w(I,!0);const K=M()(H.clientX,H.clientY);D={x:K.x-h(),y:K.y-y()},window.addEventListener("mousemove",z),window.addEventListener("mouseup",fe)}function z(H){if(!n(I))return;const K=M()(H.clientX,H.clientY);let re=K.x-D.x,De=K.y-D.y;H.shiftKey||(re=Math.round(re),De=Math.round(De));const Xe=Math.max(n(s),n(i));re=Math.max(-Xe,Math.min(Ie.width+Xe-n(s),re)),De=Math.max(-Xe,Math.min(Ie.height+Xe-n(i),De)),b()(m(),re,De)}function fe(){w(I,!1),window.removeEventListener("mousemove",z),window.removeEventListener("mouseup",fe)}function de(H){H.preventDefault(),H.stopPropagation(),S=!0,window.addEventListener("mousemove",F),window.addEventListener("mouseup",B)}function F(H){if(!S)return;const K=M()(H.clientX,H.clientY),re=K.x-n(o),De=K.y-n(l);let Xe=Math.atan2(De,re)*180/Math.PI+45;H.shiftKey||(Xe=Math.round(Xe/15)*15),x()(m(),Xe)}function B(){S=!1,window.removeEventListener("mousemove",F),window.removeEventListener("mouseup",B)}ue(()=>ae(g()),()=>{w(a,La(g()))}),ue(()=>n(a),()=>{w(r,R(n(a)))}),ue(()=>n(r),()=>{w(s,n(r).maxX-n(r).minX)}),ue(()=>n(r),()=>{w(i,n(r).maxY-n(r).minY)}),ue(()=>(ae(h()),n(r),n(s)),()=>{w(o,h()+n(r).minX+n(s)/2)}),ue(()=>(ae(y()),n(r),n(i)),()=>{w(l,y()+n(r).minY+n(i)/2)}),ue(()=>(n(a),ae(h()),ae(y())),()=>{w(c,n(a).length>0?`M ${n(a).map(H=>`${h()+H.x},${y()+H.y}`).join(" L ")} Z`:"")}),ue(()=>(n(s),n(i)),()=>{w(u,Math.max(n(s),n(i))/2+1.5)}),ue(()=>(n(o),n(u),ae(p())),()=>{w(d,n(o)+n(u)*Math.cos((p()-45)*Math.PI/180))}),ue(()=>(n(l),n(u),ae(p())),()=>{w(f,n(l)+n(u)*Math.sin((p()-45)*Math.PI/180))}),Tn(),$t();var te=Sc();let G;var ne=E(te),P=E(ne),N=A(ne);{var W=H=>{var K=_c(),re=Ne(K),De=A(re);V(()=>{T(re,"x1",n(o)),T(re,"y1",n(l)),T(re,"x2",n(d)),T(re,"y2",n(f)),T(De,"cx",n(d)),T(De,"cy",n(f))}),J("mousedown",De,de),L(H,K)};_e(N,H=>{_()&&H(W)})}V(()=>{G=rn(te,0,"wall-piece svelte-1tez9jd",null,G,{selected:_(),dragging:n(I)}),T(ne,"transform",`rotate(${p()??""}, ${n(o)??""}, ${n(l)??""})`),T(P,"d",n(c)),T(P,"fill",_()?"rgba(139, 69, 19, 0.6)":"rgba(139, 69, 19, 0.8)"),T(P,"stroke",_()?"#3b82f6":"#5c3317"),T(P,"stroke-width",_()?.15:.1)}),J("click",P,O),J("mousedown",P,ie),L(e,te),Lt()}var wc=be('<div class="section-content svelte-7o4pd4"><!></div>'),Ac=be('<section><div class="section-header svelte-7o4pd4" role="button" tabindex="0"><h3 class="svelte-7o4pd4"> </h3> <span class="toggle-icon svelte-7o4pd4"> </span></div> <!></section>');function Et(e,t){let a=Re(t,"title",8),r=Re(t,"defaultOpen",8,!0),s=$(r());function i(){w(s,!n(s))}var o=Ac();let l;var c=E(o),u=E(c),d=E(u),f=A(u,2),m=E(f),h=A(c,2);{var y=g=>{var p=wc(),_=E(p);Oi(_,t,"default",{}),L(g,p)};_e(h,g=>{n(s)&&g(y)})}V(()=>{l=rn(o,1,"collapsible-section svelte-7o4pd4",null,l,{collapsed:!n(s)}),Ce(d,a()),Ce(m,n(s)?"â¼":"â¶")}),J("click",c,i),L(e,o)}var Cc=be('<button class="svelte-10mgcx0"> </button>'),Ec=be('<div class="button-group svelte-10mgcx0"></div>'),Rc=be('<button class="svelte-10mgcx0"> </button>'),Mc=be('<div class="button-group svelte-10mgcx0"></div>'),kc=be('<div class="field svelte-10mgcx0"><span class="label-text svelte-10mgcx0">Size</span> <span class="value svelte-10mgcx0"> </span></div> <div class="field svelte-10mgcx0"><span class="label-text svelte-10mgcx0">Rotation</span> <span class="value svelte-10mgcx0"> </span></div>',1),Dc=be('<div class="field svelte-10mgcx0"><span class="label-text svelte-10mgcx0">Shape</span> <span class="value svelte-10mgcx0"> </span></div> <div class="field svelte-10mgcx0"><span class="label-text svelte-10mgcx0">Rotation</span> <span class="value svelte-10mgcx0"> </span></div>',1),Ic=be('<div class="edit-form svelte-10mgcx0"><div class="field svelte-10mgcx0"><label for="edit-x" class="svelte-10mgcx0">X (inches)</label> <input id="edit-x" type="number" step="0.1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-y" class="svelte-10mgcx0">Y (inches)</label> <input id="edit-y" type="number" step="0.1" class="svelte-10mgcx0"/></div> <!> <button class="danger svelte-10mgcx0">Remove</button></div>'),Lc=be('<p class="hint svelte-10mgcx0">Click a piece to select it</p>'),Nc=be('<div class="button-group vertical svelte-10mgcx0"><button class="svelte-10mgcx0">Save Layout</button> <button class="svelte-10mgcx0">Load Layout</button> <div class="button-row svelte-10mgcx0"><button class="secondary small svelte-10mgcx0">Export</button> <button class="secondary small svelte-10mgcx0">Import</button></div> <button class="secondary svelte-10mgcx0">Clear All</button></div>'),Pc=be("<!> <!>",1),$c=be('<div class="modal-overlay svelte-10mgcx0" role="presentation"><div class="modal svelte-10mgcx0" role="dialog"><h2 class="svelte-10mgcx0">Save Layout</h2> <div class="modal-field svelte-10mgcx0"><label for="layout-name" class="svelte-10mgcx0">Layout Name</label> <input id="layout-name" type="text" placeholder="Enter a name..." class="svelte-10mgcx0"/></div> <div class="modal-actions svelte-10mgcx0"><button class="secondary svelte-10mgcx0">Cancel</button> <button class="svelte-10mgcx0">Save</button></div></div></div>'),Oc=be('<p class="hint svelte-10mgcx0">No saved layouts yet</p>'),Wc=be('<div class="layout-item svelte-10mgcx0" role="button" tabindex="0"><div class="layout-info svelte-10mgcx0"><span class="layout-name svelte-10mgcx0"> </span> <span class="layout-meta svelte-10mgcx0"> </span></div> <button class="delete-btn svelte-10mgcx0" title="Delete">Ã</button></div>'),Yc=be('<div class="layout-list svelte-10mgcx0"></div>'),Hc=be('<div class="modal-overlay svelte-10mgcx0" role="presentation"><div class="modal svelte-10mgcx0" role="dialog"><h2 class="svelte-10mgcx0">Load Layout</h2> <!> <div class="modal-actions svelte-10mgcx0"><button class="secondary svelte-10mgcx0">Cancel</button></div></div></div>'),Bc=be('<main class="svelte-10mgcx0"><div class="header svelte-10mgcx0"><h1 class="svelte-10mgcx0">Layout Builder</h1> <nav class="nav-links svelte-10mgcx0"><a href="#/setup" class="svelte-10mgcx0">Battlefield Setup</a> <a href="#/deployment" class="svelte-10mgcx0">Deployment</a> <a href="#/" class="active svelte-10mgcx0">Layout Builder</a> <a href="#/debug" class="svelte-10mgcx0">Debug Mode</a></nav></div> <div class="layout svelte-10mgcx0"><div class="sidebar svelte-10mgcx0"><!> <!> <!> <!> <input type="file" accept=".json" style="display: none;"/></div> <div class="battlefield-area svelte-10mgcx0"><div class="battlefield-container svelte-10mgcx0" role="presentation"><!></div> <div class="info svelte-10mgcx0"><p class="svelte-10mgcx0"> </p> <p class="hint svelte-10mgcx0">Scroll to zoom | Space+drag or middle-click to pan | Double-click to reset view</p></div></div></div></main> <!> <!>',1);function Fc(e,t){It(t,!1);const a=()=>Qe(dn,"$selectedTerrainId",l),r=()=>Qe(hn,"$selectedWallId",l),s=()=>Qe(zt,"$layoutTerrains",l),i=()=>Qe(Ht,"$layoutWalls",l),o=()=>Qe(vr,"$savedLayoutsList",l),[l,c]=Ya(),u=$(),d=$();let f=$(!1),m=$(!1),h=$(""),y=null;Ha(()=>{za(),window.addEventListener("keydown",g)}),Bi(()=>{window.removeEventListener("keydown",g)});function g(Y){if(Y.target.tagName==="INPUT"||n(f)||n(m))return;const ge=a()||r();if((Y.key==="Delete"||Y.key==="Backspace")&&ge){Y.preventDefault(),ie();return}if(ge&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(Y.key)){Y.preventDefault();const xe=Y.shiftKey?.1:1;let we=0,Te=0;switch(Y.key){case"ArrowUp":Te=-xe;break;case"ArrowDown":Te=xe;break;case"ArrowLeft":we=-xe;break;case"ArrowRight":we=xe;break}if(a()){const ee=s().find(oe=>oe.id===a());ee&&zt.updateTerrain(a(),{x:ee.x+we,y:ee.y+Te})}else if(r()){const ee=i().find(oe=>oe.id===r());ee&&Ht.updateWall(r(),{x:ee.x+we,y:ee.y+Te})}return}if(Y.key==="c"&&(Y.ctrlKey||Y.metaKey)&&ge){if(Y.preventDefault(),a()){const xe=s().find(we=>we.id===a());xe&&(y={type:"terrain",data:{...xe}})}else if(r()){const xe=i().find(we=>we.id===r());xe&&(y={type:"wall",data:{...xe}})}return}if(Y.key==="v"&&(Y.ctrlKey||Y.metaKey)&&y){if(Y.preventDefault(),y.type==="terrain"){const xe="terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),we={...y.data,id:xe,x:y.data.x+2,y:y.data.y+2};zt.update(Te=>[...Te,we]),dn.set(xe),hn.set(null),y.data.x+=2,y.data.y+=2}else if(y.type==="wall"){const xe="wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),we={...y.data,id:xe,x:y.data.x+2,y:y.data.y+2};Ht.update(Te=>[...Te,we]),hn.set(xe),dn.set(null),y.data.x+=2,y.data.y+=2}return}if(Y.key==="Escape"){R();return}}let p=$(""),_=$("");function M(Y,ge){zt.add(Y,ge)}function C(Y){Ht.add(Y)}function b(Y){dn.set(Y),hn.set(null)}function x(Y){hn.set(Y),dn.set(null)}function R(){dn.set(null),hn.set(null)}function I(Y,ge,xe){zt.updateTerrain(Y,{x:ge,y:xe})}function S(Y,ge,xe){Ht.updateWall(Y,{x:ge,y:xe})}function D(Y,ge){zt.updateTerrain(Y,{rotation:ge})}function O(Y,ge){Ht.updateWall(Y,{rotation:ge})}function ie(){a()?(zt.remove(a()),dn.set(null)):r()&&(Ht.remove(r()),hn.set(null))}function z(){const Y=parseFloat(n(p)),ge=parseFloat(n(_));!isNaN(Y)&&!isNaN(ge)&&(a()?zt.updateTerrain(a(),{x:Y,y:ge}):r()&&Ht.updateWall(r(),{x:Y,y:ge}))}function fe(){w(h,""),w(f,!0)}function de(){n(h).trim()&&(gc(n(h).trim()),za(),w(f,!1),w(h,""))}function F(){za(),w(m,!0)}function B(Y){bc(Y),dn.set(null),hn.set(null),w(m,!1)}function te(Y,ge){ge.stopPropagation(),confirm(`Delete layout "${Y}"?`)&&(Tc(Y),za())}function G(){confirm("Clear all terrain and walls?")&&(zt.clear(),Ht.clear(),dn.set(null),hn.set(null))}function ne(Y){return new Date(Y).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function P(Y){const ge=Vs.find(xe=>xe.shape===Y);return ge?ge.label:Y}function N(){const Y=s(),ge=i(),xe={version:1,exportedAt:Date.now(),terrains:Y,walls:ge},we=JSON.stringify(xe,null,2),Te=new Blob([we],{type:"application/json"}),ee=URL.createObjectURL(Te),oe=document.createElement("a");oe.href=ee,oe.download=`layout-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(oe),oe.click(),document.body.removeChild(oe),URL.revokeObjectURL(ee)}let W=$();function H(){n(W).click()}function K(Y){const ge=Y.target.files[0];if(!ge)return;const xe=new FileReader;xe.onload=we=>{try{const Te=JSON.parse(we.target.result);Te.terrains&&Array.isArray(Te.terrains)&&zt.set(Te.terrains),Te.walls&&Array.isArray(Te.walls)&&Ht.set(Te.walls),dn.set(null),hn.set(null)}catch(Te){alert("Failed to import layout: Invalid file format"),console.error("Import error:",Te)}},xe.readAsText(ge),Y.target.value=""}ue(()=>(s(),a()),()=>{w(u,s().find(Y=>Y.id===a()))}),ue(()=>(i(),r()),()=>{w(d,i().find(Y=>Y.id===r()))}),ue(()=>(n(u),n(d)),()=>{n(u)?(w(p,n(u).x.toFixed(1)),w(_,n(u).y.toFixed(1))):n(d)&&(w(p,n(d).x.toFixed(1)),w(_,n(d).y.toFixed(1)))}),Tn(),$t();var re=Bc(),De=Ne(re),Xe=A(E(De),2),q=E(Xe),he=E(q);Et(he,{title:"Add Terrain",children:(Y,ge)=>{var xe=Ec();ke(xe,5,()=>ji,He,(we,Te)=>{var ee=Cc(),oe=E(ee);V(()=>Ce(oe,(n(Te),v(()=>n(Te).label)))),J("click",ee,()=>M(n(Te).width,n(Te).height)),L(we,ee)}),L(Y,xe)},$$slots:{default:!0}});var Pe=A(he,2);Et(Pe,{title:"Add Wall",children:(Y,ge)=>{var xe=Mc();ke(xe,5,()=>Vs,He,(we,Te)=>{var ee=Rc(),oe=E(ee);V(()=>Ce(oe,(n(Te),v(()=>n(Te).label)))),J("click",ee,()=>C(n(Te).shape)),L(we,ee)}),L(Y,xe)},$$slots:{default:!0}});var le=A(Pe,2);{let Y=ze(()=>n(u)?"Terrain":n(d)?"Wall":"Item");Et(le,{get title(){return`Selected ${n(Y)??""}`},children:(ge,xe)=>{var we=vt(),Te=Ne(we);{var ee=j=>{var Ee=Ic(),et=E(Ee),$e=A(E(et),2),U=A(et,2),Ge=A(E(U),2),Ot=A(U,2);{var tt=Tt=>{var st=kc(),nt=Ne(st),xt=A(E(nt),2),Ln=E(xt),Gn=A(nt,2),ma=A(E(Gn),2),Ba=E(ma);V(da=>{Ce(Ln,`${n(u),v(()=>n(u).width)??""}" x ${n(u),v(()=>n(u).height)??""}"`),Ce(Ba,`${da??""}Â°`)},[()=>(n(u),v(()=>Math.round(n(u).rotation)))]),L(Tt,st)},Gt=Tt=>{var st=vt(),nt=Ne(st);{var xt=Ln=>{var Gn=Dc(),ma=Ne(Gn),Ba=A(E(ma),2),da=E(Ba),Fa=A(ma,2),Is=A(E(Fa),2),Ls=E(Is);V((Ns,Ps)=>{Ce(da,Ns),Ce(Ls,`${Ps??""}Â°`)},[()=>(n(d),v(()=>P(n(d).shape))),()=>(n(d),v(()=>Math.round(n(d).rotation)))]),L(Ln,Gn)};_e(nt,Ln=>{n(d)&&Ln(xt)},!0)}L(Tt,st)};_e(Ot,Tt=>{n(u)?Tt(tt):Tt(Gt,!1)})}var cn=A(Ot,2);Ea($e,()=>n(p),Tt=>w(p,Tt)),J("change",$e,z),Ea(Ge,()=>n(_),Tt=>w(_,Tt)),J("change",Ge,z),J("click",cn,ie),L(j,Ee)},oe=j=>{var Ee=Lc();L(j,Ee)};_e(Te,j=>{n(u)||n(d)?j(ee):j(oe,!1)})}L(ge,we)},$$slots:{default:!0}})}var mt=A(le,2);Et(mt,{title:"Layout",children:(Y,ge)=>{var xe=Nc(),we=E(xe),Te=A(we,2),ee=A(Te,2),oe=E(ee),j=A(oe,2),Ee=A(ee,2);V(()=>Te.disabled=(o(),v(()=>o().length===0))),J("click",we,fe),J("click",Te,F),J("click",oe,N),J("click",j,H),J("click",Ee,G),L(Y,xe)},$$slots:{default:!0}});var dt=A(mt,2);ts(dt,Y=>w(W,Y),()=>n(W));var Je=A(q,2),Fe=E(Je),bt=E(Fe);Ds(bt,{children:rr,$$slots:{default:(Y,ge)=>{const xe=ze(()=>ge.screenToSvg);var we=Pc(),Te=Ne(we);ke(Te,1,s,oe=>oe.id,(oe,j)=>{{let Ee=ze(()=>(n(j),a(),v(()=>n(j).id===a())));Gi(oe,{get id(){return n(j),v(()=>n(j).id)},get x(){return n(j),v(()=>n(j).x)},get y(){return n(j),v(()=>n(j).y)},get width(){return n(j),v(()=>n(j).width)},get height(){return n(j),v(()=>n(j).height)},get rotation(){return n(j),v(()=>n(j).rotation)},get selected(){return n(Ee)},get screenToSvg(){return n(xe)},onSelect:b,onDrag:I,onRotate:D})}});var ee=A(Te,2);ke(ee,1,i,oe=>oe.id,(oe,j)=>{{let Ee=ze(()=>(n(j),r(),v(()=>n(j).id===r())));gr(oe,{get id(){return n(j),v(()=>n(j).id)},get x(){return n(j),v(()=>n(j).x)},get y(){return n(j),v(()=>n(j).y)},get shape(){return n(j),v(()=>n(j).shape)},get rotation(){return n(j),v(()=>n(j).rotation)},get selected(){return n(Ee)},get screenToSvg(){return n(xe)},onSelect:x,onDrag:S,onRotate:O})}}),L(Y,we)}}});var ln=A(Fe,2),Zt=E(ln),Z=E(Zt),Se=A(De,2);{var Le=Y=>{var ge=$c(),xe=E(ge),we=A(E(xe),2),Te=A(E(we),2),ee=A(we,2),oe=E(ee),j=A(oe,2);V(Ee=>j.disabled=Ee,[()=>(n(h),v(()=>!n(h).trim()))]),Ea(Te,()=>n(h),Ee=>w(h,Ee)),J("keydown",Te,Ee=>Ee.key==="Enter"&&de()),J("click",oe,()=>w(f,!1)),J("click",j,de),J("click",xe,Lr(function(Ee){Pr.call(this,t,Ee)})),J("click",ge,()=>w(f,!1)),L(Y,ge)};_e(Se,Y=>{n(f)&&Y(Le)})}var Ze=A(Se,2);{var Ke=Y=>{var ge=Hc(),xe=E(ge),we=A(E(xe),2);{var Te=Ee=>{var et=Oc();L(Ee,et)},ee=Ee=>{var et=Yc();ke(et,5,o,He,($e,U)=>{var Ge=Wc(),Ot=E(Ge),tt=E(Ot),Gt=E(tt),cn=A(tt,2),Tt=E(cn),st=A(Ot,2);V(nt=>{Ce(Gt,(n(U),v(()=>n(U).name))),Ce(Tt,`${n(U),v(()=>n(U).terrainCount)??""} terrain${n(U),v(()=>n(U).terrainCount!==1?"s":"")??""}, ${n(U),v(()=>n(U).wallCount||0)??""} wall${n(U),v(()=>(n(U).wallCount||0)!==1?"s":"")??""} Â· ${nt??""}`)},[()=>(n(U),v(()=>ne(n(U).savedAt)))]),J("click",st,nt=>te(n(U).name,nt)),J("click",Ge,()=>B(n(U).name)),L($e,Ge)}),L(Ee,et)};_e(we,Ee=>{o(),v(()=>o().length===0)?Ee(Te):Ee(ee,!1)})}var oe=A(we,2),j=E(oe);J("click",j,()=>w(m,!1)),J("click",xe,Lr(function(Ee){Pr.call(this,t,Ee)})),J("click",ge,()=>w(m,!1)),L(Y,ge)};_e(Ze,Y=>{n(m)&&Y(Ke)})}V(()=>Ce(Z,`Battlefield: 60" x 44" | ${s(),v(()=>s().length)??""} terrain${s(),v(()=>s().length!==1?"s":"")??""} | ${i(),v(()=>i().length)??""} wall${i(),v(()=>i().length!==1?"s":"")??""}`)),J("change",dt,K),J("click",Fe,R),L(e,re),Lt(),c()}const Qi=1/25.4,Ji=40*Qi/2,Zi=3+20*Qi;function eo(e="item"){return e+"-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function qc(){const{subscribe:e,set:t,update:a}=ot([]);return{subscribe:e,set:t,update:a,add(r){const s=eo("zone");return a(i=>[...i,{id:s,...r}]),s},updateZone(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){t([])}}}function Uc(){const{subscribe:e,set:t,update:a}=ot([]);return{subscribe:e,set:t,update:a,add(r,s,i=!1){const o=eo("obj"),l=Math.round(r),c=Math.round(s);return a(u=>[...u,{id:o,x:l,y:c,isPrimary:i}]),o},updateObjective(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){t([])}}}qc();Uc();const to=[{name:"Dawn of War",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:32},{type:"L",x:60,y:32},{type:"L",x:60,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:0,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:12},{type:"L",x:0,y:12},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1}]},{name:"Hammer and Anvil",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:18,y:0},{type:"L",x:18,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:42,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:42,y:44},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1}]},{name:"Tipping Point",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:12,y:0},{type:"L",x:12,y:22},{type:"L",x:20,y:22},{type:"L",x:20,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:40,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:48,y:44},{type:"L",x:48,y:22},{type:"L",x:40,y:22},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:34,isPrimary:!1},{x:22,y:8,isPrimary:!1},{x:38,y:36,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Search and Destroy",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:22},{type:"L",x:21,y:22},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:0,x:30,y:31},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:30,y:0},{type:"L",x:30,y:13},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:1,x:39,y:22},{type:"L",x:60,y:22},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:10,isPrimary:!1},{x:46,y:34,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Sweeping Engagement",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:0,y:8},{type:"L",x:30,y:8},{type:"L",x:30,y:14},{type:"L",x:60,y:14},{type:"L",x:60,y:0},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:0,y:44},{type:"L",x:60,y:44},{type:"L",x:60,y:36},{type:"L",x:30,y:36},{type:"L",x:30,y:30},{type:"L",x:0,y:30},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:18,isPrimary:!1},{x:50,y:26,isPrimary:!1},{x:18,y:38,isPrimary:!1},{x:42,y:6,isPrimary:!1}]},{name:"Crucible of Battle",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:60,y:44},{type:"L",x:30,y:0},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:20,y:8,isPrimary:!1},{x:40,y:36,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]}];function Qs(e){return e.map(t=>{switch(t.type){case"M":return`M ${t.x} ${t.y}`;case"L":return`L ${t.x} ${t.y}`;case"A":return`A ${t.rx} ${t.ry} ${t.rotation} ${t.largeArc} ${t.sweep} ${t.x} ${t.y}`;case"Z":return"Z";default:return""}}).join(" ")}const ea=ot(null),nn=ot(null),fn=ot(null),no=Kt([nn,fn],([e,t])=>{if(!e)return{terrains:[],walls:[]};if(t==="preset"){const a=yr.find(r=>r.name===e);return a?{terrains:a.terrains||[],walls:a.walls||[]}:{terrains:[],walls:[]}}else if(t==="saved"){const a=localStorage.getItem("warhammer-deployment-layouts");if(a)try{const r=JSON.parse(a);if(r[e])return{terrains:r[e].terrains||[],walls:r[e].walls||[]}}catch(r){console.error("Failed to load layout:",r)}}return{terrains:[],walls:[]}});var Kc=be('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),Gc=be('<button class="svelte-1jotvmi"> </button>'),zc=be('<div class="button-group svelte-1jotvmi"></div>'),jc=be('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),Xc=be('<button class="svelte-1jotvmi"> </button>'),Vc=be('<button class="svelte-1jotvmi"> </button>'),Qc=be('<div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Saved</h4> <div class="button-group svelte-1jotvmi"></div></div>'),Jc=be('<div class="layout-sections svelte-1jotvmi"><div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Presets</h4> <div class="button-group svelte-1jotvmi"></div></div> <!></div>'),Zc=be('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Objectives:</span> <span class="value svelte-1jotvmi"> </span></div>'),eu=be('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Pieces:</span> <span class="value svelte-1jotvmi"> </span></div>'),tu=be('<div class="summary svelte-1jotvmi"><div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Deployment:</span> <span class="value svelte-1jotvmi"> </span></div> <div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Terrain:</span> <span class="value svelte-1jotvmi"> </span></div> <!> <!></div>'),nu=Me('<path stroke-width="0.10" stroke-dasharray="0.5,0.25"></path>'),au=Me('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15"></circle><circle stroke="#000" stroke-width="0.06"></circle><circle r="0.15" fill="#000"></circle>',1),su=Me("<!><!>",1),ru=Me('<g><rect fill="rgba(139, 90, 43, 0.6)" stroke="#8b5a2b" stroke-width="0.1"></rect></g>'),iu=Me('<g><path fill="rgba(139, 69, 19, 0.8)" stroke="#5c3317" stroke-width="0.1"></path></g>'),ou=Me("<!><!><!>",1),lu=be('<main class="svelte-1jotvmi"><div class="header svelte-1jotvmi"><h1 class="svelte-1jotvmi">Battlefield Setup</h1> <nav class="nav-links svelte-1jotvmi"><a href="#/setup" class="active svelte-1jotvmi">Battlefield Setup</a> <a href="#/deployment" class="svelte-1jotvmi">Deployment</a> <a href="#/" class="svelte-1jotvmi">Layout Builder</a> <a href="#/debug" class="svelte-1jotvmi">Debug Mode</a></nav></div> <div class="layout svelte-1jotvmi"><div class="sidebar svelte-1jotvmi"><!> <!> <!></div> <div class="battlefield-area svelte-1jotvmi"><div class="battlefield-container svelte-1jotvmi"><!></div> <div class="info svelte-1jotvmi"><p class="svelte-1jotvmi">Battlefield: 60" x 44"</p> <p class="hint svelte-1jotvmi">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function cu(e,t){It(t,!1);const a=()=>Qe(ea,"$selectedDeployment",o),r=()=>Qe(nn,"$selectedLayoutName",o),s=()=>Qe(vr,"$savedLayoutsList",o),i=()=>Qe(no,"$loadedTerrain",o),[o,l]=Ya();Ha(()=>{za()});function c(S){ea.set(S)}function u(S){nn.set(S.name),fn.set("preset")}function d(S){nn.set(S),fn.set("saved")}function f(){nn.set(null),fn.set(null)}function m(){ea.set(null)}function h(S){let O=[];switch(S.shape){case"L-4x8":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];break;case"L-4x8-mirror":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:8},{x:-4+.5,y:8},{x:-4+.5,y:8-.5},{x:0,y:8-.5}];break;case"C-4-8-4":O=[{x:0,y:0},{x:4,y:0},{x:4,y:.5},{x:.5,y:.5},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];break;case"L-5x6":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:5,y:6-.5},{x:5,y:6},{x:0,y:6}];break;case"L-5x6-mirror":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-5+.5,y:6},{x:-5+.5,y:6-.5},{x:0,y:6-.5}];break;case"L-4x6":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:4,y:6-.5},{x:4,y:6},{x:0,y:6}];break;case"L-4x6-mirror":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-4+.5,y:6},{x:-4+.5,y:6-.5},{x:0,y:6-.5}];break;default:return""}return`M ${O.map(ie=>`${S.x+ie.x},${S.y+ie.y}`).join(" L ")} Z`}function y(S){switch(S.shape){case"L-4x8":return{x:S.x+2,y:S.y+4};case"L-4x8-mirror":return{x:S.x-2+.5,y:S.y+4};case"C-4-8-4":return{x:S.x+2,y:S.y+4};case"L-5x6":return{x:S.x+2.5,y:S.y+3};case"L-5x6-mirror":return{x:S.x-2.5+.5,y:S.y+3};case"L-4x6":return{x:S.x+2,y:S.y+3};case"L-4x6-mirror":return{x:S.x-2+.5,y:S.y+3};default:return{x:S.x,y:S.y}}}$t();var g=lu(),p=A(E(g),2),_=E(p),M=E(_);Et(M,{title:"Deployment",children:(S,D)=>{var O=vt(),ie=Ne(O);{var z=de=>{var F=Kc(),B=E(F),te=E(B),G=A(B,2);V(()=>Ce(te,a().name)),J("click",G,m),L(de,F)},fe=de=>{var F=zc();ke(F,5,()=>to,He,(B,te)=>{var G=Gc(),ne=E(G);V(()=>Ce(ne,n(te).name)),J("click",G,()=>c(n(te))),L(B,G)}),L(de,F)};_e(ie,de=>{a()?de(z):de(fe,!1)})}L(S,O)},$$slots:{default:!0}});var C=A(M,2);Et(C,{title:"Terrain Layout",children:(S,D)=>{var O=vt(),ie=Ne(O);{var z=de=>{var F=jc(),B=E(F),te=E(B),G=A(B,2);V(()=>Ce(te,r())),J("click",G,f),L(de,F)},fe=de=>{var F=Jc(),B=E(F),te=A(E(B),2);ke(te,5,()=>yr,He,(P,N)=>{var W=Xc(),H=E(W);V(()=>Ce(H,n(N).name)),J("click",W,()=>u(n(N))),L(P,W)});var G=A(B,2);{var ne=P=>{var N=Qc(),W=A(E(N),2);ke(W,5,s,He,(H,K)=>{var re=Vc(),De=E(re);V(()=>Ce(De,n(K).name)),J("click",re,()=>d(n(K).name)),L(H,re)}),L(P,N)};_e(G,P=>{s().length>0&&P(ne)})}L(de,F)};_e(ie,de=>{r()?de(z):de(fe,!1)})}L(S,O)},$$slots:{default:!0}});var b=A(C,2);Et(b,{title:"Summary",children:(S,D)=>{var O=tu(),ie=E(O),z=A(E(ie),2),fe=E(z),de=A(ie,2),F=A(E(de),2),B=E(F),te=A(de,2);{var G=N=>{var W=Zc(),H=A(E(W),2),K=E(H);V(()=>Ce(K,a().objectives.length)),L(N,W)};_e(te,N=>{a()&&N(G)})}var ne=A(te,2);{var P=N=>{var W=eu(),H=A(E(W),2),K=E(H);V(()=>Ce(K,`${i().terrains.length??""} terrain, ${i().walls.length??""} walls`)),L(N,W)};_e(ne,N=>{(i().terrains.length>0||i().walls.length>0)&&N(P)})}V(()=>{Ce(fe,a()?.name||"None"),Ce(B,r()||"None")}),L(S,O)},$$slots:{default:!0}});var x=A(_,2),R=E(x),I=E(R);Ds(I,{children:(S,D)=>{var O=ou(),ie=Ne(O);{var z=F=>{var B=su(),te=Ne(B);ke(te,1,()=>a().zones,He,(ne,P)=>{var N=nu();V(W=>{T(N,"d",W),T(N,"fill",n(P).color),T(N,"stroke",n(P).borderColor)},[()=>Qs(n(P).path)]),L(ne,N)});var G=A(te);ke(G,1,()=>a().objectives,He,(ne,P)=>{const N=ze(()=>n(P).isPrimary?"#fbbf24":"#9ca3af"),W=ze(()=>n(P).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)");var H=au(),K=Ne(H),re=A(K),De=A(re);V(()=>{T(K,"cx",n(P).x),T(K,"cy",n(P).y),T(K,"r",Zi),T(K,"fill",n(W)),T(K,"stroke",n(N)),T(re,"cx",n(P).x),T(re,"cy",n(P).y),T(re,"r",Ji),T(re,"fill",n(N)),T(De,"cx",n(P).x),T(De,"cy",n(P).y)}),L(ne,H)}),L(F,B)};_e(ie,F=>{a()&&F(z)})}var fe=A(ie);ke(fe,1,()=>i().terrains,He,(F,B)=>{const te=ze(()=>n(B).x+n(B).width/2),G=ze(()=>n(B).y+n(B).height/2);var ne=ru(),P=E(ne);V(()=>{T(ne,"transform",`rotate(${n(B).rotation??""}, ${n(te)??""}, ${n(G)??""})`),T(P,"x",n(B).x),T(P,"y",n(B).y),T(P,"width",n(B).width),T(P,"height",n(B).height)}),L(F,ne)});var de=A(fe);ke(de,1,()=>i().walls,He,(F,B)=>{const te=ze(()=>y(n(B)));var G=iu(),ne=E(G);V(P=>{T(G,"transform",`rotate(${n(B).rotation??""}, ${n(te).x??""}, ${n(te).y??""})`),T(ne,"d",P)},[()=>h(n(B))]),L(F,G)}),L(S,O)},$$slots:{default:!0}}),L(e,g),Lt(),l()}function ao(){const{subscribe:e,set:t,update:a}=ot({past:[],future:[]});return{subscribe:e,push(r){a(s=>({past:[...s.past,r],future:[]}))},undo(){let r=null;return a(s=>{if(s.past.length===0)return s;const i=[...s.past];return r=i.pop(),{past:i,future:[r,...s.future]}}),r},redo(){let r=null;return a(s=>{if(s.future.length===0)return s;const i=[...s.future];return r=i.shift(),{past:[...s.past,r],future:i}}),r},canUndo(){return Ft({subscribe:e}).past.length>0},canRedo(){return Ft({subscribe:e}).future.length>0},clear(){t({past:[],future:[]})}}}const $n=ao(),Js=ao(),Ve=1/25.4,qt={circles:[{type:"25mm",radius:25*Ve/2,label:"25mm"},{type:"28.5mm",radius:28.5*Ve/2,label:"28mm.5"},{type:"32mm",radius:32*Ve/2,label:"32mm"},{type:"40mm",radius:40*Ve/2,label:"40mm"},{type:"50mm",radius:50*Ve/2,label:"50mm"},{type:"60mm",radius:60*Ve/2,label:"60mm"},{type:"80mm",radius:80*Ve/2,label:"80mm"},{type:"90mm",radius:90*Ve/2,label:"90mm"},{type:"100mm",radius:100*Ve/2,label:"100mm"},{type:"130mm",radius:130*Ve/2,label:"130mm"},{type:"160mm",radius:160*Ve/2,label:"160mm"}],ovals:[{type:"60x35.5mm",width:60*Ve,height:35.5*Ve,label:"60Ã35.5mm"},{type:"75x42mm",width:75*Ve,height:42*Ve,label:"75Ã42mm"},{type:"Small Flying Base",width:75*Ve,height:42*Ve,label:"Small Flying"},{type:"90x52.5mm",width:90*Ve,height:52.5*Ve,label:"90Ã52.5mm"},{type:"Large Flying Base",width:90*Ve,height:52.5*Ve,label:"Large Flying"},{type:"105x70mm",width:105*Ve,height:70*Ve,label:"105Ã70mm"},{type:"120x92mm",width:120*Ve,height:92*Ve,label:"120Ã92mm"},{type:"150x95mm",width:150*Ve,height:95*Ve,label:"150Ã95mm"},{type:"170x109mm",width:170*Ve,height:109*Ve,label:"170Ã109mm"}]};function Ja(e,t=null){const a=qt.circles.find(s=>s.type===e);if(a)return a;const r=qt.ovals.find(s=>s.type===e);return r||(br(e)&&t?{type:e,width:t.customWidth,height:t.customHeight,label:`${t.customWidth.toFixed(1)}"Ã${t.customHeight.toFixed(1)}"`}:null)}function Za(e){return qt.ovals.some(t=>t.type===e)}function br(e){return e&&e.startsWith("rect-")}function Br(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function so(e){const{subscribe:t,set:a,update:r}=ot([]);return{subscribe:t,set:a,update:r,add(s,i,o,l,c=null,u=!1){const d=Br(),f={id:d,baseType:s,playerId:i,x:o,y:l,rotation:0};return c&&c.width&&c.height&&(f.customWidth=c.width,f.customHeight=c.height),r(m=>[...m,f]),!u&&e&&e.push({type:"add",modelId:d,model:{...f}}),d},updateModel(s,i,o=!1){let l=null,c=null;if(!o&&e){const d=Ft({subscribe:t}).find(f=>f.id===s);d&&(l={...d},"x"in i||"y"in i?c="move":"rotation"in i&&(c="rotate"))}if(r(u=>u.map(d=>d.id===s?{...d,...i}:d)),!o&&e&&c&&l){const d=Ft({subscribe:t}).find(f=>f.id===s);e.push({type:c,modelId:s,before:c==="move"?{x:l.x,y:l.y}:{rotation:l.rotation},after:c==="move"?{x:d.x,y:d.y}:{rotation:d.rotation}})}},remove(s,i=!1){let o=null;!i&&e&&(o=Ft({subscribe:t}).find(c=>c.id===s)),r(l=>l.filter(c=>c.id!==s)),!i&&e&&o&&e.push({type:"remove",modelId:s,model:{...o}})},removeByPlayer(s){r(i=>i.filter(o=>o.playerId!==s))},addBatch(s,i=!1){const o=[];return r(l=>{const c=[...l];return s.forEach(u=>{const d=u.id||Br(),f={...u,id:d};c.push(f),o.push(d),!i&&e&&e.push({type:"add",modelId:d,model:{...f}})}),c}),o},updateUnit(s,i,o=!1){r(l=>l.map(c=>c.unitId===s?{...c,...i}:c))},removeUnit(s,i=!1){const o=[];if(!i&&e){const l=Ft({subscribe:t});o.push(...l.filter(c=>c.unitId===s))}r(l=>l.filter(c=>c.unitId!==s)),!i&&e&&o.forEach(l=>{e.push({type:"remove",modelId:l.id,model:{...l}})})},clear(){a([]),e&&e.clear()},undo(){if(!e)return;const s=e.undo();if(s)switch(s.type){case"add":this.remove(s.modelId,!0);break;case"remove":r(i=>[...i,s.model]);break;case"move":this.updateModel(s.modelId,s.before,!0);break;case"rotate":this.updateModel(s.modelId,s.before,!0);break}},redo(){if(!e)return;const s=e.redo();if(s)switch(s.type){case"add":r(i=>[...i,s.model]);break;case"remove":this.remove(s.modelId,!0);break;case"move":this.updateModel(s.modelId,s.after,!0);break;case"rotate":this.updateModel(s.modelId,s.after,!0);break}}}}const it=so($n),uu=Kt(it,e=>e.filter(t=>t.playerId===1)),mu=Kt(it,e=>e.filter(t=>t.playerId===2)),du=ot(null);Kt([it,du],([e,t])=>t?e.find(a=>a.id===t):null);const On=so(Js),Qn=ot(null);Kt([On,Qn],([e,t])=>t?e.find(a=>a.id===t):null);var hu=Me('<g><rect role="button" tabindex="0" class="svelte-hycs6b"></rect></g>'),fu=Me('<g><ellipse role="button" tabindex="0" class="svelte-hycs6b"></ellipse></g>'),yu=Me('<circle role="button" tabindex="0" class="svelte-hycs6b"></circle>'),pu=Me('<text text-anchor="middle" dominant-baseline="middle" font-weight="bold" fill="white" stroke="black" stroke-width="0.02" paint-order="stroke" pointer-events="none" class="model-name"> </text>'),vu=Me('<line stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-hycs6b"></circle>',1),gu=Me('<line stroke="#fbbf24" stroke-width="0.12" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.25" fill="#fbbf24" pointer-events="none" class="svelte-hycs6b"></circle><text text-anchor="middle" dominant-baseline="middle" font-size="0.5" font-weight="bold" fill="#fbbf24" stroke="#000" stroke-width="0.05" paint-order="stroke" pointer-events="none" class="drag-ruler-label svelte-hycs6b"> </text>',1),bu=Me("<g><!><!><!><!></g>");function as(e,t){It(t,!1);const a=$(),r=$(),s=$(),i=$(),o=$(),l=$(),c=$(),u=$(),d=$(),f=$(),m=$(),h=$(),y=$(),g=$(),p=$(),_=$(),M=$(),C=$(),b=$(),x=$(),R=$();let I=Re(t,"id",8),S=Re(t,"x",8),D=Re(t,"y",8),O=Re(t,"baseType",8),ie=Re(t,"playerId",8),z=Re(t,"rotation",8,0),fe=Re(t,"selected",8,!1),de=Re(t,"marqueePreview",8,!1),F=Re(t,"name",8,""),B=Re(t,"customWidth",8,null),te=Re(t,"customHeight",8,null),G=Re(t,"screenToSvg",8),ne=Re(t,"onSelect",8,()=>{}),P=Re(t,"onDrag",8,()=>{}),N=Re(t,"onDragEnd",8,()=>{}),W=Re(t,"onRotate",8,()=>{}),H=Re(t,"onRotateEnd",8,()=>{}),K=Re(t,"onRename",8,()=>{}),re=$(!1),De=!1,Xe={x:0,y:0},q=$(null),he=null;function Pe(ee){ee.stopPropagation(),ne()(I(),ee)}function le(ee){ee.stopPropagation();const oe=prompt("Model name:",F());oe!==null&&K()(I(),oe)}function mt(ee){if(ee.button!==0)return;ee.preventDefault(),ee.stopPropagation(),ne()(I(),ee),w(re,!0),w(q,{x:S(),y:D()});const oe=G()(ee.clientX,ee.clientY);Xe={x:oe.x-S(),y:oe.y-D()},window.addEventListener("mousemove",dt),window.addEventListener("mouseup",Je)}function dt(ee){if(!n(re))return;const oe=G()(ee.clientX,ee.clientY);let j=oe.x-Xe.x,Ee=oe.y-Xe.y;P()(I(),j,Ee)}function Je(){n(re)&&n(q)&&((n(q).x!==S()||n(q).y!==D())&&N()(I(),n(q).x,n(q).y,S(),D()),w(q,null)),w(re,!1),window.removeEventListener("mousemove",dt),window.removeEventListener("mouseup",Je)}function Fe(ee){ee.preventDefault(),ee.stopPropagation(),De=!0,he=z(),window.addEventListener("mousemove",bt),window.addEventListener("mouseup",ln)}function bt(ee){if(!De)return;const oe=G()(ee.clientX,ee.clientY),j=oe.x-S(),Ee=oe.y-D();let et=Math.atan2(Ee,j)*180/Math.PI+45;ee.shiftKey||(et=Math.round(et/15)*15),W()(I(),et)}function ln(){De&&he!==null&&(he!==z()&&H()(I(),he,z()),he=null),De=!1,window.removeEventListener("mousemove",bt),window.removeEventListener("mouseup",ln)}ue(()=>(ae(B()),ae(te())),()=>{w(a,{customWidth:B(),customHeight:te()})}),ue(()=>(ae(O()),n(a)),()=>{w(r,Ja(O(),n(a)))}),ue(()=>ae(O()),()=>{w(s,Za(O()))}),ue(()=>ae(O()),()=>{w(i,br(O()))}),ue(()=>ae(ie()),()=>{w(o,ie()===1?"#3b82f6":"#ef4444")}),ue(()=>ae(ie()),()=>{w(l,ie()===1?"rgba(59, 130, 246, 0.5)":"rgba(239, 68, 68, 0.5)")}),ue(()=>ae(ie()),()=>{w(c,ie()===1?"rgba(59, 130, 246, 0.3)":"rgba(239, 68, 68, 0.3)")}),ue(()=>(ae(fe()),ae(de())),()=>{w(u,fe()?.15:de()?.12:.1)}),ue(()=>(ae(fe()),n(o),ae(de()),n(c),n(l)),()=>{w(d,fe()?n(o):de()?n(c):n(l))}),ue(()=>n(r),()=>{w(f,n(r)?.radius||.5)}),ue(()=>n(r),()=>{w(m,n(r)?.width?n(r).width/2:0)}),ue(()=>n(r),()=>{w(h,n(r)?.height?n(r).height/2:0)}),ue(()=>(n(i),ae(B())),()=>{w(y,n(i)&&B()||0)}),ue(()=>(n(i),ae(te())),()=>{w(g,n(i)&&te()||0)}),ue(()=>(n(s),n(m),n(h),n(i),n(y),n(g)),()=>{w(p,n(s)?Math.max(n(m),n(h))+1:n(i)?Math.max(n(y),n(g))/2+1:0)}),ue(()=>(ae(S()),n(p),ae(z())),()=>{w(_,S()+n(p)*Math.cos((z()-45)*Math.PI/180))}),ue(()=>(ae(D()),n(p),ae(z())),()=>{w(M,D()+n(p)*Math.sin((z()-45)*Math.PI/180))}),ue(()=>(n(re),n(q),ae(S()),ae(D())),()=>{w(C,n(re)&&n(q)?Math.sqrt(Math.pow(S()-n(q).x,2)+Math.pow(D()-n(q).y,2)):0)}),ue(()=>(n(re),n(q),ae(S())),()=>{w(b,n(re)&&n(q)?(n(q).x+S())/2:0)}),ue(()=>(n(re),n(q),ae(D())),()=>{w(x,n(re)&&n(q)?(n(q).y+D())/2:0)}),ue(()=>(n(i),n(y),n(g),n(s),n(m),n(h),n(f)),()=>{w(R,n(i)?Math.min(n(y),n(g))*.2:n(s)?Math.min(n(m),n(h))*.4:n(f)*.5)}),Tn(),$t();var Zt=bu();let Z;var Se=E(Zt);{var Le=ee=>{var oe=hu(),j=E(oe);V(()=>{T(oe,"transform",`rotate(${z()??""}, ${S()??""}, ${D()??""})`),T(j,"x",S()-n(y)/2),T(j,"y",D()-n(g)/2),T(j,"width",n(y)),T(j,"height",n(g)),T(j,"fill",n(d)),T(j,"stroke",n(o)),T(j,"stroke-width",n(u))}),J("click",j,Pe),J("dblclick",j,le),J("mousedown",j,mt),L(ee,oe)},Ze=ee=>{var oe=vt(),j=Ne(oe);{var Ee=$e=>{var U=fu(),Ge=E(U);V(()=>{T(U,"transform",`rotate(${z()??""}, ${S()??""}, ${D()??""})`),T(Ge,"cx",S()),T(Ge,"cy",D()),T(Ge,"rx",n(m)),T(Ge,"ry",n(h)),T(Ge,"fill",n(d)),T(Ge,"stroke",n(o)),T(Ge,"stroke-width",n(u))}),J("click",Ge,Pe),J("dblclick",Ge,le),J("mousedown",Ge,mt),L($e,U)},et=$e=>{var U=yu();V(()=>{T(U,"cx",S()),T(U,"cy",D()),T(U,"r",n(f)),T(U,"fill",n(d)),T(U,"stroke",n(o)),T(U,"stroke-width",n(u))}),J("click",U,Pe),J("dblclick",U,le),J("mousedown",U,mt),L($e,U)};_e(j,$e=>{n(s)?$e(Ee):$e(et,!1)},!0)}L(ee,oe)};_e(Se,ee=>{n(i)?ee(Le):ee(Ze,!1)})}var Ke=A(Se);{var Y=ee=>{var oe=pu(),j=E(oe);V(()=>{T(oe,"x",S()),T(oe,"y",D()),T(oe,"font-size",n(R)),Ce(j,F())}),L(ee,oe)};_e(Ke,ee=>{F()&&ee(Y)})}var ge=A(Ke);{var xe=ee=>{var oe=vu(),j=Ne(oe),Ee=A(j);V(()=>{T(j,"x1",S()),T(j,"y1",D()),T(j,"x2",n(_)),T(j,"y2",n(M)),T(j,"stroke",n(o)),T(Ee,"cx",n(_)),T(Ee,"cy",n(M)),T(Ee,"fill",n(o)),T(Ee,"stroke",ie()===1?"#1d4ed8":"#b91c1c")}),J("mousedown",Ee,Fe),L(ee,oe)};_e(ge,ee=>{fe()&&(n(s)||n(i))&&ee(xe)})}var we=A(ge);{var Te=ee=>{var oe=gu(),j=Ne(oe),Ee=A(j),et=A(Ee),$e=E(et);V(U=>{T(j,"x1",(n(q),v(()=>n(q).x))),T(j,"y1",(n(q),v(()=>n(q).y))),T(j,"x2",S()),T(j,"y2",D()),T(Ee,"cx",(n(q),v(()=>n(q).x))),T(Ee,"cy",(n(q),v(()=>n(q).y))),T(et,"x",n(b)),T(et,"y",n(x)-.5),Ce($e,`${U??""}"`)},[()=>(n(C),v(()=>n(C).toFixed(2)))]),L(ee,oe)};_e(we,ee=>{n(re)&&n(q)&&n(C)>.1&&ee(Te)})}V(()=>Z=rn(Zt,0,"model-base svelte-hycs6b",null,Z,{selected:fe(),dragging:n(re)})),L(e,Zt),Lt()}var Tu=Me('<ellipse fill="none" stroke-width="2"></ellipse>'),xu=Me('<circle fill="none" stroke-width="2"></circle>'),_u=be('<button class="palette-item svelte-1urec28"><svg class="svelte-1urec28"><!></svg> <span class="label svelte-1urec28"> </span></button>');function Cs(e,t){It(t,!1);const a=$(),r=$(),s=$(),i=$(),o=$(),l=$();let c=Re(t,"baseSize",8),u=Re(t,"playerId",8),d=Re(t,"onDragStart",8,()=>{});const f=3;function m(b){b.button===0&&(b.preventDefault(),d()(c(),b))}ue(()=>ae(u()),()=>{w(a,u()===1?"#3b82f6":"#ef4444")}),ue(()=>ae(c()),()=>{w(r,c().width!==void 0)}),ue(()=>(n(r),ae(c())),()=>{w(s,n(r)?null:c().radius*f)}),ue(()=>(n(r),ae(c())),()=>{w(i,n(r)?c().width/2*f:null)}),ue(()=>(n(r),ae(c())),()=>{w(o,n(r)?c().height/2*f:null)}),ue(()=>(n(r),ae(c())),()=>{w(l,n(r)?Math.max(c().width,c().height)*f:c().radius*2*f)}),Tn(),$t();var h=_u(),y=E(h),g=E(y);{var p=b=>{var x=Tu();V(()=>{T(x,"cx",(n(l)+8)/2),T(x,"cy",(n(l)+8)/2),T(x,"rx",n(i)),T(x,"ry",n(o)),T(x,"stroke",n(a))}),L(b,x)},_=b=>{var x=xu();V(()=>{T(x,"cx",(n(l)+8)/2),T(x,"cy",(n(l)+8)/2),T(x,"r",n(s)),T(x,"stroke",n(a))}),L(b,x)};_e(g,b=>{n(r)?b(p):b(_,!1)})}var M=A(y,2),C=E(M);V(()=>{Pl(h,`border-color: ${n(a)??""}`),T(h,"title",(ae(c()),v(()=>c().label))),T(y,"width",n(l)+8),T(y,"height",n(l)+8),T(y,"viewBox",`0 0 ${n(l)+8} ${n(l)+8}`),Ce(C,(ae(c()),v(()=>c().label)))}),J("mousedown",h,m),L(e,h),Lt()}const ro="warhammer-imported-armies";function Su(){try{const e=localStorage.getItem(ro);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load army imports from storage:",e),[]}}function Ys(e){try{localStorage.setItem(ro,JSON.stringify(e))}catch(t){console.error("Failed to save army imports to storage:",t)}}function wu(){return"import-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Au(){const{subscribe:e,set:t,update:a}=ot(Su());return{subscribe:e,addImport(r,s,i,o){const l=wu(),c={id:l,name:r||"Unnamed Army",timestamp:Date.now(),rawText:s,parsedData:i,faction:i.FACTION_KEYWORD||"Unknown",totalPoints:i.TOTAL_ARMY_POINTS||"0pts",playerId:o};return a(u=>{const d=[...u,c];return Ys(d),d}),l},removeImport(r){a(s=>{const i=s.filter(o=>o.id!==r);return Ys(i),i})},getImport(r){return Ft({subscribe:e}).find(i=>i.id===r)||null},clear(){t([]),Ys([])}}}const Zs=Au();var Cu=be('<div class="error-message svelte-leqhjl"> </div>'),Eu=be('<div class="success-message svelte-leqhjl"> </div>'),Ru=be("<option> </option>"),Mu=be('<div class="army-import-panel svelte-leqhjl"><div class="form-group svelte-leqhjl"><label for="army-list-input" class="svelte-leqhjl">Paste Army List:</label> <textarea id="army-list-input" placeholder="Paste your army list here (GW App, WTC, ListForge formats supported)" rows="12" class="svelte-leqhjl"></textarea></div> <div class="button-group svelte-leqhjl"><button class="svelte-leqhjl"> </button> <button class="svelte-leqhjl">Clear</button></div> <!> <!> <div class="divider svelte-leqhjl"></div> <div class="form-group svelte-leqhjl"><label for="import-select" class="svelte-leqhjl">Load Previous Import:</label> <select id="import-select" class="svelte-leqhjl"><option>-- Select an import --</option><!></select> <button class="load-button svelte-leqhjl">Load</button></div></div>');function ku(e,t){It(t,!1);const a=()=>Qe(Zs,"$armyImports",r),[r,s]=Ya();let i=Re(t,"currentPlayer",8,1);const o=fr();let l=$(""),c=$(!1),u=$(""),d=$(""),f=$("");function m(){if(!n(l).trim()){w(u,"Please paste an army list");return}w(c,!0),w(u,""),w(d,""),o("parse",{text:n(l),playerId:i()})}function h(){if(!n(f))return;const N=Zs.getImport(n(f));N&&(w(l,N.rawText),w(d,`Loaded: ${N.name} (${N.faction}, ${N.totalPoints})`),w(u,""))}function y(){w(l,""),w(u,""),w(d,"")}function g(N){w(c,N)}function p(N){w(u,N),w(d,""),w(c,!1)}function _(N){w(d,N),w(u,""),w(c,!1)}function M(){w(l,"")}var C={setLoading:g,setError:p,setSuccess:_,clearText:M};$t();var b=Mu(),x=E(b),R=A(E(x),2),I=A(x,2),S=E(I),D=E(S),O=A(S,2),ie=A(I,2);{var z=N=>{var W=Cu(),H=E(W);V(()=>Ce(H,`â ï¸ ${n(u)??""}`)),L(N,W)};_e(ie,N=>{n(u)&&N(z)})}var fe=A(ie,2);{var de=N=>{var W=Eu(),H=E(W);V(()=>Ce(H,`â ${n(d)??""}`)),L(N,W)};_e(fe,N=>{n(d)&&N(de)})}var F=A(fe,4),B=A(E(F),2);V(()=>{n(f),Ri(()=>{n(c),a()})});var te=E(B);te.value=te.__value="";var G=A(te);ke(G,1,a,N=>N.id,(N,W)=>{var H=Ru(),K=E(H),re={};V(()=>{Ce(K,`${n(W),v(()=>n(W).name)??""} (${n(W),v(()=>n(W).faction)??""}, ${n(W),v(()=>n(W).totalPoints)??""})`),re!==(re=(n(W),v(()=>n(W).id)))&&(H.value=(H.__value=(n(W),v(()=>n(W).id)))??"")}),L(N,H)});var ne=A(B,2);V(N=>{R.disabled=n(c),S.disabled=N,Ce(D,n(c)?"Parsing...":"Parse Army List"),O.disabled=n(c),B.disabled=n(c),ne.disabled=n(c)||!n(f)},[()=>(n(c),n(l),v(()=>n(c)||!n(l).trim()))]),Ea(R,()=>n(l),N=>w(l,N)),J("click",S,m),J("click",O,y),Yi(B,()=>n(f),N=>w(f,N)),J("click",ne,h),L(e,b),Ga(t,"setLoading",g),Ga(t,"setError",p),Ga(t,"setSuccess",_),Ga(t,"clearText",M);var P=Lt(C);return s(),P}var Du=be("<option> </option>"),Iu=be('<tr><td class="unit-name svelte-1xyf33v"> </td><td class="quantity svelte-1xyf33v"> </td><td class="svelte-1xyf33v"><select class="svelte-1xyf33v"></select></td><td class="skip-cell svelte-1xyf33v"><input type="checkbox" class="svelte-1xyf33v"/></td></tr>'),Lu=be('<div class="dialog-overlay svelte-1xyf33v"><div class="dialog svelte-1xyf33v"><div class="dialog-header svelte-1xyf33v"><h3 class="svelte-1xyf33v">Unmatched Units</h3> <button class="close-button svelte-1xyf33v">&times;</button></div> <div class="dialog-content svelte-1xyf33v"><p class="info-text svelte-1xyf33v">The following units were not found in the database. Please select base sizes or skip them:</p> <div class="units-table svelte-1xyf33v"><table class="svelte-1xyf33v"><thead class="svelte-1xyf33v"><tr><th class="svelte-1xyf33v">Unit Name</th><th class="svelte-1xyf33v">Quantity</th><th class="svelte-1xyf33v">Base Size</th><th class="svelte-1xyf33v">Skip</th></tr></thead><tbody></tbody></table></div></div> <div class="dialog-footer svelte-1xyf33v"><button class="cancel-button svelte-1xyf33v">Cancel</button> <button class="import-button svelte-1xyf33v">Import Selected</button></div></div></div>');function Nu(e,t){It(t,!1);let a=Re(t,"unmatchedUnits",24,()=>[]),r=Re(t,"show",12,!1);const s=fr();let i=$({});const o=[...qt.circles.map(m=>({value:m.type,label:m.label})),...qt.ovals.map(m=>({value:m.type,label:m.label})),{value:"rect-custom",label:"Custom Rectangle (Vehicle)"}];function l(){const m=a().filter(h=>!n(i)[h.id]?.skip).map(h=>({unitName:h.unitName,quantity:h.quantity,baseType:n(i)[h.id]?.baseType||"32mm"}));s("import",{selected:m}),c()}function c(){r(!1),s("close")}ue(()=>ae(a()),()=>{w(i,{}),a().forEach(m=>{$s(i,n(i)[m.id]={baseType:"32mm",skip:!1})})}),Tn(),$t();var u=vt(),d=Ne(u);{var f=m=>{var h=Lu(),y=E(h),g=E(y),p=A(E(g),2),_=A(g,2),M=A(E(_),2),C=E(M),b=A(E(C));ke(b,5,a,S=>S.id,(S,D)=>{var O=Iu();let ie;var z=E(O),fe=E(z),de=A(z),F=E(de),B=A(de),te=E(B);V(()=>{n(i),Ri(()=>{n(D)})}),ke(te,5,()=>o,He,(P,N)=>{var W=Du(),H=E(W),K={};V(()=>{Ce(H,(n(N),v(()=>n(N).label))),K!==(K=(n(N),v(()=>n(N).value)))&&(W.value=(W.__value=(n(N),v(()=>n(N).value)))??"")}),L(P,W)});var G=A(B),ne=E(G);V(()=>{ie=rn(O,1,"svelte-1xyf33v",null,ie,{skipped:n(i)[n(D).id]?.skip}),Ce(fe,(n(D),v(()=>n(D).unitName))),Ce(F,(n(D),v(()=>n(D).quantity||"1x"))),te.disabled=(n(i),n(D),v(()=>n(i)[n(D).id]?.skip))}),Yi(te,()=>n(i)[n(D).id].baseType,P=>$s(i,n(i)[n(D).id].baseType=P)),wa(ne,()=>n(i)[n(D).id].skip,P=>$s(i,n(i)[n(D).id].skip=P)),L(S,O)});var x=A(_,2),R=E(x),I=A(R,2);J("click",p,c),J("click",R,c),J("click",I,l),J("click",y,S=>S.stopPropagation()),J("click",h,c),L(m,h)};_e(d,m=>{r()&&m(f)})}L(e,u),Lt()}const Qt=ot([]),Un=ot([]);function Fr(e,t){const a={};e.forEach(s=>{const i=s.unitId||"ungrouped";a[i]||(a[i]=[]),a[i].push(s)});const r=[];for(const s in a){const i=a[s],o=i[0];r.push({id:s,name:o.unitName||"Unknown Unit",playerId:o.playerId,modelIds:i.map(l=>l.id),importId:t})}Qt.update(s=>[...s,...e]),Un.update(s=>[...s,...r])}function Pu(e){const a=Ft(Un).find(r=>r.id===e);a&&(Qt.update(r=>r.filter(s=>!a.modelIds.includes(s.id))),Un.update(r=>r.filter(s=>s.id!==e)))}function $u(e,t=30,a=22){const s=Ft(Qt).filter(c=>e.includes(c.id));if(s.length===0)return;const i=2;let o=0,l=0;s.forEach((c,u)=>{const d={...c,x:t+o,y:a+l,inStaging:!1};it.update(f=>[...f,d]),o+=i,(u+1)%5===0&&(o=0,l+=i)}),Qt.update(c=>c.filter(u=>!e.includes(u.id))),Un.update(c=>c.map(u=>({...u,modelIds:u.modelIds.filter(d=>!e.includes(d))})).filter(u=>u.modelIds.length>0))}function Ou(){Qt.set([]),Un.set([])}Kt(Qt,e=>e.filter(t=>t.playerId===1));Kt(Qt,e=>e.filter(t=>t.playerId===2));Kt(Un,e=>e.filter(t=>t.playerId===1));Kt(Un,e=>e.filter(t=>t.playerId===2));var Wu=Me('<g class="unit-group"><rect fill="none" stroke-dasharray="0.3 0.2" opacity="0.6" cursor="pointer"></rect><text text-anchor="middle" font-size="0.5" font-weight="600" pointer-events="none"> </text><g class="remove-button svelte-1lpiqbg" cursor="pointer"><circle r="0.25" fill="#dc3545" opacity="0.8" class="svelte-1lpiqbg"></circle><line stroke="white" stroke-width="0.08"></line><line stroke="white" stroke-width="0.08"></line></g></g>');function Yu(e,t){It(t,!1);const a=$(),r=$(),s=$(),i=$();let o=Re(t,"unit",8),l=Re(t,"models",24,()=>[]),c=Re(t,"selected",8,!1),u=Re(t,"onclick",8,()=>{}),d=Re(t,"onremove",8,()=>{});function f(g){if(g.length===0)return{minX:0,minY:0,maxX:0,maxY:0,width:0,height:0};const p=g.map(x=>({x:x.x,y:x.y})),_=Math.min(...p.map(x=>x.x))-.5,M=Math.min(...p.map(x=>x.y))-.5,C=Math.max(...p.map(x=>x.x))+.5,b=Math.max(...p.map(x=>x.y))+.5;return{minX:_,minY:M,maxX:C,maxY:b,width:C-_,height:b-M}}ue(()=>(ae(l()),ae(o())),()=>{w(a,l().filter(g=>o().modelIds.includes(g.id)))}),ue(()=>n(a),()=>{w(r,f(n(a)))}),ue(()=>n(r),()=>{w(s,n(r).minX+n(r).width/2)}),ue(()=>n(r),()=>{w(i,n(r).minY-.3)}),Tn(),$t();var m=vt(),h=Ne(m);{var y=g=>{var p=Wu(),_=E(p),M=A(_),C=E(M),b=A(M),x=E(b),R=A(x),I=A(R);V(()=>{T(_,"x",(n(r),v(()=>n(r).minX))),T(_,"y",(n(r),v(()=>n(r).minY))),T(_,"width",(n(r),v(()=>n(r).width))),T(_,"height",(n(r),v(()=>n(r).height))),T(_,"stroke",c()?"#ffc107":"#adb5bd"),T(_,"stroke-width",c()?"0.15":"0.08"),T(M,"x",n(s)),T(M,"y",n(i)),T(M,"fill",c()?"#333":"#6c757d"),Ce(C,`${ae(o()),v(()=>o().name)??""} (${n(a),v(()=>n(a).length)??""})`),T(x,"cx",(n(r),v(()=>n(r).maxX-.3))),T(x,"cy",(n(r),v(()=>n(r).minY+.3))),T(R,"x1",(n(r),v(()=>n(r).maxX-.4))),T(R,"y1",(n(r),v(()=>n(r).minY+.2))),T(R,"x2",(n(r),v(()=>n(r).maxX-.2))),T(R,"y2",(n(r),v(()=>n(r).minY+.4))),T(I,"x1",(n(r),v(()=>n(r).maxX-.2))),T(I,"y1",(n(r),v(()=>n(r).minY+.2))),T(I,"x2",(n(r),v(()=>n(r).maxX-.4))),T(I,"y2",(n(r),v(()=>n(r).minY+.4)))}),J("click",_,function(...S){u()?.apply(this,S)}),J("click",b,S=>{S.stopPropagation(),d()()}),L(g,p)};_e(h,g=>{n(a),v(()=>n(a).length>0)&&g(y)})}L(e,m),Lt()}var Hu=Me('<line y1="0" y2="60" stroke="#2a2a2a" stroke-width="0.05"></line>'),Bu=Me('<line x1="0" x2="30" stroke="#2a2a2a" stroke-width="0.05"></line>'),Fu=Me('<text text-anchor="middle" font-size="0.4" fill="#6c757d" font-weight="600" pointer-events="none">STAGING</text>'),qu=Me("<!><!>",1),Uu=Me('<text x="15" y="30" text-anchor="middle" font-size="0.8" fill="#666">No models in staging</text>'),Ku=be('<div class="staging-area svelte-cjtwzf"><div class="staging-header svelte-cjtwzf"><h3 class="svelte-cjtwzf">Staging Area</h3> <div class="button-group svelte-cjtwzf"><button class="svelte-cjtwzf"> </button> <button class="svelte-cjtwzf"> </button> <button class="clear-button svelte-cjtwzf">Clear</button></div></div> <div class="staging-canvas svelte-cjtwzf"><svg viewBox="0 0 30 60" class="staging-svg svelte-cjtwzf"><rect x="0" y="0" width="30" height="60" fill="#1a1a1a" stroke="#444" stroke-width="0.1"></rect><!><!><!><!><!></svg></div></div>');function Gu(e,t){It(t,!1);const a=()=>Qe(Qt,"$stagingModels",s),r=()=>Qe(Un,"$stagingUnits",s),[s,i]=Ya(),o=fr();let l=$(new Set),c=$();function u(N,W){if(!n(c))return{x:0,y:0};const H=n(c).createSVGPoint();H.x=N,H.y=W;const K=H.matrixTransform(n(c).getScreenCTM().inverse());return{x:K.x,y:K.y}}function d(N){w(l,new Set([N]))}function f(N,W,H){Qt.update(K=>K.map(re=>re.id===N?{...re,x:W,y:H}:re))}function m(N){}function h(N,W){Qt.update(H=>H.map(K=>K.id===N?{...K,rotation:W}:K))}function y(N){}function g(N,W){Qt.update(H=>H.map(K=>K.id===N?{...K,unitName:W}:K))}function p(){o("deploy",{modelIds:a().map(N=>N.id)})}function _(){o("deploy",{modelIds:Array.from(n(l))})}function M(){confirm("Clear all models from staging area?")&&(Ou(),o("clear"))}function C(N){confirm("Remove this unit from staging?")&&Pu(N)}function b(N){const W=r().find(H=>H.id===N);W&&w(l,new Set(W.modelIds))}$t();var x=Ku(),R=E(x),I=A(E(R),2),S=E(I),D=E(S),O=A(S,2),ie=E(O),z=A(O,2),fe=A(R,2),de=E(fe),F=A(E(de));ke(F,0,()=>Array(16),He,(N,W,H)=>{var K=Hu();T(K,"x1",H*2),T(K,"x2",H*2),L(N,K)});var B=A(F);ke(B,0,()=>Array(31),He,(N,W,H)=>{var K=Bu();T(K,"y1",H*2),T(K,"y2",H*2),L(N,K)});var te=A(B);ke(te,1,r,N=>N.id,(N,W)=>{{let H=ze(()=>n(W).modelIds.every(K=>n(l).has(K)));Yu(N,{get unit(){return n(W)},get models(){return a()},get selected(){return n(H)},onclick:()=>b(n(W).id),onremove:()=>C(n(W).id)})}});var G=A(te);ke(G,1,a,N=>N.id,(N,W)=>{var H=qu(),K=Ne(H);{let Xe=ze(()=>n(W).name||n(W).unitName),q=ze(()=>n(l).has(n(W).id));as(K,{get id(){return n(W).id},get x(){return n(W).x},get y(){return n(W).y},get baseType(){return n(W).baseType},get playerId(){return n(W).playerId},get rotation(){return n(W).rotation},get name(){return n(Xe)},get customWidth(){return n(W).customWidth},get customHeight(){return n(W).customHeight},get selected(){return n(q)},screenToSvg:u,onSelect:d,onDrag:f,onDragEnd:m,onRotate:h,onRotateEnd:y,onRename:g})}var re=A(K);{var De=Xe=>{var q=Fu();V(()=>{T(q,"x",n(W).x),T(q,"y",n(W).y-1)}),L(Xe,q)};_e(re,Xe=>{n(W).inStaging&&Xe(De)})}L(N,H)});var ne=A(G);{var P=N=>{var W=Uu();L(N,W)};_e(ne,N=>{a().length===0&&N(P)})}ts(de,N=>w(c,N),()=>n(c)),V(()=>{S.disabled=n(l).size===0,Ce(D,`Deploy Selected (${n(l).size??""})`),O.disabled=a().length===0,Ce(ie,`Deploy All (${a().length??""})`),z.disabled=a().length===0}),J("click",S,_),J("click",O,p),J("click",z,M),L(e,x),Lt(),i()}function Fn(e){const t=e.match(/^\s*/);return t?t[0].length:0}function Q(e){return e?e.toLowerCase().replace(/\s+/g," ").trim():""}function Kn(e){const t=/^(?:(\d+)x?\s+)?(.*)/,a=e.trim().match(t);if(a){const r=a[1]?`${a[1]}x`:"1x";let s=a[2].trim();return s=s.replace(/^with\s+/i,"").trim(),{quantity:r,name:s}}return{quantity:"1x",name:e.trim()}}function on(e){return Array.isArray(e)&&e.sort((t,a)=>{const r=parseInt(String(t&&t.quantity||"1x").replace(/x/i,""),10)||1,s=parseInt(String(a&&a.quantity||"1x").replace(/x/i,""),10)||1;if(r!==s)return s-r;const i=t&&t.name?t.name.toString().toLowerCase():"",o=a&&a.name?a.name.toString().toLowerCase():"";return i<o?-1:i>o?1:0}),e}const pn={"World Eaters":"Chaos","Chaos Space Marines":"Chaos","Emperor's Children":"Chaos","Death Guard":"Chaos","Chaos Daemons":"Chaos","Chaos Knights":"Chaos","Thousand Sons":"Chaos","Space Marines":"Imperium","Iron Hands":"Space Marines",Salamanders:"Space Marines","Space Wolves":"Space Marines",Ultramarines:"Space Marines","White Scars":"Space Marines","Adepta Sororitas":"Imperium","Astra Militarum":"Imperium","Imperial Fists":"Space Marines","Dark Angels":"Space Marines","Blood Angels":"Space Marines","Raven Guard":"Space Marines","Black Templars":"Space Marines",Deathwatch:"Space Marines","Grey Knights":"Imperium","Imperial Knights":"Imperium","Adeptus Custodes":"Imperium","Adeptus Titanicus":"Imperium","Adeptus Mechanicus":"Imperium","Agents of the Imperium":"Imperium",Aeldari:"Xenos",Drukhari:"Xenos",Ynnari:"Xenos",Harlequins:"Xenos",Necrons:"Xenos",Orks:"Xenos",Tyranids:"Xenos","T'au Empire":"Xenos",Tau:"Xenos","T'au":"Xenos","Genestealer Cults":"Xenos","Leagues of Votann":"Xenos"};function ua(e){if(!e)return e;e.SUMMARY=e.SUMMARY||{};const t=e.SUMMARY;t.LIST_TITLE=t.LIST_TITLE||"",t.FACTION_KEYWORD&&(t.FACTION_KEYWORD=String(t.FACTION_KEYWORD).trim()),t.DETACHMENT&&(t.DETACHMENT=String(t.DETACHMENT).replace(/\u00A0/g," ").trim()),t.TOTAL_ARMY_POINTS&&(t.TOTAL_ARMY_POINTS=String(t.TOTAL_ARMY_POINTS).trim());const a=s=>{if(!s)return"";try{return s.toString().normalize("NFD").replace(new RegExp("\\p{M}","gu"),"").replace(/[\u2018\u2019\u201B\u2032]/g,"'").replace(/[^\w\s'\-]/g,"").toLowerCase().trim()}catch{return s.toString().toLowerCase().trim()}},r=t.FACTION_KEYWORD||null;if(r){const s=a(r);let i;for(const o of Object.keys(pn))if(a(o)===s){i=o;break}if(i){const o=r.toString().replace(/[\u2018\u2019\u201B\u2032]/g,"'").trim();t.DISPLAY_FACTION=`${pn[i]} - ${o}`}else t.DISPLAY_FACTION=t.DISPLAY_FACTION||r+(t.DETACHMENT?` - ${t.DETACHMENT}`:"")}else t.DETACHMENT?t.DISPLAY_FACTION=t.DISPLAY_FACTION||t.DETACHMENT:t.DISPLAY_FACTION=t.DISPLAY_FACTION||"";if(!t.FACTION_KEY){if(t.FACTION_KEYWORD)try{t.FACTION_KEY=t.FACTION_KEYWORD.toString().toLowerCase()}catch{t.FACTION_KEY=String(t.FACTION_KEYWORD).toLowerCase()}else if(t.DISPLAY_FACTION){const s=(t.DISPLAY_FACTION||"").split(" - ")[0];try{t.FACTION_KEY=s.toString().toLowerCase()}catch{t.FACTION_KEY=String(s).toLowerCase()}}}return e}function Vn(e,t,a,r,s="",i=!1,o="wargear"){if(!e)return;e.items=e.items||[];const l=Kn(String(t||"").trim()),c=l.quantity?String(l.quantity):"1x",u=l.name||"",d=Q(u);if(i){const m=String(a||""),h=String(s||"");if(Q(m)===Q(u)||h&&Q(h)===Q(u))return}const f=e.items.find(m=>Q(m.name||"")===d);if(f){const m=parseInt(String(f.quantity||"1x").replace(/x/i,""),10)||0,h=parseInt(String(c||"1x").replace(/x/i,""),10)||0;f.quantity=`${m+h}x`}else{const m=Q(u)==="warlord"?"special":o;e.items.push({quantity:c,name:u,items:[],type:m,nameshort:""})}}function zu(e,t){if(!e||!t)return;t.items=t.items||[];const a=e.trim(),r=a.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),o=Q(i);if((t.items||[]).some(f=>f&&f.type==="special"&&Q((f.name||"").replace(/^Enhancement:\s*/i,""))===o))return;const u=`E: ${i.split(/\s+/).map(f=>f[0]?f[0].toUpperCase():"").join("")}${s}`.trim(),d={quantity:"1x",name:`Enhancement: ${i}`,nameshort:u,items:[],type:"special"};t.items.push(d)}function ju(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(e))return t;const a=[];let r=0;const s=f=>/^(\d+)x?\s+/i.test(String(f||"").trim()),i=(f,m)=>{const h=String(f||"").trim();if(!h)return h;if(s(h)){const y=h.match(/^(\d+)x?\s+(.*)$/i);if(y){const g=parseInt(y[1],10)||1,p=y[2].trim();return`${Math.max(1,g*(parseInt(m,10)||1))}x ${p}`}return h}return`${m}x ${h}`};for(;r<e.length;r++){const m=(e[r]||"").trim();if(m){if(m.startsWith("+")||m.startsWith("&")){a.push(m);continue}break}}for(const f of a){if(f.startsWith("&")){const g=f.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);g&&(g[1].trim(),(g[3]||"").trim());continue}const h=f.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(h){const y=h[1].trim().toUpperCase(),g=h[2].trim();if(y==="FACTION KEYWORD"){const p=g.split(" - ");t.SUMMARY.FACTION_KEYWORD=p[p.length-1].trim()}else y==="DETACHMENT"?t.SUMMARY.DETACHMENT=g.replace(/\u00A0/g," "):y==="TOTAL ARMY POINTS"&&(t.SUMMARY.TOTAL_ARMY_POINTS=g)}}if(t.SUMMARY.LIST_TITLE="",t.SUMMARY&&t.SUMMARY.FACTION_KEYWORD){const f=t.SUMMARY.FACTION_KEYWORD,m=Object.keys(pn).find(y=>y.toLowerCase()===(f||"").toString().toLowerCase()),h=m?pn[m]:null;h?t.SUMMARY.DISPLAY_FACTION=`${h} - ${f}`:t.SUMMARY.DISPLAY_FACTION=f+(t.SUMMARY.DETACHMENT?` - ${t.SUMMARY.DETACHMENT}`:"");try{t.SUMMARY.FACTION_KEY=f.toString().toLowerCase()}catch{}}let o=null,l=null;const c=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,u=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;for(;r<e.length;r++){const f=e[r]||"",m=f.trim();if(!m)continue;if(/^Enhancement:\s*/i.test(m)){const _=m.replace(/^Enhancement:\s*/i,"").trim();l&&zu(_,l);continue}const h=m.match(c);if(h){const _=h[1],M=h[2]?`${h[2]}x`:"1x",C=(h[3]||"").trim(),b=parseInt(h[4],10)||0,x=h[5],R={quantity:M,name:C,points:b,items:[],isComplex:!1,nameshort:""};_?(t.CHARACTER.push(R),l=R):(t["OTHER DATASHEETS"]=t["OTHER DATASHEETS"]||[],t["OTHER DATASHEETS"].push(R)),o=R,x&&x.split(",").map(I=>I.trim()).filter(Boolean).forEach(I=>Vn(R,I,R.name,t.SUMMARY.FACTION_KEYWORD||"",R.name,!0));continue}const y=f.match(u);if(y){const _=y[1].trim(),M=_.match(/^(\d+)\s+with\s+(.*)$/i);if(M&&o){const x=parseInt(M[1],10)||1,R=M[2],I=o.items&&o.items.length>0?o.items[o.items.length-1]:o;R.split(",").map(S=>S.trim()).filter(Boolean).forEach(S=>{const D=i(S,x);Vn(I,D,I.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const C=_.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(C&&o){const x=C[1],R=C[2].trim(),I=C[3]||"",S={quantity:x,name:R,items:[],type:"subunit"};if(o.items=o.items||[],o.items.push(S),I){const D=I.match(/^(\d+)\s+with\s+(.*)$/i);if(D){const O=parseInt(D[1],10)||1;D[2].split(",").map(z=>z.trim()).filter(Boolean).forEach(z=>{const fe=i(z,O);Vn(S,fe,S.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)})}else I.split(",").map(O=>O.trim()).filter(Boolean).forEach(O=>Vn(S,O,S.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0))}continue}const b=_.match(/^(\d+x?)\s+(.*)$/i);if(b&&o){const x={quantity:b[1],name:b[2].trim(),items:[],type:"subunit"};o.items=o.items||[],o.items.push(x);continue}if(o){Vn(o,_,o.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0);continue}continue}const g=m.match(/^(\d+)\s+with\s+(.*)$/i);if(g&&o){const _=parseInt(g[1],10)||1,M=g[2],C=o.items&&o.items.length>0?o.items[o.items.length-1]:o;M.split(",").map(b=>b.trim()).filter(Boolean).forEach(b=>{const x=i(b,_);Vn(C,x,C.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const p=m.match(/^(.*?):\s*(.*)$/);if(p&&o){(p[2]||"").split(",").map(M=>M.trim()).filter(Boolean).forEach(M=>Vn(o,M,o.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0));continue}}const d=[...t.CHARACTER||[],...t["OTHER DATASHEETS"]||[]];for(const f of d){f&&Array.isArray(f.items)&&f.items.length>0&&on(f.items);const m=f&&Array.isArray(f.items)?f.items.filter(h=>h&&h.type==="subunit"):[];for(const h of m)h&&Array.isArray(h.items)&&h.items.length>0&&on(h.items)}return ua(t),t}function tn(e,t,a,r,s="",i=!1,o="wargear"){if(!e)return;e.items=e.items||[];const l=String(t||"").trim();if(/battlesuit support system|homing beacon|marker drone/i.test(l))try{Bt.push(`processing raw=${l} for target=${e&&e.name}`)}catch{}let c=l.split(",").map(b=>b.trim()).filter(Boolean);try{const b=new Set;c=c.filter(x=>{const R=Q(Ca(_n(x)));return b.has(R)?!1:(b.add(R),!0)})}catch{}try{/stealth shas'vre|stealth battlesuits/i.test((e&&e.name||"")+(s||"")+l)&&Bt.push(`splitParts target=${e&&e.name} top=${s} parts=${JSON.stringify(c)}`)}catch{}if(c.length>1){c.forEach(b=>tn(e,b,a,r,s,i,o));return}const u=Kn(l),d=u.quantity!==void 0&&u.quantity!==null;let f=d?String(u.quantity):"1x",m=u.name||"";try{m=Ca(_n(m))}catch{}const h=/battlesuit support system|homing beacon|marker drone/i;try{const b=m.toLowerCase();if(b.includes("battlesuit support system")||b.includes("homing beacon")||b.includes("marker drone"))try{Bt.push(`addItemToTarget target=${e&&e.name} raw=${l}`)}catch{}}catch{}const y=m.match(/^(\d+)x\s+(.*)$/i);if(y){const b=parseInt(y[1],10)||1,x=parseInt(String(f||"1x").replace(/x/i,""),10)||1;f=`${Math.max(1,x*b)}x`,m=y[2]}try{Bt.push(`PARSE_QTY name=${m} parsedQtyRaw=${String(u.quantity||"")} qtyToken=${f}`)}catch{}let g=(b=>isNaN(b)?1:b)(parseInt(String(f||"1x").replace(/x/i,""),10)),p=g;try{if(e&&e.type==="subunit"){const b=parseInt(String(e.quantity||"1x").replace(/[^0-9]/g,""),10)||1;try{Bt.push(`CALC_EFFECTIVE target=${e&&e.name} parentQty=${b} parsedQty=${g} hasExplicit=${d}`)}catch{}p=d?g:b;try{Bt.push(`EFFECTIVE_QTY target=${e&&e.name} effectiveQty=${p}`)}catch{}}}catch{}const _=m,M=Q(m);if(i){const b=String(a||""),x=String(s||"");if(Q(b)===Q(m)||x&&Q(x)===Q(m)){if(h.test(m))try{Bt.push(`SKIP matched unitname name=${m} ctx=${b} top=${x}`)}catch{}return}}const C=e.items.find(b=>Q(b.name||"")===M);if(C){const b=parseInt(String(C.quantity||"1x").replace(/x/i,""),10)||0,x=b+p;C.quantity=`${x}x`;try{Bt.push(`UPDATED existing name=${m} existing=${b} added=${p} new=${x} target=${e&&e.name}`)}catch{}}else{const b=Q(m)==="warlord"?"special":o;e.items.push({quantity:`${p}x`,name:_,items:[],type:b,nameshort:""});try{Bt.push(`PUSHED new name=${m} quantity=${p} target=${e&&e.name}`)}catch{}}}function _n(e){if(!e)return e;const t=e.toLowerCase();return t.includes("shield")&&t.includes("drone")?"Shield Drone":t.includes("marker")&&t.includes("drone")?"Marker Drone":t.includes("marker")&&t.includes("beacon")?"Homing Beacon":e}function Ca(e){return e&&e.split(/\s+/).map(t=>!t||/[A-Z]/.test(t.slice(1))?t:t[0].toUpperCase()+t.slice(1).toLowerCase()).join(" ")}function qr(e,t){if(!t)return`${e}x`;const a=String(t).trim(),r=a.match(/^(\d+)x\s+(.*)$/i);if(r){const s=parseInt(r[1],10)||1,i=r[2]||"";return`${Math.max(1,e*s)}x ${i}`}return`${e}x ${a}`}function Xu(e,t){if(!e||!t)return;t.items=t.items||[];const a=e.trim(),r=a.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),o=Q(i);if((t.items||[]).some(f=>{if(!f||!f.name)return!1;const m=String(f.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]+\)$/,"").trim();return Q(m)===o}))return;const u=`E: ${i.split(/\s+/).map(f=>f[0]?f[0].toUpperCase():"").join("")}${s}`.trim(),d={quantity:"1x",name:`Enhancement: ${i}`,nameshort:u,items:[],type:"special"};t.items.push(d)}function Vu(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(e))return t;const a=[];let r=0;for(;r<e.length;r++){const d=(e[r]||"").trim();if(d){if(d.startsWith("+")){a.push(d);continue}if(!d.startsWith("&"))break}}for(const u of a){const f=u.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(f){const m=f[1].trim().toUpperCase(),h=f[2].trim();if(m==="FACTION KEYWORD"){const y=h.split(" - ");t.SUMMARY.FACTION_KEYWORD=y[y.length-1].trim()}else m==="DETACHMENT"?t.SUMMARY.DETACHMENT=h.replace(/\u00A0/g," "):m==="TOTAL ARMY POINTS"&&(t.SUMMARY.TOTAL_ARMY_POINTS=h)}}if(t.SUMMARY.LIST_TITLE="",t.SUMMARY&&t.SUMMARY.FACTION_KEYWORD){const u=t.SUMMARY.FACTION_KEYWORD,d=Object.keys(pn).find(m=>m.toLowerCase()===(u||"").toString().toLowerCase()),f=d?pn[d]:null;f?t.SUMMARY.DISPLAY_FACTION=`${f} - ${u}`:t.SUMMARY.DISPLAY_FACTION=u+(t.SUMMARY.DETACHMENT?` - ${t.SUMMARY.DETACHMENT}`:"");try{t.SUMMARY.FACTION_KEY=u.toString().toLowerCase()}catch{}}const s=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,i=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;let o=null,l=null;for(;r<e.length;r++){const u=e[r]||"",d=u.trim();if(!d)continue;if(/^Enhancement:\s*/i.test(d)){const g=d.replace(/^Enhancement:\s*/i,"").trim();l&&Xu(g,l);continue}const f=d.match(s);if(f){const g=f[1],p=f[2]?`${f[2]}x`:"1x",_=(f[3]||"").trim(),M=parseInt(f[4],10)||0,C=f[5],b={quantity:p,name:_,points:M,items:[],isComplex:!1,nameshort:"",charId:g||null};g?(t.CHARACTER.push(b),l=b):(t["OTHER DATASHEETS"]=t["OTHER DATASHEETS"]||[],t["OTHER DATASHEETS"].push(b)),o=b,C&&C.split(",").map(x=>x.trim()).filter(Boolean).forEach(x=>tn(b,x,b.name,t.SUMMARY.FACTION_KEYWORD||"",b.name,!0));continue}const m=u.match(i);if(m){const g=m[1].trim(),p=g.match(/^(\d+)\s+with\s+(.*)$/i);if(p&&o){const C=parseInt(p[1],10)||1,b=p[2],x=o.items&&o.items.length>0?o.items[o.items.length-1]:o;try{Bt.push(`WITHMATCH unit=${o.name} target=${x&&x.name} n=${C} rest=${b}`)}catch{}b.split(",").map(R=>R.trim()).filter(Boolean).forEach(R=>{const S=Ca(_n(R));if(x&&x.type==="subunit"){try{Bt.push(`WITH->SUB target=${x.name} item=${S} n=${C}`)}catch{}tn(x,`${C}x ${S}`,x.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}else{try{Bt.push(`WITH->UNIT unit=${o.name} item=${S} n=${C}`)}catch{}tn(x,qr(C,S),x.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}});continue}const _=g.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(_&&o){const C=_[1],b=_[2].trim(),x=_[3]||"",R={quantity:C,name:b,items:[],type:"subunit",_parent:o};if(o.items=o.items||[],o.items.push(R),x){const I=x.match(/^(\d+)\s+with\s+(.*)$/i);I?I[2].split(",").map(D=>D.trim()).filter(Boolean).forEach(D=>{const O=_n(D);tn(R,O,R.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}):x.split(",").map(S=>S.trim()).filter(Boolean).forEach(S=>{const D=_n(S);tn(R,D,R.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)})}continue}const M=g.match(/^(\d+x?)\s+(.*)$/i);if(M&&o)if(o.charId){const C=M[1],b=M[2].trim();tn(o,`${C} ${b}`,o.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0);continue}else{const C={quantity:M[1],name:M[2].trim(),items:[],type:"subunit",_parent:o};o.items=o.items||[],o.items.push(C);continue}if(o){let C=g.split(",").map(x=>x.trim()).filter(Boolean);try{const x=o.items&&o.items.length>0?o.items[o.items.length-1]:null;x&&x.name&&(C=C.map(R=>{const I=R.match(/^(.*)\s*\(([^)]+)\)\s*$/);if(I){const S=I[1].trim();if(Q(S)===Q(x.name))return S}return R}))}catch{}try{const x=new Set;C=C.filter(R=>{const I=Q(Ca(_n(R)));return x.has(I)?!1:(x.add(I),!0)})}catch{}let b=o;if(o.items&&o.items.length>0){const x=o.items[o.items.length-1];x&&x.type==="subunit"&&(b=x)}C.forEach(x=>{const R=Ca(_n(x));tn(b,R,b.name||o.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}continue}const h=d.match(/^(\d+)\s+with\s+(.*)$/i);if(h&&o){const g=parseInt(h[1],10)||1,p=h[2],_=o.items&&o.items.length>0?o.items[o.items.length-1]:o;p.split(",").map(M=>M.trim()).filter(Boolean).forEach(M=>{const b=Ca(_n(M));_&&_.type==="subunit"?tn(_,`${g}x ${b}`,_.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0):tn(_,qr(g,b),_.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const y=d.match(/^(.*?):\s*(.*)$/);if(y&&o){(y[2]||"").split(",").map(p=>p.trim()).filter(Boolean).forEach(p=>{const _=_n(p);tn(o,_,o.name,t.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}}const c=[...t.CHARACTER||[],...t["OTHER DATASHEETS"]||[]];for(const u of c){u&&Array.isArray(u.items)&&u.items.length>0&&on(u.items);const d=u&&Array.isArray(u.items)?u.items.filter(f=>f&&f.type==="subunit"):[];for(const f of d)f&&Array.isArray(f.items)&&f.items.length>0&&on(f.items)}ua(t);try{t.SUMMARY._parseDebug=(Bt||[]).slice(0,200)}catch{}return t}const Bt=[];function gs(e){const t=Fn(e);if(t>0)return t;const a=(e||"").trim();return a.startsWith("â¦")||a.startsWith("+")?2:0}function bs(e){if(!e)return"";const t=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(e).split(/\s+/).map((a,r)=>{if(!a)return"";const s=a.toLowerCase();return r>0&&t.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function ba(e,t,a,r,s="",i=!1,o="wargear",l=1){if(!e)return;e.items=e.items||[];const c=Kn(String(t||"").trim()),u=c.quantity?String(c.quantity):"1x",d=c.name||"",f=Q(d);if(i){const h=String(a||""),y=String(s||"");if(Q(h)===Q(d)||y&&Q(y)===Q(d))return}const m=e.items.find(h=>Q(h.name||"")===f);if(m){const h=parseInt(String(m.quantity||"1x").replace(/x/i,""),10)||0,y=parseInt(String(u||"1x").replace(/x/i,""),10)||0;m.quantity=`${h+y}x`}else{const h=Q(d)==="warlord"?"special":o;e.items.push({quantity:u,name:d,items:[],type:h,nameshort:""})}}function Ur(e,t,a){if(!e||!t)return;t.items=t.items||[];const r=e.trim(),s=r.match(/\(([^)]+)\)$/),i=s?` (${s[1]})`:"",o=r.replace(/\s*\([^)]+\)$/,"").trim(),l=Q(o);if((t.items||[]).some(m=>m&&m.type==="special"&&Q((m.name||"").replace(/^Enhancement:\s*/i,""))===l))return;const d=`E: ${o.split(/\s+/).map(m=>m[0]?m[0].toUpperCase():"").join("")}${i}`.trim(),f={quantity:"1x",name:`Enhancement: ${o}`,nameshort:d,items:[],type:"special"};t.items.push(f)}function Qu(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=e.findIndex(m=>a.test((m||"").trim().toUpperCase()));let i=(r===-1?e.slice(0,0):e.slice(0,r)).map(m=>(m||"").trim()).filter(m=>m&&!m.startsWith("Exported with"));const o=i.findIndex(m=>m&&m.trim()!=="");if(o!==-1){const m=i[o],h=m.match(/^(.*?)\s*\((\s*\d+\s*(?:pts|points)\s*)\)\s*$/i);if(h){t.SUMMARY.LIST_TITLE=h[1].trim();const R=(h[2].match(/(\d+)/)||[])[1]||"";R&&(t.SUMMARY.TOTAL_ARMY_POINTS=`${R}pts`)}else t.SUMMARY.LIST_TITLE=m;const y=[];for(let R=o+1;R<i.length;R++){const I=i[R];I&&y.push(I)}const g=["Combat Patrol","Incursion","Strike Force","Onslaught"],p=R=>{if(!R||!/\(/.test(R))return!1;for(const I of g)if(new RegExp(I,"i").test(R))return!0;return!1},_=new Set(Object.values(pn).map(R=>(R||"").toString().toLowerCase())),M=y.filter(R=>!(!R||p(R)||_.has(R.toLowerCase())));let C=null,b=null;const x=Object.keys(pn).map(R=>R.toLowerCase());for(const R of M)x.includes((R||"").toString().toLowerCase())?C=R:b||(b=R);if(!C&&M.length>0&&(C=M[0],b=M.length>1?M[1]:b),C&&(t.SUMMARY.FACTION_KEYWORD=C),b&&(t.SUMMARY.DETACHMENT=b),C){const R=Object.keys(pn).find(S=>S.toLowerCase()===C.toLowerCase()),I=R?pn[R]:null;I?t.SUMMARY.DISPLAY_FACTION=`${I} - ${C}`:t.SUMMARY.DISPLAY_FACTION=C+(b?` - ${b}`:"");try{t.SUMMARY.FACTION_KEY=C.toString().toLowerCase()}catch{}}}const l=r===-1?0:r,c=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*$/i,u=/^\s*(?:â¢|\-|\+|â¦)\s*(.*)$/;let d=null;for(let m=l;m<e.length;m++){const y=(e[m]||"").trim();if(!y||y.startsWith("Exported with"))continue;if(a.test(y.toUpperCase())){d=/^CHARACTERS?/i.test(y)?"CHARACTER":"OTHER DATASHEETS";continue}const g=y.match(c);if(g){const p=g[1].trim(),_=parseInt(String(g[2]).replace(/[\,\.\s]/g,""),10)||0;let M="1x",C=p;const b=p.match(/^([0-9]+x?)\s+(.*)$/i);b&&(M=b[1].toLowerCase(),C=b[2].trim());const x={quantity:M,name:C,points:_,items:[],isComplex:!1,nameshort:""},R=d==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";t[R]=t[R]||[],t[R].push(x);const I=[];let S=m+1;for(;S<e.length;){const z=e[S]||"";if(!z.trim()||a.test(z.trim().toUpperCase())||c.test(z.trim())||!/^\s+/.test(z)&&!u.test(z))break;I.push(z),S++}const D=(()=>{for(let z=0;z<I.length;z++){const fe=I[z];if(!fe.match(u))continue;const F=gs(fe);for(let B=z+1;B<I.length;B++){const te=I[B];if(!te.trim()||gs(te)<=F)break;if(u.test(te))return!0}}return!1})();let O=null,ie=0;for(let z=0;z<I.length;z++){const fe=I[z],de=fe.trim(),F=fe.match(u),B=gs(fe);if(F){const te=F[1].trim(),G=te.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(te)){Ur(te.replace(/^Enhancement:\s*/i,"").trim(),x,t.SUMMARY.FACTION_KEYWORD||"");continue}else if(G){Ur(te.trim(),x,t.SUMMARY.FACTION_KEYWORD||"");continue}if(D){if(O&&typeof ie=="number"&&B>ie){ba(O,te,O.name,t.SUMMARY.FACTION_KEYWORD||"",x.name,!1);continue}if(!(()=>{for(let K=z+1;K<I.length;K++){const re=I[K];if(!re.trim()||gs(re)<=B)break;if(u.test(re))return!0}return!1})()){O=null,ba(x,te,x.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}O=null;const P=te.match(/^(\d+x?)\s+(.*)$/i),N=P?P[1]:"1x",W=P?P[2].trim():te,H={quantity:N,name:W,items:[],type:"subunit"};x.items=x.items||[],x.items.push(H),O=H,ie=B;continue}ba(x,te,x.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(O&&B>ie){ba(O,de,O.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}ba(x,de,x.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1)}m=S-1;continue}}function f(m,h){if(!(!m||typeof m!="object")){if(typeof m.name!="string"&&(m.name=""),typeof m.quantity!="string"&&(m.quantity=m.quantity?String(m.quantity):"1x"),typeof m.type!="string"&&(m.type=m.type||"wargear"),typeof m.nameshort!="string"&&(m.nameshort=m.nameshort||""),Array.isArray(m.items)||(m.items=[]),/^Enhancement:/i.test(m.name)){const y=m.name.replace(/^Enhancement:\s*/i,"").trim();m.type="special",m.nameshort=m.nameshort||(()=>{const g=y.match(/\(([^)]+)\)$/),p=g?` (${g[1]})`:"";return`E: ${y.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(C=>C[0]?C[0].toUpperCase():"").join("")}${p}`.trim()})(),m.name=`Enhancement: ${bs(y.replace(/\s*\([^)]+\)$/,"").trim())}`}else m.name=h?m.name:bs(m.name);Q(m.name)==="warlord"&&(m.type="special"),m.items=(m.items||[]).map(y=>{if(!y)return null;if(typeof y=="string"){const g={quantity:"1x",name:y.trim(),items:[],type:/^Enhancement:/i.test(y)?"special":"wargear",nameshort:""};return f(g,m.name),g.name&&(g.name=bs(g.name)),g}return f(y,m.name),y&&y.name&&(y.name=bs(y.name)),y}).filter(Boolean)}}for(const m of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(t[m]))for(const h of t[m]){f(h);const y=(h.items||[]).filter(g=>g&&g.type==="subunit");if(y.length>0)if(y.every(p=>Q(p.name||"")===Q(h.name||""))){const p=new Map;let _=0;for(const M of y){const C=parseInt(String(M.quantity||"1x").replace(/x/i,""),10)||1;_+=C;for(const b of M.items||[]){const x={items:[]};ba(x,`${b.quantity||"1x"} ${b.name}`,h.name,t.SUMMARY.FACTION_KEYWORD||"",b.type||"wargear",1);for(const R of x.items){const I=Q(R.name||"");if(p.has(I)){const S=p.get(I),D=parseInt(String(S.quantity||"1x").replace(/x/i,""),10)||0,O=parseInt(String(R.quantity||"1x").replace(/x/i,""),10)||0;S.quantity=`${D+O}x`}else p.set(I,R)}}}h.items=Array.from(p.values()),_>0&&(h.quantity=`${_}x`),h.isComplex=!1}else{const p=y.reduce((_,M)=>_+(parseInt(String(M.quantity||"1x").replace(/x/i,""),10)||0),0);p>0&&(h.quantity=`${p}x`),h.isComplex=!0}else h.isComplex=!1;Array.isArray(h.items)&&h.items.length>0&&on(h.items)}return ua(t),t}function Kr(e){if(!e)return"";const t=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(e).split(/\s+/).map((a,r)=>{if(!a)return"";const s=a.toLowerCase();return r>0&&t.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function Wn(e,t,a,r,s="",i=!1,o="wargear",l=1){if(!e)return;e.items=e.items||[];const c=Kn(String(t||"").trim()),u=c.quantity?String(c.quantity):"1x",d=parseInt(String(u||"1x").replace(/[^0-9]/g,""),10)||1,f=`${d*(l||1)}x`;let m=c.name||"";if(!i)try{const g=m.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(g){const p=g[1].trim(),_=g[2].trim(),M=Q(p),C=Q(a||""),b=Q(s||"");M&&(M===C||M===b||C.startsWith(M+" ")||b.startsWith(M+" ")||M.startsWith(C+" ")||M.startsWith(b+" "))&&(m=_)}}catch{}const h=Q(m);if(i){const g=String(a||""),p=String(s||""),_=Q(m),M=Q(g),C=Q(p),b=M&&_.startsWith(M+" "),x=C&&_.startsWith(C+" ");if(M&&(_===M||b)||C&&(_===C||x)){const R=m.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(R){const I=R[1].trim(),S=R[2].trim(),D=Q(I);if(D===M||D===C||D.startsWith(M+" ")||D.startsWith(C+" ")){if(e&&e._deferredParenthetical&&Q(e._deferredParenthetical)===Q(S)||e&&e._deferredParenthetical&&Q(e._deferredParenthetical)===Q(S)||(e.items||[]).some(ie=>Q(ie.name||"")===Q(S)))return;Wn(e,S,a,r,s,!1,o,d);return}}return}}const y=e.items.find(g=>Q(g.name||"")===h);if(y){const g=parseInt(String(y.quantity||"1x").replace(/x/i,""),10)||0,p=parseInt(String(f||"1x").replace(/x/i,""),10)||0;y.quantity=`${g+p}x`}else{const g=Q(m)==="warlord"?"special":o;e.items.push({quantity:f,name:m,items:[],type:g,nameshort:""})}}function er(e,t,a){if(!e||!t)return;t.items=t.items||[];const r=e.trim(),s=r.match(/\(([^)]+)\)$/),i=s?` (${s[1]})`:"",o=r.replace(/\s*\([^)]+\)$/,"").trim(),l=Q(o);if((t.items||[]).some(m=>m&&m.type==="special"&&Q((m.name||"").replace(/^Enhancement:\s*/i,""))===l))return;const d=`E: ${o.split(/\s+/).map(m=>m[0]?m[0].toUpperCase():"").join("")}${i}`.trim(),f={quantity:"1x",name:`Enhancement: ${o}`,nameshort:d,items:[],type:"special"};t.items.push(f)}function Gr(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*(?::\s*(.*))?$/i,s=/^\s*(?:â¢|\-|\+|â¦)\s*(.*)$/;let i=null;for(let l=0;l<e.length;l++){const u=(e[l]||"").trim();if(!u)continue;if(a.test(u.toUpperCase())){i=/^CHARACTERS?/i.test(u)?"CHARACTER":"OTHER DATASHEETS";continue}const d=u.match(r);if(d){const f=d[1].trim(),m=parseInt(String(d[2]).replace(/[\,\.\s]/g,""),10)||0;let h="1x",y=f;const g=f.match(/^([0-9]+x?)\s+(.*)$/i);g&&(h=g[1].toLowerCase(),y=g[2].trim());const p={quantity:h,name:y,points:m,items:[],isComplex:!1,nameshort:""},_=i==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";t[_]=t[_]||[],t[_].push(p);const M=d[3]||"";M&&M.split(",").map(S=>S.trim()).filter(Boolean).forEach(S=>Wn(p,S,p.name,t.SUMMARY.FACTION_KEYWORD||"",p.name,!0));const C=[];let b=l+1;for(;b<e.length;){const S=e[b]||"";if(!S.trim()||a.test(S.trim().toUpperCase())||r.test(S.trim())||!/^\s+/.test(S)&&!s.test(S))break;C.push(S),b++}const x=(()=>{for(let S=0;S<C.length;S++){const D=C[S];if(!D.match(s))continue;const ie=Fn(D);for(let z=S+1;z<C.length;z++){const fe=C[z];if(!fe.trim()||Fn(fe)<=ie)break;if(s.test(fe))return!0}}return!1})();let R=null,I=0;for(let S=0;S<C.length;S++){const D=C[S],O=D.trim(),ie=D.match(s),z=Fn(D);if(ie){const fe=ie[1].trim(),de=fe.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(fe)){er(fe.replace(/^Enhancement:\s*/i,"").trim(),p,t.SUMMARY.FACTION_KEYWORD||"");continue}else if(de){er(fe.trim(),p,t.SUMMARY.FACTION_KEYWORD||"");continue}if(x){if(R&&typeof I=="number"&&z>I){const ne=fe.split(",").map(P=>P.trim()).filter(Boolean);for(let P of ne){const N=P.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(N){const W=N[1].trim(),H=N[2].trim();if(Q(W)===Q(R.name)){const K=ne.some(q=>Q(q)===Q(H)),re=(R.items||[]).some(q=>Q(q.name||"")===Q(H));if(K||re)continue;const De=Kn(P),Xe=parseInt(String(De.quantity||"1x").replace(/[^0-9]/g,""),10)||1;Wn(R,H,R.name,t.SUMMARY.FACTION_KEYWORD||"",p.name,!1,"wargear",Xe);continue}}Wn(R,P,R.name,t.SUMMARY.FACTION_KEYWORD||"",p.name,!0)}continue}R=null;const F=fe.match(/^(\d+x?)\s+(.*)$/i),B=F?F[1]:"1x";let te=F?F[2].trim():fe;try{const ne=te.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(ne){const P=ne[1].trim(),N=ne[2].trim(),W=Q(P),H=Q(p.name||""),K=Q(unitTopName||p.name||"");if(W&&(W===H||H.startsWith(W)||W.startsWith(H)||K.startsWith(W)||W.startsWith(K))){te=P;const re={quantity:B,name:te,items:[],type:"subunit"};re._deferredParenthetical=N,re._deferredParentheticalQty=parseInt(String(B||"1x").replace(/[^0-9]/g,""),10)||1,p.items=p.items||[],p.items.push(re),R=re,I=z;continue}}}catch{}const G={quantity:B,name:te,items:[],type:"subunit"};p.items=p.items||[],p.items.push(G),R=G,I=z;continue}Wn(p,fe,p.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(R&&z>I){Wn(R,O,R.name,t.SUMMARY.FACTION_KEYWORD||"",p.name,!0);continue}Wn(p,O,p.name,t.SUMMARY.FACTION_KEYWORD||"","wargear",1)}l=b-1;continue}}function o(l,c){if(!(!l||typeof l!="object")){if(typeof l.name!="string"&&(l.name=""),typeof l.quantity!="string"&&(l.quantity=l.quantity?String(l.quantity):"1x"),typeof l.type!="string"&&(l.type=l.type||"wargear"),typeof l.nameshort!="string"&&(l.nameshort=l.nameshort||""),Array.isArray(l.items)||(l.items=[]),/^Enhancement:/i.test(l.name)){const u=l.name.replace(/^Enhancement:\s*/i,"").trim();l.type="special",l.nameshort=l.nameshort||(()=>{const d=u.match(/\(([^)]+)\)$/),f=d?` (${d[1]})`:"";return`E: ${u.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(y=>y[0]?y[0].toUpperCase():"").join("")}${f}`.trim()})(),l.name=`Enhancement: ${Kr(u.replace(/\s*\([^)]+\)$/,"").trim())}`}else l.name=c?l.name:Kr(l.name);Q(l.name)==="warlord"&&(l.type="special"),l.items=(l.items||[]).map(u=>{if(!u)return null;if(typeof u=="string"){const d={quantity:"1x",name:u.trim(),items:[],type:/^Enhancement:/i.test(u)?"special":"wargear",nameshort:""};return o(d,l.name),d}return o(u,l.name),u}).filter(Boolean)}}for(const l of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(t[l]))for(const c of t[l]){o(c);const u=(c.items||[]).filter(f=>f&&f.type==="subunit");if(u.length>0)if(u.every(m=>Q(m.name||"")===Q(c.name||""))){const m=new Map;let h=0;for(const y of u){const g=parseInt(String(y.quantity||"1x").replace(/x/i,""),10)||1;h+=g;for(const p of y.items||[]){const _={items:[]};Wn(_,`${p.quantity||"1x"} ${p.name}`,c.name,t.SUMMARY.FACTION_KEYWORD||"",p.type||"wargear",1);for(const M of _.items){const C=Q(M.name||"");if(m.has(C)){const b=m.get(C),x=parseInt(String(b.quantity||"1x").replace(/x/i,""),10)||0,R=parseInt(String(M.quantity||"1x").replace(/x/i,""),10)||0;b.quantity=`${x+R}x`}else m.set(C,M)}}}c.items=Array.from(m.values()),h>0&&(c.quantity=`${h}x`),c.isComplex=!1}else{const m=u.reduce((h,y)=>h+(parseInt(String(y.quantity||"1x").replace(/x/i,""),10)||0),0);m>0&&(c.quantity=`${m}x`),c.isComplex=!1}else c.isComplex=!1;if(Array.isArray(c.items)&&c.items.length===1&&c.items[0]&&c.items[0].type==="subunit"){const f=c.items[0];Array.isArray(f.items)&&f.items.length>0&&(c.items=f.items.slice(),c.isComplex=!1)}Array.isArray(c.items)&&c.items.length>0&&on(c.items);const d=(c.items||[]).filter(f=>f&&f.type==="subunit");for(const f of d)Array.isArray(f.items)&&f.items.length>0&&on(f.items)}return ua(t),t}function Ju(e){if(!Array.isArray(e))return Gr(e);const t=[];let a=0;for(;a<e.length;a++){const f=String(e[a]||"").trim();if(!f){t.push(f);continue}if(f.startsWith("+")||f.startsWith("&")){t.push(f);continue}break}const r=[],s={};for(const d of t){if(!d)continue;if(d.startsWith("&")){const y=d.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);y&&r.push({enh:y[1].trim(),target:(y[3]||"").trim(),charId:y[2]||null});continue}const m=d.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(m){const h=m[1].trim().toUpperCase(),y=m[2].trim();if(h==="ENHANCEMENT"){const g=y.match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);g?r.push({enh:g[1].trim(),target:(g[3]||"").trim(),charId:g[2]||null}):r.push({enh:y,target:null,charId:null})}else if(h==="FACTION KEYWORD"){const g=y.split(" - ");s.faction=g[g.length-1].trim()}else h==="DETACHMENT"?s.detachment=y.replace(/\u00A0/g," "):h==="TOTAL ARMY POINTS"&&(s.points=y)}}const i=e.slice(a),o=[];for(const d of i){if(!d){o.push(d);continue}let f=String(d);f=f.replace(/^\s*Char\d+:\s*/i,"");const m=f.match(/^(.*\))\s*:\s*(.+)$/);m?(o.push(m[1]),o.push("  â¢ "+m[2])):o.push(f)}const l=Gr(o);l.SUMMARY=l.SUMMARY||{},s.faction&&(l.SUMMARY.FACTION_KEYWORD=s.faction),s.detachment&&(l.SUMMARY.DETACHMENT=s.detachment),s.points&&(l.SUMMARY.TOTAL_ARMY_POINTS=s.points);const c=[...l.CHARACTER||[],...l["OTHER DATASHEETS"]||[]],u=d=>{const f=Q(String(d||""));for(const m of c){const h=m&&Array.isArray(m.items)?m.items:[];for(const y of h){if(!y||!y.name)continue;const g=String(y.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,"").trim();if(Q(g)===f)return!0}}return!1};for(const d of r){if(!d||!d.enh||u(d.enh))continue;let f=null;const m=h=>String(h||"").toLowerCase().replace(/[^a-z0-9 ]/g,"").trim();if(d.charId){const h=parseInt(String(d.charId).replace(/[^0-9]/g,""),10);!Number.isNaN(h)&&h>0&&Array.isArray(l.CHARACTER)&&l.CHARACTER[h-1]&&(f=l.CHARACTER[h-1])}!f&&d.target&&(f=c.find(h=>m(h.name).includes(m(d.target))||m(`${h.quantity} ${h.name}`).includes(m(d.target)))),!f&&c.length===1&&(f=c[0]),f&&er(d.enh,f,l.SUMMARY.FACTION_KEYWORD||"")}try{for(const d of["CHARACTER","OTHER DATASHEETS"]){const f=l[d];if(Array.isArray(f))for(const m of f)m&&typeof m=="object"&&Object.prototype.hasOwnProperty.call(m,"type")&&delete m.type}for(const d of["CHARACTER","OTHER DATASHEETS"]){const f=l[d];if(Array.isArray(f)){for(const m of f)if(!(!m||!Array.isArray(m.items))){for(const h of m.items.filter(y=>y&&y.type==="subunit"))if(h&&h._deferredParenthetical)try{delete h._deferredParenthetical,delete h._deferredParentheticalQty}catch{}}}}}catch{}return ua(l),l}function Zu(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(e))return t;const a=e.map(u=>String(u||"")).find(u=>u.trim()),r=e.findIndex(u=>String(u||"").trim());if(a){const u=a.split(/\s*-\s*/).map(d=>d.trim()).filter(Boolean);if(t.SUMMARY.FACTION_FAMILY=u[0]||"",t.SUMMARY.FACTION_KEYWORD=u[1]||"",u.length>=3){const f=u[u.length-1].match(/\[\s*(\d{2,5})\s*pts?\s*\]$/i);f?(t.SUMMARY.TOTAL_ARMY_POINTS=`${f[1]}pts`,u.length===3?t.SUMMARY.LIST_TITLE=u[2]:t.SUMMARY.LIST_TITLE=u.slice(2,u.length-1).join(" - ")):t.SUMMARY.LIST_TITLE=u.slice(2).join(" - ")}t.SUMMARY.DISPLAY_FACTION=a.trim()}for(let u=0;u<Math.min(e.length,40);u++){const d=String(e[u]||"").trim();if(!d)continue;const f=d.match(/^Detachment:\s*(.*)$/i);f&&(t.SUMMARY.DETACHMENT=f[1].trim());const m=d.match(/^TOTAL ARMY POINTS:\s*(.*)$/i);m&&(t.SUMMARY.TOTAL_ARMY_POINTS=m[1].trim());const h=d.match(/^FACTION KEYWORD:\s*(.*)$/i);h&&(t.SUMMARY.FACTION_KEYWORD=h[1].trim());const y=d.match(/^Battle Size:\s*(.*)$/i);y&&(t.SUMMARY.BATTLE_SIZE=y[1].trim());const g=d.match(/^#+\s*(?:\+{1,2}\s*)?(.*)\[\s*\d{2,5}\s*pts?\s*\]$/i);if(g&&!t.SUMMARY.LIST_TITLE){const p=g[1].trim();/Army\s+Roster/i.test(p)||/\+\+/.test(p)?t.SUMMARY.LIST_TITLE="":t.SUMMARY.LIST_TITLE=p}}if(!t.SUMMARY.FACTION_KEYWORD&&t.SUMMARY.DISPLAY_FACTION){const u=t.SUMMARY.DISPLAY_FACTION.split(" - ");u.length>=2?t.SUMMARY.FACTION_KEYWORD=u[1].trim():t.SUMMARY.FACTION_KEYWORD=t.SUMMARY.DISPLAY_FACTION.replace(/\s*\[.*$/,"").trim()}const s=/^(?:(\d+)x?\s+)?(.+?)\s*\[\s*(\d{1,4})\s*pts?\s*\]\s*(?::\s*(.*))?$/i,i=/^\s*(?:â¢|\-|\+)\s*(.*)$/;let o=null,l=null;for(let u=0;u<e.length;u++){const d=String(e[u]||""),f=d.trim();if(!f||u===r)continue;if(f.startsWith("#")){const y=f.match(/^#+\s*(.+?)\s*(?:\[\s*\d+\s*pts?\s*\])?$/i);if(y){const g=y[1].trim();/character|epic|hero|hq/i.test(g)?o="CHARACTER":o="OTHER DATASHEETS"}continue}const m=f.match(s);if(m){const y=m[1]?`${m[1]}x`:"1x",g=(m[2]||"").trim(),p=parseInt(m[3],10)||0,_=m[4]||"",M={quantity:y,name:g,points:p,items:[],isComplex:!1,nameshort:""};o||(o="OTHER DATASHEETS"),t[o]=t[o]||[],t[o].push(M),l=M,_&&_.split(",").map(C=>C.trim()).filter(Boolean).forEach(C=>{c(l,C,l.name,t.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}const h=d.match(i);if(h&&l){const y=h[1].trim(),g=y.match(/^(\d+)\s+with\s+(.*)$/i);if(g&&l){const M=parseInt(g[1],10)||1,C=g[2],b=l.items&&l.items.length>0?l.items[l.items.length-1]:l;C.split(",").map(x=>x.trim()).filter(Boolean).forEach(x=>c(b,`${M}x ${x}`,b.name,t.SUMMARY.FACTION_KEYWORD||"",l.name,!0));continue}const p=y.match(/^(\d+x?)\s+([^:]+):\s*(.*)$/i);if(p){const M=p[1];let C=p[2].trim();const b=p[3]||"";C=C.replace(/\s+w\/.*$/i,"").trim();const x={quantity:M,name:C,items:[],type:"subunit"};if(b){const R=b.match(/^(\d+)\s+with\s+(.*)$/i);if(R){const I=parseInt(R[1],10)||1;R[2].split(",").map(D=>D.trim()).filter(Boolean).forEach(D=>c(x,`${I}x ${D}`,x.name,t.SUMMARY.FACTION_KEYWORD||"",l.name,!0))}else b.split(",").map(I=>I.trim()).filter(Boolean).forEach(I=>c(x,I,x.name,t.SUMMARY.FACTION_KEYWORD||"",l.name,!0))}l.items=l.items||[],l.items.push(x);continue}const _=y.match(/^(\d+x?)\s+(.*)$/i);if(_&&l){let M=_[2].trim();M=M.replace(/\s+w\/.*$/i,"").trim();const C={quantity:_[1],name:M,items:[],type:"subunit"};l.items=l.items||[],l.items.push(C);continue}c(l,y,l.name,t.SUMMARY.FACTION_KEYWORD||"",l.name,!0);continue}}function c(u,d,f,m,h="",y=!1,g="wargear"){if(!u)return;u.items=u.items||[];const p=String(d||"").trim(),_=Kn(p),M=_.quantity?String(_.quantity):"1x",C=/^\s*\d+x?\s+/i.test(p);let b=_.name||"";const x=b.match(/^(.*?)\s*\(([^)]+)\)$/);if(x){const O=(x[1]||"").trim(),ie=(x[2]||"").trim();(/\bDrone\b/i.test(O)||/\bDrone\b/i.test(b))&&(b=ie)}const R=Q(b);if(y){const O=String(f||""),ie=String(h||"");if(Q(O)===Q(b)||ie&&Q(ie)===Q(b))return}const I=parseInt(String(M||"1x").replace(/x/i,""),10)||1;let S=I;if(u&&u.type==="subunit"){const O=parseInt(String(u.quantity||"1x").replace(/[^0-9]/g,""),10)||1;S=C?I:O}const D=u.items.find(O=>Q(O.name||"")===R);if(D){const O=parseInt(String(D.quantity||"1x").replace(/x/i,""),10)||0;D.quantity=`${O+S}x`}else{const O=Q(b)==="warlord"?"special":g;u.items.push({quantity:`${S}x`,name:b,items:[],type:O,nameshort:""})}}for(const u of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(t[u]))for(const d of t[u]){if(!d||!Array.isArray(d.items)||d.items.length===0)continue;if(d.items.filter(h=>h&&h.type==="subunit").length>1){const h=new Map,y=[];for(const g of d.items){if(!g||g.type!=="subunit"){y.push(g);continue}const p=Q(g.name||"");if(!h.has(p))h.set(p,{quantity:g.quantity||"1x",name:g.name,items:Array.isArray(g.items)?g.items.slice():[],type:"subunit"});else{const _=h.get(p),M=parseInt(String(_.quantity||"1x").replace(/[^0-9]/g,""),10)||0,C=parseInt(String(g.quantity||"1x").replace(/[^0-9]/g,""),10)||0;_.quantity=`${M+C}x`;const b=new Map;for(const x of _.items||[]){const R=Q(x&&x.name||"");R&&b.set(R,{quantity:x.quantity||"1x",name:x.name,items:[],type:x.type||"wargear",nameshort:x.nameshort||""})}for(const x of g.items||[]){const R=Q(x&&x.name||"");if(R)if(b.has(R)){const I=b.get(R),S=parseInt(String(I.quantity||"1x").replace(/[^0-9]/g,""),10)||0,D=parseInt(String(x.quantity||"1x").replace(/[^0-9]/g,""),10)||0;I.quantity=`${S+D}x`}else b.set(R,{quantity:x.quantity||"1x",name:x.name,items:[],type:x.type||"wargear",nameshort:x.nameshort||""})}_.items=Array.from(b.values())}}d.items=[...y,...Array.from(h.values())]}d&&Array.isArray(d.items)&&d.items.length>0&&on(d.items);const m=d&&Array.isArray(d.items)?d.items.filter(h=>h&&h.type==="subunit"):[];for(const h of m)h&&Array.isArray(h.items)&&h.items.length>0&&on(h.items)}return ua(t),t}function em(e,t=40){return(Array.isArray(e)?e:String(e||"").split(/\r?\n/)).slice(0,t)}function tm(e){const t=Array.isArray(e)?e:String(e||"").split(/\r?\n/),a=em(t,40),r=t.join(`
`),s={NRNR:{score:0,breakdown:{},maxScore:8},"WTC-Compact":{score:0,breakdown:{},maxScore:8},WTC:{score:0,breakdown:{},maxScore:8},GWAPP:{score:0,breakdown:{},maxScore:7},"NR-GW":{score:0,breakdown:{},maxScore:7},LF:{score:0,breakdown:{},maxScore:7}},i=a.some(F=>/-\s*\[\s*\d{2,5}\s*pts?\s*\]$/i.test(F)),o=a.some(F=>/^#{1,3}\s+/.test(F)),l=a.some(F=>/^\s*#?\s*\+\+\s*Army Roster\s*\+\+/i.test(F)),c=a.some(F=>/^\s*##\s+/.test(F)),u=/(.+?)\s*[\(\[]\s*([0-9]{1,4})\s*(?:pts|points)\s*[\)\]]/i,d=r.match(new RegExp(u.source,"g"))||[],f=r.match(/^[ \t]*(?:â¢|\-|\+)\s*(?:\d+x?)\s+[^:]+:/gmi)||[],m=r.match(/\b[A-Za-z0-9\-\'â ]+\s*\([^\)]+\)/g)||[],h=/(^|\n)\s*Char\d+:.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)\s*:\s*/i,y=(r.match(new RegExp(h.source,"gi"))||[]).length,g=a.some(F=>/^(List Name|Factions Used|Army Points|Detachment Rule):/i.test(F.trim())),p=a.some(F=>/-\s*\(\s*\d+\s*Points?\s*\)\s*$/i.test(F)),_=r.match(/^(Epic Hero|Epic Heroes|Character|Characters|Battleline|Infantry|Beast|Vehicle|Dedicated Transport|Other Datasheets):\s*$/gmi)||[],M=(r.match(/^\s*â¢\s*(?:E:|Enhancement:)/gmi)||[]).length,C=(r.match(/^\s*â¢\s+/gmi)||[]).length;g&&(s.LF.score+=4,s.LF.breakdown.headerKeys=4),p&&(s.LF.score+=4,s.LF.breakdown.titleLine=4),_.length>=2&&(s.LF.score+=3,s.LF.breakdown.sectionColons=_.length),C>5&&(s.LF.score+=1,s.LF.breakdown.bullets=C),M>0&&(s.LF.score+=1,s.LF.breakdown.enhancementLines=M),(g||p||_.length>=2)&&(s.NRNR.score-=1,s.WTC.score-=1,s["WTC-Compact"].score-=1,s.GWAPP.score-=1,s["NR-GW"].score-=3),i&&(s.NRNR.score+=2,s.NRNR.breakdown.titleWithBracketedPts=2),o&&(s.NRNR.score+=3,s.NRNR.breakdown.markdownHeading=3),l&&(s.NRNR.score+=2,s.NRNR.breakdown.armyRoster=2),c&&(s.NRNR.score+=1,s.NRNR.breakdown.doubleHashSections=1),d.length>=3&&(s.NRNR.score+=1,s.NRNR.breakdown.unitLines=1),f.length>0&&(s.NRNR.score+=1,s.NRNR.breakdown.bulletWithQty=f.length),m.length>0&&(s.NRNR.score+=.5,s.NRNR.breakdown.parenItem=m.length);const b=a.join(`
`);/^[ \t]*[+&]/m.test(b)&&(s["WTC-Compact"].score+=3,s["WTC-Compact"].breakdown.headerPlusAmp=3),/(FACTION KEYWORD|DETACHMENT|TOTAL ARMY POINTS)/i.test(b)&&(s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.headerKeys=2),d.length>=2&&(s["WTC-Compact"].score+=1,s["WTC-Compact"].breakdown.unitLines=1),y>0&&(s["WTC-Compact"].score+=5,s["WTC-Compact"].breakdown.inlineCharList=y),/^\s*[+&]/m.test(b)&&(s.WTC.score+=1,s.WTC.breakdown.headerPlusAmp=1),/NUMBER OF UNITS:/i.test(b)&&(s.WTC.score+=2,s.WTC.breakdown.numberOfUnits=2);const x=(r.match(/(^|\n)\s*Char\d+:/gi)||[]).length>0;x&&(s.WTC.score+=3,s.WTC.breakdown.charMarkers=3),(o||l||c)&&(s.WTC.score-=2,s.WTC.breakdown.nrnrPenalty=-2,s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.nrnrPenalty=-1);const R=(r.match(/^\s*\d+\s+with\s+/gmi)||[]).length;R>0&&(s.WTC.score+=2,s.WTC.breakdown.withLines=R,s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.withLines=R),a.some(F=>/^(?:CHARACTER|OTHER DATASHEETS|CHARACTERS)\s*$/.test((F||"").trim()))&&(s.WTC.score+=1,s.WTC.breakdown.sectionHeaders=1),x&&(s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.charMarkerPenalty=-1),y>0&&(s.WTC.score-=2,s.WTC.breakdown.compactInlinePenalty=-2);const I=/Exported with/i.test(r);(/Exported with/i.test(b)||I)&&(s.GWAPP.score+=6,s.GWAPP.breakdown.exportedWith=6),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS)\b/i.test(r)&&(s.GWAPP.score+=2,s.GWAPP.breakdown.sectionHeaders=2),/\(\s*\d+\s*(?:pts|points)\s*\)/i.test(b)&&(s.GWAPP.score+=1,s.GWAPP.breakdown.titleParenPts=1),I&&(s["NR-GW"].score-=4,s["NR-GW"].breakdown.gwappPenalty=-4),/^\s*Strike Force\s*\(\s*\d{2,5}\s*points\s*\)/mi.test(r)&&(s.GWAPP.score+=3,s.GWAPP.breakdown.strikeForce=3),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|DEDICATED TRANSPORTS)\b/i.test(r)&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.sectionHeaders=2);const S=(r.match(/^[ \t]*(?:â¢|\u2022|â¦|\-|\+)\s+/gmi)||[]).length;S>0&&!I&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.bulletCount=S),m.length>0&&!I&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.parenItem=m.length);const D=(r.match(/^[ \t]*(?:â¢|\u2022|â¦|\-|\+)\s*\d+x?\s+[A-Za-z0-9\-\'â]+/gmi)||[]).length;D>=3&&!x&&!I&&(s["NR-GW"].score+=3,s["NR-GW"].breakdown.bulletQty=D);const O=/^(?:\s*)\d+x?\s+.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)/i,ie=t.filter(F=>O.test(F)).length;if(ie>=2&&!x&&!I&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.unitLinesNoChar=ie),!x&&!I&&(D>=3||ie>=2)&&(s.WTC.score-=2,s.WTC.breakdown.nrGwPenalty=-2,s["WTC-Compact"].score-=2,s["WTC-Compact"].breakdown.nrGwPenalty=-2),(o||l)&&(s["NR-GW"].score-=1,s["NR-GW"].breakdown.nrnrPenalty2=-1),r.indexOf("â")!==-1)for(const F of Object.keys(s))s[F].score+=.5,s[F].breakdown=s[F].breakdown||{},s[F].breakdown.unicodeApostrophe=.5;const z={};for(const F of Object.keys(s)){const B=s[F],te=Math.max(0,Math.min(1,B.score/(B.maxScore||8)));z[F]={score:B.score,confidence:te,scoreBreakdown:B.breakdown}}const fe=Object.keys(z).sort((F,B)=>z[B].score-z[F].score)[0],de=z[fe]||{score:0,confidence:0};return{format:fe,confidence:de.confidence,score:de.score,scoreBreakdown:de.scoreBreakdown,all:z}}function io(e){const t=String(e||"").trim().match(/^(\d+)\s+(.*)$/);return t&&!/^\d+x\b/i.test(String(e||""))?`${t[1]}x ${t[2]}`:e}function oo(e){const t=String(e||"").trim().replace(/^E:\s*/i,"").replace(/^Enhancement:\s*/i,"").trim(),a=t.match(/\(([^)]*pts?[^)]*)\)\s*$/i),r=t.replace(/\s*\([^)]*\)\s*$/,"").trim(),i=`E: ${r.split(/\s+/).map(o=>o[0]?o[0].toUpperCase():"").join("")}${a?` (${a[1].trim()})`:""}`.trim();return{quantity:"1x",name:`Enhancement: ${r}`,nameshort:i,items:[],type:"special"}}function nm(e,t){if(!e)return;e.items=e.items||[];const a=io(String(t||"").trim());if(/^(E:|Enhancement:)/i.test(a)){const s=oo(a),i=Q(s.name.replace(/^Enhancement:\s*/i,""));(e.items||[]).some(l=>/^Enhancement:/i.test(l.name||"")&&Q(String(l.name).replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,""))===i)||e.items.push(s);return}const r=a.split(",").map(s=>s.trim()).filter(Boolean);for(const s of r){const i=Kn(s.replace(/^with\s+/i,"")),o=i.quantity||"1x",l=i.name||"";if(!l)continue;const c=Q(l),u=e.items.find(d=>Q(d.name||"")===c);if(u){const d=parseInt(String(u.quantity||"1x").replace(/[^0-9]/g,""),10)||0,f=parseInt(String(o).replace(/[^0-9]/g,""),10)||0;u.quantity=`${d+f}x`}else e.items.push({quantity:o,name:l,items:[],type:"wargear",nameshort:""})}}function am(e,t){const a=e[t]||"",r=Fn(a);for(let s=t+1;s<e.length;s++){const i=e[s]||"";if(!i.trim())continue;const o=Fn(i),l=/^\s*â¢\s*/.test(i);return o>r&&l}return!1}function sm(e){const t={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(e))return t;const a=e.slice(0,30).map(m=>String(m||""));let r=!1;for(const m of a){const h=m.match(/^\s*([A-Za-z ][A-Za-z ]*):\s*(.*)$/);if(!h)continue;const y=h[1].trim().toLowerCase(),g=h[2].trim();if(y==="list name"&&(t.SUMMARY.LIST_TITLE=g,r=!0),y==="factions used"&&(t.SUMMARY.FACTION_KEYWORD=g,r=!0),y==="army points"){const p=parseInt(g.replace(/[^0-9]/g,""),10);p&&(t.SUMMARY.TOTAL_ARMY_POINTS=`${p}pts`,r=!0)}y==="detachment rule"&&(t.SUMMARY.DETACHMENT=g,r=!0)}if(!r){const m=e.find(h=>String(h||"").trim());if(m){const h=String(m).match(/^(.*?)\s*-\s*(.*?)\s*-\s*(.*?)\s*\((\d+)\s*Points?\)/i);h&&(t.SUMMARY.LIST_TITLE=h[1].trim(),t.SUMMARY.FACTION_KEYWORD=h[2].trim(),t.SUMMARY.DETACHMENT=h[3].trim(),t.SUMMARY.TOTAL_ARMY_POINTS=`${parseInt(h[4],10)}pts`)}}const s=/^\s*([A-Za-z ]+):\s*$/,i=/^\s*(.*?)\s*\((\d+)\s*pts?\)\s*$/i,o=/^\s*â¢\s*(.*)$/;let l=null;const c=[];for(let m=0;m<e.length;m++){const h=String(e[m]||"");if(!h.trim())continue;const g=h.match(s);if(g){const R=g[1].trim().toLowerCase();l=/hero|character/.test(R)?"CHARACTER":"OTHER DATASHEETS",c.length=0;continue}const p=h.match(i);if(p&&Fn(h)===0){const R=p[1].trim(),I=parseInt(p[2],10)||0,S={quantity:"1x",name:R,points:I,items:[],isComplex:!1,nameshort:""},D=l==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";t[D]=t[D]||[],t[D].push(S),c.length=0,c.push({indent:0,node:S});continue}const _=h.match(o);if(!_)continue;const M=_[1].trim(),C=Fn(h);for(;c.length>0&&C<=c[c.length-1].indent;)c.pop();const b=c.length>0?c[c.length-1].node:null;if(!b||/^B:\s*/i.test(M))continue;if(/^(E:|Enhancement:)/i.test(M)){const R=oo(M),I=c[0]?c[0].node:b;I.items=I.items||[],(I.items||[]).some(D=>/^Enhancement:/i.test(D.name||"")&&Q(D.name)===Q(R.name))||I.items.push(R);continue}if(am(e,m)){const R=Kn(io(M));let I=R.name||"";I=I.replace(/\s+w\/.*$/i,"").trim();const S={quantity:R.quantity||"1x",name:I,items:[],type:"subunit"};b.items=b.items||[],b.items.push(S),c.push({indent:C,node:S});continue}nm(b,M)}function u(m){const h=parseInt(String(m||"1x").replace(/[^0-9]/g,""),10);return Number.isFinite(h)&&h>0?h:1}for(const m of["CHARACTER","OTHER DATASHEETS"]){const h=t[m]||[];for(const y of h){const g=Array.isArray(y.items)?y.items:[],p=g.filter(b=>b&&b.type==="subunit");if(p.length<=1)continue;const _=new Map;for(const b of p){const x=Q((b.name||"").replace(/\s+w\/.*/i,"").trim());_.has(x)||_.set(x,{name:b.name,qty:0,wargear:new Map});const R=_.get(x);R.qty+=u(b.quantity);const I=Array.isArray(b.items)?b.items:[];for(const S of I){const D=Q(S.name||""),O=R.wargear.get(D)||{name:S.name,qty:0,type:S.type||"wargear"};O.qty+=u(S.quantity),R.wargear.has(D),R.wargear.set(D,O)}}const M=g.filter(b=>!(b&&b.type==="subunit")),C=[];for(const[,b]of _){const x={quantity:`${b.qty}x`,name:b.name,items:[],type:"subunit"};for(const[,R]of b.wargear)x.items.push({quantity:`${R.qty}x`,name:R.name,items:[],type:R.type||"wargear",nameshort:""});C.push(x)}y.items=[...M,...C]}}const d=t.SUMMARY&&t.SUMMARY.FACTION_KEYWORD?String(t.SUMMARY.FACTION_KEYWORD).trim():"";function f(m){if(!m||!d)return m;const h=new RegExp("^"+d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\s+","i");return String(m).replace(h,"").trim()}if(d)for(const m of["CHARACTER","OTHER DATASHEETS"]){const h=t[m]||[];for(const y of h){y.name=f(y.name);const g=(y.items||[]).filter(p=>p&&p.type==="subunit");for(const p of g)p.name=f(p.name)}}for(const m of["CHARACTER","OTHER DATASHEETS"]){const h=t[m]||[];for(const y of h){Array.isArray(y.items)&&y.items.length>0&&on(y.items);const g=(y.items||[]).filter(p=>p&&p.type==="subunit");for(const p of g)Array.isArray(p.items)&&p.items.length>0&&on(p.items)}}return ua(t),t}function rm(e){try{const t=tm(e).format;return t==="NRNR"?"NRNR":t==="WTC-Compact"?"WTC_COMPACT":t==="WTC"?"WTC":t==="GWAPP"?"GW_APP":t==="NR-GW"?"NR_GW":t==="LF"?"LF":"UNKNOWN"}catch{const a=Array.isArray(e)?e.slice(0,25):[],r=a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i)||/^\s*\+\s*DETACHMENT:/i.test(i)),s=a.some(i=>/^(?:CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i.test((i||"").trim().toUpperCase()));return r&&s?"NR_GW":a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i))?"WTC_COMPACT":s?"GW_APP":"UNKNOWN"}}async function im(e){if(!e||typeof e!="string")throw new Error("Invalid army list text");const t=e.split(`
`),a=rm(t);if(a==="UNKNOWN")throw new Error("Unable to detect army list format. Supported formats: GW App, WTC, WTC Compact, NR-GW, NR-NR, ListForge");let r;try{switch(a){case"GW_APP":r=Qu(t);break;case"WTC":r=Vu(t);break;case"WTC_COMPACT":r=ju(t);break;case"NR_GW":r=Ju(t);break;case"NRNR":r=Zu(t);break;case"LF":r=sm(t);break;default:throw new Error(`Unsupported format: ${a}`)}}catch(i){throw console.error("Parse error:",i),new Error(`Failed to parse ${a} format: ${i.message}`)}const s=om(r);return{format:a,data:s}}function om(e,t){const a=e.SUMMARY||{},r=[],s=["CHARACTER","CHARACTERS","BATTLELINE","OTHER DATASHEETS","ALLIED UNITS","DEDICATED TRANSPORTS"];for(const i of s)e[i]&&Array.isArray(e[i])&&r.push(...e[i].map(o=>({...o,section:i})));return{FACTION_KEYWORD:a.FACTION_KEYWORD||a.FACTION_KEY||"Unknown",DETACHMENT:a.DETACHMENT||"",TOTAL_ARMY_POINTS:a.TOTAL_ARMY_POINTS||"0pts",LIST_TITLE:a.LIST_TITLE||"",UNITS:r}}function lm(e){if(!e)return 1;const t=String(e).match(/(\d+)/);return t?parseInt(t[1],10):1}const cm={Asurmen:{baseType:"40mm"},Autarch:{baseType:"32mm"},"Autarch wayleaper":{baseType:"32mm"},"Avatar of Khaine":{baseType:"80mm"},Baharroth:{baseType:"40mm"},"Corsair Voidreavers":{baseType:"28.5mm"},"Corsair Voidscarred":{baseType:"28.5mm"},"Crimson Hunter":{baseType:"120x92mm"},"D-cannon Platform":{baseType:"40mm"},"Dark Reapers":{baseType:"28.5mm"},"Death Jester":{baseType:"25mm"},"Dire Avengers":{baseType:"28.5mm"},"Eldrad Ulthran":{baseType:"32mm"},Falcon:{baseType:"Large Flying Base"},Farseer:{baseType:"25mm"},"Farseer Skyrunner":{baseType:"Small Flying Base"},"Fire Dragons":{baseType:"28.5mm"},"Fire Prism":{baseType:"Large Flying Base"},Fuegan:{baseType:"40mm"},"Guardian Defenders":{baseType:"28.5mm"},"Guardian Defenders: Heavy Weapon Platform":{baseType:"40mm"},"Hemlock Wraithfighter":{baseType:"120x92mm"},"Howling Banshees":{baseType:"28.5mm"},"Jain Zar":{baseType:"40mm"},Lhykhis:{baseType:"40mm"},"Maugan Ra":{baseType:"40mm"},"Night Spinner":{baseType:"Large Flying Base"},Rangers:{baseType:"28.5mm"},"Shadow Weaver Platform":{baseType:"40mm"},Shadowseer:{baseType:"25mm"},"Shining Spears":{baseType:"Large Flying Base"},"Shroud Runners":{baseType:"Large Flying Base"},Skyweavers:{baseType:"Large Flying Base"},Solitaire:{baseType:"25mm"},Spiritseer:{baseType:"25mm"},Starweaver:{baseType:"Large Flying Base"},"Storm Guardians":{baseType:"28.5mm"},"Storm Guardians: Serpentâs Scale Platform":{baseType:"40mm"},"Striking Scorpions":{baseType:"28.5mm"},"Swooping Hawks":{baseType:"28.5mm"},"The Visarch":{baseType:"32mm"}},um={"Corvus Blackstar":{baseType:"120x92mm"},"Deathwatch Terminator Squad":{baseType:"40mm"},"Deathwatch Veterans":{baseType:"32mm"},"Fortis Kill Team":{baseType:"32mm"},"Indomitor Kill Team":{baseType:"40mm"},"Spectrus Kill Team":{baseType:"32mm"},"Spectrus Kill Team: Kill Team Infiltrators with bolt sniper rifles":{baseType:"40mm"},"Talonstrike Kill Team":{baseType:"32mm"},"Talonstrike Kill Team: Kill Team Heavy Intercessors with Jump Packs":{baseType:"40mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},mm={Archon:{baseType:"25mm"},Beastmaster:{baseType:"Small Flying Base"},"Beastmaster: Clawed Fiends, Khymerae, Razorwing Flocks":{baseType:"40mm"},"Court of the Archon: Sslyth":{baseType:"40mm"},"Court of the Archon: Ur-Ghul, Lhamaean, Medusae":{baseType:"25mm"},Cronos:{baseType:"Large Flying Base"},Drazhar:{baseType:"40mm"},Grotesques:{baseType:"40mm"},Haemonculus:{baseType:"25mm"},Hellions:{baseType:"Small Flying Base"},Incubi:{baseType:"28.5mm"},"Kabalite Warriors":{baseType:"25mm"},"Lelith Hesperax":{baseType:"32mm"},Mandrakes:{baseType:"28.5mm"},Raider:{baseType:"Large Flying Base"},Ravager:{baseType:"Large Flying Base"},"Razorwing Jetfighter":{baseType:"120x92mm"},Reavers:{baseType:"Small Flying Base"},Scourges:{baseType:"32mm"},Succubus:{baseType:"25mm"},Talos:{baseType:"Large Flying Base"},"Urien Rakarth":{baseType:"25mm"},Venom:{baseType:"Large Flying Base"},"Voidraven Bomber":{baseType:"120x92mm"},Wracks:{baseType:"25mm"},Wyches:{baseType:"25mm"}},dm={"Annihilation Barge":{baseType:"Large Flying Base"},"Câtan Shard of the Deceiver":{baseType:"40mm"},"Câtan Shard of the Nightbringer":{baseType:"40mm"},"Câtan Shard of the Void Dragon":{baseType:"80mm"},"Canoptek Doomstalker":{baseType:"90mm"},"Canoptek Reanimator":{baseType:"60mm"},"Canoptek Scarab Swarms":{baseType:"40mm"},"Canoptek Spyders":{baseType:"60mm"},"Canoptek Wraiths":{baseType:"50mm"},"Catacomb Command Barge":{baseType:"Large Flying Base"},Chronomancer:{baseType:"40mm"},"Convergence of Dominion":{baseType:"hull",hullDimensions:{width:0,height:0}},Cryptothralls:{baseType:"32mm"},Deathmarks:{baseType:"32mm"},"Doom Scythe":{baseType:"120x92mm"},"Doomsday Ark":{baseType:"Large Flying Base"},"Flayed Ones":{baseType:"28.5mm"},"Ghost Ark":{baseType:"Large Flying Base"},"Hexmark Destroyer":{baseType:"50mm"},"Illuminor Szeras":{baseType:"80mm"},Immortals:{baseType:"32mm"},"Imotekh the Stormlord":{baseType:"40mm"},"Lokhust Destroyers":{baseType:"Large Flying Base"},"Lokhust Heavy Destroyers":{baseType:"60mm"},"Lokhust Lord":{baseType:"Large Flying Base"},Lychguard:{baseType:"32mm"},Monolith:{baseType:"160mm"},"Necron Warriors":{baseType:"32mm"},"Night Scythe":{baseType:"120x92mm"},Obelisk:{baseType:"120x92mm"},"Ophydian Destroyers":{baseType:"50mm"},"Orikan the Diviner":{baseType:"40mm"},Overlord:{baseType:"40mm"},"Overlord with Translocation Shroud":{baseType:"40mm"},Plasmancer:{baseType:"32mm"},Psychomancer:{baseType:"40mm"},"Royal Warden":{baseType:"32mm"},"Skorpekh Destroyers":{baseType:"50mm"},"Skorpekh Lord":{baseType:"60mm"},Technomancer:{baseType:"50mm"},"Tesseract Vault":{baseType:"120x92mm"},"The Silent King: Szarekh":{baseType:"100mm"},"The Silent King: Triarchal Menhir":{baseType:"50mm"},"Tomb Blades":{baseType:"Small Flying Base"},"Transcendent Câtan":{baseType:"60mm"},"Trazyn the Infinite":{baseType:"40mm"},"Triarch Praetorians":{baseType:"32mm"},"Triarch Stalker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Seraptek Heavy Construct":{baseType:"hull",hullDimensions:{width:0,height:0}}},hm={Battlewagon:{baseType:"hull",hullDimensions:{width:0,height:0}},"Beast Snagga Boyz":{baseType:"32mm"},Beastboss:{baseType:"50mm"},"Beastboss on Squigosaur":{baseType:"80mm"},"Big Mek":{baseType:"50mm"},"Big Mek in Mega Armour":{baseType:"40mm"},"Big Mek with Shokk Attack Gun":{baseType:"40mm"},"Bigâed Bossbunka":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blitza-bommer":{baseType:"120x92mm"},"Boomdakka Snazzwagon":{baseType:"150x95mm"},"Boss Snikrot":{baseType:"40mm"},Boyz:{baseType:"32mm"},"Breaka Boyz":{baseType:"32mm"},"Breaka Boyz: Boss Nob":{baseType:"40mm"},"Burna Boyz":{baseType:"32mm"},"Burna-bommer":{baseType:"120x92mm"},Dakkajet:{baseType:"120x92mm"},"Deff Dread":{baseType:"60mm"},"Deffkilla Wartrike":{baseType:"150x95mm"},Deffkoptas:{baseType:"75x42mm"},"Flash Gitz":{baseType:"40mm"},"Ghazghkull Thraka":{baseType:"80mm"},"Ghazghkull Thraka: Makari":{baseType:"25mm"},Gorkanaut:{baseType:"170x109mm"},Gretchin:{baseType:"25mm"},"Gretchin: Runtherd":{baseType:"32mm"},"Hunta Rig":{baseType:"170x109mm"},"Kill Rig":{baseType:"170x109mm"},"Killa Kans":{baseType:"60mm"},Kommandos:{baseType:"32mm"},"Kustom Boosta-blasta":{baseType:"150x95mm"},Lootas:{baseType:"32mm"},Meganobz:{baseType:"40mm"},"Megatrakk Scrapjet":{baseType:"150x95mm"},Mek:{baseType:"32mm"},"Mek Gunz":{baseType:"hull",hullDimensions:{width:0,height:0}},Morkanaut:{baseType:"170x109mm"},"Mozrog Skragbad":{baseType:"80mm"},Nobz:{baseType:"32mm"},Painboss:{baseType:"40mm"},Painboy:{baseType:"32mm"},"Rukkatrukk Squigbuggy":{baseType:"150x95mm"},"Shokkjump Dragsta":{baseType:"150x95mm"},"Squighog Boyz":{baseType:"75x42mm"},"Squighog Boyz: Nob on Smasha Squig":{baseType:"90x52.5mm"},Stompa:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormboyz:{baseType:"32mm"},Tankbustas:{baseType:"32mm"},"Tankbustas: Boss Nob":{baseType:"40mm"},Trukk:{baseType:"hull",hullDimensions:{width:0,height:0}},Warbikers:{baseType:"75x42mm"},Warboss:{baseType:"40mm"},"Warboss in Mega Armour":{baseType:"50mm"},"Wazbom Blastajet":{baseType:"150x95mm"},Weirdboy:{baseType:"40mm"},Wurrboy:{baseType:"32mm"},"Zodgrod Wortsnagga":{baseType:"50mm"},"Gargantuan Squiggoth":{baseType:"hull",hullDimensions:{width:0,height:0}}},fm={Barbgaunts:{baseType:"40mm"},Biovores:{baseType:"80mm"},Broodlord:{baseType:"75x42mm"},Carnifexes:{baseType:"105x70mm"},Deathleaper:{baseType:"60mm"},Exocrine:{baseType:"120x92mm"},Gargoyles:{baseType:"Small Flying Base"},Genestealers:{baseType:"32mm"},Harpy:{baseType:"120x92mm"},Haruspex:{baseType:"120x92mm"},"Hive Crone":{baseType:"120x92mm"},"Hive Guard":{baseType:"50mm"},"Hive Tyrant":{baseType:"50mm"},Hormagaunts:{baseType:"28.5mm"},Lictor:{baseType:"50mm"},Maleceptor:{baseType:"120x92mm"},Mawloc:{baseType:"120x92mm"},"Mucolid Spores":{baseType:"40mm"},Neurogaunts:{baseType:"25mm"},"Neurogaunts: Nodebeasts":{baseType:"28.5mm"},Neurolictor:{baseType:"50mm"},Neurotyrant:{baseType:"50mm"},"Norn Assimilator":{baseType:"100mm"},"Norn Emissary":{baseType:"100mm"},"Old One Eye":{baseType:"105x70mm"},"Parasite of Mortrex":{baseType:"40mm"},Psychophage:{baseType:"120x92mm"},Pyrovores:{baseType:"80mm"},Raveners:{baseType:"40mm"},"Ripper Swarms":{baseType:"40mm"},"Screamer-killer":{baseType:"90mm"},"Spore MInes":{baseType:"25mm"},Sporocyst:{baseType:"hull",hullDimensions:{width:0,height:0}},Termagants:{baseType:"28.5mm"},Tervigon:{baseType:"120x92mm"},"The Swarmlord":{baseType:"60mm"},Toxicrene:{baseType:"120x92mm"},Trygon:{baseType:"120x92mm"},"Tyranid Warriors with Melee Bio-weapons":{baseType:"50mm"},"Tyranid Warriors with Ranged Bio-weapons":{baseType:"50mm"},Tyrannocyte:{baseType:"100mm"},Tyrannofex:{baseType:"120x92mm"},"Tyrant Guard":{baseType:"50mm"},Venomthropes:{baseType:"40mm"},"Von Ryanâs Leapers":{baseType:"40mm"},"Winged Hive Tyrant":{baseType:"60mm"},"Winged Tyranid Prime":{baseType:"50mm"},Zoanthropes:{baseType:"40mm"},Harridan:{baseType:"hull",hullDimensions:{width:4,height:6}},Hierophant:{baseType:"hull",hullDimensions:{width:0,height:0}}},ra={"ADEPTA SORORITAS":{"Aestred Thurga and Agathae Dolan: Aestred Thurga":{baseType:"32mm"},"Aestred Thurga and Agathae Dolan: Agathae Dolan":{baseType:"25mm"},"Arco-flagellants":{baseType:"25mm"},"Battle Sisters Squad":{baseType:"32mm"},Canoness:{baseType:"32mm"},"Canoness with Jump Pack":{baseType:"32mm"},Castigator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Celestian Sacresants":{baseType:"32mm"},Daemonifuge:{baseType:"32mm"},Dialogus:{baseType:"40mm"},Dogmata:{baseType:"32mm"},"Dominion Squad":{baseType:"32mm"},Exorcist:{baseType:"hull",hullDimensions:{width:0,height:0}},Hospitaller:{baseType:"50mm"},Imagifier:{baseType:"32mm"},Immolator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Junith Eruita":{baseType:"50mm"},"Ministorum Priest":{baseType:"32mm"},Mortifiers:{baseType:"50mm"},"Morvenn Vahl":{baseType:"60mm"},Palatine:{baseType:"32mm"},"Paragon Warsuits":{baseType:"50mm"},"Penitent Engines":{baseType:"50mm"},"Repentia Squad: Repentia Superior":{baseType:"32mm"},"Repentia Squad: Sister Repentia":{baseType:"28.5mm"},"Retributor Squad":{baseType:"32mm"},"Saint Celestine":{baseType:"40mm"},"Saint Celestine: Geminae Superia":{baseType:"32mm"},Sanctifiers:{baseType:"25mm"},"Seraphim Squad":{baseType:"32mm"},"Sisters Novitiate Squad: Novitiate Superior":{baseType:"32mm"},"Sisters Novitiate Squad: Sister Novitiate":{baseType:"28.5mm"},"Sororitas Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Triumph of Saint Katherine":{baseType:"120x92mm"},"Zephyrim Squad":{baseType:"32mm"}},"ADEPTUS CUSTODES":{Aleya:{baseType:"32mm"},"Allarus Custodians":{baseType:"40mm"},"Anathema Psykana Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blade Champion":{baseType:"40mm"},"Custodian Guard":{baseType:"40mm"},"Custodian Wardens":{baseType:"40mm"},"Knight-Centura":{baseType:"32mm"},Prosecutors:{baseType:"32mm"},"Shield-Captain":{baseType:"40mm"},"Shield-Captain in Allarus Terminator Armour":{baseType:"40mm"},"Shield-Captain on Dawneagle Jetbike":{baseType:"75x42mm"},"Trajann Valoris":{baseType:"40mm"},Valerian:{baseType:"40mm"},"Venerable Contemptor Dreadnought":{baseType:"60mm"},"Venerable Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vertus Praetors":{baseType:"75x42mm"},Vigilators:{baseType:"32mm"},Witchseekers:{baseType:"32mm"},"Agamatus Custodians":{baseType:"75x42mm"},"Aquilon Custodians":{baseType:"50mm"},"Ares Gunship":{baseType:"160mm"},"Caladius Grav-tank":{baseType:"170x109mm"},"Contemptor-Achillus Dreadnought":{baseType:"60mm"},"Contemptor-Galatus Dreadnought":{baseType:"60mm"},"Coronus Grav-carrier":{baseType:"170x109mm"},"Custodian Guard with Adrasite and Pyrithite Spears":{baseType:"40mm"},"Orion Assault Dropship":{baseType:"160mm"},"Pallas Grav-attack":{baseType:"105x70mm"},"Sagittarum Custodians":{baseType:"40mm"},"Telemon Heavy Dreadnought":{baseType:"100mm"},"Venatari Custodians":{baseType:"40mm"}},"ADEPTUS MECHANICUS":{"Archaeopter Fusilave":{baseType:"170x109mm"},"Archaeopter Stratoraptor":{baseType:"170x109mm"},"Archaeopter Transvector":{baseType:"170x109mm"},"Belisarius Cawl":{baseType:"105x70mm"},"Corpuscarii Electro-Priests":{baseType:"32mm"},"Cybernetica Datasmith":{baseType:"32mm"},"Fulgurite Electro-Priests":{baseType:"32mm"},"Ironstrider Ballistarii":{baseType:"105x70mm"},"Kastelan Robots":{baseType:"60mm"},"Kataphron Breachers":{baseType:"60mm"},"Kataphron Destroyers":{baseType:"60mm"},"Onager Dunecrawler":{baseType:"130mm"},"Pteraxii Skystalkers":{baseType:"40mm"},"Pteraxii Sterylizors":{baseType:"40mm"},"Serberys Raiders":{baseType:"60x35.5mm"},"Serberys Sulphurhounds":{baseType:"60x35.5mm"},"Sicarian Infiltrators":{baseType:"40mm"},"Sicarian Ruststalkers":{baseType:"40mm"},"Skitarii Marshal":{baseType:"32mm"},"Skitarii Rangers":{baseType:"25mm"},"Skitarii Rangers/Skitarii Vanguard: Transuranic Arquebus":{baseType:"60x35.5mm"},"Skitarii Vanguard":{baseType:"25mm"},"Skorpius Disintegrator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skorpius Dunerider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sydonian Dragoons with Radium Jezzails":{baseType:"105x70mm"},"Sydonian Dragoons with Taser Lances":{baseType:"105x70mm"},"Sydonian Skatros":{baseType:"40mm"},"Tech-Priest Dominus":{baseType:"50mm"},"Tech-Priest Enginseer":{baseType:"32mm"},"Tech-Priest Manipulus":{baseType:"50mm"},Technoarcheologist:{baseType:"32mm"}},"ADEPTUS TITANICUS":{"Reaver Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warbringer Nemesis Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warhound Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warlord Titan":{baseType:"hull",hullDimensions:{width:0,height:0}}},AELDARI:cm,"ASTRA MILITARUM":{"Aegis Defence Line":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armoured Sentinels":{baseType:"80mm"},"Artillery Team":{baseType:"130mm"},"Attilan Rough Riders":{baseType:"60x35.5mm"},Baneblade:{baseType:"hull",hullDimensions:{width:0,height:0}},Banehammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Banesword:{baseType:"hull",hullDimensions:{width:0,height:0}},Basilisk:{baseType:"hull",hullDimensions:{width:0,height:0}},"Bullgryn squad":{baseType:"40mm"},"Cadian Castellan":{baseType:"28.5mm"},"Cadian Command Squad":{baseType:"28.5mm"},"Cadian Heavy Weapons Squad":{baseType:"50mm"},"Cadian Shock Troops":{baseType:"25mm"},"Catachan Command Squad":{baseType:"25mm"},"Catachan Heavy Weapons Squad":{baseType:"60mm"},"Catachan Jungle Fighters":{baseType:"25mm"},Chimera:{baseType:"hull",hullDimensions:{width:0,height:0}},Commissar:{baseType:"28.5mm"},"Death Korps of Krieg":{baseType:"25mm"},"Death Riders":{baseType:"60x35.5mm"},Deathstrike:{baseType:"hull",hullDimensions:{width:0,height:0}},Doomhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},"Field Ordnance Battery":{baseType:"100mm"},"Gauntâs Ghosts":{baseType:"28.5mm"},Hellhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Hellhound:{baseType:"hull",hullDimensions:{width:0,height:0}},Hydra:{baseType:"hull",hullDimensions:{width:0,height:0}},Kasrkin:{baseType:"28.5mm"},"Krieg Combat Engineers":{baseType:"25mm"},"Krieg Command Squad":{baseType:"25mm"},"Krieg Command Squad: Lord Commissar":{baseType:"32mm"},"Krieg Heavy Weapons Squad":{baseType:"50mm"},"Krieg Heavy Weapons Squad: Fire Coordinator":{baseType:"25mm"},"Leman Russ Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Demolisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Eradicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Executioner":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Exterminator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Punisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Vanquisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Marshal Dreir":{baseType:"75x42mm"},"Lord Solar Leontus":{baseType:"80mm"},Manticore:{baseType:"hull",hullDimensions:{width:0,height:0}},"Militarum Tempestus Command Squad":{baseType:"25mm"},"Ministorum Priest":{baseType:"32mm"},"Nork Deddog":{baseType:"40mm"},"Ogryn Bodyguard":{baseType:"40mm"},"Ogryn squad":{baseType:"40mm"},"Primaris Psyker":{baseType:"32mm"},Ratlings:{baseType:"25mm"},"Rogal Dorn Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Rogal Dorn Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Scout Sentinels":{baseType:"80mm"},Shadowsword:{baseType:"hull",hullDimensions:{width:0,height:0}},"Sly Marbo":{baseType:"32mm"},Stormlord:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormsword:{baseType:"hull",hullDimensions:{width:0,height:0}},Taurox:{baseType:"hull",hullDimensions:{width:0,height:0}},"Taurox Prime":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tech-Priest Enginseer":{baseType:"32mm"},"Tempestus Aquilons":{baseType:"28.5mm"},"Tempestus Scions":{baseType:"25mm"},"Ursula Creed":{baseType:"32mm"},Valkyrie:{baseType:"120x92mm"},Wyvern:{baseType:"hull",hullDimensions:{width:0,height:0}},"Avenger Strike Fighter":{baseType:"120x92mm"},"Cyclops Demolition Vehicle":{baseType:"hull",hullDimensions:{width:0,height:0}}},"BLACK TEMPLARS":{"Black Templars Gladiator Lancer":{baseType:"100mm"},"Black Templars Gladiator Reaper":{baseType:"100mm"},"Black Templars Gladiator Valiant":{baseType:"100mm"},"Black Templars Impulsor":{baseType:"100mm"},"Black Templars Repulsor":{baseType:"100mm"},"Black Templars Repulsor Executioner":{baseType:"100mm"},Castellan:{baseType:"40mm"},"Chaplain Grimaldus":{baseType:"40mm"},"Chaplain Grimaldus: Cenobyte Servitors":{baseType:"28.5mm"},"Crusader Squad: Neophytes":{baseType:"28.5mm"},"Crusader Squad: Sword Brother/Initiates":{baseType:"32mm"},"High Marshal Helbrecht":{baseType:"60mm"},Marshal:{baseType:"40mm"},"Primaris Crusader Squad: Initiates":{baseType:"32mm"},"Primaris Crusader Squad: Neophytes":{baseType:"28.5mm"},"Primaris Crusader Squad: Sword Brother":{baseType:"40mm"},"Primaris Sword Brethren":{baseType:"40mm"},"The Emperorâs Champion":{baseType:"40mm"}},"BLOOD ANGELS":{Astorath:{baseType:"40mm"},"Baal Predator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blood Angels Captain":{baseType:"40mm"},"Chief Librarian Mephiston":{baseType:"40mm"},"Commander Dante":{baseType:"50mm"},"Death Company Captain":{baseType:"40mm"},"Death Company Captain with Jump Pack":{baseType:"40mm"},"Death Company Dreadnought":{baseType:"90mm"},"Death Company Marines":{baseType:"32mm"},"Death Company Marines with Bolt Rifles":{baseType:"32mm"},"Death Company Marines with Jump Packs":{baseType:"32mm"},Lemartes:{baseType:"40mm"},"Sanguinary Guard":{baseType:"40mm"},"Sanguinary Priest":{baseType:"40mm"},"The Sanguinor":{baseType:"40mm"}},"CHAOS DAEMONS":{"Beâlakor":{baseType:"100mm"},"Beasts of Nurgle":{baseType:"60mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodmaster:{baseType:"40mm"},Bloodthirster:{baseType:"120x92mm"},"Blue Horrors":{baseType:"25mm"},"Burning Chariot":{baseType:"120x92mm"},Changecaster:{baseType:"32mm"},"Contorted Epitome":{baseType:"75x42mm"},"Daemon Prince of Chaos":{baseType:"60mm"},"Daemon Prince of Chaos with Wings":{baseType:"60mm"},Daemonettes:{baseType:"25mm"},Epidemius:{baseType:"60mm"},"Exalted Flamer":{baseType:"75x42mm"},Fateskimmer:{baseType:"120x92mm"},"Feculent Gnarlmaw":{baseType:"hull",hullDimensions:{width:0,height:0}},Fiends:{baseType:"75x42mm"},Flamers:{baseType:"32mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Fluxmaster:{baseType:"Large Flying Base"},"Great Unclean One":{baseType:"130mm"},Hellflayers:{baseType:"120x92mm"},"Horticulous Slimux":{baseType:"105x70mm"},"Infernal Enrapturess":{baseType:"60x35.5mm"},"Kairos Fateweaver":{baseType:"100mm"},Karanak:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},Nurglings:{baseType:"40mm"},"Pink Horrors":{baseType:"32mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Poxbringer:{baseType:"32mm"},"Rendmaster on Blood Throne":{baseType:"120x92mm"},Rotigus:{baseType:"130mm"},Screamers:{baseType:"Small Flying Base"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"},Skarbrand:{baseType:"100mm"},"Skull Altar":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skull Cannon":{baseType:"120x92mm"},Skullmaster:{baseType:"90x52.5mm"},Skulltaker:{baseType:"40mm"},"Sloppity Bilepiper":{baseType:"32mm"},"Soul Grinder":{baseType:"160mm"},"Spoilpox Scrivener":{baseType:"40mm"},"Syllâesske":{baseType:"50mm"},"The Blue Scribes":{baseType:"Large Flying Base"},"The Changeling":{baseType:"40mm"},"The Masque of Slaanesh":{baseType:"32mm"},Tormentbringer:{baseType:"120x92mm"},Tranceweaver:{baseType:"32mm"}},"CHAOS KNIGHTS":{"Knight Abominant":{baseType:"170x109mm"},"Knight Desecrator":{baseType:"170x109mm"},"Knight Despoiler":{baseType:"170x109mm"},"Knight Rampager":{baseType:"170x109mm"},"Knight Tyrant":{baseType:"170x109mm"},"War Dog Brigand":{baseType:"100mm"},"War Dog Executioner":{baseType:"100mm"},"War Dog Huntsman":{baseType:"100mm"},"War Dog Karnivore":{baseType:"100mm"},"War Dog Stalker":{baseType:"100mm"},"Chaos Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Cerastus Knight Acheron":{baseType:"170x109mm"},"Chaos Cerastus Knight Atrapos":{baseType:"170x109mm"},"Chaos Cerastus Knight Castigator":{baseType:"170x109mm"},"Chaos Cerastus Knight Lancer":{baseType:"170x109mm"},"Chaos Questoris Knight Magaera":{baseType:"170x109mm"},"Chaos Questoris Knight Styrix":{baseType:"170x109mm"},"War Dog Moirax":{baseType:"100mm"}},"CHAOS SPACE MARINES":{"Abaddon the Despoiler":{baseType:"60mm"},"Accursed Cultists: Mutant":{baseType:"25mm"},"Accursed Cultists: Torment":{baseType:"40mm"},"Chaos Bikers":{baseType:"75x42mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Lord":{baseType:"40mm"},"Chaos Lord in Terminator Armour":{baseType:"40mm"},"Chaos Lord with Jump Pack":{baseType:"40mm"},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminator Squad":{baseType:"40mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},Chosen:{baseType:"32mm"},"Cultist Firebrand":{baseType:"32mm"},"Cultist Mob":{baseType:"25mm"},Cypher:{baseType:"32mm"},"Dark Apostle":{baseType:"40mm"},"Dark Apostle: Dark Disciple":{baseType:"25mm"},"Dark Commune: Blessed Blade":{baseType:"28.5mm"},"Dark Commune: Cult Demagogue, Mindwitch, Iconarch":{baseType:"32mm"},Defiler:{baseType:"160mm"},"Fabius Bile":{baseType:"40mm"},"Fabius Bile: Surgeon Acolyte":{baseType:"32mm"},"Fellgor beastmen":{baseType:"32mm"},Forgefiend:{baseType:"120x92mm"},"Haarken Worldclaimer":{baseType:"40mm"},Havocs:{baseType:"40mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Heretic Astartes Daemon Prince":{baseType:"60mm"},"Heretic Astartes Daemon Prince with Wings":{baseType:"60mm"},"Huron Blackheart":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},Legionaries:{baseType:"32mm"},"Lord Discordant on Helstalker":{baseType:"120x92mm"},"Master of Executions":{baseType:"40mm"},"Master of Possession":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},"Nemesis Claw":{baseType:"32mm"},"Noctilith Crown":{baseType:"hull",hullDimensions:{width:0,height:0}},Obliterators:{baseType:"50mm"},Possessed:{baseType:"40mm"},Raptors:{baseType:"32mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Traitor Enforcer":{baseType:"32mm"},"Traitor Enforcer: Traitor Ogryn":{baseType:"40mm"},"Traitor Guardsmen Squad":{baseType:"25mm"},"Vashtorr the Arkifane":{baseType:"80mm"},Venomcrawler:{baseType:"100mm"},"Warp Talons":{baseType:"32mm"},Warpsmith:{baseType:"60x35.5mm"}},"DARK ANGELS":{Asmodai:{baseType:"50mm"},Azrael:{baseType:"50mm"},Belial:{baseType:"50mm"},"Deathwing Knights":{baseType:"40mm"},"Deathwing Terminator Squad":{baseType:"40mm"},Ezekiel:{baseType:"25mm"},"Inner Circle Companions":{baseType:"40mm"},"Land Speeder Vengeance":{baseType:"Large Flying Base"},Lazarus:{baseType:"40mm"},"Lion ElâJonson":{baseType:"60mm"},"Nephilim Jetfighter":{baseType:"120x92mm"},"Ravenwing Black Knights":{baseType:"75x42mm"},"Ravenwing Command Squad":{baseType:"75x42mm"},"Ravenwing Dark Talon":{baseType:"120x92mm"},"Ravenwing Darkshroud":{baseType:"Large Flying Base"},Sammael:{baseType:"Large Flying Base"}},"DEATH GUARD":{"Biologus Putrifier":{baseType:"40mm"},"Blightlord Terminators":{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Nurgle":{baseType:"60mm"},"Daemon Prince of Nurgle with Wings":{baseType:"60mm"},"Deathshroud Terminators":{baseType:"40mm"},Defiler:{baseType:"160mm"},"Foetid Bloat-Drone":{baseType:"60mm"},"Foetid Bloat-drone with Heavy Blight Launcher":{baseType:"60mm"},"Foul Blightspawn":{baseType:"40mm"},Helbrute:{baseType:"60mm"},"Icon Bearer":{baseType:"32mm"},"Lord of Contagion":{baseType:"50mm"},"Lord of Poxes":{baseType:"40mm"},"Lord of Virulence":{baseType:"50mm"},"Malignant Plaguecaster":{baseType:"32mm"},"Miasmic Malignifier":{baseType:"hull",hullDimensions:{width:0,height:0}},Mortarion:{baseType:"100mm"},"Myphitic Blight-Haulers":{baseType:"80mm"},"Noxious Blightbringer":{baseType:"40mm"},"Plague Marines":{baseType:"32mm"},"Plague Surgeon":{baseType:"40mm"},"Plagueburst Crawler":{baseType:"hull",hullDimensions:{width:0,height:0}},Poxwalkers:{baseType:"25mm"},Tallyman:{baseType:"40mm"},Typhus:{baseType:"50mm"},"Beasts of Nurgle":{baseType:"60mm"},"Great Unclean One":{baseType:"130mm"},Nurglings:{baseType:"40mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Rotigus:{baseType:"130mm"}},DEATHWATCH:um,DRUKHARI:mm,"EMPERORâS CHILDREN":{"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminators":{baseType:"40mm"},"Daemon Prince of Slaanesh":{baseType:"60mm"},"Daemon Prince of Slaanesh with Wings":{baseType:"60mm"},"Flawless Blades":{baseType:"40mm"},Fulgrim:{baseType:"130mm"},Heldrake:{baseType:"120x92mm"},Infractors:{baseType:"32mm"},"Lord Exultant":{baseType:"40mm"},"Lord Kakophonist":{baseType:"40mm"},"Lucius the Eternal":{baseType:"50mm"},Maulerfiend:{baseType:"120x92mm"},"Noise Marines":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},Tormentors:{baseType:"32mm"},Daemonettes:{baseType:"25mm"},Fiends:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"}},"GENESTEALER CULTS":{Aberrants:{baseType:"32mm"},Abominant:{baseType:"40mm"},"Achilles Ridgerunners":{baseType:"120x92mm"},"Acolyte Hybrids with Autopistols":{baseType:"32mm"},"Acolyte Hybrids with Hand Flamers":{baseType:"32mm"},"Acolyte Iconward":{baseType:"32mm"},"Atalan Jackals":{baseType:"60x35.5mm"},"Atalan Jackals: Wolfquad":{baseType:"60mm"},Benefictus:{baseType:"32mm"},Biophagus:{baseType:"25mm"},Clamavus:{baseType:"32mm"},"Goliath Rockgrinder":{baseType:"hull",hullDimensions:{width:0,height:0}},"Goliath Truck":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hybrid Metamorphs":{baseType:"32mm"},"Jackal Alphus":{baseType:"60x35.5mm"},Kelermorph:{baseType:"32mm"},Locus:{baseType:"32mm"},Magus:{baseType:"32mm"},"Neophyte Hybrids":{baseType:"25mm"},"Neophyte Hybrids: Heavy stubber, Mining laser, Seismic cannon":{baseType:"32mm"},Nexos:{baseType:"40mm"},Patriarch:{baseType:"50mm"},Primus:{baseType:"32mm"},"Purestrain Genestealers":{baseType:"32mm"},"Reductus Saboteur":{baseType:"32mm"},Sanctus:{baseType:"32mm"}},"GREY KNIGHTS":{"Brother-Captain":{baseType:"40mm"},"Brother-Captain Stern":{baseType:"40mm"},"Brotherhood Champion":{baseType:"32mm"},"Brotherhood Chaplain":{baseType:"40mm"},"Brotherhood Librarian":{baseType:"40mm"},"Brotherhood Techmarine":{baseType:"32mm"},"Brotherhood Terminator Squad":{baseType:"40mm"},"Castellan Crowe":{baseType:"40mm"},"Grand Master":{baseType:"40mm"},"Grand Master in Nemesis Dreadknight":{baseType:"120x92mm"},"Grand Master Voldus":{baseType:"40mm"},"Grey Knights Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Razorback":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Stormhawk Interceptor":{baseType:"120x92mm"},"Grey knights Stormraven Gunship":{baseType:"120x92mm"},"Grey knights Stormtalon Gunship":{baseType:"120x92mm"},"Grey Knights Venerable Dreadnought":{baseType:"60mm"},"Interceptor Squad":{baseType:"32mm"},"Kaldor Draigo":{baseType:"40mm"},"Nemesis Dreadknight":{baseType:"120x92mm"},"Paladin Squad":{baseType:"40mm"},"Purgation Squad":{baseType:"32mm"},"Purifier Squad":{baseType:"32mm"},Servitors:{baseType:"25mm"},"Strike Squad":{baseType:"32mm"},"Grey Knights Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}},"Land Raider Banisher":{baseType:"hull",hullDimensions:{width:0,height:0}}},"IMPERIAL AGENTS":{"Callidus Assassin":{baseType:"32mm"},"Corvus Blackstar":{baseType:"120x92mm"},"Culexus Assassin":{baseType:"32mm"},"Deathwatch Kill Team":{baseType:"32mm"},"Eversor Assassin":{baseType:"32mm"},"Exaction Squad":{baseType:"28.5mm"},"Exaction Squad: Cyber-mastiff":{baseType:"25mm"},"Grey Knights Terminator Squad":{baseType:"40mm"},"Imperial Navy Breachers":{baseType:"25mm"},"Imperial Navy Breachers: Navis las-volley, endurant shield":{baseType:"28.5mm"},"Imperial Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},Inquisitor:{baseType:"32mm"},"Inquisitor Coteaz":{baseType:"40mm"},"Inquisitor Draxus":{baseType:"32mm"},"Inquisitor Greyfax":{baseType:"32mm"},"Inquisitorial Agents":{baseType:"25mm"},"Inquisitorial Agents: Gun Servitors":{baseType:"32mm"},"Inquisitorial Chimera":{baseType:"hull",hullDimensions:{width:0,height:0}},"Ministorum Priest":{baseType:"32mm"},Navigator:{baseType:"32mm"},"Rogue Trader entourage":{baseType:"25mm"},Sanctifiers:{baseType:"25mm"},"Sisters of Battle Immolator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sisters of Battle Squad":{baseType:"32mm"},"Subductor Squad":{baseType:"28.5mm"},"Subductor Squad: Cyber-mastiff":{baseType:"25mm"},"Vigilant Squad":{baseType:"28.5mm"},"Vigilant Squad: Cyber-mastiff":{baseType:"25mm"},"Vindicare Assassin":{baseType:"32mm"},"Voidsmen-at-Arms":{baseType:"32mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},"IMPERIAL KNIGHTS":{"Armiger Helverin":{baseType:"100mm"},"Armiger Warglaive":{baseType:"100mm"},"Canis Rex":{baseType:"170x109mm"},"Knight Castellan":{baseType:"170x109mm"},"Knight Crusader":{baseType:"170x109mm"},"Knight Errant":{baseType:"170x109mm"},"Knight Gallant":{baseType:"170x109mm"},"Knight Paladin":{baseType:"170x109mm"},"Knight Preceptor":{baseType:"170x109mm"},"Knight Valiant":{baseType:"170x109mm"},"Knight Warden":{baseType:"170x109mm"},"Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armiger Moirax":{baseType:"100mm"},"Cerastus Knight Acheron":{baseType:"170x109mm"},"Cerastus Knight Atrapos":{baseType:"170x109mm"},"Cerastus Knight Castigator":{baseType:"170x109mm"},"Cerastus Knight Lancer":{baseType:"170x109mm"},"Questoris Knight Magaera":{baseType:"170x109mm"},"Questoris Knight Styrix":{baseType:"170x109mm"}},"LEAGUES OF VOTANN":{"BrÃ´khyr Iron-master":{baseType:"32mm"},"BrÃ´khyr Iron-master: E-COG":{baseType:"25mm"},"BrÃ´khyr Iron-master: Ironkin Assistant":{baseType:"28.5mm"},"BrÃ´khyr Thunderkyn":{baseType:"40mm"},"Cthonian Beserks":{baseType:"28.5mm"},"Cthonian Beserks: Mole grenade launcher":{baseType:"50mm"},"Einhyr Champion":{baseType:"40mm"},"Einhyr Hearthguard":{baseType:"32mm"},Grimnyr:{baseType:"40mm"},"Grimnyr: CORV":{baseType:"25mm"},"Hearthkyn Warriors":{baseType:"28.5mm"},"Hekaton Land Fortress":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hernkyn Pioneers":{baseType:"90x52.5mm"},"Hernkyn Yaegirs":{baseType:"28.5mm"},KÃ¢hl:{baseType:"40mm"},Sagitaur:{baseType:"hull",hullDimensions:{width:0,height:0}},"Ãthar the Destined":{baseType:"40mm"}},NECRONS:dm,ORKS:hm,"SPACE MARINES":{"Adrax Agatone":{baseType:"40mm"},"Aggressor Squad":{baseType:"40mm"},Ancient:{baseType:"40mm"},"Ancient in Terminator Armour":{baseType:"40mm"},Apothecary:{baseType:"40mm"},"Apothecary Biologis":{baseType:"40mm"},"Assault Intercessor Squad":{baseType:"32mm"},"Assault Intercessors with Jump Packs":{baseType:"32mm"},"Ballistus Dreadnought":{baseType:"90mm"},"Bladeguard Ancient":{baseType:"40mm"},"Bladeguard Veteran Squad":{baseType:"40mm"},"Brutalis Dreadnought":{baseType:"90mm"},Captain:{baseType:"40mm"},"Captain in Gravis Armour":{baseType:"40mm"},"Captain in Phobos Armour":{baseType:"40mm"},"Captain in Terminator Armour":{baseType:"50mm"},"Captain Sicarius":{baseType:"32mm"},"Captain with Jump Pack":{baseType:"40mm"},"Centurion Assault Squad":{baseType:"50mm"},"Centurion Devastator Squad":{baseType:"50mm"},Chaplain:{baseType:"40mm"},"Chaplain in Terminator Armour":{baseType:"40mm"},"Chaplain on Bike":{baseType:"90x52.5mm"},"Chaplain with Jump Pack":{baseType:"32mm"},"Chief Librarian Tigurius":{baseType:"40mm"},"Company Heroes":{baseType:"40mm"},"Darnath Lysander":{baseType:"50mm"},"Desolation Squad":{baseType:"32mm"},"Devastator Squad":{baseType:"32mm"},Dreadnought:{baseType:"60mm"},"Drop Pod":{baseType:"hull",hullDimensions:{width:0,height:0}},"Eliminator Squad":{baseType:"40mm"},"Eradicator Squad":{baseType:"40mm"},"Firestrike Servo-turrets":{baseType:"80mm"},"Gladiator Lancer":{baseType:"100mm"},"Gladiator Reaper":{baseType:"100mm"},"Gladiator Valiant":{baseType:"100mm"},"Hammerfall Bunker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Heavy Intercessor Squad":{baseType:"40mm"},"Hellblaster Squad":{baseType:"32mm"},Impulsor:{baseType:"100mm"},"Inceptor Squad":{baseType:"40mm"},"Incursor Squad":{baseType:"32mm"},"Infernus Squad":{baseType:"32mm"},"Infiltrator Squad":{baseType:"32mm"},"Intercessor Squad":{baseType:"32mm"},"Invader ATV":{baseType:"hull",hullDimensions:{width:0,height:0}},"Invictor Tactical Warsuit":{baseType:"90mm"},"Iron Father Feirros":{baseType:"40mm"},Judiciar:{baseType:"40mm"},"Kayvaan Shrike":{baseType:"40mm"},"Korâsarro Khan":{baseType:"40mm"},"Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},Librarian:{baseType:"40mm"},"Librarian in Phobos Armour":{baseType:"40mm"},"Librarian in Terminator Armour":{baseType:"40mm"},Lieutenant:{baseType:"40mm"},"Lieutenant in Phobos Armour":{baseType:"40mm"},"Lieutenant in Reiver Armour":{baseType:"40mm"},"Lieutenant Titus":{baseType:"40mm"},"Lieutenant with Combi-weapon":{baseType:"40mm"},"Marneus Calgar":{baseType:"50mm"},"Marneus Calgar: Victrix Honour Guard":{baseType:"40mm"},"Outrider Squad":{baseType:"90x52.5mm"},"Pedro Kantor":{baseType:"32mm"},"Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},Razorback:{baseType:"hull",hullDimensions:{width:0,height:0}},"Redemptor Dreadnought":{baseType:"90mm"},"Reiver Squad":{baseType:"32mm"},Repulsor:{baseType:"100mm"},"Repulsor Executioner":{baseType:"100mm"},Rhino:{baseType:"hull",hullDimensions:{width:0,height:0}},"Roboute Guilliman":{baseType:"60mm"},"Scout Squad":{baseType:"28.5mm"},"Sternguard Veteran Squad":{baseType:"32mm"},"Storm Speeder Hailstrike":{baseType:"90mm"},"Storm Speeder Hammerstrike":{baseType:"90mm"},"Storm Speeder Thunderstrike":{baseType:"90mm"},"Stormhawk Interceptor":{baseType:"120x92mm"},"Stormraven Gunship":{baseType:"120x92mm"},"Stormtalon Gunship":{baseType:"120x92mm"},"Suppressor Squad":{baseType:"40mm"},"Tactical Squad":{baseType:"32mm"},Techmarine:{baseType:"40mm"},"Terminator Assault Squad":{baseType:"40mm"},"Terminator Squad":{baseType:"40mm"},"Tor Garadon":{baseType:"40mm"},"Uriel Ventris":{baseType:"40mm"},"Vanguard Veteran Squad with Jump Packs":{baseType:"32mm"},Vindicator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Vulkan Heâstan":{baseType:"32mm"},Whirlwind:{baseType:"hull",hullDimensions:{width:0,height:0}},Astraeus:{baseType:"hull",hullDimensions:{width:0,height:0}},"Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}}},"SPACE WOLVES":{"Arjac Rockfist":{baseType:"50mm"},"Bjorn the Fell-handed":{baseType:"60mm"},"Blood Claws":{baseType:"32mm"},"Fenrisian Wolves":{baseType:"40mm"},"Grey Hunters":{baseType:"32mm"},"Iron Priest":{baseType:"32mm"},"Logan Grimnar":{baseType:"80mm"},Murderfang:{baseType:"60mm"},"Njal Stormcaller":{baseType:"40mm"},"Ragnar Blackmane":{baseType:"40mm"},"Thunderwolf Cavalry":{baseType:"60mm"},"Ulrik the Slayer":{baseType:"32mm"},"Venerable Dreadnought":{baseType:"60mm"},"Wolf Guard Battle Leader":{baseType:"40mm"},"Wolf Guard Headtakers":{baseType:"40mm"},"Wolf Guard Headtakers: Hunting Wolves":{baseType:"60x35.5mm"},"Wolf Guard Terminators":{baseType:"40mm"},"Wolf Priest":{baseType:"40mm"},Wulfen:{baseType:"40mm"},"Wulfen Dreadnought":{baseType:"60mm"},"Wulfen with Storm Shields":{baseType:"40mm"}},"TâAU EMPIRE":{"Breacher Team":{baseType:"25mm"},"Broadside Battlesuits":{baseType:"60mm"},"Cadre Fireblade":{baseType:"25mm"},"Commander Farsight":{baseType:"60mm"},"Commander in Coldstar Battlesuit":{baseType:"60mm"},"Commander in Enforcer Battlesuit":{baseType:"60mm"},"Commander Shadowsun":{baseType:"50mm"},"Crisis Fireknife Battlesuits":{baseType:"50mm"},"Crisis Starscythe Battlesuits":{baseType:"50mm"},"Crisis Sunforge Battlesuits":{baseType:"50mm"},Darkstrider:{baseType:"32mm"},Devilfish:{baseType:"Large Flying Base"},Ethereal:{baseType:"40mm"},"Firesight Team":{baseType:"40mm"},"Ghostkeel Battlesuit":{baseType:"105x70mm"},"Hammerhead Gunship":{baseType:"Large Flying Base"},"Kroot Carnivores":{baseType:"28.5mm"},"Kroot Farstalkers":{baseType:"28.5mm"},"Kroot Farstalkers: Kroot Kill-broker":{baseType:"32mm"},"Kroot Flesh Shaper":{baseType:"32mm"},"Kroot Hounds":{baseType:"28.5mm"},"Kroot Lone-spear":{baseType:"90x52.5mm"},"Kroot Trail Shaper":{baseType:"32mm"},"Kroot War Shaper":{baseType:"32mm"},"Krootox Rampagers":{baseType:"50mm"},"Krootox Riders":{baseType:"50mm"},"Pathfinder Team":{baseType:"25mm"},Piranhas:{baseType:"Large Flying Base"},"Razorshark Strike Fighter":{baseType:"120x92mm"},"Riptide Battlesuit":{baseType:"120x92mm"},"Sky Ray Gunship":{baseType:"Large Flying Base"},"Stealth Battlesuits":{baseType:"32mm"},Stormsurge:{baseType:"170x109mm"},"Strike Team":{baseType:"25mm"},"Sun Shark Bomber":{baseType:"120x92mm"},"Tidewall Defence Platform":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Droneport":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Gunrig":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Shieldline":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vespid Stingwings":{baseType:"28.5mm"},"AX-1-0 Tiger Shark":{baseType:"160mm"},Manta:{baseType:"hull",hullDimensions:{width:4,height:6}},"Taâunar Supremacy Armour":{baseType:"160mm"},"Tiger Shark":{baseType:"160mm"}},"THOUSAND SONS":{Ahriman:{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Daemon Prince of Tzeentch":{baseType:"60mm"},"Daemon Prince of Tzeentch with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},"Exalted Sorcerer":{baseType:"32mm"},"Exalted Sorcerer on Disc of Tzeentch":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Infernal Master":{baseType:"40mm"},"Magnus the Red":{baseType:"100mm"},Maulerfiend:{baseType:"120x92mm"},"Mutalith Vortex Beast":{baseType:"120x92mm"},"Rubric Marines":{baseType:"32mm"},"Scarab Occult Terminators":{baseType:"40mm"},"Sekhetar Robots":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Tzaangor Enlightened":{baseType:"40mm"},"Tzaangor Enlightened with Fatecaster Greatbows":{baseType:"40mm"},"Tzaangor Shaman":{baseType:"40mm"},Tzaangors:{baseType:"32mm"},"Blue Horrors":{baseType:"25mm"},Flamers:{baseType:"32mm"},"Kairos Fateweaver":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},"Pink Horrors":{baseType:"32mm"},Screamers:{baseType:"Small Flying Base"}},TYRANIDS:fm,"WORLD EATERS":{Angron:{baseType:"100mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Khorne":{baseType:"60mm"},"Daemon Prince of Khorne with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},Eightbound:{baseType:"40mm"},"Exalted Eightbound":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Goremongers:{baseType:"32mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},Jakhals:{baseType:"28.5mm"},"Jakhals: Dishonoured":{baseType:"40mm"},"KhÃ¢rn the Betrayer":{baseType:"40mm"},"Khorne Berzerkers":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Invocatus":{baseType:"90x52.5mm"},"Lord on Juggernaut":{baseType:"90x52.5mm"},"Master of Executions":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},Slaughterbound:{baseType:"50mm"},"Terminator Squad":{baseType:"40mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodthirster:{baseType:"120x92mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Skarbrand:{baseType:"100mm"}}},ym=ot(ra);function pm(){return Object.keys(ra)}function lo(e){return ra[e]?Object.keys(ra[e]):[]}function Hs(e,t){return!ra[e]||!ra[e][t]?null:ra[e][t]}Kt(ym,e=>Object.keys(e));function vm(e,t){const a=e.FACTION_KEYWORD,r=e.UNITS||[],s=[],i=[],o={};for(const c of r){const u=c.name||"",d=lm(c.quantity);let f=Hs(a,u);if(!f){const m=uo(u,a);m&&(f=Hs(a,m))}if(!f){const{faction:m,unitName:h}=bm(u);m&&h&&(f=Hs(m,h))}if(f){o[u]||(o[u]=0),o[u]++;const m=o[u]>1?` #${o[u]}`:"",h=`${u}${m}`,y=gm(f,d,t,h);s.push(...y)}else i.push({id:"unmatched-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),unitName:u,quantity:d,points:c.points,section:c.section})}return{matched:co(s),unmatched:i}}function gm(e,t,a,r,s){const i=[],o=Tm(),l=e.baseType,c=xm(r,l);for(let u=0;u<t;u++){const f={id:Sm(),baseType:l,playerId:a,x:0,y:0,rotation:0,unitId:o,unitName:r,name:c,imported:!0,inStaging:!0};l==="hull"&&(f.baseType="rect-custom",f.customWidth=e.hullDimensions?.width||5.5,f.customHeight=e.hullDimensions?.height||3),i.push(f)}return i}function co(e){const i={};e.forEach(u=>{const d=u.unitId||"ungrouped";i[d]||(i[d]=[]),i[d].push(u)});let o=2,l=2,c=0;for(const u in i){const d=i[u];for(const f of d)f.x=o,f.y=l,o+=2,c++,c>=6&&(o=2,l+=2,c=0);c>0&&(o=2,l+=2,c=0)}return e}function uo(e,t){const a=lo(t);if(!a||a.length===0)return null;const r=Jn(e);for(const l of a)if(Jn(l)===r)return l;const s=r.replace(/s$/,""),i=r+"s";for(const l of a){const c=Jn(l);if(c===s||c===i)return l}for(const l of a){const c=Jn(l);if(r.includes(c)||c.includes(r))return l}const o=r.split(/\s+/).filter(l=>l.length>2);if(o.length>0)for(const l of a){const c=Jn(l);if(o.every(u=>c.includes(u)))return l}return null}function bm(e){const t=pm(),a=Jn(e);for(const r of t){const s=lo(r);if(s){for(const i of s)if(Jn(i)===a)return{faction:r,unitName:i}}}for(const r of t){const s=uo(e,r);if(s)return{faction:r,unitName:s}}return{faction:null,unitName:null}}function Jn(e){return String(e||"").toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim()}function Tm(){return"unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function xm(e,t){if(!e)return"";const a=t.match(/(\d+)mm/),r=a?parseInt(a[1],10):null;return r&&r<50?_m(e):e}function _m(e){return e?e.replace(/\s*#\d+$/,"").split(/\s+/).filter(s=>s.length>0).slice(0,3).map(s=>s[0].toUpperCase()).join(""):""}function Sm(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}var wm=be('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),Am=be('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div> <!>',1),Cm=be('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Selected</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <button class="danger svelte-1g40uyy"> </button></div>'),Em=be('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Rotation</span> <span class="value svelte-1g40uyy"> </span></div>'),Rm=be('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div>'),Mm=be('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),km=be('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Base Type</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Player</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Position</span> <span class="value svelte-1g40uyy"> </span></div> <!> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-1g40uyy">Remove</button></div>'),Dm=be('<p class="hint svelte-1g40uyy">Click a model to select it</p>'),Im=be('<div class="button-group vertical svelte-1g40uyy"><div class="button-row svelte-1g40uyy"><button title="Undo (Ctrl+Z)" class="svelte-1g40uyy">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-1g40uyy">Redo</button></div> <div class="button-row svelte-1g40uyy"><button title="Export deployment to share with others" class="svelte-1g40uyy">Export</button> <button title="Import deployment from JSON file" class="svelte-1g40uyy">Import</button></div> <input type="file" accept=".json" style="display: none;"/> <button class="svelte-1g40uyy">Save to Browser</button> <button class="svelte-1g40uyy">Restore from Browser</button> <button class="secondary svelte-1g40uyy">Clear All Models</button> <button class="secondary svelte-1g40uyy">Clear Saved State</button></div>'),Lm=be('<div class="player-toggle svelte-1g40uyy"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-1g40uyy"><div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Circles</h4> <div class="palette-grid svelte-1g40uyy"></div></div> <div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Ovals</h4> <div class="palette-grid svelte-1g40uyy"></div></div></div>',1),Nm=be('<div class="rect-hull-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="rect-width" class="svelte-1g40uyy">Width (inches)</label> <input id="rect-width" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <div class="field svelte-1g40uyy"><label for="rect-height" class="svelte-1g40uyy">Height (inches)</label> <input id="rect-height" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <button class="svelte-1g40uyy"> </button></div>'),Pm=Me('<path stroke-width="0.10" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),$m=Me('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),Om=Me("<!><!>",1),Wm=Me('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),Ym=Me('<g opacity="0.5" pointer-events="none"><!></g>'),Hm=Me('<line stroke-width="0.05" pointer-events="none"></line>'),Bm=Me('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),Fm=Me('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),qm=Me('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),Um=Me("<!><!><!><!><!><!><!><!><!><!><!>",1),Km=be('<div class="staging-wrapper svelte-1g40uyy"><!></div>'),Gm=be('<main class="svelte-1g40uyy"><div class="header svelte-1g40uyy"><h1 class="svelte-1g40uyy">Deployment Practice</h1> <nav class="nav-links svelte-1g40uyy"><a href="#/setup" class="svelte-1g40uyy">Battlefield Setup</a> <a href="#/deployment" class="active svelte-1g40uyy">Deployment</a> <a href="#/" class="svelte-1g40uyy">Layout Builder</a> <a href="#/debug" class="svelte-1g40uyy">Debug Mode</a></nav></div> <div class="layout svelte-1g40uyy"><div class="sidebar svelte-1g40uyy"><!> <!> <!> <!> <!></div> <div class="main-content svelte-1g40uyy"><div class="battlefield-area svelte-1g40uyy"><div class="battlefield-container svelte-1g40uyy" role="presentation"><!></div> <div class="info svelte-1g40uyy"><p class="svelte-1g40uyy"> </p> <p class="hint svelte-1g40uyy">Drag to select multiple | Ctrl+Click for multi-select | Delete to remove | 1/2 to switch player | L for LoS</p></div></div> <!></div></div></main> <!>',1);function zm(e,t){It(t,!1);const a=()=>Qe(ea,"$selectedDeployment",f),r=()=>Qe(nn,"$selectedLayoutName",f),s=()=>Qe(fn,"$selectedLayoutType",f),i=()=>Qe(it,"$models",f),o=()=>Qe(no,"$loadedTerrain",f),l=()=>Qe($n,"$history",f),c=()=>Qe(uu,"$player1Models",f),u=()=>Qe(mu,"$player2Models",f),d=()=>Qe(Qt,"$stagingModels",f),[f,m]=Ya(),h=$(),y=$(),g=$(),p=$(),_=$(),M=$(),C=$();let b=$(1),x=$(null),R=!1,I=null,S=$(null),D=$(!1),O=$(!1),ie=$(5.5),z=$(3),fe=$(!1),de=$([]),F=[],B=$(null),te=$(!1),G=$(null),ne=$(null),P=$([]),N=$(new Set),W=!1,H=!1,K=null,re=!1,De=null;const Xe=5,q="warhammer-deployment-state";function he(){const k={deployment:a()?.name||null,layout:r()||null,layoutType:s()||null,models:i()};localStorage.setItem(q,JSON.stringify(k))}function Pe(){const k=localStorage.getItem(q);if(k)try{const X=JSON.parse(k);X.models&&Array.isArray(X.models)&&(it.set(X.models),$n.clear())}catch(X){console.error("Failed to restore deployment state:",X)}}function le(){localStorage.removeItem(q),it.clear()}function mt(){const k={version:1,exportedAt:new Date().toISOString(),deployment:a()?{name:a().name,zones:a().zones,objectives:a().objectives}:null,terrain:{layoutName:r(),layoutType:s(),terrains:o().terrains,walls:o().walls},models:i()},X=JSON.stringify(k,null,2),se=new Blob([X],{type:"application/json"}),ye=URL.createObjectURL(se),me=document.createElement("a");me.href=ye,me.download=`deployment-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(me),me.click(),document.body.removeChild(me),URL.revokeObjectURL(ye)}let dt=$(null);function Je(){n(dt)?.click()}function Fe(k){const X=k.target.files?.[0];if(!X)return;const se=new FileReader;se.onload=ye=>{try{const me=JSON.parse(ye.target.result);bt(me)}catch(me){console.error("Failed to parse import file:",me),alert("Failed to import: Invalid JSON file")}},se.readAsText(X),k.target.value=""}function bt(k){if(!k.version){alert("Invalid import file: missing version");return}if(k.deployment){const X=to.find(se=>se.name===k.deployment.name);X?ea.set(X):k.deployment.zones&&k.deployment.objectives&&ea.set({name:k.deployment.name||"Imported",zones:k.deployment.zones,objectives:k.deployment.objectives})}else ea.set(null);if(k.terrain){const{layoutName:X,layoutType:se,terrains:ye,walls:me}=k.terrain;if(se==="preset"&&X){if(yr.find(pe=>pe.name===X))nn.set(X),fn.set("preset");else if(ye||me){const pe=`imported-${Date.now()}`,Ae=localStorage.getItem("warhammer-deployment-layouts"),qe=Ae?JSON.parse(Ae):{};qe[pe]={terrains:ye||[],walls:me||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(qe)),nn.set(pe),fn.set("saved")}}else if(se==="saved"&&X){const ve=localStorage.getItem("warhammer-deployment-layouts"),pe=ve?JSON.parse(ve):{};pe[X]?(nn.set(X),fn.set("saved")):(ye||me)&&(pe[X]={terrains:ye||[],walls:me||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(pe)),nn.set(X),fn.set("saved"))}else if(ye||me){const ve=`imported-${Date.now()}`,pe=localStorage.getItem("warhammer-deployment-layouts"),Ae=pe?JSON.parse(pe):{};Ae[ve]={terrains:ye||[],walls:me||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(Ae)),nn.set(ve),fn.set("saved")}}k.models&&Array.isArray(k.models)&&(it.set(k.models),$n.clear()),w(P,[])}async function ln(k){const{text:X,playerId:se}=k.detail;try{n(B)&&n(B).setLoading(!0);const{format:ye,data:me}=await im(X),{matched:ve,unmatched:pe}=vm(me,se),Ae=me.LIST_TITLE||`${me.FACTION_KEYWORD} Army`;Zs.addImport(Ae,X,me,se),pe.length>0?(w(de,pe),F=ve,w(fe,!0),n(B)&&n(B).setLoading(!1)):(Fr(ve,me.FACTION_KEYWORD),n(B)&&(n(B).setSuccess(`Imported ${ve.length} models from ${me.FACTION_KEYWORD} (${ye})`),n(B).clearText()))}catch(ye){console.error("Failed to parse army list:",ye),n(B)&&n(B).setError(ye.message||"Failed to parse army list")}}function Zt(k){const{selected:X}=k.detail,se=[];for(const ve of X){const pe=typeof ve.quantity=="string"?parseInt(ve.quantity.replace(/x/i,""),10)||1:ve.quantity||1,Ae="unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);for(let qe=0;qe<pe;qe++)se.push({id:"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),baseType:ve.baseType,playerId:n(b),x:0,y:0,rotation:0,unitId:Ae,unitName:ve.unitName,imported:!0,inStaging:!0})}const ye=[...F,...se],me=co(ye);Fr(me,"imported"),n(B)&&(n(B).setSuccess(`Imported ${ye.length} models to staging area`),n(B).clearText()),w(de,[]),F=[]}function Z(k){const{modelIds:X}=k.detail;$u(X,30,22)}function Se(){}Ha(()=>{window.addEventListener("keydown",Le)}),Bi(()=>{window.removeEventListener("keydown",Le)});function Le(k){if(k.target.tagName==="INPUT")return;const X=n(P).length>0;if((k.ctrlKey||k.metaKey)&&k.key==="z"&&!k.shiftKey){k.preventDefault(),it.undo();return}if((k.ctrlKey||k.metaKey)&&(k.key==="y"||k.shiftKey&&k.key==="z")){k.preventDefault(),it.redo();return}if(k.key==="1"){k.preventDefault(),w(b,1);return}if(k.key==="2"){k.preventDefault(),w(b,2);return}if(k.key==="l"||k.key==="L"){k.preventDefault(),w(D,!n(D));return}if(k.key==="Delete"||k.key==="Backspace"){k.preventDefault(),n(P).length>0&&(n(P).forEach(se=>{it.remove(se)}),w(P,[]));return}if(X&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(k.key)){k.preventDefault();const se=k.shiftKey?.1:1;let ye=0,me=0;switch(k.key){case"ArrowUp":me=-se;break;case"ArrowDown":me=se;break;case"ArrowLeft":ye=-se;break;case"ArrowRight":ye=se;break}n(P).forEach(ve=>{const pe=i().find(Ae=>Ae.id===ve);pe&&it.updateModel(ve,{x:pe.x+ye,y:pe.y+me},!1)});return}if(k.key==="Escape"){Ze();return}}function Ze(k){if(W){W=!1;return}w(P,[])}function Ke(k){if(k.target.closest(".model-base")||!n(S))return;k.preventDefault();const ye=n(S)(k.clientX,k.clientY);w(G,{x:ye.x,y:ye.y}),w(ne,{x:ye.x,y:ye.y}),w(te,!0),window.addEventListener("mousemove",Y),window.addEventListener("mouseup",ge)}function Y(k){if(!n(te)||!n(S))return;const X=n(S)(k.clientX,k.clientY);w(ne,{x:X.x,y:X.y});const se=Math.min(n(G).x,n(ne).x),ye=Math.max(n(G).x,n(ne).x),me=Math.min(n(G).y,n(ne).y),ve=Math.max(n(G).y,n(ne).y),pe=new Set;i().forEach(Ae=>{Ae.x>=se&&Ae.x<=ye&&Ae.y>=me&&Ae.y<=ve&&pe.add(Ae.id)}),w(N,pe)}function ge(k){if(!n(te))return;const X=Math.min(n(G).x,n(ne).x),se=Math.max(n(G).x,n(ne).x),ye=Math.min(n(G).y,n(ne).y),me=Math.max(n(G).y,n(ne).y),ve=se-X,pe=me-ye;if(ve<.5&&pe<.5)w(P,[]);else{const Ae=[];i().forEach(qe=>{qe.x>=X&&qe.x<=se&&qe.y>=ye&&qe.y<=me&&Ae.push(qe.id)}),w(P,Ae),W=!0}w(te,!1),w(G,null),w(ne,null),n(N).clear(),w(N,n(N)),window.removeEventListener("mousemove",Y),window.removeEventListener("mouseup",ge)}function xe(k,X){if(!n(S))return;R=!0,I={x:X.clientX,y:X.clientY};const se=n(S)(X.clientX,X.clientY);w(x,{baseType:k.type,x:se.x,y:se.y}),window.addEventListener("mousemove",we),window.addEventListener("mouseup",Te)}function we(k){if(!R||!n(x)||!n(S))return;const X=n(S)(k.clientX,k.clientY);w(x,{...n(x),x:X.x,y:X.y})}function Te(k){if(!R||!n(x)){R=!1,w(x,null),I=null,window.removeEventListener("mousemove",we),window.removeEventListener("mouseup",Te);return}const X=k.clientX-I.x,se=k.clientY-I.y,ye=Math.sqrt(X*X+se*se);let me,ve;ye<Xe?(me=30,ve=22):(me=n(x).x,ve=n(x).y);const pe=n(x).customWidth&&n(x).customHeight?{width:n(x).customWidth,height:n(x).customHeight}:null,Ae=it.add(n(x).baseType,n(b),me,ve,pe);w(P,[Ae]),w(x,null),R=!1,I=null,window.removeEventListener("mousemove",we),window.removeEventListener("mouseup",Te)}function ee(){const se={width:n(ie),height:n(z)},ye=it.add("rect-custom",n(b),30,22,se);w(P,[ye])}function oe(k,X){X&&(X.ctrlKey||X.metaKey||X.shiftKey)?n(P).includes(k)?w(P,n(P).filter(se=>se!==k)):w(P,[...n(P),k]):n(P).includes(k)&&n(P).length>1||w(P,[k])}function j(k,X,se){if(n(P).length>1&&n(P).includes(k)){H||(H=!0,K={},n(P).forEach(me=>{const ve=i().find(pe=>pe.id===me);ve&&(K[me]={x:ve.x,y:ve.y})}));const ye=K[k];if(ye){const me=X-ye.x,ve=se-ye.y;n(P).forEach(pe=>{const Ae=K[pe];Ae&&it.updateModel(pe,{x:Ae.x+me,y:Ae.y+ve},!0)})}}else it.updateModel(k,{x:X,y:se},!0)}function Ee(k,X,se,ye,me){H?(n(P).forEach(ve=>{const pe=K[ve],Ae=i().find(qe=>qe.id===ve);pe&&Ae&&$n.push({type:"move",modelId:ve,before:{x:pe.x,y:pe.y},after:{x:Ae.x,y:Ae.y}})}),H=!1,K=null):$n.push({type:"move",modelId:k,before:{x:X,y:se},after:{x:ye,y:me}})}function et(k,X){if(n(P).length>1&&n(P).includes(k)){if(!re){re=!0;let ve=0,pe=0,Ae=0;const qe={};n(P).forEach(rt=>{const ht=i().find(lt=>lt.id===rt);ht&&(ve+=ht.x,pe+=ht.y,Ae++,qe[rt]={x:ht.x,y:ht.y,rotation:ht.rotation||0})}),De={x:ve/Ae,y:pe/Ae},K=qe}const se=i().find(ve=>ve.id===k),ye=K[k];if(!se||!ye)return;const me=X-ye.rotation;n(P).forEach(ve=>{const pe=K[ve];if(pe){const Ae=pe.x-De.x,qe=pe.y-De.y,rt=me*Math.PI/180,ht=Math.cos(rt),lt=Math.sin(rt),Ct=Ae*ht-qe*lt,Rt=Ae*lt+qe*ht;it.updateModel(ve,{x:De.x+Ct,y:De.y+Rt,rotation:pe.rotation+me},!0)}})}else it.updateModel(k,{rotation:X},!0)}function $e(k,X,se){re?(n(P).forEach(ye=>{const me=K[ye],ve=i().find(pe=>pe.id===ye);me&&ve&&$n.push({type:"rotate",modelId:ye,before:{x:me.x,y:me.y,rotation:me.rotation},after:{x:ve.x,y:ve.y,rotation:ve.rotation||0}})}),re=!1,De=null,K=null):$n.push({type:"rotate",modelId:k,before:{rotation:X},after:{rotation:se}})}function U(k,X){it.updateModel(k,{name:X})}function Ge(){n(P).length>0&&(n(P).forEach(k=>{it.remove(k)}),w(P,[]))}function Ot(){confirm("Clear all models?")&&(it.clear(),w(P,[]))}function tt(k){if(br(k.baseType))return{x:k.x,y:k.y,width:k.customWidth,height:k.customHeight,rotation:k.rotation||0,isRectangle:!0};const X=Ja(k.baseType,k);return Za(k.baseType)?{x:k.x,y:k.y,rx:X.width/2,ry:X.height/2,rotation:k.rotation||0}:{x:k.x,y:k.y,radius:X.radius}}ue(()=>(n(P),i()),()=>{w(h,n(P).map(k=>i().find(X=>X.id===k)).filter(Boolean))}),ue(()=>n(h),()=>{w(y,n(h).length===1?n(h)[0]:null)}),ue(()=>n(h),()=>{w(g,[...new Set(n(h).map(k=>k.playerId))])}),ue(()=>(n(h),i(),n(g)),()=>{w(p,n(h).length>0?i().filter(k=>!n(g).includes(k.playerId)):[])}),ue(()=>(o(),ns),()=>{w(_,o().terrains.map(k=>({id:k.id,vertices:ns(k)})))}),ue(()=>(o(),La),()=>{w(M,o().walls.map(k=>pr(La(k.shape),k.x,k.y,k.rotation)))}),ue(()=>(n(h),n(D),n(p),n(_),n(M)),()=>{w(C,n(h).length>0&&n(D)&&n(p).length>0?n(h).flatMap(k=>n(p).map(X=>{const se=Ui(tt(k),tt(X),n(_),n(M));return{sourceId:k.id,source:k,targetId:X.id,target:X,canSee:se.canSee,firstClearRay:se.firstClearRay,rays:se.rays}})):[])}),Tn(),$t();var Gt=Gm(),cn=Ne(Gt),Tt=A(E(cn),2),st=E(Tt),nt=E(st);Et(nt,{title:"Selected Model",children:(k,X)=>{var se=vt(),ye=Ne(se);{var me=pe=>{var Ae=Cm(),qe=E(Ae),rt=A(E(qe),2),ht=E(rt),lt=A(qe,2),Ct=E(lt),Rt=E(Ct),Wt=A(lt,2);{var zn=un=>{var ya=Am(),pa=Ne(ya),We=E(pa),ce=E(We),ft=A(pa,2);{var yt=Ye=>{var Oe=wm(),Mt=A(E(Oe),2),en=E(Mt);V(ct=>Ce(en,`${ct??""}/${n(C),v(()=>n(C).length)??""} rays visible`),[()=>(n(C),v(()=>n(C).filter(ct=>ct.canSee).length))]),L(Ye,Oe)};_e(ft,Ye=>{n(C),v(()=>n(C).length>0)&&Ye(yt)})}wa(ce,()=>n(O),Ye=>w(O,Ye)),L(un,ya)};_e(Wt,un=>{n(D)&&un(zn)})}var ha=A(Wt,2),fa=E(ha);V(()=>{Ce(ht,`${n(P),v(()=>n(P).length)??""} models`),Ce(fa,`Remove All (${n(P),v(()=>n(P).length)??""})`)}),wa(Rt,()=>n(D),un=>w(D,un)),J("click",ha,Ge),L(pe,Ae)},ve=pe=>{var Ae=vt(),qe=Ne(Ae);{var rt=lt=>{var Ct=km(),Rt=E(Ct),Wt=A(E(Rt),2),zn=A(Rt,2),ha=A(E(zn),2),fa=E(ha),un=A(zn,2),ya=A(E(un),2),pa=E(ya),We=A(un,2),ce=A(E(We),2),ft=E(ce),yt=A(We,2);{var Ye=_t=>{var mn=Em(),jn=A(E(mn),2),qa=E(jn);V(Xn=>Ce(qa,`${Xn??""}Â°`),[()=>(n(y),v(()=>Math.round(n(y).rotation||0)))]),L(_t,mn)};_e(yt,_t=>{ae(Za),n(y),v(()=>Za(n(y).baseType))&&_t(Ye)})}var Oe=A(yt,2),Mt=E(Oe),en=E(Mt),ct=A(Oe,2);{var ut=_t=>{var mn=Rm(),jn=E(mn),qa=E(jn);wa(qa,()=>n(O),Xn=>w(O,Xn)),L(_t,mn)};_e(ct,_t=>{n(D)&&_t(ut)})}var pt=A(ct,2);{var cs=_t=>{var mn=Mm(),jn=A(E(mn),2),qa=E(jn);V(Xn=>Ce(qa,`${Xn??""}/${n(C),v(()=>n(C).length)??""} visible`),[()=>(n(C),v(()=>n(C).filter(Xn=>Xn.canSee).length))]),L(_t,mn)};_e(pt,_t=>{n(D),n(C),v(()=>n(D)&&n(C).length>0)&&_t(cs)})}var yo=A(pt,2);V((_t,mn,jn)=>{Yl(Wt,(n(y),v(()=>n(y).name||""))),Ce(fa,_t),Ce(pa,`Player ${n(y),v(()=>n(y).playerId)??""}`),Ce(ft,`${mn??""}", ${jn??""}"`)},[()=>(ae(Ja),n(y),v(()=>Ja(n(y).baseType,n(y))?.label||"Unknown")),()=>(n(y),v(()=>n(y).x.toFixed(1))),()=>(n(y),v(()=>n(y).y.toFixed(1)))]),J("change",Wt,_t=>U(n(y).id,_t.target.value)),wa(en,()=>n(D),_t=>w(D,_t)),J("click",yo,Ge),L(lt,Ct)},ht=lt=>{var Ct=Dm();L(lt,Ct)};_e(qe,lt=>{n(y)?lt(rt):lt(ht,!1)},!0)}L(pe,Ae)};_e(ye,pe=>{n(P),v(()=>n(P).length>1)?pe(me):pe(ve,!1)})}L(k,se)},$$slots:{default:!0}});var xt=A(nt,2);Et(xt,{title:"Import Army List",startOpen:!1,children:(k,X)=>{ts(ku(k,{get currentPlayer(){return n(b)},$$events:{parse:ln},$$legacy:!0}),se=>w(B,se),()=>n(B))},$$slots:{default:!0}});var Ln=A(xt,2);Et(Ln,{title:"Actions",children:(k,X)=>{var se=Im(),ye=E(se),me=E(ye),ve=A(me,2),pe=A(ye,2),Ae=E(pe),qe=A(Ae,2),rt=A(pe,2);ts(rt,Wt=>w(dt,Wt),()=>n(dt));var ht=A(rt,2),lt=A(ht,2),Ct=A(lt,2),Rt=A(Ct,2);V(()=>{me.disabled=(l(),v(()=>!l().past.length)),ve.disabled=(l(),v(()=>!l().future.length))}),J("click",me,()=>it.undo()),J("click",ve,()=>it.redo()),J("click",Ae,mt),J("click",qe,Je),J("change",rt,Fe),J("click",ht,he),J("click",lt,Pe),J("click",Ct,Ot),J("click",Rt,le),L(k,se)},$$slots:{default:!0}});var Gn=A(Ln,2);Et(Gn,{title:"Add Models",children:(k,X)=>{var se=Lm(),ye=Ne(se),me=E(ye);let ve;var pe=A(me,2);let Ae;var qe=A(ye,2),rt=E(qe),ht=A(E(rt),2);ke(ht,5,()=>(ae(qt),v(()=>qt.circles)),He,(Rt,Wt)=>{Cs(Rt,{get baseSize(){return n(Wt)},get playerId(){return n(b)},onDragStart:xe})});var lt=A(rt,2),Ct=A(E(lt),2);ke(Ct,5,()=>(ae(qt),v(()=>qt.ovals)),He,(Rt,Wt)=>{Cs(Rt,{get baseSize(){return n(Wt)},get playerId(){return n(b)},onDragStart:xe})}),V(()=>{ve=rn(me,1,"toggle-btn svelte-1g40uyy",null,ve,{active:n(b)===1}),Ae=rn(pe,1,"toggle-btn svelte-1g40uyy",null,Ae,{active:n(b)===2})}),J("click",me,()=>w(b,1)),J("click",pe,()=>w(b,2)),L(k,se)},$$slots:{default:!0}});var ma=A(Gn,2);Et(ma,{title:"Add Hull (Vehicle)",children:(k,X)=>{var se=Nm(),ye=E(se),me=A(E(ye),2),ve=A(ye,2),pe=A(E(ve),2),Ae=A(ve,2),qe=E(Ae);V(()=>Ce(qe,`Add ${n(ie)??""}" Ã ${n(z)??""}" Hull`)),Ea(me,()=>n(ie),rt=>w(ie,rt)),Ea(pe,()=>n(z),rt=>w(z,rt)),J("click",Ae,ee),L(k,se)},$$slots:{default:!0}});var Ba=A(st,2),da=E(Ba),Fa=E(da),Is=E(Fa);Ds(Is,{children:rr,$$slots:{default:(k,X)=>{const se=ze(()=>X.screenToSvg);var ye=Um(),me=Ne(ye);{var ve=We=>{var ce=$i();V(()=>Ce(ce,(n(S),ae(n(se)),v(()=>(w(S,n(se)),""))))),L(We,ce)};_e(me,We=>{n(se)&&!n(S)&&We(ve)})}var pe=A(me);{var Ae=We=>{var ce=Om(),ft=Ne(ce);ke(ft,1,()=>(a(),v(()=>a().zones)),He,(Ye,Oe)=>{var Mt=Pm();V(en=>{T(Mt,"d",en),T(Mt,"fill",(n(Oe),v(()=>n(Oe).color))),T(Mt,"stroke",(n(Oe),v(()=>n(Oe).borderColor)))},[()=>(ae(Qs),n(Oe),v(()=>Qs(n(Oe).path)))]),L(Ye,Mt)});var yt=A(ft);ke(yt,1,()=>(a(),v(()=>a().objectives)),He,(Ye,Oe)=>{const Mt=ze(()=>(n(Oe),v(()=>n(Oe).isPrimary?"#fbbf24":"#9ca3af"))),en=ze(()=>(n(Oe),v(()=>n(Oe).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var ct=$m(),ut=Ne(ct),pt=A(ut),cs=A(pt);V(()=>{T(ut,"cx",(n(Oe),v(()=>n(Oe).x))),T(ut,"cy",(n(Oe),v(()=>n(Oe).y))),T(ut,"r",Zi),T(ut,"fill",n(en)),T(ut,"stroke",n(Mt)),T(pt,"cx",(n(Oe),v(()=>n(Oe).x))),T(pt,"cy",(n(Oe),v(()=>n(Oe).y))),T(pt,"r",Ji),T(pt,"fill",n(Mt)),T(cs,"cx",(n(Oe),v(()=>n(Oe).x))),T(cs,"cy",(n(Oe),v(()=>n(Oe).y)))}),L(Ye,ct)}),L(We,ce)};_e(pe,We=>{a()&&We(Ae)})}var qe=A(pe);_e(qe,We=>{});var rt=A(qe);_e(rt,We=>{});var ht=A(rt);ke(ht,1,()=>(o(),v(()=>o().terrains)),He,(We,ce)=>{var ft=Wm(),yt=E(ft);V(()=>{T(ft,"transform",`rotate(${n(ce),v(()=>n(ce).rotation)??""}, ${n(ce),v(()=>n(ce).x+n(ce).width/2)??""}, ${n(ce),v(()=>n(ce).y+n(ce).height/2)??""})`),T(yt,"x",(n(ce),v(()=>n(ce).x))),T(yt,"y",(n(ce),v(()=>n(ce).y))),T(yt,"width",(n(ce),v(()=>n(ce).width))),T(yt,"height",(n(ce),v(()=>n(ce).height)))}),L(We,ft)});var lt=A(ht);ke(lt,1,()=>(o(),v(()=>o().walls)),He,(We,ce)=>{var ft=Ym(),yt=E(ft);gr(yt,{get id(){return n(ce),v(()=>n(ce).id)},get x(){return n(ce),v(()=>n(ce).x)},get y(){return n(ce),v(()=>n(ce).y)},get shape(){return n(ce),v(()=>n(ce).shape)},get rotation(){return n(ce),v(()=>n(ce).rotation)},selected:!1,get screenToSvg(){return n(se)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),L(We,ft)});var Ct=A(lt);ke(Ct,1,i,We=>We.id,(We,ce)=>{{let ft=ze(()=>(n(ce),v(()=>n(ce).name||""))),yt=ze(()=>(n(P),n(ce),v(()=>n(P).includes(n(ce).id)))),Ye=ze(()=>(n(P),n(ce),n(N),v(()=>!n(P).includes(n(ce).id)&&n(N).has(n(ce).id))));as(We,{get id(){return n(ce),v(()=>n(ce).id)},get x(){return n(ce),v(()=>n(ce).x)},get y(){return n(ce),v(()=>n(ce).y)},get baseType(){return n(ce),v(()=>n(ce).baseType)},get playerId(){return n(ce),v(()=>n(ce).playerId)},get rotation(){return n(ce),v(()=>n(ce).rotation)},get name(){return n(ft)},get customWidth(){return n(ce),v(()=>n(ce).customWidth)},get customHeight(){return n(ce),v(()=>n(ce).customHeight)},get selected(){return n(yt)},get marqueePreview(){return n(Ye)},get screenToSvg(){return n(se)},onSelect:oe,onDrag:j,onDragEnd:Ee,onRotate:et,onRotateEnd:$e,onRename:U})}});var Rt=A(Ct);{var Wt=We=>{as(We,{id:"phantom",get x(){return n(x),v(()=>n(x).x)},get y(){return n(x),v(()=>n(x).y)},get baseType(){return n(x),v(()=>n(x).baseType)},get playerId(){return n(b)},rotation:0,get customWidth(){return n(x),v(()=>n(x).customWidth)},get customHeight(){return n(x),v(()=>n(x).customHeight)},selected:!1,get screenToSvg(){return n(se)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};_e(Rt,We=>{n(x)&&We(Wt)})}var zn=A(Rt);{var ha=We=>{var ce=vt(),ft=Ne(ce);ke(ft,1,()=>n(C),He,(yt,Ye)=>{var Oe=vt(),Mt=Ne(Oe);ke(Mt,1,()=>(n(Ye),v(()=>n(Ye).rays)),He,(en,ct)=>{var ut=Hm();V(()=>{T(ut,"x1",(n(ct),v(()=>n(ct).from.x))),T(ut,"y1",(n(ct),v(()=>n(ct).from.y))),T(ut,"x2",(n(ct),v(()=>n(ct).to.x))),T(ut,"y2",(n(ct),v(()=>n(ct).to.y))),T(ut,"stroke",(n(ct),v(()=>n(ct).blocked?"#ff000033":"#00ff0033")))}),L(en,ut)}),L(yt,Oe)}),L(We,ce)};_e(zn,We=>{n(O),n(D),n(h),n(C),v(()=>n(O)&&n(D)&&n(h).length>0&&n(C).length>0)&&We(ha)})}var fa=A(zn);{var un=We=>{var ce=vt(),ft=Ne(ce);ke(ft,1,()=>n(C),He,(yt,Ye)=>{var Oe=vt(),Mt=Ne(Oe);{var en=ut=>{var pt=Bm();V(()=>{T(pt,"x1",(n(Ye),v(()=>n(Ye).firstClearRay.from.x))),T(pt,"y1",(n(Ye),v(()=>n(Ye).firstClearRay.from.y))),T(pt,"x2",(n(Ye),v(()=>n(Ye).firstClearRay.to.x))),T(pt,"y2",(n(Ye),v(()=>n(Ye).firstClearRay.to.y)))}),L(ut,pt)},ct=ut=>{var pt=Fm();V(()=>{T(pt,"x1",(n(Ye),v(()=>n(Ye).source.x))),T(pt,"y1",(n(Ye),v(()=>n(Ye).source.y))),T(pt,"x2",(n(Ye),v(()=>n(Ye).target.x))),T(pt,"y2",(n(Ye),v(()=>n(Ye).target.y)))}),L(ut,pt)};_e(Mt,ut=>{n(Ye),v(()=>n(Ye).firstClearRay)?ut(en):ut(ct,!1)})}L(yt,Oe)}),L(We,ce)};_e(fa,We=>{n(D),n(h),n(C),v(()=>n(D)&&n(h).length>0&&n(C).length>0)&&We(un)})}var ya=A(fa);{var pa=We=>{const ce=ze(()=>(n(G),n(ne),v(()=>Math.min(n(G).x,n(ne).x)))),ft=ze(()=>(n(G),n(ne),v(()=>Math.min(n(G).y,n(ne).y)))),yt=ze(()=>(n(ne),n(G),v(()=>Math.abs(n(ne).x-n(G).x)))),Ye=ze(()=>(n(ne),n(G),v(()=>Math.abs(n(ne).y-n(G).y))));var Oe=qm();V(()=>{T(Oe,"x",n(ce)),T(Oe,"y",n(ft)),T(Oe,"width",n(yt)),T(Oe,"height",n(Ye))}),L(We,Oe)};_e(ya,We=>{n(te)&&n(G)&&n(ne)&&We(pa)})}L(k,ye)}}});var Ls=A(Fa,2),Ns=E(Ls),Ps=E(Ns),mo=A(da,2);{var ho=k=>{var X=Km(),se=E(X);Gu(se,{$$events:{deploy:Z,clear:Se}}),L(k,X)};_e(mo,k=>{d(),v(()=>d().length>0)&&k(ho)})}var fo=A(cn,2);Nu(fo,{get unmatchedUnits(){return n(de)},get show(){return n(fe)},set show(k){w(fe,k)},$$events:{import:Zt,close:()=>{w(fe,!1)}},$$legacy:!0}),V(()=>Ce(Ps,`Battlefield: 60" x 44" | ${c(),v(()=>c().length)??""} P1 models | ${u(),v(()=>u().length)??""} P2 models`)),J("mousedown",Fa,Ke),L(e,Gt),Lt(),m()}var jm=be("<span> </span>"),Xm=be('<span class="los-status svelte-12aohay">No enemies</span>'),Vm=be('<div class="controls svelte-12aohay"><label class="svelte-12aohay"><input type="checkbox" class="svelte-12aohay"/> Show debug rays</label> <!></div>'),Qm=be('<button class="svelte-12aohay"> </button>'),Jm=be('<div class="button-group svelte-12aohay"></div>'),Zm=be('<button class="svelte-12aohay"> </button>'),ed=be('<div class="button-group svelte-12aohay"></div>'),td=be('<div class="player-toggle svelte-12aohay"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-12aohay"><div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Circles</h4> <div class="palette-grid svelte-12aohay"></div></div> <div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Ovals</h4> <div class="palette-grid svelte-12aohay"></div></div></div>',1),nd=Me('<line stroke-width="0.05"></line>'),ad=Me('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),sd=Me('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),rd=Me("<!><!><!><!><!><!><!>",1),id=be('<p class="svelte-12aohay"> </p>'),od=be('<main class="svelte-12aohay"><div class="header svelte-12aohay"><h1 class="svelte-12aohay">Debug Mode</h1> <nav class="nav-links svelte-12aohay"><a href="#/setup" class="svelte-12aohay">Battlefield Setup</a> <a href="#/deployment" class="svelte-12aohay">Deployment</a> <a href="#/" class="svelte-12aohay">Layout Builder</a> <a href="#/debug" class="active svelte-12aohay">Debug Mode</a></nav></div> <div class="layout svelte-12aohay"><div class="sidebar svelte-12aohay"><!> <!> <!> <!></div> <div class="battlefield-area svelte-12aohay"><div class="battlefield-container svelte-12aohay"><!></div> <div class="info svelte-12aohay"><p class="svelte-12aohay"> </p> <!> <p class="hint svelte-12aohay">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function ld(e,t){It(t,!1);const a=()=>Qe(On,"$debugModels",u),r=()=>Qe(Qn,"$debugSelectedModelId",u),s=()=>Qe(fs,"$debugTerrains",u),i=()=>Qe(ys,"$debugWalls",u),o=()=>Qe(Hr,"$debugMode",u),l=()=>Qe(ps,"$debugSelectedTerrainId",u),c=()=>Qe(vs,"$debugSelectedWallId",u),[u,d]=Ya(),f=$(),m=$(),h=$(),y=$(),g=$();function p(Z,Se){fs.add(Z,Se)}function _(Z){ys.add(Z)}function M(Z){ps.set(Z),vs.set(null),Qn.set(null)}function C(Z){vs.set(Z),ps.set(null),Qn.set(null)}function b(Z,Se,Le){fs.updateTerrain(Z,{x:Se,y:Le})}function x(Z,Se,Le){ys.updateWall(Z,{x:Se,y:Le})}function R(Z,Se){fs.updateTerrain(Z,{rotation:Se})}function I(Z,Se){ys.updateWall(Z,{rotation:Se})}let S=$(1),D=$(null),O=!1,ie=null,z=$(null);const fe=5;Ha(()=>{if(a().length===0){const Z=On.add("32mm",1,10,22);On.add("32mm",2,50,22),Qn.set(Z)}});function de(Z,Se){if(!n(z))return;O=!0,ie={x:Se.clientX,y:Se.clientY};const Le=n(z)(Se.clientX,Se.clientY);w(D,{baseType:Z.type,x:Le.x,y:Le.y}),window.addEventListener("mousemove",F),window.addEventListener("mouseup",B)}function F(Z){if(!O||!n(D)||!n(z))return;const Se=n(z)(Z.clientX,Z.clientY);w(D,{...n(D),x:Se.x,y:Se.y})}function B(Z){if(!O||!n(D)){O=!1,w(D,null),ie=null,window.removeEventListener("mousemove",F),window.removeEventListener("mouseup",B);return}const Se=Z.clientX-ie.x,Le=Z.clientY-ie.y,Ze=Math.sqrt(Se*Se+Le*Le);let Ke,Y;Ze<fe?(Ke=30,Y=22):(Ke=n(D).x,Y=n(D).y);const ge=On.add(n(D).baseType,n(S),Ke,Y);Qn.set(ge),w(D,null),O=!1,ie=null,window.removeEventListener("mousemove",F),window.removeEventListener("mouseup",B)}function te(Z){Qn.set(Z),ps.set(null),vs.set(null)}function G(Z,Se,Le){On.updateModel(Z,{x:Se,y:Le},!0)}function ne(Z,Se,Le,Ze,Ke){Js.push({type:"move",modelId:Z,before:{x:Se,y:Le},after:{x:Ze,y:Ke}})}function P(Z,Se){On.updateModel(Z,{rotation:Se},!0)}function N(Z,Se,Le){Js.push({type:"rotate",modelId:Z,before:{rotation:Se},after:{rotation:Le}})}function W(Z,Se){On.updateModel(Z,{name:Se})}function H(Z){const Se=Ja(Z.baseType);return Za(Z.baseType)?{x:Z.x,y:Z.y,rx:Se.width/2,ry:Se.height/2,rotation:Z.rotation||0}:{x:Z.x,y:Z.y,radius:Se.radius}}ue(()=>(a(),r()),()=>{w(f,a().find(Z=>Z.id===r()))}),ue(()=>(n(f),a()),()=>{w(m,n(f)?a().filter(Z=>Z.playerId!==n(f).playerId):[])}),ue(()=>(s(),ns),()=>{w(h,s().map(Z=>({id:Z.id,vertices:ns(Z)})))}),ue(()=>(i(),La),()=>{w(y,i().map(Z=>pr(La(Z.shape),Z.x,Z.y,Z.rotation)))}),ue(()=>(n(f),n(m),n(h),n(y)),()=>{w(g,n(f)&&n(m).length>0?n(m).map(Z=>{const Se=Ui(H(n(f)),H(Z),n(h),n(y));return{targetId:Z.id,target:Z,canSee:Se.canSee,firstClearRay:Se.firstClearRay,rays:Se.rays}}):[])}),Tn(),$t();var K=od(),re=A(E(K),2),De=E(re),Xe=E(De);Et(Xe,{title:"LOS Debug",children:(Z,Se)=>{var Le=Vm(),Ze=E(Le),Ke=E(Ze),Y=A(Ze,2);{var ge=we=>{var Te=jm();let ee;var oe=E(Te);V((j,Ee)=>{ee=rn(Te,1,"los-status svelte-12aohay",null,ee,j),Ce(oe,`${Ee??""}/${n(g),v(()=>n(g).length)??""} visible`)},[()=>({"can-see":n(g).some(j=>j.canSee),blocked:!n(g).some(j=>j.canSee)}),()=>(n(g),v(()=>n(g).filter(j=>j.canSee).length))]),L(we,Te)},xe=we=>{var Te=Xm();L(we,Te)};_e(Y,we=>{n(f),n(g),v(()=>n(f)&&n(g).length>0)?we(ge):we(xe,!1)})}wa(Ke,o,we=>Fl(Hr,we)),L(Z,Le)},$$slots:{default:!0}});var q=A(Xe,2);Et(q,{title:"Add Terrain",defaultOpen:!1,children:(Z,Se)=>{var Le=Jm();ke(Le,5,()=>ji,He,(Ze,Ke)=>{var Y=Qm(),ge=E(Y);V(()=>Ce(ge,(n(Ke),v(()=>n(Ke).label)))),J("click",Y,()=>p(n(Ke).width,n(Ke).height)),L(Ze,Y)}),L(Z,Le)},$$slots:{default:!0}});var he=A(q,2);Et(he,{title:"Add Wall",defaultOpen:!1,children:(Z,Se)=>{var Le=ed();ke(Le,5,()=>Vs,He,(Ze,Ke)=>{var Y=Zm(),ge=E(Y);V(()=>Ce(ge,(n(Ke),v(()=>n(Ke).label)))),J("click",Y,()=>_(n(Ke).shape)),L(Ze,Y)}),L(Z,Le)},$$slots:{default:!0}});var Pe=A(he,2);Et(Pe,{title:"Add Models",defaultOpen:!1,children:(Z,Se)=>{var Le=td(),Ze=Ne(Le),Ke=E(Ze);let Y;var ge=A(Ke,2);let xe;var we=A(Ze,2),Te=E(we),ee=A(E(Te),2);ke(ee,5,()=>(ae(qt),v(()=>qt.circles)),He,(Ee,et)=>{Cs(Ee,{get baseSize(){return n(et)},get playerId(){return n(S)},onDragStart:de})});var oe=A(Te,2),j=A(E(oe),2);ke(j,5,()=>(ae(qt),v(()=>qt.ovals)),He,(Ee,et)=>{Cs(Ee,{get baseSize(){return n(et)},get playerId(){return n(S)},onDragStart:de})}),V(()=>{Y=rn(Ke,1,"toggle-btn svelte-12aohay",null,Y,{active:n(S)===1}),xe=rn(ge,1,"toggle-btn svelte-12aohay",null,xe,{active:n(S)===2})}),J("click",Ke,()=>w(S,1)),J("click",ge,()=>w(S,2)),L(Z,Le)},$$slots:{default:!0}});var le=A(De,2),mt=E(le),dt=E(mt);Ds(dt,{children:rr,$$slots:{default:(Z,Se)=>{const Le=ze(()=>Se.screenToSvg);var Ze=rd(),Ke=Ne(Ze);{var Y=$e=>{var U=$i();V(()=>Ce(U,(n(z),ae(n(Le)),v(()=>(w(z,n(Le)),""))))),L($e,U)};_e(Ke,$e=>{n(Le)&&!n(z)&&$e(Y)})}var ge=A(Ke);{var xe=$e=>{var U=vt(),Ge=Ne(U);ke(Ge,1,()=>n(g),He,(Ot,tt)=>{var Gt=vt(),cn=Ne(Gt);ke(cn,1,()=>(n(tt),v(()=>n(tt).rays)),He,(Tt,st)=>{var nt=nd();V(()=>{T(nt,"x1",(n(st),v(()=>n(st).from.x))),T(nt,"y1",(n(st),v(()=>n(st).from.y))),T(nt,"x2",(n(st),v(()=>n(st).to.x))),T(nt,"y2",(n(st),v(()=>n(st).to.y))),T(nt,"stroke",(n(st),v(()=>n(st).blocked?"#ff000033":"#00ff0033")))}),L(Tt,nt)}),L(Ot,Gt)}),L($e,U)};_e(ge,$e=>{o(),n(f),n(g),v(()=>o()&&n(f)&&n(g).length>0)&&$e(xe)})}var we=A(ge);ke(we,1,s,$e=>$e.id,($e,U)=>{{let Ge=ze(()=>(n(U),l(),v(()=>n(U).id===l())));Gi($e,{get id(){return n(U),v(()=>n(U).id)},get x(){return n(U),v(()=>n(U).x)},get y(){return n(U),v(()=>n(U).y)},get width(){return n(U),v(()=>n(U).width)},get height(){return n(U),v(()=>n(U).height)},get rotation(){return n(U),v(()=>n(U).rotation)},get selected(){return n(Ge)},get screenToSvg(){return n(Le)},onSelect:M,onDrag:b,onRotate:R})}});var Te=A(we);ke(Te,1,i,$e=>$e.id,($e,U)=>{{let Ge=ze(()=>(n(U),c(),v(()=>n(U).id===c())));gr($e,{get id(){return n(U),v(()=>n(U).id)},get x(){return n(U),v(()=>n(U).x)},get y(){return n(U),v(()=>n(U).y)},get shape(){return n(U),v(()=>n(U).shape)},get rotation(){return n(U),v(()=>n(U).rotation)},get selected(){return n(Ge)},get screenToSvg(){return n(Le)},onSelect:C,onDrag:x,onRotate:I})}});var ee=A(Te);ke(ee,1,a,$e=>$e.id,($e,U)=>{{let Ge=ze(()=>(n(U),v(()=>n(U).name||""))),Ot=ze(()=>(n(U),r(),v(()=>n(U).id===r())));as($e,{get id(){return n(U),v(()=>n(U).id)},get x(){return n(U),v(()=>n(U).x)},get y(){return n(U),v(()=>n(U).y)},get baseType(){return n(U),v(()=>n(U).baseType)},get playerId(){return n(U),v(()=>n(U).playerId)},get rotation(){return n(U),v(()=>n(U).rotation)},get name(){return n(Ge)},get selected(){return n(Ot)},get screenToSvg(){return n(Le)},onSelect:te,onDrag:G,onDragEnd:ne,onRotate:P,onRotateEnd:N,onRename:W})}});var oe=A(ee);{var j=$e=>{var U=vt(),Ge=Ne(U);ke(Ge,1,()=>n(g),He,(Ot,tt)=>{var Gt=vt(),cn=Ne(Gt);{var Tt=nt=>{var xt=ad();V(()=>{T(xt,"x1",(n(tt),v(()=>n(tt).firstClearRay.from.x))),T(xt,"y1",(n(tt),v(()=>n(tt).firstClearRay.from.y))),T(xt,"x2",(n(tt),v(()=>n(tt).firstClearRay.to.x))),T(xt,"y2",(n(tt),v(()=>n(tt).firstClearRay.to.y)))}),L(nt,xt)},st=nt=>{var xt=sd();V(()=>{T(xt,"x1",(n(f),v(()=>n(f).x))),T(xt,"y1",(n(f),v(()=>n(f).y))),T(xt,"x2",(n(tt),v(()=>n(tt).target.x))),T(xt,"y2",(n(tt),v(()=>n(tt).target.y)))}),L(nt,xt)};_e(cn,nt=>{n(tt),v(()=>n(tt).firstClearRay)?nt(Tt):nt(st,!1)})}L(Ot,Gt)}),L($e,U)};_e(oe,$e=>{o(),n(f),n(g),v(()=>o()&&n(f)&&n(g).length>0)&&$e(j)})}var Ee=A(oe);{var et=$e=>{as($e,{id:"phantom",get x(){return n(D),v(()=>n(D).x)},get y(){return n(D),v(()=>n(D).y)},get baseType(){return n(D),v(()=>n(D).baseType)},get playerId(){return n(S)},rotation:0,selected:!1,get screenToSvg(){return n(Le)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};_e(Ee,$e=>{n(D)&&$e(et)})}L(Z,Ze)}}});var Je=A(mt,2),Fe=E(Je),bt=E(Fe),ln=A(Fe,2);{var Zt=Z=>{var Se=id(),Le=E(Se);V(Ze=>Ce(Le,`Selected model LOS: ${Ze??""}/${n(g),v(()=>n(g).length)??""} visible`),[()=>(n(g),v(()=>n(g).filter(Ze=>Ze.canSee).length))]),L(Z,Se)};_e(ln,Z=>{o(),n(f),n(g),v(()=>o()&&n(f)&&n(g).length>0)&&Z(Zt)})}V(()=>Ce(bt,`Battlefield: 60" x 44" | ${s(),v(()=>s().length)??""} terrain | ${i(),v(()=>i().length)??""} walls | ${a(),v(()=>a().length)??""} models`)),L(e,K),Lt(),d()}function cd(e,t){It(t,!1);let a=$("main");function r(){const c=window.location.hash;c==="#/debug"?w(a,"debug"):c==="#/setup"?w(a,"setup"):c==="#/deployment"?w(a,"deployment"):w(a,"setup")}Ha(()=>(r(),window.addEventListener("hashchange",r),()=>window.removeEventListener("hashchange",r))),$t();var s=vt(),i=Ne(s);{var o=c=>{ld(c,{})},l=c=>{var u=vt(),d=Ne(u);{var f=h=>{cu(h,{})},m=h=>{var y=vt(),g=Ne(y);{var p=M=>{zm(M,{})},_=M=>{Fc(M,{})};_e(g,M=>{n(a)==="deployment"?M(p):M(_,!1)},!0)}L(h,y)};_e(d,h=>{n(a)==="setup"?h(f):h(m,!1)},!0)}L(c,u)};_e(i,c=>{n(a)==="debug"?c(o):c(l,!1)})}L(e,s),Lt()}Cl(cd,{target:document.getElementById("app")});
//# sourceMappingURL=index-DVLWZVwZ.js.map
