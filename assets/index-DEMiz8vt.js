(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=a(s);fetch(s.href,i)}})();const br=!1;var ks=Array.isArray,nl=Array.prototype.indexOf,sr=Array.from,Mi=Object.defineProperty,wa=Object.getOwnPropertyDescriptor,Ri=Object.getOwnPropertyDescriptors,al=Object.prototype,sl=Array.prototype,Nr=Object.getPrototypeOf,ti=Object.isExtensible;const oa=()=>{};function rl(t){return t()}function Vs(t){for(var n=0;n<t.length;n++)t[n]()}function ki(){var t,n,a=new Promise((r,s)=>{t=r,n=s});return{promise:a,resolve:t,reject:n}}const Nt=2,Qs=4,Ls=8,Li=1<<24,Vn=16,Qn=32,Da=64,Pr=128,mn=512,It=1024,qt=2048,Ln=4096,tn=8192,Kn=16384,$r=32768,Qa=65536,ni=1<<17,Di=1<<18,as=1<<19,Ii=1<<20,Un=1<<25,Ra=32768,Tr=1<<21,Or=1<<22,la=1<<23,Gn=Symbol("$state"),il=Symbol("legacy props"),ol=Symbol(""),Ka=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Wr(){throw new Error("https://svelte.dev/e/invalid_default_snippet")}function Yr(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function ll(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function cl(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function ul(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function ml(t){throw new Error("https://svelte.dev/e/effect_orphan")}function dl(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function hl(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function fl(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function yl(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function pl(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function vl(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const gl=1,bl=2,Ni=4,Tl=8,xl=16,_l=1,Sl=2,wl=4,Al=8,Cl=16,Pi=1,El=2,Lt=Symbol(),Ml="http://www.w3.org/1999/xhtml";function Rl(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function kl(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function $i(t){return t===this.v}function Oi(t,n){return t!=t?n==n:t!==n||t!==null&&typeof t=="object"||typeof t=="function"}function Wi(t){return!Oi(t,this.v)}let ss=!1,Ll=!1;function Dl(){ss=!0}let pt=null;function Ja(t){pt=t}function Ut(t,n=!1,a){pt={p:pt,i:!1,c:null,e:null,s:t,x:null,l:ss&&!n?{s:null,u:null,$:[]}:null}}function Kt(t){var n=pt,a=n.e;if(a!==null){n.e=null;for(var r of a)to(r)}return t!==void 0&&(n.x=t),n.i=!0,pt=n.p,t??{}}function Ds(){return!ss||pt!==null&&pt.l===null}let _a=[];function Yi(){var t=_a;_a=[],Vs(t)}function rs(t){if(_a.length===0&&!Ss){var n=_a;queueMicrotask(()=>{n===_a&&Yi()})}_a.push(t)}function Il(){for(;_a.length>0;)Yi()}function Hi(t){var n=rt;if(n===null)return Ve.f|=la,t;if((n.f&$r)===0){if((n.f&Pr)===0)throw t;n.b.error(t)}else Za(t,n)}function Za(t,n){for(;n!==null;){if((n.f&Pr)!==0)try{n.b.error(t);return}catch(a){t=a}n=n.parent}throw t}const Nl=-7169;function Rt(t,n){t.f=t.f&Nl|n}function Hr(t){(t.f&mn)!==0||t.deps===null?Rt(t,It):Rt(t,Ln)}function Fi(t){if(t!==null)for(const n of t)(n.f&Nt)===0||(n.f&Ra)===0||(n.f^=Ra,Fi(n.deps))}function Bi(t,n,a){(t.f&qt)!==0?n.add(t):(t.f&Ln)!==0&&a.add(t),Fi(t.deps),Rt(t,It)}const Hs=new Set;let at=null,_s=null,vn=null,ln=[],rr=null,xr=!1,Ss=!1;class Mn{committed=!1;current=new Map;previous=new Map;#t=new Set;#i=new Set;#e=0;#s=0;#r=null;#a=new Set;#n=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#s>0}process(n){ln=[],_s=null,this.apply();var a=[],r=[];for(const s of n)this.#o(s,a,r);this.is_fork||this.#c(),this.is_deferred()?(this.#l(r),this.#l(a)):(_s=this,at=null,ai(r),ai(a),_s=null,this.#r?.resolve()),vn=null}#o(n,a,r){n.f^=It;for(var s=n.first,i=null;s!==null;){var o=s.f,l=(o&(Qn|Da))!==0,c=l&&(o&It)!==0,u=c||(o&tn)!==0||this.skipped_effects.has(s);if(!u&&s.fn!==null){l?s.f^=It:i!==null&&(o&(Qs|Ls|Li))!==0?i.b.defer_effect(s):(o&Qs)!==0?a.push(s):os(s)&&((o&Vn)!==0&&this.#a.add(s),es(s));var d=s.first;if(d!==null){s=d;continue}}var f=s.parent;for(s=s.next;s===null&&f!==null;)f===i&&(i=null),s=f.next,f=f.parent}}#l(n){for(var a=0;a<n.length;a+=1)Bi(n[a],this.#a,this.#n)}capture(n,a){a!==Lt&&!this.previous.has(n)&&this.previous.set(n,a),(n.f&la)===0&&(this.current.set(n,n.v),vn?.set(n,n.v))}activate(){at=this,this.apply()}deactivate(){at===this&&(at=null,vn=null)}flush(){if(this.activate(),ln.length>0){if(qi(),at!==null&&at!==this)return}else this.#e===0&&this.process([]);this.deactivate()}discard(){for(const n of this.#i)n(this);this.#i.clear()}#c(){if(this.#s===0){for(const n of this.#t)n();this.#t.clear()}this.#e===0&&this.#u()}#u(){if(Hs.size>1){this.previous.clear();var n=vn,a=!0;for(const s of Hs){if(s===this){a=!1;continue}const i=[];for(const[l,c]of this.current){if(s.current.has(l))if(a&&c!==s.current.get(l))s.current.set(l,c);else continue;i.push(l)}if(i.length===0)continue;const o=[...s.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var r=ln;ln=[];const l=new Set,c=new Map;for(const u of i)Ui(u,o,l,c);if(ln.length>0){at=s,s.apply();for(const u of ln)s.#o(u,[],[]);s.deactivate()}ln=r}}at=null,vn=n}this.committed=!0,Hs.delete(this)}increment(n){this.#e+=1,n&&(this.#s+=1)}decrement(n){this.#e-=1,n&&(this.#s-=1),this.revive()}revive(){for(const n of this.#a)this.#n.delete(n),Rt(n,qt),jn(n);for(const n of this.#n)Rt(n,Ln),jn(n);this.flush()}oncommit(n){this.#t.add(n)}ondiscard(n){this.#i.add(n)}settled(){return(this.#r??=ki()).promise}static ensure(){if(at===null){const n=at=new Mn;Hs.add(at),Ss||Mn.enqueue(()=>{at===n&&n.flush()})}return at}static enqueue(n){rs(n)}apply(){}}function Pl(t){var n=Ss;Ss=!0;try{for(var a;;){if(Il(),ln.length===0&&(at?.flush(),ln.length===0))return rr=null,a;qi()}}finally{Ss=n}}function qi(){var t=Ca;xr=!0;var n=null;try{var a=0;for(Zs(!0);ln.length>0;){var r=Mn.ensure();if(a++>1e3){var s,i;$l()}r.process(ln),ca.clear()}}finally{xr=!1,Zs(t),rr=null}}function $l(){try{dl()}catch(t){Za(t,rr)}}let Hn=null;function ai(t){var n=t.length;if(n!==0){for(var a=0;a<n;){var r=t[a++];if((r.f&(Kn|tn))===0&&os(r)&&(Hn=new Set,es(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?ro(r):r.fn=null),Hn?.size>0)){ca.clear();for(const s of Hn){if((s.f&(Kn|tn))!==0)continue;const i=[s];let o=s.parent;for(;o!==null;)Hn.has(o)&&(Hn.delete(o),i.push(o)),o=o.parent;for(let l=i.length-1;l>=0;l--){const c=i[l];(c.f&(Kn|tn))===0&&es(c)}}Hn.clear()}}Hn=null}}function Ui(t,n,a,r){if(!a.has(t)&&(a.add(t),t.reactions!==null))for(const s of t.reactions){const i=s.f;(i&Nt)!==0?Ui(s,n,a,r):(i&(Or|Vn))!==0&&(i&qt)===0&&Ki(s,n,r)&&(Rt(s,qt),jn(s))}}function Ki(t,n,a){const r=a.get(t);if(r!==void 0)return r;if(t.deps!==null)for(const s of t.deps){if(n.includes(s))return!0;if((s.f&Nt)!==0&&Ki(s,n,a))return a.set(s,!0),!0}return a.set(t,!1),!1}function jn(t){for(var n=rr=t;n.parent!==null;){n=n.parent;var a=n.f;if(xr&&n===rt&&(a&Vn)!==0&&(a&Di)===0)return;if((a&(Da|Qn))!==0){if((a&It)===0)return;n.f^=It}}ln.push(n)}function Ol(t){let n=0,a=ka(0),r;return()=>{qr()&&(e(a),is(()=>(n===0&&(r=p(()=>t(()=>ws(a)))),n+=1,()=>{rs(()=>{n-=1,n===0&&(r?.(),r=void 0,ws(a))})})))}}var Wl=Qa|as|Pr;function Yl(t,n,a){new Hl(t,n,a)}class Hl{parent;is_pending=!1;#t;#i=null;#e;#s;#r;#a=null;#n=null;#o=null;#l=null;#c=null;#u=0;#m=0;#h=!1;#f=new Set;#y=new Set;#d=null;#T=Ol(()=>(this.#d=ka(this.#u),()=>{this.#d=null}));constructor(n,a,r){this.#t=n,this.#e=a,this.#s=r,this.parent=rt.b,this.is_pending=!!this.#e.pending,this.#r=Ur(()=>{rt.b=this;{var s=this.#g();try{this.#a=cn(()=>r(s))}catch(i){this.error(i)}this.#m>0?this.#v():this.is_pending=!1}return()=>{this.#c?.remove()}},Wl)}#x(){try{this.#a=cn(()=>this.#s(this.#t))}catch(n){this.error(n)}}#_(){const n=this.#e.pending;n&&(this.#n=cn(()=>n(this.#t)),Mn.enqueue(()=>{var a=this.#g();this.#a=this.#p(()=>(Mn.ensure(),cn(()=>this.#s(a)))),this.#m>0?this.#v():(Aa(this.#n,()=>{this.#n=null}),this.is_pending=!1)}))}#g(){var n=this.#t;return this.is_pending&&(this.#c=zn(),this.#t.before(this.#c),n=this.#c),n}defer_effect(n){Bi(n,this.#f,this.#y)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#e.pending}#p(n){var a=rt,r=Ve,s=pt;kn(this.#r),zt(this.#r),Ja(this.#r.ctx);try{return n()}catch(i){return Hi(i),null}finally{kn(a),zt(r),Ja(s)}}#v(){const n=this.#e.pending;this.#a!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#c),lo(this.#a,this.#l)),this.#n===null&&(this.#n=cn(()=>n(this.#t)))}#b(n){if(!this.has_pending_snippet()){this.parent&&this.parent.#b(n);return}if(this.#m+=n,this.#m===0){this.is_pending=!1;for(const a of this.#f)Rt(a,qt),jn(a);for(const a of this.#y)Rt(a,Ln),jn(a);this.#f.clear(),this.#y.clear(),this.#n&&Aa(this.#n,()=>{this.#n=null}),this.#l&&(this.#t.before(this.#l),this.#l=null)}}update_pending_count(n){this.#b(n),this.#u+=n,this.#d&&La(this.#d,this.#u)}get_effect_pending(){return this.#T(),e(this.#d)}error(n){var a=this.#e.onerror;let r=this.#e.failed;if(this.#h||!a&&!r)throw n;this.#a&&(Xt(this.#a),this.#a=null),this.#n&&(Xt(this.#n),this.#n=null),this.#o&&(Xt(this.#o),this.#o=null);var s=!1,i=!1;const o=()=>{if(s){kl();return}s=!0,i&&vl(),Mn.ensure(),this.#u=0,this.#o!==null&&Aa(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#a=this.#p(()=>(this.#h=!1,cn(()=>this.#s(this.#t)))),this.#m>0?this.#v():this.is_pending=!1};var l=Ve;try{zt(null),i=!0,a?.(n,o),i=!1}catch(c){Za(c,this.#r&&this.#r.parent)}finally{zt(l)}r&&rs(()=>{this.#o=this.#p(()=>{Mn.ensure(),this.#h=!0;try{return cn(()=>{r(this.#t,()=>n,()=>o)})}catch(c){return Za(c,this.#r.parent),null}finally{this.#h=!1}})})}}function Fl(t,n,a,r){const s=Ds()?ir:Ge;if(a.length===0&&t.length===0){r(n.map(s));return}var i=at,o=rt,l=Bl();function c(){Promise.all(a.map(u=>ql(u))).then(u=>{l();try{r([...n.map(s),...u])}catch(d){(o.f&Kn)===0&&Za(d,o)}i?.deactivate(),Js()}).catch(u=>{Za(u,o)})}t.length>0?Promise.all(t).then(()=>{l();try{return c()}finally{i?.deactivate(),Js()}}):c()}function Bl(){var t=rt,n=Ve,a=pt,r=at;return function(i=!0){kn(t),zt(n),Ja(a),i&&r?.activate()}}function Js(){kn(null),zt(null),Ja(null)}function ir(t){var n=Nt|qt,a=Ve!==null&&(Ve.f&Nt)!==0?Ve:null;return rt!==null&&(rt.f|=as),{ctx:pt,deps:null,effects:null,equals:$i,f:n,fn:t,reactions:null,rv:0,v:Lt,wv:0,parent:a??rt,ac:null}}function ql(t,n,a){let r=rt;r===null&&ll();var s=r.b,i=void 0,o=ka(Lt),l=!Ve,c=new Map;return Zl(()=>{var u=ki();i=u.promise;try{Promise.resolve(t()).then(u.resolve,u.reject).then(()=>{d===at&&d.committed&&d.deactivate(),Js()})}catch(h){u.reject(h),Js()}var d=at;if(l){var f=s.is_rendered();s.update_pending_count(1),d.increment(f),c.get(d)?.reject(Ka),c.delete(d),c.set(d,u)}const m=(h,y=void 0)=>{if(d.activate(),y)y!==Ka&&(o.f|=la,La(o,y));else{(o.f&la)!==0&&(o.f^=la),La(o,h);for(const[v,b]of c){if(c.delete(v),v===d)break;b.reject(Ka)}}l&&(s.update_pending_count(-1),d.decrement(f))};u.promise.then(m,h=>m(null,h||"unknown"))}),Ns(()=>{for(const u of c.values())u.reject(Ka)}),new Promise(u=>{function d(f){function m(){f===i?u(o):d(i)}f.then(m,m)}d(i)})}function Ge(t){const n=ir(t);return n.equals=Wi,n}function Gi(t){var n=t.effects;if(n!==null){t.effects=null;for(var a=0;a<n.length;a+=1)Xt(n[a])}}function Ul(t){for(var n=t.parent;n!==null;){if((n.f&Nt)===0)return(n.f&Kn)===0?n:null;n=n.parent}return null}function Fr(t){var n,a=rt;kn(Ul(t));try{t.f&=~Ra,Gi(t),n=fo(t)}finally{kn(a)}return n}function zi(t){var n=Fr(t);if(!t.equals(n)&&(t.wv=mo(),(!at?.is_fork||t.deps===null)&&(t.v=n,t.deps===null))){Rt(t,It);return}ma||(vn!==null?(qr()||at?.is_fork)&&vn.set(t,n):Hr(t))}let _r=new Set;const ca=new Map;let Xi=!1;function ka(t,n){var a={f:0,v:t,reactions:null,equals:$i,rv:0,wv:0};return a}function aa(t,n){const a=ka(t);return ac(a),a}function W(t,n=!1,a=!0){const r=ka(t);return n||(r.equals=Wi),ss&&a&&pt!==null&&pt.l!==null&&(pt.l.s??=[]).push(r),r}function fr(t,n){return T(t,p(()=>e(t))),n}function T(t,n,a=!1){Ve!==null&&(!gn||(Ve.f&ni)!==0)&&Ds()&&(Ve.f&(Nt|Vn|Or|ni))!==0&&!Xn?.includes(t)&&pl();let r=a?Ga(n):n;return La(t,r)}function La(t,n){if(!t.equals(n)){var a=t.v;ma?ca.set(t,n):ca.set(t,a),t.v=n;var r=Mn.ensure();if(r.capture(t,a),(t.f&Nt)!==0){const s=t;(t.f&qt)!==0&&Fr(s),Hr(s)}t.wv=mo(),ji(t,qt),Ds()&&rt!==null&&(rt.f&It)!==0&&(rt.f&(Qn|Da))===0&&(on===null?sc([t]):on.push(t)),!r.is_fork&&_r.size>0&&!Xi&&Kl()}return n}function Kl(){Xi=!1;var t=Ca;Zs(!0);const n=Array.from(_r);try{for(const a of n)(a.f&It)!==0&&Rt(a,Ln),os(a)&&es(a)}finally{Zs(t)}_r.clear()}function ws(t){T(t,t.v+1)}function ji(t,n){var a=t.reactions;if(a!==null)for(var r=Ds(),s=a.length,i=0;i<s;i++){var o=a[i],l=o.f;if(!(!r&&o===rt)){var c=(l&qt)===0;if(c&&Rt(o,n),(l&Nt)!==0){var u=o;vn?.delete(u),(l&Ra)===0&&(l&mn&&(o.f|=Ra),ji(u,Ln))}else c&&((l&Vn)!==0&&Hn!==null&&Hn.add(o),jn(o))}}}function Ga(t){if(typeof t!="object"||t===null||Gn in t)return t;const n=Nr(t);if(n!==al&&n!==sl)return t;var a=new Map,r=ks(t),s=aa(0),i=Ea,o=l=>{if(Ea===i)return l();var c=Ve,u=Ea;zt(null),oi(i);var d=l();return zt(c),oi(u),d};return r&&a.set("length",aa(t.length)),new Proxy(t,{defineProperty(l,c,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&fl();var d=a.get(c);return d===void 0?d=o(()=>{var f=aa(u.value);return a.set(c,f),f}):T(d,u.value,!0),!0},deleteProperty(l,c){var u=a.get(c);if(u===void 0){if(c in l){const d=o(()=>aa(Lt));a.set(c,d),ws(s)}}else T(u,Lt),ws(s);return!0},get(l,c,u){if(c===Gn)return t;var d=a.get(c),f=c in l;if(d===void 0&&(!f||wa(l,c)?.writable)&&(d=o(()=>{var h=Ga(f?l[c]:Lt),y=aa(h);return y}),a.set(c,d)),d!==void 0){var m=e(d);return m===Lt?void 0:m}return Reflect.get(l,c,u)},getOwnPropertyDescriptor(l,c){var u=Reflect.getOwnPropertyDescriptor(l,c);if(u&&"value"in u){var d=a.get(c);d&&(u.value=e(d))}else if(u===void 0){var f=a.get(c),m=f?.v;if(f!==void 0&&m!==Lt)return{enumerable:!0,configurable:!0,value:m,writable:!0}}return u},has(l,c){if(c===Gn)return!0;var u=a.get(c),d=u!==void 0&&u.v!==Lt||Reflect.has(l,c);if(u!==void 0||rt!==null&&(!d||wa(l,c)?.writable)){u===void 0&&(u=o(()=>{var m=d?Ga(l[c]):Lt,h=aa(m);return h}),a.set(c,u));var f=e(u);if(f===Lt)return!1}return d},set(l,c,u,d){var f=a.get(c),m=c in l;if(r&&c==="length")for(var h=u;h<f.v;h+=1){var y=a.get(h+"");y!==void 0?T(y,Lt):h in l&&(y=o(()=>aa(Lt)),a.set(h+"",y))}if(f===void 0)(!m||wa(l,c)?.writable)&&(f=o(()=>aa(void 0)),T(f,Ga(u)),a.set(c,f));else{m=f.v!==Lt;var v=o(()=>Ga(u));T(f,v)}var b=Reflect.getOwnPropertyDescriptor(l,c);if(b?.set&&b.set.call(d,u),!m){if(r&&typeof c=="string"){var S=a.get("length"),R=Number(c);Number.isInteger(R)&&R>=S.v&&T(S,R+1)}ws(s)}return!0},ownKeys(l){e(s);var c=Reflect.ownKeys(l).filter(f=>{var m=a.get(f);return m===void 0||m.v!==Lt});for(var[u,d]of a)d.v!==Lt&&!(u in l)&&c.push(u);return c},setPrototypeOf(){yl()}})}function si(t){try{if(t!==null&&typeof t=="object"&&Gn in t)return t[Gn]}catch{}return t}function Gl(t,n){return Object.is(si(t),si(n))}var za,Vi,Qi,Ji;function zl(){if(za===void 0){za=window,Vi=/Firefox/.test(navigator.userAgent);var t=Element.prototype,n=Node.prototype,a=Text.prototype;Qi=wa(n,"firstChild").get,Ji=wa(n,"nextSibling").get,ti(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),ti(a)&&(a.__t=void 0)}}function zn(t=""){return document.createTextNode(t)}function Bn(t){return Qi.call(t)}function Is(t){return Ji.call(t)}function E(t,n){return Bn(t)}function Re(t,n=!1){{var a=Bn(t);return a instanceof Comment&&a.data===""?Is(a):a}}function x(t,n=1,a=!1){let r=t;for(;n--;)r=Is(r);return r}function Xl(t){t.textContent=""}function Zi(){return!1}let ri=!1;function jl(){ri||(ri=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const n of t.target.elements)n.__on_r?.()})},{capture:!0}))}function or(t){var n=Ve,a=rt;zt(null),kn(null);try{return t()}finally{zt(n),kn(a)}}function Br(t,n,a,r=a){t.addEventListener(n,()=>or(a));const s=t.__on_r;s?t.__on_r=()=>{s(),r(!0)}:t.__on_r=()=>r(!0),jl()}function eo(t){rt===null&&(Ve===null&&ml(),ul()),ma&&cl()}function Vl(t,n){var a=n.last;a===null?n.last=n.first=t:(a.next=t,t.prev=a,n.last=t)}function Dn(t,n,a){var r=rt;r!==null&&(r.f&tn)!==0&&(t|=tn);var s={ctx:pt,deps:null,nodes:null,f:t|qt|mn,first:null,fn:n,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(a)try{es(s),s.f|=$r}catch(l){throw Xt(s),l}else n!==null&&jn(s);var i=s;if(a&&i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&as)===0&&(i=i.first,(t&Vn)!==0&&(t&Qa)!==0&&i!==null&&(i.f|=Qa)),i!==null&&(i.parent=r,r!==null&&Vl(i,r),Ve!==null&&(Ve.f&Nt)!==0&&(t&Da)===0)){var o=Ve;(o.effects??=[]).push(i)}return s}function qr(){return Ve!==null&&!gn}function Ns(t){const n=Dn(Ls,null,!1);return Rt(n,It),n.teardown=t,n}function Sr(t){eo();var n=rt.f,a=!Ve&&(n&Qn)!==0&&(n&$r)===0;if(a){var r=pt;(r.e??=[]).push(t)}else return to(t)}function to(t){return Dn(Qs|Ii,t,!1)}function Ql(t){return eo(),Dn(Ls|Ii,t,!0)}function Jl(t){Mn.ensure();const n=Dn(Da|as,t,!0);return(a={})=>new Promise(r=>{a.outro?Aa(n,()=>{Xt(n),r(void 0)}):(Xt(n),r(void 0))})}function no(t){return Dn(Qs,t,!1)}function me(t,n){var a=pt,r={effect:null,ran:!1,deps:t};a.l.$.push(r),r.effect=is(()=>{t(),!r.ran&&(r.ran=!0,p(n))})}function In(){var t=pt;is(()=>{for(var n of t.l.$){n.deps();var a=n.effect;(a.f&It)!==0&&a.deps!==null&&Rt(a,Ln),os(a)&&es(a),n.ran=!1}})}function Zl(t){return Dn(Or|as,t,!0)}function is(t,n=0){return Dn(Ls|n,t,!0)}function X(t,n=[],a=[],r=[]){Fl(r,n,a,s=>{Dn(Ls,()=>t(...s.map(e)),!0)})}function Ur(t,n=0){var a=Dn(Vn|n,t,!0);return a}function cn(t){return Dn(Qn|as,t,!0)}function ao(t){var n=t.teardown;if(n!==null){const a=ma,r=Ve;ii(!0),zt(null);try{n.call(null)}finally{ii(a),zt(r)}}}function so(t,n=!1){var a=t.first;for(t.first=t.last=null;a!==null;){const s=a.ac;s!==null&&or(()=>{s.abort(Ka)});var r=a.next;(a.f&Da)!==0?a.parent=null:Xt(a,n),a=r}}function ec(t){for(var n=t.first;n!==null;){var a=n.next;(n.f&Qn)===0&&Xt(n),n=a}}function Xt(t,n=!0){var a=!1;(n||(t.f&Di)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(tc(t.nodes.start,t.nodes.end),a=!0),so(t,n&&!a),er(t,0),Rt(t,Kn);var r=t.nodes&&t.nodes.t;if(r!==null)for(const i of r)i.stop();ao(t);var s=t.parent;s!==null&&s.first!==null&&ro(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function tc(t,n){for(;t!==null;){var a=t===n?null:Is(t);t.remove(),t=a}}function ro(t){var n=t.parent,a=t.prev,r=t.next;a!==null&&(a.next=r),r!==null&&(r.prev=a),n!==null&&(n.first===t&&(n.first=r),n.last===t&&(n.last=a))}function Aa(t,n,a=!0){var r=[];io(t,r,!0);var s=()=>{a&&Xt(t),n&&n()},i=r.length;if(i>0){var o=()=>--i||s();for(var l of r)l.out(o)}else s()}function io(t,n,a){if((t.f&tn)===0){t.f^=tn;var r=t.nodes&&t.nodes.t;if(r!==null)for(const l of r)(l.is_global||a)&&n.push(l);for(var s=t.first;s!==null;){var i=s.next,o=(s.f&Qa)!==0||(s.f&Qn)!==0&&(t.f&Vn)!==0;io(s,n,o?a:!1),s=i}}}function Kr(t){oo(t,!0)}function oo(t,n){if((t.f&tn)!==0){t.f^=tn,(t.f&It)===0&&(Rt(t,qt),jn(t));for(var a=t.first;a!==null;){var r=a.next,s=(a.f&Qa)!==0||(a.f&Qn)!==0;oo(a,s?n:!1),a=r}var i=t.nodes&&t.nodes.t;if(i!==null)for(const o of i)(o.is_global||n)&&o.in()}}function lo(t,n){if(t.nodes)for(var a=t.nodes.start,r=t.nodes.end;a!==null;){var s=a===r?null:Is(a);n.append(a),a=s}}let Ua=null;function nc(t){var n=Ua;try{if(Ua=new Set,p(t),n!==null)for(var a of Ua)n.add(a);return Ua}finally{Ua=n}}function co(t){for(var n of nc(t))La(n,n.v)}let Ca=!1;function Zs(t){Ca=t}let ma=!1;function ii(t){ma=t}let Ve=null,gn=!1;function zt(t){Ve=t}let rt=null;function kn(t){rt=t}let Xn=null;function ac(t){Ve!==null&&(Xn===null?Xn=[t]:Xn.push(t))}let Bt=null,Qt=0,on=null;function sc(t){on=t}let uo=1,Cs=0,Ea=Cs;function oi(t){Ea=t}function mo(){return++uo}function os(t){var n=t.f;if((n&qt)!==0)return!0;if(n&Nt&&(t.f&=~Ra),(n&Ln)!==0){for(var a=t.deps,r=a.length,s=0;s<r;s++){var i=a[s];if(os(i)&&zi(i),i.wv>t.wv)return!0}(n&mn)!==0&&vn===null&&Rt(t,It)}return!1}function ho(t,n,a=!0){var r=t.reactions;if(r!==null&&!Xn?.includes(t))for(var s=0;s<r.length;s++){var i=r[s];(i.f&Nt)!==0?ho(i,n,!1):n===i&&(a?Rt(i,qt):(i.f&It)!==0&&Rt(i,Ln),jn(i))}}function fo(t){var n=Bt,a=Qt,r=on,s=Ve,i=Xn,o=pt,l=gn,c=Ea,u=t.f;Bt=null,Qt=0,on=null,Ve=(u&(Qn|Da))===0?t:null,Xn=null,Ja(t.ctx),gn=!1,Ea=++Cs,t.ac!==null&&(or(()=>{t.ac.abort(Ka)}),t.ac=null);try{t.f|=Tr;var d=t.fn,f=d(),m=t.deps;if(Bt!==null){var h;if(er(t,Qt),m!==null&&Qt>0)for(m.length=Qt+Bt.length,h=0;h<Bt.length;h++)m[Qt+h]=Bt[h];else t.deps=m=Bt;if(qr()&&(t.f&mn)!==0)for(h=Qt;h<m.length;h++)(m[h].reactions??=[]).push(t)}else m!==null&&Qt<m.length&&(er(t,Qt),m.length=Qt);if(Ds()&&on!==null&&!gn&&m!==null&&(t.f&(Nt|Ln|qt))===0)for(h=0;h<on.length;h++)ho(on[h],t);return s!==null&&s!==t&&(Cs++,on!==null&&(r===null?r=on:r.push(...on))),(t.f&la)!==0&&(t.f^=la),f}catch(y){return Hi(y)}finally{t.f^=Tr,Bt=n,Qt=a,on=r,Ve=s,Xn=i,Ja(o),gn=l,Ea=c}}function rc(t,n){let a=n.reactions;if(a!==null){var r=nl.call(a,t);if(r!==-1){var s=a.length-1;s===0?a=n.reactions=null:(a[r]=a[s],a.pop())}}if(a===null&&(n.f&Nt)!==0&&(Bt===null||!Bt.includes(n))){var i=n;(i.f&mn)!==0&&(i.f^=mn,i.f&=~Ra),Hr(i),Gi(i),er(i,0)}}function er(t,n){var a=t.deps;if(a!==null)for(var r=n;r<a.length;r++)rc(t,a[r])}function es(t){var n=t.f;if((n&Kn)===0){Rt(t,It);var a=rt,r=Ca;rt=t,Ca=!0;try{(n&(Vn|Li))!==0?ec(t):so(t),ao(t);var s=fo(t);t.teardown=typeof s=="function"?s:null,t.wv=uo;var i;br&&Ll&&(t.f&qt)!==0&&t.deps}finally{Ca=r,rt=a}}}async function ic(){await Promise.resolve(),Pl()}function e(t){var n=t.f,a=(n&Nt)!==0;if(Ua?.add(t),Ve!==null&&!gn){var r=rt!==null&&(rt.f&Kn)!==0;if(!r&&!Xn?.includes(t)){var s=Ve.deps;if((Ve.f&Tr)!==0)t.rv<Cs&&(t.rv=Cs,Bt===null&&s!==null&&s[Qt]===t?Qt++:Bt===null?Bt=[t]:Bt.includes(t)||Bt.push(t));else{(Ve.deps??=[]).push(t);var i=t.reactions;i===null?t.reactions=[Ve]:i.includes(Ve)||i.push(Ve)}}}if(ma&&ca.has(t))return ca.get(t);if(a){var o=t;if(ma){var l=o.v;return((o.f&It)===0&&o.reactions!==null||po(o))&&(l=Fr(o)),ca.set(o,l),l}var c=(o.f&mn)===0&&!gn&&Ve!==null&&(Ca||(Ve.f&mn)!==0),u=o.deps===null;os(o)&&(c&&(o.f|=mn),zi(o)),c&&!u&&yo(o)}if(vn?.has(t))return vn.get(t);if((t.f&la)!==0)throw t.v;return t.v}function yo(t){if(t.deps!==null){t.f|=mn;for(const n of t.deps)(n.reactions??=[]).push(t),(n.f&Nt)!==0&&(n.f&mn)===0&&yo(n)}}function po(t){if(t.v===Lt)return!0;if(t.deps===null)return!1;for(const n of t.deps)if(ca.has(n)||(n.f&Nt)!==0&&po(n))return!0;return!1}function p(t){var n=gn;try{return gn=!0,t()}finally{gn=n}}function se(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Gn in t)wr(t);else if(!Array.isArray(t))for(let n in t){const a=t[n];typeof a=="object"&&a&&Gn in a&&wr(a)}}}function wr(t,n=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!n.has(t)){n.add(t),t instanceof Date&&t.getTime();for(let r in t)try{wr(t[r],n)}catch{}const a=Nr(t);if(a!==Object.prototype&&a!==Array.prototype&&a!==Map.prototype&&a!==Set.prototype&&a!==Date.prototype){const r=Ri(a);for(let s in r){const i=r[s].get;if(i)try{i.call(t)}catch{}}}}}const oc=["touchstart","touchmove"];function lc(t){return oc.includes(t)}const cc=new Set,li=new Set;function uc(t,n,a,r={}){function s(i){if(r.capture||gs.call(n,i),!i.cancelBubble)return or(()=>a?.call(this,i))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?rs(()=>{n.addEventListener(t,s,r)}):n.addEventListener(t,s,r),s}function K(t,n,a,r,s){var i={capture:r,passive:s},o=uc(t,n,a,i);(n===document.body||n===window||n===document||n instanceof HTMLMediaElement)&&Ns(()=>{n.removeEventListener(t,o,i)})}let ci=null;function gs(t){var n=this,a=n.ownerDocument,r=t.type,s=t.composedPath?.()||[],i=s[0]||t.target;ci=t;var o=0,l=ci===t&&t.__root;if(l){var c=s.indexOf(l);if(c!==-1&&(n===document||n===window)){t.__root=n;return}var u=s.indexOf(n);if(u===-1)return;c<=u&&(o=c)}if(i=s[o]||t.target,i!==n){Mi(t,"currentTarget",{configurable:!0,get(){return i||a}});var d=Ve,f=rt;zt(null),kn(null);try{for(var m,h=[];i!==null;){var y=i.assignedSlot||i.parentNode||i.host||null;try{var v=i["__"+r];v!=null&&(!i.disabled||t.target===i)&&v.call(i,t)}catch(b){m?h.push(b):m=b}if(t.cancelBubble||y===n||y===null)break;i=y}if(m){for(let b of h)queueMicrotask(()=>{throw b});throw m}}finally{t.__root=n,delete t.currentTarget,zt(d),kn(f)}}}function vo(t){var n=document.createElement("template");return n.innerHTML=t.replaceAll("<!>","<!---->"),n.content}function ts(t,n){var a=rt;a.nodes===null&&(a.nodes={start:t,end:n,a:null,t:null})}function ye(t,n){var a=(n&Pi)!==0,r=(n&El)!==0,s,i=!t.startsWith("<!>");return()=>{s===void 0&&(s=vo(i?t:"<!>"+t),a||(s=Bn(s)));var o=r||Vi?document.importNode(s,!0):s.cloneNode(!0);if(a){var l=Bn(o),c=o.lastChild;ts(l,c)}else ts(o,o);return o}}function mc(t,n,a="svg"){var r=!t.startsWith("<!>"),s=(n&Pi)!==0,i=`<${a}>${r?t:"<!>"+t}</${a}>`,o;return()=>{if(!o){var l=vo(i),c=Bn(l);if(s)for(o=document.createDocumentFragment();Bn(c);)o.appendChild(Bn(c));else o=Bn(c)}var u=o.cloneNode(!0);if(s){var d=Bn(u),f=u.lastChild;ts(d,f)}else ts(u,u);return u}}function _e(t,n){return mc(t,n,"svg")}function go(t=""){{var n=zn(t+"");return ts(n,n),n}}function wt(){var t=document.createDocumentFragment(),n=document.createComment(""),a=zn();return t.append(n,a),ts(n,a),t}function D(t,n){t!==null&&t.before(n)}function we(t,n){var a=n==null?"":typeof n=="object"?n+"":n;a!==(t.__t??=t.nodeValue)&&(t.__t=a,t.nodeValue=a+"")}function dc(t,n){return hc(t,n)}const Fa=new Map;function hc(t,{target:n,anchor:a,props:r={},events:s,context:i,intro:o=!0}){zl();var l=new Set,c=f=>{for(var m=0;m<f.length;m++){var h=f[m];if(!l.has(h)){l.add(h);var y=lc(h);n.addEventListener(h,gs,{passive:y});var v=Fa.get(h);v===void 0?(document.addEventListener(h,gs,{passive:y}),Fa.set(h,1)):Fa.set(h,v+1)}}};c(sr(cc)),li.add(c);var u=void 0,d=Jl(()=>{var f=a??n.appendChild(zn());return Yl(f,{pending:()=>{}},m=>{if(i){Ut({});var h=pt;h.c=i}s&&(r.$$events=s),u=t(m,r)||{},i&&Kt()}),()=>{for(var m of l){n.removeEventListener(m,gs);var h=Fa.get(m);--h===0?(document.removeEventListener(m,gs),Fa.delete(m)):Fa.set(m,h)}li.delete(c),f!==a&&f.parentNode?.removeChild(f)}});return fc.set(u,d),u}let fc=new WeakMap;class yc{anchor;#t=new Map;#i=new Map;#e=new Map;#s=new Set;#r=!0;constructor(n,a=!0){this.anchor=n,this.#r=a}#a=()=>{var n=at;if(this.#t.has(n)){var a=this.#t.get(n),r=this.#i.get(a);if(r)Kr(r),this.#s.delete(a);else{var s=this.#e.get(a);s&&(this.#i.set(a,s.effect),this.#e.delete(a),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),r=s.effect)}for(const[i,o]of this.#t){if(this.#t.delete(i),i===n)break;const l=this.#e.get(o);l&&(Xt(l.effect),this.#e.delete(o))}for(const[i,o]of this.#i){if(i===a||this.#s.has(i))continue;const l=()=>{if(Array.from(this.#t.values()).includes(i)){var u=document.createDocumentFragment();lo(o,u),u.append(zn()),this.#e.set(i,{effect:o,fragment:u})}else Xt(o);this.#s.delete(i),this.#i.delete(i)};this.#r||!r?(this.#s.add(i),Aa(o,l,!1)):l()}}};#n=n=>{this.#t.delete(n);const a=Array.from(this.#t.values());for(const[r,s]of this.#e)a.includes(r)||(Xt(s.effect),this.#e.delete(r))};ensure(n,a){var r=at,s=Zi();if(a&&!this.#i.has(n)&&!this.#e.has(n))if(s){var i=document.createDocumentFragment(),o=zn();i.append(o),this.#e.set(n,{effect:cn(()=>a(o)),fragment:i})}else this.#i.set(n,cn(()=>a(this.anchor)));if(this.#t.set(r,n),s){for(const[l,c]of this.#i)l===n?r.skipped_effects.delete(c):r.skipped_effects.add(c);for(const[l,c]of this.#e)l===n?r.skipped_effects.delete(c.effect):r.skipped_effects.add(c.effect);r.oncommit(this.#a),r.ondiscard(this.#n)}else this.#a()}}function pe(t,n,a=!1){var r=new yc(t),s=a?Qa:0;function i(o,l){r.ensure(o,l)}Ur(()=>{var o=!1;n((l,c=!0)=>{o=!0,i(c,l)}),o||i(!1,null)},s)}function ze(t,n){return n}function pc(t,n,a){for(var r=[],s=n.length,i,o=n.length,l=0;l<s;l++){let f=n[l];Aa(f,()=>{if(i){if(i.pending.delete(f),i.done.add(f),i.pending.size===0){var m=t.outrogroups;Ar(sr(i.done)),m.delete(i),m.size===0&&(t.outrogroups=null)}}else o-=1},!1)}if(o===0){var c=r.length===0&&a!==null;if(c){var u=a,d=u.parentNode;Xl(d),d.append(u),t.items.clear()}Ar(n,!c)}else i={pending:new Set(n),done:new Set},(t.outrogroups??=new Set).add(i)}function Ar(t,n=!0){for(var a=0;a<t.length;a++)Xt(t[a],n)}var ui;function Le(t,n,a,r,s,i=null){var o=t,l=new Map,c=(n&Ni)!==0;if(c){var u=t;o=u.appendChild(zn())}var d=null,f=Ge(()=>{var S=a();return ks(S)?S:S==null?[]:sr(S)}),m,h=!0;function y(){b.fallback=d,vc(b,m,o,n,r),d!==null&&(m.length===0?(d.f&Un)===0?Kr(d):(d.f^=Un,bs(d,null,o)):Aa(d,()=>{d=null}))}var v=Ur(()=>{m=e(f);for(var S=m.length,R=new Set,M=at,_=Zi(),A=0;A<S;A+=1){var k=m[A],$=r(k,A),w=h?null:l.get($);w?(w.v&&La(w.v,k),w.i&&La(w.i,A),_&&M.skipped_effects.delete(w.e)):(w=gc(l,h?o:ui??=zn(),k,$,A,s,n,a),h||(w.e.f|=Un),l.set($,w)),R.add($)}if(S===0&&i&&!d&&(h?d=cn(()=>i(o)):(d=cn(()=>i(ui??=zn())),d.f|=Un)),!h)if(_){for(const[I,O]of l)R.has(I)||M.skipped_effects.add(O.e);M.oncommit(y),M.ondiscard(()=>{})}else y();e(f)}),b={effect:v,items:l,outrogroups:null,fallback:d};h=!1}function vc(t,n,a,r,s){var i=(r&Tl)!==0,o=n.length,l=t.items,c=t.effect.first,u,d=null,f,m=[],h=[],y,v,b,S;if(i)for(S=0;S<o;S+=1)y=n[S],v=s(y,S),b=l.get(v).e,(b.f&Un)===0&&(b.nodes?.a?.measure(),(f??=new Set).add(b));for(S=0;S<o;S+=1){if(y=n[S],v=s(y,S),b=l.get(v).e,t.outrogroups!==null)for(const O of t.outrogroups)O.pending.delete(b),O.done.delete(b);if((b.f&Un)!==0)if(b.f^=Un,b===c)bs(b,null,a);else{var R=d?d.next:c;b===t.effect.last&&(t.effect.last=b.prev),b.prev&&(b.prev.next=b.next),b.next&&(b.next.prev=b.prev),sa(t,d,b),sa(t,b,R),bs(b,R,a),d=b,m=[],h=[],c=d.next;continue}if((b.f&tn)!==0&&(Kr(b),i&&(b.nodes?.a?.unfix(),(f??=new Set).delete(b))),b!==c){if(u!==void 0&&u.has(b)){if(m.length<h.length){var M=h[0],_;d=M.prev;var A=m[0],k=m[m.length-1];for(_=0;_<m.length;_+=1)bs(m[_],M,a);for(_=0;_<h.length;_+=1)u.delete(h[_]);sa(t,A.prev,k.next),sa(t,d,A),sa(t,k,M),c=M,d=k,S-=1,m=[],h=[]}else u.delete(b),bs(b,c,a),sa(t,b.prev,b.next),sa(t,b,d===null?t.effect.first:d.next),sa(t,d,b),d=b;continue}for(m=[],h=[];c!==null&&c!==b;)(u??=new Set).add(c),h.push(c),c=c.next;if(c===null)continue}(b.f&Un)===0&&m.push(b),d=b,c=b.next}if(t.outrogroups!==null){for(const O of t.outrogroups)O.pending.size===0&&(Ar(sr(O.done)),t.outrogroups?.delete(O));t.outrogroups.size===0&&(t.outrogroups=null)}if(c!==null||u!==void 0){var $=[];if(u!==void 0)for(b of u)(b.f&tn)===0&&$.push(b);for(;c!==null;)(c.f&tn)===0&&c!==t.fallback&&$.push(c),c=c.next;var w=$.length;if(w>0){var I=(r&Ni)!==0&&o===0?a:null;if(i){for(S=0;S<w;S+=1)$[S].nodes?.a?.measure();for(S=0;S<w;S+=1)$[S].nodes?.a?.fix()}pc(t,$,I)}}i&&rs(()=>{if(f!==void 0)for(b of f)b.nodes?.a?.apply()})}function gc(t,n,a,r,s,i,o,l){var c=(o&gl)!==0?(o&xl)===0?W(a,!1,!1):ka(a):null,u=(o&bl)!==0?ka(s):null;return{v:c,i:u,e:cn(()=>(i(n,c??a,u??s,l),()=>{t.delete(r)}))}}function bs(t,n,a){if(t.nodes)for(var r=t.nodes.start,s=t.nodes.end,i=n&&(n.f&Un)===0?n.nodes.start:a;r!==null;){var o=Is(r);if(i.before(r),r===s)return;r=o}}function sa(t,n,a){n===null?t.effect.first=a:n.next=a,a===null?t.effect.last=n:a.prev=n}function bo(t,n,a,r,s){var i=n.$$slots?.[a],o=!1;i===!0&&(i=n.children,o=!0),i===void 0||i(t,o?()=>r:r)}const mi=[...` 	
\r\fÂ \v\uFEFF`];function bc(t,n,a){var r=t==null?"":""+t;if(a){for(var s in a)if(a[s])r=r?r+" "+s:s;else if(r.length)for(var i=s.length,o=0;(o=r.indexOf(s,o))>=0;){var l=o+i;(o===0||mi.includes(r[o-1]))&&(l===r.length||mi.includes(r[l]))?r=(o===0?"":r.substring(0,o))+r.substring(l+1):o=l}}return r===""?null:r}function Tc(t,n){return t==null?null:String(t)}function dn(t,n,a,r,s,i){var o=t.__className;if(o!==a||o===void 0){var l=bc(a,r,i);l==null?t.removeAttribute("class"):n?t.className=l:t.setAttribute("class",l),t.__className=a}else if(i&&s!==i)for(var c in i){var u=!!i[c];(s==null||u!==!!s[c])&&t.classList.toggle(c,u)}return i}function xc(t,n,a,r){var s=t.__style;if(s!==n){var i=Tc(n);i==null?t.removeAttribute("style"):t.style.cssText=i,t.__style=n}return r}function To(t,n,a=!1){if(t.multiple){if(n==null)return;if(!ks(n))return Rl();for(var r of t.options)r.selected=n.includes(As(r));return}for(r of t.options){var s=As(r);if(Gl(s,n)){r.selected=!0;return}}(!a||n!==void 0)&&(t.selectedIndex=-1)}function _c(t){var n=new MutationObserver(()=>{To(t,t.__value)});n.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ns(()=>{n.disconnect()})}function xo(t,n,a=n){var r=new WeakSet,s=!0;Br(t,"change",i=>{var o=i?"[selected]":":checked",l;if(t.multiple)l=[].map.call(t.querySelectorAll(o),As);else{var c=t.querySelector(o)??t.querySelector("option:not([disabled])");l=c&&As(c)}a(l),at!==null&&r.add(at)}),no(()=>{var i=n();if(t===document.activeElement){var o=_s??at;if(r.has(o))return}if(To(t,i,s),s&&i===void 0){var l=t.querySelector(":checked");l!==null&&(i=As(l),a(i))}t.__value=i,s=!1}),_c(t)}function As(t){return"__value"in t?t.__value:t.value}const Sc=Symbol("is custom element"),wc=Symbol("is html");function Ac(t,n){var a=_o(t);a.value===(a.value=n??void 0)||t.value===n&&(n!==0||t.nodeName!=="PROGRESS")||(t.value=n??"")}function g(t,n,a,r){var s=_o(t);s[n]!==(s[n]=a)&&(n==="loading"&&(t[ol]=a),a==null?t.removeAttribute(n):typeof a!="string"&&Cc(t).includes(n)?t[n]=a:t.setAttribute(n,a))}function _o(t){return t.__attributes??={[Sc]:t.nodeName.includes("-"),[wc]:t.namespaceURI===Ml}}var di=new Map;function Cc(t){var n=t.getAttribute("is")||t.nodeName,a=di.get(n);if(a)return a;di.set(n,a=[]);for(var r,s=t,i=Element.prototype;i!==s;){r=Ri(s);for(var o in r)r[o].set&&a.push(o);s=Nr(s)}return a}function Ht(t,n,a=n){var r=new WeakSet;Br(t,"input",async s=>{var i=s?t.defaultValue:t.value;if(i=yr(t)?pr(i):i,a(i),at!==null&&r.add(at),await ic(),i!==(i=n())){var o=t.selectionStart,l=t.selectionEnd,c=t.value.length;if(t.value=i??"",l!==null){var u=t.value.length;o===l&&l===c&&u>c?(t.selectionStart=u,t.selectionEnd=u):(t.selectionStart=o,t.selectionEnd=Math.min(l,u))}}}),p(n)==null&&t.value&&(a(yr(t)?pr(t.value):t.value),at!==null&&r.add(at)),is(()=>{var s=n();if(t===document.activeElement){var i=_s??at;if(r.has(i))return}yr(t)&&s===pr(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function ba(t,n,a=n){Br(t,"change",r=>{var s=r?t.defaultChecked:t.checked;a(s)}),p(n)==null&&a(t.checked),is(()=>{var r=n();t.checked=!!r})}function yr(t){var n=t.type;return n==="number"||n==="range"}function pr(t){return t===""?null:+t}function Ts(t,n,a){var r=wa(t,n);r&&r.set&&(t[n]=a,Ns(()=>{t[n]=null}))}function hi(t,n){return t===n||t?.[Gn]===n}function Es(t={},n,a,r){return no(()=>{var s,i;return is(()=>{s=i,i=[],p(()=>{t!==a(...i)&&(n(t,...i),s&&hi(a(...s),t)&&n(null,...s))})}),()=>{rs(()=>{i&&hi(a(...i),t)&&n(null,...i)})}}),t}function fi(t){return function(...n){var a=n[0];return a.stopPropagation(),t?.apply(this,n)}}function jt(t=!1){const n=pt,a=n.l.u;if(!a)return;let r=()=>se(n.s);if(t){let s=0,i={};const o=ir(()=>{let l=!1;const c=n.s;for(const u in c)c[u]!==i[u]&&(i[u]=c[u],l=!0);return l&&s++,s});r=()=>e(o)}a.b.length&&Ql(()=>{yi(n,r),Vs(a.b)}),Sr(()=>{const s=p(()=>a.m.map(rl));return()=>{for(const i of s)typeof i=="function"&&i()}}),a.a.length&&Sr(()=>{yi(n,r),Vs(a.a)})}function yi(t,n){if(t.l.s)for(const a of t.l.s)e(a);n()}function pi(t,n){var a=t.$$events?.[n.type],r=ks(a)?a.slice():a==null?[]:[a];for(var s of r)s.call(this,n)}function Gr(t,n,a){if(t==null)return n(void 0),a&&a(void 0),oa;const r=p(()=>t.subscribe(n,a));return r.unsubscribe?()=>r.unsubscribe():r}const Ba=[];function Ec(t,n){return{subscribe:Tt(t,n).subscribe}}function Tt(t,n=oa){let a=null;const r=new Set;function s(l){if(Oi(t,l)&&(t=l,a)){const c=!Ba.length;for(const u of r)u[1](),Ba.push(u,t);if(c){for(let u=0;u<Ba.length;u+=2)Ba[u][0](Ba[u+1]);Ba.length=0}}}function i(l){s(l(t))}function o(l,c=oa){const u=[l,c];return r.add(u),r.size===1&&(a=n(s,i)||oa),l(t),()=>{r.delete(u),r.size===0&&a&&(a(),a=null)}}return{set:s,update:i,subscribe:o}}function nn(t,n,a){const r=!Array.isArray(t),s=r?[t]:t;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=n.length<2;return Ec(a,(o,l)=>{let c=!1;const u=[];let d=0,f=oa;const m=()=>{if(d)return;f();const y=n(r?u[0]:u,o,l);i?o(y):f=typeof y=="function"?y:oa},h=s.map((y,v)=>Gr(y,b=>{u[v]=b,d&=~(1<<v),c&&m()},()=>{d|=1<<v}));return c=!0,m(),function(){Vs(h),f(),c=!1}})}function Zt(t){let n;return Gr(t,a=>n=a)(),n}let Fs=!1,Cr=Symbol();function lt(t,n,a){const r=a[n]??={store:null,source:W(void 0),unsubscribe:oa};if(r.store!==t&&!(Cr in a))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=oa;else{var s=!0;r.unsubscribe=Gr(t,i=>{s?r.source.v=i:T(r.source,i)}),s=!1}return t&&Cr in a?Zt(t):e(r.source)}function Mc(t,n){return t.set(n),n}function ls(){const t={};function n(){Ns(()=>{for(var a in t)t[a].unsubscribe();Mi(t,Cr,{enumerable:!1,value:!0})})}return[t,n]}function Rc(t){var n=Fs;try{return Fs=!1,[t(),Fs]}finally{Fs=n}}function Ce(t,n,a,r){var s=!ss||(a&Sl)!==0,i=(a&Al)!==0,o=(a&Cl)!==0,l=r,c=!0,u=()=>(c&&(c=!1,l=o?p(r):r),l),d;if(i){var f=Gn in t||il in t;d=wa(t,n)?.set??(f&&n in t?M=>t[n]=M:void 0)}var m,h=!1;i?[m,h]=Rc(()=>t[n]):m=t[n],m===void 0&&r!==void 0&&(m=u(),d&&(s&&hl(),d(m)));var y;if(s?y=()=>{var M=t[n];return M===void 0?u():(c=!0,M)}:y=()=>{var M=t[n];return M!==void 0&&(l=void 0),M===void 0?l:M},s&&(a&wl)===0)return y;if(d){var v=t.$$legacy;return(function(M,_){return arguments.length>0?((!s||!_||v||h)&&d(_?y():M),M):y()})}var b=!1,S=((a&_l)!==0?ir:Ge)(()=>(b=!1,y()));i&&e(S);var R=rt;return(function(M,_){if(arguments.length>0){const A=_?e(S):s&&i?Ga(M):M;return T(S,A),b=!0,l!==void 0&&(l=A),M}return ma&&b||(R.f&Kn)!==0?S.v:e(S)})}function cs(t){pt===null&&Yr(),ss&&pt.l!==null?Lc(pt).m.push(t):Sr(()=>{const n=p(t);if(typeof n=="function")return n})}function So(t){pt===null&&Yr(),cs(()=>()=>p(t))}function kc(t,n,{bubbles:a=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:n,bubbles:a,cancelable:r})}function zr(){const t=pt;return t===null&&Yr(),(n,a,r)=>{const s=t.s.$$events?.[n];if(s){const i=ks(s)?s.slice():[s],o=kc(n,a,r);for(const l of i)l.call(t.x,o);return!o.defaultPrevented}return!0}}function Lc(t){var n=t.l;return n.u??={a:[],b:[],m:[]}}const Dc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Dc);Dl();function Ic(t,n,a,r){const s=Xa(a,r,t),i=Xa(a,r,n),o=Xa(t,n,a),l=Xa(t,n,r);return!!((s>0&&i<0||s<0&&i>0)&&(o>0&&l<0||o<0&&l>0)||s===0&&Bs(a,r,t)||i===0&&Bs(a,r,n)||o===0&&Bs(t,n,a)||l===0&&Bs(t,n,r))}function Xa(t,n,a){return(a.x-t.x)*(n.y-t.y)-(n.x-t.x)*(a.y-t.y)}function Bs(t,n,a){return Math.min(t.x,n.x)<=a.x&&a.x<=Math.max(t.x,n.x)&&Math.min(t.y,n.y)<=a.y&&a.y<=Math.max(t.y,n.y)}function vi(t,n,a,r=16){const s=[];for(let i=0;i<r;i++){const o=2*Math.PI*i/r;s.push({x:t+a*Math.cos(o),y:n+a*Math.sin(o)})}return s}function Nc(t,n,a,r,s=0,i=16){const o=[],l=2*(a+r),c=s*Math.PI/180,u=Math.cos(c),d=Math.sin(c),f=i/l,m=Math.max(1,Math.round(a*f)),h=Math.max(1,Math.round(r*f)),y=a/2,v=r/2,b=[];for(let S=0;S<m;S++){const R=S/m;b.push({x:-y+a*R,y:-v})}for(let S=0;S<h;S++){const R=S/h;b.push({x:y,y:-v+r*R})}for(let S=0;S<m;S++){const R=S/m;b.push({x:y-a*R,y:v})}for(let S=0;S<h;S++){const R=S/h;b.push({x:-y,y:v-r*R})}for(const S of b)o.push({x:t+S.x*u-S.y*d,y:n+S.x*d+S.y*u});if(o.length>i){const S=[],R=o.length/i;for(let M=0;M<i;M++)S.push(o[Math.floor(M*R)]);return S}return o}function Pc(t,n,a,r,s=0,i=16){const o=[],l=s*Math.PI/180,c=Math.cos(l),u=Math.sin(l);for(let d=0;d<i;d++){const f=2*Math.PI*d/i,m=a*Math.cos(f),h=r*Math.sin(f);o.push({x:t+m*c-h*u,y:n+m*u+h*c})}return o}function gi(t,n,a){const r=a.length;for(let s=0;s<r;s++){const i=a[s],o=a[(s+1)%r];if(Ic(t,n,i,o))return!0}return!1}function wo(t,n,a){const r=a*Math.PI/180,s=Math.cos(r),i=Math.sin(r),o=t.x-n.x,l=t.y-n.y;return{x:n.x+o*s-l*i,y:n.y+o*i+l*s}}function Ao(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function Ms(t){const n=Ao(t),a=t.rotation||0;return[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}].map(s=>wo(s,n,a))}function $c(t){const s=t.x,i=t.y+t.height;return[{x:s,y:i},{x:s,y:i-8},{x:s+.5,y:i-8},{x:s+.5,y:i-.5},{x:s+4,y:i-.5},{x:s+4,y:i}]}function Oc(t){const n=$c(t),a=Ao(t),r=t.rotation||0;return n.map(s=>wo(s,a,r))}function Wc(t,n,a,r,s=.01){const i=Math.abs(Xa(t,n,a)),o=Math.abs(Xa(t,n,r)),l=Math.sqrt((n.x-t.x)**2+(n.y-t.y)**2),c=s*l;if(i>c||o>c)return!1;const u=n.x-t.x,d=n.y-t.y,f=Math.sqrt(u*u+d*d);if(f<s)return!1;const m=u/f,h=d/f,y=0,v=f,b=(a.x-t.x)*m+(a.y-t.y)*h,S=(r.x-t.x)*m+(r.y-t.y)*h,R=Math.min(y,v),M=Math.max(y,v),_=Math.min(b,S),A=Math.max(b,S),k=Math.max(R,_);return Math.min(M,A)-k>s}function Yc(t,n,a=.1){const r=t.length,s=n.length;for(let i=0;i<r;i++){const o=t[i],l=t[(i+1)%r];for(let c=0;c<s;c++){const u=n[c],d=n[(c+1)%s];if(Wc(o,l,u,d,a))return!0}}return!1}function Hc(t){const n=t.length;if(n===0)return new Map;const a=Array.from({length:n},(l,c)=>c);function r(l){return a[l]!==l&&(a[l]=r(a[l])),a[l]}function s(l,c){const u=r(l),d=r(c);u!==d&&(a[u]=d)}for(let l=0;l<n;l++)for(let c=l+1;c<n;c++)Yc(t[l].vertices,t[c].vertices)&&s(l,c);const i=new Map;t.forEach((l,c)=>i.set(l.id,c));const o=new Map;return t.forEach((l,c)=>{o.set(l.id,r(c))}),o}function Fc(t,n,a){const r=n.get(t);return r===void 0?[t]:a.filter(s=>n.get(s.id)===r).map(s=>s.id)}const qs=16;function Er(t){return t.isRectangle&&t.width!==void 0&&t.height!==void 0?Nc(t.x,t.y,t.width,t.height,t.rotation||0,qs):t.radius!==void 0?vi(t.x,t.y,t.radius,qs):t.rx!==void 0&&t.ry!==void 0?Pc(t.x,t.y,t.rx,t.ry,t.rotation||0,qs):vi(t.x,t.y,.5,qs)}function bi(t,n){const a=Er(t);for(const r of a)if(Ti(r,n))return!0;return!!Ti({x:t.x,y:t.y},n)}function Ti(t,n){const a=n.length;let r=null;for(let s=0;s<a;s++){const i=n[s],o=n[(s+1)%a],l=(o.x-i.x)*(t.y-i.y)-(o.y-i.y)*(t.x-i.x);if(l!==0){const c=l>0;if(r===null)r=c;else if(r!==c)return!1}}return!0}function Co(t,n,a,r){const s=Er(t),i=Er(n),o=Hc(a),l=new Set;for(const f of a){const m=bi(t,f.vertices),h=bi(n,f.vertices);if(m||h){const y=Fc(f.id,o,a);for(const v of y)l.add(v)}}const c=[];let u=!1,d=null;for(const f of s)for(const m of i){const h={from:f,to:m,blocked:!1,blockedBy:null};let y=!1;for(const b of a)if(!l.has(b.id)&&gi(f,m,b.vertices)){h.blocked=!0,h.blockedBy="terrain",y=!0;break}if(y){c.push(h);continue}let v=!1;for(const b of r)if(gi(f,m,b)){h.blocked=!0,h.blockedBy="wall",v=!0;break}v||(h.blocked=!1,u||(d=h),u=!0),c.push(h)}return{canSee:u,rays:c,firstClearRay:d,terrainsIgnored:Array.from(l)}}const We={width:60,height:44},Eo=Tt([{id:"terrain1",x:20,y:16,width:6,height:12,rotation:0},{id:"terrain2",x:34,y:10,width:6,height:12,rotation:45},{id:"terrain3",x:44,y:20,width:6,height:12,rotation:-30}]);nn(Eo,t=>t.map(n=>Oc(n)));nn(Eo,t=>t.map(n=>({id:n.id,vertices:Ms(n)})));const xi=Tt(!1);var Bc=_e('<line stroke="#3a4a3a" stroke-width="0.05"></line>'),qc=_e('<line stroke="#3a4a3a" stroke-width="0.05"></line>'),Uc=_e('<line stroke="#5a6a5a" stroke-width="0.08"></line>'),Kc=_e('<line stroke="#5a6a5a" stroke-width="0.08"></line>'),Gc=_e('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),zc=_e('<line stroke="#666"></line><!>',1),Xc=_e('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),jc=_e('<line stroke="#666"></line><!>',1),Vc=_e('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),Qc=_e('<line stroke="#666"></line><!>',1),Jc=_e('<text text-anchor="middle" class="ruler-text svelte-n43bnt"> </text>'),Zc=_e('<line stroke="#666"></line><!>',1),eu=_e('<svg preserveAspectRatio="xMidYMid meet"><rect x="0" y="0" fill="#1a1a1a"></rect><rect fill="#4a5a4a"></rect><!><!><!><!><!><!><!><!><g><!></g></svg>');function lr(t,n){Ut(n,!1);const a=W(),r=W(),s=W(),i=W(),o=W(),l=W(),c=W();let u=W();const d=2,f=We.width+d*2,m=We.height+d*2;let h=W(1),y=W(0),v=W(0),b=W(!1),S={x:0,y:0},R=W(!1);const M=.5,_=4;function A(G,oe){if(!e(u))return{x:0,y:0};const ke=e(u).createSVGPoint();ke.x=G,ke.y=oe;const ce=ke.matrixTransform(e(u).getScreenCTM().inverse());return{x:ce.x-d,y:ce.y-d}}function k(G){G.preventDefault();const oe=e(u).getBoundingClientRect(),ke=G.clientX-oe.left,ce=G.clientY-oe.top,xt=e(s)+ke/oe.width*e(a),ht=e(i)+ce/oe.height*e(r),Ye=G.deltaY>0?.9:1.1,De=Math.max(M,Math.min(_,e(h)*Ye)),vt=f/De,Je=m/De,Qe=xt-ke/oe.width*vt,U=ht-ce/oe.height*Je;T(h,De),T(y,Qe),T(v,U)}function $(G){(G.button===1||G.button===0&&e(R))&&(G.preventDefault(),T(b,!0),S={x:G.clientX,y:G.clientY})}function w(G){if(!e(b))return;const oe=e(u).getBoundingClientRect(),ke=(G.clientX-S.x)/oe.width*e(a),ce=(G.clientY-S.y)/oe.height*e(r);T(y,e(y)-ke),T(v,e(v)-ce),S={x:G.clientX,y:G.clientY}}function I(){T(b,!1)}function O(G){G.code==="Space"&&!G.repeat&&G.target.tagName!=="INPUT"&&(G.preventDefault(),T(R,!0))}function he(G){G.code==="Space"&&T(R,!1)}function V(){T(h,1),T(y,0),T(v,0)}me(()=>e(h),()=>{T(a,f/e(h))}),me(()=>e(h),()=>{T(r,m/e(h))}),me(()=>e(y),()=>{T(s,e(y))}),me(()=>e(v),()=>{T(i,e(v))}),me(()=>(e(s),e(i),e(a),e(r)),()=>{T(o,`${e(s)} ${e(i)} ${e(a)} ${e(r)}`)}),me(()=>We,()=>{T(l,Array.from({length:We.width+1},(G,oe)=>oe))}),me(()=>We,()=>{T(c,Array.from({length:We.height+1},(G,oe)=>oe))}),In();var Z={screenToSvg:A};jt();var ne=eu();K("keydown",za,O),K("keyup",za,he),K("mouseup",za,I),K("mousemove",za,w);let z;var J=E(ne),ie=x(J);g(ie,"x",d),g(ie,"y",d);var le=x(ie);Le(le,1,()=>(se(We),p(()=>Array(We.width+1))),ze,(G,oe,ke)=>{var ce=Bc();g(ce,"x1",d+ke),g(ce,"y1",d),g(ce,"x2",d+ke),X(()=>g(ce,"y2",(se(We),p(()=>d+We.height)))),D(G,ce)});var be=x(le);Le(be,1,()=>(se(We),p(()=>Array(We.height+1))),ze,(G,oe,ke)=>{var ce=qc();g(ce,"x1",d),g(ce,"y1",d+ke),g(ce,"y2",d+ke),X(()=>g(ce,"x2",(se(We),p(()=>d+We.width)))),D(G,ce)});var te=x(be);Le(te,1,()=>(se(We),p(()=>Array(Math.floor(We.width/6)+1))),ze,(G,oe,ke)=>{var ce=Uc();g(ce,"x1",d+ke*6),g(ce,"y1",d),g(ce,"x2",d+ke*6),X(()=>g(ce,"y2",(se(We),p(()=>d+We.height)))),D(G,ce)});var N=x(te);Le(N,1,()=>(se(We),p(()=>Array(Math.floor(We.height/6)+1))),ze,(G,oe,ke)=>{var ce=Kc();g(ce,"x1",d),g(ce,"y1",d+ke*6),g(ce,"y2",d+ke*6),X(()=>g(ce,"x2",(se(We),p(()=>d+We.width)))),D(G,ce)});var q=x(N);Le(q,1,()=>e(l),ze,(G,oe)=>{var ke=zc(),ce=Re(ke);g(ce,"y2",d);var xt=x(ce);{var ht=Ye=>{var De=Gc();g(De,"y",1.2);var vt=E(De);X(()=>{g(De,"x",d+e(oe)),we(vt,`${e(oe)??""}"`)}),D(Ye,De)};pe(xt,Ye=>{e(oe)%6===0&&Ye(ht)})}X(()=>{g(ce,"x1",d+e(oe)),g(ce,"y1",e(oe)%6===0?.5:d-.8),g(ce,"x2",d+e(oe)),g(ce,"stroke-width",e(oe)%6===0?.08:.04)}),D(G,ke)});var j=x(q);Le(j,1,()=>e(l),ze,(G,oe)=>{var ke=jc(),ce=Re(ke),xt=x(ce);{var ht=Ye=>{var De=Xc(),vt=E(De);X(()=>{g(De,"x",d+e(oe)),g(De,"y",(se(We),p(()=>d+We.height+1.8))),we(vt,`${e(oe)??""}"`)}),D(Ye,De)};pe(xt,Ye=>{e(oe)%6===0&&Ye(ht)})}X(()=>{g(ce,"x1",d+e(oe)),g(ce,"y1",(se(We),p(()=>d+We.height))),g(ce,"x2",d+e(oe)),g(ce,"y2",(se(We),e(oe),p(()=>d+We.height+(e(oe)%6===0?1.5:.8)))),g(ce,"stroke-width",e(oe)%6===0?.08:.04)}),D(G,ke)});var F=x(j);Le(F,1,()=>e(c),ze,(G,oe)=>{var ke=Qc(),ce=Re(ke);g(ce,"x2",d);var xt=x(ce);{var ht=Ye=>{var De=Vc();g(De,"x",1);var vt=E(De);X(()=>{g(De,"y",d+e(oe)+.35),we(vt,`${e(oe)??""}"`)}),D(Ye,De)};pe(xt,Ye=>{e(oe)%6===0&&Ye(ht)})}X(()=>{g(ce,"x1",e(oe)%6===0?.5:d-.8),g(ce,"y1",d+e(oe)),g(ce,"y2",d+e(oe)),g(ce,"stroke-width",e(oe)%6===0?.08:.04)}),D(G,ke)});var H=x(F);Le(H,1,()=>e(c),ze,(G,oe)=>{var ke=Zc(),ce=Re(ke),xt=x(ce);{var ht=Ye=>{var De=Jc(),vt=E(De);X(()=>{g(De,"x",(se(We),p(()=>d+We.width+1))),g(De,"y",d+e(oe)+.35),we(vt,`${e(oe)??""}"`)}),D(Ye,De)};pe(xt,Ye=>{e(oe)%6===0&&Ye(ht)})}X(()=>{g(ce,"x1",(se(We),p(()=>d+We.width))),g(ce,"y1",d+e(oe)),g(ce,"x2",(se(We),e(oe),p(()=>d+We.width+(e(oe)%6===0?1.5:.8)))),g(ce,"y2",d+e(oe)),g(ce,"stroke-width",e(oe)%6===0?.08:.04)}),D(G,ke)});var $e=x(H);g($e,"transform","translate(2, 2)");var Ue=E($e);return bo(Ue,n,"default",{screenToSvg:A}),Es(ne,G=>T(u,G),()=>e(u)),X(()=>{g(ne,"viewBox",e(o)),z=dn(ne,0,"battlefield svelte-n43bnt",null,z,{panning:e(b)||e(R)}),g(J,"width",(se(We),p(()=>We.width+d*2))),g(J,"height",(se(We),p(()=>We.height+d*2))),g(ie,"width",(se(We),p(()=>We.width))),g(ie,"height",(se(We),p(()=>We.height)))}),K("wheel",ne,k),K("mousedown",ne,$),K("dblclick",ne,V),D(t,ne),Ts(n,"screenToSvg",A),Kt(Z)}var tu=_e('<line stroke="#3b82f6" stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" fill="#3b82f6" stroke="#1d4ed8" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-trljjm"></circle>',1),nu=_e('<g><g><rect role="button" tabindex="0" class="svelte-trljjm"></rect></g><!></g>');function Mo(t,n){Ut(n,!1);const a=W(),r=W(),s=W(),i=W(),o=W();let l=Ce(n,"id",8),c=Ce(n,"x",8),u=Ce(n,"y",8),d=Ce(n,"width",8),f=Ce(n,"height",8),m=Ce(n,"rotation",8,0),h=Ce(n,"selected",8,!1),y=Ce(n,"screenToSvg",8),v=Ce(n,"onSelect",8,()=>{}),b=Ce(n,"onDrag",8,()=>{}),S=Ce(n,"onRotate",8,()=>{}),R=W(!1),M=!1,_={x:0,y:0};function A(le){le.stopPropagation(),v()(l())}function k(le){if(le.button!==0)return;le.preventDefault(),le.stopPropagation(),v()(l()),T(R,!0);const be=y()(le.clientX,le.clientY);_={x:be.x-c(),y:be.y-u()},window.addEventListener("mousemove",$),window.addEventListener("mouseup",w)}function $(le){if(!e(R))return;const be=y()(le.clientX,le.clientY);let te=be.x-_.x,N=be.y-_.y;le.shiftKey||(te=Math.round(te),N=Math.round(N));const q=Math.max(d(),f())/2;te=Math.max(-q,Math.min(We.width-d()+q,te)),N=Math.max(-q,Math.min(We.height-f()+q,N)),b()(l(),te,N)}function w(){T(R,!1),window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",w)}function I(le){le.preventDefault(),le.stopPropagation(),M=!0,window.addEventListener("mousemove",O),window.addEventListener("mouseup",he)}function O(le){if(!M)return;const be=y()(le.clientX,le.clientY),te=be.x-e(a),N=be.y-e(r);let q=Math.atan2(N,te)*180/Math.PI+45;le.shiftKey||(q=Math.round(q/15)*15),S()(l(),q)}function he(){M=!1,window.removeEventListener("mousemove",O),window.removeEventListener("mouseup",he)}me(()=>(se(c()),se(d())),()=>{T(a,c()+d()/2)}),me(()=>(se(u()),se(f())),()=>{T(r,u()+f()/2)}),me(()=>(se(d()),se(f())),()=>{T(s,Math.max(d(),f())/2+1.5)}),me(()=>(e(a),e(s),se(m())),()=>{T(i,e(a)+e(s)*Math.cos((m()-45)*Math.PI/180))}),me(()=>(e(r),e(s),se(m())),()=>{T(o,e(r)+e(s)*Math.sin((m()-45)*Math.PI/180))}),In(),jt();var V=nu();let Z;var ne=E(V),z=E(ne),J=x(ne);{var ie=le=>{var be=tu(),te=Re(be),N=x(te);X(()=>{g(te,"x1",e(a)),g(te,"y1",e(r)),g(te,"x2",e(i)),g(te,"y2",e(o)),g(N,"cx",e(i)),g(N,"cy",e(o))}),K("mousedown",N,I),D(le,be)};pe(J,le=>{h()&&le(ie)})}X(()=>{Z=dn(V,0,"terrain-rect svelte-trljjm",null,Z,{selected:h(),dragging:e(R)}),g(ne,"transform",`rotate(${m()??""}, ${e(a)??""}, ${e(r)??""})`),g(z,"x",c()),g(z,"y",u()),g(z,"width",d()),g(z,"height",f()),g(z,"fill",h()?"rgba(59, 130, 246, 0.3)":"rgba(139, 90, 43, 0.3)"),g(z,"stroke",h()?"#3b82f6":"#8b5a2b"),g(z,"stroke-width",h()?.15:.1)}),K("click",z,A),K("mousedown",z,k),D(t,V),Kt()}const Ro="warhammer-deployment-layouts",ko=[{label:'6" x 12"',width:6,height:12},{label:'5" x 10"',width:5,height:10},{label:'4" x 6"',width:4,height:6}],Mr=[{label:"L 4x8",shape:"L-4x8"},{label:"L 4x8 â",shape:"L-4x8-mirror"},{label:"C 4-8-4",shape:"C-4-8-4"},{label:"L 5x6",shape:"L-5x6"},{label:"L 5x6 â",shape:"L-5x6-mirror"},{label:"L 4x6",shape:"L-4x6"},{label:"L 4x6 â",shape:"L-4x6-mirror"}],Xr=[{name:"Layout 1",terrains:[{id:"a",x:28,y:0,width:4,height:6,rotation:0},{id:"b",x:28,y:38,width:4,height:6,rotation:0},{id:"c",x:6,y:5,width:6,height:12,rotation:0},{id:"d",x:48,y:27,width:6,height:12,rotation:0},{id:"e",x:16,y:28,width:6,height:12,rotation:0},{id:"f",x:7,y:19,width:6,height:12,rotation:90},{id:"g",x:38,y:4,width:6,height:12,rotation:0},{id:"h",x:47,y:13,width:6,height:12,rotation:90},{id:"i",x:32.74,y:23.59,width:5,height:10,rotation:135},{id:"j",x:35.06,y:19.5,width:4,height:6,rotation:45},{id:"k",x:22.07,y:10.17,width:5,height:10,rotation:-45},{id:"l",x:20.72,y:18.23,width:4,height:6,rotation:45}],walls:[{id:"wa",x:38,y:6,shape:"C-4-8-4",rotation:0},{id:"wb",x:18,y:30,shape:"C-4-8-4",rotation:180},{id:"wc",x:13.33,y:20.15,shape:"L-4x8-mirror",rotation:-90},{id:"wd",x:49.67,y:15.93,shape:"L-4x8-mirror",rotation:90},{id:"we",x:48.2,y:30.88,shape:"L-4x8",rotation:0},{id:"wf",x:7.84,y:5.01,shape:"L-4x8",rotation:180},{id:"wg",x:27.06,y:11.52,shape:"L-4x8-mirror",rotation:-45},{id:"wh",x:35.81,y:24.24,shape:"L-4x8-mirror",rotation:135}]},{name:"Layout 2",terrains:[{id:"a",x:31,y:7,width:4,height:6,rotation:-90},{id:"b",x:25,y:30,width:4,height:6,rotation:90},{id:"c",x:5,y:4,width:6,height:12,rotation:0},{id:"d",x:49,y:28,width:6,height:12,rotation:0},{id:"e",x:46,y:4,width:6,height:12,rotation:0},{id:"f",x:16.32,y:16.13,width:6,height:12,rotation:135},{id:"g",x:53,y:15,width:4,height:6,rotation:90},{id:"h",x:8,y:28,width:6,height:12,rotation:0},{id:"i",x:3,y:23,width:4,height:6,rotation:90},{id:"j",x:32.62,y:32.55,width:5,height:10,rotation:-90},{id:"k",x:22.48,y:.51,width:5,height:10,rotation:-90},{id:"l",x:37,y:16,width:6,height:12,rotation:135}],walls:[{id:"wa",x:49,y:32,shape:"L-4x8",rotation:0},{id:"wb",x:7,y:4,shape:"L-4x8",rotation:180},{id:"wc",x:46,y:8,shape:"L-4x8",rotation:0},{id:"wd",x:10,y:28,shape:"L-4x8",rotation:180},{id:"we",x:35.07,y:34.56,shape:"L-5x6-mirror",rotation:-90},{id:"wf",x:29.09,y:2.47,shape:"L-5x6-mirror",rotation:90},{id:"wg",x:17.86,y:17.53,shape:"C-4-8-4",rotation:135},{id:"wh",x:37.24,y:18.38,shape:"C-4-8-4",rotation:-45}]},{name:"Layout 3",terrains:[{id:"a",x:11,y:3,width:4,height:6,rotation:90},{id:"b",x:45,y:35,width:4,height:6,rotation:90},{id:"c",x:25,y:1,width:6,height:12,rotation:90},{id:"d",x:29,y:31,width:6,height:12,rotation:90},{id:"e",x:7.74,y:26.05,width:6,height:12,rotation:125.31},{id:"f",x:46.34,y:5.51,width:6,height:12,rotation:121.72},{id:"g",x:5.14,y:10.46,width:6,height:12,rotation:41.51},{id:"h",x:48.67,y:21.52,width:6,height:12,rotation:41.51},{id:"i",x:19.59,y:14.36,width:5,height:10,rotation:-38.13},{id:"j",x:20.69,y:24.37,width:4,height:6,rotation:-39.33},{id:"k",x:35.34,y:19.61,width:5,height:10,rotation:-38.13},{id:"l",x:35.31,y:13.5,width:4,height:6,rotation:-39.33}],walls:[{id:"aa",x:30,y:32,shape:"C-4-8-4",rotation:90},{id:"ab",x:26,y:4,shape:"C-4-8-4",rotation:-90},{id:"ac",x:8.19,y:11.64,shape:"L-4x8",rotation:222.46},{id:"ad",x:47.79,y:24.3,shape:"L-4x8",rotation:41.26},{id:"ae",x:38.64,y:20.09,shape:"L-5x6-mirror",rotation:141.31},{id:"af",x:25.26,y:17.9,shape:"L-5x6-mirror",rotation:-37.61},{id:"ag",x:14.37,y:28.38,shape:"L-4x8-mirror",rotation:-54.26},{id:"ah",x:48.75,y:7.3,shape:"L-4x8-mirror",rotation:122.02}]},{name:"Layout 4",terrains:[{id:"a",x:15,y:1,width:6,height:12,rotation:90},{id:"b",x:8,y:10,width:4,height:6,rotation:0},{id:"c",x:4,y:19,width:4,height:6,rotation:0},{id:"d",x:7.5,y:27.68,width:6,height:12,rotation:-48.57},{id:"e",x:46.53,y:4.24,width:6,height:12,rotation:-48.57},{id:"f",x:53,y:19,width:4,height:6,rotation:0},{id:"g",x:48,y:28,width:4,height:6,rotation:0},{id:"h",x:39,y:31,width:6,height:12,rotation:90},{id:"i",x:33.03,y:2.97,width:6,height:12,rotation:-37.25},{id:"j",x:20.96,y:28.96,width:6,height:12,rotation:-37.25},{id:"k",x:16.93,y:16.51,width:5,height:10,rotation:-41.85},{id:"l",x:37.96,y:17.43,width:5,height:10,rotation:-41.85}],walls:[{id:"aa",x:18,y:4,shape:"L-4x8",rotation:-90},{id:"ab",x:9.04,y:29.01,shape:"C-4-8-4",rotation:131.97},{id:"ac",x:47,y:7,shape:"C-4-8-4",rotation:-48.54},{id:"ad",x:38,y:32,shape:"L-4x8",rotation:90},{id:"ae",x:34.42,y:7.12,shape:"L-4x8",rotation:-37.53},{id:"af",x:21.57,y:28.8,shape:"L-4x8",rotation:142.46},{id:"ag",x:15.7,y:17.01,shape:"L-5x6",rotation:137.87},{id:"ah",x:39.17,y:20.85,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 5",terrains:[{id:"aa",x:27,y:1,width:6,height:12,rotation:90},{id:"ab",x:36.53,y:12.48,width:5,height:10,rotation:-90},{id:"ac",x:13,y:3,width:4,height:6,rotation:90},{id:"ad",x:43,y:35,width:4,height:6,rotation:90},{id:"ae",x:27,y:31,width:6,height:12,rotation:90},{id:"af",x:18.43,y:21.49,width:5,height:10,rotation:-90},{id:"ag",x:1,y:23,width:4,height:6,rotation:90},{id:"ah",x:55,y:15,width:4,height:6,rotation:90},{id:"ai",x:7.83,y:30.22,width:6,height:12,rotation:-60},{id:"aj",x:46.32,y:1.58,width:6,height:12,rotation:-60},{id:"ak",x:8.74,y:10.19,width:6,height:12,rotation:65.22},{id:"al",x:45.22,y:21.75,width:6,height:12,rotation:65.22}],walls:[{id:"a1",x:28,y:32,shape:"C-4-8-4",rotation:90},{id:"a2",x:28,y:4,shape:"C-4-8-4",rotation:-90},{id:"a3",x:11.88,y:12.29,shape:"L-4x8",rotation:-114.74},{id:"a4",x:43.97,y:23.59,shape:"L-4x8",rotation:64.22},{id:"a5",x:24.91,y:23.52,shape:"L-5x6-mirror",rotation:-90.37},{id:"a6",x:39,y:14.51,shape:"L-5x6-mirror",rotation:89.9},{id:"a7",x:7.58,y:30.57,shape:"L-4x8",rotation:120.93},{id:"a8",x:48.51,y:5.28,shape:"L-4x8",rotation:-59.06}]},{name:"Layout 6",terrains:[{id:"aa",x:13,y:1,width:6,height:12,rotation:90},{id:"ab",x:6,y:10,width:4,height:6,rotation:0},{id:"ac",x:25,y:11,width:4,height:6,rotation:90},{id:"ad",x:7.34,y:27.57,width:6,height:12,rotation:-40.32},{id:"ae",x:46.69,y:4.57,width:6,height:12,rotation:-41.9},{id:"af",x:31,y:27,width:4,height:6,rotation:-90},{id:"ag",x:50,y:28,width:4,height:6,rotation:0},{id:"ah",x:41,y:31,width:6,height:12,rotation:90},{id:"ai",x:34,y:4,width:6,height:12,rotation:0},{id:"aj",x:20,y:28,width:6,height:12,rotation:0},{id:"ak",x:15.7,y:15.03,width:5,height:10,rotation:-41.85},{id:"al",x:39.43,y:19.24,width:5,height:10,rotation:-39.95}],walls:[{id:"a1",x:16,y:4,shape:"L-4x8",rotation:-90},{id:"a2",x:9.04,y:29.01,shape:"C-4-8-4",rotation:140.05},{id:"a3",x:47,y:7.16,shape:"C-4-8-4",rotation:-41.53},{id:"a4",x:40,y:32,shape:"L-4x8",rotation:90},{id:"a5",x:34.15,y:7.88,shape:"L-4x8",rotation:0},{id:"a6",x:22,y:28,shape:"L-4x8",rotation:180},{id:"a7",x:14.47,y:15.47,shape:"L-5x6",rotation:137.87},{id:"a8",x:40.53,y:22.78,shape:"L-5x6",rotation:-40.92}]},{name:"Layout 7",terrains:[{id:"aa",x:8,y:8,width:6,height:12,rotation:0},{id:"ab",x:6,y:28,width:6,height:12,rotation:0},{id:"ac",x:7,y:39,width:4,height:6,rotation:90},{id:"ad",x:18,y:26,width:5,height:10,rotation:0},{id:"ae",x:19,y:20,width:4,height:6,rotation:0},{id:"af",x:23,y:3,width:6,height:12,rotation:0},{id:"ag",x:31,y:29,width:6,height:12,rotation:0},{id:"ah",x:37,y:18,width:4,height:6,rotation:0},{id:"ai",x:37,y:8,width:5,height:10,rotation:0},{id:"aj",x:46,y:24,width:6,height:12,rotation:0},{id:"ak",x:48,y:4,width:6,height:12,rotation:0},{id:"al",x:49,y:-1,width:4,height:6,rotation:90}],walls:[{id:"a1",x:9,y:10,shape:"L-5x6",rotation:180},{id:"a2",x:11.44,y:31.97,shape:"L-4x8-mirror",rotation:0},{id:"a3",x:19,y:20,shape:"L-4x6",rotation:180},{id:"a4",x:22.53,y:30.02,shape:"L-5x6-mirror",rotation:0},{id:"a5",x:25,y:5,shape:"C-4-8-4",rotation:180},{id:"a6",x:31,y:31,shape:"C-4-8-4",rotation:0},{id:"a7",x:37,y:18,shape:"L-4x6",rotation:0},{id:"a8",x:41.51,y:8.09,shape:"L-5x6-mirror",rotation:180},{id:"a9",x:46,y:28,shape:"L-5x6",rotation:0},{id:"a10",x:51.51,y:4.01,shape:"L-4x8-mirror",rotation:180}]},{name:"Layout 8",terrains:[{id:"aa",x:23,y:22,width:4,height:6,rotation:0},{id:"ab",x:23,y:28,width:4,height:6,rotation:0},{id:"ac",x:33,y:16,width:4,height:6,rotation:0},{id:"ad",x:33,y:10,width:4,height:6,rotation:0},{id:"ae",x:41,y:19,width:6,height:12,rotation:0},{id:"af",x:13,y:13,width:6,height:12,rotation:0},{id:"ag",x:32,y:32,width:6,height:12,rotation:0},{id:"ah",x:22,y:0,width:6,height:12,rotation:0},{id:"ai",x:9.5,y:27.68,width:6,height:12,rotation:-48.69},{id:"aj",x:44.51,y:4.35,width:6,height:12,rotation:-48.69},{id:"ak",x:6.95,y:4,width:5,height:10,rotation:53.9},{id:"al",x:48,y:30,width:5,height:10,rotation:53.9}],walls:[{id:"a1",x:32,y:34,shape:"C-4-8-4",rotation:0},{id:"a2",x:24,y:2,shape:"C-4-8-4",rotation:180},{id:"a3",x:44.68,y:19.06,shape:"L-4x8-mirror",rotation:180},{id:"a4",x:18.43,y:16.91,shape:"L-4x8-mirror",rotation:0},{id:"a5",x:46.38,y:33.13,shape:"L-5x6",rotation:52.87},{id:"a6",x:8.55,y:4.89,shape:"L-5x6",rotation:-127.66},{id:"a7",x:16,y:30.28,shape:"L-4x8-mirror",rotation:-48.62},{id:"a8",x:46.91,y:5.85,shape:"L-4x8-mirror",rotation:132.19}]}];function au(){return"terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function qn(){const t=localStorage.getItem(Ro);if(t)try{return JSON.parse(t)}catch(n){return console.error("Failed to parse saved layouts:",n),{}}return{}}function tr(t){localStorage.setItem(Ro,JSON.stringify(t))}function Lo(){const{subscribe:t,set:n,update:a}=Tt([]);return{subscribe:t,set:n,update:a,add(r,s){a(i=>[...i,{id:au(),x:30-r/2,y:22-s/2,width:r,height:s,rotation:0}])},updateTerrain(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){n([])},save(r){const s=Zt({subscribe:t}),i=qn();i[r]={terrains:s,savedAt:Date.now()},tr(i)},load(r){const s=qn();return s[r]?(n(s[r].terrains),!0):!1},deleteLayout(r){const s=qn();delete s[r],tr(s)},getSavedLayoutNames(){const r=qn();return Object.keys(r).map(s=>({name:s,savedAt:r[s].savedAt,terrainCount:r[s].terrains.length})).sort((s,i)=>i.savedAt-s.savedAt)},hasSaved(){const r=qn();return Object.keys(r).length>0}}}const Gt=Lo();function Do(){const{subscribe:t,set:n,update:a}=Tt([]);return{subscribe:t,set:n,update:a,add(r){a(s=>[...s,{id:"wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),x:30,y:22,shape:r,rotation:0}])},updateWall(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){n([])}}}const Ft=Do(),Us=Lo(),Ks=Do(),Gs=Tt(null),zs=Tt(null);function Rr(t){const n=t.includes("-mirror"),a=t.replace("-mirror","");if(a.startsWith("L-")){const r=a.match(/L-(\d+)x(\d+)/);if(r)return{type:"L",segments:[parseInt(r[1]),parseInt(r[2])],mirrored:n}}else if(a.startsWith("C-")){const r=a.match(/C-(\d+)-(\d+)-(\d+)/);if(r)return{type:"C",segments:[parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],mirrored:n}}return{type:"L",segments:[4,8],mirrored:!1}}function ns(t,n=null){const s=Rr(t),i=n||s.segments,o=s.mirrored;if(s.type==="L"){const[l,c]=i;return o?[{x:0,y:0},{x:.5,y:0},{x:.5,y:c},{x:-l+.5,y:c},{x:-l+.5,y:c-.5},{x:0,y:c-.5}]:[{x:0,y:0},{x:.5,y:0},{x:.5,y:c-.5},{x:l,y:c-.5},{x:l,y:c},{x:0,y:c}]}else if(s.type==="C"){const[l,c,u]=i;return[{x:0,y:0},{x:u,y:0},{x:u,y:.5},{x:.5,y:.5},{x:.5,y:c-.5},{x:l,y:c-.5},{x:l,y:c},{x:0,y:c}]}return[]}function jr(t,n,a,r){if(t.length===0)return[];const s=t.map(S=>S.x),i=t.map(S=>S.y),o=Math.min(...s),l=Math.max(...s),c=Math.min(...i),u=Math.max(...i),d=l-o,f=u-c,m=n+o+d/2,h=a+c+f/2,y=r*Math.PI/180,v=Math.cos(y),b=Math.sin(y);return t.map(S=>{const R=n+S.x,M=a+S.y,_=R-m,A=M-h;return{x:m+_*v-A*b,y:h+_*b+A*v}})}nn(Ft,t=>t.map(n=>jr(ns(n.shape,n.segments),n.x,n.y,n.rotation)));const An=Tt(null),Cn=Tt(null),Vr=Tt([]);function su(t,n=[]){const a=Zt(Gt),r=Zt(Ft),s=qn();s[t]={terrains:a,walls:r,models:n,savedAt:Date.now()},tr(s)}function ru(t){const n=qn();return n[t]?(Gt.set(n[t].terrains||[]),Ft.set(n[t].walls||[]),{terrains:n[t].terrains||[],walls:n[t].walls||[],models:n[t].models||[]}):null}function iu(t){const n=qn();delete n[t],tr(n)}function ou(){const t=qn();return Object.keys(t).map(n=>({name:n,savedAt:t[n].savedAt,terrainCount:(t[n].terrains||[]).length,wallCount:(t[n].walls||[]).length,modelCount:(t[n].models||[]).length})).sort((n,a)=>a.savedAt-n.savedAt)}function xs(){Vr.set(ou())}var lu=_e('<line stroke="#3b82f6" stroke-width="0.08" stroke-dasharray="0.2,0.1"></line><circle r="0.6" fill="#3b82f6" stroke="#1d4ed8" stroke-width="0.08" role="button" tabindex="0" class="rotate-handle svelte-1tez9jd"></circle>',1),cu=_e('<g><g><path role="button" tabindex="0" class="svelte-1tez9jd"></path></g><!></g>');function Qr(t,n){Ut(n,!1);const a=W(),r=W(),s=W(),i=W(),o=W(),l=W(),c=W(),u=W(),d=W(),f=W();let m=Ce(n,"id",8),h=Ce(n,"x",8),y=Ce(n,"y",8),v=Ce(n,"shape",8),b=Ce(n,"segments",8,null),S=Ce(n,"rotation",8,0),R=Ce(n,"selected",8,!1),M=Ce(n,"screenToSvg",8),_=Ce(n,"onSelect",8,()=>{}),A=Ce(n,"onDrag",8,()=>{}),k=Ce(n,"onRotate",8,()=>{});function $(F){const H=F.map(Ue=>Ue.x),$e=F.map(Ue=>Ue.y);return{minX:Math.min(...H),maxX:Math.max(...H),minY:Math.min(...$e),maxY:Math.max(...$e)}}let w=W(!1),I=!1,O={x:0,y:0};function he(F){F.stopPropagation(),_()(m())}function V(F){if(F.button!==0)return;F.preventDefault(),F.stopPropagation(),_()(m()),T(w,!0);const H=M()(F.clientX,F.clientY);O={x:H.x-h(),y:H.y-y()},window.addEventListener("mousemove",Z),window.addEventListener("mouseup",ne)}function Z(F){if(!e(w))return;const H=M()(F.clientX,F.clientY);let $e=H.x-O.x,Ue=H.y-O.y;F.shiftKey||($e=Math.round($e),Ue=Math.round(Ue));const G=Math.max(e(s),e(i));$e=Math.max(-G,Math.min(We.width+G-e(s),$e)),Ue=Math.max(-G,Math.min(We.height+G-e(i),Ue)),A()(m(),$e,Ue)}function ne(){T(w,!1),window.removeEventListener("mousemove",Z),window.removeEventListener("mouseup",ne)}function z(F){F.preventDefault(),F.stopPropagation(),I=!0,window.addEventListener("mousemove",J),window.addEventListener("mouseup",ie)}function J(F){if(!I)return;const H=M()(F.clientX,F.clientY),$e=H.x-e(o),Ue=H.y-e(l);let G=Math.atan2(Ue,$e)*180/Math.PI+45;F.shiftKey||(G=Math.round(G/15)*15),k()(m(),G)}function ie(){I=!1,window.removeEventListener("mousemove",J),window.removeEventListener("mouseup",ie)}me(()=>(se(v()),se(b())),()=>{T(a,ns(v(),b()))}),me(()=>e(a),()=>{T(r,$(e(a)))}),me(()=>e(r),()=>{T(s,e(r).maxX-e(r).minX)}),me(()=>e(r),()=>{T(i,e(r).maxY-e(r).minY)}),me(()=>(se(h()),e(r),e(s)),()=>{T(o,h()+e(r).minX+e(s)/2)}),me(()=>(se(y()),e(r),e(i)),()=>{T(l,y()+e(r).minY+e(i)/2)}),me(()=>(e(a),se(h()),se(y())),()=>{T(c,e(a).length>0?`M ${e(a).map(F=>`${h()+F.x},${y()+F.y}`).join(" L ")} Z`:"")}),me(()=>(e(s),e(i)),()=>{T(u,Math.max(e(s),e(i))/2+1.5)}),me(()=>(e(o),e(u),se(S())),()=>{T(d,e(o)+e(u)*Math.cos((S()-45)*Math.PI/180))}),me(()=>(e(l),e(u),se(S())),()=>{T(f,e(l)+e(u)*Math.sin((S()-45)*Math.PI/180))}),In(),jt();var le=cu();let be;var te=E(le),N=E(te),q=x(te);{var j=F=>{var H=lu(),$e=Re(H),Ue=x($e);X(()=>{g($e,"x1",e(o)),g($e,"y1",e(l)),g($e,"x2",e(d)),g($e,"y2",e(f)),g(Ue,"cx",e(d)),g(Ue,"cy",e(f))}),K("mousedown",Ue,z),D(F,H)};pe(q,F=>{R()&&F(j)})}X(()=>{be=dn(le,0,"wall-piece svelte-1tez9jd",null,be,{selected:R(),dragging:e(w)}),g(te,"transform",`rotate(${S()??""}, ${e(o)??""}, ${e(l)??""})`),g(N,"d",e(c)),g(N,"fill",R()?"rgba(139, 69, 19, 0.6)":"rgba(139, 69, 19, 0.8)"),g(N,"stroke",R()?"#3b82f6":"#5c3317"),g(N,"stroke-width",R()?.15:.1)}),K("click",N,he),K("mousedown",N,V),D(t,le),Kt()}var uu=ye('<div class="section-content svelte-7o4pd4"><!></div>'),mu=ye('<section><div class="section-header svelte-7o4pd4" role="button" tabindex="0"><h3 class="svelte-7o4pd4"> </h3> <span class="toggle-icon svelte-7o4pd4"> </span></div> <!></section>');function Dt(t,n){let a=Ce(n,"title",8),r=Ce(n,"defaultOpen",8,!0),s=W(r());function i(){T(s,!e(s))}var o=mu();let l;var c=E(o),u=E(c),d=E(u),f=x(u,2),m=E(f),h=x(c,2);{var y=v=>{var b=uu(),S=E(b);bo(S,n,"default",{}),D(v,b)};pe(h,v=>{e(s)&&v(y)})}X(()=>{l=dn(o,1,"collapsible-section svelte-7o4pd4",null,l,{collapsed:!e(s)}),we(d,a()),we(m,e(s)?"â¼":"â¶")}),K("click",c,i),D(t,o)}var du=ye('<button class="svelte-10mgcx0"> </button>'),hu=ye('<div class="button-group svelte-10mgcx0"></div>'),fu=ye('<button class="svelte-10mgcx0"> </button>'),yu=ye('<div class="button-group svelte-10mgcx0"></div>'),pu=ye('<div class="field svelte-10mgcx0"><label for="edit-width" class="svelte-10mgcx0">Width (inches)</label> <input id="edit-width" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-height" class="svelte-10mgcx0">Length (inches)</label> <input id="edit-height" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-rotation" class="svelte-10mgcx0">Rotation (Â°)</label> <input id="edit-rotation" type="number" step="15" class="svelte-10mgcx0"/></div>',1),vu=ye('<div class="field svelte-10mgcx0"><label for="edit-seg1" class="svelte-10mgcx0">Horizontal (inches)</label> <input id="edit-seg1" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg2" class="svelte-10mgcx0">Vertical (inches)</label> <input id="edit-seg2" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div>',1),gu=ye('<div class="field svelte-10mgcx0"><label for="edit-seg1" class="svelte-10mgcx0">Top Width (inches)</label> <input id="edit-seg1" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg2" class="svelte-10mgcx0">Length (inches)</label> <input id="edit-seg2" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-seg3" class="svelte-10mgcx0">Bottom Width (inches)</label> <input id="edit-seg3" type="number" step="0.5" min="1" class="svelte-10mgcx0"/></div>',1),bu=ye('<div class="field svelte-10mgcx0"><span class="label-text svelte-10mgcx0">Shape</span> <span class="value svelte-10mgcx0"> </span></div> <!> <div class="field svelte-10mgcx0"><label for="edit-rotation" class="svelte-10mgcx0">Rotation (Â°)</label> <input id="edit-rotation" type="number" step="15" class="svelte-10mgcx0"/></div>',1),Tu=ye('<div class="edit-form svelte-10mgcx0"><div class="field svelte-10mgcx0"><label for="edit-x" class="svelte-10mgcx0">X (inches)</label> <input id="edit-x" type="number" step="0.1" class="svelte-10mgcx0"/></div> <div class="field svelte-10mgcx0"><label for="edit-y" class="svelte-10mgcx0">Y (inches)</label> <input id="edit-y" type="number" step="0.1" class="svelte-10mgcx0"/></div> <!> <button class="danger svelte-10mgcx0">Remove</button></div>'),xu=ye('<p class="hint svelte-10mgcx0">Click a piece to select it</p>'),_u=ye('<div class="button-group vertical svelte-10mgcx0"><button class="svelte-10mgcx0">Save Layout</button> <button class="svelte-10mgcx0">Load Layout</button> <div class="button-row svelte-10mgcx0"><button class="secondary small svelte-10mgcx0">Export</button> <button class="secondary small svelte-10mgcx0">Import</button></div> <button class="secondary svelte-10mgcx0">Clear All</button></div>'),Su=ye("<!> <!>",1),wu=ye('<div class="modal-overlay svelte-10mgcx0" role="presentation"><div class="modal svelte-10mgcx0" role="dialog"><h2 class="svelte-10mgcx0">Save Layout</h2> <div class="modal-field svelte-10mgcx0"><label for="layout-name" class="svelte-10mgcx0">Layout Name</label> <input id="layout-name" type="text" placeholder="Enter a name..." class="svelte-10mgcx0"/></div> <div class="modal-actions svelte-10mgcx0"><button class="secondary svelte-10mgcx0">Cancel</button> <button class="svelte-10mgcx0">Save</button></div></div></div>'),Au=ye('<p class="hint svelte-10mgcx0">No saved layouts yet</p>'),Cu=ye('<div class="layout-item svelte-10mgcx0" role="button" tabindex="0"><div class="layout-info svelte-10mgcx0"><span class="layout-name svelte-10mgcx0"> </span> <span class="layout-meta svelte-10mgcx0"> </span></div> <button class="delete-btn svelte-10mgcx0" title="Delete">Ã</button></div>'),Eu=ye('<div class="layout-list svelte-10mgcx0"></div>'),Mu=ye('<div class="modal-overlay svelte-10mgcx0" role="presentation"><div class="modal svelte-10mgcx0" role="dialog"><h2 class="svelte-10mgcx0">Load Layout</h2> <!> <div class="modal-actions svelte-10mgcx0"><button class="secondary svelte-10mgcx0">Cancel</button></div></div></div>'),Ru=ye('<main class="svelte-10mgcx0"><div class="header svelte-10mgcx0"><h1 class="svelte-10mgcx0">Layout Builder</h1> <nav class="nav-links svelte-10mgcx0"><a href="#/setup" class="svelte-10mgcx0">Battlefield Setup</a> <a href="#/deployment" class="svelte-10mgcx0">Deployment</a> <a href="#/" class="active svelte-10mgcx0">Layout Builder</a> <a href="#/debug" class="svelte-10mgcx0">Debug Mode</a></nav></div> <div class="layout svelte-10mgcx0"><div class="sidebar svelte-10mgcx0"><!> <!> <!> <!> <input type="file" accept=".json" style="display: none;"/></div> <div class="battlefield-area svelte-10mgcx0"><div class="battlefield-container svelte-10mgcx0" role="presentation"><!></div> <div class="info svelte-10mgcx0"><p class="svelte-10mgcx0"> </p> <p class="hint svelte-10mgcx0">Scroll to zoom | Space+drag or middle-click to pan | Double-click to reset view</p></div></div></div></main> <!> <!>',1);function ku(t,n){Ut(n,!1);const a=()=>lt(An,"$selectedTerrainId",l),r=()=>lt(Cn,"$selectedWallId",l),s=()=>lt(Gt,"$layoutTerrains",l),i=()=>lt(Ft,"$layoutWalls",l),o=()=>lt(Vr,"$savedLayoutsList",l),[l,c]=ls(),u=W(),d=W();let f=W(!1),m=W(!1),h=W(""),y=null;cs(()=>{xs(),window.addEventListener("keydown",v)}),So(()=>{window.removeEventListener("keydown",v)});function v(L){if(L.target.tagName==="INPUT"||e(f)||e(m))return;const re=a()||r();if((L.key==="Delete"||L.key==="Backspace")&&re){L.preventDefault(),be();return}if(re&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(L.key)){L.preventDefault();const ve=L.shiftKey?.1:1;let Te=0,xe=0;switch(L.key){case"ArrowUp":xe=-ve;break;case"ArrowDown":xe=ve;break;case"ArrowLeft":Te=-ve;break;case"ArrowRight":Te=ve;break}if(a()){const Ke=s().find(Xe=>Xe.id===a());Ke&&Gt.updateTerrain(a(),{x:Ke.x+Te,y:Ke.y+xe})}else if(r()){const Ke=i().find(Xe=>Xe.id===r());Ke&&Ft.updateWall(r(),{x:Ke.x+Te,y:Ke.y+xe})}return}if(L.key==="c"&&(L.ctrlKey||L.metaKey)&&re){if(L.preventDefault(),a()){const ve=s().find(Te=>Te.id===a());ve&&(y={type:"terrain",data:{...ve}})}else if(r()){const ve=i().find(Te=>Te.id===r());ve&&(y={type:"wall",data:{...ve}})}return}if(L.key==="v"&&(L.ctrlKey||L.metaKey)&&y){if(L.preventDefault(),y.type==="terrain"){const ve="terrain-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),Te={...y.data,id:ve,x:y.data.x+2,y:y.data.y+2};Gt.update(xe=>[...xe,Te]),An.set(ve),Cn.set(null),y.data.x+=2,y.data.y+=2}else if(y.type==="wall"){const ve="wall-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),Te={...y.data,id:ve,x:y.data.x+2,y:y.data.y+2};Ft.update(xe=>[...xe,Te]),Cn.set(ve),An.set(null),y.data.x+=2,y.data.y+=2}return}if(L.key==="Escape"){ne();return}}let b=W(""),S=W(""),R=W(""),M=W(""),_=W(""),A=W(""),k=W(""),$=W("");function w(L){return L.segments?L.segments:Rr(L.shape).segments}function I(L){return Rr(L.shape).type}function O(L,re){Gt.add(L,re)}function he(L){Ft.add(L)}function V(L){An.set(L),Cn.set(null)}function Z(L){Cn.set(L),An.set(null)}function ne(){An.set(null),Cn.set(null)}function z(L,re,ve){Gt.updateTerrain(L,{x:re,y:ve})}function J(L,re,ve){Ft.updateWall(L,{x:re,y:ve})}function ie(L,re){Gt.updateTerrain(L,{rotation:re})}function le(L,re){Ft.updateWall(L,{rotation:re})}function be(){a()?(Gt.remove(a()),An.set(null)):r()&&(Ft.remove(r()),Cn.set(null))}function te(){const L=parseFloat(e(b)),re=parseFloat(e(S));!isNaN(L)&&!isNaN(re)&&(a()?Gt.updateTerrain(a(),{x:L,y:re}):r()&&Ft.updateWall(r(),{x:L,y:re}))}function N(){if(!a())return;const L=parseFloat(e(R)),re=parseFloat(e(M));!isNaN(L)&&!isNaN(re)&&L>0&&re>0&&Gt.updateTerrain(a(),{width:L,height:re})}function q(){const L=parseFloat(e(_));isNaN(L)||(a()?Gt.updateTerrain(a(),{rotation:L}):r()&&Ft.updateWall(r(),{rotation:L}))}function j(){if(!r()||!e(d))return;const L=I(e(d)),re=parseFloat(e(A)),ve=parseFloat(e(k));if(isNaN(re)||isNaN(ve)||re<=0||ve<=0)return;let Te;if(L==="C"){const xe=parseFloat(e($));if(isNaN(xe)||xe<=0)return;Te=[re,ve,xe]}else Te=[re,ve];Ft.updateWall(r(),{segments:Te})}function F(){T(h,""),T(f,!0)}function H(){e(h).trim()&&(su(e(h).trim()),xs(),T(f,!1),T(h,""))}function $e(){xs(),T(m,!0)}function Ue(L){ru(L),An.set(null),Cn.set(null),T(m,!1)}function G(L,re){re.stopPropagation(),confirm(`Delete layout "${L}"?`)&&(iu(L),xs())}function oe(){confirm("Clear all terrain and walls?")&&(Gt.clear(),Ft.clear(),An.set(null),Cn.set(null))}function ke(L){return new Date(L).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function ce(L){const re=Mr.find(ve=>ve.shape===L);return re?re.label:L}function xt(){const L=prompt("Layout name (for the recipient):","Custom Layout");if(L===null)return;const re=s(),ve=i(),Te={version:1,name:L||"Custom Layout",exportedAt:new Date().toISOString(),terrainCount:re.length,wallCount:ve.length,terrains:re,walls:ve},xe=JSON.stringify(Te,null,2),Ke=new Blob([xe],{type:"application/json"}),Xe=URL.createObjectURL(Ke),fe=document.createElement("a");fe.href=Xe;const Ne=(L||"layout").toLowerCase().replace(/[^a-z0-9]+/g,"-");fe.download=`${Ne}-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(fe),fe.click(),document.body.removeChild(fe),URL.revokeObjectURL(Xe)}let ht=W();function Ye(){e(ht).click()}function De(L){const re=L.target.files[0];if(!re)return;const ve=new FileReader;ve.onload=Te=>{try{const xe=JSON.parse(Te.target.result);xe.terrains&&Array.isArray(xe.terrains)&&Gt.set(xe.terrains),xe.walls&&Array.isArray(xe.walls)&&Ft.set(xe.walls),An.set(null),Cn.set(null);const Ke=xe.name||"Unknown",Xe=xe.terrains?.length||0,fe=xe.walls?.length||0;alert(`Imported "${Ke}"
${Xe} terrain(s), ${fe} wall(s)`)}catch(xe){alert("Failed to import layout: Invalid file format"),console.error("Import error:",xe)}},ve.readAsText(re),L.target.value=""}me(()=>(s(),a()),()=>{T(u,s().find(L=>L.id===a()))}),me(()=>(i(),r()),()=>{T(d,i().find(L=>L.id===r()))}),me(()=>(e(u),e(d)),()=>{if(e(u))T(b,e(u).x.toFixed(1)),T(S,e(u).y.toFixed(1)),T(R,e(u).width.toString()),T(M,e(u).height.toString()),T(_,Math.round(e(u).rotation).toString());else if(e(d)){T(b,e(d).x.toFixed(1)),T(S,e(d).y.toFixed(1)),T(_,Math.round(e(d).rotation).toString());const L=w(e(d));T(A,L[0]?.toString()||""),T(k,L[1]?.toString()||""),T($,L[2]?.toString()||"")}}),In(),jt();var vt=Ru(),Je=Re(vt),Qe=x(E(Je),2),U=E(Qe),Se=E(U);Dt(Se,{title:"Add Terrain",children:(L,re)=>{var ve=hu();Le(ve,5,()=>ko,ze,(Te,xe)=>{var Ke=du(),Xe=E(Ke);X(()=>we(Xe,(e(xe),p(()=>e(xe).label)))),K("click",Ke,()=>O(e(xe).width,e(xe).height)),D(Te,Ke)}),D(L,ve)},$$slots:{default:!0}});var Oe=x(Se,2);Dt(Oe,{title:"Add Wall",children:(L,re)=>{var ve=yu();Le(ve,5,()=>Mr,ze,(Te,xe)=>{var Ke=fu(),Xe=E(Ke);X(()=>we(Xe,(e(xe),p(()=>e(xe).label)))),K("click",Ke,()=>he(e(xe).shape)),D(Te,Ke)}),D(L,ve)},$$slots:{default:!0}});var ct=x(Oe,2);{let L=Ge(()=>e(u)?"Terrain":e(d)?"Wall":"Item");Dt(ct,{get title(){return`Selected ${e(L)??""}`},children:(re,ve)=>{var Te=wt(),xe=Re(Te);{var Ke=fe=>{var Ne=Tu(),yt=E(Ne),Tn=x(E(yt),2),Et=x(yt,2),Nn=x(E(Et),2),Pn=x(Et,2);{var Jn=Ot=>{var xn=pu(),hn=Re(xn),Zn=x(E(hn),2),_n=x(hn,2),fa=x(E(_n),2),Na=x(_n,2),Pa=x(E(Na),2);Ht(Zn,()=>e(R),$n=>T(R,$n)),K("change",Zn,N),Ht(fa,()=>e(M),$n=>T(M,$n)),K("change",fa,N),Ht(Pa,()=>e(_),$n=>T(_,$n)),K("change",Pa,q),D(Ot,xn)},us=Ot=>{var xn=wt(),hn=Re(xn);{var Zn=_n=>{var fa=bu(),Na=Re(fa),Pa=x(E(Na),2),$n=E(Pa),Ps=x(Na,2);{var cr=Vt=>{var ea=vu(),$a=Re(ea),ya=x(E($a),2),an=x($a,2),ta=x(E(an),2);Ht(ya,()=>e(A),On=>T(A,On)),K("change",ya,j),Ht(ta,()=>e(k),On=>T(k,On)),K("change",ta,j),D(Vt,ea)},$s=Vt=>{var ea=wt(),$a=Re(ea);{var ya=an=>{var ta=gu(),On=Re(ta),Os=x(E(On),2),hs=x(On,2),fs=x(E(hs),2),Ws=x(hs,2),ys=x(E(Ws),2);Ht(Os,()=>e(A),na=>T(A,na)),K("change",Os,j),Ht(fs,()=>e(k),na=>T(k,na)),K("change",fs,j),Ht(ys,()=>e($),na=>T($,na)),K("change",ys,j),D(an,ta)};pe($a,an=>{e(d),p(()=>I(e(d))==="C")&&an(ya)},!0)}D(Vt,ea)};pe(Ps,Vt=>{e(d),p(()=>I(e(d))==="L")?Vt(cr):Vt($s,!1)})}var ur=x(Ps,2),ds=x(E(ur),2);X(Vt=>we($n,Vt),[()=>(e(d),p(()=>ce(e(d).shape)))]),Ht(ds,()=>e(_),Vt=>T(_,Vt)),K("change",ds,q),D(_n,fa)};pe(hn,_n=>{e(d)&&_n(Zn)},!0)}D(Ot,xn)};pe(Pn,Ot=>{e(u)?Ot(Jn):Ot(us,!1)})}var ms=x(Pn,2);Ht(Tn,()=>e(b),Ot=>T(b,Ot)),K("change",Tn,te),Ht(Nn,()=>e(S),Ot=>T(S,Ot)),K("change",Nn,te),K("click",ms,be),D(fe,Ne)},Xe=fe=>{var Ne=xu();D(fe,Ne)};pe(xe,fe=>{e(u)||e(d)?fe(Ke):fe(Xe,!1)})}D(re,Te)},$$slots:{default:!0}})}var tt=x(ct,2);Dt(tt,{title:"Layout",children:(L,re)=>{var ve=_u(),Te=E(ve),xe=x(Te,2),Ke=x(xe,2),Xe=E(Ke),fe=x(Xe,2),Ne=x(Ke,2);X(()=>xe.disabled=(o(),p(()=>o().length===0))),K("click",Te,F),K("click",xe,$e),K("click",Xe,xt),K("click",fe,Ye),K("click",Ne,oe),D(L,ve)},$$slots:{default:!0}});var ft=x(tt,2);Es(ft,L=>T(ht,L),()=>e(ht));var At=x(U,2),Pt=E(At),Ct=E(Pt);lr(Ct,{children:Wr,$$slots:{default:(L,re)=>{const ve=Ge(()=>re.screenToSvg);var Te=Su(),xe=Re(Te);Le(xe,1,s,Xe=>Xe.id,(Xe,fe)=>{{let Ne=Ge(()=>(e(fe),a(),p(()=>e(fe).id===a())));Mo(Xe,{get id(){return e(fe),p(()=>e(fe).id)},get x(){return e(fe),p(()=>e(fe).x)},get y(){return e(fe),p(()=>e(fe).y)},get width(){return e(fe),p(()=>e(fe).width)},get height(){return e(fe),p(()=>e(fe).height)},get rotation(){return e(fe),p(()=>e(fe).rotation)},get selected(){return e(Ne)},get screenToSvg(){return e(ve)},onSelect:V,onDrag:z,onRotate:ie})}});var Ke=x(xe,2);Le(Ke,1,i,Xe=>Xe.id,(Xe,fe)=>{{let Ne=Ge(()=>(e(fe),r(),p(()=>e(fe).id===r())));Qr(Xe,{get id(){return e(fe),p(()=>e(fe).id)},get x(){return e(fe),p(()=>e(fe).x)},get y(){return e(fe),p(()=>e(fe).y)},get shape(){return e(fe),p(()=>e(fe).shape)},get segments(){return e(fe),p(()=>e(fe).segments)},get rotation(){return e(fe),p(()=>e(fe).rotation)},get selected(){return e(Ne)},get screenToSvg(){return e(ve)},onSelect:Z,onDrag:J,onRotate:le})}}),D(L,Te)}}});var kt=x(Pt,2),Ee=E(kt),Fe=E(Ee),Ie=x(Je,2);{var ut=L=>{var re=wu(),ve=E(re),Te=x(E(ve),2),xe=x(E(Te),2),Ke=x(Te,2),Xe=E(Ke),fe=x(Xe,2);X(Ne=>fe.disabled=Ne,[()=>(e(h),p(()=>!e(h).trim()))]),Ht(xe,()=>e(h),Ne=>T(h,Ne)),K("keydown",xe,Ne=>Ne.key==="Enter"&&H()),K("click",Xe,()=>T(f,!1)),K("click",fe,H),K("click",ve,fi(function(Ne){pi.call(this,n,Ne)})),K("click",re,()=>T(f,!1)),D(L,re)};pe(Ie,L=>{e(f)&&L(ut)})}var _t=x(Ie,2);{var Be=L=>{var re=Mu(),ve=E(re),Te=x(E(ve),2);{var xe=Ne=>{var yt=Au();D(Ne,yt)},Ke=Ne=>{var yt=Eu();Le(yt,5,o,ze,(Tn,Et)=>{var Nn=Cu(),Pn=E(Nn),Jn=E(Pn),us=E(Jn),ms=x(Jn,2),Ot=E(ms),xn=x(Pn,2);X(hn=>{we(us,(e(Et),p(()=>e(Et).name))),we(Ot,`${e(Et),p(()=>e(Et).terrainCount)??""} terrain${e(Et),p(()=>e(Et).terrainCount!==1?"s":"")??""}, ${e(Et),p(()=>e(Et).wallCount||0)??""} wall${e(Et),p(()=>(e(Et).wallCount||0)!==1?"s":"")??""} Â· ${hn??""}`)},[()=>(e(Et),p(()=>ke(e(Et).savedAt)))]),K("click",xn,hn=>G(e(Et).name,hn)),K("click",Nn,()=>Ue(e(Et).name)),D(Tn,Nn)}),D(Ne,yt)};pe(Te,Ne=>{o(),p(()=>o().length===0)?Ne(xe):Ne(Ke,!1)})}var Xe=x(Te,2),fe=E(Xe);K("click",fe,()=>T(m,!1)),K("click",ve,fi(function(Ne){pi.call(this,n,Ne)})),K("click",re,()=>T(m,!1)),D(L,re)};pe(_t,L=>{e(m)&&L(Be)})}X(()=>we(Fe,`Battlefield: 60" x 44" | ${s(),p(()=>s().length)??""} terrain${s(),p(()=>s().length!==1?"s":"")??""} | ${i(),p(()=>i().length)??""} wall${i(),p(()=>i().length!==1?"s":"")??""}`)),K("change",ft,De),K("click",Pt,ne),D(t,vt),Kt(),c()}const Io=1/25.4,No=40*Io/2,Po=3+20*Io;function $o(t="item"){return t+"-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Lu(){const{subscribe:t,set:n,update:a}=Tt([]);return{subscribe:t,set:n,update:a,add(r){const s=$o("zone");return a(i=>[...i,{id:s,...r}]),s},updateZone(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){n([])}}}function Du(){const{subscribe:t,set:n,update:a}=Tt([]);return{subscribe:t,set:n,update:a,add(r,s,i=!1){const o=$o("obj"),l=Math.round(r),c=Math.round(s);return a(u=>[...u,{id:o,x:l,y:c,isPrimary:i}]),o},updateObjective(r,s){a(i=>i.map(o=>o.id===r?{...o,...s}:o))},remove(r){a(s=>s.filter(i=>i.id!==r))},clear(){n([])}}}Lu();Du();const Oo=[{name:"Dawn of War",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:32},{type:"L",x:60,y:32},{type:"L",x:60,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:0,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:12},{type:"L",x:0,y:12},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1}]},{name:"Hammer and Anvil",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:18,y:0},{type:"L",x:18,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:42,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:42,y:44},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:30,y:6,isPrimary:!1},{x:30,y:38,isPrimary:!1},{x:10,y:22,isPrimary:!1},{x:50,y:22,isPrimary:!1}]},{name:"Tipping Point",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:12,y:0},{type:"L",x:12,y:22},{type:"L",x:20,y:22},{type:"L",x:20,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:40,y:0},{type:"L",x:60,y:0},{type:"L",x:60,y:44},{type:"L",x:48,y:44},{type:"L",x:48,y:22},{type:"L",x:40,y:22},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:34,isPrimary:!1},{x:22,y:8,isPrimary:!1},{x:38,y:36,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Search and Destroy",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:22},{type:"L",x:21,y:22},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:0,x:30,y:31},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:30,y:0},{type:"L",x:30,y:13},{type:"A",rx:9,ry:9,rotation:0,largeArc:0,sweep:1,x:39,y:22},{type:"L",x:60,y:22},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:14,y:10,isPrimary:!1},{x:46,y:34,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]},{name:"Sweeping Engagement",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:0,y:8},{type:"L",x:30,y:8},{type:"L",x:30,y:14},{type:"L",x:60,y:14},{type:"L",x:60,y:0},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:0,y:44},{type:"L",x:60,y:44},{type:"L",x:60,y:36},{type:"L",x:30,y:36},{type:"L",x:30,y:30},{type:"L",x:0,y:30},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:10,y:18,isPrimary:!1},{x:50,y:26,isPrimary:!1},{x:18,y:38,isPrimary:!1},{x:42,y:6,isPrimary:!1}]},{name:"Crucible of Battle",zones:[{name:"Player 1",color:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",path:[{type:"M",x:0,y:0},{type:"L",x:30,y:44},{type:"L",x:0,y:44},{type:"Z"}]},{name:"Player 2",color:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",path:[{type:"M",x:60,y:44},{type:"L",x:30,y:0},{type:"L",x:60,y:0},{type:"Z"}]}],objectives:[{x:30,y:22,isPrimary:!0},{x:20,y:8,isPrimary:!1},{x:40,y:36,isPrimary:!1},{x:14,y:34,isPrimary:!1},{x:46,y:10,isPrimary:!1}]}];function kr(t){return t.map(n=>{switch(n.type){case"M":return`M ${n.x} ${n.y}`;case"L":return`L ${n.x} ${n.y}`;case"A":return`A ${n.rx} ${n.ry} ${n.rotation} ${n.largeArc} ${n.sweep} ${n.x} ${n.y}`;case"Z":return"Z";default:return""}}).join(" ")}const Sa=Tt(null),pn=Tt(null),En=Tt(null),Wo=nn([pn,En],([t,n])=>{if(!t)return{terrains:[],walls:[]};if(n==="preset"){const a=Xr.find(r=>r.name===t);return a?{terrains:a.terrains||[],walls:a.walls||[]}:{terrains:[],walls:[]}}else if(n==="saved"){const a=localStorage.getItem("warhammer-deployment-layouts");if(a)try{const r=JSON.parse(a);if(r[t])return{terrains:r[t].terrains||[],walls:r[t].walls||[]}}catch(r){console.error("Failed to load layout:",r)}}return{terrains:[],walls:[]}});var Iu=ye('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),Nu=ye('<button class="svelte-1jotvmi"> </button>'),Pu=ye('<div class="button-group svelte-1jotvmi"></div>'),$u=ye('<div class="selected-item svelte-1jotvmi"><span class="selected-name svelte-1jotvmi"> </span> <button class="small secondary svelte-1jotvmi">Change</button></div>'),Ou=ye('<button class="svelte-1jotvmi"> </button>'),Wu=ye('<button class="svelte-1jotvmi"> </button>'),Yu=ye('<div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Saved</h4> <div class="button-group svelte-1jotvmi"></div></div>'),Hu=ye('<div class="layout-sections svelte-1jotvmi"><div class="layout-group svelte-1jotvmi"><h4 class="svelte-1jotvmi">Presets</h4> <div class="button-group svelte-1jotvmi"></div></div> <!></div>'),Fu=ye('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Objectives:</span> <span class="value svelte-1jotvmi"> </span></div>'),Bu=ye('<div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Pieces:</span> <span class="value svelte-1jotvmi"> </span></div>'),qu=ye('<div class="summary svelte-1jotvmi"><div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Deployment:</span> <span class="value svelte-1jotvmi"> </span></div> <div class="summary-row svelte-1jotvmi"><span class="label svelte-1jotvmi">Terrain:</span> <span class="value svelte-1jotvmi"> </span></div> <!> <!></div>'),Uu=_e('<path stroke-width="0.10" stroke-dasharray="0.5,0.25"></path>'),Ku=_e('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15"></circle><circle stroke="#000" stroke-width="0.06"></circle><circle r="0.15" fill="#000"></circle>',1),Gu=_e("<!><!>",1),zu=_e('<g><rect fill="rgba(139, 90, 43, 0.6)" stroke="#8b5a2b" stroke-width="0.1"></rect></g>'),Xu=_e('<g><path fill="rgba(139, 69, 19, 0.8)" stroke="#5c3317" stroke-width="0.1"></path></g>'),ju=_e("<!><!><!>",1),Vu=ye('<main class="svelte-1jotvmi"><div class="header svelte-1jotvmi"><h1 class="svelte-1jotvmi">Battlefield Setup</h1> <nav class="nav-links svelte-1jotvmi"><a href="#/setup" class="active svelte-1jotvmi">Battlefield Setup</a> <a href="#/deployment" class="svelte-1jotvmi">Deployment</a> <a href="#/" class="svelte-1jotvmi">Layout Builder</a> <a href="#/debug" class="svelte-1jotvmi">Debug Mode</a></nav></div> <div class="layout svelte-1jotvmi"><div class="sidebar svelte-1jotvmi"><!> <!> <!></div> <div class="battlefield-area svelte-1jotvmi"><div class="battlefield-container svelte-1jotvmi"><!></div> <div class="info svelte-1jotvmi"><p class="svelte-1jotvmi">Battlefield: 60" x 44"</p> <p class="hint svelte-1jotvmi">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function Qu(t,n){Ut(n,!1);const a=()=>lt(Sa,"$selectedDeployment",o),r=()=>lt(pn,"$selectedLayoutName",o),s=()=>lt(Vr,"$savedLayoutsList",o),i=()=>lt(Wo,"$loadedTerrain",o),[o,l]=ls();cs(()=>{xs()});function c(w){Sa.set(w)}function u(w){pn.set(w.name),En.set("preset")}function d(w){pn.set(w),En.set("saved")}function f(){pn.set(null),En.set(null)}function m(){Sa.set(null)}function h(w){let O=[];switch(w.shape){case"L-4x8":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];break;case"L-4x8-mirror":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:8},{x:-4+.5,y:8},{x:-4+.5,y:8-.5},{x:0,y:8-.5}];break;case"C-4-8-4":O=[{x:0,y:0},{x:4,y:0},{x:4,y:.5},{x:.5,y:.5},{x:.5,y:8-.5},{x:4,y:8-.5},{x:4,y:8},{x:0,y:8}];break;case"L-5x6":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:5,y:6-.5},{x:5,y:6},{x:0,y:6}];break;case"L-5x6-mirror":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-5+.5,y:6},{x:-5+.5,y:6-.5},{x:0,y:6-.5}];break;case"L-4x6":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6-.5},{x:4,y:6-.5},{x:4,y:6},{x:0,y:6}];break;case"L-4x6-mirror":O=[{x:0,y:0},{x:.5,y:0},{x:.5,y:6},{x:-4+.5,y:6},{x:-4+.5,y:6-.5},{x:0,y:6-.5}];break;default:return""}return`M ${O.map(he=>`${w.x+he.x},${w.y+he.y}`).join(" L ")} Z`}function y(w){switch(w.shape){case"L-4x8":return{x:w.x+2,y:w.y+4};case"L-4x8-mirror":return{x:w.x-2+.5,y:w.y+4};case"C-4-8-4":return{x:w.x+2,y:w.y+4};case"L-5x6":return{x:w.x+2.5,y:w.y+3};case"L-5x6-mirror":return{x:w.x-2.5+.5,y:w.y+3};case"L-4x6":return{x:w.x+2,y:w.y+3};case"L-4x6-mirror":return{x:w.x-2+.5,y:w.y+3};default:return{x:w.x,y:w.y}}}jt();var v=Vu(),b=x(E(v),2),S=E(b),R=E(S);Dt(R,{title:"Deployment",children:(w,I)=>{var O=wt(),he=Re(O);{var V=ne=>{var z=Iu(),J=E(z),ie=E(J),le=x(J,2);X(()=>we(ie,a().name)),K("click",le,m),D(ne,z)},Z=ne=>{var z=Pu();Le(z,5,()=>Oo,ze,(J,ie)=>{var le=Nu(),be=E(le);X(()=>we(be,e(ie).name)),K("click",le,()=>c(e(ie))),D(J,le)}),D(ne,z)};pe(he,ne=>{a()?ne(V):ne(Z,!1)})}D(w,O)},$$slots:{default:!0}});var M=x(R,2);Dt(M,{title:"Terrain Layout",children:(w,I)=>{var O=wt(),he=Re(O);{var V=ne=>{var z=$u(),J=E(z),ie=E(J),le=x(J,2);X(()=>we(ie,r())),K("click",le,f),D(ne,z)},Z=ne=>{var z=Hu(),J=E(z),ie=x(E(J),2);Le(ie,5,()=>Xr,ze,(te,N)=>{var q=Ou(),j=E(q);X(()=>we(j,e(N).name)),K("click",q,()=>u(e(N))),D(te,q)});var le=x(J,2);{var be=te=>{var N=Yu(),q=x(E(N),2);Le(q,5,s,ze,(j,F)=>{var H=Wu(),$e=E(H);X(()=>we($e,e(F).name)),K("click",H,()=>d(e(F).name)),D(j,H)}),D(te,N)};pe(le,te=>{s().length>0&&te(be)})}D(ne,z)};pe(he,ne=>{r()?ne(V):ne(Z,!1)})}D(w,O)},$$slots:{default:!0}});var _=x(M,2);Dt(_,{title:"Summary",children:(w,I)=>{var O=qu(),he=E(O),V=x(E(he),2),Z=E(V),ne=x(he,2),z=x(E(ne),2),J=E(z),ie=x(ne,2);{var le=N=>{var q=Fu(),j=x(E(q),2),F=E(j);X(()=>we(F,a().objectives.length)),D(N,q)};pe(ie,N=>{a()&&N(le)})}var be=x(ie,2);{var te=N=>{var q=Bu(),j=x(E(q),2),F=E(j);X(()=>we(F,`${i().terrains.length??""} terrain, ${i().walls.length??""} walls`)),D(N,q)};pe(be,N=>{(i().terrains.length>0||i().walls.length>0)&&N(te)})}X(()=>{we(Z,a()?.name||"None"),we(J,r()||"None")}),D(w,O)},$$slots:{default:!0}});var A=x(S,2),k=E(A),$=E(k);lr($,{children:(w,I)=>{var O=ju(),he=Re(O);{var V=z=>{var J=Gu(),ie=Re(J);Le(ie,1,()=>a().zones,ze,(be,te)=>{var N=Uu();X(q=>{g(N,"d",q),g(N,"fill",e(te).color),g(N,"stroke",e(te).borderColor)},[()=>kr(e(te).path)]),D(be,N)});var le=x(ie);Le(le,1,()=>a().objectives,ze,(be,te)=>{const N=Ge(()=>e(te).isPrimary?"#fbbf24":"#9ca3af"),q=Ge(()=>e(te).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)");var j=Ku(),F=Re(j),H=x(F),$e=x(H);X(()=>{g(F,"cx",e(te).x),g(F,"cy",e(te).y),g(F,"r",Po),g(F,"fill",e(q)),g(F,"stroke",e(N)),g(H,"cx",e(te).x),g(H,"cy",e(te).y),g(H,"r",No),g(H,"fill",e(N)),g($e,"cx",e(te).x),g($e,"cy",e(te).y)}),D(be,j)}),D(z,J)};pe(he,z=>{a()&&z(V)})}var Z=x(he);Le(Z,1,()=>i().terrains,ze,(z,J)=>{const ie=Ge(()=>e(J).x+e(J).width/2),le=Ge(()=>e(J).y+e(J).height/2);var be=zu(),te=E(be);X(()=>{g(be,"transform",`rotate(${e(J).rotation??""}, ${e(ie)??""}, ${e(le)??""})`),g(te,"x",e(J).x),g(te,"y",e(J).y),g(te,"width",e(J).width),g(te,"height",e(J).height)}),D(z,be)});var ne=x(Z);Le(ne,1,()=>i().walls,ze,(z,J)=>{const ie=Ge(()=>y(e(J)));var le=Xu(),be=E(le);X(te=>{g(le,"transform",`rotate(${e(J).rotation??""}, ${e(ie).x??""}, ${e(ie).y??""})`),g(be,"d",te)},[()=>h(e(J))]),D(z,le)}),D(w,O)},$$slots:{default:!0}}),D(t,v),Kt(),l()}function Yo(){const{subscribe:t,set:n,update:a}=Tt({past:[],future:[]});return{subscribe:t,push(r){a(s=>({past:[...s.past,r],future:[]}))},undo(){let r=null;return a(s=>{if(s.past.length===0)return s;const i=[...s.past];return r=i.pop(),{past:i,future:[r,...s.future]}}),r},redo(){let r=null;return a(s=>{if(s.future.length===0)return s;const i=[...s.future];return r=i.shift(),{past:[...s.past,r],future:i}}),r},canUndo(){return Zt({subscribe:t}).past.length>0},canRedo(){return Zt({subscribe:t}).future.length>0},clear(){n({past:[],future:[]})}}}const Yn=Yo(),Lr=Yo(),it=1/25.4,en={circles:[{type:"25mm",radius:25*it/2,label:"25mm"},{type:"28.5mm",radius:28.5*it/2,label:"28mm.5"},{type:"32mm",radius:32*it/2,label:"32mm"},{type:"40mm",radius:40*it/2,label:"40mm"},{type:"50mm",radius:50*it/2,label:"50mm"},{type:"60mm",radius:60*it/2,label:"60mm"},{type:"80mm",radius:80*it/2,label:"80mm"},{type:"90mm",radius:90*it/2,label:"90mm"},{type:"100mm",radius:100*it/2,label:"100mm"},{type:"130mm",radius:130*it/2,label:"130mm"},{type:"160mm",radius:160*it/2,label:"160mm"}],ovals:[{type:"60x35.5mm",width:60*it,height:35.5*it,label:"60Ã35.5mm"},{type:"75x42mm",width:75*it,height:42*it,label:"75Ã42mm"},{type:"Small Flying Base",width:75*it,height:42*it,label:"Small Flying"},{type:"90x52.5mm",width:90*it,height:52.5*it,label:"90Ã52.5mm"},{type:"Large Flying Base",width:90*it,height:52.5*it,label:"Large Flying"},{type:"105x70mm",width:105*it,height:70*it,label:"105Ã70mm"},{type:"120x92mm",width:120*it,height:92*it,label:"120Ã92mm"},{type:"150x95mm",width:150*it,height:95*it,label:"150Ã95mm"},{type:"170x109mm",width:170*it,height:109*it,label:"170Ã109mm"}]};function ja(t,n=null){const a=en.circles.find(s=>s.type===t);if(a)return a;const r=en.ovals.find(s=>s.type===t);return r||(nr(t)&&n?{type:t,width:n.customWidth,height:n.customHeight,label:`${n.customWidth.toFixed(1)}"Ã${n.customHeight.toFixed(1)}"`}:null)}function Ta(t){return en.ovals.some(n=>n.type===t)}function nr(t){return t&&t.startsWith("rect-")}function _i(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function Ho(t){const{subscribe:n,set:a,update:r}=Tt([]);return{subscribe:n,set:a,update:r,add(s,i,o,l,c=null,u=!1){const d=_i(),f={id:d,baseType:s,playerId:i,x:o,y:l,rotation:0};return c&&c.width&&c.height&&(f.customWidth=c.width,f.customHeight=c.height),r(m=>[...m,f]),!u&&t&&t.push({type:"add",modelId:d,model:{...f}}),d},updateModel(s,i,o=!1){let l=null,c=null;if(!o&&t){const d=Zt({subscribe:n}).find(f=>f.id===s);d&&(l={...d},"x"in i||"y"in i?c="move":"rotation"in i&&(c="rotate"))}if(r(u=>u.map(d=>d.id===s?{...d,...i}:d)),!o&&t&&c&&l){const d=Zt({subscribe:n}).find(f=>f.id===s);t.push({type:c,modelId:s,before:c==="move"?{x:l.x,y:l.y}:{rotation:l.rotation},after:c==="move"?{x:d.x,y:d.y}:{rotation:d.rotation}})}},remove(s,i=!1){let o=null;!i&&t&&(o=Zt({subscribe:n}).find(c=>c.id===s)),r(l=>l.filter(c=>c.id!==s)),!i&&t&&o&&t.push({type:"remove",modelId:s,model:{...o}})},removeByPlayer(s){r(i=>i.filter(o=>o.playerId!==s))},addBatch(s,i=!1){const o=[];return r(l=>{const c=[...l];return s.forEach(u=>{const d=u.id||_i(),f={...u,id:d};c.push(f),o.push(d),!i&&t&&t.push({type:"add",modelId:d,model:{...f}})}),c}),o},updateUnit(s,i,o=!1){r(l=>l.map(c=>c.unitId===s?{...c,...i}:c))},removeUnit(s,i=!1){const o=[];if(!i&&t){const l=Zt({subscribe:n});o.push(...l.filter(c=>c.unitId===s))}r(l=>l.filter(c=>c.unitId!==s)),!i&&t&&o.forEach(l=>{t.push({type:"remove",modelId:l.id,model:{...l}})})},clear(){a([]),t&&t.clear()},undo(){if(!t)return;const s=t.undo();if(s)switch(s.type){case"add":this.remove(s.modelId,!0);break;case"remove":r(i=>[...i,s.model]);break;case"move":this.updateModel(s.modelId,s.before,!0);break;case"rotate":this.updateModel(s.modelId,s.before,!0);break}},redo(){if(!t)return;const s=t.redo();if(s)switch(s.type){case"add":r(i=>[...i,s.model]);break;case"remove":this.remove(s.modelId,!0);break;case"move":this.updateModel(s.modelId,s.after,!0);break;case"rotate":this.updateModel(s.modelId,s.after,!0);break}}}}const gt=Ho(Yn),Ju=nn(gt,t=>t.filter(n=>n.playerId===1)),Zu=nn(gt,t=>t.filter(n=>n.playerId===2)),em=Tt(null);nn([gt,em],([t,n])=>n?t.find(a=>a.id===n):null);const ra=Ho(Lr),ga=Tt(null);nn([ra,ga],([t,n])=>n?t.find(a=>a.id===n):null);var tm=_e('<g><rect role="button" tabindex="0" class="svelte-hycs6b"></rect></g>'),nm=_e('<g><ellipse role="button" tabindex="0" class="svelte-hycs6b"></ellipse></g>'),am=_e('<circle role="button" tabindex="0" class="svelte-hycs6b"></circle>'),sm=_e('<text text-anchor="middle" dominant-baseline="middle" font-weight="bold" fill="white" stroke="black" stroke-width="0.02" paint-order="stroke" pointer-events="none" class="model-name"> </text>'),rm=_e('<line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="rotate-handle svelte-hycs6b"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),im=_e('<line stroke="#fbbf24" stroke-width="0.12" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.25" fill="#fbbf24" pointer-events="none" class="svelte-hycs6b"></circle><text text-anchor="middle" dominant-baseline="middle" font-size="0.5" font-weight="bold" fill="#fbbf24" stroke="#000" stroke-width="0.05" paint-order="stroke" pointer-events="none" class="drag-ruler-label svelte-hycs6b"> </text>',1),om=_e("<g><!><!><!><!></g>");function Rs(t,n){Ut(n,!1);const a=W(),r=W(),s=W(),i=W(),o=W(),l=W(),c=W(),u=W(),d=W(),f=W(),m=W(),h=W(),y=W(),v=W(),b=W(),S=W(),R=W(),M=W(),_=W(),A=W(),k=W();let $=Ce(n,"id",8),w=Ce(n,"x",8),I=Ce(n,"y",8),O=Ce(n,"baseType",8),he=Ce(n,"playerId",8),V=Ce(n,"rotation",8,0),Z=Ce(n,"selected",8,!1),ne=Ce(n,"marqueePreview",8,!1),z=Ce(n,"name",8,""),J=Ce(n,"customWidth",8,null),ie=Ce(n,"customHeight",8,null),le=Ce(n,"screenToSvg",8),be=Ce(n,"onSelect",8,()=>{}),te=Ce(n,"onDrag",8,()=>{}),N=Ce(n,"onDragEnd",8,()=>{}),q=Ce(n,"onRotate",8,()=>{}),j=Ce(n,"onRotateEnd",8,()=>{}),F=Ce(n,"onRename",8,()=>{}),H=W(!1),$e=!1,Ue={x:0,y:0},G=W(null),oe=null;function ke(Ee){Ee.stopPropagation()}function ce(Ee){Ee.stopPropagation();const Fe=prompt("Model name:",z());Fe!==null&&F()($(),Fe)}function xt(Ee){if(Ee.button!==0)return;Ee.preventDefault(),Ee.stopPropagation(),be()($(),Ee),T(H,!0),T(G,{x:w(),y:I()});const Fe=le()(Ee.clientX,Ee.clientY);Ue={x:Fe.x-w(),y:Fe.y-I()},window.addEventListener("mousemove",ht),window.addEventListener("mouseup",Ye)}function ht(Ee){if(!e(H))return;const Fe=le()(Ee.clientX,Ee.clientY);let Ie=Fe.x-Ue.x,ut=Fe.y-Ue.y;te()($(),Ie,ut)}function Ye(){e(H)&&e(G)&&((e(G).x!==w()||e(G).y!==I())&&N()($(),e(G).x,e(G).y,w(),I()),T(G,null)),T(H,!1),window.removeEventListener("mousemove",ht),window.removeEventListener("mouseup",Ye)}function De(Ee){Ee.preventDefault(),Ee.stopPropagation(),$e=!0,oe=V(),window.addEventListener("mousemove",vt),window.addEventListener("mouseup",Je)}function vt(Ee){if(!$e)return;const Fe=le()(Ee.clientX,Ee.clientY),Ie=Fe.x-w(),ut=Fe.y-I();let _t=Math.atan2(ut,Ie)*180/Math.PI+45;Ee.shiftKey||(_t=Math.round(_t/15)*15),q()($(),_t)}function Je(){$e&&oe!==null&&(oe!==V()&&j()($(),oe,V()),oe=null),$e=!1,window.removeEventListener("mousemove",vt),window.removeEventListener("mouseup",Je)}me(()=>(se(J()),se(ie())),()=>{T(a,{customWidth:J(),customHeight:ie()})}),me(()=>(se(O()),e(a)),()=>{T(r,ja(O(),e(a)))}),me(()=>se(O()),()=>{T(s,Ta(O()))}),me(()=>se(O()),()=>{T(i,nr(O()))}),me(()=>se(he()),()=>{T(o,he()===1?"#3b82f6":"#ef4444")}),me(()=>se(he()),()=>{T(l,he()===1?"rgba(59, 130, 246, 0.5)":"rgba(239, 68, 68, 0.5)")}),me(()=>se(he()),()=>{T(c,he()===1?"rgba(59, 130, 246, 0.3)":"rgba(239, 68, 68, 0.3)")}),me(()=>(se(Z()),se(ne())),()=>{T(u,Z()?.15:ne()?.12:.1)}),me(()=>(se(Z()),e(o),se(ne()),e(c),e(l)),()=>{T(d,Z()?e(o):ne()?e(c):e(l))}),me(()=>e(r),()=>{T(f,e(r)?.radius||.5)}),me(()=>e(r),()=>{T(m,e(r)?.width?e(r).width/2:0)}),me(()=>e(r),()=>{T(h,e(r)?.height?e(r).height/2:0)}),me(()=>(e(i),se(J())),()=>{T(y,e(i)&&J()||0)}),me(()=>(e(i),se(ie())),()=>{T(v,e(i)&&ie()||0)}),me(()=>(e(s),e(m),e(h),e(i),e(y),e(v)),()=>{T(b,e(s)?Math.max(e(m),e(h))+1:e(i)?Math.max(e(y),e(v))/2+1:0)}),me(()=>(se(w()),e(b),se(V())),()=>{T(S,w()+e(b)*Math.cos((V()-45)*Math.PI/180))}),me(()=>(se(I()),e(b),se(V())),()=>{T(R,I()+e(b)*Math.sin((V()-45)*Math.PI/180))}),me(()=>(e(H),e(G),se(w()),se(I())),()=>{T(M,e(H)&&e(G)?Math.sqrt(Math.pow(w()-e(G).x,2)+Math.pow(I()-e(G).y,2)):0)}),me(()=>(e(H),e(G),se(w())),()=>{T(_,e(H)&&e(G)?(e(G).x+w())/2:0)}),me(()=>(e(H),e(G),se(I())),()=>{T(A,e(H)&&e(G)?(e(G).y+I())/2:0)}),me(()=>(e(i),e(y),e(v),e(s),e(m),e(h),e(f)),()=>{T(k,e(i)?Math.min(e(y),e(v))*.2:e(s)?Math.min(e(m),e(h))*.4:e(f)*.5)}),In(),jt();var Qe=om();let U;var Se=E(Qe);{var Oe=Ee=>{var Fe=tm(),Ie=E(Fe);X(()=>{g(Fe,"transform",`rotate(${V()??""}, ${w()??""}, ${I()??""})`),g(Ie,"x",w()-e(y)/2),g(Ie,"y",I()-e(v)/2),g(Ie,"width",e(y)),g(Ie,"height",e(v)),g(Ie,"fill",e(d)),g(Ie,"stroke",e(o)),g(Ie,"stroke-width",e(u))}),K("click",Ie,ke),K("dblclick",Ie,ce),K("mousedown",Ie,xt),D(Ee,Fe)},ct=Ee=>{var Fe=wt(),Ie=Re(Fe);{var ut=Be=>{var L=nm(),re=E(L);X(()=>{g(L,"transform",`rotate(${V()??""}, ${w()??""}, ${I()??""})`),g(re,"cx",w()),g(re,"cy",I()),g(re,"rx",e(m)),g(re,"ry",e(h)),g(re,"fill",e(d)),g(re,"stroke",e(o)),g(re,"stroke-width",e(u))}),K("click",re,ke),K("dblclick",re,ce),K("mousedown",re,xt),D(Be,L)},_t=Be=>{var L=am();X(()=>{g(L,"cx",w()),g(L,"cy",I()),g(L,"r",e(f)),g(L,"fill",e(d)),g(L,"stroke",e(o)),g(L,"stroke-width",e(u))}),K("click",L,ke),K("dblclick",L,ce),K("mousedown",L,xt),D(Be,L)};pe(Ie,Be=>{e(s)?Be(ut):Be(_t,!1)},!0)}D(Ee,Fe)};pe(Se,Ee=>{e(i)?Ee(Oe):Ee(ct,!1)})}var tt=x(Se);{var ft=Ee=>{var Fe=sm(),Ie=E(Fe);X(()=>{g(Fe,"x",w()),g(Fe,"y",I()),g(Fe,"font-size",e(k)),we(Ie,z())}),D(Ee,Fe)};pe(tt,Ee=>{z()&&Ee(ft)})}var At=x(tt);{var Pt=Ee=>{var Fe=rm(),Ie=Re(Fe),ut=x(Ie),_t=x(ut);X(()=>{g(Ie,"x1",w()),g(Ie,"y1",I()),g(Ie,"x2",e(S)),g(Ie,"y2",e(R)),g(ut,"cx",e(S)),g(ut,"cy",e(R)),g(_t,"transform",`translate(${e(S)??""}, ${e(R)??""})`)}),K("mousedown",ut,De),D(Ee,Fe)};pe(At,Ee=>{Z()&&(e(s)||e(i))&&Ee(Pt)})}var Ct=x(At);{var kt=Ee=>{var Fe=im(),Ie=Re(Fe),ut=x(Ie),_t=x(ut),Be=E(_t);X(L=>{g(Ie,"x1",(e(G),p(()=>e(G).x))),g(Ie,"y1",(e(G),p(()=>e(G).y))),g(Ie,"x2",w()),g(Ie,"y2",I()),g(ut,"cx",(e(G),p(()=>e(G).x))),g(ut,"cy",(e(G),p(()=>e(G).y))),g(_t,"x",e(_)),g(_t,"y",e(A)-.5),we(Be,`${L??""}"`)},[()=>(e(M),p(()=>e(M).toFixed(2)))]),D(Ee,Fe)};pe(Ct,Ee=>{e(H)&&e(G)&&e(M)>.1&&Ee(kt)})}X(()=>U=dn(Qe,0,"model-base svelte-hycs6b",null,U,{selected:Z(),dragging:e(H)})),D(t,Qe),Kt()}var lm=_e('<ellipse fill="none" stroke-width="2"></ellipse>'),cm=_e('<circle fill="none" stroke-width="2"></circle>'),um=ye('<button class="palette-item svelte-1urec28"><svg class="svelte-1urec28"><!></svg> <span class="label svelte-1urec28"> </span></button>');function ar(t,n){Ut(n,!1);const a=W(),r=W(),s=W(),i=W(),o=W(),l=W();let c=Ce(n,"baseSize",8),u=Ce(n,"playerId",8),d=Ce(n,"onDragStart",8,()=>{});const f=3;function m(_){_.button===0&&(_.preventDefault(),d()(c(),_))}me(()=>se(u()),()=>{T(a,u()===1?"#3b82f6":"#ef4444")}),me(()=>se(c()),()=>{T(r,c().width!==void 0)}),me(()=>(e(r),se(c())),()=>{T(s,e(r)?null:c().radius*f)}),me(()=>(e(r),se(c())),()=>{T(i,e(r)?c().width/2*f:null)}),me(()=>(e(r),se(c())),()=>{T(o,e(r)?c().height/2*f:null)}),me(()=>(e(r),se(c())),()=>{T(l,e(r)?Math.max(c().width,c().height)*f:c().radius*2*f)}),In(),jt();var h=um(),y=E(h),v=E(y);{var b=_=>{var A=lm();X(()=>{g(A,"cx",(e(l)+8)/2),g(A,"cy",(e(l)+8)/2),g(A,"rx",e(i)),g(A,"ry",e(o)),g(A,"stroke",e(a))}),D(_,A)},S=_=>{var A=cm();X(()=>{g(A,"cx",(e(l)+8)/2),g(A,"cy",(e(l)+8)/2),g(A,"r",e(s)),g(A,"stroke",e(a))}),D(_,A)};pe(v,_=>{e(r)?_(b):_(S,!1)})}var R=x(y,2),M=E(R);X(()=>{xc(h,`border-color: ${e(a)??""}`),g(h,"title",(se(c()),p(()=>c().label))),g(y,"width",e(l)+8),g(y,"height",e(l)+8),g(y,"viewBox",`0 0 ${e(l)+8} ${e(l)+8}`),we(M,(se(c()),p(()=>c().label)))}),K("mousedown",h,m),D(t,h),Kt()}const Fo="warhammer-imported-armies";function mm(){try{const t=localStorage.getItem(Fo);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load army imports from storage:",t),[]}}function vr(t){try{localStorage.setItem(Fo,JSON.stringify(t))}catch(n){console.error("Failed to save army imports to storage:",n)}}function dm(){return"import-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function hm(){const{subscribe:t,set:n,update:a}=Tt(mm());return{subscribe:t,addImport(r,s,i,o){const l=dm(),c={id:l,name:r||"Unnamed Army",timestamp:Date.now(),rawText:s,parsedData:i,faction:i.FACTION_KEYWORD||"Unknown",totalPoints:i.TOTAL_ARMY_POINTS||"0pts",playerId:o};return a(u=>{const d=[...u,c];return vr(d),d}),l},removeImport(r){a(s=>{const i=s.filter(o=>o.id!==r);return vr(i),i})},getImport(r){return Zt({subscribe:t}).find(i=>i.id===r)||null},clear(){n([]),vr([])}}}const Dr=hm();var fm=ye('<div class="error-message svelte-leqhjl"> </div>'),ym=ye('<div class="success-message svelte-leqhjl"> </div>'),pm=ye("<option> </option>"),vm=ye('<div class="army-import-panel svelte-leqhjl"><div class="form-group svelte-leqhjl"><label for="army-list-input" class="svelte-leqhjl">Paste Army List:</label> <textarea id="army-list-input" placeholder="Paste your army list here (GW App, WTC, ListForge formats supported)" rows="12" class="svelte-leqhjl"></textarea></div> <div class="button-group svelte-leqhjl"><button class="svelte-leqhjl"> </button> <button class="svelte-leqhjl">Clear</button></div> <!> <!> <div class="divider svelte-leqhjl"></div> <div class="form-group svelte-leqhjl"><label for="import-select" class="svelte-leqhjl">Load Previous Import:</label> <select id="import-select" class="svelte-leqhjl"><option>-- Select an import --</option><!></select> <button class="load-button svelte-leqhjl">Load</button></div></div>');function gm(t,n){Ut(n,!1);const a=()=>lt(Dr,"$armyImports",r),[r,s]=ls();let i=Ce(n,"currentPlayer",8,1);const o=zr();let l=W(""),c=W(!1),u=W(""),d=W(""),f=W("");function m(){if(!e(l).trim()){T(u,"Please paste an army list");return}T(c,!0),T(u,""),T(d,""),o("parse",{text:e(l),playerId:i()})}function h(){if(!e(f))return;const N=Dr.getImport(e(f));N&&(T(l,N.rawText),T(d,`Loaded: ${N.name} (${N.faction}, ${N.totalPoints})`),T(u,""))}function y(){T(l,""),T(u,""),T(d,"")}function v(N){T(c,N)}function b(N){T(u,N),T(d,""),T(c,!1)}function S(N){T(d,N),T(u,""),T(c,!1)}function R(){T(l,"")}var M={setLoading:v,setError:b,setSuccess:S,clearText:R};jt();var _=vm(),A=E(_),k=x(E(A),2),$=x(A,2),w=E($),I=E(w),O=x(w,2),he=x($,2);{var V=N=>{var q=fm(),j=E(q);X(()=>we(j,`â ï¸ ${e(u)??""}`)),D(N,q)};pe(he,N=>{e(u)&&N(V)})}var Z=x(he,2);{var ne=N=>{var q=ym(),j=E(q);X(()=>we(j,`â ${e(d)??""}`)),D(N,q)};pe(Z,N=>{e(d)&&N(ne)})}var z=x(Z,4),J=x(E(z),2);X(()=>{e(f),co(()=>{e(c),a()})});var ie=E(J);ie.value=ie.__value="";var le=x(ie);Le(le,1,a,N=>N.id,(N,q)=>{var j=pm(),F=E(j),H={};X(()=>{we(F,`${e(q),p(()=>e(q).name)??""} (${e(q),p(()=>e(q).faction)??""}, ${e(q),p(()=>e(q).totalPoints)??""})`),H!==(H=(e(q),p(()=>e(q).id)))&&(j.value=(j.__value=(e(q),p(()=>e(q).id)))??"")}),D(N,j)});var be=x(J,2);X(N=>{k.disabled=e(c),w.disabled=N,we(I,e(c)?"Parsing...":"Parse Army List"),O.disabled=e(c),J.disabled=e(c),be.disabled=e(c)||!e(f)},[()=>(e(c),e(l),p(()=>e(c)||!e(l).trim()))]),Ht(k,()=>e(l),N=>T(l,N)),K("click",w,m),K("click",O,y),xo(J,()=>e(f),N=>T(f,N)),K("click",be,h),D(t,_),Ts(n,"setLoading",v),Ts(n,"setError",b),Ts(n,"setSuccess",S),Ts(n,"clearText",R);var te=Kt(M);return s(),te}var bm=ye("<option> </option>"),Tm=ye('<tr><td class="unit-name svelte-1xyf33v"> </td><td class="quantity svelte-1xyf33v"> </td><td class="svelte-1xyf33v"><select class="svelte-1xyf33v"></select></td><td class="skip-cell svelte-1xyf33v"><input type="checkbox" class="svelte-1xyf33v"/></td></tr>'),xm=ye('<div class="dialog-overlay svelte-1xyf33v"><div class="dialog svelte-1xyf33v"><div class="dialog-header svelte-1xyf33v"><h3 class="svelte-1xyf33v">Unmatched Units</h3> <button class="close-button svelte-1xyf33v">&times;</button></div> <div class="dialog-content svelte-1xyf33v"><p class="info-text svelte-1xyf33v">The following units were not found in the database. Please select base sizes or skip them:</p> <div class="units-table svelte-1xyf33v"><table class="svelte-1xyf33v"><thead class="svelte-1xyf33v"><tr><th class="svelte-1xyf33v">Unit Name</th><th class="svelte-1xyf33v">Quantity</th><th class="svelte-1xyf33v">Base Size</th><th class="svelte-1xyf33v">Skip</th></tr></thead><tbody></tbody></table></div></div> <div class="dialog-footer svelte-1xyf33v"><button class="cancel-button svelte-1xyf33v">Cancel</button> <button class="import-button svelte-1xyf33v">Import Selected</button></div></div></div>');function _m(t,n){Ut(n,!1);let a=Ce(n,"unmatchedUnits",24,()=>[]),r=Ce(n,"show",12,!1);const s=zr();let i=W({});const o=[...en.circles.map(m=>({value:m.type,label:m.label})),...en.ovals.map(m=>({value:m.type,label:m.label})),{value:"rect-custom",label:"Custom Rectangle (Vehicle)"}];function l(){const m=a().filter(h=>!e(i)[h.id]?.skip).map(h=>({unitName:h.unitName,quantity:h.quantity,baseType:e(i)[h.id]?.baseType||"32mm"}));s("import",{selected:m}),c()}function c(){r(!1),s("close")}me(()=>se(a()),()=>{T(i,{}),a().forEach(m=>{fr(i,e(i)[m.id]={baseType:"32mm",skip:!1})})}),In(),jt();var u=wt(),d=Re(u);{var f=m=>{var h=xm(),y=E(h),v=E(y),b=x(E(v),2),S=x(v,2),R=x(E(S),2),M=E(R),_=x(E(M));Le(_,5,a,w=>w.id,(w,I)=>{var O=Tm();let he;var V=E(O),Z=E(V),ne=x(V),z=E(ne),J=x(ne),ie=E(J);X(()=>{e(i),co(()=>{e(I)})}),Le(ie,5,()=>o,ze,(te,N)=>{var q=bm(),j=E(q),F={};X(()=>{we(j,(e(N),p(()=>e(N).label))),F!==(F=(e(N),p(()=>e(N).value)))&&(q.value=(q.__value=(e(N),p(()=>e(N).value)))??"")}),D(te,q)});var le=x(J),be=E(le);X(()=>{he=dn(O,1,"svelte-1xyf33v",null,he,{skipped:e(i)[e(I).id]?.skip}),we(Z,(e(I),p(()=>e(I).unitName))),we(z,(e(I),p(()=>e(I).quantity||"1x"))),ie.disabled=(e(i),e(I),p(()=>e(i)[e(I).id]?.skip))}),xo(ie,()=>e(i)[e(I).id].baseType,te=>fr(i,e(i)[e(I).id].baseType=te)),ba(be,()=>e(i)[e(I).id].skip,te=>fr(i,e(i)[e(I).id].skip=te)),D(w,O)});var A=x(S,2),k=E(A),$=x(k,2);K("click",b,c),K("click",k,c),K("click",$,l),K("click",y,w=>w.stopPropagation()),K("click",h,c),D(m,h)};pe(d,m=>{r()&&m(f)})}D(t,u),Kt()}const un=Tt([]),da=Tt([]);function Si(t,n){const a={};t.forEach(s=>{const i=s.unitId||"ungrouped";a[i]||(a[i]=[]),a[i].push(s)});const r=[];for(const s in a){const i=a[s],o=i[0];r.push({id:s,name:o.unitName||"Unknown Unit",playerId:o.playerId,modelIds:i.map(l=>l.id),importId:n})}un.update(s=>[...s,...t]),da.update(s=>[...s,...r])}function Sm(t){const a=Zt(da).find(r=>r.id===t);a&&(un.update(r=>r.filter(s=>!a.modelIds.includes(s.id))),da.update(r=>r.filter(s=>s.id!==t)))}function wm(t,n=30,a=22){const s=Zt(un).filter(c=>t.includes(c.id));if(s.length===0)return;const i=2;let o=0,l=0;s.forEach((c,u)=>{const d={...c,x:n+o,y:a+l,inStaging:!1};gt.update(f=>[...f,d]),o+=i,(u+1)%5===0&&(o=0,l+=i)}),un.update(c=>c.filter(u=>!t.includes(u.id))),da.update(c=>c.map(u=>({...u,modelIds:u.modelIds.filter(d=>!t.includes(d))})).filter(u=>u.modelIds.length>0))}function Am(){un.set([]),da.set([])}nn(un,t=>t.filter(n=>n.playerId===1));nn(un,t=>t.filter(n=>n.playerId===2));nn(da,t=>t.filter(n=>n.playerId===1));nn(da,t=>t.filter(n=>n.playerId===2));var Cm=_e('<g class="unit-group"><rect fill="none" stroke-dasharray="0.3 0.2" opacity="0.6" cursor="pointer"></rect><text text-anchor="middle" font-size="0.5" font-weight="600" pointer-events="none"> </text><g class="remove-button svelte-1lpiqbg" cursor="pointer"><circle r="0.25" fill="#dc3545" opacity="0.8" class="svelte-1lpiqbg"></circle><line stroke="white" stroke-width="0.08"></line><line stroke="white" stroke-width="0.08"></line></g></g>');function Em(t,n){Ut(n,!1);const a=W(),r=W(),s=W(),i=W();let o=Ce(n,"unit",8),l=Ce(n,"models",24,()=>[]),c=Ce(n,"selected",8,!1),u=Ce(n,"onclick",8,()=>{}),d=Ce(n,"onremove",8,()=>{});function f(v){if(v.length===0)return{minX:0,minY:0,maxX:0,maxY:0,width:0,height:0};const b=v.map(A=>({x:A.x,y:A.y})),S=Math.min(...b.map(A=>A.x))-.5,R=Math.min(...b.map(A=>A.y))-.5,M=Math.max(...b.map(A=>A.x))+.5,_=Math.max(...b.map(A=>A.y))+.5;return{minX:S,minY:R,maxX:M,maxY:_,width:M-S,height:_-R}}me(()=>(se(l()),se(o())),()=>{T(a,l().filter(v=>o().modelIds.includes(v.id)))}),me(()=>e(a),()=>{T(r,f(e(a)))}),me(()=>e(r),()=>{T(s,e(r).minX+e(r).width/2)}),me(()=>e(r),()=>{T(i,e(r).minY-.3)}),In(),jt();var m=wt(),h=Re(m);{var y=v=>{var b=Cm(),S=E(b),R=x(S),M=E(R),_=x(R),A=E(_),k=x(A),$=x(k);X(()=>{g(S,"x",(e(r),p(()=>e(r).minX))),g(S,"y",(e(r),p(()=>e(r).minY))),g(S,"width",(e(r),p(()=>e(r).width))),g(S,"height",(e(r),p(()=>e(r).height))),g(S,"stroke",c()?"#ffc107":"#adb5bd"),g(S,"stroke-width",c()?"0.15":"0.08"),g(R,"x",e(s)),g(R,"y",e(i)),g(R,"fill",c()?"#333":"#6c757d"),we(M,`${se(o()),p(()=>o().name)??""} (${e(a),p(()=>e(a).length)??""})`),g(A,"cx",(e(r),p(()=>e(r).maxX-.3))),g(A,"cy",(e(r),p(()=>e(r).minY+.3))),g(k,"x1",(e(r),p(()=>e(r).maxX-.4))),g(k,"y1",(e(r),p(()=>e(r).minY+.2))),g(k,"x2",(e(r),p(()=>e(r).maxX-.2))),g(k,"y2",(e(r),p(()=>e(r).minY+.4))),g($,"x1",(e(r),p(()=>e(r).maxX-.2))),g($,"y1",(e(r),p(()=>e(r).minY+.2))),g($,"x2",(e(r),p(()=>e(r).maxX-.4))),g($,"y2",(e(r),p(()=>e(r).minY+.4)))}),K("click",S,function(...w){u()?.apply(this,w)}),K("click",_,w=>{w.stopPropagation(),d()()}),D(v,b)};pe(h,v=>{e(a),p(()=>e(a).length>0)&&v(y)})}D(t,m),Kt()}var Mm=_e('<line y1="0" y2="60" stroke="#2a2a2a" stroke-width="0.05"></line>'),Rm=_e('<line x1="0" x2="30" stroke="#2a2a2a" stroke-width="0.05"></line>'),km=_e('<text text-anchor="middle" font-size="0.4" fill="#6c757d" font-weight="600" pointer-events="none">STAGING</text>'),Lm=_e("<!><!>",1),Dm=_e('<text x="15" y="30" text-anchor="middle" font-size="0.8" fill="#666">No models in staging</text>'),Im=ye('<div class="staging-area svelte-cjtwzf"><div class="staging-header svelte-cjtwzf"><h3 class="svelte-cjtwzf">Staging Area</h3> <div class="button-group svelte-cjtwzf"><button class="svelte-cjtwzf"> </button> <button class="svelte-cjtwzf"> </button> <button class="clear-button svelte-cjtwzf">Clear</button></div></div> <div class="staging-canvas svelte-cjtwzf"><svg viewBox="0 0 30 60" class="staging-svg svelte-cjtwzf"><rect x="0" y="0" width="30" height="60" fill="#1a1a1a" stroke="#444" stroke-width="0.1"></rect><!><!><!><!><!></svg></div></div>');function Nm(t,n){Ut(n,!1);const a=()=>lt(un,"$stagingModels",s),r=()=>lt(da,"$stagingUnits",s),[s,i]=ls(),o=zr();let l=W(new Set),c=W();function u(N,q){if(!e(c))return{x:0,y:0};const j=e(c).createSVGPoint();j.x=N,j.y=q;const F=j.matrixTransform(e(c).getScreenCTM().inverse());return{x:F.x,y:F.y}}function d(N){T(l,new Set([N]))}function f(N,q,j){un.update(F=>F.map(H=>H.id===N?{...H,x:q,y:j}:H))}function m(N){}function h(N,q){un.update(j=>j.map(F=>F.id===N?{...F,rotation:q}:F))}function y(N){}function v(N,q){un.update(j=>j.map(F=>F.id===N?{...F,unitName:q}:F))}function b(){o("deploy",{modelIds:a().map(N=>N.id)})}function S(){o("deploy",{modelIds:Array.from(e(l))})}function R(){confirm("Clear all models from staging area?")&&(Am(),o("clear"))}function M(N){confirm("Remove this unit from staging?")&&Sm(N)}function _(N){const q=r().find(j=>j.id===N);q&&T(l,new Set(q.modelIds))}jt();var A=Im(),k=E(A),$=x(E(k),2),w=E($),I=E(w),O=x(w,2),he=E(O),V=x(O,2),Z=x(k,2),ne=E(Z),z=x(E(ne));Le(z,0,()=>Array(16),ze,(N,q,j)=>{var F=Mm();g(F,"x1",j*2),g(F,"x2",j*2),D(N,F)});var J=x(z);Le(J,0,()=>Array(31),ze,(N,q,j)=>{var F=Rm();g(F,"y1",j*2),g(F,"y2",j*2),D(N,F)});var ie=x(J);Le(ie,1,r,N=>N.id,(N,q)=>{{let j=Ge(()=>e(q).modelIds.every(F=>e(l).has(F)));Em(N,{get unit(){return e(q)},get models(){return a()},get selected(){return e(j)},onclick:()=>_(e(q).id),onremove:()=>M(e(q).id)})}});var le=x(ie);Le(le,1,a,N=>N.id,(N,q)=>{var j=Lm(),F=Re(j);{let Ue=Ge(()=>e(q).name||e(q).unitName),G=Ge(()=>e(l).has(e(q).id));Rs(F,{get id(){return e(q).id},get x(){return e(q).x},get y(){return e(q).y},get baseType(){return e(q).baseType},get playerId(){return e(q).playerId},get rotation(){return e(q).rotation},get name(){return e(Ue)},get customWidth(){return e(q).customWidth},get customHeight(){return e(q).customHeight},get selected(){return e(G)},screenToSvg:u,onSelect:d,onDrag:f,onDragEnd:m,onRotate:h,onRotateEnd:y,onRename:v})}var H=x(F);{var $e=Ue=>{var G=km();X(()=>{g(G,"x",e(q).x),g(G,"y",e(q).y-1)}),D(Ue,G)};pe(H,Ue=>{e(q).inStaging&&Ue($e)})}D(N,j)});var be=x(le);{var te=N=>{var q=Dm();D(N,q)};pe(be,N=>{a().length===0&&N(te)})}Es(ne,N=>T(c,N),()=>e(c)),X(()=>{w.disabled=e(l).size===0,we(I,`Deploy Selected (${e(l).size??""})`),O.disabled=a().length===0,we(he,`Deploy All (${a().length??""})`),V.disabled=a().length===0}),K("click",w,S),K("click",O,b),K("click",V,R),D(t,A),Kt(),i()}function ua(t){const n=t.match(/^\s*/);return n?n[0].length:0}function Q(t){return t?t.toLowerCase().replace(/\s+/g," ").trim():""}function ha(t){const n=/^(?:(\d+)x?\s+)?(.*)/,a=t.trim().match(n);if(a){const r=a[1]?`${a[1]}x`:"1x";let s=a[2].trim();return s=s.replace(/^with\s+/i,"").trim(),{quantity:r,name:s}}return{quantity:"1x",name:t.trim()}}function bn(t){return Array.isArray(t)&&t.sort((n,a)=>{const r=parseInt(String(n&&n.quantity||"1x").replace(/x/i,""),10)||1,s=parseInt(String(a&&a.quantity||"1x").replace(/x/i,""),10)||1;if(r!==s)return s-r;const i=n&&n.name?n.name.toString().toLowerCase():"",o=a&&a.name?a.name.toString().toLowerCase():"";return i<o?-1:i>o?1:0}),t}const Rn={"World Eaters":"Chaos","Chaos Space Marines":"Chaos","Emperor's Children":"Chaos","Death Guard":"Chaos","Chaos Daemons":"Chaos","Chaos Knights":"Chaos","Thousand Sons":"Chaos","Space Marines":"Imperium","Iron Hands":"Space Marines",Salamanders:"Space Marines","Space Wolves":"Space Marines",Ultramarines:"Space Marines","White Scars":"Space Marines","Adepta Sororitas":"Imperium","Astra Militarum":"Imperium","Imperial Fists":"Space Marines","Dark Angels":"Space Marines","Blood Angels":"Space Marines","Raven Guard":"Space Marines","Black Templars":"Space Marines",Deathwatch:"Space Marines","Grey Knights":"Imperium","Imperial Knights":"Imperium","Adeptus Custodes":"Imperium","Adeptus Titanicus":"Imperium","Adeptus Mechanicus":"Imperium","Agents of the Imperium":"Imperium",Aeldari:"Xenos",Drukhari:"Xenos",Ynnari:"Xenos",Harlequins:"Xenos",Necrons:"Xenos",Orks:"Xenos",Tyranids:"Xenos","T'au Empire":"Xenos",Tau:"Xenos","T'au":"Xenos","Genestealer Cults":"Xenos","Leagues of Votann":"Xenos"};function Ia(t){if(!t)return t;t.SUMMARY=t.SUMMARY||{};const n=t.SUMMARY;n.LIST_TITLE=n.LIST_TITLE||"",n.FACTION_KEYWORD&&(n.FACTION_KEYWORD=String(n.FACTION_KEYWORD).trim()),n.DETACHMENT&&(n.DETACHMENT=String(n.DETACHMENT).replace(/\u00A0/g," ").trim()),n.TOTAL_ARMY_POINTS&&(n.TOTAL_ARMY_POINTS=String(n.TOTAL_ARMY_POINTS).trim());const a=s=>{if(!s)return"";try{return s.toString().normalize("NFD").replace(new RegExp("\\p{M}","gu"),"").replace(/[\u2018\u2019\u201B\u2032]/g,"'").replace(/[^\w\s'\-]/g,"").toLowerCase().trim()}catch{return s.toString().toLowerCase().trim()}},r=n.FACTION_KEYWORD||null;if(r){const s=a(r);let i;for(const o of Object.keys(Rn))if(a(o)===s){i=o;break}if(i){const o=r.toString().replace(/[\u2018\u2019\u201B\u2032]/g,"'").trim();n.DISPLAY_FACTION=`${Rn[i]} - ${o}`}else n.DISPLAY_FACTION=n.DISPLAY_FACTION||r+(n.DETACHMENT?` - ${n.DETACHMENT}`:"")}else n.DETACHMENT?n.DISPLAY_FACTION=n.DISPLAY_FACTION||n.DETACHMENT:n.DISPLAY_FACTION=n.DISPLAY_FACTION||"";if(!n.FACTION_KEY){if(n.FACTION_KEYWORD)try{n.FACTION_KEY=n.FACTION_KEYWORD.toString().toLowerCase()}catch{n.FACTION_KEY=String(n.FACTION_KEYWORD).toLowerCase()}else if(n.DISPLAY_FACTION){const s=(n.DISPLAY_FACTION||"").split(" - ")[0];try{n.FACTION_KEY=s.toString().toLowerCase()}catch{n.FACTION_KEY=String(s).toLowerCase()}}}return t}function va(t,n,a,r,s="",i=!1,o="wargear"){if(!t)return;t.items=t.items||[];const l=ha(String(n||"").trim()),c=l.quantity?String(l.quantity):"1x",u=l.name||"",d=Q(u);if(i){const m=String(a||""),h=String(s||"");if(Q(m)===Q(u)||h&&Q(h)===Q(u))return}const f=t.items.find(m=>Q(m.name||"")===d);if(f){const m=parseInt(String(f.quantity||"1x").replace(/x/i,""),10)||0,h=parseInt(String(c||"1x").replace(/x/i,""),10)||0;f.quantity=`${m+h}x`}else{const m=Q(u)==="warlord"?"special":o;t.items.push({quantity:c,name:u,items:[],type:m,nameshort:""})}}function Pm(t,n){if(!t||!n)return;n.items=n.items||[];const a=t.trim(),r=a.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),o=Q(i);if((n.items||[]).some(f=>f&&f.type==="special"&&Q((f.name||"").replace(/^Enhancement:\s*/i,""))===o))return;const u=`E: ${i.split(/\s+/).map(f=>f[0]?f[0].toUpperCase():"").join("")}${s}`.trim(),d={quantity:"1x",name:`Enhancement: ${i}`,nameshort:u,items:[],type:"special"};n.items.push(d)}function $m(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=[];let r=0;const s=f=>/^(\d+)x?\s+/i.test(String(f||"").trim()),i=(f,m)=>{const h=String(f||"").trim();if(!h)return h;if(s(h)){const y=h.match(/^(\d+)x?\s+(.*)$/i);if(y){const v=parseInt(y[1],10)||1,b=y[2].trim();return`${Math.max(1,v*(parseInt(m,10)||1))}x ${b}`}return h}return`${m}x ${h}`};for(;r<t.length;r++){const m=(t[r]||"").trim();if(m){if(m.startsWith("+")||m.startsWith("&")){a.push(m);continue}break}}for(const f of a){if(f.startsWith("&")){const v=f.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);v&&(v[1].trim(),(v[3]||"").trim());continue}const h=f.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(h){const y=h[1].trim().toUpperCase(),v=h[2].trim();if(y==="FACTION KEYWORD"){const b=v.split(" - ");n.SUMMARY.FACTION_KEYWORD=b[b.length-1].trim()}else y==="DETACHMENT"?n.SUMMARY.DETACHMENT=v.replace(/\u00A0/g," "):y==="TOTAL ARMY POINTS"&&(n.SUMMARY.TOTAL_ARMY_POINTS=v)}}if(n.SUMMARY.LIST_TITLE="",n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD){const f=n.SUMMARY.FACTION_KEYWORD,m=Object.keys(Rn).find(y=>y.toLowerCase()===(f||"").toString().toLowerCase()),h=m?Rn[m]:null;h?n.SUMMARY.DISPLAY_FACTION=`${h} - ${f}`:n.SUMMARY.DISPLAY_FACTION=f+(n.SUMMARY.DETACHMENT?` - ${n.SUMMARY.DETACHMENT}`:"");try{n.SUMMARY.FACTION_KEY=f.toString().toLowerCase()}catch{}}let o=null,l=null;const c=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,u=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;for(;r<t.length;r++){const f=t[r]||"",m=f.trim();if(!m)continue;if(/^Enhancement:\s*/i.test(m)){const S=m.replace(/^Enhancement:\s*/i,"").trim();l&&Pm(S,l);continue}const h=m.match(c);if(h){const S=h[1],R=h[2]?`${h[2]}x`:"1x",M=(h[3]||"").trim(),_=parseInt(h[4],10)||0,A=h[5],k={quantity:R,name:M,points:_,items:[],isComplex:!1,nameshort:""};S?(n.CHARACTER.push(k),l=k):(n["OTHER DATASHEETS"]=n["OTHER DATASHEETS"]||[],n["OTHER DATASHEETS"].push(k)),o=k,A&&A.split(",").map($=>$.trim()).filter(Boolean).forEach($=>va(k,$,k.name,n.SUMMARY.FACTION_KEYWORD||"",k.name,!0));continue}const y=f.match(u);if(y){const S=y[1].trim(),R=S.match(/^(\d+)\s+with\s+(.*)$/i);if(R&&o){const A=parseInt(R[1],10)||1,k=R[2],$=o.items&&o.items.length>0?o.items[o.items.length-1]:o;k.split(",").map(w=>w.trim()).filter(Boolean).forEach(w=>{const I=i(w,A);va($,I,$.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const M=S.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(M&&o){const A=M[1],k=M[2].trim(),$=M[3]||"",w={quantity:A,name:k,items:[],type:"subunit"};if(o.items=o.items||[],o.items.push(w),$){const I=$.match(/^(\d+)\s+with\s+(.*)$/i);if(I){const O=parseInt(I[1],10)||1;I[2].split(",").map(V=>V.trim()).filter(Boolean).forEach(V=>{const Z=i(V,O);va(w,Z,w.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)})}else $.split(",").map(O=>O.trim()).filter(Boolean).forEach(O=>va(w,O,w.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0))}continue}const _=S.match(/^(\d+x?)\s+(.*)$/i);if(_&&o){const A={quantity:_[1],name:_[2].trim(),items:[],type:"subunit"};o.items=o.items||[],o.items.push(A);continue}if(o){va(o,S,o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0);continue}continue}const v=m.match(/^(\d+)\s+with\s+(.*)$/i);if(v&&o){const S=parseInt(v[1],10)||1,R=v[2],M=o.items&&o.items.length>0?o.items[o.items.length-1]:o;R.split(",").map(_=>_.trim()).filter(Boolean).forEach(_=>{const A=i(_,S);va(M,A,M.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const b=m.match(/^(.*?):\s*(.*)$/);if(b&&o){(b[2]||"").split(",").map(R=>R.trim()).filter(Boolean).forEach(R=>va(o,R,o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0));continue}}const d=[...n.CHARACTER||[],...n["OTHER DATASHEETS"]||[]];for(const f of d){f&&Array.isArray(f.items)&&f.items.length>0&&bn(f.items);const m=f&&Array.isArray(f.items)?f.items.filter(h=>h&&h.type==="subunit"):[];for(const h of m)h&&Array.isArray(h.items)&&h.items.length>0&&bn(h.items)}return Ia(n),n}function yn(t,n,a,r,s="",i=!1,o="wargear"){if(!t)return;t.items=t.items||[];const l=String(n||"").trim();if(/battlesuit support system|homing beacon|marker drone/i.test(l))try{Jt.push(`processing raw=${l} for target=${t&&t.name}`)}catch{}let c=l.split(",").map(_=>_.trim()).filter(Boolean);try{const _=new Set;c=c.filter(A=>{const k=Q(Va(Fn(A)));return _.has(k)?!1:(_.add(k),!0)})}catch{}try{/stealth shas'vre|stealth battlesuits/i.test((t&&t.name||"")+(s||"")+l)&&Jt.push(`splitParts target=${t&&t.name} top=${s} parts=${JSON.stringify(c)}`)}catch{}if(c.length>1){c.forEach(_=>yn(t,_,a,r,s,i,o));return}const u=ha(l),d=u.quantity!==void 0&&u.quantity!==null;let f=d?String(u.quantity):"1x",m=u.name||"";try{m=Va(Fn(m))}catch{}const h=/battlesuit support system|homing beacon|marker drone/i;try{const _=m.toLowerCase();if(_.includes("battlesuit support system")||_.includes("homing beacon")||_.includes("marker drone"))try{Jt.push(`addItemToTarget target=${t&&t.name} raw=${l}`)}catch{}}catch{}const y=m.match(/^(\d+)x\s+(.*)$/i);if(y){const _=parseInt(y[1],10)||1,A=parseInt(String(f||"1x").replace(/x/i,""),10)||1;f=`${Math.max(1,A*_)}x`,m=y[2]}try{Jt.push(`PARSE_QTY name=${m} parsedQtyRaw=${String(u.quantity||"")} qtyToken=${f}`)}catch{}let v=(_=>isNaN(_)?1:_)(parseInt(String(f||"1x").replace(/x/i,""),10)),b=v;try{if(t&&t.type==="subunit"){const _=parseInt(String(t.quantity||"1x").replace(/[^0-9]/g,""),10)||1;try{Jt.push(`CALC_EFFECTIVE target=${t&&t.name} parentQty=${_} parsedQty=${v} hasExplicit=${d}`)}catch{}b=d?v:_;try{Jt.push(`EFFECTIVE_QTY target=${t&&t.name} effectiveQty=${b}`)}catch{}}}catch{}const S=m,R=Q(m);if(i){const _=String(a||""),A=String(s||"");if(Q(_)===Q(m)||A&&Q(A)===Q(m)){if(h.test(m))try{Jt.push(`SKIP matched unitname name=${m} ctx=${_} top=${A}`)}catch{}return}}const M=t.items.find(_=>Q(_.name||"")===R);if(M){const _=parseInt(String(M.quantity||"1x").replace(/x/i,""),10)||0,A=_+b;M.quantity=`${A}x`;try{Jt.push(`UPDATED existing name=${m} existing=${_} added=${b} new=${A} target=${t&&t.name}`)}catch{}}else{const _=Q(m)==="warlord"?"special":o;t.items.push({quantity:`${b}x`,name:S,items:[],type:_,nameshort:""});try{Jt.push(`PUSHED new name=${m} quantity=${b} target=${t&&t.name}`)}catch{}}}function Fn(t){if(!t)return t;const n=t.toLowerCase();return n.includes("shield")&&n.includes("drone")?"Shield Drone":n.includes("marker")&&n.includes("drone")?"Marker Drone":n.includes("marker")&&n.includes("beacon")?"Homing Beacon":t}function Va(t){return t&&t.split(/\s+/).map(n=>!n||/[A-Z]/.test(n.slice(1))?n:n[0].toUpperCase()+n.slice(1).toLowerCase()).join(" ")}function wi(t,n){if(!n)return`${t}x`;const a=String(n).trim(),r=a.match(/^(\d+)x\s+(.*)$/i);if(r){const s=parseInt(r[1],10)||1,i=r[2]||"";return`${Math.max(1,t*s)}x ${i}`}return`${t}x ${a}`}function Om(t,n){if(!t||!n)return;n.items=n.items||[];const a=t.trim(),r=a.match(/\(([^)]+)\)$/),s=r?` (${r[1]})`:"",i=a.replace(/\s*\([^)]+\)$/,"").trim(),o=Q(i);if((n.items||[]).some(f=>{if(!f||!f.name)return!1;const m=String(f.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]+\)$/,"").trim();return Q(m)===o}))return;const u=`E: ${i.split(/\s+/).map(f=>f[0]?f[0].toUpperCase():"").join("")}${s}`.trim(),d={quantity:"1x",name:`Enhancement: ${i}`,nameshort:u,items:[],type:"special"};n.items.push(d)}function Wm(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=[];let r=0;for(;r<t.length;r++){const d=(t[r]||"").trim();if(d){if(d.startsWith("+")){a.push(d);continue}if(!d.startsWith("&"))break}}for(const u of a){const f=u.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(f){const m=f[1].trim().toUpperCase(),h=f[2].trim();if(m==="FACTION KEYWORD"){const y=h.split(" - ");n.SUMMARY.FACTION_KEYWORD=y[y.length-1].trim()}else m==="DETACHMENT"?n.SUMMARY.DETACHMENT=h.replace(/\u00A0/g," "):m==="TOTAL ARMY POINTS"&&(n.SUMMARY.TOTAL_ARMY_POINTS=h)}}if(n.SUMMARY.LIST_TITLE="",n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD){const u=n.SUMMARY.FACTION_KEYWORD,d=Object.keys(Rn).find(m=>m.toLowerCase()===(u||"").toString().toLowerCase()),f=d?Rn[d]:null;f?n.SUMMARY.DISPLAY_FACTION=`${f} - ${u}`:n.SUMMARY.DISPLAY_FACTION=u+(n.SUMMARY.DETACHMENT?` - ${n.SUMMARY.DETACHMENT}`:"");try{n.SUMMARY.FACTION_KEY=u.toString().toLowerCase()}catch{}}const s=/^(?:(Char\d+):\s*)?(?:(\d+)x?\s+)?(.*?)\s*\((\d+)\s*(?:pts|points)\)(?::\s*(.*))?$/i,i=/^\s*(?:\u2022|\*|-|\u25e6)\s*(.*)$/;let o=null,l=null;for(;r<t.length;r++){const u=t[r]||"",d=u.trim();if(!d)continue;if(/^Enhancement:\s*/i.test(d)){const v=d.replace(/^Enhancement:\s*/i,"").trim();l&&Om(v,l);continue}const f=d.match(s);if(f){const v=f[1],b=f[2]?`${f[2]}x`:"1x",S=(f[3]||"").trim(),R=parseInt(f[4],10)||0,M=f[5],_={quantity:b,name:S,points:R,items:[],isComplex:!1,nameshort:"",charId:v||null};v?(n.CHARACTER.push(_),l=_):(n["OTHER DATASHEETS"]=n["OTHER DATASHEETS"]||[],n["OTHER DATASHEETS"].push(_)),o=_,M&&M.split(",").map(A=>A.trim()).filter(Boolean).forEach(A=>yn(_,A,_.name,n.SUMMARY.FACTION_KEYWORD||"",_.name,!0));continue}const m=u.match(i);if(m){const v=m[1].trim(),b=v.match(/^(\d+)\s+with\s+(.*)$/i);if(b&&o){const M=parseInt(b[1],10)||1,_=b[2],A=o.items&&o.items.length>0?o.items[o.items.length-1]:o;try{Jt.push(`WITHMATCH unit=${o.name} target=${A&&A.name} n=${M} rest=${_}`)}catch{}_.split(",").map(k=>k.trim()).filter(Boolean).forEach(k=>{const w=Va(Fn(k));if(A&&A.type==="subunit"){try{Jt.push(`WITH->SUB target=${A.name} item=${w} n=${M}`)}catch{}yn(A,`${M}x ${w}`,A.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}else{try{Jt.push(`WITH->UNIT unit=${o.name} item=${w} n=${M}`)}catch{}yn(A,wi(M,w),A.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}});continue}const S=v.match(/^(\d+x?)\s+(.*?):\s*(.*)$/i);if(S&&o){const M=S[1],_=S[2].trim(),A=S[3]||"",k={quantity:M,name:_,items:[],type:"subunit",_parent:o};if(o.items=o.items||[],o.items.push(k),A){const $=A.match(/^(\d+)\s+with\s+(.*)$/i);$?$[2].split(",").map(I=>I.trim()).filter(Boolean).forEach(I=>{const O=Fn(I);yn(k,O,k.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)}):A.split(",").map(w=>w.trim()).filter(Boolean).forEach(w=>{const I=Fn(w);yn(k,I,k.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)})}continue}const R=v.match(/^(\d+x?)\s+(.*)$/i);if(R&&o)if(o.charId){const M=R[1],_=R[2].trim();yn(o,`${M} ${_}`,o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0);continue}else{const M={quantity:R[1],name:R[2].trim(),items:[],type:"subunit",_parent:o};o.items=o.items||[],o.items.push(M);continue}if(o){let M=v.split(",").map(A=>A.trim()).filter(Boolean);try{const A=o.items&&o.items.length>0?o.items[o.items.length-1]:null;A&&A.name&&(M=M.map(k=>{const $=k.match(/^(.*)\s*\(([^)]+)\)\s*$/);if($){const w=$[1].trim();if(Q(w)===Q(A.name))return w}return k}))}catch{}try{const A=new Set;M=M.filter(k=>{const $=Q(Va(Fn(k)));return A.has($)?!1:(A.add($),!0)})}catch{}let _=o;if(o.items&&o.items.length>0){const A=o.items[o.items.length-1];A&&A.type==="subunit"&&(_=A)}M.forEach(A=>{const k=Va(Fn(A));yn(_,k,_.name||o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}continue}const h=d.match(/^(\d+)\s+with\s+(.*)$/i);if(h&&o){const v=parseInt(h[1],10)||1,b=h[2],S=o.items&&o.items.length>0?o.items[o.items.length-1]:o;b.split(",").map(R=>R.trim()).filter(Boolean).forEach(R=>{const _=Va(Fn(R));S&&S.type==="subunit"?yn(S,`${v}x ${_}`,S.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0):yn(S,wi(v,_),S.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}const y=d.match(/^(.*?):\s*(.*)$/);if(y&&o){(y[2]||"").split(",").map(b=>b.trim()).filter(Boolean).forEach(b=>{const S=Fn(b);yn(o,S,o.name,n.SUMMARY.FACTION_KEYWORD||"",o.name,!0)});continue}}const c=[...n.CHARACTER||[],...n["OTHER DATASHEETS"]||[]];for(const u of c){u&&Array.isArray(u.items)&&u.items.length>0&&bn(u.items);const d=u&&Array.isArray(u.items)?u.items.filter(f=>f&&f.type==="subunit"):[];for(const f of d)f&&Array.isArray(f.items)&&f.items.length>0&&bn(f.items)}Ia(n);try{n.SUMMARY._parseDebug=(Jt||[]).slice(0,200)}catch{}return n}const Jt=[];function Xs(t){const n=ua(t);if(n>0)return n;const a=(t||"").trim();return a.startsWith("â¦")||a.startsWith("+")?2:0}function js(t){if(!t)return"";const n=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(t).split(/\s+/).map((a,r)=>{if(!a)return"";const s=a.toLowerCase();return r>0&&n.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function qa(t,n,a,r,s="",i=!1,o="wargear",l=1){if(!t)return;t.items=t.items||[];const c=ha(String(n||"").trim()),u=c.quantity?String(c.quantity):"1x",d=c.name||"",f=Q(d);if(i){const h=String(a||""),y=String(s||"");if(Q(h)===Q(d)||y&&Q(y)===Q(d))return}const m=t.items.find(h=>Q(h.name||"")===f);if(m){const h=parseInt(String(m.quantity||"1x").replace(/x/i,""),10)||0,y=parseInt(String(u||"1x").replace(/x/i,""),10)||0;m.quantity=`${h+y}x`}else{const h=Q(d)==="warlord"?"special":o;t.items.push({quantity:u,name:d,items:[],type:h,nameshort:""})}}function Ai(t,n,a){if(!t||!n)return;n.items=n.items||[];const r=t.trim(),s=r.match(/\(([^)]+)\)$/),i=s?` (${s[1]})`:"",o=r.replace(/\s*\([^)]+\)$/,"").trim(),l=Q(o);if((n.items||[]).some(m=>m&&m.type==="special"&&Q((m.name||"").replace(/^Enhancement:\s*/i,""))===l))return;const d=`E: ${o.split(/\s+/).map(m=>m[0]?m[0].toUpperCase():"").join("")}${i}`.trim(),f={quantity:"1x",name:`Enhancement: ${o}`,nameshort:d,items:[],type:"special"};n.items.push(f)}function Ym(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=t.findIndex(m=>a.test((m||"").trim().toUpperCase()));let i=(r===-1?t.slice(0,0):t.slice(0,r)).map(m=>(m||"").trim()).filter(m=>m&&!m.startsWith("Exported with"));const o=i.findIndex(m=>m&&m.trim()!=="");if(o!==-1){const m=i[o],h=m.match(/^(.*?)\s*\((\s*\d+\s*(?:pts|points)\s*)\)\s*$/i);if(h){n.SUMMARY.LIST_TITLE=h[1].trim();const k=(h[2].match(/(\d+)/)||[])[1]||"";k&&(n.SUMMARY.TOTAL_ARMY_POINTS=`${k}pts`)}else n.SUMMARY.LIST_TITLE=m;const y=[];for(let k=o+1;k<i.length;k++){const $=i[k];$&&y.push($)}const v=["Combat Patrol","Incursion","Strike Force","Onslaught"],b=k=>{if(!k||!/\(/.test(k))return!1;for(const $ of v)if(new RegExp($,"i").test(k))return!0;return!1},S=new Set(Object.values(Rn).map(k=>(k||"").toString().toLowerCase())),R=y.filter(k=>!(!k||b(k)||S.has(k.toLowerCase())));let M=null,_=null;const A=Object.keys(Rn).map(k=>k.toLowerCase());for(const k of R)A.includes((k||"").toString().toLowerCase())?M=k:_||(_=k);if(!M&&R.length>0&&(M=R[0],_=R.length>1?R[1]:_),M&&(n.SUMMARY.FACTION_KEYWORD=M),_&&(n.SUMMARY.DETACHMENT=_),M){const k=Object.keys(Rn).find(w=>w.toLowerCase()===M.toLowerCase()),$=k?Rn[k]:null;$?n.SUMMARY.DISPLAY_FACTION=`${$} - ${M}`:n.SUMMARY.DISPLAY_FACTION=M+(_?` - ${_}`:"");try{n.SUMMARY.FACTION_KEY=M.toString().toLowerCase()}catch{}}}const l=r===-1?0:r,c=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*$/i,u=/^\s*(?:â¢|\-|\+|â¦)\s*(.*)$/;let d=null;for(let m=l;m<t.length;m++){const y=(t[m]||"").trim();if(!y||y.startsWith("Exported with"))continue;if(a.test(y.toUpperCase())){d=/^CHARACTERS?/i.test(y)?"CHARACTER":"OTHER DATASHEETS";continue}const v=y.match(c);if(v){const b=v[1].trim(),S=parseInt(String(v[2]).replace(/[\,\.\s]/g,""),10)||0;let R="1x",M=b;const _=b.match(/^([0-9]+x?)\s+(.*)$/i);_&&(R=_[1].toLowerCase(),M=_[2].trim());const A={quantity:R,name:M,points:S,items:[],isComplex:!1,nameshort:""},k=d==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[k]=n[k]||[],n[k].push(A);const $=[];let w=m+1;for(;w<t.length;){const V=t[w]||"";if(!V.trim()||a.test(V.trim().toUpperCase())||c.test(V.trim())||!/^\s+/.test(V)&&!u.test(V))break;$.push(V),w++}const I=(()=>{for(let V=0;V<$.length;V++){const Z=$[V];if(!Z.match(u))continue;const z=Xs(Z);for(let J=V+1;J<$.length;J++){const ie=$[J];if(!ie.trim()||Xs(ie)<=z)break;if(u.test(ie))return!0}}return!1})();let O=null,he=0;for(let V=0;V<$.length;V++){const Z=$[V],ne=Z.trim(),z=Z.match(u),J=Xs(Z);if(z){const ie=z[1].trim(),le=ie.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(ie)){Ai(ie.replace(/^Enhancement:\s*/i,"").trim(),A,n.SUMMARY.FACTION_KEYWORD||"");continue}else if(le){Ai(ie.trim(),A,n.SUMMARY.FACTION_KEYWORD||"");continue}if(I){if(O&&typeof he=="number"&&J>he){qa(O,ie,O.name,n.SUMMARY.FACTION_KEYWORD||"",A.name,!1);continue}if(!(()=>{for(let F=V+1;F<$.length;F++){const H=$[F];if(!H.trim()||Xs(H)<=J)break;if(u.test(H))return!0}return!1})()){O=null,qa(A,ie,A.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}O=null;const te=ie.match(/^(\d+x?)\s+(.*)$/i),N=te?te[1]:"1x",q=te?te[2].trim():ie,j={quantity:N,name:q,items:[],type:"subunit"};A.items=A.items||[],A.items.push(j),O=j,he=J;continue}qa(A,ie,A.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(O&&J>he){qa(O,ne,O.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}qa(A,ne,A.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1)}m=w-1;continue}}function f(m,h){if(!(!m||typeof m!="object")){if(typeof m.name!="string"&&(m.name=""),typeof m.quantity!="string"&&(m.quantity=m.quantity?String(m.quantity):"1x"),typeof m.type!="string"&&(m.type=m.type||"wargear"),typeof m.nameshort!="string"&&(m.nameshort=m.nameshort||""),Array.isArray(m.items)||(m.items=[]),/^Enhancement:/i.test(m.name)){const y=m.name.replace(/^Enhancement:\s*/i,"").trim();m.type="special",m.nameshort=m.nameshort||(()=>{const v=y.match(/\(([^)]+)\)$/),b=v?` (${v[1]})`:"";return`E: ${y.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(M=>M[0]?M[0].toUpperCase():"").join("")}${b}`.trim()})(),m.name=`Enhancement: ${js(y.replace(/\s*\([^)]+\)$/,"").trim())}`}else m.name=h?m.name:js(m.name);Q(m.name)==="warlord"&&(m.type="special"),m.items=(m.items||[]).map(y=>{if(!y)return null;if(typeof y=="string"){const v={quantity:"1x",name:y.trim(),items:[],type:/^Enhancement:/i.test(y)?"special":"wargear",nameshort:""};return f(v,m.name),v.name&&(v.name=js(v.name)),v}return f(y,m.name),y&&y.name&&(y.name=js(y.name)),y}).filter(Boolean)}}for(const m of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[m]))for(const h of n[m]){f(h);const y=(h.items||[]).filter(v=>v&&v.type==="subunit");if(y.length>0)if(y.every(b=>Q(b.name||"")===Q(h.name||""))){const b=new Map;let S=0;for(const R of y){const M=parseInt(String(R.quantity||"1x").replace(/x/i,""),10)||1;S+=M;for(const _ of R.items||[]){const A={items:[]};qa(A,`${_.quantity||"1x"} ${_.name}`,h.name,n.SUMMARY.FACTION_KEYWORD||"",_.type||"wargear",1);for(const k of A.items){const $=Q(k.name||"");if(b.has($)){const w=b.get($),I=parseInt(String(w.quantity||"1x").replace(/x/i,""),10)||0,O=parseInt(String(k.quantity||"1x").replace(/x/i,""),10)||0;w.quantity=`${I+O}x`}else b.set($,k)}}}h.items=Array.from(b.values()),S>0&&(h.quantity=`${S}x`),h.isComplex=!1}else{const b=y.reduce((S,R)=>S+(parseInt(String(R.quantity||"1x").replace(/x/i,""),10)||0),0);b>0&&(h.quantity=`${b}x`),h.isComplex=!0}else h.isComplex=!1;Array.isArray(h.items)&&h.items.length>0&&bn(h.items)}return Ia(n),n}function Ci(t){if(!t)return"";const n=new Set(["of","and","the","in","to","with","for","on","a","an","by","from"]);return String(t).split(/\s+/).map((a,r)=>{if(!a)return"";const s=a.toLowerCase();return r>0&&n.has(s)?s:s[0].toUpperCase()+s.slice(1)}).join(" ")}function ia(t,n,a,r,s="",i=!1,o="wargear",l=1){if(!t)return;t.items=t.items||[];const c=ha(String(n||"").trim()),u=c.quantity?String(c.quantity):"1x",d=parseInt(String(u||"1x").replace(/[^0-9]/g,""),10)||1,f=`${d*(l||1)}x`;let m=c.name||"";if(!i)try{const v=m.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(v){const b=v[1].trim(),S=v[2].trim(),R=Q(b),M=Q(a||""),_=Q(s||"");R&&(R===M||R===_||M.startsWith(R+" ")||_.startsWith(R+" ")||R.startsWith(M+" ")||R.startsWith(_+" "))&&(m=S)}}catch{}const h=Q(m);if(i){const v=String(a||""),b=String(s||""),S=Q(m),R=Q(v),M=Q(b),_=R&&S.startsWith(R+" "),A=M&&S.startsWith(M+" ");if(R&&(S===R||_)||M&&(S===M||A)){const k=m.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(k){const $=k[1].trim(),w=k[2].trim(),I=Q($);if(I===R||I===M||I.startsWith(R+" ")||I.startsWith(M+" ")){if(t&&t._deferredParenthetical&&Q(t._deferredParenthetical)===Q(w)||t&&t._deferredParenthetical&&Q(t._deferredParenthetical)===Q(w)||(t.items||[]).some(he=>Q(he.name||"")===Q(w)))return;ia(t,w,a,r,s,!1,o,d);return}}return}}const y=t.items.find(v=>Q(v.name||"")===h);if(y){const v=parseInt(String(y.quantity||"1x").replace(/x/i,""),10)||0,b=parseInt(String(f||"1x").replace(/x/i,""),10)||0;y.quantity=`${v+b}x`}else{const v=Q(m)==="warlord"?"special":o;t.items.push({quantity:f,name:m,items:[],type:v,nameshort:""})}}function Ir(t,n,a){if(!t||!n)return;n.items=n.items||[];const r=t.trim(),s=r.match(/\(([^)]+)\)$/),i=s?` (${s[1]})`:"",o=r.replace(/\s*\([^)]+\)$/,"").trim(),l=Q(o);if((n.items||[]).some(m=>m&&m.type==="special"&&Q((m.name||"").replace(/^Enhancement:\s*/i,""))===l))return;const d=`E: ${o.split(/\s+/).map(m=>m[0]?m[0].toUpperCase():"").join("")}${i}`.trim(),f={quantity:"1x",name:`Enhancement: ${o}`,nameshort:d,items:[],type:"special"};n.items.push(f)}function Ei(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]},a=/^(CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i,r=/^(.*?)\s*\(([\d,\.\s]+)\s*(?:pts|points)\)\s*(?::\s*(.*))?$/i,s=/^\s*(?:â¢|\-|\+|â¦)\s*(.*)$/;let i=null;for(let l=0;l<t.length;l++){const u=(t[l]||"").trim();if(!u)continue;if(a.test(u.toUpperCase())){i=/^CHARACTERS?/i.test(u)?"CHARACTER":"OTHER DATASHEETS";continue}const d=u.match(r);if(d){const f=d[1].trim(),m=parseInt(String(d[2]).replace(/[\,\.\s]/g,""),10)||0;let h="1x",y=f;const v=f.match(/^([0-9]+x?)\s+(.*)$/i);v&&(h=v[1].toLowerCase(),y=v[2].trim());const b={quantity:h,name:y,points:m,items:[],isComplex:!1,nameshort:""},S=i==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[S]=n[S]||[],n[S].push(b);const R=d[3]||"";R&&R.split(",").map(w=>w.trim()).filter(Boolean).forEach(w=>ia(b,w,b.name,n.SUMMARY.FACTION_KEYWORD||"",b.name,!0));const M=[];let _=l+1;for(;_<t.length;){const w=t[_]||"";if(!w.trim()||a.test(w.trim().toUpperCase())||r.test(w.trim())||!/^\s+/.test(w)&&!s.test(w))break;M.push(w),_++}const A=(()=>{for(let w=0;w<M.length;w++){const I=M[w];if(!I.match(s))continue;const he=ua(I);for(let V=w+1;V<M.length;V++){const Z=M[V];if(!Z.trim()||ua(Z)<=he)break;if(s.test(Z))return!0}}return!1})();let k=null,$=0;for(let w=0;w<M.length;w++){const I=M[w],O=I.trim(),he=I.match(s),V=ua(I);if(he){const Z=he[1].trim(),ne=Z.match(/^(.*?)\s*\(\+?\s*\d+\s*(?:pts?|points)\)\s*$/i);if(/^Enhancement:/i.test(Z)){Ir(Z.replace(/^Enhancement:\s*/i,"").trim(),b,n.SUMMARY.FACTION_KEYWORD||"");continue}else if(ne){Ir(Z.trim(),b,n.SUMMARY.FACTION_KEYWORD||"");continue}if(A){if(k&&typeof $=="number"&&V>$){const be=Z.split(",").map(te=>te.trim()).filter(Boolean);for(let te of be){const N=te.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(N){const q=N[1].trim(),j=N[2].trim();if(Q(q)===Q(k.name)){const F=be.some(G=>Q(G)===Q(j)),H=(k.items||[]).some(G=>Q(G.name||"")===Q(j));if(F||H)continue;const $e=ha(te),Ue=parseInt(String($e.quantity||"1x").replace(/[^0-9]/g,""),10)||1;ia(k,j,k.name,n.SUMMARY.FACTION_KEYWORD||"",b.name,!1,"wargear",Ue);continue}}ia(k,te,k.name,n.SUMMARY.FACTION_KEYWORD||"",b.name,!0)}continue}k=null;const z=Z.match(/^(\d+x?)\s+(.*)$/i),J=z?z[1]:"1x";let ie=z?z[2].trim():Z;try{const be=ie.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(be){const te=be[1].trim(),N=be[2].trim(),q=Q(te),j=Q(b.name||""),F=Q(unitTopName||b.name||"");if(q&&(q===j||j.startsWith(q)||q.startsWith(j)||F.startsWith(q)||q.startsWith(F))){ie=te;const H={quantity:J,name:ie,items:[],type:"subunit"};H._deferredParenthetical=N,H._deferredParentheticalQty=parseInt(String(J||"1x").replace(/[^0-9]/g,""),10)||1,b.items=b.items||[],b.items.push(H),k=H,$=V;continue}}}catch{}const le={quantity:J,name:ie,items:[],type:"subunit"};b.items=b.items||[],b.items.push(le),k=le,$=V;continue}ia(b,Z,b.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1);continue}if(k&&V>$){ia(k,O,k.name,n.SUMMARY.FACTION_KEYWORD||"",b.name,!0);continue}ia(b,O,b.name,n.SUMMARY.FACTION_KEYWORD||"","wargear",1)}l=_-1;continue}}function o(l,c){if(!(!l||typeof l!="object")){if(typeof l.name!="string"&&(l.name=""),typeof l.quantity!="string"&&(l.quantity=l.quantity?String(l.quantity):"1x"),typeof l.type!="string"&&(l.type=l.type||"wargear"),typeof l.nameshort!="string"&&(l.nameshort=l.nameshort||""),Array.isArray(l.items)||(l.items=[]),/^Enhancement:/i.test(l.name)){const u=l.name.replace(/^Enhancement:\s*/i,"").trim();l.type="special",l.nameshort=l.nameshort||(()=>{const d=u.match(/\(([^)]+)\)$/),f=d?` (${d[1]})`:"";return`E: ${u.replace(/\s*\([^)]+\)$/,"").trim().split(/\s+/).map(y=>y[0]?y[0].toUpperCase():"").join("")}${f}`.trim()})(),l.name=`Enhancement: ${Ci(u.replace(/\s*\([^)]+\)$/,"").trim())}`}else l.name=c?l.name:Ci(l.name);Q(l.name)==="warlord"&&(l.type="special"),l.items=(l.items||[]).map(u=>{if(!u)return null;if(typeof u=="string"){const d={quantity:"1x",name:u.trim(),items:[],type:/^Enhancement:/i.test(u)?"special":"wargear",nameshort:""};return o(d,l.name),d}return o(u,l.name),u}).filter(Boolean)}}for(const l of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[l]))for(const c of n[l]){o(c);const u=(c.items||[]).filter(f=>f&&f.type==="subunit");if(u.length>0)if(u.every(m=>Q(m.name||"")===Q(c.name||""))){const m=new Map;let h=0;for(const y of u){const v=parseInt(String(y.quantity||"1x").replace(/x/i,""),10)||1;h+=v;for(const b of y.items||[]){const S={items:[]};ia(S,`${b.quantity||"1x"} ${b.name}`,c.name,n.SUMMARY.FACTION_KEYWORD||"",b.type||"wargear",1);for(const R of S.items){const M=Q(R.name||"");if(m.has(M)){const _=m.get(M),A=parseInt(String(_.quantity||"1x").replace(/x/i,""),10)||0,k=parseInt(String(R.quantity||"1x").replace(/x/i,""),10)||0;_.quantity=`${A+k}x`}else m.set(M,R)}}}c.items=Array.from(m.values()),h>0&&(c.quantity=`${h}x`),c.isComplex=!1}else{const m=u.reduce((h,y)=>h+(parseInt(String(y.quantity||"1x").replace(/x/i,""),10)||0),0);m>0&&(c.quantity=`${m}x`),c.isComplex=!1}else c.isComplex=!1;if(Array.isArray(c.items)&&c.items.length===1&&c.items[0]&&c.items[0].type==="subunit"){const f=c.items[0];Array.isArray(f.items)&&f.items.length>0&&(c.items=f.items.slice(),c.isComplex=!1)}Array.isArray(c.items)&&c.items.length>0&&bn(c.items);const d=(c.items||[]).filter(f=>f&&f.type==="subunit");for(const f of d)Array.isArray(f.items)&&f.items.length>0&&bn(f.items)}return Ia(n),n}function Hm(t){if(!Array.isArray(t))return Ei(t);const n=[];let a=0;for(;a<t.length;a++){const f=String(t[a]||"").trim();if(!f){n.push(f);continue}if(f.startsWith("+")||f.startsWith("&")){n.push(f);continue}break}const r=[],s={};for(const d of n){if(!d)continue;if(d.startsWith("&")){const y=d.replace(/^&\s*/,"").match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);y&&r.push({enh:y[1].trim(),target:(y[3]||"").trim(),charId:y[2]||null});continue}const m=d.replace(/^\+\s*/,"").match(/^([^:]+):\s*(.*)$/);if(m){const h=m[1].trim().toUpperCase(),y=m[2].trim();if(h==="ENHANCEMENT"){const v=y.match(/^(.*?)\s*\(on\s+(?:(Char\d+):\s*)?(.*)\)$/i);v?r.push({enh:v[1].trim(),target:(v[3]||"").trim(),charId:v[2]||null}):r.push({enh:y,target:null,charId:null})}else if(h==="FACTION KEYWORD"){const v=y.split(" - ");s.faction=v[v.length-1].trim()}else h==="DETACHMENT"?s.detachment=y.replace(/\u00A0/g," "):h==="TOTAL ARMY POINTS"&&(s.points=y)}}const i=t.slice(a),o=[];for(const d of i){if(!d){o.push(d);continue}let f=String(d);f=f.replace(/^\s*Char\d+:\s*/i,"");const m=f.match(/^(.*\))\s*:\s*(.+)$/);m?(o.push(m[1]),o.push("  â¢ "+m[2])):o.push(f)}const l=Ei(o);l.SUMMARY=l.SUMMARY||{},s.faction&&(l.SUMMARY.FACTION_KEYWORD=s.faction),s.detachment&&(l.SUMMARY.DETACHMENT=s.detachment),s.points&&(l.SUMMARY.TOTAL_ARMY_POINTS=s.points);const c=[...l.CHARACTER||[],...l["OTHER DATASHEETS"]||[]],u=d=>{const f=Q(String(d||""));for(const m of c){const h=m&&Array.isArray(m.items)?m.items:[];for(const y of h){if(!y||!y.name)continue;const v=String(y.name||"").replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,"").trim();if(Q(v)===f)return!0}}return!1};for(const d of r){if(!d||!d.enh||u(d.enh))continue;let f=null;const m=h=>String(h||"").toLowerCase().replace(/[^a-z0-9 ]/g,"").trim();if(d.charId){const h=parseInt(String(d.charId).replace(/[^0-9]/g,""),10);!Number.isNaN(h)&&h>0&&Array.isArray(l.CHARACTER)&&l.CHARACTER[h-1]&&(f=l.CHARACTER[h-1])}!f&&d.target&&(f=c.find(h=>m(h.name).includes(m(d.target))||m(`${h.quantity} ${h.name}`).includes(m(d.target)))),!f&&c.length===1&&(f=c[0]),f&&Ir(d.enh,f,l.SUMMARY.FACTION_KEYWORD||"")}try{for(const d of["CHARACTER","OTHER DATASHEETS"]){const f=l[d];if(Array.isArray(f))for(const m of f)m&&typeof m=="object"&&Object.prototype.hasOwnProperty.call(m,"type")&&delete m.type}for(const d of["CHARACTER","OTHER DATASHEETS"]){const f=l[d];if(Array.isArray(f)){for(const m of f)if(!(!m||!Array.isArray(m.items))){for(const h of m.items.filter(y=>y&&y.type==="subunit"))if(h&&h._deferredParenthetical)try{delete h._deferredParenthetical,delete h._deferredParentheticalQty}catch{}}}}}catch{}return Ia(l),l}function Fm(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=t.map(u=>String(u||"")).find(u=>u.trim()),r=t.findIndex(u=>String(u||"").trim());if(a){const u=a.split(/\s*-\s*/).map(d=>d.trim()).filter(Boolean);if(n.SUMMARY.FACTION_FAMILY=u[0]||"",n.SUMMARY.FACTION_KEYWORD=u[1]||"",u.length>=3){const f=u[u.length-1].match(/\[\s*(\d{2,5})\s*pts?\s*\]$/i);f?(n.SUMMARY.TOTAL_ARMY_POINTS=`${f[1]}pts`,u.length===3?n.SUMMARY.LIST_TITLE=u[2]:n.SUMMARY.LIST_TITLE=u.slice(2,u.length-1).join(" - ")):n.SUMMARY.LIST_TITLE=u.slice(2).join(" - ")}n.SUMMARY.DISPLAY_FACTION=a.trim()}for(let u=0;u<Math.min(t.length,40);u++){const d=String(t[u]||"").trim();if(!d)continue;const f=d.match(/^Detachment:\s*(.*)$/i);f&&(n.SUMMARY.DETACHMENT=f[1].trim());const m=d.match(/^TOTAL ARMY POINTS:\s*(.*)$/i);m&&(n.SUMMARY.TOTAL_ARMY_POINTS=m[1].trim());const h=d.match(/^FACTION KEYWORD:\s*(.*)$/i);h&&(n.SUMMARY.FACTION_KEYWORD=h[1].trim());const y=d.match(/^Battle Size:\s*(.*)$/i);y&&(n.SUMMARY.BATTLE_SIZE=y[1].trim());const v=d.match(/^#+\s*(?:\+{1,2}\s*)?(.*)\[\s*\d{2,5}\s*pts?\s*\]$/i);if(v&&!n.SUMMARY.LIST_TITLE){const b=v[1].trim();/Army\s+Roster/i.test(b)||/\+\+/.test(b)?n.SUMMARY.LIST_TITLE="":n.SUMMARY.LIST_TITLE=b}}if(!n.SUMMARY.FACTION_KEYWORD&&n.SUMMARY.DISPLAY_FACTION){const u=n.SUMMARY.DISPLAY_FACTION.split(" - ");u.length>=2?n.SUMMARY.FACTION_KEYWORD=u[1].trim():n.SUMMARY.FACTION_KEYWORD=n.SUMMARY.DISPLAY_FACTION.replace(/\s*\[.*$/,"").trim()}const s=/^(?:(\d+)x?\s+)?(.+?)\s*\[\s*(\d{1,4})\s*pts?\s*\]\s*(?::\s*(.*))?$/i,i=/^\s*(?:â¢|\-|\+)\s*(.*)$/;let o=null,l=null;for(let u=0;u<t.length;u++){const d=String(t[u]||""),f=d.trim();if(!f||u===r)continue;if(f.startsWith("#")){const y=f.match(/^#+\s*(.+?)\s*(?:\[\s*\d+\s*pts?\s*\])?$/i);if(y){const v=y[1].trim();/character|epic|hero|hq/i.test(v)?o="CHARACTER":o="OTHER DATASHEETS"}continue}const m=f.match(s);if(m){const y=m[1]?`${m[1]}x`:"1x",v=(m[2]||"").trim(),b=parseInt(m[3],10)||0,S=m[4]||"",R={quantity:y,name:v,points:b,items:[],isComplex:!1,nameshort:""};o||(o="OTHER DATASHEETS"),n[o]=n[o]||[],n[o].push(R),l=R,S&&S.split(",").map(M=>M.trim()).filter(Boolean).forEach(M=>{c(l,M,l.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0)});continue}const h=d.match(i);if(h&&l){const y=h[1].trim(),v=y.match(/^(\d+)\s+with\s+(.*)$/i);if(v&&l){const R=parseInt(v[1],10)||1,M=v[2],_=l.items&&l.items.length>0?l.items[l.items.length-1]:l;M.split(",").map(A=>A.trim()).filter(Boolean).forEach(A=>c(_,`${R}x ${A}`,_.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0));continue}const b=y.match(/^(\d+x?)\s+([^:]+):\s*(.*)$/i);if(b){const R=b[1];let M=b[2].trim();const _=b[3]||"";M=M.replace(/\s+w\/.*$/i,"").trim();const A={quantity:R,name:M,items:[],type:"subunit"};if(_){const k=_.match(/^(\d+)\s+with\s+(.*)$/i);if(k){const $=parseInt(k[1],10)||1;k[2].split(",").map(I=>I.trim()).filter(Boolean).forEach(I=>c(A,`${$}x ${I}`,A.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0))}else _.split(",").map($=>$.trim()).filter(Boolean).forEach($=>c(A,$,A.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0))}l.items=l.items||[],l.items.push(A);continue}const S=y.match(/^(\d+x?)\s+(.*)$/i);if(S&&l){let R=S[2].trim();R=R.replace(/\s+w\/.*$/i,"").trim();const M={quantity:S[1],name:R,items:[],type:"subunit"};l.items=l.items||[],l.items.push(M);continue}c(l,y,l.name,n.SUMMARY.FACTION_KEYWORD||"",l.name,!0);continue}}function c(u,d,f,m,h="",y=!1,v="wargear"){if(!u)return;u.items=u.items||[];const b=String(d||"").trim(),S=ha(b),R=S.quantity?String(S.quantity):"1x",M=/^\s*\d+x?\s+/i.test(b);let _=S.name||"";const A=_.match(/^(.*?)\s*\(([^)]+)\)$/);if(A){const O=(A[1]||"").trim(),he=(A[2]||"").trim();(/\bDrone\b/i.test(O)||/\bDrone\b/i.test(_))&&(_=he)}const k=Q(_);if(y){const O=String(f||""),he=String(h||"");if(Q(O)===Q(_)||he&&Q(he)===Q(_))return}const $=parseInt(String(R||"1x").replace(/x/i,""),10)||1;let w=$;if(u&&u.type==="subunit"){const O=parseInt(String(u.quantity||"1x").replace(/[^0-9]/g,""),10)||1;w=M?$:O}const I=u.items.find(O=>Q(O.name||"")===k);if(I){const O=parseInt(String(I.quantity||"1x").replace(/x/i,""),10)||0;I.quantity=`${O+w}x`}else{const O=Q(_)==="warlord"?"special":v;u.items.push({quantity:`${w}x`,name:_,items:[],type:O,nameshort:""})}}for(const u of["CHARACTER","OTHER DATASHEETS"])if(Array.isArray(n[u]))for(const d of n[u]){if(!d||!Array.isArray(d.items)||d.items.length===0)continue;if(d.items.filter(h=>h&&h.type==="subunit").length>1){const h=new Map,y=[];for(const v of d.items){if(!v||v.type!=="subunit"){y.push(v);continue}const b=Q(v.name||"");if(!h.has(b))h.set(b,{quantity:v.quantity||"1x",name:v.name,items:Array.isArray(v.items)?v.items.slice():[],type:"subunit"});else{const S=h.get(b),R=parseInt(String(S.quantity||"1x").replace(/[^0-9]/g,""),10)||0,M=parseInt(String(v.quantity||"1x").replace(/[^0-9]/g,""),10)||0;S.quantity=`${R+M}x`;const _=new Map;for(const A of S.items||[]){const k=Q(A&&A.name||"");k&&_.set(k,{quantity:A.quantity||"1x",name:A.name,items:[],type:A.type||"wargear",nameshort:A.nameshort||""})}for(const A of v.items||[]){const k=Q(A&&A.name||"");if(k)if(_.has(k)){const $=_.get(k),w=parseInt(String($.quantity||"1x").replace(/[^0-9]/g,""),10)||0,I=parseInt(String(A.quantity||"1x").replace(/[^0-9]/g,""),10)||0;$.quantity=`${w+I}x`}else _.set(k,{quantity:A.quantity||"1x",name:A.name,items:[],type:A.type||"wargear",nameshort:A.nameshort||""})}S.items=Array.from(_.values())}}d.items=[...y,...Array.from(h.values())]}d&&Array.isArray(d.items)&&d.items.length>0&&bn(d.items);const m=d&&Array.isArray(d.items)?d.items.filter(h=>h&&h.type==="subunit"):[];for(const h of m)h&&Array.isArray(h.items)&&h.items.length>0&&bn(h.items)}return Ia(n),n}function Bm(t,n=40){return(Array.isArray(t)?t:String(t||"").split(/\r?\n/)).slice(0,n)}function qm(t){const n=Array.isArray(t)?t:String(t||"").split(/\r?\n/),a=Bm(n,40),r=n.join(`
`),s={NRNR:{score:0,breakdown:{},maxScore:8},"WTC-Compact":{score:0,breakdown:{},maxScore:8},WTC:{score:0,breakdown:{},maxScore:8},GWAPP:{score:0,breakdown:{},maxScore:7},"NR-GW":{score:0,breakdown:{},maxScore:7},LF:{score:0,breakdown:{},maxScore:7}},i=a.some(z=>/-\s*\[\s*\d{2,5}\s*pts?\s*\]$/i.test(z)),o=a.some(z=>/^#{1,3}\s+/.test(z)),l=a.some(z=>/^\s*#?\s*\+\+\s*Army Roster\s*\+\+/i.test(z)),c=a.some(z=>/^\s*##\s+/.test(z)),u=/(.+?)\s*[\(\[]\s*([0-9]{1,4})\s*(?:pts|points)\s*[\)\]]/i,d=r.match(new RegExp(u.source,"g"))||[],f=r.match(/^[ \t]*(?:â¢|\-|\+)\s*(?:\d+x?)\s+[^:]+:/gmi)||[],m=r.match(/\b[A-Za-z0-9\-\'â ]+\s*\([^\)]+\)/g)||[],h=/(^|\n)\s*Char\d+:.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)\s*:\s*/i,y=(r.match(new RegExp(h.source,"gi"))||[]).length,v=a.some(z=>/^(List Name|Factions Used|Army Points|Detachment Rule):/i.test(z.trim())),b=a.some(z=>/-\s*\(\s*\d+\s*Points?\s*\)\s*$/i.test(z)),S=r.match(/^(Epic Hero|Epic Heroes|Character|Characters|Battleline|Infantry|Beast|Vehicle|Dedicated Transport|Other Datasheets):\s*$/gmi)||[],R=(r.match(/^\s*â¢\s*(?:E:|Enhancement:)/gmi)||[]).length,M=(r.match(/^\s*â¢\s+/gmi)||[]).length;v&&(s.LF.score+=4,s.LF.breakdown.headerKeys=4),b&&(s.LF.score+=4,s.LF.breakdown.titleLine=4),S.length>=2&&(s.LF.score+=3,s.LF.breakdown.sectionColons=S.length),M>5&&(s.LF.score+=1,s.LF.breakdown.bullets=M),R>0&&(s.LF.score+=1,s.LF.breakdown.enhancementLines=R),(v||b||S.length>=2)&&(s.NRNR.score-=1,s.WTC.score-=1,s["WTC-Compact"].score-=1,s.GWAPP.score-=1,s["NR-GW"].score-=3),i&&(s.NRNR.score+=2,s.NRNR.breakdown.titleWithBracketedPts=2),o&&(s.NRNR.score+=3,s.NRNR.breakdown.markdownHeading=3),l&&(s.NRNR.score+=2,s.NRNR.breakdown.armyRoster=2),c&&(s.NRNR.score+=1,s.NRNR.breakdown.doubleHashSections=1),d.length>=3&&(s.NRNR.score+=1,s.NRNR.breakdown.unitLines=1),f.length>0&&(s.NRNR.score+=1,s.NRNR.breakdown.bulletWithQty=f.length),m.length>0&&(s.NRNR.score+=.5,s.NRNR.breakdown.parenItem=m.length);const _=a.join(`
`);/^[ \t]*[+&]/m.test(_)&&(s["WTC-Compact"].score+=3,s["WTC-Compact"].breakdown.headerPlusAmp=3),/(FACTION KEYWORD|DETACHMENT|TOTAL ARMY POINTS)/i.test(_)&&(s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.headerKeys=2),d.length>=2&&(s["WTC-Compact"].score+=1,s["WTC-Compact"].breakdown.unitLines=1),y>0&&(s["WTC-Compact"].score+=5,s["WTC-Compact"].breakdown.inlineCharList=y),/^\s*[+&]/m.test(_)&&(s.WTC.score+=1,s.WTC.breakdown.headerPlusAmp=1),/NUMBER OF UNITS:/i.test(_)&&(s.WTC.score+=2,s.WTC.breakdown.numberOfUnits=2);const A=(r.match(/(^|\n)\s*Char\d+:/gi)||[]).length>0;A&&(s.WTC.score+=3,s.WTC.breakdown.charMarkers=3),(o||l||c)&&(s.WTC.score-=2,s.WTC.breakdown.nrnrPenalty=-2,s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.nrnrPenalty=-1);const k=(r.match(/^\s*\d+\s+with\s+/gmi)||[]).length;k>0&&(s.WTC.score+=2,s.WTC.breakdown.withLines=k,s["WTC-Compact"].score+=2,s["WTC-Compact"].breakdown.withLines=k),a.some(z=>/^(?:CHARACTER|OTHER DATASHEETS|CHARACTERS)\s*$/.test((z||"").trim()))&&(s.WTC.score+=1,s.WTC.breakdown.sectionHeaders=1),A&&(s["WTC-Compact"].score-=1,s["WTC-Compact"].breakdown.charMarkerPenalty=-1),y>0&&(s.WTC.score-=2,s.WTC.breakdown.compactInlinePenalty=-2);const $=/Exported with/i.test(r);(/Exported with/i.test(_)||$)&&(s.GWAPP.score+=6,s.GWAPP.breakdown.exportedWith=6),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS)\b/i.test(r)&&(s.GWAPP.score+=2,s.GWAPP.breakdown.sectionHeaders=2),/\(\s*\d+\s*(?:pts|points)\s*\)/i.test(_)&&(s.GWAPP.score+=1,s.GWAPP.breakdown.titleParenPts=1),$&&(s["NR-GW"].score-=4,s["NR-GW"].breakdown.gwappPenalty=-4),/^\s*Strike Force\s*\(\s*\d{2,5}\s*points\s*\)/mi.test(r)&&(s.GWAPP.score+=3,s.GWAPP.breakdown.strikeForce=3),/\b(CHARACTERS|BATTLELINE|OTHER DATASHEETS|DEDICATED TRANSPORTS)\b/i.test(r)&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.sectionHeaders=2);const w=(r.match(/^[ \t]*(?:â¢|\u2022|â¦|\-|\+)\s+/gmi)||[]).length;w>0&&!$&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.bulletCount=w),m.length>0&&!$&&(s["NR-GW"].score+=1,s["NR-GW"].breakdown.parenItem=m.length);const I=(r.match(/^[ \t]*(?:â¢|\u2022|â¦|\-|\+)\s*\d+x?\s+[A-Za-z0-9\-\'â]+/gmi)||[]).length;I>=3&&!A&&!$&&(s["NR-GW"].score+=3,s["NR-GW"].breakdown.bulletQty=I);const O=/^(?:\s*)\d+x?\s+.*\(\s*\d{1,4}\s*(?:pts|points)\s*\)/i,he=n.filter(z=>O.test(z)).length;if(he>=2&&!A&&!$&&(s["NR-GW"].score+=2,s["NR-GW"].breakdown.unitLinesNoChar=he),!A&&!$&&(I>=3||he>=2)&&(s.WTC.score-=2,s.WTC.breakdown.nrGwPenalty=-2,s["WTC-Compact"].score-=2,s["WTC-Compact"].breakdown.nrGwPenalty=-2),(o||l)&&(s["NR-GW"].score-=1,s["NR-GW"].breakdown.nrnrPenalty2=-1),r.indexOf("â")!==-1)for(const z of Object.keys(s))s[z].score+=.5,s[z].breakdown=s[z].breakdown||{},s[z].breakdown.unicodeApostrophe=.5;const V={};for(const z of Object.keys(s)){const J=s[z],ie=Math.max(0,Math.min(1,J.score/(J.maxScore||8)));V[z]={score:J.score,confidence:ie,scoreBreakdown:J.breakdown}}const Z=Object.keys(V).sort((z,J)=>V[J].score-V[z].score)[0],ne=V[Z]||{score:0,confidence:0};return{format:Z,confidence:ne.confidence,score:ne.score,scoreBreakdown:ne.scoreBreakdown,all:V}}function Bo(t){const n=String(t||"").trim().match(/^(\d+)\s+(.*)$/);return n&&!/^\d+x\b/i.test(String(t||""))?`${n[1]}x ${n[2]}`:t}function qo(t){const n=String(t||"").trim().replace(/^E:\s*/i,"").replace(/^Enhancement:\s*/i,"").trim(),a=n.match(/\(([^)]*pts?[^)]*)\)\s*$/i),r=n.replace(/\s*\([^)]*\)\s*$/,"").trim(),i=`E: ${r.split(/\s+/).map(o=>o[0]?o[0].toUpperCase():"").join("")}${a?` (${a[1].trim()})`:""}`.trim();return{quantity:"1x",name:`Enhancement: ${r}`,nameshort:i,items:[],type:"special"}}function Um(t,n){if(!t)return;t.items=t.items||[];const a=Bo(String(n||"").trim());if(/^(E:|Enhancement:)/i.test(a)){const s=qo(a),i=Q(s.name.replace(/^Enhancement:\s*/i,""));(t.items||[]).some(l=>/^Enhancement:/i.test(l.name||"")&&Q(String(l.name).replace(/^Enhancement:\s*/i,"").replace(/\s*\([^)]*\)\s*$/,""))===i)||t.items.push(s);return}const r=a.split(",").map(s=>s.trim()).filter(Boolean);for(const s of r){const i=ha(s.replace(/^with\s+/i,"")),o=i.quantity||"1x",l=i.name||"";if(!l)continue;const c=Q(l),u=t.items.find(d=>Q(d.name||"")===c);if(u){const d=parseInt(String(u.quantity||"1x").replace(/[^0-9]/g,""),10)||0,f=parseInt(String(o).replace(/[^0-9]/g,""),10)||0;u.quantity=`${d+f}x`}else t.items.push({quantity:o,name:l,items:[],type:"wargear",nameshort:""})}}function Km(t,n){const a=t[n]||"",r=ua(a);for(let s=n+1;s<t.length;s++){const i=t[s]||"";if(!i.trim())continue;const o=ua(i),l=/^\s*â¢\s*/.test(i);return o>r&&l}return!1}function Gm(t){const n={SUMMARY:{},CHARACTER:[],"OTHER DATASHEETS":[]};if(!Array.isArray(t))return n;const a=t.slice(0,30).map(m=>String(m||""));let r=!1;for(const m of a){const h=m.match(/^\s*([A-Za-z ][A-Za-z ]*):\s*(.*)$/);if(!h)continue;const y=h[1].trim().toLowerCase(),v=h[2].trim();if(y==="list name"&&(n.SUMMARY.LIST_TITLE=v,r=!0),y==="factions used"&&(n.SUMMARY.FACTION_KEYWORD=v,r=!0),y==="army points"){const b=parseInt(v.replace(/[^0-9]/g,""),10);b&&(n.SUMMARY.TOTAL_ARMY_POINTS=`${b}pts`,r=!0)}y==="detachment rule"&&(n.SUMMARY.DETACHMENT=v,r=!0)}if(!r){const m=t.find(h=>String(h||"").trim());if(m){const h=String(m).match(/^(.*?)\s*-\s*(.*?)\s*-\s*(.*?)\s*\((\d+)\s*Points?\)/i);h&&(n.SUMMARY.LIST_TITLE=h[1].trim(),n.SUMMARY.FACTION_KEYWORD=h[2].trim(),n.SUMMARY.DETACHMENT=h[3].trim(),n.SUMMARY.TOTAL_ARMY_POINTS=`${parseInt(h[4],10)}pts`)}}const s=/^\s*([A-Za-z ]+):\s*$/,i=/^\s*(.*?)\s*\((\d+)\s*pts?\)\s*$/i,o=/^\s*â¢\s*(.*)$/;let l=null;const c=[];for(let m=0;m<t.length;m++){const h=String(t[m]||"");if(!h.trim())continue;const v=h.match(s);if(v){const k=v[1].trim().toLowerCase();l=/hero|character/.test(k)?"CHARACTER":"OTHER DATASHEETS",c.length=0;continue}const b=h.match(i);if(b&&ua(h)===0){const k=b[1].trim(),$=parseInt(b[2],10)||0,w={quantity:"1x",name:k,points:$,items:[],isComplex:!1,nameshort:""},I=l==="CHARACTER"?"CHARACTER":"OTHER DATASHEETS";n[I]=n[I]||[],n[I].push(w),c.length=0,c.push({indent:0,node:w});continue}const S=h.match(o);if(!S)continue;const R=S[1].trim(),M=ua(h);for(;c.length>0&&M<=c[c.length-1].indent;)c.pop();const _=c.length>0?c[c.length-1].node:null;if(!_||/^B:\s*/i.test(R))continue;if(/^(E:|Enhancement:)/i.test(R)){const k=qo(R),$=c[0]?c[0].node:_;$.items=$.items||[],($.items||[]).some(I=>/^Enhancement:/i.test(I.name||"")&&Q(I.name)===Q(k.name))||$.items.push(k);continue}if(Km(t,m)){const k=ha(Bo(R));let $=k.name||"";$=$.replace(/\s+w\/.*$/i,"").trim();const w={quantity:k.quantity||"1x",name:$,items:[],type:"subunit"};_.items=_.items||[],_.items.push(w),c.push({indent:M,node:w});continue}Um(_,R)}function u(m){const h=parseInt(String(m||"1x").replace(/[^0-9]/g,""),10);return Number.isFinite(h)&&h>0?h:1}for(const m of["CHARACTER","OTHER DATASHEETS"]){const h=n[m]||[];for(const y of h){const v=Array.isArray(y.items)?y.items:[],b=v.filter(_=>_&&_.type==="subunit");if(b.length<=1)continue;const S=new Map;for(const _ of b){const A=Q((_.name||"").replace(/\s+w\/.*/i,"").trim());S.has(A)||S.set(A,{name:_.name,qty:0,wargear:new Map});const k=S.get(A);k.qty+=u(_.quantity);const $=Array.isArray(_.items)?_.items:[];for(const w of $){const I=Q(w.name||""),O=k.wargear.get(I)||{name:w.name,qty:0,type:w.type||"wargear"};O.qty+=u(w.quantity),k.wargear.has(I),k.wargear.set(I,O)}}const R=v.filter(_=>!(_&&_.type==="subunit")),M=[];for(const[,_]of S){const A={quantity:`${_.qty}x`,name:_.name,items:[],type:"subunit"};for(const[,k]of _.wargear)A.items.push({quantity:`${k.qty}x`,name:k.name,items:[],type:k.type||"wargear",nameshort:""});M.push(A)}y.items=[...R,...M]}}const d=n.SUMMARY&&n.SUMMARY.FACTION_KEYWORD?String(n.SUMMARY.FACTION_KEYWORD).trim():"";function f(m){if(!m||!d)return m;const h=new RegExp("^"+d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\s+","i");return String(m).replace(h,"").trim()}if(d)for(const m of["CHARACTER","OTHER DATASHEETS"]){const h=n[m]||[];for(const y of h){y.name=f(y.name);const v=(y.items||[]).filter(b=>b&&b.type==="subunit");for(const b of v)b.name=f(b.name)}}for(const m of["CHARACTER","OTHER DATASHEETS"]){const h=n[m]||[];for(const y of h){Array.isArray(y.items)&&y.items.length>0&&bn(y.items);const v=(y.items||[]).filter(b=>b&&b.type==="subunit");for(const b of v)Array.isArray(b.items)&&b.items.length>0&&bn(b.items)}}return Ia(n),n}function zm(t){try{const n=qm(t).format;return n==="NRNR"?"NRNR":n==="WTC-Compact"?"WTC_COMPACT":n==="WTC"?"WTC":n==="GWAPP"?"GW_APP":n==="NR-GW"?"NR_GW":n==="LF"?"LF":"UNKNOWN"}catch{const a=Array.isArray(t)?t.slice(0,25):[],r=a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i)||/^\s*\+\s*DETACHMENT:/i.test(i)),s=a.some(i=>/^(?:CHARACTERS|CHARACTER|BATTLELINE|OTHER DATASHEETS|ALLIED UNITS|DEDICATED TRANSPORTS)$/i.test((i||"").trim().toUpperCase()));return r&&s?"NR_GW":a.some(i=>/^\s*\+\s*FACTION KEYWORD:/i.test(i))?"WTC_COMPACT":s?"GW_APP":"UNKNOWN"}}async function Xm(t){if(!t||typeof t!="string")throw new Error("Invalid army list text");const n=t.split(`
`),a=zm(n);if(a==="UNKNOWN")throw new Error("Unable to detect army list format. Supported formats: GW App, WTC, WTC Compact, NR-GW, NR-NR, ListForge");let r;try{switch(a){case"GW_APP":r=Ym(n);break;case"WTC":r=Wm(n);break;case"WTC_COMPACT":r=$m(n);break;case"NR_GW":r=Hm(n);break;case"NRNR":r=Fm(n);break;case"LF":r=Gm(n);break;default:throw new Error(`Unsupported format: ${a}`)}}catch(i){throw console.error("Parse error:",i),new Error(`Failed to parse ${a} format: ${i.message}`)}const s=jm(r);return{format:a,data:s}}function jm(t,n){const a=t.SUMMARY||{},r=[],s=["CHARACTER","CHARACTERS","BATTLELINE","OTHER DATASHEETS","ALLIED UNITS","DEDICATED TRANSPORTS"];for(const i of s)t[i]&&Array.isArray(t[i])&&r.push(...t[i].map(o=>({...o,section:i})));return{FACTION_KEYWORD:a.FACTION_KEYWORD||a.FACTION_KEY||"Unknown",DETACHMENT:a.DETACHMENT||"",TOTAL_ARMY_POINTS:a.TOTAL_ARMY_POINTS||"0pts",LIST_TITLE:a.LIST_TITLE||"",UNITS:r}}function Vm(t){if(!t)return 1;const n=String(t).match(/(\d+)/);return n?parseInt(n[1],10):1}const Qm={Asurmen:{baseType:"40mm"},Autarch:{baseType:"32mm"},"Autarch wayleaper":{baseType:"32mm"},"Avatar of Khaine":{baseType:"80mm"},Baharroth:{baseType:"40mm"},"Corsair Voidreavers":{baseType:"28.5mm"},"Corsair Voidscarred":{baseType:"28.5mm"},"Crimson Hunter":{baseType:"120x92mm"},"D-cannon Platform":{baseType:"40mm"},"Dark Reapers":{baseType:"28.5mm"},"Death Jester":{baseType:"25mm"},"Dire Avengers":{baseType:"28.5mm"},"Eldrad Ulthran":{baseType:"32mm"},Falcon:{baseType:"Large Flying Base"},Farseer:{baseType:"25mm"},"Farseer Skyrunner":{baseType:"Small Flying Base"},"Fire Dragons":{baseType:"28.5mm"},"Fire Prism":{baseType:"Large Flying Base"},Fuegan:{baseType:"40mm"},"Guardian Defenders":{baseType:"28.5mm"},"Guardian Defenders: Heavy Weapon Platform":{baseType:"40mm"},"Hemlock Wraithfighter":{baseType:"120x92mm"},"Howling Banshees":{baseType:"28.5mm"},"Jain Zar":{baseType:"40mm"},Lhykhis:{baseType:"40mm"},"Maugan Ra":{baseType:"40mm"},"Night Spinner":{baseType:"Large Flying Base"},Rangers:{baseType:"28.5mm"},"Shadow Weaver Platform":{baseType:"40mm"},Shadowseer:{baseType:"25mm"},"Shining Spears":{baseType:"Large Flying Base"},"Shroud Runners":{baseType:"Large Flying Base"},Skyweavers:{baseType:"Large Flying Base"},Solitaire:{baseType:"25mm"},Spiritseer:{baseType:"25mm"},Starweaver:{baseType:"Large Flying Base"},"Storm Guardians":{baseType:"28.5mm"},"Storm Guardians: Serpentâs Scale Platform":{baseType:"40mm"},"Striking Scorpions":{baseType:"28.5mm"},"Swooping Hawks":{baseType:"28.5mm"},"The Visarch":{baseType:"32mm"}},Jm={"Corvus Blackstar":{baseType:"120x92mm"},"Deathwatch Terminator Squad":{baseType:"40mm"},"Deathwatch Veterans":{baseType:"32mm"},"Fortis Kill Team":{baseType:"32mm"},"Indomitor Kill Team":{baseType:"40mm"},"Spectrus Kill Team":{baseType:"32mm"},"Spectrus Kill Team: Kill Team Infiltrators with bolt sniper rifles":{baseType:"40mm"},"Talonstrike Kill Team":{baseType:"32mm"},"Talonstrike Kill Team: Kill Team Heavy Intercessors with Jump Packs":{baseType:"40mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},Zm={Archon:{baseType:"25mm"},Beastmaster:{baseType:"Small Flying Base"},"Beastmaster: Clawed Fiends, Khymerae, Razorwing Flocks":{baseType:"40mm"},"Court of the Archon: Sslyth":{baseType:"40mm"},"Court of the Archon: Ur-Ghul, Lhamaean, Medusae":{baseType:"25mm"},Cronos:{baseType:"Large Flying Base"},Drazhar:{baseType:"40mm"},Grotesques:{baseType:"40mm"},Haemonculus:{baseType:"25mm"},Hellions:{baseType:"Small Flying Base"},Incubi:{baseType:"28.5mm"},"Kabalite Warriors":{baseType:"25mm"},"Lelith Hesperax":{baseType:"32mm"},Mandrakes:{baseType:"28.5mm"},Raider:{baseType:"Large Flying Base"},Ravager:{baseType:"Large Flying Base"},"Razorwing Jetfighter":{baseType:"120x92mm"},Reavers:{baseType:"Small Flying Base"},Scourges:{baseType:"32mm"},Succubus:{baseType:"25mm"},Talos:{baseType:"Large Flying Base"},"Urien Rakarth":{baseType:"25mm"},Venom:{baseType:"Large Flying Base"},"Voidraven Bomber":{baseType:"120x92mm"},Wracks:{baseType:"25mm"},Wyches:{baseType:"25mm"}},ed={"Annihilation Barge":{baseType:"Large Flying Base"},"Câtan Shard of the Deceiver":{baseType:"40mm"},"Câtan Shard of the Nightbringer":{baseType:"40mm"},"Câtan Shard of the Void Dragon":{baseType:"80mm"},"Canoptek Doomstalker":{baseType:"90mm"},"Canoptek Reanimator":{baseType:"60mm"},"Canoptek Scarab Swarms":{baseType:"40mm"},"Canoptek Spyders":{baseType:"60mm"},"Canoptek Wraiths":{baseType:"50mm"},"Catacomb Command Barge":{baseType:"Large Flying Base"},Chronomancer:{baseType:"40mm"},"Convergence of Dominion":{baseType:"hull",hullDimensions:{width:0,height:0}},Cryptothralls:{baseType:"32mm"},Deathmarks:{baseType:"32mm"},"Doom Scythe":{baseType:"120x92mm"},"Doomsday Ark":{baseType:"Large Flying Base"},"Flayed Ones":{baseType:"28.5mm"},"Ghost Ark":{baseType:"Large Flying Base"},"Hexmark Destroyer":{baseType:"50mm"},"Illuminor Szeras":{baseType:"80mm"},Immortals:{baseType:"32mm"},"Imotekh the Stormlord":{baseType:"40mm"},"Lokhust Destroyers":{baseType:"Large Flying Base"},"Lokhust Heavy Destroyers":{baseType:"60mm"},"Lokhust Lord":{baseType:"Large Flying Base"},Lychguard:{baseType:"32mm"},Monolith:{baseType:"160mm"},"Necron Warriors":{baseType:"32mm"},"Night Scythe":{baseType:"120x92mm"},Obelisk:{baseType:"120x92mm"},"Ophydian Destroyers":{baseType:"50mm"},"Orikan the Diviner":{baseType:"40mm"},Overlord:{baseType:"40mm"},"Overlord with Translocation Shroud":{baseType:"40mm"},Plasmancer:{baseType:"32mm"},Psychomancer:{baseType:"40mm"},"Royal Warden":{baseType:"32mm"},"Skorpekh Destroyers":{baseType:"50mm"},"Skorpekh Lord":{baseType:"60mm"},Technomancer:{baseType:"50mm"},"Tesseract Vault":{baseType:"120x92mm"},"The Silent King: Szarekh":{baseType:"100mm"},"The Silent King: Triarchal Menhir":{baseType:"50mm"},"Tomb Blades":{baseType:"Small Flying Base"},"Transcendent Câtan":{baseType:"60mm"},"Trazyn the Infinite":{baseType:"40mm"},"Triarch Praetorians":{baseType:"32mm"},"Triarch Stalker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Seraptek Heavy Construct":{baseType:"hull",hullDimensions:{width:0,height:0}}},td={Battlewagon:{baseType:"hull",hullDimensions:{width:0,height:0}},"Beast Snagga Boyz":{baseType:"32mm"},Beastboss:{baseType:"50mm"},"Beastboss on Squigosaur":{baseType:"80mm"},"Big Mek":{baseType:"50mm"},"Big Mek in Mega Armour":{baseType:"40mm"},"Big Mek with Shokk Attack Gun":{baseType:"40mm"},"Bigâed Bossbunka":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blitza-bommer":{baseType:"120x92mm"},"Boomdakka Snazzwagon":{baseType:"150x95mm"},"Boss Snikrot":{baseType:"40mm"},Boyz:{baseType:"32mm"},"Breaka Boyz":{baseType:"32mm"},"Breaka Boyz: Boss Nob":{baseType:"40mm"},"Burna Boyz":{baseType:"32mm"},"Burna-bommer":{baseType:"120x92mm"},Dakkajet:{baseType:"120x92mm"},"Deff Dread":{baseType:"60mm"},"Deffkilla Wartrike":{baseType:"150x95mm"},Deffkoptas:{baseType:"75x42mm"},"Flash Gitz":{baseType:"40mm"},"Ghazghkull Thraka":{baseType:"80mm"},"Ghazghkull Thraka: Makari":{baseType:"25mm"},Gorkanaut:{baseType:"170x109mm"},Gretchin:{baseType:"25mm"},"Gretchin: Runtherd":{baseType:"32mm"},"Hunta Rig":{baseType:"170x109mm"},"Kill Rig":{baseType:"170x109mm"},"Killa Kans":{baseType:"60mm"},Kommandos:{baseType:"32mm"},"Kustom Boosta-blasta":{baseType:"150x95mm"},Lootas:{baseType:"32mm"},Meganobz:{baseType:"40mm"},"Megatrakk Scrapjet":{baseType:"150x95mm"},Mek:{baseType:"32mm"},"Mek Gunz":{baseType:"hull",hullDimensions:{width:0,height:0}},Morkanaut:{baseType:"170x109mm"},"Mozrog Skragbad":{baseType:"80mm"},Nobz:{baseType:"32mm"},Painboss:{baseType:"40mm"},Painboy:{baseType:"32mm"},"Rukkatrukk Squigbuggy":{baseType:"150x95mm"},"Shokkjump Dragsta":{baseType:"150x95mm"},"Squighog Boyz":{baseType:"75x42mm"},"Squighog Boyz: Nob on Smasha Squig":{baseType:"90x52.5mm"},Stompa:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormboyz:{baseType:"32mm"},Tankbustas:{baseType:"32mm"},"Tankbustas: Boss Nob":{baseType:"40mm"},Trukk:{baseType:"hull",hullDimensions:{width:0,height:0}},Warbikers:{baseType:"75x42mm"},Warboss:{baseType:"40mm"},"Warboss in Mega Armour":{baseType:"50mm"},"Wazbom Blastajet":{baseType:"150x95mm"},Weirdboy:{baseType:"40mm"},Wurrboy:{baseType:"32mm"},"Zodgrod Wortsnagga":{baseType:"50mm"},"Gargantuan Squiggoth":{baseType:"hull",hullDimensions:{width:0,height:0}}},nd={Barbgaunts:{baseType:"40mm"},Biovores:{baseType:"80mm"},Broodlord:{baseType:"75x42mm"},Carnifexes:{baseType:"105x70mm"},Deathleaper:{baseType:"60mm"},Exocrine:{baseType:"120x92mm"},Gargoyles:{baseType:"Small Flying Base"},Genestealers:{baseType:"32mm"},Harpy:{baseType:"120x92mm"},Haruspex:{baseType:"120x92mm"},"Hive Crone":{baseType:"120x92mm"},"Hive Guard":{baseType:"50mm"},"Hive Tyrant":{baseType:"50mm"},Hormagaunts:{baseType:"28.5mm"},Lictor:{baseType:"50mm"},Maleceptor:{baseType:"120x92mm"},Mawloc:{baseType:"120x92mm"},"Mucolid Spores":{baseType:"40mm"},Neurogaunts:{baseType:"25mm"},"Neurogaunts: Nodebeasts":{baseType:"28.5mm"},Neurolictor:{baseType:"50mm"},Neurotyrant:{baseType:"50mm"},"Norn Assimilator":{baseType:"100mm"},"Norn Emissary":{baseType:"100mm"},"Old One Eye":{baseType:"105x70mm"},"Parasite of Mortrex":{baseType:"40mm"},Psychophage:{baseType:"120x92mm"},Pyrovores:{baseType:"80mm"},Raveners:{baseType:"40mm"},"Ripper Swarms":{baseType:"40mm"},"Screamer-killer":{baseType:"90mm"},"Spore MInes":{baseType:"25mm"},Sporocyst:{baseType:"hull",hullDimensions:{width:0,height:0}},Termagants:{baseType:"28.5mm"},Tervigon:{baseType:"120x92mm"},"The Swarmlord":{baseType:"60mm"},Toxicrene:{baseType:"120x92mm"},Trygon:{baseType:"120x92mm"},"Tyranid Warriors with Melee Bio-weapons":{baseType:"50mm"},"Tyranid Warriors with Ranged Bio-weapons":{baseType:"50mm"},Tyrannocyte:{baseType:"100mm"},Tyrannofex:{baseType:"120x92mm"},"Tyrant Guard":{baseType:"50mm"},Venomthropes:{baseType:"40mm"},"Von Ryanâs Leapers":{baseType:"40mm"},"Winged Hive Tyrant":{baseType:"60mm"},"Winged Tyranid Prime":{baseType:"50mm"},Zoanthropes:{baseType:"40mm"},Harridan:{baseType:"hull",hullDimensions:{width:4,height:6}},Hierophant:{baseType:"hull",hullDimensions:{width:0,height:0}}},Ma={"ADEPTA SORORITAS":{"Aestred Thurga and Agathae Dolan: Aestred Thurga":{baseType:"32mm"},"Aestred Thurga and Agathae Dolan: Agathae Dolan":{baseType:"25mm"},"Arco-flagellants":{baseType:"25mm"},"Battle Sisters Squad":{baseType:"32mm"},Canoness:{baseType:"32mm"},"Canoness with Jump Pack":{baseType:"32mm"},Castigator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Celestian Sacresants":{baseType:"32mm"},Daemonifuge:{baseType:"32mm"},Dialogus:{baseType:"40mm"},Dogmata:{baseType:"32mm"},"Dominion Squad":{baseType:"32mm"},Exorcist:{baseType:"hull",hullDimensions:{width:0,height:0}},Hospitaller:{baseType:"50mm"},Imagifier:{baseType:"32mm"},Immolator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Junith Eruita":{baseType:"50mm"},"Ministorum Priest":{baseType:"32mm"},Mortifiers:{baseType:"50mm"},"Morvenn Vahl":{baseType:"60mm"},Palatine:{baseType:"32mm"},"Paragon Warsuits":{baseType:"50mm"},"Penitent Engines":{baseType:"50mm"},"Repentia Squad: Repentia Superior":{baseType:"32mm"},"Repentia Squad: Sister Repentia":{baseType:"28.5mm"},"Retributor Squad":{baseType:"32mm"},"Saint Celestine":{baseType:"40mm"},"Saint Celestine: Geminae Superia":{baseType:"32mm"},Sanctifiers:{baseType:"25mm"},"Seraphim Squad":{baseType:"32mm"},"Sisters Novitiate Squad: Novitiate Superior":{baseType:"32mm"},"Sisters Novitiate Squad: Sister Novitiate":{baseType:"28.5mm"},"Sororitas Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Triumph of Saint Katherine":{baseType:"120x92mm"},"Zephyrim Squad":{baseType:"32mm"}},"ADEPTUS CUSTODES":{Aleya:{baseType:"32mm"},"Allarus Custodians":{baseType:"40mm"},"Anathema Psykana Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blade Champion":{baseType:"40mm"},"Custodian Guard":{baseType:"40mm"},"Custodian Wardens":{baseType:"40mm"},"Knight-Centura":{baseType:"32mm"},Prosecutors:{baseType:"32mm"},"Shield-Captain":{baseType:"40mm"},"Shield-Captain in Allarus Terminator Armour":{baseType:"40mm"},"Shield-Captain on Dawneagle Jetbike":{baseType:"75x42mm"},"Trajann Valoris":{baseType:"40mm"},Valerian:{baseType:"40mm"},"Venerable Contemptor Dreadnought":{baseType:"60mm"},"Venerable Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vertus Praetors":{baseType:"75x42mm"},Vigilators:{baseType:"32mm"},Witchseekers:{baseType:"32mm"},"Agamatus Custodians":{baseType:"75x42mm"},"Aquilon Custodians":{baseType:"50mm"},"Ares Gunship":{baseType:"160mm"},"Caladius Grav-tank":{baseType:"170x109mm"},"Contemptor-Achillus Dreadnought":{baseType:"60mm"},"Contemptor-Galatus Dreadnought":{baseType:"60mm"},"Coronus Grav-carrier":{baseType:"170x109mm"},"Custodian Guard with Adrasite and Pyrithite Spears":{baseType:"40mm"},"Orion Assault Dropship":{baseType:"160mm"},"Pallas Grav-attack":{baseType:"105x70mm"},"Sagittarum Custodians":{baseType:"40mm"},"Telemon Heavy Dreadnought":{baseType:"100mm"},"Venatari Custodians":{baseType:"40mm"}},"ADEPTUS MECHANICUS":{"Archaeopter Fusilave":{baseType:"170x109mm"},"Archaeopter Stratoraptor":{baseType:"170x109mm"},"Archaeopter Transvector":{baseType:"170x109mm"},"Belisarius Cawl":{baseType:"105x70mm"},"Corpuscarii Electro-Priests":{baseType:"32mm"},"Cybernetica Datasmith":{baseType:"32mm"},"Fulgurite Electro-Priests":{baseType:"32mm"},"Ironstrider Ballistarii":{baseType:"105x70mm"},"Kastelan Robots":{baseType:"60mm"},"Kataphron Breachers":{baseType:"60mm"},"Kataphron Destroyers":{baseType:"60mm"},"Onager Dunecrawler":{baseType:"130mm"},"Pteraxii Skystalkers":{baseType:"40mm"},"Pteraxii Sterylizors":{baseType:"40mm"},"Serberys Raiders":{baseType:"60x35.5mm"},"Serberys Sulphurhounds":{baseType:"60x35.5mm"},"Sicarian Infiltrators":{baseType:"40mm"},"Sicarian Ruststalkers":{baseType:"40mm"},"Skitarii Marshal":{baseType:"32mm"},"Skitarii Rangers":{baseType:"25mm"},"Skitarii Rangers/Skitarii Vanguard: Transuranic Arquebus":{baseType:"60x35.5mm"},"Skitarii Vanguard":{baseType:"25mm"},"Skorpius Disintegrator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skorpius Dunerider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sydonian Dragoons with Radium Jezzails":{baseType:"105x70mm"},"Sydonian Dragoons with Taser Lances":{baseType:"105x70mm"},"Sydonian Skatros":{baseType:"40mm"},"Tech-Priest Dominus":{baseType:"50mm"},"Tech-Priest Enginseer":{baseType:"32mm"},"Tech-Priest Manipulus":{baseType:"50mm"},Technoarcheologist:{baseType:"32mm"}},"ADEPTUS TITANICUS":{"Reaver Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warbringer Nemesis Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warhound Titan":{baseType:"hull",hullDimensions:{width:0,height:0}},"Warlord Titan":{baseType:"hull",hullDimensions:{width:0,height:0}}},AELDARI:Qm,"ASTRA MILITARUM":{"Aegis Defence Line":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armoured Sentinels":{baseType:"80mm"},"Artillery Team":{baseType:"130mm"},"Attilan Rough Riders":{baseType:"60x35.5mm"},Baneblade:{baseType:"hull",hullDimensions:{width:0,height:0}},Banehammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Banesword:{baseType:"hull",hullDimensions:{width:0,height:0}},Basilisk:{baseType:"hull",hullDimensions:{width:0,height:0}},"Bullgryn squad":{baseType:"40mm"},"Cadian Castellan":{baseType:"28.5mm"},"Cadian Command Squad":{baseType:"28.5mm"},"Cadian Heavy Weapons Squad":{baseType:"50mm"},"Cadian Shock Troops":{baseType:"25mm"},"Catachan Command Squad":{baseType:"25mm"},"Catachan Heavy Weapons Squad":{baseType:"60mm"},"Catachan Jungle Fighters":{baseType:"25mm"},Chimera:{baseType:"hull",hullDimensions:{width:0,height:0}},Commissar:{baseType:"28.5mm"},"Death Korps of Krieg":{baseType:"25mm"},"Death Riders":{baseType:"60x35.5mm"},Deathstrike:{baseType:"hull",hullDimensions:{width:0,height:0}},Doomhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},"Field Ordnance Battery":{baseType:"100mm"},"Gauntâs Ghosts":{baseType:"28.5mm"},Hellhammer:{baseType:"hull",hullDimensions:{width:0,height:0}},Hellhound:{baseType:"hull",hullDimensions:{width:0,height:0}},Hydra:{baseType:"hull",hullDimensions:{width:0,height:0}},Kasrkin:{baseType:"28.5mm"},"Krieg Combat Engineers":{baseType:"25mm"},"Krieg Command Squad":{baseType:"25mm"},"Krieg Command Squad: Lord Commissar":{baseType:"32mm"},"Krieg Heavy Weapons Squad":{baseType:"50mm"},"Krieg Heavy Weapons Squad: Fire Coordinator":{baseType:"25mm"},"Leman Russ Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Demolisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Eradicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Executioner":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Exterminator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Punisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Leman Russ Vanquisher":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Marshal Dreir":{baseType:"75x42mm"},"Lord Solar Leontus":{baseType:"80mm"},Manticore:{baseType:"hull",hullDimensions:{width:0,height:0}},"Militarum Tempestus Command Squad":{baseType:"25mm"},"Ministorum Priest":{baseType:"32mm"},"Nork Deddog":{baseType:"40mm"},"Ogryn Bodyguard":{baseType:"40mm"},"Ogryn squad":{baseType:"40mm"},"Primaris Psyker":{baseType:"32mm"},Ratlings:{baseType:"25mm"},"Rogal Dorn Battle Tank":{baseType:"hull",hullDimensions:{width:0,height:0}},"Rogal Dorn Commander":{baseType:"hull",hullDimensions:{width:0,height:0}},"Scout Sentinels":{baseType:"80mm"},Shadowsword:{baseType:"hull",hullDimensions:{width:0,height:0}},"Sly Marbo":{baseType:"32mm"},Stormlord:{baseType:"hull",hullDimensions:{width:0,height:0}},Stormsword:{baseType:"hull",hullDimensions:{width:0,height:0}},Taurox:{baseType:"hull",hullDimensions:{width:0,height:0}},"Taurox Prime":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tech-Priest Enginseer":{baseType:"32mm"},"Tempestus Aquilons":{baseType:"28.5mm"},"Tempestus Scions":{baseType:"25mm"},"Ursula Creed":{baseType:"32mm"},Valkyrie:{baseType:"120x92mm"},Wyvern:{baseType:"hull",hullDimensions:{width:0,height:0}},"Avenger Strike Fighter":{baseType:"120x92mm"},"Cyclops Demolition Vehicle":{baseType:"hull",hullDimensions:{width:0,height:0}}},"BLACK TEMPLARS":{"Black Templars Gladiator Lancer":{baseType:"100mm"},"Black Templars Gladiator Reaper":{baseType:"100mm"},"Black Templars Gladiator Valiant":{baseType:"100mm"},"Black Templars Impulsor":{baseType:"100mm"},"Black Templars Repulsor":{baseType:"100mm"},"Black Templars Repulsor Executioner":{baseType:"100mm"},Castellan:{baseType:"40mm"},"Chaplain Grimaldus":{baseType:"40mm"},"Chaplain Grimaldus: Cenobyte Servitors":{baseType:"28.5mm"},"Crusader Squad: Neophytes":{baseType:"28.5mm"},"Crusader Squad: Sword Brother/Initiates":{baseType:"32mm"},"High Marshal Helbrecht":{baseType:"60mm"},Marshal:{baseType:"40mm"},"Primaris Crusader Squad: Initiates":{baseType:"32mm"},"Primaris Crusader Squad: Neophytes":{baseType:"28.5mm"},"Primaris Crusader Squad: Sword Brother":{baseType:"40mm"},"Primaris Sword Brethren":{baseType:"40mm"},"The Emperorâs Champion":{baseType:"40mm"}},"BLOOD ANGELS":{Astorath:{baseType:"40mm"},"Baal Predator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Blood Angels Captain":{baseType:"40mm"},"Chief Librarian Mephiston":{baseType:"40mm"},"Commander Dante":{baseType:"50mm"},"Death Company Captain":{baseType:"40mm"},"Death Company Captain with Jump Pack":{baseType:"40mm"},"Death Company Dreadnought":{baseType:"90mm"},"Death Company Marines":{baseType:"32mm"},"Death Company Marines with Bolt Rifles":{baseType:"32mm"},"Death Company Marines with Jump Packs":{baseType:"32mm"},Lemartes:{baseType:"40mm"},"Sanguinary Guard":{baseType:"40mm"},"Sanguinary Priest":{baseType:"40mm"},"The Sanguinor":{baseType:"40mm"}},"CHAOS DAEMONS":{"Beâlakor":{baseType:"100mm"},"Beasts of Nurgle":{baseType:"60mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodmaster:{baseType:"40mm"},Bloodthirster:{baseType:"120x92mm"},"Blue Horrors":{baseType:"25mm"},"Burning Chariot":{baseType:"120x92mm"},Changecaster:{baseType:"32mm"},"Contorted Epitome":{baseType:"75x42mm"},"Daemon Prince of Chaos":{baseType:"60mm"},"Daemon Prince of Chaos with Wings":{baseType:"60mm"},Daemonettes:{baseType:"25mm"},Epidemius:{baseType:"60mm"},"Exalted Flamer":{baseType:"75x42mm"},Fateskimmer:{baseType:"120x92mm"},"Feculent Gnarlmaw":{baseType:"hull",hullDimensions:{width:0,height:0}},Fiends:{baseType:"75x42mm"},Flamers:{baseType:"32mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Fluxmaster:{baseType:"Large Flying Base"},"Great Unclean One":{baseType:"130mm"},Hellflayers:{baseType:"120x92mm"},"Horticulous Slimux":{baseType:"105x70mm"},"Infernal Enrapturess":{baseType:"60x35.5mm"},"Kairos Fateweaver":{baseType:"100mm"},Karanak:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},Nurglings:{baseType:"40mm"},"Pink Horrors":{baseType:"32mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Poxbringer:{baseType:"32mm"},"Rendmaster on Blood Throne":{baseType:"120x92mm"},Rotigus:{baseType:"130mm"},Screamers:{baseType:"Small Flying Base"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"},Skarbrand:{baseType:"100mm"},"Skull Altar":{baseType:"hull",hullDimensions:{width:0,height:0}},"Skull Cannon":{baseType:"120x92mm"},Skullmaster:{baseType:"90x52.5mm"},Skulltaker:{baseType:"40mm"},"Sloppity Bilepiper":{baseType:"32mm"},"Soul Grinder":{baseType:"160mm"},"Spoilpox Scrivener":{baseType:"40mm"},"Syllâesske":{baseType:"50mm"},"The Blue Scribes":{baseType:"Large Flying Base"},"The Changeling":{baseType:"40mm"},"The Masque of Slaanesh":{baseType:"32mm"},Tormentbringer:{baseType:"120x92mm"},Tranceweaver:{baseType:"32mm"}},"CHAOS KNIGHTS":{"Knight Abominant":{baseType:"170x109mm"},"Knight Desecrator":{baseType:"170x109mm"},"Knight Despoiler":{baseType:"170x109mm"},"Knight Rampager":{baseType:"170x109mm"},"Knight Tyrant":{baseType:"170x109mm"},"War Dog Brigand":{baseType:"100mm"},"War Dog Executioner":{baseType:"100mm"},"War Dog Huntsman":{baseType:"100mm"},"War Dog Karnivore":{baseType:"100mm"},"War Dog Stalker":{baseType:"100mm"},"Chaos Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Cerastus Knight Acheron":{baseType:"170x109mm"},"Chaos Cerastus Knight Atrapos":{baseType:"170x109mm"},"Chaos Cerastus Knight Castigator":{baseType:"170x109mm"},"Chaos Cerastus Knight Lancer":{baseType:"170x109mm"},"Chaos Questoris Knight Magaera":{baseType:"170x109mm"},"Chaos Questoris Knight Styrix":{baseType:"170x109mm"},"War Dog Moirax":{baseType:"100mm"}},"CHAOS SPACE MARINES":{"Abaddon the Despoiler":{baseType:"60mm"},"Accursed Cultists: Mutant":{baseType:"25mm"},"Accursed Cultists: Torment":{baseType:"40mm"},"Chaos Bikers":{baseType:"75x42mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Lord":{baseType:"40mm"},"Chaos Lord in Terminator Armour":{baseType:"40mm"},"Chaos Lord with Jump Pack":{baseType:"40mm"},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminator Squad":{baseType:"40mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},Chosen:{baseType:"32mm"},"Cultist Firebrand":{baseType:"32mm"},"Cultist Mob":{baseType:"25mm"},Cypher:{baseType:"32mm"},"Dark Apostle":{baseType:"40mm"},"Dark Apostle: Dark Disciple":{baseType:"25mm"},"Dark Commune: Blessed Blade":{baseType:"28.5mm"},"Dark Commune: Cult Demagogue, Mindwitch, Iconarch":{baseType:"32mm"},Defiler:{baseType:"160mm"},"Fabius Bile":{baseType:"40mm"},"Fabius Bile: Surgeon Acolyte":{baseType:"32mm"},"Fellgor beastmen":{baseType:"32mm"},Forgefiend:{baseType:"120x92mm"},"Haarken Worldclaimer":{baseType:"40mm"},Havocs:{baseType:"40mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Heretic Astartes Daemon Prince":{baseType:"60mm"},"Heretic Astartes Daemon Prince with Wings":{baseType:"60mm"},"Huron Blackheart":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},Legionaries:{baseType:"32mm"},"Lord Discordant on Helstalker":{baseType:"120x92mm"},"Master of Executions":{baseType:"40mm"},"Master of Possession":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},"Nemesis Claw":{baseType:"32mm"},"Noctilith Crown":{baseType:"hull",hullDimensions:{width:0,height:0}},Obliterators:{baseType:"50mm"},Possessed:{baseType:"40mm"},Raptors:{baseType:"32mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Traitor Enforcer":{baseType:"32mm"},"Traitor Enforcer: Traitor Ogryn":{baseType:"40mm"},"Traitor Guardsmen Squad":{baseType:"25mm"},"Vashtorr the Arkifane":{baseType:"80mm"},Venomcrawler:{baseType:"100mm"},"Warp Talons":{baseType:"32mm"},Warpsmith:{baseType:"60x35.5mm"}},"DARK ANGELS":{Asmodai:{baseType:"50mm"},Azrael:{baseType:"50mm"},Belial:{baseType:"50mm"},"Deathwing Knights":{baseType:"40mm"},"Deathwing Terminator Squad":{baseType:"40mm"},Ezekiel:{baseType:"25mm"},"Inner Circle Companions":{baseType:"40mm"},"Land Speeder Vengeance":{baseType:"Large Flying Base"},Lazarus:{baseType:"40mm"},"Lion ElâJonson":{baseType:"60mm"},"Nephilim Jetfighter":{baseType:"120x92mm"},"Ravenwing Black Knights":{baseType:"75x42mm"},"Ravenwing Command Squad":{baseType:"75x42mm"},"Ravenwing Dark Talon":{baseType:"120x92mm"},"Ravenwing Darkshroud":{baseType:"Large Flying Base"},Sammael:{baseType:"Large Flying Base"}},"DEATH GUARD":{"Biologus Putrifier":{baseType:"40mm"},"Blightlord Terminators":{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Nurgle":{baseType:"60mm"},"Daemon Prince of Nurgle with Wings":{baseType:"60mm"},"Deathshroud Terminators":{baseType:"40mm"},Defiler:{baseType:"160mm"},"Foetid Bloat-Drone":{baseType:"60mm"},"Foetid Bloat-drone with Heavy Blight Launcher":{baseType:"60mm"},"Foul Blightspawn":{baseType:"40mm"},Helbrute:{baseType:"60mm"},"Icon Bearer":{baseType:"32mm"},"Lord of Contagion":{baseType:"50mm"},"Lord of Poxes":{baseType:"40mm"},"Lord of Virulence":{baseType:"50mm"},"Malignant Plaguecaster":{baseType:"32mm"},"Miasmic Malignifier":{baseType:"hull",hullDimensions:{width:0,height:0}},Mortarion:{baseType:"100mm"},"Myphitic Blight-Haulers":{baseType:"80mm"},"Noxious Blightbringer":{baseType:"40mm"},"Plague Marines":{baseType:"32mm"},"Plague Surgeon":{baseType:"40mm"},"Plagueburst Crawler":{baseType:"hull",hullDimensions:{width:0,height:0}},Poxwalkers:{baseType:"25mm"},Tallyman:{baseType:"40mm"},Typhus:{baseType:"50mm"},"Beasts of Nurgle":{baseType:"60mm"},"Great Unclean One":{baseType:"130mm"},Nurglings:{baseType:"40mm"},"Plague Drones":{baseType:"Large Flying Base"},Plaguebearers:{baseType:"32mm"},Rotigus:{baseType:"130mm"}},DEATHWATCH:Jm,DRUKHARI:Zm,"EMPERORâS CHILDREN":{"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Terminators":{baseType:"40mm"},"Daemon Prince of Slaanesh":{baseType:"60mm"},"Daemon Prince of Slaanesh with Wings":{baseType:"60mm"},"Flawless Blades":{baseType:"40mm"},Fulgrim:{baseType:"130mm"},Heldrake:{baseType:"120x92mm"},Infractors:{baseType:"32mm"},"Lord Exultant":{baseType:"40mm"},"Lord Kakophonist":{baseType:"40mm"},"Lucius the Eternal":{baseType:"50mm"},Maulerfiend:{baseType:"120x92mm"},"Noise Marines":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},Tormentors:{baseType:"32mm"},Daemonettes:{baseType:"25mm"},Fiends:{baseType:"75x42mm"},"Keeper of Secrets":{baseType:"100mm"},Seekers:{baseType:"60x35.5mm"},"Shalaxi Helbane":{baseType:"100mm"}},"GENESTEALER CULTS":{Aberrants:{baseType:"32mm"},Abominant:{baseType:"40mm"},"Achilles Ridgerunners":{baseType:"120x92mm"},"Acolyte Hybrids with Autopistols":{baseType:"32mm"},"Acolyte Hybrids with Hand Flamers":{baseType:"32mm"},"Acolyte Iconward":{baseType:"32mm"},"Atalan Jackals":{baseType:"60x35.5mm"},"Atalan Jackals: Wolfquad":{baseType:"60mm"},Benefictus:{baseType:"32mm"},Biophagus:{baseType:"25mm"},Clamavus:{baseType:"32mm"},"Goliath Rockgrinder":{baseType:"hull",hullDimensions:{width:0,height:0}},"Goliath Truck":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hybrid Metamorphs":{baseType:"32mm"},"Jackal Alphus":{baseType:"60x35.5mm"},Kelermorph:{baseType:"32mm"},Locus:{baseType:"32mm"},Magus:{baseType:"32mm"},"Neophyte Hybrids":{baseType:"25mm"},"Neophyte Hybrids: Heavy stubber, Mining laser, Seismic cannon":{baseType:"32mm"},Nexos:{baseType:"40mm"},Patriarch:{baseType:"50mm"},Primus:{baseType:"32mm"},"Purestrain Genestealers":{baseType:"32mm"},"Reductus Saboteur":{baseType:"32mm"},Sanctus:{baseType:"32mm"}},"GREY KNIGHTS":{"Brother-Captain":{baseType:"40mm"},"Brother-Captain Stern":{baseType:"40mm"},"Brotherhood Champion":{baseType:"32mm"},"Brotherhood Chaplain":{baseType:"40mm"},"Brotherhood Librarian":{baseType:"40mm"},"Brotherhood Techmarine":{baseType:"32mm"},"Brotherhood Terminator Squad":{baseType:"40mm"},"Castellan Crowe":{baseType:"40mm"},"Grand Master":{baseType:"40mm"},"Grand Master in Nemesis Dreadknight":{baseType:"120x92mm"},"Grand Master Voldus":{baseType:"40mm"},"Grey Knights Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Razorback":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Grey knights Stormhawk Interceptor":{baseType:"120x92mm"},"Grey knights Stormraven Gunship":{baseType:"120x92mm"},"Grey knights Stormtalon Gunship":{baseType:"120x92mm"},"Grey Knights Venerable Dreadnought":{baseType:"60mm"},"Interceptor Squad":{baseType:"32mm"},"Kaldor Draigo":{baseType:"40mm"},"Nemesis Dreadknight":{baseType:"120x92mm"},"Paladin Squad":{baseType:"40mm"},"Purgation Squad":{baseType:"32mm"},"Purifier Squad":{baseType:"32mm"},Servitors:{baseType:"25mm"},"Strike Squad":{baseType:"32mm"},"Grey Knights Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}},"Land Raider Banisher":{baseType:"hull",hullDimensions:{width:0,height:0}}},"IMPERIAL AGENTS":{"Callidus Assassin":{baseType:"32mm"},"Corvus Blackstar":{baseType:"120x92mm"},"Culexus Assassin":{baseType:"32mm"},"Deathwatch Kill Team":{baseType:"32mm"},"Eversor Assassin":{baseType:"32mm"},"Exaction Squad":{baseType:"28.5mm"},"Exaction Squad: Cyber-mastiff":{baseType:"25mm"},"Grey Knights Terminator Squad":{baseType:"40mm"},"Imperial Navy Breachers":{baseType:"25mm"},"Imperial Navy Breachers: Navis las-volley, endurant shield":{baseType:"28.5mm"},"Imperial Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},Inquisitor:{baseType:"32mm"},"Inquisitor Coteaz":{baseType:"40mm"},"Inquisitor Draxus":{baseType:"32mm"},"Inquisitor Greyfax":{baseType:"32mm"},"Inquisitorial Agents":{baseType:"25mm"},"Inquisitorial Agents: Gun Servitors":{baseType:"32mm"},"Inquisitorial Chimera":{baseType:"hull",hullDimensions:{width:0,height:0}},"Ministorum Priest":{baseType:"32mm"},Navigator:{baseType:"32mm"},"Rogue Trader entourage":{baseType:"25mm"},Sanctifiers:{baseType:"25mm"},"Sisters of Battle Immolator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Sisters of Battle Squad":{baseType:"32mm"},"Subductor Squad":{baseType:"28.5mm"},"Subductor Squad: Cyber-mastiff":{baseType:"25mm"},"Vigilant Squad":{baseType:"28.5mm"},"Vigilant Squad: Cyber-mastiff":{baseType:"25mm"},"Vindicare Assassin":{baseType:"32mm"},"Voidsmen-at-Arms":{baseType:"32mm"},"Watch Captain Artemis":{baseType:"32mm"},"Watch Master":{baseType:"32mm"}},"IMPERIAL KNIGHTS":{"Armiger Helverin":{baseType:"100mm"},"Armiger Warglaive":{baseType:"100mm"},"Canis Rex":{baseType:"170x109mm"},"Knight Castellan":{baseType:"170x109mm"},"Knight Crusader":{baseType:"170x109mm"},"Knight Errant":{baseType:"170x109mm"},"Knight Gallant":{baseType:"170x109mm"},"Knight Paladin":{baseType:"170x109mm"},"Knight Preceptor":{baseType:"170x109mm"},"Knight Valiant":{baseType:"170x109mm"},"Knight Warden":{baseType:"170x109mm"},"Acastus Knight Asterius":{baseType:"hull",hullDimensions:{width:0,height:0}},"Acastus Knight Porphyrion":{baseType:"hull",hullDimensions:{width:0,height:0}},"Armiger Moirax":{baseType:"100mm"},"Cerastus Knight Acheron":{baseType:"170x109mm"},"Cerastus Knight Atrapos":{baseType:"170x109mm"},"Cerastus Knight Castigator":{baseType:"170x109mm"},"Cerastus Knight Lancer":{baseType:"170x109mm"},"Questoris Knight Magaera":{baseType:"170x109mm"},"Questoris Knight Styrix":{baseType:"170x109mm"}},"LEAGUES OF VOTANN":{"BrÃ´khyr Iron-master":{baseType:"32mm"},"BrÃ´khyr Iron-master: E-COG":{baseType:"25mm"},"BrÃ´khyr Iron-master: Ironkin Assistant":{baseType:"28.5mm"},"BrÃ´khyr Thunderkyn":{baseType:"40mm"},"Cthonian Beserks":{baseType:"28.5mm"},"Cthonian Beserks: Mole grenade launcher":{baseType:"50mm"},"Einhyr Champion":{baseType:"40mm"},"Einhyr Hearthguard":{baseType:"32mm"},Grimnyr:{baseType:"40mm"},"Grimnyr: CORV":{baseType:"25mm"},"Hearthkyn Warriors":{baseType:"28.5mm"},"Hekaton Land Fortress":{baseType:"hull",hullDimensions:{width:0,height:0}},"Hernkyn Pioneers":{baseType:"90x52.5mm"},"Hernkyn Yaegirs":{baseType:"28.5mm"},KÃ¢hl:{baseType:"40mm"},Sagitaur:{baseType:"hull",hullDimensions:{width:0,height:0}},"Ãthar the Destined":{baseType:"40mm"}},NECRONS:ed,ORKS:td,"SPACE MARINES":{"Adrax Agatone":{baseType:"40mm"},"Aggressor Squad":{baseType:"40mm"},Ancient:{baseType:"40mm"},"Ancient in Terminator Armour":{baseType:"40mm"},Apothecary:{baseType:"40mm"},"Apothecary Biologis":{baseType:"40mm"},"Assault Intercessor Squad":{baseType:"32mm"},"Assault Intercessors with Jump Packs":{baseType:"32mm"},"Ballistus Dreadnought":{baseType:"90mm"},"Bladeguard Ancient":{baseType:"40mm"},"Bladeguard Veteran Squad":{baseType:"40mm"},"Brutalis Dreadnought":{baseType:"90mm"},Captain:{baseType:"40mm"},"Captain in Gravis Armour":{baseType:"40mm"},"Captain in Phobos Armour":{baseType:"40mm"},"Captain in Terminator Armour":{baseType:"50mm"},"Captain Sicarius":{baseType:"32mm"},"Captain with Jump Pack":{baseType:"40mm"},"Centurion Assault Squad":{baseType:"50mm"},"Centurion Devastator Squad":{baseType:"50mm"},Chaplain:{baseType:"40mm"},"Chaplain in Terminator Armour":{baseType:"40mm"},"Chaplain on Bike":{baseType:"90x52.5mm"},"Chaplain with Jump Pack":{baseType:"32mm"},"Chief Librarian Tigurius":{baseType:"40mm"},"Company Heroes":{baseType:"40mm"},"Darnath Lysander":{baseType:"50mm"},"Desolation Squad":{baseType:"32mm"},"Devastator Squad":{baseType:"32mm"},Dreadnought:{baseType:"60mm"},"Drop Pod":{baseType:"hull",hullDimensions:{width:0,height:0}},"Eliminator Squad":{baseType:"40mm"},"Eradicator Squad":{baseType:"40mm"},"Firestrike Servo-turrets":{baseType:"80mm"},"Gladiator Lancer":{baseType:"100mm"},"Gladiator Reaper":{baseType:"100mm"},"Gladiator Valiant":{baseType:"100mm"},"Hammerfall Bunker":{baseType:"hull",hullDimensions:{width:0,height:0}},"Heavy Intercessor Squad":{baseType:"40mm"},"Hellblaster Squad":{baseType:"32mm"},Impulsor:{baseType:"100mm"},"Inceptor Squad":{baseType:"40mm"},"Incursor Squad":{baseType:"32mm"},"Infernus Squad":{baseType:"32mm"},"Infiltrator Squad":{baseType:"32mm"},"Intercessor Squad":{baseType:"32mm"},"Invader ATV":{baseType:"hull",hullDimensions:{width:0,height:0}},"Invictor Tactical Warsuit":{baseType:"90mm"},"Iron Father Feirros":{baseType:"40mm"},Judiciar:{baseType:"40mm"},"Kayvaan Shrike":{baseType:"40mm"},"Korâsarro Khan":{baseType:"40mm"},"Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Crusader":{baseType:"hull",hullDimensions:{width:0,height:0}},"Land Raider Redeemer":{baseType:"hull",hullDimensions:{width:0,height:0}},Librarian:{baseType:"40mm"},"Librarian in Phobos Armour":{baseType:"40mm"},"Librarian in Terminator Armour":{baseType:"40mm"},Lieutenant:{baseType:"40mm"},"Lieutenant in Phobos Armour":{baseType:"40mm"},"Lieutenant in Reiver Armour":{baseType:"40mm"},"Lieutenant Titus":{baseType:"40mm"},"Lieutenant with Combi-weapon":{baseType:"40mm"},"Marneus Calgar":{baseType:"50mm"},"Marneus Calgar: Victrix Honour Guard":{baseType:"40mm"},"Outrider Squad":{baseType:"90x52.5mm"},"Pedro Kantor":{baseType:"32mm"},"Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},Razorback:{baseType:"hull",hullDimensions:{width:0,height:0}},"Redemptor Dreadnought":{baseType:"90mm"},"Reiver Squad":{baseType:"32mm"},Repulsor:{baseType:"100mm"},"Repulsor Executioner":{baseType:"100mm"},Rhino:{baseType:"hull",hullDimensions:{width:0,height:0}},"Roboute Guilliman":{baseType:"60mm"},"Scout Squad":{baseType:"28.5mm"},"Sternguard Veteran Squad":{baseType:"32mm"},"Storm Speeder Hailstrike":{baseType:"90mm"},"Storm Speeder Hammerstrike":{baseType:"90mm"},"Storm Speeder Thunderstrike":{baseType:"90mm"},"Stormhawk Interceptor":{baseType:"120x92mm"},"Stormraven Gunship":{baseType:"120x92mm"},"Stormtalon Gunship":{baseType:"120x92mm"},"Suppressor Squad":{baseType:"40mm"},"Tactical Squad":{baseType:"32mm"},Techmarine:{baseType:"40mm"},"Terminator Assault Squad":{baseType:"40mm"},"Terminator Squad":{baseType:"40mm"},"Tor Garadon":{baseType:"40mm"},"Uriel Ventris":{baseType:"40mm"},"Vanguard Veteran Squad with Jump Packs":{baseType:"32mm"},Vindicator:{baseType:"hull",hullDimensions:{width:0,height:0}},"Vulkan Heâstan":{baseType:"32mm"},Whirlwind:{baseType:"hull",hullDimensions:{width:0,height:0}},Astraeus:{baseType:"hull",hullDimensions:{width:0,height:0}},"Thunderhawk Gunship":{baseType:"hull",hullDimensions:{width:4,height:6}}},"SPACE WOLVES":{"Arjac Rockfist":{baseType:"50mm"},"Bjorn the Fell-handed":{baseType:"60mm"},"Blood Claws":{baseType:"32mm"},"Fenrisian Wolves":{baseType:"40mm"},"Grey Hunters":{baseType:"32mm"},"Iron Priest":{baseType:"32mm"},"Logan Grimnar":{baseType:"80mm"},Murderfang:{baseType:"60mm"},"Njal Stormcaller":{baseType:"40mm"},"Ragnar Blackmane":{baseType:"40mm"},"Thunderwolf Cavalry":{baseType:"60mm"},"Ulrik the Slayer":{baseType:"32mm"},"Venerable Dreadnought":{baseType:"60mm"},"Wolf Guard Battle Leader":{baseType:"40mm"},"Wolf Guard Headtakers":{baseType:"40mm"},"Wolf Guard Headtakers: Hunting Wolves":{baseType:"60x35.5mm"},"Wolf Guard Terminators":{baseType:"40mm"},"Wolf Priest":{baseType:"40mm"},Wulfen:{baseType:"40mm"},"Wulfen Dreadnought":{baseType:"60mm"},"Wulfen with Storm Shields":{baseType:"40mm"}},"TâAU EMPIRE":{"Breacher Team":{baseType:"25mm"},"Broadside Battlesuits":{baseType:"60mm"},"Cadre Fireblade":{baseType:"25mm"},"Commander Farsight":{baseType:"60mm"},"Commander in Coldstar Battlesuit":{baseType:"60mm"},"Commander in Enforcer Battlesuit":{baseType:"60mm"},"Commander Shadowsun":{baseType:"50mm"},"Crisis Fireknife Battlesuits":{baseType:"50mm"},"Crisis Starscythe Battlesuits":{baseType:"50mm"},"Crisis Sunforge Battlesuits":{baseType:"50mm"},Darkstrider:{baseType:"32mm"},Devilfish:{baseType:"Large Flying Base"},Ethereal:{baseType:"40mm"},"Firesight Team":{baseType:"40mm"},"Ghostkeel Battlesuit":{baseType:"105x70mm"},"Hammerhead Gunship":{baseType:"Large Flying Base"},"Kroot Carnivores":{baseType:"28.5mm"},"Kroot Farstalkers":{baseType:"28.5mm"},"Kroot Farstalkers: Kroot Kill-broker":{baseType:"32mm"},"Kroot Flesh Shaper":{baseType:"32mm"},"Kroot Hounds":{baseType:"28.5mm"},"Kroot Lone-spear":{baseType:"90x52.5mm"},"Kroot Trail Shaper":{baseType:"32mm"},"Kroot War Shaper":{baseType:"32mm"},"Krootox Rampagers":{baseType:"50mm"},"Krootox Riders":{baseType:"50mm"},"Pathfinder Team":{baseType:"25mm"},Piranhas:{baseType:"Large Flying Base"},"Razorshark Strike Fighter":{baseType:"120x92mm"},"Riptide Battlesuit":{baseType:"120x92mm"},"Sky Ray Gunship":{baseType:"Large Flying Base"},"Stealth Battlesuits":{baseType:"32mm"},Stormsurge:{baseType:"170x109mm"},"Strike Team":{baseType:"25mm"},"Sun Shark Bomber":{baseType:"120x92mm"},"Tidewall Defence Platform":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Droneport":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Gunrig":{baseType:"hull",hullDimensions:{width:0,height:0}},"Tidewall Shieldline":{baseType:"hull",hullDimensions:{width:0,height:0}},"Vespid Stingwings":{baseType:"28.5mm"},"AX-1-0 Tiger Shark":{baseType:"160mm"},Manta:{baseType:"hull",hullDimensions:{width:4,height:6}},"Taâunar Supremacy Armour":{baseType:"160mm"},"Tiger Shark":{baseType:"160mm"}},"THOUSAND SONS":{Ahriman:{baseType:"40mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Chaos Vindicator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Daemon Prince of Tzeentch":{baseType:"60mm"},"Daemon Prince of Tzeentch with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},"Exalted Sorcerer":{baseType:"32mm"},"Exalted Sorcerer on Disc of Tzeentch":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},"Infernal Master":{baseType:"40mm"},"Magnus the Red":{baseType:"100mm"},Maulerfiend:{baseType:"120x92mm"},"Mutalith Vortex Beast":{baseType:"120x92mm"},"Rubric Marines":{baseType:"32mm"},"Scarab Occult Terminators":{baseType:"40mm"},"Sekhetar Robots":{baseType:"40mm"},Sorcerer:{baseType:"40mm"},"Sorcerer in Terminator Armour":{baseType:"40mm"},"Tzaangor Enlightened":{baseType:"40mm"},"Tzaangor Enlightened with Fatecaster Greatbows":{baseType:"40mm"},"Tzaangor Shaman":{baseType:"40mm"},Tzaangors:{baseType:"32mm"},"Blue Horrors":{baseType:"25mm"},Flamers:{baseType:"32mm"},"Kairos Fateweaver":{baseType:"100mm"},"Lord of Change":{baseType:"100mm"},"Pink Horrors":{baseType:"32mm"},Screamers:{baseType:"Small Flying Base"}},TYRANIDS:nd,"WORLD EATERS":{Angron:{baseType:"100mm"},"Chaos Land Raider":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Annihilator":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Predator Destructor":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Rhino":{baseType:"hull",hullDimensions:{width:0,height:0}},"Chaos Spawn":{baseType:"50mm"},"Daemon Prince of Khorne":{baseType:"60mm"},"Daemon Prince of Khorne with Wings":{baseType:"60mm"},Defiler:{baseType:"160mm"},Eightbound:{baseType:"40mm"},"Exalted Eightbound":{baseType:"40mm"},Forgefiend:{baseType:"120x92mm"},Goremongers:{baseType:"32mm"},Helbrute:{baseType:"60mm"},Heldrake:{baseType:"120x92mm"},Jakhals:{baseType:"28.5mm"},"Jakhals: Dishonoured":{baseType:"40mm"},"KhÃ¢rn the Betrayer":{baseType:"40mm"},"Khorne Berzerkers":{baseType:"32mm"},"Khorne Lord of Skulls":{baseType:"hull",hullDimensions:{width:0,height:0}},"Lord Invocatus":{baseType:"90x52.5mm"},"Lord on Juggernaut":{baseType:"90x52.5mm"},"Master of Executions":{baseType:"40mm"},Maulerfiend:{baseType:"120x92mm"},Slaughterbound:{baseType:"50mm"},"Terminator Squad":{baseType:"40mm"},Bloodcrushers:{baseType:"90x52.5mm"},Bloodletters:{baseType:"32mm"},Bloodthirster:{baseType:"120x92mm"},"Flesh Hounds":{baseType:"60x35.5mm"},Skarbrand:{baseType:"100mm"}}},ad=Tt(Ma);function sd(){return Object.keys(Ma)}function Uo(t){return Ma[t]?Object.keys(Ma[t]):[]}function gr(t,n){return!Ma[t]||!Ma[t][n]?null:Ma[t][n]}nn(ad,t=>Object.keys(t));function rd(t,n){const a=t.FACTION_KEYWORD,r=t.UNITS||[],s=[],i=[],o={};for(const c of r){const u=c.name||"",d=Vm(c.quantity);let f=gr(a,u);if(!f){const m=Go(u,a);m&&(f=gr(a,m))}if(!f){const{faction:m,unitName:h}=od(u);m&&h&&(f=gr(m,h))}if(f){o[u]||(o[u]=0),o[u]++;const m=o[u]>1?` #${o[u]}`:"",h=`${u}${m}`,y=id(f,d,n,h);s.push(...y)}else i.push({id:"unmatched-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),unitName:u,quantity:d,points:c.points,section:c.section})}return{matched:Ko(s),unmatched:i}}function id(t,n,a,r,s){const i=[],o=ld(),l=t.baseType,c=cd(r,l);for(let u=0;u<n;u++){const f={id:md(),baseType:l,playerId:a,x:0,y:0,rotation:0,unitId:o,unitName:r,name:c,imported:!0,inStaging:!0};l==="hull"&&(f.baseType="rect-custom",f.customWidth=t.hullDimensions?.width||5.5,f.customHeight=t.hullDimensions?.height||3),i.push(f)}return i}function Ko(t){const i={};t.forEach(u=>{const d=u.unitId||"ungrouped";i[d]||(i[d]=[]),i[d].push(u)});let o=2,l=2,c=0;for(const u in i){const d=i[u];for(const f of d)f.x=o,f.y=l,o+=2,c++,c>=6&&(o=2,l+=2,c=0);c>0&&(o=2,l+=2,c=0)}return t}function Go(t,n){const a=Uo(n);if(!a||a.length===0)return null;const r=xa(t);for(const l of a)if(xa(l)===r)return l;const s=r.replace(/s$/,""),i=r+"s";for(const l of a){const c=xa(l);if(c===s||c===i)return l}for(const l of a){const c=xa(l);if(r.includes(c)||c.includes(r))return l}const o=r.split(/\s+/).filter(l=>l.length>2);if(o.length>0)for(const l of a){const c=xa(l);if(o.every(u=>c.includes(u)))return l}return null}function od(t){const n=sd(),a=xa(t);for(const r of n){const s=Uo(r);if(s){for(const i of s)if(xa(i)===a)return{faction:r,unitName:i}}}for(const r of n){const s=Go(t,r);if(s)return{faction:r,unitName:s}}return{faction:null,unitName:null}}function xa(t){return String(t||"").toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim()}function ld(){return"unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function cd(t,n){if(!t)return"";const a=n.match(/(\d+)mm/),r=a?parseInt(a[1],10):null;return r&&r<50?ud(t):t}function ud(t){return t?t.replace(/\s*#\d+$/,"").split(/\s+/).filter(s=>s.length>0).slice(0,3).map(s=>s[0].toUpperCase()).join(""):""}function md(){return"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}var dd=ye('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),hd=ye('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div> <!>',1),fd=ye('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Selected</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <button class="danger svelte-1g40uyy"> </button></div>'),yd=ye('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Rotation</span> <span class="value svelte-1g40uyy"> </span></div>'),pd=ye('<div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Debug Rays</label></div>'),vd=ye('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">LoS Status</span> <span class="value svelte-1g40uyy"> </span></div>'),gd=ye('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="model-name">Name</label> <input id="model-name" type="text"/></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Base Type</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Player</span> <span class="value svelte-1g40uyy"> </span></div> <div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Position</span> <span class="value svelte-1g40uyy"> </span></div> <!> <div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Show Line of Sight</label></div> <!> <!> <button class="danger svelte-1g40uyy">Remove</button></div>'),bd=ye('<p class="hint svelte-1g40uyy">Click a model to select it</p>'),Td=ye('<p class="hint svelte-1g40uyy">Click and drag on battlefield to draw a measurement line</p>'),xd=ye('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Length</span> <span class="value svelte-1g40uyy"> </span></div> <button class="danger svelte-1g40uyy">Remove Line</button>',1),_d=ye('<div class="field svelte-1g40uyy"><span class="label-text svelte-1g40uyy">Lines</span> <span class="value svelte-1g40uyy"> </span></div> <button class="secondary svelte-1g40uyy">Clear All Lines</button>',1),Sd=ye('<div class="edit-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label class="checkbox-label svelte-1g40uyy"><input type="checkbox" class="svelte-1g40uyy"/> Line Tool Active (M)</label></div> <!> <!> <!></div>'),wd=ye('<div class="button-group vertical svelte-1g40uyy"><div class="button-row svelte-1g40uyy"><button title="Undo (Ctrl+Z)" class="svelte-1g40uyy">Undo</button> <button title="Redo (Ctrl+Y)" class="svelte-1g40uyy">Redo</button></div> <div class="button-row svelte-1g40uyy"><button title="Export deployment to share with others" class="svelte-1g40uyy">Export</button> <button title="Import deployment from JSON file" class="svelte-1g40uyy">Import</button></div> <input type="file" accept=".json" style="display: none;"/> <button class="svelte-1g40uyy">Save to Browser</button> <button class="svelte-1g40uyy">Restore from Browser</button> <button class="secondary svelte-1g40uyy">Clear All Models</button> <button class="secondary svelte-1g40uyy">Clear Saved State</button></div>'),Ad=ye('<div class="player-toggle svelte-1g40uyy"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-1g40uyy"><div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Circles</h4> <div class="palette-grid svelte-1g40uyy"></div></div> <div class="palette-section svelte-1g40uyy"><h4 class="svelte-1g40uyy">Ovals</h4> <div class="palette-grid svelte-1g40uyy"></div></div></div>',1),Cd=ye('<div class="rect-hull-form svelte-1g40uyy"><div class="field svelte-1g40uyy"><label for="rect-width" class="svelte-1g40uyy">Width (inches)</label> <input id="rect-width" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <div class="field svelte-1g40uyy"><label for="rect-height" class="svelte-1g40uyy">Height (inches)</label> <input id="rect-height" type="number" min="1" max="20" step="0.5" class="svelte-1g40uyy"/></div> <button class="svelte-1g40uyy"> </button></div>'),Ed=_e('<path stroke-width="0.10" stroke-dasharray="0.5,0.25" pointer-events="none"></path>'),Md=_e('<circle stroke-width="0.05" stroke-dasharray="0.3,0.15" pointer-events="none"></circle><circle stroke="#000" stroke-width="0.06" pointer-events="none"></circle><circle r="0.15" fill="#000" pointer-events="none"></circle>',1),Rd=_e("<!><!>",1),kd=_e('<g><rect fill="rgba(139, 90, 43, 0.2)" stroke="#8b5a2b" stroke-width="0.1" pointer-events="none"></rect></g>'),Ld=_e('<g opacity="0.5" pointer-events="none"><!></g>'),Dd=_e('<circle r="0.4" fill="rgba(147, 51, 234, 0.5)" stroke="#9333ea" stroke-width="0.1" pointer-events="none"></circle><line stroke="#9333ea" stroke-width="0.1" stroke-dasharray="0.3,0.15" pointer-events="none"></line><circle r="0.8" fill="#9333ea" stroke="#7e22ce" stroke-width="0.1" role="button" tabindex="0" class="group-rotate-handle"></circle><g pointer-events="none"><path d="M -0.3 0 A 0.3 0.3 0 1 1 0.3 0" fill="none" stroke="white" stroke-width="0.08"></path><path d="M 0.22 -0.15 L 0.3 0 L 0.15 0.08" fill="none" stroke="white" stroke-width="0.08"></path></g>',1),Id=_e('<circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle><circle r="0.4" stroke="#000" stroke-width="0.05" class="endpoint" role="button" tabindex="0"></circle>',1),Nd=_e('<g><line stroke-linecap="round"></line><!><g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g></g>'),Pd=_e('<g><rect x="-2" y="-0.6" width="4" height="1.2" fill="rgba(0,0,0,0.75)" rx="0.3" pointer-events="none"></rect><text x="0" y="0.35" text-anchor="middle" fill="#f59e0b" font-size="0.8" font-weight="bold" pointer-events="none"> </text></g>'),$d=_e('<g class="measurement-line drawing"><line stroke="#f59e0b" stroke-width="0.15" stroke-dasharray="0.3,0.15" stroke-linecap="round" pointer-events="none"></line><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><circle r="0.3" fill="#f59e0b" pointer-events="none"></circle><!></g>'),Od=_e('<line stroke-width="0.05" pointer-events="none"></line>'),Wd=_e('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),Yd=_e('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),Hd=_e('<rect fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-width="0.1" stroke-dasharray="0.3 0.2" pointer-events="none"></rect>'),Fd=_e("<!><!><!><!><!><!><!><!><!><!><!><!><!><!>",1),Bd=ye('<div class="staging-wrapper svelte-1g40uyy"><!></div>'),qd=ye('<main class="svelte-1g40uyy"><div class="header svelte-1g40uyy"><h1 class="svelte-1g40uyy">Deployment Practice</h1> <nav class="nav-links svelte-1g40uyy"><a href="#/setup" class="svelte-1g40uyy">Battlefield Setup</a> <a href="#/deployment" class="active svelte-1g40uyy">Deployment</a> <a href="#/" class="svelte-1g40uyy">Layout Builder</a> <a href="#/debug" class="svelte-1g40uyy">Debug Mode</a></nav></div> <div class="layout svelte-1g40uyy"><div class="sidebar svelte-1g40uyy"><!> <!> <!> <!> <!> <!></div> <div class="main-content svelte-1g40uyy"><div class="battlefield-area svelte-1g40uyy"><div class="battlefield-container svelte-1g40uyy" role="presentation"><!></div> <div class="info svelte-1g40uyy"><p class="svelte-1g40uyy"> </p> <p class="hint svelte-1g40uyy">Drag to select | Ctrl+Click multi-select | Del remove | 1/2 player | L LoS | M measure</p></div></div> <!></div></div></main> <!>',1);function Ud(t,n){Ut(n,!1);const a=()=>lt(Sa,"$selectedDeployment",f),r=()=>lt(pn,"$selectedLayoutName",f),s=()=>lt(En,"$selectedLayoutType",f),i=()=>lt(gt,"$models",f),o=()=>lt(Wo,"$loadedTerrain",f),l=()=>lt(Yn,"$history",f),c=()=>lt(Ju,"$player1Models",f),u=()=>lt(Zu,"$player2Models",f),d=()=>lt(un,"$stagingModels",f),[f,m]=ls(),h=W(),y=W(),v=W(),b=W(),S=W(),R=W(),M=W(),_=W(),A=W(),k=W(),$=W(),w=W();let I=W(1),O=W(null),he=!1,V=null,Z=W(null),ne=W(!1),z=W(!1),J=W(5.5),ie=W(3),le=W(!1),be=W([]),te=[],N=W(null),q=W(!1),j=W(null),F=W(null),H=W([]),$e=W(new Set),Ue=!1,G=!1,oe=null,ke=!1,ce=null,xt=0,ht=null,Ye=W([]),De=W(null),vt=W(!1),Je=W(null),Qe=W(null),U=W(!1);const Se=5,Oe="warhammer-deployment-state";function ct(){const C={deployment:a()?.name||null,layout:r()||null,layoutType:s()||null,models:i()};localStorage.setItem(Oe,JSON.stringify(C))}function tt(){const C=localStorage.getItem(Oe);if(C)try{const P=JSON.parse(C);P.models&&Array.isArray(P.models)&&(gt.set(P.models),Yn.clear())}catch(P){console.error("Failed to restore deployment state:",P)}}function ft(){localStorage.removeItem(Oe),gt.clear()}function At(){const C={version:1,exportedAt:new Date().toISOString(),deployment:a()?{name:a().name,zones:a().zones,objectives:a().objectives}:null,terrain:{layoutName:r(),layoutType:s(),terrains:o().terrains,walls:o().walls},models:i()},P=JSON.stringify(C,null,2),Y=new Blob([P],{type:"application/json"}),ae=URL.createObjectURL(Y),ee=document.createElement("a");ee.href=ae,ee.download=`deployment-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(ee),ee.click(),document.body.removeChild(ee),URL.revokeObjectURL(ae)}let Pt=W(null);function Ct(){e(Pt)?.click()}function kt(C){const P=C.target.files?.[0];if(!P)return;const Y=new FileReader;Y.onload=ae=>{try{const ee=JSON.parse(ae.target.result);Ee(ee)}catch(ee){console.error("Failed to parse import file:",ee),alert("Failed to import: Invalid JSON file")}},Y.readAsText(P),C.target.value=""}function Ee(C){if(!C.version){alert("Invalid import file: missing version");return}if(C.deployment){const P=Oo.find(Y=>Y.name===C.deployment.name);P?Sa.set(P):C.deployment.zones&&C.deployment.objectives&&Sa.set({name:C.deployment.name||"Imported",zones:C.deployment.zones,objectives:C.deployment.objectives})}else Sa.set(null);if(C.terrain){const{layoutName:P,layoutType:Y,terrains:ae,walls:ee}=C.terrain;if(Y==="preset"&&P){if(Xr.find(ue=>ue.name===P))pn.set(P),En.set("preset");else if(ae||ee){const ue=`imported-${Date.now()}`,ge=localStorage.getItem("warhammer-deployment-layouts"),He=ge?JSON.parse(ge):{};He[ue]={terrains:ae||[],walls:ee||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(He)),pn.set(ue),En.set("saved")}}else if(Y==="saved"&&P){const de=localStorage.getItem("warhammer-deployment-layouts"),ue=de?JSON.parse(de):{};ue[P]?(pn.set(P),En.set("saved")):(ae||ee)&&(ue[P]={terrains:ae||[],walls:ee||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(ue)),pn.set(P),En.set("saved"))}else if(ae||ee){const de=`imported-${Date.now()}`,ue=localStorage.getItem("warhammer-deployment-layouts"),ge=ue?JSON.parse(ue):{};ge[de]={terrains:ae||[],walls:ee||[]},localStorage.setItem("warhammer-deployment-layouts",JSON.stringify(ge)),pn.set(de),En.set("saved")}}C.models&&Array.isArray(C.models)&&(gt.set(C.models),Yn.clear()),T(H,[])}async function Fe(C){const{text:P,playerId:Y}=C.detail;try{e(N)&&e(N).setLoading(!0);const{format:ae,data:ee}=await Xm(P),{matched:de,unmatched:ue}=rd(ee,Y),ge=ee.LIST_TITLE||`${ee.FACTION_KEYWORD} Army`;Dr.addImport(ge,P,ee,Y),ue.length>0?(T(be,ue),te=de,T(le,!0),e(N)&&e(N).setLoading(!1)):(Si(de,ee.FACTION_KEYWORD),e(N)&&(e(N).setSuccess(`Imported ${de.length} models from ${ee.FACTION_KEYWORD} (${ae})`),e(N).clearText()))}catch(ae){console.error("Failed to parse army list:",ae),e(N)&&e(N).setError(ae.message||"Failed to parse army list")}}function Ie(C){const{selected:P}=C.detail,Y=[];for(const de of P){const ue=typeof de.quantity=="string"?parseInt(de.quantity.replace(/x/i,""),10)||1:de.quantity||1,ge="unit-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);for(let He=0;He<ue;He++)Y.push({id:"model-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),baseType:de.baseType,playerId:e(I),x:0,y:0,rotation:0,unitId:ge,unitName:de.unitName,imported:!0,inStaging:!0})}const ae=[...te,...Y],ee=Ko(ae);Si(ee,"imported"),e(N)&&(e(N).setSuccess(`Imported ${ae.length} models to staging area`),e(N).clearText()),T(be,[]),te=[]}function ut(C){const{modelIds:P}=C.detail;wm(P,30,22)}function _t(){}cs(()=>{window.addEventListener("keydown",Be)}),So(()=>{window.removeEventListener("keydown",Be)});function Be(C){if(C.target.tagName==="INPUT")return;const P=e(H).length>0;if((C.ctrlKey||C.metaKey)&&C.key==="z"&&!C.shiftKey){C.preventDefault(),gt.undo();return}if((C.ctrlKey||C.metaKey)&&(C.key==="y"||C.shiftKey&&C.key==="z")){C.preventDefault(),gt.redo();return}if(C.key==="1"){C.preventDefault(),T(I,1);return}if(C.key==="2"){C.preventDefault(),T(I,2);return}if(C.key==="l"||C.key==="L"){C.preventDefault(),T(ne,!e(ne));return}if(C.key==="m"||C.key==="M"){C.preventDefault(),T(U,!e(U)),e(U)||(T(vt,!1),T(Je,null),T(Qe,null));return}if(C.key==="Delete"||C.key==="Backspace"){if(C.preventDefault(),e(De)){T(Ye,e(Ye).filter(Y=>Y.id!==e(De))),T(De,null);return}e(H).length>0&&(e(H).forEach(Y=>{gt.remove(Y)}),T(H,[]));return}if(P&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(C.key)){C.preventDefault();const Y=C.shiftKey?.1:1;let ae=0,ee=0;switch(C.key){case"ArrowUp":ee=-Y;break;case"ArrowDown":ee=Y;break;case"ArrowLeft":ae=-Y;break;case"ArrowRight":ae=Y;break}e(H).forEach(de=>{const ue=i().find(ge=>ge.id===de);ue&&gt.updateModel(de,{x:ue.x+ae,y:ue.y+ee},!1)});return}if(C.key==="Escape"){L();return}}function L(C){if(Ue){Ue=!1;return}T(H,[]),T(De,null)}function re(){return"line-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function ve(C,P,Y,ae){return Math.sqrt((Y-C)**2+(ae-P)**2)}function Te(C){if(!e(Z))return;C.preventDefault();const P=e(Z)(C.clientX,C.clientY);T(vt,!0),T(Je,{x:P.x,y:P.y}),T(Qe,{x:P.x,y:P.y}),window.addEventListener("mousemove",xe),window.addEventListener("mouseup",Ke)}function xe(C){if(!e(vt)||!e(Z))return;const P=e(Z)(C.clientX,C.clientY);T(Qe,{x:P.x,y:P.y})}function Ke(C){if(!e(vt))return;if(ve(e(Je).x,e(Je).y,e(Qe).x,e(Qe).y)>.5){const Y={id:re(),x1:e(Je).x,y1:e(Je).y,x2:e(Qe).x,y2:e(Qe).y};T(Ye,[...e(Ye),Y]),T(De,Y.id),T(H,[])}T(vt,!1),T(Je,null),T(Qe,null),window.removeEventListener("mousemove",xe),window.removeEventListener("mouseup",Ke)}function Xe(C,P){P?.stopPropagation(),T(De,C),T(H,[])}let fe=!1,Ne={x:0,y:0},yt=null,Tn=null;function Et(C,P){if(!e(U)||!e(Z))return;P.stopPropagation(),P.preventDefault();const Y=e(Ye).find(ue=>ue.id===C);if(!Y)return;fe=!0,yt=C,Tn=null,T(De,C),T(H,[]);const ae=e(Z)(P.clientX,P.clientY),ee=(Y.x1+Y.x2)/2,de=(Y.y1+Y.y2)/2;Ne={x:ae.x-ee,y:ae.y-de},window.addEventListener("mousemove",Pn),window.addEventListener("mouseup",Jn)}function Nn(C,P,Y){!e(U)||!e(Z)||(Y.stopPropagation(),Y.preventDefault(),fe=!0,yt=C,Tn=P,T(De,C),T(H,[]),window.addEventListener("mousemove",Pn),window.addEventListener("mouseup",Jn))}function Pn(C){if(!fe||!e(Z)||!yt)return;const P=e(Z)(C.clientX,C.clientY);T(Ye,e(Ye).map(Y=>{if(Y.id!==yt)return Y;if(Tn===1)return{...Y,x1:P.x,y1:P.y};if(Tn===2)return{...Y,x2:P.x,y2:P.y};{const ae=P.x-Ne.x,ee=P.y-Ne.y,de=(Y.x1+Y.x2)/2,ue=(Y.y1+Y.y2)/2,ge=ae-de,He=ee-ue;return{...Y,x1:Y.x1+ge,y1:Y.y1+He,x2:Y.x2+ge,y2:Y.y2+He}}}))}function Jn(){fe=!1,yt=null,Tn=null,window.removeEventListener("mousemove",Pn),window.removeEventListener("mouseup",Jn)}function us(){T(Ye,[]),T(De,null)}function ms(C){const P=C.target,Y=P.closest(".model-base"),ae=P.closest(".measurement-line");if(Y||ae||!e(Z))return;if(C.preventDefault(),e(U)){Te(C);return}const ee=e(Z)(C.clientX,C.clientY);T(j,{x:ee.x,y:ee.y}),T(F,{x:ee.x,y:ee.y}),T(q,!0),window.addEventListener("mousemove",Ot),window.addEventListener("mouseup",xn)}function Ot(C){if(!e(q)||!e(Z))return;const P=e(Z)(C.clientX,C.clientY);T(F,{x:P.x,y:P.y});const Y=Math.min(e(j).x,e(F).x),ae=Math.max(e(j).x,e(F).x),ee=Math.min(e(j).y,e(F).y),de=Math.max(e(j).y,e(F).y),ue=new Set;i().forEach(ge=>{ge.x>=Y&&ge.x<=ae&&ge.y>=ee&&ge.y<=de&&ue.add(ge.id)}),T($e,ue)}function xn(C){if(!e(q))return;const P=Math.min(e(j).x,e(F).x),Y=Math.max(e(j).x,e(F).x),ae=Math.min(e(j).y,e(F).y),ee=Math.max(e(j).y,e(F).y),de=Y-P,ue=ee-ae;if(de<.5&&ue<.5)T(H,[]);else{const ge=[];i().forEach(He=>{He.x>=P&&He.x<=Y&&He.y>=ae&&He.y<=ee&&ge.push(He.id)}),T(H,ge),Ue=!0}T(q,!1),T(j,null),T(F,null),e($e).clear(),T($e,e($e)),window.removeEventListener("mousemove",Ot),window.removeEventListener("mouseup",xn)}function hn(C,P){if(!e(Z))return;he=!0,V={x:P.clientX,y:P.clientY};const Y=e(Z)(P.clientX,P.clientY);T(O,{baseType:C.type,x:Y.x,y:Y.y}),window.addEventListener("mousemove",Zn),window.addEventListener("mouseup",_n)}function Zn(C){if(!he||!e(O)||!e(Z))return;const P=e(Z)(C.clientX,C.clientY);T(O,{...e(O),x:P.x,y:P.y})}function _n(C){if(!he||!e(O)){he=!1,T(O,null),V=null,window.removeEventListener("mousemove",Zn),window.removeEventListener("mouseup",_n);return}const P=C.clientX-V.x,Y=C.clientY-V.y,ae=Math.sqrt(P*P+Y*Y);let ee,de;ae<Se?(ee=30,de=22):(ee=e(O).x,de=e(O).y);const ue=e(O).customWidth&&e(O).customHeight?{width:e(O).customWidth,height:e(O).customHeight}:null,ge=gt.add(e(O).baseType,e(I),ee,de,ue);T(H,[ge]),T(O,null),he=!1,V=null,window.removeEventListener("mousemove",Zn),window.removeEventListener("mouseup",_n)}function fa(){const Y={width:e(J),height:e(ie)},ae=gt.add("rect-custom",e(I),30,22,Y);T(H,[ae])}function Na(C,P){P&&(P.ctrlKey||P.metaKey||P.shiftKey)?e(H).includes(C)?T(H,e(H).filter(Y=>Y!==C)):T(H,[...e(H),C]):e(H).includes(C)&&e(H).length>1||T(H,[C])}function Pa(C,P,Y){if(e(H).length>1&&e(H).includes(C)){G||(G=!0,oe={},e(H).forEach(ee=>{const de=i().find(ue=>ue.id===ee);de&&(oe[ee]={x:de.x,y:de.y})}));const ae=oe[C];if(ae){const ee=P-ae.x,de=Y-ae.y;e(H).forEach(ue=>{const ge=oe[ue];ge&&gt.updateModel(ue,{x:ge.x+ee,y:ge.y+de},!0)})}}else gt.updateModel(C,{x:P,y:Y},!0)}function $n(C,P,Y,ae,ee){G?(e(H).forEach(de=>{const ue=oe[de],ge=i().find(He=>He.id===de);ue&&ge&&Yn.push({type:"move",modelId:de,before:{x:ue.x,y:ue.y},after:{x:ge.x,y:ge.y}})}),G=!1,oe=null):Yn.push({type:"move",modelId:C,before:{x:P,y:Y},after:{x:ae,y:ee}})}function Ps(C,P){if(e(H).length>1&&e(H).includes(C)){if(!ke){ke=!0;let de=0,ue=0,ge=0;const He={};e(H).forEach(ot=>{const mt=i().find(dt=>dt.id===ot);mt&&(de+=mt.x,ue+=mt.y,ge++,He[ot]={x:mt.x,y:mt.y,rotation:mt.rotation||0})}),ce={x:de/ge,y:ue/ge},oe=He}const Y=i().find(de=>de.id===C),ae=oe[C];if(!Y||!ae)return;const ee=P-ae.rotation;e(H).forEach(de=>{const ue=oe[de];if(ue){const ge=ue.x-ce.x,He=ue.y-ce.y,ot=ee*Math.PI/180,mt=Math.cos(ot),dt=Math.sin(ot),et=ge*mt-He*dt,bt=ge*dt+He*mt;gt.updateModel(de,{x:ce.x+et,y:ce.y+bt,rotation:ue.rotation+ee},!0)}})}else gt.updateModel(C,{rotation:P},!0)}function cr(C,P,Y){ke?(e(H).forEach(ae=>{const ee=oe[ae],de=i().find(ue=>ue.id===ae);ee&&de&&Yn.push({type:"rotate",modelId:ae,before:{x:ee.x,y:ee.y,rotation:ee.rotation},after:{x:de.x,y:de.y,rotation:de.rotation||0}})}),ke=!1,ce=null,oe=null):Yn.push({type:"rotate",modelId:C,before:{rotation:P},after:{rotation:Y}})}function $s(C,P){gt.updateModel(C,{name:P})}function ur(C){if(!e(Z)||e(h).length<2)return;C.preventDefault(),C.stopPropagation(),ke=!0,ht={},e(h).forEach(Y=>{ht[Y.id]={x:Y.x,y:Y.y,rotation:Y.rotation||0}});const P=e(Z)(C.clientX,C.clientY);xt=Math.atan2(P.y-e(v).y,P.x-e(v).x)*180/Math.PI,window.addEventListener("mousemove",ds),window.addEventListener("mouseup",Vt)}function ds(C){if(!ke||!e(Z)||!e(v))return;const P=e(Z)(C.clientX,C.clientY);let ae=Math.atan2(P.y-e(v).y,P.x-e(v).x)*180/Math.PI-xt;C.shiftKey||(ae=Math.round(ae/15)*15),T(an,-45+ae);const ee=ae*Math.PI/180,de=Math.cos(ee),ue=Math.sin(ee);e(h).forEach(ge=>{const He=ht[ge.id];if(He){const ot=He.x-e(v).x,mt=He.y-e(v).y,dt=ot*de-mt*ue,et=ot*ue+mt*de;gt.updateModel(ge.id,{x:e(v).x+dt,y:e(v).y+et,rotation:He.rotation+ae},!0)}})}function Vt(){ke&&ht&&e(h).forEach(C=>{const P=ht[C.id];P&&Yn.push({type:"rotate",modelId:C.id,before:{x:P.x,y:P.y,rotation:P.rotation},after:{x:C.x,y:C.y,rotation:C.rotation||0}})}),ke=!1,ht=null,T(an,-45),window.removeEventListener("mousemove",ds),window.removeEventListener("mouseup",Vt)}function ea(){e(H).length>0&&(e(H).forEach(C=>{gt.remove(C)}),T(H,[]))}function $a(){confirm("Clear all models?")&&(gt.clear(),T(H,[]))}function ya(C){if(nr(C.baseType))return{x:C.x,y:C.y,width:C.customWidth,height:C.customHeight,rotation:C.rotation||0,isRectangle:!0};const P=ja(C.baseType,C);return Ta(C.baseType)?{x:C.x,y:C.y,rx:P.width/2,ry:P.height/2,rotation:C.rotation||0}:{x:C.x,y:C.y,radius:P.radius}}let an=W(-45);me(()=>(e(H),i()),()=>{T(h,e(H).map(C=>i().find(P=>P.id===C)).filter(Boolean))}),me(()=>e(h),()=>{T(y,e(h).length===1?e(h)[0]:null)}),me(()=>e(h),()=>{T(v,e(h).length>1?(()=>{let C=0,P=0;return e(h).forEach(Y=>{C+=Y.x,P+=Y.y}),{x:C/e(h).length,y:P/e(h).length}})():null)}),me(()=>(e(h),e(v),Ta),()=>{T(b,e(h).length>1?(()=>{let C=0;return e(h).forEach(P=>{const Y=Math.sqrt(Math.pow(P.x-e(v).x,2)+Math.pow(P.y-e(v).y,2)),ae=ja(P.baseType,P),ee=nr(P.baseType)?Math.max(P.customWidth,P.customHeight)/2:Ta(P.baseType)?Math.max(ae.width,ae.height)/2:ae.radius;C=Math.max(C,Y+ee)}),C+2})():0)}),me(()=>(e(v),e(b),e(an)),()=>{T(S,e(v)?e(v).x+e(b)*Math.cos(e(an)*Math.PI/180):0)}),me(()=>(e(v),e(b),e(an)),()=>{T(R,e(v)?e(v).y+e(b)*Math.sin(e(an)*Math.PI/180):0)}),me(()=>(e(De),e(Ye)),()=>{T(M,e(De)?e(Ye).find(C=>C.id===e(De)):null)}),me(()=>e(h),()=>{T(_,[...new Set(e(h).map(C=>C.playerId))])}),me(()=>(e(h),i(),e(_)),()=>{T(A,e(h).length>0?i().filter(C=>!e(_).includes(C.playerId)):[])}),me(()=>(o(),Ms),()=>{T(k,o().terrains.map(C=>({id:C.id,vertices:Ms(C)})))}),me(()=>(o(),ns),()=>{T($,o().walls.map(C=>jr(ns(C.shape,C.segments),C.x,C.y,C.rotation)))}),me(()=>(e(h),e(ne),e(A),e(k),e($)),()=>{T(w,e(h).length>0&&e(ne)&&e(A).length>0?e(h).flatMap(C=>e(A).map(P=>{const Y=Co(ya(C),ya(P),e(k),e($));return{sourceId:C.id,source:C,targetId:P.id,target:P,canSee:Y.canSee,firstClearRay:Y.firstClearRay,rays:Y.rays}})):[])}),In(),jt();var ta=qd(),On=Re(ta),Os=x(E(On),2),hs=E(Os),fs=E(hs);Dt(fs,{title:"Selected Model",children:(C,P)=>{var Y=wt(),ae=Re(Y);{var ee=ue=>{var ge=fd(),He=E(ge),ot=x(E(He),2),mt=E(ot),dt=x(He,2),et=E(dt),bt=E(et),Mt=x(dt,2);{var fn=Wt=>{var Oa=hd(),pa=Re(Oa),Wa=E(pa),Ya=E(Wa),ps=x(pa,2);{var Ha=Wn=>{var Me=dd(),B=x(E(Me),2),st=E(B);X(Ze=>we(st,`${Ze??""}/${e(w),p(()=>e(w).length)??""} rays visible`),[()=>(e(w),p(()=>e(w).filter(Ze=>Ze.canSee).length))]),D(Wn,Me)};pe(ps,Wn=>{e(w),p(()=>e(w).length>0)&&Wn(Ha)})}ba(Ya,()=>e(z),Wn=>T(z,Wn)),D(Wt,Oa)};pe(Mt,Wt=>{e(ne)&&Wt(fn)})}var Sn=x(Mt,2),wn=E(Sn);X(()=>{we(mt,`${e(H),p(()=>e(H).length)??""} models`),we(wn,`Remove All (${e(H),p(()=>e(H).length)??""})`)}),ba(bt,()=>e(ne),Wt=>T(ne,Wt)),K("click",Sn,ea),D(ue,ge)},de=ue=>{var ge=wt(),He=Re(ge);{var ot=dt=>{var et=gd(),bt=E(et),Mt=x(E(bt),2),fn=x(bt,2),Sn=x(E(fn),2),wn=E(Sn),Wt=x(fn,2),Oa=x(E(Wt),2),pa=E(Oa),Wa=x(Wt,2),Ya=x(E(Wa),2),ps=E(Ya),Ha=x(Wa,2);{var Wn=Pe=>{var je=yd(),nt=x(E(je),2),Yt=E(nt);X(sn=>we(Yt,`${sn??""}Â°`),[()=>(e(y),p(()=>Math.round(e(y).rotation||0)))]),D(Pe,je)};pe(Ha,Pe=>{se(Ta),e(y),p(()=>Ta(e(y).baseType))&&Pe(Wn)})}var Me=x(Ha,2),B=E(Me),st=E(B),Ze=x(Me,2);{var qe=Pe=>{var je=pd(),nt=E(je),Yt=E(nt);ba(Yt,()=>e(z),sn=>T(z,sn)),D(Pe,je)};pe(Ze,Pe=>{e(ne)&&Pe(qe)})}var Ae=x(Ze,2);{var St=Pe=>{var je=vd(),nt=x(E(je),2),Yt=E(nt);X(sn=>we(Yt,`${sn??""}/${e(w),p(()=>e(w).length)??""} visible`),[()=>(e(w),p(()=>e(w).filter(sn=>sn.canSee).length))]),D(Pe,je)};pe(Ae,Pe=>{e(ne),e(w),p(()=>e(ne)&&e(w).length>0)&&Pe(St)})}var $t=x(Ae,2);X((Pe,je,nt)=>{Ac(Mt,(e(y),p(()=>e(y).name||""))),we(wn,Pe),we(pa,`Player ${e(y),p(()=>e(y).playerId)??""}`),we(ps,`${je??""}", ${nt??""}"`)},[()=>(se(ja),e(y),p(()=>ja(e(y).baseType,e(y))?.label||"Unknown")),()=>(e(y),p(()=>e(y).x.toFixed(1))),()=>(e(y),p(()=>e(y).y.toFixed(1)))]),K("change",Mt,Pe=>$s(e(y).id,Pe.target.value)),ba(st,()=>e(ne),Pe=>T(ne,Pe)),K("click",$t,ea),D(dt,et)},mt=dt=>{var et=bd();D(dt,et)};pe(He,dt=>{e(y)?dt(ot):dt(mt,!1)},!0)}D(ue,ge)};pe(ae,ue=>{e(H),p(()=>e(H).length>1)?ue(ee):ue(de,!1)})}D(C,Y)},$$slots:{default:!0}});var Ws=x(fs,2);Dt(Ws,{title:"Measure Tool",children:(C,P)=>{var Y=Sd(),ae=E(Y),ee=E(ae),de=E(ee),ue=x(ae,2);{var ge=et=>{var bt=Td();D(et,bt)};pe(ue,et=>{e(U)&&et(ge)})}var He=x(ue,2);{var ot=et=>{var bt=xd(),Mt=Re(bt),fn=x(E(Mt),2),Sn=E(fn),wn=x(Mt,2);X(Wt=>we(Sn,`${Wt??""}"`),[()=>(e(M),p(()=>ve(e(M).x1,e(M).y1,e(M).x2,e(M).y2).toFixed(2)))]),K("click",wn,()=>{T(Ye,e(Ye).filter(Wt=>Wt.id!==e(De))),T(De,null)}),D(et,bt)};pe(He,et=>{e(M)&&et(ot)})}var mt=x(He,2);{var dt=et=>{var bt=_d(),Mt=Re(bt),fn=x(E(Mt),2),Sn=E(fn),wn=x(Mt,2);X(()=>we(Sn,`${e(Ye),p(()=>e(Ye).length)??""} line${e(Ye),p(()=>e(Ye).length!==1?"s":"")??""}`)),K("click",wn,us),D(et,bt)};pe(mt,et=>{e(Ye),p(()=>e(Ye).length>0)&&et(dt)})}ba(de,()=>e(U),et=>T(U,et)),D(C,Y)},$$slots:{default:!0}});var ys=x(Ws,2);Dt(ys,{title:"Actions",children:(C,P)=>{var Y=wd(),ae=E(Y),ee=E(ae),de=x(ee,2),ue=x(ae,2),ge=E(ue),He=x(ge,2),ot=x(ue,2);Es(ot,Mt=>T(Pt,Mt),()=>e(Pt));var mt=x(ot,2),dt=x(mt,2),et=x(dt,2),bt=x(et,2);X(()=>{ee.disabled=(l(),p(()=>!l().past.length)),de.disabled=(l(),p(()=>!l().future.length))}),K("click",ee,()=>gt.undo()),K("click",de,()=>gt.redo()),K("click",ge,At),K("click",He,Ct),K("change",ot,kt),K("click",mt,ct),K("click",dt,tt),K("click",et,$a),K("click",bt,ft),D(C,Y)},$$slots:{default:!0}});var na=x(ys,2);Dt(na,{title:"Import Army List",startOpen:!1,children:(C,P)=>{Es(gm(C,{get currentPlayer(){return e(I)},$$events:{parse:Fe},$$legacy:!0}),Y=>T(N,Y),()=>e(N))},$$slots:{default:!0}});var Jr=x(na,2);Dt(Jr,{title:"Add Models",children:(C,P)=>{var Y=Ad(),ae=Re(Y),ee=E(ae);let de;var ue=x(ee,2);let ge;var He=x(ae,2),ot=E(He),mt=x(E(ot),2);Le(mt,5,()=>(se(en),p(()=>en.circles)),ze,(bt,Mt)=>{ar(bt,{get baseSize(){return e(Mt)},get playerId(){return e(I)},onDragStart:hn})});var dt=x(ot,2),et=x(E(dt),2);Le(et,5,()=>(se(en),p(()=>en.ovals)),ze,(bt,Mt)=>{ar(bt,{get baseSize(){return e(Mt)},get playerId(){return e(I)},onDragStart:hn})}),X(()=>{de=dn(ee,1,"toggle-btn svelte-1g40uyy",null,de,{active:e(I)===1}),ge=dn(ue,1,"toggle-btn svelte-1g40uyy",null,ge,{active:e(I)===2})}),K("click",ee,()=>T(I,1)),K("click",ue,()=>T(I,2)),D(C,Y)},$$slots:{default:!0}});var zo=x(Jr,2);Dt(zo,{title:"Add Hull (Vehicle)",children:(C,P)=>{var Y=Cd(),ae=E(Y),ee=x(E(ae),2),de=x(ae,2),ue=x(E(de),2),ge=x(de,2),He=E(ge);X(()=>we(He,`Add ${e(J)??""}" Ã ${e(ie)??""}" Hull`)),Ht(ee,()=>e(J),ot=>T(J,ot)),Ht(ue,()=>e(ie),ot=>T(ie,ot)),K("click",ge,fa),D(C,Y)},$$slots:{default:!0}});var Xo=x(hs,2),Zr=E(Xo),mr=E(Zr),jo=E(mr);lr(jo,{children:Wr,$$slots:{default:(C,P)=>{const Y=Ge(()=>P.screenToSvg);var ae=Fd(),ee=Re(ae);{var de=Me=>{var B=go();X(()=>we(B,(e(Z),se(e(Y)),p(()=>(T(Z,e(Y)),""))))),D(Me,B)};pe(ee,Me=>{e(Y)&&!e(Z)&&Me(de)})}var ue=x(ee);{var ge=Me=>{var B=Rd(),st=Re(B);Le(st,1,()=>(a(),p(()=>a().zones)),ze,(qe,Ae)=>{var St=Ed();X($t=>{g(St,"d",$t),g(St,"fill",(e(Ae),p(()=>e(Ae).color))),g(St,"stroke",(e(Ae),p(()=>e(Ae).borderColor)))},[()=>(se(kr),e(Ae),p(()=>kr(e(Ae).path)))]),D(qe,St)});var Ze=x(st);Le(Ze,1,()=>(a(),p(()=>a().objectives)),ze,(qe,Ae)=>{const St=Ge(()=>(e(Ae),p(()=>e(Ae).isPrimary?"#fbbf24":"#9ca3af"))),$t=Ge(()=>(e(Ae),p(()=>e(Ae).isPrimary?"rgba(251, 191, 36, 0.15)":"rgba(156, 163, 175, 0.15)")));var Pe=Md(),je=Re(Pe),nt=x(je),Yt=x(nt);X(()=>{g(je,"cx",(e(Ae),p(()=>e(Ae).x))),g(je,"cy",(e(Ae),p(()=>e(Ae).y))),g(je,"r",Po),g(je,"fill",e($t)),g(je,"stroke",e(St)),g(nt,"cx",(e(Ae),p(()=>e(Ae).x))),g(nt,"cy",(e(Ae),p(()=>e(Ae).y))),g(nt,"r",No),g(nt,"fill",e(St)),g(Yt,"cx",(e(Ae),p(()=>e(Ae).x))),g(Yt,"cy",(e(Ae),p(()=>e(Ae).y)))}),D(qe,Pe)}),D(Me,B)};pe(ue,Me=>{a()&&Me(ge)})}var He=x(ue);pe(He,Me=>{});var ot=x(He);pe(ot,Me=>{});var mt=x(ot);Le(mt,1,()=>(o(),p(()=>o().terrains)),ze,(Me,B)=>{var st=kd(),Ze=E(st);X(()=>{g(st,"transform",`rotate(${e(B),p(()=>e(B).rotation)??""}, ${e(B),p(()=>e(B).x+e(B).width/2)??""}, ${e(B),p(()=>e(B).y+e(B).height/2)??""})`),g(Ze,"x",(e(B),p(()=>e(B).x))),g(Ze,"y",(e(B),p(()=>e(B).y))),g(Ze,"width",(e(B),p(()=>e(B).width))),g(Ze,"height",(e(B),p(()=>e(B).height)))}),D(Me,st)});var dt=x(mt);Le(dt,1,()=>(o(),p(()=>o().walls)),ze,(Me,B)=>{var st=Ld(),Ze=E(st);Qr(Ze,{get id(){return e(B),p(()=>e(B).id)},get x(){return e(B),p(()=>e(B).x)},get y(){return e(B),p(()=>e(B).y)},get shape(){return e(B),p(()=>e(B).shape)},get segments(){return e(B),p(()=>e(B).segments)},get rotation(){return e(B),p(()=>e(B).rotation)},selected:!1,get screenToSvg(){return e(Y)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}}),D(Me,st)});var et=x(dt);Le(et,1,i,Me=>Me.id,(Me,B)=>{{let st=Ge(()=>(e(B),p(()=>e(B).name||""))),Ze=Ge(()=>(e(H),e(B),p(()=>e(H).includes(e(B).id)))),qe=Ge(()=>(e(H),e(B),e($e),p(()=>!e(H).includes(e(B).id)&&e($e).has(e(B).id))));Rs(Me,{get id(){return e(B),p(()=>e(B).id)},get x(){return e(B),p(()=>e(B).x)},get y(){return e(B),p(()=>e(B).y)},get baseType(){return e(B),p(()=>e(B).baseType)},get playerId(){return e(B),p(()=>e(B).playerId)},get rotation(){return e(B),p(()=>e(B).rotation)},get name(){return e(st)},get customWidth(){return e(B),p(()=>e(B).customWidth)},get customHeight(){return e(B),p(()=>e(B).customHeight)},get selected(){return e(Ze)},get marqueePreview(){return e(qe)},get screenToSvg(){return e(Y)},onSelect:Na,onDrag:Pa,onDragEnd:$n,onRotate:Ps,onRotateEnd:cr,onRename:$s})}});var bt=x(et);{var Mt=Me=>{Rs(Me,{id:"phantom",get x(){return e(O),p(()=>e(O).x)},get y(){return e(O),p(()=>e(O).y)},get baseType(){return e(O),p(()=>e(O).baseType)},get playerId(){return e(I)},rotation:0,get customWidth(){return e(O),p(()=>e(O).customWidth)},get customHeight(){return e(O),p(()=>e(O).customHeight)},selected:!1,get screenToSvg(){return e(Y)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};pe(bt,Me=>{e(O)&&Me(Mt)})}var fn=x(bt);{var Sn=Me=>{var B=Dd(),st=Re(B),Ze=x(st),qe=x(Ze),Ae=x(qe);X(()=>{g(st,"cx",(e(v),p(()=>e(v).x))),g(st,"cy",(e(v),p(()=>e(v).y))),g(Ze,"x1",(e(v),p(()=>e(v).x))),g(Ze,"y1",(e(v),p(()=>e(v).y))),g(Ze,"x2",e(S)),g(Ze,"y2",e(R)),g(qe,"cx",e(S)),g(qe,"cy",e(R)),g(Ae,"transform",`translate(${e(S)??""}, ${e(R)??""})`)}),K("mousedown",qe,ur),D(Me,B)};pe(fn,Me=>{e(v),e(h),p(()=>e(v)&&e(h).length>1)&&Me(Sn)})}var wn=x(fn);Le(wn,1,()=>e(Ye),Me=>Me.id,(Me,B)=>{const st=Ge(()=>(e(B),p(()=>ve(e(B).x1,e(B).y1,e(B).x2,e(B).y2)))),Ze=Ge(()=>(e(B),p(()=>(e(B).x1+e(B).x2)/2))),qe=Ge(()=>(e(B),p(()=>(e(B).y1+e(B).y2)/2))),Ae=Ge(()=>(e(B),e(De),p(()=>e(B).id===e(De))));var St=Nd();let $t;var Pe=E(St),je=x(Pe);{var nt=rn=>{var ei=Id(),vs=Re(ei),Ys=x(vs);X(()=>{g(vs,"cx",(e(B),p(()=>e(B).x1))),g(vs,"cy",(e(B),p(()=>e(B).y1))),g(vs,"fill",e(Ae)?"#3b82f6":"#f59e0b"),g(Ys,"cx",(e(B),p(()=>e(B).x2))),g(Ys,"cy",(e(B),p(()=>e(B).y2))),g(Ys,"fill",e(Ae)?"#3b82f6":"#f59e0b")}),K("mousedown",vs,hr=>Nn(e(B).id,1,hr)),K("mousedown",Ys,hr=>Nn(e(B).id,2,hr)),D(rn,ei)};pe(je,rn=>{e(U)&&rn(nt)})}var Yt=x(je),sn=x(E(Yt)),dr=E(sn);X(rn=>{$t=dn(St,0,"measurement-line",null,$t,{selected:e(Ae),"tool-active":e(U)}),g(Pe,"x1",(e(B),p(()=>e(B).x1))),g(Pe,"y1",(e(B),p(()=>e(B).y1))),g(Pe,"x2",(e(B),p(()=>e(B).x2))),g(Pe,"y2",(e(B),p(()=>e(B).y2))),g(Pe,"stroke",e(Ae)&&e(U)?"#3b82f6":"#f59e0b"),g(Pe,"stroke-width",e(Ae)&&e(U)?.2:.15),g(Pe,"role",e(U)?"button":"presentation"),g(Pe,"tabindex",e(U)?0:-1),g(Yt,"transform",`translate(${e(Ze)??""}, ${e(qe)??""})`),g(sn,"fill",e(Ae)&&e(U)?"#3b82f6":"#f59e0b"),we(dr,`${rn??""}"`)},[()=>(se(e(st)),p(()=>e(st).toFixed(1)))]),K("click",Pe,rn=>e(U)&&Xe(e(B).id,rn)),K("mousedown",Pe,rn=>e(U)?Et(e(B).id,rn):rn.stopPropagation()),D(Me,St)});var Wt=x(wn);{var Oa=Me=>{const B=Ge(()=>(e(Je),e(Qe),p(()=>ve(e(Je).x,e(Je).y,e(Qe).x,e(Qe).y)))),st=Ge(()=>(e(Je),e(Qe),p(()=>(e(Je).x+e(Qe).x)/2))),Ze=Ge(()=>(e(Je),e(Qe),p(()=>(e(Je).y+e(Qe).y)/2)));var qe=$d(),Ae=E(qe),St=x(Ae),$t=x(St),Pe=x($t);{var je=nt=>{var Yt=Pd(),sn=x(E(Yt)),dr=E(sn);X(rn=>{g(Yt,"transform",`translate(${e(st)??""}, ${e(Ze)??""})`),we(dr,`${rn??""}"`)},[()=>(se(e(B)),p(()=>e(B).toFixed(1)))]),D(nt,Yt)};pe(Pe,nt=>{e(B)>.5&&nt(je)})}X(()=>{g(Ae,"x1",(e(Je),p(()=>e(Je).x))),g(Ae,"y1",(e(Je),p(()=>e(Je).y))),g(Ae,"x2",(e(Qe),p(()=>e(Qe).x))),g(Ae,"y2",(e(Qe),p(()=>e(Qe).y))),g(St,"cx",(e(Je),p(()=>e(Je).x))),g(St,"cy",(e(Je),p(()=>e(Je).y))),g($t,"cx",(e(Qe),p(()=>e(Qe).x))),g($t,"cy",(e(Qe),p(()=>e(Qe).y)))}),D(Me,qe)};pe(Wt,Me=>{e(vt)&&e(Je)&&e(Qe)&&Me(Oa)})}var pa=x(Wt);{var Wa=Me=>{var B=wt(),st=Re(B);Le(st,1,()=>e(w),ze,(Ze,qe)=>{var Ae=wt(),St=Re(Ae);Le(St,1,()=>(e(qe),p(()=>e(qe).rays)),ze,($t,Pe)=>{var je=Od();X(()=>{g(je,"x1",(e(Pe),p(()=>e(Pe).from.x))),g(je,"y1",(e(Pe),p(()=>e(Pe).from.y))),g(je,"x2",(e(Pe),p(()=>e(Pe).to.x))),g(je,"y2",(e(Pe),p(()=>e(Pe).to.y))),g(je,"stroke",(e(Pe),p(()=>e(Pe).blocked?"#ff000033":"#00ff0033")))}),D($t,je)}),D(Ze,Ae)}),D(Me,B)};pe(pa,Me=>{e(z),e(ne),e(h),e(w),p(()=>e(z)&&e(ne)&&e(h).length>0&&e(w).length>0)&&Me(Wa)})}var Ya=x(pa);{var ps=Me=>{var B=wt(),st=Re(B);Le(st,1,()=>e(w),ze,(Ze,qe)=>{var Ae=wt(),St=Re(Ae);{var $t=je=>{var nt=Wd();X(()=>{g(nt,"x1",(e(qe),p(()=>e(qe).firstClearRay.from.x))),g(nt,"y1",(e(qe),p(()=>e(qe).firstClearRay.from.y))),g(nt,"x2",(e(qe),p(()=>e(qe).firstClearRay.to.x))),g(nt,"y2",(e(qe),p(()=>e(qe).firstClearRay.to.y)))}),D(je,nt)},Pe=je=>{var nt=Yd();X(()=>{g(nt,"x1",(e(qe),p(()=>e(qe).source.x))),g(nt,"y1",(e(qe),p(()=>e(qe).source.y))),g(nt,"x2",(e(qe),p(()=>e(qe).target.x))),g(nt,"y2",(e(qe),p(()=>e(qe).target.y)))}),D(je,nt)};pe(St,je=>{e(qe),p(()=>e(qe).firstClearRay)?je($t):je(Pe,!1)})}D(Ze,Ae)}),D(Me,B)};pe(Ya,Me=>{e(ne),e(h),e(w),p(()=>e(ne)&&e(h).length>0&&e(w).length>0)&&Me(ps)})}var Ha=x(Ya);{var Wn=Me=>{const B=Ge(()=>(e(j),e(F),p(()=>Math.min(e(j).x,e(F).x)))),st=Ge(()=>(e(j),e(F),p(()=>Math.min(e(j).y,e(F).y)))),Ze=Ge(()=>(e(F),e(j),p(()=>Math.abs(e(F).x-e(j).x)))),qe=Ge(()=>(e(F),e(j),p(()=>Math.abs(e(F).y-e(j).y))));var Ae=Hd();X(()=>{g(Ae,"x",e(B)),g(Ae,"y",e(st)),g(Ae,"width",e(Ze)),g(Ae,"height",e(qe))}),D(Me,Ae)};pe(Ha,Me=>{e(q)&&e(j)&&e(F)&&Me(Wn)})}D(C,ae)}}});var Vo=x(mr,2),Qo=E(Vo),Jo=E(Qo),Zo=x(Zr,2);{var el=C=>{var P=Bd(),Y=E(P);Nm(Y,{$$events:{deploy:ut,clear:_t}}),D(C,P)};pe(Zo,C=>{d(),p(()=>d().length>0)&&C(el)})}var tl=x(On,2);_m(tl,{get unmatchedUnits(){return e(be)},get show(){return e(le)},set show(C){T(le,C)},$$events:{import:Ie,close:()=>{T(le,!1)}},$$legacy:!0}),X(()=>we(Jo,`Battlefield: 60" x 44" | ${c(),p(()=>c().length)??""} P1 models | ${u(),p(()=>u().length)??""} P2 models`)),K("mousedown",mr,ms),D(t,ta),Kt(),m()}var Kd=ye("<span> </span>"),Gd=ye('<span class="los-status svelte-12aohay">No enemies</span>'),zd=ye('<div class="controls svelte-12aohay"><label class="svelte-12aohay"><input type="checkbox" class="svelte-12aohay"/> Show debug rays</label> <!></div>'),Xd=ye('<button class="svelte-12aohay"> </button>'),jd=ye('<div class="button-group svelte-12aohay"></div>'),Vd=ye('<button class="svelte-12aohay"> </button>'),Qd=ye('<div class="button-group svelte-12aohay"></div>'),Jd=ye('<div class="player-toggle svelte-12aohay"><button>Player 1</button> <button>Player 2</button></div> <div class="base-palette svelte-12aohay"><div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Circles</h4> <div class="palette-grid svelte-12aohay"></div></div> <div class="palette-section svelte-12aohay"><h4 class="svelte-12aohay">Ovals</h4> <div class="palette-grid svelte-12aohay"></div></div></div>',1),Zd=_e('<line stroke-width="0.05"></line>'),eh=_e('<line stroke="#22c55e" stroke-width="0.15" opacity="0.7" pointer-events="none"></line>'),th=_e('<line stroke="#ef4444" stroke-width="0.1" stroke-dasharray="0.5 0.25" opacity="0.7" pointer-events="none"></line>'),nh=_e("<!><!><!><!><!><!><!>",1),ah=ye('<p class="svelte-12aohay"> </p>'),sh=ye('<main class="svelte-12aohay"><div class="header svelte-12aohay"><h1 class="svelte-12aohay">Debug Mode</h1> <nav class="nav-links svelte-12aohay"><a href="#/setup" class="svelte-12aohay">Battlefield Setup</a> <a href="#/deployment" class="svelte-12aohay">Deployment</a> <a href="#/" class="svelte-12aohay">Layout Builder</a> <a href="#/debug" class="active svelte-12aohay">Debug Mode</a></nav></div> <div class="layout svelte-12aohay"><div class="sidebar svelte-12aohay"><!> <!> <!> <!></div> <div class="battlefield-area svelte-12aohay"><div class="battlefield-container svelte-12aohay"><!></div> <div class="info svelte-12aohay"><p class="svelte-12aohay"> </p> <!> <p class="hint svelte-12aohay">Scroll to zoom | Space+drag to pan | Double-click to reset view</p></div></div></div></main>');function rh(t,n){Ut(n,!1);const a=()=>lt(ra,"$debugModels",u),r=()=>lt(ga,"$debugSelectedModelId",u),s=()=>lt(Us,"$debugTerrains",u),i=()=>lt(Ks,"$debugWalls",u),o=()=>lt(xi,"$debugMode",u),l=()=>lt(Gs,"$debugSelectedTerrainId",u),c=()=>lt(zs,"$debugSelectedWallId",u),[u,d]=ls(),f=W(),m=W(),h=W(),y=W(),v=W();function b(U,Se){Us.add(U,Se)}function S(U){Ks.add(U)}function R(U){Gs.set(U),zs.set(null),ga.set(null)}function M(U){zs.set(U),Gs.set(null),ga.set(null)}function _(U,Se,Oe){Us.updateTerrain(U,{x:Se,y:Oe})}function A(U,Se,Oe){Ks.updateWall(U,{x:Se,y:Oe})}function k(U,Se){Us.updateTerrain(U,{rotation:Se})}function $(U,Se){Ks.updateWall(U,{rotation:Se})}let w=W(1),I=W(null),O=!1,he=null,V=W(null);const Z=5;cs(()=>{if(a().length===0){const U=ra.add("32mm",1,10,22);ra.add("32mm",2,50,22),ga.set(U)}});function ne(U,Se){if(!e(V))return;O=!0,he={x:Se.clientX,y:Se.clientY};const Oe=e(V)(Se.clientX,Se.clientY);T(I,{baseType:U.type,x:Oe.x,y:Oe.y}),window.addEventListener("mousemove",z),window.addEventListener("mouseup",J)}function z(U){if(!O||!e(I)||!e(V))return;const Se=e(V)(U.clientX,U.clientY);T(I,{...e(I),x:Se.x,y:Se.y})}function J(U){if(!O||!e(I)){O=!1,T(I,null),he=null,window.removeEventListener("mousemove",z),window.removeEventListener("mouseup",J);return}const Se=U.clientX-he.x,Oe=U.clientY-he.y,ct=Math.sqrt(Se*Se+Oe*Oe);let tt,ft;ct<Z?(tt=30,ft=22):(tt=e(I).x,ft=e(I).y);const At=ra.add(e(I).baseType,e(w),tt,ft);ga.set(At),T(I,null),O=!1,he=null,window.removeEventListener("mousemove",z),window.removeEventListener("mouseup",J)}function ie(U){ga.set(U),Gs.set(null),zs.set(null)}function le(U,Se,Oe){ra.updateModel(U,{x:Se,y:Oe},!0)}function be(U,Se,Oe,ct,tt){Lr.push({type:"move",modelId:U,before:{x:Se,y:Oe},after:{x:ct,y:tt}})}function te(U,Se){ra.updateModel(U,{rotation:Se},!0)}function N(U,Se,Oe){Lr.push({type:"rotate",modelId:U,before:{rotation:Se},after:{rotation:Oe}})}function q(U,Se){ra.updateModel(U,{name:Se})}function j(U){const Se=ja(U.baseType);return Ta(U.baseType)?{x:U.x,y:U.y,rx:Se.width/2,ry:Se.height/2,rotation:U.rotation||0}:{x:U.x,y:U.y,radius:Se.radius}}me(()=>(a(),r()),()=>{T(f,a().find(U=>U.id===r()))}),me(()=>(e(f),a()),()=>{T(m,e(f)?a().filter(U=>U.playerId!==e(f).playerId):[])}),me(()=>(s(),Ms),()=>{T(h,s().map(U=>({id:U.id,vertices:Ms(U)})))}),me(()=>(i(),ns),()=>{T(y,i().map(U=>jr(ns(U.shape,U.segments),U.x,U.y,U.rotation)))}),me(()=>(e(f),e(m),e(h),e(y)),()=>{T(v,e(f)&&e(m).length>0?e(m).map(U=>{const Se=Co(j(e(f)),j(U),e(h),e(y));return{targetId:U.id,target:U,canSee:Se.canSee,firstClearRay:Se.firstClearRay,rays:Se.rays}}):[])}),In(),jt();var F=sh(),H=x(E(F),2),$e=E(H),Ue=E($e);Dt(Ue,{title:"LOS Debug",children:(U,Se)=>{var Oe=zd(),ct=E(Oe),tt=E(ct),ft=x(ct,2);{var At=Ct=>{var kt=Kd();let Ee;var Fe=E(kt);X((Ie,ut)=>{Ee=dn(kt,1,"los-status svelte-12aohay",null,Ee,Ie),we(Fe,`${ut??""}/${e(v),p(()=>e(v).length)??""} visible`)},[()=>({"can-see":e(v).some(Ie=>Ie.canSee),blocked:!e(v).some(Ie=>Ie.canSee)}),()=>(e(v),p(()=>e(v).filter(Ie=>Ie.canSee).length))]),D(Ct,kt)},Pt=Ct=>{var kt=Gd();D(Ct,kt)};pe(ft,Ct=>{e(f),e(v),p(()=>e(f)&&e(v).length>0)?Ct(At):Ct(Pt,!1)})}ba(tt,o,Ct=>Mc(xi,Ct)),D(U,Oe)},$$slots:{default:!0}});var G=x(Ue,2);Dt(G,{title:"Add Terrain",defaultOpen:!1,children:(U,Se)=>{var Oe=jd();Le(Oe,5,()=>ko,ze,(ct,tt)=>{var ft=Xd(),At=E(ft);X(()=>we(At,(e(tt),p(()=>e(tt).label)))),K("click",ft,()=>b(e(tt).width,e(tt).height)),D(ct,ft)}),D(U,Oe)},$$slots:{default:!0}});var oe=x(G,2);Dt(oe,{title:"Add Wall",defaultOpen:!1,children:(U,Se)=>{var Oe=Qd();Le(Oe,5,()=>Mr,ze,(ct,tt)=>{var ft=Vd(),At=E(ft);X(()=>we(At,(e(tt),p(()=>e(tt).label)))),K("click",ft,()=>S(e(tt).shape)),D(ct,ft)}),D(U,Oe)},$$slots:{default:!0}});var ke=x(oe,2);Dt(ke,{title:"Add Models",defaultOpen:!1,children:(U,Se)=>{var Oe=Jd(),ct=Re(Oe),tt=E(ct);let ft;var At=x(tt,2);let Pt;var Ct=x(ct,2),kt=E(Ct),Ee=x(E(kt),2);Le(Ee,5,()=>(se(en),p(()=>en.circles)),ze,(ut,_t)=>{ar(ut,{get baseSize(){return e(_t)},get playerId(){return e(w)},onDragStart:ne})});var Fe=x(kt,2),Ie=x(E(Fe),2);Le(Ie,5,()=>(se(en),p(()=>en.ovals)),ze,(ut,_t)=>{ar(ut,{get baseSize(){return e(_t)},get playerId(){return e(w)},onDragStart:ne})}),X(()=>{ft=dn(tt,1,"toggle-btn svelte-12aohay",null,ft,{active:e(w)===1}),Pt=dn(At,1,"toggle-btn svelte-12aohay",null,Pt,{active:e(w)===2})}),K("click",tt,()=>T(w,1)),K("click",At,()=>T(w,2)),D(U,Oe)},$$slots:{default:!0}});var ce=x($e,2),xt=E(ce),ht=E(xt);lr(ht,{children:Wr,$$slots:{default:(U,Se)=>{const Oe=Ge(()=>Se.screenToSvg);var ct=nh(),tt=Re(ct);{var ft=Be=>{var L=go();X(()=>we(L,(e(V),se(e(Oe)),p(()=>(T(V,e(Oe)),""))))),D(Be,L)};pe(tt,Be=>{e(Oe)&&!e(V)&&Be(ft)})}var At=x(tt);{var Pt=Be=>{var L=wt(),re=Re(L);Le(re,1,()=>e(v),ze,(ve,Te)=>{var xe=wt(),Ke=Re(xe);Le(Ke,1,()=>(e(Te),p(()=>e(Te).rays)),ze,(Xe,fe)=>{var Ne=Zd();X(()=>{g(Ne,"x1",(e(fe),p(()=>e(fe).from.x))),g(Ne,"y1",(e(fe),p(()=>e(fe).from.y))),g(Ne,"x2",(e(fe),p(()=>e(fe).to.x))),g(Ne,"y2",(e(fe),p(()=>e(fe).to.y))),g(Ne,"stroke",(e(fe),p(()=>e(fe).blocked?"#ff000033":"#00ff0033")))}),D(Xe,Ne)}),D(ve,xe)}),D(Be,L)};pe(At,Be=>{o(),e(f),e(v),p(()=>o()&&e(f)&&e(v).length>0)&&Be(Pt)})}var Ct=x(At);Le(Ct,1,s,Be=>Be.id,(Be,L)=>{{let re=Ge(()=>(e(L),l(),p(()=>e(L).id===l())));Mo(Be,{get id(){return e(L),p(()=>e(L).id)},get x(){return e(L),p(()=>e(L).x)},get y(){return e(L),p(()=>e(L).y)},get width(){return e(L),p(()=>e(L).width)},get height(){return e(L),p(()=>e(L).height)},get rotation(){return e(L),p(()=>e(L).rotation)},get selected(){return e(re)},get screenToSvg(){return e(Oe)},onSelect:R,onDrag:_,onRotate:k})}});var kt=x(Ct);Le(kt,1,i,Be=>Be.id,(Be,L)=>{{let re=Ge(()=>(e(L),c(),p(()=>e(L).id===c())));Qr(Be,{get id(){return e(L),p(()=>e(L).id)},get x(){return e(L),p(()=>e(L).x)},get y(){return e(L),p(()=>e(L).y)},get shape(){return e(L),p(()=>e(L).shape)},get segments(){return e(L),p(()=>e(L).segments)},get rotation(){return e(L),p(()=>e(L).rotation)},get selected(){return e(re)},get screenToSvg(){return e(Oe)},onSelect:M,onDrag:A,onRotate:$})}});var Ee=x(kt);Le(Ee,1,a,Be=>Be.id,(Be,L)=>{{let re=Ge(()=>(e(L),p(()=>e(L).name||""))),ve=Ge(()=>(e(L),r(),p(()=>e(L).id===r())));Rs(Be,{get id(){return e(L),p(()=>e(L).id)},get x(){return e(L),p(()=>e(L).x)},get y(){return e(L),p(()=>e(L).y)},get baseType(){return e(L),p(()=>e(L).baseType)},get playerId(){return e(L),p(()=>e(L).playerId)},get rotation(){return e(L),p(()=>e(L).rotation)},get name(){return e(re)},get selected(){return e(ve)},get screenToSvg(){return e(Oe)},onSelect:ie,onDrag:le,onDragEnd:be,onRotate:te,onRotateEnd:N,onRename:q})}});var Fe=x(Ee);{var Ie=Be=>{var L=wt(),re=Re(L);Le(re,1,()=>e(v),ze,(ve,Te)=>{var xe=wt(),Ke=Re(xe);{var Xe=Ne=>{var yt=eh();X(()=>{g(yt,"x1",(e(Te),p(()=>e(Te).firstClearRay.from.x))),g(yt,"y1",(e(Te),p(()=>e(Te).firstClearRay.from.y))),g(yt,"x2",(e(Te),p(()=>e(Te).firstClearRay.to.x))),g(yt,"y2",(e(Te),p(()=>e(Te).firstClearRay.to.y)))}),D(Ne,yt)},fe=Ne=>{var yt=th();X(()=>{g(yt,"x1",(e(f),p(()=>e(f).x))),g(yt,"y1",(e(f),p(()=>e(f).y))),g(yt,"x2",(e(Te),p(()=>e(Te).target.x))),g(yt,"y2",(e(Te),p(()=>e(Te).target.y)))}),D(Ne,yt)};pe(Ke,Ne=>{e(Te),p(()=>e(Te).firstClearRay)?Ne(Xe):Ne(fe,!1)})}D(ve,xe)}),D(Be,L)};pe(Fe,Be=>{o(),e(f),e(v),p(()=>o()&&e(f)&&e(v).length>0)&&Be(Ie)})}var ut=x(Fe);{var _t=Be=>{Rs(Be,{id:"phantom",get x(){return e(I),p(()=>e(I).x)},get y(){return e(I),p(()=>e(I).y)},get baseType(){return e(I),p(()=>e(I).baseType)},get playerId(){return e(w)},rotation:0,selected:!1,get screenToSvg(){return e(Oe)},onSelect:()=>{},onDrag:()=>{},onRotate:()=>{}})};pe(ut,Be=>{e(I)&&Be(_t)})}D(U,ct)}}});var Ye=x(xt,2),De=E(Ye),vt=E(De),Je=x(De,2);{var Qe=U=>{var Se=ah(),Oe=E(Se);X(ct=>we(Oe,`Selected model LOS: ${ct??""}/${e(v),p(()=>e(v).length)??""} visible`),[()=>(e(v),p(()=>e(v).filter(ct=>ct.canSee).length))]),D(U,Se)};pe(Je,U=>{o(),e(f),e(v),p(()=>o()&&e(f)&&e(v).length>0)&&U(Qe)})}X(()=>we(vt,`Battlefield: 60" x 44" | ${s(),p(()=>s().length)??""} terrain | ${i(),p(()=>i().length)??""} walls | ${a(),p(()=>a().length)??""} models`)),D(t,F),Kt(),d()}function ih(t,n){Ut(n,!1);let a=W("main");function r(){const c=window.location.hash;c==="#/debug"?T(a,"debug"):c==="#/setup"?T(a,"setup"):c==="#/deployment"?T(a,"deployment"):c==="#/"||c==="#/layout"?T(a,"main"):T(a,"setup")}cs(()=>(r(),window.addEventListener("hashchange",r),()=>window.removeEventListener("hashchange",r))),jt();var s=wt(),i=Re(s);{var o=c=>{rh(c,{})},l=c=>{var u=wt(),d=Re(u);{var f=h=>{Qu(h,{})},m=h=>{var y=wt(),v=Re(y);{var b=R=>{Ud(R,{})},S=R=>{ku(R,{})};pe(v,R=>{e(a)==="deployment"?R(b):R(S,!1)},!0)}D(h,y)};pe(d,h=>{e(a)==="setup"?h(f):h(m,!1)},!0)}D(c,u)};pe(i,c=>{e(a)==="debug"?c(o):c(l,!1)})}D(t,s),Kt()}dc(ih,{target:document.getElementById("app")});
//# sourceMappingURL=index-DEMiz8vt.js.map
